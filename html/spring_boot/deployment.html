<h1>Deploying Spring Boot Applications</h1> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>Spring Boot’s flexible packaging options provide a great deal of choice when it comes to deploying your application. You can deploy Spring Boot applications to a variety of cloud platforms, to virtual/real machines, or make them fully executable for Unix systems.</p> </div> <div class="paragraph"> <p>This section covers some of the more common deployment scenarios.</p> </div> </div> </div> <div class="sect1"> <h2 id="deployment.cloud">
1. Deploying to the Cloud</h2> <div class="sectionbody"> <div class="paragraph"> <p>Spring Boot’s executable jars are ready-made for most popular cloud PaaS (Platform-as-a-Service) providers. These providers tend to require that you “bring your own container”. They manage application processes (not Java applications specifically), so they need an intermediary layer that adapts <em>your</em> application to the <em>cloud’s</em> notion of a running process.</p> </div> <div class="paragraph"> <p>Two popular cloud providers, Heroku and Cloud Foundry, employ a “buildpack” approach. The buildpack wraps your deployed code in whatever is needed to <em>start</em> your application. It might be a JDK and a call to <code>java</code>, an embedded web server, or a full-fledged application server. A buildpack is pluggable, but ideally you should be able to get by with as few customizations to it as possible. This reduces the footprint of functionality that is not under your control. It minimizes divergence between development and production environments.</p> </div> <div class="paragraph"> <p>Ideally, your application, like a Spring Boot executable jar, has everything that it needs to run packaged within it.</p> </div> <div class="paragraph"> <p>In this section, we look at what it takes to get the <a href="getting-started.html#getting-started.first-application">application that we developed</a> in the “Getting Started” section up and running in the Cloud.</p> </div> <div class="sect2"> <h3 id="deployment.cloud.cloud-foundry">
1.1. Cloud Foundry</h3> <div class="paragraph"> <p>Cloud Foundry provides default buildpacks that come into play if no other buildpack is specified. The Cloud Foundry <a href="https://github.com/cloudfoundry/java-buildpack">Java buildpack</a> has excellent support for Spring applications, including Spring Boot. You can deploy stand-alone executable jar applications as well as traditional <code>.war</code> packaged applications.</p> </div> <div class="paragraph"> <p>Once you have built your application (by using, for example, <code>mvn clean package</code>) and have <a href="https://docs.cloudfoundry.org/cf-cli/install-go-cli.html">installed the <code>cf</code> command line tool</a>, deploy your application by using the <code>cf push</code> command, substituting the path to your compiled <code>.jar</code>. Be sure to have <a href="https://docs.cloudfoundry.org/cf-cli/getting-started.html#login">logged in with your <code>cf</code> command line client</a> before pushing an application. The following line shows using the <code>cf push</code> command to deploy an application:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight" data-language="shell"><code class="language-shell" data-lang="shell">$ cf push acloudyspringtime -p target/demo-0.0.1-SNAPSHOT.jar</code></pre> </div> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon">  </td> <td class="content"> In the preceding example, we substitute <code>acloudyspringtime</code> for whatever value you give <code>cf</code> as the name of your application. </td> </tr> </table> </div> <div class="paragraph"> <p>See the <a href="https://docs.cloudfoundry.org/cf-cli/getting-started.html#push"><code>cf push</code> documentation</a> for more options. If there is a Cloud Foundry <a href="https://docs.cloudfoundry.org/devguide/deploy-apps/manifest.html"><code>manifest.yml</code></a> file present in the same directory, it is considered.</p> </div> <div class="paragraph"> <p>At this point, <code>cf</code> starts uploading your application, producing output similar to the following example:</p> </div> <div class="listingblock"> <div class="content"> <pre data-language="">Uploading acloudyspringtime... <strong>OK</strong>
Preparing to start acloudyspringtime... <strong>OK</strong>
-----&gt; Downloaded app package (<strong>8.9M</strong>)
-----&gt; Java Buildpack Version: v3.12 (offline) | https://github.com/cloudfoundry/java-buildpack.git#6f25b7e
-----&gt; Downloading Open Jdk JRE
       Expanding Open Jdk JRE to .java-buildpack/open_jdk_jre (1.6s)
-----&gt; Downloading Open JDK Like Memory Calculator 2.0.2_RELEASE from https://java-buildpack.cloudfoundry.org/memory-calculator/trusty/x86_64/memory-calculator-2.0.2_RELEASE.tar.gz (found in cache)
       Memory Settings: -Xss349K -Xmx681574K -XX:MaxMetaspaceSize=104857K -Xms681574K -XX:MetaspaceSize=104857K
-----&gt; Downloading Container Certificate Trust Store 1.0.0_RELEASE from https://java-buildpack.cloudfoundry.org/container-certificate-trust-store/container-certificate-trust-store-1.0.0_RELEASE.jar (found in cache)
       Adding certificates to .java-buildpack/container_certificate_trust_store/truststore.jks (0.6s)
-----&gt; Downloading Spring Auto Reconfiguration 1.10.0_RELEASE from https://java-buildpack.cloudfoundry.org/auto-reconfiguration/auto-reconfiguration-1.10.0_RELEASE.jar (found in cache)
Checking status of app 'acloudyspringtime'...
  0 of 1 instances running (1 starting)
  ...
  0 of 1 instances running (1 starting)
  ...
  0 of 1 instances running (1 starting)
  ...
  1 of 1 instances running (1 running)

App started</pre> </div> </div> <div class="paragraph"> <p>Congratulations! The application is now live!</p> </div> <div class="paragraph"> <p>Once your application is live, you can verify the status of the deployed application by using the <code>cf apps</code> command, as shown in the following example:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight" data-language="shell"><code class="language-shell" data-lang="shell">$ cf apps
Getting applications in ...
OK

name                 requested state   instances   memory   disk   urls
...
acloudyspringtime    started           1/1         512M     1G     acloudyspringtime.cfapps.io
...</code></pre> </div> </div> <div class="paragraph"> <p>Once Cloud Foundry acknowledges that your application has been deployed, you should be able to find the application at the URI given. In the preceding example, you could find it at <code>https://acloudyspringtime.cfapps.io/</code>.</p> </div> <div class="sect3"> <h4 id="deployment.cloud.cloud-foundry.binding-to-services">
1.1.1. Binding to Services</h4> <div class="paragraph"> <p>By default, metadata about the running application as well as service connection information is exposed to the application as environment variables (for example: <code>$VCAP_SERVICES</code>). This architecture decision is due to Cloud Foundry’s polyglot (any language and platform can be supported as a buildpack) nature. Process-scoped environment variables are language agnostic.</p> </div> <div class="paragraph"> <p>Environment variables do not always make for the easiest API, so Spring Boot automatically extracts them and flattens the data into properties that can be accessed through Spring’s <code>Environment</code> abstraction, as shown in the following example:</p> </div> <div class="listingblock primary"> <div class="title">Java</div> <div class="content"> <pre class="highlight" data-language="java"><code class="language-java" data-lang="java"><span class="fold-block hide-when-folded">import org.springframework.context.EnvironmentAware;
import org.springframework.core.env.Environment;
import org.springframework.stereotype.Component;

</span><span class="fold-block">@Component
public class MyBean implements EnvironmentAware {

    private String instanceId;

    @Override
    public void setEnvironment(Environment environment) {
        this.instanceId = environment.getProperty("vcap.application.instance_id");
    }

    // ...

}
</span></code></pre> </div> </div> <div class="listingblock secondary"> <div class="title">Kotlin</div> <div class="content"> <pre class="highlight" data-language="kotlin"><code class="language-kotlin" data-lang="kotlin"><span class="fold-block hide-when-folded">import org.springframework.context.EnvironmentAware
import org.springframework.core.env.Environment
import org.springframework.stereotype.Component

</span><span class="fold-block">@Component
class MyBean : EnvironmentAware {

    private var instanceId: String? = null

    override fun setEnvironment(environment: Environment) {
        instanceId = environment.getProperty("vcap.application.instance_id")
    }

    // ...

}
</span></code></pre> </div> </div> <div class="paragraph"> <p>All Cloud Foundry properties are prefixed with <code>vcap</code>. You can use <code>vcap</code> properties to access application information (such as the public URL of the application) and service information (such as database credentials). See the <a href="https://docs.spring.io/spring-boot/docs/3.1.3/api/org/springframework/boot/cloud/CloudFoundryVcapEnvironmentPostProcessor.html"><code>CloudFoundryVcapEnvironmentPostProcessor</code></a> Javadoc for complete details.</p> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon">  </td> <td class="content"> The <a href="https://github.com/pivotal-cf/java-cfenv/">Java CFEnv</a> project is a better fit for tasks such as configuring a DataSource. </td> </tr> </table> </div> </div> </div> <div class="sect2"> <h3 id="deployment.cloud.kubernetes">
1.2. Kubernetes</h3> <div class="paragraph"> <p>Spring Boot auto-detects Kubernetes deployment environments by checking the environment for <code>"*_SERVICE_HOST"</code> and <code>"*_SERVICE_PORT"</code> variables. You can override this detection with the <code>spring.main.cloud-platform</code> configuration property.</p> </div> <div class="paragraph"> <p>Spring Boot helps you to <a href="features.html#features.spring-application.application-availability">manage the state of your application</a> and export it with <a href="actuator.html#actuator.endpoints.kubernetes-probes">HTTP Kubernetes Probes using Actuator</a>.</p> </div> <div class="sect3"> <h4 id="deployment.cloud.kubernetes.container-lifecycle">
1.2.1. Kubernetes Container Lifecycle</h4> <div class="paragraph"> <p>When Kubernetes deletes an application instance, the shutdown process involves several subsystems concurrently: shutdown hooks, unregistering the service, removing the instance from the load-balancer…​ Because this shutdown processing happens in parallel (and due to the nature of distributed systems), there is a window during which traffic can be routed to a pod that has also begun its shutdown processing.</p> </div> <div class="paragraph"> <p>You can configure a sleep execution in a preStop handler to avoid requests being routed to a pod that has already begun shutting down. This sleep should be long enough for new requests to stop being routed to the pod and its duration will vary from deployment to deployment. The preStop handler can be configured by using the PodSpec in the pod’s configuration file as follows:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight" data-language="yaml"><code class="language-yaml" data-lang="yaml">spec:
  containers:
  - name: "example-container"
    image: "example-image"
    lifecycle:
      preStop:
        exec:
          command: ["sh", "-c", "sleep 10"]</code></pre> </div> </div> <div class="paragraph"> <p>Once the pre-stop hook has completed, SIGTERM will be sent to the container and <a href="web.html#web.graceful-shutdown">graceful shutdown</a> will begin, allowing any remaining in-flight requests to complete.</p> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon">  </td> <td class="content"> When Kubernetes sends a SIGTERM signal to the pod, it waits for a specified time called the termination grace period (the default for which is 30 seconds). If the containers are still running after the grace period, they are sent the SIGKILL signal and forcibly removed. If the pod takes longer than 30 seconds to shut down, which could be because you have increased <code>spring.lifecycle.timeout-per-shutdown-phase</code>, make sure to increase the termination grace period by setting the <code>terminationGracePeriodSeconds</code> option in the Pod YAML. </td> </tr> </table> </div> </div> </div> <div class="sect2"> <h3 id="deployment.cloud.heroku">
1.3. Heroku</h3> <div class="paragraph"> <p>Heroku is another popular PaaS platform. To customize Heroku builds, you provide a <code>Procfile</code>, which provides the incantation required to deploy an application. Heroku assigns a <code>port</code> for the Java application to use and then ensures that routing to the external URI works.</p> </div> <div class="paragraph"> <p>You must configure your application to listen on the correct port. The following example shows the <code>Procfile</code> for our starter REST application:</p> </div> <div class="listingblock"> <div class="content"> <pre data-language="">web: java -Dserver.port=$PORT -jar target/demo-0.0.1-SNAPSHOT.jar</pre> </div> </div> <div class="paragraph"> <p>Spring Boot makes <code>-D</code> arguments available as properties accessible from a Spring <code>Environment</code> instance. The <code>server.port</code> configuration property is fed to the embedded Tomcat, Jetty, or Undertow instance, which then uses the port when it starts up. The <code>$PORT</code> environment variable is assigned to us by the Heroku PaaS.</p> </div> <div class="paragraph"> <p>This should be everything you need. The most common deployment workflow for Heroku deployments is to <code>git push</code> the code to production, as shown in the following example:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight" data-language="shell"><code class="language-shell" data-lang="shell">$ git push heroku main</code></pre> </div> </div> <div class="paragraph"> <p>Which will result in the following:</p> </div> <div class="listingblock"> <div class="content"> <pre data-language="">Initializing repository, <strong>done</strong>.
Counting objects: 95, <strong>done</strong>.
Delta compression using up to 8 threads.
Compressing objects: 100% (78/78), <strong>done</strong>.
Writing objects: 100% (95/95), 8.66 MiB | 606.00 KiB/s, <strong>done</strong>.
Total 95 (delta 31), reused 0 (delta 0)

-----&gt; Java app detected
-----&gt; Installing OpenJDK... <strong>done</strong>
-----&gt; Installing Maven... <strong>done</strong>
-----&gt; Installing settings.xml... <strong>done</strong>
-----&gt; Executing: mvn -B -DskipTests=true clean install

       [INFO] Scanning for projects...
       Downloading: https://repo.spring.io/...
       Downloaded: https://repo.spring.io/... (818 B at 1.8 KB/sec)
        ....
       Downloaded: https://s3pository.heroku.com/jvm/... (152 KB at 595.3 KB/sec)
       [INFO] Installing /tmp/build_0c35a5d2-a067-4abc-a232-14b1fb7a8229/target/...
       [INFO] Installing /tmp/build_0c35a5d2-a067-4abc-a232-14b1fb7a8229/pom.xml ...
       [INFO] ------------------------------------------------------------------------
       [INFO] <strong>BUILD SUCCESS</strong>
       [INFO] ------------------------------------------------------------------------
       [INFO] Total time: 59.358s
       [INFO] Finished at: Fri Mar 07 07:28:25 UTC 2014
       [INFO] Final Memory: 20M/493M
       [INFO] ------------------------------------------------------------------------

-----&gt; Discovering process types
       Procfile declares types -&gt; <strong>web</strong>

-----&gt; Compressing... <strong>done</strong>, 70.4MB
-----&gt; Launching... <strong>done</strong>, v6
       https://agile-sierra-1405.herokuapp.com/ <strong>deployed to Heroku</strong>

To git@heroku.com:agile-sierra-1405.git
 * [new branch]      main -&gt; main</pre> </div> </div> <div class="paragraph"> <p>Your application should now be up and running on Heroku. For more details, see <a href="https://devcenter.heroku.com/articles/deploying-spring-boot-apps-to-heroku">Deploying Spring Boot Applications to Heroku</a>.</p> </div> </div> <div class="sect2"> <h3 id="deployment.cloud.openshift">
1.4. OpenShift</h3> <div class="paragraph"> <p><a href="https://www.openshift.com/">OpenShift</a> has many resources describing how to deploy Spring Boot applications, including:</p> </div> <div class="ulist"> <ul> <li> <p><a href="https://blog.openshift.com/using-openshift-enterprise-grade-spring-boot-deployments/">Using the S2I builder</a></p> </li> <li> <p><a href="https://access.redhat.com/documentation/en-us/reference_architectures/2017/html-single/spring_boot_microservices_on_red_hat_openshift_container_platform_3/">Architecture guide</a></p> </li> <li> <p><a href="https://blog.openshift.com/using-spring-boot-on-openshift/">Running as a traditional web application on Wildfly</a></p> </li> <li> <p><a href="https://blog.openshift.com/openshift-commons-briefing-96-cloud-native-applications-spring-rhoar/">OpenShift Commons Briefing</a></p> </li> </ul> </div> </div> <div class="sect2"> <h3 id="deployment.cloud.aws">
1.5. Amazon Web Services (AWS)</h3> <div class="paragraph"> <p>Amazon Web Services offers multiple ways to install Spring Boot-based applications, either as traditional web applications (war) or as executable jar files with an embedded web server. The options include:</p> </div> <div class="ulist"> <ul> <li> <p>AWS Elastic Beanstalk</p> </li> <li> <p>AWS Code Deploy</p> </li> <li> <p>AWS OPS Works</p> </li> <li> <p>AWS Cloud Formation</p> </li> <li> <p>AWS Container Registry</p> </li> </ul> </div> <div class="paragraph"> <p>Each has different features and pricing models. In this document, we describe to approach using AWS Elastic Beanstalk.</p> </div> <div class="sect3"> <h4 id="deployment.cloud.aws.beanstalk">
1.5.1. AWS Elastic Beanstalk</h4> <div class="paragraph"> <p>As described in the official <a href="https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/create_deploy_Java.html">Elastic Beanstalk Java guide</a>, there are two main options to deploy a Java application. You can either use the “Tomcat Platform” or the “Java SE platform”.</p> </div> <div class="sect4"> <h5 id="deployment.cloud.aws.beanstalk.tomcat-platform">
Using the Tomcat Platform</h5> <div class="paragraph"> <p>This option applies to Spring Boot projects that produce a war file. No special configuration is required. You need only follow the official guide.</p> </div> </div> <div class="sect4"> <h5 id="deployment.cloud.aws.beanstalk.java-se-platform">
Using the Java SE Platform</h5> <div class="paragraph"> <p>This option applies to Spring Boot projects that produce a jar file and run an embedded web container. Elastic Beanstalk environments run an nginx instance on port 80 to proxy the actual application, running on port 5000. To configure it, add the following line to your <code>application.properties</code> file:</p> </div> <div class="listingblock"> <div class="content"> <pre data-language="">server.port=5000</pre> </div> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon">  </td> <td class="content"> <div class="title">Upload binaries instead of sources</div> <div class="paragraph"> <p>By default, Elastic Beanstalk uploads sources and compiles them in AWS. However, it is best to upload the binaries instead. To do so, add lines similar to the following to your <code>.elasticbeanstalk/config.yml</code> file:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight" data-language="xml"><code class="language-xml" data-lang="xml">deploy:
    artifact: target/demo-0.0.1-SNAPSHOT.jar</code></pre> </div> </div> </td> </tr> </table> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon">  </td> <td class="content"> <div class="title">Reduce costs by setting the environment type</div> <div class="paragraph"> <p>By default an Elastic Beanstalk environment is load balanced. The load balancer has a significant cost. To avoid that cost, set the environment type to “Single instance”, as described in <a href="https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/environments-create-wizard.html#environments-create-wizard-capacity">the Amazon documentation</a>. You can also create single instance environments by using the CLI and the following command:</p> </div> <div class="listingblock"> <div class="content"> <pre data-language="">eb create -s</pre> </div> </div> </td> </tr> </table> </div> </div> </div> <div class="sect3"> <h4 id="deployment.cloud.aws.summary">
1.5.2. Summary</h4> <div class="paragraph"> <p>This is one of the easiest ways to get to AWS, but there are more things to cover, such as how to integrate Elastic Beanstalk into any CI / CD tool, use the Elastic Beanstalk Maven plugin instead of the CLI, and others. There is a <a href="https://exampledriven.wordpress.com/2017/01/09/spring-boot-aws-elastic-beanstalk-example/">blog post</a> covering these topics more in detail.</p> </div> </div> </div> <div class="sect2"> <h3 id="deployment.cloud.boxfuse">
1.6. CloudCaptain and Amazon Web Services</h3> <div class="paragraph"> <p><a href="https://cloudcaptain.sh/">CloudCaptain</a> works by turning your Spring Boot executable jar or war into a minimal VM image that can be deployed unchanged either on VirtualBox or on AWS. CloudCaptain comes with deep integration for Spring Boot and uses the information from your Spring Boot configuration file to automatically configure ports and health check URLs. CloudCaptain leverages this information both for the images it produces as well as for all the resources it provisions (instances, security groups, elastic load balancers, and so on).</p> </div> <div class="paragraph"> <p>Once you have created a <a href="https://console.cloudcaptain.sh">CloudCaptain account</a>, connected it to your AWS account, installed the latest version of the CloudCaptain Client, and ensured that the application has been built by Maven or Gradle (by using, for example, <code>mvn clean package</code>), you can deploy your Spring Boot application to AWS with a command similar to the following:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight" data-language="shell"><code class="language-shell" data-lang="shell">$ boxfuse run myapp-1.0.jar -env=prod</code></pre> </div> </div> <div class="paragraph"> <p>See the <a href="https://cloudcaptain.sh/docs/commandline/run.html"><code>boxfuse run</code> documentation</a> for more options. If there is a <a href="https://cloudcaptain.sh/docs/commandline/#configuration"><code>boxfuse.conf</code></a> file present in the current directory, it is considered.</p> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon">  </td> <td class="content"> By default, CloudCaptain activates a Spring profile named <code>boxfuse</code> on startup. If your executable jar or war contains an <a href="https://cloudcaptain.sh/docs/payloads/springboot.html#configuration"><code>application-boxfuse.properties</code></a> file, CloudCaptain bases its configuration on the properties it contains. </td> </tr> </table> </div> <div class="paragraph"> <p>At this point, CloudCaptain creates an image for your application, uploads it, and configures and starts the necessary resources on AWS, resulting in output similar to the following example:</p> </div> <div class="listingblock"> <div class="content"> <pre data-language="">Fusing Image for myapp-1.0.jar ...
Image fused in 00:06.838s (53937 K) -&gt; axelfontaine/myapp:1.0
Creating axelfontaine/myapp ...
Pushing axelfontaine/myapp:1.0 ...
Verifying axelfontaine/myapp:1.0 ...
Creating Elastic IP ...
Mapping myapp-axelfontaine.boxfuse.io to 52.28.233.167 ...
Waiting for AWS to create an AMI for axelfontaine/myapp:1.0 in eu-central-1 (this may take up to 50 seconds) ...
AMI created in 00:23.557s -&gt; ami-d23f38cf
Creating security group boxfuse-sg_axelfontaine/myapp:1.0 ...
Launching t2.micro instance of axelfontaine/myapp:1.0 (ami-d23f38cf) in eu-central-1 ...
Instance launched in 00:30.306s -&gt; i-92ef9f53
Waiting for AWS to boot Instance i-92ef9f53 and Payload to start at https://52.28.235.61/ ...
Payload started in 00:29.266s -&gt; https://52.28.235.61/
Remapping Elastic IP 52.28.233.167 to i-92ef9f53 ...
Waiting 15s for AWS to complete Elastic IP Zero Downtime transition ...
Deployment completed successfully. axelfontaine/myapp:1.0 is up and running at https://myapp-axelfontaine.boxfuse.io/</pre> </div> </div> <div class="paragraph"> <p>Your application should now be up and running on AWS.</p> </div> <div class="paragraph"> <p>See the blog post on <a href="https://cloudcaptain.sh/blog/spring-boot-ec2.html">deploying Spring Boot apps on EC2</a> as well as the <a href="https://cloudcaptain.sh/docs/payloads/springboot.html">documentation for the CloudCaptain Spring Boot integration</a> to get started with a Maven build to run the app.</p> </div> </div> <div class="sect2"> <h3 id="deployment.cloud.azure">
1.7. Azure</h3> <div class="paragraph"> <p>This <a href="https://spring.io/guides/gs/spring-boot-for-azure/">Getting Started guide</a> walks you through deploying your Spring Boot application to either <a href="https://azure.microsoft.com/en-us/services/spring-cloud/">Azure Spring Cloud</a> or <a href="https://docs.microsoft.com/en-us/azure/app-service/overview">Azure App Service</a>.</p> </div> </div> <div class="sect2"> <h3 id="deployment.cloud.google">
1.8. Google Cloud</h3> <div class="paragraph"> <p>Google Cloud has several options that can be used to launch Spring Boot applications. The easiest to get started with is probably App Engine, but you could also find ways to run Spring Boot in a container with Container Engine or on a virtual machine with Compute Engine.</p> </div> <div class="paragraph"> <p>To deploy your first app to App Engine standard environment, follow <a href="https://codelabs.developers.google.com/codelabs/cloud-app-engine-springboot#0">this tutorial</a>.</p> </div> <div class="paragraph"> <p>Alternatively, App Engine Flex requires you to create an <code>app.yaml</code> file to describe the resources your app requires. Normally, you put this file in <code>src/main/appengine</code>, and it should resemble the following file:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight" data-language="yaml"><code class="language-yaml" data-lang="yaml">service: "default"

runtime: "java17"
env: "flex"

handlers:
- url: "/.*"
  script: "this field is required, but ignored"

manual_scaling:
  instances: 1

health_check:
  enable_health_check: false

env_variables:
  ENCRYPT_KEY: "your_encryption_key_here"</code></pre> </div> </div> <div class="paragraph"> <p>You can deploy the app (for example, with a Maven plugin) by adding the project ID to the build configuration, as shown in the following example:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight" data-language="xml"><code class="language-xml" data-lang="xml">&lt;plugin&gt;
    &lt;groupId&gt;com.google.cloud.tools&lt;/groupId&gt;
    &lt;artifactId&gt;appengine-maven-plugin&lt;/artifactId&gt;
    &lt;version&gt;2.4.4&lt;/version&gt;
    &lt;configuration&gt;
        &lt;project&gt;myproject&lt;/project&gt;
    &lt;/configuration&gt;
&lt;/plugin&gt;</code></pre> </div> </div> <div class="paragraph"> <p>Then deploy with <code>mvn appengine:deploy</code> (you need to authenticate first, otherwise the build fails).</p> </div> </div> </div> </div> <div class="sect1"> <h2 id="deployment.installing">
2. Installing Spring Boot Applications</h2> <div class="sectionbody"> <div class="paragraph"> <p>In addition to running Spring Boot applications by using <code>java -jar</code>, it is also possible to make fully executable applications for Unix systems. A fully executable jar can be executed like any other executable binary or it can be <a href="#deployment.installing.nix-services">registered with <code>init.d</code> or <code>systemd</code></a>. This helps when installing and managing Spring Boot applications in common production environments.</p> </div> <div class="admonitionblock caution"> <table> <tr> <td class="icon">  </td> <td class="content"> Fully executable jars work by embedding an extra script at the front of the file. Currently, some tools do not accept this format, so you may not always be able to use this technique. For example, <code>jar -xf</code> may silently fail to extract a jar or war that has been made fully executable. It is recommended that you make your jar or war fully executable only if you intend to execute it directly, rather than running it with <code>java -jar</code> or deploying it to a servlet container. </td> </tr> </table> </div> <div class="admonitionblock caution"> <table> <tr> <td class="icon">  </td> <td class="content"> A zip64-format jar file cannot be made fully executable. Attempting to do so will result in a jar file that is reported as corrupt when executed directly or with <code>java -jar</code>. A standard-format jar file that contains one or more zip64-format nested jars can be fully executable. </td> </tr> </table> </div> <div class="paragraph"> <p>To create a ‘fully executable’ jar with Maven, use the following plugin configuration:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight" data-language="xml"><code class="language-xml" data-lang="xml">&lt;plugin&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
    &lt;configuration&gt;
        &lt;executable&gt;true&lt;/executable&gt;
    &lt;/configuration&gt;
&lt;/plugin&gt;</code></pre> </div> </div> <div class="paragraph"> <p>The following example shows the equivalent Gradle configuration:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight" data-language="gradle"><code class="language-gradle" data-lang="gradle">tasks.named('bootJar') {
    launchScript()
}</code></pre> </div> </div> <div class="paragraph"> <p>You can then run your application by typing <code>./my-application.jar</code> (where <code>my-application</code> is the name of your artifact). The directory containing the jar is used as your application’s working directory.</p> </div> <div class="sect2"> <h3 id="deployment.installing.supported-operating-systems">
2.1. Supported Operating Systems</h3> <div class="paragraph"> <p>The default script supports most Linux distributions and is tested on CentOS and Ubuntu. Other platforms, such as OS X and FreeBSD, require the use of a custom <code>embeddedLaunchScript</code>.</p> </div> </div> <div class="sect2"> <h3 id="deployment.installing.nix-services">
2.2. Unix/Linux Services</h3> <div class="paragraph"> <p>Spring Boot application can be easily started as Unix/Linux services by using either <code>init.d</code> or <code>systemd</code>.</p> </div> <div class="sect3"> <h4 id="deployment.installing.nix-services.init-d">
2.2.1. Installation as an init.d Service (System V)</h4> <div class="paragraph"> <p>If you configured Spring Boot’s Maven or Gradle plugin to generate a <a href="#deployment.installing">fully executable jar</a>, and you do not use a custom <code>embeddedLaunchScript</code>, your application can be used as an <code>init.d</code> service. To do so, symlink the jar to <code>init.d</code> to support the standard <code>start</code>, <code>stop</code>, <code>restart</code>, and <code>status</code> commands.</p> </div> <div class="paragraph"> <p>The script supports the following features:</p> </div> <div class="ulist"> <ul> <li> <p>Starts the services as the user that owns the jar file</p> </li> <li> <p>Tracks the application’s PID by using <code>/var/run/&lt;appname&gt;/&lt;appname&gt;.pid</code></p> </li> <li> <p>Writes console logs to <code>/var/log/&lt;appname&gt;.log</code></p> </li> </ul> </div> <div class="paragraph"> <p>Assuming that you have a Spring Boot application installed in <code>/var/myapp</code>, to install a Spring Boot application as an <code>init.d</code> service, create a symlink, as follows:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight" data-language="shell"><code class="language-shell" data-lang="shell">$ sudo ln -s /var/myapp/myapp.jar /etc/init.d/myapp</code></pre> </div> </div> <div class="paragraph"> <p>Once installed, you can start and stop the service in the usual way. For example, on a Debian-based system, you could start it with the following command:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight" data-language="shell"><code class="language-shell" data-lang="shell">$ service myapp start</code></pre> </div> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon">  </td> <td class="content"> If your application fails to start, check the log file written to <code>/var/log/&lt;appname&gt;.log</code> for errors. </td> </tr> </table> </div> <div class="paragraph"> <p>You can also flag the application to start automatically by using your standard operating system tools. For example, on Debian, you could use the following command:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight" data-language="shell"><code class="language-shell" data-lang="shell">$ update-rc.d myapp defaults &lt;priority&gt;</code></pre> </div> </div> <div class="sect4"> <h5 id="deployment.installing.nix-services.init-d.securing">
Securing an init.d Service</h5> <div class="admonitionblock note"> <table> <tr> <td class="icon">  </td> <td class="content"> The following is a set of guidelines on how to secure a Spring Boot application that runs as an init.d service. It is not intended to be an exhaustive list of everything that should be done to harden an application and the environment in which it runs. </td> </tr> </table> </div> <div class="paragraph"> <p>When executed as root, as is the case when root is being used to start an init.d service, the default executable script runs the application as the user specified in the <code>RUN_AS_USER</code> environment variable. When the environment variable is not set, the user who owns the jar file is used instead. You should never run a Spring Boot application as <code>root</code>, so <code>RUN_AS_USER</code> should never be root and your application’s jar file should never be owned by root. Instead, create a specific user to run your application and set the <code>RUN_AS_USER</code> environment variable or use <code>chown</code> to make it the owner of the jar file, as shown in the following example:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight" data-language="shell"><code class="language-shell" data-lang="shell">$ chown bootapp:bootapp your-app.jar</code></pre> </div> </div> <div class="paragraph"> <p>In this case, the default executable script runs the application as the <code>bootapp</code> user.</p> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon">  </td> <td class="content"> To reduce the chances of the application’s user account being compromised, you should consider preventing it from using a login shell. For example, you can set the account’s shell to <code>/usr/sbin/nologin</code>. </td> </tr> </table> </div> <div class="paragraph"> <p>You should also take steps to prevent the modification of your application’s jar file. Firstly, configure its permissions so that it cannot be written and can only be read or executed by its owner, as shown in the following example:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight" data-language="shell"><code class="language-shell" data-lang="shell">$ chmod 500 your-app.jar</code></pre> </div> </div> <div class="paragraph"> <p>Second, you should also take steps to limit the damage if your application or the account that is running it is compromised. If an attacker does gain access, they could make the jar file writable and change its contents. One way to protect against this is to make it immutable by using <code>chattr</code>, as shown in the following example:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight" data-language="shell"><code class="language-shell" data-lang="shell">$ sudo chattr +i your-app.jar</code></pre> </div> </div> <div class="paragraph"> <p>This will prevent any user, including root, from modifying the jar.</p> </div> <div class="paragraph"> <p>If root is used to control the application’s service and you <a href="#deployment.installing.nix-services.script-customization.when-running.conf-file">use a <code>.conf</code> file</a> to customize its startup, the <code>.conf</code> file is read and evaluated by the root user. It should be secured accordingly. Use <code>chmod</code> so that the file can only be read by the owner and use <code>chown</code> to make root the owner, as shown in the following example:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight" data-language="shell"><code class="language-shell" data-lang="shell">$ chmod 400 your-app.conf
$ sudo chown root:root your-app.conf</code></pre> </div> </div> </div> </div> <div class="sect3"> <h4 id="deployment.installing.nix-services.system-d">
2.2.2. Installation as a systemd Service</h4> <div class="paragraph"> <p><code>systemd</code> is the successor of the System V init system and is now being used by many modern Linux distributions. Although you can continue to use <code>init.d</code> scripts with <code>systemd</code>, it is also possible to launch Spring Boot applications by using <code>systemd</code> ‘service’ scripts.</p> </div> <div class="paragraph"> <p>Assuming that you have a Spring Boot application installed in <code>/var/myapp</code>, to install a Spring Boot application as a <code>systemd</code> service, create a script named <code>myapp.service</code> and place it in <code>/etc/systemd/system</code> directory. The following script offers an example:</p> </div> <div class="listingblock"> <div class="content"> <pre data-language="">[Unit]
Description=myapp
After=syslog.target

[Service]
User=myapp
ExecStart=/var/myapp/myapp.jar
SuccessExitStatus=143

[Install]
WantedBy=multi-user.target</pre> </div> </div> <div class="admonitionblock important"> <table> <tr> <td class="icon">  </td> <td class="content"> Remember to change the <code>Description</code>, <code>User</code>, and <code>ExecStart</code> fields for your application. </td> </tr> </table> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon">  </td> <td class="content"> The <code>ExecStart</code> field does not declare the script action command, which means that the <code>run</code> command is used by default. </td> </tr> </table> </div> <div class="paragraph"> <p>Note that, unlike when running as an <code>init.d</code> service, the user that runs the application, the PID file, and the console log file are managed by <code>systemd</code> itself and therefore must be configured by using appropriate fields in the ‘service’ script. Consult the <a href="https://www.freedesktop.org/software/systemd/man/systemd.service.html">service unit configuration man page</a> for more details.</p> </div> <div class="paragraph"> <p>To flag the application to start automatically on system boot, use the following command:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight" data-language="shell"><code class="language-shell" data-lang="shell">$ systemctl enable myapp.service</code></pre> </div> </div> <div class="paragraph"> <p>Run <code>man systemctl</code> for more details.</p> </div> </div> <div class="sect3"> <h4 id="deployment.installing.nix-services.script-customization">
2.2.3. Customizing the Startup Script</h4> <div class="paragraph"> <p>The default embedded startup script written by the Maven or Gradle plugin can be customized in a number of ways. For most people, using the default script along with a few customizations is usually enough. If you find you cannot customize something that you need to, use the <code>embeddedLaunchScript</code> option to write your own file entirely.</p> </div> <div class="sect4"> <h5 id="deployment.installing.nix-services.script-customization.when-written">
Customizing the Start Script When It Is Written</h5> <div class="paragraph"> <p>It often makes sense to customize elements of the start script as it is written into the jar file. For example, init.d scripts can provide a “description”. Since you know the description up front (and it need not change), you may as well provide it when the jar is generated.</p> </div> <div class="paragraph"> <p>To customize written elements, use the <code>embeddedLaunchScriptProperties</code> option of the Spring Boot Maven plugin or the <a href="https://docs.spring.io/spring-boot/docs/3.1.3/gradle-plugin/reference/htmlsingle/#packaging-executable-configuring-launch-script"><code>properties</code> property of the Spring Boot Gradle plugin’s <code>launchScript</code></a>.</p> </div> <div class="paragraph"> <p>The following property substitutions are supported with the default script:</p> </div> <table class="tableblock frame-all grid-all stretch"> <colgroup> <col style="width: 10%;"> <col style="width: 30%;"> <col style="width: 30%;"> <col style="width: 30%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Name</th> <th class="tableblock halign-left valign-top">Description</th> <th class="tableblock halign-left valign-top">Gradle default</th> <th class="tableblock halign-left valign-top">Maven default</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>mode</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">The script mode.</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>auto</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>auto</code></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>initInfoProvides</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">The <code>Provides</code> section of “INIT INFO”</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>${task.baseName}</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>${project.artifactId}</code></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>initInfoRequiredStart</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>Required-Start</code> section of “INIT INFO”.</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>$remote_fs $syslog $network</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>$remote_fs $syslog $network</code></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>initInfoRequiredStop</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>Required-Stop</code> section of “INIT INFO”.</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>$remote_fs $syslog $network</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>$remote_fs $syslog $network</code></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>initInfoDefaultStart</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>Default-Start</code> section of “INIT INFO”.</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>2 3 4 5</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>2 3 4 5</code></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>initInfoDefaultStop</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>Default-Stop</code> section of “INIT INFO”.</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>0 1 6</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>0 1 6</code></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>initInfoShortDescription</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>Short-Description</code> section of “INIT INFO”.</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Single-line version of <code>${project.description}</code> (falling back to <code>${task.baseName}</code>)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>${project.name}</code></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>initInfoDescription</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>Description</code> section of “INIT INFO”.</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>${project.description}</code> (falling back to <code>${task.baseName}</code>)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>${project.description}</code> (falling back to <code>${project.name}</code>)</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>initInfoChkconfig</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>chkconfig</code> section of “INIT INFO”</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>2345 99 01</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>2345 99 01</code></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>confFolder</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">The default value for <code>CONF_FOLDER</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Folder containing the jar</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Folder containing the jar</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>inlinedConfScript</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Reference to a file script that should be inlined in the default launch script. This can be used to set environmental variables such as <code>JAVA_OPTS</code> before any external config files are loaded</p></td> <td class="tableblock halign-left valign-top"></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>logFolder</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Default value for <code>LOG_FOLDER</code>. Only valid for an <code>init.d</code> service</p></td> <td class="tableblock halign-left valign-top"></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>logFilename</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Default value for <code>LOG_FILENAME</code>. Only valid for an <code>init.d</code> service</p></td> <td class="tableblock halign-left valign-top"></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>pidFolder</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Default value for <code>PID_FOLDER</code>. Only valid for an <code>init.d</code> service</p></td> <td class="tableblock halign-left valign-top"></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>pidFilename</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Default value for the name of the PID file in <code>PID_FOLDER</code>. Only valid for an <code>init.d</code> service</p></td> <td class="tableblock halign-left valign-top"></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>useStartStopDaemon</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Whether the <code>start-stop-daemon</code> command, when it is available, should be used to control the process</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>stopWaitTime</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Default value for <code>STOP_WAIT_TIME</code> in seconds. Only valid for an <code>init.d</code> service</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">60</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">60</p></td> </tr> </tbody> </table> </div> <div class="sect4"> <h5 id="deployment.installing.nix-services.script-customization.when-running">
Customizing a Script When It Runs</h5> <div class="paragraph"> <p>For items of the script that need to be customized <em>after</em> the jar has been written, you can use environment variables or a <a href="#deployment.installing.nix-services.script-customization.when-running.conf-file">config file</a>.</p> </div> <div class="paragraph"> <p>The following environment properties are supported with the default script:</p> </div> <table class="tableblock frame-all grid-all stretch"> <colgroup> <col style="width: 14.2857%;"> <col style="width: 85.7143%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Variable</th> <th class="tableblock halign-left valign-top">Description</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>MODE</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">The “mode” of operation. The default depends on the way the jar was built but is usually <code>auto</code> (meaning it tries to guess if it is an init script by checking if it is a symlink in a directory called <code>init.d</code>). You can explicitly set it to <code>service</code> so that the <code>stop|start|status|restart</code> commands work or to <code>run</code> if you want to run the script in the foreground.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>RUN_AS_USER</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">The user that will be used to run the application. When not set, the user that owns the jar file will be used.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>USE_START_STOP_DAEMON</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Whether the <code>start-stop-daemon</code> command, when it is available, should be used to control the process. Defaults to <code>true</code>.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>PID_FOLDER</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">The root name of the pid folder (<code>/var/run</code> by default).</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>LOG_FOLDER</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">The name of the folder in which to put log files (<code>/var/log</code> by default).</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>CONF_FOLDER</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">The name of the folder from which to read .conf files (same folder as jar-file by default).</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>LOG_FILENAME</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">The name of the log file in the <code>LOG_FOLDER</code> (<code>&lt;appname&gt;.log</code> by default).</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>APP_NAME</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">The name of the app. If the jar is run from a symlink, the script guesses the app name. If it is not a symlink or you want to explicitly set the app name, this can be useful.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>RUN_ARGS</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">The arguments to pass to the program (the Spring Boot app).</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>JAVA_HOME</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">The location of the <code>java</code> executable is discovered by using the <code>PATH</code> by default, but you can set it explicitly if there is an executable file at <code>$JAVA_HOME/bin/java</code>.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>JAVA_OPTS</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Options that are passed to the JVM when it is launched.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>JARFILE</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">The explicit location of the jar file, in case the script is being used to launch a jar that it is not actually embedded.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>DEBUG</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">If not empty, sets the <code>-x</code> flag on the shell process, allowing you to see the logic in the script.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>STOP_WAIT_TIME</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">The time in seconds to wait when stopping the application before forcing a shutdown (<code>60</code> by default).</p></td> </tr> </tbody> </table> <div class="admonitionblock note"> <table> <tr> <td class="icon">  </td> <td class="content"> The <code>PID_FOLDER</code>, <code>LOG_FOLDER</code>, and <code>LOG_FILENAME</code> variables are only valid for an <code>init.d</code> service. For <code>systemd</code>, the equivalent customizations are made by using the ‘service’ script. See the <a href="https://www.freedesktop.org/software/systemd/man/systemd.service.html">service unit configuration man page</a> for more details. </td> </tr> </table> </div> <div id="deployment.installing.nix-services.script-customization.when-running.conf-file" class="paragraph"> <p>With the exception of <code>JARFILE</code> and <code>APP_NAME</code>, the settings listed in the preceding section can be configured by using a <code>.conf</code> file. The file is expected to be next to the jar file and have the same name but suffixed with <code>.conf</code> rather than <code>.jar</code>. For example, a jar named <code>/var/myapp/myapp.jar</code> uses the configuration file named <code>/var/myapp/myapp.conf</code>, as shown in the following example:</p> </div> <div class="listingblock"> <div class="title">myapp.conf</div> <div class="content"> <pre data-language="">JAVA_OPTS=-Xmx1024M
LOG_FOLDER=/custom/log/folder</pre> </div> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon">  </td> <td class="content"> If you do not like having the config file next to the jar file, you can set a <code>CONF_FOLDER</code> environment variable to customize the location of the config file. </td> </tr> </table> </div> <div class="paragraph"> <p>To learn about securing this file appropriately, see <a href="#deployment.installing.nix-services.init-d.securing">the guidelines for securing an init.d service</a>.</p> </div> </div> </div> </div> <div class="sect2"> <h3 id="deployment.installing.windows-services">
2.3. Microsoft Windows Services</h3> <div class="paragraph"> <p>A Spring Boot application can be started as a Windows service by using <a href="https://github.com/kohsuke/winsw"><code>winsw</code></a>.</p> </div> <div class="paragraph"> <p>A (<a href="https://github.com/snicoll/spring-boot-daemon">separately maintained sample</a>) describes step-by-step how you can create a Windows service for your Spring Boot application.</p> </div> </div> </div> </div> <div class="sect1"> <h2 id="deployment.efficient">
3. Efficient deployments</h2> <div class="sectionbody"> <div class="sect2"> <h3 id="deployment.efficient.unpacking">
3.1. Unpacking the Executable JAR</h3> <div class="paragraph"> <p>If you are running your application from a container, you can use an executable jar, but it is also often an advantage to explode it and run it in a different way. Certain PaaS implementations may also choose to unpack archives before they run. For example, Cloud Foundry operates this way. One way to run an unpacked archive is by starting the appropriate launcher, as follows:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight" data-language="shell"><code class="language-shell" data-lang="shell">$ jar -xf myapp.jar
$ java org.springframework.boot.loader.JarLauncher</code></pre> </div> </div> <div class="paragraph"> <p>This is actually slightly faster on startup (depending on the size of the jar) than running from an unexploded archive. After startup, you should not expect any differences.</p> </div> <div class="paragraph"> <p>Once you have unpacked the jar file, you can also get an extra boost to startup time by running the app with its "natural" main method instead of the <code>JarLauncher</code>. For example:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight" data-language="shell"><code class="language-shell" data-lang="shell">$ jar -xf myapp.jar
$ java -cp "BOOT-INF/classes:BOOT-INF/lib/*" com.example.MyApplication</code></pre> </div> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon">  </td> <td class="content"> Using the <code>JarLauncher</code> over the application’s main method has the added benefit of a predictable classpath order. The jar contains a <code>classpath.idx</code> file which is used by the <code>JarLauncher</code> when constructing the classpath. </td> </tr> </table> </div> </div> <div class="sect2"> <h3 id="deployment.efficient.aot">
3.2. Using Ahead-of-time Processing With the JVM</h3> <div class="paragraph"> <p>It’s beneficial for the startup time to run your application using the AOT generated initialization code. First, you need to ensure that the jar you are building includes AOT generated code.</p> </div> <div class="paragraph"> <p>For Maven, this means that you should build with <code>-Pnative</code> to activate the <code>native</code> profile:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight" data-language="shell"><code class="language-shell" data-lang="shell">$ mvn -Pnative package</code></pre> </div> </div> <div class="paragraph"> <p>For Gradle, you need to ensure that your build includes the <code>org.springframework.boot.aot</code> plugin.</p> </div> <div class="paragraph"> <p>When the JAR has been built, run it with <code>spring.aot.enabled</code> system property set to <code>true</code>. For example:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight" data-language="shell"><code class="language-shell" data-lang="shell">$ java -Dspring.aot.enabled=true -jar myapplication.jar

........ Starting AOT-processed MyApplication ...</code></pre> </div> </div> <div class="paragraph"> <p>Beware that using the ahead-of-time processing has drawbacks. It implies the following restrictions:</p> </div> <div class="ulist"> <ul> <li> <p>The classpath is fixed and fully defined at build time</p> </li> <li> <p>The beans defined in your application cannot change at runtime, meaning:</p> <div class="ulist"> <ul> <li> <p>The Spring <code>@Profile</code> annotation and profile-specific configuration <a href="howto.html#howto.aot.conditions">have limitations</a>.</p> </li> <li> <p>Properties that change if a bean is created are not supported (for example, <code>@ConditionalOnProperty</code> and <code>.enable</code> properties).</p> </li> </ul> </div> </li> </ul> </div> <div class="paragraph"> <p>To learn more about ahead-of-time processing, please see the <a href="native-image.html#native-image.introducing-graalvm-native-images.understanding-aot-processing">Understanding Spring Ahead-of-Time Processing section</a>.</p> </div> </div> </div> </div> <div class="sect1"> <h2 id="deployment.whats-next">
4. What to Read Next</h2> <div class="sectionbody"> <div class="paragraph"> <p>See the <a href="https://www.cloudfoundry.org/">Cloud Foundry</a>, <a href="https://www.heroku.com/">Heroku</a>, <a href="https://www.openshift.com">OpenShift</a>, and <a href="https://boxfuse.com">Boxfuse</a> web sites for more information about the kinds of features that a PaaS can offer. These are just four of the most popular Java PaaS providers. Since Spring Boot is so amenable to cloud-based deployment, you can freely consider other providers as well.</p> </div> <div class="paragraph"> <p>The next section goes on to cover the <em><a href="native-image.html#native-image">GraalVM Native Images</a></em>, or you can jump ahead to read about the <em><a href="cli.html#cli">Spring Boot CLI</a></em> or our <em><a href="build-tool-plugins.html#build-tool-plugins">build tool plugins</a></em>.</p> </div> </div> </div><div class="_attribution">
  <p class="_attribution-p">
    Copyright &copy; 2012-2023 VMware, Inc.<br>Licensed under the Apache License, Version 2.0.<br>
    <a href="https://docs.spring.io/spring-boot/docs/3.1.3/reference/html/deployment.html" class="_attribution-link">https://docs.spring.io/spring-boot/docs/3.1.3/reference/html/deployment.html</a>
  </p>
</div>
