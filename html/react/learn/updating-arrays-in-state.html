<h1>Updating Arrays in State
</h1>
<div><p>Arrays are mutable in JavaScript, but you should treat them as immutable when you store them in state. Just like with objects, when you want to update an array stored in state, you need to create a new one (or make a copy of an existing one), and then set state to use the new array.</p></div> <div class="note">
<h4>You will learn</h4>
<ul> <li>How to add, remove, or change items in an array in React state</li> <li>How to update an object inside of an array</li> <li>How to make array copying less repetitive with Immer</li> </ul>
</div> <h2 id="updating-arrays-without-mutation">Updating arrays without mutation 
</h2> <p>In JavaScript, arrays are just another kind of object. <a href="updating-objects-in-state.html">Like with objects</a>, <strong>you should treat arrays in React state as read-only.</strong> This means that you shouldn’t reassign items inside an array like <code dir="ltr">arr[0] = 'bird'</code>, and you also shouldn’t use methods that mutate the array, such as <code dir="ltr">push()</code> and <code dir="ltr">pop()</code>.</p> <p>Instead, every time you want to update an array, you’ll want to pass a <em>new</em> array to your state setting function. To do that, you can create a new array from the original array in your state by calling its non-mutating methods like <code dir="ltr">filter()</code> and <code dir="ltr">map()</code>. Then you can set your state to the resulting new array.</p> <p>Here is a reference table of common array operations. When dealing with arrays inside React state, you will need to avoid the methods in the left column, and instead prefer the methods in the right column:</p> <table>
<thead><tr>
<th></th>
<th>avoid (mutates the array)</th>
<th>prefer (returns a new array)</th>
</tr></thead>
<tbody>
<tr>
<td>adding</td>
<td>
<code dir="ltr">push</code>, <code dir="ltr">unshift</code>
</td>
<td>
<code dir="ltr">concat</code>, <code dir="ltr">[...arr]</code> spread syntax (<a href="#adding-to-an-array">example</a>)</td>
</tr>
<tr>
<td>removing</td>
<td>
<code dir="ltr">pop</code>, <code dir="ltr">shift</code>, <code dir="ltr">splice</code>
</td>
<td>
<code dir="ltr">filter</code>, <code dir="ltr">slice</code> (<a href="#removing-from-an-array">example</a>)</td>
</tr>
<tr>
<td>replacing</td>
<td>
<code dir="ltr">splice</code>, <code dir="ltr">arr[i] = ...</code> assignment</td>
<td>
<code dir="ltr">map</code> (<a href="#replacing-items-in-an-array">example</a>)</td>
</tr>
<tr>
<td>sorting</td>
<td>
<code dir="ltr">reverse</code>, <code dir="ltr">sort</code>
</td>
<td>copy the array first (<a href="#making-other-changes-to-an-array">example</a>)</td>
</tr>
</tbody>
</table> <p>Alternatively, you can <a href="#write-concise-update-logic-with-immer">use Immer</a> which lets you use methods from both columns.</p> <div class="note note-orange">
<h4>Pitfall</h4>
<div>
<p>Unfortunately, <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/slice" target="_blank" rel="nofollow noopener noreferrer"><code dir="ltr">slice</code></a> and <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/splice" target="_blank" rel="nofollow noopener noreferrer"><code dir="ltr">splice</code></a> are named similarly but are very different:</p>
<ul> <li>
<code dir="ltr">slice</code> lets you copy an array or a part of it.</li> <li>
<code dir="ltr">splice</code> <strong>mutates</strong> the array (to insert or delete items).</li> </ul>
<p>In React, you will be using <code dir="ltr">slice</code> (no <code dir="ltr">p</code>!) a lot more often because you don’t want to mutate objects or arrays in state. <a href="updating-objects-in-state.html">Updating Objects</a> explains what mutation is and why it’s not recommended for state.</p>
</div>
</div> <h3 id="adding-to-an-array">Adding to an array 
</h3> <p><code dir="ltr">push()</code> will mutate an array, which you don’t want:</p> 
<pre data-language="jsx"><span>import</span> <span>{</span> <span>useState</span> <span>}</span> <span>from</span> <span>'react'</span><span>;</span>

<span>let</span> <span>nextId</span> = <span>0</span><span>;</span>

<span>export</span> <span>default</span> <span>function</span> <span>List</span><span>(</span><span>)</span> <span>{</span>
  <span>const</span> <span>[</span><span>name</span><span>,</span> <span>setName</span><span>]</span> = <span>useState</span><span>(</span><span>''</span><span>)</span><span>;</span>
  <span>const</span> <span>[</span><span>artists</span><span>,</span> <span>setArtists</span><span>]</span> = <span>useState</span><span>(</span><span>[</span><span>]</span><span>)</span><span>;</span>

  <span>return</span> <span>(</span>
    <span>&lt;</span><span>&gt;</span>
      <span>&lt;</span><span>h1</span><span>&gt;</span>Inspiring sculptors:<span>&lt;/</span><span>h1</span><span>&gt;</span>
      <span>&lt;</span><span>input</span>
        <span>value</span>=<span>{</span><span>name</span><span>}</span>
        <span>onChange</span>=<span>{</span><span>e</span> <span>=&gt;</span> <span>setName</span><span>(</span><span>e</span>.<span>target</span>.<span>value</span><span>)</span><span>}</span>
      <span>/&gt;</span>
      <span>&lt;</span><span>button</span> <span>onClick</span>=<span>{</span><span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
        <span>artists</span>.<span>push</span><span>(</span><span>{</span>
          <span>id</span><span>:</span> <span>nextId</span>++<span>,</span>
          <span>name</span><span>:</span> <span>name</span><span>,</span>
        <span>}</span><span>)</span><span>;</span>
      <span>}</span><span>}</span><span>&gt;</span>Add<span>&lt;/</span><span>button</span><span>&gt;</span>
      <span>&lt;</span><span>ul</span><span>&gt;</span>
        <span>{</span><span>artists</span>.<span>map</span><span>(</span><span>artist</span> <span>=&gt;</span> <span>(</span>
          <span>&lt;</span><span>li</span> <span>key</span>=<span>{</span><span>artist</span>.<span>id</span><span>}</span><span>&gt;</span><span>{</span><span>artist</span>.<span>name</span><span>}</span><span>&lt;/</span><span>li</span><span>&gt;</span>
        <span>)</span><span>)</span><span>}</span>
      <span>&lt;/</span><span>ul</span><span>&gt;</span>
    <span>&lt;/</span><span>&gt;</span>
  <span>)</span><span>;</span>
<span>}</span>

</pre> <p>Instead, create a <em>new</em> array which contains the existing items <em>and</em> a new item at the end. There are multiple ways to do this, but the easiest one is to use the <code dir="ltr">...</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Spread_syntax#spread_in_array_literals" target="_blank" rel="nofollow noopener noreferrer">array spread</a> syntax:</p> <pre data-language="jsx"><code><span>setArtists</span><span>(</span> <span>// Replace the state</span>
  <span>[</span> <span>// with a new array</span>
    <span>...</span><span>artists</span><span>,</span> <span>// that contains all the old items</span>
    <span>{</span> <span>id</span><span>:</span> <span>nextId</span>++<span>,</span> <span>name</span><span>:</span> <span>name</span> <span>}</span> <span>// and one new item at the end</span>
  <span>]</span>
<span>)</span><span>;</span></code></pre> <p>Now it works correctly:</p> 
<pre data-language="jsx"><span>import</span> <span>{</span> <span>useState</span> <span>}</span> <span>from</span> <span>'react'</span><span>;</span>

<span>let</span> <span>nextId</span> = <span>0</span><span>;</span>

<span>export</span> <span>default</span> <span>function</span> <span>List</span><span>(</span><span>)</span> <span>{</span>
  <span>const</span> <span>[</span><span>name</span><span>,</span> <span>setName</span><span>]</span> = <span>useState</span><span>(</span><span>''</span><span>)</span><span>;</span>
  <span>const</span> <span>[</span><span>artists</span><span>,</span> <span>setArtists</span><span>]</span> = <span>useState</span><span>(</span><span>[</span><span>]</span><span>)</span><span>;</span>

  <span>return</span> <span>(</span>
    <span>&lt;</span><span>&gt;</span>
      <span>&lt;</span><span>h1</span><span>&gt;</span>Inspiring sculptors:<span>&lt;/</span><span>h1</span><span>&gt;</span>
      <span>&lt;</span><span>input</span>
        <span>value</span>=<span>{</span><span>name</span><span>}</span>
        <span>onChange</span>=<span>{</span><span>e</span> <span>=&gt;</span> <span>setName</span><span>(</span><span>e</span>.<span>target</span>.<span>value</span><span>)</span><span>}</span>
      <span>/&gt;</span>
      <span>&lt;</span><span>button</span> <span>onClick</span>=<span>{</span><span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
        <span>setArtists</span><span>(</span><span>[</span>
          <span>...</span><span>artists</span><span>,</span>
          <span>{</span> <span>id</span><span>:</span> <span>nextId</span>++<span>,</span> <span>name</span><span>:</span> <span>name</span> <span>}</span>
        <span>]</span><span>)</span><span>;</span>
      <span>}</span><span>}</span><span>&gt;</span>Add<span>&lt;/</span><span>button</span><span>&gt;</span>
      <span>&lt;</span><span>ul</span><span>&gt;</span>
        <span>{</span><span>artists</span>.<span>map</span><span>(</span><span>artist</span> <span>=&gt;</span> <span>(</span>
          <span>&lt;</span><span>li</span> <span>key</span>=<span>{</span><span>artist</span>.<span>id</span><span>}</span><span>&gt;</span><span>{</span><span>artist</span>.<span>name</span><span>}</span><span>&lt;/</span><span>li</span><span>&gt;</span>
        <span>)</span><span>)</span><span>}</span>
      <span>&lt;/</span><span>ul</span><span>&gt;</span>
    <span>&lt;/</span><span>&gt;</span>
  <span>)</span><span>;</span>
<span>}</span>

</pre> <p>The array spread syntax also lets you prepend an item by placing it <em>before</em> the original <code dir="ltr">...artists</code>:</p> <pre data-language="jsx"><code><span>setArtists</span><span>(</span><span>[</span>
  <span>{</span> <span>id</span><span>:</span> <span>nextId</span>++<span>,</span> <span>name</span><span>:</span> <span>name</span> <span>}</span><span>,</span>
  <span>...</span><span>artists</span> <span>// Put old items at the end</span>
<span>]</span><span>)</span><span>;</span></code></pre> <p>In this way, spread can do the job of both <code dir="ltr">push()</code> by adding to the end of an array and <code dir="ltr">unshift()</code> by adding to the beginning of an array. Try it in the sandbox above!</p> <h3 id="removing-from-an-array">Removing from an array 
</h3> <p>The easiest way to remove an item from an array is to <em>filter it out</em>. In other words, you will produce a new array that will not contain that item. To do this, use the <code dir="ltr">filter</code> method, for example:</p> 
<pre data-language="jsx"><span>import</span> <span>{</span> <span>useState</span> <span>}</span> <span>from</span> <span>'react'</span><span>;</span>

<span>let</span> <span>initialArtists</span> = <span>[</span>
  <span>{</span> <span>id</span><span>:</span> <span>0</span><span>,</span> <span>name</span><span>:</span> <span>'Marta Colvin Andrade'</span> <span>}</span><span>,</span>
  <span>{</span> <span>id</span><span>:</span> <span>1</span><span>,</span> <span>name</span><span>:</span> <span>'Lamidi Olonade Fakeye'</span><span>}</span><span>,</span>
  <span>{</span> <span>id</span><span>:</span> <span>2</span><span>,</span> <span>name</span><span>:</span> <span>'Louise Nevelson'</span><span>}</span><span>,</span>
<span>]</span><span>;</span>

<span>export</span> <span>default</span> <span>function</span> <span>List</span><span>(</span><span>)</span> <span>{</span>
  <span>const</span> <span>[</span><span>artists</span><span>,</span> <span>setArtists</span><span>]</span> = <span>useState</span><span>(</span>
    <span>initialArtists</span>
  <span>)</span><span>;</span>

  <span>return</span> <span>(</span>
    <span>&lt;</span><span>&gt;</span>
      <span>&lt;</span><span>h1</span><span>&gt;</span>Inspiring sculptors:<span>&lt;/</span><span>h1</span><span>&gt;</span>
      <span>&lt;</span><span>ul</span><span>&gt;</span>
        <span>{</span><span>artists</span>.<span>map</span><span>(</span><span>artist</span> <span>=&gt;</span> <span>(</span>
          <span>&lt;</span><span>li</span> <span>key</span>=<span>{</span><span>artist</span>.<span>id</span><span>}</span><span>&gt;</span>
            <span>{</span><span>artist</span>.<span>name</span><span>}</span><span>{</span><span>' '</span><span>}</span>
            <span>&lt;</span><span>button</span> <span>onClick</span>=<span>{</span><span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
              <span>setArtists</span><span>(</span>
                <span>artists</span>.<span>filter</span><span>(</span><span>a</span> <span>=&gt;</span>
                  <span>a</span>.<span>id</span> !== <span>artist</span>.<span>id</span>
                <span>)</span>
              <span>)</span><span>;</span>
            <span>}</span><span>}</span><span>&gt;</span>
              Delete
            <span>&lt;/</span><span>button</span><span>&gt;</span>
          <span>&lt;/</span><span>li</span><span>&gt;</span>
        <span>)</span><span>)</span><span>}</span>
      <span>&lt;/</span><span>ul</span><span>&gt;</span>
    <span>&lt;/</span><span>&gt;</span>
  <span>)</span><span>;</span>
<span>}</span>

</pre> <p>Click the “Delete” button a few times, and look at its click handler.</p> <pre data-language="jsx"><code><span>setArtists</span><span>(</span>
  <span>artists</span>.<span>filter</span><span>(</span><span>a</span> <span>=&gt;</span> <span>a</span>.<span>id</span> !== <span>artist</span>.<span>id</span><span>)</span>
<span>)</span><span>;</span></code></pre> <p>Here, <code dir="ltr">artists.filter(a =&gt; a.id !== artist.id)</code> means “create an array that consists of those <code dir="ltr">artists</code> whose IDs are different from <code dir="ltr">artist.id</code>”. In other words, each artist’s “Delete” button will filter <em>that</em> artist out of the array, and then request a re-render with the resulting array. Note that <code dir="ltr">filter</code> does not modify the original array.</p> <h3 id="transforming-an-array">Transforming an array 
</h3> <p>If you want to change some or all items of the array, you can use <code dir="ltr">map()</code> to create a <strong>new</strong> array. The function you will pass to <code dir="ltr">map</code> can decide what to do with each item, based on its data or its index (or both).</p> <p>In this example, an array holds coordinates of two circles and a square. When you press the button, it moves only the circles down by 50 pixels. It does this by producing a new array of data using <code dir="ltr">map()</code>:</p> 
<pre data-language="jsx"><span>import</span> <span>{</span> <span>useState</span> <span>}</span> <span>from</span> <span>'react'</span><span>;</span>

<span>let</span> <span>initialShapes</span> = <span>[</span>
  <span>{</span> <span>id</span><span>:</span> <span>0</span><span>,</span> <span>type</span><span>:</span> <span>'circle'</span><span>,</span> <span>x</span><span>:</span> <span>50</span><span>,</span> <span>y</span><span>:</span> <span>100</span> <span>}</span><span>,</span>
  <span>{</span> <span>id</span><span>:</span> <span>1</span><span>,</span> <span>type</span><span>:</span> <span>'square'</span><span>,</span> <span>x</span><span>:</span> <span>150</span><span>,</span> <span>y</span><span>:</span> <span>100</span> <span>}</span><span>,</span>
  <span>{</span> <span>id</span><span>:</span> <span>2</span><span>,</span> <span>type</span><span>:</span> <span>'circle'</span><span>,</span> <span>x</span><span>:</span> <span>250</span><span>,</span> <span>y</span><span>:</span> <span>100</span> <span>}</span><span>,</span>
<span>]</span><span>;</span>

<span>export</span> <span>default</span> <span>function</span> <span>ShapeEditor</span><span>(</span><span>)</span> <span>{</span>
  <span>const</span> <span>[</span><span>shapes</span><span>,</span> <span>setShapes</span><span>]</span> = <span>useState</span><span>(</span>
    <span>initialShapes</span>
  <span>)</span><span>;</span>

  <span>function</span> <span>handleClick</span><span>(</span><span>)</span> <span>{</span>
    <span>const</span> <span>nextShapes</span> = <span>shapes</span>.<span>map</span><span>(</span><span>shape</span> <span>=&gt;</span> <span>{</span>
      <span>if</span> <span>(</span><span>shape</span>.<span>type</span> === <span>'square'</span><span>)</span> <span>{</span>
        <span>// No change</span>
        <span>return</span> <span>shape</span><span>;</span>
      <span>}</span> <span>else</span> <span>{</span>
        <span>// Return a new circle 50px below</span>
        <span>return</span> <span>{</span>
          <span>...</span><span>shape</span><span>,</span>
          <span>y</span><span>:</span> <span>shape</span>.<span>y</span> + <span>50</span><span>,</span>
        <span>}</span><span>;</span>
      <span>}</span>
    <span>}</span><span>)</span><span>;</span>
    <span>// Re-render with the new array</span>
    <span>setShapes</span><span>(</span><span>nextShapes</span><span>)</span><span>;</span>
  <span>}</span>

  <span>return</span> <span>(</span>
    <span>&lt;</span><span>&gt;</span>
      <span>&lt;</span><span>button</span> <span>onClick</span>=<span>{</span><span>handleClick</span><span>}</span><span>&gt;</span>
        Move circles down!
      <span>&lt;/</span><span>button</span><span>&gt;</span>
      <span>{</span><span>shapes</span>.<span>map</span><span>(</span><span>shape</span> <span>=&gt;</span> <span>(</span>
        <span>&lt;</span><span>div</span>
          <span>key</span>=<span>{</span><span>shape</span>.<span>id</span><span>}</span>
          <span>style</span>=<span>{</span><span>{</span>
          <span>background</span><span>:</span> <span>'purple'</span><span>,</span>
          <span>position</span><span>:</span> <span>'absolute'</span><span>,</span>
          <span>left</span><span>:</span> <span>shape</span>.<span>x</span><span>,</span>
          <span>top</span><span>:</span> <span>shape</span>.<span>y</span><span>,</span>
          <span>borderRadius</span><span>:</span>
            <span>shape</span>.<span>type</span> === <span>'circle'</span>
              ? <span>'50%'</span> : <span>''</span><span>,</span>
          <span>width</span><span>:</span> <span>20</span><span>,</span>
          <span>height</span><span>:</span> <span>20</span><span>,</span>
        <span>}</span><span>}</span> <span>/&gt;</span>
      <span>)</span><span>)</span><span>}</span>
    <span>&lt;/</span><span>&gt;</span>
  <span>)</span><span>;</span>
<span>}</span>

</pre> <h3 id="replacing-items-in-an-array">Replacing items in an array 
</h3> <p>It is particularly common to want to replace one or more items in an array. Assignments like <code dir="ltr">arr[0] = 'bird'</code> are mutating the original array, so instead you’ll want to use <code dir="ltr">map</code> for this as well.</p> <p>To replace an item, create a new array with <code dir="ltr">map</code>. Inside your <code dir="ltr">map</code> call, you will receive the item index as the second argument. Use it to decide whether to return the original item (the first argument) or something else:</p> 
<pre data-language="jsx"><span>import</span> <span>{</span> <span>useState</span> <span>}</span> <span>from</span> <span>'react'</span><span>;</span>

<span>let</span> <span>initialCounters</span> = <span>[</span>
  <span>0</span><span>,</span> <span>0</span><span>,</span> <span>0</span>
<span>]</span><span>;</span>

<span>export</span> <span>default</span> <span>function</span> <span>CounterList</span><span>(</span><span>)</span> <span>{</span>
  <span>const</span> <span>[</span><span>counters</span><span>,</span> <span>setCounters</span><span>]</span> = <span>useState</span><span>(</span>
    <span>initialCounters</span>
  <span>)</span><span>;</span>

  <span>function</span> <span>handleIncrementClick</span><span>(</span><span>index</span><span>)</span> <span>{</span>
    <span>const</span> <span>nextCounters</span> = <span>counters</span>.<span>map</span><span>(</span><span>(</span><span>c</span><span>,</span> <span>i</span><span>)</span> <span>=&gt;</span> <span>{</span>
      <span>if</span> <span>(</span><span>i</span> === <span>index</span><span>)</span> <span>{</span>
        <span>// Increment the clicked counter</span>
        <span>return</span> <span>c</span> + <span>1</span><span>;</span>
      <span>}</span> <span>else</span> <span>{</span>
        <span>// The rest haven't changed</span>
        <span>return</span> <span>c</span><span>;</span>
      <span>}</span>
    <span>}</span><span>)</span><span>;</span>
    <span>setCounters</span><span>(</span><span>nextCounters</span><span>)</span><span>;</span>
  <span>}</span>

  <span>return</span> <span>(</span>
    <span>&lt;</span><span>ul</span><span>&gt;</span>
      <span>{</span><span>counters</span>.<span>map</span><span>(</span><span>(</span><span>counter</span><span>,</span> <span>i</span><span>)</span> <span>=&gt;</span> <span>(</span>
        <span>&lt;</span><span>li</span> <span>key</span>=<span>{</span><span>i</span><span>}</span><span>&gt;</span>
          <span>{</span><span>counter</span><span>}</span>
          <span>&lt;</span><span>button</span> <span>onClick</span>=<span>{</span><span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
            <span>handleIncrementClick</span><span>(</span><span>i</span><span>)</span><span>;</span>
          <span>}</span><span>}</span><span>&gt;</span>+1<span>&lt;/</span><span>button</span><span>&gt;</span>
        <span>&lt;/</span><span>li</span><span>&gt;</span>
      <span>)</span><span>)</span><span>}</span>
    <span>&lt;/</span><span>ul</span><span>&gt;</span>
  <span>)</span><span>;</span>
<span>}</span>

</pre> <h3 id="inserting-into-an-array">Inserting into an array 
</h3> <p>Sometimes, you may want to insert an item at a particular position that’s neither at the beginning nor at the end. To do this, you can use the <code dir="ltr">...</code> array spread syntax together with the <code dir="ltr">slice()</code> method. The <code dir="ltr">slice()</code> method lets you cut a “slice” of the array. To insert an item, you will create an array that spreads the slice <em>before</em> the insertion point, then the new item, and then the rest of the original array.</p> <p>In this example, the Insert button always inserts at the index <code dir="ltr">1</code>:</p> 
<pre data-language="jsx"><span>import</span> <span>{</span> <span>useState</span> <span>}</span> <span>from</span> <span>'react'</span><span>;</span>

<span>let</span> <span>nextId</span> = <span>3</span><span>;</span>
<span>const</span> <span>initialArtists</span> = <span>[</span>
  <span>{</span> <span>id</span><span>:</span> <span>0</span><span>,</span> <span>name</span><span>:</span> <span>'Marta Colvin Andrade'</span> <span>}</span><span>,</span>
  <span>{</span> <span>id</span><span>:</span> <span>1</span><span>,</span> <span>name</span><span>:</span> <span>'Lamidi Olonade Fakeye'</span><span>}</span><span>,</span>
  <span>{</span> <span>id</span><span>:</span> <span>2</span><span>,</span> <span>name</span><span>:</span> <span>'Louise Nevelson'</span><span>}</span><span>,</span>
<span>]</span><span>;</span>

<span>export</span> <span>default</span> <span>function</span> <span>List</span><span>(</span><span>)</span> <span>{</span>
  <span>const</span> <span>[</span><span>name</span><span>,</span> <span>setName</span><span>]</span> = <span>useState</span><span>(</span><span>''</span><span>)</span><span>;</span>
  <span>const</span> <span>[</span><span>artists</span><span>,</span> <span>setArtists</span><span>]</span> = <span>useState</span><span>(</span>
    <span>initialArtists</span>
  <span>)</span><span>;</span>

  <span>function</span> <span>handleClick</span><span>(</span><span>)</span> <span>{</span>
    <span>const</span> <span>insertAt</span> = <span>1</span><span>;</span> <span>// Could be any index</span>
    <span>const</span> <span>nextArtists</span> = <span>[</span>
      <span>// Items before the insertion point:</span>
      <span>...</span><span>artists</span>.<span>slice</span><span>(</span><span>0</span><span>,</span> <span>insertAt</span><span>)</span><span>,</span>
      <span>// New item:</span>
      <span>{</span> <span>id</span><span>:</span> <span>nextId</span>++<span>,</span> <span>name</span><span>:</span> <span>name</span> <span>}</span><span>,</span>
      <span>// Items after the insertion point:</span>
      <span>...</span><span>artists</span>.<span>slice</span><span>(</span><span>insertAt</span><span>)</span>
    <span>]</span><span>;</span>
    <span>setArtists</span><span>(</span><span>nextArtists</span><span>)</span><span>;</span>
    <span>setName</span><span>(</span><span>''</span><span>)</span><span>;</span>
  <span>}</span>

  <span>return</span> <span>(</span>
    <span>&lt;</span><span>&gt;</span>
      <span>&lt;</span><span>h1</span><span>&gt;</span>Inspiring sculptors:<span>&lt;/</span><span>h1</span><span>&gt;</span>
      <span>&lt;</span><span>input</span>
        <span>value</span>=<span>{</span><span>name</span><span>}</span>
        <span>onChange</span>=<span>{</span><span>e</span> <span>=&gt;</span> <span>setName</span><span>(</span><span>e</span>.<span>target</span>.<span>value</span><span>)</span><span>}</span>
      <span>/&gt;</span>
      <span>&lt;</span><span>button</span> <span>onClick</span>=<span>{</span><span>handleClick</span><span>}</span><span>&gt;</span>
        Insert
      <span>&lt;/</span><span>button</span><span>&gt;</span>
      <span>&lt;</span><span>ul</span><span>&gt;</span>
        <span>{</span><span>artists</span>.<span>map</span><span>(</span><span>artist</span> <span>=&gt;</span> <span>(</span>
          <span>&lt;</span><span>li</span> <span>key</span>=<span>{</span><span>artist</span>.<span>id</span><span>}</span><span>&gt;</span><span>{</span><span>artist</span>.<span>name</span><span>}</span><span>&lt;/</span><span>li</span><span>&gt;</span>
        <span>)</span><span>)</span><span>}</span>
      <span>&lt;/</span><span>ul</span><span>&gt;</span>
    <span>&lt;/</span><span>&gt;</span>
  <span>)</span><span>;</span>
<span>}</span>

</pre> <h3 id="making-other-changes-to-an-array">Making other changes to an array 
</h3> <p>There are some things you can’t do with the spread syntax and non-mutating methods like <code dir="ltr">map()</code> and <code dir="ltr">filter()</code> alone. For example, you may want to reverse or sort an array. The JavaScript <code dir="ltr">reverse()</code> and <code dir="ltr">sort()</code> methods are mutating the original array, so you can’t use them directly.</p> <p><strong>However, you can copy the array first, and then make changes to it.</strong></p> <p>For example:</p> 
<pre data-language="jsx"><span>import</span> <span>{</span> <span>useState</span> <span>}</span> <span>from</span> <span>'react'</span><span>;</span>

<span>const</span> <span>initialList</span> = <span>[</span>
  <span>{</span> <span>id</span><span>:</span> <span>0</span><span>,</span> <span>title</span><span>:</span> <span>'Big Bellies'</span> <span>}</span><span>,</span>
  <span>{</span> <span>id</span><span>:</span> <span>1</span><span>,</span> <span>title</span><span>:</span> <span>'Lunar Landscape'</span> <span>}</span><span>,</span>
  <span>{</span> <span>id</span><span>:</span> <span>2</span><span>,</span> <span>title</span><span>:</span> <span>'Terracotta Army'</span> <span>}</span><span>,</span>
<span>]</span><span>;</span>

<span>export</span> <span>default</span> <span>function</span> <span>List</span><span>(</span><span>)</span> <span>{</span>
  <span>const</span> <span>[</span><span>list</span><span>,</span> <span>setList</span><span>]</span> = <span>useState</span><span>(</span><span>initialList</span><span>)</span><span>;</span>

  <span>function</span> <span>handleClick</span><span>(</span><span>)</span> <span>{</span>
    <span>const</span> <span>nextList</span> = <span>[</span><span>...</span><span>list</span><span>]</span><span>;</span>
    <span>nextList</span>.<span>reverse</span><span>(</span><span>)</span><span>;</span>
    <span>setList</span><span>(</span><span>nextList</span><span>)</span><span>;</span>
  <span>}</span>

  <span>return</span> <span>(</span>
    <span>&lt;</span><span>&gt;</span>
      <span>&lt;</span><span>button</span> <span>onClick</span>=<span>{</span><span>handleClick</span><span>}</span><span>&gt;</span>
        Reverse
      <span>&lt;/</span><span>button</span><span>&gt;</span>
      <span>&lt;</span><span>ul</span><span>&gt;</span>
        <span>{</span><span>list</span>.<span>map</span><span>(</span><span>artwork</span> <span>=&gt;</span> <span>(</span>
          <span>&lt;</span><span>li</span> <span>key</span>=<span>{</span><span>artwork</span>.<span>id</span><span>}</span><span>&gt;</span><span>{</span><span>artwork</span>.<span>title</span><span>}</span><span>&lt;/</span><span>li</span><span>&gt;</span>
        <span>)</span><span>)</span><span>}</span>
      <span>&lt;/</span><span>ul</span><span>&gt;</span>
    <span>&lt;/</span><span>&gt;</span>
  <span>)</span><span>;</span>
<span>}</span>

</pre> <p>Here, you use the <code dir="ltr">[...list]</code> spread syntax to create a copy of the original array first. Now that you have a copy, you can use mutating methods like <code dir="ltr">nextList.reverse()</code> or <code dir="ltr">nextList.sort()</code>, or even assign individual items with <code dir="ltr">nextList[0] = "something"</code>.</p> <p>However, <strong>even if you copy an array, you can’t mutate existing items <em>inside</em> of it directly.</strong> This is because copying is shallow—the new array will contain the same items as the original one. So if you modify an object inside the copied array, you are mutating the existing state. For example, code like this is a problem.</p> <pre data-language="jsx"><code><span>const</span> <span>nextList</span> = <span>[</span><span>...</span><span>list</span><span>]</span><span>;</span>
<span>nextList</span><span>[</span><span>0</span><span>]</span>.<span>seen</span> = <span>true</span><span>;</span> <span>// Problem: mutates list[0]</span>
<span>setList</span><span>(</span><span>nextList</span><span>)</span><span>;</span></code></pre> <p>Although <code dir="ltr">nextList</code> and <code dir="ltr">list</code> are two different arrays, <strong><code dir="ltr">nextList[0]</code> and <code dir="ltr">list[0]</code> point to the same object.</strong> So by changing <code dir="ltr">nextList[0].seen</code>, you are also changing <code dir="ltr">list[0].seen</code>. This is a state mutation, which you should avoid! You can solve this issue in a similar way to <a href="updating-objects-in-state.html#updating-a-nested-object">updating nested JavaScript objects</a>—by copying individual items you want to change instead of mutating them. Here’s how.</p> <h2 id="updating-objects-inside-arrays">Updating objects inside arrays 
</h2> <p>Objects are not <em>really</em> located “inside” arrays. They might appear to be “inside” in code, but each object in an array is a separate value, to which the array “points”. This is why you need to be careful when changing nested fields like <code dir="ltr">list[0]</code>. Another person’s artwork list may point to the same element of the array!</p> <p><strong>When updating nested state, you need to create copies from the point where you want to update, and all the way up to the top level.</strong> Let’s see how this works.</p> <p>In this example, two separate artwork lists have the same initial state. They are supposed to be isolated, but because of a mutation, their state is accidentally shared, and checking a box in one list affects the other list:</p> 
<pre data-language="jsx"><span>import</span> <span>{</span> <span>useState</span> <span>}</span> <span>from</span> <span>'react'</span><span>;</span>

<span>let</span> <span>nextId</span> = <span>3</span><span>;</span>
<span>const</span> <span>initialList</span> = <span>[</span>
  <span>{</span> <span>id</span><span>:</span> <span>0</span><span>,</span> <span>title</span><span>:</span> <span>'Big Bellies'</span><span>,</span> <span>seen</span><span>:</span> <span>false</span> <span>}</span><span>,</span>
  <span>{</span> <span>id</span><span>:</span> <span>1</span><span>,</span> <span>title</span><span>:</span> <span>'Lunar Landscape'</span><span>,</span> <span>seen</span><span>:</span> <span>false</span> <span>}</span><span>,</span>
  <span>{</span> <span>id</span><span>:</span> <span>2</span><span>,</span> <span>title</span><span>:</span> <span>'Terracotta Army'</span><span>,</span> <span>seen</span><span>:</span> <span>true</span> <span>}</span><span>,</span>
<span>]</span><span>;</span>

<span>export</span> <span>default</span> <span>function</span> <span>BucketList</span><span>(</span><span>)</span> <span>{</span>
  <span>const</span> <span>[</span><span>myList</span><span>,</span> <span>setMyList</span><span>]</span> = <span>useState</span><span>(</span><span>initialList</span><span>)</span><span>;</span>
  <span>const</span> <span>[</span><span>yourList</span><span>,</span> <span>setYourList</span><span>]</span> = <span>useState</span><span>(</span>
    <span>initialList</span>
  <span>)</span><span>;</span>

  <span>function</span> <span>handleToggleMyList</span><span>(</span><span>artworkId</span><span>,</span> <span>nextSeen</span><span>)</span> <span>{</span>
    <span>const</span> <span>myNextList</span> = <span>[</span><span>...</span><span>myList</span><span>]</span><span>;</span>
    <span>const</span> <span>artwork</span> = <span>myNextList</span>.<span>find</span><span>(</span>
      <span>a</span> <span>=&gt;</span> <span>a</span>.<span>id</span> === <span>artworkId</span>
    <span>)</span><span>;</span>
    <span>artwork</span>.<span>seen</span> = <span>nextSeen</span><span>;</span>
    <span>setMyList</span><span>(</span><span>myNextList</span><span>)</span><span>;</span>
  <span>}</span>

  <span>function</span> <span>handleToggleYourList</span><span>(</span><span>artworkId</span><span>,</span> <span>nextSeen</span><span>)</span> <span>{</span>
    <span>const</span> <span>yourNextList</span> = <span>[</span><span>...</span><span>yourList</span><span>]</span><span>;</span>
    <span>const</span> <span>artwork</span> = <span>yourNextList</span>.<span>find</span><span>(</span>
      <span>a</span> <span>=&gt;</span> <span>a</span>.<span>id</span> === <span>artworkId</span>
    <span>)</span><span>;</span>
    <span>artwork</span>.<span>seen</span> = <span>nextSeen</span><span>;</span>
    <span>setYourList</span><span>(</span><span>yourNextList</span><span>)</span><span>;</span>
  <span>}</span>

  <span>return</span> <span>(</span>
    <span>&lt;</span><span>&gt;</span>
      <span>&lt;</span><span>h1</span><span>&gt;</span>Art Bucket List<span>&lt;/</span><span>h1</span><span>&gt;</span>
      <span>&lt;</span><span>h2</span><span>&gt;</span>My list of art to see:<span>&lt;/</span><span>h2</span><span>&gt;</span>
      <span>&lt;</span><span>ItemList</span>
        <span>artworks</span>=<span>{</span><span>myList</span><span>}</span>
        <span>onToggle</span>=<span>{</span><span>handleToggleMyList</span><span>}</span> <span>/&gt;</span>
      <span>&lt;</span><span>h2</span><span>&gt;</span>Your list of art to see:<span>&lt;/</span><span>h2</span><span>&gt;</span>
      <span>&lt;</span><span>ItemList</span>
        <span>artworks</span>=<span>{</span><span>yourList</span><span>}</span>
        <span>onToggle</span>=<span>{</span><span>handleToggleYourList</span><span>}</span> <span>/&gt;</span>
    <span>&lt;/</span><span>&gt;</span>
  <span>)</span><span>;</span>
<span>}</span>

<span>function</span> <span>ItemList</span><span>(</span><span>{</span> <span>artworks</span><span>,</span> <span>onToggle</span> <span>}</span><span>)</span> <span>{</span>
  <span>return</span> <span>(</span>
    <span>&lt;</span><span>ul</span><span>&gt;</span>
      <span>{</span><span>artworks</span>.<span>map</span><span>(</span><span>artwork</span> <span>=&gt;</span> <span>(</span>
        <span>&lt;</span><span>li</span> <span>key</span>=<span>{</span><span>artwork</span>.<span>id</span><span>}</span><span>&gt;</span>
          <span>&lt;</span><span>label</span><span>&gt;</span>
            <span>&lt;</span><span>input</span>
              <span>type</span>=<span>"checkbox"</span>
              <span>checked</span>=<span>{</span><span>artwork</span>.<span>seen</span><span>}</span>
              <span>onChange</span>=<span>{</span><span>e</span> <span>=&gt;</span> <span>{</span>
                <span>onToggle</span><span>(</span>
                  <span>artwork</span>.<span>id</span><span>,</span>
                  <span>e</span>.<span>target</span>.<span>checked</span>
                <span>)</span><span>;</span>
              <span>}</span><span>}</span>
            <span>/&gt;</span>
            <span>{</span><span>artwork</span>.<span>title</span><span>}</span>
          <span>&lt;/</span><span>label</span><span>&gt;</span>
        <span>&lt;/</span><span>li</span><span>&gt;</span>
      <span>)</span><span>)</span><span>}</span>
    <span>&lt;/</span><span>ul</span><span>&gt;</span>
  <span>)</span><span>;</span>
<span>}</span>

</pre> <p>The problem is in code like this:</p> <pre data-language="jsx"><code><span>const</span> <span>myNextList</span> = <span>[</span><span>...</span><span>myList</span><span>]</span><span>;</span>
<span>const</span> <span>artwork</span> = <span>myNextList</span>.<span>find</span><span>(</span><span>a</span> <span>=&gt;</span> <span>a</span>.<span>id</span> === <span>artworkId</span><span>)</span><span>;</span>
<span>artwork</span>.<span>seen</span> = <span>nextSeen</span><span>;</span> <span>// Problem: mutates an existing item</span>
<span>setMyList</span><span>(</span><span>myNextList</span><span>)</span><span>;</span></code></pre> <p>Although the <code dir="ltr">myNextList</code> array itself is new, the <em>items themselves</em> are the same as in the original <code dir="ltr">myList</code> array. So changing <code dir="ltr">artwork.seen</code> changes the <em>original</em> artwork item. That artwork item is also in <code dir="ltr">yourList</code>, which causes the bug. Bugs like this can be difficult to think about, but thankfully they disappear if you avoid mutating state.</p> <p><strong>You can use <code dir="ltr">map</code> to substitute an old item with its updated version without mutation.</strong></p> <pre data-language="jsx"><code><span>setMyList</span><span>(</span><span>myList</span>.<span>map</span><span>(</span><span>artwork</span> <span>=&gt;</span> <span>{</span>
  <span>if</span> <span>(</span><span>artwork</span>.<span>id</span> === <span>artworkId</span><span>)</span> <span>{</span>
    <span>// Create a *new* object with changes</span>
    <span>return</span> <span>{</span> <span>...</span><span>artwork</span><span>,</span> <span>seen</span><span>:</span> <span>nextSeen</span> <span>}</span><span>;</span>
  <span>}</span> <span>else</span> <span>{</span>
    <span>// No changes</span>
    <span>return</span> <span>artwork</span><span>;</span>
  <span>}</span>
<span>}</span><span>)</span><span>)</span><span>;</span></code></pre> <p>Here, <code dir="ltr">...</code> is the object spread syntax used to <a href="updating-objects-in-state.html#copying-objects-with-the-spread-syntax">create a copy of an object.</a></p> <p>With this approach, none of the existing state items are being mutated, and the bug is fixed:</p> 
<pre data-language="jsx"><span>import</span> <span>{</span> <span>useState</span> <span>}</span> <span>from</span> <span>'react'</span><span>;</span>

<span>let</span> <span>nextId</span> = <span>3</span><span>;</span>
<span>const</span> <span>initialList</span> = <span>[</span>
  <span>{</span> <span>id</span><span>:</span> <span>0</span><span>,</span> <span>title</span><span>:</span> <span>'Big Bellies'</span><span>,</span> <span>seen</span><span>:</span> <span>false</span> <span>}</span><span>,</span>
  <span>{</span> <span>id</span><span>:</span> <span>1</span><span>,</span> <span>title</span><span>:</span> <span>'Lunar Landscape'</span><span>,</span> <span>seen</span><span>:</span> <span>false</span> <span>}</span><span>,</span>
  <span>{</span> <span>id</span><span>:</span> <span>2</span><span>,</span> <span>title</span><span>:</span> <span>'Terracotta Army'</span><span>,</span> <span>seen</span><span>:</span> <span>true</span> <span>}</span><span>,</span>
<span>]</span><span>;</span>

<span>export</span> <span>default</span> <span>function</span> <span>BucketList</span><span>(</span><span>)</span> <span>{</span>
  <span>const</span> <span>[</span><span>myList</span><span>,</span> <span>setMyList</span><span>]</span> = <span>useState</span><span>(</span><span>initialList</span><span>)</span><span>;</span>
  <span>const</span> <span>[</span><span>yourList</span><span>,</span> <span>setYourList</span><span>]</span> = <span>useState</span><span>(</span>
    <span>initialList</span>
  <span>)</span><span>;</span>

  <span>function</span> <span>handleToggleMyList</span><span>(</span><span>artworkId</span><span>,</span> <span>nextSeen</span><span>)</span> <span>{</span>
    <span>setMyList</span><span>(</span><span>myList</span>.<span>map</span><span>(</span><span>artwork</span> <span>=&gt;</span> <span>{</span>
      <span>if</span> <span>(</span><span>artwork</span>.<span>id</span> === <span>artworkId</span><span>)</span> <span>{</span>
        <span>// Create a *new* object with changes</span>
        <span>return</span> <span>{</span> <span>...</span><span>artwork</span><span>,</span> <span>seen</span><span>:</span> <span>nextSeen</span> <span>}</span><span>;</span>
      <span>}</span> <span>else</span> <span>{</span>
        <span>// No changes</span>
        <span>return</span> <span>artwork</span><span>;</span>
      <span>}</span>
    <span>}</span><span>)</span><span>)</span><span>;</span>
  <span>}</span>

  <span>function</span> <span>handleToggleYourList</span><span>(</span><span>artworkId</span><span>,</span> <span>nextSeen</span><span>)</span> <span>{</span>
    <span>setYourList</span><span>(</span><span>yourList</span>.<span>map</span><span>(</span><span>artwork</span> <span>=&gt;</span> <span>{</span>
      <span>if</span> <span>(</span><span>artwork</span>.<span>id</span> === <span>artworkId</span><span>)</span> <span>{</span>
        <span>// Create a *new* object with changes</span>
        <span>return</span> <span>{</span> <span>...</span><span>artwork</span><span>,</span> <span>seen</span><span>:</span> <span>nextSeen</span> <span>}</span><span>;</span>
      <span>}</span> <span>else</span> <span>{</span>
        <span>// No changes</span>
        <span>return</span> <span>artwork</span><span>;</span>
      <span>}</span>
    <span>}</span><span>)</span><span>)</span><span>;</span>
  <span>}</span>

  <span>return</span> <span>(</span>
    <span>&lt;</span><span>&gt;</span>
      <span>&lt;</span><span>h1</span><span>&gt;</span>Art Bucket List<span>&lt;/</span><span>h1</span><span>&gt;</span>
      <span>&lt;</span><span>h2</span><span>&gt;</span>My list of art to see:<span>&lt;/</span><span>h2</span><span>&gt;</span>
      <span>&lt;</span><span>ItemList</span>
        <span>artworks</span>=<span>{</span><span>myList</span><span>}</span>
        <span>onToggle</span>=<span>{</span><span>handleToggleMyList</span><span>}</span> <span>/&gt;</span>
      <span>&lt;</span><span>h2</span><span>&gt;</span>Your list of art to see:<span>&lt;/</span><span>h2</span><span>&gt;</span>
      <span>&lt;</span><span>ItemList</span>
        <span>artworks</span>=<span>{</span><span>yourList</span><span>}</span>
        <span>onToggle</span>=<span>{</span><span>handleToggleYourList</span><span>}</span> <span>/&gt;</span>
    <span>&lt;/</span><span>&gt;</span>
  <span>)</span><span>;</span>
<span>}</span>

<span>function</span> <span>ItemList</span><span>(</span><span>{</span> <span>artworks</span><span>,</span> <span>onToggle</span> <span>}</span><span>)</span> <span>{</span>
  <span>return</span> <span>(</span>
    <span>&lt;</span><span>ul</span><span>&gt;</span>
      <span>{</span><span>artworks</span>.<span>map</span><span>(</span><span>artwork</span> <span>=&gt;</span> <span>(</span>
        <span>&lt;</span><span>li</span> <span>key</span>=<span>{</span><span>artwork</span>.<span>id</span><span>}</span><span>&gt;</span>
          <span>&lt;</span><span>label</span><span>&gt;</span>
            <span>&lt;</span><span>input</span>
              <span>type</span>=<span>"checkbox"</span>
              <span>checked</span>=<span>{</span><span>artwork</span>.<span>seen</span><span>}</span>
              <span>onChange</span>=<span>{</span><span>e</span> <span>=&gt;</span> <span>{</span>
                <span>onToggle</span><span>(</span>
                  <span>artwork</span>.<span>id</span><span>,</span>
                  <span>e</span>.<span>target</span>.<span>checked</span>
                <span>)</span><span>;</span>
              <span>}</span><span>}</span>
            <span>/&gt;</span>
            <span>{</span><span>artwork</span>.<span>title</span><span>}</span>
          <span>&lt;/</span><span>label</span><span>&gt;</span>
        <span>&lt;/</span><span>li</span><span>&gt;</span>
      <span>)</span><span>)</span><span>}</span>
    <span>&lt;/</span><span>ul</span><span>&gt;</span>
  <span>)</span><span>;</span>
<span>}</span>

</pre> <p>In general, <strong>you should only mutate objects that you have just created.</strong> If you were inserting a <em>new</em> artwork, you could mutate it, but if you’re dealing with something that’s already in state, you need to make a copy.</p> <h3 id="write-concise-update-logic-with-immer">Write concise update logic with Immer 
</h3> <p>Updating nested arrays without mutation can get a little bit repetitive. <a href="updating-objects-in-state.html#write-concise-update-logic-with-immer">Just as with objects</a>:</p> <ul> <li>Generally, you shouldn’t need to update state more than a couple of levels deep. If your state objects are very deep, you might want to <a href="choosing-the-state-structure.html#avoid-deeply-nested-state">restructure them differently</a> so that they are flat.</li> <li>If you don’t want to change your state structure, you might prefer to use <a href="https://github.com/immerjs/use-immer" target="_blank" rel="nofollow noopener noreferrer">Immer</a>, which lets you write using the convenient but mutating syntax and takes care of producing the copies for you.</li> </ul> <p>Here is the Art Bucket List example rewritten with Immer:</p> 
<pre data-language="jsx"><span>{</span>
  <span>"dependencies"</span><span>:</span> <span>{</span>
    <span>"immer"</span><span>:</span> <span>"1.7.3"</span><span>,</span>
    <span>"react"</span><span>:</span> <span>"latest"</span><span>,</span>
    <span>"react-dom"</span><span>:</span> <span>"latest"</span><span>,</span>
    <span>"react-scripts"</span><span>:</span> <span>"latest"</span><span>,</span>
    <span>"use-immer"</span><span>:</span> <span>"0.5.1"</span>
  <span>}</span><span>,</span>
  <span>"scripts"</span><span>:</span> <span>{</span>
    <span>"start"</span><span>:</span> <span>"react-scripts start"</span><span>,</span>
    <span>"build"</span><span>:</span> <span>"react-scripts build"</span><span>,</span>
    <span>"test"</span><span>:</span> <span>"react-scripts test --env=jsdom"</span><span>,</span>
    <span>"eject"</span><span>:</span> <span>"react-scripts eject"</span>
  <span>}</span><span>,</span>
  <span>"devDependencies"</span><span>:</span> <span>{</span><span>}</span>
<span>}</span></pre> <p>Note how with Immer, <strong>mutation like <code dir="ltr">artwork.seen = nextSeen</code> is now okay:</strong></p> <pre data-language="jsx"><code><span>updateMyTodos</span><span>(</span><span>draft</span> <span>=&gt;</span> <span>{</span>
  <span>const</span> <span>artwork</span> = <span>draft</span>.<span>find</span><span>(</span><span>a</span> <span>=&gt;</span> <span>a</span>.<span>id</span> === <span>artworkId</span><span>)</span><span>;</span>
  <span>artwork</span>.<span>seen</span> = <span>nextSeen</span><span>;</span>
<span>}</span><span>)</span><span>;</span></code></pre> <p>This is because you’re not mutating the <em>original</em> state, but you’re mutating a special <code dir="ltr">draft</code> object provided by Immer. Similarly, you can apply mutating methods like <code dir="ltr">push()</code> and <code dir="ltr">pop()</code> to the content of the <code dir="ltr">draft</code>.</p> <p>Behind the scenes, Immer always constructs the next state from scratch according to the changes that you’ve done to the <code dir="ltr">draft</code>. This keeps your event handlers very concise without ever mutating state.</p> <section><h2 id="recap">Recap
</h2>
<ul> <li>You can put arrays into state, but you can’t change them.</li> <li>Instead of mutating an array, create a <em>new</em> version of it, and update the state to it.</li> <li>You can use the <code dir="ltr">[...arr, newItem]</code> array spread syntax to create arrays with new items.</li> <li>You can use <code dir="ltr">filter()</code> and <code dir="ltr">map()</code> to create new arrays with filtered or transformed items.</li> <li>You can use Immer to keep your code concise.</li> </ul></section> <div class="note">
<h4>Try out some challenges</h4>

<div>
<h4 id="update-an-item-in-the-shopping-cart">
<div>Challenge 1 of 4<span>: </span>
</div>Update an item in the shopping cart 
</h4>
<p>Fill in the <code dir="ltr">handleIncreaseClick</code> logic so that pressing ”+” increases the corresponding number:</p>

<pre data-language="jsx"><span>import</span> <span>{</span> <span>useState</span> <span>}</span> <span>from</span> <span>'react'</span><span>;</span>

<span>const</span> <span>initialProducts</span> = <span>[</span><span>{</span>
  <span>id</span><span>:</span> <span>0</span><span>,</span>
  <span>name</span><span>:</span> <span>'Baklava'</span><span>,</span>
  <span>count</span><span>:</span> <span>1</span><span>,</span>
<span>}</span><span>,</span> <span>{</span>
  <span>id</span><span>:</span> <span>1</span><span>,</span>
  <span>name</span><span>:</span> <span>'Cheese'</span><span>,</span>
  <span>count</span><span>:</span> <span>5</span><span>,</span>
<span>}</span><span>,</span> <span>{</span>
  <span>id</span><span>:</span> <span>2</span><span>,</span>
  <span>name</span><span>:</span> <span>'Spaghetti'</span><span>,</span>
  <span>count</span><span>:</span> <span>2</span><span>,</span>
<span>}</span><span>]</span><span>;</span>

<span>export</span> <span>default</span> <span>function</span> <span>ShoppingCart</span><span>(</span><span>)</span> <span>{</span>
  <span>const</span> <span>[</span>
    <span>products</span><span>,</span>
    <span>setProducts</span>
  <span>]</span> = <span>useState</span><span>(</span><span>initialProducts</span><span>)</span>

  <span>function</span> <span>handleIncreaseClick</span><span>(</span><span>productId</span><span>)</span> <span>{</span>

  <span>}</span>

  <span>return</span> <span>(</span>
    <span>&lt;</span><span>ul</span><span>&gt;</span>
      <span>{</span><span>products</span>.<span>map</span><span>(</span><span>product</span> <span>=&gt;</span> <span>(</span>
        <span>&lt;</span><span>li</span> <span>key</span>=<span>{</span><span>product</span>.<span>id</span><span>}</span><span>&gt;</span>
          <span>{</span><span>product</span>.<span>name</span><span>}</span>
          <span>{</span><span>' '</span><span>}</span>
          (<span>&lt;</span><span>b</span><span>&gt;</span><span>{</span><span>product</span>.<span>count</span><span>}</span><span>&lt;/</span><span>b</span><span>&gt;</span>)
          <span>&lt;</span><span>button</span> <span>onClick</span>=<span>{</span><span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
            <span>handleIncreaseClick</span><span>(</span><span>product</span>.<span>id</span><span>)</span><span>;</span>
          <span>}</span><span>}</span><span>&gt;</span>
            +
          <span>&lt;/</span><span>button</span><span>&gt;</span>
        <span>&lt;/</span><span>li</span><span>&gt;</span>
      <span>)</span><span>)</span><span>}</span>
    <span>&lt;/</span><span>ul</span><span>&gt;</span>
  <span>)</span><span>;</span>
<span>}</span>

</pre>
</div>

</div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2013&ndash;present Facebook Inc.<br>Licensed under the Creative Commons Attribution 4.0 International Public License.<br>
    <a href="https://react.dev/learn/updating-arrays-in-state" class="_attribution-link">https://react.dev/learn/updating-arrays-in-state</a>
  </p>
</div>
