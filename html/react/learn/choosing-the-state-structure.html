<h1>Choosing the State Structure
</h1>
<div><p>Structuring state well can make a difference between a component that is pleasant to modify and debug, and one that is a constant source of bugs. Here are some tips you should consider when structuring state.</p></div> <div class="note">
<h4>You will learn</h4>
<ul> <li>When to use a single vs multiple state variables</li> <li>What to avoid when organizing state</li> <li>How to fix common issues with the state structure</li> </ul>
</div> <h2 id="principles-for-structuring-state">Principles for structuring state 
</h2> <p>When you write a component that holds some state, you’ll have to make choices about how many state variables to use and what the shape of their data should be. While it’s possible to write correct programs even with a suboptimal state structure, there are a few principles that can guide you to make better choices:</p> <ol> <li>
<strong>Group related state.</strong> If you always update two or more state variables at the same time, consider merging them into a single state variable.</li> <li>
<strong>Avoid contradictions in state.</strong> When the state is structured in a way that several pieces of state may contradict and “disagree” with each other, you leave room for mistakes. Try to avoid this.</li> <li>
<strong>Avoid redundant state.</strong> If you can calculate some information from the component’s props or its existing state variables during rendering, you should not put that information into that component’s state.</li> <li>
<strong>Avoid duplication in state.</strong> When the same data is duplicated between multiple state variables, or within nested objects, it is difficult to keep them in sync. Reduce duplication when you can.</li> <li>
<strong>Avoid deeply nested state.</strong> Deeply hierarchical state is not very convenient to update. When possible, prefer to structure state in a flat way.</li> </ol> <p>The goal behind these principles is to <em>make state easy to update without introducing mistakes</em>. Removing redundant and duplicate data from state helps ensure that all its pieces stay in sync. This is similar to how a database engineer might want to <a href="https://docs.microsoft.com/en-us/office/troubleshoot/access/database-normalization-description" target="_blank" rel="nofollow noopener noreferrer">“normalize” the database structure</a> to reduce the chance of bugs. To paraphrase Albert Einstein, <strong>“Make your state as simple as it can be—but no simpler.”</strong></p> <p>Now let’s see how these principles apply in action.</p> <h2 id="group-related-state">Group related state 
</h2> <p>You might sometimes be unsure between using a single or multiple state variables.</p> <p>Should you do this?</p> <pre data-language="jsx"><code><span>const</span> <span>[</span><span>x</span><span>,</span> <span>setX</span><span>]</span> = <span>useState</span><span>(</span><span>0</span><span>)</span><span>;</span>
<span>const</span> <span>[</span><span>y</span><span>,</span> <span>setY</span><span>]</span> = <span>useState</span><span>(</span><span>0</span><span>)</span><span>;</span></code></pre> <p>Or this?</p> <pre data-language="jsx"><code><span>const</span> <span>[</span><span>position</span><span>,</span> <span>setPosition</span><span>]</span> = <span>useState</span><span>(</span><span>{</span> <span>x</span><span>:</span> <span>0</span><span>,</span> <span>y</span><span>:</span> <span>0</span> <span>}</span><span>)</span><span>;</span></code></pre> <p>Technically, you can use either of these approaches. But <strong>if some two state variables always change together, it might be a good idea to unify them into a single state variable.</strong> Then you won’t forget to always keep them in sync, like in this example where moving the cursor updates both coordinates of the red dot:</p> 
<pre data-language="jsx"><span>import</span> <span>{</span> <span>useState</span> <span>}</span> <span>from</span> <span>'react'</span><span>;</span>

<span>export</span> <span>default</span> <span>function</span> <span>MovingDot</span><span>(</span><span>)</span> <span>{</span>
  <span>const</span> <span>[</span><span>position</span><span>,</span> <span>setPosition</span><span>]</span> = <span>useState</span><span>(</span><span>{</span>
    <span>x</span><span>:</span> <span>0</span><span>,</span>
    <span>y</span><span>:</span> <span>0</span>
  <span>}</span><span>)</span><span>;</span>
  <span>return</span> <span>(</span>
    <span>&lt;</span><span>div</span>
      <span>onPointerMove</span>=<span>{</span><span>e</span> <span>=&gt;</span> <span>{</span>
        <span>setPosition</span><span>(</span><span>{</span>
          <span>x</span><span>:</span> <span>e</span>.<span>clientX</span><span>,</span>
          <span>y</span><span>:</span> <span>e</span>.<span>clientY</span>
        <span>}</span><span>)</span><span>;</span>
      <span>}</span><span>}</span>
      <span>style</span>=<span>{</span><span>{</span>
        <span>position</span><span>:</span> <span>'relative'</span><span>,</span>
        <span>width</span><span>:</span> <span>'100vw'</span><span>,</span>
        <span>height</span><span>:</span> <span>'100vh'</span><span>,</span>
      <span>}</span><span>}</span><span>&gt;</span>
      <span>&lt;</span><span>div</span> <span>style</span>=<span>{</span><span>{</span>
        <span>position</span><span>:</span> <span>'absolute'</span><span>,</span>
        <span>backgroundColor</span><span>:</span> <span>'red'</span><span>,</span>
        <span>borderRadius</span><span>:</span> <span>'50%'</span><span>,</span>
        <span>transform</span><span>:</span> <span>`translate(</span><span>${</span><span>position</span>.<span>x</span><span>}</span><span>px, </span><span>${</span><span>position</span>.<span>y</span><span>}</span><span>px)`</span><span>,</span>
        <span>left</span><span>:</span> -<span>10</span><span>,</span>
        <span>top</span><span>:</span> -<span>10</span><span>,</span>
        <span>width</span><span>:</span> <span>20</span><span>,</span>
        <span>height</span><span>:</span> <span>20</span><span>,</span>
      <span>}</span><span>}</span> <span>/&gt;</span>
    <span>&lt;/</span><span>div</span><span>&gt;</span>
  <span>)</span>
<span>}</span>

</pre> <p>Another case where you’ll group data into an object or an array is when you don’t know how many pieces of state you’ll need. For example, it’s helpful when you have a form where the user can add custom fields.</p> <div class="note note-orange">
<h4>Pitfall</h4>
<div><p>If your state variable is an object, remember that <a href="updating-objects-in-state.html">you can’t update only one field in it</a> without explicitly copying the other fields. For example, you can’t do <code dir="ltr">setPosition({ x: 100 })</code> in the above example because it would not have the <code dir="ltr">y</code> property at all! Instead, if you wanted to set <code dir="ltr">x</code> alone, you would either do <code dir="ltr">setPosition({ ...position, x: 100 })</code>, or split them into two state variables and do <code dir="ltr">setX(100)</code>.</p></div>
</div> <h2 id="avoid-contradictions-in-state">Avoid contradictions in state 
</h2> <p>Here is a hotel feedback form with <code dir="ltr">isSending</code> and <code dir="ltr">isSent</code> state variables:</p> 
<pre data-language="jsx"><span>import</span> <span>{</span> <span>useState</span> <span>}</span> <span>from</span> <span>'react'</span><span>;</span>

<span>export</span> <span>default</span> <span>function</span> <span>FeedbackForm</span><span>(</span><span>)</span> <span>{</span>
  <span>const</span> <span>[</span><span>text</span><span>,</span> <span>setText</span><span>]</span> = <span>useState</span><span>(</span><span>''</span><span>)</span><span>;</span>
  <span>const</span> <span>[</span><span>isSending</span><span>,</span> <span>setIsSending</span><span>]</span> = <span>useState</span><span>(</span><span>false</span><span>)</span><span>;</span>
  <span>const</span> <span>[</span><span>isSent</span><span>,</span> <span>setIsSent</span><span>]</span> = <span>useState</span><span>(</span><span>false</span><span>)</span><span>;</span>

  <span>async</span> <span>function</span> <span>handleSubmit</span><span>(</span><span>e</span><span>)</span> <span>{</span>
    <span>e</span>.<span>preventDefault</span><span>(</span><span>)</span><span>;</span>
    <span>setIsSending</span><span>(</span><span>true</span><span>)</span><span>;</span>
    <span>await</span> <span>sendMessage</span><span>(</span><span>text</span><span>)</span><span>;</span>
    <span>setIsSending</span><span>(</span><span>false</span><span>)</span><span>;</span>
    <span>setIsSent</span><span>(</span><span>true</span><span>)</span><span>;</span>
  <span>}</span>

  <span>if</span> <span>(</span><span>isSent</span><span>)</span> <span>{</span>
    <span>return</span> <span>&lt;</span><span>h1</span><span>&gt;</span>Thanks for feedback!<span>&lt;/</span><span>h1</span><span>&gt;</span>
  <span>}</span>

  <span>return</span> <span>(</span>
    <span>&lt;</span><span>form</span> <span>onSubmit</span>=<span>{</span><span>handleSubmit</span><span>}</span><span>&gt;</span>
      <span>&lt;</span><span>p</span><span>&gt;</span>How was your stay at The Prancing Pony?<span>&lt;/</span><span>p</span><span>&gt;</span>
      <span>&lt;</span><span>textarea</span>
        <span>disabled</span>=<span>{</span><span>isSending</span><span>}</span>
        <span>value</span>=<span>{</span><span>text</span><span>}</span>
        <span>onChange</span>=<span>{</span><span>e</span> <span>=&gt;</span> <span>setText</span><span>(</span><span>e</span>.<span>target</span>.<span>value</span><span>)</span><span>}</span>
      <span>/&gt;</span>
      <span>&lt;</span><span>br</span> <span>/&gt;</span>
      <span>&lt;</span><span>button</span>
        <span>disabled</span>=<span>{</span><span>isSending</span><span>}</span>
        <span>type</span>=<span>"submit"</span>
      <span>&gt;</span>
        Send
      <span>&lt;/</span><span>button</span><span>&gt;</span>
      <span>{</span><span>isSending</span> &amp;&amp; <span>&lt;</span><span>p</span><span>&gt;</span>Sending...<span>&lt;/</span><span>p</span><span>&gt;</span><span>}</span>
    <span>&lt;/</span><span>form</span><span>&gt;</span>
  <span>)</span><span>;</span>
<span>}</span>

<span>// Pretend to send a message.</span>
<span>function</span> <span>sendMessage</span><span>(</span><span>text</span><span>)</span> <span>{</span>
  <span>return</span> <span>new</span> <span>Promise</span><span>(</span><span>resolve</span> <span>=&gt;</span> <span>{</span>
    <span>setTimeout</span><span>(</span><span>resolve</span><span>,</span> <span>2000</span><span>)</span><span>;</span>
  <span>}</span><span>)</span><span>;</span>
<span>}</span>

</pre> <p>While this code works, it leaves the door open for “impossible” states. For example, if you forget to call <code dir="ltr">setIsSent</code> and <code dir="ltr">setIsSending</code> together, you may end up in a situation where both <code dir="ltr">isSending</code> and <code dir="ltr">isSent</code> are <code dir="ltr">true</code> at the same time. The more complex your component is, the harder it is to understand what happened.</p> <p><strong>Since <code dir="ltr">isSending</code> and <code dir="ltr">isSent</code> should never be <code dir="ltr">true</code> at the same time, it is better to replace them with one <code dir="ltr">status</code> state variable that may take one of <em>three</em> valid states:</strong> <code dir="ltr">'typing'</code> (initial), <code dir="ltr">'sending'</code>, and <code dir="ltr">'sent'</code>:</p> 
<pre data-language="jsx"><span>import</span> <span>{</span> <span>useState</span> <span>}</span> <span>from</span> <span>'react'</span><span>;</span>

<span>export</span> <span>default</span> <span>function</span> <span>FeedbackForm</span><span>(</span><span>)</span> <span>{</span>
  <span>const</span> <span>[</span><span>text</span><span>,</span> <span>setText</span><span>]</span> = <span>useState</span><span>(</span><span>''</span><span>)</span><span>;</span>
  <span>const</span> <span>[</span><span>status</span><span>,</span> <span>setStatus</span><span>]</span> = <span>useState</span><span>(</span><span>'typing'</span><span>)</span><span>;</span>

  <span>async</span> <span>function</span> <span>handleSubmit</span><span>(</span><span>e</span><span>)</span> <span>{</span>
    <span>e</span>.<span>preventDefault</span><span>(</span><span>)</span><span>;</span>
    <span>setStatus</span><span>(</span><span>'sending'</span><span>)</span><span>;</span>
    <span>await</span> <span>sendMessage</span><span>(</span><span>text</span><span>)</span><span>;</span>
    <span>setStatus</span><span>(</span><span>'sent'</span><span>)</span><span>;</span>
  <span>}</span>

  <span>const</span> <span>isSending</span> = <span>status</span> === <span>'sending'</span><span>;</span>
  <span>const</span> <span>isSent</span> = <span>status</span> === <span>'sent'</span><span>;</span>

  <span>if</span> <span>(</span><span>isSent</span><span>)</span> <span>{</span>
    <span>return</span> <span>&lt;</span><span>h1</span><span>&gt;</span>Thanks for feedback!<span>&lt;/</span><span>h1</span><span>&gt;</span>
  <span>}</span>

  <span>return</span> <span>(</span>
    <span>&lt;</span><span>form</span> <span>onSubmit</span>=<span>{</span><span>handleSubmit</span><span>}</span><span>&gt;</span>
      <span>&lt;</span><span>p</span><span>&gt;</span>How was your stay at The Prancing Pony?<span>&lt;/</span><span>p</span><span>&gt;</span>
      <span>&lt;</span><span>textarea</span>
        <span>disabled</span>=<span>{</span><span>isSending</span><span>}</span>
        <span>value</span>=<span>{</span><span>text</span><span>}</span>
        <span>onChange</span>=<span>{</span><span>e</span> <span>=&gt;</span> <span>setText</span><span>(</span><span>e</span>.<span>target</span>.<span>value</span><span>)</span><span>}</span>
      <span>/&gt;</span>
      <span>&lt;</span><span>br</span> <span>/&gt;</span>
      <span>&lt;</span><span>button</span>
        <span>disabled</span>=<span>{</span><span>isSending</span><span>}</span>
        <span>type</span>=<span>"submit"</span>
      <span>&gt;</span>
        Send
      <span>&lt;/</span><span>button</span><span>&gt;</span>
      <span>{</span><span>isSending</span> &amp;&amp; <span>&lt;</span><span>p</span><span>&gt;</span>Sending...<span>&lt;/</span><span>p</span><span>&gt;</span><span>}</span>
    <span>&lt;/</span><span>form</span><span>&gt;</span>
  <span>)</span><span>;</span>
<span>}</span>

<span>// Pretend to send a message.</span>
<span>function</span> <span>sendMessage</span><span>(</span><span>text</span><span>)</span> <span>{</span>
  <span>return</span> <span>new</span> <span>Promise</span><span>(</span><span>resolve</span> <span>=&gt;</span> <span>{</span>
    <span>setTimeout</span><span>(</span><span>resolve</span><span>,</span> <span>2000</span><span>)</span><span>;</span>
  <span>}</span><span>)</span><span>;</span>
<span>}</span>

</pre> <p>You can still declare some constants for readability:</p> <pre data-language="jsx"><code><span>const</span> <span>isSending</span> = <span>status</span> === <span>'sending'</span><span>;</span>
<span>const</span> <span>isSent</span> = <span>status</span> === <span>'sent'</span><span>;</span></code></pre> <p>But they’re not state variables, so you don’t need to worry about them getting out of sync with each other.</p> <h2 id="avoid-redundant-state">Avoid redundant state 
</h2> <p>If you can calculate some information from the component’s props or its existing state variables during rendering, you <strong>should not</strong> put that information into that component’s state.</p> <p>For example, take this form. It works, but can you find any redundant state in it?</p> 
<pre data-language="jsx"><span>import</span> <span>{</span> <span>useState</span> <span>}</span> <span>from</span> <span>'react'</span><span>;</span>

<span>export</span> <span>default</span> <span>function</span> <span>Form</span><span>(</span><span>)</span> <span>{</span>
  <span>const</span> <span>[</span><span>firstName</span><span>,</span> <span>setFirstName</span><span>]</span> = <span>useState</span><span>(</span><span>''</span><span>)</span><span>;</span>
  <span>const</span> <span>[</span><span>lastName</span><span>,</span> <span>setLastName</span><span>]</span> = <span>useState</span><span>(</span><span>''</span><span>)</span><span>;</span>
  <span>const</span> <span>[</span><span>fullName</span><span>,</span> <span>setFullName</span><span>]</span> = <span>useState</span><span>(</span><span>''</span><span>)</span><span>;</span>

  <span>function</span> <span>handleFirstNameChange</span><span>(</span><span>e</span><span>)</span> <span>{</span>
    <span>setFirstName</span><span>(</span><span>e</span>.<span>target</span>.<span>value</span><span>)</span><span>;</span>
    <span>setFullName</span><span>(</span><span>e</span>.<span>target</span>.<span>value</span> + <span>' '</span> + <span>lastName</span><span>)</span><span>;</span>
  <span>}</span>

  <span>function</span> <span>handleLastNameChange</span><span>(</span><span>e</span><span>)</span> <span>{</span>
    <span>setLastName</span><span>(</span><span>e</span>.<span>target</span>.<span>value</span><span>)</span><span>;</span>
    <span>setFullName</span><span>(</span><span>firstName</span> + <span>' '</span> + <span>e</span>.<span>target</span>.<span>value</span><span>)</span><span>;</span>
  <span>}</span>

  <span>return</span> <span>(</span>
    <span>&lt;</span><span>&gt;</span>
      <span>&lt;</span><span>h2</span><span>&gt;</span>Let’s check you in<span>&lt;/</span><span>h2</span><span>&gt;</span>
      <span>&lt;</span><span>label</span><span>&gt;</span>
        First name:<span>{</span><span>' '</span><span>}</span>
        <span>&lt;</span><span>input</span>
          <span>value</span>=<span>{</span><span>firstName</span><span>}</span>
          <span>onChange</span>=<span>{</span><span>handleFirstNameChange</span><span>}</span>
        <span>/&gt;</span>
      <span>&lt;/</span><span>label</span><span>&gt;</span>
      <span>&lt;</span><span>label</span><span>&gt;</span>
        Last name:<span>{</span><span>' '</span><span>}</span>
        <span>&lt;</span><span>input</span>
          <span>value</span>=<span>{</span><span>lastName</span><span>}</span>
          <span>onChange</span>=<span>{</span><span>handleLastNameChange</span><span>}</span>
        <span>/&gt;</span>
      <span>&lt;/</span><span>label</span><span>&gt;</span>
      <span>&lt;</span><span>p</span><span>&gt;</span>
        Your ticket will be issued to: <span>&lt;</span><span>b</span><span>&gt;</span><span>{</span><span>fullName</span><span>}</span><span>&lt;/</span><span>b</span><span>&gt;</span>
      <span>&lt;/</span><span>p</span><span>&gt;</span>
    <span>&lt;/</span><span>&gt;</span>
  <span>)</span><span>;</span>
<span>}</span>

</pre> <p>This form has three state variables: <code dir="ltr">firstName</code>, <code dir="ltr">lastName</code>, and <code dir="ltr">fullName</code>. However, <code dir="ltr">fullName</code> is redundant. <strong>You can always calculate <code dir="ltr">fullName</code> from <code dir="ltr">firstName</code> and <code dir="ltr">lastName</code> during render, so remove it from state.</strong></p> <p>This is how you can do it:</p> 
<pre data-language="jsx"><span>import</span> <span>{</span> <span>useState</span> <span>}</span> <span>from</span> <span>'react'</span><span>;</span>

<span>export</span> <span>default</span> <span>function</span> <span>Form</span><span>(</span><span>)</span> <span>{</span>
  <span>const</span> <span>[</span><span>firstName</span><span>,</span> <span>setFirstName</span><span>]</span> = <span>useState</span><span>(</span><span>''</span><span>)</span><span>;</span>
  <span>const</span> <span>[</span><span>lastName</span><span>,</span> <span>setLastName</span><span>]</span> = <span>useState</span><span>(</span><span>''</span><span>)</span><span>;</span>

  <span>const</span> <span>fullName</span> = <span>firstName</span> + <span>' '</span> + <span>lastName</span><span>;</span>

  <span>function</span> <span>handleFirstNameChange</span><span>(</span><span>e</span><span>)</span> <span>{</span>
    <span>setFirstName</span><span>(</span><span>e</span>.<span>target</span>.<span>value</span><span>)</span><span>;</span>
  <span>}</span>

  <span>function</span> <span>handleLastNameChange</span><span>(</span><span>e</span><span>)</span> <span>{</span>
    <span>setLastName</span><span>(</span><span>e</span>.<span>target</span>.<span>value</span><span>)</span><span>;</span>
  <span>}</span>

  <span>return</span> <span>(</span>
    <span>&lt;</span><span>&gt;</span>
      <span>&lt;</span><span>h2</span><span>&gt;</span>Let’s check you in<span>&lt;/</span><span>h2</span><span>&gt;</span>
      <span>&lt;</span><span>label</span><span>&gt;</span>
        First name:<span>{</span><span>' '</span><span>}</span>
        <span>&lt;</span><span>input</span>
          <span>value</span>=<span>{</span><span>firstName</span><span>}</span>
          <span>onChange</span>=<span>{</span><span>handleFirstNameChange</span><span>}</span>
        <span>/&gt;</span>
      <span>&lt;/</span><span>label</span><span>&gt;</span>
      <span>&lt;</span><span>label</span><span>&gt;</span>
        Last name:<span>{</span><span>' '</span><span>}</span>
        <span>&lt;</span><span>input</span>
          <span>value</span>=<span>{</span><span>lastName</span><span>}</span>
          <span>onChange</span>=<span>{</span><span>handleLastNameChange</span><span>}</span>
        <span>/&gt;</span>
      <span>&lt;/</span><span>label</span><span>&gt;</span>
      <span>&lt;</span><span>p</span><span>&gt;</span>
        Your ticket will be issued to: <span>&lt;</span><span>b</span><span>&gt;</span><span>{</span><span>fullName</span><span>}</span><span>&lt;/</span><span>b</span><span>&gt;</span>
      <span>&lt;/</span><span>p</span><span>&gt;</span>
    <span>&lt;/</span><span>&gt;</span>
  <span>)</span><span>;</span>
<span>}</span>

</pre> <p>Here, <code dir="ltr">fullName</code> is <em>not</em> a state variable. Instead, it’s calculated during render:</p> <pre data-language="jsx"><code><span>const</span> <span>fullName</span> = <span>firstName</span> + <span>' '</span> + <span>lastName</span><span>;</span></code></pre> <p>As a result, the change handlers don’t need to do anything special to update it. When you call <code dir="ltr">setFirstName</code> or <code dir="ltr">setLastName</code>, you trigger a re-render, and then the next <code dir="ltr">fullName</code> will be calculated from the fresh data.</p> <details class="note note-blue"><summary tabindex="-1"><h5>
Deep Dive</h5>
<h4 id="don-t-mirror-props-in-state">Don’t mirror props in state 
</h4></summary><div>
<p>A common example of redundant state is code like this:</p>
<pre data-language="jsx"><code><span>function</span> <span>Message</span><span>(</span><span>{</span> <span>messageColor</span> <span>}</span><span>)</span> <span>{</span>
  <span>const</span> <span>[</span><span>color</span><span>,</span> <span>setColor</span><span>]</span> = <span>useState</span><span>(</span><span>messageColor</span><span>)</span><span>;</span></code></pre>
<p>Here, a <code dir="ltr">color</code> state variable is initialized to the <code dir="ltr">messageColor</code> prop. The problem is that <strong>if the parent component passes a different value of <code dir="ltr">messageColor</code> later (for example, <code dir="ltr">'red'</code> instead of <code dir="ltr">'blue'</code>), the <code dir="ltr">color</code> <em>state variable</em> would not be updated!</strong> The state is only initialized during the first render.</p>
<p>This is why “mirroring” some prop in a state variable can lead to confusion. Instead, use the <code dir="ltr">messageColor</code> prop directly in your code. If you want to give it a shorter name, use a constant:</p>
<pre data-language="jsx"><code><span>function</span> <span>Message</span><span>(</span><span>{</span> <span>messageColor</span> <span>}</span><span>)</span> <span>{</span>
  <span>const</span> <span>color</span> = <span>messageColor</span><span>;</span></code></pre>
<p>This way it won’t get out of sync with the prop passed from the parent component.</p>
<p>”Mirroring” props into state only makes sense when you <em>want</em> to ignore all updates for a specific prop. By convention, start the prop name with <code dir="ltr">initial</code> or <code dir="ltr">default</code> to clarify that its new values are ignored:</p>
<pre data-language="jsx"><code><span>function</span> <span>Message</span><span>(</span><span>{</span> <span>initialColor</span> <span>}</span><span>)</span> <span>{</span>
  <span>// The `color` state variable holds the *first* value of `initialColor`.</span>
  <span>// Further changes to the `initialColor` prop are ignored.</span>
  <span>const</span> <span>[</span><span>color</span><span>,</span> <span>setColor</span><span>]</span> = <span>useState</span><span>(</span><span>initialColor</span><span>)</span><span>;</span></code></pre>
</div></details> <h2 id="avoid-duplication-in-state">Avoid duplication in state 
</h2> <p>This menu list component lets you choose a single travel snack out of several:</p> 
<pre data-language="jsx"><span>import</span> <span>{</span> <span>useState</span> <span>}</span> <span>from</span> <span>'react'</span><span>;</span>

<span>const</span> <span>initialItems</span> = <span>[</span>
  <span>{</span> <span>title</span><span>:</span> <span>'pretzels'</span><span>,</span> <span>id</span><span>:</span> <span>0</span> <span>}</span><span>,</span>
  <span>{</span> <span>title</span><span>:</span> <span>'crispy seaweed'</span><span>,</span> <span>id</span><span>:</span> <span>1</span> <span>}</span><span>,</span>
  <span>{</span> <span>title</span><span>:</span> <span>'granola bar'</span><span>,</span> <span>id</span><span>:</span> <span>2</span> <span>}</span><span>,</span>
<span>]</span><span>;</span>

<span>export</span> <span>default</span> <span>function</span> <span>Menu</span><span>(</span><span>)</span> <span>{</span>
  <span>const</span> <span>[</span><span>items</span><span>,</span> <span>setItems</span><span>]</span> = <span>useState</span><span>(</span><span>initialItems</span><span>)</span><span>;</span>
  <span>const</span> <span>[</span><span>selectedItem</span><span>,</span> <span>setSelectedItem</span><span>]</span> = <span>useState</span><span>(</span>
    <span>items</span><span>[</span><span>0</span><span>]</span>
  <span>)</span><span>;</span>

  <span>return</span> <span>(</span>
    <span>&lt;</span><span>&gt;</span>
      <span>&lt;</span><span>h2</span><span>&gt;</span>What's your travel snack?<span>&lt;/</span><span>h2</span><span>&gt;</span>
      <span>&lt;</span><span>ul</span><span>&gt;</span>
        <span>{</span><span>items</span>.<span>map</span><span>(</span><span>item</span> <span>=&gt;</span> <span>(</span>
          <span>&lt;</span><span>li</span> <span>key</span>=<span>{</span><span>item</span>.<span>id</span><span>}</span><span>&gt;</span>
            <span>{</span><span>item</span>.<span>title</span><span>}</span>
            <span>{</span><span>' '</span><span>}</span>
            <span>&lt;</span><span>button</span> <span>onClick</span>=<span>{</span><span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
              <span>setSelectedItem</span><span>(</span><span>item</span><span>)</span><span>;</span>
            <span>}</span><span>}</span><span>&gt;</span>Choose<span>&lt;/</span><span>button</span><span>&gt;</span>
          <span>&lt;/</span><span>li</span><span>&gt;</span>
        <span>)</span><span>)</span><span>}</span>
      <span>&lt;/</span><span>ul</span><span>&gt;</span>
      <span>&lt;</span><span>p</span><span>&gt;</span>You picked <span>{</span><span>selectedItem</span>.<span>title</span><span>}</span>.<span>&lt;/</span><span>p</span><span>&gt;</span>
    <span>&lt;/</span><span>&gt;</span>
  <span>)</span><span>;</span>
<span>}</span>

</pre> <p>Currently, it stores the selected item as an object in the <code dir="ltr">selectedItem</code> state variable. However, this is not great: <strong>the contents of the <code dir="ltr">selectedItem</code> is the same object as one of the items inside the <code dir="ltr">items</code> list.</strong> This means that the information about the item itself is duplicated in two places.</p> <p>Why is this a problem? Let’s make each item editable:</p> 
<pre data-language="jsx"><span>import</span> <span>{</span> <span>useState</span> <span>}</span> <span>from</span> <span>'react'</span><span>;</span>

<span>const</span> <span>initialItems</span> = <span>[</span>
  <span>{</span> <span>title</span><span>:</span> <span>'pretzels'</span><span>,</span> <span>id</span><span>:</span> <span>0</span> <span>}</span><span>,</span>
  <span>{</span> <span>title</span><span>:</span> <span>'crispy seaweed'</span><span>,</span> <span>id</span><span>:</span> <span>1</span> <span>}</span><span>,</span>
  <span>{</span> <span>title</span><span>:</span> <span>'granola bar'</span><span>,</span> <span>id</span><span>:</span> <span>2</span> <span>}</span><span>,</span>
<span>]</span><span>;</span>

<span>export</span> <span>default</span> <span>function</span> <span>Menu</span><span>(</span><span>)</span> <span>{</span>
  <span>const</span> <span>[</span><span>items</span><span>,</span> <span>setItems</span><span>]</span> = <span>useState</span><span>(</span><span>initialItems</span><span>)</span><span>;</span>
  <span>const</span> <span>[</span><span>selectedItem</span><span>,</span> <span>setSelectedItem</span><span>]</span> = <span>useState</span><span>(</span>
    <span>items</span><span>[</span><span>0</span><span>]</span>
  <span>)</span><span>;</span>

  <span>function</span> <span>handleItemChange</span><span>(</span><span>id</span><span>,</span> <span>e</span><span>)</span> <span>{</span>
    <span>setItems</span><span>(</span><span>items</span>.<span>map</span><span>(</span><span>item</span> <span>=&gt;</span> <span>{</span>
      <span>if</span> <span>(</span><span>item</span>.<span>id</span> === <span>id</span><span>)</span> <span>{</span>
        <span>return</span> <span>{</span>
          <span>...</span><span>item</span><span>,</span>
          <span>title</span><span>:</span> <span>e</span>.<span>target</span>.<span>value</span><span>,</span>
        <span>}</span><span>;</span>
      <span>}</span> <span>else</span> <span>{</span>
        <span>return</span> <span>item</span><span>;</span>
      <span>}</span>
    <span>}</span><span>)</span><span>)</span><span>;</span>
  <span>}</span>

  <span>return</span> <span>(</span>
    <span>&lt;</span><span>&gt;</span>
      <span>&lt;</span><span>h2</span><span>&gt;</span>What's your travel snack?<span>&lt;/</span><span>h2</span><span>&gt;</span> 
      <span>&lt;</span><span>ul</span><span>&gt;</span>
        <span>{</span><span>items</span>.<span>map</span><span>(</span><span>(</span><span>item</span><span>,</span> <span>index</span><span>)</span> <span>=&gt;</span> <span>(</span>
          <span>&lt;</span><span>li</span> <span>key</span>=<span>{</span><span>item</span>.<span>id</span><span>}</span><span>&gt;</span>
            <span>&lt;</span><span>input</span>
              <span>value</span>=<span>{</span><span>item</span>.<span>title</span><span>}</span>
              <span>onChange</span>=<span>{</span><span>e</span> <span>=&gt;</span> <span>{</span>
                <span>handleItemChange</span><span>(</span><span>item</span>.<span>id</span><span>,</span> <span>e</span><span>)</span>
              <span>}</span><span>}</span>
            <span>/&gt;</span>
            <span>{</span><span>' '</span><span>}</span>
            <span>&lt;</span><span>button</span> <span>onClick</span>=<span>{</span><span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
              <span>setSelectedItem</span><span>(</span><span>item</span><span>)</span><span>;</span>
            <span>}</span><span>}</span><span>&gt;</span>Choose<span>&lt;/</span><span>button</span><span>&gt;</span>
          <span>&lt;/</span><span>li</span><span>&gt;</span>
        <span>)</span><span>)</span><span>}</span>
      <span>&lt;/</span><span>ul</span><span>&gt;</span>
      <span>&lt;</span><span>p</span><span>&gt;</span>You picked <span>{</span><span>selectedItem</span>.<span>title</span><span>}</span>.<span>&lt;/</span><span>p</span><span>&gt;</span>
    <span>&lt;/</span><span>&gt;</span>
  <span>)</span><span>;</span>
<span>}</span>

</pre> <p>Notice how if you first click “Choose” on an item and <em>then</em> edit it, <strong>the input updates but the label at the bottom does not reflect the edits.</strong> This is because you have duplicated state, and you forgot to update <code dir="ltr">selectedItem</code>.</p> <p>Although you could update <code dir="ltr">selectedItem</code> too, an easier fix is to remove duplication. In this example, instead of a <code dir="ltr">selectedItem</code> object (which creates a duplication with objects inside <code dir="ltr">items</code>), you hold the <code dir="ltr">selectedId</code> in state, and <em>then</em> get the <code dir="ltr">selectedItem</code> by searching the <code dir="ltr">items</code> array for an item with that ID:</p> 
<pre data-language="jsx"><span>import</span> <span>{</span> <span>useState</span> <span>}</span> <span>from</span> <span>'react'</span><span>;</span>

<span>const</span> <span>initialItems</span> = <span>[</span>
  <span>{</span> <span>title</span><span>:</span> <span>'pretzels'</span><span>,</span> <span>id</span><span>:</span> <span>0</span> <span>}</span><span>,</span>
  <span>{</span> <span>title</span><span>:</span> <span>'crispy seaweed'</span><span>,</span> <span>id</span><span>:</span> <span>1</span> <span>}</span><span>,</span>
  <span>{</span> <span>title</span><span>:</span> <span>'granola bar'</span><span>,</span> <span>id</span><span>:</span> <span>2</span> <span>}</span><span>,</span>
<span>]</span><span>;</span>

<span>export</span> <span>default</span> <span>function</span> <span>Menu</span><span>(</span><span>)</span> <span>{</span>
  <span>const</span> <span>[</span><span>items</span><span>,</span> <span>setItems</span><span>]</span> = <span>useState</span><span>(</span><span>initialItems</span><span>)</span><span>;</span>
  <span>const</span> <span>[</span><span>selectedId</span><span>,</span> <span>setSelectedId</span><span>]</span> = <span>useState</span><span>(</span><span>0</span><span>)</span><span>;</span>

  <span>const</span> <span>selectedItem</span> = <span>items</span>.<span>find</span><span>(</span><span>item</span> <span>=&gt;</span>
    <span>item</span>.<span>id</span> === <span>selectedId</span>
  <span>)</span><span>;</span>

  <span>function</span> <span>handleItemChange</span><span>(</span><span>id</span><span>,</span> <span>e</span><span>)</span> <span>{</span>
    <span>setItems</span><span>(</span><span>items</span>.<span>map</span><span>(</span><span>item</span> <span>=&gt;</span> <span>{</span>
      <span>if</span> <span>(</span><span>item</span>.<span>id</span> === <span>id</span><span>)</span> <span>{</span>
        <span>return</span> <span>{</span>
          <span>...</span><span>item</span><span>,</span>
          <span>title</span><span>:</span> <span>e</span>.<span>target</span>.<span>value</span><span>,</span>
        <span>}</span><span>;</span>
      <span>}</span> <span>else</span> <span>{</span>
        <span>return</span> <span>item</span><span>;</span>
      <span>}</span>
    <span>}</span><span>)</span><span>)</span><span>;</span>
  <span>}</span>

  <span>return</span> <span>(</span>
    <span>&lt;</span><span>&gt;</span>
      <span>&lt;</span><span>h2</span><span>&gt;</span>What's your travel snack?<span>&lt;/</span><span>h2</span><span>&gt;</span>
      <span>&lt;</span><span>ul</span><span>&gt;</span>
        <span>{</span><span>items</span>.<span>map</span><span>(</span><span>(</span><span>item</span><span>,</span> <span>index</span><span>)</span> <span>=&gt;</span> <span>(</span>
          <span>&lt;</span><span>li</span> <span>key</span>=<span>{</span><span>item</span>.<span>id</span><span>}</span><span>&gt;</span>
            <span>&lt;</span><span>input</span>
              <span>value</span>=<span>{</span><span>item</span>.<span>title</span><span>}</span>
              <span>onChange</span>=<span>{</span><span>e</span> <span>=&gt;</span> <span>{</span>
                <span>handleItemChange</span><span>(</span><span>item</span>.<span>id</span><span>,</span> <span>e</span><span>)</span>
              <span>}</span><span>}</span>
            <span>/&gt;</span>
            <span>{</span><span>' '</span><span>}</span>
            <span>&lt;</span><span>button</span> <span>onClick</span>=<span>{</span><span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
              <span>setSelectedId</span><span>(</span><span>item</span>.<span>id</span><span>)</span><span>;</span>
            <span>}</span><span>}</span><span>&gt;</span>Choose<span>&lt;/</span><span>button</span><span>&gt;</span>
          <span>&lt;/</span><span>li</span><span>&gt;</span>
        <span>)</span><span>)</span><span>}</span>
      <span>&lt;/</span><span>ul</span><span>&gt;</span>
      <span>&lt;</span><span>p</span><span>&gt;</span>You picked <span>{</span><span>selectedItem</span>.<span>title</span><span>}</span>.<span>&lt;/</span><span>p</span><span>&gt;</span>
    <span>&lt;/</span><span>&gt;</span>
  <span>)</span><span>;</span>
<span>}</span>

</pre> <p>The state used to be duplicated like this:</p> <ul> <li><code dir="ltr">items = [{ id: 0, title: 'pretzels'}, ...]</code></li> <li><code dir="ltr">selectedItem = {id: 0, title: 'pretzels'}</code></li> </ul> <p>But after the change it’s like this:</p> <ul> <li><code dir="ltr">items = [{ id: 0, title: 'pretzels'}, ...]</code></li> <li><code dir="ltr">selectedId = 0</code></li> </ul> <p>The duplication is gone, and you only keep the essential state!</p> <p>Now if you edit the <em>selected</em> item, the message below will update immediately. This is because <code dir="ltr">setItems</code> triggers a re-render, and <code dir="ltr">items.find(...)</code> would find the item with the updated title. You didn’t need to hold <em>the selected item</em> in state, because only the <em>selected ID</em> is essential. The rest could be calculated during render.</p> <h2 id="avoid-deeply-nested-state">Avoid deeply nested state 
</h2> <p>Imagine a travel plan consisting of planets, continents, and countries. You might be tempted to structure its state using nested objects and arrays, like in this example:</p> 
<pre data-language="jsx"><span>export</span> <span>const</span> <span>initialTravelPlan</span> = <span>{</span>
  <span>id</span><span>:</span> <span>0</span><span>,</span>
  <span>title</span><span>:</span> <span>'(Root)'</span><span>,</span>
  <span>childPlaces</span><span>:</span> <span>[</span><span>{</span>
    <span>id</span><span>:</span> <span>1</span><span>,</span>
    <span>title</span><span>:</span> <span>'Earth'</span><span>,</span>
    <span>childPlaces</span><span>:</span> <span>[</span><span>{</span>
      <span>id</span><span>:</span> <span>2</span><span>,</span>
      <span>title</span><span>:</span> <span>'Africa'</span><span>,</span>
      <span>childPlaces</span><span>:</span> <span>[</span><span>{</span>
        <span>id</span><span>:</span> <span>3</span><span>,</span>
        <span>title</span><span>:</span> <span>'Botswana'</span><span>,</span>
        <span>childPlaces</span><span>:</span> <span>[</span><span>]</span>
      <span>}</span><span>,</span> <span>{</span>
        <span>id</span><span>:</span> <span>4</span><span>,</span>
        <span>title</span><span>:</span> <span>'Egypt'</span><span>,</span>
        <span>childPlaces</span><span>:</span> <span>[</span><span>]</span>
      <span>}</span><span>,</span> <span>{</span>
        <span>id</span><span>:</span> <span>5</span><span>,</span>
        <span>title</span><span>:</span> <span>'Kenya'</span><span>,</span>
        <span>childPlaces</span><span>:</span> <span>[</span><span>]</span>
      <span>}</span><span>,</span> <span>{</span>
        <span>id</span><span>:</span> <span>6</span><span>,</span>
        <span>title</span><span>:</span> <span>'Madagascar'</span><span>,</span>
        <span>childPlaces</span><span>:</span> <span>[</span><span>]</span>
      <span>}</span><span>,</span> <span>{</span>
        <span>id</span><span>:</span> <span>7</span><span>,</span>
        <span>title</span><span>:</span> <span>'Morocco'</span><span>,</span>
        <span>childPlaces</span><span>:</span> <span>[</span><span>]</span>
      <span>}</span><span>,</span> <span>{</span>
        <span>id</span><span>:</span> <span>8</span><span>,</span>
        <span>title</span><span>:</span> <span>'Nigeria'</span><span>,</span>
        <span>childPlaces</span><span>:</span> <span>[</span><span>]</span>
      <span>}</span><span>,</span> <span>{</span>
        <span>id</span><span>:</span> <span>9</span><span>,</span>
        <span>title</span><span>:</span> <span>'South Africa'</span><span>,</span>
        <span>childPlaces</span><span>:</span> <span>[</span><span>]</span>
      <span>}</span><span>]</span>
    <span>}</span><span>,</span> <span>{</span>
      <span>id</span><span>:</span> <span>10</span><span>,</span>
      <span>title</span><span>:</span> <span>'Americas'</span><span>,</span>
      <span>childPlaces</span><span>:</span> <span>[</span><span>{</span>
        <span>id</span><span>:</span> <span>11</span><span>,</span>
        <span>title</span><span>:</span> <span>'Argentina'</span><span>,</span>
        <span>childPlaces</span><span>:</span> <span>[</span><span>]</span>
      <span>}</span><span>,</span> <span>{</span>
        <span>id</span><span>:</span> <span>12</span><span>,</span>
        <span>title</span><span>:</span> <span>'Brazil'</span><span>,</span>
        <span>childPlaces</span><span>:</span> <span>[</span><span>]</span>
      <span>}</span><span>,</span> <span>{</span>
        <span>id</span><span>:</span> <span>13</span><span>,</span>
        <span>title</span><span>:</span> <span>'Barbados'</span><span>,</span>
        <span>childPlaces</span><span>:</span> <span>[</span><span>]</span>
      <span>}</span><span>,</span> <span>{</span>
        <span>id</span><span>:</span> <span>14</span><span>,</span>
        <span>title</span><span>:</span> <span>'Canada'</span><span>,</span>
        <span>childPlaces</span><span>:</span> <span>[</span><span>]</span>
      <span>}</span><span>,</span> <span>{</span>
        <span>id</span><span>:</span> <span>15</span><span>,</span>
        <span>title</span><span>:</span> <span>'Jamaica'</span><span>,</span>
        <span>childPlaces</span><span>:</span> <span>[</span><span>]</span>
      <span>}</span><span>,</span> <span>{</span>
        <span>id</span><span>:</span> <span>16</span><span>,</span>
        <span>title</span><span>:</span> <span>'Mexico'</span><span>,</span>
        <span>childPlaces</span><span>:</span> <span>[</span><span>]</span>
      <span>}</span><span>,</span> <span>{</span>
        <span>id</span><span>:</span> <span>17</span><span>,</span>
        <span>title</span><span>:</span> <span>'Trinidad and Tobago'</span><span>,</span>
        <span>childPlaces</span><span>:</span> <span>[</span><span>]</span>
      <span>}</span><span>,</span> <span>{</span>
        <span>id</span><span>:</span> <span>18</span><span>,</span>
        <span>title</span><span>:</span> <span>'Venezuela'</span><span>,</span>
        <span>childPlaces</span><span>:</span> <span>[</span><span>]</span>
      <span>}</span><span>]</span>
    <span>}</span><span>,</span> <span>{</span>
      <span>id</span><span>:</span> <span>19</span><span>,</span>
      <span>title</span><span>:</span> <span>'Asia'</span><span>,</span>
      <span>childPlaces</span><span>:</span> <span>[</span><span>{</span>
        <span>id</span><span>:</span> <span>20</span><span>,</span>
        <span>title</span><span>:</span> <span>'China'</span><span>,</span>
        <span>childPlaces</span><span>:</span> <span>[</span><span>]</span>
      <span>}</span><span>,</span> <span>{</span>
        <span>id</span><span>:</span> <span>21</span><span>,</span>
        <span>title</span><span>:</span> <span>'India'</span><span>,</span>
        <span>childPlaces</span><span>:</span> <span>[</span><span>]</span>
      <span>}</span><span>,</span> <span>{</span>
        <span>id</span><span>:</span> <span>22</span><span>,</span>
        <span>title</span><span>:</span> <span>'Singapore'</span><span>,</span>
        <span>childPlaces</span><span>:</span> <span>[</span><span>]</span>
      <span>}</span><span>,</span> <span>{</span>
        <span>id</span><span>:</span> <span>23</span><span>,</span>
        <span>title</span><span>:</span> <span>'South Korea'</span><span>,</span>
        <span>childPlaces</span><span>:</span> <span>[</span><span>]</span>
      <span>}</span><span>,</span> <span>{</span>
        <span>id</span><span>:</span> <span>24</span><span>,</span>
        <span>title</span><span>:</span> <span>'Thailand'</span><span>,</span>
        <span>childPlaces</span><span>:</span> <span>[</span><span>]</span>
      <span>}</span><span>,</span> <span>{</span>
        <span>id</span><span>:</span> <span>25</span><span>,</span>
        <span>title</span><span>:</span> <span>'Vietnam'</span><span>,</span>
        <span>childPlaces</span><span>:</span> <span>[</span><span>]</span>
      <span>}</span><span>]</span>
    <span>}</span><span>,</span> <span>{</span>
      <span>id</span><span>:</span> <span>26</span><span>,</span>
      <span>title</span><span>:</span> <span>'Europe'</span><span>,</span>
      <span>childPlaces</span><span>:</span> <span>[</span><span>{</span>
        <span>id</span><span>:</span> <span>27</span><span>,</span>
        <span>title</span><span>:</span> <span>'Croatia'</span><span>,</span>
        <span>childPlaces</span><span>:</span> <span>[</span><span>]</span><span>,</span>
      <span>}</span><span>,</span> <span>{</span>
        <span>id</span><span>:</span> <span>28</span><span>,</span>
        <span>title</span><span>:</span> <span>'France'</span><span>,</span>
        <span>childPlaces</span><span>:</span> <span>[</span><span>]</span><span>,</span>
      <span>}</span><span>,</span> <span>{</span>
        <span>id</span><span>:</span> <span>29</span><span>,</span>
        <span>title</span><span>:</span> <span>'Germany'</span><span>,</span>
        <span>childPlaces</span><span>:</span> <span>[</span><span>]</span><span>,</span>
      <span>}</span><span>,</span> <span>{</span>
        <span>id</span><span>:</span> <span>30</span><span>,</span>
        <span>title</span><span>:</span> <span>'Italy'</span><span>,</span>
        <span>childPlaces</span><span>:</span> <span>[</span><span>]</span><span>,</span>
      <span>}</span><span>,</span> <span>{</span>
        <span>id</span><span>:</span> <span>31</span><span>,</span>
        <span>title</span><span>:</span> <span>'Portugal'</span><span>,</span>
        <span>childPlaces</span><span>:</span> <span>[</span><span>]</span><span>,</span>
      <span>}</span><span>,</span> <span>{</span>
        <span>id</span><span>:</span> <span>32</span><span>,</span>
        <span>title</span><span>:</span> <span>'Spain'</span><span>,</span>
        <span>childPlaces</span><span>:</span> <span>[</span><span>]</span><span>,</span>
      <span>}</span><span>,</span> <span>{</span>
        <span>id</span><span>:</span> <span>33</span><span>,</span>
        <span>title</span><span>:</span> <span>'Turkey'</span><span>,</span>
        <span>childPlaces</span><span>:</span> <span>[</span><span>]</span><span>,</span>
      <span>}</span><span>]</span>
    <span>}</span><span>,</span> <span>{</span>
      <span>id</span><span>:</span> <span>34</span><span>,</span>
      <span>title</span><span>:</span> <span>'Oceania'</span><span>,</span>
      <span>childPlaces</span><span>:</span> <span>[</span><span>{</span>
        <span>id</span><span>:</span> <span>35</span><span>,</span>
        <span>title</span><span>:</span> <span>'Australia'</span><span>,</span>
        <span>childPlaces</span><span>:</span> <span>[</span><span>]</span><span>,</span>
      <span>}</span><span>,</span> <span>{</span>
        <span>id</span><span>:</span> <span>36</span><span>,</span>
        <span>title</span><span>:</span> <span>'Bora Bora (French Polynesia)'</span><span>,</span>
        <span>childPlaces</span><span>:</span> <span>[</span><span>]</span><span>,</span>
      <span>}</span><span>,</span> <span>{</span>
        <span>id</span><span>:</span> <span>37</span><span>,</span>
        <span>title</span><span>:</span> <span>'Easter Island (Chile)'</span><span>,</span>
        <span>childPlaces</span><span>:</span> <span>[</span><span>]</span><span>,</span>
      <span>}</span><span>,</span> <span>{</span>
        <span>id</span><span>:</span> <span>38</span><span>,</span>
        <span>title</span><span>:</span> <span>'Fiji'</span><span>,</span>
        <span>childPlaces</span><span>:</span> <span>[</span><span>]</span><span>,</span>
      <span>}</span><span>,</span> <span>{</span>
        <span>id</span><span>:</span> <span>39</span><span>,</span>
        <span>title</span><span>:</span> <span>'Hawaii (the USA)'</span><span>,</span>
        <span>childPlaces</span><span>:</span> <span>[</span><span>]</span><span>,</span>
      <span>}</span><span>,</span> <span>{</span>
        <span>id</span><span>:</span> <span>40</span><span>,</span>
        <span>title</span><span>:</span> <span>'New Zealand'</span><span>,</span>
        <span>childPlaces</span><span>:</span> <span>[</span><span>]</span><span>,</span>
      <span>}</span><span>,</span> <span>{</span>
        <span>id</span><span>:</span> <span>41</span><span>,</span>
        <span>title</span><span>:</span> <span>'Vanuatu'</span><span>,</span>
        <span>childPlaces</span><span>:</span> <span>[</span><span>]</span><span>,</span>
      <span>}</span><span>]</span>
    <span>}</span><span>]</span>
  <span>}</span><span>,</span> <span>{</span>
    <span>id</span><span>:</span> <span>42</span><span>,</span>
    <span>title</span><span>:</span> <span>'Moon'</span><span>,</span>
    <span>childPlaces</span><span>:</span> <span>[</span><span>{</span>
      <span>id</span><span>:</span> <span>43</span><span>,</span>
      <span>title</span><span>:</span> <span>'Rheita'</span><span>,</span>
      <span>childPlaces</span><span>:</span> <span>[</span><span>]</span>
    <span>}</span><span>,</span> <span>{</span>
      <span>id</span><span>:</span> <span>44</span><span>,</span>
      <span>title</span><span>:</span> <span>'Piccolomini'</span><span>,</span>
      <span>childPlaces</span><span>:</span> <span>[</span><span>]</span>
    <span>}</span><span>,</span> <span>{</span>
      <span>id</span><span>:</span> <span>45</span><span>,</span>
      <span>title</span><span>:</span> <span>'Tycho'</span><span>,</span>
      <span>childPlaces</span><span>:</span> <span>[</span><span>]</span>
    <span>}</span><span>]</span>
  <span>}</span><span>,</span> <span>{</span>
    <span>id</span><span>:</span> <span>46</span><span>,</span>
    <span>title</span><span>:</span> <span>'Mars'</span><span>,</span>
    <span>childPlaces</span><span>:</span> <span>[</span><span>{</span>
      <span>id</span><span>:</span> <span>47</span><span>,</span>
      <span>title</span><span>:</span> <span>'Corn Town'</span><span>,</span>
      <span>childPlaces</span><span>:</span> <span>[</span><span>]</span>
    <span>}</span><span>,</span> <span>{</span>
      <span>id</span><span>:</span> <span>48</span><span>,</span>
      <span>title</span><span>:</span> <span>'Green Hill'</span><span>,</span>
      <span>childPlaces</span><span>:</span> <span>[</span><span>]</span>      
    <span>}</span><span>]</span>
  <span>}</span><span>]</span>
<span>}</span><span>;</span>

</pre> <p>Now let’s say you want to add a button to delete a place you’ve already visited. How would you go about it? <a href="updating-objects-in-state.html#updating-a-nested-object">Updating nested state</a> involves making copies of objects all the way up from the part that changed. Deleting a deeply nested place would involve copying its entire parent place chain. Such code can be very verbose.</p> <p><strong>If the state is too nested to update easily, consider making it “flat”.</strong> Here is one way you can restructure this data. Instead of a tree-like structure where each <code dir="ltr">place</code> has an array of <em>its child places</em>, you can have each place hold an array of <em>its child place IDs</em>. Then store a mapping from each place ID to the corresponding place.</p> <p>This data restructuring might remind you of seeing a database table:</p> 
<pre data-language="jsx"><span>export</span> <span>const</span> <span>initialTravelPlan</span> = <span>{</span>
  <span>0</span><span>:</span> <span>{</span>
    <span>id</span><span>:</span> <span>0</span><span>,</span>
    <span>title</span><span>:</span> <span>'(Root)'</span><span>,</span>
    <span>childIds</span><span>:</span> <span>[</span><span>1</span><span>,</span> <span>42</span><span>,</span> <span>46</span><span>]</span><span>,</span>
  <span>}</span><span>,</span>
  <span>1</span><span>:</span> <span>{</span>
    <span>id</span><span>:</span> <span>1</span><span>,</span>
    <span>title</span><span>:</span> <span>'Earth'</span><span>,</span>
    <span>childIds</span><span>:</span> <span>[</span><span>2</span><span>,</span> <span>10</span><span>,</span> <span>19</span><span>,</span> <span>26</span><span>,</span> <span>34</span><span>]</span>
  <span>}</span><span>,</span>
  <span>2</span><span>:</span> <span>{</span>
    <span>id</span><span>:</span> <span>2</span><span>,</span>
    <span>title</span><span>:</span> <span>'Africa'</span><span>,</span>
    <span>childIds</span><span>:</span> <span>[</span><span>3</span><span>,</span> <span>4</span><span>,</span> <span>5</span><span>,</span> <span>6</span> <span>,</span> <span>7</span><span>,</span> <span>8</span><span>,</span> <span>9</span><span>]</span>
  <span>}</span><span>,</span> 
  <span>3</span><span>:</span> <span>{</span>
    <span>id</span><span>:</span> <span>3</span><span>,</span>
    <span>title</span><span>:</span> <span>'Botswana'</span><span>,</span>
    <span>childIds</span><span>:</span> <span>[</span><span>]</span>
  <span>}</span><span>,</span>
  <span>4</span><span>:</span> <span>{</span>
    <span>id</span><span>:</span> <span>4</span><span>,</span>
    <span>title</span><span>:</span> <span>'Egypt'</span><span>,</span>
    <span>childIds</span><span>:</span> <span>[</span><span>]</span>
  <span>}</span><span>,</span>
  <span>5</span><span>:</span> <span>{</span>
    <span>id</span><span>:</span> <span>5</span><span>,</span>
    <span>title</span><span>:</span> <span>'Kenya'</span><span>,</span>
    <span>childIds</span><span>:</span> <span>[</span><span>]</span>
  <span>}</span><span>,</span>
  <span>6</span><span>:</span> <span>{</span>
    <span>id</span><span>:</span> <span>6</span><span>,</span>
    <span>title</span><span>:</span> <span>'Madagascar'</span><span>,</span>
    <span>childIds</span><span>:</span> <span>[</span><span>]</span>
  <span>}</span><span>,</span> 
  <span>7</span><span>:</span> <span>{</span>
    <span>id</span><span>:</span> <span>7</span><span>,</span>
    <span>title</span><span>:</span> <span>'Morocco'</span><span>,</span>
    <span>childIds</span><span>:</span> <span>[</span><span>]</span>
  <span>}</span><span>,</span>
  <span>8</span><span>:</span> <span>{</span>
    <span>id</span><span>:</span> <span>8</span><span>,</span>
    <span>title</span><span>:</span> <span>'Nigeria'</span><span>,</span>
    <span>childIds</span><span>:</span> <span>[</span><span>]</span>
  <span>}</span><span>,</span>
  <span>9</span><span>:</span> <span>{</span>
    <span>id</span><span>:</span> <span>9</span><span>,</span>
    <span>title</span><span>:</span> <span>'South Africa'</span><span>,</span>
    <span>childIds</span><span>:</span> <span>[</span><span>]</span>
  <span>}</span><span>,</span>
  <span>10</span><span>:</span> <span>{</span>
    <span>id</span><span>:</span> <span>10</span><span>,</span>
    <span>title</span><span>:</span> <span>'Americas'</span><span>,</span>
    <span>childIds</span><span>:</span> <span>[</span><span>11</span><span>,</span> <span>12</span><span>,</span> <span>13</span><span>,</span> <span>14</span><span>,</span> <span>15</span><span>,</span> <span>16</span><span>,</span> <span>17</span><span>,</span> <span>18</span><span>]</span><span>,</span>   
  <span>}</span><span>,</span>
  <span>11</span><span>:</span> <span>{</span>
    <span>id</span><span>:</span> <span>11</span><span>,</span>
    <span>title</span><span>:</span> <span>'Argentina'</span><span>,</span>
    <span>childIds</span><span>:</span> <span>[</span><span>]</span>
  <span>}</span><span>,</span>
  <span>12</span><span>:</span> <span>{</span>
    <span>id</span><span>:</span> <span>12</span><span>,</span>
    <span>title</span><span>:</span> <span>'Brazil'</span><span>,</span>
    <span>childIds</span><span>:</span> <span>[</span><span>]</span>
  <span>}</span><span>,</span>
  <span>13</span><span>:</span> <span>{</span>
    <span>id</span><span>:</span> <span>13</span><span>,</span>
    <span>title</span><span>:</span> <span>'Barbados'</span><span>,</span>
    <span>childIds</span><span>:</span> <span>[</span><span>]</span>
  <span>}</span><span>,</span> 
  <span>14</span><span>:</span> <span>{</span>
    <span>id</span><span>:</span> <span>14</span><span>,</span>
    <span>title</span><span>:</span> <span>'Canada'</span><span>,</span>
    <span>childIds</span><span>:</span> <span>[</span><span>]</span>
  <span>}</span><span>,</span>
  <span>15</span><span>:</span> <span>{</span>
    <span>id</span><span>:</span> <span>15</span><span>,</span>
    <span>title</span><span>:</span> <span>'Jamaica'</span><span>,</span>
    <span>childIds</span><span>:</span> <span>[</span><span>]</span>
  <span>}</span><span>,</span>
  <span>16</span><span>:</span> <span>{</span>
    <span>id</span><span>:</span> <span>16</span><span>,</span>
    <span>title</span><span>:</span> <span>'Mexico'</span><span>,</span>
    <span>childIds</span><span>:</span> <span>[</span><span>]</span>
  <span>}</span><span>,</span>
  <span>17</span><span>:</span> <span>{</span>
    <span>id</span><span>:</span> <span>17</span><span>,</span>
    <span>title</span><span>:</span> <span>'Trinidad and Tobago'</span><span>,</span>
    <span>childIds</span><span>:</span> <span>[</span><span>]</span>
  <span>}</span><span>,</span>
  <span>18</span><span>:</span> <span>{</span>
    <span>id</span><span>:</span> <span>18</span><span>,</span>
    <span>title</span><span>:</span> <span>'Venezuela'</span><span>,</span>
    <span>childIds</span><span>:</span> <span>[</span><span>]</span>
  <span>}</span><span>,</span>
  <span>19</span><span>:</span> <span>{</span>
    <span>id</span><span>:</span> <span>19</span><span>,</span>
    <span>title</span><span>:</span> <span>'Asia'</span><span>,</span>
    <span>childIds</span><span>:</span> <span>[</span><span>20</span><span>,</span> <span>21</span><span>,</span> <span>22</span><span>,</span> <span>23</span><span>,</span> <span>24</span><span>,</span> <span>25</span><span>]</span><span>,</span>   
  <span>}</span><span>,</span>
  <span>20</span><span>:</span> <span>{</span>
    <span>id</span><span>:</span> <span>20</span><span>,</span>
    <span>title</span><span>:</span> <span>'China'</span><span>,</span>
    <span>childIds</span><span>:</span> <span>[</span><span>]</span>
  <span>}</span><span>,</span>
  <span>21</span><span>:</span> <span>{</span>
    <span>id</span><span>:</span> <span>21</span><span>,</span>
    <span>title</span><span>:</span> <span>'India'</span><span>,</span>
    <span>childIds</span><span>:</span> <span>[</span><span>]</span>
  <span>}</span><span>,</span>
  <span>22</span><span>:</span> <span>{</span>
    <span>id</span><span>:</span> <span>22</span><span>,</span>
    <span>title</span><span>:</span> <span>'Singapore'</span><span>,</span>
    <span>childIds</span><span>:</span> <span>[</span><span>]</span>
  <span>}</span><span>,</span>
  <span>23</span><span>:</span> <span>{</span>
    <span>id</span><span>:</span> <span>23</span><span>,</span>
    <span>title</span><span>:</span> <span>'South Korea'</span><span>,</span>
    <span>childIds</span><span>:</span> <span>[</span><span>]</span>
  <span>}</span><span>,</span>
  <span>24</span><span>:</span> <span>{</span>
    <span>id</span><span>:</span> <span>24</span><span>,</span>
    <span>title</span><span>:</span> <span>'Thailand'</span><span>,</span>
    <span>childIds</span><span>:</span> <span>[</span><span>]</span>
  <span>}</span><span>,</span>
  <span>25</span><span>:</span> <span>{</span>
    <span>id</span><span>:</span> <span>25</span><span>,</span>
    <span>title</span><span>:</span> <span>'Vietnam'</span><span>,</span>
    <span>childIds</span><span>:</span> <span>[</span><span>]</span>
  <span>}</span><span>,</span>
  <span>26</span><span>:</span> <span>{</span>
    <span>id</span><span>:</span> <span>26</span><span>,</span>
    <span>title</span><span>:</span> <span>'Europe'</span><span>,</span>
    <span>childIds</span><span>:</span> <span>[</span><span>27</span><span>,</span> <span>28</span><span>,</span> <span>29</span><span>,</span> <span>30</span><span>,</span> <span>31</span><span>,</span> <span>32</span><span>,</span> <span>33</span><span>]</span><span>,</span>   
  <span>}</span><span>,</span>
  <span>27</span><span>:</span> <span>{</span>
    <span>id</span><span>:</span> <span>27</span><span>,</span>
    <span>title</span><span>:</span> <span>'Croatia'</span><span>,</span>
    <span>childIds</span><span>:</span> <span>[</span><span>]</span>
  <span>}</span><span>,</span>
  <span>28</span><span>:</span> <span>{</span>
    <span>id</span><span>:</span> <span>28</span><span>,</span>
    <span>title</span><span>:</span> <span>'France'</span><span>,</span>
    <span>childIds</span><span>:</span> <span>[</span><span>]</span>
  <span>}</span><span>,</span>
  <span>29</span><span>:</span> <span>{</span>
    <span>id</span><span>:</span> <span>29</span><span>,</span>
    <span>title</span><span>:</span> <span>'Germany'</span><span>,</span>
    <span>childIds</span><span>:</span> <span>[</span><span>]</span>
  <span>}</span><span>,</span>
  <span>30</span><span>:</span> <span>{</span>
    <span>id</span><span>:</span> <span>30</span><span>,</span>
    <span>title</span><span>:</span> <span>'Italy'</span><span>,</span>
    <span>childIds</span><span>:</span> <span>[</span><span>]</span>
  <span>}</span><span>,</span>
  <span>31</span><span>:</span> <span>{</span>
    <span>id</span><span>:</span> <span>31</span><span>,</span>
    <span>title</span><span>:</span> <span>'Portugal'</span><span>,</span>
    <span>childIds</span><span>:</span> <span>[</span><span>]</span>
  <span>}</span><span>,</span>
  <span>32</span><span>:</span> <span>{</span>
    <span>id</span><span>:</span> <span>32</span><span>,</span>
    <span>title</span><span>:</span> <span>'Spain'</span><span>,</span>
    <span>childIds</span><span>:</span> <span>[</span><span>]</span>
  <span>}</span><span>,</span>
  <span>33</span><span>:</span> <span>{</span>
    <span>id</span><span>:</span> <span>33</span><span>,</span>
    <span>title</span><span>:</span> <span>'Turkey'</span><span>,</span>
    <span>childIds</span><span>:</span> <span>[</span><span>]</span>
  <span>}</span><span>,</span>
  <span>34</span><span>:</span> <span>{</span>
    <span>id</span><span>:</span> <span>34</span><span>,</span>
    <span>title</span><span>:</span> <span>'Oceania'</span><span>,</span>
    <span>childIds</span><span>:</span> <span>[</span><span>35</span><span>,</span> <span>36</span><span>,</span> <span>37</span><span>,</span> <span>38</span><span>,</span> <span>39</span><span>,</span> <span>40</span><span>,</span> <span>41</span><span>]</span><span>,</span>   
  <span>}</span><span>,</span>
  <span>35</span><span>:</span> <span>{</span>
    <span>id</span><span>:</span> <span>35</span><span>,</span>
    <span>title</span><span>:</span> <span>'Australia'</span><span>,</span>
    <span>childIds</span><span>:</span> <span>[</span><span>]</span>
  <span>}</span><span>,</span>
  <span>36</span><span>:</span> <span>{</span>
    <span>id</span><span>:</span> <span>36</span><span>,</span>
    <span>title</span><span>:</span> <span>'Bora Bora (French Polynesia)'</span><span>,</span>
    <span>childIds</span><span>:</span> <span>[</span><span>]</span>
  <span>}</span><span>,</span>
  <span>37</span><span>:</span> <span>{</span>
    <span>id</span><span>:</span> <span>37</span><span>,</span>
    <span>title</span><span>:</span> <span>'Easter Island (Chile)'</span><span>,</span>
    <span>childIds</span><span>:</span> <span>[</span><span>]</span>
  <span>}</span><span>,</span>
  <span>38</span><span>:</span> <span>{</span>
    <span>id</span><span>:</span> <span>38</span><span>,</span>
    <span>title</span><span>:</span> <span>'Fiji'</span><span>,</span>
    <span>childIds</span><span>:</span> <span>[</span><span>]</span>
  <span>}</span><span>,</span>
  <span>39</span><span>:</span> <span>{</span>
    <span>id</span><span>:</span> <span>40</span><span>,</span>
    <span>title</span><span>:</span> <span>'Hawaii (the USA)'</span><span>,</span>
    <span>childIds</span><span>:</span> <span>[</span><span>]</span>
  <span>}</span><span>,</span>
  <span>40</span><span>:</span> <span>{</span>
    <span>id</span><span>:</span> <span>40</span><span>,</span>
    <span>title</span><span>:</span> <span>'New Zealand'</span><span>,</span>
    <span>childIds</span><span>:</span> <span>[</span><span>]</span>
  <span>}</span><span>,</span>
  <span>41</span><span>:</span> <span>{</span>
    <span>id</span><span>:</span> <span>41</span><span>,</span>
    <span>title</span><span>:</span> <span>'Vanuatu'</span><span>,</span>
    <span>childIds</span><span>:</span> <span>[</span><span>]</span>
  <span>}</span><span>,</span>
  <span>42</span><span>:</span> <span>{</span>
    <span>id</span><span>:</span> <span>42</span><span>,</span>
    <span>title</span><span>:</span> <span>'Moon'</span><span>,</span>
    <span>childIds</span><span>:</span> <span>[</span><span>43</span><span>,</span> <span>44</span><span>,</span> <span>45</span><span>]</span>
  <span>}</span><span>,</span>
  <span>43</span><span>:</span> <span>{</span>
    <span>id</span><span>:</span> <span>43</span><span>,</span>
    <span>title</span><span>:</span> <span>'Rheita'</span><span>,</span>
    <span>childIds</span><span>:</span> <span>[</span><span>]</span>
  <span>}</span><span>,</span>
  <span>44</span><span>:</span> <span>{</span>
    <span>id</span><span>:</span> <span>44</span><span>,</span>
    <span>title</span><span>:</span> <span>'Piccolomini'</span><span>,</span>
    <span>childIds</span><span>:</span> <span>[</span><span>]</span>
  <span>}</span><span>,</span>
  <span>45</span><span>:</span> <span>{</span>
    <span>id</span><span>:</span> <span>45</span><span>,</span>
    <span>title</span><span>:</span> <span>'Tycho'</span><span>,</span>
    <span>childIds</span><span>:</span> <span>[</span><span>]</span>
  <span>}</span><span>,</span>
  <span>46</span><span>:</span> <span>{</span>
    <span>id</span><span>:</span> <span>46</span><span>,</span>
    <span>title</span><span>:</span> <span>'Mars'</span><span>,</span>
    <span>childIds</span><span>:</span> <span>[</span><span>47</span><span>,</span> <span>48</span><span>]</span>
  <span>}</span><span>,</span>
  <span>47</span><span>:</span> <span>{</span>
    <span>id</span><span>:</span> <span>47</span><span>,</span>
    <span>title</span><span>:</span> <span>'Corn Town'</span><span>,</span>
    <span>childIds</span><span>:</span> <span>[</span><span>]</span>
  <span>}</span><span>,</span>
  <span>48</span><span>:</span> <span>{</span>
    <span>id</span><span>:</span> <span>48</span><span>,</span>
    <span>title</span><span>:</span> <span>'Green Hill'</span><span>,</span>
    <span>childIds</span><span>:</span> <span>[</span><span>]</span>
  <span>}</span>
<span>}</span><span>;</span>

</pre> <p><strong>Now that the state is “flat” (also known as “normalized”), updating nested items becomes easier.</strong></p> <p>In order to remove a place now, you only need to update two levels of state:</p> <ul> <li>The updated version of its <em>parent</em> place should exclude the removed ID from its <code dir="ltr">childIds</code> array.</li> <li>The updated version of the root “table” object should include the updated version of the parent place.</li> </ul> <p>Here is an example of how you could go about it:</p> 
<pre data-language="jsx"><span>import</span> <span>{</span> <span>useState</span> <span>}</span> <span>from</span> <span>'react'</span><span>;</span>
<span>import</span> <span>{</span> <span>initialTravelPlan</span> <span>}</span> <span>from</span> <span>'./places.js'</span><span>;</span>

<span>export</span> <span>default</span> <span>function</span> <span>TravelPlan</span><span>(</span><span>)</span> <span>{</span>
  <span>const</span> <span>[</span><span>plan</span><span>,</span> <span>setPlan</span><span>]</span> = <span>useState</span><span>(</span><span>initialTravelPlan</span><span>)</span><span>;</span>

  <span>function</span> <span>handleComplete</span><span>(</span><span>parentId</span><span>,</span> <span>childId</span><span>)</span> <span>{</span>
    <span>const</span> <span>parent</span> = <span>plan</span><span>[</span><span>parentId</span><span>]</span><span>;</span>
    <span>// Create a new version of the parent place</span>
    <span>// that doesn't include this child ID.</span>
    <span>const</span> <span>nextParent</span> = <span>{</span>
      <span>...</span><span>parent</span><span>,</span>
      <span>childIds</span><span>:</span> <span>parent</span>.<span>childIds</span>
        .<span>filter</span><span>(</span><span>id</span> <span>=&gt;</span> <span>id</span> !== <span>childId</span><span>)</span>
    <span>}</span><span>;</span>
    <span>// Update the root state object...</span>
    <span>setPlan</span><span>(</span><span>{</span>
      <span>...</span><span>plan</span><span>,</span>
      <span>// ...so that it has the updated parent.</span>
      <span>[</span><span>parentId</span><span>]</span><span>:</span> <span>nextParent</span>
    <span>}</span><span>)</span><span>;</span>
  <span>}</span>

  <span>const</span> <span>root</span> = <span>plan</span><span>[</span><span>0</span><span>]</span><span>;</span>
  <span>const</span> <span>planetIds</span> = <span>root</span>.<span>childIds</span><span>;</span>
  <span>return</span> <span>(</span>
    <span>&lt;</span><span>&gt;</span>
      <span>&lt;</span><span>h2</span><span>&gt;</span>Places to visit<span>&lt;/</span><span>h2</span><span>&gt;</span>
      <span>&lt;</span><span>ol</span><span>&gt;</span>
        <span>{</span><span>planetIds</span>.<span>map</span><span>(</span><span>id</span> <span>=&gt;</span> <span>(</span>
          <span>&lt;</span><span>PlaceTree</span>
            <span>key</span>=<span>{</span><span>id</span><span>}</span>
            <span>id</span>=<span>{</span><span>id</span><span>}</span>
            <span>parentId</span>=<span>{</span><span>0</span><span>}</span>
            <span>placesById</span>=<span>{</span><span>plan</span><span>}</span>
            <span>onComplete</span>=<span>{</span><span>handleComplete</span><span>}</span>
          <span>/&gt;</span>
        <span>)</span><span>)</span><span>}</span>
      <span>&lt;/</span><span>ol</span><span>&gt;</span>
    <span>&lt;/</span><span>&gt;</span>
  <span>)</span><span>;</span>
<span>}</span>

<span>function</span> <span>PlaceTree</span><span>(</span><span>{</span> <span>id</span><span>,</span> <span>parentId</span><span>,</span> <span>placesById</span><span>,</span> <span>onComplete</span> <span>}</span><span>)</span> <span>{</span>
  <span>const</span> <span>place</span> = <span>placesById</span><span>[</span><span>id</span><span>]</span><span>;</span>
  <span>const</span> <span>childIds</span> = <span>place</span>.<span>childIds</span><span>;</span>
  <span>return</span> <span>(</span>
    <span>&lt;</span><span>li</span><span>&gt;</span>
      <span>{</span><span>place</span>.<span>title</span><span>}</span>
      <span>&lt;</span><span>button</span> <span>onClick</span>=<span>{</span><span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
        <span>onComplete</span><span>(</span><span>parentId</span><span>,</span> <span>id</span><span>)</span><span>;</span>
      <span>}</span><span>}</span><span>&gt;</span>
        Complete
      <span>&lt;/</span><span>button</span><span>&gt;</span>
      <span>{</span><span>childIds</span>.<span>length</span> &gt; <span>0</span> &amp;&amp;
        <span>&lt;</span><span>ol</span><span>&gt;</span>
          <span>{</span><span>childIds</span>.<span>map</span><span>(</span><span>childId</span> <span>=&gt;</span> <span>(</span>
            <span>&lt;</span><span>PlaceTree</span>
              <span>key</span>=<span>{</span><span>childId</span><span>}</span>
              <span>id</span>=<span>{</span><span>childId</span><span>}</span>
              <span>parentId</span>=<span>{</span><span>id</span><span>}</span>
              <span>placesById</span>=<span>{</span><span>placesById</span><span>}</span>
              <span>onComplete</span>=<span>{</span><span>onComplete</span><span>}</span>
            <span>/&gt;</span>
          <span>)</span><span>)</span><span>}</span>
        <span>&lt;/</span><span>ol</span><span>&gt;</span>
      <span>}</span>
    <span>&lt;/</span><span>li</span><span>&gt;</span>
  <span>)</span><span>;</span>
<span>}</span>

</pre> <p>You can nest state as much as you like, but making it “flat” can solve numerous problems. It makes state easier to update, and it helps ensure you don’t have duplication in different parts of a nested object.</p> <details class="note note-blue"><summary tabindex="-1"><h5>
Deep Dive</h5>
<h4 id="improving-memory-usage">Improving memory usage 
</h4></summary><div>
<p>Ideally, you would also remove the deleted items (and their children!) from the “table” object to improve memory usage. This version does that. It also <a href="updating-objects-in-state.html#write-concise-update-logic-with-immer">uses Immer</a> to make the update logic more concise.</p>

<pre data-language="jsx"><span>{</span>
  <span>"dependencies"</span><span>:</span> <span>{</span>
    <span>"immer"</span><span>:</span> <span>"1.7.3"</span><span>,</span>
    <span>"react"</span><span>:</span> <span>"latest"</span><span>,</span>
    <span>"react-dom"</span><span>:</span> <span>"latest"</span><span>,</span>
    <span>"react-scripts"</span><span>:</span> <span>"latest"</span><span>,</span>
    <span>"use-immer"</span><span>:</span> <span>"0.5.1"</span>
  <span>}</span><span>,</span>
  <span>"scripts"</span><span>:</span> <span>{</span>
    <span>"start"</span><span>:</span> <span>"react-scripts start"</span><span>,</span>
    <span>"build"</span><span>:</span> <span>"react-scripts build"</span><span>,</span>
    <span>"test"</span><span>:</span> <span>"react-scripts test --env=jsdom"</span><span>,</span>
    <span>"eject"</span><span>:</span> <span>"react-scripts eject"</span>
  <span>}</span><span>,</span>
  <span>"devDependencies"</span><span>:</span> <span>{</span><span>}</span>
<span>}</span></pre>
</div></details> <p>Sometimes, you can also reduce state nesting by moving some of the nested state into the child components. This works well for ephemeral UI state that doesn’t need to be stored, like whether an item is hovered.</p> <section><h2 id="recap">Recap
</h2>
<ul> <li>If two state variables always update together, consider merging them into one.</li> <li>Choose your state variables carefully to avoid creating “impossible” states.</li> <li>Structure your state in a way that reduces the chances that you’ll make a mistake updating it.</li> <li>Avoid redundant and duplicate state so that you don’t need to keep it in sync.</li> <li>Don’t put props <em>into</em> state unless you specifically want to prevent updates.</li> <li>For UI patterns like selection, keep ID or index in state instead of the object itself.</li> <li>If updating deeply nested state is complicated, try flattening it.</li> </ul></section> <div class="note">
<h4>Try out some challenges</h4>

<div>
<h4 id="fix-a-component-thats-not-updating">
<div>Challenge 1 of 4<span>: </span>
</div>Fix a component that’s not updating 
</h4>
<p>This <code dir="ltr">Clock</code> component receives two props: <code dir="ltr">color</code> and <code dir="ltr">time</code>. When you select a different color in the select box, the <code dir="ltr">Clock</code> component receives a different <code dir="ltr">color</code> prop from its parent component. However, for some reason, the displayed color doesn’t update. Why? Fix the problem.</p>

<pre data-language="jsx"><span>import</span> <span>{</span> <span>useState</span> <span>}</span> <span>from</span> <span>'react'</span><span>;</span>

<span>export</span> <span>default</span> <span>function</span> <span>Clock</span><span>(</span><span>props</span><span>)</span> <span>{</span>
  <span>const</span> <span>[</span><span>color</span><span>,</span> <span>setColor</span><span>]</span> = <span>useState</span><span>(</span><span>props</span>.<span>color</span><span>)</span><span>;</span>
  <span>return</span> <span>(</span>
    <span>&lt;</span><span>h1</span> <span>style</span>=<span>{</span><span>{</span> <span>color</span><span>:</span> <span>color</span> <span>}</span><span>}</span><span>&gt;</span>
      <span>{</span><span>props</span>.<span>time</span><span>}</span>
    <span>&lt;/</span><span>h1</span><span>&gt;</span>
  <span>)</span><span>;</span>
<span>}</span>

</pre>
</div>

</div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2013&ndash;present Facebook Inc.<br>Licensed under the Creative Commons Attribution 4.0 International Public License.<br>
    <a href="https://react.dev/learn/choosing-the-state-structure" class="_attribution-link">https://react.dev/learn/choosing-the-state-structure</a>
  </p>
</div>
