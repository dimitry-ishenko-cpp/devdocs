<h1>Escape Hatches
</h1>
<div><span><span>Advanced</span></span></div>
<div><p>Some of your components may need to control and synchronize with systems outside of React. For example, you might need to focus an input using the browser API, play and pause a video player implemented without React, or connect and listen to messages from a remote server. In this chapter, you’ll learn the escape hatches that let you “step outside” React and connect to external systems. Most of your application logic and data flow should not rely on these features.</p></div> <div class="note">
<h4>In this chapter</h4>
<ul> <li><a href="referencing-values-with-refs.html">How to “remember” information without re-rendering</a></li> <li><a href="manipulating-the-dom-with-refs.html">How to access DOM elements managed by React</a></li> <li><a href="synchronizing-with-effects.html">How to synchronize components with external systems</a></li> <li><a href="you-might-not-need-an-effect.html">How to remove unnecessary Effects from your components</a></li> <li><a href="lifecycle-of-reactive-effects.html">How an Effect’s lifecycle is different from a component’s</a></li> <li><a href="separating-events-from-effects.html">How to prevent some values from re-triggering Effects</a></li> <li><a href="removing-effect-dependencies.html">How to make your Effect re-run less often</a></li> <li><a href="reusing-logic-with-custom-hooks.html">How to share logic between components</a></li> </ul>
</div> <h2 id="referencing-values-with-refs">Referencing values with refs 
</h2> <p>When you want a component to “remember” some information, but you don’t want that information to <a href="render-and-commit.html">trigger new renders</a>, you can use a <em>ref</em>:</p> <pre data-language="jsx"><code><span>const</span> <span>ref</span> = <span>useRef</span><span>(</span><span>0</span><span>)</span><span>;</span></code></pre> <p>Like state, refs are retained by React between re-renders. However, setting state re-renders a component. Changing a ref does not! You can access the current value of that ref through the <code dir="ltr">ref.current</code> property.</p> 
<pre data-language="jsx"><span>import</span> <span>{</span> <span>useRef</span> <span>}</span> <span>from</span> <span>'react'</span><span>;</span>

<span>export</span> <span>default</span> <span>function</span> <span>Counter</span><span>(</span><span>)</span> <span>{</span>
  <span>let</span> <span>ref</span> = <span>useRef</span><span>(</span><span>0</span><span>)</span><span>;</span>

  <span>function</span> <span>handleClick</span><span>(</span><span>)</span> <span>{</span>
    <span>ref</span>.<span>current</span> = <span>ref</span>.<span>current</span> + <span>1</span><span>;</span>
    <span>alert</span><span>(</span><span>'You clicked '</span> + <span>ref</span>.<span>current</span> + <span>' times!'</span><span>)</span><span>;</span>
  <span>}</span>

  <span>return</span> <span>(</span>
    <span>&lt;</span><span>button</span> <span>onClick</span>=<span>{</span><span>handleClick</span><span>}</span><span>&gt;</span>
      Click me!
    <span>&lt;/</span><span>button</span><span>&gt;</span>
  <span>)</span><span>;</span>
<span>}</span>

</pre> <p>A ref is like a secret pocket of your component that React doesn’t track. For example, you can use refs to store <a href="https://developer.mozilla.org/en-US/docs/Web/API/setTimeout#return_value" target="_blank" rel="nofollow noopener noreferrer">timeout IDs</a>, <a href="https://developer.mozilla.org/en-US/docs/Web/API/Element" target="_blank" rel="nofollow noopener noreferrer">DOM elements</a>, and other objects that don’t impact the component’s rendering output.</p> <section class="note"><div>
<h4>Ready to learn this topic?</h4>
<p>Read <strong><a href="referencing-values-with-refs.html">Referencing Values with Refs</a></strong> to learn how to use refs to remember information.</p>
<a aria-label="Read More" target="_self" href="referencing-values-with-refs.html">Read More</a>
</div></section><hr> <h2 id="manipulating-the-dom-with-refs">Manipulating the DOM with refs 
</h2> <p>React automatically updates the DOM to match your render output, so your components won’t often need to manipulate it. However, sometimes you might need access to the DOM elements managed by React—for example, to focus a node, scroll to it, or measure its size and position. There is no built-in way to do those things in React, so you will need a ref to the DOM node. For example, clicking the button will focus the input using a ref:</p> 
<pre data-language="jsx"><span>import</span> <span>{</span> <span>useRef</span> <span>}</span> <span>from</span> <span>'react'</span><span>;</span>

<span>export</span> <span>default</span> <span>function</span> <span>Form</span><span>(</span><span>)</span> <span>{</span>
  <span>const</span> <span>inputRef</span> = <span>useRef</span><span>(</span><span>null</span><span>)</span><span>;</span>

  <span>function</span> <span>handleClick</span><span>(</span><span>)</span> <span>{</span>
    <span>inputRef</span>.<span>current</span>.<span>focus</span><span>(</span><span>)</span><span>;</span>
  <span>}</span>

  <span>return</span> <span>(</span>
    <span>&lt;</span><span>&gt;</span>
      <span>&lt;</span><span>input</span> <span>ref</span>=<span>{</span><span>inputRef</span><span>}</span> <span>/&gt;</span>
      <span>&lt;</span><span>button</span> <span>onClick</span>=<span>{</span><span>handleClick</span><span>}</span><span>&gt;</span>
        Focus the input
      <span>&lt;/</span><span>button</span><span>&gt;</span>
    <span>&lt;/</span><span>&gt;</span>
  <span>)</span><span>;</span>
<span>}</span>

</pre> <section class="note"><div>
<h4>Ready to learn this topic?</h4>
<p>Read <strong><a href="manipulating-the-dom-with-refs.html">Manipulating the DOM with Refs</a></strong> to learn how to access DOM elements managed by React.</p>
<a aria-label="Read More" target="_self" href="manipulating-the-dom-with-refs.html">Read More</a>
</div></section><hr> <h2 id="synchronizing-with-effects">Synchronizing with Effects 
</h2> <p>Some components need to synchronize with external systems. For example, you might want to control a non-React component based on the React state, set up a server connection, or send an analytics log when a component appears on the screen. Unlike event handlers, which let you handle particular events, <em>Effects</em> let you run some code after rendering. Use them to synchronize your component with a system outside of React.</p> <p>Press Play/Pause a few times and see how the video player stays synchronized to the <code dir="ltr">isPlaying</code> prop value:</p> 
<pre data-language="jsx"><span>import</span> <span>{</span> <span>useState</span><span>,</span> <span>useRef</span><span>,</span> <span>useEffect</span> <span>}</span> <span>from</span> <span>'react'</span><span>;</span>

<span>function</span> <span>VideoPlayer</span><span>(</span><span>{</span> <span>src</span><span>,</span> <span>isPlaying</span> <span>}</span><span>)</span> <span>{</span>
  <span>const</span> <span>ref</span> = <span>useRef</span><span>(</span><span>null</span><span>)</span><span>;</span>

  <span>useEffect</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
    <span>if</span> <span>(</span><span>isPlaying</span><span>)</span> <span>{</span>
      <span>ref</span>.<span>current</span>.<span>play</span><span>(</span><span>)</span><span>;</span>
    <span>}</span> <span>else</span> <span>{</span>
      <span>ref</span>.<span>current</span>.<span>pause</span><span>(</span><span>)</span><span>;</span>
    <span>}</span>
  <span>}</span><span>,</span> <span>[</span><span>isPlaying</span><span>]</span><span>)</span><span>;</span>

  <span>return</span> <span>&lt;</span><span>video</span> <span>ref</span>=<span>{</span><span>ref</span><span>}</span> <span>src</span>=<span>{</span><span>src</span><span>}</span> <span>loop</span> <span>playsInline</span> <span>/&gt;</span><span>;</span>
<span>}</span>

<span>export</span> <span>default</span> <span>function</span> <span>App</span><span>(</span><span>)</span> <span>{</span>
  <span>const</span> <span>[</span><span>isPlaying</span><span>,</span> <span>setIsPlaying</span><span>]</span> = <span>useState</span><span>(</span><span>false</span><span>)</span><span>;</span>
  <span>return</span> <span>(</span>
    <span>&lt;</span><span>&gt;</span>
      <span>&lt;</span><span>button</span> <span>onClick</span>=<span>{</span><span>(</span><span>)</span> <span>=&gt;</span> <span>setIsPlaying</span><span>(</span>!<span>isPlaying</span><span>)</span><span>}</span><span>&gt;</span>
        <span>{</span><span>isPlaying</span> ? <span>'Pause'</span> : <span>'Play'</span><span>}</span>
      <span>&lt;/</span><span>button</span><span>&gt;</span>
      <span>&lt;</span><span>VideoPlayer</span>
        <span>isPlaying</span>=<span>{</span><span>isPlaying</span><span>}</span>
        <span>src</span>=<span>"https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4"</span>
      <span>/&gt;</span>
    <span>&lt;/</span><span>&gt;</span>
  <span>)</span><span>;</span>
<span>}</span>

</pre> <p>Many Effects also “clean up” after themselves. For example, an Effect that sets up a connection to a chat server should return a <em>cleanup function</em> that tells React how to disconnect your component from that server:</p> 
<pre data-language="jsx"><span>import</span> <span>{</span> <span>useState</span><span>,</span> <span>useEffect</span> <span>}</span> <span>from</span> <span>'react'</span><span>;</span>
<span>import</span> <span>{</span> <span>createConnection</span> <span>}</span> <span>from</span> <span>'./chat.js'</span><span>;</span>

<span>export</span> <span>default</span> <span>function</span> <span>ChatRoom</span><span>(</span><span>)</span> <span>{</span>
  <span>useEffect</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
    <span>const</span> <span>connection</span> = <span>createConnection</span><span>(</span><span>)</span><span>;</span>
    <span>connection</span>.<span>connect</span><span>(</span><span>)</span><span>;</span>
    <span>return</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>connection</span>.<span>disconnect</span><span>(</span><span>)</span><span>;</span>
  <span>}</span><span>,</span> <span>[</span><span>]</span><span>)</span><span>;</span>
  <span>return</span> <span>&lt;</span><span>h1</span><span>&gt;</span>Welcome to the chat!<span>&lt;/</span><span>h1</span><span>&gt;</span><span>;</span>
<span>}</span>

</pre> <p>In development, React will immediately run and clean up your Effect one extra time. This is why you see <code dir="ltr">"✅ Connecting..."</code> printed twice. This ensures that you don’t forget to implement the cleanup function.</p> <section class="note"><div>
<h4>Ready to learn this topic?</h4>
<p>Read <strong><a href="synchronizing-with-effects.html">Synchronizing with Effects</a></strong> to learn how to synchronize components with external systems.</p>
<a aria-label="Read More" target="_self" href="synchronizing-with-effects.html">Read More</a>
</div></section><hr> <h2 id="you-might-not-need-an-effect">You Might Not Need An Effect 
</h2> <p>Effects are an escape hatch from the React paradigm. They let you “step outside” of React and synchronize your components with some external system. If there is no external system involved (for example, if you want to update a component’s state when some props or state change), you shouldn’t need an Effect. Removing unnecessary Effects will make your code easier to follow, faster to run, and less error-prone.</p> <p>There are two common cases in which you don’t need Effects:</p> <ul> <li><strong>You don’t need Effects to transform data for rendering.</strong></li> <li><strong>You don’t need Effects to handle user events.</strong></li> </ul> <p>For example, you don’t need an Effect to adjust some state based on other state:</p> <pre data-language="jsx"><code><span>function</span> <span>Form</span><span>(</span><span>)</span> <span>{</span>
  <span>const</span> <span>[</span><span>firstName</span><span>,</span> <span>setFirstName</span><span>]</span> = <span>useState</span><span>(</span><span>'Taylor'</span><span>)</span><span>;</span>
  <span>const</span> <span>[</span><span>lastName</span><span>,</span> <span>setLastName</span><span>]</span> = <span>useState</span><span>(</span><span>'Swift'</span><span>)</span><span>;</span>

  <span>// 🔴 Avoid: redundant state and unnecessary Effect</span>
  <span>const</span> <span>[</span><span>fullName</span><span>,</span> <span>setFullName</span><span>]</span> = <span>useState</span><span>(</span><span>''</span><span>)</span><span>;</span>
  <span>useEffect</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
    <span>setFullName</span><span>(</span><span>firstName</span> + <span>' '</span> + <span>lastName</span><span>)</span><span>;</span>
  <span>}</span><span>,</span> <span>[</span><span>firstName</span><span>,</span> <span>lastName</span><span>]</span><span>)</span><span>;</span>
  <span>// ...</span>
<span>}</span></code></pre> <p>Instead, calculate as much as you can while rendering:</p> <pre data-language="jsx"><code><span>function</span> <span>Form</span><span>(</span><span>)</span> <span>{</span>
  <span>const</span> <span>[</span><span>firstName</span><span>,</span> <span>setFirstName</span><span>]</span> = <span>useState</span><span>(</span><span>'Taylor'</span><span>)</span><span>;</span>
  <span>const</span> <span>[</span><span>lastName</span><span>,</span> <span>setLastName</span><span>]</span> = <span>useState</span><span>(</span><span>'Swift'</span><span>)</span><span>;</span>
  <span>// ✅ Good: calculated during rendering</span>
  <span>const</span> <span>fullName</span> = <span>firstName</span> + <span>' '</span> + <span>lastName</span><span>;</span>
  <span>// ...</span>
<span>}</span></code></pre> <p>However, you <em>do</em> need Effects to synchronize with external systems.</p> <section class="note"><div>
<h4>Ready to learn this topic?</h4>
<p>Read <strong><a href="you-might-not-need-an-effect.html">You Might Not Need an Effect</a></strong> to learn how to remove unnecessary Effects.</p>
<a aria-label="Read More" target="_self" href="you-might-not-need-an-effect.html">Read More</a>
</div></section><hr> <h2 id="lifecycle-of-reactive-effects">Lifecycle of reactive effects 
</h2> <p>Effects have a different lifecycle from components. Components may mount, update, or unmount. An Effect can only do two things: to start synchronizing something, and later to stop synchronizing it. This cycle can happen multiple times if your Effect depends on props and state that change over time.</p> <p>This Effect depends on the value of the <code dir="ltr">roomId</code> prop. Props are <em>reactive values,</em> which means they can change on a re-render. Notice that the Effect <em>re-synchronizes</em> (and re-connects to the server) if <code dir="ltr">roomId</code> changes:</p> 
<pre data-language="jsx"><span>import</span> <span>{</span> <span>useState</span><span>,</span> <span>useEffect</span> <span>}</span> <span>from</span> <span>'react'</span><span>;</span>
<span>import</span> <span>{</span> <span>createConnection</span> <span>}</span> <span>from</span> <span>'./chat.js'</span><span>;</span>

<span>const</span> <span>serverUrl</span> = <span>'https://localhost:1234'</span><span>;</span>

<span>function</span> <span>ChatRoom</span><span>(</span><span>{</span> <span>roomId</span> <span>}</span><span>)</span> <span>{</span>
  <span>useEffect</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
    <span>const</span> <span>connection</span> = <span>createConnection</span><span>(</span><span>serverUrl</span><span>,</span> <span>roomId</span><span>)</span><span>;</span>
    <span>connection</span>.<span>connect</span><span>(</span><span>)</span><span>;</span>
    <span>return</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>connection</span>.<span>disconnect</span><span>(</span><span>)</span><span>;</span>
  <span>}</span><span>,</span> <span>[</span><span>roomId</span><span>]</span><span>)</span><span>;</span>

  <span>return</span> <span>&lt;</span><span>h1</span><span>&gt;</span>Welcome to the <span>{</span><span>roomId</span><span>}</span> room!<span>&lt;/</span><span>h1</span><span>&gt;</span><span>;</span>
<span>}</span>

<span>export</span> <span>default</span> <span>function</span> <span>App</span><span>(</span><span>)</span> <span>{</span>
  <span>const</span> <span>[</span><span>roomId</span><span>,</span> <span>setRoomId</span><span>]</span> = <span>useState</span><span>(</span><span>'general'</span><span>)</span><span>;</span>
  <span>return</span> <span>(</span>
    <span>&lt;</span><span>&gt;</span>
      <span>&lt;</span><span>label</span><span>&gt;</span>
        Choose the chat room:<span>{</span><span>' '</span><span>}</span>
        <span>&lt;</span><span>select</span>
          <span>value</span>=<span>{</span><span>roomId</span><span>}</span>
          <span>onChange</span>=<span>{</span><span>e</span> <span>=&gt;</span> <span>setRoomId</span><span>(</span><span>e</span>.<span>target</span>.<span>value</span><span>)</span><span>}</span>
        <span>&gt;</span>
          <span>&lt;</span><span>option</span> <span>value</span>=<span>"general"</span><span>&gt;</span>general<span>&lt;/</span><span>option</span><span>&gt;</span>
          <span>&lt;</span><span>option</span> <span>value</span>=<span>"travel"</span><span>&gt;</span>travel<span>&lt;/</span><span>option</span><span>&gt;</span>
          <span>&lt;</span><span>option</span> <span>value</span>=<span>"music"</span><span>&gt;</span>music<span>&lt;/</span><span>option</span><span>&gt;</span>
        <span>&lt;/</span><span>select</span><span>&gt;</span>
      <span>&lt;/</span><span>label</span><span>&gt;</span>
      <span>&lt;</span><span>hr</span> <span>/&gt;</span>
      <span>&lt;</span><span>ChatRoom</span> <span>roomId</span>=<span>{</span><span>roomId</span><span>}</span> <span>/&gt;</span>
    <span>&lt;/</span><span>&gt;</span>
  <span>)</span><span>;</span>
<span>}</span>

</pre> <p>React provides a linter rule to check that you’ve specified your Effect’s dependencies correctly. If you forget to specify <code dir="ltr">roomId</code> in the list of dependencies in the above example, the linter will find that bug automatically.</p> <section class="note"><div>
<h4>Ready to learn this topic?</h4>
<p>Read <strong><a href="lifecycle-of-reactive-effects.html">Lifecycle of Reactive Events</a></strong> to learn how an Effect’s lifecycle is different from a component’s.</p>
<a aria-label="Read More" target="_self" href="lifecycle-of-reactive-effects.html">Read More</a>
</div></section><hr> <h2 id="separating-events-from-effects">Separating events from Effects 
</h2> <div class="note note-orange">
<h4>Under Construction</h4>
<div><p>This section describes an <strong>experimental API that has not yet been released</strong> in a stable version of React.</p></div>
</div> <p>Event handlers only re-run when you perform the same interaction again. Unlike event handlers, Effects re-synchronize if any of the values they read, like props or state, are different than during last render. Sometimes, you want a mix of both behaviors: an Effect that re-runs in response to some values but not others.</p> <p>All code inside Effects is <em>reactive.</em> It will run again if some reactive value it reads has changed due to a re-render. For example, this Effect will re-connect to the chat if either <code dir="ltr">roomId</code> or <code dir="ltr">theme</code> have changed:</p> 
<pre data-language="jsx"><span>import</span> <span>{</span> <span>useState</span><span>,</span> <span>useEffect</span> <span>}</span> <span>from</span> <span>'react'</span><span>;</span>
<span>import</span> <span>{</span> <span>createConnection</span><span>,</span> <span>sendMessage</span> <span>}</span> <span>from</span> <span>'./chat.js'</span><span>;</span>
<span>import</span> <span>{</span> <span>showNotification</span> <span>}</span> <span>from</span> <span>'./notifications.js'</span><span>;</span>

<span>const</span> <span>serverUrl</span> = <span>'https://localhost:1234'</span><span>;</span>

<span>function</span> <span>ChatRoom</span><span>(</span><span>{</span> <span>roomId</span><span>,</span> <span>theme</span> <span>}</span><span>)</span> <span>{</span>
  <span>useEffect</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
    <span>const</span> <span>connection</span> = <span>createConnection</span><span>(</span><span>serverUrl</span><span>,</span> <span>roomId</span><span>)</span><span>;</span>
    <span>connection</span>.<span>on</span><span>(</span><span>'connected'</span><span>,</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
      <span>showNotification</span><span>(</span><span>'Connected!'</span><span>,</span> <span>theme</span><span>)</span><span>;</span>
    <span>}</span><span>)</span><span>;</span>
    <span>connection</span>.<span>connect</span><span>(</span><span>)</span><span>;</span>
    <span>return</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>connection</span>.<span>disconnect</span><span>(</span><span>)</span><span>;</span>
  <span>}</span><span>,</span> <span>[</span><span>roomId</span><span>,</span> <span>theme</span><span>]</span><span>)</span><span>;</span>

  <span>return</span> <span>&lt;</span><span>h1</span><span>&gt;</span>Welcome to the <span>{</span><span>roomId</span><span>}</span> room!<span>&lt;/</span><span>h1</span><span>&gt;</span>
<span>}</span>

<span>export</span> <span>default</span> <span>function</span> <span>App</span><span>(</span><span>)</span> <span>{</span>
  <span>const</span> <span>[</span><span>roomId</span><span>,</span> <span>setRoomId</span><span>]</span> = <span>useState</span><span>(</span><span>'general'</span><span>)</span><span>;</span>
  <span>const</span> <span>[</span><span>isDark</span><span>,</span> <span>setIsDark</span><span>]</span> = <span>useState</span><span>(</span><span>false</span><span>)</span><span>;</span>
  <span>return</span> <span>(</span>
    <span>&lt;</span><span>&gt;</span>
      <span>&lt;</span><span>label</span><span>&gt;</span>
        Choose the chat room:<span>{</span><span>' '</span><span>}</span>
        <span>&lt;</span><span>select</span>
          <span>value</span>=<span>{</span><span>roomId</span><span>}</span>
          <span>onChange</span>=<span>{</span><span>e</span> <span>=&gt;</span> <span>setRoomId</span><span>(</span><span>e</span>.<span>target</span>.<span>value</span><span>)</span><span>}</span>
        <span>&gt;</span>
          <span>&lt;</span><span>option</span> <span>value</span>=<span>"general"</span><span>&gt;</span>general<span>&lt;/</span><span>option</span><span>&gt;</span>
          <span>&lt;</span><span>option</span> <span>value</span>=<span>"travel"</span><span>&gt;</span>travel<span>&lt;/</span><span>option</span><span>&gt;</span>
          <span>&lt;</span><span>option</span> <span>value</span>=<span>"music"</span><span>&gt;</span>music<span>&lt;/</span><span>option</span><span>&gt;</span>
        <span>&lt;/</span><span>select</span><span>&gt;</span>
      <span>&lt;/</span><span>label</span><span>&gt;</span>
      <span>&lt;</span><span>label</span><span>&gt;</span>
        <span>&lt;</span><span>input</span>
          <span>type</span>=<span>"checkbox"</span>
          <span>checked</span>=<span>{</span><span>isDark</span><span>}</span>
          <span>onChange</span>=<span>{</span><span>e</span> <span>=&gt;</span> <span>setIsDark</span><span>(</span><span>e</span>.<span>target</span>.<span>checked</span><span>)</span><span>}</span>
        <span>/&gt;</span>
        Use dark theme
      <span>&lt;/</span><span>label</span><span>&gt;</span>
      <span>&lt;</span><span>hr</span> <span>/&gt;</span>
      <span>&lt;</span><span>ChatRoom</span>
        <span>roomId</span>=<span>{</span><span>roomId</span><span>}</span>
        <span>theme</span>=<span>{</span><span>isDark</span> ? <span>'dark'</span> : <span>'light'</span><span>}</span> 
      <span>/&gt;</span>
    <span>&lt;/</span><span>&gt;</span>
  <span>)</span><span>;</span>
<span>}</span>

</pre> <p>This is not ideal. You want to re-connect to the chat only if the <code dir="ltr">roomId</code> has changed. Switching the <code dir="ltr">theme</code> shouldn’t re-connect to the chat! Move the code reading <code dir="ltr">theme</code> out of your Effect into an <em>Effect Event</em>:</p> 
<pre data-language="jsx"><span>import</span> <span>{</span> <span>useState</span><span>,</span> <span>useEffect</span> <span>}</span> <span>from</span> <span>'react'</span><span>;</span>
<span>import</span> <span>{</span> <span>experimental_useEffectEvent</span> <span>as</span> <span>useEffectEvent</span> <span>}</span> <span>from</span> <span>'react'</span><span>;</span>
<span>import</span> <span>{</span> <span>createConnection</span><span>,</span> <span>sendMessage</span> <span>}</span> <span>from</span> <span>'./chat.js'</span><span>;</span>
<span>import</span> <span>{</span> <span>showNotification</span> <span>}</span> <span>from</span> <span>'./notifications.js'</span><span>;</span>

<span>const</span> <span>serverUrl</span> = <span>'https://localhost:1234'</span><span>;</span>

<span>function</span> <span>ChatRoom</span><span>(</span><span>{</span> <span>roomId</span><span>,</span> <span>theme</span> <span>}</span><span>)</span> <span>{</span>
  <span>const</span> <span>onConnected</span> = <span>useEffectEvent</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
    <span>showNotification</span><span>(</span><span>'Connected!'</span><span>,</span> <span>theme</span><span>)</span><span>;</span>
  <span>}</span><span>)</span><span>;</span>

  <span>useEffect</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
    <span>const</span> <span>connection</span> = <span>createConnection</span><span>(</span><span>serverUrl</span><span>,</span> <span>roomId</span><span>)</span><span>;</span>
    <span>connection</span>.<span>on</span><span>(</span><span>'connected'</span><span>,</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
      <span>onConnected</span><span>(</span><span>)</span><span>;</span>
    <span>}</span><span>)</span><span>;</span>
    <span>connection</span>.<span>connect</span><span>(</span><span>)</span><span>;</span>
    <span>return</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>connection</span>.<span>disconnect</span><span>(</span><span>)</span><span>;</span>
  <span>}</span><span>,</span> <span>[</span><span>roomId</span><span>]</span><span>)</span><span>;</span>

  <span>return</span> <span>&lt;</span><span>h1</span><span>&gt;</span>Welcome to the <span>{</span><span>roomId</span><span>}</span> room!<span>&lt;/</span><span>h1</span><span>&gt;</span>
<span>}</span>

<span>export</span> <span>default</span> <span>function</span> <span>App</span><span>(</span><span>)</span> <span>{</span>
  <span>const</span> <span>[</span><span>roomId</span><span>,</span> <span>setRoomId</span><span>]</span> = <span>useState</span><span>(</span><span>'general'</span><span>)</span><span>;</span>
  <span>const</span> <span>[</span><span>isDark</span><span>,</span> <span>setIsDark</span><span>]</span> = <span>useState</span><span>(</span><span>false</span><span>)</span><span>;</span>
  <span>return</span> <span>(</span>
    <span>&lt;</span><span>&gt;</span>
      <span>&lt;</span><span>label</span><span>&gt;</span>
        Choose the chat room:<span>{</span><span>' '</span><span>}</span>
        <span>&lt;</span><span>select</span>
          <span>value</span>=<span>{</span><span>roomId</span><span>}</span>
          <span>onChange</span>=<span>{</span><span>e</span> <span>=&gt;</span> <span>setRoomId</span><span>(</span><span>e</span>.<span>target</span>.<span>value</span><span>)</span><span>}</span>
        <span>&gt;</span>
          <span>&lt;</span><span>option</span> <span>value</span>=<span>"general"</span><span>&gt;</span>general<span>&lt;/</span><span>option</span><span>&gt;</span>
          <span>&lt;</span><span>option</span> <span>value</span>=<span>"travel"</span><span>&gt;</span>travel<span>&lt;/</span><span>option</span><span>&gt;</span>
          <span>&lt;</span><span>option</span> <span>value</span>=<span>"music"</span><span>&gt;</span>music<span>&lt;/</span><span>option</span><span>&gt;</span>
        <span>&lt;/</span><span>select</span><span>&gt;</span>
      <span>&lt;/</span><span>label</span><span>&gt;</span>
      <span>&lt;</span><span>label</span><span>&gt;</span>
        <span>&lt;</span><span>input</span>
          <span>type</span>=<span>"checkbox"</span>
          <span>checked</span>=<span>{</span><span>isDark</span><span>}</span>
          <span>onChange</span>=<span>{</span><span>e</span> <span>=&gt;</span> <span>setIsDark</span><span>(</span><span>e</span>.<span>target</span>.<span>checked</span><span>)</span><span>}</span>
        <span>/&gt;</span>
        Use dark theme
      <span>&lt;/</span><span>label</span><span>&gt;</span>
      <span>&lt;</span><span>hr</span> <span>/&gt;</span>
      <span>&lt;</span><span>ChatRoom</span>
        <span>roomId</span>=<span>{</span><span>roomId</span><span>}</span>
        <span>theme</span>=<span>{</span><span>isDark</span> ? <span>'dark'</span> : <span>'light'</span><span>}</span> 
      <span>/&gt;</span>
    <span>&lt;/</span><span>&gt;</span>
  <span>)</span><span>;</span>
<span>}</span>

</pre> <p>Code inside Effect Events isn’t reactive, so changing the <code dir="ltr">theme</code> no longer makes your Effect re-connect.</p> <section class="note"><div>
<h4>Ready to learn this topic?</h4>
<p>Read <strong><a href="separating-events-from-effects.html">Separating Events from Effects</a></strong> to learn how to prevent some values from re-triggering Effects.</p>
<a aria-label="Read More" target="_self" href="separating-events-from-effects.html">Read More</a>
</div></section><hr> <h2 id="removing-effect-dependencies">Removing Effect dependencies 
</h2> <p>When you write an Effect, the linter will verify that you’ve included every reactive value (like props and state) that the Effect reads in the list of your Effect’s dependencies. This ensures that your Effect remains synchronized with the latest props and state of your component. Unnecessary dependencies may cause your Effect to run too often, or even create an infinite loop. The way you remove them depends on the case.</p> <p>For example, this Effect depends on the <code dir="ltr">options</code> object which gets re-created every time you edit the input:</p> 
<pre data-language="jsx"><span>import</span> <span>{</span> <span>useState</span><span>,</span> <span>useEffect</span> <span>}</span> <span>from</span> <span>'react'</span><span>;</span>
<span>import</span> <span>{</span> <span>createConnection</span> <span>}</span> <span>from</span> <span>'./chat.js'</span><span>;</span>

<span>const</span> <span>serverUrl</span> = <span>'https://localhost:1234'</span><span>;</span>

<span>function</span> <span>ChatRoom</span><span>(</span><span>{</span> <span>roomId</span> <span>}</span><span>)</span> <span>{</span>
  <span>const</span> <span>[</span><span>message</span><span>,</span> <span>setMessage</span><span>]</span> = <span>useState</span><span>(</span><span>''</span><span>)</span><span>;</span>

  <span>const</span> <span>options</span> = <span>{</span>
    <span>serverUrl</span><span>:</span> <span>serverUrl</span><span>,</span>
    <span>roomId</span><span>:</span> <span>roomId</span>
  <span>}</span><span>;</span>

  <span>useEffect</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
    <span>const</span> <span>connection</span> = <span>createConnection</span><span>(</span><span>options</span><span>)</span><span>;</span>
    <span>connection</span>.<span>connect</span><span>(</span><span>)</span><span>;</span>
    <span>return</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>connection</span>.<span>disconnect</span><span>(</span><span>)</span><span>;</span>
  <span>}</span><span>,</span> <span>[</span><span>options</span><span>]</span><span>)</span><span>;</span>

  <span>return</span> <span>(</span>
    <span>&lt;</span><span>&gt;</span>
      <span>&lt;</span><span>h1</span><span>&gt;</span>Welcome to the <span>{</span><span>roomId</span><span>}</span> room!<span>&lt;/</span><span>h1</span><span>&gt;</span>
      <span>&lt;</span><span>input</span> <span>value</span>=<span>{</span><span>message</span><span>}</span> <span>onChange</span>=<span>{</span><span>e</span> <span>=&gt;</span> <span>setMessage</span><span>(</span><span>e</span>.<span>target</span>.<span>value</span><span>)</span><span>}</span> <span>/&gt;</span>
    <span>&lt;/</span><span>&gt;</span>
  <span>)</span><span>;</span>
<span>}</span>

<span>export</span> <span>default</span> <span>function</span> <span>App</span><span>(</span><span>)</span> <span>{</span>
  <span>const</span> <span>[</span><span>roomId</span><span>,</span> <span>setRoomId</span><span>]</span> = <span>useState</span><span>(</span><span>'general'</span><span>)</span><span>;</span>
  <span>return</span> <span>(</span>
    <span>&lt;</span><span>&gt;</span>
      <span>&lt;</span><span>label</span><span>&gt;</span>
        Choose the chat room:<span>{</span><span>' '</span><span>}</span>
        <span>&lt;</span><span>select</span>
          <span>value</span>=<span>{</span><span>roomId</span><span>}</span>
          <span>onChange</span>=<span>{</span><span>e</span> <span>=&gt;</span> <span>setRoomId</span><span>(</span><span>e</span>.<span>target</span>.<span>value</span><span>)</span><span>}</span>
        <span>&gt;</span>
          <span>&lt;</span><span>option</span> <span>value</span>=<span>"general"</span><span>&gt;</span>general<span>&lt;/</span><span>option</span><span>&gt;</span>
          <span>&lt;</span><span>option</span> <span>value</span>=<span>"travel"</span><span>&gt;</span>travel<span>&lt;/</span><span>option</span><span>&gt;</span>
          <span>&lt;</span><span>option</span> <span>value</span>=<span>"music"</span><span>&gt;</span>music<span>&lt;/</span><span>option</span><span>&gt;</span>
        <span>&lt;/</span><span>select</span><span>&gt;</span>
      <span>&lt;/</span><span>label</span><span>&gt;</span>
      <span>&lt;</span><span>hr</span> <span>/&gt;</span>
      <span>&lt;</span><span>ChatRoom</span> <span>roomId</span>=<span>{</span><span>roomId</span><span>}</span> <span>/&gt;</span>
    <span>&lt;/</span><span>&gt;</span>
  <span>)</span><span>;</span>
<span>}</span>

</pre> <p>You don’t want the chat to re-connect every time you start typing a message in that chat. To fix this problem, move creation of the <code dir="ltr">options</code> object inside the Effect so that the Effect only depends on the <code dir="ltr">roomId</code> string:</p> 
<pre data-language="jsx"><span>import</span> <span>{</span> <span>useState</span><span>,</span> <span>useEffect</span> <span>}</span> <span>from</span> <span>'react'</span><span>;</span>
<span>import</span> <span>{</span> <span>createConnection</span> <span>}</span> <span>from</span> <span>'./chat.js'</span><span>;</span>

<span>const</span> <span>serverUrl</span> = <span>'https://localhost:1234'</span><span>;</span>

<span>function</span> <span>ChatRoom</span><span>(</span><span>{</span> <span>roomId</span> <span>}</span><span>)</span> <span>{</span>
  <span>const</span> <span>[</span><span>message</span><span>,</span> <span>setMessage</span><span>]</span> = <span>useState</span><span>(</span><span>''</span><span>)</span><span>;</span>

  <span>useEffect</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
    <span>const</span> <span>options</span> = <span>{</span>
      <span>serverUrl</span><span>:</span> <span>serverUrl</span><span>,</span>
      <span>roomId</span><span>:</span> <span>roomId</span>
    <span>}</span><span>;</span>
    <span>const</span> <span>connection</span> = <span>createConnection</span><span>(</span><span>options</span><span>)</span><span>;</span>
    <span>connection</span>.<span>connect</span><span>(</span><span>)</span><span>;</span>
    <span>return</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>connection</span>.<span>disconnect</span><span>(</span><span>)</span><span>;</span>
  <span>}</span><span>,</span> <span>[</span><span>roomId</span><span>]</span><span>)</span><span>;</span>

  <span>return</span> <span>(</span>
    <span>&lt;</span><span>&gt;</span>
      <span>&lt;</span><span>h1</span><span>&gt;</span>Welcome to the <span>{</span><span>roomId</span><span>}</span> room!<span>&lt;/</span><span>h1</span><span>&gt;</span>
      <span>&lt;</span><span>input</span> <span>value</span>=<span>{</span><span>message</span><span>}</span> <span>onChange</span>=<span>{</span><span>e</span> <span>=&gt;</span> <span>setMessage</span><span>(</span><span>e</span>.<span>target</span>.<span>value</span><span>)</span><span>}</span> <span>/&gt;</span>
    <span>&lt;/</span><span>&gt;</span>
  <span>)</span><span>;</span>
<span>}</span>

<span>export</span> <span>default</span> <span>function</span> <span>App</span><span>(</span><span>)</span> <span>{</span>
  <span>const</span> <span>[</span><span>roomId</span><span>,</span> <span>setRoomId</span><span>]</span> = <span>useState</span><span>(</span><span>'general'</span><span>)</span><span>;</span>
  <span>return</span> <span>(</span>
    <span>&lt;</span><span>&gt;</span>
      <span>&lt;</span><span>label</span><span>&gt;</span>
        Choose the chat room:<span>{</span><span>' '</span><span>}</span>
        <span>&lt;</span><span>select</span>
          <span>value</span>=<span>{</span><span>roomId</span><span>}</span>
          <span>onChange</span>=<span>{</span><span>e</span> <span>=&gt;</span> <span>setRoomId</span><span>(</span><span>e</span>.<span>target</span>.<span>value</span><span>)</span><span>}</span>
        <span>&gt;</span>
          <span>&lt;</span><span>option</span> <span>value</span>=<span>"general"</span><span>&gt;</span>general<span>&lt;/</span><span>option</span><span>&gt;</span>
          <span>&lt;</span><span>option</span> <span>value</span>=<span>"travel"</span><span>&gt;</span>travel<span>&lt;/</span><span>option</span><span>&gt;</span>
          <span>&lt;</span><span>option</span> <span>value</span>=<span>"music"</span><span>&gt;</span>music<span>&lt;/</span><span>option</span><span>&gt;</span>
        <span>&lt;/</span><span>select</span><span>&gt;</span>
      <span>&lt;/</span><span>label</span><span>&gt;</span>
      <span>&lt;</span><span>hr</span> <span>/&gt;</span>
      <span>&lt;</span><span>ChatRoom</span> <span>roomId</span>=<span>{</span><span>roomId</span><span>}</span> <span>/&gt;</span>
    <span>&lt;/</span><span>&gt;</span>
  <span>)</span><span>;</span>
<span>}</span>

</pre> <p>Notice that you didn’t start by editing the dependency list to remove the <code dir="ltr">options</code> dependency. That would be wrong. Instead, you changed the surrounding code so that the dependency became <em>unnecessary.</em> Think of the dependency list as a list of all the reactive values used by your Effect’s code. You don’t intentionally choose what to put on that list. The list describes your code. To change the dependency list, change the code.</p> <section class="note"><div>
<h4>Ready to learn this topic?</h4>
<p>Read <strong><a href="removing-effect-dependencies.html">Removing Effect Dependencies</a></strong> to learn how to make your Effect re-run less often.</p>
<a aria-label="Read More" target="_self" href="removing-effect-dependencies.html">Read More</a>
</div></section><hr> <h2 id="reusing-logic-with-custom-hooks">Reusing logic with custom Hooks 
</h2> <p>React comes with built-in Hooks like <code dir="ltr">useState</code>, <code dir="ltr">useContext</code>, and <code dir="ltr">useEffect</code>. Sometimes, you’ll wish that there was a Hook for some more specific purpose: for example, to fetch data, to keep track of whether the user is online, or to connect to a chat room. To do this, you can create your own Hooks for your application’s needs.</p> <p>In this example, the <code dir="ltr">usePointerPosition</code> custom Hook tracks the cursor position, while <code dir="ltr">useDelayedValue</code> custom Hook returns a value that’s “lagging behind” the value you passed by a certain number of milliseconds. Move the cursor over the sandbox preview area to see a moving trail of dots following the cursor:</p> 
<pre data-language="jsx"><span>import</span> <span>{</span> <span>usePointerPosition</span> <span>}</span> <span>from</span> <span>'./usePointerPosition.js'</span><span>;</span>
<span>import</span> <span>{</span> <span>useDelayedValue</span> <span>}</span> <span>from</span> <span>'./useDelayedValue.js'</span><span>;</span>

<span>export</span> <span>default</span> <span>function</span> <span>Canvas</span><span>(</span><span>)</span> <span>{</span>
  <span>const</span> <span>pos1</span> = <span>usePointerPosition</span><span>(</span><span>)</span><span>;</span>
  <span>const</span> <span>pos2</span> = <span>useDelayedValue</span><span>(</span><span>pos1</span><span>,</span> <span>100</span><span>)</span><span>;</span>
  <span>const</span> <span>pos3</span> = <span>useDelayedValue</span><span>(</span><span>pos2</span><span>,</span> <span>200</span><span>)</span><span>;</span>
  <span>const</span> <span>pos4</span> = <span>useDelayedValue</span><span>(</span><span>pos3</span><span>,</span> <span>100</span><span>)</span><span>;</span>
  <span>const</span> <span>pos5</span> = <span>useDelayedValue</span><span>(</span><span>pos4</span><span>,</span> <span>50</span><span>)</span><span>;</span>
  <span>return</span> <span>(</span>
    <span>&lt;</span><span>&gt;</span>
      <span>&lt;</span><span>Dot</span> <span>position</span>=<span>{</span><span>pos1</span><span>}</span> <span>opacity</span>=<span>{</span><span>1</span><span>}</span> <span>/&gt;</span>
      <span>&lt;</span><span>Dot</span> <span>position</span>=<span>{</span><span>pos2</span><span>}</span> <span>opacity</span>=<span>{</span><span>0.8</span><span>}</span> <span>/&gt;</span>
      <span>&lt;</span><span>Dot</span> <span>position</span>=<span>{</span><span>pos3</span><span>}</span> <span>opacity</span>=<span>{</span><span>0.6</span><span>}</span> <span>/&gt;</span>
      <span>&lt;</span><span>Dot</span> <span>position</span>=<span>{</span><span>pos4</span><span>}</span> <span>opacity</span>=<span>{</span><span>0.4</span><span>}</span> <span>/&gt;</span>
      <span>&lt;</span><span>Dot</span> <span>position</span>=<span>{</span><span>pos5</span><span>}</span> <span>opacity</span>=<span>{</span><span>0.2</span><span>}</span> <span>/&gt;</span>
    <span>&lt;/</span><span>&gt;</span>
  <span>)</span><span>;</span>
<span>}</span>

<span>function</span> <span>Dot</span><span>(</span><span>{</span> <span>position</span><span>,</span> <span>opacity</span> <span>}</span><span>)</span> <span>{</span>
  <span>return</span> <span>(</span>
    <span>&lt;</span><span>div</span> <span>style</span>=<span>{</span><span>{</span>
      <span>position</span><span>:</span> <span>'absolute'</span><span>,</span>
      <span>backgroundColor</span><span>:</span> <span>'pink'</span><span>,</span>
      <span>borderRadius</span><span>:</span> <span>'50%'</span><span>,</span>
      <span>opacity</span><span>,</span>
      <span>transform</span><span>:</span> <span>`translate(</span><span>${</span><span>position</span>.<span>x</span><span>}</span><span>px, </span><span>${</span><span>position</span>.<span>y</span><span>}</span><span>px)`</span><span>,</span>
      <span>pointerEvents</span><span>:</span> <span>'none'</span><span>,</span>
      <span>left</span><span>:</span> -<span>20</span><span>,</span>
      <span>top</span><span>:</span> -<span>20</span><span>,</span>
      <span>width</span><span>:</span> <span>40</span><span>,</span>
      <span>height</span><span>:</span> <span>40</span><span>,</span>
    <span>}</span><span>}</span> <span>/&gt;</span>
  <span>)</span><span>;</span>
<span>}</span>

</pre> <p>You can create custom Hooks, compose them together, pass data between them, and reuse them between components. As your app grows, you will write fewer Effects by hand because you’ll be able to reuse custom Hooks you already wrote. There are also many excellent custom Hooks maintained by the React community.</p> <section class="note"><div>
<h4>Ready to learn this topic?</h4>
<p>Read <strong><a href="reusing-logic-with-custom-hooks.html">Reusing Logic with Custom Hooks</a></strong> to learn how to share logic between components.</p>
<a aria-label="Read More" target="_self" href="reusing-logic-with-custom-hooks.html">Read More</a>
</div></section><hr> <h2 id="whats-next">What’s next? 
</h2> <p>Head over to <a href="referencing-values-with-refs.html">Referencing Values with Refs</a> to start reading this chapter page by page!</p><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2013&ndash;present Facebook Inc.<br>Licensed under the Creative Commons Attribution 4.0 International Public License.<br>
    <a href="https://react.dev/learn/escape-hatches" class="_attribution-link">https://react.dev/learn/escape-hatches</a>
  </p>
</div>
