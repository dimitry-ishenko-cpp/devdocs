<h1 id="browser-mode" tabindex="-1">Browser Mode <span class="VPBadge warning">Experimental</span> </h1>
<p>This page provides information about the experimental browser mode feature in the Vitest API, which allows you to run your tests in the browser natively, providing access to browser globals like window and document. This feature is currently under development, and APIs may change in the future.</p>
<h2 id="installation" tabindex="-1">Installation </h2>
<p>For easier setup, you can use <code>vitest init browser</code> command to install required dependencies and create browser configuration.</p>
<div class="vp-code-group vp-adaptive-theme">
<div class="tabs">
<input type="radio" name="group-FI7cx" id="tab-UCamT9I" checked><label for="tab-UCamT9I">npm</label><input type="radio" name="group-FI7cx" id="tab-dSF6LL-"><label for="tab-dSF6LL-">yarn</label><input type="radio" name="group-FI7cx" id="tab-tcjCCK0"><label for="tab-tcjCCK0">pnpm</label><input type="radio" name="group-FI7cx" id="tab-KCos-F0"><label for="tab-KCos-F0">bun</label>
</div>
<div class="blocks">
<div class="language-bash vp-adaptive-theme active">
<span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="javascript">npx vitest init browser</pre>
</div>
<div class="language-bash vp-adaptive-theme">
<span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="javascript">yarn exec vitest init browser</pre>
</div>
<div class="language-bash vp-adaptive-theme">
<span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="javascript">pnpx vitest init browser</pre>
</div>
<div class="language-bash vp-adaptive-theme">
<span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="javascript">bunx vitest init browser</pre>
</div>
</div>
</div>
<h3 id="manual-installation" tabindex="-1">Manual Installation </h3>
<p>You can also install packages manually. By default, Browser Mode doesn't require any additional E2E provider to run tests locally because it reuses your existing browser.</p>
<div class="vp-code-group vp-adaptive-theme">
<div class="tabs">
<input type="radio" name="group-Fvrvn" id="tab-aaPuuVq" checked><label for="tab-aaPuuVq">npm</label><input type="radio" name="group-Fvrvn" id="tab-WDmzUWO"><label for="tab-WDmzUWO">yarn</label><input type="radio" name="group-Fvrvn" id="tab-jEHe4AF"><label for="tab-jEHe4AF">pnpm</label><input type="radio" name="group-Fvrvn" id="tab-ezDNU7g"><label for="tab-ezDNU7g">bun</label>
</div>
<div class="blocks">
<div class="language-bash vp-adaptive-theme active">
<span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="javascript">npm install -D vitest @vitest/browser</pre>
</div>
<div class="language-bash vp-adaptive-theme">
<span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="javascript">yarn add -D vitest @vitest/browser</pre>
</div>
<div class="language-bash vp-adaptive-theme">
<span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="javascript">pnpm add -D vitest @vitest/browser</pre>
</div>
<div class="language-bash vp-adaptive-theme">
<span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="javascript">bun add -D vitest @vitest/browser</pre>
</div>
</div>
</div>
<div class="warning custom-block">
<strong class="custom-block-title">WARNING</strong><p>However, to run tests in CI you need to install either <a href="https://npmjs.com/package/playwright" target="_blank" rel="noreferrer"><code>playwright</code></a> or <a href="https://www.npmjs.com/package/webdriverio" target="_blank" rel="noreferrer"><code>webdriverio</code></a>. We also recommend switching to either one of them for testing locally instead of using the default <code>preview</code> provider since it relies on simulating events instead of using Chrome DevTools Protocol.</p>
</div>
<h3 id="using-playwright" tabindex="-1">Using Playwright </h3>
<div class="vp-code-group vp-adaptive-theme">
<div class="tabs">
<input type="radio" name="group-nPBIt" id="tab-PWYnHOr" checked><label for="tab-PWYnHOr">npm</label><input type="radio" name="group-nPBIt" id="tab-AwjvWm1"><label for="tab-AwjvWm1">yarn</label><input type="radio" name="group-nPBIt" id="tab-whlQ7R2"><label for="tab-whlQ7R2">pnpm</label><input type="radio" name="group-nPBIt" id="tab-9kh7Boe"><label for="tab-9kh7Boe">bun</label>
</div>
<div class="blocks">
<div class="language-bash vp-adaptive-theme active">
<span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="javascript">npm install -D vitest @vitest/browser playwright</pre>
</div>
<div class="language-bash vp-adaptive-theme">
<span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="javascript">yarn add -D vitest @vitest/browser playwright</pre>
</div>
<div class="language-bash vp-adaptive-theme">
<span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="javascript">pnpm add -D vitest @vitest/browser playwright</pre>
</div>
<div class="language-bash vp-adaptive-theme">
<span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="javascript">bun add -D vitest @vitest/browser playwright</pre>
</div>
</div>
</div>
<h3 id="using-webdriverio" tabindex="-1">Using Webdriverio </h3>
<div class="vp-code-group vp-adaptive-theme">
<div class="tabs">
<input type="radio" name="group-QSD-2" id="tab-MNZ7Yw1" checked><label for="tab-MNZ7Yw1">npm</label><input type="radio" name="group-QSD-2" id="tab-MMSYOhG"><label for="tab-MMSYOhG">yarn</label><input type="radio" name="group-QSD-2" id="tab-dx-Emt-"><label for="tab-dx-Emt-">pnpm</label><input type="radio" name="group-QSD-2" id="tab-QmzsnDZ"><label for="tab-QmzsnDZ">bun</label>
</div>
<div class="blocks">
<div class="language-bash vp-adaptive-theme active">
<span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="javascript">npm install -D vitest @vitest/browser webdriverio</pre>
</div>
<div class="language-bash vp-adaptive-theme">
<span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="javascript">yarn add -D vitest @vitest/browser webdriverio</pre>
</div>
<div class="language-bash vp-adaptive-theme">
<span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="javascript">pnpm add -D vitest @vitest/browser webdriverio</pre>
</div>
<div class="language-bash vp-adaptive-theme">
<span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="javascript">bun add -D vitest @vitest/browser webdriverio</pre>
</div>
</div>
</div>
<h2 id="configuration" tabindex="-1">Configuration </h2>
<p>To activate browser mode in your Vitest configuration, you can use the <code>--browser</code> flag or set the <code>browser.enabled</code> field to <code>true</code> in your Vitest configuration file. Here is an example configuration using the browser field:</p>
<div class="language-ts vp-adaptive-theme">
<span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="javascript">export default defineConfig({
  test: {
    browser: {
      provider: 'playwright', // or 'webdriverio'
      enabled: true,
      name: 'chrome', // browser name is required
    },
  }
})</pre>
</div>
<p>If you have not used Vite before, make sure you have your framework's plugin installed and specified in the config. Some frameworks might require extra configuration to work - check their Vite related documentation to be sure.</p>
<div class="vp-code-group vp-adaptive-theme">
<div class="tabs">
<input type="radio" name="group-ZP-T7" id="tab-ErSV1K0" checked><label for="tab-ErSV1K0">vue</label><input type="radio" name="group-ZP-T7" id="tab-ZwS7P7B"><label for="tab-ZwS7P7B">svelte</label><input type="radio" name="group-ZP-T7" id="tab-CR_7q9f"><label for="tab-CR_7q9f">solid</label><input type="radio" name="group-ZP-T7" id="tab-spjgmNu"><label for="tab-spjgmNu">marko</label>
</div>
<div class="blocks">
<div class="language-ts vp-adaptive-theme active">
<span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="javascript">import { defineConfig } from 'vitest/config'
import vue from '@vitejs/plugin-vue'

export default defineConfig({
  plugins: [vue()],
  test: {
    browser: {
      enabled: true,
      provider: 'playwright',
      name: 'chrome',
    }
  }
})</pre>
</div>
<div class="language-ts vp-adaptive-theme">
<span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="javascript">import { defineConfig } from 'vitest/config'
import { svelte } from '@sveltejs/vite-plugin-svelte'

export default defineConfig({
  plugins: [svelte()],
  test: {
    browser: {
      enabled: true,
      provider: 'playwright',
      name: 'chrome',
    }
  }
})</pre>
</div>
<div class="language-ts vp-adaptive-theme">
<span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="javascript">import { defineConfig } from 'vitest/config'
import solidPlugin from 'vite-plugin-solid'

export default defineConfig({
  plugins: [solidPlugin()],
  test: {
    browser: {
      enabled: true,
      provider: 'playwright',
      name: 'chrome',
    }
  }
})</pre>
</div>
<div class="language-ts vp-adaptive-theme">
<span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="javascript">import { defineConfig } from 'vitest/config'
import marko from '@marko/vite'

export default defineConfig({
  plugins: [marko()],
  test: {
    browser: {
      enabled: true,
      provider: 'playwright',
      name: 'chrome',
    }
  }
})</pre>
</div>
</div>
</div>
<div class="tip custom-block">
<strong class="custom-block-title">TIP</strong><p><code>react</code> doesn't require a plugin to work, but <code>preact</code> requires <a href="https://preactjs.com/guide/v10/getting-started/#create-a-vite-powered-preact-app" target="_blank" rel="noreferrer">extra configuration</a> to make aliases work.</p>
</div>
<p>If you need to run some tests using Node-based runner, you can define a <a href="../workspace.html">workspace</a> file with separate configurations for different testing strategies:</p>
<div class="language-ts vp-adaptive-theme">
<span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="javascript">// vitest.workspace.ts
import { defineWorkspace } from 'vitest/config'

export default defineWorkspace([
  {
    test: {
      // an example of file based convention,
      // you don't have to follow it
      include: [
        'tests/unit/**/*.{test,spec}.ts',
        'tests/**/*.unit.{test,spec}.ts',
      ],
      name: 'unit',
      environment: 'node',
    },
  },
  {
    test: {
      // an example of file based convention,
      // you don't have to follow it
      include: [
        'tests/browser/**/*.{test,spec}.ts',
        'tests/**/*.browser.{test,spec}.ts',
      ],
      name: 'browser',
      browser: {
        enabled: true,
        name: 'chrome',
      },
    },
  },
])</pre>
</div>
<h2 id="browser-option-types" tabindex="-1">Browser Option Types </h2>
<p>The browser option in Vitest depends on the provider. Vitest will fail, if you pass <code>--browser</code> and don't specify its name in the config file. Available options:</p>
<ul>
<li>
<code>webdriverio</code> supports these browsers: <ul>
<li><code>firefox</code></li>
<li><code>chrome</code></li>
<li><code>edge</code></li>
<li><code>safari</code></li>
</ul>
</li>
<li>
<code>playwright</code> supports these browsers: <ul>
<li><code>firefox</code></li>
<li><code>webkit</code></li>
<li><code>chromium</code></li>
</ul>
</li>
</ul>
<h2 id="browser-compatibility" tabindex="-1">Browser Compatibility </h2>
<p>Vitest uses <a href="https://vitejs.dev/guide/#browser-support" target="_blank" rel="noreferrer">Vite dev server</a> to run your tests, so we only support features specified in the <a href="https://vitejs.dev/config/shared-options.html#esbuild" target="_blank" rel="noreferrer"><code>esbuild.target</code></a> option (<code>esnext</code> by default).</p>
<p>By default, Vite targets browsers which support the native <a href="https://caniuse.com/es6-module" target="_blank" rel="noreferrer">ES Modules</a>, native <a href="https://caniuse.com/es6-module-dynamic-import" target="_blank" rel="noreferrer">ESM dynamic import</a>, and <a href="https://caniuse.com/mdn-javascript_operators_import_meta" target="_blank" rel="noreferrer"><code>import.meta</code></a>. On top of that, we utilize <a href="https://caniuse.com/?search=BroadcastChannel" target="_blank" rel="noreferrer"><code>BroadcastChannel</code></a> to communicate between iframes:</p>
<ul>
<li>Chrome &gt;=87</li>
<li>Firefox &gt;=78</li>
<li>Safari &gt;=15.4</li>
<li>Edge &gt;=88</li>
</ul>
<h2 id="motivation" tabindex="-1">Motivation </h2>
<p>We developed the Vitest browser mode feature to help improve testing workflows and achieve more accurate and reliable test results. This experimental addition to our testing API allows developers to run tests in a native browser environment. In this section, we'll explore the motivations behind this feature and its benefits for testing.</p>
<h3 id="different-ways-of-testing" tabindex="-1">Different Ways of Testing </h3>
<p>There are different ways to test JavaScript code. Some testing frameworks simulate browser environments in Node.js, while others run tests in real browsers. In this context, <a href="https://www.npmjs.com/package/jsdom" target="_blank" rel="noreferrer">jsdom</a> is an example of a spec implementation that simulates a browser environment by being used with a test runner like Jest or Vitest, while other testing tools such as <a href="https://webdriver.io/" target="_blank" rel="noreferrer">WebdriverIO</a> or <a href="https://www.cypress.io/" target="_blank" rel="noreferrer">Cypress</a> allow developers to test their applications in a real browser or in case of <a href="https://playwright.dev/" target="_blank" rel="noreferrer">Playwright</a> provide you a browser engine.</p>
<h3 id="the-simulation-caveat" tabindex="-1">The Simulation Caveat </h3>
<p>Testing JavaScript programs in simulated environments such as jsdom or happy-dom has simplified the test setup and provided an easy-to-use API, making them suitable for many projects and increasing confidence in test results. However, it is crucial to keep in mind that these tools only simulate a browser environment and not an actual browser, which may result in some discrepancies between the simulated environment and the real environment. Therefore, false positives or negatives in test results may occur.</p>
<p>To achieve the highest level of confidence in our tests, it's crucial to test in a real browser environment. This is why we developed the browser mode feature in Vitest, allowing developers to run tests natively in a browser and gain more accurate and reliable test results. With browser-level testing, developers can be more confident that their application will work as intended in a real-world scenario.</p>
<h2 id="drawbacks" tabindex="-1">Drawbacks </h2>
<p>When using Vitest browser, it is important to consider the following drawbacks:</p>
<h3 id="early-development" tabindex="-1">Early Development </h3>
<p>The browser mode feature of Vitest is still in its early stages of development. As such, it may not yet be fully optimized, and there may be some bugs or issues that have not yet been ironed out. It is recommended that users augment their Vitest browser experience with a standalone browser-side test runner like WebdriverIO, Cypress or Playwright.</p>
<h3 id="longer-initialization" tabindex="-1">Longer Initialization </h3>
<p>Vitest browser requires spinning up the provider and the browser during the initialization process, which can take some time. This can result in longer initialization times compared to other testing patterns.</p>
<h2 id="cross-browser-testing" tabindex="-1">Cross-Browser Testing </h2>
<p>When you specify a browser name in the browser option, Vitest will try to run the specified browser using <a href="https://webdriver.io/" target="_blank" rel="noreferrer">WebdriverIO</a> by default, and then run the tests there. This feature makes cross-browser testing easy to use and configure in environments like a CI. If you don't want to use WebdriverIO, you can configure the custom browser provider by using <code>browser.provider</code> option.</p>
<p>To specify a browser using the CLI, use the <code>--browser</code> flag followed by the browser name, like this:</p>
<div class="language-sh vp-adaptive-theme">
<span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="javascript">npx vitest --browser=chrome</pre>
</div>
<p>Or you can provide browser options to CLI with dot notation:</p>
<div class="language-sh vp-adaptive-theme">
<span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="javascript">npx vitest --browser.name=chrome --browser.headless</pre>
</div>
<h2 id="headless" tabindex="-1">Headless </h2>
<p>Headless mode is another option available in the browser mode. In headless mode, the browser runs in the background without a user interface, which makes it useful for running automated tests. The headless option in Vitest can be set to a boolean value to enable or disable headless mode.</p>
<p>Here's an example configuration enabling headless mode:</p>
<div class="language-ts vp-adaptive-theme">
<span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="javascript">export default defineConfig({
  test: {
    browser: {
      provider: 'playwright',
      enabled: true,
      headless: true,
    },
  }
})</pre>
</div>
<p>You can also set headless mode using the <code>--browser.headless</code> flag in the CLI, like this:</p>
<div class="language-sh vp-adaptive-theme">
<span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="javascript">npx vitest --browser.name=chrome --browser.headless</pre>
</div>
<p>In this case, Vitest will run in headless mode using the Chrome browser.</p>
<div class="warning custom-block">
<strong class="custom-block-title">WARNING</strong><p>Headless mode is not available by default. You need to use either <a href="https://npmjs.com/package/playwright" target="_blank" rel="noreferrer"><code>playwright</code></a> or <a href="https://www.npmjs.com/package/webdriverio" target="_blank" rel="noreferrer"><code>webdriverio</code></a> providers to enable this feature.</p>
</div>
<h2 id="limitations" tabindex="-1">Limitations </h2>
<h3 id="thread-blocking-dialogs" tabindex="-1">Thread Blocking Dialogs </h3>
<p>When using Vitest Browser, it's important to note that thread blocking dialogs like <code>alert</code> or <code>confirm</code> cannot be used natively. This is because they block the web page, which means Vitest cannot continue communicating with the page, causing the execution to hang.</p>
<p>In such situations, Vitest provides default mocks with default returned values for these APIs. This ensures that if the user accidentally uses synchronous popup web APIs, the execution would not hang. However, it's still recommended for the user to mock these web APIs for better experience. Read more in <a href="../mocking.html">Mocking</a>.</p><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2021-Present Anthony Fu<br>&copy; 2021-Present Matias Capeletto<br>Licensed under the MIT License.<br>
    <a href="https://vitest.dev/guide/browser/" class="_attribution-link">https://vitest.dev/guide/browser/</a>
  </p>
</div>
