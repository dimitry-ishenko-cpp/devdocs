<h1>30.4. Extensibility </h1>    <div class="toc"> <dl class="toc"> <dt><a href="jit-extensibility.html#JIT-EXTENSIBILITY-BITCODE">30.4.1. Inlining Support for Extensions</a></dt> <dt><a href="jit-extensibility.html#JIT-PLUGGABLE">30.4.2. Pluggable JIT Providers</a></dt> </dl> </div> <div class="sect2" id="JIT-EXTENSIBILITY-BITCODE">    <h2 class="title">30.4.1. Inlining Support for Extensions </h2>    <p>PostgreSQL's JIT implementation can inline the bodies of functions of types <code class="literal">C</code> and <code class="literal">internal</code>, as well as operators based on such functions. To do so for functions in extensions, the definitions of those functions need to be made available. When using <a class="link" href="https://www.postgresql.org/docs/17/extend-pgxs.html" title="36.18.Â Extension Building Infrastructure">PGXS</a> to build an extension against a server that has been compiled with LLVM JIT support, the relevant files will be built and installed automatically.</p> <p>The relevant files have to be installed into <code class="filename">$pkglibdir/bitcode/$extension/</code> and a summary of them into <code class="filename">$pkglibdir/bitcode/$extension.index.bc</code>, where <code class="literal">$pkglibdir</code> is the directory returned by <code class="literal">pg_config --pkglibdir</code> and <code class="literal">$extension</code> is the base name of the extension's shared library.</p> <blockquote class="note"> <h3 class="title">Note</h3> <p>For functions built into PostgreSQL itself, the bitcode is installed into <code class="literal">$pkglibdir/bitcode/postgres</code>.</p> </blockquote> </div> <div class="sect2" id="JIT-PLUGGABLE">    <h2 class="title">30.4.2. Pluggable JIT Providers </h2>    <p>PostgreSQL provides a JIT implementation based on LLVM. The interface to the JIT provider is pluggable and the provider can be changed without recompiling (although currently, the build process only provides inlining support data for LLVM). The active provider is chosen via the setting <a class="xref" href="runtime-config-client.html#GUC-JIT-PROVIDER">jit_provider</a>.</p> <div class="sect3" id="JIT-PLUGGABLE-PROVIDER-INTERFACE">    <h3 class="title">30.4.2.1. JIT Provider Interface </h3>    <p>A JIT provider is loaded by dynamically loading the named shared library. The normal library search path is used to locate the library. To provide the required JIT provider callbacks and to indicate that the library is actually a JIT provider, it needs to provide a C function named <code class="function">_PG_jit_provider_init</code>. This function is passed a struct that needs to be filled with the callback function pointers for individual actions:</p> <pre data-language="sql">
struct JitProviderCallbacks
{
    JitProviderResetAfterErrorCB reset_after_error;
    JitProviderReleaseContextCB release_context;
    JitProviderCompileExprCB compile_expr;
};

extern void _PG_jit_provider_init(JitProviderCallbacks *cb);
</pre> </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 1996&ndash;2024 The PostgreSQL Global Development Group<br>Licensed under the PostgreSQL License.<br>
    <a href="https://www.postgresql.org/docs/17/jit-extensibility.html" class="_attribution-link">https://www.postgresql.org/docs/17/jit-extensibility.html</a>
  </p>
</div>
