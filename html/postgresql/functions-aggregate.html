<h1>9.21. Aggregate Functions </h1>    <p><em class="firstterm">Aggregate functions</em> compute a single result from a set of input values. The built-in general-purpose aggregate functions are listed in <a class="xref" href="functions-aggregate.html#FUNCTIONS-AGGREGATE-TABLE" title="Table 9.60. General-Purpose Aggregate Functions">Table 9.60</a> while statistical aggregates are in <a class="xref" href="functions-aggregate.html#FUNCTIONS-AGGREGATE-STATISTICS-TABLE" title="Table 9.61. Aggregate Functions for Statistics">Table 9.61</a>. The built-in within-group ordered-set aggregate functions are listed in <a class="xref" href="functions-aggregate.html#FUNCTIONS-ORDEREDSET-TABLE" title="Table 9.62. Ordered-Set Aggregate Functions">Table 9.62</a> while the built-in within-group hypothetical-set ones are in <a class="xref" href="functions-aggregate.html#FUNCTIONS-HYPOTHETICAL-TABLE" title="Table 9.63. Hypothetical-Set Aggregate Functions">Table 9.63</a>. Grouping operations, which are closely related to aggregate functions, are listed in <a class="xref" href="functions-aggregate.html#FUNCTIONS-GROUPING-TABLE" title="Table 9.64. Grouping Operations">Table 9.64</a>. The special syntax considerations for aggregate functions are explained in <a class="xref" href="sql-expressions.html#SYNTAX-AGGREGATES" title="4.2.7. Aggregate Expressions">Section 4.2.7</a>. Consult <a class="xref" href="tutorial-agg.html" title="2.7. Aggregate Functions">Section 2.7</a> for additional introductory information.</p> <p>Aggregate functions that support <em class="firstterm">Partial Mode</em> are eligible to participate in various optimizations, such as parallel aggregation.</p> <p>While all aggregates below accept an optional <code class="literal">ORDER BY</code> clause (as outlined in <a class="xref" href="sql-expressions.html#SYNTAX-AGGREGATES" title="4.2.7. Aggregate Expressions">Section 4.2.7</a>), the clause has only been added to aggregates whose output is affected by ordering.</p> <div class="table" id="FUNCTIONS-AGGREGATE-TABLE"> <p class="title"><strong>Table 9.60. General-Purpose Aggregate Functions</strong></p> <div class="table-contents"> <table class="table" summary="General-Purpose Aggregate Functions"> <colgroup> <col class="col1"> <col class="col2"> </colgroup> <thead> <tr> <th class="func_table_entry"> <p class="func_signature">Function</p> <p>Description</p> </th> <th>Partial Mode</th> </tr> </thead> <tbody> <tr> <td class="func_table_entry"> <p class="func_signature" id="id-1.5.8.27.6.2.4.1.1.1.1"> <code class="function" id="any_value">any_value</code> ( <code class="type">anyelement</code> ) → <code class="returnvalue">same as input type</code></p> <p>Returns an arbitrary value from the non-null input values.</p> </td> <td>Yes</td> </tr> <tr> <td class="func_table_entry"> <p class="func_signature" id="id-1.5.8.27.6.2.4.2.1.1.1"> <code class="function" id="array_agg">array_agg</code> ( <code class="type">anynonarray</code> <code class="literal">ORDER BY</code> <code class="literal">input_sort_columns</code> ) → <code class="returnvalue">anyarray</code></p> <p>Collects all the input values, including nulls, into an array.</p> </td> <td>Yes</td> </tr> <tr> <td class="func_table_entry"> <p class="func_signature"><code class="function">array_agg</code> ( <code class="type">anyarray</code> <code class="literal">ORDER BY</code> <code class="literal">input_sort_columns</code> ) → <code class="returnvalue">anyarray</code></p> <p>Concatenates all the input arrays into an array of one higher dimension. (The inputs must all have the same dimensionality, and cannot be empty or null.)</p> </td> <td>Yes</td> </tr> <tr> <td class="func_table_entry"> <p class="func_signature" id="id-1.5.8.27.6.2.4.4.1.1.2">  <code class="function" id="avg">avg</code> ( <code class="type">smallint</code> ) → <code class="returnvalue">numeric</code></p> <p class="func_signature"><code class="function">avg</code> ( <code class="type">integer</code> ) → <code class="returnvalue">numeric</code></p> <p class="func_signature"><code class="function">avg</code> ( <code class="type">bigint</code> ) → <code class="returnvalue">numeric</code></p> <p class="func_signature"><code class="function">avg</code> ( <code class="type">numeric</code> ) → <code class="returnvalue">numeric</code></p> <p class="func_signature"><code class="function">avg</code> ( <code class="type">real</code> ) → <code class="returnvalue">double precision</code></p> <p class="func_signature"><code class="function">avg</code> ( <code class="type">double precision</code> ) → <code class="returnvalue">double precision</code></p> <p class="func_signature"><code class="function">avg</code> ( <code class="type">interval</code> ) → <code class="returnvalue">interval</code></p> <p>Computes the average (arithmetic mean) of all the non-null input values.</p> </td> <td>Yes</td> </tr> <tr> <td class="func_table_entry"> <p class="func_signature" id="id-1.5.8.27.6.2.4.5.1.1.1"> <code class="function" id="bit_and">bit_and</code> ( <code class="type">smallint</code> ) → <code class="returnvalue">smallint</code></p> <p class="func_signature"><code class="function">bit_and</code> ( <code class="type">integer</code> ) → <code class="returnvalue">integer</code></p> <p class="func_signature"><code class="function">bit_and</code> ( <code class="type">bigint</code> ) → <code class="returnvalue">bigint</code></p> <p class="func_signature"><code class="function">bit_and</code> ( <code class="type">bit</code> ) → <code class="returnvalue">bit</code></p> <p>Computes the bitwise AND of all non-null input values.</p> </td> <td>Yes</td> </tr> <tr> <td class="func_table_entry"> <p class="func_signature" id="id-1.5.8.27.6.2.4.6.1.1.1"> <code class="function" id="bit_or">bit_or</code> ( <code class="type">smallint</code> ) → <code class="returnvalue">smallint</code></p> <p class="func_signature"><code class="function">bit_or</code> ( <code class="type">integer</code> ) → <code class="returnvalue">integer</code></p> <p class="func_signature"><code class="function">bit_or</code> ( <code class="type">bigint</code> ) → <code class="returnvalue">bigint</code></p> <p class="func_signature"><code class="function">bit_or</code> ( <code class="type">bit</code> ) → <code class="returnvalue">bit</code></p> <p>Computes the bitwise OR of all non-null input values.</p> </td> <td>Yes</td> </tr> <tr> <td class="func_table_entry"> <p class="func_signature" id="id-1.5.8.27.6.2.4.7.1.1.1"> <code class="function" id="bit_xor">bit_xor</code> ( <code class="type">smallint</code> ) → <code class="returnvalue">smallint</code></p> <p class="func_signature"><code class="function">bit_xor</code> ( <code class="type">integer</code> ) → <code class="returnvalue">integer</code></p> <p class="func_signature"><code class="function">bit_xor</code> ( <code class="type">bigint</code> ) → <code class="returnvalue">bigint</code></p> <p class="func_signature"><code class="function">bit_xor</code> ( <code class="type">bit</code> ) → <code class="returnvalue">bit</code></p> <p>Computes the bitwise exclusive OR of all non-null input values. Can be useful as a checksum for an unordered set of values.</p> </td> <td>Yes</td> </tr> <tr> <td class="func_table_entry"> <p class="func_signature" id="id-1.5.8.27.6.2.4.8.1.1.1"> <code class="function" id="bool_and">bool_and</code> ( <code class="type">boolean</code> ) → <code class="returnvalue">boolean</code></p> <p>Returns true if all non-null input values are true, otherwise false.</p> </td> <td>Yes</td> </tr> <tr> <td class="func_table_entry"> <p class="func_signature" id="id-1.5.8.27.6.2.4.9.1.1.1"> <code class="function" id="bool_or">bool_or</code> ( <code class="type">boolean</code> ) → <code class="returnvalue">boolean</code></p> <p>Returns true if any non-null input value is true, otherwise false.</p> </td> <td>Yes</td> </tr> <tr> <td class="func_table_entry"> <p class="func_signature" id="id-1.5.8.27.6.2.4.10.1.1.1"> <code class="function" id="count">count</code> ( <code class="literal" id="42">*</code> ) → <code class="returnvalue">bigint</code></p> <p>Computes the number of input rows.</p> </td> <td>Yes</td> </tr> <tr> <td class="func_table_entry"> <p class="func_signature"><code class="function">count</code> ( <code class="type">"any"</code> ) → <code class="returnvalue">bigint</code></p> <p>Computes the number of input rows in which the input value is not null.</p> </td> <td>Yes</td> </tr> <tr> <td class="func_table_entry"> <p class="func_signature" id="id-1.5.8.27.6.2.4.12.1.1.1"> <code class="function" id="every">every</code> ( <code class="type">boolean</code> ) → <code class="returnvalue">boolean</code></p> <p>This is the SQL standard's equivalent to <code class="function">bool_and</code>.</p> </td> <td>Yes</td> </tr> <tr> <td class="func_table_entry"> <p class="func_signature" id="id-1.5.8.27.6.2.4.13.1.1.1"> <code class="function" id="json_agg">json_agg</code> ( <code class="type">anyelement</code> <code class="literal">ORDER BY</code> <code class="literal">input_sort_columns</code> ) → <code class="returnvalue">json</code></p> <p class="func_signature" id="id-1.5.8.27.6.2.4.13.1.2.1"> <code class="function" id="jsonb_agg">jsonb_agg</code> ( <code class="type">anyelement</code> <code class="literal">ORDER BY</code> <code class="literal">input_sort_columns</code> ) → <code class="returnvalue">jsonb</code></p> <p>Collects all the input values, including nulls, into a JSON array. Values are converted to JSON as per <code class="function" id="to_json">to_json</code> or <code class="function">to_jsonb</code>.</p> </td> <td>No</td> </tr> <tr> <td class="func_table_entry"> <p class="func_signature" id="id-1.5.8.27.6.2.4.14.1.1.1"> <code class="function" id="json_agg_strict">json_agg_strict</code> ( <code class="type">anyelement</code> ) → <code class="returnvalue">json</code></p> <p class="func_signature" id="id-1.5.8.27.6.2.4.14.1.2.1"> <code class="function" id="jsonb_agg_strict">jsonb_agg_strict</code> ( <code class="type">anyelement</code> ) → <code class="returnvalue">jsonb</code></p> <p>Collects all the input values, skipping nulls, into a JSON array. Values are converted to JSON as per <code class="function">to_json</code> or <code class="function">to_jsonb</code>.</p> </td> <td>No</td> </tr> <tr> <td class="func_table_entry"> <p class="func_signature" id="id-1.5.8.27.6.2.4.15.1.1.1"> <code class="function" id="json_arrayagg">json_arrayagg</code> ( [ <span class="optional"><code>value_expression</code></span> ] [ <span class="optional"><code class="literal">ORDER BY</code> <code>sort_expression</code></span> ] [ <span class="optional">{ <code class="literal">NULL</code> | <code class="literal">ABSENT</code> } <code class="literal">ON NULL</code></span> ] [ <span class="optional"><code class="literal">RETURNING</code> <code>data_type</code> [ <span class="optional"><code class="literal">FORMAT JSON</code> [ <span class="optional"><code class="literal">ENCODING UTF8</code></span> ]</span> ]</span> ])</p> <p>Behaves in the same way as <code class="function" id="json_array">json_array</code> but as an aggregate function so it only takes one <code>value_expression</code> parameter. If <code class="literal">ABSENT ON NULL</code> is specified, any NULL values are omitted. If <code class="literal">ORDER BY</code> is specified, the elements will appear in the array in that order rather than in the input order.</p> <p><code class="literal">SELECT json_arrayagg(v) FROM (VALUES(2),(1)) t(v)</code> → <code class="returnvalue">[2, 1]</code></p> </td> <td>No</td> </tr> <tr> <td class="func_table_entry"> <p class="func_signature" id="id-1.5.8.27.6.2.4.16.1.1.1"> <code class="function" id="json_objectagg">json_objectagg</code> ( [ <span class="optional">{ <code>key_expression</code> { <code class="literal">VALUE</code> | ':' } <code>value_expression</code> }</span> ] [ <span class="optional">{ <code class="literal">NULL</code> | <code class="literal">ABSENT</code> } <code class="literal">ON NULL</code></span> ] [ <span class="optional">{ <code class="literal">WITH</code> | <code class="literal">WITHOUT</code> } <code class="literal">UNIQUE</code> [ <span class="optional"><code class="literal">KEYS</code></span> ]</span> ] [ <span class="optional"><code class="literal">RETURNING</code> <code>data_type</code> [ <span class="optional"><code class="literal">FORMAT JSON</code> [ <span class="optional"><code class="literal">ENCODING UTF8</code></span> ]</span> ]</span> ])</p> <p>Behaves like <code class="function" id="json_object">json_object</code>, but as an aggregate function, so it only takes one <code>key_expression</code> and one <code>value_expression</code> parameter.</p> <p><code class="literal">SELECT json_objectagg(k:v) FROM (VALUES ('a'::text,current_date),('b',current_date + 1)) AS t(k,v)</code> → <code class="returnvalue">{ "a" : "2022-05-10", "b" : "2022-05-11" }</code></p> </td> <td>No</td> </tr> <tr> <td class="func_table_entry"> <p class="func_signature" id="id-1.5.8.27.6.2.4.17.1.1.1"> <code class="function" id="json_object_agg">json_object_agg</code> ( <em class="parameter"><code>key</code></em> <code class="type">"any"</code>, <em class="parameter"><code>value</code></em> <code class="type">"any"</code> <code class="literal">ORDER BY</code> <code class="literal">input_sort_columns</code> ) → <code class="returnvalue">json</code></p> <p class="func_signature" id="id-1.5.8.27.6.2.4.17.1.2.1"> <code class="function" id="jsonb_object_agg">jsonb_object_agg</code> ( <em class="parameter"><code>key</code></em> <code class="type">"any"</code>, <em class="parameter"><code>value</code></em> <code class="type">"any"</code> <code class="literal">ORDER BY</code> <code class="literal">input_sort_columns</code> ) → <code class="returnvalue">jsonb</code></p> <p>Collects all the key/value pairs into a JSON object. Key arguments are coerced to text; value arguments are converted as per <code class="function">to_json</code> or <code class="function">to_jsonb</code>. Values can be null, but keys cannot.</p> </td> <td>No</td> </tr> <tr> <td class="func_table_entry"> <p class="func_signature" id="id-1.5.8.27.6.2.4.18.1.1.1"> <code class="function" id="json_object_agg_strict">json_object_agg_strict</code> ( <em class="parameter"><code>key</code></em> <code class="type">"any"</code>, <em class="parameter"><code>value</code></em> <code class="type">"any"</code> ) → <code class="returnvalue">json</code></p> <p class="func_signature" id="id-1.5.8.27.6.2.4.18.1.2.1"> <code class="function" id="jsonb_object_agg_strict">jsonb_object_agg_strict</code> ( <em class="parameter"><code>key</code></em> <code class="type">"any"</code>, <em class="parameter"><code>value</code></em> <code class="type">"any"</code> ) → <code class="returnvalue">jsonb</code></p> <p>Collects all the key/value pairs into a JSON object. Key arguments are coerced to text; value arguments are converted as per <code class="function">to_json</code> or <code class="function">to_jsonb</code>. The <em class="parameter"><code>key</code></em> can not be null. If the <em class="parameter"><code>value</code></em> is null then the entry is skipped,</p> </td> <td>No</td> </tr> <tr> <td class="func_table_entry"> <p class="func_signature" id="id-1.5.8.27.6.2.4.19.1.1.1"> <code class="function" id="json_object_agg_unique">json_object_agg_unique</code> ( <em class="parameter"><code>key</code></em> <code class="type">"any"</code>, <em class="parameter"><code>value</code></em> <code class="type">"any"</code> ) → <code class="returnvalue">json</code></p> <p class="func_signature" id="id-1.5.8.27.6.2.4.19.1.2.1"> <code class="function" id="jsonb_object_agg_unique">jsonb_object_agg_unique</code> ( <em class="parameter"><code>key</code></em> <code class="type">"any"</code>, <em class="parameter"><code>value</code></em> <code class="type">"any"</code> ) → <code class="returnvalue">jsonb</code></p> <p>Collects all the key/value pairs into a JSON object. Key arguments are coerced to text; value arguments are converted as per <code class="function">to_json</code> or <code class="function">to_jsonb</code>. Values can be null, but keys cannot. If there is a duplicate key an error is thrown.</p> </td> <td>No</td> </tr> <tr> <td class="func_table_entry"> <p class="func_signature" id="id-1.5.8.27.6.2.4.20.1.1.1"> <code class="function" id="json_object_agg_unique_strict">json_object_agg_unique_strict</code> ( <em class="parameter"><code>key</code></em> <code class="type">"any"</code>, <em class="parameter"><code>value</code></em> <code class="type">"any"</code> ) → <code class="returnvalue">json</code></p> <p class="func_signature" id="id-1.5.8.27.6.2.4.20.1.2.1"> <code class="function" id="jsonb_object_agg_unique_strict">jsonb_object_agg_unique_strict</code> ( <em class="parameter"><code>key</code></em> <code class="type">"any"</code>, <em class="parameter"><code>value</code></em> <code class="type">"any"</code> ) → <code class="returnvalue">jsonb</code></p> <p>Collects all the key/value pairs into a JSON object. Key arguments are coerced to text; value arguments are converted as per <code class="function">to_json</code> or <code class="function">to_jsonb</code>. The <em class="parameter"><code>key</code></em> can not be null. If the <em class="parameter"><code>value</code></em> is null then the entry is skipped. If there is a duplicate key an error is thrown.</p> </td> <td>No</td> </tr> <tr> <td class="func_table_entry"> <p class="func_signature" id="id-1.5.8.27.6.2.4.21.1.1.1"> <code class="function" id="max">max</code> ( <code>see text</code> ) → <code class="returnvalue">same as input type</code></p> <p>Computes the maximum of the non-null input values. Available for any numeric, string, date/time, or enum type, as well as <code class="type">inet</code>, <code class="type">interval</code>, <code class="type">money</code>, <code class="type">oid</code>, <code class="type">pg_lsn</code>, <code class="type">tid</code>, <code class="type">xid8</code>, and arrays of any of these types.</p> </td> <td>Yes</td> </tr> <tr> <td class="func_table_entry"> <p class="func_signature" id="id-1.5.8.27.6.2.4.22.1.1.1"> <code class="function" id="min">min</code> ( <code>see text</code> ) → <code class="returnvalue">same as input type</code></p> <p>Computes the minimum of the non-null input values. Available for any numeric, string, date/time, or enum type, as well as <code class="type">inet</code>, <code class="type">interval</code>, <code class="type">money</code>, <code class="type">oid</code>, <code class="type">pg_lsn</code>, <code class="type">tid</code>, <code class="type">xid8</code>, and arrays of any of these types.</p> </td> <td>Yes</td> </tr> <tr> <td class="func_table_entry"> <p class="func_signature" id="id-1.5.8.27.6.2.4.23.1.1.1"> <code class="function" id="range_agg">range_agg</code> ( <em class="parameter"><code>value</code></em> <code class="type">anyrange</code> ) → <code class="returnvalue">anymultirange</code></p> <p class="func_signature"><code class="function">range_agg</code> ( <em class="parameter"><code>value</code></em> <code class="type">anymultirange</code> ) → <code class="returnvalue">anymultirange</code></p> <p>Computes the union of the non-null input values.</p> </td> <td>No</td> </tr> <tr> <td class="func_table_entry"> <p class="func_signature" id="id-1.5.8.27.6.2.4.24.1.1.1"> <code class="function" id="range_intersect_agg">range_intersect_agg</code> ( <em class="parameter"><code>value</code></em> <code class="type">anyrange</code> ) → <code class="returnvalue">anyrange</code></p> <p class="func_signature"><code class="function">range_intersect_agg</code> ( <em class="parameter"><code>value</code></em> <code class="type">anymultirange</code> ) → <code class="returnvalue">anymultirange</code></p> <p>Computes the intersection of the non-null input values.</p> </td> <td>No</td> </tr> <tr> <td class="func_table_entry"> <p class="func_signature" id="id-1.5.8.27.6.2.4.25.1.1.1"> <code class="function" id="string_agg">string_agg</code> ( <em class="parameter"><code>value</code></em> <code class="type">text</code>, <em class="parameter"><code>delimiter</code></em> <code class="type">text</code> ) → <code class="returnvalue">text</code></p> <p class="func_signature"><code class="function">string_agg</code> ( <em class="parameter"><code>value</code></em> <code class="type">bytea</code>, <em class="parameter"><code>delimiter</code></em> <code class="type">bytea</code> <code class="literal">ORDER BY</code> <code class="literal">input_sort_columns</code> ) → <code class="returnvalue">bytea</code></p> <p>Concatenates the non-null input values into a string. Each value after the first is preceded by the corresponding <em class="parameter"><code>delimiter</code></em> (if it's not null).</p> </td> <td>Yes</td> </tr> <tr> <td class="func_table_entry"> <p class="func_signature" id="id-1.5.8.27.6.2.4.26.1.1.1"> <code class="function" id="sum">sum</code> ( <code class="type">smallint</code> ) → <code class="returnvalue">bigint</code></p> <p class="func_signature"><code class="function">sum</code> ( <code class="type">integer</code> ) → <code class="returnvalue">bigint</code></p> <p class="func_signature"><code class="function">sum</code> ( <code class="type">bigint</code> ) → <code class="returnvalue">numeric</code></p> <p class="func_signature"><code class="function">sum</code> ( <code class="type">numeric</code> ) → <code class="returnvalue">numeric</code></p> <p class="func_signature"><code class="function">sum</code> ( <code class="type">real</code> ) → <code class="returnvalue">real</code></p> <p class="func_signature"><code class="function">sum</code> ( <code class="type">double precision</code> ) → <code class="returnvalue">double precision</code></p> <p class="func_signature"><code class="function">sum</code> ( <code class="type">interval</code> ) → <code class="returnvalue">interval</code></p> <p class="func_signature"><code class="function">sum</code> ( <code class="type">money</code> ) → <code class="returnvalue">money</code></p> <p>Computes the sum of the non-null input values.</p> </td> <td>Yes</td> </tr> <tr> <td class="func_table_entry"> <p class="func_signature" id="id-1.5.8.27.6.2.4.27.1.1.1"> <code class="function" id="xmlagg">xmlagg</code> ( <code class="type">xml</code> <code class="literal">ORDER BY</code> <code class="literal">input_sort_columns</code> ) → <code class="returnvalue">xml</code></p> <p>Concatenates the non-null XML input values (see <a class="xref" href="functions-xml.html#FUNCTIONS-XML-XMLAGG" title="9.15.1.8. xmlagg">Section 9.15.1.8</a>).</p> </td> <td>No</td> </tr> </tbody> </table> </div> </div> <p>It should be noted that except for <code class="function">count</code>, these functions return a null value when no rows are selected. In particular, <code class="function">sum</code> of no rows returns null, not zero as one might expect, and <code class="function">array_agg</code> returns null rather than an empty array when there are no input rows. The <code class="function">coalesce</code> function can be used to substitute zero or an empty array for null when necessary.</p> <p>The aggregate functions <code class="function">array_agg</code>, <code class="function">json_agg</code>, <code class="function">jsonb_agg</code>, <code class="function">json_agg_strict</code>, <code class="function">jsonb_agg_strict</code>, <code class="function">json_object_agg</code>, <code class="function">jsonb_object_agg</code>, <code class="function">json_object_agg_strict</code>, <code class="function">jsonb_object_agg_strict</code>, <code class="function">json_object_agg_unique</code>, <code class="function">jsonb_object_agg_unique</code>, <code class="function">json_object_agg_unique_strict</code>, <code class="function">jsonb_object_agg_unique_strict</code>, <code class="function">string_agg</code>, and <code class="function">xmlagg</code>, as well as similar user-defined aggregate functions, produce meaningfully different result values depending on the order of the input values. This ordering is unspecified by default, but can be controlled by writing an <code class="literal">ORDER BY</code> clause within the aggregate call, as shown in <a class="xref" href="sql-expressions.html#SYNTAX-AGGREGATES" title="4.2.7. Aggregate Expressions">Section 4.2.7</a>. Alternatively, supplying the input values from a sorted subquery will usually work. For example:</p> <pre>
SELECT xmlagg(x) FROM (SELECT x FROM test ORDER BY y DESC) AS tab;
</pre> <p>Beware that this approach can fail if the outer query level contains additional processing, such as a join, because that might cause the subquery's output to be reordered before the aggregate is computed.</p> <blockquote class="note" id="id-1.5.8.27.9.2"> <h3 class="title">Note</h3> <p>The boolean aggregates <code class="function">bool_and</code> and <code class="function">bool_or</code> correspond to the standard SQL aggregates <code class="function">every</code> and <code class="function">any</code> or <code class="function">some</code>. PostgreSQL supports <code class="function">every</code>, but not <code class="function">any</code> or <code class="function">some</code>, because there is an ambiguity built into the standard syntax:</p> <pre data-language="sql">
SELECT b1 = ANY((SELECT b2 FROM t2 ...)) FROM t1 ...;
</pre> <p>Here <code class="function">ANY</code> can be considered either as introducing a subquery, or as being an aggregate function, if the subquery returns one row with a Boolean value. Thus the standard name cannot be given to these aggregates.</p> </blockquote> <blockquote class="note"> <h3 class="title">Note</h3> <p>Users accustomed to working with other SQL database management systems might be disappointed by the performance of the <code class="function">count</code> aggregate when it is applied to the entire table. A query like:</p> <pre data-language="sql">
SELECT count(*) FROM sometable;
</pre> <p>will require effort proportional to the size of the table: PostgreSQL will need to scan either the entire table or the entirety of an index that includes all rows in the table.</p> </blockquote> <p><a class="xref" href="functions-aggregate.html#FUNCTIONS-AGGREGATE-STATISTICS-TABLE" title="Table 9.61. Aggregate Functions for Statistics">Table 9.61</a> shows aggregate functions typically used in statistical analysis. (These are separated out merely to avoid cluttering the listing of more-commonly-used aggregates.) Functions shown as accepting <code>numeric_type</code> are available for all the types <code class="type">smallint</code>, <code class="type">integer</code>, <code class="type">bigint</code>, <code class="type">numeric</code>, <code class="type">real</code>, and <code class="type">double precision</code>. Where the description mentions <em class="parameter"><code>N</code></em>, it means the number of input rows for which all the input expressions are non-null. In all cases, null is returned if the computation is meaningless, for example when <em class="parameter"><code>N</code></em> is zero.</p> <div class="table" id="FUNCTIONS-AGGREGATE-STATISTICS-TABLE"> <p class="title"><strong>Table 9.61. Aggregate Functions for Statistics</strong></p> <div class="table-contents"> <table class="table" summary="Aggregate Functions for Statistics"> <colgroup> <col class="col1"> <col class="col2"> </colgroup> <thead> <tr> <th class="func_table_entry"> <p class="func_signature">Function</p> <p>Description</p> </th> <th>Partial Mode</th> </tr> </thead> <tbody> <tr> <td class="func_table_entry"> <p class="func_signature" id="id-1.5.8.27.14.2.4.1.1.1.2">  <code class="function" id="corr">corr</code> ( <em class="parameter"><code>Y</code></em> <code class="type">double precision</code>, <em class="parameter"><code>X</code></em> <code class="type">double precision</code> ) → <code class="returnvalue">double precision</code></p> <p>Computes the correlation coefficient.</p> </td> <td>Yes</td> </tr> <tr> <td class="func_table_entry"> <p class="func_signature" id="id-1.5.8.27.14.2.4.2.1.1.2">  <code class="function" id="covar_pop">covar_pop</code> ( <em class="parameter"><code>Y</code></em> <code class="type">double precision</code>, <em class="parameter"><code>X</code></em> <code class="type">double precision</code> ) → <code class="returnvalue">double precision</code></p> <p>Computes the population covariance.</p> </td> <td>Yes</td> </tr> <tr> <td class="func_table_entry"> <p class="func_signature" id="id-1.5.8.27.14.2.4.3.1.1.2">  <code class="function" id="covar_samp">covar_samp</code> ( <em class="parameter"><code>Y</code></em> <code class="type">double precision</code>, <em class="parameter"><code>X</code></em> <code class="type">double precision</code> ) → <code class="returnvalue">double precision</code></p> <p>Computes the sample covariance.</p> </td> <td>Yes</td> </tr> <tr> <td class="func_table_entry"> <p class="func_signature" id="id-1.5.8.27.14.2.4.4.1.1.1"> <code class="function" id="regr_avgx">regr_avgx</code> ( <em class="parameter"><code>Y</code></em> <code class="type">double precision</code>, <em class="parameter"><code>X</code></em> <code class="type">double precision</code> ) → <code class="returnvalue">double precision</code></p> <p>Computes the average of the independent variable, <code class="literal">sum(<em class="parameter">X</em>)/<em class="parameter">N</em></code>.</p> </td> <td>Yes</td> </tr> <tr> <td class="func_table_entry"> <p class="func_signature" id="id-1.5.8.27.14.2.4.5.1.1.1"> <code class="function" id="regr_avgy">regr_avgy</code> ( <em class="parameter"><code>Y</code></em> <code class="type">double precision</code>, <em class="parameter"><code>X</code></em> <code class="type">double precision</code> ) → <code class="returnvalue">double precision</code></p> <p>Computes the average of the dependent variable, <code class="literal">sum(<em class="parameter">Y</em>)/<em class="parameter">N</em></code>.</p> </td> <td>Yes</td> </tr> <tr> <td class="func_table_entry"> <p class="func_signature" id="id-1.5.8.27.14.2.4.6.1.1.1"> <code class="function" id="regr_count">regr_count</code> ( <em class="parameter"><code>Y</code></em> <code class="type">double precision</code>, <em class="parameter"><code>X</code></em> <code class="type">double precision</code> ) → <code class="returnvalue">bigint</code></p> <p>Computes the number of rows in which both inputs are non-null.</p> </td> <td>Yes</td> </tr> <tr> <td class="func_table_entry"> <p class="func_signature" id="id-1.5.8.27.14.2.4.7.1.1.2">  <code class="function" id="regr_intercept">regr_intercept</code> ( <em class="parameter"><code>Y</code></em> <code class="type">double precision</code>, <em class="parameter"><code>X</code></em> <code class="type">double precision</code> ) → <code class="returnvalue">double precision</code></p> <p>Computes the y-intercept of the least-squares-fit linear equation determined by the (<em class="parameter"><code>X</code></em>, <em class="parameter"><code>Y</code></em>) pairs.</p> </td> <td>Yes</td> </tr> <tr> <td class="func_table_entry"> <p class="func_signature" id="id-1.5.8.27.14.2.4.8.1.1.1"> <code class="function" id="regr_r2">regr_r2</code> ( <em class="parameter"><code>Y</code></em> <code class="type">double precision</code>, <em class="parameter"><code>X</code></em> <code class="type">double precision</code> ) → <code class="returnvalue">double precision</code></p> <p>Computes the square of the correlation coefficient.</p> </td> <td>Yes</td> </tr> <tr> <td class="func_table_entry"> <p class="func_signature" id="id-1.5.8.27.14.2.4.9.1.1.2">  <code class="function" id="regr_slope">regr_slope</code> ( <em class="parameter"><code>Y</code></em> <code class="type">double precision</code>, <em class="parameter"><code>X</code></em> <code class="type">double precision</code> ) → <code class="returnvalue">double precision</code></p> <p>Computes the slope of the least-squares-fit linear equation determined by the (<em class="parameter"><code>X</code></em>, <em class="parameter"><code>Y</code></em>) pairs.</p> </td> <td>Yes</td> </tr> <tr> <td class="func_table_entry"> <p class="func_signature" id="id-1.5.8.27.14.2.4.10.1.1.1"> <code class="function" id="regr_sxx">regr_sxx</code> ( <em class="parameter"><code>Y</code></em> <code class="type">double precision</code>, <em class="parameter"><code>X</code></em> <code class="type">double precision</code> ) → <code class="returnvalue">double precision</code></p> <p>Computes the <span class="quote">“<span class="quote">sum of squares</span>”</span> of the independent variable, <code class="literal">sum(<em class="parameter">X</em>^2) - sum(<em class="parameter">X</em>)^2/<em class="parameter">N</em></code>.</p> </td> <td>Yes</td> </tr> <tr> <td class="func_table_entry"> <p class="func_signature" id="id-1.5.8.27.14.2.4.11.1.1.1"> <code class="function" id="regr_sxy">regr_sxy</code> ( <em class="parameter"><code>Y</code></em> <code class="type">double precision</code>, <em class="parameter"><code>X</code></em> <code class="type">double precision</code> ) → <code class="returnvalue">double precision</code></p> <p>Computes the <span class="quote">“<span class="quote">sum of products</span>”</span> of independent times dependent variables, <code class="literal">sum(<em class="parameter">X</em>*<em class="parameter">Y</em>) - sum(<em class="parameter">X</em>) * sum(<em class="parameter">Y</em>)/<em class="parameter">N</em></code>.</p> </td> <td>Yes</td> </tr> <tr> <td class="func_table_entry"> <p class="func_signature" id="id-1.5.8.27.14.2.4.12.1.1.1"> <code class="function" id="regr_syy">regr_syy</code> ( <em class="parameter"><code>Y</code></em> <code class="type">double precision</code>, <em class="parameter"><code>X</code></em> <code class="type">double precision</code> ) → <code class="returnvalue">double precision</code></p> <p>Computes the <span class="quote">“<span class="quote">sum of squares</span>”</span> of the dependent variable, <code class="literal">sum(<em class="parameter">Y</em>^2) - sum(<em class="parameter">Y</em>)^2/<em class="parameter">N</em></code>.</p> </td> <td>Yes</td> </tr> <tr> <td class="func_table_entry"> <p class="func_signature" id="id-1.5.8.27.14.2.4.13.1.1.2">  <code class="function" id="stddev">stddev</code> ( <code>numeric_type</code> ) → <code class="type">double precision</code> for <code class="type">real</code> or <code class="type">double precision</code>, otherwise <code class="type">numeric</code></p> <p>This is a historical alias for <code class="function" id="stddev_samp">stddev_samp</code>.</p> </td> <td>Yes</td> </tr> <tr> <td class="func_table_entry"> <p class="func_signature" id="id-1.5.8.27.14.2.4.14.1.1.2">  <code class="function" id="stddev_pop">stddev_pop</code> ( <code>numeric_type</code> ) → <code class="type">double precision</code> for <code class="type">real</code> or <code class="type">double precision</code>, otherwise <code class="type">numeric</code></p> <p>Computes the population standard deviation of the input values.</p> </td> <td>Yes</td> </tr> <tr> <td class="func_table_entry"> <p class="func_signature" id="id-1.5.8.27.14.2.4.15.1.1.2">  <code class="function">stddev_samp</code> ( <code>numeric_type</code> ) → <code class="type">double precision</code> for <code class="type">real</code> or <code class="type">double precision</code>, otherwise <code class="type">numeric</code></p> <p>Computes the sample standard deviation of the input values.</p> </td> <td>Yes</td> </tr> <tr> <td class="func_table_entry"> <p class="func_signature" id="id-1.5.8.27.14.2.4.16.1.1.1"> <code class="function" id="variance">variance</code> ( <code>numeric_type</code> ) → <code class="type">double precision</code> for <code class="type">real</code> or <code class="type">double precision</code>, otherwise <code class="type">numeric</code></p> <p>This is a historical alias for <code class="function" id="var_samp">var_samp</code>.</p> </td> <td>Yes</td> </tr> <tr> <td class="func_table_entry"> <p class="func_signature" id="id-1.5.8.27.14.2.4.17.1.1.2">  <code class="function" id="var_pop">var_pop</code> ( <code>numeric_type</code> ) → <code class="type">double precision</code> for <code class="type">real</code> or <code class="type">double precision</code>, otherwise <code class="type">numeric</code></p> <p>Computes the population variance of the input values (square of the population standard deviation).</p> </td> <td>Yes</td> </tr> <tr> <td class="func_table_entry"> <p class="func_signature" id="id-1.5.8.27.14.2.4.18.1.1.2">  <code class="function">var_samp</code> ( <code>numeric_type</code> ) → <code class="type">double precision</code> for <code class="type">real</code> or <code class="type">double precision</code>, otherwise <code class="type">numeric</code></p> <p>Computes the sample variance of the input values (square of the sample standard deviation).</p> </td> <td>Yes</td> </tr> </tbody> </table> </div> </div> <p><a class="xref" href="functions-aggregate.html#FUNCTIONS-ORDEREDSET-TABLE" title="Table 9.62. Ordered-Set Aggregate Functions">Table 9.62</a> shows some aggregate functions that use the <em class="firstterm">ordered-set aggregate</em> syntax. These functions are sometimes referred to as <span class="quote">“<span class="quote">inverse distribution</span>”</span> functions. Their aggregated input is introduced by <code class="literal">ORDER BY</code>, and they may also take a <em class="firstterm">direct argument</em> that is not aggregated, but is computed only once. All these functions ignore null values in their aggregated input. For those that take a <em class="parameter"><code>fraction</code></em> parameter, the fraction value must be between 0 and 1; an error is thrown if not. However, a null <em class="parameter"><code>fraction</code></em> value simply produces a null result.</p> <div class="table" id="FUNCTIONS-ORDEREDSET-TABLE"> <p class="title"><strong>Table 9.62. Ordered-Set Aggregate Functions</strong></p> <div class="table-contents"> <table class="table" summary="Ordered-Set Aggregate Functions"> <colgroup> <col class="col1"> <col class="col2"> </colgroup> <thead> <tr> <th class="func_table_entry"> <p class="func_signature">Function</p> <p>Description</p> </th> <th>Partial Mode</th> </tr> </thead> <tbody> <tr> <td class="func_table_entry"> <p class="func_signature" id="id-1.5.8.27.18.2.4.1.1.1.1"> <code class="function" id="mode">mode</code> () <code class="literal" id="within32group">WITHIN GROUP</code> ( <code class="literal">ORDER BY</code> <code class="type">anyelement</code> ) → <code class="returnvalue">anyelement</code></p> <p>Computes the <em class="firstterm">mode</em>, the most frequent value of the aggregated argument (arbitrarily choosing the first one if there are multiple equally-frequent values). The aggregated argument must be of a sortable type.</p> </td> <td>No</td> </tr> <tr> <td class="func_table_entry"> <p class="func_signature" id="id-1.5.8.27.18.2.4.2.1.1.1"> <code class="function" id="percentile_cont">percentile_cont</code> ( <em class="parameter"><code>fraction</code></em> <code class="type">double precision</code> ) <code class="literal">WITHIN GROUP</code> ( <code class="literal">ORDER BY</code> <code class="type">double precision</code> ) → <code class="returnvalue">double precision</code></p> <p class="func_signature"><code class="function">percentile_cont</code> ( <em class="parameter"><code>fraction</code></em> <code class="type">double precision</code> ) <code class="literal">WITHIN GROUP</code> ( <code class="literal">ORDER BY</code> <code class="type">interval</code> ) → <code class="returnvalue">interval</code></p> <p>Computes the <em class="firstterm">continuous percentile</em>, a value corresponding to the specified <em class="parameter"><code>fraction</code></em> within the ordered set of aggregated argument values. This will interpolate between adjacent input items if needed.</p> </td> <td>No</td> </tr> <tr> <td class="func_table_entry"> <p class="func_signature"><code class="function">percentile_cont</code> ( <em class="parameter"><code>fractions</code></em> <code class="type">double precision[]</code> ) <code class="literal">WITHIN GROUP</code> ( <code class="literal">ORDER BY</code> <code class="type">double precision</code> ) → <code class="returnvalue">double precision[]</code></p> <p class="func_signature"><code class="function">percentile_cont</code> ( <em class="parameter"><code>fractions</code></em> <code class="type">double precision[]</code> ) <code class="literal">WITHIN GROUP</code> ( <code class="literal">ORDER BY</code> <code class="type">interval</code> ) → <code class="returnvalue">interval[]</code></p> <p>Computes multiple continuous percentiles. The result is an array of the same dimensions as the <em class="parameter"><code>fractions</code></em> parameter, with each non-null element replaced by the (possibly interpolated) value corresponding to that percentile.</p> </td> <td>No</td> </tr> <tr> <td class="func_table_entry"> <p class="func_signature" id="id-1.5.8.27.18.2.4.4.1.1.1"> <code class="function" id="percentile_disc">percentile_disc</code> ( <em class="parameter"><code>fraction</code></em> <code class="type">double precision</code> ) <code class="literal">WITHIN GROUP</code> ( <code class="literal">ORDER BY</code> <code class="type">anyelement</code> ) → <code class="returnvalue">anyelement</code></p> <p>Computes the <em class="firstterm">discrete percentile</em>, the first value within the ordered set of aggregated argument values whose position in the ordering equals or exceeds the specified <em class="parameter"><code>fraction</code></em>. The aggregated argument must be of a sortable type.</p> </td> <td>No</td> </tr> <tr> <td class="func_table_entry"> <p class="func_signature"><code class="function">percentile_disc</code> ( <em class="parameter"><code>fractions</code></em> <code class="type">double precision[]</code> ) <code class="literal">WITHIN GROUP</code> ( <code class="literal">ORDER BY</code> <code class="type">anyelement</code> ) → <code class="returnvalue">anyarray</code></p> <p>Computes multiple discrete percentiles. The result is an array of the same dimensions as the <em class="parameter"><code>fractions</code></em> parameter, with each non-null element replaced by the input value corresponding to that percentile. The aggregated argument must be of a sortable type.</p> </td> <td>No</td> </tr> </tbody> </table> </div> </div>  <p>Each of the <span class="quote">“<span class="quote">hypothetical-set</span>”</span> aggregates listed in <a class="xref" href="functions-aggregate.html#FUNCTIONS-HYPOTHETICAL-TABLE" title="Table 9.63. Hypothetical-Set Aggregate Functions">Table 9.63</a> is associated with a window function of the same name defined in <a class="xref" href="functions-window.html" title="9.22. Window Functions">Section 9.22</a>. In each case, the aggregate's result is the value that the associated window function would have returned for the <span class="quote">“<span class="quote">hypothetical</span>”</span> row constructed from <code>args</code>, if such a row had been added to the sorted group of rows represented by the <code>sorted_args</code>. For each of these functions, the list of direct arguments given in <code>args</code> must match the number and types of the aggregated arguments given in <code>sorted_args</code>. Unlike most built-in aggregates, these aggregates are not strict, that is they do not drop input rows containing nulls. Null values sort according to the rule specified in the <code class="literal">ORDER BY</code> clause.</p> <div class="table" id="FUNCTIONS-HYPOTHETICAL-TABLE"> <p class="title"><strong>Table 9.63. Hypothetical-Set Aggregate Functions</strong></p> <div class="table-contents"> <table class="table" summary="Hypothetical-Set Aggregate Functions"> <colgroup> <col class="col1"> <col class="col2"> </colgroup> <thead> <tr> <th class="func_table_entry"> <p class="func_signature">Function</p> <p>Description</p> </th> <th>Partial Mode</th> </tr> </thead> <tbody> <tr> <td class="func_table_entry"> <p class="func_signature" id="id-1.5.8.27.21.2.4.1.1.1.1"> <code class="function" id="rank">rank</code> ( <code>args</code> ) <code class="literal">WITHIN GROUP</code> ( <code class="literal">ORDER BY</code> <code>sorted_args</code> ) → <code class="returnvalue">bigint</code></p> <p>Computes the rank of the hypothetical row, with gaps; that is, the row number of the first row in its peer group.</p> </td> <td>No</td> </tr> <tr> <td class="func_table_entry"> <p class="func_signature" id="id-1.5.8.27.21.2.4.2.1.1.1"> <code class="function" id="dense_rank">dense_rank</code> ( <code>args</code> ) <code class="literal">WITHIN GROUP</code> ( <code class="literal">ORDER BY</code> <code>sorted_args</code> ) → <code class="returnvalue">bigint</code></p> <p>Computes the rank of the hypothetical row, without gaps; this function effectively counts peer groups.</p> </td> <td>No</td> </tr> <tr> <td class="func_table_entry"> <p class="func_signature" id="id-1.5.8.27.21.2.4.3.1.1.1"> <code class="function" id="percent_rank">percent_rank</code> ( <code>args</code> ) <code class="literal">WITHIN GROUP</code> ( <code class="literal">ORDER BY</code> <code>sorted_args</code> ) → <code class="returnvalue">double precision</code></p> <p>Computes the relative rank of the hypothetical row, that is (<code class="function">rank</code> - 1) / (total rows - 1). The value thus ranges from 0 to 1 inclusive.</p> </td> <td>No</td> </tr> <tr> <td class="func_table_entry"> <p class="func_signature" id="id-1.5.8.27.21.2.4.4.1.1.1"> <code class="function" id="cume_dist">cume_dist</code> ( <code>args</code> ) <code class="literal">WITHIN GROUP</code> ( <code class="literal">ORDER BY</code> <code>sorted_args</code> ) → <code class="returnvalue">double precision</code></p> <p>Computes the cumulative distribution, that is (number of rows preceding or peers with hypothetical row) / (total rows). The value thus ranges from 1/<em class="parameter"><code>N</code></em> to 1.</p> </td> <td>No</td> </tr> </tbody> </table> </div> </div> <div class="table" id="FUNCTIONS-GROUPING-TABLE"> <p class="title"><strong>Table 9.64. Grouping Operations</strong></p> <div class="table-contents"> <table class="table" summary="Grouping Operations"> <colgroup> <col> </colgroup> <thead> <tr> <th class="func_table_entry"> <p class="func_signature">Function</p> <p>Description</p> </th> </tr> </thead> <tbody> <tr> <td class="func_table_entry"> <p class="func_signature" id="id-1.5.8.27.22.2.2.1.1.1.1"> <code class="function" id="grouping">GROUPING</code> ( <code>group_by_expression(s)</code> ) → <code class="returnvalue">integer</code></p> <p>Returns a bit mask indicating which <code class="literal">GROUP BY</code> expressions are not included in the current grouping set. Bits are assigned with the rightmost argument corresponding to the least-significant bit; each bit is 0 if the corresponding expression is included in the grouping criteria of the grouping set generating the current result row, and 1 if it is not included.</p> </td> </tr> </tbody> </table> </div> </div> <p>The grouping operations shown in <a class="xref" href="functions-aggregate.html#FUNCTIONS-GROUPING-TABLE" title="Table 9.64. Grouping Operations">Table 9.64</a> are used in conjunction with grouping sets (see <a class="xref" href="queries-table-expressions.html#QUERIES-GROUPING-SETS" title="7.2.4. GROUPING SETS, CUBE, and ROLLUP">Section 7.2.4</a>) to distinguish result rows. The arguments to the <code class="literal">GROUPING</code> function are not actually evaluated, but they must exactly match expressions given in the <code class="literal">GROUP BY</code> clause of the associated query level. For example:</p> <pre>
=&gt; <strong class="userinput">SELECT * FROM items_sold;</strong>
 make  | model | sales
-------+-------+-------
 Foo   | GT    |  10
 Foo   | Tour  |  20
 Bar   | City  |  15
 Bar   | Sport |  5
(4 rows)

=&gt; <strong class="userinput">SELECT make, model, GROUPING(make,model), sum(sales) FROM items_sold GROUP BY ROLLUP(make,model);</strong>
 make  | model | grouping | sum
-------+-------+----------+-----
 Foo   | GT    |        0 | 10
 Foo   | Tour  |        0 | 20
 Bar   | City  |        0 | 15
 Bar   | Sport |        0 | 5
 Foo   |       |        1 | 30
 Bar   |       |        1 | 20
       |       |        3 | 50
(7 rows)
</pre> <p>Here, the <code class="literal">grouping</code> value <code class="literal">0</code> in the first four rows shows that those have been grouped normally, over both the grouping columns. The value <code class="literal">1</code> indicates that <code class="literal">model</code> was not grouped by in the next-to-last two rows, and the value <code class="literal">3</code> indicates that neither <code class="literal">make</code> nor <code class="literal">model</code> was grouped by in the last row (which therefore is an aggregate over all the input rows).</p><div class="_attribution">
  <p class="_attribution-p">
    &copy; 1996&ndash;2024 The PostgreSQL Global Development Group<br>Licensed under the PostgreSQL License.<br>
    <a href="https://www.postgresql.org/docs/17/functions-aggregate.html" class="_attribution-link">https://www.postgresql.org/docs/17/functions-aggregate.html</a>
  </p>
</div>
