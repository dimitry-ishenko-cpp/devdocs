<h1>pg_combinebackup</h1> <p>pg_combinebackup — reconstruct a full backup from an incremental backup and dependent backups</p>   <h2>Synopsis</h2> <div class="cmdsynopsis"> <p id="id-1.9.4.12.4.1"><code class="command">pg_combinebackup</code> [<code>option</code>...] [<code>backup_directory</code>...]</p> </div>  <div class="refsect1" id="id-1.9.4.12.5"> <h2>Description</h2> <p>pg_combinebackup is used to reconstruct a synthetic full backup from an <a class="link" href="continuous-archiving.html#BACKUP-INCREMENTAL-BACKUP" title="25.3.3. Making an Incremental Backup">incremental backup</a> and the earlier backups upon which it depends.</p> <p>Specify all of the required backups on the command line from oldest to newest. That is, the first backup directory should be the path to the full backup, and the last should be the path to the final incremental backup that you wish to restore. The reconstructed backup will be written to the output directory specified by the <code class="option">-o</code> option.</p> <p>pg_combinebackup will attempt to verify that the backups you specify form a legal backup chain from which a correct full backup can be reconstructed. However, it is not designed to help you keep track of which backups depend on which other backups. If you remove one or more of the previous backups upon which your incremental backup relies, you will not be able to restore it. Moreover, pg_combinebackup only attempts to verify that the backups have the correct relationship to each other, not that each individual backup is intact; for that, use <a class="xref" href="app-pgverifybackup.html" title="pg_verifybackup">pg_verifybackup</a>.</p> <p>Since the output of pg_combinebackup is a synthetic full backup, it can be used as an input to a future invocation of pg_combinebackup. The synthetic full backup would be specified on the command line in lieu of the chain of backups from which it was reconstructed.</p> </div> <div class="refsect1" id="id-1.9.4.12.6"> <h2>Options</h2> <div class="variablelist"> <dl class="variablelist"> <dt>
<code class="option">-d</code><code class="option">--debug</code>
</dt> <dd> <p>Print lots of debug logging output on <code class="filename">stderr</code>.</p> </dd> <dt>
<code class="option">-n</code><code class="option">--dry-run</code>
</dt> <dd> <p>The <code class="option">-n</code>/<code class="option">--dry-run</code> option instructs <code class="command">pg_combinebackup</code> to figure out what would be done without actually creating the target directory or any output files. It is particularly useful in combination with <code class="option">--debug</code>.</p> </dd> <dt>
<code class="option">-N</code><code class="option">--no-sync</code>
</dt> <dd> <p>By default, <code class="command">pg_combinebackup</code> will wait for all files to be written safely to disk. This option causes <code class="command">pg_combinebackup</code> to return without waiting, which is faster, but means that a subsequent operating system crash can leave the output backup corrupt. Generally, this option is useful for testing but should not be used when creating a production installation.</p> </dd> <dt>
<code class="option">-o outputdir</code><code class="option">--output=outputdir</code>
</dt> <dd> <p>Specifies the output directory to which the synthetic full backup should be written. Currently, this argument is required.</p> </dd> <dt>
<code class="option">-T olddir=newdir</code><code class="option">--tablespace-mapping=olddir=newdir</code>
</dt> <dd> <p>Relocates the tablespace in directory <code>olddir</code> to <code>newdir</code> during the backup. <code>olddir</code> is the absolute path of the tablespace as it exists in the final backup specified on the command line, and <code>newdir</code> is the absolute path to use for the tablespace in the reconstructed backup. If either path needs to contain an equal sign (<code class="literal">=</code>), precede that with a backslash. This option can be specified multiple times for multiple tablespaces.</p> </dd> <dt><code class="option">--clone</code></dt> <dd> <p>Use efficient file cloning (also known as <span class="quote">“<span class="quote">reflinks</span>”</span> on some systems) instead of copying files to the new data directory, which can result in near-instantaneous copying of the data files.</p> <p>If a backup manifest is not available or does not contain checksum of the right type, file cloning will be used to copy the file, but the file will be also read block-by-block for the checksum calculation.</p> <p>File cloning is only supported on some operating systems and file systems. If it is selected but not supported, the pg_combinebackup run will error. At present, it is supported on Linux (kernel 4.5 or later) with Btrfs and XFS (on file systems created with reflink support), and on macOS with APFS.</p> </dd> <dt><code class="option">--copy</code></dt> <dd> <p>Perform regular file copy. This is the default. (See also <code class="option">--copy-file-range</code> and <code class="option">--clone</code>.)</p> </dd> <dt><code class="option">--copy-file-range</code></dt> <dd> <p>Use the <code class="function">copy_file_range</code> system call for efficient copying. On some file systems this gives results similar to <code class="option">--clone</code>, sharing physical disk blocks, while on others it may still copy blocks, but do so via an optimized path. At present, it is supported on Linux and FreeBSD.</p> <p>If a backup manifest is not available or does not contain checksum of the right type, <code class="function">copy_file_range</code> will be used to copy the file, but the file will be also read block-by-block for the checksum calculation.</p> </dd> <dt><code class="option">--manifest-checksums=algorithm</code></dt> <dd> <p>Like <a class="xref" href="app-pgbasebackup.html" title="pg_basebackup">pg_basebackup</a>, pg_combinebackup writes a backup manifest in the output directory. This option specifies the checksum algorithm that should be applied to each file included in the backup manifest. Currently, the available algorithms are <code class="literal">NONE</code>, <code class="literal">CRC32C</code>, <code class="literal">SHA224</code>, <code class="literal">SHA256</code>, <code class="literal">SHA384</code>, and <code class="literal">SHA512</code>. The default is <code class="literal">CRC32C</code>.</p> </dd> <dt><code class="option">--no-manifest</code></dt> <dd> <p>Disables generation of a backup manifest. If this option is not specified, a backup manifest for the reconstructed backup will be written to the output directory.</p> </dd> <dt><code class="option">--sync-method=method</code></dt> <dd> <p>When set to <code class="literal">fsync</code>, which is the default, <code class="command">pg_combinebackup</code> will recursively open and synchronize all files in the backup directory. When the plain format is used, the search for files will follow symbolic links for the WAL directory and each configured tablespace.</p> <p>On Linux, <code class="literal">syncfs</code> may be used instead to ask the operating system to synchronize the whole file system that contains the backup directory. When the plain format is used, <code class="command">pg_combinebackup</code> will also synchronize the file systems that contain the WAL files and each tablespace. See <a class="xref" href="runtime-config-error-handling.html#GUC-RECOVERY-INIT-SYNC-METHOD">recovery_init_sync_method</a> for information about the caveats to be aware of when using <code class="literal">syncfs</code>.</p> <p>This option has no effect when <code class="option">--no-sync</code> is used.</p> </dd> <dt>
<code class="option">-V</code><code class="option">--version</code>
</dt> <dd> <p>Prints the pg_combinebackup version and exits.</p> </dd> <dt>
<code class="option">-?</code><code class="option">--help</code>
</dt> <dd> <p>Shows help about pg_combinebackup command line arguments, and exits.</p> </dd> </dl> </div> </div> <div class="refsect1" id="APP-PGCOMBINEBACKUP-LIMITATIONS"> <h2>Limitations</h2> <p><code class="literal">pg_combinebackup</code> does not recompute page checksums when writing the output directory. Therefore, if any of the backups used for reconstruction were taken with checksums disabled, but the final backup was taken with checksums enabled, the resulting directory may contain pages with invalid checksums.</p> <p>To avoid this problem, taking a new full backup after changing the checksum state of the cluster using <a class="xref" href="app-pgchecksums.html" title="pg_checksums">pg_checksums</a> is recommended. Otherwise, you can disable and then optionally reenable checksums on the directory produced by <code class="literal">pg_combinebackup</code> in order to correct the problem.</p> </div> <div class="refsect1" id="id-1.9.4.12.8"> <h2>Environment</h2> <p>This utility, like most other PostgreSQL utilities, uses the environment variables supported by libpq (see <a class="xref" href="https://www.postgresql.org/docs/17/libpq-envars.html" title="32.15. Environment Variables">Section 32.15</a>).</p> <p>The environment variable <code class="envar">PG_COLOR</code> specifies whether to use color in diagnostic messages. Possible values are <code class="literal">always</code>, <code class="literal">auto</code> and <code class="literal">never</code>.</p> </div> <div class="refsect1" id="id-1.9.4.12.9"> <h2>See Also</h2>
<span class="simplelist"><a class="xref" href="app-pgbasebackup.html" title="pg_basebackup">pg_basebackup</a></span> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 1996&ndash;2024 The PostgreSQL Global Development Group<br>Licensed under the PostgreSQL License.<br>
    <a href="https://www.postgresql.org/docs/17/app-pgcombinebackup.html" class="_attribution-link">https://www.postgresql.org/docs/17/app-pgcombinebackup.html</a>
  </p>
</div>
