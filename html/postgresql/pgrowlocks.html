<h1>F.31. pgrowlocks — show a table's row locking information </h1>    <div class="toc"> <dl class="toc"> <dt><a href="pgrowlocks.html#PGROWLOCKS-OVERVIEW">F.31.1. Overview</a></dt> <dt><a href="pgrowlocks.html#PGROWLOCKS-SAMPLE-OUTPUT">F.31.2. Sample Output</a></dt> <dt><a href="pgrowlocks.html#PGROWLOCKS-AUTHOR">F.31.3. Author</a></dt> </dl> </div> <p>The <code class="filename">pgrowlocks</code> module provides a function to show row locking information for a specified table.</p> <p>By default use is restricted to superusers, roles with privileges of the <code class="literal">pg_stat_scan_tables</code> role, and users with <code class="literal">SELECT</code> permissions on the table.</p> <div class="sect2" id="id-1.11.7.41.5.2">    <h2 class="title">F.31.1. Overview </h2>    <pre data-language="sql">
pgrowlocks(text) returns setof record
</pre> <p>The parameter is the name of a table. The result is a set of records, with one row for each locked row within the table. The output columns are shown in <a class="xref" href="pgrowlocks.html#PGROWLOCKS-COLUMNS" title="Table F.21. pgrowlocks Output Columns">Table F.21</a>.</p> <div class="table" id="PGROWLOCKS-COLUMNS"> <p class="title"><strong>Table F.21. <code class="function">pgrowlocks</code> Output Columns</strong></p> <div class="table-contents"> <table class="table" summary="pgrowlocks Output Columns"> <colgroup> <col> <col> <col> </colgroup> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code class="structfield">locked_row</code></td> <td><code class="type">tid</code></td> <td>Tuple ID (TID) of locked row</td> </tr> <tr> <td><code class="structfield">locker</code></td> <td><code class="type">xid</code></td> <td>Transaction ID of locker, or multixact ID if multitransaction; see <a class="xref" href="transaction-id.html" title="74.1. Transactions and Identifiers">Section 74.1</a>
</td> </tr> <tr> <td><code class="structfield">multi</code></td> <td><code class="type">boolean</code></td> <td>True if locker is a multitransaction</td> </tr> <tr> <td><code class="structfield">xids</code></td> <td><code class="type">xid[]</code></td> <td>Transaction IDs of lockers (more than one if multitransaction)</td> </tr> <tr> <td><code class="structfield">modes</code></td> <td><code class="type">text[]</code></td> <td>Lock mode of lockers (more than one if multitransaction), an array of <code class="literal">Key Share</code>, <code class="literal">Share</code>, <code class="literal">For No Key Update</code>, <code class="literal">No Key Update</code>, <code class="literal">For Update</code>, <code class="literal">Update</code>.</td> </tr> <tr> <td><code class="structfield">pids</code></td> <td><code class="type">integer[]</code></td> <td>Process IDs of locking backends (more than one if multitransaction)</td> </tr> </tbody> </table> </div> </div> <p><code class="function">pgrowlocks</code> takes <code class="literal">AccessShareLock</code> for the target table and reads each row one by one to collect the row locking information. This is not very speedy for a large table. Note that:</p> <div class="orderedlist"> <ol class="orderedlist" type="1"> <li> <p>If an <code class="literal">ACCESS EXCLUSIVE</code> lock is taken on the table, <code class="function">pgrowlocks</code> will be blocked.</p> </li> <li> <p><code class="function">pgrowlocks</code> is not guaranteed to produce a self-consistent snapshot. It is possible that a new row lock is taken, or an old lock is freed, during its execution.</p> </li> </ol> </div> <p><code class="function">pgrowlocks</code> does not show the contents of locked rows. If you want to take a look at the row contents at the same time, you could do something like this:</p> <pre data-language="sql">
SELECT * FROM accounts AS a, pgrowlocks('accounts') AS p
  WHERE p.locked_row = a.ctid;
</pre> <p>Be aware however that such a query will be very inefficient.</p> </div> <div class="sect2" id="PGROWLOCKS-SAMPLE-OUTPUT">    <h2 class="title">F.31.2. Sample Output </h2>    <pre>
=# SELECT * FROM pgrowlocks('t1');
 locked_row | locker | multi | xids  |     modes      |  pids
------------+--------+-------+-------+----------------+--------
 (0,1)      |    609 | f     | {609} | {"For Share"}  | {3161}
 (0,2)      |    609 | f     | {609} | {"For Share"}  | {3161}
 (0,3)      |    607 | f     | {607} | {"For Update"} | {3107}
 (0,4)      |    607 | f     | {607} | {"For Update"} | {3107}
(4 rows)
</pre> </div> <div class="sect2" id="PGROWLOCKS-AUTHOR">    <h2 class="title">F.31.3. Author </h2>    <p>Tatsuo Ishii</p> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 1996&ndash;2023 The PostgreSQL Global Development Group<br>Licensed under the PostgreSQL License.<br>
    <a href="https://www.postgresql.org/docs/16/pgrowlocks.html" class="_attribution-link">https://www.postgresql.org/docs/16/pgrowlocks.html</a>
  </p>
</div>
