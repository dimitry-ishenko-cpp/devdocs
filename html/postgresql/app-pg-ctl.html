<h1>pg_ctl</h1> <p>pg_ctl — initialize, start, stop, or control a PostgreSQL server</p>   <h2>Synopsis</h2> <div class="cmdsynopsis"> <p id="id-1.9.5.7.4.1"><code class="command">pg_ctl</code> <code class="option">init[db]</code> [<code class="option">-D</code> <code>datadir</code>] [<code class="option">-s</code>] [<code class="option">-o</code> <code>initdb-options</code>]</p> </div> <div class="cmdsynopsis"> <p id="id-1.9.5.7.4.2"><code class="command">pg_ctl</code> <code class="option">start</code> [<code class="option">-D</code> <code>datadir</code>] [<code class="option">-l</code> <code>filename</code>] [<code class="option">-W</code>] [<code class="option">-t</code> <code>seconds</code>] [<code class="option">-s</code>] [<code class="option">-o</code> <code>options</code>] [<code class="option">-p</code> <code>path</code>] [<code class="option">-c</code>]</p> </div> <div class="cmdsynopsis"> <p id="id-1.9.5.7.4.3"><code class="command">pg_ctl</code> <code class="option">stop</code> [<code class="option">-D</code> <code>datadir</code>] [<code class="option">-m</code> <code class="option">s[mart]</code> | <code class="option">f[ast]</code> | <code class="option">i[mmediate]</code> ] [<code class="option">-W</code>] [<code class="option">-t</code> <code>seconds</code>] [<code class="option">-s</code>]</p> </div> <div class="cmdsynopsis"> <p id="id-1.9.5.7.4.4"><code class="command">pg_ctl</code> <code class="option">restart</code> [<code class="option">-D</code> <code>datadir</code>] [<code class="option">-m</code> <code class="option">s[mart]</code> | <code class="option">f[ast]</code> | <code class="option">i[mmediate]</code> ] [<code class="option">-W</code>] [<code class="option">-t</code> <code>seconds</code>] [<code class="option">-s</code>] [<code class="option">-o</code> <code>options</code>] [<code class="option">-c</code>]</p> </div> <div class="cmdsynopsis"> <p id="id-1.9.5.7.4.5"><code class="command">pg_ctl</code> <code class="option">reload</code> [<code class="option">-D</code> <code>datadir</code>] [<code class="option">-s</code>]</p> </div> <div class="cmdsynopsis"> <p id="id-1.9.5.7.4.6"><code class="command">pg_ctl</code> <code class="option">status</code> [<code class="option">-D</code> <code>datadir</code>]</p> </div> <div class="cmdsynopsis"> <p id="id-1.9.5.7.4.7"><code class="command">pg_ctl</code> <code class="option">promote</code> [<code class="option">-D</code> <code>datadir</code>] [<code class="option">-W</code>] [<code class="option">-t</code> <code>seconds</code>] [<code class="option">-s</code>]</p> </div> <div class="cmdsynopsis"> <p id="id-1.9.5.7.4.8"><code class="command">pg_ctl</code> <code class="option">logrotate</code> [<code class="option">-D</code> <code>datadir</code>] [<code class="option">-s</code>]</p> </div> <div class="cmdsynopsis"> <p id="id-1.9.5.7.4.9"><code class="command">pg_ctl</code> <code class="option">kill</code> <code>signal_name</code> <code>process_id</code></p> </div> <p>On Microsoft Windows, also:</p> <div class="cmdsynopsis"> <p id="id-1.9.5.7.4.11"><code class="command">pg_ctl</code> <code class="option">register</code> [<code class="option">-D</code> <code>datadir</code>] [<code class="option">-N</code> <code>servicename</code>] [<code class="option">-U</code> <code>username</code>] [<code class="option">-P</code> <code>password</code>] [<code class="option">-S</code> <code class="option">a[uto]</code> | <code class="option">d[emand]</code> ] [<code class="option">-e</code> <code>source</code>] [<code class="option">-W</code>] [<code class="option">-t</code> <code>seconds</code>] [<code class="option">-s</code>] [<code class="option">-o</code> <code>options</code>]</p> </div> <div class="cmdsynopsis"> <p id="id-1.9.5.7.4.12"><code class="command">pg_ctl</code> <code class="option">unregister</code> [<code class="option">-N</code> <code>servicename</code>]</p> </div>  <div class="refsect1" id="APP-PG-CTL-DESCRIPTION"> <h2>Description</h2> <p>pg_ctl is a utility for initializing a PostgreSQL database cluster, starting, stopping, or restarting the PostgreSQL database server (<a class="xref" href="app-postgres.html" title="postgres">postgres</a>), or displaying the status of a running server. Although the server can be started manually, pg_ctl encapsulates tasks such as redirecting log output and properly detaching from the terminal and process group. It also provides convenient options for controlled shutdown.</p> <p>The <code class="option">init</code> or <code class="option">initdb</code> mode creates a new PostgreSQL database cluster, that is, a collection of databases that will be managed by a single server instance. This mode invokes the <code class="command">initdb</code> command. See <a class="xref" href="app-initdb.html" title="initdb">initdb</a> for details.</p> <p><code class="option">start</code> mode launches a new server. The server is started in the background, and its standard input is attached to <code class="filename">/dev/null</code> (or <code class="literal">nul</code> on Windows). On Unix-like systems, by default, the server's standard output and standard error are sent to pg_ctl's standard output (not standard error). The standard output of pg_ctl should then be redirected to a file or piped to another process such as a log rotating program like rotatelogs; otherwise <code class="command">postgres</code> will write its output to the controlling terminal (from the background) and will not leave the shell's process group. On Windows, by default the server's standard output and standard error are sent to the terminal. These default behaviors can be changed by using <code class="option">-l</code> to append the server's output to a log file. Use of either <code class="option">-l</code> or output redirection is recommended.</p> <p><code class="option">stop</code> mode shuts down the server that is running in the specified data directory. Three different shutdown methods can be selected with the <code class="option">-m</code> option. <span class="quote">“<span class="quote">Smart</span>”</span> mode disallows new connections, then waits for all existing clients to disconnect. If the server is in hot standby, recovery and streaming replication will be terminated once all clients have disconnected. <span class="quote">“<span class="quote">Fast</span>”</span> mode (the default) does not wait for clients to disconnect. All active transactions are rolled back and clients are forcibly disconnected, then the server is shut down. <span class="quote">“<span class="quote">Immediate</span>”</span> mode will abort all server processes immediately, without a clean shutdown. This choice will lead to a crash-recovery cycle during the next server start.</p> <p><code class="option">restart</code> mode effectively executes a stop followed by a start. This allows changing the <code class="command">postgres</code> command-line options, or changing configuration-file options that cannot be changed without restarting the server. If relative paths were used on the command line during server start, <code class="option">restart</code> might fail unless pg_ctl is executed in the same current directory as it was during server start.</p> <p><code class="option">reload</code> mode simply sends the <code class="command">postgres</code> server process a <span class="systemitem">SIGHUP</span> signal, causing it to reread its configuration files (<code class="filename">postgresql.conf</code>, <code class="filename">pg_hba.conf</code>, etc.). This allows changing configuration-file options that do not require a full server restart to take effect.</p> <p><code class="option">status</code> mode checks whether a server is running in the specified data directory. If it is, the server's PID and the command line options that were used to invoke it are displayed. If the server is not running, pg_ctl returns an exit status of 3. If an accessible data directory is not specified, pg_ctl returns an exit status of 4.</p> <p><code class="option">promote</code> mode commands the standby server that is running in the specified data directory to end standby mode and begin read-write operations.</p> <p><code class="option">logrotate</code> mode rotates the server log file. For details on how to use this mode with external log rotation tools, see <a class="xref" href="logfile-maintenance.html" title="25.3. Log File Maintenance">Section 25.3</a>.</p> <p><code class="option">kill</code> mode sends a signal to a specified process. This is primarily valuable on Microsoft Windows which does not have a built-in kill command. Use <code class="literal">--help</code> to see a list of supported signal names.</p> <p><code class="option">register</code> mode registers the PostgreSQL server as a system service on Microsoft Windows. The <code class="option">-S</code> option allows selection of service start type, either <span class="quote">“<span class="quote">auto</span>”</span> (start service automatically on system startup) or <span class="quote">“<span class="quote">demand</span>”</span> (start service on demand).</p> <p><code class="option">unregister</code> mode unregisters a system service on Microsoft Windows. This undoes the effects of the <code class="option">register</code> command.</p> </div> <div class="refsect1" id="APP-PG-CTL-OPTIONS"> <h2>Options</h2> <div class="variablelist"> <dl class="variablelist"> <dt>
<code class="option">-c</code><code class="option">--core-files</code>
</dt> <dd> <p>Attempt to allow server crashes to produce core files, on platforms where this is possible, by lifting any soft resource limit placed on core files. This is useful in debugging or diagnosing problems by allowing a stack trace to be obtained from a failed server process.</p> </dd> <dt>
<code class="option">-D datadir</code><code class="option">--pgdata=datadir</code>
</dt> <dd> <p>Specifies the file system location of the database configuration files. If this option is omitted, the environment variable <code class="envar">PGDATA</code> is used.</p> </dd> <dt>
<code class="option">-l filename</code><code class="option">--log=filename</code>
</dt> <dd> <p>Append the server log output to <code>filename</code>. If the file does not exist, it is created. The <span class="systemitem">umask</span> is set to 077, so access to the log file is disallowed to other users by default.</p> </dd> <dt>
<code class="option">-m mode</code><code class="option">--mode=mode</code>
</dt> <dd> <p>Specifies the shutdown mode. <code>mode</code> can be <code class="literal">smart</code>, <code class="literal">fast</code>, or <code class="literal">immediate</code>, or the first letter of one of these three. If this option is omitted, <code class="literal">fast</code> is the default.</p> </dd> <dt>
<code class="option">-o options</code><code class="option">--options=options</code>
</dt> <dd> <p>Specifies options to be passed directly to the <code class="command">postgres</code> command. <code class="option">-o</code> can be specified multiple times, with all the given options being passed through.</p> <p>The <code>options</code> should usually be surrounded by single or double quotes to ensure that they are passed through as a group.</p> </dd> <dt>
<code class="option">-o initdb-options</code><code class="option">--options=initdb-options</code>
</dt> <dd> <p>Specifies options to be passed directly to the <code class="command">initdb</code> command. <code class="option">-o</code> can be specified multiple times, with all the given options being passed through.</p> <p>The <code>initdb-options</code> should usually be surrounded by single or double quotes to ensure that they are passed through as a group.</p> </dd> <dt><code class="option">-p path</code></dt> <dd> <p>Specifies the location of the <code class="filename">postgres</code> executable. By default the <code class="filename">postgres</code> executable is taken from the same directory as <code class="command">pg_ctl</code>, or failing that, the hard-wired installation directory. It is not necessary to use this option unless you are doing something unusual and get errors that the <code class="filename">postgres</code> executable was not found.</p> <p>In <code class="literal">init</code> mode, this option analogously specifies the location of the <code class="filename">initdb</code> executable.</p> </dd> <dt>
<code class="option">-s</code><code class="option">--silent</code>
</dt> <dd> <p>Print only errors, no informational messages.</p> </dd> <dt>
<code class="option">-t seconds</code><code class="option">--timeout=seconds</code>
</dt> <dd> <p>Specifies the maximum number of seconds to wait when waiting for an operation to complete (see option <code class="option">-w</code>). Defaults to the value of the <code class="envar">PGCTLTIMEOUT</code> environment variable or, if not set, to 60 seconds.</p> </dd> <dt>
<code class="option">-V</code><code class="option">--version</code>
</dt> <dd> <p>Print the pg_ctl version and exit.</p> </dd> <dt>
<code class="option">-w</code><code class="option">--wait</code>
</dt> <dd> <p>Wait for the operation to complete. This is supported for the modes <code class="literal">start</code>, <code class="literal">stop</code>, <code class="literal">restart</code>, <code class="literal">promote</code>, and <code class="literal">register</code>, and is the default for those modes.</p> <p>When waiting, <code class="command">pg_ctl</code> repeatedly checks the server's PID file, sleeping for a short amount of time between checks. Startup is considered complete when the PID file indicates that the server is ready to accept connections. Shutdown is considered complete when the server removes the PID file. <code class="command">pg_ctl</code> returns an exit code based on the success of the startup or shutdown.</p> <p>If the operation does not complete within the timeout (see option <code class="option">-t</code>), then <code class="command">pg_ctl</code> exits with a nonzero exit status. But note that the operation might continue in the background and eventually succeed.</p> </dd> <dt>
<code class="option">-W</code><code class="option">--no-wait</code>
</dt> <dd> <p>Do not wait for the operation to complete. This is the opposite of the option <code class="option">-w</code>.</p> <p>If waiting is disabled, the requested action is triggered, but there is no feedback about its success. In that case, the server log file or an external monitoring system would have to be used to check the progress and success of the operation.</p> <p>In prior releases of PostgreSQL, this was the default except for the <code class="literal">stop</code> mode.</p> </dd> <dt>
<code class="option">-?</code><code class="option">--help</code>
</dt> <dd> <p>Show help about pg_ctl command line arguments, and exit.</p> </dd> </dl> </div> <p>If an option is specified that is valid, but not relevant to the selected operating mode, pg_ctl ignores it.</p> <div class="refsect2" id="APP-PG-CTL-WINDOWS-OPTIONS"> <h3>Options for Windows</h3> <div class="variablelist"> <dl class="variablelist"> <dt><code class="option">-e source</code></dt> <dd> <p>Name of the event source for pg_ctl to use for logging to the event log when running as a Windows service. The default is <code class="literal">PostgreSQL</code>. Note that this only controls messages sent from pg_ctl itself; once started, the server will use the event source specified by its <a class="xref" href="runtime-config-logging.html#GUC-EVENT-SOURCE">event_source</a> parameter. Should the server fail very early in startup, before that parameter has been set, it might also log using the default event source name <code class="literal">PostgreSQL</code>.</p> </dd> <dt><code class="option">-N servicename</code></dt> <dd> <p>Name of the system service to register. This name will be used as both the service name and the display name. The default is <code class="literal">PostgreSQL</code>.</p> </dd> <dt><code class="option">-P password</code></dt> <dd> <p>Password for the user to run the service as.</p> </dd> <dt><code class="option">-S start-type</code></dt> <dd> <p>Start type of the system service. <code>start-type</code> can be <code class="literal">auto</code>, or <code class="literal">demand</code>, or the first letter of one of these two. If this option is omitted, <code class="literal">auto</code> is the default.</p> </dd> <dt><code class="option">-U username</code></dt> <dd> <p>User name for the user to run the service as. For domain users, use the format <code class="literal">DOMAIN\username</code>.</p> </dd> </dl> </div> </div> </div> <div class="refsect1" id="id-1.9.5.7.7"> <h2>Environment</h2> <div class="variablelist"> <dl class="variablelist"> <dt><code class="envar">PGCTLTIMEOUT</code></dt> <dd> <p>Default limit on the number of seconds to wait when waiting for startup or shutdown to complete. If not set, the default is 60 seconds.</p> </dd> <dt><code class="envar">PGDATA</code></dt> <dd> <p>Default data directory location.</p> </dd> </dl> </div> <p>Most <code class="command">pg_ctl</code> modes require knowing the data directory location; therefore, the <code class="option">-D</code> option is required unless <code class="envar">PGDATA</code> is set.</p> <p><code class="command">pg_ctl</code>, like most other PostgreSQL utilities, also uses the environment variables supported by libpq (see <a class="xref" href="https://www.postgresql.org/docs/16/libpq-envars.html" title="34.15. Environment Variables">Section 34.15</a>).</p> <p>For additional variables that affect the server, see <a class="xref" href="app-postgres.html" title="postgres">postgres</a>.</p> </div> <div class="refsect1" id="id-1.9.5.7.8"> <h2>Files</h2> <div class="variablelist"> <dl class="variablelist"> <dt><code class="filename">postmaster.pid</code></dt> <dd> <p>pg_ctl examines this file in the data directory to determine whether the server is currently running.</p> </dd> <dt><code class="filename">postmaster.opts</code></dt> <dd> <p>If this file exists in the data directory, pg_ctl (in <code class="option">restart</code> mode) will pass the contents of the file as options to postgres, unless overridden by the <code class="option">-o</code> option. The contents of this file are also displayed in <code class="option">status</code> mode.</p> </dd> </dl> </div> </div> <div class="refsect1" id="R1-APP-PGCTL-2"> <h2>Examples</h2> <div class="refsect2" id="R2-APP-PGCTL-3"> <h3>Starting the Server</h3> <p>To start the server, waiting until the server is accepting connections:</p> <pre>
$ <strong class="userinput">pg_ctl start</strong>
</pre> <p>To start the server using port 5433, and running without <code class="function">fsync</code>, use:</p> <pre>
$ <strong class="userinput">pg_ctl -o "-F -p 5433" start</strong>
</pre> </div> <div class="refsect2" id="R2-APP-PGCTL-4"> <h3>Stopping the Server</h3> <p>To stop the server, use:</p> <pre>
$ <strong class="userinput">pg_ctl stop</strong>
</pre> <p>The <code class="option">-m</code> option allows control over <span class="emphasis"><em>how</em></span> the server shuts down:</p> <pre>
$ <strong class="userinput">pg_ctl stop -m smart</strong>
</pre> </div> <div class="refsect2" id="R2-APP-PGCTL-5"> <h3>Restarting the Server</h3> <p>Restarting the server is almost equivalent to stopping the server and starting it again, except that by default, <code class="command">pg_ctl</code> saves and reuses the command line options that were passed to the previously-running instance. To restart the server using the same options as before, use:</p> <pre>
$ <strong class="userinput">pg_ctl restart</strong>
</pre> <p>But if <code class="option">-o</code> is specified, that replaces any previous options. To restart using port 5433, disabling <code class="function">fsync</code> upon restart:</p> <pre>
$ <strong class="userinput">pg_ctl -o "-F -p 5433" restart</strong>
</pre> </div> <div class="refsect2" id="R2-APP-PGCTL-6"> <h3>Showing the Server Status</h3> <p>Here is sample status output from pg_ctl:</p> <pre>
$ <strong class="userinput">pg_ctl status</strong>

pg_ctl: server is running (PID: 13718)
/usr/local/pgsql/bin/postgres "-D" "/usr/local/pgsql/data" "-p" "5433" "-B" "128"
</pre> <p>The second line is the command that would be invoked in restart mode.</p> </div> </div> <div class="refsect1" id="id-1.9.5.7.10"> <h2>See Also</h2>
<span class="simplelist"><a class="xref" href="app-initdb.html" title="initdb">initdb</a>, <a class="xref" href="app-postgres.html" title="postgres">postgres</a></span> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 1996&ndash;2023 The PostgreSQL Global Development Group<br>Licensed under the PostgreSQL License.<br>
    <a href="https://www.postgresql.org/docs/16/app-pg-ctl.html" class="_attribution-link">https://www.postgresql.org/docs/16/app-pg-ctl.html</a>
  </p>
</div>
