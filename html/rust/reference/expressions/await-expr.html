<h1 id="await-expressions">Await expressions</h1> <blockquote> <p><strong><sup>Syntax</sup></strong><br> <em>AwaitExpression</em> :<br> <a href="../expressions.html"><em>Expression</em></a> <code>.</code> <code>await</code></p> </blockquote> <p>An <code>await</code> expression is a syntactic construct for suspending a computation provided by an implementation of <code>std::future::IntoFuture</code> until the given future is ready to produce a value. The syntax for an await expression is an expression with a type that implements the <a href="https://doc.rust-lang.org/core/future/into_future/trait.IntoFuture.html"><code>IntoFuture</code></a> trait, called the <em>future operand</em>, then the token <code>.</code>, and then the <code>await</code> keyword. Await expressions are legal only within an <a href="block-expr.html#async-context">async context</a>, like an <a href="../items/functions.html#async-functions"><code>async fn</code></a>, <a href="closure-expr.html#async-closures"><code>async</code> closure</a>, or <a href="block-expr.html#async-blocks"><code>async</code> block</a>.</p> <p>More specifically, an await expression has the following effect.</p> <ol> <li>Create a future by calling <a href="https://doc.rust-lang.org/core/future/into_future/trait.IntoFuture.html#tymethod.into_future"><code>IntoFuture::into_future</code></a> on the future operand.</li> <li>Evaluate the future to a <a href="https://doc.rust-lang.org/core/future/future/trait.Future.html">future</a> <code>tmp</code>;</li> <li>Pin <code>tmp</code> using <a href="https://doc.rust-lang.org/core/pin/struct.Pin.html#method.new_unchecked"><code>Pin::new_unchecked</code></a>;</li> <li>This pinned future is then polled by calling the <a href="https://doc.rust-lang.org/core/future/future/trait.Future.html#tymethod.poll"><code>Future::poll</code></a> method and passing it the current <a href="#task-context">task context</a>;</li> <li>If the call to <code>poll</code> returns <a href="https://doc.rust-lang.org/core/task/poll/enum.Poll.html#variant.Pending"><code>Poll::Pending</code></a>, then the future returns <code>Poll::Pending</code>, suspending its state so that, when the surrounding async context is re-polled,execution returns to step 3;</li> <li>Otherwise the call to <code>poll</code> must have returned <a href="https://doc.rust-lang.org/core/task/poll/enum.Poll.html#variant.Ready"><code>Poll::Ready</code></a>, in which case the value contained in the <a href="https://doc.rust-lang.org/core/task/poll/enum.Poll.html#variant.Ready"><code>Poll::Ready</code></a> variant is used as the result of the <code>await</code> expression itself.</li> </ol> <blockquote> <p><strong>Edition differences</strong>: Await expressions are only available beginning with Rust 2018.</p> </blockquote> <h2 id="task-context">Task context</h2> <p>The task context refers to the <a href="https://doc.rust-lang.org/core/task/wake/struct.Context.html"><code>Context</code></a> which was supplied to the current <a href="block-expr.html#async-context">async context</a> when the async context itself was polled. Because <code>await</code> expressions are only legal in an async context, there must be some task context available.</p> <h2 id="approximate-desugaring">Approximate desugaring</h2> <p>Effectively, an await expression is roughly equivalent to the following non-normative desugaring:</p>  <pre data-language="rust">match operand.into_future() {
    mut pinned =&gt; loop {
        let mut pin = unsafe { Pin::new_unchecked(&amp;mut pinned) };
        match Pin::future::poll(Pin::borrow(&amp;mut pin), &amp;mut current_context) {
            Poll::Ready(r) =&gt; break r,
            Poll::Pending =&gt; yield Poll::Pending,
        }
    }
}</pre> <p>where the <code>yield</code> pseudo-code returns <code>Poll::Pending</code> and, when re-invoked, resumes execution from that point. The variable <code>current_context</code> refers to the context taken from the async environment.</p><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2010 The Rust Project Developers<br>Licensed under the Apache License, Version 2.0 or the MIT license, at your option.<br>
    <a href="https://doc.rust-lang.org/reference/expressions/await-expr.html" class="_attribution-link">https://doc.rust-lang.org/reference/expressions/await-expr.html</a>
  </p>
</div>
