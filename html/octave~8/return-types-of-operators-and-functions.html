<div class="subsubsection" id="Return-Types-of-Operators-and-Functions">   <h1 class="subsubsection">22.1.4.2 Return Types of Operators and Functions</h1> <p>The two basic reasons to use sparse matrices are to reduce the memory usage and to not have to do calculations on zero elements. The two are closely related in that the computation time on a sparse matrix operator or function is roughly linear with the number of nonzero elements. </p> <p>Therefore, there is a certain density of nonzero elements of a matrix where it no longer makes sense to store it as a sparse matrix, but rather as a full matrix. For this reason operators and functions that have a high probability of returning a full matrix will always return one. For example adding a scalar constant to a sparse matrix will almost always make it a full matrix, and so the example, </p> <pre class="example" data-language="matlab">speye (3) + 0
⇒   1  0  0
  0  1  0
  0  0  1</pre> <p>returns a full matrix as can be seen. </p> <p>As all of the mixed operators and functions between full and sparse matrices exist, in general this does not cause any problems. However, one area where it does cause a problem is where a sparse matrix is promoted to a full matrix, where subsequent operations would resparsify the matrix. Such cases are rare, but can be artificially created, for example <code>(fliplr (speye (3)) + speye (3)) - speye (3)</code> gives a full matrix when it should give a sparse one. In general, where such cases occur, they impose only a small memory penalty. </p> <p>There is however one known case where this behavior of Octave’s sparse matrices will cause a problem. That is in the handling of the <em>diag</em> function. Whether <em>diag</em> returns a sparse or full matrix depending on the type of its input arguments. So </p> <pre class="example" data-language="matlab">a = diag (sparse ([1,2,3]), -1);</pre> <p>should return a sparse matrix. To ensure this actually happens, the <em>sparse</em> function, and other functions based on it like <em>speye</em>, always returns a sparse matrix, even if the memory used will be larger than its full representation. </p> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 1996–2023 The Octave Project Developers<br>Permission is granted to make and distribute verbatim copies of this manual provided the copyright notice and this permission notice are preserved on all copies.<br/>Permission is granted to copy and distribute modified versions of this manual under the conditions for verbatim copying, provided that the entire resulting derived work is distributed under the terms of a permission notice identical to this one.</br>Permission is granted to copy and distribute translations of this manual into another language, under the above conditions for modified versions.<br>
    <a href="https://docs.octave.org/v8.1.0/Return-Types-of-Operators-and-Functions.html" class="_attribution-link">https://docs.octave.org/v8.1.0/Return-Types-of-Operators-and-Functions.html</a>
  </p>
</div>
