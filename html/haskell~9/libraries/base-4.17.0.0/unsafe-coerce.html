<h1 class="caption">Unsafe.Coerce</h1>
<div class="_haskell-api">
<table class="info">
<tr>
<th>Safe Haskell</th>
<td>Unsafe</td>
</tr>
<tr>
<th>Language</th>
<td>Haskell2010</td>
</tr>
</table>
<p class="src"><a id="v:unsafeCoerce" class="def">unsafeCoerce</a> :: forall (a :: <a href="data-kind.html#t:Type" title="Data.Kind">Type</a>) (b :: <a href="data-kind.html#t:Type" title="Data.Kind">Type</a>). a -&gt; b <a href="https://downloads.haskell.org/~ghc/9.4.2/docs/libraries/base-4.17.0.0/src/Unsafe.Coerce.html#unsafeCoerce" class="link">Source</a> </p>
<p>Coerce a value from one type to another, bypassing the type-checker.</p>
<p>There are several legitimate ways to use <code><a href="unsafe-coerce.html#v:unsafeCoerce" title="Unsafe.Coerce">unsafeCoerce</a></code>:</p>
<ol>
<li value="1">To coerce e.g. <code>Int</code> to <code>HValue</code>, put it in a list of <code>HValue</code>, and then later coerce it back to <code>Int</code> before using it.</li>
<li value="2">To produce e.g. <code>(a+b) :~: (b+a)</code> from <code>unsafeCoerce Refl</code>. Here the two sides really are the same type -- so nothing unsafe is happening -- but GHC is not clever enough to see it.</li>
<li value="3">In <code>Data.Typeable</code> we have</li>
</ol>
<pre>       eqTypeRep :: forall k1 k2 (a :: k1) (b :: k2).
                    TypeRep a -&gt; TypeRep b -&gt; Maybe (a :~~: b)
       eqTypeRep a b
         | sameTypeRep a b = Just (unsafeCoerce HRefl)
         | otherwise       = Nothing
     </pre>
<p>Here again, the <code>unsafeCoerce HRefl</code> is safe, because the two types really are the same -- but the proof of that relies on the complex, trusted implementation of <code>Typeable</code>.</p>
<ol><li value="4">The "reflection trick", which takes advantage of the fact that in <code>class C a where { op :: ty }</code>, we can safely coerce between <code>C a</code> and <code>ty</code> (which have different kinds!) because it's really just a newtype. Note: there is <em>no guarantee, at all</em> that this behavior will be supported into perpetuity.</li></ol>
<p>For safe zero-cost coercions you can instead use the <code><a href="data-coerce.html#v:coerce" title="Data.Coerce">coerce</a></code> function from <a href="data-coerce.html">Data.Coerce</a>.</p>
<p class="src"><a id="v:unsafeCoerceUnlifted" class="def">unsafeCoerceUnlifted</a> :: forall (a :: <a href="ghc-exts.html#t:TYPE" title="GHC.Exts">TYPE</a> ('<a href="ghc-exts.html#v:BoxedRep" title="GHC.Exts">BoxedRep</a> '<a href="ghc-exts.html#v:Unlifted" title="GHC.Exts">Unlifted</a>)) (b :: <a href="ghc-exts.html#t:TYPE" title="GHC.Exts">TYPE</a> ('<a href="ghc-exts.html#v:BoxedRep" title="GHC.Exts">BoxedRep</a> '<a href="ghc-exts.html#v:Unlifted" title="GHC.Exts">Unlifted</a>)). a -&gt; b <a href="https://downloads.haskell.org/~ghc/9.4.2/docs/libraries/base-4.17.0.0/src/Unsafe.Coerce.html#unsafeCoerceUnlifted" class="link">Source</a> </p>
<p class="src"><a id="v:unsafeCoerceAddr" class="def">unsafeCoerceAddr</a> :: forall (a :: <a href="ghc-exts.html#t:TYPE" title="GHC.Exts">TYPE</a> '<a href="ghc-exts.html#v:AddrRep" title="GHC.Exts">AddrRep</a>) (b :: <a href="ghc-exts.html#t:TYPE" title="GHC.Exts">TYPE</a> '<a href="ghc-exts.html#v:AddrRep" title="GHC.Exts">AddrRep</a>). a -&gt; b <a href="https://downloads.haskell.org/~ghc/9.4.2/docs/libraries/base-4.17.0.0/src/Unsafe.Coerce.html#unsafeCoerceAddr" class="link">Source</a> </p>
<p class="src"><a id="v:unsafeEqualityProof" class="def">unsafeEqualityProof</a> :: forall a b. <a href="unsafe-coerce.html#t:UnsafeEquality" title="Unsafe.Coerce">UnsafeEquality</a> a b <a href="https://downloads.haskell.org/~ghc/9.4.2/docs/libraries/base-4.17.0.0/src/Unsafe.Coerce.html#unsafeEqualityProof" class="link">Source</a> </p>
<p class="src">data <a id="t:UnsafeEquality" class="def">UnsafeEquality</a> a b where <a href="https://downloads.haskell.org/~ghc/9.4.2/docs/libraries/base-4.17.0.0/src/Unsafe.Coerce.html#UnsafeEquality" class="link">Source</a> </p>
<p>This type is treated magically within GHC. Any pattern match of the form <code>case unsafeEqualityProof of UnsafeRefl -&gt; body</code> gets transformed just into <code>body</code>. This is ill-typed, but the transformation takes place after type-checking is complete. It is used to implement <code><a href="unsafe-coerce.html#v:unsafeCoerce" title="Unsafe.Coerce">unsafeCoerce</a></code>. You probably don't want to use <code><a href="unsafe-coerce.html#v:UnsafeRefl" title="Unsafe.Coerce">UnsafeRefl</a></code> in an expression, but you might conceivably want to pattern-match on it. Use <code><a href="unsafe-coerce.html#v:unsafeEqualityProof" title="Unsafe.Coerce">unsafeEqualityProof</a></code> to create one of these.</p>
<div class="subs constructors">
<h4 class="caption">Constructors</h4>
<table><tr>
<td class="src">
<a id="v:UnsafeRefl" class="def">UnsafeRefl</a> :: <a href="unsafe-coerce.html#t:UnsafeEquality" title="Unsafe.Coerce">UnsafeEquality</a> a a</td>
<td class="doc empty"> </td>
</tr></table>
</div>
<p class="src"><a id="v:unsafeCoerce-35-" class="def">unsafeCoerce#</a> :: forall (r1 :: <a href="ghc-exts.html#t:RuntimeRep" title="GHC.Exts">RuntimeRep</a>) (r2 :: <a href="ghc-exts.html#t:RuntimeRep" title="GHC.Exts">RuntimeRep</a>) (a :: <a href="ghc-exts.html#t:TYPE" title="GHC.Exts">TYPE</a> r1) (b :: <a href="ghc-exts.html#t:TYPE" title="GHC.Exts">TYPE</a> r2). a -&gt; b <a href="https://downloads.haskell.org/~ghc/9.4.2/docs/libraries/base-4.17.0.0/src/Unsafe.Coerce.html#unsafeCoerce%23" class="link">Source</a> </p>
<p>Highly, terribly dangerous coercion from one representation type to another. Misuse of this function can invite the garbage collector to trounce upon your data and then laugh in your face. You don't want this function. Really.</p>
</div><div class="_attribution">
  <p class="_attribution-p">
    &copy; The University of Glasgow and others<br>Licensed under a BSD-style license (see top of the page).<br>
    <a href="https://downloads.haskell.org/~ghc/9.4.2/docs/libraries/base-4.17.0.0/Unsafe-Coerce.html" class="_attribution-link">https://downloads.haskell.org/~ghc/9.4.2/docs/libraries/base-4.17.0.0/Unsafe-Coerce.html</a>
  </p>
</div>
