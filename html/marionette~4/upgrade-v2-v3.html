<h1>
Upgrade Guide</h1>
<p>Marionette 3 introduces a number of breaking changes. This upgrade guide will go through the major changes and describe how to change your application to accommodate them.</p> <p>An <a href="https://github.com/marionettejs/marionette-v3-compat">upgrade tool</a> is available and covers the breaking changes in detail.</p> <p>Where possible, we will document how to make the changes in Marionette 2.x so that your applications can continue to work and to ease the burden of upgrading to Marionette 3.</p> <p>You can run Marionette 3 alongside Marionette 2 with the Marionette.noConflict() function.</p> <h2 id="views">
Views</h2>
<p>The most noticeable change to Marionette 3 is the consolidation of <code>ItemView</code> and <code>LayoutView</code> into <code>View</code>. In addition, <code>CompositeView</code> has been removed and its functionality merged into <code>CollectionView</code> and <code>View</code>.</p> <h3 id="removing-layoutview-and-itemview">
Removing <code>LayoutView</code> and <code>ItemView</code>
</h3>
<p>Using separate <code>View</code> <code>LayoutView</code> and <code>ItemView</code> was complicating the API for Marionette needlessly. The new <code>View</code> replaces all of this and sets a clear recommendation for building layout trees.</p> <h4>
Upgrading for Marionette 2.x</h4>
<p>For updating in Marionette 2.x, it is recommended you change all instances of <code>ItemView</code> to <code>LayoutView</code>.</p> <h4>
Upgrading to Marionette 3</h4>
<p>Change all instances of <code>LayoutView</code> and <code>ItemView</code> to <code>View</code>. Any views that previously extended <code>View</code> with a custom <code>render</code> should work relatively unchanged.</p> <h3 id="removing-compositeview">
Removing <code>CompositeView</code>
</h3>
<p>The <code>CompositeView</code> was deprecated in favor of using <code>View</code> and <code>CollectionView</code>. The <code>CompositeView</code> will be completely removed in Marionette 4.</p> <p>See <a href="marionette.collectionview.html#rendering-collectionviews"><code>CollectionView</code></a> for detail on upgrading to Marionette 3. This technique works in both Marionette 2.x and Marionette 3.</p> <h3 id="removing-collectionviewgetchildview">
Removing <code>CollectionView.getChildView()</code>
</h3>
<p>The <code>getChildView</code> method has been removed in favor of the <code>childView</code> property, <a href="basics.html#functions-returning-values">which now accepts a function</a>.</p> <h4>
Upgrading to Marionette 3</h4>
<p>Simply replace all instances of <code>getChildView</code> with <code>childView</code>.</p> <h3 id="removing-collectionviewgetemptyview">
Removing <code>CollectionView.getEmptyView()</code>
</h3>
<p>The <code>getEmptyView</code> method has been removed in favor of the <code>emptyView</code> property, <a href="basics.html#functions-returning-values">which now accepts a function</a>.</p> <h4>
Upgrading to Marionette 3</h4>
<p>Simply replace all instances of <code>getEmptyView</code> with <code>emptyView</code>.</p> <h3 id="child-event-handlers">
Child event handlers</h3>
<p>The <code>childEvents</code> attribute was renamed to <code>childViewEvents</code>.</p> <p>Child event bubbling above one level is now removed in most instances and deprecated pending removal everywhere else. This can no longer be relied upon. To pass events further up the chain, you must explicitly using <code>childViewTriggers</code> to convert the event from the child into an event on the parent. These can be chained all the way up to the level you require them to be.</p> <p>Bubbled child events no longer pass the <code>childView</code> implicitly and only pass the arguments passed as part of <code>triggerMethod</code>. This means that the arguments passed to <code>onEvent</code> and <code>onChildviewEvent</code> are now identical. See the <a href="view.lifecycle.html">documentation on event lifecycles</a> for more information.</p> <p>In Marionette 2, <code>childEvents</code> were bound on every event. In Marionette 3, <code>childViewEvents</code> are bound once and cached. This means that you cannot add new events after the view has been created.</p> <h3 id="view-triggers">
View <code>triggers</code>
</h3>
<p>The view <code>triggers</code> attribute no longer passes an <code>options</code> attribute to event handlers, instead passing the view instance that triggered the event.</p> <h2 id="events">
Events</h2>
<p>A number of lifecycle events were changed or removed from Marionette 3. Information on which ones were removed, changed, or added will be found here with recommendations on how to update your code.</p> <h3 id="show-and-beforeshow">
<code>show</code> and <code>before:show</code>
</h3>
<p>The <code>show</code> events were removed completely as they were redundant and were being used incorrectly to show child regions. The <code>show</code> event was fired after the view had been attached, meaning the DOM was being constantly updated, leading to deteriorated performance.</p> <h4>
Upgrading for Marionette 2.x</h4>
<p>Replace all instances of <code>onShow</code>, <code>on('show')</code>, <code>onBeforeShow</code> and <code>on('before:show')</code> to use the <code>render</code> and <code>before:render</code> events. This is the recommendation for Marionette 3 and ensures the DOM tree is built in-memory before modifying the DOM.</p> <h4>
Upgrading to Marionette 3</h4>
<p>Replace all instances of <code>show</code> and <code>before:show</code> with <code>render</code> and <code>before:render</code>. If you want the view to be visible in the DOM, then listen to the <code>dom:refresh</code> event.</p> <h3 id="changes-to-regionshow">
Changes to <code>region.show()</code>
</h3>
<p>The <code>region.show()</code> method (that also backs <code>showChildView()</code>) was changed to not remove HTML outside the <code>$el</code> of the displayed view. In Marionette 2, the <code>region.show()</code> method would call <code>region.$el.empty()</code> before showing the new HTML.</p> <p>In Marionette 3, this was changed to unhook <code>region.currentView</code> from the DOM, remove all event handlers, then delete it. Any HTML added to the region that isn't contained in the DOM of the View won't be removed.</p> <p>For example:</p> <pre data-language="javascript"><span class="hljs-keyword">var</span> _ = <span class="hljs-built_in">require</span>(<span class="hljs-string">'underscore'</span>);
<span class="hljs-keyword">var</span> Mn = <span class="hljs-built_in">require</span>(<span class="hljs-string">'backbone.marionette'</span>);

<span class="hljs-keyword">var</span> app = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./app'</span>);

<span class="hljs-keyword">var</span> MyView = Mn.View.extend({
  <span class="hljs-attr">template</span>: _.template(<span class="hljs-string">'View contents'</span>)
});

<span class="hljs-keyword">var</span> ParentView = Mn.View.extend({
  <span class="hljs-attr">template</span>: _.template(<span class="hljs-string">'&lt;div class="view-hook"&gt;&lt;/div&gt;'</span>),
  <span class="hljs-attr">regions</span>: {
    <span class="hljs-attr">child</span>: <span class="hljs-string">'.view-hook'</span>
  }
});

<span class="hljs-keyword">var</span> parent = <span class="hljs-keyword">new</span> ParentView();
app.showView(parent);

<span class="hljs-keyword">var</span> child = <span class="hljs-keyword">new</span> MyView();

parent.showChildView(<span class="hljs-string">'child'</span>, child);
parent.getRegion(<span class="hljs-string">'child'</span>).$el.append(<span class="hljs-string">'&lt;p&gt;Not removed&lt;/p&gt;'</span>);
parent.showChildView(<span class="hljs-string">'child'</span>, <span class="hljs-keyword">new</span> MyView());
</pre> <p>In Marionette 2, the HTML output will be:</p> <pre data-language="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"view-hook"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>View contents<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</pre> <p>In Marionette 3, the HTML will be:</p> <pre data-language="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"view-hook"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Not Removed<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>View contents<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</pre> <h3 id="arguments-for-lifecycle-events">
Arguments for Lifecycle Events</h3>
<p>The arguments for a number of lifecycle events were changed. For consistency, all events will now receive the view that is emitting the event as the first argument. See the <a href="view.lifecycle.html">documentation for view lifecycles</a> for more complete information.</p> <h4>
Upgrading to Marionette 3</h4>
<p>The following events, with their accompanying <code>before:</code> event were changed and may need to be updated:</p> <table> <thead> <tr> <th>Class</th> <th>Event</th> </tr> </thead> <tbody> <tr> <td><code>Object</code></td> <td><code>destroy</code></td> </tr> <tr> <td><code>Region</code></td> <td><code>show</code></td> </tr> <tr> <td><code>View</code></td> <td>
<code>add:region</code> and <code>remove:region</code>
</td> </tr> <tr> <td><code>CollectionView</code></td> <td>
<code>add:child</code> and <code>remove:child</code>
</td> </tr> <tr> <td><code>Application</code></td> <td><code>start</code></td> </tr> </tbody> </table> <h2 id="templates">
Templates</h2>
<p>The biggest change to templates is renaming <code>templateHelpers</code> to <code>templateContext</code> - the aim is to be more in-line with terminology from other frameworks.</p> <h3 id="upgrading-to-marionette-3">
Upgrading to Marionette 3</h3>
<p>Simply replace all instances of <code>templateHelpers</code> with <code>templateContext</code></p> <h2 id="regions">
Regions</h2>
<p>There are a number of changes to how regions behave - the biggest change being the removal of the ability to access regions as attributes</p> <h3 id="removing-viewregion">
Removing <code>view.region</code>
</h3>
<p>The <code>view.&lt;region_name&gt;</code> syntax has been removed in favor of <code>view.getRegion()</code>, <code>view.getChildView()</code> and <code>view.showChildView()</code>.</p> <h4>
Upgrading for Marionette 2.x</h4>
<p>Change all references to <code>view.region</code> to <code>view.getRegion('region')</code>. For example, in Mn 2.x and below:</p> <pre data-language="javascript"><span class="hljs-keyword">var</span> AnotherView = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./anotherview'</span>);

<span class="hljs-keyword">var</span> MyView = Mn.LayoutView.extend({
  <span class="hljs-attr">regions</span>: {
    <span class="hljs-attr">myregion</span>: <span class="hljs-string">'.regionname'</span>
  },

  <span class="hljs-attr">onRender</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>() </span>{
    <span class="hljs-keyword">this</span>.myregion.show(<span class="hljs-keyword">new</span> AnotherView());
  }
});
</pre> <p>This does not work in Mn 3 - instead do:</p> <pre data-language="javascript"><span class="hljs-keyword">var</span> AnotherView = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./anotherview'</span>);

<span class="hljs-comment">/* In Mn 2.x we can just use LayoutView */</span>
<span class="hljs-keyword">var</span> MyView = Mn.View.extend({
  <span class="hljs-attr">regions</span>: {
    <span class="hljs-attr">myregion</span>: <span class="hljs-string">'.regionname'</span>
  },

  <span class="hljs-attr">onRender</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>() </span>{
    <span class="hljs-keyword">this</span>.showChildView(<span class="hljs-string">'myregion'</span>, <span class="hljs-keyword">new</span> AnotherView());
  }
});
</pre> <p>See the documentation for <a href="marionette.view.html#laying-out-views---regions">views</a> to learn more about how to manage regions in Marionette 3.</p> <h2 id="modules">
Modules</h2>
<p>Marionette Modules have been completely removed in favor of using the more standard JavaScript module loaders e.g. <a href="installation.html#quick-start-using-npm-and-webpack">Webpack</a> or <a href="installation.html#quick-start-using-npm-and-browserify">Browserify</a>. See the <a href="installation.html">installation</a> documentation for a list of potential options.</p> <h2 id="backbonebabysitter">
Backbone.Babysitter</h2>
<p>The dependency on <code>Backbone.Babysitter</code> has been removed in favour of an in-built implementation that is maintained within the main Marionette codebase.</p> <p>BabySitter provides a simple way to manage child views in Backbone/Marionette or any object that manages lists of views. The external Babysitter library was used in Marionette to manage the <code>CollectionView</code> children.</p> <h3 id="main-differences">
Main Differences</h3>
<p>The main difference between Babysitter and the Marionette implementation is the removal of <code>.call</code> and <code>.apply</code> on <code>CollectionView.children</code>. Instead you should use <code>.invoke</code> or <a href="marionette.collectionview.html#collectionview-childview-iterators-and-collection-functions">any of the methods provided</a>.</p> <p>For example:</p> <pre data-language="javascript"><span class="hljs-keyword">var</span> MyCollectionView = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./views'</span>);
<span class="hljs-keyword">var</span> MyCollection = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./collections'</span>);

<span class="hljs-keyword">var</span> collection = <span class="hljs-keyword">new</span> MyCollection();
collection.fetch();

<span class="hljs-keyword">var</span> myView = <span class="hljs-keyword">new</span> MyCollectionView({<span class="hljs-attr">collection</span>: collection});
myView.children.invoke(<span class="hljs-string">'render'</span>);
myView.children.map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">view</span>) </span>{
  view.doMethod();
});
</pre><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2017 Muted Solutions, LLC<br>Licensed under the MIT License.<br>
    <a href="https://marionettejs.com/docs/v4.0.0/upgrade-v2-v3.html" class="_attribution-link">https://marionettejs.com/docs/v4.0.0/upgrade-v2-v3.html</a>
  </p>
</div>
