<h1 id="plugin-development-provisioners">  Plugin Development: Provisioners </h1> <p>This page documents how to add new <a href="../provisioning/index.html">provisioners</a> to Vagrant, allowing Vagrant to automatically install software and configure software using a custom provisioner. Prior to reading this, you should be familiar with the <a href="development-basics.html">plugin development basics</a>.</p> <blockquote class="alert alert-warning"> <p><strong>Warning: Advanced Topic!</strong> Developing plugins is an advanced topic that only experienced Vagrant users who are reasonably comfortable with Ruby should approach.</p> </blockquote>
<h2 id="definition-component">  Definition Component </h2> <p>Within the context of a plugin definition, new provisioners can be defined like so:</p> <div class="highlight"><pre class="highlight ruby" data-language="ruby">provisioner "custom" do
  require_relative "provisioner"
  Provisioner
end
</pre></div>
<p>Provisioners are defined with the <code>provisioner</code> method, which takes a single argument specifying the name of the provisioner. This is the name that used with <code>config.vm.provision</code> when configuring and enabling the provisioner. So in the case above, the provisioner would be enabled using <code>config.vm.provision :custom</code>.</p> <p>The block argument then lazily loads and returns a class that implements the <code>Vagrant.plugin(2, :provisioner)</code> interface, which is covered next.</p> <h2 id="provisioner-class">  Provisioner Class </h2> <p>The provisioner class should subclass and implement <code>Vagrant.plugin(2, :provisioner)</code> which is an upgrade-safe way to let Vagrant return the proper parent class for provisioners.</p> <p>This class and the methods that need to be implemented are <a href="https://github.com/hashicorp/vagrant/blob/master/lib/vagrant/plugin/v2/provisioner.rb">very well documented</a>. The documentation on the class in the comments should be enough to understand what needs to be done.</p> <p>There are two main methods that need to be implemented: the <code>configure</code> method and the <code>provision</code> method.</p> <p>The <code>configure</code> method is called early in the machine booting process to allow the provisioner to define new configuration on the machine, such as sharing folders, defining networks, etc. As an example, the <a href="https://github.com/hashicorp/vagrant/blob/master/plugins/provisioners/chef/provisioner/chef_solo.rb#L24">Chef solo provisioner</a> uses this to define shared folders.</p> <p>The <code>provision</code> method is called when the machine is booted and ready for SSH connections. In this method, the provisioner should execute any commands that need to be executed.</p><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2010&ndash;2018 Mitchell Hashimoto<br>Licensed under the MPL 2.0 License.<br>
    <a href="https://www.vagrantup.com/docs/plugins/provisioners.html" class="_attribution-link">https://www.vagrantup.com/docs/plugins/provisioners.html</a>
  </p>
</div>
