<h1 id="smb">  SMB </h1> <p><strong>Synced folder type:</strong> <code>smb</code></p> <p>Vagrant can use <a href="https://en.wikipedia.org/wiki/Server_Message_Block">SMB</a> as a mechanism to create a bi-directional synced folder between the host machine and the Vagrant machine.</p> <p>SMB is built-in to Windows machines and provides a higher performance alternative to some other mechanisms such as VirtualBox shared folders.</p> <blockquote class="alert alert-info"> <p>SMB is currently only supported when the host machine is Windows or macOS. The guest machine can be Windows, Linux, or macOS.</p> </blockquote>
<h2 id="prerequisites">  Prerequisites </h2> <h3 id="windows-host">  Windows Host </h3> <p>To use the SMB synced folder type on a Windows host, the machine must have PowerShell version 3 or later installed. In addition, when Vagrant attempts to create new SMB shares, or remove existing SMB shares, Administrator privileges will be required. Vagrant will request these privileges using UAC.</p> <h3 id="macos-host">  macOS Host </h3> <p>To use the SMB synced folder type on a macOS host, file sharing must be enabled for the local account. Enable SMB file sharing by following the instructions below:</p> <ul> <li>Open "System Preferences" </li> <li>Click "Sharing" </li> <li>Check the "On" checkbox next to "File Sharing" </li> <li>Click "Options" </li> <li>Check "Share files and folders using SMB" </li> <li>Check the "On" checkbox next to your username within "Windows File Sharing" </li> <li>Click "Done" </li> </ul> <p>When Vagrant attempts to create new SMB shares, or remove existing SMB shares, root access will be required. Vagrant will request these privileges using <code>sudo</code> to run the <code>/usr/sbin/sharing</code> command. Adding the following to the system's <code>sudoers</code> configuration will allow Vagrant to manage SMB shares without requiring a password each time:</p> <div class="highlight"><pre class="highlight plaintext">Cmnd_Alias VAGRANT_SMB_ADD = /usr/sbin/sharing -a * -S * -s * -g * -n *
Cmnd_Alias VAGRANT_SMB_REMOVE = /usr/sbin/sharing -r *
Cmnd_Alias VAGRANT_SMB_LIST = /usr/sbin/sharing -l
Cmnd_Alias VAGRANT_SMB_PLOAD = /bin/launchctl load -w /System/Library/LaunchDaemons/com.apple.smb.preferences.plist
Cmnd_Alias VAGRANT_SMB_DLOAD = /bin/launchctl load -w /System/Library/LaunchDaemons/com.apple.smbd.plist
Cmnd_Alias VAGRANT_SMB_DSTART = /bin/launchctl start com.apple.smbd
%admin ALL=(root) NOPASSWD: VAGRANT_SMB_ADD, VAGRANT_SMB_REMOVE, VAGRANT_SMB_LIST, VAGRANT_SMB_PLOAD, VAGRANT_SMB_DLOAD, VAGRANT_SMB_DSTART
</pre></div>
<h3 id="guests">  Guests </h3> <p>The destination machine must be able to mount SMB filesystems. On Linux the package to do this is usually called <code>smbfs</code> or <code>cifs</code>. Vagrant knows how to automatically install this for some operating systems.</p> <h2 id="options">  Options </h2> <p>The SMB synced folder type has a variety of options it accepts:</p> <ul> <li>
<p><a href="#smb_host"><code>smb_host</code></a> (string) - The host IP where the SMB mount is located. If this is not specified, Vagrant will attempt to determine this automatically.</p> </li> <li>
<p><a href="#smb_password"><code>smb_password</code></a> (string) - The password used for authentication to mount the SMB mount. This is the password for the username specified by <code>smb_username</code>. If this is not specified, Vagrant will prompt you for it. It is highly recommended that you do not set this, since it would expose your password directly in your Vagrantfile.</p> </li> <li>
<p><a href="#smb_username"><code>smb_username</code></a> (string) - The username used for authentication to mount the SMB mount. This is the username to access the mount, <em>not</em> the username of the account where the folder is being mounted to. This is usually your Windows username. If you sign into a domain, specify it as <code>user@domain</code>. If this option is not specified, Vagrant will prompt you for it.</p> </li> </ul> <h2 id="example">  Example </h2> <p>The following is an example of using SMB to sync a folder:</p> <div class="highlight"><pre class="highlight ruby" data-language="ruby">Vagrant.configure("2") do |config|
  config.vm.synced_folder ".", "/vagrant", type: "smb"
end
</pre></div>
<h2 id="preventing-idle-disconnects">  Preventing Idle Disconnects </h2> <p>On Windows, if a file is not accessed for some period of time, it may disconnect from the guest and prevent the guest from accessing the SMB-mounted share. To prevent this, the following command can be used in a superuser shell. Note that you should research if this is the right option for you.</p> <div class="highlight"><pre class="highlight plaintext">net config server /autodisconnect:-1
</pre></div>
<h2 id="common-issues">  Common Issues </h2> <h3 id="quot-wrong-fs-type-quot-error">  "wrong fs type" Error </h3> <p>If during mounting on Linux you are seeing an error message that includes the words "wrong fs type," this is because the SMB kernel extension needs to be updated in the OS.</p> <p>If updating the kernel extension is not an option, you can workaround the issue by specifying the following options on your synced folder:</p> <div class="highlight"><pre class="highlight ruby" data-language="ruby">mount_options: ["username=USERNAME","password=PASSWORD"]
</pre></div>
<p>Replace "USERNAME" and "PASSWORD" with your SMB username and password.</p> <p>Vagrant 1.8 changed SMB mounting to use the more secure credential file mechanism. However, many operating systems ship with an outdated filesystem type for SMB out of the box which does not support this. The above workaround reverts Vagrant to the insecure before, but causes it work.</p><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2010&ndash;2018 Mitchell Hashimoto<br>Licensed under the MPL 2.0 License.<br>
    <a href="https://www.vagrantup.com/docs/synced-folders/smb.html" class="_attribution-link">https://www.vagrantup.com/docs/synced-folders/smb.html</a>
  </p>
</div>
