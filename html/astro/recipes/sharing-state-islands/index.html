<h1 id="_top" class="astro-556cgime">Share state between Islands</h1> <div class="content-panel astro-ayt3hsza"> <div class="sl-container astro-ayt3hsza"> <div class="sl-markdown-content astro-klj6ju3r"> <p>When building an Astro website with <a href="../../concepts/islands/index.html">islands architecture / partial hydration</a>, you may have run into this problem: <strong>I want to share state between my components.</strong></p> <p>UI frameworks like React or Vue may encourage <a href="https://react.dev/learn/passing-data-deeply-with-context">‚Äúcontext‚Äù providers</a> for other components to consume. But when <a href="../../guides/framework-components/index.html#hydrating-interactive-components">partially hydrating components</a> within Astro or Markdown, you can‚Äôt use these context wrappers.</p> <p>Astro recommends a different solution for shared client-side storage: <a href="https://github.com/nanostores/nanostores"><strong>Nano Stores</strong></a>.</p> <div class="root astro-u7553m4s"> <div class="flex astro-u7553m4s"> <img src="data:image/webp;base64,UklGRuQEAABXRUJQVlA4WAoAAAAYAAAAMwAANQAAQUxQSGsCAAABoEZrmyFJeiMix7Zt27a9tm3btm3btm3bthVffO8iMyo7avZ/REwAVoo2y6zNnEnJOBS6dBzQdavzbr3ppFUaw5g0nEO94/9g7qebAZlzzpmaMQbo8SQpXsQLeRbyXU0YYNFdP9Mrc4PwkKG7HLD9FAdXA8CxJAOLVZn78hLY0hz2onhltKqIBHJnuJIsuv7KwFI9OQuuHIc16Vmy520wZW1DKUv5WV2YkubQl/dlWQZ13uRfJQkfhEG5DtOVXoJWpn9xI7iS4DDrXVYexJMXolzjsiyrg0abXPPoT9QYJcmjjKmVOVuRRewNlAjlCxfs2BX5rgILTN7/hOOOP/7E088++11q1K1HH374SSccf/xxW3WDMTEWHe5krDJWGfnb7og1aPw6JVIZH6TQk/vCFWU4in8wwUAOgi1Aw08ZUqDn/nBFXQPTFF4V0ztQE7klpldgmsKbq+KWqri5Aq2KNFcOWhVpVqJVEaj/D72VaQpviekZkrkZtU3BSCZzBwCbtwslDfKPB9cBXM7F9KmQfKA73H/upyQjnl8MgQMavM2QDPkX320Dg+bfUhPin7wQFi1/SksZBsO2+DEteu6HWo0/YUhK+DCAK6gimg4Dr2mITtf8SVLFS9Ak+CePtECP7W7/krHBF2qOBC3SIF7JNWAtgJbTdrngofd/FTIII+U//9UQJChzn10AADaz+G/Drq/Tk6+fdOYZZ5xx+tGHfkmv/PX6N/5g4V/v3nnoOMAg17gsc9iD5Fvb1kfhoOeo5Bh0HD5nlfU2WHX+6M4NAcAh0qK//+G69RoBtXKz2siOU+ENiDa1nAEAAFZQOCA8AgAAUA0AnQEqNAA2AD7lYqZPKSUjIiwVXZkgHIlkAMdkbc6KwKFXtoJpaNoyqLQ/FGN00F6wVZIfnXiVi1ZJjkcZ0nNZIsE90QHkgj4yGAjIg8GNR3g1bfXluGis9CqpEDIaIKQSEfuf2Uk/tJygs2T/CpkLOAD++90v7wUm4rf+3+Af0bFf9FDxRxPx/uyNmmuUn84N1S8oeCamnnI71i6f4UiRm8f9Hp1bg3B4DsRB5+mUgzo/4bnweeaxZgh0SL/aJJmVmzy9c8202SrAoix1gA9Mu6pJtpQzIzp5YuIDPxOw+qfShBsZNu7bs2FbLYm9QXO6KOogBnG8yukH0OwiE+DnM/TVmtkTBW16oDUc1kwDuwb2koEyJK3+nIi9vTEJbmgjzNy0hv2qQpmT8IGeGOmWASc8HdwGSXXiapinC4l4um2zabGEmrQWa8rLxGRQ/ZFsnmAvLdTLDk89DnLcpQ78xNMPbbKut8V2OvI0rPE6x/rStU9bxZRN+0T+Wa/kZPFrAtpeEMeI31JeMUUw7ki5RB5R3I4uviJ32A/q+PzE5/JGDVkn7vjHQboTyXOWWQI8qKDwRfPeR4/MHhDprmFlw7Qf/Y4VNXdX4X9DXrU1Dk02qM1tPVpcTLNneaESBYpH9S35JjhN7dD4DlrRVZjvdfI3Xa90VJCaBoCsRLS3lj97HXa2WoLFvBUR1hrmHn7KW+bQCefXaR8JfLC4VFMIDMFfZf8Lf7+0sF+p2hrsjrlHvC/Z1Mf4AABFWElGDgAAAE1NACoAAAAIAAAAAAAA" width="24" alt="" class="astro-u7553m4s"> <strong class="astro-u7553m4s">Related recipe:</strong> <a href="../sharing-state/index.html" class="astro-u7553m4s"> Share state between Astro Components </a> </div> </div> <div tabindex="-1" class="heading-wrapper level-h2"><h2 id="why-nano-stores">Why Nano Stores?</h2></div> <p>The <a href="https://github.com/nanostores/nanostores">Nano Stores</a> library allows you to author stores that any component can interact with. We recommend Nano Stores because:</p> <ul> <li>
<strong>They‚Äôre lightweight.</strong> Nano Stores ship the bare minimum JS you‚Äôll need (less than 1 KB) with zero dependencies.</li> <li>
<strong>They‚Äôre framework-agnostic.</strong> This means sharing state between frameworks will be seamless! Astro is built on flexibility, so we love solutions that offer a similar developer experience no matter your preference.</li> </ul> <p>Still, there are a number of alternatives you can explore. These include:</p> <ul> <li><a href="https://svelte.dev/tutorial/writable-stores">Svelte‚Äôs built-in stores</a></li> <li>
<a href="https://www.solidjs.com/docs/latest">Solid signals</a> outside of a component context</li> <li><a href="https://vuejs.org/guide/scaling-up/state-management.html#simple-state-management-with-reactivity-api">Vue‚Äôs reactivity API</a></li> <li>
<a href="https://developer.mozilla.org/en-US/docs/Web/Events/Creating_and_triggering_events">Sending custom browser events</a> between components</li> </ul> <aside aria-label="FAQ" class="starlight-aside starlight-aside--note"><p class="starlight-aside__title" aria-hidden="true">FAQ</p>
<section class="starlight-aside__content"><details><summary><strong>üôã Can I use Nano Stores in <code dir="auto">.astro</code> files or other server-side components?</strong></summary><p>Nano Stores can be used in <code dir="auto">&lt;script&gt;</code> tags to <a href="../sharing-state/index.html">share state between <code dir="auto">.astro</code> components</a>. However, Using Nano Stores in the frontmatter of server-side components is not recommended because of the following restrictions:</p>
<ul> <li>Writing to a store from a <code dir="auto">.astro</code> file or <a href="../../guides/framework-components/index.html#hydrating-interactive-components">non-hydrated component</a> will <em>not</em> affect the value received by <a href="../../reference/directives-reference/index.html#client-directives">client-side components</a>.</li> <li>You cannot pass a Nano Store as a ‚Äúprop‚Äù to client-side components.</li> <li>You cannot subscribe to store changes from a <code dir="auto">.astro</code> file, since Astro components do not re-render.</li> </ul>
<p>If you understand these restrictions and still find a use case, you can give Nano Stores a try! Just remember that Nano Stores are built for reactivity to changes on the <strong>client</strong> specifically.</p></details><details><summary><strong>üôã How do Svelte stores compare to Nano Stores?</strong></summary><p><strong>Nano Stores and <a href="https://svelte.dev/tutorial/writable-stores">Svelte stores</a> are very similar!</strong> In fact, <a href="https://github.com/nanostores/nanostores#svelte">nanostores allow you to use the same <code dir="auto">$</code> shortcut</a> for subscriptions that you might use with Svelte stores.</p>
<p>If you want to avoid third-party libraries, <a href="https://svelte.dev/tutorial/writable-stores">Svelte stores</a> are a great cross-island communication tool on their own. Still, you might prefer Nano Stores if a) you like their add-ons for <a href="https://github.com/nanostores/nanostores#maps">‚Äúobjects‚Äù</a> and <a href="https://github.com/nanostores/nanostores#lazy-stores">async state</a>, or b) you want to communicate between Svelte and other UI frameworks like Preact or Vue.</p></details><details><summary><strong>üôã How do Solid signals compare to Nano Stores?</strong></summary><p>If you‚Äôve used Solid for a while, you may have tried moving <a href="https://www.solidjs.com/docs/latest#createsignal">signals</a> or <a href="https://www.solidjs.com/docs/latest#createstore">stores</a> outside of your components. This is a great way to share state between Solid islands! Try exporting signals from a shared file:</p>
<div class="expressive-code">
<div class="_pre-heading"><span class="title">sharedStore.js</span></div>
<pre data-language="js">import { createSignal } from 'solid-js';


export const sharedCount = createSignal(0);</pre>

</div>
<p>‚Ä¶and all components importing <code dir="auto">sharedCount</code> will share the same state. Though this works well, you might prefer Nano Stores if a) you like their add-ons for <a href="https://github.com/nanostores/nanostores#maps">‚Äúobjects‚Äù</a> and <a href="https://github.com/nanostores/nanostores#lazy-stores">async state</a>, or b) you want to communicate between Solid and other UI frameworks like Preact or Vue.</p></details></section></aside> <div tabindex="-1" class="heading-wrapper level-h2"><h2 id="installing-nano-stores">Installing Nano Stores</h2></div> <p>To get started, install Nano Stores alongside their helper package for your favorite UI framework:</p> <starlight-tabs data-sync-key="ui-frameworks" class="astro-tx2opqu5"> <div class="tablist-wrapper not-content astro-tx2opqu5"> <ul role="tablist" class="astro-tx2opqu5"> <li role="presentation" class="tab astro-tx2opqu5"> <a role="tab" href="#tab-panel-554" id="tab-554" aria-selected="true" tabindex="0" class="astro-tx2opqu5"> Preact </a> </li>
<li role="presentation" class="tab astro-tx2opqu5"> <a role="tab" href="#tab-panel-555" id="tab-555" aria-selected="false" tabindex="-1" class="astro-tx2opqu5"> React </a> </li>
<li role="presentation" class="tab astro-tx2opqu5"> <a role="tab" href="#tab-panel-556" id="tab-556" aria-selected="false" tabindex="-1" class="astro-tx2opqu5"> Solid </a> </li>
<li role="presentation" class="tab astro-tx2opqu5"> <a role="tab" href="#tab-panel-557" id="tab-557" aria-selected="false" tabindex="-1" class="astro-tx2opqu5"> Svelte </a> </li>
<li role="presentation" class="tab astro-tx2opqu5"> <a role="tab" href="#tab-panel-558" id="tab-558" aria-selected="false" tabindex="-1" class="astro-tx2opqu5"> Vue </a> </li>
<li role="presentation" class="tab astro-tx2opqu5"> <a role="tab" href="#tab-panel-559" id="tab-559" aria-selected="false" tabindex="-1" class="astro-tx2opqu5"> Lit </a> </li> </ul> </div> <section id="tab-panel-554" aria-labelledby="tab-554" role="tabpanel"> <div class="expressive-code">
<div class="_pre-heading">
<span class="sr-only">Terminal window</span>
</div>
<pre data-language="shell">npm install nanostores @nanostores/preact</pre>

</div> </section><section id="tab-panel-555" aria-labelledby="tab-555" role="tabpanel" hidden> <div class="expressive-code">
<div class="_pre-heading">
<span class="sr-only">Terminal window</span>
</div>
<pre data-language="shell">npm install nanostores @nanostores/react</pre>

</div> </section><section id="tab-panel-556" aria-labelledby="tab-556" role="tabpanel" hidden> <div class="expressive-code">
<div class="_pre-heading">
<span class="sr-only">Terminal window</span>
</div>
<pre data-language="shell">npm install nanostores @nanostores/solid</pre>

</div> </section><section id="tab-panel-557" aria-labelledby="tab-557" role="tabpanel" hidden> <div class="expressive-code">
<div class="_pre-heading">
<span class="sr-only">Terminal window</span>
</div>
<pre data-language="shell">npm install nanostores</pre>

</div>
<aside aria-label="Note" class="starlight-aside starlight-aside--note"><p class="starlight-aside__title" aria-hidden="true">Note</p>
<section class="starlight-aside__content"><p>No helper package here! Nano Stores can be used like standard Svelte stores.</p></section></aside> </section><section id="tab-panel-558" aria-labelledby="tab-558" role="tabpanel" hidden> <div class="expressive-code">
<div class="_pre-heading">
<span class="sr-only">Terminal window</span>
</div>
<pre data-language="shell">npm install nanostores @nanostores/vue</pre>

</div> </section><section id="tab-panel-559" aria-labelledby="tab-559" role="tabpanel" hidden> <div class="expressive-code">
<div class="_pre-heading">
<span class="sr-only">Terminal window</span>
</div>
<pre data-language="shell">npm install nanostores @nanostores/lit</pre>

</div> </section> </starlight-tabs> <p>You can jump into the <a href="https://github.com/nanostores/nanostores#guide">Nano Stores usage guide</a> from here, or follow along with our example below!</p> <div tabindex="-1" class="heading-wrapper level-h2"><h2 id="usage-example---ecommerce-cart-flyout">Usage example - ecommerce cart flyout</h2></div> <p>Let‚Äôs say we‚Äôre building a simple ecommerce interface with three interactive elements:</p> <ul> <li>An ‚Äúadd to cart‚Äù submission form</li> <li>A cart flyout to display those added items</li> <li>A cart flyout toggle</li> </ul>  <p><em><a href="https://github.com/withastro/astro/tree/main/examples/with-nanostores"><strong>Try the completed example</strong></a> on your machine or online via StackBlitz.</em></p> <p>Your base Astro file may look like this:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/pages/index.astro</span></div>
<pre data-language="astro">---
import CartFlyoutToggle from '../components/CartFlyoutToggle';
import CartFlyout from '../components/CartFlyout';
import AddToCartForm from '../components/AddToCartForm';
---


&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;...&lt;/head&gt;
&lt;body&gt;
  &lt;header&gt;
    &lt;nav&gt;
      &lt;a href="/.html"&gt;Astro storefront&lt;/a&gt;
      &lt;CartFlyoutToggle client:load /&gt;
    &lt;/nav&gt;
  &lt;/header&gt;
  &lt;main&gt;
    &lt;AddToCartForm client:load&gt;
    &lt;!-- ... --&gt;
    &lt;/AddToCartForm&gt;
  &lt;/main&gt;
  &lt;CartFlyout client:load /&gt;
&lt;/body&gt;
&lt;/html&gt;</pre>

</div> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="using-atoms">Using ‚Äúatoms‚Äù</h3></div> <p>Let‚Äôs start by opening our <code dir="auto">CartFlyout</code> whenever <code dir="auto">CartFlyoutToggle</code> is clicked.</p> <p>First, create a new JS or TS file to contain our store. We‚Äôll use an <a href="https://github.com/nanostores/nanostores#atoms">‚Äúatom‚Äù</a> for this:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/cartStore.js</span></div>
<pre data-language="js">import { atom } from 'nanostores';


export const isCartOpen = atom(false);</pre>

</div> <p>Now, we can import this store into any file that needs to read or write. We‚Äôll start by wiring up our <code dir="auto">CartFlyoutToggle</code>:</p> <starlight-tabs data-sync-key="ui-frameworks" class="astro-tx2opqu5"> <div class="tablist-wrapper not-content astro-tx2opqu5"> <ul role="tablist" class="astro-tx2opqu5"> <li role="presentation" class="tab astro-tx2opqu5"> <a role="tab" href="#tab-panel-560" id="tab-560" aria-selected="true" tabindex="0" class="astro-tx2opqu5"> Preact </a> </li>
<li role="presentation" class="tab astro-tx2opqu5"> <a role="tab" href="#tab-panel-561" id="tab-561" aria-selected="false" tabindex="-1" class="astro-tx2opqu5"> React </a> </li>
<li role="presentation" class="tab astro-tx2opqu5"> <a role="tab" href="#tab-panel-562" id="tab-562" aria-selected="false" tabindex="-1" class="astro-tx2opqu5"> Solid </a> </li>
<li role="presentation" class="tab astro-tx2opqu5"> <a role="tab" href="#tab-panel-563" id="tab-563" aria-selected="false" tabindex="-1" class="astro-tx2opqu5"> Svelte </a> </li>
<li role="presentation" class="tab astro-tx2opqu5"> <a role="tab" href="#tab-panel-564" id="tab-564" aria-selected="false" tabindex="-1" class="astro-tx2opqu5"> Vue </a> </li>
<li role="presentation" class="tab astro-tx2opqu5"> <a role="tab" href="#tab-panel-565" id="tab-565" aria-selected="false" tabindex="-1" class="astro-tx2opqu5"> Lit </a> </li> </ul> </div> <section id="tab-panel-560" aria-labelledby="tab-560" role="tabpanel"> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/components/CartFlyoutToggle.jsx</span></div>
<pre data-language="jsx">import { useStore } from '@nanostores/preact';
import { isCartOpen } from '../cartStore';


export default function CartButton() {
  // read the store value with the `useStore` hook
  const $isCartOpen = useStore(isCartOpen);
  // write to the imported store using `.set`
  return (
    &lt;button onClick={() =&gt; isCartOpen.set(!$isCartOpen)}&gt;Cart&lt;/button&gt;
  )
}</pre>

</div> </section><section id="tab-panel-561" aria-labelledby="tab-561" role="tabpanel" hidden> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/components/CartFlyoutToggle.jsx</span></div>
<pre data-language="jsx">import { useStore } from '@nanostores/react';
import { isCartOpen } from '../cartStore';


export default function CartButton() {
  // read the store value with the `useStore` hook
  const $isCartOpen = useStore(isCartOpen);
  // write to the imported store using `.set`
  return (
    &lt;button onClick={() =&gt; isCartOpen.set(!$isCartOpen)}&gt;Cart&lt;/button&gt;
  )
}</pre>

</div> </section><section id="tab-panel-562" aria-labelledby="tab-562" role="tabpanel" hidden> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/components/CartFlyoutToggle.jsx</span></div>
<pre data-language="jsx">import { useStore } from '@nanostores/solid';
import { isCartOpen } from '../cartStore';


export default function CartButton() {
  // read the store value with the `useStore` hook
  const $isCartOpen = useStore(isCartOpen);
  // write to the imported store using `.set`
  return (
    &lt;button onClick={() =&gt; isCartOpen.set(!$isCartOpen())}&gt;Cart&lt;/button&gt;
  )
}</pre>

</div> </section><section id="tab-panel-563" aria-labelledby="tab-563" role="tabpanel" hidden> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/components/CartFlyoutToggle.svelte</span></div>
<pre data-language="svelte">&lt;script&gt;
  import { isCartOpen } from '../cartStore';
&lt;/script&gt;


&lt;!--use "$" to read the store value--&gt;
&lt;button on:click={() =&gt; isCartOpen.set(!$isCartOpen)}&gt;Cart&lt;/button&gt;</pre>

</div> </section><section id="tab-panel-564" aria-labelledby="tab-564" role="tabpanel" hidden> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/components/CartFlyoutToggle.vue</span></div>
<pre data-language="vue">&lt;template&gt;
  &lt;!--write to the imported store using `.set`--&gt;
  &lt;button @click="isCartOpen.set(!$isCartOpen)"&gt;Cart&lt;/button&gt;
&lt;/template&gt;


&lt;script setup&gt;
  import { isCartOpen } from '../cartStore';
  import { useStore } from '@nanostores/vue';


  // read the store value with the `useStore` hook
  const $isCartOpen = useStore(isCartOpen);
&lt;/script&gt;</pre>

</div> </section><section id="tab-panel-565" aria-labelledby="tab-565" role="tabpanel" hidden> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/components/CartFlyoutToggle.ts</span></div>
<pre data-language="ts">import { LitElement, html } from 'lit';
import { isCartOpen } from '../cartStore';


export class CartFlyoutToggle extends LitElement {
  handleClick() {
    isCartOpen.set(!isCartOpen.get());
  }


  render() {
    return html`
      &lt;button @click="${this.handleClick}"&gt;Cart&lt;/button&gt;
    `;
  }
}


customElements.define('cart-flyout-toggle', CartFlyoutToggle);</pre>

</div> </section> </starlight-tabs> <p>Then, we can read <code dir="auto">isCartOpen</code> from our <code dir="auto">CartFlyout</code> component:</p> <starlight-tabs data-sync-key="ui-frameworks" class="astro-tx2opqu5"> <div class="tablist-wrapper not-content astro-tx2opqu5"> <ul role="tablist" class="astro-tx2opqu5"> <li role="presentation" class="tab astro-tx2opqu5"> <a role="tab" href="#tab-panel-566" id="tab-566" aria-selected="true" tabindex="0" class="astro-tx2opqu5"> Preact </a> </li>
<li role="presentation" class="tab astro-tx2opqu5"> <a role="tab" href="#tab-panel-567" id="tab-567" aria-selected="false" tabindex="-1" class="astro-tx2opqu5"> React </a> </li>
<li role="presentation" class="tab astro-tx2opqu5"> <a role="tab" href="#tab-panel-568" id="tab-568" aria-selected="false" tabindex="-1" class="astro-tx2opqu5"> Solid </a> </li>
<li role="presentation" class="tab astro-tx2opqu5"> <a role="tab" href="#tab-panel-569" id="tab-569" aria-selected="false" tabindex="-1" class="astro-tx2opqu5"> Svelte </a> </li>
<li role="presentation" class="tab astro-tx2opqu5"> <a role="tab" href="#tab-panel-570" id="tab-570" aria-selected="false" tabindex="-1" class="astro-tx2opqu5"> Vue </a> </li>
<li role="presentation" class="tab astro-tx2opqu5"> <a role="tab" href="#tab-panel-571" id="tab-571" aria-selected="false" tabindex="-1" class="astro-tx2opqu5"> Lit </a> </li> </ul> </div> <section id="tab-panel-566" aria-labelledby="tab-566" role="tabpanel"> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/components/CartFlyout.jsx</span></div>
<pre data-language="jsx">import { useStore } from '@nanostores/preact';
import { isCartOpen } from '../cartStore';


export default function CartFlyout() {
  const $isCartOpen = useStore(isCartOpen);


  return $isCartOpen ? &lt;aside&gt;...&lt;/aside&gt; : null;
}</pre>

</div> </section><section id="tab-panel-567" aria-labelledby="tab-567" role="tabpanel" hidden> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/components/CartFlyout.jsx</span></div>
<pre data-language="jsx">import { useStore } from '@nanostores/react';
import { isCartOpen } from '../cartStore';


export default function CartFlyout() {
  const $isCartOpen = useStore(isCartOpen);


  return $isCartOpen ? &lt;aside&gt;...&lt;/aside&gt; : null;
}</pre>

</div> </section><section id="tab-panel-568" aria-labelledby="tab-568" role="tabpanel" hidden> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/components/CartFlyout.jsx</span></div>
<pre data-language="jsx">import { useStore } from '@nanostores/solid';
import { isCartOpen } from '../cartStore';


export default function CartFlyout() {
  const $isCartOpen = useStore(isCartOpen);


  return $isCartOpen() ? &lt;aside&gt;...&lt;/aside&gt; : null;
}</pre>

</div> </section><section id="tab-panel-569" aria-labelledby="tab-569" role="tabpanel" hidden> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/components/CartFlyout.svelte</span></div>
<pre data-language="svelte">&lt;script&gt;
  import { isCartOpen } from '../cartStore';
&lt;/script&gt;


{#if $isCartOpen}
&lt;aside&gt;...&lt;/aside&gt;
{/if}</pre>

</div> </section><section id="tab-panel-570" aria-labelledby="tab-570" role="tabpanel" hidden> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/components/CartFlyout.vue</span></div>
<pre data-language="vue">&lt;template&gt;
  &lt;aside v-if="$isCartOpen"&gt;...&lt;/aside&gt;
&lt;/template&gt;


&lt;script setup&gt;
  import { isCartOpen } from '../cartStore';
  import { useStore } from '@nanostores/vue';


  const $isCartOpen = useStore(isCartOpen);
&lt;/script&gt;</pre>

</div> </section><section id="tab-panel-571" aria-labelledby="tab-571" role="tabpanel" hidden> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/components/CartFlyout.ts</span></div>
<pre data-language="ts">import { isCartOpen } from '../cartStore';
import { LitElement, html } from 'lit';
import { StoreController } from '@nanostores/lit';


export class CartFlyout extends LitElement {
  private cartOpen = new StoreController(this, isCartOpen);


  render() {
    return this.cartOpen.value ? html`&lt;aside&gt;...&lt;/aside&gt;` : null;
  }
}


customElements.define('cart-flyout', CartFlyout);</pre>

</div> </section> </starlight-tabs> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="using-maps">Using ‚Äúmaps‚Äù</h3></div> <aside aria-label="Tip" class="starlight-aside starlight-aside--tip"><p class="starlight-aside__title" aria-hidden="true">Tip</p>
<section class="starlight-aside__content"><p><strong><a href="https://github.com/nanostores/nanostores#maps">Maps</a> are a great choice for objects you write to regularly!</strong> Alongside the standard <code dir="auto">get()</code> and <code dir="auto">set()</code> helpers an <code dir="auto">atom</code> provides, you‚Äôll also have a <code dir="auto">.setKey()</code> function to efficiently update individual object keys.</p></section></aside> <p>Now, let‚Äôs keep track of the items inside your cart. To avoid duplicates and keep track of ‚Äúquantity,‚Äù we can store your cart as an object with the item‚Äôs ID as a key. We‚Äôll use a <a href="https://github.com/nanostores/nanostores#maps">Map</a> for this.</p> <p>Let‚Äôs add a <code dir="auto">cartItem</code> store to our <code dir="auto">cartStore.js</code> from earlier. You can also switch to a TypeScript file to define the shape if you‚Äôre so inclined.</p> <starlight-tabs data-sync-key="javascript-flavors" class="astro-tx2opqu5"> <div class="tablist-wrapper not-content astro-tx2opqu5"> <ul role="tablist" class="astro-tx2opqu5"> <li role="presentation" class="tab astro-tx2opqu5"> <a role="tab" href="#tab-panel-550" id="tab-550" aria-selected="true" tabindex="0" class="astro-tx2opqu5"> JavaScript </a> </li>
<li role="presentation" class="tab astro-tx2opqu5"> <a role="tab" href="#tab-panel-551" id="tab-551" aria-selected="false" tabindex="-1" class="astro-tx2opqu5"> TypeScript </a> </li> </ul> </div> <section id="tab-panel-550" aria-labelledby="tab-550" role="tabpanel"> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/cartStore.js</span></div>
<pre data-language="js">import { atom, map } from 'nanostores';


export const isCartOpen = atom(false);


/**
 * @typedef {Object} CartItem
 * @property {string} id
 * @property {string} name
 * @property {string} imageSrc
 * @property {number} quantity
 */


/** @type {import('nanostores').MapStore&lt;Record&lt;string, CartItem&gt;&gt;} */
export const cartItems = map({});</pre>

</div> </section> <section id="tab-panel-551" aria-labelledby="tab-551" role="tabpanel" hidden> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/cartStore.ts</span></div>
<pre data-language="ts">import { atom, map } from 'nanostores';


export const isCartOpen = atom(false);


export type CartItem = {
  id: string;
  name: string;
  imageSrc: string;
  quantity: number;
}


export const cartItems = map&lt;Record&lt;string, CartItem&gt;&gt;({});</pre>

</div> </section> </starlight-tabs>  <p>Now, let‚Äôs export an <code dir="auto">addCartItem</code> helper for our components to use.</p> <ul> <li>
<strong>If that item doesn‚Äôt exist in your cart</strong>, add the item with a starting quantity of 1.</li> <li>
<strong>If that item <em>does</em> already exist</strong>, bump the quantity by 1.</li> </ul> <starlight-tabs data-sync-key="javascript-flavors" class="astro-tx2opqu5"> <div class="tablist-wrapper not-content astro-tx2opqu5"> <ul role="tablist" class="astro-tx2opqu5"> <li role="presentation" class="tab astro-tx2opqu5"> <a role="tab" href="#tab-panel-552" id="tab-552" aria-selected="true" tabindex="0" class="astro-tx2opqu5"> JavaScript </a> </li>
<li role="presentation" class="tab astro-tx2opqu5"> <a role="tab" href="#tab-panel-553" id="tab-553" aria-selected="false" tabindex="-1" class="astro-tx2opqu5"> TypeScript </a> </li> </ul> </div> <section id="tab-panel-552" aria-labelledby="tab-552" role="tabpanel"> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/cartStore.js</span></div>
<pre data-language="js">...
export function addCartItem({ id, name, imageSrc }) {
  const existingEntry = cartItems.get()[id];
  if (existingEntry) {
    cartItems.setKey(id, {
      ...existingEntry,
      quantity: existingEntry.quantity + 1,
    })
  } else {
    cartItems.setKey(
      id,
      { id, name, imageSrc, quantity: 1 }
    );
  }
}</pre>

</div> </section> <section id="tab-panel-553" aria-labelledby="tab-553" role="tabpanel" hidden> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/cartStore.ts</span></div>
<pre data-language="ts">...
type ItemDisplayInfo = Pick&lt;CartItem, 'id' | 'name' | 'imageSrc'&gt;;
export function addCartItem({ id, name, imageSrc }: ItemDisplayInfo) {
  const existingEntry = cartItems.get()[id];
  if (existingEntry) {
    cartItems.setKey(id, {
      ...existingEntry,
      quantity: existingEntry.quantity + 1,
    });
  } else {
    cartItems.setKey(
      id,
      { id, name, imageSrc, quantity: 1 }
    );
  }
}</pre>

</div> </section> </starlight-tabs> <aside aria-label="Note" class="starlight-aside starlight-aside--note"><p class="starlight-aside__title" aria-hidden="true">Note</p>
<section class="starlight-aside__content"><details><summary><strong>üôã Why use <code dir="auto">.get()</code> here instead of a <code dir="auto">useStore</code> helper?</strong></summary><p>You may have noticed we‚Äôre calling <code dir="auto">cartItems.get()</code> here, instead of grabbing that <code dir="auto">useStore</code> helper from our React / Preact / Solid / Vue examples. This is because <strong>useStore is meant to trigger component re-renders.</strong> In other words, <code dir="auto">useStore</code> should be used whenever the store value is being rendered to the UI. Since we‚Äôre reading the value when an <strong>event</strong> is triggered (<code dir="auto">addToCart</code> in this case), and we aren‚Äôt trying to render that value, we don‚Äôt need <code dir="auto">useStore</code> here.</p></details></section></aside> <p>With our store in place, we can call this function inside our <code dir="auto">AddToCartForm</code> whenever that form is submitted. We‚Äôll also open the cart flyout so you can see a full cart summary.</p> <starlight-tabs data-sync-key="ui-frameworks" class="astro-tx2opqu5"> <div class="tablist-wrapper not-content astro-tx2opqu5"> <ul role="tablist" class="astro-tx2opqu5"> <li role="presentation" class="tab astro-tx2opqu5"> <a role="tab" href="#tab-panel-572" id="tab-572" aria-selected="true" tabindex="0" class="astro-tx2opqu5"> Preact </a> </li>
<li role="presentation" class="tab astro-tx2opqu5"> <a role="tab" href="#tab-panel-573" id="tab-573" aria-selected="false" tabindex="-1" class="astro-tx2opqu5"> React </a> </li>
<li role="presentation" class="tab astro-tx2opqu5"> <a role="tab" href="#tab-panel-574" id="tab-574" aria-selected="false" tabindex="-1" class="astro-tx2opqu5"> Solid </a> </li>
<li role="presentation" class="tab astro-tx2opqu5"> <a role="tab" href="#tab-panel-575" id="tab-575" aria-selected="false" tabindex="-1" class="astro-tx2opqu5"> Svelte </a> </li>
<li role="presentation" class="tab astro-tx2opqu5"> <a role="tab" href="#tab-panel-576" id="tab-576" aria-selected="false" tabindex="-1" class="astro-tx2opqu5"> Vue </a> </li>
<li role="presentation" class="tab astro-tx2opqu5"> <a role="tab" href="#tab-panel-577" id="tab-577" aria-selected="false" tabindex="-1" class="astro-tx2opqu5"> Lit </a> </li> </ul> </div> <section id="tab-panel-572" aria-labelledby="tab-572" role="tabpanel"> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/components/AddToCartForm.jsx</span></div>
<pre data-language="jsx">import { addCartItem, isCartOpen } from '../cartStore';


export default function AddToCartForm({ children }) {
  // we'll hardcode the item info for simplicity!
  const hardcodedItemInfo = {
    id: 'astronaut-figurine',
    name: 'Astronaut Figurine',
    imageSrc: '/images/astronaut-figurine.png',
  }


  function addToCart(e) {
    e.preventDefault();
    isCartOpen.set(true);
    addCartItem(hardcodedItemInfo);
  }


  return (
    &lt;form onSubmit={addToCart}&gt;
      {children}
    &lt;/form&gt;
  )
}</pre>

</div> </section><section id="tab-panel-573" aria-labelledby="tab-573" role="tabpanel" hidden> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/components/AddToCartForm.jsx</span></div>
<pre data-language="jsx">import { addCartItem, isCartOpen } from '../cartStore';


export default function AddToCartForm({ children }) {
  // we'll hardcode the item info for simplicity!
  const hardcodedItemInfo = {
    id: 'astronaut-figurine',
    name: 'Astronaut Figurine',
    imageSrc: '/images/astronaut-figurine.png',
  }


  function addToCart(e) {
    e.preventDefault();
    isCartOpen.set(true);
    addCartItem(hardcodedItemInfo);
  }


  return (
    &lt;form onSubmit={addToCart}&gt;
      {children}
    &lt;/form&gt;
  )
}</pre>

</div> </section><section id="tab-panel-574" aria-labelledby="tab-574" role="tabpanel" hidden> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/components/AddToCartForm.jsx</span></div>
<pre data-language="jsx">import { addCartItem, isCartOpen } from '../cartStore';


export default function AddToCartForm({ children }) {
  // we'll hardcode the item info for simplicity!
  const hardcodedItemInfo = {
    id: 'astronaut-figurine',
    name: 'Astronaut Figurine',
    imageSrc: '/images/astronaut-figurine.png',
  }


  function addToCart(e) {
    e.preventDefault();
    isCartOpen.set(true);
    addCartItem(hardcodedItemInfo);
  }


  return (
    &lt;form onSubmit={addToCart}&gt;
      {children}
    &lt;/form&gt;
  )
}</pre>

</div> </section><section id="tab-panel-575" aria-labelledby="tab-575" role="tabpanel" hidden> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/components/AddToCartForm.svelte</span></div>
<pre data-language="svelte">&lt;form on:submit|preventDefault={addToCart}&gt;
  &lt;slot&gt;&lt;/slot&gt;
&lt;/form&gt;


&lt;script&gt;
  import { addCartItem, isCartOpen } from '../cartStore';


  // we'll hardcode the item info for simplicity!
  const hardcodedItemInfo = {
    id: 'astronaut-figurine',
    name: 'Astronaut Figurine',
    imageSrc: '/images/astronaut-figurine.png',
  }


  function addToCart() {
    isCartOpen.set(true);
    addCartItem(hardcodedItemInfo);
  }
&lt;/script&gt;</pre>

</div> </section><section id="tab-panel-576" aria-labelledby="tab-576" role="tabpanel" hidden> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/components/AddToCartForm.vue</span></div>
<pre data-language="vue">&lt;template&gt;
  &lt;form @submit="addToCart"&gt;
    &lt;slot&gt;&lt;/slot&gt;
  &lt;/form&gt;
&lt;/template&gt;


&lt;script setup&gt;
  import { addCartItem, isCartOpen } from '../cartStore';


  // we'll hardcode the item info for simplicity!
  const hardcodedItemInfo = {
    id: 'astronaut-figurine',
    name: 'Astronaut Figurine',
    imageSrc: '/images/astronaut-figurine.png',
  }


  function addToCart(e) {
    e.preventDefault();
    isCartOpen.set(true);
    addCartItem(hardcodedItemInfo);
  }
&lt;/script&gt;</pre>

</div> </section><section id="tab-panel-577" aria-labelledby="tab-577" role="tabpanel" hidden> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/components/AddToCartForm.ts</span></div>
<pre data-language="ts">import { LitElement, html } from 'lit';
import { isCartOpen, addCartItem } from '../cartStore';


export class AddToCartForm extends LitElement {
  static get properties() {
    return {
      item: { type: Object },
    };
  }


  constructor() {
    super();
    this.item = {};
  }


  addToCart(e) {
    e.preventDefault();
    isCartOpen.set(true);
    addCartItem(this.item);
  }


  render() {
    return html`
      &lt;form @submit="${this.addToCart}"&gt;
        &lt;slot&gt;&lt;/slot&gt;
      &lt;/form&gt;
    `;
  }
}
customElements.define('add-to-cart-form', AddToCartForm);</pre>

</div> </section> </starlight-tabs> <p>Finally, we‚Äôll render those cart items inside our <code dir="auto">CartFlyout</code>:</p> <starlight-tabs data-sync-key="ui-frameworks" class="astro-tx2opqu5"> <div class="tablist-wrapper not-content astro-tx2opqu5"> <ul role="tablist" class="astro-tx2opqu5"> <li role="presentation" class="tab astro-tx2opqu5"> <a role="tab" href="#tab-panel-578" id="tab-578" aria-selected="true" tabindex="0" class="astro-tx2opqu5"> Preact </a> </li>
<li role="presentation" class="tab astro-tx2opqu5"> <a role="tab" href="#tab-panel-579" id="tab-579" aria-selected="false" tabindex="-1" class="astro-tx2opqu5"> React </a> </li>
<li role="presentation" class="tab astro-tx2opqu5"> <a role="tab" href="#tab-panel-580" id="tab-580" aria-selected="false" tabindex="-1" class="astro-tx2opqu5"> Solid </a> </li>
<li role="presentation" class="tab astro-tx2opqu5"> <a role="tab" href="#tab-panel-581" id="tab-581" aria-selected="false" tabindex="-1" class="astro-tx2opqu5"> Svelte </a> </li>
<li role="presentation" class="tab astro-tx2opqu5"> <a role="tab" href="#tab-panel-582" id="tab-582" aria-selected="false" tabindex="-1" class="astro-tx2opqu5"> Vue </a> </li>
<li role="presentation" class="tab astro-tx2opqu5"> <a role="tab" href="#tab-panel-583" id="tab-583" aria-selected="false" tabindex="-1" class="astro-tx2opqu5"> Lit </a> </li> </ul> </div> <section id="tab-panel-578" aria-labelledby="tab-578" role="tabpanel"> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/components/CartFlyout.jsx</span></div>
<pre data-language="jsx">import { useStore } from '@nanostores/preact';
import { isCartOpen, cartItems } from '../cartStore';


export default function CartFlyout() {
  const $isCartOpen = useStore(isCartOpen);
  const $cartItems = useStore(cartItems);


  return $isCartOpen ? (
    &lt;aside&gt;
      {Object.values($cartItems).length ? (
        &lt;ul&gt;
          {Object.values($cartItems).map(cartItem =&gt; (
            &lt;li&gt;
              &lt;img src={cartItem.imageSrc} alt={cartItem.name} /&gt;
              &lt;h3&gt;{cartItem.name}&lt;/h3&gt;
              &lt;p&gt;Quantity: {cartItem.quantity}&lt;/p&gt;
            &lt;/li&gt;
          ))}
        &lt;/ul&gt;
      ) : &lt;p&gt;Your cart is empty!&lt;/p&gt;}
    &lt;/aside&gt;
  ) : null;
}</pre>

</div> </section><section id="tab-panel-579" aria-labelledby="tab-579" role="tabpanel" hidden> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/components/CartFlyout.jsx</span></div>
<pre data-language="jsx">import { useStore } from '@nanostores/react';
import { isCartOpen, cartItems } from '../cartStore';


export default function CartFlyout() {
  const $isCartOpen = useStore(isCartOpen);
  const $cartItems = useStore(cartItems);


  return $isCartOpen ? (
    &lt;aside&gt;
      {Object.values($cartItems).length ? (
        &lt;ul&gt;
          {Object.values($cartItems).map(cartItem =&gt; (
            &lt;li&gt;
              &lt;img src={cartItem.imageSrc} alt={cartItem.name} /&gt;
              &lt;h3&gt;{cartItem.name}&lt;/h3&gt;
              &lt;p&gt;Quantity: {cartItem.quantity}&lt;/p&gt;
            &lt;/li&gt;
          ))}
        &lt;/ul&gt;
      ) : &lt;p&gt;Your cart is empty!&lt;/p&gt;}
    &lt;/aside&gt;
  ) : null;
}</pre>

</div> </section><section id="tab-panel-580" aria-labelledby="tab-580" role="tabpanel" hidden> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/components/CartFlyout.jsx</span></div>
<pre data-language="jsx">import { useStore } from '@nanostores/solid';
import { isCartOpen, cartItems } from '../cartStore';


export default function CartFlyout() {
  const $isCartOpen = useStore(isCartOpen);
  const $cartItems = useStore(cartItems);


  return $isCartOpen() ? (
    &lt;aside&gt;
      {Object.values($cartItems()).length ? (
        &lt;ul&gt;
          {Object.values($cartItems()).map(cartItem =&gt; (
            &lt;li&gt;
              &lt;img src={cartItem.imageSrc} alt={cartItem.name} /&gt;
              &lt;h3&gt;{cartItem.name}&lt;/h3&gt;
              &lt;p&gt;Quantity: {cartItem.quantity}&lt;/p&gt;
            &lt;/li&gt;
          ))}
        &lt;/ul&gt;
      ) : &lt;p&gt;Your cart is empty!&lt;/p&gt;}
    &lt;/aside&gt;
  ) : null;
}</pre>

</div> </section><section id="tab-panel-581" aria-labelledby="tab-581" role="tabpanel" hidden> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/components/CartFlyout.svelte</span></div>
<pre data-language="svelte">&lt;script&gt;
  import { isCartOpen, cartItems } from '../cartStore';
&lt;/script&gt;


{#if $isCartOpen}
  {#if Object.values($cartItems).length}
    &lt;aside&gt;
      {#each Object.values($cartItems) as cartItem}
      &lt;li&gt;
        &lt;img src={cartItem.imageSrc} alt={cartItem.name} /&gt;
        &lt;h3&gt;{cartItem.name}&lt;/h3&gt;
        &lt;p&gt;Quantity: {cartItem.quantity}&lt;/p&gt;
      &lt;/li&gt;
      {/each}
    &lt;/aside&gt;
  {:else}
    &lt;p&gt;Your cart is empty!&lt;/p&gt;
  {/if}
{/if}</pre>

</div> </section><section id="tab-panel-582" aria-labelledby="tab-582" role="tabpanel" hidden> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/components/CartFlyout.vue</span></div>
<pre data-language="vue">&lt;template&gt;
  &lt;aside v-if="$isCartOpen"&gt;
    &lt;ul v-if="Object.values($cartItems).length"&gt;
      &lt;li v-for="cartItem in Object.values($cartItems)" v-bind:key="cartItem.name"&gt;
        &lt;img :src=cartItem.imageSrc :alt=cartItem.name /&gt;
        &lt;h3&gt;{{cartItem.name}}&lt;/h3&gt;
        &lt;p&gt;Quantity: {{cartItem.quantity}}&lt;/p&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
    &lt;p v-else&gt;Your cart is empty!&lt;/p&gt;
  &lt;/aside&gt;
&lt;/template&gt;


&lt;script setup&gt;
  import { cartItems, isCartOpen } from '../cartStore';
  import { useStore } from '@nanostores/vue';


  const $isCartOpen = useStore(isCartOpen);
  const $cartItems = useStore(cartItems);
&lt;/script&gt;</pre>

</div> </section><section id="tab-panel-583" aria-labelledby="tab-583" role="tabpanel" hidden> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/components/CartFlyout.ts</span></div>
<pre data-language="ts">import { LitElement, html } from 'lit';
import { isCartOpen, cartItems } from '../cartStore';
import { StoreController } from '@nanostores/lit';


export class CartFlyoutLit extends LitElement {
  private cartOpen = new StoreController(this, isCartOpen);
  private getCartItems = new StoreController(this, cartItems);


  renderCartItem(cartItem) {
    return html`
      &lt;li&gt;
        &lt;img src="${cartItem.imageSrc}" alt="${cartItem.name}" /&gt;
        &lt;h3&gt;${cartItem.name}&lt;/h3&gt;
        &lt;p&gt;Quantity: ${cartItem.quantity}&lt;/p&gt;
      &lt;/li&gt;
    `;
  }


  render() {
    return this.cartOpen.value
      ? html`
          &lt;aside&gt;
            ${
              Object.values(this.getCartItems.value).length
                ? html`
                  &lt;ul&gt;
                    ${Object.values(this.getCartItems.value).map((cartItem) =&gt;
                      this.renderCartItem(cartItem)
                    )}
                  &lt;/ul&gt;
                `
                : html`&lt;p&gt;Your cart is empty!&lt;/p&gt;`
            }
          &lt;/aside&gt;
        `
      : null;
  }
}


customElements.define('cart-flyout', CartFlyoutLit);</pre>

</div> </section> </starlight-tabs> <p>Now, you should have a fully interactive ecommerce example with the smallest JS bundle in the galaxy üöÄ</p> <p><a href="https://github.com/withastro/astro/tree/main/examples/with-nanostores"><strong>Try the completed example</strong></a> on your machine or online via StackBlitz!</p> <span id="docsearch-lvl0" hidden class="astro-klj6ju3r">Recipes</span> </div>   </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2021 Fred K. Schott<br>Licensed under the MIT License.<br>
    <a href="https://docs.astro.build/en/recipes/sharing-state-islands/" class="_attribution-link">https://docs.astro.build/en/recipes/sharing-state-islands/</a>
  </p>
</div>
