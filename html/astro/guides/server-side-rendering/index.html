<h1 class="content-title astro-j75b3yus" id="overview">Server⁠-⁠side Rendering</h1> <p>Server-side rendering (SSR) refers to generating HTML pages on the server on-demand and sending them to the client.</p> <p>SSR allows you to:</p> <ul> <li>Implement sessions for login state in your app.</li> <li>Render data from an API called dynamically with <code>fetch</code>.</li> <li>Deploy your site to a host using an <em>adapter</em>.</li> </ul> <p>Consider enabling server-side rendering in your Astro project if you need the following:</p> <ul> <li> <p><strong>API endpoints</strong>: SSR enables you to create specific pages that function as API endpoints for tasks like database access, authentication, and authorization while keeping sensitive data hidden from the client.</p> </li> <li> <p><strong>Protected pages</strong>: If you need to restrict access to a page based on user privileges, you can enable SSR to handle user access on the server.</p> </li> <li> <p><strong>Frequently changing content</strong>: Enabling SSR lets you generate individual pages without requiring a static rebuild of your site. This is useful when the content of a page updates frequently.</p> </li> </ul> <div tabindex="-1" class="heading-wrapper level-h2"><h2 id="enabling-ssr-in-your-project">Enabling SSR in Your Project</h2></div> <p>To enable SSR features for production deployments, update your <code>output</code> configuration to <code>'server'</code> or <code>'hybrid'</code> (introduced in <strong>v2.6.0</strong>). Both of these modes control which <a href="../../core-concepts/astro-pages/index.html">pages</a> or <a href="../../core-concepts/endpoints/index.html#server-endpoints-api-routes">server endpoints</a> should be server-rendered. Each configuration option has a different default behavior, and allows individual routes to opt-out of the default accordingly:</p> <ul> <li>
<strong><code>output: 'server'</code></strong>: Server-rendered by default. Use this when most or all of your site should be server-rendered. Any individual page or endpoint can <em>opt-in</em> to pre-rendering.</li> <li>
<strong><code>output: 'hybrid'</code></strong>: Pre-rendered to HTML by default. Use this when most of your site should be static. Any individual page or endpoint can <em>opt-out</em> of pre-rendering.</li> </ul> <div class="expressive-code ec ec-s1gwf">
<div class="_pre-heading"><span class="title">astro.config.mjs</span></div>


</div> <p>You can then opt-out of the default rendering behavior with an export statement in any page or route:</p> <div class="expressive-code ec ec-s1gwf">
<div class="_pre-heading"><span class="title">src/pages/mypage.astro</span></div>


</div> <p>See more usage examples of <a href="#configuring-individual-routes">configuring individual routes</a></p> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="converting-a-static-site-to-hybrid-rendering">Converting a static site to hybrid rendering</h3></div> <p>To convert an existing static Astro site to allow hybrid rendering, change the <code>output</code> to <code>'hybrid'</code> and add an adapter:</p> <div class="expressive-code ec ec-s1gwf">
<div class="_pre-heading"><span class="title">astro.config.mjs</span></div>


</div> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="adding-an-adapter">Adding an Adapter</h3></div> <p>When it’s time to deploy an SSR project, you also need to add an adapter. This is because SSR requires a server <em>runtime</em>: the environment that runs your server-side code. Each adapter allows Astro to output a script that runs your project on a specific runtime.</p> <p>You can find both <a href="https://astro.build/integrations/?search=&amp;categories%5B%5D=adapters">official and community SSR adapters in our integrations directory</a>.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="astro-add-install">
<code>astro add</code> Install</h4></div> <p>You can add any of the <a href="../integrations-guide/index.html">official Astro adapter integrations</a> with the following <code>astro add</code> command. This will install the adapter and make the appropriate changes to your <code>astro.config.mjs</code> file in one step. For example, to install the Vercel adapter, run:</p> <astro-island uid="Z2gj73o" component-url="/_astro/Tabs.3d721b18.js" component-export="default" renderer-url="/_astro/client.d87097da.js" props='{"sharedStore":[0,"package-managers"]}' ssr="" client="idle" opts='{"name":"Tabs","value":true}' await-children=""><div class="_container_1kkny_1">
<div class="_tab-scroll-overflow_1kkny_6"><div class="_tablist_1kkny_30 TabGroup no-flex" role="tablist">
<button aria-selected="true" tabindex="0" role="tab" type="button" class="_tab_1kkny_6" id="137-tab.npm"><astro-slot name="tab.npm">npm</astro-slot></button><button aria-selected="false" tabindex="-1" role="tab" type="button" class="_tab_1kkny_6" id="137-tab.pnpm"><astro-slot name="tab.pnpm">pnpm</astro-slot></button><button aria-selected="false" tabindex="-1" role="tab" type="button" class="_tab_1kkny_6" id="137-tab.yarn"><astro-slot name="tab.yarn">Yarn</astro-slot></button>
</div></div>
<div role="tabpanel" aria-labelledby="137-tab.npm" class="_tabpanel_1kkny_26"><astro-slot name="panel.npm"> <div class="expressive-code ec ec-s1gwf">
<div class="_pre-heading">
<span class="sr-only">Terminal window</span>
</div>


</div> </astro-slot></div>
<div hidden role="tabpanel" aria-labelledby="137-tab.pnpm" class="_tabpanel_1kkny_26"><astro-slot name="panel.pnpm"> <div class="expressive-code ec ec-s1gwf">
<div class="_pre-heading">
<span class="sr-only">Terminal window</span>
</div>


</div> </astro-slot></div>
<div hidden role="tabpanel" aria-labelledby="137-tab.yarn" class="_tabpanel_1kkny_26"><astro-slot name="panel.yarn"> <div class="expressive-code ec ec-s1gwf">
<div class="_pre-heading">
<span class="sr-only">Terminal window</span>
</div>


</div> </astro-slot></div>
</div></astro-island> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="manual-install">Manual Install</h4></div> <p>You can also add an adapter manually by installing the package and updating <code>astro.config.mjs</code> yourself. (See the links above for adapter-specific instructions to complete the following two steps to enable SSR.) Using <code>my-adapter</code> as an example placeholder, the instructions will look something like:</p> <ol> <li> <p>Install the adapter to your project dependencies using your preferred package manager:</p> <astro-island uid="nY2fo" component-url="/_astro/Tabs.3d721b18.js" component-export="default" renderer-url="/_astro/client.d87097da.js" props='{"sharedStore":[0,"package-managers"]}' ssr="" client="idle" opts='{"name":"Tabs","value":true}' await-children=""><div class="_container_1kkny_1">
<div class="_tab-scroll-overflow_1kkny_6"><div class="_tablist_1kkny_30 TabGroup no-flex" role="tablist">
<button aria-selected="true" tabindex="0" role="tab" type="button" class="_tab_1kkny_6" id="138-tab.npm"><astro-slot name="tab.npm">npm</astro-slot></button><button aria-selected="false" tabindex="-1" role="tab" type="button" class="_tab_1kkny_6" id="138-tab.pnpm"><astro-slot name="tab.pnpm">pnpm</astro-slot></button><button aria-selected="false" tabindex="-1" role="tab" type="button" class="_tab_1kkny_6" id="138-tab.yarn"><astro-slot name="tab.yarn">Yarn</astro-slot></button>
</div></div>
<div role="tabpanel" aria-labelledby="138-tab.npm" class="_tabpanel_1kkny_26"><astro-slot name="panel.npm"> <div class="expressive-code ec ec-s1gwf">
<div class="_pre-heading">
<span class="sr-only">Terminal window</span>
</div>


</div> </astro-slot></div>
<div hidden role="tabpanel" aria-labelledby="138-tab.pnpm" class="_tabpanel_1kkny_26"><astro-slot name="panel.pnpm"> <div class="expressive-code ec ec-s1gwf">
<div class="_pre-heading">
<span class="sr-only">Terminal window</span>
</div>


</div> </astro-slot></div>
<div hidden role="tabpanel" aria-labelledby="138-tab.yarn" class="_tabpanel_1kkny_26"><astro-slot name="panel.yarn"> <div class="expressive-code ec ec-s1gwf">
<div class="_pre-heading">
<span class="sr-only">Terminal window</span>
</div>


</div> </astro-slot></div>
</div></astro-island> </li> <li> <p><a href="../../reference/configuration-reference/index.html#adapter">Add the adapter</a> to your <code>astro.config.mjs</code> file’s import and default export:</p> <div class="expressive-code ec ec-s1gwf">
<div class="_pre-heading"><span class="title">astro.config.mjs</span></div>


</div> </li> </ol> <div tabindex="-1" class="heading-wrapper level-h2"><h2 id="features">Features</h2></div> <p>Astro will remain a static-site generator by default. But once you enable server-side rendering and add an adapter, a few new features become available to you.</p> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="configuring-individual-routes">Configuring individual routes</h3></div> <p>Both <code>server</code> and <code>hybrid</code> modes allow for server-rendered pages and endpoints and will render all pages according to their default behavior. However, both modes allow you to mark an individual page to opt-out of this default behavior.</p> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="opting-out-of-server-rendering">Opting-out of server-rendering</h3></div> <p>For a mostly server-rendered app configured as <code>output: server</code>, add <code>export const prerender = true</code> to any page or route to pre-render a static page or endpoint:</p> <div class="expressive-code ec ec-s1gwf">
<div class="_pre-heading"><span class="title">src/pages/mypage.astro</span></div>


</div> <div class="expressive-code ec ec-s1gwf">
<div class="_pre-heading"><span class="title">src/pages/mypage.mdx</span></div>


</div> <p>And for an endpoint:</p> <div class="expressive-code ec ec-s1gwf">
<div class="_pre-heading"><span class="title">src/pages/myendpoint.js</span></div>


</div> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="opting-out-of-pre-rendering">Opting out of pre-rendering</h3></div> <p>For a mostly static site configured as <code>output: hybrid</code>, add <code>export const prerender = false</code> to any files that should be server-rendered:</p> <div class="expressive-code ec ec-s1gwf">
<div class="_pre-heading"><span class="title">src/pages/randomnumber.js</span></div>


</div> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="astrorequestheaders"><code>Astro.request.headers</code></h3></div> <p>The headers for the request are available on <code>Astro.request.headers</code>. This works like the browser’s <a href="https://developer.mozilla.org/en-US/docs/Web/API/Request/headers"><code>Request.headers</code></a>. It is a <a href="https://developer.mozilla.org/en-US/docs/Web/API/Headers">Headers</a> object, a Map-like object where you can retrieve headers such as the cookie.</p> <div class="expressive-code ec ec-s1gwf">
<div class="_pre-heading"><span class="title">src/pages/index.astro</span></div>


</div> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="astrorequestmethod"><code>Astro.request.method</code></h3></div> <p>The HTTP method used in the request is available as <code>Astro.request.method</code>. This works like the browser’s <a href="https://developer.mozilla.org/en-US/docs/Web/API/Request/method"><code>Request.method</code></a>. It returns the string representation of the HTTP method used in the request.</p> <div class="expressive-code ec ec-s1gwf">
<div class="_pre-heading"><span class="title">src/pages/index.astro</span></div>


</div> <aside class="content caution astro-duqfclob" aria-label="Caution"> <p class="title astro-duqfclob" aria-hidden="true">  Caution </p> <section class="astro-duqfclob"> <p>The features below are only available at the page level. (You can’t use them inside of components, including layout components.)</p>
<p>This is because these features modify the <a href="https://developer.mozilla.org/en-US/docs/Glossary/Response_header">Response headers</a>, which can’t be modified after they’re sent to the browser. In SSR mode, Astro uses HTML streaming to send each component to the browser as it renders them. This makes sure the user sees your HTML as fast as possible, but it also means that by the time Astro runs your component code, it has already sent the Response headers.</p> </section> </aside> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="astrocookies"><code>Astro.cookies</code></h3></div> <p>This is a utility to read and modify a single cookie. It allows you to check, set, get and delete a cookie.</p> <p>See more details about <a href="../../reference/api-reference/index.html#astrocookies"><code>Astro.cookies</code> and the <code>AstroCookie</code> type</a> in the API reference.</p> <p>The example below updates the value of a cookie for a page view counter.</p> <div class="expressive-code ec ec-s1gwf">
<div class="_pre-heading"><span class="title">src/pages/index.astro</span></div>


</div> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="response"><code>Response</code></h3></div> <p>You can also return a <a href="https://developer.mozilla.org/en-US/docs/Web/API/Response">Response</a> from any page. You might do this to return a 404 on a dynamic page after looking up an id in the database.</p> <div class="expressive-code ec ec-s1gwf">
<div class="_pre-heading"><span class="title">src/pages/[id].astro</span></div>


</div> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="server-endpoints">Server Endpoints</h3></div> <p>A server endpoint, also known as an <strong>API route</strong>, is a special function exported from a <code>.js</code> or <code>.ts</code> file within the <code>src/pages/</code> folder. The function takes an <a href="../../reference/api-reference/index.html#endpoint-context">endpoint context</a> and returns a <a href="https://developer.mozilla.org/en-US/docs/Web/API/Response">Response</a>. A powerful feature of SSR, API routes are able to securely execute code on the server. To learn more, see our <a href="../../core-concepts/endpoints/index.html#server-endpoints-api-routes">Endpoints Guide</a>.</p> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="streaming">Streaming</h3></div> <p>Browsers natively support HTTP streaming, where a document is broken up into chunks, sent over the network in order, and rendered on the page in that order.</p> <p>During this process, browsers consume HTML incrementally: parsing, rendering into the DOM, and painting. This happens whether or not you intentionally stream your HTML. Network conditions can cause large documents to be downloaded slowly, and waiting for data fetches can block page rendering.</p> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="using-streaming-to-improve-page-performance">Using streaming to improve page performance</h3></div> <p>The following page <code>await</code>s some data in its frontmatter. Astro will wait for all of the <code>fetch</code> calls to resolve before sending any HTML to the browser.</p> <div class="expressive-code ec ec-s1gwf">
<div class="_pre-heading"><span class="title">src/pages/index.astro</span></div>


</div> <p>Moving the <code>await</code> calls into smaller components allows you to take advantage of Astro’s streaming. Using the following components to perform the data fetches, Astro can render some HTML first, such as the title, and then the paragraphs when the data is ready.</p> <div class="expressive-code ec ec-s1gwf">
<div class="_pre-heading"><span class="title">src/components/RandomName.astro</span></div>


</div> <div class="expressive-code ec ec-s1gwf">
<div class="_pre-heading"><span class="title">src/components/RandomFact.astro</span></div>


</div> <p>The Astro page below using these components can render parts of the page sooner. The <code>&lt;head&gt;</code>, <code>&lt;body&gt;</code>, and <code>&lt;h1&gt;</code> tags are no longer blocked by data fetches. The server will then fetch data for <code>RandomName</code> and <code>RandomFact</code> in parallel and stream the resulting HTML to the browser.</p> <div class="expressive-code ec ec-s1gwf">
<div class="_pre-heading"><span class="title">src/pages/index.astro</span></div>


</div> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="including-promises-directly">Including Promises directly</h4></div> <p>You can also include promises directly in the template. Instead of blocking the entire component, it will resolve the promise in parallel and only block the markup that comes after it.</p> <div class="expressive-code ec ec-s1gwf">
<div class="_pre-heading"><span class="title">src/pages/index.astro</span></div>


</div> <p>In this example, <code>A name</code> will render while <code>personPromise</code> and <code>factPromise</code> are loading. Once <code>personPromise</code> has resolved, <code>A fact</code> will appear and <code>factPromise</code> will render when it’s finished loading.</p><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2021 Fred K. Schott<br>Licensed under the MIT License.<br>
    <a href="https://docs.astro.build/en/guides/server-side-rendering/" class="_attribution-link">https://docs.astro.build/en/guides/server-side-rendering/</a>
  </p>
</div>
