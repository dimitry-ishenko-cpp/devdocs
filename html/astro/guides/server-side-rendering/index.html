<h1 id="_top" class="astro-556cgime">On-demand Rendering Adapters</h1> <div class="content-panel astro-ayt3hsza"> <div class="sl-container astro-ayt3hsza"> <div class="sl-markdown-content astro-klj6ju3r"> <p>Astro allows you to choose <strong>on-demand rendering</strong> for some, or all of your pages and endpoints. This is also known as <strong>server-side rendering (SSR)</strong>: generating HTML pages on the server when requested and sending them to the client. An <strong>adapter</strong> is used to run your project on the server and handle these requests.</p> <p>This on-demand rendering allows you to:</p> <ul> <li>Implement sessions for login state in your app.</li> <li>Render data from an API called dynamically with <code dir="auto">fetch()</code>.</li> <li>Deploy your site to a host using an <em>adapter</em>.</li> </ul> <p>Consider enabling on-demand server rendering in your Astro project if you need the following:</p> <ul> <li> <p><strong>API endpoints</strong>: Create specific pages that function as API endpoints for tasks like database access, authentication, and authorization while keeping sensitive data hidden from the client.</p> </li> <li> <p><strong>Protected pages</strong>: Restrict access to a page based on user privileges, by handling user access on the server.</p> </li> <li> <p><strong>Frequently changing content</strong>: Generate individual pages without requiring a static rebuild of your site. This is useful when the content of a page updates frequently.</p> </li> </ul> <div tabindex="-1" class="heading-wrapper level-h2"><h2 id="official-adapters">Official Adapters</h2></div> <p>Astro maintains official adapters for <a href="https://nodejs.org/">Node.js</a>, <a href="https://vercel.com/">Vercel</a>, <a href="https://www.netlify.com/">Netlify</a>, and <a href="https://www.cloudflare.com/">Cloudflare</a>.</p> <p>Find even more <a href="https://astro.build/integrations/?search=&amp;categories%5B%5D=adapters">community-maintained adapters</a> (e.g. Deno, SST, AWS) in our integrations directory.</p> <h3 class="astro-hu7fe7u2">SSR Adapters</h3> <section class="cards-nav integrations-nav astro-hu7fe7u2 not-content astro-kq5jy4fu"> <ul class="fluid-grid fluid-grid--minimal astro-oxk5cgh7"> <li class="card card--minimal  astro-kq5jy4fu astro-har75nup"> <div class="logo circle astro-anndpidy" style="--logo-size: 4rem; --logo-padding: .1875em;"> <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGZpbGw9IiNGMzgwMjAiIHZpZXdCb3g9IjAgMCA0OCA0OCI+CiAgPHBhdGggZD0ibTIxLjQgNy41LTIgM0g5djI3aDguN2wtLjUgM0g3LjVMNiAzOVY5bDEuNS0xLjVoMTMuOXptOS40IDBoOS43TDQyIDl2MzBsLTEuNSAxLjVIMjYuNmwyLTNIMzl2LTI3aC04LjdsLjUtM3oiLz4KICA8cGF0aCBkPSJNMjEuNCAyOC41aC04LjZsLTEuMy0yLjNMMjcgMi4ybDIuNyAxLjEtMy4zIDE2LjJoOC43bDEuMyAyLjMtMTUuNiAyNC0yLjctMS4xIDMuMi0xNi4yek0xMS4zIDEzLjdhMSAxIDAgMSAwIDAtMiAxIDEgMCAwIDAgMCAyem0yLjggMGExIDEgMCAxIDAgMC0yIDEgMSAwIDAgMCAwIDJ6bTIuNyAwYTEgMSAwIDEgMCAwLTIgMSAxIDAgMCAwIDAgMnoiLz4KPC9zdmc+Cg==" alt="" loading="lazy" decoding="async" width="64" height="64" class="astro-anndpidy"> </div> <div class="stack sl-flex astro-har75nup"> <h3 class="astro-har75nup"> <a href="../integrations-guide/cloudflare/index.html" aria-current="false" class="astro-har75nup"> <span class="scope">@astrojs/</span><wbr>cloudflare </wbr></a> </h3> </div> </li>
<li class="card card--minimal  astro-kq5jy4fu astro-har75nup"> <div class="logo circle astro-anndpidy" style="--logo-size: 4rem; --logo-padding: .1625em;"> <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGZpbGw9Im5vbmUiIHZpZXdCb3g9IjAgMCAxMjggMTEzIj48ZyBjbGlwLXBhdGg9InVybCgjYSkiPjxwYXRoIGZpbGw9IiMzMkU2RTIiIGQ9Ik0zNC42IDk0aC0xLjJsLTYtNnYtMS4ybDkuMi05LjJINDNsLjguOHY2LjRsLTkuMiA5LjNabS03LjItNjguMnYtMS4ybDYtNmgxLjJsOS4yIDkuMnY2LjRsLS44LjhoLTYuNGwtOS4yLTkuMloiLz48cGF0aCBmaWxsPSIjZmZmIiBkPSJNODAuNSA3NC42aC04LjhsLS44LS43VjUzLjNjMC0zLjYtMS40LTYuNS01LjgtNi42bC03LjYuMS0uNC41djI2LjZsLS44LjdoLTguOGwtLjctLjdWMzguOGwuNy0uOGgxOS44YTE0IDE0IDAgMCAxIDEzLjkgMTR2MjEuOWwtLjcuN1oiLz48cGF0aCBmaWxsPSIjMzJFNkUyIiBkPSJNMzUuOCA2MS41SC44bC0uOC0uOFY1MmwuNy0uN2gzNS4xbC44Ljd2OC44bC0uOC43Wm05MS41IDBIOTIuMmwtLjgtLjhWNTJsLjgtLjdoMzVsLjguN3Y4LjhsLS43LjdaTTU4LjkgMjdWLjdsLjgtLjdoOC44bC43Ljd2MjYuNGwtLjcuN2gtOC44bC0uOC0uN1ptMCA4NC44Vjg1LjZsLjgtLjhoOC44bC43Ljh2MjYuM2wtLjcuN2gtOC44bC0uOC0uN1oiLz48L2c+PGRlZnM+PGNsaXBQYXRoIGlkPSJhIj48cGF0aCBmaWxsPSIjZmZmIiBkPSJNMCAwaDEyOHYxMTIuNkgweiIvPjwvY2xpcFBhdGg+PC9kZWZzPjwvc3ZnPg==" alt="" loading="lazy" decoding="async" width="64" height="64" class="astro-anndpidy"> </div> <div class="stack sl-flex astro-har75nup"> <h3 class="astro-har75nup"> <a href="../integrations-guide/netlify/index.html" aria-current="false" class="astro-har75nup"> <span class="scope">@astrojs/</span><wbr>netlify </wbr></a> </h3> </div> </li>
<li class="card card--minimal  astro-kq5jy4fu astro-har75nup"> <div class="logo circle astro-anndpidy" style="--logo-size: 4rem; --logo-padding: .1875em;"> <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGFyaWEtaGlkZGVuPSJ0cnVlIiBjbGFzcz0iaWNvbmlmeSBpY29uaWZ5LS1sb2dvcyIgdmlld0JveD0iMCAwIDI1NiAyODkiPgogIDxwYXRoIGZpbGw9IiM1MzlFNDMiIGQ9Ik0xMjggMjg5Yy00IDAtOC0yLTExLTNsLTM1LTIxYy02LTMtMy00LTEtNWwxNi03aDJsMjcgMTZoM2wxMDYtNjFjMSAwIDItMSAyLTNWODNsLTItMy0xMDYtNjFoLTNMMjAgODBsLTEgM3YxMjJsMSAzIDI5IDE3YzE2IDggMjYtMSAyNi0xMVY5NGMwLTIgMS0zIDMtM2gxM2MyIDAgNCAxIDQgM3YxMjBjMCAyMS0xMiAzMy0zMiAzMy02IDAtMTEgMC0yNC02bC0yOC0xNmEyMiAyMiAwIDAgMS0xMS0xOVY4M2MwLTggNC0xNSAxMS0xOUwxMTcgM2EyNCAyNCAwIDAgMSAyMiAwbDEwNiA2MWM3IDQgMTEgMTEgMTEgMTl2MTIzYzAgOC00IDE1LTExIDE5bC0xMDYgNjFhMjcgMjcgMCAwIDEtMTEgMlptMzMtODRjLTQ3IDAtNTYtMjItNTYtNDAgMC0xIDEtMyAzLTNoMTRjMSAwIDMgMSAzIDMgMiAxNCA4IDIxIDM2IDIxIDIyIDAgMzItNSAzMi0xNyAwLTctMy0xMi0zOC0xNi0yOS0zLTQ3LTktNDctMzIgMC0yMiAxOC0zNCA0OS0zNCAzNCAwIDUwIDExIDUyIDM3djJsLTMgMWgtMTNjLTIgMC0zLTEtMy0yLTMtMTUtMTItMTktMzMtMTktMjUgMC0yOCA4LTI4IDE0IDAgOCA0IDEwIDM3IDE1IDMyIDQgNDggMTAgNDggMzMtMSAyMy0yMCAzNi01MyAzNloiLz4KPC9zdmc+Cg==" alt="" loading="lazy" decoding="async" width="64" height="64" class="astro-anndpidy"> </div> <div class="stack sl-flex astro-har75nup"> <h3 class="astro-har75nup"> <a href="../integrations-guide/node/index.html" aria-current="false" class="astro-har75nup"> <span class="scope">@astrojs/</span><wbr>node </wbr></a> </h3> </div> </li>
<li class="card card--minimal  astro-kq5jy4fu astro-har75nup"> <div class="logo circle astro-anndpidy" style="--logo-size: 4rem; --logo-padding: .3em .3em .35em;"> <img src="data:image/svg+xml;base64,PHN2ZyBmaWxsPSJub25lIiB2aWV3Qm94PSIwIDAgMTE1NSAxMDAwIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Im01NzcuMyAwIDU3Ny40IDEwMDBoLTExNTQuN3oiIGZpbGw9IiNmZmYiLz48L3N2Zz4=" alt="" loading="lazy" decoding="async" width="64" height="64" class="astro-anndpidy"> </div> <div class="stack sl-flex astro-har75nup"> <h3 class="astro-har75nup"> <a href="../integrations-guide/vercel/index.html" aria-current="false" class="astro-har75nup"> <span class="scope">@astrojs/</span><wbr>vercel </wbr></a> </h3> </div> </li> </ul> </section> <div tabindex="-1" class="heading-wrapper level-h2"><h2 id="enable-on-demand-server-rendering">Enable on-demand server rendering</h2></div> <p>Both of Astro’s on-demand rendering output modes (<code dir="auto">server</code> and <code dir="auto">hybrid</code>) allow you to take advantage of static site performance by pre-rendering individual routes whenever possible, whether you have an entirely dynamic app or a mostly static site that needs on-demand rendering only for select routes.</p> <p>To decide which one to use in your project, choose the <code dir="auto">output</code> option that represents how <strong>most</strong> of your pages and routes will be rendered:</p> <ul> <li>
<strong><code dir="auto">output: 'server'</code></strong>: On-demand rendered by default. Use this when most or all of your site or app should be server-rendered on request. Any individual page or endpoint can <em>opt-in</em> to pre-rendering.</li> <li>
<strong><code dir="auto">output: 'hybrid'</code></strong>: Pre-rendered to HTML by default. Use this when most of your site should be static. Any individual page or endpoint can <em>opt-out</em> of pre-rendering.</li> </ul> <p>Because the server will need to generate at least some pages on demand, both of these modes require you to <a href="#add-an-adapter">add an adapter</a> to carry out the server functions.</p> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="add-an-adapter">Add an Adapter</h3></div> <p>To deploy a project in <code dir="auto">server</code> or <code dir="auto">hybrid</code> mode, you need to add an <strong>adapter</strong>. This is because both of these modes require a server <em>runtime</em>: the environment that runs code on the server to generate pages when they are requested. Each adapter allows Astro to output a script that runs your project on a specific runtime, such as Vercel, Netlify or Cloudflare.</p> <p>You can find both <a href="https://astro.build/integrations/?search=&amp;categories%5B%5D=adapters">official and community adapters in our integrations directory</a>. Choose the one that corresponds to your <a href="../deploy/index.html">deployment environment</a>.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="astro-add-install">
<code dir="auto">astro add</code> install</h4></div> <p>You can add any of the <a href="../integrations-guide/index.html#official-integrations">official adapters maintained by Astro</a> with the following <code dir="auto">astro add</code> command. This will install the adapter and make the appropriate changes to your <code dir="auto">astro.config.mjs</code> file in one step.</p> <p>For example, to install the Vercel adapter, run:</p> <starlight-tabs data-sync-key="package-managers" class="astro-tx2opqu5"> <div class="tablist-wrapper not-content astro-tx2opqu5"> <ul role="tablist" class="astro-tx2opqu5"> <li role="presentation" class="tab astro-tx2opqu5"> <a role="tab" href="#tab-panel-462" id="tab-462" aria-selected="true" tabindex="0" class="astro-tx2opqu5"> npm </a> </li>
<li role="presentation" class="tab astro-tx2opqu5"> <a role="tab" href="#tab-panel-463" id="tab-463" aria-selected="false" tabindex="-1" class="astro-tx2opqu5"> pnpm </a> </li>
<li role="presentation" class="tab astro-tx2opqu5"> <a role="tab" href="#tab-panel-464" id="tab-464" aria-selected="false" tabindex="-1" class="astro-tx2opqu5"> Yarn </a> </li> </ul> </div> <section id="tab-panel-462" aria-labelledby="tab-462" role="tabpanel"> <div class="expressive-code">
<div class="_pre-heading">
<span class="sr-only">Terminal window</span>
</div>
<pre data-language="shell">npx astro add vercel</pre>

</div> </section> <section id="tab-panel-463" aria-labelledby="tab-463" role="tabpanel" hidden> <div class="expressive-code">
<div class="_pre-heading">
<span class="sr-only">Terminal window</span>
</div>
<pre data-language="shell">pnpm astro add vercel</pre>

</div> </section> <section id="tab-panel-464" aria-labelledby="tab-464" role="tabpanel" hidden> <div class="expressive-code">
<div class="_pre-heading">
<span class="sr-only">Terminal window</span>
</div>
<pre data-language="shell">yarn astro add vercel</pre>

</div> </section> </starlight-tabs>  <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="manual-install">Manual Install</h4></div> <p>You can also add an adapter manually by installing the package and updating <code dir="auto">astro.config.mjs</code> yourself.</p> <p>For example, to install the Vercel adapter manually:</p> <ol role="list" class="sl-steps"> <li> <p>Install the adapter to your project dependencies using your preferred package manager:</p> <starlight-tabs data-sync-key="package-managers" class="astro-tx2opqu5"> <div class="tablist-wrapper not-content astro-tx2opqu5"> <ul role="tablist" class="astro-tx2opqu5"> <li role="presentation" class="tab astro-tx2opqu5"> <a role="tab" href="#tab-panel-465" id="tab-465" aria-selected="true" tabindex="0" class="astro-tx2opqu5"> npm </a> </li>
<li role="presentation" class="tab astro-tx2opqu5"> <a role="tab" href="#tab-panel-466" id="tab-466" aria-selected="false" tabindex="-1" class="astro-tx2opqu5"> pnpm </a> </li>
<li role="presentation" class="tab astro-tx2opqu5"> <a role="tab" href="#tab-panel-467" id="tab-467" aria-selected="false" tabindex="-1" class="astro-tx2opqu5"> Yarn </a> </li> </ul> </div> <section id="tab-panel-465" aria-labelledby="tab-465" role="tabpanel"> <div class="expressive-code">
<div class="_pre-heading">
<span class="sr-only">Terminal window</span>
</div>
<pre data-language="shell">npm install @astrojs/vercel</pre>

</div> </section> <section id="tab-panel-466" aria-labelledby="tab-466" role="tabpanel" hidden> <div class="expressive-code">
<div class="_pre-heading">
<span class="sr-only">Terminal window</span>
</div>
<pre data-language="shell">pnpm add @astrojs/vercel</pre>

</div> </section> <section id="tab-panel-467" aria-labelledby="tab-467" role="tabpanel" hidden> <div class="expressive-code">
<div class="_pre-heading">
<span class="sr-only">Terminal window</span>
</div>
<pre data-language="shell">yarn add @astrojs/vercel</pre>

</div> </section> </starlight-tabs> </li> <li> <p><a href="../../reference/configuration-reference/index.html#adapter">Add the adapter</a> to your <code dir="auto">astro.config.mjs</code> file’s import and default export, along with your desired <code dir="auto">output</code> mode:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">astro.config.mjs</span></div>
<pre data-language="js">import { defineConfig } from 'astro/config';
import vercel from '@astrojs/vercel/serverless';


export default defineConfig({
  output: 'server',
  adapter: vercel(),
});</pre>

</div> <p>Note that different adapters may also have different configuration settings. Read each adapter’s documentation, and apply any necessary config options to your chosen adapter in <code dir="auto">astro.config.mjs</code></p> </li> </ol> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="configure-server-or-hybrid">Configure <code dir="auto">server</code> or <code dir="auto">hybrid</code>
</h3></div> <p>To enable on-demand rendering, you must update your <code dir="auto">output</code> configuration to one of the two server-rendered modes.</p> <p>For example, to configure a highly dynamic app where every page is rendered on demand by default, add <code dir="auto">output: 'server'</code> to your Astro config:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">astro.config.mjs</span></div>
<pre data-language="js">import { defineConfig } from 'astro/config';
import node from "@astrojs/node";


export default defineConfig({
  output: 'server',
  adapter: node({
    mode: "standalone"
  })
});</pre>

</div> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="opting-in-to-pre-rendering-in-server-mode">Opting-in to pre-rendering in <code dir="auto">server</code> mode</h3></div> <p>For a mostly server-rendered app configured as <code dir="auto">output: server</code>, add <code dir="auto">export const prerender = true</code> to any page or route to pre-render a static page or endpoint:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/pages/mypage.astro</span></div>
<pre data-language="astro">---
export const prerender = true;
// ...
---
&lt;html&gt;
  &lt;!-- Static, pre-rendered page here... --&gt;
&lt;/html&gt;</pre>

</div> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/pages/mypage.mdx</span></div>
<pre data-language="mdx">---
layout: '../layouts/markdown.astro'
title: 'My page'
---
export const prerender = true;


# This is my static, pre-rendered page</pre>

</div> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/pages/myendpoint.js</span></div>
<pre data-language="js">export const prerender = true;


export async function GET() {
  return new Response(
    JSON.stringify({
      message: `This is my static endpoint`,
    }),
  );
}</pre>

</div> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="opting-out-of-pre-rendering-in-hybrid-mode">Opting out of pre-rendering in <code dir="auto">hybrid</code> mode</h3></div> <p>For a mostly static site configured as <code dir="auto">output: hybrid</code>, add <code dir="auto">export const prerender = false</code> to any files that should be server-rendered on demand:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/pages/randomnumber.js</span></div>
<pre data-language="js">export const prerender = false;


export async function GET() {
  let number = Math.random();
  return new Response(
    JSON.stringify({
      number,
      message: `Here's a random number: ${number}`,
    }),
  );
}</pre>

</div> <div tabindex="-1" class="heading-wrapper level-h2"><h2 id="on-demand-rendering-features">On-demand rendering features</h2></div> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="html-streaming">HTML streaming</h3></div> <p>With HTML streaming, a document is broken up into chunks, sent over the network in order, and rendered on the page in that order. In <code dir="auto">server</code> or <code dir="auto">hybrid</code> mode, Astro uses HTML streaming to send each component to the browser as it renders them. This makes sure the user sees your HTML as fast as possible, although network conditions can cause large documents to be downloaded slowly, and waiting for data fetches can block page rendering.</p> <div class="root astro-u7553m4s"> <div class="flex astro-u7553m4s"> <img src="data:image/webp;base64,UklGRuQEAABXRUJQVlA4WAoAAAAYAAAAMwAANQAAQUxQSGsCAAABoEZrmyFJeiMix7Zt27a9tm3btm3btm3bthVffO8iMyo7avZ/REwAVoo2y6zNnEnJOBS6dBzQdavzbr3ppFUaw5g0nEO94/9g7qebAZlzzpmaMQbo8SQpXsQLeRbyXU0YYNFdP9Mrc4PwkKG7HLD9FAdXA8CxJAOLVZn78hLY0hz2onhltKqIBHJnuJIsuv7KwFI9OQuuHIc16Vmy520wZW1DKUv5WV2YkubQl/dlWQZ13uRfJQkfhEG5DtOVXoJWpn9xI7iS4DDrXVYexJMXolzjsiyrg0abXPPoT9QYJcmjjKmVOVuRRewNlAjlCxfs2BX5rgILTN7/hOOOP/7E088++11q1K1HH374SSccf/xxW3WDMTEWHe5krDJWGfnb7og1aPw6JVIZH6TQk/vCFWU4in8wwUAOgi1Aw08ZUqDn/nBFXQPTFF4V0ztQE7klpldgmsKbq+KWqri5Aq2KNFcOWhVpVqJVEaj/D72VaQpviekZkrkZtU3BSCZzBwCbtwslDfKPB9cBXM7F9KmQfKA73H/upyQjnl8MgQMavM2QDPkX320Dg+bfUhPin7wQFi1/SksZBsO2+DEteu6HWo0/YUhK+DCAK6gimg4Dr2mITtf8SVLFS9Ak+CePtECP7W7/krHBF2qOBC3SIF7JNWAtgJbTdrngofd/FTIII+U//9UQJChzn10AADaz+G/Drq/Tk6+fdOYZZ5xx+tGHfkmv/PX6N/5g4V/v3nnoOMAg17gsc9iD5Fvb1kfhoOeo5Bh0HD5nlfU2WHX+6M4NAcAh0qK//+G69RoBtXKz2siOU+ENiDa1nAEAAFZQOCA8AgAAUA0AnQEqNAA2AD7lYqZPKSUjIiwVXZkgHIlkAMdkbc6KwKFXtoJpaNoyqLQ/FGN00F6wVZIfnXiVi1ZJjkcZ0nNZIsE90QHkgj4yGAjIg8GNR3g1bfXluGis9CqpEDIaIKQSEfuf2Uk/tJygs2T/CpkLOAD++90v7wUm4rf+3+Af0bFf9FDxRxPx/uyNmmuUn84N1S8oeCamnnI71i6f4UiRm8f9Hp1bg3B4DsRB5+mUgzo/4bnweeaxZgh0SL/aJJmVmzy9c8202SrAoix1gA9Mu6pJtpQzIzp5YuIDPxOw+qfShBsZNu7bs2FbLYm9QXO6KOogBnG8yukH0OwiE+DnM/TVmtkTBW16oDUc1kwDuwb2koEyJK3+nIi9vTEJbmgjzNy0hv2qQpmT8IGeGOmWASc8HdwGSXXiapinC4l4um2zabGEmrQWa8rLxGRQ/ZFsnmAvLdTLDk89DnLcpQ78xNMPbbKut8V2OvI0rPE6x/rStU9bxZRN+0T+Wa/kZPFrAtpeEMeI31JeMUUw7ki5RB5R3I4uviJ32A/q+PzE5/JGDVkn7vjHQboTyXOWWQI8qKDwRfPeR4/MHhDprmFlw7Qf/Y4VNXdX4X9DXrU1Dk02qM1tPVpcTLNneaESBYpH9S35JjhN7dD4DlrRVZjvdfI3Xa90VJCaBoCsRLS3lj97HXa2WoLFvBUR1hrmHn7KW+bQCefXaR8JfLC4VFMIDMFfZf8Lf7+0sF+p2hrsjrlHvC/Z1Mf4AABFWElGDgAAAE1NACoAAAAIAAAAAAAA" width="24" alt="" class="astro-u7553m4s"> <strong class="astro-u7553m4s">Related recipe:</strong> <a href="../../recipes/streaming-improve-page-performance/index.html" class="astro-u7553m4s"> Using streaming to improve page performance </a> </div> </div> <aside aria-label="Caution" class="starlight-aside starlight-aside--caution"><p class="starlight-aside__title" aria-hidden="true">Caution</p>
<section class="starlight-aside__content"><p>Features that modify the <a href="https://developer.mozilla.org/en-US/docs/Glossary/Response_header">Response headers</a> are only available at the <strong>page level</strong>. (You can’t use them inside of components, including layout components.) By the time Astro runs your component code, it has already sent the Response headers and they cannot be modified.</p></section></aside> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="cookies">Cookies</h3></div> <p>In <code dir="auto">server</code> and <code dir="auto">hybrid</code> modes, a page or API endpoint can check, set, get, and delete cookies.</p> <p>The example below updates the value of a cookie for a page view counter:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/pages/index.astro</span></div>
<pre data-language="astro">---
let counter = 0


if (Astro.cookies.has("counter")) {
  const cookie = Astro.cookies.get("counter")
  counter = cookie.number() + 1
}


Astro.cookies.set("counter",counter)
---
&lt;html&gt;
  &lt;h1&gt;Counter = {counter}&lt;/h1&gt;
&lt;/html&gt;</pre>

</div> <p>See more details about <a href="../../reference/api-reference/index.html#astrocookies"><code dir="auto">Astro.cookies</code> and the <code dir="auto">AstroCookie</code> type</a> in the API reference.</p> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="response"><code dir="auto">Response</code></h3></div> <p><a href="../../reference/api-reference/index.html#astroresponse"><code dir="auto">Astro.response</code></a> is a standard <a href="https://developer.mozilla.org/en-US/docs/Web/API/Response/Response#options"><code dir="auto">ResponseInit</code></a> object. It can be used to set the response status and headers.</p> <p>The example below sets a response status and status text for a product listing page when the product does not exist:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/pages/my-product.astro</span></div>
<pre data-language="astro">---
import { getProduct } from '../api';


const product = await getProduct(Astro.params.id);


// No product found
if (!product) {
  Astro.response.status = 404;
  Astro.response.statusText = 'Not found';
}
---
&lt;html&gt;
  &lt;!-- Page here... --&gt;
&lt;/html&gt;</pre>

</div> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="astroresponseheaders"><code dir="auto">Astro.response.headers</code></h4></div> <p>You can set headers using the <code dir="auto">Astro.response.headers</code> object:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/pages/index.astro</span></div>
<pre data-language="astro">---
Astro.response.headers.set('Cache-Control', 'public, max-age=3600');
---
&lt;html&gt;
  &lt;!-- Page here... --&gt;
&lt;/html&gt;</pre>

</div> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="return-a-response-object">Return a <code dir="auto">Response</code> object</h4></div> <p>You can also return a <a href="https://developer.mozilla.org/en-US/docs/Web/API/Response">Response</a> object directly from any page using on-demand rendering.</p> <p>The example below returns a 404 on a dynamic page after looking up an id in the database:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/pages/[id].astro</span></div>
<pre data-language="astro">---
import { getProduct } from '../api';


const product = await getProduct(Astro.params.id);


// No product found
if (!product) {
  return new Response(null, {
    status: 404,
    statusText: 'Not found'
  });
}
---
&lt;html&gt;
  &lt;!-- Page here... --&gt;
&lt;/html&gt;</pre>

</div> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="request"><code dir="auto">Request</code></h3></div> <p><code dir="auto">Astro.request</code> is a standard <a href="https://developer.mozilla.org/en-US/docs/Web/API/Request">Request</a> object. It can be used to get the <code dir="auto">url</code>, <code dir="auto">headers</code>, <code dir="auto">method</code>, and even body of the request.</p> <p>In both <code dir="auto">server</code> and <code dir="auto">hybrid</code> mode, you can access additional information from this object for pages that are not statically-generated.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="astrorequestheaders"><code dir="auto">Astro.request.headers</code></h4></div> <p>The headers for the request are available on <code dir="auto">Astro.request.headers</code>. This works like the browser’s <a href="https://developer.mozilla.org/en-US/docs/Web/API/Request/headers"><code dir="auto">Request.headers</code></a>. It is a <a href="https://developer.mozilla.org/en-US/docs/Web/API/Headers">Headers</a> object where you can retrieve headers such as the cookie.</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/pages/index.astro</span></div>
<pre data-language="astro">---
const cookie = Astro.request.headers.get('cookie');
// ...
---
&lt;html&gt;
  &lt;!-- Page here... --&gt;
&lt;/html&gt;</pre>

</div> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="astrorequestmethod"><code dir="auto">Astro.request.method</code></h4></div> <p>The HTTP method used in the request is available as <code dir="auto">Astro.request.method</code>. This works like the browser’s <a href="https://developer.mozilla.org/en-US/docs/Web/API/Request/method"><code dir="auto">Request.method</code></a>. It returns the string representation of the HTTP method used in the request.</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/pages/index.astro</span></div>
<pre data-language="astro">---
console.log(Astro.request.method) // GET (when navigated to in the browser)
---</pre>

</div> <p>See more details about <a href="../../reference/api-reference/index.html#astrorequest"><code dir="auto">Astro.request</code></a> in the API reference.</p> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="server-endpoints">Server Endpoints</h3></div> <p>A server endpoint, also known as an <strong>API route</strong>, is a special function exported from a <code dir="auto">.js</code> or <code dir="auto">.ts</code> file within the <code dir="auto">src/pages/</code> folder. A powerful feature of server-side rendering on demand, API routes are able to securely execute code on the server.</p> <p>The function takes an <a href="../../reference/api-reference/index.html#endpoint-context">endpoint context</a> and returns a <a href="https://developer.mozilla.org/en-US/docs/Web/API/Response">Response</a>.</p> <p>To learn more, see our <a href="../endpoints/index.html#server-endpoints-api-routes">Endpoints Guide</a>.</p> <span id="docsearch-lvl0" hidden class="astro-klj6ju3r">Learn</span> </div>   </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2021 Fred K. Schott<br>Licensed under the MIT License.<br>
    <a href="https://docs.astro.build/en/guides/server-side-rendering/" class="_attribution-link">https://docs.astro.build/en/guides/server-side-rendering/</a>
  </p>
</div>
