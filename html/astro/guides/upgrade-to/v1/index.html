<h1 id="_top" class="astro-556cgime">Legacy v0.x Upgrade Guide</h1> <div class="content-panel astro-ayt3hsza"> <div class="sl-container astro-ayt3hsza"> <div class="sl-markdown-content astro-klj6ju3r"> <p>This guide will help you upgrade through breaking changes in pre-v1 versions of Astro.</p> <p>You can update your project’s version of Astro to the latest version using your package manager. If you’re using Astro integrations, you’ll also want to update those to the latest version.</p> <starlight-tabs data-sync-key="package-managers" class="astro-tx2opqu5"> <div class="tablist-wrapper not-content astro-tx2opqu5"> <ul role="tablist" class="astro-tx2opqu5"> <li role="presentation" class="tab astro-tx2opqu5"> <a role="tab" href="#tab-panel-483" id="tab-483" aria-selected="true" tabindex="0" class="astro-tx2opqu5"> npm </a> </li>
<li role="presentation" class="tab astro-tx2opqu5"> <a role="tab" href="#tab-panel-484" id="tab-484" aria-selected="false" tabindex="-1" class="astro-tx2opqu5"> pnpm </a> </li>
<li role="presentation" class="tab astro-tx2opqu5"> <a role="tab" href="#tab-panel-485" id="tab-485" aria-selected="false" tabindex="-1" class="astro-tx2opqu5"> Yarn </a> </li> </ul> </div> <section id="tab-panel-483" aria-labelledby="tab-483" role="tabpanel"> <div class="expressive-code">
<div class="_pre-heading">
<span class="sr-only">Terminal window</span>
</div>
<pre data-language="shell"># updates the astro dependency:
npm upgrade astro
# or, to update all dependencies:
npm upgrade</pre>

</div> </section> <section id="tab-panel-484" aria-labelledby="tab-484" role="tabpanel" hidden> <div class="expressive-code">
<div class="_pre-heading">
<span class="sr-only">Terminal window</span>
</div>
<pre data-language="shell"># updates the astro dependency:
pnpm upgrade astro
# or, to update all dependencies:
pnpm upgrade</pre>

</div> </section> <section id="tab-panel-485" aria-labelledby="tab-485" role="tabpanel" hidden> <div class="expressive-code">
<div class="_pre-heading">
<span class="sr-only">Terminal window</span>
</div>
<pre data-language="shell"># updates the astro dependency:
yarn upgrade astro
# or, to update all dependencies:
yarn upgrade</pre>

</div> </section> </starlight-tabs>  <p>Read the guide below for major highlights and instructions on how to handle breaking changes.</p> <div tabindex="-1" class="heading-wrapper level-h2"><h2 id="astro-10">Astro 1.0</h2></div> <p>Astro v1.0 introduces some changes that you should be aware of when migrating from v0.x and v1.0-beta releases. See below for more details.</p> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="updated-vite-3">Updated: Vite 3</h3></div> <p>Astro v1.0 has upgraded from Vite 2 to <a href="https://vitejs.dev/">Vite 3</a>. We’ve handled most of the upgrade for you inside of Astro; however, some subtle Vite behaviors may still change between versions. Refer to the official <a href="https://vitejs.dev/guide/migration.html#general-changes">Vite Migration Guide</a> if you run into trouble.</p> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="deprecated-astrocanonicalurl">Deprecated: <code dir="auto">Astro.canonicalURL</code>
</h3></div> <p>You can now use the new <a href="../../../reference/api-reference/index.html#astrourl"><code dir="auto">Astro.url</code></a> helper to construct your own canonical URL from the current page/request URL.</p> <div class="expressive-code">

<pre data-language="js">// Before:
const canonicalURL = Astro.canonicalURL;
// After:
const canonicalURL = new URL(Astro.url.pathname, Astro.site);</pre>

</div> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="changed-scoped-css-specificity">Changed: Scoped CSS specificity</h3></div> <p><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/Specificity">Specificity</a> will now be preserved in scoped CSS styles. This change will cause most scoped styles to <em>happen</em> to take precedence over global styles. But, this behavior is no longer explicitly guaranteed.</p> <p>Technically, this is accomplished using <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/:where">the <code dir="auto">:where()</code> pseudo-class</a> instead of using classes directly in Astro’s CSS output.</p> <p>Let’s use the following style block in an Astro component as an example:</p> <div class="expressive-code">

<pre data-language="astro">&lt;style&gt;
  div { color: red; } /* 0-0-1 specificity */
&lt;/style&gt;</pre>

</div> <p>Previously, Astro would transform this into the following CSS, which has a specificity of <code dir="auto">0-1-1</code> — a higher specificity than the source CSS:</p> <div class="expressive-code">

<pre data-language="css">div.astro-XXXXXX { color: red; } /* 0-1-1 specificity */</pre>

</div> <p>Now, Astro wraps the class selector with <code dir="auto">:where()</code>, maintaining the authored specificity:</p> <div class="expressive-code">

<pre data-language="css">div:where(.astro-XXXXXX) { color: red; } /* 0-0-1 specificity */</pre>

</div> <p>The previous specificity increase made it hard to combine scoped styles in Astro with other CSS files or styling libraries (e.g. Tailwind, CSS Modules, Styled Components, Stitches). This change will allow Astro’s scoped styles to work consistently alongside them while still preserving the exclusive boundaries that prevent styles from applying outside the component.</p> <aside aria-label="Caution" class="starlight-aside starlight-aside--caution"><p class="starlight-aside__title" aria-hidden="true">Caution</p>
<section class="starlight-aside__content"><p>When upgrading, please visually inspect your site output to make sure everything is styled as expected. If not, find your scoped style and increase the selector specificity manually to match the old behavior.</p></section></aside> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="deprecated-components-and-jsx-in-markdown">Deprecated: Components and JSX in Markdown</h3></div> <p>Astro no longer supports components or JSX expressions in Markdown pages by default. For long-term support you should migrate to the <a href="../../integrations-guide/mdx/index.html"><code dir="auto">@astrojs/mdx</code></a> integration.</p> <p>To make migrating easier, a new <code dir="auto">legacy.astroFlavoredMarkdown</code> flag (removed in v2.0) can be used to re-enable previous Markdown features.</p> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="converting-existing-md-files-to-mdx">Converting existing <code dir="auto">.md</code> files to <code dir="auto">.mdx</code>
</h3></div> <p>If you’re not familiar with MDX, here are some steps you can follow to quickly convert an existing “Astro Flavored Markdown” file to MDX. As you learn more about MDX, feel free to explore other ways of writing your pages!</p> <ol role="list" class="sl-steps"> <li> <p>Install the <a href="../../integrations-guide/mdx/index.html"><code dir="auto">@astrojs/mdx</code></a> integration.</p> </li> <li> <p>Change your existing <code dir="auto">.md</code> file extensions to <code dir="auto">.mdx</code></p> </li> <li> <p>Remove any <code dir="auto">setup:</code> properties from your frontmatter, and write any import statements below the frontmatter instead.</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/pages/posts/my-post.mdx</span></div>
<pre data-language="mdx">---
layout: '../../layouts/BaseLayout.astro'
setup: |
  import ReactCounter from '../../components/ReactCounter.jsx'
title: 'Migrating to MDX'
date: 2022-07-26
tags: ["markdown", "mdx", "astro"]
---
import ReactCounter from '../../components/ReactCounter.jsx'


# {frontmatter.title}


Here is my counter component, working in MDX:


&lt;ReactCounter client:load /&gt;</pre>

</div> </li> <li> <p>Update any <code dir="auto">Astro.glob()</code> statements that currently return <code dir="auto">.md</code> files so that they will now return your <code dir="auto">.mdx</code> files.</p> <aside aria-label="Caution" class="starlight-aside starlight-aside--caution"><p class="starlight-aside__title" aria-hidden="true">Caution</p>
<section class="starlight-aside__content"><p>The object returned when importing <code dir="auto">.mdx</code> files (including using Astro.glob) differs from the object returned when importing <code dir="auto">.md</code> files. However, <code dir="auto">frontmatter</code>, <code dir="auto">file</code>, and <code dir="auto">url</code> work identically.</p></section></aside> </li> <li> <p>Update any use of the <code dir="auto">&lt;Content /&gt;</code> component to use the default export when importing MDX:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/pages/index.astro</span></div>
<pre data-language="astro">---
// Multiple imports with Astro.glob
const mdxPosts = await Astro.glob('./posts/*.mdx');
---


{mdxPosts.map(Post =&gt; &lt;Post.default /&gt;)}</pre>

</div> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/pages/index.astro</span></div>
<pre data-language="astro">---
// Import a single page
import { default as About } from './about.mdx';
---


&lt;About /&gt;</pre>

</div> </li> </ol> <aside aria-label="Tip" class="starlight-aside starlight-aside--tip"><p class="starlight-aside__title" aria-hidden="true">Tip</p>
<section class="starlight-aside__content"><p>While you are transitioning to MDX, you may wish to enable the <code dir="auto">legacy.astroFlavoredMarkdown</code> flag (removed in v2.0) and include both <strong><code dir="auto">.md</code> and <code dir="auto">.mdx</code></strong> files, so that your site continues to function normally even before all your files have been converted. Here is one way you can do that:</p>
<div class="expressive-code">

<pre data-language="astro">---
const mdPosts = await Astro.glob('../pages/posts/*.md');
const mdxPosts = await Astro.glob('../pages/posts/*.mdx');
const allPosts = [...mdxPosts, ...mdPosts];
---</pre>

</div></section></aside> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="markdown--component-removed">
<code dir="auto">&lt;Markdown /&gt;</code> Component Removed</h3></div> <p>Astro’s built-in <code dir="auto">&lt;Markdown /&gt;</code> component has been moved to a separate package. To continue using this component, you will now need to install <code dir="auto">@astrojs/markdown-component</code> and update your imports accordingly. For more details, see <a href="https://github.com/withastro/astro/tree/main/packages/markdown/component">the <code dir="auto">@astrojs/markdown</code> README</a>.</p> <aside aria-label="Tip" class="starlight-aside starlight-aside--tip"><p class="starlight-aside__title" aria-hidden="true">Tip</p>
<section class="starlight-aside__content"><p>Astro now has support for <a href="https://mdxjs.com/">MDX</a> through our <a href="https://github.com/withastro/astro/tree/main/packages/integrations/mdx">MDX integration</a>. MDX gives you the ability to include both Markdown and imported components in the same file. MDX can be good alternative for the <code dir="auto">&lt;Markdown /&gt;</code> component due to its large community and stable APIs.</p></section></aside> <div tabindex="-1" class="heading-wrapper level-h2"><h2 id="migrate-to-v100-beta">Migrate to v1.0.0-beta</h2></div> <p>On April 4, 2022 we released the Astro 1.0 Beta! 🎉</p> <p>If you are coming from v0.25 or earlier, make sure you have read and followed the <a href="#migrate-to-v026">v0.26 Migration Guide</a> below, which contained several major breaking changes.</p> <p>The <code dir="auto">v1.0.0-beta.0</code> release of Astro contained no breaking changes. Below are small changes that were introduced during the beta period.</p> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="changed-rss-feeds">Changed: RSS Feeds</h3></div> <p>RSS feeds should now be generated using the <code dir="auto">@astrojs/rss</code> package, as described in our <a href="../../rss/index.html">RSS guide</a>.</p> <div tabindex="-1" class="heading-wrapper level-h2"><h2 id="migrate-to-v026">Migrate to v0.26</h2></div> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="new-configuration-api">New Configuration API</h3></div> <p>Our Configuration API has been redesigned to solve a few glaring points of confusion that had built up over the last year. Most of the configuration options have just been moved or renamed, which will hopefully be a quick update for most users. A few options have been refactored more heavily, and may require a few additional changes:</p> <ul> <li>
<code dir="auto">.buildOptions.site</code> has been replaced with <code dir="auto">.site</code> (your deployed domain) and a new <code dir="auto">.base</code> (your deployed subpath) option.</li> <li>
<code dir="auto">.markdownOptions</code> has been replaced with <code dir="auto">.markdown</code>, a mostly similar config object with some small changes to simplify Markdown configuration.</li> <li>
<code dir="auto">.sitemap</code> has been moved into the <a href="https://www.npmjs.com/package/@astrojs/sitemap">@astrojs/sitemap</a> integration.</li> </ul> <p>If you run Astro with legacy configuration, you will see a warning with instructions on how to update. See our updated <a href="../../../reference/configuration-reference/index.html">Configuration Reference</a> for more information on upgrading.</p> <p>Read <a href="https://github.com/withastro/rfcs/blob/main/proposals/0019-config-finalization.md">RFC0019</a> for more background on these changes.</p> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="new-markdown-api">New Markdown API</h3></div> <p>Astro v0.26 releases a brand new Markdown API for your content. This included three major user-facing changes:</p> <ul> <li>You can now <code dir="auto">import</code>/<code dir="auto">import()</code> markdown content directly using an ESM import.</li> <li>A new <code dir="auto">Astro.glob()</code> API, for easier glob imports (especially for Markdown).</li> <li>
<strong>BREAKING CHANGE:</strong> <code dir="auto">Astro.fetchContent()</code> has been removed and replaced by <code dir="auto">Astro.glob()</code>
</li> <li>
<strong>BREAKING CHANGE:</strong> Markdown objects have an updated interface.</li> </ul> <div class="expressive-code">

<pre data-language="js">// v0.25
let allPosts = Astro.fetchContent('./posts/*.md');
// v0.26+
let allPosts = await Astro.glob('./posts/*.md');</pre>

</div> <p>When migrating, be careful about the new Markdown object interface. Frontmatter, for example, has been moved to the <code dir="auto">.frontmatter</code> property, so references like <code dir="auto">post.title</code> should change to <code dir="auto">post.frontmatter.title</code>.</p> <p>This should solve many issues for Markdown users, including some nice performance boosts for larger sites.</p> <p>Read <a href="https://github.com/withastro/rfcs/blob/main/proposals/0017-markdown-content-redesign.md">RFC0017</a> for more background on these changes.</p> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="new-default-script-behavior">New Default Script Behavior</h3></div> <p><code dir="auto">&lt;script&gt;</code> tags in Astro components are now built, bundled and optimized by default. This completes a long-term move to make our Astro component syntax more consistent, matching the default-optimized behavior our <code dir="auto">&lt;style&gt;</code> tags have today.</p> <p>This includes a few changes to be aware of:</p> <ul> <li>
<strong>BREAKING:</strong> <code dir="auto">&lt;script hoist&gt;</code> is the new default <code dir="auto">&lt;script&gt;</code> behavior. The <code dir="auto">hoist</code> attribute has been removed. To use the new default behaviour, make sure there are no other attributes on the <code dir="auto">&lt;script&gt;</code> tag. For example, remove <code dir="auto">type="module"</code> if you were using it before.</li> <li>New <code dir="auto">&lt;script is:inline&gt;</code> directive, to revert a <code dir="auto">&lt;script&gt;</code> tag to previous default behavior (unbuilt, unbundled, untouched by Astro).</li> <li>New <code dir="auto">&lt;style is:inline&gt;</code> directive, to leave a style tag inline in the page template (similar to previous <code dir="auto">&lt;script&gt;</code> behavior).</li> <li>New <code dir="auto">&lt;style is:global&gt;</code> directive to replace <code dir="auto">&lt;style global&gt;</code> in a future release.</li> </ul> <div class="expressive-code">

<pre data-language="js">// v0.25
&lt;script hoist type="module"&gt;
// v0.26+
&lt;script&gt;</pre>

</div> <p>See how to use <a href="../../client-side-scripts/index.html">client-side scripts</a> in Astro for full details.</p> <p>Read <a href="https://github.com/withastro/rfcs/blob/main/proposals/0016-style-script-defaults.md">RFC0016</a> for more background on these changes.</p> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="updated-astrorequest-api">Updated <code dir="auto">Astro.request</code> API</h3></div> <p><code dir="auto">Astro.request</code> has been changed from our custom object to a standard <code dir="auto">Request</code> object. This is part of a project to use more web standard APIs, especially where SSR is concerned.</p> <p>This includes a few changes to be aware of:</p> <ul> <li>Change <code dir="auto">Astro.request</code> to become a <a href="https://developer.mozilla.org/en-US/docs/Web/API/Request">Request</a> object.</li> <li>Move <code dir="auto">Astro.request.params</code> to <code dir="auto">Astro.params</code>.</li> <li>Move <code dir="auto">Astro.request.canonicalURL</code> to <code dir="auto">Astro.canonicalURL</code>.</li> </ul> <p>Read <a href="https://github.com/withastro/rfcs/blob/main/proposals/0018-astro-request.md">RFC0018</a> for more background on these changes.</p> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="other-changes">Other Changes</h3></div> <ul> <li>Improve <code dir="auto">Astro.slots</code> API to support passing arguments to function-based slots. This allows for more ergonomic utility components that accept a callback function as a child.</li> <li>Update CLI output formatting, especially around error reporting.</li> <li>Update <code dir="auto">@astrojs/compiler</code>, fixing some bugs related to RegExp usage in frontmatter</li> </ul> <div tabindex="-1" class="heading-wrapper level-h2"><h2 id="migrate-to-v025">Migrate to v0.25</h2></div> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="astro-integrations">Astro Integrations</h3></div> <p>The <code dir="auto">renderers</code> config has been replaced by a new, official integration system! This unlocks some really exciting new features for Astro. You can read our <a href="../../integrations-guide/index.html">Using Integrations</a> guide for more details on how to use this new system.</p> <p>Integrations replace our original <code dir="auto">renderers</code> concept, and come with a few breaking changes and new defaults for existing users. These changes are covered below.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="removed-built-in-framework-support">Removed: Built-in Framework Support</h4></div> <p>Previously, React, Preact, Svelte, and Vue were all included with Astro by default. Starting in v0.25.0, Astro no longer comes with any built-in renderers. If you did not have a <code dir="auto">renderers</code> configuration entry already defined for your project, you will now need to install those frameworks yourself.</p> <p>Read our <a href="../../integrations-guide/index.html">step-by-step walkthrough</a> to learn how to add a new Astro integration for the framework(s) that you currently use.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="deprecated-renderers">Deprecated: Renderers</h4></div> <aside aria-label="Note" class="starlight-aside starlight-aside--note"><p class="starlight-aside__title" aria-hidden="true">Note</p>
<section class="starlight-aside__content"><p>Read this section if you have custom “renderers” already defined in your configuration file.</p></section></aside> <p>The new integration system replaces the previous <code dir="auto">renderers</code> system, including the published <code dir="auto">@astrojs/renderer-*</code> packages on npm. Going forward, <code dir="auto">@astrojs/renderer-react</code> becomes <code dir="auto">@astrojs/react</code>, <code dir="auto">@astrojs/renderer-vue</code> becomes <code dir="auto">@astrojs/vue</code>, and so on.</p> <p><strong>To migrate:</strong> update Astro to <code dir="auto">v0.25.0</code> and then run <code dir="auto">astro dev</code> or <code dir="auto">astro build</code> with your old configuration file containing the outdated <code dir="auto">"renderers"</code> config. You will immediately see a notice telling you the exact changes you need to make to your <code dir="auto">astro.config.mjs</code> file, based on your current config. You can also update your packages yourself, using the table below.</p> <p>For a deeper walkthrough, read our <a href="../../integrations-guide/index.html">step-by-step guide</a> to learn how to replace existing renderers with a new Astro framework integration.</p> <div class="expressive-code">
<div class="_pre-heading">
<span class="sr-only">Terminal window</span>
</div>
<pre data-language="shell"># Install your new integrations and frameworks:
# (Read the full walkthrough: https://docs.astro.build/en/guides/integrations-guide)
npm install @astrojs/lit lit
npm install @astrojs/react react react-dom</pre>

</div> <div class="expressive-code">

<pre data-language="js">// Then, update your `astro.config.mjs` file:
// (Read the full walkthrough: https://docs.astro.build/en/guides/integrations-guide)
import lit from '@astrojs/lit';
import react from '@astrojs/react';


export default {
  renderers: ['@astrojs/renderer-lit', '@astrojs/renderer-react'],
  integrations: [lit(), react()],
}</pre>

</div> <table>
<thead><tr>
<th>Deprecated Renderers on npm</th>
<th>v0.25+ Integrations on npm</th>
</tr></thead>
<tbody>
<tr>
<td>@astrojs/renderer-react</td>
<td>@astrojs/react</td>
</tr>
<tr>
<td>@astrojs/renderer-preact</td>
<td>@astrojs/preact</td>
</tr>
<tr>
<td>@astrojs/renderer-solid</td>
<td>@astrojs/solid-js</td>
</tr>
<tr>
<td>@astrojs/renderer-vue</td>
<td>@astrojs/vue</td>
</tr>
<tr>
<td>@astrojs/renderer-svelte</td>
<td>@astrojs/svelte</td>
</tr>
</tbody>
</table> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="handling-peer-dependencies">Handling Peer Dependencies</h4></div> <aside aria-label="Note" class="starlight-aside starlight-aside--note"><p class="starlight-aside__title" aria-hidden="true">Note</p>
<section class="starlight-aside__content"><p>Read this section if: You are on Node v14 <strong>or</strong> if you use any package manager other than npm.</p></section></aside> <p>Unlike the old renderers, integrations no longer mark the frameworks themselves (“react”, “svelte”, “vue”, etc.) as direct dependencies of the integration. Instead, you should now install your framework packages <em>in addition to</em> your integrations.</p> <div class="expressive-code">
<div class="_pre-heading">
<span class="sr-only">Terminal window</span>
</div>
<pre data-language="shell"># Example: Install integrations and frameworks together
npm install @astrojs/react react react-dom</pre>

</div> <p>If you see a <code dir="auto">"Cannot find package 'react'"</code> (or similar) warning when you start up Astro, that means that you need to install that package into your project. See our <a href="../../troubleshooting/index.html#cannot-find-package-x">note on peer dependencies</a> in the troubleshooting guide for more information.</p> <p>If you are using <code dir="auto">npm</code> &amp; Node v16+, then this may be automatically handled for you by <code dir="auto">npm</code>, since the latest version of <code dir="auto">npm</code> (v7+) installs peer dependencies like this for you automatically. In that case, installing a framework like “react” into your project is an optional but still recommended step.</p> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="updated-syntax-highlighting">Updated: Syntax Highlighting</h3></div> <p>We love to find sensible defaults that “just work” out-of-the-box. As part of this, we decided to make <a href="https://github.com/shikijs/shiki">Shiki</a> our new default syntax highlighter. This comes pre-configured with the <code dir="auto">github-dark</code> theme, providing zero-config highlighting in your code blocks without extraneous CSS classes, stylesheets, or client-side JS.</p> <p>Check our new <a href="../../markdown-content/index.html#syntax-highlighting">syntax highlighting docs</a> for full details. <strong>If you prefer to keep Prism as your syntax highlighter,</strong> <a href="../../markdown-content/index.html#prism-configuration">set the <code dir="auto">syntaxHighlight</code> option to <code dir="auto">'prism'</code></a> in your project’s markdown configuration.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="the-prism--component-has-a-new-home">The <code dir="auto">&lt;Prism /&gt;</code> component has a new home</h4></div> <p>As part of our mission to keep Astro core as lean as possible, we’ve moved the built-in <code dir="auto">Prism</code> component out of <code dir="auto">astro/components</code> and into the <code dir="auto">@astrojs/prism</code> package. You can now import this component from <code dir="auto">@astrojs/prism</code> like so:</p> <div class="expressive-code">

<pre data-language="astro">---
import { Prism } from '@astrojs/prism';
---</pre>

</div> <p>Since the <code dir="auto">@astrojs/prism</code> package is still bundled with <code dir="auto">astro</code> core, you won’t need to install anything new, nor add Prism as an integration! However, note that we <em>do</em> plan to extract <code dir="auto">@astrojs/prism</code> (and Prism syntax highlighting in general) to a separate, installable package in the future. See <a href="../../../reference/api-reference/index.html#prism-">the <code dir="auto">&lt;Prism /&gt;</code> component API reference</a> for more.</p> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="css-parser-upgrade">CSS Parser Upgrade</h3></div> <p>Our internal CSS parser has been updated, and comes with better support for advanced CSS syntax, like container queries. This should be a mostly invisible change for most users, but hopefully advanced users will enjoy the new CSS feature support.</p> <div tabindex="-1" class="heading-wrapper level-h2"><h2 id="migrate-to-v024">Migrate to v0.24</h2></div> <aside aria-label="Note" class="starlight-aside starlight-aside--note"><p class="starlight-aside__title" aria-hidden="true">Note</p>
<section class="starlight-aside__content"><p>The new build strategy is on by default on 0.24. If you run into a problem you can continue using the old build strategy by passing the <code dir="auto">--legacy-build</code> flag. Please <a href="https://github.com/withastro/astro/issues/new/choose">open an issue</a> so that we can resolve problems with the new build strategy.</p></section></aside> <p>0.24 introduced a new <em>static build</em> strategy that changes the behavior of a few features. In previous versions of Astro this was available behavior with an opt-in flag: <code dir="auto">--experimental-static-build</code>.</p> <p>To migrate for the transition, be aware of the following changes that will be required to move to this new build engine. You can make these changes to your codebase at any time so that you are ready ahead of schedule.</p> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="deprecated-astroresolve">Deprecated: <code dir="auto">Astro.resolve()</code>
</h3></div> <p><code dir="auto">Astro.resolve()</code> allows you to get resolved URLs to assets that you might want to reference in the browser. This was most commonly used inside of <code dir="auto">&lt;link&gt;</code> and <code dir="auto">&lt;img&gt;</code> tags to load CSS files and images as needed. Unfortunately, this will no longer work due to Astro now building assets at <em>build time</em> rather than at <em>render time</em>. You’ll want to upgrade your asset references to one of the following future-proof options available going forward:</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="how-to-resolve-css-files">How to Resolve CSS Files</h4></div> <p><strong>1. ESM Import (Recommended)</strong></p> <p><strong>Example:</strong> <code dir="auto">import './style.css';</code> <strong>When to use this:</strong> If your CSS file lives inside of the <code dir="auto">src/</code> directory, and you want automatic CSS build and optimization features.</p> <p>Use an ESM import to add some CSS onto the page. Astro detects these CSS imports and then builds, optimizes, and adds the CSS to the page automatically. This is the easiest way to migrate from <code dir="auto">Astro.resolve()</code> while keeping the automatic building/bundling that Astro provides.</p> <div class="expressive-code">

<pre data-language="astro">---
// Example: Astro will include and optimize this CSS for you automatically
import './style.css';
---
&lt;html&gt;&lt;!-- Your page here --&gt;&lt;/html&gt;</pre>

</div> <p>Importing CSS files should work anywhere that ESM imports are supported, including:</p> <ul> <li>JavaScript files</li> <li>TypeScript files</li> <li>Astro component frontmatter</li> <li>non-Astro components like React, Svelte, and others</li> </ul> <p>When a CSS file is imported using this method, any <code dir="auto">@import</code> statements are also resolved and inlined into the imported CSS file. All <code dir="auto">url()</code> references are also resolved relative to the source file, and any <code dir="auto">url()</code> referenced assets will be included in the final build.</p> <p><strong>2. Absolute URL Path</strong></p> <p><strong>Example:</strong> <code dir="auto">&lt;link href="/style.css.html"&gt;</code> <strong>When to use this:</strong> If your CSS file lives inside of <code dir="auto">public/</code>, and you prefer to create your HTML <code dir="auto">link</code> element yourself.</p> <p>You can reference any file inside of the <code dir="auto">public/</code> directory by absolute URL path in your component template. This is a good option if you want to control the <code dir="auto">&lt;link&gt;</code> tag on the page yourself. However, this approach also skips the CSS processing, bundling and optimizations that are provided by Astro when you use the <code dir="auto">import</code> method described above.</p> <p>We recommend using the <code dir="auto">import</code> approach over the absolute URL approach since it provides the best possible CSS performance and features by default.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="how-to-resolve-javascript-files">How to Resolve JavaScript Files</h4></div> <p><strong>1. Absolute URL Path</strong></p> <p><strong>Example:</strong> <code dir="auto">&lt;script src="/some-external-script.js" /&gt;</code> <strong>When to use this:</strong> If your JavaScript file lives inside of <code dir="auto">public/</code>.</p> <p>You can reference any file inside of the <code dir="auto">public/</code> directory by absolute URL path in your Astro component templates. This is a good default option for external scripts because it lets you control the <code dir="auto">&lt;script&gt;</code> tag on the page yourself.</p> <p>Note that this approach skips the JavaScript processing, bundling and optimizations that are provided by Astro when you use the <code dir="auto">import</code> method described below. However, this may be preferred for any external scripts that have already been published and minified separately from Astro. If your script was downloaded from an external source, then this method is probably preferred.</p> <p><strong>2. ESM Import via <code dir="auto">&lt;script hoist&gt;</code></strong></p> <p><strong>Example:</strong> <code dir="auto">&lt;script hoist&gt;import './some-external-script.js';&lt;/script&gt;</code> <strong>When to use this:</strong> If your external script lives inside of <code dir="auto">src/</code> <em>and</em> it supports the ESM module type.</p> <p>Use an ESM import inside of a <code dir="auto">&lt;script hoist&gt;</code> element in your Astro template, and Astro will include the JavaScript file in your final build. Astro detects these JavaScript client-side imports and then builds, optimizes, and adds the JavaScript to the page automatically. This is the easiest way to migrate from <code dir="auto">Astro.resolve()</code> while keeping the automatic building/bundling that Astro provides.</p> <div class="expressive-code">

<pre data-language="astro">&lt;script hoist&gt;
  import './some-external-script.js';
&lt;/script&gt;</pre>

</div> <p>Note that Astro will bundle this external script with the rest of your client-side JavaScript, and load it in the <code dir="auto">type="module"</code> script context. Some older JavaScript files may not be written for the <code dir="auto">module</code> context, in which case they may need to be updated to use this method.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="how-to-resolve-images--other-assets">How to Resolve Images &amp; Other Assets</h4></div> <p><strong>1. Absolute URL Path (Recommended)</strong></p> <p><strong>Example:</strong> <code dir="auto">&lt;img src="/penguin.png"&gt;</code> <strong>When to use this:</strong> If your asset lives inside of <code dir="auto">public/</code>.</p> <p>If you place your images inside of <code dir="auto">public/</code> you can safely reference them by absolute URL path directly in your component templates. This is the simplest way to reference an asset that you can use today, and it is recommended for most users who are getting started with Astro.</p> <p><strong>2. ESM Import</strong></p> <p><strong>Example:</strong> <code dir="auto">import imgUrl from './penguin.png'</code> <strong>When to use this:</strong> If your asset lives inside of the <code dir="auto">src/</code> directory, and you want automatic optimization features like filename hashing.</p> <p>This works inside of any JavaScript or Astro component, and returns a resolved URL to the final image. Once you have the resolved URL, you can use it anywhere inside of the component template.</p> <div class="expressive-code">

<pre data-language="astro">---
// Example: Astro will include this image file in your final build
import imgUrl from './penguin.png';
---
&lt;img src={imgUrl} /&gt;</pre>

</div> <p>Similar to how Astro handles CSS, the ESM import allows Astro to perform some simple build optimizations for you automatically. For example, any asset inside of <code dir="auto">src/</code> that is imported using an ESM import (ex: <code dir="auto">import imgUrl from './penguin.png'</code>) will have its filename hashed automatically. This can let you cache the file more aggressively on the server, improving user performance. In the future, Astro may add more optimizations like this.</p> <p><strong>Tip:</strong> If you dislike static ESM imports, Astro also supports dynamic ESM imports. We only recommend this option if you prefer this syntax: <code dir="auto">&lt;img src={(await import('./penguin.png')).default} /&gt;</code>.</p> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="deprecated-script-default-processing">Deprecated: <code dir="auto">&lt;script&gt;</code> Default Processing</h3></div> <p>Previously, all <code dir="auto">&lt;script&gt;</code> elements were read from the final HTML output and processed + bundled automatically. This behavior is no longer the default. Starting in 0.24, you must opt-in to <code dir="auto">&lt;script&gt;</code> element processing via the <code dir="auto">hoist</code> attribute. The <code dir="auto">type="module"</code> is also required for hoisted modules.</p> <div class="expressive-code">

<pre data-language="astro">&lt;script&gt;
  // Will be rendered into the HTML exactly as written!
  // ESM imports will not be resolved relative to the file.
&lt;/script&gt;
&lt;script type="module" hoist&gt;
  // Processed! Bundled! ESM imports work, even to npm packages.
&lt;/script&gt;</pre>

</div> <div tabindex="-1" class="heading-wrapper level-h2"><h2 id="migrate-to-v023">Migrate to v0.23</h2></div> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="missing-sass-error">Missing Sass Error</h3></div> <div class="expressive-code">

<pre data-language="plaintext">Preprocessor dependency "sass" not found. Did you install it?</pre>

</div> <p>In our quest to reduce npm install size, we’ve moved <a href="https://sass-lang.com/">Sass</a> out to an optional dependency. If you use Sass in your project, you’ll want to make sure that you run <code dir="auto">npm install sass --save-dev</code> to save it as a dependency.</p> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="deprecated-unescaped-html">Deprecated: Unescaped HTML</h3></div> <p>In Astro v0.23+, unescaped HTML content in expressions is now deprecated. In future releases, content within expressions will have strings escaped to protect against unintended HTML injection.</p> <div class="expressive-code">

<pre data-language="astro">&lt;h1&gt;{title}&lt;/h1&gt; &lt;!-- &lt;h1&gt;Hello &lt;strong&gt;World&lt;/strong&gt;&lt;/h1&gt; --&gt;
&lt;h1&gt;{title}&lt;/h1&gt; &lt;!-- &lt;h1&gt;Hello &amp;lt;strong&amp;gt;World&amp;lt;/strong&amp;gt;&lt;/h1&gt; --&gt;</pre>

</div> <p>To continue injecting unescaped HTML, you can now use <code dir="auto">set:html</code>.</p> <div class="expressive-code">

<pre data-language="astro">&lt;h1&gt;{title}&lt;/h1&gt;
&lt;h1 set:html={title} /&gt;</pre>

</div> <p>To avoid a wrapper element, <code dir="auto">set:html</code> can work alongside <code dir="auto">&lt;Fragment&gt;</code>.</p> <div class="expressive-code">

<pre data-language="astro">&lt;h1&gt;{title}!&lt;/h1&gt;
&lt;h1&gt;&lt;Fragment set:html={title}&gt;!&lt;/h1&gt;</pre>

</div> <p>You can also protect against unintended HTML injection with <code dir="auto">set:text</code>.</p> <div class="expressive-code">

<pre data-language="astro">&lt;h1 set:text={title} /&gt; &lt;!-- &lt;h1&gt;Hello &amp;lt;strong&amp;gt;World&amp;lt;/strong&amp;gt;&lt;/h1&gt; --&gt;</pre>

</div> <div tabindex="-1" class="heading-wrapper level-h2"><h2 id="migrate-to-v021">Migrate to v0.21</h2></div> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="vite">Vite</h3></div> <p>Starting in v0.21, Astro is built with <a href="https://vitejs.dev">Vite</a>. As a result, configurations written in <code dir="auto">snowpack.config.mjs</code> should be moved into <code dir="auto">astro.config.mjs</code>.</p> <div class="expressive-code">

<pre data-language="js">// @ts-check


/** @type {import('astro').AstroUserConfig} */
export default {
  renderers: [],
  vite: {
    plugins: [],
  },
};</pre>

</div> <p>To learn more about configuring Vite, please visit their <a href="https://vitejs.dev/config/">configuration guide</a>.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="vite-plugins">Vite Plugins</h4></div> <p>In Astro v0.21+, Vite plugins may be configured within <code dir="auto">astro.config.mjs</code>.</p> <div class="expressive-code">

<pre data-language="js">import { imagetools } from 'vite-imagetools';


export default {
  vite: {
    plugins: [imagetools()],
  },
};</pre>

</div> <p>To learn more about Vite plugins, please visit their <a href="https://vitejs.dev/guide/using-plugins.html">plugin guide</a>.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="vite-changes-to-renderers">Vite Changes to Renderers</h4></div> <p>In Astro v0.21+, plugins should now use <code dir="auto">viteConfig()</code>.</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">renderer-svelte/index.js</span></div>
<pre data-language="js">import { svelte } from '@sveltejs/vite-plugin-svelte';


export default {
  name: '@astrojs/renderer-svelte',
  client: './client.js',
  server: './server.js',
  snowpackPlugin: '@snowpack/plugin-svelte',
  snowpackPluginOptions: { compilerOptions: { hydratable: true } },
  viteConfig() {
    return {
      optimizeDeps: {
        include: ['@astrojs/renderer-svelte/client.js', 'svelte', 'svelte/internal'],
        exclude: ['@astrojs/renderer-svelte/server.js'],
      },
      plugins: [
        svelte({
          emitCss: true,
          compilerOptions: { hydratable: true },
        }),
      ],
    };
  },
}</pre>

</div> <p>To learn more about Vite plugins, please visit their <a href="https://vitejs.dev/guide/using-plugins.html">plugin guide</a>.</p> <aside aria-label="Note" class="starlight-aside starlight-aside--note"><p class="starlight-aside__title" aria-hidden="true">Note</p>
<section class="starlight-aside__content"><p>In prior releases, these were configured with <code dir="auto">snowpackPlugin</code> or <code dir="auto">snowpackPluginOptions</code>.</p></section></aside> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="aliasing">Aliasing</h3></div> <p>In Astro v0.21+, import aliases can be added in <code dir="auto">tsconfig.json</code>.</p> <div class="expressive-code">

<pre data-language="json">{
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "@/components/*": ["src/components/*"]
    }
  }
}</pre>

</div> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="file-extensions-in-imports">File Extensions in Imports</h3></div> <p>In Astro v0.21+, files need to be referenced by their actual extension, exactly as it is on disk. In this example, <code dir="auto">Div.tsx</code> would need to be referenced as <code dir="auto">Div.tsx</code>, not <code dir="auto">Div.jsx</code>.</p> <div class="expressive-code">

<pre data-language="js">import Div from './Div.jsx' // Astro v0.20
import Div from './Div.tsx' // Astro v0.21</pre>

</div> <p>This same change applies to a compile-to-css file like <code dir="auto">Div.scss</code>:</p> <div class="expressive-code">

<pre data-language="astro">&lt;link rel="stylesheet" href={Astro.resolve('./Div.css')}&gt;
&lt;link rel="stylesheet" href={Astro.resolve('./Div.scss')}&gt;</pre>

</div> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="removed-components-in-frontmatter">Removed: Components in Frontmatter</h3></div> <p>Previously, you could create mini Astro Components inside of the Astro Frontmatter, using JSX syntax instead of Astro’s component syntax. This was always a bit of a hack, but in the new compiler it became impossible to support. We hope to re-introduce this feature in a future release of Astro using a different, non-JSX API.</p> <p>To migrate to v0.21+, please convert all JSX Astro components (that is, any Astro components created inside of another component’s frontmatter) to standalone components.</p> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="styling-changes">Styling Changes</h3></div> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="autoprefixer">Autoprefixer</h4></div> <p>Autoprefixer is no longer run by default. To enable:</p> <ol role="list" class="sl-steps"> <li> <p>Install the latest version (<code dir="auto">npm install autoprefixer</code>)</p> </li> <li> <p>Create a <code dir="auto">postcss.config.cjs</code> file at the root of your project with:</p> <div class="expressive-code">

<pre data-language="js">module.exports = {
  plugins: {
    autoprefixer: {},
  },
};</pre>

</div> </li> </ol> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="tailwind-css">Tailwind CSS</h4></div> <p>Ensure you have PostCSS installed. This was optional in previous releases, but is required now:</p> <ol role="list" class="sl-steps"> <li> <p>Install the latest version of postcss (<code dir="auto">npm install -D postcss</code>)</p> </li> <li> <p>Create a <code dir="auto">postcss.config.cjs</code> file at the root of your project with:</p> <div class="expressive-code">

<pre data-language="js">module.exports = {
  plugins: {
    tailwindcss: {},
  },
};</pre>

</div> <p>For more information, read the <a href="https://tailwindcss.com/docs/installation#add-tailwind-as-a-post-css-plugin">Tailwind CSS documentation</a></p> </li> </ol> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="known-issues">Known Issues</h3></div> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="imports-on-top">Imports on top</h4></div> <p>In Astro v0.21+, a bug has been introduced that requires imports inside components to be at the top of your frontmatter.</p> <div class="expressive-code">

<pre data-language="astro">---
import Component from '../components/Component.astro'
const whereShouldIPutMyImports = "on top!"
---</pre>

</div> <span id="docsearch-lvl0" hidden class="astro-klj6ju3r">Upgrade Guides</span> </div>   </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2021 Fred K. Schott<br>Licensed under the MIT License.<br>
    <a href="https://docs.astro.build/en/guides/upgrade-to/v1/" class="_attribution-link">https://docs.astro.build/en/guides/upgrade-to/v1/</a>
  </p>
</div>
