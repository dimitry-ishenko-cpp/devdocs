<h1 id="_top" class="astro-556cgime">Upgrade to Astro v3</h1> <div class="content-panel astro-ayt3hsza"> <div class="sl-container astro-ayt3hsza"> <div class="sl-markdown-content astro-klj6ju3r"> <p>This guide will help you migrate from Astro v2 to Astro v3.</p> <p>Need to upgrade an older project to v2? See our <a href="../v2/index.html">older migration guide</a>.</p> <div tabindex="-1" class="heading-wrapper level-h2"><h2 id="upgrade-astro">Upgrade Astro</h2></div> <p>Update your projectâ€™s version of Astro to the latest version using your package manager. If youâ€™re using Astro integrations, please also update those to the latest version.</p> <starlight-tabs data-sync-key="package-managers" class="astro-tx2opqu5"> <div class="tablist-wrapper not-content astro-tx2opqu5"> <ul role="tablist" class="astro-tx2opqu5"> <li role="presentation" class="tab astro-tx2opqu5"> <a role="tab" href="#tab-panel-489" id="tab-489" aria-selected="true" tabindex="0" class="astro-tx2opqu5"> npm </a> </li>
<li role="presentation" class="tab astro-tx2opqu5"> <a role="tab" href="#tab-panel-490" id="tab-490" aria-selected="false" tabindex="-1" class="astro-tx2opqu5"> pnpm </a> </li>
<li role="presentation" class="tab astro-tx2opqu5"> <a role="tab" href="#tab-panel-491" id="tab-491" aria-selected="false" tabindex="-1" class="astro-tx2opqu5"> Yarn </a> </li> </ul> </div> <section id="tab-panel-489" aria-labelledby="tab-489" role="tabpanel"> <div class="expressive-code">
<div class="_pre-heading">
<span class="sr-only">Terminal window</span>
</div>
<pre data-language="shell"># Upgrade to Astro v3.x
npm install astro@latest


# Example: upgrade React and Tailwind integrations
npm install @astrojs/react@latest @astrojs/tailwind@latest</pre>

</div> </section> <section id="tab-panel-490" aria-labelledby="tab-490" role="tabpanel" hidden> <div class="expressive-code">
<div class="_pre-heading">
<span class="sr-only">Terminal window</span>
</div>
<pre data-language="shell"># Upgrade to Astro v3.x
pnpm add astro@latest


# Example: upgrade React and Tailwind integrations
pnpm add @astrojs/react@latest @astrojs/tailwind@latest</pre>

</div> </section> <section id="tab-panel-491" aria-labelledby="tab-491" role="tabpanel" hidden> <div class="expressive-code">
<div class="_pre-heading">
<span class="sr-only">Terminal window</span>
</div>
<pre data-language="shell"># Upgrade to Astro v3.x
yarn add astro@latest


# Example: upgrade React and Tailwind integrations
yarn add @astrojs/react@latest @astrojs/tailwind@latest</pre>

</div> </section> </starlight-tabs>  <aside aria-label="Need to continue?" class="starlight-aside starlight-aside--note"><p class="starlight-aside__title" aria-hidden="true">Need to continue?</p>
<section class="starlight-aside__content"><p>After upgrading Astro to the latest version, you may not need to make any changes to your project at all!</p>
<p>But, if you notice errors or unexpected behavior, please check below for what has changed that might need updating in your project.</p></section></aside> <div tabindex="-1" class="heading-wrapper level-h2"><h2 id="astro-v30-experimental-flags-removed">Astro v3.0 Experimental Flags Removed</h2></div> <p>Remove the following experimental flags from <code dir="auto">astro.config.mjs</code>:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">astro.config.mjs</span></div>
<pre data-language="js">import { defineConfig } from 'astro/config';


export default defineConfig({
  experimental: {
    assets: true,
    viewTransitions: true,
  },
})</pre>

</div> <p>These features are now available by default:</p> <ul> <li>View Transitions for animated page transitions and persistent islands. See <a href="#upgrade-view-transitions-to-v3">view transitions API breaking changes and upgrading advice</a> if you were using this experimental flag.</li> <li>A new image services API <code dir="auto">astro:assets</code> for using images in Astro, including a new <code dir="auto">&lt;Image /&gt;</code> component and <code dir="auto">getImage()</code> function. Please read the detailed <a href="#upgrade-images-to-v3">image upgrade advice</a> <strong>whether or not you were using this experimental flag</strong> to see how this might affect your project.</li> </ul> <p>Read more about these two exciting features and more in <a href="https://astro.build/blog/astro-3/">the 3.0 Blog post</a>!</p> <div tabindex="-1" class="heading-wrapper level-h2"><h2 id="astro-v30-breaking-changes">Astro v3.0 Breaking Changes</h2></div> <p>Astro v3.0 includes some breaking changes, as well as the removal of some previously deprecated features. If your project doesnâ€™t work as expected after upgrading to v3.0, check this guide for an overview of all breaking changes and instructions on how to update your codebase.</p> <p>See <a href="https://github.com/withastro/astro/blob/main/packages/astro/CHANGELOG.md">the changelog</a> for full release notes.</p> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="removed-support-for-node-16">Removed: Support for Node 16</h3></div> <p>Node 16 is scheduled to reach its End of Life in September 2023.</p> <p>Astro v3.0 drops Node 16 support entirely so that all Astro users can take advantage of Nodeâ€™s more modern features.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do">What should I do?</h4></div> <p>Check that both your development environment and your deployment environment are using <strong>Node <code dir="auto">18.14.1</code> or higher</strong>.</p> <ol role="list" class="sl-steps"> <li> <p>Check your local version of Node using:</p> <div class="expressive-code">
<div class="_pre-heading">
<span class="sr-only">Terminal window</span>
</div>
<pre data-language="sh">node -v</pre>

</div> </li> <li> <p>Check your <a href="../../deploy/index.html">deployment environmentâ€™s</a> own documentation to verify that they support Node 18.</p> <p>You can specify Node <code dir="auto">18.14.1</code> for your Astro project either in a dashboard configuration setting or a <code dir="auto">.nvmrc</code> file.</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">.nvmrc</span></div>
<pre data-language="bash">18.14.1</pre>

</div> </li> </ol> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="removed-support-for-typescript-4">Removed: Support for TypeScript 4</h3></div> <p>In Astro v2.x, the <code dir="auto">tsconfig.json</code> presets include support for both TypeScript 4.x and 5.x.</p> <p>Astro v3.0 updates the <code dir="auto">tsconfig.json</code> presets to only support TypeScript 5.x. Astro now assumes that you use TypeScript 5.0 (March 2023), or that your editor includes it (e.g. VS Code 1.77).</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-1">What should I do?</h4></div> <p>If you have installed TypeScript locally, update to at least v5.0.</p> <div class="expressive-code">
<div class="_pre-heading">
<span class="sr-only">Terminal window</span>
</div>
<pre data-language="bash">npm install typescript@latest --save-dev</pre>

</div> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="removed-astrojsimage">Removed: <code dir="auto">@astrojs/image</code>
</h3></div> <p>In Astro v2.x, Astro offered an official image integration that included Astro <code dir="auto">&lt;Image /&gt;</code> and <code dir="auto">&lt;Picture /&gt;</code> components.</p> <p>Astro v3.0 removes this integration from the codebase entirely. Astroâ€™s new solution for images is a built-in image services API: <code dir="auto">astro:assets</code>.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-2">What should I do?</h4></div> <p>Remove the <code dir="auto">@astrojs/image</code> integration from your project. You will need to not only uninstall the integration but also update or remove any import statements and existing <code dir="auto">&lt;Image /&gt;</code> and <code dir="auto">&lt;Picture /&gt;</code> components. You might also need to configure a preferred default image processing service.</p> <p>You will find <a href="#remove-astrojsimage">complete, step-by-step instructions for removing the old image integration</a> in our Images guide.</p> <p>Migrating to <code dir="auto">astro:assets</code> will also bring some new image options and features that you may now wish to use. Please see the full <a href="#upgrade-images-to-v3">v3.0 Image Upgrade Advice</a> for full details!</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">astro.config.mjs</span></div>
<pre data-language="js">import { defineConfig } from 'astro/config';
import image from '@astrojs/image';


export default defineConfig({
  integrations: [
    image(),
  ]
})</pre>

</div> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="removed-markdown--component">Removed: <code dir="auto">&lt;Markdown /&gt;</code> component</h3></div> <p>In Astro v1.x, Astro deprecated the <code dir="auto">&lt;Markdown /&gt;</code> component and moved it to an external package.</p> <p>Astro v3.0 completely removes the package <code dir="auto">@astrojs/markdown-component</code>. Astroâ€™s <code dir="auto">&lt;Markdown /&gt;</code> component will no longer work in your project.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-3">What should I do?</h4></div> <p>Remove all instances of the <code dir="auto">@astrojs/markdown-component</code>.</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/components/MyAstroComponent.astro</span></div>
<pre data-language="astro">---
import Markdown from '@astrojs/markdown-component';
---</pre>

</div> <p>To continue using a similar <code dir="auto">&lt;Markdown /&gt;</code> component in your code, consider using <a href="https://astro.build/integrations/">community integrations</a> such as <a href="https://github.com/natemoo-re/astro-remote"><code dir="auto">astro-remote</code></a>. Be sure to update your <code dir="auto">&lt;Markdown /&gt;</code> component imports and attributes as necessary, according to the integrationâ€™s own documentation.</p> <p>Otherwise, delete all references to importing Astroâ€™s <code dir="auto">&lt;Markdown /&gt;</code> component and the component itself in your <code dir="auto">.astro</code> files. You will need to rewrite your content as HTML directly or <a href="../../markdown-content/index.html#importing-markdown">import Markdown</a> from a <code dir="auto">.md</code> file.</p> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="removed-deprecated-1x-apis">Removed: deprecated 1.x APIs</h3></div> <p>In Astro v1.x, Astro deprecated our original configuration settings as well as <code dir="auto">&lt;style global&gt;</code> and <code dir="auto">&lt;script hoist&gt;</code> support. However, these were still supported for backwards compatibility.</p> <p>Astro v3.0 removes these deprecated APIs entirely. The officially supported <a href="../../../reference/configuration-reference/index.html">configuration settings</a> and modern <code dir="auto">&lt;style is:global&gt;</code> and <code dir="auto">&lt;script&gt;</code> syntax should be used instead.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-4">What should I do?</h4></div> <p>If you are continuing to use v1.x APIs, use the new APIs for each feature instead:</p> <ul> <li>Deprecated config options: See <a href="../v1/index.html#new-configuration-api">the 0.26 migration guide</a>
</li> <li>Deprecated script/style attribute types: See <a href="../v1/index.html#new-default-script-behavior">the 0.26 migration guide</a>
</li> </ul> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="removed-partial-shims-for-web-apis-in-server-code">Removed: Partial shims for Web APIs in server code</h3></div> <p>In Astro v2.x, Astro provided partial shims for Web APIs such as <code dir="auto">document</code> or <code dir="auto">localStorage</code> in server-rendered code. These shims were often incomplete and unreliable.</p> <p>Astro v3.0 removes these partial shims entirely. Web APIs are no longer available in server-rendered code.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-5">What should I do?</h4></div> <p>If you are using Web APIs in server-rendered components, you will need to either make the usage of those APIs conditional or use <a href="../../../reference/directives-reference/index.html#clientonly">the <code dir="auto">client:only</code> client directive</a>.</p> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="removed-image-from-astrocontent-in-content-collections-schema">Removed: <code dir="auto">image</code> from <code dir="auto">astro:content</code> in content collections schema</h3></div> <p>In Astro v2.x, the content collections API deprecated an <code dir="auto">image</code> export from <code dir="auto">astro:content</code> for use in your content collections schemas.</p> <p>Astro v3.0 removes this export entirely.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-6">What should I do?</h4></div> <p>If you are using the deprecated <code dir="auto">image()</code> from <code dir="auto">astro:content</code>, remove it as this no longer exists. Validate images through <a href="#update-content-collections-schemas">the <code dir="auto">image</code> helper from <code dir="auto">schema</code></a> instead:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/content/config.ts</span></div>
<pre data-language="ts">import { defineCollection, z, image } from "astro:content";
import { defineCollection, z } from "astro:content";


defineCollection({
  schema: ({ image }) =&gt;
    z.object({
      image: image(),
   }),
});</pre>

</div> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="removed-pre-014-shiki-theme-names">Removed: pre-0.14 Shiki theme names</h3></div> <p>In Astro v2.x, some Shiki theme names had been renamed, but the original names were kept for backwards compatibility.</p> <p>Astro v3.0 removes the original names in favor of the renamed theme names.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-7">What should I do?</h4></div> <p>If your project uses any of the themes below, rename them to their updated name:</p> <ul> <li>
<code dir="auto">material-darker</code> -&gt; <code dir="auto">material-theme-darker</code>
</li> <li>
<code dir="auto">material-default</code> -&gt; <code dir="auto">material-theme</code>
</li> <li>
<code dir="auto">material-lighter</code> -&gt; <code dir="auto">material-theme-lighter</code>
</li> <li>
<code dir="auto">material-ocean</code> -&gt; <code dir="auto">material-theme-ocean</code>
</li> <li>
<code dir="auto">material-palenight</code> -&gt; <code dir="auto">material-theme-palenight</code>
</li> </ul> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="removed-classlist-features">Removed: <code dir="auto">class:list</code> features</h3></div> <p>In Astro v2.x, the <a href="../../../reference/directives-reference/index.html#classlist"><code dir="auto">class:list</code> directive</a> used a custom implementation inspired by <a href="https://github.com/lukeed/clsx"><code dir="auto">clsx</code></a> with a few extra features like deduplication and <code dir="auto">Set</code> support.</p> <p>Astro v3.0 now uses <code dir="auto">clsx</code> directly for <code dir="auto">class:list</code>, which does not support deduplication or <code dir="auto">Set</code> values.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-8">What should I do?</h4></div> <p>Replace any <code dir="auto">Set</code> elements passed to the <code dir="auto">class:list</code> directive with a plain <code dir="auto">Array</code>.</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/components/MyAstroComponent.astro</span></div>
<pre data-language="astro">&lt;Component class:list={[
  'a',
  'b',
  new Set(['c', 'd'])
  ['c', 'd']
]} /&gt;</pre>

</div> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="removed-passing-classlist-as-a-prop">Removed: passing <code dir="auto">class:list</code> as a prop</h3></div> <p>In Astro v2.x, <a href="../../../reference/directives-reference/index.html#classlist"><code dir="auto">class:list</code> values</a> were sent to components via <a href="../../../reference/api-reference/index.html#astroprops"><code dir="auto">Astro.props['class:list']</code></a>.</p> <p>Astro v3.0 normalizes <code dir="auto">class:list</code> values into a string before being sent to components via <code dir="auto">Astro.props['class']</code></p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-9">What should I do?</h4></div> <p>Remove any code that expects to receive the <code dir="auto">class:list</code> prop.</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/components/MyAstroComponent.astro</span></div>
<pre data-language="astro">---
import { clsx } from 'clsx';
const { class: className, 'class:list': classList } = Astro.props;
const { class: className } = Astro.props;
---
&lt;div
  class:list={[className, classList]}
  class:list={[className]}
/&gt;</pre>

</div> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="removed-kebab-case-transform-for-camelcase-css-variables">Removed: kebab-case transform for camelCase CSS variables</h3></div> <p>In Astro v2.x, camelCase <a href="../../styling/index.html#css-variables">CSS variables</a> passed to the <code dir="auto">style</code> attribute were rendered as both camelCase (as written) and kebab-case (kept for backwards compatibility).</p> <p>Astro v3.0 removes the kebab-case transform for these camelCase CSS variable names, and only the original camelCase CSS variable is rendered.</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/components/MyAstroComponent.astro</span></div>
<pre data-language="astro">---
const myValue = "red"
---
&lt;!-- input --&gt;
&lt;div style={{ "--myValue": myValue }}&gt;&lt;/div&gt;


&lt;!-- output (Astro 2.x) --&gt;
&lt;div style="--my-value:var(--myValue);--myValue:red"&gt;&lt;/div&gt;
&lt;!-- output (Astro 3.0) --&gt;
&lt;div style="--myValue:red"&gt;&lt;/div&gt;</pre>

</div> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-10">What should I do?</h4></div> <p>If you were relying on Astro to transform kebab-case in your styles, update your existing styles to camelCase to prevent missing styles. For example:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/components/MyAstroComponent.astro</span></div>
<pre data-language="astro">&lt;style&gt;
  div {
   color: var(--my-value);
   color: var(--myValue);
  }
&lt;/style&gt;</pre>

</div> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="removed-automatic-flattening-of-getstaticpathss-return-value">Removed: automatic flattening of <code dir="auto">getStaticPaths()</code>â€™s return value</h3></div> <p>In Astro v2.x, the return value of <a href="../../../reference/api-reference/index.html#getstaticpaths"><code dir="auto">getStaticPaths()</code></a> was automatically flattened to allow you to return an array of arrays without errors.</p> <p>Astro v3.0 removes automatic flattening of <code dir="auto">getStaticPaths()</code>â€™s result.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-11">What should I do?</h4></div> <p>If youâ€™re returning an array of arrays instead of an array of <em>objects</em> (as is expected), <code dir="auto">.flatMap</code> and <code dir="auto">.flat</code> should now be used to ensure that you are returning a flat array.</p> <p>An <a href="../../../reference/errors/invalid-get-static-paths-entry/index.html#what-went-wrong">error message indicating that <code dir="auto">getStaticPath()</code>â€™s return value must be an array of objects</a> will be provided if you need to update your code.</p> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="moved-astro-check-now-requires-an-external-package">Moved: <code dir="auto">astro check</code> now requires an external package</h3></div> <p>In Astro v2.x, <a href="../../../reference/cli-reference/index.html#astro-check"><code dir="auto">astro check</code></a> was included in Astro by default, and its dependencies were bundled in Astro. This meant a larger package whether or not you ever used <code dir="auto">astro check</code>. This also prevented you from having control over the version of TypeScript and the Astro Language Server to use.</p> <p>Astro v3.0 moves the <code dir="auto">astro check</code> command out of Astro core and now requires an external package <code dir="auto">@astrojs/check</code>. Additionally, you must install <code dir="auto">typescript</code> in your project to use the <code dir="auto">astro check</code> command.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-12">What should I do?</h4></div> <p>Run the <code dir="auto">astro check</code> command after upgrading to Astro v3.0 and follow the prompts to install the required dependencies, or manually install <code dir="auto">@astrojs/check</code> and <code dir="auto">typescript</code> into your project.</p> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="deprecated-buildexcludemiddleware-and-buildsplit">Deprecated: <code dir="auto">build.excludeMiddleware</code> and <code dir="auto">build.split</code>
</h3></div> <p>In Astro v2.x, <code dir="auto">build.excludeMiddleware</code> and <code dir="auto">build.split</code> were used to change how specific files were emitted when using an adapter in SSR mode.</p> <p>Astro v3.0 replaces these build config options with new <a href="../../integrations-guide/index.html#official-integrations">SSR adapter configuration options</a> to perform the same tasks: <code dir="auto">edgeMiddleware</code> and <code dir="auto">functionPerRoute</code>.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-13">What should I do?</h4></div> <p>Update the Astro config file to now use the new options <strong>in the adapter configuration</strong> directly.</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">astro.config.mjs</span></div>
<pre data-language="js">import { defineConfig } from "astro/config";
import vercel from "@astrojs/vercel/serverless";


export default defineConfig({
    build: {
      excludeMiddleware: true
    },
    adapter: vercel({
      edgeMiddleware: true
    }),
});</pre>

</div> <div class="expressive-code">
<div class="_pre-heading"><span class="title">astro.config.mjs</span></div>
<pre data-language="js">import { defineConfig } from "astro/config";
import netlify from "@astrojs/netlify/functions";


export default defineConfig({
     build: {
        split: true
     },
     adapter: netlify({
        functionPerRoute: true
     }),
});</pre>

</div> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="deprecated-markdowndrafts">Deprecated: <code dir="auto">markdown.drafts</code>
</h3></div> <p>In Astro v2.x, the <code dir="auto">markdown.drafts</code> configuration allowed you to have draft pages that were available in when running the dev server, but not built in production.</p> <p>Astro v3.0 deprecates this feature in favor of the content collections method of handling draft pages by filtering manually instead, which gives more control over the feature.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-14">What should I do?</h4></div> <p>To continue to mark some pages in your project as drafts, <a href="../../content-collections/index.html#migrating-from-file-based-routing">migrate to content collections</a> and <a href="../../content-collections/index.html#filtering-collection-queries">manually filter out pages</a> with the <code dir="auto">draft: true</code> frontmatter property instead.</p> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="deprecated-returning-simple-object-in-endpoints">Deprecated: returning simple object in endpoints</h3></div> <p>In Astro v2.x, endpoints could return a simple object, which would be converted to a JSON response.</p> <p>Astro v3.0 deprecates this behavior in favor of returning a <code dir="auto">Response</code> object directly.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-15">What should I do?</h4></div> <p>Update your endpoints to return a <code dir="auto">Response</code> object directly.</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">endpoint.json.ts</span></div>
<pre data-language="ts">export async function GET() {
  return { body: { "title": "Bob's blog" }};
  return new Response(JSON.stringify({ "title": "Bob's blog" }));
}</pre>

</div> <p>If you really need to keep the previous format, you can use the <code dir="auto">ResponseWithEncoding</code> object but will be deprecated in the future.</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">endpoint.json.ts</span></div>
<pre data-language="ts">export async function GET() {
  return { body: { "title": "Bob's blog" } };
  return new ResponseWithEncoding({ body: { "title": "Bob's blog" }});
}</pre>

</div> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="changed-default-verbatimmodulesyntax-in-tsconfigjson-presets">Changed default: <code dir="auto">verbatimModuleSyntax</code> in tsconfig.json presets</h3></div> <p>In Astro v2.x, the <a href="https://www.typescriptlang.org/tsconfig#verbatimModuleSyntax"><code dir="auto">verbatimModuleSyntax</code></a> setting was off by default, with its TypeScript 4.x equivalent <code dir="auto">importsNotUsedAsValues</code> being enabled in the <code dir="auto">strict</code> preset.</p> <p>In Astro v3.0, <code dir="auto">verbatimModuleSyntax</code> is enabled in every preset.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-16">What should I do?</h4></div> <p>This option requires that types are imported using the <code dir="auto">import type</code> syntax.</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/components/MyAstroComponent.astro</span></div>
<pre data-language="astro">---
import { type CollectionEntry, getEntry } from "astro:content";
---</pre>

</div> <p>While we recommend keeping it on and properly making your type imports with <code dir="auto">type</code> (as shown above), you can disable it by setting <code dir="auto">verbatimModuleSyntax: false</code> in your <code dir="auto">tsconfig.json</code> file if it causes any issues.</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">tsconfig.json</span></div>
<pre data-language="json">{
  "compilerOptions": {
    "verbatimModuleSyntax": false
  }
}</pre>

</div> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="changed-default-port-3000">Changed default: port <code dir="auto">3000</code>
</h3></div> <p>In Astro v2.x, Astro ran on port <code dir="auto">3000</code> by default.</p> <p>Astro v3.0 changes the <a href="../../../reference/cli-reference/index.html#--port-number">default port</a> to <code dir="auto">4321</code>. ðŸš€</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-17">What should I do?</h4></div> <p>Update any existing references to <code dir="auto">localhost:3000</code>, for example in tests or in your <code dir="auto">README</code>, to reflect the new port <code dir="auto">localhost:4321</code>.</p> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="changed-default-importmetaenvbase_url-trailingslash">Changed default: import.meta.env.BASE_URL <code dir="auto">trailingSlash</code>
</h3></div> <p>In Astro v2.x, <code dir="auto">import.meta.env.BASE_URL</code> appended your <a href="../../../reference/configuration-reference/index.html#base"><code dir="auto">base</code></a> setting with a <a href="../../../reference/configuration-reference/index.html#trailingslash">trailingSlash</a> by default. <code dir="auto">trailingSlash: "ignore"</code> also appended a trailing slash.</p> <p>Astro v3.0 no longer appends <code dir="auto">import.meta.env.BASE_URL</code> with a trailing slash by default, nor when <code dir="auto">trailingSlash: "ignore"</code> is set. (The existing behavior of <code dir="auto">base</code> in combination with <code dir="auto">trailingSlash: "always"</code> or <code dir="auto">trailingSlash: "never"</code> is unchanged.)</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-18">What should I do?</h4></div> <p>If your <code dir="auto">base</code> already has a trailing slash, no change is needed.</p> <p>If your <code dir="auto">base</code> does not have a trailing slash, add one if you wish to preserve the previous default (or <code dir="auto">trailingSlash: "ignore"</code>) behavior:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">astro.config.mjs</span></div>
<pre data-language="js">import { defineConfig } from "astro/config";


export default defineConfig({
  base: 'my-base',
  base: 'my-base/',
});</pre>

</div> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="changed-default-compresshtml">Changed default: <code dir="auto">compressHTML</code>
</h3></div> <p>In Astro v2.x, Astro only compressed your emitted HTML when <a href="../../../reference/configuration-reference/index.html#compresshtml"><code dir="auto">compressHTML</code></a> was explicitly set to <code dir="auto">true</code>. The default value was <code dir="auto">false</code>.</p> <p>Astro v3.0 now compresses emitted HTML by default.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-19">What should I do?</h4></div> <p>You can now remove <code dir="auto">compressHTML: true</code> from your configuration as this is the new default behavior.</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">astro.config.mjs</span></div>
<pre data-language="js">import { defineConfig } from "astro/config";


export default defineConfig({
  compressHTML: true
})</pre>

</div> <p>You must now set <code dir="auto">compressHTML: false</code> to opt out of HTML compression.</p> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="changed-default-scopedstylestrategy">Changed default: <code dir="auto">scopedStyleStrategy</code>
</h3></div> <p>In Astro v2.x, the default value of <a href="../../../reference/configuration-reference/index.html#scopedstylestrategy"><code dir="auto">scopedStyleStrategy</code></a> was <code dir="auto">"where"</code>.</p> <p>Astro v3.0 introduces a new, default value: <code dir="auto">"attribute"</code>. By default, styles are now applied using <code dir="auto">data-*</code> attributes.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-20">What should I do?</h4></div> <p>To retain your projectâ€™s current <a href="../../styling/index.html#scoped-styles">style scoping</a>, update the configuration file to the previous default value:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">astro.config.mjs</span></div>
<pre data-language="js">import { defineConfig } from "astro/config";


export default defineConfig({
  scopedStyleStrategy: "where"
})</pre>

</div> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="changed-default-inlinestylesheets">Changed default: <code dir="auto">inlineStyleSheets</code>
</h3></div> <p>In Astro v2.x, all project stylesheets were sent as link tags by default. You could opt in to inlining them into <code dir="auto">&lt;style&gt;</code> tags every time with <code dir="auto">"always"</code>, or to inlining only stylesheets below a certain size with <code dir="auto">"auto"</code> by setting the <a href="../../../reference/configuration-reference/index.html#buildinlinestylesheets"><code dir="auto">build.inlineStylesheets</code></a> configuration. The default setting was <code dir="auto">"never"</code>.</p> <p>Astro v3.0 changes the default value of <code dir="auto">inlineStylesheets</code> to <code dir="auto">"auto"</code>. Stylesheets smaller than <code dir="auto">ViteConfig.build.assetsInlineLimit</code> (default: 4kb) are inlined by default. Otherwise, project styles are sent in external stylesheets.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-21">What should I do?</h4></div> <p>If you want to keep your projectâ€™s current behavior, set <code dir="auto">build.inlineStylesheets</code> to the previous default, <code dir="auto">"never"</code>:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">astro.config.mjs</span></div>
<pre data-language="js">import { defineConfig } from "astro/config";


export default defineConfig({
   build: {
    inlineStylesheets: "never"
  }
})</pre>

</div> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="changed-default-image-service">Changed default: image service</h3></div> <p>In Astro v2.x, Squoosh was the <a href="../../images/index.html#default-image-service">default image processing service</a>.</p> <p>Astro v3.0 now includes Sharp as the default image processing service and instead provides a configuration option to use Squoosh.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-22">What should I do?</h4></div> <aside aria-label="Note" class="starlight-aside starlight-aside--note"><p class="starlight-aside__title" aria-hidden="true">Note</p>
<section class="starlight-aside__content"><p>When using a <a href="https://pnpm.io/pnpm-vs-npm#npms-flat-tree">strict package manager</a> like <code dir="auto">pnpm</code>, you may need to manually install Sharp into your project even though it is an Astro dependency:</p>
<div class="expressive-code">
<div class="_pre-heading">
<span class="sr-only">Terminal window</span>
</div>
<pre data-language="bash">pnpm add sharp</pre>

</div></section></aside> <p>If you would prefer to continue to use Squoosh to transform your images, update your config with the following:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">astro.config.mjs</span></div>
<pre data-language="ts">import { defineConfig, squooshImageService } from "astro/config";


export default defineConfig({
  image: {
    service: squooshImageService(),
  }
})</pre>

</div> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="changed-http-request-methods-case">Changed: HTTP request methods case</h3></div> <p>In Astro v2.x, <a href="../../endpoints/index.html#http-methods">HTTP request methods</a> were written using lowercase function names: <code dir="auto">get</code>, <code dir="auto">post</code>, <code dir="auto">put</code>, <code dir="auto">all</code>, and <code dir="auto">del</code>.</p> <p>Astro v3.0 uses uppercase function names, including <code dir="auto">DELETE</code> instead of <code dir="auto">del</code>.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-23">What should I do?</h4></div> <p>Rename all functions to their uppercase equivalent:</p> <ul> <li>
<code dir="auto">get</code> to <code dir="auto">GET</code>
</li> <li>
<code dir="auto">post</code> to <code dir="auto">POST</code>
</li> <li>
<code dir="auto">put</code> to <code dir="auto">PUT</code>
</li> <li>
<code dir="auto">all</code> to <code dir="auto">ALL</code>
</li> <li>
<code dir="auto">del</code> to <code dir="auto">DELETE</code>
</li> </ul> <div class="expressive-code">
<div class="_pre-heading"><span class="title">endpoint.ts</span></div>
<pre data-language="js">export function get() {
export function GET() {
    return new Response(JSON.stringify({ "title": "Bob's blog" }));
}</pre>

</div> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="changed-multiple-jsx-framework-configuration">Changed: Multiple JSX framework configuration</h3></div> <p>In Astro v2.x, you could use <a href="../../integrations-guide/index.html#official-integrations">multiple JSX framework integrations</a> (React, Solid, Preact) in the same project without needing to identify which files belonged to which framework.</p> <p>Astro v3.0 now requires you to specify which framework to use for your files with new <code dir="auto">include</code> and <code dir="auto">exclude</code> integration config options when you have multiple JSX framework integrations installed. This allows Astro to better support single-framework usage, as well as advanced features like React Fast Refresh.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-24">What should I do?</h4></div> <p>If you are using multiple JSX frameworks in the same project, set <code dir="auto">include</code> (and optionally <code dir="auto">exclude</code>) to an array of files and/or folders. Wildcards may be used to include multiple file paths.</p> <p>We recommend placing common framework components in the same folder (e.g. <code dir="auto">/components/react/</code> and <code dir="auto">/components/solid/</code>) to make specifying your includes easier, but this is not required:</p> <div class="expressive-code">

<pre data-language="js">import { defineConfig } from 'astro/config';
import preact from '@astrojs/preact';
import react from '@astrojs/react';
import svelte from '@astrojs/svelte';
import vue from '@astrojs/vue';
import solid from '@astrojs/solid-js';


export default defineConfig({
  // Enable many frameworks to support all different kinds of components.
  // No `include` is needed if you are only using a single framework!
  integrations: [
    preact({
      include: ['**/preact/*']
    }),
    react({
      include: ['**/react/*']
    }),
    solid({
      include: ['**/solid/*'],
    }),
  ]
});</pre>

</div> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="changed-astrocookiesgetkey-can-return-undefined">Changed: <code dir="auto">Astro.cookies.get(key)</code> can return <code dir="auto">undefined</code>
</h3></div> <p>In Astro v2.x, <a href="../../../reference/api-reference/index.html#astrocookies"><code dir="auto">Astro.cookies.get(key)</code></a> would always return an <a href="../../../reference/api-reference/index.html#astrocookie"><code dir="auto">AstroCookie</code> object</a>, even if the cookie did not exist. To check for its existence, you needed to use <code dir="auto">Astro.cookies.has(key)</code>.</p> <p>Astro v3.0 returns <code dir="auto">undefined</code> for <code dir="auto">Astro.cookies.get(key)</code> if the cookie does not exist.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-25">What should I do?</h4></div> <p>This change will not break any code that checks for the existence of the <code dir="auto">Astro.cookie</code> object before using <code dir="auto">Astro.cookies.get(key)</code>, but is now no longer required.</p> <p>You can safely remove any code that uses <code dir="auto">has()</code> to check if the value of <code dir="auto">Astro.cookies</code> is <code dir="auto">undefined</code>:</p> <div class="expressive-code">

<pre data-language="js">if (Astro.cookies.has(id)) {
  const id = Astro.cookies.get(id)!;
}


const id = Astro.cookies.get(id);
if (id) {
}</pre>

</div> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="changed-running-the-astro-cli-programmatically">Changed: running the Astro CLI programmatically</h3></div> <p>In Astro v2.x, the <code dir="auto">"astro"</code> package entrypoint exported and ran the Astro CLI directly. It is not recommended to run Astro this way in practice.</p> <p>Astro v3.0 removes the CLI from the entrypoint, and exports a new set of experimental JavaScript APIs, including <code dir="auto">dev()</code>, <code dir="auto">build()</code>, <code dir="auto">preview()</code>, and <code dir="auto">sync()</code>.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-26">What should I do?</h4></div> <p>To <a href="../../../reference/cli-reference/index.html#advanced-apis-experimental">run the Astro CLI programmatically</a>, use the new experimental JavaScript APIs:</p> <div class="expressive-code">

<pre data-language="js">import { dev, build } from "astro";


// Start the Astro dev server
const devServer = await dev();
await devServer.stop();


// Build your Astro project
await build();</pre>

</div> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="changed-internal-astro-api-entry-point-export-paths">Changed: internal Astro API entry point export paths</h3></div> <p>In Astro v2.x, you could import internal Astro APIs from <code dir="auto">astro/internal/*</code> and <code dir="auto">astro/runtime/server/*</code>.</p> <p>Astro v3.0 removes the two entry points in favor of the existing <code dir="auto">astro/runtime/*</code> entrypoint. Additionally, a new <code dir="auto">astro/compiler-runtime</code> export has been added for compiler-specific runtime code.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-27">What should I do?</h4></div> <p>These are entry points for Astroâ€™s internal API and should not affect your project. But if you do use these entrypoints, update as shown below:</p> <div class="expressive-code">

<pre data-language="js">import 'astro/internal/index.js';
import 'astro/runtime/server/index.js';


import 'astro/server/index.js';
import 'astro/runtime/server/index.js';</pre>

</div> <div class="expressive-code">

<pre data-language="js">import { transform } from '@astrojs/compiler';


const result = await transform(source, {
  internalURL: 'astro/runtime/server/index.js',
  internalURL: 'astro/compiler-runtime',
  // ...
});</pre>

</div> <div tabindex="-1" class="heading-wrapper level-h2"><h2 id="feature-upgrades">Feature Upgrades</h2></div> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="upgrade-images-to-v3">Upgrade images to v3</h3></div> <p><code dir="auto">astro:assets</code> is no longer behind an experimental flag in Astro v3.0.</p> <p><code dir="auto">&lt;Image /&gt;</code> is now a built-in component and the previous <code dir="auto">@astrojs/image</code> integration has been removed.</p> <p>These and other accompanying changes to using images in Astro may cause some breaking changes when you upgrade your Astro project from an earlier version.</p> <p>Please follow the instructions below as appropriate to upgrade an Astro v2.x project to v3.0.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="upgrade-from-experimentalassets">Upgrade from <code dir="auto">experimental.assets</code>
</h4></div> <p>If you had previously enabled the experimental flag for <code dir="auto">astro:assets</code>, you will need to update your project for Astro v3.0 which now includes assets features by default.</p> <div tabindex="-1" class="heading-wrapper level-h5"><h5 id="remove-experimentalassets-flag">Remove <code dir="auto">experimental.assets</code> flag</h5></div> <p>Remove the experimental flag:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">astro.config.mjs</span></div>
<pre data-language="js">import { defineConfig } from 'astro/config';


export default defineConfig({
  experimental: {
    assets: true
  }
});</pre>

</div> <p>If necessary, also update your <code dir="auto">src/env.d.ts</code> file to replace the <code dir="auto">astro/client-image</code> reference with <code dir="auto">astro/client</code>:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/env.d.ts</span></div>
<pre data-language="ts">/// &lt;reference types="astro/client-image" /&gt;
/// &lt;reference types="astro/client" /&gt;</pre>

</div> <div tabindex="-1" class="heading-wrapper level-h5"><h5 id="remove-the-assets-import-alias">Remove the <code dir="auto">~/assets</code> import alias</h5></div> <p>This import alias is no longer included by default with <code dir="auto">astro:assets</code>. If you were using this alias with experimental assets, you must convert them to relative file paths, or <a href="../../imports/index.html#aliases">create your own import aliases</a>.</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/pages/posts/post-1.astro</span></div>
<pre data-language="astro">---
import rocket from '~/assets/rocket.png';
import rocket from '../../assets/rocket.png';
---</pre>

</div> <div tabindex="-1" class="heading-wrapper level-h5"><h5 id="add-simple-asset-support-for-cloudflare-deno-vercel-edge-and-netlify-edge">Add simple asset support for Cloudflare, Deno, Vercel Edge and Netlify Edge</h5></div> <p>Astro v3.0 allows <code dir="auto">astro:assets</code> to work without errors in Cloudflare, Deno, Vercel Edge and Netlify Edge, which do not support Astroâ€™s built-in Squoosh and Sharp image optimization. Note that Astro does not perform any image transformation and processing in these environments. However, you can still enjoy the other benefits of using <code dir="auto">astro:assets</code>, including no Cumulative Layout Shift (CLS), the enforced <code dir="auto">alt</code> attribute, and a consistent authoring experience.</p> <p>If you previously avoided using <code dir="auto">astro:assets</code> because of these constraints, you can now use them without issues. You can configure the no-op image service to explicitly opt-in to this behavior:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">astro.config.mjs</span></div>
<pre data-language="js">import { defineConfig } from 'astro/config';


export default defineConfig({
  image: {
    service: {
      entrypoint: 'astro/assets/services/noop'
    }
  }
});</pre>

</div> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="decide-where-to-store-your-images">Decide where to store your images</h4></div> <p>See the Images guide to help you decide <a href="../../images/index.html#where-to-store-images">where to store your images</a>. You may wish to take advantage of new options for storing your images with the added flexibility <code dir="auto">astro:assets</code> brings. For example, relative images from your project <code dir="auto">src/</code> can now be referenced in Markdown, MDX, and Markdoc using standard Markdown <code dir="auto">![alt](src)</code> syntax.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="update-existing-img-tags">Update existing <code dir="auto">&lt;img&gt;</code> tags</h4></div> <p>Previously, importing an image would return a simple <code dir="auto">string</code> with the path of the image. Now, imported image assets match the following signature:</p> <div class="expressive-code">

<pre data-language="ts">interface ImageMetadata {
  src: string;
  width: number;
  height: number;
  format: string;
}</pre>

</div> <p>You must update the <code dir="auto">src</code> attribute of any existing <code dir="auto">&lt;img&gt;</code> tags (including any <a href="../../images/index.html#images-in-ui-framework-components">images in UI framework components</a>) and you may also update other attributes that are now available to you from the imported image.</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/components/MyComponent.astro</span></div>
<pre data-language="astro">---
import rocket from '../images/rocket.svg';
---
&lt;img src={rocket} width="250" height="250" alt="A rocketship in space." /&gt;


&lt;img src={rocket.src} width={rocket.width} height={rocket.height} alt="A rocketship in space." /&gt;</pre>

</div> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="update-your-markdown-mdx-and-markdoc-files">Update your Markdown, MDX, and Markdoc files</h4></div> <p>Relative images from your project <code dir="auto">src/</code> can now be referenced in Markdown, MDX, and Markdoc using standard Markdown <code dir="auto">![alt](src)</code> syntax.</p> <p>This allows you to move your images from the <code dir="auto">public/</code> directory to your project <code dir="auto">src/</code> where they will now be processed and optimized. Your existing images in <code dir="auto">public/</code> and remote images are still valid but are not optimized by Astroâ€™s build process.</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/pages/posts/post-1.md</span></div>
<pre data-language="md"># My Markdown Page


&lt;!-- Local images now possible! --&gt;
![A starry night sky.](../../images/stars.png)


&lt;!-- Keep your images next to your content! --&gt;
![A starry night sky.](./stars.png)</pre>

</div> <p>If you require more control over your image attributes, we recommend using the <code dir="auto">.mdx</code> file format, which allows you to include Astroâ€™s <code dir="auto">&lt;Image /&gt;</code> component or a JSX <code dir="auto">&lt;img /&gt;</code> tag in addition to the Markdown syntax. Use the <a href="../../integrations-guide/mdx/index.html">MDX integration</a> to add support for MDX to Astro.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="remove-astrojsimage">Remove <code dir="auto">@astrojs/image</code>
</h4></div> <p>If you were using the image integration in Astro v2.x, complete the following steps:</p> <ol role="list" class="sl-steps"> <li> <p>Remove the <code dir="auto">@astrojs/image</code> integration.</p> <p>You must <a href="../../integrations-guide/index.html#removing-an-integration">remove the integration</a> by uninstalling and then removing it from your <code dir="auto">astro.config.mjs</code> file.</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">astro.config.mjs</span></div>
<pre data-language="js">import { defineConfig } from 'astro/config';
import image from '@astrojs/image';


export default defineConfig({
  integrations: [
    image(),
  ]
})</pre>

</div> </li> <li> <p>Update types (if required).</p> <p>If you had special types configured for <code dir="auto">@astrojs/image</code> in <code dir="auto">src/env.d.ts</code>, you may need to change them back to the default Astro types if your upgrade to v3 did not complete this step for you.</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/env.d.ts</span></div>
<pre data-language="ts"> /// &lt;reference types="@astrojs/image/client" /&gt;
 /// &lt;reference types="astro/client" /&gt;</pre>

</div> <p>Similarly, update <code dir="auto">tsconfig.json</code> if necessary:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">tsconfig.json</span></div>
<pre data-language="json">{
  "compilerOptions": {
    "types": ["@astrojs/image/client"]
    "types": ["astro/client"]
  }
}</pre>

</div> </li> <li> <p>Migrate any existing <code dir="auto">&lt;Image /&gt;</code> components.</p> <p>Change all <code dir="auto">import</code> statements from <code dir="auto">@astrojs/image/components</code> to <code dir="auto">astro:assets</code> in order to use the new built-in <code dir="auto">&lt;Image /&gt;</code> component.</p> <p>Remove any component attributes that are not <a href="../../images/index.html#properties">currently supported image asset properties</a>.</p> <p>For example, <code dir="auto">aspectRatio</code> is no longer supported, as it is now automatically inferred from the <code dir="auto">width</code> and <code dir="auto">height</code> attributes.</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/components/MyComponent.astro</span></div>
<pre data-language="astro">---
import { Image } from '@astrojs/image/components';
import { Image } from 'astro:assets';
import localImage from '../assets/logo.png';
const localAlt = 'The Astro Logo';
---


&lt;Image
  src={localImage}
  width={300}
  aspectRatio="16:9"
  alt={localAlt}
/&gt;</pre>

</div> </li> <li> <p>Choose a default image service.</p> <p><a href="https://github.com/lovell/sharp">Sharp</a> is now the default image service used for <code dir="auto">astro:assets</code>. If you would like to use Sharp, no configuration is required.</p> <p>If you would prefer to use <a href="https://github.com/GoogleChromeLabs/squoosh">Squoosh</a> to transform your images, update your config with the following <code dir="auto">image.service</code> option:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">astro.config.mjs</span></div>
<pre data-language="js">import { defineConfig, squooshImageService } from 'astro/config';


export default defineConfig({
  image: {
    service: squooshImageService(),
  },
});</pre>

</div> </li> </ol> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="update-content-collections-schemas">Update Content Collections schemas</h4></div> <p>You can now declare an associated image for a content collections entry, such as a blog postâ€™s cover image, in your frontmatter using its path relative to the current folder.</p> <p>The new <code dir="auto">image</code> helper for content collections lets you validate the image metadata using Zod. Learn more about <a href="../../images/index.html#images-in-content-collections">how to use images in content collections</a></p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="navigating-image-imports-in-astro-v30">Navigating Image Imports in Astro v3.0</h4></div> <p>In Astro v3.0, if you have to preserve the old import behavior for images and require a string representation of the imageâ€™s URL, append <code dir="auto">?url</code> to the end of your image path when importing it. For example:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/pages/blog/MyImages.astro</span></div>
<pre data-language="astro">---
import Sprite from '../assets/logo.svg?url';
---


&lt;svg&gt;
  &lt;use xlink:href={Sprite + '#cart'} /&gt;
&lt;/svg&gt;</pre>

</div> <p>This approach ensures you obtain the URL string. Keep in mind that during development, Astro uses a <code dir="auto">src/</code> path, but upon building, it generates hashed paths like <code dir="auto">/_astro/cat.a6737dd3.png</code>.</p> <p>If you prefer to work directly with the image object itself, you can access the <code dir="auto">.src</code> property. This approach is best for tasks like managing image dimensions for Core Web Vitals metrics and preventing CLS.</p> <p>If you are transitioning into the new import behavior, combining <code dir="auto">?url</code> and <code dir="auto">.src</code> methods might be the right method for seamless image handling.</p> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="upgrade-view-transitions-to-v3">Upgrade view transitions to v3</h3></div> <p>View transitions are no longer behind an experimental flag in Astro v3.0.</p> <p>If you had <strong>not</strong> enabled this experimental flag in Astro 2.x, this will not cause any breaking changes to your project. The new View Transitions API has no effect on your existing code.</p> <p>If you were previously using experimental view transitions, there may be some breaking changes when you upgrade your Astro project from an earlier version.</p> <p>Please follow the instructions below as appropriate to upgrade <strong>an Astro v2.x project configured with <code dir="auto">experimental.viewTransitions: true</code></strong> to v3.0.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="upgrade-from-experimentalviewtransitions">Upgrade from <code dir="auto">experimental.viewTransitions</code>
</h4></div> <p>If you had previously enabled the experimental flag for view transitions, you will need to update your project for Astro v3.0 which now allows view transitions by default.</p> <div tabindex="-1" class="heading-wrapper level-h5"><h5 id="remove-experimentalviewtransitions-flag">Remove <code dir="auto">experimental.viewTransitions</code> flag</h5></div> <p>Remove the experimental flag:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">astro.config.mjs</span></div>
<pre data-language="js">import { defineConfig } from 'astro/config';


export default defineConfig({
  experimental: {
   viewTransitions: true
  }
});</pre>

</div> <div tabindex="-1" class="heading-wrapper level-h5"><h5 id="update-import-source">Update import source</h5></div> <p>The <code dir="auto">&lt;ViewTransitions /&gt;</code> component has been moved from <code dir="auto">astro:components</code> to <code dir="auto">astro:transitions</code>. Update the import source across all occurrences in your project.</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/layouts/BaseLayout.astro</span></div>
<pre data-language="astro">---
import { ViewTransitions } from "astro:components astro:transitions"
---
&lt;html lang="en"&gt;
  &lt;head&gt;
    &lt;title&gt;My Homepage&lt;/title&gt;
    &lt;ViewTransitions /&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;Welcome to my website!&lt;/h1&gt;
  &lt;/body&gt;
&lt;/html&gt;</pre>

</div> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="update-transitionanimate-directives">Update <code dir="auto">transition:animate</code> directives</h4></div> <p><strong>Changed:</strong> The <code dir="auto">transition:animate</code> value <code dir="auto">morph</code> has been renamed to <code dir="auto">initial</code>. Also, this is no longer the default animation. If no <code dir="auto">transition:animate</code> directive is specified, your animations will now default to <code dir="auto">fade</code>.</p> <ol> <li> <p>Rename any <code dir="auto">morph</code> animations to <code dir="auto">initial</code>.</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/components/MyComponent.astro</span></div>
<pre data-language="astro">&lt;div transition:name="name" transition:animate="morph initial" /&gt;</pre>

</div> </li> <li> <p>To keep any animations that were previously using <code dir="auto">morph</code> by default, explicitly add <code dir="auto">transition:animate="initial"</code></p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/components/MyComponent.astro</span></div>
<pre data-language="astro">&lt;div transition:name="name" transition:animate="initial" /&gt;</pre>

</div> </li> <li> <p>You can safely remove any animations explicitly set to <code dir="auto">fade</code>. This is now the default behavior:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/components/MyComponent.astro</span></div>
<pre data-language="astro">&lt;div transition:name="name" transition:animate="fade" /&gt;</pre>

</div> </li> </ol> <p><strong>Added:</strong> Astro also supports a new <code dir="auto">transition:animate</code> value, <code dir="auto">none</code>. This value can be used on a pageâ€™s <code dir="auto">&lt;html&gt;</code> element to disable animated full-page transitions on an entire page. This will only override <strong>default animation behavior</strong> on page elements without an animation directive. You can still set animations on individual elements, and these specific animations will occur.</p> <ol start="4"> <li> <p>You may now disable all default transitions on an individual page, animating only elements that explicitly use a <code dir="auto">transition:animate</code> directive:</p> <div class="expressive-code">

<pre data-language="astro">&lt;html transition:animate="none"&gt;
  &lt;head&gt;&lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;Hello world!&lt;/h1&gt;
  &lt;/body&gt;
&lt;/html&gt;</pre>

</div> </li> </ol> <div tabindex="-1" class="heading-wrapper level-h5"><h5 id="update-event-names">Update event names</h5></div> <p>The event <code dir="auto">astro:load</code> has been renamed to <code dir="auto">astro:page-load</code>. Rename all occurrences in your project.</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/components/MyComponent.astro</span></div>
<pre data-language="astro">&lt;script&gt;
document.addEventListener('astro:load astro:page-load', runSetupLogic);
&lt;/script&gt;</pre>

</div> <p>The event <code dir="auto">astro:beforeload</code> has been renamed to <code dir="auto">astro:after-swap</code>. Rename all occurrences in your project.</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/components/MyComponent.astro</span></div>
<pre data-language="astro">&lt;script&gt;
document.addEventListener('astro:beforeload astro:after-swap', setDarkMode);
&lt;/script&gt;</pre>

</div> <div tabindex="-1" class="heading-wrapper level-h2"><h2 id="community-resources">Community Resources</h2></div> <p>Know a good resource for Astro v3.0? <a href="https://github.com/withastro/docs/edit/main/src/content/docs/en/guides/upgrade-to/v3.mdx">Edit this page</a> and add a link below!</p> <div tabindex="-1" class="heading-wrapper level-h2"><h2 id="known-issues">Known Issues</h2></div> <p>There are currently no known issues.</p> <span id="docsearch-lvl0" hidden class="astro-klj6ju3r">Upgrade Guides</span> </div>   </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2021 Fred K. Schott<br>Licensed under the MIT License.<br>
    <a href="https://docs.astro.build/en/guides/upgrade-to/v3/" class="_attribution-link">https://docs.astro.build/en/guides/upgrade-to/v3/</a>
  </p>
</div>
