<h1 class="content-title astro-j75b3yus" id="overview">Upgrade to Astro v3</h1> <p>This guide will help you migrate from Astro v2 to Astro v3.</p> <p>Need to upgrade an older project to v2? See our <a href="../v2/index.html">older migration guide</a>.</p> <div tabindex="-1" class="heading-wrapper level-h2"><h2 id="upgrade-astro">Upgrade Astro</h2></div> <p>Update your projectâ€™s version of Astro to the latest version using your package manager. If youâ€™re using Astro integrations, please also update those to the latest version.</p> <astro-island uid="1x4inP" component-url="/_astro/Tabs.3d721b18.js" component-export="default" renderer-url="/_astro/client.d87097da.js" props='{"sharedStore":[0,"package-managers"]}' ssr="" client="idle" opts='{"name":"Tabs","value":true}' await-children=""><div class="_container_1kkny_1">
<div class="_tab-scroll-overflow_1kkny_6"><div class="_tablist_1kkny_30 TabGroup no-flex" role="tablist">
<button aria-selected="true" tabindex="0" role="tab" type="button" class="_tab_1kkny_6" id="152-tab.npm"><astro-slot name="tab.npm">npm</astro-slot></button><button aria-selected="false" tabindex="-1" role="tab" type="button" class="_tab_1kkny_6" id="152-tab.pnpm"><astro-slot name="tab.pnpm">pnpm</astro-slot></button><button aria-selected="false" tabindex="-1" role="tab" type="button" class="_tab_1kkny_6" id="152-tab.yarn"><astro-slot name="tab.yarn">Yarn</astro-slot></button>
</div></div>
<div role="tabpanel" aria-labelledby="152-tab.npm" class="_tabpanel_1kkny_26"><astro-slot name="panel.npm"> <div class="expressive-code ec ec-s1gwf">
<div class="_pre-heading">
<span class="sr-only">Terminal window</span>
</div>


</div> </astro-slot></div>
<div hidden role="tabpanel" aria-labelledby="152-tab.pnpm" class="_tabpanel_1kkny_26"><astro-slot name="panel.pnpm"> <div class="expressive-code ec ec-s1gwf">
<div class="_pre-heading">
<span class="sr-only">Terminal window</span>
</div>


</div> </astro-slot></div>
<div hidden role="tabpanel" aria-labelledby="152-tab.yarn" class="_tabpanel_1kkny_26"><astro-slot name="panel.yarn"> <div class="expressive-code ec ec-s1gwf">
<div class="_pre-heading">
<span class="sr-only">Terminal window</span>
</div>


</div> </astro-slot></div>
</div></astro-island> <aside class="content note astro-duqfclob" aria-label="Need to continue?"> <p class="title astro-duqfclob" aria-hidden="true">  Need to continue? </p> <section class="astro-duqfclob"> <p>After upgrading Astro to the latest version, you may not need to make any changes to your project at all!</p>
<p>But, if you notice errors or unexpected behavior, please check below for what has changed that might need updating in your project.</p> </section> </aside> <div tabindex="-1" class="heading-wrapper level-h2"><h2 id="astro-v30-experimental-flags-removed">Astro v3.0 Experimental Flags Removed</h2></div> <p>Remove the following experimental flags from <code>astro.config.mjs</code>:</p> <div class="expressive-code ec ec-s1gwf">
<div class="_pre-heading"><span class="title">astro.config.mjs</span></div>


</div> <p>These features are now available by default:</p> <ul> <li>View Transitions for animated page transitions and persistent islands. See <a href="../../view-transitions/index.html#upgrade-to-v30-from-v2x">view transitions API breaking changes and upgrading advice</a> if you were using this experimental flag.</li> <li>A new image services API <code>astro:assets</code> for using images in Astro, including a new <code>&lt;Image /&gt;</code> component and <code>getImage()</code> function. Please read the detailed <a href="../../images/index.html#upgrade-to-v30-from-v2x">image upgrade advice</a> <strong>whether or not you were using this experimental flag</strong> to see how this might affect your project.</li> </ul> <p>Read more about these two exciting features and more in <a href="https://astro.build/blog/astro-3/">the 3.0 Blog post</a>!</p> <div tabindex="-1" class="heading-wrapper level-h2"><h2 id="astro-v30-breaking-changes">Astro v3.0 Breaking Changes</h2></div> <p>Astro v3.0 includes some breaking changes, as well as the removal of some previously deprecated features. If your project doesnâ€™t work as expected after upgrading to v3.0, check this guide for an overview of all breaking changes and instructions on how to update your codebase.</p> <p>See <a href="https://github.com/withastro/astro/blob/main/packages/astro/CHANGELOG.md">the changelog</a> for full release notes.</p> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="removed-support-for-node-16">Removed: Support for Node 16</h3></div> <p>Node 16 is scheduled to reach its End of Life in September 2023.</p> <p>Astro v3.0 drops Node 16 support entirely so that all Astro users can take advantage of Nodeâ€™s more modern features.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do">What should I do?</h4></div> <p>Check that both your development environment and your deployment environment are using <strong>Node <code>18.14.1</code> or higher</strong>.</p> <ol> <li> <p>Check your local version of Node using:</p> <div class="expressive-code ec ec-s1gwf">
<div class="_pre-heading">
<span class="sr-only">Terminal window</span>
</div>


</div> </li> <li> <p>Check your <a href="../../deploy/index.html">deployment environmentâ€™s</a> own documentation to verify that they support Node 18.</p> <p>You can specify Node <code>18.14.1</code> for your Astro project either in a dashboard configuration setting or a <code>.nvmrc</code> file.</p> </li> </ol> <div class="expressive-code ec ec-s1gwf">
<div class="_pre-heading"><span class="title">.nvmrc</span></div>


</div> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="removed-support-for-typescript-4">Removed: Support for TypeScript 4</h3></div> <p>In Astro v2.x, the <code>tsconfig.json</code> presets include support for both TypeScript 4.x and 5.x.</p> <p>Astro v3.0 updates the <code>tsconfig.json</code> presets to only support TypeScript 5.x. Astro now assumes that you use TypeScript 5.0 (March 2023), or that your editor includes it (e.g. VS Code 1.77).</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-1">What should I do?</h4></div> <p>If you have installed TypeScript locally, update to at least v5.0.</p> <div class="expressive-code ec ec-s1gwf">
<div class="_pre-heading">
<span class="sr-only">Terminal window</span>
</div>


</div> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="removed-astrojsimage">Removed: <code>@astrojs/image</code>
</h3></div> <p>In Astro v2.x, Astro offered an official image integration that included Astro <code>&lt;Image /&gt;</code> and <code>&lt;Picture /&gt;</code> components.</p> <p>Astro v3.0 removes this integration from the codebase entirely. Astroâ€™s new solution for images is a built-in image services API: <code>astro:assets</code>.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-2">What should I do?</h4></div> <p>Remove the <code>@astrojs/image</code> integration from your project. You will need to not only uninstall the integration but also update or remove any import statements and existing <code>&lt;Image /&gt;</code> and <code>&lt;Picture /&gt;</code> components. You might also need to configure a preferred default image processing service.</p> <p>You will find <a href="../../images/index.html#remove-astrojsimage">complete, step-by-step instructions for removing the old image integration</a> in our Images guide.</p> <p>Migrating to <code>astro:assets</code> will also bring some new image options and features that you may now wish to use. Please see the full <a href="../../images/index.html#upgrade-to-v30-from-v2x">v3.0 Image Upgrade Advice</a> for full details!</p> <div class="expressive-code ec ec-s1gwf">
<div class="_pre-heading"><span class="title">astro.config.mjs</span></div>


</div> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="removed-markdown--component">Removed: <code>&lt;Markdown /&gt;</code> component</h3></div> <p>In Astro v1.x, Astro deprecated the <code>&lt;Markdown /&gt;</code> component and moved it to an external package.</p> <p>Astro v3.0 completely removes the package <code>@astrojs/markdown-component</code>. Astroâ€™s <code>&lt;Markdown /&gt;</code> component will no longer work in your project.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-3">What should I do?</h4></div> <p>Remove all instances of the <code>@astrojs/markdown-component</code>.</p> <div class="expressive-code ec ec-s1gwf">
<div class="_pre-heading"><span class="title">src/components/MyAstroComponent.astro</span></div>


</div> <p>To continue using a similar <code>&lt;Markdown /&gt;</code> component in your code, consider using <a href="https://astro.build/integrations/">community integrations</a> such as <a href="https://github.com/natemoo-re/astro-remote"><code>astro-remote</code></a>. Be sure to update your <code>&lt;Markdown /&gt;</code> component imports and attributes as necessary, according to the integrationâ€™s own documentation.</p> <p>Otherwise, delete all references to importing Astroâ€™s <code>&lt;Markdown /&gt;</code> component and the component itself in your <code>.astro</code> files. You will need to rewrite your content as HTML directly or <a href="../../markdown-content/index.html#importing-markdown">import Markdown</a> from a <code>.md</code> file.</p> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="removed-deprecated-1x-apis">Removed: deprecated 1.x APIs</h3></div> <p>In Astro v1.x, Astro deprecated our original configuration settings as well as <code>&lt;style global&gt;</code> and <code>&lt;script hoist&gt;</code> support. However, these were still supported for backwards compatibility.</p> <p>Astro v3.0 removes these deprecated APIs entirely. The officially supported <a href="../../../reference/configuration-reference/index.html">configuration settings</a> and modern <code>&lt;style is:global&gt;</code> and <code>&lt;script&gt;</code> syntax should be used instead.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-4">What should I do?</h4></div> <p>If you are continuing to use v1.x APIs, use the new APIs for each feature instead:</p> <ul> <li>Deprecated config options: See <a href="../v1/index.html#new-configuration-api">the 0.26 migration guide</a>
</li> <li>Deprecated script/style attribute types: See <a href="../v1/index.html#new-default-script-behavior">the 0.26 migration guide</a>
</li> </ul> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="removed-partial-shims-for-web-apis-in-server-code">Removed: Partial shims for Web APIs in server code</h3></div> <p>In Astro v2.x, Astro provided partial shims for Web APIs such as <code>document</code> or <code>localStorage</code> in server-rendered code. These shims were often incomplete and unreliable.</p> <p>Astro v3.0 removes these partial shims entirely. Web APIs are no longer available in server-rendered code.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-5">What should I do?</h4></div> <p>If you are using Web APIs in server-rendered components, you will need to either make the usage of those APIs conditional or use <a href="../../../reference/directives-reference/index.html#clientonly">the <code>client:only</code> client directive</a>.</p> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="removed-image-from-astrocontent-in-content-collections-schema">Removed: <code>image</code> from <code>astro:content</code> in content collections schema</h3></div> <p>In Astro v2.x, the content collections API deprecated an <code>image</code> export from <code>astro:content</code> for use in your content collections schemas.</p> <p>Astro v3.0 removes this export entirely.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-6">What should I do?</h4></div> <p>If you are using the deprecated <code>image()</code> from <code>astro:content</code>, remove it as this no longer exists. Validate images through <a href="../../images/index.html#update-content-collections-schemas">the <code>image</code> helper from <code>schema</code></a> instead:</p> <div class="expressive-code ec ec-s1gwf">
<div class="_pre-heading"><span class="title">src/content/config.ts</span></div>


</div> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="removed-pre-014-shiki-theme-names">Removed: pre-0.14 Shiki theme names</h3></div> <p>In Astro v2.x, some Shiki theme names had been renamed, but the original names were kept for backwards compatibility.</p> <p>Astro v3.0 removes the original names in favor of the renamed theme names.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-7">What should I do?</h4></div> <p>If your project uses any of the themes below, rename them to their updated name:</p> <ul> <li>
<code>material-darker</code> -&gt; <code>material-theme-darker</code>
</li> <li>
<code>material-default</code> -&gt; <code>material-theme</code>
</li> <li>
<code>material-lighter</code> -&gt; <code>material-theme-lighter</code>
</li> <li>
<code>material-ocean</code> -&gt; <code>material-theme-ocean</code>
</li> <li>
<code>material-palenight</code> -&gt; <code>material-theme-palenight</code>
</li> </ul> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="removed-classlist-features">Removed: <code>class:list</code> features</h3></div> <p>In Astro v2.x, the <a href="../../../reference/directives-reference/index.html#classlist"><code>class:list</code> directive</a> used a custom implementation inspired by <a href="https://github.com/lukeed/clsx"><code>clsx</code></a> with a few extra features like deduplication and <code>Set</code> support.</p> <p>Astro v3.0 now uses <code>clsx</code> directly for <code>class:list</code>, which does not support deduplication or <code>Set</code> values.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-8">What should I do?</h4></div> <p>Replace any <code>Set</code> elements passed to the <code>class:list</code> directive with a plain <code>Array</code>.</p> <div class="expressive-code ec ec-s1gwf">
<div class="_pre-heading"><span class="title">src/components/MyAstroComponent.astro</span></div>


</div> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="removed-passing-classlist-as-a-prop">Removed: passing <code>class:list</code> as a prop</h3></div> <p>In Astro v2.x, <a href="../../../reference/directives-reference/index.html#classlist"><code>class:list</code> values</a> were sent to components via <a href="../../../reference/api-reference/index.html#astroprops"><code>Astro.props['class:list']</code></a>.</p> <p>Astro v3.0 normalizes <code>class:list</code> values into a string before being sent to components via <code>Astro.props['class']</code></p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-9">What should I do?</h4></div> <p>Remove any code that expects to receive the <code>class:list</code> prop.</p> <div class="expressive-code ec ec-s1gwf">
<div class="_pre-heading"><span class="title">src/components/MyAstroComponent.astro</span></div>


</div> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="removed-kebab-case-transform-for-camelcase-css-variables">Removed: kebab-case transform for camelCase CSS variables</h3></div> <p>In Astro v2.x, camelCase <a href="../../styling/index.html#css-variables">CSS variables</a> passed to the <code>style</code> attribute were rendered as both camelCase (as written) and kebab-case (kept for backwards compatibility).</p> <p>Astro v3.0 removes the kebab-case transform for these camelCase CSS variable names, and only the original camelCase CSS variable is rendered.</p> <div class="expressive-code ec ec-s1gwf">
<div class="_pre-heading"><span class="title">src/components/MyAstroComponent.astro</span></div>


</div> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-10">What should I do?</h4></div> <p>If you were relying on Astro to transform kebab-case in your styles, update your existing styles to camelCase to prevent missing styles. For example:</p> <div class="expressive-code ec ec-s1gwf">
<div class="_pre-heading"><span class="title">src/components/MyAstroComponent.astro</span></div>


</div> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="removed-automatic-flattening-of-getstaticpathss-return-value">Removed: automatic flattening of <code>getStaticPaths()</code>â€™s return value</h3></div> <p>In Astro v2.x, the return value of <a href="../../../reference/api-reference/index.html#getstaticpaths"><code>getStaticPaths()</code></a> was automatically flattened to allow you to return an array of arrays without errors.</p> <p>Astro v3.0 removes automatic flattening of <code>getStaticPaths()</code>â€™s result.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-11">What should I do?</h4></div> <p>If youâ€™re returning an array of arrays instead of an array of <em>objects</em> (as is expected), <code>.flatMap</code> and <code>.flat</code> should now be used to ensure that you are returning a flat array.</p> <p>An <a href="../../../reference/errors/invalid-get-static-paths-entry/index.html#what-went-wrong">error message indicating that <code>getStaticPath()</code>â€™s return value must be an array of objects</a> will be provided if you need to update your code.</p> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="moved-astro-check-now-requires-an-external-package">Moved: <code>astro check</code> now requires an external package</h3></div> <p>In Astro v2.x, <a href="../../../reference/cli-reference/index.html#astro-check"><code>astro check</code></a> was included in Astro by default, and its dependencies were bundled in Astro. This meant a larger package whether or not you ever used <code>astro check</code>. This also prevented you from having control over the version of TypeScript and the Astro Language Server to use.</p> <p>Astro v3.0 moves the <code>astro check</code> command out of Astro core and now requires an external package <code>@astrojs/check</code>. Additionally, you must install <code>typescript</code> in your project to use the <code>astro check</code> command.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-12">What should I do?</h4></div> <p>Run the <code>astro check</code> command after upgrading to Astro v3.0 and follow the prompts to install the required dependencies, or manually install <code>@astrojs/check</code> and <code>typescript</code> into your project.</p> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="deprecated-buildexcludemiddleware-and-buildsplit">Deprecated: <code>build.excludeMiddleware</code> and <code>build.split</code>
</h3></div> <p>In Astro v2.x, <code>build.excludeMiddleware</code> and <code>build.split</code> were used to change how specific files were emitted when using an adapter in SSR mode.</p> <p>Astro v3.0 replaces these build config options with new <a href="../../integrations-guide/index.html#official-integrations">SSR adapter configuration options</a> to perform the same tasks: <code>edgeMiddleware</code> and <code>functionPerRoute</code>.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-13">What should I do?</h4></div> <p>Update the Astro config file to now use the new options <strong>in the adapter configuration</strong> directly.</p> <div class="expressive-code ec ec-s1gwf">
<div class="_pre-heading"><span class="title">astro.config.mjs</span></div>


</div> <div class="expressive-code ec ec-s1gwf">
<div class="_pre-heading"><span class="title">astro.config.mjs</span></div>


</div> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="deprecated-markdowndrafts">Deprecated: <code>markdown.drafts</code>
</h3></div> <p>In Astro v2.x, the <code>markdown.drafts</code> configuration allowed you to have draft pages that were available in when running the dev server, but not built in production.</p> <p>Astro v3.0 deprecates this feature in favor of the content collections method of handling draft pages by filtering manually instead, which gives more control over the feature.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-14">What should I do?</h4></div> <p>To continue to mark some pages in your project as drafts, <a href="../../content-collections/index.html#migrating-from-file-based-routing">migrate to content collections</a> and <a href="../../content-collections/index.html#filtering-collection-queries">manually filter out pages</a> with the <code>draft: true</code> frontmatter property instead.</p> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="deprecated-returning-simple-object-in-endpoints">Deprecated: returning simple object in endpoints</h3></div> <p>In Astro v2.x, endpoints could return a simple object, which would be converted to a JSON response.</p> <p>Astro v3.0 deprecates this behavior in favor of returning a <code>Response</code> object directly.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-15">What should I do?</h4></div> <p>Update your endpoints to return a <code>Response</code> object directly.</p> <div class="expressive-code ec ec-s1gwf">
<div class="_pre-heading"><span class="title">endpoint.json.ts</span></div>


</div> <p>If you really need to keep the previous format, you can use the <code>ResponseWithEncoding</code> object but will be deprecated in the future.</p> <div class="expressive-code ec ec-s1gwf">
<div class="_pre-heading"><span class="title">endpoint.json.ts</span></div>


</div> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="changed-default-verbatimmodulesyntax-in-tsconfigjson-presets">Changed default: <code>verbatimModuleSyntax</code> in tsconfig.json presets</h3></div> <p>In Astro v2.x, the <a href="https://www.typescriptlang.org/tsconfig#verbatimModuleSyntax"><code>verbatimModuleSyntax</code></a> setting was off by default, with its TypeScript 4.x equivalent <code>importsNotUsedAsValues</code> being enabled in the <code>strict</code> preset.</p> <p>In Astro v3.0, <code>verbatimModuleSyntax</code> is enabled in every preset.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-16">What should I do?</h4></div> <p>This option requires that types are imported using the <code>import type</code> syntax.</p> <div class="expressive-code ec ec-s1gwf">
<div class="_pre-heading"><span class="title">src/components/MyAstroComponent.astro</span></div>


</div> <p>While we recommend keeping it on and properly making your type imports with <code>type</code> (as shown above), you can disable it by setting <code>verbatimModuleSyntax: false</code> in your <code>tsconfig.json</code> file if it causes any issues.</p> <div class="expressive-code ec ec-s1gwf">
<div class="_pre-heading"><span class="title">tsconfig.json</span></div>


</div> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="changed-default-port-3000">Changed default: port <code>3000</code>
</h3></div> <p>In Astro v2.x, Astro ran on port <code>3000</code> by default.</p> <p>Astro v3.0 changes the <a href="../../../reference/cli-reference/index.html#--port-number">default port</a> to <code>4321</code>. ðŸš€</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-17">What should I do?</h4></div> <p>Update any existing references to <code>localhost:3000</code>, for example in tests or in your <code>README</code>, to reflect the new port <code>localhost:4321</code>.</p> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="changed-default-importmetaenvbase_url-trailingslash">Changed default: import.meta.env.BASE_URL <code>trailingSlash</code>
</h3></div> <p>In Astro v2.x, <code>import.meta.env.BASE_URL</code> appended your <a href="../../../reference/configuration-reference/index.html#base"><code>base</code></a> setting with a <a href="../../../reference/configuration-reference/index.html#trailingslash">trailingSlash</a> by default. <code>trailingSlash: "ignore"</code> also appended a trailing slash.</p> <p>Astro v3.0 no longer appends <code>import.meta.env.BASE_URL</code> with a trailing slash by default, nor when <code>trailingSlash: "ignore"</code> is set. (The existing behavior of <code>base</code> in combination with <code>trailingSlash: "always"</code> or <code>trailingSlash: "never"</code> is unchanged.)</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-18">What should I do?</h4></div> <p>If your <code>base</code> already has a trailing slash, no change is needed.</p> <p>If your <code>base</code> does not have a trailing slash, add one if you wish to preserve the previous default (or <code>trailingSlash: "ignore"</code>) behavior:</p> <div class="expressive-code ec ec-s1gwf">
<div class="_pre-heading"><span class="title">astro.config.mjs</span></div>


</div> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="changed-default-compresshtml">Changed default: <code>compressHTML</code>
</h3></div> <p>In Astro v2.x, Astro only compressed your emitted HTML when <a href="../../../reference/configuration-reference/index.html#compresshtml"><code>compressHTML</code></a> was explicitly set to <code>true</code>. The default value was <code>false</code>.</p> <p>Astro v3.0 now compresses emitted HTML by default.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-19">What should I do?</h4></div> <p>You can now remove <code>compressHTML: true</code> from your configuration as this is the new default behavior.</p> <div class="expressive-code ec ec-s1gwf">
<div class="_pre-heading"><span class="title">astro.config.mjs</span></div>


</div> <p>You must now set <code>compressHTML: false</code> to opt out of HTML compression.</p> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="changed-default-scopedstylestrategy">Changed default: <code>scopedStyleStrategy</code>
</h3></div> <p>In Astro v2.x, the default value of <a href="../../../reference/configuration-reference/index.html#scopedstylestrategy"><code>scopedStyleStrategy</code></a> was <code>"where"</code>.</p> <p>Astro v3.0 introduces a new, default value: <code>"attribute"</code>. By default, styles are now applied using <code>data-*</code> attributes.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-20">What should I do?</h4></div> <p>To retain your projectâ€™s current <a href="../../styling/index.html#scoped-styles">style scoping</a>, update the configuration file to the previous default value:</p> <div class="expressive-code ec ec-s1gwf">
<div class="_pre-heading"><span class="title">astro.config.mjs</span></div>


</div> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="changed-default-inlinestylesheets">Changed default: <code>inlineStyleSheets</code>
</h3></div> <p>In Astro v2.x, all project stylesheets were sent as link tags by default. You could opt in to inlining them into <code>&lt;style&gt;</code> tags every time with <code>"always"</code>, or to inlining only stylesheets below a certain size with <code>"auto"</code> by setting the <a href="../../../reference/configuration-reference/index.html#buildinlinestylesheets"><code>build.inlineStylesheets</code></a> configuration. The default setting was <code>"never"</code>.</p> <p>Astro v3.0 changes the default value of <code>inlineStylesheets</code> to <code>"auto"</code>. Stylesheets smaller than <code>ViteConfig.build.assetsInlineLimit</code> (default: 4kb) are inlined by default. Otherwise, project styles are sent in external stylesheets.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-21">What should I do?</h4></div> <p>If you want to keep your projectâ€™s current behavior, set <code>build.inlineStylesheets</code> to the previous default, <code>"never"</code>:</p> <div class="expressive-code ec ec-s1gwf">
<div class="_pre-heading"><span class="title">astro.config.mjs</span></div>


</div> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="changed-default-image-service">Changed default: image service</h3></div> <p>In Astro v2.x, Squoosh was the <a href="../../images/index.html#default-image-service">default image processing service</a>.</p> <p>Astro v3.0 now includes Sharp as the default image processing service and instead provides a configuration option to use Squoosh.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-22">What should I do?</h4></div> <aside class="content note astro-duqfclob" aria-label="Note"> <p class="title astro-duqfclob" aria-hidden="true">  Note </p> <section class="astro-duqfclob"> <p>When using a <a href="https://pnpm.io/pnpm-vs-npm#npms-flat-tree">strict package manager</a> like <code>pnpm</code>, you may need to manually install Sharp into your project even though it is an Astro dependency:</p>
<div class="expressive-code ec ec-s1gwf">
<div class="_pre-heading">
<span class="sr-only">Terminal window</span>
</div>


</div> </section> </aside> <p>If you would prefer to continue to use Squoosh to transform your images, update your config with the following:</p> <div class="expressive-code ec ec-s1gwf">
<div class="_pre-heading"><span class="title">astro.config.mjs</span></div>


</div> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="changed-http-request-methods-case">Changed: HTTP request methods case</h3></div> <p>In Astro v2.x, <a href="../../../core-concepts/endpoints/index.html#http-methods">HTTP request methods</a> were written using lowercase function names: <code>get</code>, <code>post</code>, <code>put</code>, <code>all</code>, and <code>del</code>.</p> <p>Astro v3.0 uses uppercase function names, including <code>DELETE</code> instead of <code>del</code>.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-23">What should I do?</h4></div> <p>Rename all functions to their uppercase equivalent:</p> <ul> <li>
<code>get</code> to <code>GET</code>
</li> <li>
<code>post</code> to <code>POST</code>
</li> <li>
<code>put</code> to <code>PUT</code>
</li> <li>
<code>all</code> to <code>ALL</code>
</li> <li>
<code>del</code> to <code>DELETE</code>
</li> </ul> <div class="expressive-code ec ec-s1gwf">
<div class="_pre-heading"><span class="title">endpoint.ts</span></div>


</div> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="changed-multiple-jsx-framework-configuration">Changed: Multiple JSX framework configuration</h3></div> <p>In Astro v2.x, you could use <a href="../../integrations-guide/index.html#official-integrations">multiple JSX framework integrations</a> (React, Solid, Preact) in the same project without needing to identify which files belonged to which framework.</p> <p>Astro v3.0 now requires you to specify which framework to use for your files with new <code>include</code> and <code>exclude</code> integration config options when you have multiple JSX framework integrations installed. This allows Astro to better support single-framework usage, as well as advanced features like React Fast Refresh.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-24">What should I do?</h4></div> <p>If you are using multiple JSX frameworks in the same project, set <code>include</code> (and optionally <code>exclude</code>) to an array of files and/or folders. Wildcards may be used to include multiple file paths.</p> <p>We recommend placing common framework components in the same folder (e.g. <code>/components/react/</code> and <code>/components/solid/</code>) to make specifying your includes easier, but this is not required:</p>  <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="changed-astrocookiesgetkey-can-return-undefined">Changed: <code>Astro.cookies.get(key)</code> can return <code>undefined</code>
</h3></div> <p>In Astro v2.x, <a href="../../../reference/api-reference/index.html#astrocookies"><code>Astro.cookies.get(key)</code></a> would always return an <a href="../../../reference/api-reference/index.html#astrocookie"><code>AstroCookie</code> object</a>, even if the cookie did not exist. To check for its existence, you needed to use <code>Astro.cookies.has(key)</code>.</p> <p>Astro v3.0 returns <code>undefined</code> for <code>Astro.cookies.get(key)</code> if the cookie does not exist.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-25">What should I do?</h4></div> <p>This change will not break any code that checks for the existence of the <code>Astro.cookie</code> object before using <code>Astro.cookies.get(key)</code>, but is now no longer required.</p> <p>You can safely remove any code that uses <code>has()</code> to check if the value of <code>Astro.cookies</code> is <code>undefined</code>:</p>  <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="changed-running-the-astro-cli-programmatically">Changed: running the Astro CLI programmatically</h3></div> <p>In Astro v2.x, the <code>"astro"</code> package entrypoint exported and ran the Astro CLI directly. It is not recommended to run Astro this way in practice.</p> <p>Astro v3.0 removes the CLI from the entrypoint, and exports a new set of experimental JavaScript APIs, including <code>dev()</code>, <code>build()</code>, <code>preview()</code>, and <code>sync()</code>.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-26">What should I do?</h4></div> <p>To <a href="../../../reference/cli-reference/index.html#advanced-apis-experimental">run the Astro CLI programatically</a>, use the new experimental JavaScript APIs:</p>  <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="changed-internal-astro-api-entry-point-export-paths">Changed: internal Astro API entry point export paths</h3></div> <p>In Astro v2.x, you could import internal Astro APIs from <code>astro/internal/*</code> and <code>astro/runtime/server/*</code>.</p> <p>Astro v3.0 removes the two entry points in favor of the existing <code>astro/runtime/*</code> entrypoint. Additionally, a new <code>astro/compiler-runtime</code> export has been added for compiler-specific runtime code.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-27">What should I do?</h4></div> <p>These are entry points for Astroâ€™s internal API and should not affect your project. But if you do use these entrypoints, update as shown below:</p>   <div tabindex="-1" class="heading-wrapper level-h2"><h2 id="community-resources">Community Resources</h2></div> <p>Know a good resource for Astro v3.0? <a href="https://github.com/withastro/docs/edit/main/src/content/docs/en/guides/upgrade-to/v3.mdx">Edit this page</a> and add a link below!</p> <div tabindex="-1" class="heading-wrapper level-h2"><h2 id="known-issues">Known Issues</h2></div> <p>There are currently no known issues.</p><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2021 Fred K. Schott<br>Licensed under the MIT License.<br>
    <a href="https://docs.astro.build/en/guides/upgrade-to/v3/" class="_attribution-link">https://docs.astro.build/en/guides/upgrade-to/v3/</a>
  </p>
</div>
