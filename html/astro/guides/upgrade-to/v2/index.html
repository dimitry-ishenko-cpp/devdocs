<h1 id="_top" class="astro-556cgime">Upgrade to Astro v2</h1> <div class="content-panel astro-ayt3hsza"> <div class="sl-container astro-ayt3hsza"> <div class="sl-markdown-content astro-klj6ju3r"> <p>This guide will help you migrate from Astro v1 to Astro v2.</p> <p>Need to upgrade an older project to v1? See our <a href="../v1/index.html">older migration guide</a>.</p> <div tabindex="-1" class="heading-wrapper level-h2"><h2 id="upgrade-astro">Upgrade Astro</h2></div> <p>Update your project’s version of Astro to the latest version using your package manager. If you’re using Astro integrations, please also update those to the latest version.</p> <starlight-tabs data-sync-key="package-managers" class="astro-tx2opqu5"> <div class="tablist-wrapper not-content astro-tx2opqu5"> <ul role="tablist" class="astro-tx2opqu5"> <li role="presentation" class="tab astro-tx2opqu5"> <a role="tab" href="#tab-panel-486" id="tab-486" aria-selected="true" tabindex="0" class="astro-tx2opqu5"> npm </a> </li>
<li role="presentation" class="tab astro-tx2opqu5"> <a role="tab" href="#tab-panel-487" id="tab-487" aria-selected="false" tabindex="-1" class="astro-tx2opqu5"> pnpm </a> </li>
<li role="presentation" class="tab astro-tx2opqu5"> <a role="tab" href="#tab-panel-488" id="tab-488" aria-selected="false" tabindex="-1" class="astro-tx2opqu5"> Yarn </a> </li> </ul> </div> <section id="tab-panel-486" aria-labelledby="tab-486" role="tabpanel"> <div class="expressive-code">
<div class="_pre-heading">
<span class="sr-only">Terminal window</span>
</div>
<pre data-language="shell"># Upgrade to Astro v2.x
npm install astro@latest


# Example: upgrade React and Tailwind integrations
npm install @astrojs/react@latest @astrojs/tailwind@latest</pre>

</div> </section> <section id="tab-panel-487" aria-labelledby="tab-487" role="tabpanel" hidden> <div class="expressive-code">
<div class="_pre-heading">
<span class="sr-only">Terminal window</span>
</div>
<pre data-language="shell"># Upgrade to Astro v2.x
pnpm add astro@latest


# Example: upgrade React and Tailwind integrations
pnpm add @astrojs/react@latest @astrojs/tailwind@latest</pre>

</div> </section> <section id="tab-panel-488" aria-labelledby="tab-488" role="tabpanel" hidden> <div class="expressive-code">
<div class="_pre-heading">
<span class="sr-only">Terminal window</span>
</div>
<pre data-language="shell"># Upgrade to Astro v2.x
yarn add astro@latest


# Example: upgrade React and Tailwind integrations
yarn add @astrojs/react@latest @astrojs/tailwind@latest</pre>

</div> </section> </starlight-tabs>  <div tabindex="-1" class="heading-wrapper level-h2"><h2 id="astro-v20-breaking-changes">Astro v2.0 Breaking Changes</h2></div> <p>Astro v2.0 includes some breaking changes, as well as the removal of some previously deprecated features. If your project doesn’t work as expected after upgrading to v2.0, check this guide for an overview of all breaking changes and instructions on how to update your codebase.</p> <p>See <a href="https://github.com/withastro/astro/blob/main/packages/astro/CHANGELOG.md">the changelog</a> for full release notes.</p> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="removed-support-for-node-14">Removed: Support for Node 14</h3></div> <p>Node 14 is scheduled to reach its End of Life in April 2023.</p> <p>Astro v2.0 drops Node 14 support entirely, so that all Astro users can take advantage of Node’s more modern features.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do">What should I do?</h4></div> <p>Check that both your development environment and your deployment environment are using <strong>Node <code dir="auto">16.12.0</code> or later</strong>.</p> <ol role="list" class="sl-steps"> <li> <p>Check your local version of Node using:</p> <div class="expressive-code">
<div class="_pre-heading">
<span class="sr-only">Terminal window</span>
</div>
<pre data-language="sh">node -v</pre>

</div> <p>If your local development environment needs upgrading, <a href="https://nodejs.org/en/download/">install Node</a>.</p> </li> <li> <p>Check your <a href="../../deploy/index.html">deployment environment’s</a> own documentation to verify that they support Node 16.</p> <p>You can specify Node <code dir="auto">16.12.0</code> for your Astro project either in a dashboard configuration setting, or a <code dir="auto">.nvmrc</code> file.</p> </li> </ol> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="reserved-srccontent">Reserved: <code dir="auto">src/content/</code>
</h3></div> <p>Astro v2.0 now includes the Collections API for organizing your Markdown and MDX files into <a href="../../content-collections/index.html">content collections</a>. This API reserves <code dir="auto">src/content/</code> as a special folder.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-1">What should I do?</h4></div> <p>Rename an existing <code dir="auto">src/content/</code> folder to avoid conflicts. This folder, if it exists, can now only be used for <a href="../../content-collections/index.html">content collections</a>.</p> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="changed-astrosite-trailing-slash">Changed: <code dir="auto">Astro.site</code> trailing slash</h3></div> <p>In v1.x, Astro ensured the URL you set as <code dir="auto">site</code> in <code dir="auto">astro.config.mjs</code> always had a trailing slash when accessed using <code dir="auto">Astro.site</code>.</p> <p>Astro v2.0 no longer modifies the value of <code dir="auto">site</code>. <code dir="auto">Astro.site</code> will use the exact value defined, and a trailing slash must be specified if desired.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-2">What should I do?</h4></div> <p>In <code dir="auto">astro.config.mjs</code>, add a trailing slash to the URL set in <code dir="auto">site</code>.</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">astro.config.mjs</span></div>
<pre data-language="js">import { defineConfig } from 'astro/config';


export default defineConfig({
  site: 'https://example.com',
  site: 'https://example.com/',
});</pre>

</div> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="changed-_astro-folder-for-build-assets">Changed: <code dir="auto">_astro/</code> folder for build assets</h3></div> <p>In v1.x, assets were built to various locations, including <code dir="auto">assets/</code>, <code dir="auto">chunks/</code>, and to the root of the build output.</p> <p>Astro v2.0 moves and unifies the location of all build output assets to a new <code dir="auto">_astro/</code> folder.</p> <starlight-file-tree class="not-content astro-amtfieur" data-pagefind-ignore><ul><li class="directory"><details open><summary><span class="tree-entry"><span class=""><span><span class="sr-only">Directory</span></span>dist/ </span></span></summary><ul><li class="directory"><details open><summary><span class="tree-entry"><span class=""><span><span class="sr-only">Directory</span></span>_astro </span></span></summary><ul>
<li class="file"><span class="tree-entry"><span class="">client.9218e799.js</span></span></li>
<li class="file"><span class="tree-entry"><span class="">index.df3f880e0.css</span></span></li>
</ul></details></li></ul></details></li></ul></starlight-file-tree> <p>You can control this location with the <a href="../../../reference/configuration-reference/index.html#buildassets">new <code dir="auto">build.assets</code> configuration option</a>.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-3">What should I do?</h4></div> <p>Update your deployment platform configuration if it relies on the location of these assets.</p> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="changed-markdown-plugin-configuration">Changed: Markdown plugin configuration</h3></div> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="removed-extenddefaultplugins">Removed: <code dir="auto">extendDefaultPlugins</code>
</h4></div> <p>In v1.x, Astro used <code dir="auto">markdown.extendDefaultPlugins</code> to re-enable Astro’s default plugins when adding your own Markdown plugins.</p> <p>Astro v2.0 removes this configuration option entirely because its behavior is now the default.</p> <p>Applying remark and rehype plugins in your Markdown configuration <strong>no longer disables Astro’s default plugins</strong>. GitHub-Flavored Markdown and Smartypants are now applied whether or not custom <code dir="auto">remarkPlugins</code> or <code dir="auto">rehypePlugins</code> are configured.</p> <div tabindex="-1" class="heading-wrapper level-h5"><h5 id="what-should-i-do-4">What should I do?</h5></div> <p>Remove <code dir="auto">extendDefaultPlugins</code> in your configuration. This is now Astro’s default behavior in v2.0, and you can delete this line without any replacement.</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">astro.config.mjs</span></div>
<pre data-language="js">import { defineConfig } from 'astro/config';


export default defineConfig({
  markdown: {
    extendDefaultPlugins,
  }
});</pre>

</div> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="added-gfm-and-smartypants">Added: <code dir="auto">gfm</code> and <code dir="auto">smartypants</code>
</h4></div> <p>In v1.x, you could choose to disable both of Astro’s default Markdown plugins (GitHub-Flavored Markdown and SmartyPants) by setting <code dir="auto">markdown.extendDefaultPlugins: false</code>.</p> <p>Astro v2.0 replaces <code dir="auto">markdown.extendDefaultPlugins: false</code> with separate Boolean options to individually control each of Astro’s built-in default Markdown plugins. These are enabled by default and can be set to <code dir="auto">false</code> independently.</p> <div tabindex="-1" class="heading-wrapper level-h5"><h5 id="what-should-i-do-5">What should I do?</h5></div> <p>Remove <code dir="auto">extendDefaultPlugins: false</code> and add the flags to disable each plugin individually instead.</p> <ul> <li>
<code dir="auto">markdown.gfm: false</code> disables GitHub-Flavored Markdown</li> <li>
<code dir="auto">markdown.smartypants: false</code> disables SmartyPants</li> </ul> <div class="expressive-code">
<div class="_pre-heading"><span class="title">astro.config.mjs</span></div>
<pre data-language="js">import { defineConfig } from 'astro/config';


export default defineConfig({
  markdown: {
    extendDefaultPlugins: false,
    smartypants: false,
    gfm: false,
  }
});</pre>

</div> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="changed-mdx-plugin-configuration">Changed: MDX plugin configuration</h3></div> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="replaced-extendplugins-changed-to-extendmarkdownconfig">Replaced: <code dir="auto">extendPlugins</code> changed to <code dir="auto">extendMarkdownConfig</code>
</h4></div> <p>In v1.x, the MDX integration’s <code dir="auto">extendPlugins</code> option managed how your MDX files should inherit your Markdown configuration: all your Markdown configuration (<code dir="auto">markdown</code>), or Astro’s default plugins only (<code dir="auto">default</code>).</p> <p>Astro v2.0 replaces the behavior controlled by <code dir="auto">mdx.extendPlugins</code> with three new, independently-configurable options that are <code dir="auto">true</code> by default:</p> <ul> <li>
<strong><a href="../../integrations-guide/mdx/index.html#extendmarkdownconfig"><code dir="auto">mdx.extendMarkdownConfig</code></a></strong> to inherit all or none of your Markdown configuration</li> <li>
<strong><code dir="auto">mdx.gfm</code></strong> to enable or disable GitHub-Flavored Markdown in MDX</li> <li>
<strong><code dir="auto">mdx.smartypants</code></strong> to enable or disable SmartyPants in MDX</li> </ul> <div tabindex="-1" class="heading-wrapper level-h5"><h5 id="what-should-i-do-6">What should I do?</h5></div> <p>Delete <code dir="auto">extendPlugins: 'markdown'</code> in your configuration. This is now the default behavior.</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">astro.config.mjs</span></div>
<pre data-language="js">import { defineConfig } from 'astro/config';
import mdx from '@astrojs/mdx';


export default defineConfig({
  integrations: [
    mdx({
      extendPlugins: 'markdown',
    }),
  ],
});</pre>

</div> <p>Replace <code dir="auto">extendPlugins: 'defaults'</code> with <code dir="auto">extendMarkdownConfig: false</code> and add the separate options for GitHub-Flavored Markdown and SmartyPants to enable these default plugins individually in MDX.</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">astro.config.mjs</span></div>
<pre data-language="js">import { defineConfig } from 'astro/config';
import mdx from '@astrojs/mdx';


export default defineConfig({
  integrations: [
    mdx({
      extendPlugins: 'defaults',
      extendMarkdownConfig: false,
      smartypants: true,
      gfm: true,
    }),
  ],
});</pre>

</div> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="added-more-mdx-config-options-to-match-markdown">Added: More MDX config options to match Markdown</h4></div> <p>Astro v2.0 allows you to now individually set <a href="../../../reference/configuration-reference/index.html#markdown-options">every available Markdown configuration option</a> (except <code dir="auto">drafts</code>) separately in your MDX integration configuration.</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">astro.config.mjs</span></div>
<pre data-language="js">import { defineConfig } from 'astro/config';
import mdx from '@astrojs/mdx';


export default defineConfig({
  markdown: {
    remarkPlugins: [remarkPlugin1],
    gfm: true,
  },
  integrations: [
    mdx({
      remarkPlugins: [remarkPlugin2],
      gfm: false,
    })
  ]
});</pre>

</div> <div tabindex="-1" class="heading-wrapper level-h5"><h5 id="what-should-i-do-7">What should I do?</h5></div> <p>Revisit your Markdown and MDX configuration and compare your existing config with the new options available.</p> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="changed-plugin-access-to-frontmatter">Changed: Plugin access to frontmatter</h3></div> <p>In v1.x, remark and rehype plugins did not have access to user frontmatter. Astro merged plugin frontmatter with your file’s frontmatter, without passing the file frontmatter to your plugins.</p> <p>Astro v2.0 gives remark and rehype plugins access to user frontmatter via frontmatter injection. This allows plugin authors to modify a user’s existing frontmatter, or compute new properties based on other properties.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-8">What should I do?</h4></div> <p>Check any remark and rehype plugins you have written to see whether their behavior has changed. Note that <code dir="auto">data.astro.frontmatter</code> is now the <em>complete</em> Markdown or MDX document’s frontmatter, rather than an empty object.</p> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="changed-rss-configuration">Changed: RSS Configuration</h3></div> <p>In v1.x, Astro’s RSS package allowed you to use <code dir="auto">items: import.meta.glob(...)</code> to generate a list of RSS feed items. This usage is now deprecated and will eventually be removed.</p> <p>Astro v2.0 introduces a <code dir="auto">pagesGlobToRssItems()</code> wrapper to the <code dir="auto">items</code> property.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-9">What should I do?</h4></div> <p>Import, then wrap your existing function containing <code dir="auto">import.meta.glob()</code> with the <code dir="auto">pagesGlobToRssItems()</code> helper.</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/pages/rss.xml.js</span></div>
<pre data-language="js">import rss, {
  pagesGlobToRssItems
} from '@astrojs/rss';


export async function get(context) {
  return rss({
    items: await pagesGlobToRssItems(
      import.meta.glob('./blog/*.{md,mdx}'),
    ),
  });
}</pre>

</div> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="changed-svelte-ide-support">Changed: Svelte IDE support</h3></div> <p>Astro v2.0 requires a <code dir="auto">svelte.config.js</code> file in your project if you are using <a href="../../integrations-guide/svelte/index.html">the <code dir="auto">@astrojs/svelte</code> integration</a>. This is needed to provide IDE autocompletion.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-10">What should I do?</h4></div> <p>Add a <code dir="auto">svelte.config.js</code> file to the root of your project:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">svelte.config.js</span></div>
<pre data-language="js">import { vitePreprocess } from '@astrojs/svelte';


export default {
  preprocess: vitePreprocess(),
};</pre>

</div> <p>For new users, this file will be added automatically when running <code dir="auto">astro add svelte</code>.</p> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="removed-legacyastroflavoredmarkdown">Removed: <code dir="auto">legacy.astroFlavoredMarkdown</code>
</h3></div> <p>In v1.0, Astro moved the old Astro-Flavored Markdown (also known as Components in Markdown) to a legacy feature.</p> <p>Astro v2.0 removes the <code dir="auto">legacy.astroFlavoredMarkdown</code> option completely. Importing and using components in <code dir="auto">.md</code> files will no longer work.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-11">What should I do?</h4></div> <p>Remove this legacy flag. It is no longer available in Astro.</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">astro.config.mjs</span></div>
<pre data-language="js">export default defineConfig({
  legacy: {
    astroFlavoredMarkdown: true,
  },
})</pre>

</div> <p>If you were using this feature in v1.x, we recommend <a href="../../integrations-guide/mdx/index.html">using the MDX integration</a> which allows you to combine components and JSX expressions with Markdown syntax.</p> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="removed-astroresolve">Removed: <code dir="auto">Astro.resolve()</code>
</h3></div> <p>In v0.24, Astro deprecated <code dir="auto">Astro.resolve()</code> for getting resolved URLs to assets that you might want to reference in the browser.</p> <p>Astro v2.0 removes this option entirely. <code dir="auto">Astro.resolve()</code> in your code will cause an error.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-12">What should I do?</h4></div> <p>Resolve asset paths using <code dir="auto">import</code> instead. For example:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/pages/index.astro</span></div>
<pre data-language="astro">---
import 'style.css';
import imageUrl from './image.png';
---


&lt;img src={imageUrl} /&gt;</pre>

</div> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="removed-astrofetchcontent">Removed: <code dir="auto">Astro.fetchContent()</code>
</h3></div> <p>In v0.26, Astro deprecated <code dir="auto">Astro.fetchContent()</code> for fetching data from your local Markdown files.</p> <p>Astro v2.0 removes this option entirely. <code dir="auto">Astro.fetchContent()</code> in your code will cause an error.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-13">What should I do?</h4></div> <p>Use <a href="../../imports/index.html#astroglob"><code dir="auto">Astro.glob()</code></a> to fetch Markdown files, or convert to the <a href="../../content-collections/index.html">Content Collections</a> feature.</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/pages/index.astro</span></div>
<pre data-language="astro">---
const allPosts = await Astro.glob('./posts/*.md');
---</pre>

</div> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="removed-astrocanonicalurl">Removed: <code dir="auto">Astro.canonicalURL</code>
</h3></div> <p>In v1.0, Astro deprecated <code dir="auto">Astro.canonicalURL</code> for constructing a canonical URL.</p> <p>Astro v2.0 removes this option entirely. <code dir="auto">Astro.canonicalURL</code> in your code will cause an error.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-14">What should I do?</h4></div> <p>Use <code dir="auto">Astro.url</code> to construct a canonical URL.</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/pages/index.astro</span></div>
<pre data-language="astro">---
const canonicalURL = new URL(Astro.url.pathname, Astro.site);
---</pre>

</div> <div tabindex="-1" class="heading-wrapper level-h3"><h3 id="updated-vite-4">Updated: Vite 4</h3></div> <p>Astro v2.0 upgrades from Vite 3 to <a href="https://vitejs.dev/">Vite 4</a>, released in December 2022.</p> <div tabindex="-1" class="heading-wrapper level-h4"><h4 id="what-should-i-do-15">What should I do?</h4></div> <p>There should be no changes to your code necessary! We’ve handled most of the upgrade for you inside of Astro; however, some subtle Vite behaviors may still change between versions.</p> <p>Refer to the official <a href="https://vitejs.dev/guide/migration.html">Vite Migration Guide</a> if you run into trouble.</p> <div tabindex="-1" class="heading-wrapper level-h2"><h2 id="astro-v20-experimental-flags-removed">Astro v2.0 Experimental Flags Removed</h2></div> <p>Remove the following experimental flags from <code dir="auto">astro.config.mjs</code>:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">astro.config.mjs</span></div>
<pre data-language="js">import { defineConfig } from 'astro/config';


export default defineConfig({
  experimental: {
    contentCollections: true,
    prerender: true,
    errorOverlay: true,
  },
})</pre>

</div> <p>These features are now available by default:</p> <ul> <li>
<a href="../../content-collections/index.html">Content collections</a> as a way to manage your Markdown and MDX files with type-safety.</li> <li>
<a href="../../server-side-rendering/index.html">Prerendering individual pages to static HTML</a> when using SSR to improve speed and cacheability.</li> <li>A redesigned error message overlay.</li> </ul> <div tabindex="-1" class="heading-wrapper level-h2"><h2 id="known-issues">Known Issues</h2></div> <p>There are currently no known issues.</p> <span id="docsearch-lvl0" hidden class="astro-klj6ju3r">Upgrade Guides</span> </div>   </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2021 Fred K. Schott<br>Licensed under the MIT License.<br>
    <a href="https://docs.astro.build/en/guides/upgrade-to/v2/" class="_attribution-link">https://docs.astro.build/en/guides/upgrade-to/v2/</a>
  </p>
</div>
