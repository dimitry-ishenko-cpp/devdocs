<h1>Using Encryption and Compression Tools With Mariabackup</h1> <div> <div class="node creole"> <div class="answer formatted"> <p> <a href="../backup-restore-and-import-clients-mariadb-backup/index.html">Mariabackup</a> supports streaming to stdout with the <code>--stream=xbstream</code> option. This option allows easy integration with popular encryption and compression tools. Below are several examples.</p> <h2 class="anchored_heading" id="encrypting-and-decrypting-backup-with-openssl">Encrypting and Decrypting Backup With openssl</h2> <p>The following example creates an AES-encrypted backup, protected with the password "mypass" and stores it in a file "backup.xb.enc": <br><br><br></p> <pre class="fixed wrap" data-language="sql">mariabackup --user=root --backup --stream=xbstream  | openssl  enc -aes-256-cbc -k mypass &gt; backup.xb.enc
</pre>
<p>To decrypt and unpack this backup into the current directory, the following command can be used:</p> <pre class="fixed" data-language="sql">openssl  enc -d -aes-256-cbc -k mypass -in backup.xb.enc | mbstream -x
</pre>
<h2 class="anchored_heading" id="compressing-and-decompressing-backup-with-gzip">Compressing and Decompressing Backup With gzip</h2> <p>This example compresses the backup without encrypting:</p> <pre class="fixed" data-language="sql">mariabackup --user=root --backup --stream=xbstream | gzip &gt; backupstream.gz
</pre>
<p>We can decompress and unpack the backup as follows:</p> <pre class="fixed" data-language="sql">gunzip -c backupstream.gz | mbstream -x
</pre>
<h2 class="anchored_heading" id="compressing-and-encrypting-backup-using-gzip-and-openssl">Compressing and Encrypting Backup, Using gzip and openssl</h2> <p>This example adds a compression step before the encryption, otherwise looks almost identical to the previous example:</p> <pre class="fixed wrap" data-language="sql">mariabackup --user=root --backup --stream=xbstream | gzip | openssl  enc -aes-256-cbc -k mypass &gt; backup.xb.gz.enc
</pre>
<p>We can decrypt, decompress and unpack the backup as follow (note <code>gzip -d</code> in the pipeline):</p> <pre class="fixed" data-language="sql">openssl  enc -d -aes-256-cbc -k mypass -in backup.xb.gz.enc |gzip -d| mbstream -x
</pre>
<h2 class="anchored_heading" id="compressing-and-encrypting-with-7zip">Compressing and Encrypting with 7Zip</h2> <p>7zip archiver is a popular utility (especially on Windows) that supports reading from standard output, with the -<code>-si</code> option, and writing to stdout with the <code>-so</code> option, and can thus be used together with Mariabackup.</p> <p>Compressing backup with the 7z command line utility works as follows:</p> <pre class="fixed" data-language="sql">mariabackup --user=root --backup --stream=xbstream | 7z a -si backup.xb.7z
</pre>
<p>Uncompress and unpack the archive with </p> <pre class="fixed" data-language="sql">7z e backup.xb.7z -so |mbstream -x
</pre>
<p>7z also has builtin AES-256 encryption. To encrypt the backup from the previous example using password SECRET, add <code>-pSECRET</code> to the 7z command line.</p> <h2 class="anchored_heading" id="encrypting-with-gpg">Encrypting With GPG</h2> <p>Encryption</p> <pre class="fixed wrap" data-language="sql">mariabackup --user=root --backup --stream=xbstream | gpg -c --passphrase SECRET --batch --yes -o backup.xb.gpg
</pre>
<p>Decrypt, unpack</p> <pre class="fixed" data-language="sql">gpg --decrypt --passphrase SECRET --batch --yes  backup.xb.gpg | mbstream -x
</pre>
<h2 class="anchored_heading" id="interactive-input-for-passphrases">Interactive Input for Passphrases</h2> <p>Most of the described tools also provide a way to enter a passphrase interactively (although 7zip does not seem to work well when reading input from stdin). Please consult documentation of the tools for more info.</p> <h2 class="anchored_heading" id="writing-extra-status-files">Writing extra status files</h2> <p>By default files like <code><a href="../files-created-by-mariabackup/index.html#xtrabackup_checkpoints">xtrabackup_checkpoints</a></code> are also written to the output stream only, and so would not be available for taking further incremental backups without prior extraction from the compressed or encrypted stream output file.</p> <p>To avoid this these files can additionally be written to a directory that can then be used as input for further incremental backups using the <code><a href="../mariabackup-options/index.html#-extra-lsndir">--extra-lsndir=...</a></code> option.</p> <p>See also e.g: <a href="../incremental-backup-and-restore-with-mariabackup/index.html#combining-with-stream-output">Combining incremental backups with streaming output</a></p> </div>     </div> <div id="content_disclaimer" class="graybox"> Content reproduced on this site is the property of its respective owners, and this content is not reviewed in advance by MariaDB. The views, information and opinions expressed by this content do not necessarily represent those of MariaDB or any other party. </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2023 MariaDB<br>Licensed under the Creative Commons Attribution 3.0 Unported License and the GNU Free Documentation License.<br>
    <a href="https://mariadb.com/kb/en/using-encryption-and-compression-tools-with-mariabackup/" class="_attribution-link">https://mariadb.com/kb/en/using-encryption-and-compression-tools-with-mariabackup/</a>
  </p>
</div>
