<h1>Optimizer Trace for Developers</h1> <div> <div class="node creole"> <div class="answer formatted"> <p>This article describes guidelines for what/how to write to Optimizer Trace when doing server development.</p> <h2 class="anchored_heading" id="basic-considerations">Basic considerations</h2> <p>The trace is a "structured log" of what was done by the optimizer. Prefer to do tracing as soon as a rewrite/decision is made (instead of having a separate trace_something() function).</p> <p>(TODO other considerations)</p> <h2 class="anchored_heading" id="making-sure-the-trace-is-valid">Making sure the trace is valid</h2> <p><code>Json_writer_object</code> and <code>Json_writer_array</code> classes use RAII idiom and ensure that JSON objects and arrays are "closed" in the reverse order they were started.</p> <p>However, they do not ensure these constraints:</p> <ul start="1">
<li>JSON objects must have named members. </li>
<li>JSON arrays must have unnamed members. </li>
</ul> <p>Tracing code has runtime checks for these. Attempt to write invalid JSON will cause assertion failure.</p> <h2 class="anchored_heading" id="test-coverage">Test coverage</h2> <p>It is possible to run <code>mysql-test-run</code> with this argument</p> <pre class="fixed" data-language="sql"> --mysqld=--optimizer_trace=enabled=on
</pre>
<p>This will run all tests with tracing on. As mentioned earlier, debug build will perform checks that we are not producing invalid trace. </p> <p>The BuildBot instance at <a href="http://buildbot.askmonty.org/">http://buildbot.askmonty.org/</a> also runs tests with this argument, see <code>mtr_opttrace</code> pass in kvm-fulltest and kvm-fulltest2.</p> <h2 class="anchored_heading" id="debugging">Debugging</h2> <p>In newer MariaDB versions, there is </p> <pre class="fixed" data-language="sql">const char *dbug_print_opt_trace();
</pre>
<p>function which one can use to print the trace produced so far.</p> </div>     </div> <div id="content_disclaimer" class="graybox"> Content reproduced on this site is the property of its respective owners, and this content is not reviewed in advance by MariaDB. The views, information and opinions expressed by this content do not necessarily represent those of MariaDB or any other party. </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2023 MariaDB<br>Licensed under the Creative Commons Attribution 3.0 Unported License and the GNU Free Documentation License.<br>
    <a href="https://mariadb.com/kb/en/optimizer-trace-for-developers/" class="_attribution-link">https://mariadb.com/kb/en/optimizer-trace-for-developers/</a>
  </p>
</div>
