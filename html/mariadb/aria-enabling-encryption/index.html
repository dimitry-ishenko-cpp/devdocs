<h1>Aria Enabling Encryption</h1> <div> <div class="node creole"> <div class="answer formatted">  <p>In order to enable data-at-rest encryption for tables using the <a href="../aria/index.html">Aria</a> storage engine, you first need to configure the server to use an <a href="../encryption-key-management/index.html">Encryption Key Management</a> plugin. Once this is done, you can enable encryption by setting the relevant system variables. </p> <h2 class="anchored_heading" id="encrypting-user-created-tables">Encrypting User-created Tables</h2> <p> With tables that the user creates, you can enable encryption by setting the <code><a href="../aria-system-variables/index.html#aria_encrypt_tables">aria_encrypt_tables</a></code> system variable to <code>ON</code>, then restart the Server. Once this is set, Aria automatically enables encryption on all tables you create after with the <code><a href="../create-table/index.html#row_format">ROW_FORMAT</a></code> table option set to <code>PAGE</code>.</p> <p>Currently, Aria does not support encryption on tables where the <code><a href="../create-table/index.html#row_format">ROW_FORMAT</a></code> table option is set to the <code>FIXED</code> or <code>DYNAMIC</code> values.</p> <p>Unlike InnoDB, Aria does not support the <code><a href="../create-table/index.html#encrypted">ENCRYPTED</a></code> table option (see <a href="https://jira.mariadb.org/browse/MDEV-18049">MDEV-18049</a> about that). Encryption for Aria can only be enabled globally using the <code><a href="../aria-system-variables/index.html#aria_encrypt_tables">aria_encrypt_tables</a></code> system variable.</p> <h3 class="anchored_heading" id="encrypting-existing-tables">Encrypting Existing Tables</h3> <p>In cases where you have existing Aria tables that you would like to encrypt, the process is a little more complicated. Unlike InnoDB, Aria does not utilize <a href="../innodb-background-encryption-threads/index.html">background encryption threads</a> to automatically perform encryption changes (see <a href="https://jira.mariadb.org/browse/MDEV-18971">MDEV-18971</a> about that). Therefore, to encrypt existing tables, you need to identify each table that needs to be encrypted, and then you need to manually rebuild each table.</p> <p>First, set the <code><a href="../aria-system-variables/index.html#aria_encrypt_tables">aria_encrypt_tables</a></code> system variable to encrypt new tables.</p> <pre class="fixed" data-language="sql">SET GLOBAL aria_encrypt_tables=ON;
</pre>
<p>Identify Aria tables that have the <code><a href="../create-table/index.html#row_format">ROW_FORMAT</a></code> table option set to <code>PAGE</code>.</p> <pre class="fixed" data-language="sql">SELECT TABLE_SCHEMA, TABLE_NAME 
FROM information_schema.TABLES 
WHERE ENGINE='Aria' 
  AND ROW_FORMAT='PAGE'
  AND TABLE_SCHEMA != 'information_schema';
</pre>
<p>For each table in the result-set, issue an <code><a href="../alter-table/index.html">ALTER TABLE</a></code> statement to rebuild the table.</p> <pre class="fixed" data-language="sql">ALTER TABLE test.aria_table ENGINE=Aria ROW_FORMAT=PAGE;
</pre>
<p>This statement causes Aria to rebuild the table using the <code><a href="../create-table/index.html#row_format">ROW_FORMAT</a></code> table option. In the process, with the new default setting, it encrypts the table when it writes to disk. </p> <h2 class="anchored_heading" id="encrypting-internal-on-disk-temporary-tables">Encrypting Internal On-disk Temporary Tables</h2> <p>During the execution of queries, MariaDB routinely creates internal temporary tables. These internal temporary tables initially use the <a href="../memory-storage-engine/index.html">MEMORY</a> storage engine, which is entirely stored in memory. When the table size exceeds the allocation defined by the <code><a href="../server-system-variables/index.html#max_heap_table_size">max_heap_table_size</a></code> system variable, MariaDB writes the data to disk using another storage engine. If you have the <code><a href="../aria-system-variables/index.html#aria_used_for_temp_tables">aria_used_for_temp_tables</a></code> set to <code>ON</code>, MariaDB uses Aria in writing the internal temporary tables to disk.</p> <p>Encryption for internal temporary tables is handled separately from encryption for user-created tables. To enable encryption for these tables, set the <code><a href="../server-system-variables/index.html#encrypt_tmp_disk_tables">encrypt_tmp_disk_tables</a></code> system variable to <code>ON</code>. Once set, all internal temporary tables that are written to disk using Aria are automatically encrypted.</p> <h2 class="anchored_heading" id="manually-encrypting-tables">Manually Encrypting Tables</h2> <p>Currently, Aria does not support manually encrypting tables through the <code><a href="../create-table/index.html#encrypted">ENCRYPTED</a></code> and <code><a href="../create-table/index.html#encryption_key_id">ENCRYPTION_KEY_ID</a></code> table options. For more information, see <a href="https://jira.mariadb.org/browse/MDEV-18049">MDEV-18049</a>.</p> <p>In cases where you want to encrypt tables manually or set the specific encryption key, use <a href="../innodb-encryption/index.html">InnoDB</a>.</p> </div>     </div> <div id="content_disclaimer" class="graybox"> Content reproduced on this site is the property of its respective owners, and this content is not reviewed in advance by MariaDB. The views, information and opinions expressed by this content do not necessarily represent those of MariaDB or any other party. </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2023 MariaDB<br>Licensed under the Creative Commons Attribution 3.0 Unported License and the GNU Free Documentation License.<br>
    <a href="https://mariadb.com/kb/en/aria-enabling-encryption/" class="_attribution-link">https://mariadb.com/kb/en/aria-enabling-encryption/</a>
  </p>
</div>
