<h1>Replication Threads</h1> <div> <div class="node creole"> <div class="answer formatted"> <div class="cstm-style bluebox text">
<p>The terms <em>master</em> and <em>slave</em> have historically been used in replication, but the terms terms <em>primary</em> and <em>replica</em> are now preferred. The old terms are used still used in parts of the documentation, and in MariaDB commands, although <a href="../what-is-mariadb-105/index.html">MariaDB 10.5</a> has begun the process of renaming. The documentation process is ongoing. See <a href="https://jira.mariadb.org/browse/MDEV-18777">MDEV-18777</a> to follow progress on this effort.</p> </div>  <p>MariaDB's <a href="../high-availability-performance-tuning-mariadb-replication/index.html">replication</a> implementation requires several types of threads.</p> <h2 class="anchored_heading" id="threads-on-the-primary">Threads on the Primary</h2> <p>The primary usually only has one type of replication-related thread: the binary log dump thread.</p> <p>If <a href="../semisynchronous-replication/index.html">semisynchronous replication</a> is enabled, then the primary also has an ACK receiver thread.</p> <h3 class="anchored_heading" id="binary-log-dump-thread">Binary Log Dump Thread</h3> <p>The binary log dump thread runs on the primary and dumps the <a href="../binary-log/index.html">binary log</a> to the replica. This thread can be identified by running the <a href="../show-processlist/index.html">SHOW PROCESSLIST</a> statement and finding the thread where the <a href="../thread-command-values/index.html">thread command</a> is <code>"Binlog Dump"</code>.</p> <p>The primary creates a separate binary log dump thread for each replica connected to the primary. You can identify which replicas are connected to the primary by executing the <a href="../show-slave-hosts/index.html">SHOW SLAVE HOSTS</a> statement.</p> <h4 class="anchored_heading" id="binary-log-dump-threads-and-the-shutdown-process">Binary Log Dump Threads and the Shutdown Process</h4> <p>When a primary server is shutdown and it goes through the normal shutdown process, the primary kills client threads in random order. By default, the primary also considers its binary log dump threads to be regular client threads. As a consequence, the binary log dump threads can be killed while client threads still exist, and this means that data can be written on the primary during a normal shutdown that won't be replicated. This is true even if <a href="../semisynchronous-replication/index.html">semi-synchronous replication</a> is being used.</p> <p>In <a href="../what-is-mariadb-104/index.html">MariaDB 10.4</a> and later, this problem can be solved by shutting down the server using either the <a href="../mariadb-admin/index.html">mariadb-admin</a> utility or the <a href="../shutdown/index.html">SHUTDOWN</a> command, and providing a special option.</p> <p>For example, this problem can be solved by shutting down the server with the <a href="../mariadb-admin/index.html">mariadb-admin</a> utility and by providing the <code>--wait-for-all-slaves</code> option to the utility and by executing the <code>shutdown</code> command with the utility:</p> <pre class="fixed" data-language="sql">mariadb-admin --wait-for-all-slaves shutdown
</pre>
<p>Or this problem can be solved by shutting down the server with the <a href="../shutdown/index.html">SHUTDOWN</a> command and by providing the <code>WAIT FOR ALL SLAVES</code> option to the command:</p> <pre class="fixed" data-language="sql">SHUTDOWN WAIT FOR ALL SLAVES;
</pre>
<p>When one of these special options is provided, the server only kills its binary log dump threads after all client threads have been killed, and it only completes the shutdown after the last <a href="../binary-log/index.html">binary log</a> has been sent to all connected replicas.</p> <p>In <a href="../what-is-mariadb-104/index.html">MariaDB 10.4</a> and later, it is still not possible to enable this behavior by default. This means that this behavior is currently inaccessible when shutting down the server using tools like <a href="../systemd/index.html">systemd</a> or <a href="../sysvinit/index.html">sysVinit</a>.</p> <p>In <a href="../what-is-mariadb-103/index.html">MariaDB 10.3</a> and before, it is recommended to manually switchover replicas to a new primary before shutting down the old primary.</p> <h3 class="anchored_heading" id="ack-receiver-thread">ACK Receiver Thread</h3> <p>When <a href="../semisynchronous-replication/index.html">semisynchronous replication</a> is enabled, semisynchronous replicas send acknowledgements (ACKs) to their primary to confirm that they have received some transaction. The primary creates an ACK receiver thread to receive these ACKs.</p> <h2 class="anchored_heading" id="threads-on-the-replica">Threads on the Replica</h2> <p>The replica has three types of replication-related threads: the replica I/O thread, the replica SQL thread, and worker threads, which are only applicable when <a href="../parallel-replication/index.html">parallel replication</a> is in use.</p> <p>When <a href="../multi-source-replication/index.html">multi-source replication</a> is in use, each independent replication connection has its own replica threads of each type.</p> <h3 class="anchored_heading" id="replica-io-thread">Replica I/O Thread</h3> <p>The replica's I/O thread receives the <a href="../binary-log/index.html">binary log</a> events from the primary and writes them to its <a href="../relay-log/index.html">relay log</a>.</p> <h4 class="anchored_heading" id="binary-log-position">Binary Log Position</h4> <p>The <a href="../binary-log/index.html">binary log</a> position of the replica's I/O thread can be checked by executing the <a href="../show-slave-status/index.html">SHOW SLAVE STATUS</a> statement. It will be shown as the <code>Master_Log_File</code> and <code>Read_Master_Log_Pos</code> columns.</p> <p>The <a href="../binary-log/index.html">binary log</a> position of the replica's I/O thread can be set by setting the <a href="../change-master-to/index.html#master_log_file">MASTER_LOG_FILE</a> and <a href="../change-master-to/index.html#master_log_pos">MASTER_LOG_POS</a> options with the <a href="../change-master-to/index.html">CHANGE MASTER</a> statement.</p> <p>The <a href="../binary-log/index.html">binary log</a> position of the replica's I/O thread and the values of most other <a href="../change-master-to/index.html">CHANGE MASTER</a> options are written to either the default <code>master.info</code> file or the file that is configured by the <a href="../mysqld-options/index.html#-master-info-file">master_info_file</a> option. The replica's I/O thread keeps this <a href="../binary-log/index.html">binary log</a> position updated as it downloads events only when the <a href="#master_use_gtid">MASTER_USE_GTID</a> option is set to <code>NO</code>. Otherwise the file is not updated on a per event basis. See <a href="../change-master-to/index.html#option-persistence">CHANGE MASTER TO: Option Persistence</a> for more information.</p> <h3 class="anchored_heading" id="replica-sql-thread">Replica SQL Thread</h3> <p>The replica's SQL thread reads events from the <a href="../relay-log/index.html">relay log</a>. What it does with them depends on whether <a href="../parallel-replication/index.html">parallel replication</a> is in use. If <a href="../parallel-replication/index.html">parallel replication</a> is not in use, then the SQL thread applies the events to its local copy of the data. If <a href="../parallel-replication/index.html">parallel replication</a> is in use, then the SQL thread hands off the events to its worker threads to apply in parallel.</p> <h4 class="anchored_heading" id="relay-log-position">Relay Log Position</h4> <p>The <a href="../relay-log/index.html">relay log</a> position of the replica's SQL thread can be checked by executing the <a href="../show-slave-status/index.html">SHOW SLAVE STATUS</a> statement. It will be shown as the <code>Relay_Log_File</code> and <code>Relay_Log_Pos</code> columns.</p> <p>The <a href="../relay-log/index.html">relay log</a> position of the replica's SQL thread can be set by setting the <a href="../change-master-to/index.html#relay_log_file">RELAY_LOG_FILE</a> and <a href="../change-master-to/index.html#relay_log_pos">RELAY_LOG_POS</a> options with the <a href="../change-master-to/index.html">CHANGE MASTER</a> statement.</p> <p>The <a href="../relay-log/index.html">relay log</a> position of the replica's SQL thread is written to either the default <code>relay-log.info</code> file or the file that is configured by the <a href="../replication-and-binary-log-system-variables/index.html#relay_log_info_file">relay_log_info_file</a> system variable. The replica's SQL thread keeps this <a href="../relay-log/index.html">relay log</a> position updated as it applies events. See <a href="../change-master-to/index.html#option-persistence">CHANGE MASTER TO: Option Persistence</a> for more information.</p> <h4 class="anchored_heading" id="binary-log-position">Binary Log Position</h4> <p>The corresponding <a href="../binary-log/index.html">binary log</a> position of the current <a href="../relay-log/index.html">relay log</a> position of the replica's SQL thread can be checked by executing the <a href="../show-slave-status/index.html">SHOW SLAVE STATUS</a> statement. It will be shown as the <code>Relay_Master_Log_File</code> and <code>Exec_Master_Log_Pos</code> columns.</p> <h4 class="anchored_heading" id="gtid-position">GTID Position</h4> <p>If the replica is replicating <a href="../binary-log/index.html">binary log</a> events that contain <a href="../gtid/index.html">GTIDs</a>, then the <a href="index.html#replica-sql-thread">replica's's SQL thread</a> will write every GTID that it applies to the <a href="../mysqlgtid_slave_pos-table/index.html">mysql.gtid_slave_pos</a> table. This GTID can be inspected and modified through the <a href="../gtid/index.html#gtid_slave_pos">gtid_slave_pos</a> system variable.</p> <p>If the replica has the <a href="../replication-and-binary-log-system-variables/index.html#log_slave_updates">log_slave_updates</a> system variable enabled and if the replica has the <a href="../binary-log/index.html">binary log</a> enabled, then every write by the <a href="index.html#replica-sql-thread">replica's SQL thread</a> will also go into the replica's <a href="../binary-log/index.html">binary log</a>. This means that <a href="../gtid/index.html">GTIDs</a> of replicated transactions would be reflected in the value of the <a href="../gtid/index.html#gtid_binlog_pos">gtid_binlog_pos</a> system variable.</p> <p>See <a href="../change-master-to/index.html#gtid-persistence">CHANGE MASTER TO: GTID Persistence</a> for more information.</p> <h3 class="anchored_heading" id="worker-threads">Worker Threads</h3> <p>When <a href="../parallel-replication/index.html">parallel replication</a> is in use, then the SQL thread hands off the events to its worker threads to apply in parallel.</p> </div>     </div> <div id="content_disclaimer" class="graybox"> Content reproduced on this site is the property of its respective owners, and this content is not reviewed in advance by MariaDB. The views, information and opinions expressed by this content do not necessarily represent those of MariaDB or any other party. </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2023 MariaDB<br>Licensed under the Creative Commons Attribution 3.0 Unported License and the GNU Free Documentation License.<br>
    <a href="https://mariadb.com/kb/en/replication-threads/" class="_attribution-link">https://mariadb.com/kb/en/replication-threads/</a>
  </p>
</div>
