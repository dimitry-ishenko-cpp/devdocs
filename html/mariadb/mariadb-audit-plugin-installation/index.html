<h1>MariaDB Audit Plugin - Installation</h1> <div> <div class="node creole"> <div class="answer formatted"> <p>The <code>server_audit</code> plugin logs the server's activity. For each client session, it records who connected to the server (i.e., user name and host), what queries were executed, and which tables were accessed and server variables that were changed. This information is stored in a rotating log file or it may be sent to the local syslogd.</p>  <h2 class="anchored_heading" id="locating-the-plugin">Locating the Plugin</h2> <p>The <code>server_audit</code> plugin's shared library is included in MariaDB packages as the <code>server_audit.so</code> or <code>server_audit.dll</code> shared library on systems where it can be built.</p> <p>The plugin must be located in the plugin directory, the directory containing all plugin libraries for MariaDB. The path to this directory is configured by the <code><a href="../server-system-variables/index.html#plugin_dir">plugin_dir</a></code> system variable. To see the value of this variable and thereby determine the file path of the plugin library, execute the following SQL statement:</p> <pre class="fixed" data-language="sql">SHOW GLOBAL VARIABLES LIKE 'plugin_dir';

+---------------+--------------------------+
| Variable_name | Value                    |
+---------------+--------------------------+
| plugin_dir    | /usr/lib64/mysql/plugin/ |
+---------------+--------------------------+
</pre>
<p>Check the directory returned at the filesystem level to make sure that you have a copy of the plugin library, <code>server_audit.so</code> or <code>server_audit.dll</code>, depending on your system. It's included in recent installations of MariaDB. If you do not have it, you should upgrade MariaDB.</p> <h2 class="anchored_heading" id="installing-the-plugin">Installing the Plugin</h2> <p>Although the plugin's shared library is distributed with MariaDB by default, the plugin is not actually installed by MariaDB by default. There are two methods that can be used to install the plugin with MariaDB.</p> <p>The first method can be used to install the plugin without restarting the server. You can install the plugin dynamically by executing <code><a href="../install-soname/index.html">INSTALL SONAME</a></code> or <code><a href="../install-plugin/index.html">INSTALL PLUGIN</a></code>. For example:</p> <pre class="fixed" data-language="sql">INSTALL SONAME 'server_audit';
</pre>
<p>The second method can be used to tell the server to load the plugin when it starts up. The plugin can be installed this way by providing the <code><a href="../mysqld-options/index.html#-plugin-load">--plugin-load</a></code> or the <code><a href="../mysqld-options/index.html#-plugin-load-add">--plugin-load-add</a></code> options. This can be specified as a command-line argument to <code><a href="../mysqld-options/index.html">mysqld</a></code> or it can be specified in a relevant server <a href="../configuring-mariadb-with-option-files/index.html#option-groups">option group</a> in an <a href="../configuring-mariadb-with-option-files/index.html">option file</a>. For example:</p> <pre class="fixed" data-language="sql">[mariadb]
...
plugin_load_add = server_audit
</pre>
<h2 class="anchored_heading" id="uninstalling-the-plugin">Uninstalling the Plugin</h2> <p>You can uninstall the plugin dynamically by executing <code><a href="../uninstall-soname/index.html">UNINSTALL SONAME</a></code> or <code><a href="../uninstall-plugin/index.html">UNINSTALL PLUGIN</a></code>. For example:</p> <pre class="fixed" data-language="sql">UNINSTALL SONAME 'server_audit';
</pre>
<p>If you installed the plugin by providing the <code><a href="../mysqld-options/index.html#-plugin-load">--plugin-load</a></code> or the <code><a href="../mysqld-options/index.html#-plugin-load-add">--plugin-load-add</a></code> options in a relevant server <a href="../configuring-mariadb-with-option-files/index.html#option-groups">option group</a> in an <a href="../configuring-mariadb-with-option-files/index.html">option file</a>, then those options should be removed to prevent the plugin from being loaded the next time the server is restarted.</p> <h2 class="anchored_heading" id="prohibiting-uninstallation">Prohibiting Uninstallation</h2> <p>The <code><a href="../uninstall-soname/index.html">UNINSTALL SONAME</a></code> or <code><a href="../uninstall-plugin/index.html">UNINSTALL PLUGIN</a></code> statements may be used to uninstall plugins. For the <code>server_audit</code> plugin, you might want to disable this capability. To prevent the plugin from being uninstalled, you could set the the <code><a href="../mariadb-audit-plugin-system-variables/index.html#server_audit">server_audit</a></code> option to <code>FORCE_PLUS_PERMANENT</code> in a relevant server <a href="../configuring-mariadb-with-option-files/index.html#option-groups">option group</a> in an <a href="../configuring-mariadb-with-option-files/index.html">option file</a> after the plugin is loaded once:</p> <pre class="fixed" data-language="sql">[mariadb]
...
plugin_load_add = server_audit
server_audit=FORCE_PLUS_PERMANENT
</pre>
<p>Once you've added the option to the server's option file and restarted the server, the plugin can't be uninstalled. If someone tries to uninstall the audit plugin, then an error message will be returned. Below is an example of the error message:</p> <pre class="fixed" data-language="sql">UNINSTALL PLUGIN server_audit;

ERROR 1702 (HY000):
Plugin 'server_audit' is force_plus_permanent and can not be unloaded
</pre>
<p>For more information on <code>FORCE_PLUS_PERMANENT</code> and other option values for the <code><a href="../mariadb-audit-plugin-system-variables/index.html#-server-audit">server_audit</a></code> option, see <a href="../plugin-overview/index.html#configuring-plugin-activation-at-server-startup">Plugin Overview: Configuring Plugin Activation at Server Startup</a> for more information.</p> </div>     </div> <div id="content_disclaimer" class="graybox"> Content reproduced on this site is the property of its respective owners, and this content is not reviewed in advance by MariaDB. The views, information and opinions expressed by this content do not necessarily represent those of MariaDB or any other party. </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2023 MariaDB<br>Licensed under the Creative Commons Attribution 3.0 Unported License and the GNU Free Documentation License.<br>
    <a href="https://mariadb.com/kb/en/mariadb-audit-plugin-installation/" class="_attribution-link">https://mariadb.com/kb/en/mariadb-audit-plugin-installation/</a>
  </p>
</div>
