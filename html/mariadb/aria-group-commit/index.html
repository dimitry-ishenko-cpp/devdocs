<h1>Aria Group Commit</h1> <div> <div class="node creole"> <div class="answer formatted"> <p>Since <a href="../what-is-mariadb-52/index.html">MariaDB 5.2</a>, the <a href="../aria/index.html">Aria storage engine</a> has included a feature to group commits to speed up concurrent threads doing many inserts into the same or different Aria tables.</p> <p>By default, group commit for Aria is turned off. It is controlled by the <a href="../aria-server-system-variables/index.html#aria_group_commit">aria_group_commit</a> and <a href="../aria-server-system-variables/index.html#aria_group_commit_interval">aria_group_commit_interval</a> system variables.</p> <p>Information on setting server variables can be found on the <a href="../server-system-variables/index.html">Server System Variables</a> page.</p> <h2 class="anchored_heading" id="terminology">Terminology</h2> <ul start="1">
<li>A <code>commit</code> is <code>flush of logs</code> followed by a sync. </li>
<li>
<code>sent to disk</code> means written to disk but not sync()ed, </li>
<li>
<code>flushed</code> mean sent to disk and synced(). </li>
<li>
<code>LSN</code> means log serial number. It's refers to the position in the transaction log. </li>
</ul> <h2 class="anchored_heading" id="non-group-commit-logic-aria_group_commitnone">Non Group commit logic (aria_group_commit="none")</h2> <p>The thread which first started the <code>commit</code> is performing the actual flush of logs. Other threads set the new goal (LSN) of the next pass (if it is maximum) and wait for the pass end or just wait for the pass end.</p> <p>The effect of this is that a flush (write of logs + sync) will save all data for all threads/transactions that have been waiting since the last flush.</p> <h2 class="anchored_heading" id="if-hard-group-commit-is-enabled-aria_group_commithard">If hard group commit is enabled (aria_group_commit="hard")</h2> <h3 class="anchored_heading" id="if-hard-commit-and-aria_group_commit_interval0">If hard commit and aria_group_commit_interval=0</h3> <p>The first thread sends all changed buffers to disk. This is repeated as long as there are new LSNs added. The process can not loop forever because we have a limited number of threads and they will wait for the data to be synced.</p> <p>Pseudo code:</p> <pre class="fixed" data-language="sql">do
   send changed buffers to disk
 while new_goal
sync
</pre>
<h3 class="anchored_heading" id="if-hard-commit-and-aria_group_commit_interval-0">If hard commit and aria_group_commit_interval &gt; 0</h3> <p>If less than rate microseconds has passed since the last sync, then after buffers have been sent to disk, wait until rate microseconds has passed since last sync, do sync and return. This ensures that if we call sync infrequently we don't do any waits.</p> <h2 class="anchored_heading" id="if-soft-group-commit-is-enabled-aria_group_commitsoft">If soft group commit is enabled (aria_group_commit="soft")</h2> <p>Note that soft group commit should only be used if you can afford to lose a few rows if your machine shuts down hard (as in the case of a power failure).</p> <p>Works like in <code>non group commit'</code> but the thread doesn't do any real sync(). If aria_group_commit_interval is not zero, the sync() will be performed by a service thread with the given rate when needed (new LSN appears). If aria_group_commit_interval is zero, there will be no sync() calls.</p> <h2 class="anchored_heading" id="code">Code</h2> <p>The code for this can be found in storage/maria/ma_loghandler.c::translog_flush()</p> </div>     </div> <div id="content_disclaimer" class="graybox"> Content reproduced on this site is the property of its respective owners, and this content is not reviewed in advance by MariaDB. The views, information and opinions expressed by this content do not necessarily represent those of MariaDB or any other party. </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2023 MariaDB<br>Licensed under the Creative Commons Attribution 3.0 Unported License and the GNU Free Documentation License.<br>
    <a href="https://mariadb.com/kb/en/aria-group-commit/" class="_attribution-link">https://mariadb.com/kb/en/aria-group-commit/</a>
  </p>
</div>
