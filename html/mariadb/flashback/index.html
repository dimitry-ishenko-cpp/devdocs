<h1>Flashback</h1> <div> <div class="node creole"> <div class="answer formatted">  <p>Flashback is a feature that allows instances, databases or tables to be rolled back to an old snapshot. </p> <p>Flashback is currently supported only over DML statements (<a href="../insert/index.html">INSERT</a>, <a href="../delete/index.html">DELETE</a>, <a href="../update/index.html">UPDATE</a>). An upcoming version of MariaDB will add support for flashback over DDL statements (<a href="../drop-table/index.html">DROP</a>, <a href="../truncate-table/index.html">TRUNCATE</a>, <a href="../alter-table/index.html">ALTER</a>, etc.) by copying or moving the current table to a reserved and hidden database, and then copying or moving back when using flashback. See <a href="https://jira.mariadb.org/browse/MDEV-10571">MDEV-10571</a>.</p> <p>Flashback is achieved in MariaDB Server using existing support for full image format binary logs (<a href="../replication-and-binary-log-system-variables/index.html#binlog_row_image">binlog_row_image=FULL</a>), so it supports all engines.</p> <p>The real work of Flashback is done by <a href="../mariadb-binlog/index.html">mariadb-binlog</a> with <code>--flashback</code>. This causes events to be translated: INSERT to DELETE, DELETE to INSERT, and for UPDATEs, the before and after images are swapped.</p> <p>When executing <code>mariadb-binlog</code> with <code>--flashback</code>, the Flashback events will be stored in memory. You should make sure your server has enough memory for this feature.</p> <h2 class="anchored_heading" id="arguments">Arguments</h2> <ul start="1">
<li>
<a href="../mariadb-binlog/index.html">mariadb-binlog</a> has the option <code>--flashback</code> or <code>-B</code> that will let it work in flashback mode. </li>
<li>
<a href="../mysqld-options/index.html">mariadbd / mysqld</a> has the option <a href="../mysqld-options/index.html#-flashback">--flashback</a> that enables the binary log and sets <code>binlog_format=ROW</code>. It is not mandatory to use this option if you have already enabled those options directly. </li>
</ul> <div class="cstm-style redbox">
<p>Do not use <code>-v</code> <code>-vv</code> options, as this adds verbose information to the binary log which can cause problems when importing. See <a href="https://jira.mariadb.org/browse/MDEV-12066">MDEV-12066</a> and <a href="https://jira.mariadb.org/browse/MDEV-12067">MDEV-12067</a>.</p> </div>
<h2 class="anchored_heading" id="example">Example</h2> <p>With a table "mytable" in database "test", you can compare the output with <code>--flashback</code> and without.</p> <pre class="fixed" data-language="sql"> mariadb-binlog /var/lib/mysql/mysql-bin.000001 -vv -d test -T mytable \
    --start-datetime="2013-03-27 14:54:00" &gt; review.sql
</pre>
<pre class="fixed" data-language="sql"> mariadb-binlog /var/lib/mysql/mysql-bin.000001 -vv -d test -T mytable \
    --start-datetime="2013-03-27 14:54:00" --flashback &gt; flashback.sql
</pre>
<p>If you know the exact position, <code>--start-position</code> can be used instead of <code>--start-datetime</code>.</p> <p>Then, by importing the output file (<code>mysql &lt; flashback.sql</code>), you can flash your database/table back to the specified time or position.</p> <h2 class="anchored_heading" id="common-use-case">Common Use Case</h2> <p>A common use case for Flashback is the following scenario:</p> <ul start="1">
<li>You have one primary and two replicas, one started with <code>--flashback</code> (i.e. with binary logging enabled, using <a href="../replication-and-binary-log-system-variables/index.html#binlog_format">binlog_format=ROW</a>, and <a href="../replication-and-binary-log-system-variables/index.html#binlog_row_image">binlog_row_image=FULL</a>). </li>
<li>Something goes wrong on the primary (like a wrong update or delete) and you would like to revert to a state of the database (or just a table) at a certain point in time. </li>
<li>Remove the flashback-enabled replica from replication. </li>
<li>Invoke <a href="../mariadb-binlog/index.html">mariadb-binlog</a> to find the exact log position of the first offending operation after the state you want to revert to. </li>
<li>Run <code>mariadb-binlog --flashback --start-position=xyz | mysql</code> to pipe the output of <code>mariadb-binlog</code> directly to the <code>mariadb</code> client, or save the output to a file and then direct the file to the command-line client.</li>
</ul> </div>     </div> <div id="content_disclaimer" class="graybox"> Content reproduced on this site is the property of its respective owners, and this content is not reviewed in advance by MariaDB. The views, information and opinions expressed by this content do not necessarily represent those of MariaDB or any other party. </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2023 MariaDB<br>Licensed under the Creative Commons Attribution 3.0 Unported License and the GNU Free Documentation License.<br>
    <a href="https://mariadb.com/kb/en/flashback/" class="_attribution-link">https://mariadb.com/kb/en/flashback/</a>
  </p>
</div>
