<h1>Aria FAQ</h1> <div> <div class="node creole"> <div class="answer formatted"> <p>This FAQ provides information on the <a href="../aria/index.html">Aria</a> storage engine.</p> <div class="cstm-style greenbox">
<p>The <strong><em>Aria</em></strong> storage engine was previously known as <strong><em>Maria</em></strong>, (see, the <a href="../the-aria-name/index.html">Aria Name</a>). In current releases of <a href="../mariadb/index.html">MariaDB</a>, you can refer to the engine as Maria or Aria. As this will change in future releases, please update references in your scripts and automation to use the correct name.</p> </div> <h2 class="anchored_heading" id="what-is-aria">What is Aria?</h2> <p>Aria is a storage engine for MySQL<span>®</span> and MariaDB. It was originally developed with the goal of becoming the default transactional <strong>and</strong> non-transactional storage engine for MariaDB and MySQL. </p> <p>It has been in development since 2007 and was first announced on Monty's <a href="http://monty-says.blogspot.com/2008/01/maria-engine-is-released.html">blog</a>. The same core MySQL engineers who developed the MySQL server and the <a href="../myisam/index.html">MyISAM</a>, <a href="../merge/index.html">MERGE</a>, and <a href="../memory-storage-engine/index.html">MEMORY</a> storage engines are also working on Aria.</p> <h2 class="anchored_heading" id="why-is-the-engine-called-aria">Why is the engine called Aria?</h2> <p>Originally, the storage engine was called <strong>Maria</strong>, after Monty's younger daughter. Monty named MySQL after his first child, <strong>My</strong> and his second child <strong>Max</strong> gave his name to MaxDB and the MySQL-Max distributions.</p> <p>In practice, having both <em>MariaDB</em> the database server and <em>Maria</em> the storage engine with such similar names proved confusing. To mitigate this, the decision was made to change the name. A Rename Maria contest was held during the first half of 2010 and names were submitted from around the world. Monty picked the name <strong><em>Aria</em></strong> from a short list of finalist. Chris Tooley, who suggested it, received the prize of a Linux-powered <a href="http://www.system76.com/product_info.php?cPath=27&amp;products_id=91">System 76 Meerkat NetTop</a> from Monty Program.</p> <p>For more information, see the <a href="../the-aria-name/index.html">Aria Name</a>.</p> <h2 class="anchored_heading" id="whats-the-goal-for-the-current-version">What's the goal for the current version?</h2> <p>The current version of Aria is 1.5. The goal of this release is to develop a crash-safe alternative to MyISAM. That is, when MariaDB restarts after a crash, Aria recovers all tables to the state as of the start of a statement or at the start of the last <code>LOCK TABLES</code> statement.</p> <p>The current goal is to keep the code stable and fix all bugs.</p> <h2 class="anchored_heading" id="whats-the-goal-for-the-next-version">What's the goal for the next version?</h2> <p>The next version of Aria is 2.0. The goal for this release is to develop a fully transactional storage engine with at least all the major features of InnoDB.</p> <p>Currently, Aria 2.0 is on hold as its developers are focusing on improving MariaDB. However, they are interested in working with interested customers and partners to add more features to Aria and eventually release 2.0.</p> <p>These are some of the goals for Aria 2.0:</p> <ul start="1">
<li>ACID compliant </li>
<li>Commit/Rollback </li>
<li>Concurrent updates/deletes </li>
<li>Row locking </li>
<li>Group commit (Already in <a href="../what-is-mariadb-52/index.html">MariaDB 5.2</a>) </li>
<li>Faster lookup in index pages (Page directory) </li>
</ul> <p>Beginning in Aria 2.5, the plan is to focus on improving performance.</p> <h2 class="anchored_heading" id="what-is-the-ultimate-goal-of-aria">What is the ultimate goal of Aria?</h2> <p>Long term, we have the following goals for Aria:</p> <ul start="1">
<li>To create a new, ACID and Multi-Version Concurrency Control (MVCC), transactional storage engine that can function as both the default non-transactional and transactional storage engine for MariaDB and MySQL<span>®</span>. </li>
<li>To be a MyISAM replacement. This is possible because Aria can also be run in non-transactional mode, supports the same row formats as MyISAM, and supports or will support all major features of MyISAM. </li>
<li>To be the default non-transactional engine in MariaDB (instead of MyISAM). </li>
</ul> <h2 class="anchored_heading" id="what-are-the-design-goals-in-aria">What are the design goals in Aria?</h2> <ul start="1">
<li>Multi-Version Concurrency Control (MVCC) and ACID storage engine. </li>
<li>Optionally non-transactional tables that should be 'as fast and as compact' as MyISAM tables. </li>
<li>Be able to use Aria for internal temporary tables in MariaDB (instead of MyISAM). </li>
<li>All indexes should have equal speed (clustered index is not on our current road map for Aria. If you need clustered index, you should use XtraDB). </li>
<li>Allow 'any' length transactions to work (Having long running transactions will cause more log space to be used). </li>
<li>Allow log shipping; that is, you can do incremental backups of Aria tables just by copying the Aria logs. </li>
<li>Allow copying of Aria tables between different Aria servers (under some well-defined constraints). </li>
<li>Better blob handling (than is currently offered in MyISAM, at a minimum). </li>
<li>No memory copying or extra memory used for blobs on insert/update. </li>
<li>Blobs allocated in big sequential blocks - Less fragmentation over time. </li>
<li>Blobs are stored so that Aria can easily be extended to have access to any part of a blob with a single fetch in the future. </li>
<li>Efficient storage on disk (that is, low row data overhead, low page data overhead and little lost space on pages). Note: There is still some more work to succeed with this goal. The disk layout is fine, but we need more in-memory caches to ensure that we get a higher fill factor on the pages. </li>
<li>Small footprint, to make MariaDB + Aria suitable for desktop and embedded applications. </li>
<li>Flexible memory allocation and scalable algorithms to utilize large amounts of memory efficiently, when it is available. </li>
</ul> <h2 class="anchored_heading" id="where-can-i-find-documentation-and-help-about-aria">Where can I find documentation and help about Aria?</h2> <p>Documentation is available at <a href="../aria/index.html">Aria</a> and related topics. The project is maintained on <a href="https://github.com/MariaDB/server">GitHub</a>.</p> <p>If you want to know what happens or be part of developing Aria, you can subscribe to the <a href="https://lists.mariadb.org/postorius/lists/developers.lists.mariadb.org/">developers</a>, <a href="https://lists.mariadb.org/postorius/lists/docs.lists.mariadb.org/">docs</a>, or <a href="https://lists.mariadb.org/postorius/lists/discuss.lists.mariadb.org/">discuss</a> mailing lists.</p> <p>To report and check bugs in Aria, see <a href="../reporting-bugs/index.html">Reporting Bugs</a>.</p> <p>You can usually find some of the Maria developers on our Zulip instance at <a href="https://mariadb.zulipchat.com">https://mariadb.zulipchat.com</a> or on the <a href="../irc/index.html">IRC</a> channel #maria at <a href="https://libera.chat/">https://libera.chat/</a>.</p> <h2 class="anchored_heading" id="who-develops-aria">Who develops Aria?</h2> <p>The Core Team who develop Aria are:</p> <p><strong>Technical lead</strong></p> <ul start="1"><li>Michael "Monty" Widenius - Creator of MySQL and MyISAM </li></ul> <p><strong>Core Developers (in alphabetical order)</strong></p> <ul start="1">
<li>Guilhem Bichot - Replication expert, on line backup for MyISAM, etc. </li>
<li>Kristian Nielsen - MySQL build tools, NDB, MySQL server </li>
<li>Oleksandr Byelkin - Query cache, sub-queries, views. </li>
<li>Sergei Golubchik - Server Architect, Full text search, keys for MyISAM-Merge, Plugin architecture, etc. </li>
</ul> <p>All except Guilhem Bichot are working for <a href="http://mariadb.com">MariaDB Corporation Ab</a>.</p> <h2 class="anchored_heading" id="what-is-the-release-policyschedule-of-aria">What is the release policy/schedule of Aria?</h2> <p>Aria follows the same <a href="../release-criteria/index.html">release criteria</a> as for <a href="../mariadb/index.html">MariaDB</a>. Some clarifications, unique for the Aria storage engine:</p> <ul start="1">
<li>Aria index and data file formats should be backwards and forwards compatible to ensure easy upgrades and downgrades. </li>
<li>The <a href="../aria-storage-engine/index.html#aria-log-files">log file</a> format should also be compatible, but we don't make any guarantees yet. In some cases when upgrading, you must remove the old <code>aria_log.%</code> and <code>maria_log.%</code> files before restarting MariaDB. (So far, this has only occurred in the upgrade from <a href="../what-is-mariadb-51/index.html">MariaDB 5.1</a> and <a href="../what-is-mariadb-52/index.html">MariaDB 5.2</a>). </li>
</ul> <h3 class="anchored_heading" id="extended-commitment-for-beta-15">Extended commitment for Beta 1.5</h3> <ul start="1"><li>Aria is now feature complete according to specification. </li></ul> <h2 class="anchored_heading" id="how-does-aria-15-compare-to-myisam">How does Aria 1.5 Compare to MyISAM?</h2> <p>Aria 1.0 was basically a crash-safe non-transactional version of MyISAM. Aria 1.5 added more concurrency (multiple inserter) and some optimizations.</p> <p>Aria supports all aspects of MyISAM, except as noted below. This includes external and internal check/repair/compressing of rows, different row formats, different index compress formats, <code><a href="../aria_chk/index.html">aria_chk</a></code> etc. After a normal shutdown you can copy Aria files between servers.</p> <h2 class="anchored_heading" id="advantages-of-aria-compared-to-myisam">Advantages of Aria compared to MyISAM</h2> <ul start="1">
<li>Data and indexes are crash safe. </li>
<li>On a crash, changes will be rolled back to state of the start of a statement or a last <code>LOCK TABLES</code> statement. </li>
<li>Aria can replay almost everything from the log. (Including <code>CREATE</code>, <code>DROP</code>, <code>RENAME</code>, <code>TRUNCATE</code> tables). Therefore, you make a backup of Aria by just copying the log. The things that can't be replayed (yet) are: <ul start="1">
<li>Batch <code>INSERT</code> into an empty table (This includes <code>LOAD DATA INFILE</code>, <code>SELECT... INSERT</code> and <code>INSERT</code> (many rows)). </li>
<li>
<code>ALTER TABLE</code>. Note that <code>.frm</code> tables are NOT recreated! </li>
</ul> </li>
<li>
<code>LOAD INDEX</code> can skip index blocks for unwanted indexes. </li>
<li>Supports all MyISAM <code>ROW</code> formats and new <code>PAGE</code> format where data is stored in pages. (default size is 8K). </li>
<li>Multiple concurrent inserters into the same table. </li>
<li>When using <code>PAGE</code> format (default) row data is cached by page cache. </li>
<li>Aria has unit tests of most parts. </li>
<li>Supports both crash-safe (soon to be transactional) and not transactional tables. (Non-transactional tables are not logged and rows uses less space): <code>CREATE TABLE foo (...) TRANSACTIONAL=0|1 ENGINE=Aria</code>. </li>
<li>
<code>PAGE</code> is the only crash-safe/transactional row format. </li>
<li>
<code>PAGE</code> format should give a notable speed improvement on systems which have bad data caching. (For example Windows). </li>
<li>From <a href="../what-is-mariadb-105/index.html">MariaDB 10.5</a>, max key length is 2000 bytes, compared to 1000 bytes in MyISAM. </li>
</ul> <h2 class="anchored_heading" id="differences-between-aria-and-myisam">Differences between Aria and MyISAM</h2> <ul start="1">
<li>Aria uses BIG (1G by default) <a href="../aria-storage-engine/index.html#aria-log-files">log files</a>. </li>
<li>Aria has a log control file (<code>aria_log_control</code>) and log files (<code>aria_log.%</code>). The log files can be automatically purged when not needed or purged on demand (after backup). </li>
<li>Aria uses 8K pages by default (MyISAM uses 1K). This makes Aria a bit faster when using keys of fixed size, but slower when using variable-length packed keys (until we add a directory to index pages). </li>
</ul> <h2 class="anchored_heading" id="disadvantages-of-aria-compared-to-myisam">Disadvantages of Aria compared to MyISAM</h2> <ul start="1">
<li>Aria doesn't support <code>INSERT DELAYED</code>. </li>
<li>Aria does not support multiple key caches. </li>
<li>Storage of very small rows (&lt; 25 bytes) are not efficient for <code>PAGE</code> format. </li>
<li>
<code>MERGE</code> tables don't support Aria (should be very easy to add later). </li>
<li>Aria data pages in block format have an overhead of 10 bytes/page and 5 bytes/row. Transaction and multiple concurrent-writer support will use an extra overhead of 7 bytes for new rows, 14 bytes for deleted rows and 0 bytes for old compacted rows. </li>
<li>No external locking (MyISAM has external locking, but this is a rarely used feature). </li>
<li>Aria has one page size for both index and data (defined when Aria is used the first time). MyISAM supports different page sizes per index. </li>
<li>Small overhead (15 bytes) per index page. </li>
<li>Aria doesn't support MySQL internal RAID (disabled in MyISAM too, it's a deprecated feature). </li>
<li>Minimum data file size for PAGE format is 16K (with 8K pages). </li>
<li>Aria doesn't support indexes on virtual fields. </li>
</ul> <h2 class="anchored_heading" id="differences-between-mariadb-51-release-and-the-normal-mysql-51-release">Differences between <a href="../what-is-mariadb-51/index.html">MariaDB 5.1</a> release and the normal MySQL-5.1 release?</h2> <p>See:</p> <ul start="1">
<li>
<a href="../aria-storage-engine/index.html">Aria storage engine</a> </li>
<li>
<a href="../mariadb-versus-mysql/index.html">MariaDB versus MySQL</a> </li>
</ul> <h2 class="anchored_heading" id="why-do-you-use-the-transactional-keyword-now-when-aria-is-not-yet-transactional">Why do you use the <code>TRANSACTIONAL</code> keyword now when Aria is not yet transactional?</h2> <p>In the current development phase Aria tables created with <code>TRANSACTIONAL=1</code> are crash safe and atomic but not transactional because changes in Aria tables can't be rolled back with the <code>ROLLBACK</code> command. As we planned to make Aria tables fully transactional, we decided it was better to use the <code>TRANSACTIONAL</code> keyword from the start so so that applications don't need to be changed later.</p> <h2 class="anchored_heading" id="what-are-the-known-problems-with-the-mysql-51-maria-release">What are the known problems with the MySQL-5.1-Maria release?</h2> <ul start="1">
<li>See <code>KNOWN_BUGS.txt</code> for open/design bugs. </li>
<li>See jira.mariadb.org for newly reported bugs. Please report anything you can't find here! </li>
<li>If there is a bug in the Aria recovery code or in the code that generates the logs, or if the logs become corrupted, then mysqld may fail to start because Aria can't execute the logs at start up. </li>
<li>Query cache and concurrent insert using page row format have a bug, please disable query cache while using page row format and <a href="https://jira.mariadb.org/browse/MDEV-6817">MDEV-6817</a> isn't complete </li>
</ul> <p>If Aria doesn't start or you have an unrecoverable table (shouldn't happen):</p> <ul start="1">
<li>Remove the <code>aria_log.%</code> files from the data directory. </li>
<li>Restart <code>mysqld</code> and run <a href="../check-table/index.html">CHECK TABLE</a>, <a href="../repair-table/index.html">REPAIR TABLE</a> or <a href="../mariadb-check/index.html">mariadb-check</a> on your Aria tables. </li>
</ul> <p>Alternatively,</p> <ul start="1"><li>Remove logs and run <a href="../aria_chk/index.html">aria_chk</a> on your <code>*.MAI</code> files. </li></ul> <h2 class="anchored_heading" id="what-is-going-to-change-in-later-aria-main-releases">What is going to change in later Aria main releases?</h2> <p>The <code>LOCK TABLES</code> statement will not start a crash-safe segment. You should use <a href="begin.html">BEGIN</a> and <a href="../commit/index.html">COMMIT</a> instead. </p> <p>To make things future safe, you could do this:</p> <pre class="fixed" data-language="sql">BEGIN;
LOCK TABLES ....
UNLOCK TABLES;
COMMIT;
</pre>
<p>And later you can just remove the <code>LOCK TABLES</code> and <code>UNLOCK TABLES</code> statements. </p> <h2 class="anchored_heading" id="how-can-i-create-a-myisam-like-non-transactional-table-in-aria">How can I create a MyISAM-like (non-transactional) table in Aria?</h2> <p>Example:</p> <pre class="fixed" data-language="sql">CREATE TABLE t1 (a int) ROW_FORMAT=FIXED TRANSACTIONAL=0 PAGE_CHECKSUM=0;
CREATE TABLE t2 (a int) ROW_FORMAT=DYNAMIC TRANSACTIONAL=0 PAGE_CHECKSUM=0;
SHOW CREATE TABLE t1;
SHOW CREATE TABLE t2;
</pre>
<p>Note that the rows are not cached in the page cache for <code>FIXED</code> or <code>DYNAMIC</code> format. If you want to have the data cached (something MyISAM doesn't support) you should use <code>ROW_FORMAT=PAGE</code>:</p> <pre class="fixed" data-language="sql">CREATE TABLE t3 (a int) ROW_FORMAT=PAGE TRANSACTIONAL=0 PAGE_CHECKSUM=0;
SHOW CREATE TABLE t3;
</pre>
<p>You can use <code>PAGE_CHECKSUM=1</code> also for non-transactional tables; This puts a page checksums on all index pages. It also puts a checksum on data pages if you use <code>ROW_FORMAT=PAGE</code>.</p> <p>You may still have a speed difference (may be slightly positive or negative) between MyISAM and Aria because of different page sizes. You can change the page size for MariaDB with <code>--aria-block-size=\</code>#, where <code>\</code># is 1024, 2048, 4096, 8192, 16384 or 32768.</p> <p>Note that if you change the page size you have to dump all your old tables into text (with <a href="../mariadb-dump/index.html">mariadb-dump</a>) and remove the old Aria log and files: </p> <pre class="fixed" data-language="sql"># rm datadir/aria_log*
</pre>
<h2 class="anchored_heading" id="what-are-the-advantagesdisadvantages-of-the-new-page-format-compared-to-the-old-myisam-like-row-formats-dynamic-and-fixed">What are the advantages/disadvantages of the new <code>PAGE</code> format compared to the old MyISAM-like row formats (<code>DYNAMIC</code> and <code>FIXED</code>)</h2> <p>The MyISAM-like <code>DYNAMIC</code> and <code>FIXED</code> format are extremely simple and have very little space overhead, so it's hard to beat them for when it comes to simple scanning of unmodified data. The <code>DYNAMIC</code> format does however get notably worse over time if you update the row a lot in a manner that increases the size of the row.</p> <p>The advantages of the <code>PAGE</code> format (compared to <code>DYNAMIC</code> or <code>FIXED</code>) for non-transactional tables are:</p> <ul start="1">
<li>It's cached by the Page Cache, which gives better random performance (as it uses less system calls). </li>
<li>Does not fragment as easily easily as the <code>DYNAMIC</code> format during <code>UPDATE</code> statements. The maximum number of fragments are very low. </li>
<li>Code can easily be extended to only read the accessed columns (for example to skip reading blobs). </li>
<li>Faster updates (compared to <code>DYNAMIC</code>). </li>
</ul> <p>The disadvantages are:</p> <ul start="1">
<li>Slight storage overhead (should only be notable for very small row sizes) </li>
<li>Slower full table scan time. </li>
<li>When using <code>row_format=PAGE</code>, (the default), Aria first writes the row, then the keys, at which point the check for duplicate keys happens. This makes <code>PAGE</code> format slower than <code>DYNAMIC</code> (or MyISAM) if there is a lot of duplicated keys because of the overhead of writing and removing the row. If this is a problem, you can use <code>row_format=DYNAMIC</code> to get same behavior as MyISAM. </li>
</ul> <h2 class="anchored_heading" id="whats-the-proper-way-to-copy-a-aria-table-from-one-place-to-another">What's the proper way to copy a Aria table from one place to another?</h2> <p>An Aria table consists of 3 files:</p> <pre class="fixed" data-language="sql">XXX.frm : The definition for the table, used by MySQL.
XXX.MYI : Aria internal information about the structure of the data and index and data for all indexes.
XXX.MAD : The data.
</pre>
<p>It's safe to copy all the Aria files to another directory or MariaDB instance if any of the following holds:</p> <ul start="1"><li>If you shutdown the MariaDB Server properly with <a href="../mariadb-admin/index.html">mariadb-admin shutdown</a>, so that there is nothing for Aria to recover when it starts. </li></ul> <p>or</p> <ul start="1"><li>If you have run a <a href="../flush/index.html">FLUSH TABLES</a> statement and not accessed the table using SQL from that time until the tables have been copied. </li></ul> <p>In addition, you must adhere the following rule for transactional tables:</p> <p>You can't copy the table to a location within the same MariaDB server if the new table has existed before and the new table is still active in the Aria recovery log (that is, Aria may need to access the old data during recovery). If you are unsure whether the old name existed, run <a href="../aria_chk/index.html">aria_chk --zerofill</a> on the table before you use it.</p> <p>After copying a transactional table and before you use the table, we recommend that you run the command:</p> <pre class="fixed" data-language="sql">$ aria_chk --zerofill table_name
</pre>
<p>This will overwrite all references to the logs (LSN), all transactional references (TRN) and all unused space with 0. It also marks the table as 'movable'. An additional benefit of zerofill is that the Aria files will compress better. No real data is ever removed as part of zerofill.</p> <p>Aria will automatically notice if you have copied a table from another system and do 'zerofill' for the first access of the table if it was not marked as 'movable'. The reason for using <a href="../aria_chk/index.html">aria_chk --zerofill</a> is that you avoid a delay in the MariaDB server for the first access of the table.</p> <p>Note that this automatic detection doesn't work if you copy tables within the same MariaDB server!</p> <h2 class="anchored_heading" id="when-is-it-safe-to-remove-old-log-files">When is it safe to remove old log files?</h2> <p>If you want to remove the <a href="../aria-storage-engine/index.html#aria-log-files">Aria log files</a> (<code>aria_log.%</code>) with <code>rm</code> or delete, then you must first shut down MariaDB cleanly (for example, with <a href="../mariadb-admin/index.html">mariadb-admin shutdown</a>) before deleting the old files.</p> <p>The same rules apply when upgrading MariaDB; When upgrading, first take down MariaDB in a clean way and then upgrade. This will allow you to remove the old log files if there are incompatible problems between releases.</p> <p>Don't remove the <code>aria_log_control</code> file! This is not a log file, but a file that contains information about the Aria setup (current transaction id, unique id, next log file number etc.).</p> <p>If you do, Aria will generate a new <code>aria_log_control</code> file at startup and will regard all old Aria files as files moved from another system. This means that they have to be 'zerofilled' before they can be used. This will happen automatically at next access of the Aria files, which can take some time if the files are big.</p> <p>If this happens, you will see things like this in your mysqld.err file:</p> <pre class="fixed" data-language="sql">[Note] Zerofilling moved table: '.\database\xxxx'
</pre>
<p>As part of zerofilling no vital data is removed.</p> <h2 class="anchored_heading" id="how-does-one-solve-the-missing-valid-id-error">How does one solve the Missing valid id error?</h2> <p>See <a href="../aria-storage-engine/index.html#aria-log-files">Aria Log Files</a> for details.</p> </div>     </div> <div id="content_disclaimer" class="graybox"> Content reproduced on this site is the property of its respective owners, and this content is not reviewed in advance by MariaDB. The views, information and opinions expressed by this content do not necessarily represent those of MariaDB or any other party. </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2023 MariaDB<br>Licensed under the Creative Commons Attribution 3.0 Unported License and the GNU Free Documentation License.<br>
    <a href="https://mariadb.com/kb/en/aria-faq/" class="_attribution-link">https://mariadb.com/kb/en/aria-faq/</a>
  </p>
</div>
