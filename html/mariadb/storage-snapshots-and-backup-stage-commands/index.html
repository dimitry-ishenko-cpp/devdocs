<h1>Storage Snapshots and BACKUP STAGE Commands</h1> <div> <div class="node creole"> <div class="answer formatted"> <div class="mariadb_from_10_4_1 mariadb from_10_4_1 product">
<strong class="product_title">MariaDB starting with <a href="https://mariadb.com/kb/en/mariadb-1041-release-notes/">10.4.1</a></strong><p>The <code>BACKUP STAGE</code> commands were introduced in <a href="https://mariadb.com/kb/en/mariadb-1041-release-notes/">MariaDB 10.4.1</a>.</p> </div> <p>The <a href="../backup-stage/index.html">BACKUP STAGE</a> commands are a set of commands to make it possible to make an efficient external backup tool. These commands could even be used by tools that perform backups by taking a snapshot of a file system, SAN, or some other kind of storage device.</p> <h2 class="anchored_heading" id="generic-backup-process-with-storage-snapshots">Generic Backup Process with Storage Snapshots</h2> <p>A tool that backs up MariaDB by taking a snapshot of a file system, SAN, or some other kind of storage device could use each <code>BACKUP STAGE</code> command in the following way:</p> <ul start="1"><li>First, execute the following: </li></ul> <pre class="fixed" data-language="sql">BACKUP STAGE START
BACKUP STAGE BLOCK_COMMIT
</pre>
<ul start="1"><li>Then, take the snapshot. </li></ul> <ul start="1"><li>Then, execute the following: </li></ul> <pre class="fixed" data-language="sql">BACKUP STAGE END
</pre>
<p>The above ensures that all non-transactional tables are properly flushed to disk before the snapshot is done. Using <code>BACKUP STAGE</code> commands is also more efficient than using the <a href="../flush/index.html">FLUSH TABLES WITH READ LOCK</a> command as the above set of commands will not block or be blocked by write operations to transactional tables.</p> <p>Note that when the backup is completed, one should delete all files with the "#sql" prefix, as these are files used by concurrent running <code>ALTER TABLE</code>. Note that InnoDB will on server restart automatically delete any tables with the "#sql" prefix.</p> </div>     </div> <div id="content_disclaimer" class="graybox"> Content reproduced on this site is the property of its respective owners, and this content is not reviewed in advance by MariaDB. The views, information and opinions expressed by this content do not necessarily represent those of MariaDB or any other party. </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2023 MariaDB<br>Licensed under the Creative Commons Attribution 3.0 Unported License and the GNU Free Documentation License.<br>
    <a href="https://mariadb.com/kb/en/storage-snapshots-and-backup-stage-commands/" class="_attribution-link">https://mariadb.com/kb/en/storage-snapshots-and-backup-stage-commands/</a>
  </p>
</div>
