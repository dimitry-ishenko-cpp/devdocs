<h1>What to Do if MariaDB Doesn't Start</h1> <div> <div class="node creole"> <div class="answer formatted">  <p>There could be many reasons that MariaDB fails to start. This page will help troubleshoot some of the more common reasons and provide solutions.</p> <p>If you have tried everything here, and still need help, you can ask for help on IRC or on the forums - see <a href="../where-to-find-other-mariadb-users-and-developers/index.html">Where to find other MariaDB users and developers</a> - or ask a question at the <a href="../starting-and-stopping-mariadb/index.html">Starting and Stopping MariaDB</a> page.</p> <h2 class="anchored_heading" id="the-error-log-and-the-data-directory">The Error Log and the Data Directory</h2> <p>The reason for the failure will almost certainly be written in the <a href="../error-log/index.html">error log</a> and, if you are starting MariaDB manually, to the console. By default, the error log is named <em>host-name</em>.err and is written to the data directory.</p> <p>Common Locations:</p> <ul start="1">
<li>/var/log/ </li>
<li>/var/log/mysql </li>
<li>C:\Program Files\MariaDB x.y\data (x.y refers to the version number) </li>
<li>C:\Program Files (x86)\MariaDB x.y\data (32bit version on 64bit Windows) </li>
</ul> <p>It's also possible that the error log has been explicitly written to another location. This is often done by changing the <code><a href="../server-system-variables/index.html#datadir">datadir</a></code> or <code><a href="../server-system-variables/index.html#log_error">log_error</a></code> system variables in an <a href="../configuring-mariadb-with-option-files/index.html">option file</a>. See <a href="#option-files">Option Files</a> below for more information about that.</p> <p>A quick way to get the values of these system variables is to execute the following commands:</p> <pre class="fixed" data-language="sql">mysqld --help --verbose | grep 'log-error' | tail -1
mysqld --help --verbose | grep 'datadir' | tail -1
</pre>
<h2 class="anchored_heading" id="option-files">Option Files</h2> <p>Another kind of file to consider when troubleshooting is <a href="../configuring-mariadb-with-option-files/index.html">option files</a>. The default option file is called <code>my.cnf</code>. Option files contain configuration options, such as the location of the data directory mentioned above. If you're unsure where the option file is located, see <a href="../configuring-mariadb-with-option-files/index.html#default-option-file-locations">Configuring MariaDB with Option Files: Default Option File Locations</a> for information on the default locations.</p> <p>You can check which configuration options MariaDB server will use from its option files by executing the following command:</p> <pre class="fixed" data-language="sql">mysqld --print-defaults
</pre>
<p>You can also check by executing the following command:</p> <pre class="fixed" data-language="sql">my_print_defaults --mysqld
</pre>
<p>See <a href="../configuring-mariadb-with-option-files/index.html#checking-program-options">Configuring MariaDB with Option Files: Checking Program Options</a> for more information on checking configuration options.</p> <h3 class="anchored_heading" id="invalid-option-or-option-value">Invalid Option or Option Value</h3> <p>Another potential reason for a startup failure is that an <a href="../configuring-mariadb-with-option-files/index.html">option file</a> contains an invalid option or an invalid option value. In those cases, the <a href="../error-log/index.html">error log</a> should contain an error similar to this:</p> <pre class="fixed" data-language="sql">140514 12:19:37 [ERROR] /usr/local/mysql/bin/mysqld: unknown variable 'option=value'
</pre>
<p>This is more likely to happen when you upgrade to a new version of MariaDB. In most cases the <a href="../configuring-mariadb-with-option-files/index.html">option file</a> from the old version of MariaDB will work just fine with the new version. However, occasionally, options are removed in new versions of MariaDB, or the valid values for options are changed in new versions of MariaDB. Therefore, it's possible for an <a href="../configuring-mariadb-with-option-files/index.html">option file</a> to stop working after an upgrade.</p> <p>Also remember that option names are case sensitive.</p> <p>Examine the specifics of the error. Possible fixes are usually one of the following:</p> <ul start="1">
<li>If the option is completely invalid, then remove it from the <a href="../configuring-mariadb-with-option-files/index.html">option file</a>. </li>
<li>If the option's name has changed, then fix the name. </li>
<li>If the option's valid values have changed, then change the option's value to a valid one. </li>
<li>If the problem is caused by a simple typo, then fix the typo. </li>
</ul> <h2 class="anchored_heading" id="cant-open-privilege-tables">Can't Open Privilege Tables</h2> <p>It is possible to see errors similar to the following:</p> <pre class="fixed" data-language="sql">System error 1067 has occurred.
Fatal error: Can't open privilege tables: Table 'mysql.host' doesn't exist
</pre>
<p>If errors like this occur, then critical <a href="../system-tables/index.html">system tables</a> are either missing or are in the wrong location. The above error is quite common after an upgrade if the <a href="../configuring-mariadb-with-option-files/index.html">option files</a> set the <code><a href="../server-system-variables/index.html#basedir">basedir</a></code> or <code><a href="../server-system-variables/index.html#datadir">datadir</a></code> to a non-standard location, but the new server is using the default location. Therefore, make sure that the <code><a href="../server-system-variables/index.html#basedir">basedir</a></code> and <code><a href="../server-system-variables/index.html#datadir">datadir</a></code> variables are correctly set.</p> <p>If you're unsure where the option file is located, see <a href="../configuring-mariadb-with-option-files/index.html#default-option-file-locations">Configuring MariaDB with Option Files: Default Option File Locations</a> for information on the default locations.</p> <p>If the <a href="../system-tables/index.html">system tables</a> really do not exist, then you may need to create them with <a href="../mariadb-install-db/index.html">mariadb-install-db</a>. See <a href="../installing-system-tables-mariadb-install-db/index.html">Installing System Tables (mariadb-install-db)</a> for more information.</p> <h2 class="anchored_heading" id="cant-create-test-file">Can't Create Test File</h2> <p>One of the first tests on startup is to check whether MariaDB can write to the data directory. When this fails, it will log an error like this:</p> <pre class="fixed wrap" data-language="sql">May 13 10:24:28 mariadb3 mysqld[19221]: 2019-05-13 10:24:28 0 [Warning] Can't create test file /usr/local/data/mariadb/mariadb3.lower-test
May 13 10:24:28 mariadb3 mysqld[19221]: 2019-05-13 10:24:28 0 [ERROR] Aborting
</pre>
<p>This is usually a permission error on the directory in which this file is being written. Ensure that the entire <code><a href="../server-system-variables/index.html#datadir">datadir</a></code> is owned by the user running <code>mysqld</code>, usually <code>mysql</code>. Ensure that directories have the "x" (execute) directory permissions for the owner. Ensure that all the parent directories of the <code><a href="../server-system-variables/index.html#datadir">datadir</a></code> upwards have "x" (execute) permissions for all (<code>user</code>, <code>group</code>, and <code>other</code>).</p> <p>Once this is checked look at the <a href="#systemd">systemd</a> and <a href="#selinux">selinux</a> documentation below, or <a href="#AppArmorl">AppArmor</a>.</p> <h2 class="anchored_heading" id="cant-lock-aria-control-file">Can't Lock Aria Control File</h2> <p>On starting MariaDB, the <code>aria_log_control</code> file is locked. If a lock cannot be obtained, it will log and error like this:</p> <pre class="fixed wrap" data-language="sql">2023-05-01 16:27:03 0 [ERROR] mariadbd: Can't lock aria control file '/var/lib/mysql/aria_log_control' for exclusive use, error: 11. Will retry for 30 seconds
</pre>
<p>This almost always cause for this is that there is already an existing MariaDB service running on this data directory. Recommend aborting this startup and looking closely for the other MariaDB instance.</p> <p>The less likely case is there isn't locking available which might occur on a NFS data directory with explictly disable locking.</p> <h2 class="anchored_heading" id="unable-to-lock-ibdata1-error-11">Unable to lock ./ibdata1 error 11</h2> <p>Like the above for the Aria Control File, this is a attempting to exclusively lock the <code>ibdata1</code> InnoDB system tablespace. Error 11 corresponds to the system error "OS error code 11: Resource temporarily unavailable" meaning the lock cannot be created.</p> <pre class="fixed wrap" data-language="sql">2023-05-01 16:27:34 0 [ERROR] InnoDB: Unable to lock ./ibdata1 error: 11
2023-05-01 16:27:34 0 [Note] InnoDB: Check that you do not already have another mariadbd process using the same InnoDB data or log files.
2023-05-01 16:27:34 0 [ERROR] InnoDB: Plugin initialization aborted with error Generic error
2023-05-01 16:27:35 0 [Note] InnoDB: Starting shutdown...
</pre>
<p>Like the above, this is an indication that a second MariaDB instance is already running on the data directory.</p> <h2 class="anchored_heading" id="innodb">InnoDB</h2> <p><a href="../xtradb-and-innodb/index.html">InnoDB</a> is probably the MariaDB component that most frequently causes a crash. In the error log, lines containing InnoDB messages generally start with "InnoDB:".</p> <h3 class="anchored_heading" id="cannot-allocate-memory-for-the-innodb-buffer-pool">Cannot Allocate Memory for the InnoDB Buffer Pool</h3> <p>In a typical installation on a dedicated server, at least 70% of your memory should be assigned to <a href="../xtradbinnodb-buffer-pool/index.html">InnoDB buffer pool</a>; sometimes it can even reach 85%. But be very careful: don't assign to the buffer pool more memory than it can allocate. If it cannot allocate memory, InnoDB will use the disk's swap area, which is very bad for performance. If swapping is disabled or the swap area is not big enough, InnoDB will crash. In this case, MariaDB will probably try to restart several times, and each time it will log a message like this:</p> <pre class="fixed" data-language="sql">140124 17:29:01 InnoDB: Fatal error: cannot allocate memory for the buffer pool
</pre>
<p>In that case, you will need to add more memory to your server/VM or decrease the value of the <a href="../xtradbinnodb-server-system-variables/index.html#innodb_buffer_pool_size">innodb_buffer_pool_size</a> variables.</p> <p>Remember that the buffer pool will slightly exceed that limit. Also, remember that MariaDB also needs allocate memory for other storage engines and several per-connection buffers. The operating system also needs memory.</p> <h3 class="anchored_heading" id="innodb-table-corruption">InnoDB Table Corruption</h3> <p>By default, InnoDB deliberately crashes the server when it detects table corruption. The reason for this behavior is preventing corruption propagation. However, in some situations, server availability is more important than data integrity. For this reason, we can avoid these crashes by changing the value of <a href="../xtradbinnodb-server-system-variables/index.html#innodb_corrupt_table_action">innodb_corrupt_table_action</a> to 'warn'.</p> <p>If InnoDB crashes the server after detecting data corruption, it writes a detailed message in the error log. The first lines are similar to the following:</p> <pre class="fixed" data-language="sql">InnoDB: Database page corruption on disk or a failed
InnoDB: file read of page 7.
InnoDB: You may have to recover from a backup.
</pre>
<p>Generally, it is still possible to recover most of the corrupted data. To do so, restart the server in <a href="../xtradbinnodb-recovery-modes/index.html">InnoDB recovery mode</a> and try to extract the data that you want to backup. You can save them in a CSV file or in a non-InnoDB table. Then, restart the server in normal mode and restore the data.</p> <h2 class="anchored_heading" id="myisam">MyISAM</h2> <p>Most tables in the <a href="../the-mysql-database-tables/index.html">mysql</a> database are MyISAM tables. These tables are necessary for MariaDB to properly work, or even start.</p> <p>A MariaDB crash could cause system tables corruption. With the default settings, MariaDB will simply not start if the system tables are corrupted. With <a href="../myisam-system-variables/index.html#myisam_recover_options">myisam_recover_options</a>, we can force MyISAM to repair damaged tables.</p> <h2 class="anchored_heading" id="systemd">systemd</h2> <p>If you are using <code><a href="../systemd/index.html">systemd</a></code>, then there are a few relevant notes about startup failures:</p> <ul start="1"><li>If MariaDB is configured to access files under <code>/home</code>, <code>/root</code>, or <code>/run/user</code>, then the default systemd unit file will prevent access to these directories with a <code>Permission Denied</code> error. This happens because the unit file set <code><a href="https://www.freedesktop.org/software/systemd/man/systemd.exec.html#ProtectHome=">ProtectHome=true</a></code>. See <a href="../systemd/index.html#configuring-access-to-home-directories">Systemd: Configuring Access to Home Directories</a> for information on how to work around this. </li></ul> <ul start="1"><li>The default systemd unit file also sets <a href="https://www.freedesktop.org/software/systemd/man/systemd.exec.html#ProtectSystem=">ProtectSystem=full</a>, which places restrictions on writing to a few other directories. Overwriting this with <code>ProtectSystem=off</code> in the same way as above will restore access to these directories. </li></ul> <ul start="1"><li>If MariaDB takes longer than 90 seconds to start, then the default systemd unit file will cause it to fail with an error. This happens because the default value for the <code><a href="https://www.freedesktop.org/software/systemd/man/systemd.service.html#TimeoutStartSec=">TimeoutStartSec</a></code> option is 90 seconds. See <a href="../systemd/index.html#configuring-the-systemd-service-timeout">Systemd: Configuring the Systemd Service Timeout</a> for information on how to work around this. </li></ul> <ul start="1"><li>The systemd journal may also contain useful information about startup failures. See <a href="../systemd/index.html#systemd-journal">Systemd: Systemd Journal</a> for more information. </li></ul> <p>See <a href="../systemd/index.html">systemd</a> documentation for further information on systemd configuration.</p> <h2 class="anchored_heading" id="selinux">SELinux</h2> <p><a href="https://selinuxproject.org/page/Main_Page">Security-Enhanced Linux (SELinux)</a> is a Linux kernel module that provides a framework for configuring <a href="https://en.wikipedia.org/wiki/Mandatory_access_control">mandatory access control (MAC)</a> system for many resources on the system. It is enabled by default on some Linux distributions, including RHEL, CentOS, Fedora, and other similar Linux distribution. SELinux prevents programs from accessing files, directories or ports unless it is configured to access those resources.</p> <p>You might need to troubleshoot SELinux-related issues in cases, such as:</p> <ul start="1">
<li>MariaDB is using a non-default port. </li>
<li>MariaDB is reading from or writing to some files (datadir, log files, option files, etc.) located at non-default paths. </li>
<li>MariaDB is using a plugin that requires access to resources that default installations do not use. </li>
</ul> <p>Setting SELinux state to <code>permissive</code> is a common way to investigate what is going wrong while allowing MariaDB to function normally. <code>permissive</code> is supposed to produce a log entry every time it should block a resource access, without actually blocking it. However, <a href="https://danwalsh.livejournal.com/67855.html">there are situations</a> when SELinux blocks resource accesses even in <code>permissive</code> mode.</p> <p>See <a href="../selinux/index.html">SELinux</a> for more information.</p> <h2 class="anchored_heading" id="apparmor">AppArmor</h2> <p>Add the following to <code>/etc/apparmor.d/tunables/alias</code> if you have moved the datadir:</p> <pre class="fixed" data-language="sql">alias /var/lib/mysql/ -&gt; /data/mariadb/,
</pre>
<p>The restart AppArmor:</p> <pre class="fixed" data-language="sql">sudo systemctl restart apparmor
</pre> </div>     </div> <div id="content_disclaimer" class="graybox"> Content reproduced on this site is the property of its respective owners, and this content is not reviewed in advance by MariaDB. The views, information and opinions expressed by this content do not necessarily represent those of MariaDB or any other party. </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2023 MariaDB<br>Licensed under the Creative Commons Attribution 3.0 Unported License and the GNU Free Documentation License.<br>
    <a href="https://mariadb.com/kb/en/what-to-do-if-mariadb-doesnt-start/" class="_attribution-link">https://mariadb.com/kb/en/what-to-do-if-mariadb-doesnt-start/</a>
  </p>
</div>
