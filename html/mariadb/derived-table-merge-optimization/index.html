<h1>Derived Table Merge Optimization</h1> <div> <div class="node creole"> <div class="answer formatted">  <h2 class="anchored_heading" id="background">Background</h2> <p>Users of "big" database systems are used to using <code>FROM</code> subqueries as a way to structure their queries. For example, if one's first thought was to select cities with population greater than 10,000 people, and then that from these cities to select those that are located in Germany, one could write this SQL:</p> <pre class="fixed" data-language="sql">SELECT * 
FROM 
  (SELECT * FROM City WHERE Population &gt; 10*1000) AS big_city
WHERE 
  big_city.Country='DEU'
</pre>
<p>For MySQL, using such syntax was taboo. If you run <a href="../explain/index.html">EXPLAIN</a> for this query, you can see why:</p> <pre class="fixed wrap" data-language="sql">mysql&gt; EXPLAIN SELECT * FROM (SELECT * FROM City WHERE Population &gt; 1*1000) 
  AS big_city WHERE big_city.Country='DEU' ;
+----+-------------+------------+------+---------------+------+---------+------+------+-------------+
| id | select_type | table      | type | possible_keys | key  | key_len | ref  | rows | Extra       |
+----+-------------+------------+------+---------------+------+---------+------+------+-------------+
|  1 | PRIMARY     | &lt;derived2&gt; | ALL  | NULL          | NULL | NULL    | NULL | 4068 | Using where |
|  2 | DERIVED     | City       | ALL  | Population    | NULL | NULL    | NULL | 4079 | Using where |
+----+-------------+------------+------+---------------+------+---------+------+------+-------------+
2 rows in set (0.60 sec)
</pre>
<p>It plans to do the following actions:</p> <p><img src="data:image/png;base64,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" alt="derived-inefficent" title="derived-inefficent"></p> <p>From left to right:</p> <ol start="1">
<li>Execute the subquery: <code>(SELECT * FROM City WHERE Population &gt; 1*1000)</code>, exactly as it was written in the query. </li>
<li>Put result of the subquery into a temporary table. </li>
<li>Read back, and apply a <code>WHERE</code> condition from the upper select, <code>big_city.Country='DEU'</code> </li>
</ol> <p>Executing a subquery like this is very inefficient, because the highly-selective condition from the parent select, (<code>Country='DEU'</code>) is not used when scanning the base table <code>City</code>. We read too many records from the <code>City</code> table, and then we have to write them into a temporary table and read them back again, before finally filtering them out.</p> <h2 class="anchored_heading" id="derived-table-merge-in-action">Derived table merge in action</h2> <p>If one runs this query in MariaDB/MySQL 5.6, they get this:</p> <pre class="fixed wrap" data-language="sql">MariaDB [world]&gt; EXPLAIN SELECT * FROM (SELECT * FROM City WHERE Population &gt; 1*1000) 
  AS big_city WHERE big_city.Country='DEU';
+----+-------------+-------+------+--------------------+---------+---------+-------+------+------------------------------------+
| id | select_type | table | type | possible_keys      | key     | key_len | ref   | rows | Extra                              |
+----+-------------+-------+------+--------------------+---------+---------+-------+------+------------------------------------+
|  1 | SIMPLE      | City  | ref  | Population,Country | Country | 3       | const |   90 | Using index condition; Using where |
+----+-------------+-------+------+--------------------+---------+---------+-------+------+------------------------------------+
1 row in set (0.00 sec)
</pre>
<p>From the above, one can see that:</p> <ol start="1">
<li>The output has only one line. This means that the subquery has been merged into the top-level <code>SELECT</code>. </li>
<li>Table <code>City</code> is accessed through an index on the <code>Country</code> column. Apparently, the <code>Country='DEU'</code> condition was used to construct <code>ref</code> access on the table. </li>
<li>The query will read about 90 rows, which is a big improvement over the 4079 row reads plus 4068 temporary table reads/writes we had before. </li>
</ol> <h2 class="anchored_heading" id="factsheet">Factsheet</h2> <ul start="1">
<li>Derived tables (subqueries in the <code>FROM</code> clause) can be merged into their parent select when they have no grouping, aggregates, or <code>ORDER BY ...  LIMIT</code> clauses. These requirements are the same as requirements for <code>VIEW</code>s to allow <code>algorithm=merge</code>. </li>
<li>The optimization is enabled by default. It can be disabled with: <pre class="fixed" data-language="sql">set @@optimizer_switch='derived_merge=OFF'
</pre> </li>
<li>Versions of MySQL and MariaDB which do not have support for this optimization will execute subqueries even when running <code>EXPLAIN</code>. This can result in a well-known problem (see e.g. <a href="http://bugs.mysql.com/bug.php?id=44802">MySQL Bug #44802</a>) of <code>EXPLAIN</code> statements taking a very long time. Starting from <a href="../what-is-mariadb-53/index.html">MariaDB 5.3</a>+ and MySQL 5.6+ <code>EXPLAIN</code> commands execute instantly, regardless of the <code>derived_merge</code> setting. </li>
</ul> <h2 class="anchored_heading" id="see-also">See Also</h2> <ul start="1"><li>FAQ entry: <a href="../why-is-order-by-in-a-from-subquery-ignored/index.html">Why is ORDER BY in a FROM subquery ignored?</a>
</li></ul> </div>     </div> <div id="content_disclaimer" class="graybox"> Content reproduced on this site is the property of its respective owners, and this content is not reviewed in advance by MariaDB. The views, information and opinions expressed by this content do not necessarily represent those of MariaDB or any other party. </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2023 MariaDB<br>Licensed under the Creative Commons Attribution 3.0 Unported License and the GNU Free Documentation License.<br>
    <a href="https://mariadb.com/kb/en/derived-table-merge-optimization/" class="_attribution-link">https://mariadb.com/kb/en/derived-table-merge-optimization/</a>
  </p>
</div>
