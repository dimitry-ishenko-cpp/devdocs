<h1>ALTER TABLE</h1> <div> <div class="node creole"> <div class="answer formatted"> <h2 class="anchored_heading" id="syntax">Syntax</h2> <pre class="highlight fixed" data-language="sql">ALTER [ONLINE] [IGNORE] TABLE [IF EXISTS] tbl_name
    [WAIT n | NOWAIT]
    alter_specification [, alter_specification] ...
alter_specification:
    table_option ...
  | ADD [COLUMN] [IF NOT EXISTS] col_name column_definition
        [FIRST | AFTER col_name ]
  | ADD [COLUMN] [IF NOT EXISTS] (col_name column_definition,...)
  | ADD {INDEX|KEY} [IF NOT EXISTS] [index_name]
        [index_type] (index_col_name,...) [index_option] ...
  | ADD [CONSTRAINT [symbol]] PRIMARY KEY
        [index_type] (index_col_name,...) [index_option] ...
  | ADD [CONSTRAINT [symbol]]
        UNIQUE [INDEX|KEY] [index_name]
        [index_type] (index_col_name,...) [index_option] ...
  | ADD FULLTEXT [INDEX|KEY] [index_name]
        (index_col_name,...) [index_option] ...
  | ADD SPATIAL [INDEX|KEY] [index_name]
        (index_col_name,...) [index_option] ...
  | ADD [CONSTRAINT [symbol]]
        FOREIGN KEY [IF NOT EXISTS] [index_name] (index_col_name,...)
        reference_definition
  | ADD PERIOD FOR SYSTEM_TIME (start_column_name, end_column_name)
  | ALTER [COLUMN] col_name SET DEFAULT literal | (expression)
  | ALTER [COLUMN] col_name DROP DEFAULT
  | ALTER {INDEX|KEY} index_name [NOT] INVISIBLE
  | CHANGE [COLUMN] [IF EXISTS] old_col_name new_col_name column_definition
        [FIRST|AFTER col_name]
  | MODIFY [COLUMN] [IF EXISTS] col_name column_definition
        [FIRST | AFTER col_name]
  | DROP [COLUMN] [IF EXISTS] col_name [RESTRICT|CASCADE]
  | DROP PRIMARY KEY
  | DROP {INDEX|KEY} [IF EXISTS] index_name
  | DROP FOREIGN KEY [IF EXISTS] fk_symbol
  | DROP CONSTRAINT [IF EXISTS] constraint_name
  | DISABLE KEYS
  | ENABLE KEYS
  | RENAME [TO] new_tbl_name
  | ORDER BY col_name [, col_name] ...
  | RENAME COLUMN old_col_name TO new_col_name
  | RENAME {INDEX|KEY} old_index_name TO new_index_name
  | CONVERT TO CHARACTER SET charset_name [COLLATE collation_name]
  | [DEFAULT] CHARACTER SET [=] charset_name
  | [DEFAULT] COLLATE [=] collation_name
  | DISCARD TABLESPACE
  | IMPORT TABLESPACE
  | ALGORITHM [=] {DEFAULT|INPLACE|COPY|NOCOPY|INSTANT}
  | LOCK [=] {DEFAULT|NONE|SHARED|EXCLUSIVE}
  | FORCE
  | partition_options
  | CONVERT TABLE normal_table TO partition_definition
  | CONVERT PARTITION partition_name TO TABLE tbl_name
  | ADD PARTITION [IF NOT EXISTS] (partition_definition)
  | DROP PARTITION [IF EXISTS] partition_names
  | COALESCE PARTITION number
  | REORGANIZE PARTITION [partition_names INTO (partition_definitions)]
  | ANALYZE PARTITION partition_names
  | CHECK PARTITION partition_names
  | OPTIMIZE PARTITION partition_names
  | REBUILD PARTITION partition_names
  | REPAIR PARTITION partition_names
  | EXCHANGE PARTITION partition_name WITH TABLE tbl_name
  | REMOVE PARTITIONING
  | ADD SYSTEM VERSIONING
  | DROP SYSTEM VERSIONING
index_col_name:
    col_name [(length)] [ASC | DESC]
index_type:
    USING {BTREE | HASH | RTREE}
index_option:
    [ KEY_BLOCK_SIZE [=] value
  | index_type
  | WITH PARSER parser_name
  | COMMENT 'string'
  | CLUSTERING={YES| NO} ]
  [ IGNORED | NOT IGNORED ]
table_options:
    table_option [[,] table_option] ...</pre> <h2 class="anchored_heading" id="description">Description</h2> <p><code>ALTER TABLE</code> enables you to change the structure of an existing table. For example, you can add or delete columns, create or destroy indexes, change the type of existing columns, or rename columns or the table itself. You can also change the comment for the table and the storage engine of the table.</p> <p>If another connection is using the table, a <a href="../metadata-locking/index.html">metadata lock</a> is active, and this statement will wait until the lock is released. This is also true for non-transactional tables.</p> <p>When adding a <code>UNIQUE</code> index on a column (or a set of columns) which have duplicated values, an error will be produced and the statement will be stopped. To suppress the error and force the creation of <code>UNIQUE</code> indexes, discarding duplicates, the <a href="../ignore/index.html">IGNORE</a> option can be specified. This can be useful if a column (or a set of columns) should be UNIQUE but it contains duplicate values; however, this technique provides no control on which rows are preserved and which are deleted. Also, note that <code>IGNORE</code> is accepted but ignored in <code>ALTER TABLE ... EXCHANGE PARTITION</code> statements.</p> <p>This statement can also be used to rename a table. For details see <a href="../rename-table/index.html">RENAME TABLE</a>.</p> <p>When an index is created, the storage engine may use a configurable buffer in the process. Incrementing the buffer speeds up the index creation. <a href="../aria/index.html">Aria</a> and <a href="../myisam/index.html">MyISAM</a> allocate a buffer whose size is defined by <a href="../aria-system-variables/index.html#aria_sort_buffer_size">aria_sort_buffer_size</a> or <a href="../myisam-system-variables/index.html#myisam_sort_buffer_size">myisam_sort_buffer_size</a>, also used for <a href="../repair-table/index.html">REPAIR TABLE</a>. <a href="../innodb/index.html">InnoDB</a> allocates three buffers whose size is defined by <a href="../innodb-system-variables/index.html#innodb_sort_buffer_size">innodb_sort_buffer_size</a>.</p> <h2 class="anchored_heading" id="privileges">Privileges</h2> <p>Executing the <code>ALTER TABLE</code> statement generally requires at least the <a href="../grant/index.html#table-privileges">ALTER</a> privilege for the table or the database..</p> <p>If you are renaming a table, then it also requires the <a href="../grant/index.html#table-privileges">DROP</a>, <a href="../grant/index.html#table-privileges">CREATE</a> and <a href="../grant/index.html#table-privileges">INSERT</a> privileges for the table or the database as well.</p> <h2 class="anchored_heading" id="online-ddl">Online DDL</h2> <p>Online DDL is supported with the <a href="#algorithm">ALGORITHM</a> and <a href="#lock">LOCK</a> clauses.</p> <p>See <a href="../innodb-online-ddl-overview/index.html">InnoDB Online DDL Overview</a> for more information on online DDL with <a href="../innodb/index.html">InnoDB</a>.</p> <h3 class="anchored_heading" id="alter-online-table">ALTER ONLINE TABLE</h3> <p>ALTER ONLINE TABLE also works for partitioned tables.</p> <p>Online <code>ALTER TABLE</code> is available by executing the following:</p> <pre class="fixed" data-language="sql">ALTER ONLINE TABLE ...;
</pre>
<p>This statement has the following semantics:</p> <p>This statement is equivalent to the following:</p> <pre class="fixed" data-language="sql">ALTER TABLE ... LOCK=NONE;
</pre>
<p>See the <a href="#lock">LOCK</a> alter specification for more information.</p> <p>This statement is equivalent to the following:</p> <pre class="fixed" data-language="sql">ALTER TABLE ... ALGORITHM=INPLACE;
</pre>
<p>See the <a href="#algorithm">ALGORITHM</a> alter specification for more information.</p> <h2 class="anchored_heading" id="waitnowait">WAIT/NOWAIT</h2> <p>Set the lock wait timeout. See <a href="../wait-and-nowait/index.html">WAIT and NOWAIT</a>.</p> <h2 class="anchored_heading" id="if-exists">IF EXISTS</h2> <p>The <code>IF EXISTS</code> and <code>IF NOT EXISTS</code> clauses are available for the following:</p> <pre class="highlight fixed" data-language="sql">ADD COLUMN       [IF NOT EXISTS]
ADD INDEX        [IF NOT EXISTS]
ADD FOREIGN KEY  [IF NOT EXISTS]
ADD PARTITION    [IF NOT EXISTS]
CREATE INDEX     [IF NOT EXISTS]
DROP COLUMN      [IF EXISTS]
DROP INDEX       [IF EXISTS]
DROP FOREIGN KEY [IF EXISTS]
DROP PARTITION   [IF EXISTS]
CHANGE COLUMN    [IF EXISTS]
MODIFY COLUMN    [IF EXISTS]
DROP INDEX       [IF EXISTS]</pre>
<p>When <code>IF EXISTS</code> and <code>IF NOT EXISTS</code> are used in clauses, queries will not report errors when the condition is triggered for that clause. A warning with the same message text will be issued and the ALTER will move on to the next clause in the statement (or end if finished).</p> <div class="mariadb_from_10_5_2 mariadb from_10_5_2 product">
<strong class="product_title">MariaDB starting with <a href="https://mariadb.com/kb/en/mariadb-1052-release-notes/">10.5.2</a></strong><p>If this is directive is used after <code>ALTER ... TABLE</code>, one will not get an error if the table doesn't exist.</p> </div>
<h2 class="anchored_heading" id="column-definitions">Column Definitions</h2> <p>See <a href="../create-table/index.html#column-definitions">CREATE TABLE: Column Definitions</a> for information about column definitions.</p> <h2 class="anchored_heading" id="index-definitions">Index Definitions</h2> <p>See <a href="../create-table/index.html#index-definitions">CREATE TABLE: Index Definitions</a> for information about index definitions.</p> <p>The <a href="../create-index/index.html">CREATE INDEX</a> and <a href="../drop-index/index.html">DROP INDEX</a> statements can also be used to add or remove an index.</p> <h2 class="anchored_heading" id="character-sets-and-collations">Character Sets and Collations</h2> <pre class="highlight fixed" data-language="sql">CONVERT TO CHARACTER SET charset_name [COLLATE collation_name]
[DEFAULT] CHARACTER SET [=] charset_name
[DEFAULT] COLLATE [=] collation_name</pre>
<p>See <a href="../setting-character-sets-and-collations/index.html">Setting Character Sets and Collations</a> for details on setting the <a href="../character-sets/index.html">character sets and collations</a>.</p> <h2 class="anchored_heading" id="alter-specifications">Alter Specifications</h2> <h3 class="anchored_heading" id="table-options">Table Options</h3> <p>See <a href="../create-table/index.html#table-options">CREATE TABLE: Table Options</a> for information about table options.</p> <h3 class="anchored_heading" id="add-column">ADD COLUMN</h3> <pre class="highlight fixed" data-language="sql">... ADD COLUMN [IF NOT EXISTS]  (col_name column_definition,...)</pre>
<p>Adds a column to the table. The syntax is the same as in <a href="../create-table/index.html">CREATE TABLE</a>. If you are using <code class="highlight fixed" style="white-space:pre-wrap">IF NOT_EXISTS</code> the column will not be added if it was not there already. This is very useful when doing scripts to modify tables.</p> <p>The <code>FIRST</code> and <code>AFTER</code> clauses affect the physical order of columns in the datafile. Use <code>FIRST</code> to add a column in the first (leftmost) position, or <code>AFTER</code> followed by a column name to add the new column in any other position. Note that, nowadays, the physical position of a column is usually irrelevant.</p> <p>See also <a href="../instant-add-column-for-innodb/index.html">Instant ADD COLUMN for InnoDB</a>.</p> <h3 class="anchored_heading" id="drop-column">DROP COLUMN</h3> <pre class="highlight fixed" data-language="sql">... DROP COLUMN [IF EXISTS] col_name [CASCADE|RESTRICT]</pre>
<p>Drops the column from the table. If you are using <code class="highlight fixed" style="white-space:pre-wrap">IF EXISTS</code> you will not get an error if the column didn't exist. If the column is part of any index, the column will be dropped from them, except if you add a new column with identical name at the same time. The index will be dropped if all columns from the index were dropped. If the column was used in a view or trigger, you will get an error next time the view or trigger is accessed. Dropping a column that is part of a multi-column <code class="highlight fixed" style="white-space:pre-wrap">UNIQUE</code> constraint is not permitted. For example:</p> <pre class="fixed" data-language="sql">CREATE TABLE a (
  a int,
  b int,
  primary key (a,b)
);

ALTER TABLE x DROP COLUMN a;
[42000][1072] Key column 'A' doesn't exist in table
</pre>
<p>The reason is that dropping column <code>a</code> would result in the new constraint that all values in column <code>b</code> be unique. In order to drop the column, an explicit <code>DROP PRIMARY KEY</code> and <code>ADD PRIMARY KEY</code> would be required. Up until <a href="https://mariadb.com/kb/en/mariadb-1027-release-notes/">MariaDB 10.2.7</a>, the column was dropped and the additional constraint applied, resulting in the following structure:</p> <pre class="fixed" data-language="sql">ALTER TABLE x DROP COLUMN a;
Query OK, 0 rows affected (0.46 sec)

DESC x;
+-------+---------+------+-----+---------+-------+
| Field | Type    | Null | Key | Default | Extra |
+-------+---------+------+-----+---------+-------+
| b     | int(11) | NO   | PRI | NULL    |       |
+-------+---------+------+-----+---------+-------+
</pre>
<div class="mariadb_from_10_4_0 mariadb from_10_4_0 product">
<strong class="product_title">MariaDB starting with <a href="https://mariadb.com/kb/en/mariadb-1040-release-notes/">10.4.0</a></strong><p><a href="https://mariadb.com/kb/en/mariadb-1040-release-notes/">MariaDB 10.4.0</a> supports instant DROP COLUMN. DROP COLUMN of an indexed column would imply <a href="../drop-index/index.html">DROP INDEX</a> (and in the case of a non-UNIQUE multi-column index, possibly ADD INDEX). These will not be allowed with <a href="#algorithm">ALGORITHM=INSTANT</a>, but unlike before, they can be allowed with <a href="#algorithm">ALGORITHM=NOCOPY</a></p> </div>
<p><code class="highlight fixed" style="white-space:pre-wrap">RESTRICT</code> and <code class="highlight fixed" style="white-space:pre-wrap">CASCADE</code> are allowed to make porting from other database systems easier. In MariaDB, they do nothing.</p> <h3 class="anchored_heading" id="modify-column">MODIFY COLUMN</h3> <p>Allows you to modify the type of a column. The column will be at the same place as the original column and all indexes on the column will be kept. Note that when modifying column, you should specify all attributes for the new column.</p> <pre class="fixed" data-language="sql">CREATE TABLE t1 (a INT UNSIGNED AUTO_INCREMENT, PRIMARY KEY((a));
ALTER TABLE t1 MODIFY a BIGINT UNSIGNED AUTO_INCREMENT;
</pre>
<h3 class="anchored_heading" id="change-column">CHANGE COLUMN</h3> <p>Works like <code>MODIFY COLUMN</code> except that you can also change the name of the column. The column will be at the same place as the original column and all index on the column will be kept.</p> <pre class="fixed" data-language="sql">CREATE TABLE t1 (a INT UNSIGNED AUTO_INCREMENT, PRIMARY KEY(a));
ALTER TABLE t1 CHANGE a b BIGINT UNSIGNED AUTO_INCREMENT;
</pre>
<h3 class="anchored_heading" id="alter-column">ALTER COLUMN</h3> <p>This lets you change column options.</p> <pre class="fixed" data-language="sql">CREATE TABLE t1 (a INT UNSIGNED AUTO_INCREMENT, b varchar(50), PRIMARY KEY(a));
ALTER TABLE t1 ALTER b SET DEFAULT 'hello';
</pre>
<h3 class="anchored_heading" id="rename-indexkey">RENAME INDEX/KEY</h3> <div class="mariadb_from_10_5_2 mariadb from_10_5_2 product">
<strong class="product_title">MariaDB starting with <a href="https://mariadb.com/kb/en/mariadb-1052-release-notes/">10.5.2</a></strong><p>From <a href="https://mariadb.com/kb/en/mariadb-1052-release-notes/">MariaDB 10.5.2</a>, it is possible to rename an index using the <code>RENAME INDEX</code> (or <code>RENAME KEY</code>) syntax, for example:</p> <pre class="fixed" data-language="sql">ALTER TABLE t1 RENAME INDEX i_old TO i_new;
</pre>
</div>
<h3 class="anchored_heading" id="rename-column">RENAME COLUMN</h3> <div class="mariadb_from_10_5_2 mariadb from_10_5_2 product">
<strong class="product_title">MariaDB starting with <a href="https://mariadb.com/kb/en/mariadb-1052-release-notes/">10.5.2</a></strong><p>From <a href="https://mariadb.com/kb/en/mariadb-1052-release-notes/">MariaDB 10.5.2</a>, it is possible to rename a column using the <code>RENAME COLUMN</code> syntax, for example:</p> <pre class="fixed" data-language="sql">ALTER TABLE t1 RENAME COLUMN c_old TO c_new;
</pre>
</div>
<h3 class="anchored_heading" id="add-primary-key">ADD PRIMARY KEY</h3> <p>Add a primary key.</p> <p>For <code>PRIMARY KEY</code> indexes, you can specify a name for the index, but it is silently ignored, and the name of the index is always <code>PRIMARY</code>.</p> <p>See <a href="../getting-started-with-indexes/index.html#primary-key">Getting Started with Indexes: Primary Key</a> for more information.</p> <h3 class="anchored_heading" id="drop-primary-key">DROP PRIMARY KEY</h3> <p>Drop a primary key.</p> <p>For <code>PRIMARY KEY</code> indexes, you can specify a name for the index, but it is silently ignored, and the name of the index is always <code>PRIMARY</code>.</p> <p>See <a href="../getting-started-with-indexes/index.html#primary-key">Getting Started with Indexes: Primary Key</a> for more information.</p> <h3 class="anchored_heading" id="add-foreign-key">ADD FOREIGN KEY</h3> <p>Add a foreign key.</p> <p>For <code>FOREIGN KEY</code> indexes, a reference definition must be provided.</p> <p>For <code>FOREIGN KEY</code> indexes, you can specify a name for the constraint, using the <code>CONSTRAINT</code> keyword. That name will be used in error messages.</p> <p>First, you have to specify the name of the target (parent) table and a column or a column list which must be indexed and whose values must match to the foreign key's values. The <code>MATCH</code> clause is accepted to improve the compatibility with other DBMS's, but has no meaning in MariaDB. The <code>ON DELETE</code> and <code>ON UPDATE</code> clauses specify what must be done when a <code>DELETE</code> (or a <code>REPLACE</code>) statements attempts to delete a referenced row from the parent table, and when an <code>UPDATE</code> statement attempts to modify the referenced foreign key columns in a parent table row, respectively. The following options are allowed:</p> <ul start="1">
<li>
<code>RESTRICT</code>: The delete/update operation is not performed. The statement terminates with a 1451 error (SQLSTATE '2300'). </li>
<li>
<code>NO ACTION</code>: Synonym for <code>RESTRICT</code>. </li>
<li>
<code>CASCADE</code>: The delete/update operation is performed in both tables. </li>
<li>
<code>SET NULL</code>: The update or delete goes ahead in the parent table, and the corresponding foreign key fields in the child table are set to <code>NULL</code>. (They must not be defined as <code>NOT NULL</code> for this to succeed). </li>
<li>
<code>SET DEFAULT</code>: This option is implemented only for the legacy PBXT storage engine, which is disabled by default and no longer maintained. It sets the child table's foreign key fields to their <code>DEFAULT</code> values when the referenced parent table key entries are updated or deleted. </li>
</ul> <p>If either clause is omitted, the default behavior for the omitted clause is <code>RESTRICT</code>.</p> <p>See <a href="../foreign-keys/index.html">Foreign Keys</a> for more information.</p> <h3 class="anchored_heading" id="drop-foreign-key">DROP FOREIGN KEY</h3> <p>Drop a foreign key.</p> <p>See <a href="../foreign-keys/index.html">Foreign Keys</a> for more information.</p> <h3 class="anchored_heading" id="add-index">ADD INDEX</h3> <p>Add a plain index.</p> <p>Plain indexes are regular indexes that are not unique, and are not acting as a primary key or a foreign key. They are also not the "specialized" <code>FULLTEXT</code> or <code>SPATIAL</code> indexes.</p> <p>See <a href="../getting-started-with-indexes/index.html#plain-indexes">Getting Started with Indexes: Plain Indexes</a> for more information.</p> <h3 class="anchored_heading" id="drop-index">DROP INDEX</h3> <p>Drop a plain index.</p> <p>Plain indexes are regular indexes that are not unique, and are not acting as a primary key or a foreign key. They are also not the "specialized" <code>FULLTEXT</code> or <code>SPATIAL</code> indexes.</p> <p>See <a href="../getting-started-with-indexes/index.html#plain-indexes">Getting Started with Indexes: Plain Indexes</a> for more information.</p> <h3 class="anchored_heading" id="add-unique-index">ADD UNIQUE INDEX</h3> <p>Add a unique index.</p> <p>The <code>UNIQUE</code> keyword means that the index will not accept duplicated values, except for NULLs. An error will raise if you try to insert duplicate values in a UNIQUE index.</p> <p>For <code>UNIQUE</code> indexes, you can specify a name for the constraint, using the <code>CONSTRAINT</code> keyword. That name will be used in error messages.</p> <p>See <a href="../getting-started-with-indexes/index.html#unique-index">Getting Started with Indexes: Unique Index</a> for more information.</p> <h3 class="anchored_heading" id="drop-unique-index">DROP UNIQUE INDEX</h3> <p>Drop a unique index.</p> <p>The <code>UNIQUE</code> keyword means that the index will not accept duplicated values, except for NULLs. An error will raise if you try to insert duplicate values in a UNIQUE index.</p> <p>For <code>UNIQUE</code> indexes, you can specify a name for the constraint, using the <code>CONSTRAINT</code> keyword. That name will be used in error messages.</p> <p>See <a href="../getting-started-with-indexes/index.html#unique-index">Getting Started with Indexes: Unique Index</a> for more information.</p> <h3 class="anchored_heading" id="add-fulltext-index">ADD FULLTEXT INDEX</h3> <p>Add a <code>FULLTEXT</code> index.</p> <p>See <a href="../full-text-indexes/index.html">Full-Text Indexes</a> for more information.</p> <h3 class="anchored_heading" id="drop-fulltext-index">DROP FULLTEXT INDEX</h3> <p>Drop a <code>FULLTEXT</code> index.</p> <p>See <a href="../full-text-indexes/index.html">Full-Text Indexes</a> for more information.</p> <h3 class="anchored_heading" id="add-spatial-index">ADD SPATIAL INDEX</h3> <p>Add a SPATIAL index.</p> <p>See <a href="../spatial-index/index.html">SPATIAL INDEX</a> for more information.</p> <h3 class="anchored_heading" id="drop-spatial-index">DROP SPATIAL INDEX</h3> <p>Drop a SPATIAL index.</p> <p>See <a href="../spatial-index/index.html">SPATIAL INDEX</a> for more information.</p> <h3 class="anchored_heading" id="enable-disable-keys">ENABLE/ DISABLE KEYS</h3> <p><code>DISABLE KEYS</code> will disable all non unique keys for the table for storage engines that support this (at least MyISAM and Aria). This can be used to <a href="../how-to-quickly-insert-data-into-mariadb/index.html">speed up inserts</a> into empty tables.</p> <p><code>ENABLE KEYS</code> will enable all disabled keys.</p> <h3 class="anchored_heading" id="rename-to">RENAME TO</h3> <p>Renames the table. See also <a href="../rename-table/index.html">RENAME TABLE</a>.</p> <h3 class="anchored_heading" id="add-constraint">ADD CONSTRAINT</h3> <p>Modifies the table adding a <a href="../constraint/index.html">constraint</a> on a particular column or columns.</p> <pre class="highlight fixed" data-language="sql">ALTER TABLE table_name 
ADD CONSTRAINT [constraint_name] CHECK(expression);</pre>
<p>Before a row is inserted or updated, all constraints are evaluated in the order they are defined. If any constraint fails, then the row will not be updated. One can use most deterministic functions in a constraint, including <a href="../user-defined-functions/index.html">UDF's</a>.</p> <pre class="fixed" data-language="sql">CREATE TABLE account_ledger (
	id INT PRIMARY KEY AUTO_INCREMENT,
	transaction_name VARCHAR(100),
	credit_account VARCHAR(100),
	credit_amount INT,
	debit_account VARCHAR(100),
	debit_amount INT);

ALTER TABLE account_ledger 
ADD CONSTRAINT is_balanced 
    CHECK((debit_amount + credit_amount) = 0);
</pre>
<p>The <code>constraint_name</code> is optional. If you don't provide one in the <code>ALTER TABLE</code> statement, MariaDB auto-generates a name for you. This is done so that you can remove it later using <a href="#drop-constraint">DROP CONSTRAINT</a> clause.</p> <p>You can disable all constraint expression checks by setting the variable <a href="../server-system-variables/index.html#check_constraint_checks">check_constraint_checks</a> to <code>OFF</code>. You may find this useful when loading a table that violates some constraints that you want to later find and fix in SQL.</p> <p>To view constraints on a table, query <a href="../information-schema-table_constraints-table/index.html">information_schema.TABLE_CONSTRAINTS</a>:</p> <pre class="fixed" data-language="sql">SELECT CONSTRAINT_NAME, TABLE_NAME, CONSTRAINT_TYPE 
FROM information_schema.TABLE_CONSTRAINTS
WHERE TABLE_NAME = 'account_ledger';

+-----------------+----------------+-----------------+
| CONSTRAINT_NAME | TABLE_NAME     | CONSTRAINT_TYPE |
+-----------------+----------------+-----------------+
| is_balanced     | account_ledger | CHECK           |
+-----------------+----------------+-----------------+
</pre>
<h3 class="anchored_heading" id="drop-constraint">DROP CONSTRAINT</h3> <p><code>DROP CONSTRAINT</code> for <code>UNIQUE</code> and <code>FOREIGN KEY</code> <a href="../constraint/index.html">constraints</a> was introduced in <a href="https://mariadb.com/kb/en/mariadb-10222-release-notes/">MariaDB 10.2.22</a> and <a href="https://mariadb.com/kb/en/mariadb-10313-release-notes/">MariaDB 10.3.13</a>.</p> <p><code>DROP CONSTRAINT</code> for <code>CHECK</code> constraints was introduced in <a href="https://mariadb.com/kb/en/mariadb-1021-release-notes/">MariaDB 10.2.1</a></p> <p>Modifies the table, removing the given constraint.</p> <pre class="fixed" data-language="sql">ALTER TABLE table_name
DROP CONSTRAINT constraint_name;
</pre>
<p>When you add a constraint to a table, whether through a <a href="../create-table/index.html#constraint-expressions">CREATE TABLE</a> or <a href="#add-constraint">ALTER TABLE...ADD CONSTRAINT</a> statement, you can either set a <code>constraint_name</code> yourself, or allow MariaDB to auto-generate one for you. To view constraints on a table, query <a href="../information-schema-table_constraints-table/index.html">information_schema.TABLE_CONSTRAINTS</a>. For instance,</p> <pre class="fixed" data-language="sql">CREATE TABLE t (
   a INT,
   b INT,
   c INT,
   CONSTRAINT CHECK(a &gt; b),
   CONSTRAINT check_equals CHECK(a = c)); 

SELECT CONSTRAINT_NAME, TABLE_NAME, CONSTRAINT_TYPE 
FROM information_schema.TABLE_CONSTRAINTS
WHERE TABLE_NAME = 't';

+-----------------+----------------+-----------------+
| CONSTRAINT_NAME | TABLE_NAME     | CONSTRAINT_TYPE |
+-----------------+----------------+-----------------+
| check_equals    | t              | CHECK           |
| CONSTRAINT_1    | t              | CHECK           |
+-----------------+----------------+-----------------+
</pre>
<p>To remove a constraint from the table, issue an <code>ALTER TABLE...DROP CONSTRAINT</code> statement. For example,</p> <pre class="fixed" data-language="sql">ALTER TABLE t DROP CONSTRAINT is_unique;
</pre>
<h3 class="anchored_heading" id="add-system-versioning">ADD SYSTEM VERSIONING</h3> <p>Add system versioning. See <a href="../system-versioned-tables/index.html">System-versioned tables</a>.</p> <h3 class="anchored_heading" id="drop-system-versioning">DROP SYSTEM VERSIONING</h3> <p>Drop system versioning. See <a href="../system-versioned-tables/index.html">System-versioned tables</a>.</p> <h3 class="anchored_heading" id="add-period-for-system_time">ADD PERIOD FOR SYSTEM_TIME</h3> <p>See <a href="../system-versioned-tables/index.html">System-versioned tables</a>.</p> <h3 class="anchored_heading" id="force">FORCE</h3> <p><code>ALTER TABLE ... FORCE</code> can force MariaDB to re-build the table.</p> <p>In <a href="../what-is-mariadb-55/index.html">MariaDB 5.5</a> and before, this could only be done by setting the <a href="../create-table/index.html#storage-engine">ENGINE</a> table option to its old value. For example, for an InnoDB table, one could execute the following:</p> <pre class="fixed" data-language="sql">ALTER TABLE tab_name ENGINE = InnoDB;
</pre>
<p>The <code>FORCE</code> option can be used instead. For example, :</p> <pre class="fixed" data-language="sql">ALTER TABLE tab_name FORCE;
</pre>
<p>With InnoDB, the table rebuild will only reclaim unused space (i.e. the space previously used for deleted rows) if the <a href="../innodb-system-variables/index.html#innodb_file_per_table">innodb_file_per_table</a> system variable is set to <code>ON</code> (the default). If the system variable is <code>OFF</code>, then the space will not be reclaimed, but it will be-re-used for new data that's later added.</p> <h3 class="anchored_heading" id="convert-table-convert-partition">CONVERT TABLE / CONVERT PARTITION</h3> <p><code>CONVERT TABLE</code> and <code>CONVERT PARTITION</code> was introduced in <a href="https://mariadb.com/kb/en/mariadb-1071-release-notes/">MariaDB 10.7.1</a>.</p> <p><code>CONVERT PARTITION</code> can be used to remove a partition from a table and make this an ordinary table. For example:</p> <pre class="fixed" data-language="sql">ALTER TABLE partitioned_table CONVERT PARTITION part1 TO TABLE normal_table;
</pre>
<p><code>CONVERT PARTITION</code> will take an existing table and move this to another table as its own partition with a specified <a href="../create-table/index.html#partitions">partition definition</a>. For example the following moves <code>normal_table</code> to a partition of <code>partitioned_table</code> with a definition that its values, based on the <code>PARTITION BY</code> of the <code>partitioned_table</code>, are less than 12345.</p> <pre class="fixed" data-language="sql">ALTER TABLE partitioned_table CONVERT TABLE normal_table TO PARTITION part1 VALUES LESS THAN (12345);
</pre>
<h3 class="anchored_heading" id="exchange-partition">EXCHANGE PARTITION</h3> <p>This is used to exchange the contents of a partition with another table.</p> <p>This is performed by swapping the tablespaces of the partition with the other table.</p> <p>See <a href="../innodb-file-per-table-tablespaces/index.html#copying-transportable-tablespaces">copying InnoDB's transportable tablespaces</a> for more information.</p> <h3 class="anchored_heading" id="discard-tablespace">DISCARD TABLESPACE</h3> <p>This is used to discard an InnoDB table's tablespace.</p> <p>See <a href="../innodb-file-per-table-tablespaces/index.html#copying-transportable-tablespaces">copying InnoDB's transportable tablespaces</a> for more information.</p> <h3 class="anchored_heading" id="import-tablespace">IMPORT TABLESPACE</h3> <p>This is used to import an InnoDB table's tablespace. The tablespace should have been copied from its original server after executing <a href="../flush-tables-for-export/index.html">FLUSH TABLES FOR EXPORT</a>.</p> <p>See <a href="../innodb-file-per-table-tablespaces/index.html#copying-transportable-tablespaces">copying InnoDB's transportable tablespaces</a> for more information.</p> <p><code>ALTER TABLE ... IMPORT</code> only applies to InnoDB tables. Most other popular storage engines, such as Aria and MyISAM, will recognize their data files as soon as they've been placed in the proper directory under the datadir, and no special DDL is required to import them.</p> <h3 class="anchored_heading" id="algorithm">ALGORITHM</h3> <p>The <code>ALTER TABLE</code> statement supports the <code>ALGORITHM</code> clause. This clause is one of the clauses that is used to implement online DDL. <code>ALTER TABLE</code> supports several different algorithms. An algorithm can be explicitly chosen for an <code>ALTER TABLE</code> operation by setting the <code>ALGORITHM</code> clause. The supported values are:</p> <ul start="1">
<li>
<code>ALGORITHM=DEFAULT</code> - This implies the default behavior for the specific statement, such as if no <code>ALGORITHM</code> clause is specified. </li>
<li>
<code>ALGORITHM=COPY</code> </li>
<li>
<code>ALGORITHM=INPLACE</code> </li>
<li>
<code>ALGORITHM=NOCOPY</code> - This was added in <a href="https://mariadb.com/kb/en/mariadb-1037-release-notes/">MariaDB 10.3.7</a>. </li>
<li>
<code>ALGORITHM=INSTANT</code> - This was added in <a href="https://mariadb.com/kb/en/mariadb-1037-release-notes/">MariaDB 10.3.7</a>. </li>
</ul> <p>See <a href="../innodb-online-ddl-overview/index.html#algorithm">InnoDB Online DDL Overview: ALGORITHM</a> for information on how the <code>ALGORITHM</code> clause affects InnoDB.</p> <h4 class="anchored_heading" id="algorithmdefault">ALGORITHM=DEFAULT</h4> <p>The default behavior, which occurs if <code>ALGORITHM=DEFAULT</code> is specified, or if <code>ALGORITHM</code> is not specified at all, usually only makes a copy if the operation doesn't support being done in-place at all. In this case, the most efficient available algorithm will usually be used.</p> <p>However, in <a href="https://mariadb.com/kb/en/mariadb-1036-release-notes/">MariaDB 10.3.6</a> and before, if the value of the <a href="../server-system-variables/index.html#old_alter_table">old_alter_table</a> system variable is set to <code>ON</code>, then the default behavior is to perform <code>ALTER TABLE</code> operations by making a copy of the table using the old algorithm.</p> <p>In <a href="https://mariadb.com/kb/en/mariadb-1037-release-notes/">MariaDB 10.3.7</a> and later, the <a href="../server-system-variables/index.html#old_alter_table">old_alter_table</a> system variable is deprecated. Instead, the <a href="../server-system-variables/index.html#alter_algorithm">alter_algorithm</a> system variable defines the default algorithm for <code>ALTER TABLE</code> operations.</p> <h4 class="anchored_heading" id="algorithmcopy">ALGORITHM=COPY</h4> <p><code>ALGORITHM=COPY</code> is the name for the original <a href="index.html">ALTER TABLE</a> algorithm from early MariaDB versions.</p> <p>When <code>ALGORITHM=COPY</code> is set, MariaDB essentially does the following operations:</p> <pre class="fixed" data-language="sql">-- Create a temporary table with the new definition
CREATE TEMPORARY TABLE tmp_tab (
...
);

-- Copy the data from the original table
INSERT INTO tmp_tab
   SELECT * FROM original_tab;

-- Drop the original table
DROP TABLE original_tab;

-- Rename the temporary table, so that it replaces the original one
RENAME TABLE tmp_tab TO original_tab;
</pre>
<p>This algorithm is very inefficient, but it is generic, so it works for all storage engines.</p> <p>If <code>ALGORITHM=COPY</code> is specified, then the copy algorithm will be used even if it is not necessary. This can result in a lengthy table copy. If multiple <a href="index.html">ALTER TABLE</a> operations are required that each require the table to be rebuilt, then it is best to specify all operations in a single <a href="index.html">ALTER TABLE</a> statement, so that the table is only rebuilt once.</p> <h4 class="anchored_heading" id="algorithminplace">ALGORITHM=INPLACE</h4> <p><code>ALGORITHM=COPY</code> can be incredibly slow, because the whole table has to be copied and rebuilt. <code>ALGORITHM=INPLACE</code> was introduced as a way to avoid this by performing operations in-place and avoiding the table copy and rebuild, when possible.</p> <p>When <code>ALGORITHM=INPLACE</code> is set, the underlying storage engine uses optimizations to perform the operation while avoiding the table copy and rebuild. However, <code>INPLACE</code> is a bit of a misnomer, since some operations may still require the table to be rebuilt for some storage engines. Regardless, several operations can be performed without a full copy of the table for some storage engines.</p> <p>A more accurate name would have been <code>ALGORITHM=ENGINE</code>, where <code>ENGINE</code> refers to an "engine-specific" algorithm.</p> <p>If an <a href="index.html">ALTER TABLE</a> operation supports <code>ALGORITHM=INPLACE</code>, then it can be performed using optimizations by the underlying storage engine, but it may rebuilt.</p> <p>See <a href="../innodb-online-ddl-operations-with-the-inplace-alter-algorithm/index.html">InnoDB Online DDL Operations with ALGORITHM=INPLACE</a> for more.</p> <h4 class="anchored_heading" id="algorithmnocopy">ALGORITHM=NOCOPY</h4> <p><code>ALGORITHM=NOCOPY</code> was introduced in <a href="https://mariadb.com/kb/en/mariadb-1037-release-notes/">MariaDB 10.3.7</a>.</p> <p><code>ALGORITHM=INPLACE</code> can sometimes be surprisingly slow in instances where it has to rebuild the clustered index, because when the clustered index has to be rebuilt, the whole table has to be rebuilt. <code>ALGORITHM=NOCOPY</code> was introduced as a way to avoid this. </p> <p>If an <code>ALTER TABLE</code> operation supports <code>ALGORITHM=NOCOPY</code>, then it can be performed without rebuilding the clustered index.</p> <p>If <code>ALGORITHM=NOCOPY</code> is specified for an <code>ALTER TABLE</code> operation that does not support <code>ALGORITHM=NOCOPY</code>, then an error will be raised. In this case, raising an error is preferable, if the alternative is for the operation to rebuild the clustered index, and perform unexpectedly slowly.</p> <p>See <a href="../innodb-online-ddl-operations-with-algorithmnocopy/index.html">InnoDB Online DDL Operations with ALGORITHM=NOCOPY</a> for more.</p> <h4 class="anchored_heading" id="algorithminstant">ALGORITHM=INSTANT</h4> <p><code>ALGORITHM=INSTANT</code> was introduced in <a href="https://mariadb.com/kb/en/mariadb-1037-release-notes/">MariaDB 10.3.7</a>.</p> <p><code>ALGORITHM=INPLACE</code> can sometimes be surprisingly slow in instances where it has to modify data files. <code>ALGORITHM=INSTANT</code> was introduced as a way to avoid this.</p> <p>If an <code>ALTER TABLE</code> operation supports <code>ALGORITHM=INSTANT</code>, then it can be performed without modifying any data files.</p> <p>If <code>ALGORITHM=INSTANT</code> is specified for an <code>ALTER TABLE</code> operation that does not support <code>ALGORITHM=INSTANT</code>, then an error will be raised. In this case, raising an error is preferable, if the alternative is for the operation to modify data files, and perform unexpectedly slowly.</p> <p>See <a href="../innodb-online-ddl-operations-with-algorithminstant/index.html">InnoDB Online DDL Operations with ALGORITHM=INSTANT</a> for more.</p> <h3 class="anchored_heading" id="lock">LOCK</h3> <p>The <code>ALTER TABLE</code> statement supports the <code>LOCK</code> clause. This clause is one of the clauses that is used to implement online DDL. <code>ALTER TABLE</code> supports several different locking strategies. A locking strategy can be explicitly chosen for an <code>ALTER TABLE</code> operation by setting the <code>LOCK</code> clause. The supported values are:</p> <ul start="1">
<li>
<code>DEFAULT</code>: Acquire the least restrictive lock on the table that is supported for the specific operation. Permit the maximum amount of concurrency that is supported for the specific operation. </li>
<li>
<code>NONE</code>: Acquire no lock on the table. Permit <strong>all</strong> concurrent DML. If this locking strategy is not permitted for an operation, then an error is raised. </li>
<li>
<code>SHARED</code>: Acquire a read lock on the table. Permit <strong>read-only</strong> concurrent DML. If this locking strategy is not permitted for an operation, then an error is raised. </li>
<li>
<code>EXCLUSIVE</code>: Acquire a write lock on the table. Do <strong>not</strong> permit concurrent DML. </li>
</ul> <p>Different storage engines support different locking strategies for different operations. If a specific locking strategy is chosen for an <code>ALTER TABLE</code> operation, and that table's storage engine does not support that locking strategy for that specific operation, then an error will be raised.</p> <p>If the <code>LOCK</code> clause is not explicitly set, then the operation uses <code>LOCK=DEFAULT</code>.</p> <p><a href="alter-online-table.html">ALTER ONLINE TABLE</a> is equivalent to <code>LOCK=NONE</code>. Therefore, the <a href="alter-online-table.html">ALTER ONLINE TABLE</a> statement can be used to ensure that your <code>ALTER TABLE</code> operation allows all concurrent DML.</p> <p>See <a href="../innodb-online-ddl-overview/index.html#lock">InnoDB Online DDL Overview: LOCK</a> for information on how the <code>LOCK</code> clause affects InnoDB.</p> <h2 class="anchored_heading" id="progress-reporting">Progress Reporting</h2> <p>MariaDB provides progress reporting for <code>ALTER TABLE</code> statement for clients that support the new progress reporting protocol. For example, if you were using the <a href="../mariadb-command-line-client/index.html">mariadb</a> client, then the progress report might look like this::</p> <pre class="fixed" data-language="sql">ALTER TABLE test ENGINE=Aria;
Stage: 1 of 2 'copy to tmp table'    46% of stage
</pre>
<p>The progress report is also shown in the output of the <a href="../show-processlist/index.html">SHOW PROCESSLIST</a> statement and in the contents of the <a href="../information-schema-processlist-table/index.html">information_schema.PROCESSLIST</a> table.</p> <p>See <a href="../progress-reporting/index.html">Progress Reporting</a> for more information.</p> <h2 class="anchored_heading" id="aborting-alter-table-operations">Aborting ALTER TABLE Operations</h2> <p>If an <code>ALTER TABLE</code> operation is being performed and the connection is killed, the changes will be rolled back in a controlled manner. The rollback can be a slow operation as the time it takes is relative to how far the operation has progressed.</p> <p>Aborting <code>ALTER TABLE ... ALGORITHM=COPY</code> was made faster in <a href="https://mariadb.com/kb/en/mariadb-10213-release-notes/">MariaDB 10.2.13</a> by removing excessive undo logging (<a href="https://jira.mariadb.org/browse/MDEV-11415">MDEV-11415</a>). This significantly shortened the time it takes to abort a running ALTER TABLE operation, compared with earlier releases.</p> <h2 class="anchored_heading" id="atomic-alter-table">Atomic ALTER TABLE</h2> <div class="mariadb_from_10_6_1 mariadb from_10_6_1 product">
<strong class="product_title">MariaDB starting with <a href="https://mariadb.com/kb/en/mariadb-1061-release-notes/">10.6.1</a></strong><p>From <a href="../what-is-mariadb-106/index.html">MariaDB 10.6</a>, <code>ALTER TABLE</code> is atomic for most engines, including InnoDB, MyRocks, MyISAM and Aria (<a href="https://jira.mariadb.org/browse/MDEV-25180">MDEV-25180</a>). This means that if there is a crash (server down or power outage) during an <code>ALTER TABLE</code> operation, after recovery, either the old table and associated triggers and status will be intact, or the new table will be active.</p> <p>In older MariaDB versions one could get leftover #sql-alter..', '#sql-backup..' or 'table_name.frm˝' files if the system crashed during the <code>ALTER TABLE</code> operation.</p> <p>See <a href="../atomic-ddl/index.html">Atomic DDL</a> for more information.</p> </div>
<h2 class="anchored_heading" id="replication">Replication</h2> <div class="mariadb_from_10_8_1 mariadb from_10_8_1 product">
<strong class="product_title">MariaDB starting with <a href="https://mariadb.com/kb/en/mariadb-1081-release-notes/">10.8.1</a></strong><p>Before <a href="https://mariadb.com/kb/en/mariadb-1081-release-notes/">MariaDB 10.8.1</a>, ALTER TABLE got fully executed on the primary first, and only then was it replicated and started executing on replicas. From <a href="https://mariadb.com/kb/en/mariadb-1081-release-notes/">MariaDB 10.8.1</a>, ALTER TABLE gains <a href="../replication-and-binary-log-system-variables/index.html#binlog_alter_two_phase">an option</a> to replicate sooner and begin executing on replicas when it merely <em>starts</em> executing on the primary, not when it <em>finishes</em>. This way the replication lag caused by a heavy ALTER TABLE can be completely eliminated (<a href="https://jira.mariadb.org/browse/MDEV-11675">MDEV-11675</a>). </p> </div>
<h2 class="anchored_heading" id="examples">Examples</h2> <p>Adding a new column:</p> <pre class="fixed" data-language="sql">ALTER TABLE t1 ADD x INT;
</pre>
<p>Dropping a column:</p> <pre class="fixed" data-language="sql">ALTER TABLE t1 DROP x;
</pre>
<p>Modifying the type of a column:</p> <pre class="fixed" data-language="sql">ALTER TABLE t1 MODIFY x bigint unsigned;
</pre>
<p>Changing the name and type of a column:</p> <pre class="fixed" data-language="sql">ALTER TABLE t1 CHANGE a b bigint unsigned auto_increment;
</pre>
<p>Combining multiple clauses in a single ALTER TABLE statement, separated by commas:</p> <pre class="fixed" data-language="sql">ALTER TABLE t1 DROP x, ADD x2 INT,  CHANGE y y2 INT;
</pre>
<p>Changing the storage engine and adding a comment:</p> <pre class="fixed" data-language="sql">ALTER TABLE t1 
  ENGINE = InnoDB 
  COMMENT = 'First of three tables containing usage info';
</pre>
<p>Rebuilding the table (the previous example will also rebuild the table if it was already InnoDB):</p> <pre class="fixed" data-language="sql">ALTER TABLE t1 FORCE;
</pre>
<p>Dropping an index:</p> <pre class="fixed" data-language="sql">ALTER TABLE rooms DROP INDEX u;
</pre>
<p>Adding a unique index:</p> <pre class="fixed" data-language="sql">ALTER TABLE rooms ADD UNIQUE INDEX u(room_number);
</pre>
<p>From <a href="https://mariadb.com/kb/en/mariadb-1053-release-notes/">MariaDB 10.5.3</a>, adding a primary key for an <a href="../application-time-periods/index.html">application-time period table</a> with a <a href="../application-time-periods/index.html#without-overlaps">WITHOUT OVERLAPS</a> constraint:</p> <pre class="fixed" data-language="sql">ALTER TABLE rooms ADD PRIMARY KEY(room_number, p WITHOUT OVERLAPS);
</pre>
<p>From <a href="https://mariadb.com/kb/en/mariadb-1081-release-notes/">MariaDB 10.8.1</a>, ALTER query can be replicated faster with the setting of</p> <pre class="fixed" data-language="sql">SET @@SESSION.binlog_alter_two_phase = true;
</pre>
<p>prior the ALTER query. Binlog would contain two event groups</p> <pre class="fixed" data-language="sql">| master-bin.000001 | 495 | Gtid              |         1 |         537 | GTID 0-1-2 START ALTER                                        |
| master-bin.000001 | 537 | Query             |         1 |         655 | use `test`; alter table t add column b int, algorithm=inplace |
| master-bin.000001 | 655 | Gtid              |         1 |         700 | GTID 0-1-3 COMMIT ALTER id=2                                  |
| master-bin.000001 | 700 | Query             |         1 |         835 | use `test`; alter table t add column b int, algorithm=inplace |
</pre>
<p>of which the first one gets delivered to replicas before ALTER is taken to actual execution on the primary. </p> <h2 class="anchored_heading" id="see-also">See Also</h2> <ul start="1">
<li>
<a href="../create-table/index.html">CREATE TABLE</a> </li>
<li>
<a href="../drop-table/index.html">DROP TABLE</a> </li>
<li>
<a href="../character-sets-and-collations/index.html">Character Sets and Collations</a> </li>
<li>
<a href="../show-create-table/index.html">SHOW CREATE TABLE</a> </li>
<li><a href="../instant-add-column-for-innodb/index.html">Instant ADD COLUMN for InnoDB</a></li>
</ul> </div>     </div> <div id="content_disclaimer" class="graybox"> Content reproduced on this site is the property of its respective owners, and this content is not reviewed in advance by MariaDB. The views, information and opinions expressed by this content do not necessarily represent those of MariaDB or any other party. </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2023 MariaDB<br>Licensed under the Creative Commons Attribution 3.0 Unported License and the GNU Free Documentation License.<br>
    <a href="https://mariadb.com/kb/en/alter-table/" class="_attribution-link">https://mariadb.com/kb/en/alter-table/</a>
  </p>
</div>
