<h1>InnoDB Change Buffering</h1> <div> <div class="node creole"> <div class="answer formatted"> <div class="cstm-style greenbox">
<p>The change buffer has been disabled by default from <a href="https://mariadb.com/kb/en/mariadb-10515-release-notes/">MariaDB 10.5.15</a>, <a href="https://mariadb.com/kb/en/mariadb-1067-release-notes/">MariaDB 10.6.7</a>, <a href="https://mariadb.com/kb/en/mariadb-1073-release-notes/">MariaDB 10.7.3</a> and <a href="https://mariadb.com/kb/en/mariadb-1082-release-notes/">MariaDB 10.8.2</a> (<a href="https://jira.mariadb.org/browse/MDEV-27734">MDEV-27734</a>), was deprecated and ignored from <a href="https://mariadb.com/kb/en/mariadb-1090-release-notes/">MariaDB 10.9.0</a> (<a href="https://jira.mariadb.org/browse/MDEV-27735">MDEV-27735</a>), and was removed in <a href="../mdb-11-0-0-rn/index.html">MariaDB 11.0.0</a> (<a href="https://jira.mariadb.org/browse/MDEV-29694">MDEV-29694</a>).</p> <p>Benchmarks attached to <a href="https://jira.mariadb.org/browse/MDEV-19514">MDEV-19514</a> show that the change buffer sometimes reduces performance, and in the best case seem to bring a few per cent improvement to throughput. However, such improvement could come with a price: If the buffered changes are never merged (<a href="https://jira.mariadb.org/browse/MDEV-19514">MDEV-19514</a>, motivated by the reduction of random crashes and the removal of an innodb_force_recovery option that can inflict further corruption), then the InnoDB system tablespace can grow out of control (<a href="https://jira.mariadb.org/browse/MDEV-21952">MDEV-21952</a>).</p> </div>
<p> INSERT, UPDATE and DELETE statements can be particularly heavy operations to perform, as all indexes need to be updated after each change. For this reason these changes are often buffered.</p> <p>Pages are modified in the <a href="../innodb-buffer-pool/index.html">buffer pool</a>, and not immediately on disk. When rows are deleted, a flag is set, thus rows are not immediately deleted on disk. Later the changes will be written to disk (''flushed'') by InnoDB background threads. Pages that have been modified in memory and not yet flushed are called dirty pages. The buffering of data changes is called Change Buffer.</p> <p>Before <a href="../what-is-mariadb-55/index.html">MariaDB 5.5</a>, only inserted rows could be buffered, so this buffer was called Insert Buffer. The old name still appears in several places, for example in the output of <a href="../show-engine-innodb-status/index.html">SHOW ENGINE INNODB STATUS</a>.</p> <p>The change buffer only contains changes to the indexes. Inserts to UNIQUE secondary indexes cannot be buffered unless unique_checks=0 is used. Delete-mark and purge buffering of UNIQUE secondary indexes is allowed.</p> <p>The Change Buffer is an optimization because:</p> <ul start="1">
<li>A page can be modified several times in memory and be flushed to disk only once. </li>
<li>Dirty pages are flushed together, so the number of IO operations is lower. </li>
</ul> <p>If the server crashes, usually the Change Buffer is not empty. However, changes are not lost because they are written to the transaction logs, so they can be applied at server restart.</p> <p>The main server system variable here is <a href="../innodb-system-variables/index.html#innodb_change_buffering">innodb_change_buffering</a>, which determines which form of change buffering, if any, to use.</p> <p>The following settings are available:</p> <ul>
<li>inserts <ul><li>Only buffer insert operations </li></ul> </li>
<li>deletes <ul><li>Only buffer delete operations </li></ul> </li>
<li>changes <ul><li>Buffer both insert and delete operations </li></ul> </li>
<li>purges <ul><li>Buffer the actual physical deletes that occur in the background </li></ul> </li>
<li>all <ul><li>Buffer inserts, deletes and purges. Default setting from <a href="../what-is-mariadb-55/index.html">MariaDB 5.5</a> until <a href="https://mariadb.com/kb/en/mariadb-10514-release-notes/">MariaDB 10.5.14</a>, <a href="https://mariadb.com/kb/en/mariadb-1066-release-notes/">MariaDB 10.6.6</a>, <a href="https://mariadb.com/kb/en/mariadb-1072-release-notes/">MariaDB 10.7.2</a> and <a href="https://mariadb.com/kb/en/mariadb-1081-release-notes/">MariaDB 10.8.1</a>. </li></ul> </li>
<li>none <ul><li>Don't buffer any operations. Default from <a href="https://mariadb.com/kb/en/mariadb-10515-release-notes/">MariaDB 10.5.15</a>, <a href="https://mariadb.com/kb/en/mariadb-1067-release-notes/">MariaDB 10.6.7</a>, <a href="https://mariadb.com/kb/en/mariadb-1073-release-notes/">MariaDB 10.7.3</a> and <a href="https://mariadb.com/kb/en/mariadb-1082-release-notes/">MariaDB 10.8.2</a>. </li></ul> </li>
</ul> <p>Modifying the value of this variable only affects the buffering of new operations. The merging of already buffered changes is not affected.</p> <p>The <a href="../innodb-system-variables/index.html#innodb_change_buffer_max_size">innodb_change_buffer_max_size</a> system variable determines the maximum size of the change buffer, expressed as a percentage of the buffer pool.</p> <h2 class="anchored_heading" id="see-also">See Also</h2> <ul start="1"><li><a href="../innodb-buffer-pool/index.html">InnoDB Buffer Pool</a></li></ul> </div>     </div> <div id="content_disclaimer" class="graybox"> Content reproduced on this site is the property of its respective owners, and this content is not reviewed in advance by MariaDB. The views, information and opinions expressed by this content do not necessarily represent those of MariaDB or any other party. </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2023 MariaDB<br>Licensed under the Creative Commons Attribution 3.0 Unported License and the GNU Free Documentation License.<br>
    <a href="https://mariadb.com/kb/en/innodb-change-buffering/" class="_attribution-link">https://mariadb.com/kb/en/innodb-change-buffering/</a>
  </p>
</div>
