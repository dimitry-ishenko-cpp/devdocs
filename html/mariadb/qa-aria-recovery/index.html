<h1>QA - Aria Recovery</h1> <div> <div class="node creole"> <div class="answer formatted">  <h2 class="anchored_heading" id="general-principles">General Principles</h2> <p>Recovery is tested via the <a href="http://github.com/RQG/RQG-Documentation/wiki/Category:RandomQueryGenerator">RQG</a>, which provides a random workload against the server, and then uses kill -9 to kill the process. After that, recovery is attempted both by using <code>maria_read_log</code> and by restarting the <code>mysqld</code> process. Once the server has started up, the tables are verified in various ways, including <code>ALTER|OPTIMIZE|ANALYZE|REPAIR TABLE</code> as well <code>SELECT</code> queries that read the table back and forth using various access methods.</p> <p>A combinations <code>.CC</code> file named <code>lp:randgen/conf/engines/maria/maria_recovery.cc</code> is used to define various <code>mysql</code> options and RQG parameters that are relavant to recovery. Then, RQG's <code>combinations.pl</code> script is used to run hundreds of individual test runs. Each run uses a random permutation from the settings in the <code>.CC</code> file in order to generate a unique workload that is then validated via the <code>Recovery</code> RQG Reporter.</p> <h2 class="anchored_heading" id="individual-tests">Individual tests</h2> <p>The following are the individual tests or test runs that must be completed or created in order to ensure that Aria recovery is solid.</p> <h3 class="anchored_heading" id="standard-kill-9-testing">Standard kill -9 testing</h3> <p><strong>Done 2011-02-28</strong> The standard <code>conf/engines/maria/maria_recovery.cc</code> passes with no failures when run with hundreds of trials.</p> <h3 class="anchored_heading" id="testing-with-small-block-sizes">Testing with small block sizes</h3> <p>On hold pending 2 bug fixes related to --maria-block-size=1K and --maria-block-size=2K</p> <h3 class="anchored_heading" id="testing-with-small-page-cache-size">Testing with small page cache size</h3> <p><strong>Done 2011-03-04</strong> Completed 400 rounds with </p> <pre class="fixed" data-language="sql">'--mysqld=--maria-block-size=4K --mysqld=--maria-pagecache-buffer-size=128K',
'--mysqld=--maria-block-size=16K --mysqld=--maria-pagecache-buffer-size=256K',
'--mysqld=--maria-block-size=32K --mysqld=--maria-pagecache-buffer-size=512K'
</pre>
<p>two pre-recovery crashes were filed, no recovery issues.</p> <h3 class="anchored_heading" id="killing-and-restarting-the-recovery-process-itself">Killing and restarting the recovery process itself</h3> <p><strong>In Progress</strong></p> <p>The AriaDoubleRecovery reporter currently attempts doble recovery via maria_read_log. The first invocation of maria_read_log is killed halfway through the process and the second invocation is left to complete the recovery.</p> <p>Future testing will involve doing the same with the mysqld server in place of maria_read_log.</p> <h3 class="anchored_heading" id="another-realistic-workload">Another realistic workload</h3> <p>The usefullness of the SMF workload, derived from the SimpleMachines forum application means that another such workload is required in order to make sure no residual recovery bugs remain. Hopefully something can be cooked up using Wikipedia so that longer fields and blobs are exercised.</p> <h3 class="anchored_heading" id="transactional-consistency">Transactional consistency</h3> <p>A transactional grammar that simulates transactions using LOCK TABLEs is required. The RecoveryConsistency Reporter can then be used to validate that no partial transactions appear in the database after recovery.</p> <h2 class="anchored_heading" id="see-also">See also</h2> <ul start="1">
<li>
<a href="../rqg-performance-comparisons/index.html">RQG Performance Comparisons</a> </li>
<li>
<a href="../rqg-extensions-for-mariadb-features/index.html">RQG Extensions for MariaDB Features</a> </li>
<li>
<a href="../optimizer-quality/index.html">Optimizer Quality</a> </li>
<li>
<a href="../qa-tools/index.html">QA Tools</a> </li>
<li><a href="../worklog-quality-checklist-template/index.html">Worklog Quality Checklist Template</a></li>
</ul> </div>     </div> <div id="content_disclaimer" class="graybox"> Content reproduced on this site is the property of its respective owners, and this content is not reviewed in advance by MariaDB. The views, information and opinions expressed by this content do not necessarily represent those of MariaDB or any other party. </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2023 MariaDB<br>Licensed under the Creative Commons Attribution 3.0 Unported License and the GNU Free Documentation License.<br>
    <a href="https://mariadb.com/kb/en/qa-aria-recovery/" class="_attribution-link">https://mariadb.com/kb/en/qa-aria-recovery/</a>
  </p>
</div>
