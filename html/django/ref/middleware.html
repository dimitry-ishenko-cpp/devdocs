<section id="s-module-django.middleware"> <h1 id="middleware">Middleware</h1> <p>This document explains all middleware components that come with Django. For information on how to use them and how to write your own middleware, see the <a class="reference internal" href="../topics/http/middleware.html"><span class="doc">middleware usage guide</span></a>.</p> <section id="s-available-middleware"> <h2 id="available-middleware">Available middleware</h2> <section id="s-module-django.middleware.cache"> <h3 id="cache-middleware">Cache middleware</h3> <dl class="py class"> <dt class="sig sig-object py" id="django.middleware.cache.UpdateCacheMiddleware">
<code>class UpdateCacheMiddleware</code> <a class="reference external" href="https://github.com/django/django/blob/stable/5.2.x/django/middleware/cache.py#L61"><span class="viewcode-link">[source]</span></a>
</dt> 
</dl> <dl class="py class"> <dt class="sig sig-object py" id="django.middleware.cache.FetchFromCacheMiddleware">
<code>class FetchFromCacheMiddleware</code> <a class="reference external" href="https://github.com/django/django/blob/stable/5.2.x/django/middleware/cache.py#L133"><span class="viewcode-link">[source]</span></a>
</dt> 
</dl> <p>Enable the site-wide cache. If these are enabled, each Django-powered page will be cached for as long as the <a class="reference internal" href="settings.html#std-setting-CACHE_MIDDLEWARE_SECONDS"><code>CACHE_MIDDLEWARE_SECONDS</code></a> setting defines. See the <a class="reference internal" href="../topics/cache.html"><span class="doc">cache documentation</span></a>.</p> </section> <section id="s-module-django.middleware.common"> <h3 id="common-middleware">“Common” middleware</h3> <dl class="py class"> <dt class="sig sig-object py" id="django.middleware.common.CommonMiddleware">
<code>class CommonMiddleware</code> <a class="reference external" href="https://github.com/django/django/blob/stable/5.2.x/django/middleware/common.py#L13"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<dl class="py attribute"> <dt class="sig sig-object py" id="django.middleware.common.CommonMiddleware.response_redirect_class">
<code>response_redirect_class</code> </dt> <dd>
<p>Defaults to <a class="reference internal" href="request-response.html#django.http.HttpResponsePermanentRedirect" title="django.http.HttpResponsePermanentRedirect"><code>HttpResponsePermanentRedirect</code></a>. Subclass <code>CommonMiddleware</code> and override the attribute to customize the redirects issued by the middleware.</p> </dd>
</dl> </dd>
</dl> <p>Adds a few conveniences for perfectionists:</p> <ul> <li>Forbids access to user agents in the <a class="reference internal" href="settings.html#std-setting-DISALLOWED_USER_AGENTS"><code>DISALLOWED_USER_AGENTS</code></a> setting, which should be a list of compiled regular expression objects.</li> <li>
<p>Performs URL rewriting based on the <a class="reference internal" href="settings.html#std-setting-APPEND_SLASH"><code>APPEND_SLASH</code></a> and <a class="reference internal" href="settings.html#std-setting-PREPEND_WWW"><code>PREPEND_WWW</code></a> settings.</p> <p>If <a class="reference internal" href="settings.html#std-setting-APPEND_SLASH"><code>APPEND_SLASH</code></a> is <code>True</code> and the initial URL doesn’t end with a slash, and it is not found in the URLconf, then a new URL is formed by appending a slash at the end. If this new URL is found in the URLconf, then Django redirects the request to this new URL. Otherwise, the initial URL is processed as usual.</p> <p>For example, <code>foo.com/bar</code> will be redirected to <code>foo.com/bar/</code> if you don’t have a valid URL pattern for <code>foo.com/bar</code> but <em>do</em> have a valid pattern for <code>foo.com/bar/</code>.</p> <p>If <a class="reference internal" href="settings.html#std-setting-PREPEND_WWW"><code>PREPEND_WWW</code></a> is <code>True</code>, URLs that lack a leading “www.” will be redirected to the same URL with a leading “www.”</p> <p>Both of these options are meant to normalize URLs. The philosophy is that each URL should exist in one, and only one, place. Technically a URL <code>foo.com/bar</code> is distinct from <code>foo.com/bar/</code> – a search-engine indexer would treat them as separate URLs – so it’s best practice to normalize URLs.</p> <p>If necessary, individual views may be excluded from the <code>APPEND_SLASH</code> behavior using the <a class="reference internal" href="../topics/http/decorators.html#django.views.decorators.common.no_append_slash" title="django.views.decorators.common.no_append_slash"><code>no_append_slash()</code></a> decorator:</p> <pre data-language="python">from django.views.decorators.common import no_append_slash


@no_append_slash
def sensitive_fbv(request, *args, **kwargs):
    """View to be excluded from APPEND_SLASH."""
    return HttpResponse()
</pre> </li> <li>Sets the <code>Content-Length</code> header for non-streaming responses.</li> </ul> <dl class="py class"> <dt class="sig sig-object py" id="django.middleware.common.BrokenLinkEmailsMiddleware">
<code>class BrokenLinkEmailsMiddleware</code> <a class="reference external" href="https://github.com/django/django/blob/stable/5.2.x/django/middleware/common.py#L118"><span class="viewcode-link">[source]</span></a>
</dt> 
</dl> <ul class="simple"> <li>Sends broken link notification emails to <a class="reference internal" href="settings.html#std-setting-MANAGERS"><code>MANAGERS</code></a> (see <a class="reference internal" href="../howto/error-reporting.html"><span class="doc">How to manage error reporting</span></a>).</li> </ul> </section> <section id="s-module-django.middleware.gzip"> <h3 id="gzip-middleware">GZip middleware</h3> <dl class="py class"> <dt class="sig sig-object py" id="django.middleware.gzip.GZipMiddleware">
<code>class GZipMiddleware</code> <a class="reference external" href="https://github.com/django/django/blob/stable/5.2.x/django/middleware/gzip.py#L9"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<dl class="py attribute"> <dt class="sig sig-object py" id="django.middleware.gzip.GZipMiddleware.max_random_bytes">
<code>max_random_bytes</code> </dt> <dd>
<p>Defaults to 100. Subclass <code>GZipMiddleware</code> and override the attribute to change the maximum number of random bytes that is included with compressed responses.</p> </dd>
</dl> </dd>
</dl> <div class="admonition note"> <p class="admonition-title">Note</p> <p>Security researchers revealed that when compression techniques (including <code>GZipMiddleware</code>) are used on a website, the site may become exposed to a number of possible attacks.</p> <p>To mitigate attacks, Django implements a technique called <em>Heal The Breach (HTB)</em>. It adds up to 100 bytes (see <a class="reference internal" href="#django.middleware.gzip.GZipMiddleware.max_random_bytes" title="django.middleware.gzip.GZipMiddleware.max_random_bytes"><code>max_random_bytes</code></a>) of random bytes to each response to make the attacks less effective.</p> <p>For more details, see the <a class="reference external" href="https://www.breachattack.com/resources/BREACH%20-%20SSL,%20gone%20in%2030%20seconds.pdf">BREACH paper (PDF)</a>, <a class="reference external" href="https://www.breachattack.com/">breachattack.com</a>, and the <a class="reference external" href="https://ieeexplore.ieee.org/document/9754554">Heal The Breach (HTB) paper</a>.</p> </div> <p>The <code>django.middleware.gzip.GZipMiddleware</code> compresses content for browsers that understand GZip compression (all modern browsers).</p> <p>This middleware should be placed before any other middleware that need to read or write the response body so that compression happens afterward.</p> <p>It will NOT compress content if any of the following are true:</p> <ul class="simple"> <li>The content body is less than 200 bytes long.</li> <li>The response has already set the <code>Content-Encoding</code> header.</li> <li>The request (the browser) hasn’t sent an <code>Accept-Encoding</code> header containing <code>gzip</code>.</li> </ul> <p>If the response has an <code>ETag</code> header, the ETag is made weak to comply with <a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc9110.html#section-8.8.1" id="index-0"><strong>RFC 9110 Section 8.8.1</strong></a>.</p> <p>You can apply GZip compression to individual views using the <a class="reference internal" href="../topics/http/decorators.html#django.views.decorators.gzip.gzip_page" title="django.views.decorators.gzip.gzip_page"><code>gzip_page()</code></a> decorator.</p> </section> <section id="s-module-django.middleware.http"> <h3 id="conditional-get-middleware">Conditional GET middleware</h3> <dl class="py class"> <dt class="sig sig-object py" id="django.middleware.http.ConditionalGetMiddleware">
<code>class ConditionalGetMiddleware</code> <a class="reference external" href="https://github.com/django/django/blob/stable/5.2.x/django/middleware/http.py#L6"><span class="viewcode-link">[source]</span></a>
</dt> 
</dl> <p>Handles conditional GET operations. If the response doesn’t have an <code>ETag</code> header, the middleware adds one if needed. If the response has an <code>ETag</code> or <code>Last-Modified</code> header, and the request has <code>If-None-Match</code> or <code>If-Modified-Since</code>, the response is replaced by an <a class="reference internal" href="request-response.html#django.http.HttpResponseNotModified" title="django.http.HttpResponseNotModified"><code>HttpResponseNotModified</code></a>.</p> <p>You can handle conditional GET operations with individual views using the <a class="reference internal" href="../topics/http/decorators.html#django.views.decorators.http.conditional_page" title="django.views.decorators.http.conditional_page"><code>conditional_page()</code></a> decorator.</p> </section> <section id="s-module-django.middleware.locale"> <h3 id="locale-middleware">Locale middleware</h3> <dl class="py class"> <dt class="sig sig-object py" id="django.middleware.locale.LocaleMiddleware">
<code>class LocaleMiddleware</code> <a class="reference external" href="https://github.com/django/django/blob/stable/5.2.x/django/middleware/locale.py#L10"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<dl class="py attribute"> <dt class="sig sig-object py" id="django.middleware.locale.LocaleMiddleware.response_redirect_class">
<code>response_redirect_class</code> </dt> <dd>
<p>Defaults to <a class="reference internal" href="request-response.html#django.http.HttpResponseRedirect" title="django.http.HttpResponseRedirect"><code>HttpResponseRedirect</code></a>. Subclass <code>LocaleMiddleware</code> and override the attribute to customize the redirects issued by the middleware.</p> </dd>
</dl> </dd>
</dl> <p>Enables language selection based on data from the request. It customizes content for each user. See the <a class="reference internal" href="../topics/i18n/translation.html"><span class="doc">internationalization documentation</span></a>.</p> </section> <section id="s-module-django.contrib.messages.middleware"> <h3 id="message-middleware">Message middleware</h3> <dl class="py class"> <dt class="sig sig-object py" id="django.contrib.messages.middleware.MessageMiddleware">
<code>class MessageMiddleware</code> <a class="reference external" href="https://github.com/django/django/blob/stable/5.2.x/django/contrib/messages/middleware.py#L6"><span class="viewcode-link">[source]</span></a>
</dt> 
</dl> <p>Enables cookie- and session-based message support. See the <a class="reference internal" href="contrib/messages.html"><span class="doc">messages documentation</span></a>.</p> </section> <section id="s-module-django.middleware.security"> <h3 id="security-middleware">Security middleware</h3> <div class="admonition warning"> <p class="admonition-title">Warning</p> <p>If your deployment situation allows, it’s usually a good idea to have your front-end web server perform the functionality provided by the <code>SecurityMiddleware</code>. That way, if there are requests that aren’t served by Django (such as static media or user-uploaded files), they will have the same protections as requests to your Django application.</p> </div> <dl class="py class"> <dt class="sig sig-object py" id="django.middleware.security.SecurityMiddleware">
<code>class SecurityMiddleware</code> <a class="reference external" href="https://github.com/django/django/blob/stable/5.2.x/django/middleware/security.py#L8"><span class="viewcode-link">[source]</span></a>
</dt> 
</dl> <p>The <code>django.middleware.security.SecurityMiddleware</code> provides several security enhancements to the request/response cycle. Each one can be independently enabled or disabled with a setting.</p> <ul class="simple"> <li><a class="reference internal" href="settings.html#std-setting-SECURE_CONTENT_TYPE_NOSNIFF"><code>SECURE_CONTENT_TYPE_NOSNIFF</code></a></li> <li><a class="reference internal" href="settings.html#std-setting-SECURE_CROSS_ORIGIN_OPENER_POLICY"><code>SECURE_CROSS_ORIGIN_OPENER_POLICY</code></a></li> <li><a class="reference internal" href="settings.html#std-setting-SECURE_HSTS_INCLUDE_SUBDOMAINS"><code>SECURE_HSTS_INCLUDE_SUBDOMAINS</code></a></li> <li><a class="reference internal" href="settings.html#std-setting-SECURE_HSTS_PRELOAD"><code>SECURE_HSTS_PRELOAD</code></a></li> <li><a class="reference internal" href="settings.html#std-setting-SECURE_HSTS_SECONDS"><code>SECURE_HSTS_SECONDS</code></a></li> <li><a class="reference internal" href="settings.html#std-setting-SECURE_REDIRECT_EXEMPT"><code>SECURE_REDIRECT_EXEMPT</code></a></li> <li><a class="reference internal" href="settings.html#std-setting-SECURE_REFERRER_POLICY"><code>SECURE_REFERRER_POLICY</code></a></li> <li><a class="reference internal" href="settings.html#std-setting-SECURE_SSL_HOST"><code>SECURE_SSL_HOST</code></a></li> <li><a class="reference internal" href="settings.html#std-setting-SECURE_SSL_REDIRECT"><code>SECURE_SSL_REDIRECT</code></a></li> </ul> <section id="s-http-strict-transport-security"> <h4 id="id2">HTTP Strict Transport Security</h4> <p>For sites that should only be accessed over HTTPS, you can instruct modern browsers to refuse to connect to your domain name via an insecure connection (for a given period of time) by setting the <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Strict-Transport-Security">“Strict-Transport-Security” header</a>. This reduces your exposure to some SSL-stripping man-in-the-middle (MITM) attacks.</p> <p><code>SecurityMiddleware</code> will set this header for you on all HTTPS responses if you set the <a class="reference internal" href="settings.html#std-setting-SECURE_HSTS_SECONDS"><code>SECURE_HSTS_SECONDS</code></a> setting to a non-zero integer value.</p> <p>When enabling HSTS, it’s a good idea to first use a small value for testing, for example, <a class="reference internal" href="settings.html#std-setting-SECURE_HSTS_SECONDS"><code>SECURE_HSTS_SECONDS = 3600</code></a> for one hour. Each time a web browser sees the HSTS header from your site, it will refuse to communicate non-securely (using HTTP) with your domain for the given period of time. Once you confirm that all assets are served securely on your site (i.e. HSTS didn’t break anything), it’s a good idea to increase this value so that infrequent visitors will be protected (31536000 seconds, i.e. 1 year, is common).</p> <p>Additionally, if you set the <a class="reference internal" href="settings.html#std-setting-SECURE_HSTS_INCLUDE_SUBDOMAINS"><code>SECURE_HSTS_INCLUDE_SUBDOMAINS</code></a> setting to <code>True</code>, <code>SecurityMiddleware</code> will add the <code>includeSubDomains</code> directive to the <code>Strict-Transport-Security</code> header. This is recommended (assuming all subdomains are served exclusively using HTTPS), otherwise your site may still be vulnerable via an insecure connection to a subdomain.</p> <p>If you wish to submit your site to the <a class="reference external" href="https://hstspreload.org/">browser preload list</a>, set the <a class="reference internal" href="settings.html#std-setting-SECURE_HSTS_PRELOAD"><code>SECURE_HSTS_PRELOAD</code></a> setting to <code>True</code>. That appends the <code>preload</code> directive to the <code>Strict-Transport-Security</code> header.</p> <div class="admonition warning"> <p class="admonition-title">Warning</p> <p>The HSTS policy applies to your entire domain, not just the URL of the response that you set the header on. Therefore, you should only use it if your entire domain is served via HTTPS only.</p> <p>Browsers properly respecting the HSTS header will refuse to allow users to bypass warnings and connect to a site with an expired, self-signed, or otherwise invalid SSL certificate. If you use HSTS, make sure your certificates are in good shape and stay that way!</p> </div> <div class="admonition note"> <p class="admonition-title">Note</p> <p>If you are deployed behind a load-balancer or reverse-proxy server, and the <code>Strict-Transport-Security</code> header is not being added to your responses, it may be because Django doesn’t realize that it’s on a secure connection; you may need to set the <a class="reference internal" href="settings.html#std-setting-SECURE_PROXY_SSL_HEADER"><code>SECURE_PROXY_SSL_HEADER</code></a> setting.</p> </div> </section> <section id="s-referrer-policy"> <h4 id="id4">Referrer Policy</h4> <p>Browsers use <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Referer">the Referer header</a> as a way to send information to a site about how users got there. When a user clicks a link, the browser will send the full URL of the linking page as the referrer. While this can be useful for some purposes – like figuring out who’s linking to your site – it also can cause privacy concerns by informing one site that a user was visiting another site.</p> <p>Some browsers have the ability to accept hints about whether they should send the HTTP <code>Referer</code> header when a user clicks a link; this hint is provided via <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Referrer-Policy">the Referrer-Policy header</a>. This header can suggest any of three behaviors to browsers:</p> <ul class="simple"> <li>Full URL: send the entire URL in the <code>Referer</code> header. For example, if the user is visiting <code>https://example.com/page.html</code>, the <code>Referer</code> header would contain <code>"https://example.com/page.html"</code>.</li> <li>Origin only: send only the “origin” in the referrer. The origin consists of the scheme, host and (optionally) port number. For example, if the user is visiting <code>https://example.com/page.html</code>, the origin would be <code>https://example.com/</code>.</li> <li>No referrer: do not send a <code>Referer</code> header at all.</li> </ul> <p>There are two types of conditions this header can tell a browser to watch out for:</p> <ul class="simple"> <li>Same-origin versus cross-origin: a link from <code>https://example.com/1.html</code> to <code>https://example.com/2.html</code> is same-origin. A link from <code>https://example.com/page.html</code> to <code>https://not.example.com/page.html</code> is cross-origin.</li> <li>Protocol downgrade: a downgrade occurs if the page containing the link is served via HTTPS, but the page being linked to is not served via HTTPS.</li> </ul> <div class="admonition warning"> <p class="admonition-title">Warning</p> <p>When your site is served via HTTPS, <a class="reference internal" href="csrf.html#how-csrf-works"><span class="std std-ref">Django’s CSRF protection system</span></a> requires the <code>Referer</code> header to be present, so completely disabling the <code>Referer</code> header will interfere with CSRF protection. To gain most of the benefits of disabling <code>Referer</code> headers while also keeping CSRF protection, consider enabling only same-origin referrers.</p> </div> <p><code>SecurityMiddleware</code> can set the <code>Referrer-Policy</code> header for you, based on the <a class="reference internal" href="settings.html#std-setting-SECURE_REFERRER_POLICY"><code>SECURE_REFERRER_POLICY</code></a> setting (note spelling: browsers send a <code>Referer</code> header when a user clicks a link, but the header instructing a browser whether to do so is spelled <code>Referrer-Policy</code>). The valid values for this setting are:</p> <dl class="simple"> <dt>
<code>no-referrer</code> </dt>
<dd>
<p>Instructs the browser to send no referrer for links clicked on this site.</p> </dd> <dt>
<code>no-referrer-when-downgrade</code> </dt>
<dd>
<p>Instructs the browser to send a full URL as the referrer, but only when no protocol downgrade occurs.</p> </dd> <dt>
<code>origin</code> </dt>
<dd>
<p>Instructs the browser to send only the origin, not the full URL, as the referrer.</p> </dd> <dt>
<code>origin-when-cross-origin</code> </dt>
<dd>
<p>Instructs the browser to send the full URL as the referrer for same-origin links, and only the origin for cross-origin links.</p> </dd> <dt>
<code>same-origin</code> </dt>
<dd>
<p>Instructs the browser to send a full URL, but only for same-origin links. No referrer will be sent for cross-origin links.</p> </dd> <dt>
<code>strict-origin</code> </dt>
<dd>
<p>Instructs the browser to send only the origin, not the full URL, and to send no referrer when a protocol downgrade occurs.</p> </dd> <dt>
<code>strict-origin-when-cross-origin</code> </dt>
<dd>
<p>Instructs the browser to send the full URL when the link is same-origin and no protocol downgrade occurs; send only the origin when the link is cross-origin and no protocol downgrade occurs; and no referrer when a protocol downgrade occurs.</p> </dd> <dt>
<code>unsafe-url</code> </dt>
<dd>
<p>Instructs the browser to always send the full URL as the referrer.</p> </dd> </dl> <div class="admonition-unknown-policy-values admonition"> <p class="admonition-title">Unknown Policy Values</p> <p>Where a policy value is <a class="reference external" href="https://w3c.github.io/webappsec-referrer-policy/#unknown-policy-values">unknown</a> by a user agent, it is possible to specify multiple policy values to provide a fallback. The last specified value that is understood takes precedence. To support this, an iterable or comma-separated string can be used with <a class="reference internal" href="settings.html#std-setting-SECURE_REFERRER_POLICY"><code>SECURE_REFERRER_POLICY</code></a>.</p> </div> </section> <section id="s-cross-origin-opener-policy"> <h4 id="id8">Cross-Origin Opener Policy</h4> <p>Some browsers have the ability to isolate top-level windows from other documents by putting them in a separate browsing context group based on the value of the <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cross-Origin-Opener-Policy">Cross-Origin Opener Policy</a> (COOP) header. If a document that is isolated in this way opens a cross-origin popup window, the popup’s <code>window.opener</code> property will be <code>null</code>. Isolating windows using COOP is a defense-in-depth protection against cross-origin attacks, especially those like Spectre which allowed exfiltration of data loaded into a shared browsing context.</p> <p><code>SecurityMiddleware</code> can set the <code>Cross-Origin-Opener-Policy</code> header for you, based on the <a class="reference internal" href="settings.html#std-setting-SECURE_CROSS_ORIGIN_OPENER_POLICY"><code>SECURE_CROSS_ORIGIN_OPENER_POLICY</code></a> setting. The valid values for this setting are:</p> <dl class="simple"> <dt>
<code>same-origin</code> </dt>
<dd>
<p>Isolates the browsing context exclusively to same-origin documents. Cross-origin documents are not loaded in the same browsing context. This is the default and most secure option.</p> </dd> <dt>
<code>same-origin-allow-popups</code> </dt>
<dd>
<p>Isolates the browsing context to same-origin documents or those which either don’t set COOP or which opt out of isolation by setting a COOP of <code>unsafe-none</code>.</p> </dd> <dt>
<code>unsafe-none</code> </dt>
<dd>
<p>Allows the document to be added to its opener’s browsing context group unless the opener itself has a COOP of <code>same-origin</code> or <code>same-origin-allow-popups</code>.</p> </dd> </dl> </section> <section id="s-x-content-type-options-nosniff"> <h4 id="x-content-type-options"><code>X-Content-Type-Options: nosniff</code></h4> <p>Some browsers will try to guess the content types of the assets that they fetch, overriding the <code>Content-Type</code> header. While this can help display sites with improperly configured servers, it can also pose a security risk.</p> <p>If your site serves user-uploaded files, a malicious user could upload a specially-crafted file that would be interpreted as HTML or JavaScript by the browser when you expected it to be something harmless.</p> <p>To prevent the browser from guessing the content type and force it to always use the type provided in the <code>Content-Type</code> header, you can pass the <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Content-Type-Options">X-Content-Type-Options: nosniff</a> header. <code>SecurityMiddleware</code> will do this for all responses if the <a class="reference internal" href="settings.html#std-setting-SECURE_CONTENT_TYPE_NOSNIFF"><code>SECURE_CONTENT_TYPE_NOSNIFF</code></a> setting is <code>True</code>.</p> <p>Note that in most deployment situations where Django isn’t involved in serving user-uploaded files, this setting won’t help you. For example, if your <a class="reference internal" href="settings.html#std-setting-MEDIA_URL"><code>MEDIA_URL</code></a> is served directly by your front-end web server (nginx, Apache, etc.) then you’d want to set this header there. On the other hand, if you are using Django to do something like require authorization in order to download files and you cannot set the header using your web server, this setting will be useful.</p> </section> <section id="s-ssl-redirect"> <h4 id="id11">SSL Redirect</h4> <p>If your site offers both HTTP and HTTPS connections, most users will end up with an unsecured connection by default. For best security, you should redirect all HTTP connections to HTTPS.</p> <p>If you set the <a class="reference internal" href="settings.html#std-setting-SECURE_SSL_REDIRECT"><code>SECURE_SSL_REDIRECT</code></a> setting to True, <code>SecurityMiddleware</code> will permanently (HTTP 301) redirect all HTTP connections to HTTPS.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>For performance reasons, it’s preferable to do these redirects outside of Django, in a front-end load balancer or reverse-proxy server such as <a class="reference external" href="https://nginx.org/">nginx</a>. <a class="reference internal" href="settings.html#std-setting-SECURE_SSL_REDIRECT"><code>SECURE_SSL_REDIRECT</code></a> is intended for the deployment situations where this isn’t an option.</p> </div> <p>If the <a class="reference internal" href="settings.html#std-setting-SECURE_SSL_HOST"><code>SECURE_SSL_HOST</code></a> setting has a value, all redirects will be sent to that host instead of the originally-requested host.</p> <p>If there are a few pages on your site that should be available over HTTP, and not redirected to HTTPS, you can list regular expressions to match those URLs in the <a class="reference internal" href="settings.html#std-setting-SECURE_REDIRECT_EXEMPT"><code>SECURE_REDIRECT_EXEMPT</code></a> setting.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>If you are deployed behind a load-balancer or reverse-proxy server and Django can’t seem to tell when a request actually is already secure, you may need to set the <a class="reference internal" href="settings.html#std-setting-SECURE_PROXY_SSL_HEADER"><code>SECURE_PROXY_SSL_HEADER</code></a> setting.</p> </div> </section> </section> <section id="s-module-django.contrib.sessions.middleware"> <h3 id="session-middleware">Session middleware</h3> <dl class="py class"> <dt class="sig sig-object py" id="django.contrib.sessions.middleware.SessionMiddleware">
<code>class SessionMiddleware</code> <a class="reference external" href="https://github.com/django/django/blob/stable/5.2.x/django/contrib/sessions/middleware.py#L12"><span class="viewcode-link">[source]</span></a>
</dt> 
</dl> <p>Enables session support. See the <a class="reference internal" href="../topics/http/sessions.html"><span class="doc">session documentation</span></a>.</p> </section> <section id="s-module-django.contrib.sites.middleware"> <h3 id="site-middleware">Site middleware</h3> <dl class="py class"> <dt class="sig sig-object py" id="django.contrib.sites.middleware.CurrentSiteMiddleware">
<code>class CurrentSiteMiddleware</code> <a class="reference external" href="https://github.com/django/django/blob/stable/5.2.x/django/contrib/sites/middleware.py#L6"><span class="viewcode-link">[source]</span></a>
</dt> 
</dl> <p>Adds the <code>site</code> attribute representing the current site to every incoming <code>HttpRequest</code> object. See the <a class="reference internal" href="contrib/sites.html#site-middleware"><span class="std std-ref">sites documentation</span></a>.</p> </section> <section id="s-module-django.contrib.auth.middleware"> <h3 id="authentication-middleware">Authentication middleware</h3> <dl class="py class"> <dt class="sig sig-object py" id="django.contrib.auth.middleware.AuthenticationMiddleware">
<code>class AuthenticationMiddleware</code> <a class="reference external" href="https://github.com/django/django/blob/stable/5.2.x/django/contrib/auth/middleware.py#L29"><span class="viewcode-link">[source]</span></a>
</dt> 
</dl> <p>Adds the <code>user</code> attribute, representing the currently-logged-in user, to every incoming <code>HttpRequest</code> object. See <a class="reference internal" href="../topics/auth/default.html#auth-web-requests"><span class="std std-ref">Authentication in web requests</span></a>.</p> <dl class="py class"> <dt class="sig sig-object py" id="django.contrib.auth.middleware.LoginRequiredMiddleware">
<code>class LoginRequiredMiddleware</code> <a class="reference external" href="https://github.com/django/django/blob/stable/5.2.x/django/contrib/auth/middleware.py#L43"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<p>Subclass the middleware and override the following attributes and methods to customize behavior for unauthenticated requests.</p> <dl class="py attribute"> <dt class="sig sig-object py" id="django.contrib.auth.middleware.LoginRequiredMiddleware.redirect_field_name">
<code>redirect_field_name</code> </dt> <dd>
<p>Defaults to <code>"next"</code>.</p> </dd>
</dl> <dl class="py method"> <dt class="sig sig-object py" id="django.contrib.auth.middleware.LoginRequiredMiddleware.get_login_url">
<code>get_login_url()</code> <a class="reference external" href="https://github.com/django/django/blob/stable/5.2.x/django/contrib/auth/middleware.py#L61"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<p>Returns the URL that unauthenticated requests will be redirected to. This result is either the <code>login_url</code> set on the <a class="reference internal" href="../topics/auth/default.html#django.contrib.auth.decorators.login_required" title="django.contrib.auth.decorators.login_required"><code>login_required()</code></a> decorator (if not <code>None</code>), or <a class="reference internal" href="settings.html#std-setting-LOGIN_URL"><code>settings.LOGIN_URL</code></a>.</p> </dd>
</dl> <dl class="py method"> <dt class="sig sig-object py" id="django.contrib.auth.middleware.LoginRequiredMiddleware.get_redirect_field_name">
<code>get_redirect_field_name()</code> <a class="reference external" href="https://github.com/django/django/blob/stable/5.2.x/django/contrib/auth/middleware.py#L71"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<p>Returns the name of the query parameter that contains the URL the user should be redirected to after a successful login. This result is either the <code>redirect_field_name</code> set on the <a class="reference internal" href="../topics/auth/default.html#django.contrib.auth.decorators.login_required" title="django.contrib.auth.decorators.login_required"><code>login_required()</code></a> decorator (if not <code>None</code>), or <a class="reference internal" href="#django.contrib.auth.middleware.LoginRequiredMiddleware.redirect_field_name" title="django.contrib.auth.middleware.LoginRequiredMiddleware.redirect_field_name"><code>redirect_field_name</code></a>. If <code>None</code> is returned, a query parameter won’t be added.</p> </dd>
</dl> </dd>
</dl> <div class="versionadded"> <span class="title">New in Django 5.1.</span> </div> <p>Redirects all unauthenticated requests to a login page, except for views excluded with <a class="reference internal" href="../topics/auth/default.html#django.contrib.auth.decorators.login_not_required" title="django.contrib.auth.decorators.login_not_required"><code>login_not_required()</code></a>. The login page defaults to <a class="reference internal" href="settings.html#std-setting-LOGIN_URL"><code>settings.LOGIN_URL</code></a>, but can be customized.</p> <p>Enable this middleware by adding it to the <a class="reference internal" href="settings.html#std-setting-MIDDLEWARE"><code>MIDDLEWARE</code></a> setting <strong>after</strong> <a class="reference internal" href="#django.contrib.auth.middleware.AuthenticationMiddleware" title="django.contrib.auth.middleware.AuthenticationMiddleware"><code>AuthenticationMiddleware</code></a>:</p> <pre data-language="python">MIDDLEWARE = [
    "...",
    "django.contrib.auth.middleware.AuthenticationMiddleware",
    "django.contrib.auth.middleware.LoginRequiredMiddleware",
    "...",
]
</pre> <p>Make a view public, allowing unauthenticated requests, with <a class="reference internal" href="../topics/auth/default.html#django.contrib.auth.decorators.login_not_required" title="django.contrib.auth.decorators.login_not_required"><code>login_not_required()</code></a>. For example:</p> <pre data-language="python">from django.contrib.auth.decorators import login_not_required


@login_not_required
def contact_us(request): ...
</pre> <p>Customize the login URL or field name for authenticated views with the <a class="reference internal" href="../topics/auth/default.html#django.contrib.auth.decorators.login_required" title="django.contrib.auth.decorators.login_required"><code>login_required()</code></a> decorator to set <code>login_url</code> or <code>redirect_field_name</code> respectively. For example:</p> <pre data-language="python">from django.contrib.auth.decorators import login_required
from django.utils.decorators import method_decorator
from django.views.generic import View


@login_required(login_url="/books/login/", redirect_field_name="redirect_to")
def book_dashboard(request): ...


@method_decorator(
    login_required(login_url="/books/login/", redirect_field_name="redirect_to"),
    name="dispatch",
)
class BookMetrics(View):
    pass
</pre> <div class="admonition-ensure-that-your-login-view-does-not-require-a-login admonition"> <p class="admonition-title">Ensure that your login view does not require a login.</p> <p>To prevent infinite redirects, ensure you have <a class="reference internal" href="../topics/auth/default.html#disable-login-required-middleware-for-views"><span class="std std-ref">enabled unauthenticated requests</span></a> to your login view.</p> </div> <dl class="py class"> <dt class="sig sig-object py" id="django.contrib.auth.middleware.RemoteUserMiddleware">
<code>class RemoteUserMiddleware</code> <a class="reference external" href="https://github.com/django/django/blob/stable/5.2.x/django/contrib/auth/middleware.py#L93"><span class="viewcode-link">[source]</span></a>
</dt> 
</dl> <p>Middleware for utilizing web server provided authentication. See <a class="reference internal" href="../howto/auth-remote-user.html"><span class="doc">How to authenticate using REMOTE_USER</span></a> for usage details.</p> <dl class="py class"> <dt class="sig sig-object py" id="django.contrib.auth.middleware.PersistentRemoteUserMiddleware">
<code>class PersistentRemoteUserMiddleware</code> <a class="reference external" href="https://github.com/django/django/blob/stable/5.2.x/django/contrib/auth/middleware.py#L260"><span class="viewcode-link">[source]</span></a>
</dt> 
</dl> <p>Middleware for utilizing web server provided authentication when enabled only on the login page. See <a class="reference internal" href="../howto/auth-remote-user.html#persistent-remote-user-middleware-howto"><span class="std std-ref">Using REMOTE_USER on login pages only</span></a> for usage details.</p> </section> <section id="s-csrf-protection-middleware"> <h3 id="csrf-protection-middleware">CSRF protection middleware</h3> <dl class="py class"> <dt class="sig sig-object py" id="django.middleware.csrf.CsrfViewMiddleware">
<code>class CsrfViewMiddleware</code> <a class="reference external" href="https://github.com/django/django/blob/stable/5.2.x/django/middleware/csrf.py#L165"><span class="viewcode-link">[source]</span></a>
</dt> 
</dl> <p>Adds protection against Cross Site Request Forgeries by adding hidden form fields to POST forms and checking requests for the correct value. See the <a class="reference internal" href="csrf.html"><span class="doc">Cross Site Request Forgery protection documentation</span></a>.</p> <p>You can add Cross Site Request Forgery protection to individual views using the <a class="reference internal" href="csrf.html#django.views.decorators.csrf.csrf_protect" title="django.views.decorators.csrf.csrf_protect"><code>csrf_protect()</code></a> decorator.</p> </section> <section id="s-x-frame-options-middleware"> <h3 id="x-frame-options-middleware">
<code>X-Frame-Options</code> middleware</h3> <dl class="py class"> <dt class="sig sig-object py" id="django.middleware.clickjacking.XFrameOptionsMiddleware">
<code>class XFrameOptionsMiddleware</code> <a class="reference external" href="https://github.com/django/django/blob/stable/5.2.x/django/middleware/clickjacking.py#L12"><span class="viewcode-link">[source]</span></a>
</dt> 
</dl> <p>Simple <a class="reference internal" href="clickjacking.html"><span class="doc">clickjacking protection via the X-Frame-Options header</span></a>.</p> </section> </section> <section id="s-middleware-ordering"> <h2 id="id12">Middleware ordering</h2> <p>Here are some hints about the ordering of various Django middleware classes:</p> <ol class="arabic"> <li>
<p><a class="reference internal" href="#django.middleware.security.SecurityMiddleware" title="django.middleware.security.SecurityMiddleware"><code>SecurityMiddleware</code></a></p> <p>It should go near the top of the list if you’re going to turn on the SSL redirect as that avoids running through a bunch of other unnecessary middleware.</p> </li> <li>
<p><a class="reference internal" href="#django.middleware.cache.UpdateCacheMiddleware" title="django.middleware.cache.UpdateCacheMiddleware"><code>UpdateCacheMiddleware</code></a></p> <p>Before those that modify the <code>Vary</code> header (<code>SessionMiddleware</code>, <code>GZipMiddleware</code>, <code>LocaleMiddleware</code>).</p> </li> <li>
<p><a class="reference internal" href="#django.middleware.gzip.GZipMiddleware" title="django.middleware.gzip.GZipMiddleware"><code>GZipMiddleware</code></a></p> <p>Before any middleware that may change or use the response body.</p> <p>After <code>UpdateCacheMiddleware</code>: Modifies <code>Vary</code> header.</p> </li> <li>
<p><a class="reference internal" href="#django.contrib.sessions.middleware.SessionMiddleware" title="django.contrib.sessions.middleware.SessionMiddleware"><code>SessionMiddleware</code></a></p> <p>Before any middleware that may raise an exception to trigger an error view (such as <a class="reference internal" href="exceptions.html#django.core.exceptions.PermissionDenied" title="django.core.exceptions.PermissionDenied"><code>PermissionDenied</code></a>) if you’re using <a class="reference internal" href="settings.html#std-setting-CSRF_USE_SESSIONS"><code>CSRF_USE_SESSIONS</code></a>.</p> <p>After <code>UpdateCacheMiddleware</code>: Modifies <code>Vary</code> header.</p> </li> <li>
<p><a class="reference internal" href="#django.middleware.http.ConditionalGetMiddleware" title="django.middleware.http.ConditionalGetMiddleware"><code>ConditionalGetMiddleware</code></a></p> <p>Before any middleware that may change the response (it sets the <code>ETag</code> header).</p> <p>After <code>GZipMiddleware</code> so it won’t calculate an <code>ETag</code> header on gzipped contents.</p> </li> <li>
<p><a class="reference internal" href="#django.middleware.locale.LocaleMiddleware" title="django.middleware.locale.LocaleMiddleware"><code>LocaleMiddleware</code></a></p> <p>One of the topmost, after <code>SessionMiddleware</code> (uses session data) and <code>UpdateCacheMiddleware</code> (modifies <code>Vary</code> header).</p> </li> <li>
<p><a class="reference internal" href="#django.middleware.common.CommonMiddleware" title="django.middleware.common.CommonMiddleware"><code>CommonMiddleware</code></a></p> <p>Before any middleware that may change the response (it sets the <code>Content-Length</code> header). A middleware that appears before <code>CommonMiddleware</code> and changes the response must reset <code>Content-Length</code>.</p> <p>Close to the top: it redirects when <a class="reference internal" href="settings.html#std-setting-APPEND_SLASH"><code>APPEND_SLASH</code></a> or <a class="reference internal" href="settings.html#std-setting-PREPEND_WWW"><code>PREPEND_WWW</code></a> are set to <code>True</code>.</p> <p>After <code>SessionMiddleware</code> if you’re using <a class="reference internal" href="settings.html#std-setting-CSRF_USE_SESSIONS"><code>CSRF_USE_SESSIONS</code></a>.</p> </li> <li>
<p><a class="reference internal" href="#django.middleware.csrf.CsrfViewMiddleware" title="django.middleware.csrf.CsrfViewMiddleware"><code>CsrfViewMiddleware</code></a></p> <p>Before any view middleware that assumes that CSRF attacks have been dealt with.</p> <p>Before <a class="reference internal" href="#django.contrib.auth.middleware.RemoteUserMiddleware" title="django.contrib.auth.middleware.RemoteUserMiddleware"><code>RemoteUserMiddleware</code></a>, or any other authentication middleware that may perform a login, and hence rotate the CSRF token, before calling down the middleware chain.</p> <p>After <code>SessionMiddleware</code> if you’re using <a class="reference internal" href="settings.html#std-setting-CSRF_USE_SESSIONS"><code>CSRF_USE_SESSIONS</code></a>.</p> </li> <li>
<p><a class="reference internal" href="#django.contrib.auth.middleware.AuthenticationMiddleware" title="django.contrib.auth.middleware.AuthenticationMiddleware"><code>AuthenticationMiddleware</code></a></p> <p>After <code>SessionMiddleware</code>: uses session storage.</p> </li> <li>
<p><a class="reference internal" href="#django.contrib.auth.middleware.LoginRequiredMiddleware" title="django.contrib.auth.middleware.LoginRequiredMiddleware"><code>LoginRequiredMiddleware</code></a></p> <div class="versionadded"> <span class="title">New in Django 5.1.</span> </div> <p>After <code>AuthenticationMiddleware</code>: uses user object.</p> </li> <li>
<p><a class="reference internal" href="#django.contrib.messages.middleware.MessageMiddleware" title="django.contrib.messages.middleware.MessageMiddleware"><code>MessageMiddleware</code></a></p> <p>After <code>SessionMiddleware</code>: can use session-based storage.</p> </li> <li>
<p><a class="reference internal" href="#django.middleware.cache.FetchFromCacheMiddleware" title="django.middleware.cache.FetchFromCacheMiddleware"><code>FetchFromCacheMiddleware</code></a></p> <p>After any middleware that modifies the <code>Vary</code> header: that header is used to pick a value for the cache hash-key.</p> </li> <li>
<p><a class="reference internal" href="contrib/flatpages.html#django.contrib.flatpages.middleware.FlatpageFallbackMiddleware" title="django.contrib.flatpages.middleware.FlatpageFallbackMiddleware"><code>FlatpageFallbackMiddleware</code></a></p> <p>Should be near the bottom as it’s a last-resort type of middleware.</p> </li> <li>
<p><a class="reference internal" href="contrib/redirects.html#django.contrib.redirects.middleware.RedirectFallbackMiddleware" title="django.contrib.redirects.middleware.RedirectFallbackMiddleware"><code>RedirectFallbackMiddleware</code></a></p> <p>Should be near the bottom as it’s a last-resort type of middleware.</p> </li> </ol> </section> </section><div class="_attribution">
  <p class="_attribution-p">
    &copy; Django Software Foundation and individual contributors<br>Licensed under the BSD License.<br>
    <a href="https://docs.djangoproject.com/en/5.2/ref/middleware/" class="_attribution-link">https://docs.djangoproject.com/en/5.2/ref/middleware/</a>
  </p>
</div>
