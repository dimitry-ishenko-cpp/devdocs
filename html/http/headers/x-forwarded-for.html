<h1>X-Forwarded-For</h1>
<h1>X-Forwarded-For</h1>
<div class="section-content">
<p>The <code>X-Forwarded-For</code> (XFF) request header is a de-facto standard header for identifying the originating IP address of a client connecting to a web server through a proxy server.</p> <div class="notecard warning" id="sect1"> <p><strong>Warning:</strong> Improper use of this header can be a security risk. For details, see the <a href="#security_and_privacy_concerns">Security and privacy concerns</a> section.</p> </div> <p> When a client connects directly to a server, the client's IP address is sent to the server (and is often written to server access logs). But if a client connection passes through any <a href="https://en.wikipedia.org/wiki/Proxy_server" rel=" noopener">forward or reverse</a> proxies, the server only sees the final proxy's IP address, which is often of little use. That's especially true if the final proxy is a load balancer which is part of the same installation as the server. So, to provide a more-useful client IP address to the server, the <code>X-Forwarded-For</code> request header is used. </p> <p>For detailed guidance on using this header, see the <a href="#parsing">Parsing</a> and <a href="#selecting_an_ip_address">Selecting an IP address</a> sections.</p> <figure class="table-container"><div class="_table"><table class="properties"> <tbody> <tr> <th scope="row">Header type</th> <td><a href="https://developer.mozilla.org/en-US/docs/Glossary/Request_header">Request header</a></td> </tr> <tr> <th scope="row"><a href="https://developer.mozilla.org/en-US/docs/Glossary/Forbidden_header_name">Forbidden header name</a></th> <td>no</td> </tr> </tbody> </table></div></figure> <p>A standardized version of this header is the HTTP <a href="forwarded.html"><code>Forwarded</code></a> header.</p>
</div>
<section aria-labelledby="security_and_privacy_concerns"><h2 id="security_and_privacy_concerns">Security and privacy concerns</h2>
<div class="section-content">
<p> This header, by design, exposes privacy-sensitive information, such as the IP address of the client. Therefore the user's privacy must be kept in mind when deploying this header. </p> <p> The <code>X-Forwarded-For</code> header is untrustworthy when no trusted reverse proxy (e.g., a load balancer) is between the client and server. If the client and all proxies are benign and well-behaved, then the list of IP addresses in the header has the meaning described in the <a href="#directives">Directives</a> section. But if there's a risk the client or any proxy is malicious or misconfigured, then it's possible any part (or the entirety) of the header may have been spoofed (and may not be a list or contain IP addresses at all). </p> <p> If any trusted reverse proxies are between the client and server, the final <code>X-Forwarded-For</code> IP addresses (one for each trusted proxy) are trustworthy, as they were added by trusted proxies. (That's true as long as the server is <em>only</em> accessible through those proxies and not also directly). </p> <p> Any security-related use of <code>X-Forwarded-For</code> (such as for rate limiting or IP-based access control) <em>must only</em> use IP addresses added by a trusted proxy. Using untrustworthy values can result in rate-limiter avoidance, access-control bypass, memory exhaustion, or other negative security or availability consequences. </p> <p> Conversely, leftmost (untrusted) values must only be used where there will be no negative impact from the possibility of using spoofed values. </p>
</div></section><section aria-labelledby="syntax"><h2 id="syntax">Syntax</h2>
<div class="section-content">
<div class="code-example"><pre data-language="http"><span class="token header"><span class="token header-name keyword">X-Forwarded-For</span><span class="token punctuation">:</span> <span class="token header-value">&lt;client&gt;, &lt;proxy1&gt;, &lt;proxy2&gt;</span></span>
</pre></div> <p>Elements are comma-separated, with optional whitespace surrounding the commas.</p>
</div></section><section aria-labelledby="directives"><h2 id="directives">Directives</h2>
<div class="section-content"><dl> <dt id="client">&lt;client&gt;</dt> <dd> <p>The client IP address</p> </dd> <dt id="proxy1_proxy2">&lt;proxy1&gt;, &lt;proxy2&gt;</dt> <dd> <p> If a request goes through multiple proxies, the IP addresses of each successive proxy is listed. This means that, given well-behaved client and proxies, the rightmost IP address is the IP address of the most recent proxy and the leftmost IP address is the IP address of the originating client. </p> </dd> </dl></div></section><section aria-labelledby="examples"><h2 id="examples">Examples</h2>
<div class="section-content"><div class="code-example"><pre data-language="http"><span class="token header"><span class="token header-name keyword">X-Forwarded-For</span><span class="token punctuation">:</span> <span class="token header-value">2001:db8:85a3:8d3:1319:8a2e:370:7348</span></span>

<span class="token header"><span class="token header-name keyword">X-Forwarded-For</span><span class="token punctuation">:</span> <span class="token header-value">203.0.113.195</span></span>

<span class="token header"><span class="token header-name keyword">X-Forwarded-For</span><span class="token punctuation">:</span> <span class="token header-value">203.0.113.195, 2001:db8:85a3:8d3:1319:8a2e:370:7348</span></span>

<span class="token header"><span class="token header-name keyword">X-Forwarded-For</span><span class="token punctuation">:</span> <span class="token header-value">203.0.113.195,2001:db8:85a3:8d3:1319:8a2e:370:7348,150.172.238.178</span></span>
</pre></div></div></section><section aria-labelledby="parsing"><h2 id="parsing">Parsing</h2>
<div class="section-content">
<p> Improper parsing of the <code>X-Forwarded-For</code> header can result in spoofed values being used for security-related purposes, resulting in the negative consequences mentioned above. </p> <p> There may be multiple <code>X-Forwarded-For</code> headers present in a request (per <a href="https://datatracker.ietf.org/doc/html/rfc2616#section-4.2" rel=" noopener">RFC 2616</a>). The IP addresses in these headers must be treated as a single list, starting with the first IP address of the first header and continuing to the last IP address of the last header. There are two ways of making this single list: </p> <ul> <li>join the <code>X-Forwarded-For</code> full header values with commas and then split by comma into a list, or</li> <li>split each <code>X-Forwarded-For</code> header by comma into lists and then join the lists</li> </ul> <p>It is insufficient to use only one of multiple <code>X-Forwarded-For</code> headers.</p> <p> (Some reverse proxies will automatically join multiple <code>X-Forwarded-For</code> headers into one, but it is safest to not assume that this is the case.) </p>
</div></section><section aria-labelledby="selecting_an_ip_address"><h2 id="selecting_an_ip_address">Selecting an IP address</h2>
<div class="section-content">
<p>When selecting an address, the full list of IPs — from all <code>X-Forwarded-For</code> headers — must be used.</p> <p> When choosing the <code>X-Forwarded-For</code> client IP address closest to the client (untrustworthy and <em>not</em> for security-related purposes), the first IP from the leftmost that is <em>a valid address</em> and <em>not private/internal</em> should be selected. ("Valid" because spoofed values may not be IP addresses at all; "not internal/private" because clients may have used proxies on their internal network, which may have added addresses from the <a href="https://en.wikipedia.org/wiki/Private_network" rel=" noopener">private IP space</a>.) </p> <p> When choosing the first <em>trustworthy</em> <code>X-Forwarded-For</code> client IP address, additional configuration is required. There are two common methods: </p> <ul> <li> <strong>Trusted proxy count</strong>: The count of reverse proxies between the internet and the server is configured. The <code>X-Forwarded-For</code> IP list is searched from the rightmost by that count minus one. (For example, if there is only one reverse proxy, that proxy will add the client's IP address, so the rightmost address should be used. If there are three reverse proxies, the last two IP addresses will be internal.) </li> <li> <strong>Trusted proxy list</strong>: The IPs or IP ranges of the trusted reverse proxies are configured. The <code>X-Forwarded-For</code> IP list is searched from the rightmost, skipping all addresses that are on the trusted proxy list. The first non-matching address is the target address. </li> </ul> <p> The first trustworthy <code>X-Forwarded-For</code> IP address may belong to an untrusted intermediate proxy rather than the actual client computer, but it is the only IP suitable for security uses. </p> <p> Note that if the server is directly connectable from the internet — even if it is also behind a trusted reverse proxy — <em>no part</em> of the <code>X-Forwarded-For</code> IP list can be considered trustworthy or safe for security-related uses. </p>
</div></section><section aria-labelledby="specifications"><h2 id="specifications">Specifications</h2>
<div class="section-content"><p> Not part of any current specification. The standardized version of this header is <a href="forwarded.html"><code>Forwarded</code></a>. </p></div></section><section aria-labelledby="see_also"><h2 id="see_also">See also</h2>
<div class="section-content"><ul> <li><a href="forwarded.html"><code>Forwarded</code></a></li> <li><a href="x-forwarded-host.html"><code>X-Forwarded-Host</code></a></li> <li><a href="x-forwarded-proto.html"><code>X-Forwarded-Proto</code></a></li> <li><a href="via.html"><code>Via</code></a></li> </ul></div></section><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2005&ndash;2022 MDN contributors.<br>Licensed under the Creative Commons Attribution-ShareAlike License v2.5 or later.<br>
    <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Forwarded-For" class="_attribution-link">https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Forwarded-For</a>
  </p>
</div>
