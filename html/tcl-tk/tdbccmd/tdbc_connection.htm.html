<h1>tdbc_connection</h1>  <dl> <dd id="L8">
<a href="tdbc_connection.htm.html#M2" name="L8">NAME</a> <dl><dd>tdbc::connection — TDBC connection object</dd></dl> <dd id="L9">
<a href="tdbc_connection.htm.html#M3" name="L9">SYNOPSIS</a>  <dd id="L10">
<a href="tdbc_connection.htm.html#M4" name="L10">DESCRIPTION</a> <dl class="description"> <dd id="L11">
<a href="tdbc_connection.htm.html#M5" name="L11"><b>type</b></a> <dd id="L12">
<a href="tdbc_connection.htm.html#M6" name="L12"><b>precision</b></a> <dd id="L13">
<a href="tdbc_connection.htm.html#M7" name="L13"><b>scale</b></a> <dd id="L14">
<a href="tdbc_connection.htm.html#M8" name="L14"><b>nullable</b></a> </dd>
</dd>
</dd>
</dd>
</dl> <dl class="description"> <dd id="L15">
<a href="tdbc_connection.htm.html#M9" name="L15"><b>tableCatalog</b></a> <dd id="L16">
<a href="tdbc_connection.htm.html#M10" name="L16"><b>tableSchema</b></a> <dd id="L17">
<a href="tdbc_connection.htm.html#M11" name="L17"><b>tableName</b></a> <dd id="L18">
<a href="tdbc_connection.htm.html#M12" name="L18"><b>constraintCatalog</b></a> <dd id="L19">
<a href="tdbc_connection.htm.html#M13" name="L19"><b>constraintSchema</b></a> <dd id="L20">
<a href="tdbc_connection.htm.html#M14" name="L20"><b>constraintName</b></a> <dd id="L21">
<a href="tdbc_connection.htm.html#M15" name="L21"><b>columnName</b></a> <dd id="L22">
<a href="tdbc_connection.htm.html#M16" name="L22"><b>ordinalPosition</b></a> </dd>
</dd>
</dd>
</dd>
</dd>
</dd>
</dd>
</dd>
</dl> <dl class="description"> <dd id="L23">
<a href="tdbc_connection.htm.html#M17" name="L23"><b>foreignConstraintCatalog</b></a> <dd id="L24">
<a href="tdbc_connection.htm.html#M18" name="L24"><b>foreignConstraintSchema</b></a> <dd id="L25">
<a href="tdbc_connection.htm.html#M19" name="L25"><b>foreignConstraintName</b></a> <dd id="L26">
<a href="tdbc_connection.htm.html#M20" name="L26"><b>primaryConstraintCatalog</b></a> <dd id="L27">
<a href="tdbc_connection.htm.html#M21" name="L27"><b>primaryConstraintSchema</b></a> <dd id="L28">
<a href="tdbc_connection.htm.html#M22" name="L28"><b>primaryConstraintName</b></a> <dd id="L29">
<a href="tdbc_connection.htm.html#M23" name="L29"><b>updateAction</b></a> <dd id="L30">
<a href="tdbc_connection.htm.html#M24" name="L30"><b>deleteAction</b></a> <dd id="L31">
<a href="tdbc_connection.htm.html#M25" name="L31"><b>primaryCatalog</b></a> <dd id="L32">
<a href="tdbc_connection.htm.html#M26" name="L32"><b>primarySchema</b></a> </dd>
</dd>
</dd>
</dd>
</dd>
</dd>
</dd>
</dd>
</dd>
</dd>
</dl> <dl class="description"> <dd id="L33">
<a href="tdbc_connection.htm.html#M27" name="L33"><b>primaryTable</b></a> <dd id="L34">
<a href="tdbc_connection.htm.html#M28" name="L34"><b>primaryColumn</b></a> <dd id="L35">
<a href="tdbc_connection.htm.html#M29" name="L35"><b>foreignCatalog</b></a> <dd id="L36">
<a href="tdbc_connection.htm.html#M30" name="L36"><b>foreignSchema</b></a> <dd id="L37">
<a href="tdbc_connection.htm.html#M31" name="L37"><b>foreignTable</b></a> <dd id="L38">
<a href="tdbc_connection.htm.html#M32" name="L38"><b>foreignColumn</b></a> <dd id="L39">
<a href="tdbc_connection.htm.html#M33" name="L39"><b>ordinalPosition</b></a> </dd>
</dd>
</dd>
</dd>
</dd>
</dd>
</dd>
</dl> <dd id="L40">
<a href="tdbc_connection.htm.html#M34" name="L40">CONFIGURATION OPTIONS</a> <dl class="configuration options"> <dd id="L41">
<a href="tdbc_connection.htm.html#M35" name="L41"><b>-encoding </b><i>name</i></a> <dd id="L42">
<a href="tdbc_connection.htm.html#M36" name="L42"><b>-isolation </b><i>level</i></a> <dd id="L43">
<a href="tdbc_connection.htm.html#M37" name="L43"><b>-timeout </b><i>ms</i></a> <dd id="L44">
<a href="tdbc_connection.htm.html#M38" name="L44"><b>-readonly </b><i>flag</i></a> </dd>
</dd>
</dd>
</dd>
</dl> <dd id="L45">
<a href="tdbc_connection.htm.html#M39" name="L45">TRANSACTION ISOLATION LEVELS</a> <dl class="transaction isolation levels"> <dd id="L46">
<a href="tdbc_connection.htm.html#M40" name="L46"><b>readuncommitted</b></a> <dd id="L47">
<a href="tdbc_connection.htm.html#M41" name="L47"><b>readcommitted</b></a> <dd id="L48">
<a href="tdbc_connection.htm.html#M42" name="L48"><b>repeatableread</b></a> <dd id="L49">
<a href="tdbc_connection.htm.html#M43" name="L49"><b>serializable</b></a> <dd id="L50">
<a href="tdbc_connection.htm.html#M44" name="L50"><b>readonly</b></a> </dd>
</dd>
</dd>
</dd>
</dd>
</dl> <dd id="L51">
<a href="tdbc_connection.htm.html#M45" name="L51">SEE ALSO</a> <dd id="L52">
<a href="tdbc_connection.htm.html#M46" name="L52">KEYWORDS</a> <dd id="L53">
<a href="tdbc_connection.htm.html#M47" name="L53">COPYRIGHT</a> </dd>
</dd>
</dd>
</dd>
</dd>
</dd>
</dd>
</dd>
</dl> <h2 id="M2">Name</h2> tdbc::connection — TDBC connection object <h2 id="M3">Synopsis</h2> package require <b>tdbc 1.0</b><br> package require <b>tdbc::</b><i>driver version</i><br> <br> <b>tdbc::</b><i>driver</i><b>::connection create </b><i>db</i> ?<i>-option value</i>...?<br> <br> <i>db </i><b>configure</b> ?<i>-option value</i>...?<br> <i>db </i><b><a href="../tclcmd/close.htm.html">close</a></b><br> <i>db </i><b>foreignkeys</b> ?<i>-primary tableName</i>? ?<i>-foreign tableName</i>?<br> <i>db </i><b>prepare</b> <i>sql-code</i><br> <i>db </i><b>preparecall</b> <i>call</i><br> <i>db </i><b>primarykeys</b> <i>tableName</i><br> <i>db </i><b>statements</b><br> <i>db </i><b>resultsets</b><br> <i>db </i><b>tables</b> ?<i>pattern</i>?<br> <i>db </i><b>columns</b> <i>table</i> ?<i>pattern</i>?<br> <i>db </i><b>begintransaction</b><br> <i>db </i><b>commit</b><br> <i>db </i><b>rollback</b><br> <i>db </i><b>transaction</b> <i>script</i><br> <i>db </i><b>allrows</b> ?<b>-as lists</b>|<b>dicts</b>? ?<b>-columnsvariable </b><i>name</i>? ?<b>--</b>? <i>sql-code</i> ?<i>dictionary</i>?<br> <i>db </i><b><a href="../tclcmd/foreach.htm.html">foreach</a></b> ?<b>-as lists</b>|<b>dicts</b>? ?<b>-columnsvariable </b><i>name</i>? ?--? <i>varName sqlcode</i> ?<i>dictionary</i>? <i>script</i><br> <h2 id="M4">Description</h2> Every database driver for TDBC (Tcl DataBase Connectivity) implements a <i>connection</i> object that represents a connection to a database. By convention, this object is created by the command, <b>tdbc::</b><i>driver</i><b>::connection create</b>. This command accepts the name of a Tcl command that will represent the connection and a possible set of options (see <b>CONFIGURATION OPTIONS</b>). It establishes a connection to the database and returns the name of the newly-created Tcl command. <p> The <b>configure</b> object command on a database connection, if presented with no arguments, returns a list of alternating keywords and values representing the connection's current configuration. If presented with a single argument <i>-option</i>, it returns the configured value of the given option. Otherwise, it must be given an even number of arguments which are alternating options and values. The specified options receive the specified values, and nothing is returned. </p>
<p> The <b><a href="../tclcmd/close.htm.html">close</a></b> object command on a database connection closes the connection. All active statements and result sets on the connection are closed. Any uncommitted transaction is rolled back. The object command is deleted. </p>
<p> The <b>prepare</b> object command on a database connection prepares a SQL statement for execution. The <i>sql-code</i> argument must contain a single SQL statement to be executed. Bound variables may be included. The return value is a newly-created Tcl command that represents the statement. See <b><a href="tdbc_statement.htm.html">tdbc::statement</a></b> for more detailed discussion of the SQL accepted by the <b>prepare</b> object command and the interface accepted by a statement. </p>
<p> On a database connection where the underlying database and driver support stored procedures, the <b>preparecall</b> object command prepares a call to a stored procedure for execution. The syntax of the stored procedure call is: </p>

<pre>?<i>resultvar</i> =? <i>procname</i>(?<i>arg</i> ?, <i>arg</i>...?)</pre> <p> The return value is a newly-created Tcl command that represents the statement. See <b><a href="tdbc_statement.htm.html">tdbc::statement</a></b> for the interface accepted by a statement. </p>
<p> The <b>statements</b> object command returns a list of statements that have been created by <b>prepare</b> and <b>preparecall</b> statements against the given connection and have not yet been closed. </p>
<p> The <b>resultsets</b> object command returns a list of result sets that have been obtained by executing statements prepared using the given connection and not yet closed. </p>
<p> The <b>tables</b> object command allows the program to query the connection for the names of tables that exist in the database. The optional <i>pattern</i> parameter is a pattern to match the name of a table. It may contain the SQL wild-card characters '<b>%</b>' and and whose values are subdictionaries. See the documentation for the individual database driver for the interpretation of the values. </p>
<p> The <b>columns</b> object command allows the program to query the connection for the names of columns that exist in a given table. The optional <b>pattern</b> parameter is a pattern to match the name of a column. It may contain the SQL wild-card characters '<b>%</b>' and and whose values are dictionaries. Each of the subdictionaries will contain at least the following keys and values (and may contain others whose usage is determined by a specific database driver). </p>

<dl class="description"> <dt id="M5"><b>type</b></dt>
<dd> Contains the data type of the column, and will generally be chosen from the set, <b>bigint</b>, <b><a href="../tclcmd/binary.htm.html">binary</a></b>, <b>bit</b>, <b>char</b>, <b>date</b>, <b>decimal</b>, <b>double</b>, <b>float</b>, <b>integer</b>, <b>longvarbinary</b>, <b>longvarchar</b>, <b>numeric</b>, <b>real</b>, <b><a href="../tclcmd/time.htm.html">time</a></b>, <b>timestamp</b>, <b>smallint</b>, <b>tinyint</b>, <b>varbinary</b>, and <b>varchar</b>. (If the column has a type that cannot be represented as one of the above, <b>type</b> will contain a driver-dependent description of the type.) 
</dd>
<dt id="M6"><b>precision</b></dt>
<dd> Contains the precision of the column in bits, decimal digits, or the width in characters, according to the type. 
</dd>
<dt id="M7"><b>scale</b></dt>
<dd> Contains the scale of the column (the number of digits after the radix point), for types that support the concept. 
</dd>
<dt id="M8"><b>nullable</b></dt>
<dd> Contains 1 if the column can contain NULL values, and 0 otherwise. 
</dd>
</dl> <p> The <b>primarykeys</b> object command allows the program to query the connection for the primary keys belonging to a given table. The <i>tableName</i> parameter identifies the table being interrogated. The result is a list of dictionaries enumerating the keys (in a similar format to the list returned by <i>$connection</i> <b>allrows -as dicts</b>). The keys of the dictionary may include at least the following. Values that are NULL or meaningless in a given database are omitted. </p>

<dl class="description"> <dt id="M9"><b>tableCatalog</b></dt>
<dd> Name of the catalog in which the table appears. 
</dd>
<dt id="M10"><b>tableSchema</b></dt>
<dd> Name of the schema in which the table appears. 
</dd>
<dt id="M11"><b>tableName</b></dt>
<dd> Name of the table owning the primary key. 
</dd>
<dt id="M12"><b>constraintCatalog</b></dt>
<dd> Name of the catalog in which the primary key constraint appears. In some database systems, this may not be the same as the table's catalog. 
</dd>
<dt id="M13"><b>constraintSchema</b></dt>
<dd> Name of the schema in which the primary key constraint appears. In some database systems, this may not be the same as the table's schema. 
</dd>
<dt id="M14"><b>constraintName</b></dt>
<dd> Name of the primary key constraint, 
</dd>
<dt id="M15"><b>columnName</b></dt>
<dd> Name of a column that is a member of the primary key. 
</dd>
<dt id="M16"><b>ordinalPosition</b></dt>
<dd> Ordinal position of the column within the primary key. 
</dd>
</dl> <p> To these columns may be added additional ones that are specific to a particular database system. </p>
<p> The <b>foreignkeys</b> object command allows the program to query the connection for foreign key relationships that apply to a particular table. The relationships may be constrained to the keys that appear in a particular table (<b>-foreign</b> <i>tableName</i>), the keys that refer to a particular table (<b>-primary</b> <i>tableName</i>), or both. At least one of <b>-primary</b> and <b>-foreign</b> should be specified, although some drivers will enumerate all foreign keys in the current catalog if both options are omitted. The result of the <b>foreignkeys</b> object command is a list of dictionaries, with one list element per key (in a similar format to the list returned by <i>$connection</i> <b>allrows -as dicts</b>). The keys of the dictionary may include at least the following. Values that are NULL or meaningless in a given database are omitted. </p>

<dl class="description"> <dt id="M17"><b>foreignConstraintCatalog</b></dt>
<dd> Catalog in which the foreign key constraint appears. 
</dd>
<dt id="M18"><b>foreignConstraintSchema</b></dt>
<dd> Schema in which the foreign key constraint appears. 
</dd>
<dt id="M19"><b>foreignConstraintName</b></dt>
<dd> Name of the foreign key constraint. 
</dd>
<dt id="M20"><b>primaryConstraintCatalog</b></dt>
<dd> Catalog holding the primary key constraint (or unique key constraint) on the column to which the foreign key refers. 
</dd>
<dt id="M21"><b>primaryConstraintSchema</b></dt>
<dd> Schema holding the primary key constraint (or unique key constraint) on the column to which the foreign key refers. 
</dd>
<dt id="M22"><b>primaryConstraintName</b></dt>
<dd> Name of the primary key constraint (or unique key constraint) on the column to which the foreign key refers. 
</dd>
<dt id="M23"><b>updateAction</b></dt>
<dd> Action to take when an UPDATE statement invalidates the constraint. The value will be <b>CASCADE</b>, <b>SET DEFAULT</b>, <b>SET NULL</b>, <b>RESTRICT</b>, or <b>NO ACTION</b>. 
</dd>
<dt id="M24"><b>deleteAction</b></dt>
<dd> Action to take when a DELETE statement invalidates the constraint. The value will be <b>CASCADE</b>, <b>SET DEFAULT</b>, <b>SET NULL</b>, <b>RESTRICT</b>, or <b>NO ACTION</b>. 
</dd>
<dt id="M25"><b>primaryCatalog</b></dt>
<dd> Catalog name in which the primary table (the one to which the foreign key refers) appears. 
</dd>
<dt id="M26"><b>primarySchema</b></dt>
<dd> Schema name in which the primary table (the one to which the foreign key refers) appears. 
</dd>
</dl> 

<dl class="description"> <dt id="M27"><b>primaryTable</b></dt>
<dd> Table name of the primary table (the one to which the foreign key refers). 
</dd>
<dt id="M28"><b>primaryColumn</b></dt>
<dd> Name of the column to which the foreign key refers. 
</dd>
<dt id="M29"><b>foreignCatalog</b></dt>
<dd> Name of the catalog in which the table containing the foreign key appears. 
</dd>
<dt id="M30"><b>foreignSchema</b></dt>
<dd> Name of the schema in which the table containing the foreign key appears. 
</dd>
<dt id="M31"><b>foreignTable</b></dt>
<dd> Name of the table containing the foreign key. 
</dd>
<dt id="M32"><b>foreignColumn</b></dt>
<dd> Name of the column appearing in the foreign key. 
</dd>
<dt id="M33"><b>ordinalPosition</b></dt>
<dd> Position of the column in the foreign key, if the key is a compound key. 
</dd>
</dl> <p> The <b>begintransaction</b> object command on a database connection begins a transaction on the database. If the underlying database does not support atomic, consistent, isolated, durable transactions, the <b>begintransaction</b> object command returns an error reporting the fact. Similarly, if multiple <b>begintransaction</b> commands are executed withough an intervening <b>commit</b> or <b>rollback</b> command, an error is returned unless the underlying database supports nested transactions. </p>
<p> The <b>commit</b> object command on a database connection ends the most recent transaction started by <b>begintransaction</b> and commits changes to the database. </p>
<p> The <b>rollback</b> object command on a database connection rolls back the most recent transaction started by <b>begintransaction</b>. The state of the database is as if nothing happened during the transaction. </p>
<p> The <b>transaction</b> object command on a database connection presents a simple way of bundling a database transaction. It begins a transaction, and evaluates the supplied <i>script</i> argument as a Tcl script in the caller's scope. If <i>script</i> terminates normally, or by <b><a href="../tclcmd/break.htm.html">break</a></b>, <b><a href="../tclcmd/continue.htm.html">continue</a></b>, or <b><a href="../tclcmd/return.htm.html">return</a></b>, the transaction is committed (and any action requested by <b><a href="../tclcmd/break.htm.html">break</a></b>, <b><a href="../tclcmd/continue.htm.html">continue</a></b>, or <b><a href="../tclcmd/return.htm.html">return</a></b> takes place). If the commit fails for any reason, the error in the commit is treated as an error in the <i>script</i>. In the case of an error in <i>script</i> or in the commit, the transaction is rolled back and the error is rethrown. Any nonstandard return code from the script causes the transaction to be rolled back and then is rethrown. </p>
<p> The <b>allrows</b> object command prepares a SQL statement (given by the <i>sql-code</i> parameter) to execute against the database. It then executes it (see <b><a href="tdbc_statement.htm.html">tdbc::statement</a></b> for details) with the optional <i>dictionary</i> parameter giving bind variables. Finally, it uses the <i>allrows</i> object command on the result set (see <b><a href="tdbc_resultset.htm.html">tdbc::resultset</a></b>) to construct a list of the results. Finally, both result set and statement are closed. The return value is the list of results. </p>
<p> The <b><a href="../tclcmd/foreach.htm.html">foreach</a></b> object command prepares a SQL statement (given by the <i>sql-code</i> parameter) to execute against the database. It then executes it (see <b><a href="tdbc_statement.htm.html">tdbc::statement</a></b> for details) with the optional <i>dictionary</i> parameter giving bind variables. Finally, it uses the <i>foreach</i> object command on the result set (see <b><a href="tdbc_resultset.htm.html">tdbc::resultset</a></b>) to evaluate the given <i>script</i> for each row of the results. Finally, both result set and statement are closed, even if the given <i>script</i> results in a <b><a href="../tclcmd/return.htm.html">return</a></b>, an error, or an unusual return code. </p>
<h2 id="M34">Configuration options</h2> The configuration options accepted when the connection is created and on the connection's <b>configure</b> object command include the following, and may include others specific to a database driver. 
<dl class="configuration options"> <dt id="M35">
<b>-encoding </b><i>name</i>
</dt>
<dd> Specifies the encoding to be used in connecting to the database. The <i>name</i> should be one of the names accepted by the <b><a href="../tclcmd/encoding.htm.html">encoding</a></b> command. This option is usually unnecessary; most database drivers can figure out the encoding in use by themselves. 
</dd>
<dt id="M36">
<b>-isolation </b><i>level</i>
</dt>
<dd> Specifies the transaction isolation level needed for transactions on the database. The acceptable values for <i>level</i> are shown under <b><a href="#M39">TRANSACTION ISOLATION LEVELS</a></b>. 
</dd>
<dt id="M37">
<b>-timeout </b><i>ms</i>
</dt>
<dd> Specifies the maximum time to wait for a an operation database engine before reporting an error to the caller. The <i>ms</i> argument gives the maximum time in milliseconds. A value of zero (the default) specifies that the calling process is to wait indefinitely for database operations. 
</dd>
<dt id="M38">
<b>-readonly </b><i>flag</i>
</dt>
<dd> Specifies that the connection will not modify the database (if the Boolean parameter <i>flag</i> is true), or that it may modify the database (if <i>flag</i> is false). If <i>flag</i> is true, this option may have the effect of raising the transaction isolation level to <i>readonly</i>. 
</dd>
</dl> <h3 id="M39">Transaction isolation levels</h3> The acceptable values for the <b>-isolation</b> configuration option are as follows: 
<dl class="transaction isolation levels"> <dt id="M40"><b>readuncommitted</b></dt>
<dd> Allows the transaction to read "dirty", that is, uncommitted data. This isolation level may compromise data integrity, does not guarantee that foreign keys or uniqueness constraints are satisfied, and in general does not guarantee data consistency. 
</dd>
<dt id="M41"><b>readcommitted</b></dt>
<dd> Forbids the transaction from reading "dirty" data, but does not guarantee repeatable reads; if a transaction reads a row of a database at a given time, there is no guarantee that the same row will be available at a later time in the same transaction. 
</dd>
<dt id="M42"><b>repeatableread</b></dt>
<dd> Guarantees that any row of the database, once read, will have the same values for the life of a transaction. Still permits "phantom reads" (that is, newly-added rows appearing if a table is queried a second time). 
</dd>
<dt id="M43"><b>serializable</b></dt>
<dd> The most restrictive (and most expensive) level of transaction isolation. Any query to the database, if repeated, will return precisely the same results for the life of the transaction, exactly as if the transaction is the only user of the database. 
</dd>
<dt id="M44"><b>readonly</b></dt>
<dd> Behaves like <b>serializable</b> in that the only results visible to the transaction are those that were committed prior to the start of the transaction, but forbids the transaction from modifying the database. 
</dd>
</dl> <p> A database that does not implement one of these isolation levels will instead use the next more restrictive isolation level. If the given level of isolation cannot be obtained, the database interface throws an error reporting the fact. The default isolation level is <b>readcommitted</b>. </p>
<p> A script should not the isolation level when a transaction is in progress. </p>
<h2 id="M45">See also</h2> <b><a href="../tclcmd/encoding.htm.html">encoding</a></b>, <b><a href="tdbc.htm.html">tdbc</a></b>, <b><a href="tdbc_resultset.htm.html">tdbc::resultset</a></b>, <b><a href="tdbc_statement.htm.html">tdbc::statement</a></b>, <b><a href="tdbc_tokenize.htm.html">tdbc::tokenize</a></b>   <h2 id="M47">Copyright</h2> Copyright (c) 2008 by Kevin B. Kenny. <div class="_attribution"><p class="_attribution-p">Copyright © 2008 by Kevin B. Kenny. </p></div><div class="_attribution">
  <p class="_attribution-p">
    Licensed under <a href="http://tcl.tk/software/tcltk/license.html">Tcl/Tk terms</a><br>
    <a href="https://www.tcl.tk/man/tcl/TdbcCmd/tdbc_connection.htm" class="_attribution-link">https://www.tcl.tk/man/tcl/TdbcCmd/tdbc_connection.htm</a>
  </p>
</div>
