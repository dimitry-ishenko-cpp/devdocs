<h1>Extending PHPUnit</h1> <section id="enhancing-concrete-test-cases"> <h2>Enhancing concrete test cases<a class="headerlink" href="#enhancing-concrete-test-cases" title="Permalink to this heading"></a>
</h2> <p>You can extend PHPUnit by enhancing concrete test cases with methods that add functionality.</p> <p>For example, you may use an assertion in a concrete test case to assert that a value created by the system under test matches a regular expression.</p> <div class="literal-block-wrapper docutils container" id="id2"> <div class="code-block-caption">
<span class="caption-number">Example 10.1 </span><span class="caption-text">A concrete test case using a default assertion</span><a class="headerlink" href="#id2" title="Permalink to this code"></a>
</div> <div class="highlight-php notranslate">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">OrderIdGeneratorTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testGenerateGeneratesId</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$orderIdGenerator</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">OrderIdGenerator</span><span class="p">;</span>

        <span class="nv">$orderId</span> <span class="o">=</span> <span class="nv">$orderIdGenerator</span><span class="o">-&gt;</span><span class="na">generate</span><span class="p">();</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertMatchesRegularExpression</span><span class="p">(</span>
            <span class="s1">'/^[a-f0-9]{8}-[a-f0-9]{4}$/'</span><span class="p">,</span>
            <span class="nb">sprintf</span><span class="p">(</span>
                <span class="s1">'Failed asserting that "%s" is a valid order ID.'</span><span class="p">,</span>
                <span class="nv">$orderId</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> <p>You can enhance this concrete test case by extracting a domain-specific assertion.</p> <div class="literal-block-wrapper docutils container" id="id3"> <div class="code-block-caption">
<span class="caption-number">Example 10.2 </span><span class="caption-text">A concrete test case using a domain-specific assertion</span><a class="headerlink" href="#id3" title="Permalink to this code"></a>
</div> <div class="highlight-php notranslate">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">OrderIdGeneratorWithDomainSpecificAssertionTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testGenerateGeneratesId</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$orderIdGenerator</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">OrderIdGenerator</span><span class="p">;</span>

        <span class="nv">$orderId</span> <span class="o">=</span> <span class="nv">$orderIdGenerator</span><span class="o">-&gt;</span><span class="na">generate</span><span class="p">();</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertStringIsOrderId</span><span class="p">(</span><span class="nv">$orderId</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">function</span> <span class="nf">assertStringIsOrderId</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$value</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertMatchesRegularExpression</span><span class="p">(</span>
            <span class="s1">'/^[a-f0-9]{8}-[a-f0-9]{4}$/'</span><span class="p">,</span>
            <span class="nv">$value</span><span class="p">,</span>
            <span class="nb">sprintf</span><span class="p">(</span>
                <span class="s1">'Failed asserting that "%s" is a valid order ID.'</span><span class="p">,</span>
                <span class="nv">$value</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> </section> <section id="extracting-abstract-test-cases"> <h2>Extracting abstract test cases<a class="headerlink" href="#extracting-abstract-test-cases" title="Permalink to this heading"></a>
</h2> <p>You can extend PHPUnit by extracting abstract test cases to share functionality with other concrete test cases via vertical inheritance.</p> <p>For example, you may want to pull the domain-specific assertion from above into an abstract test case.</p> <div class="literal-block-wrapper docutils container" id="id4"> <div class="code-block-caption">
<span class="caption-number">Example 10.3 </span><span class="caption-text">An abstract test case with a domain-specific assertion</span><a class="headerlink" href="#id4" title="Permalink to this code"></a>
</div> <div class="highlight-php notranslate">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">abstract</span> <span class="k">class</span> <span class="nc">AbstractTestCase</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">final</span> <span class="k">protected</span> <span class="k">function</span> <span class="nf">assertStringIsOrderId</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$value</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertMatchesRegularExpression</span><span class="p">(</span>
            <span class="s1">'/^[a-f0-9]{8}-[a-f0-9]{4}$/'</span><span class="p">,</span>
            <span class="nv">$value</span><span class="p">,</span>
            <span class="nb">sprintf</span><span class="p">(</span>
                <span class="s1">'Failed asserting that "%s" is a valid order ID.'</span><span class="p">,</span>
                <span class="nv">$value</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> <p>You can then enhance a concrete test case by extending the abstract test case.</p> <div class="literal-block-wrapper docutils container" id="id5"> <div class="code-block-caption">
<span class="caption-number">Example 10.4 </span><span class="caption-text">A concrete test case extending an abstract test case with a domain-specific assertion</span><a class="headerlink" href="#id5" title="Permalink to this code"></a>
</div> <div class="highlight-php notranslate">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">OrderIdGeneratorExtendingAbstractTestCaseTest</span> <span class="k">extends</span> <span class="nx">AbstractTestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testGenerateGeneratesId</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$orderIdGenerator</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">OrderIdGenerator</span><span class="p">;</span>

        <span class="nv">$orderId</span> <span class="o">=</span> <span class="nv">$orderIdGenerator</span><span class="o">-&gt;</span><span class="na">generate</span><span class="p">();</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertStringIsOrderId</span><span class="p">(</span><span class="nv">$orderId</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> </section> <section id="extracting-traits"> <h2>Extracting traits<a class="headerlink" href="#extracting-traits" title="Permalink to this heading"></a>
</h2> <p>You can extend PHPUnit by extracting traits to share functionality with concrete test cases via horizontal inheritance.</p> <p>For example, you may want to pull the domain-specific assertion from above into a trait.</p> <div class="literal-block-wrapper docutils container" id="id6"> <div class="code-block-caption">
<span class="caption-number">Example 10.5 </span><span class="caption-text">A trait with a domain-specific assertion</span><a class="headerlink" href="#id6" title="Permalink to this code"></a>
</div> <div class="highlight-php notranslate">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">trait</span> <span class="nx">AssertionTrait</span>
<span class="p">{</span>
    <span class="k">final</span> <span class="k">protected</span> <span class="k">function</span> <span class="nf">assertStringIsOrderId</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$value</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertMatchesRegularExpression</span><span class="p">(</span>
            <span class="s1">'/^[a-f0-9]{8}-[a-f0-9]{4}$/'</span><span class="p">,</span>
            <span class="nv">$value</span><span class="p">,</span>
            <span class="nb">sprintf</span><span class="p">(</span>
                <span class="s1">'Failed asserting that "%s" is a valid order ID.'</span><span class="p">,</span>
                <span class="nv">$value</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> <p>You can then enhance a concrete test case by using the trait.</p> <div class="literal-block-wrapper docutils container" id="id7"> <div class="code-block-caption">
<span class="caption-number">Example 10.6 </span><span class="caption-text">A concrete test case using a trait with a domain-specific assertion</span><a class="headerlink" href="#id7" title="Permalink to this code"></a>
</div> <div class="highlight-php notranslate">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">OrderIdGeneratorUsingAssertionTraitTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">AssertionTrait</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testGenerateGeneratesId</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$orderIdGenerator</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">OrderIdGenerator</span><span class="p">;</span>

        <span class="nv">$orderId</span> <span class="o">=</span> <span class="nv">$orderIdGenerator</span><span class="o">-&gt;</span><span class="na">generate</span><span class="p">();</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertStringIsOrderId</span><span class="p">(</span><span class="nv">$orderId</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> </section> <section id="extending-the-test-runner"> <h2>Extending the Test Runner<a class="headerlink" href="#extending-the-test-runner" title="Permalink to this heading"></a>
</h2> <p>You can extend PHPUnit by implementing and registering an extension.</p> <section id="implementing-an-extension"> <h3>Implementing an extension<a class="headerlink" href="#implementing-an-extension" title="Permalink to this heading"></a>
</h3> <p>A PHPUnit extension is a class that implements the <code class="docutils literal notranslate"><span class="pre">PHPUnit\Runner\Extension\Extension</span></code> interface.</p> <p>The extension interface declares a <code class="docutils literal notranslate"><span class="pre">bootstrap()</span></code> method that accepts the PHPUnit configuration, the extension facade, and the extension parameter collection.</p> <div class="literal-block-wrapper docutils container" id="id8"> <div class="code-block-caption">
<span class="caption-number">Example 10.7 </span><span class="caption-text">An example extension registering an ExampleSubscriber and an ExampleTracer</span><a class="headerlink" href="#id8" title="Permalink to this code"></a>
</div> <div class="highlight-php notranslate">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">namespace</span> <span class="nx">Vendor\ExampleExtensionForPhpunit</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">PHPUnit\Runner\Extension\Extension</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\Runner\Extension\Facade</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\Runner\Extension\ParameterCollection</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\TextUI\Configuration\Configuration</span><span class="p">;</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">ExampleExtension</span> <span class="k">implements</span> <span class="nx">Extension</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">bootstrap</span><span class="p">(</span>
        <span class="nx">Configuration</span> <span class="nv">$configuration</span><span class="p">,</span>
        <span class="nx">Facade</span> <span class="nv">$facade</span><span class="p">,</span>
        <span class="nx">ParameterCollection</span> <span class="nv">$parameters</span>
    <span class="p">)</span><span class="o">:</span> <span class="nx">void</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$configuration</span><span class="o">-&gt;</span><span class="na">noOutput</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nv">$message</span> <span class="o">=</span> <span class="s1">'the-default-message'</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$parameters</span><span class="o">-&gt;</span><span class="na">has</span><span class="p">(</span><span class="s1">'message'</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$message</span> <span class="o">=</span> <span class="nv">$parameters</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">'message'</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="nv">$facade</span><span class="o">-&gt;</span><span class="na">registerSubscriber</span><span class="p">(</span><span class="k">new</span> <span class="nx">ExampleSubscriber</span><span class="p">(</span><span class="nv">$message</span><span class="p">));</span>
        <span class="nv">$facade</span><span class="o">-&gt;</span><span class="na">registerTracer</span><span class="p">(</span><span class="k">new</span> <span class="nx">ExampleTracer</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> <p>The PHPUnit configuration is an instance of <code class="docutils literal notranslate"><span class="pre">PHPUnit\TextUI\Configuration\Configuration</span></code> and gives you access to the configuration of PHPUnit after merging configuration options from defaults, the XML configuration file, and command-line options.</p> <p>You can inspect the configuration object to adjust the behavior of your extension. For example, you may want to extend PHPUnit with an extension that renders output on the console. If that is the case, you may be interested to know whether a user of PHPUnit wants to use colors or prefers a monochrome output.</p> <p>The parameter collection is an instance of <code class="docutils literal notranslate"><span class="pre">PHPUnit\Runner\Extension\ParameterCollection</span></code> and gives you access to extension parameters a user has provided via PHPUnit’s XML configuration file. You can use the parameter collection to allow users of the extension to configure the behavior of your extension.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>You must verify and process the values from the parameter collection yourself. PHPUnit has no functionality for verifying or casting the values from the parameter collection to other types.</p> </div> <p>The extension facade is an instance of <code class="docutils literal notranslate"><span class="pre">PHPUnit\Runner\Extension\Facade</span></code> and allows you to register event subscribers and event tracers using the methods <code class="docutils literal notranslate"><span class="pre">registerSubscribers()</span></code>, <code class="docutils literal notranslate"><span class="pre">registerSubscriber()</span></code>, and <code class="docutils literal notranslate"><span class="pre">registerTracer()</span></code>.</p> <p>The extension facade also provides the following methods for test runner extensions to indicate to the test runner that they intend to replace default functionality or require certain functionality to be activated:</p> <p>The <code class="docutils literal notranslate"><span class="pre">replacesProgressOutput()</span></code> method can be used to disable the test runner’s default progress output while it runs the tests.</p> <p>The <code class="docutils literal notranslate"><span class="pre">replacesResultOutput()</span></code> method can be used to disable the test runner’s default result output after it finished running the tests.</p> <p>The <code class="docutils literal notranslate"><span class="pre">replacesOutput()</span></code> method combines the effects of <code class="docutils literal notranslate"><span class="pre">replacesProgressOutput()</span></code> and <code class="docutils literal notranslate"><span class="pre">replacesResultOutput()</span></code> (see above).</p> <p>The <code class="docutils literal notranslate"><span class="pre">requiresCodeCoverageCollection()</span></code> method can be used to activate the collection of code coverage information.</p> <p>The <code class="docutils literal notranslate"><span class="pre">requiresExportOfObjects()</span></code> method can be used to activate the export of objects for events such as <code class="docutils literal notranslate"><span class="pre">Test\AssertionSucceeded</span></code> and <code class="docutils literal notranslate"><span class="pre">Test\AssertionFailed</span></code>, for example.</p> <section id="implementing-an-event-subscriber"> <h4>Implementing an event subscriber<a class="headerlink" href="#implementing-an-event-subscriber" title="Permalink to this heading"></a>
</h4> <p>An event subscriber is a class that implements an event subscriber interface.</p> <p>An event subscriber interface declares a single <code class="docutils literal notranslate"><span class="pre">notify()</span></code> method that accepts an instance of the corresponding event class.</p> <div class="literal-block-wrapper docutils container" id="id9"> <div class="code-block-caption">
<span class="caption-number">Example 10.8 </span><span class="caption-text">An ExampleSubscriber printing a message when PHPUnit emits the ExecutionFinished event</span><a class="headerlink" href="#id9" title="Permalink to this code"></a>
</div> <div class="highlight-php notranslate">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">namespace</span> <span class="nx">Vendor\ExampleExtensionForPhpunit</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">PHPUnit\Event\TestRunner\ExecutionFinished</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\Event\TestRunner\ExecutionFinishedSubscriber</span><span class="p">;</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">ExampleSubscriber</span> <span class="k">implements</span> <span class="nx">ExecutionFinishedSubscriber</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="k">private</span> <span class="nx">readonly</span> <span class="nx">string</span> <span class="nv">$message</span><span class="p">)</span>
    <span class="p">{</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">notify</span><span class="p">(</span><span class="nx">ExecutionFinished</span> <span class="nv">$event</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="k">print</span> <span class="no">__METHOD__</span> <span class="o">.</span> <span class="nx">PHP_EOL</span> <span class="o">.</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">message</span> <span class="o">.</span> <span class="nx">PHP_EOL</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> <p>After registering an event subscriber with the extension facade, PHPUnit will notify the event subscriber when emitting an event of the corresponding event class.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>You can not create an event subscriber that implements more than one event subscriber interface at a time.</p> <p>If you want to subscribe to more than one event, you need to implement at least one event subscriber for each event you are interested in.</p> </div> </section> <section id="implementing-an-event-tracer"> <h4>Implementing an event tracer<a class="headerlink" href="#implementing-an-event-tracer" title="Permalink to this heading"></a>
</h4> <p>An event tracer is a class that implements the <code class="docutils literal notranslate"><span class="pre">PHPUnit\Event\Tracer\Tracer</span></code> interface.</p> <p>The tracer interface declares a single <code class="docutils literal notranslate"><span class="pre">trace()</span></code> method that accepts an event.</p> <div class="literal-block-wrapper docutils container" id="id10"> <div class="code-block-caption">
<span class="caption-number">Example 10.9 </span><span class="caption-text">An ExampleTracer receiving all events</span><a class="headerlink" href="#id10" title="Permalink to this code"></a>
</div> <div class="highlight-php notranslate">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">namespace</span> <span class="nx">Vendor\ExampleExtensionForPhpunit</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">PHPUnit\Event\Event</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\Event\Tracer\Tracer</span><span class="p">;</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">ExampleTracer</span> <span class="k">implements</span> <span class="nx">Tracer</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">trace</span><span class="p">(</span><span class="nx">Event</span> <span class="nv">$event</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> <p>After registering an event tracer with the extension facade, PHPUnit will notify the tracer of every event.</p> <div class="admonition hint"> <p class="admonition-title">Hint</p> <p>Are you unsure whether you should implement an event tracer or multiple event subscribers?</p> <p>If you are interested in every event that PHPUnit emits during the execution of the CLI application, you probably want to implement and register an event tracer.</p> <p>If you are interested in selected events that PHPUnit emits during the execution of the CLI application, you probably want to implement and register one or more event subscribers.</p> </div> </section> <section id="understanding-events"> <h4>Understanding events<a class="headerlink" href="#understanding-events" title="Permalink to this heading"></a>
</h4> <p>An event is a class that implements the <code class="docutils literal notranslate"><span class="pre">PHPUnit\Event\Event</span></code> interface.</p> <p>The <code class="docutils literal notranslate"><span class="pre">PHPUnit\Event\Event</span></code> interface declares a <code class="docutils literal notranslate"><span class="pre">telemetryInfo()</span></code> method that gives you access to telemetry information and an <code class="docutils literal notranslate"><span class="pre">asString()</span></code> method that returns a string representation of the event.</p> <p>Each event may implement additional methods that provide access to information available when PHPUnit registers and emits the event.</p> <p>You can consume, inspect, and process these events in event subscribers or tracers.</p> <p>You can find a list of all events PHPUnit currently emits in the <a class="reference internal" href="events.html#appendixes-events"><span class="std std-ref">appendix</span></a>.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>PHPUnit currently does not support registering custom events.</p> </div> </section> </section> <section id="sharing-an-extension"> <h3>Sharing an extension<a class="headerlink" href="#sharing-an-extension" title="Permalink to this heading"></a>
</h3> <p>You can share a PHPUnit extension as a PHAR or a Composer package.</p> <section id="sharing-an-extension-as-a-phar"> <h4>Sharing an extension as a PHAR<a class="headerlink" href="#sharing-an-extension-as-a-phar" title="Permalink to this heading"></a>
</h4> <p>When users of your extension prefer to install PHPUnit as a PHAR, it is best to make your extension also available as a PHAR.</p> <p>To make your extension loadable as a PHAR, you need to include a <a class="reference external" href="https://github.com/phar-io/manifest">PHAR Manifest</a>.</p> <div class="literal-block-wrapper docutils container" id="id11"> <div class="code-block-caption">
<span class="caption-number">Example 10.10 </span><span class="caption-text">An example manifest.xml</span><a class="headerlink" href="#id11" title="Permalink to this code"></a>
</div> <div class="highlight-xml notranslate">
<div class="highlight"><pre class="highlight" data-language="php"><span class="cp">&lt;?xml version="1.0" encoding="utf-8" ?&gt;</span>
<span class="nt">&lt;phar</span><span class="na">xmlns=</span><span class="s">"https://phar.io/xml/manifest/1.0"</span><span class="nt">&gt;</span>
<span class="nt">&lt;contains</span><span class="na">name=</span><span class="s">"phpunit/phpunit-test-extension"</span><span class="na">version=</span><span class="s">"1.0.0"</span><span class="na">type=</span><span class="s">"extension"</span><span class="nt">&gt;</span>
<span class="nt">&lt;extension</span><span class="na">for=</span><span class="s">"phpunit/phpunit"</span><span class="na">compatible=</span><span class="s">"^10.0"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/contains&gt;</span>

<span class="nt">&lt;requires&gt;</span>
<span class="nt">&lt;php</span><span class="na">version=</span><span class="s">"^8.1"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/requires&gt;</span>

<span class="nt">&lt;copyright&gt;</span>
<span class="nt">&lt;author</span><span class="na">name=</span><span class="s">"Sebastian Bergmann"</span><span class="na">email=</span><span class="s">"sebastian@phpunit.de"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;license</span><span class="na">type=</span><span class="s">"BSD-3-Clause"</span><span class="na">url=</span><span class="s">"https://github.com/sebastianbergmann/phpunit/blob/master/LICENSE"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/copyright&gt;</span>
<span class="nt">&lt;/phar&gt;</span>
</pre></div> </div> </div> </section> <section id="sharing-an-extension-as-a-composer-package"> <h4>Sharing an extension as a Composer package<a class="headerlink" href="#sharing-an-extension-as-a-composer-package" title="Permalink to this heading"></a>
</h4> <p>When users of your extension prefer to install PHPUnit as a Composer package, it is best to make your extension available as a Composer package.</p> </section> </section> <section id="registering-an-extension"> <h3>Registering an extension<a class="headerlink" href="#registering-an-extension" title="Permalink to this heading"></a>
</h3> <p>You can register one or more PHPUnit extensions from PHARs or from Composer package using the <a class="reference internal" href="configuration.html#appendixes-configuration-extensions"><span class="std std-ref">extensions</span></a>, <a class="reference internal" href="configuration.html#appendixes-configuration-extensions-bootstrap"><span class="std std-ref">bootstrap</span></a>, and <a class="reference internal" href="configuration.html#appendixes-configuration-extensions-extension-arguments"><span class="std std-ref">parameters</span></a> elements of the <a class="reference internal" href="configuration.html#appendixes-configuration"><span class="std std-ref">PHPUnit XML configuration file</span></a>.</p> <section id="registering-an-extension-from-a-phar"> <h4>Registering an extension from a PHAR<a class="headerlink" href="#registering-an-extension-from-a-phar" title="Permalink to this heading"></a>
</h4> <p>When you install PHPUnit as a PHAR, it is best to load extensions from a PHAR.</p> <p>You can use the <a class="reference internal" href="configuration.html#appendixes-configuration-phpunit-extensionsdirectory"><span class="std std-ref">extensionsDirectory</span></a> attribute of the <a class="reference internal" href="configuration.html#appendixes-configuration-phpunit"><span class="std std-ref">phpunit</span></a> element to configure the directory from which PHPUnit should load extensions as a PHAR.</p> <div class="literal-block-wrapper docutils container" id="id12"> <div class="code-block-caption">
<span class="caption-number">Example 10.11 </span><span class="caption-text">An XML configuration registering an ExampleExtension with parameters, loaded from an extensions directory</span><a class="headerlink" href="#id12" title="Permalink to this code"></a>
</div> <div class="highlight-xml notranslate">
<div class="highlight"><pre class="highlight" data-language="php"><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;phpunit</span>
<span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
<span class="na">xsi:noNamespaceSchemaLocation=</span><span class="s">"https://schema.phpunit.de/10.0/phpunit.xsd"</span>
<span class="na">extensionsDirectory=</span><span class="s">"../phpunit-extensions/"</span>
<span class="nt">&gt;</span>
<span class="cm">&lt;!-- ... --&gt;</span>

<span class="nt">&lt;extensions&gt;</span>
<span class="nt">&lt;bootstrap</span><span class="na">class=</span><span class="s">"Vendor\ExampleExtensionForPhpunit\ExampleExtension"</span><span class="nt">&gt;</span>
<span class="nt">&lt;parameter</span><span class="na">name=</span><span class="s">"message"</span><span class="na">value=</span><span class="s">"the-message"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bootstrap&gt;</span>
<span class="nt">&lt;/extensions&gt;</span>

<span class="cm">&lt;!-- ... --&gt;</span>
<span class="nt">&lt;/phpunit&gt;</span>
</pre></div> </div> </div> </section> <section id="registering-an-extension-from-a-composer-package"> <h4>Registering an extension from a Composer package<a class="headerlink" href="#registering-an-extension-from-a-composer-package" title="Permalink to this heading"></a>
</h4> <p>When you install PHPUnit as a Composer package, it is best to load extensions from Composer packages.</p> <p>You do not need to configure the <a class="reference internal" href="configuration.html#appendixes-configuration-phpunit-extensionsdirectory"><span class="std std-ref">extensionsDirectory</span></a> attribute, as extensions from Composer packages will be available through the autoloading mechanism of Composer.</p> <div class="literal-block-wrapper docutils container" id="id13"> <div class="code-block-caption">
<span class="caption-number">Example 10.12 </span><span class="caption-text">An XML configuration registering an ExampleExtension with parameters</span><a class="headerlink" href="#id13" title="Permalink to this code"></a>
</div> <div class="highlight-xml notranslate">
<div class="highlight"><pre class="highlight" data-language="php"><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;phpunit</span>
<span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
<span class="na">xsi:noNamespaceSchemaLocation=</span><span class="s">"https://schema.phpunit.de/10.0/phpunit.xsd"</span>
<span class="nt">&gt;</span>
<span class="cm">&lt;!-- ... --&gt;</span>

<span class="nt">&lt;extensions&gt;</span>
<span class="nt">&lt;bootstrap</span><span class="na">class=</span><span class="s">"Vendor\ExampleExtensionForPhpunit\ExampleExtension"</span><span class="nt">&gt;</span>
<span class="nt">&lt;parameter</span><span class="na">name=</span><span class="s">"message"</span><span class="na">value=</span><span class="s">"the-message"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bootstrap&gt;</span>
<span class="nt">&lt;/extensions&gt;</span>

<span class="cm">&lt;!-- ... --&gt;</span>
<span class="nt">&lt;/phpunit&gt;</span>
</pre></div> </div> </div> </section> </section> <section id="debugging-phpunit"> <h3>Debugging PHPUnit<a class="headerlink" href="#debugging-phpunit" title="Permalink to this heading"></a>
</h3> <p>The test runner’s <code class="docutils literal notranslate"><span class="pre">--log-events-text</span></code> CLI option can be used to write a plain text representation for each event to a stream. In the example shown below, we use <code class="docutils literal notranslate"><span class="pre">--no-output</span></code> to disable both the default progress output as well as the default result output. Then we use <code class="docutils literal notranslate"><span class="pre">--log-events-text</span> <span class="pre">php://stdout</span></code> to write event information to standard output:</p> <div class="literal-block-wrapper docutils container" id="extending-phpunit-event-system-event-system-debugging-phpunit-examples-logging-events"> <div class="code-block-caption">
<span class="caption-number">Example 10.13 </span><span class="caption-text">Output of “phpunit –no-output –log-events-text php://stdout” command</span><a class="headerlink" href="#extending-phpunit-event-system-event-system-debugging-phpunit-examples-logging-events" title="Permalink to this code"></a>
</div> <div class="highlight-none notranslate">
<div class="highlight"><pre class="highlight" data-language="php">phpunit --no-output --log-events-text php://stdout
PHPUnit Started (PHPUnit 10.0.0 using PHP 8.2.1 (cli) on Linux)
Test Runner Configured
Test Suite Loaded (2 tests)
Event Facade Sealed
Test Runner Started
Test Suite Sorted
Test Runner Execution Started (2 tests)
Test Suite Started (ExampleTest, 2 tests)
Test Preparation Started (ExampleTest::testOne)
Test Prepared (ExampleTest::testOne)
Assertion Succeeded (Constraint: is true)
Test Passed (ExampleTest::testOne)
Test Finished (ExampleTest::testOne)
Test Preparation Started (ExampleTest::testTwo)
Test Prepared (ExampleTest::testTwo)
Assertion Failed (Constraint: is identical to 'foo', Value: 'bar')
Test Failed (ExampleTest::testTwo)
Failed asserting that two strings are identical.
Test Finished (ExampleTest::testTwo)
Test Suite Finished (ExampleTest, 2 tests)
Test Runner Execution Finished
Test Runner Finished
PHPUnit Finished (Shell Exit Code: 1)
</pre></div> </div> </div> <p>Alternatively, the <code class="docutils literal notranslate"><span class="pre">--log-events-verbose-text</span></code> CLI option can be used to include information about resource consumption (time since the test runner was started, time since the previous event, and memory usage):</p> <div class="literal-block-wrapper docutils container" id="extending-phpunit-event-system-event-system-debugging-phpunit-examples-logging-events-verbose"> <div class="code-block-caption">
<span class="caption-number">Example 10.14 </span><span class="caption-text">Output of “phpunit –no-output –log-events-verbose-text php://stdout” command</span><a class="headerlink" href="#extending-phpunit-event-system-event-system-debugging-phpunit-examples-logging-events-verbose" title="Permalink to this code"></a>
</div> <div class="highlight-none notranslate">
<div class="highlight"><pre class="highlight" data-language="php">phpunit --no-output --log-events-verbose-text php://stdout
[00:00:00.000046482 / 00:00:00.000006987] [4194304 bytes] PHPUnit Started (PHPUnit 10.0.0 using PHP 8.2.1 (cli) on Linux)
[00:00:00.048195557 / 00:00:00.048149075] [4194304 bytes] Test Runner Configured
[00:00:00.067646038 / 00:00:00.019450481] [6291456 bytes] Test Suite Loaded (2 tests)
[00:00:00.075942220 / 00:00:00.008296182] [6291456 bytes] Event Facade Sealed
[00:00:00.076452360 / 00:00:00.000510140] [6291456 bytes] Test Runner Started
[00:00:00.084421682 / 00:00:00.007969322] [6291456 bytes] Test Suite Sorted
[00:00:00.084664485 / 00:00:00.000242803] [6291456 bytes] Test Runner Execution Started (2 tests)
[00:00:00.085240320 / 00:00:00.000575835] [6291456 bytes] Test Suite Started (ExampleTest, 2 tests)
[00:00:00.086992385 / 00:00:00.001752065] [6291456 bytes] Test Preparation Started (ExampleTest::testOne)
[00:00:00.087443560 / 00:00:00.000451175] [6291456 bytes] Test Prepared (ExampleTest::testOne)
[00:00:00.088237489 / 00:00:00.000793929] [6291456 bytes] Assertion Succeeded (Constraint: is true)
[00:00:00.089076305 / 00:00:00.000838816] [6291456 bytes] Test Passed (ExampleTest::testOne)
[00:00:00.091027624 / 00:00:00.001951319] [6291456 bytes] Test Finished (ExampleTest::testOne)
[00:00:00.091110095 / 00:00:00.000082471] [6291456 bytes] Test Preparation Started (ExampleTest::testTwo)
[00:00:00.091158739 / 00:00:00.000048644] [6291456 bytes] Test Prepared (ExampleTest::testTwo)
[00:00:00.091991799 / 00:00:00.000833060] [6291456 bytes] Assertion Failed (Constraint: is identical to 'foo', Value: 'bar')
[00:00:00.099242925 / 00:00:00.007251126] [8388608 bytes] Test Failed (ExampleTest::testTwo)
                                                          Failed asserting that two strings are identical.
[00:00:00.099386498 / 00:00:00.000143573] [8388608 bytes] Test Finished (ExampleTest::testTwo)
[00:00:00.099437634 / 00:00:00.000051136] [8388608 bytes] Test Suite Finished (ExampleTest, 2 tests)
[00:00:00.103014760 / 00:00:00.003577126] [8388608 bytes] Test Runner Execution Finished
[00:00:00.103207309 / 00:00:00.000192549] [8388608 bytes] Test Runner Finished
[00:00:00.105879902 / 00:00:00.002672593] [8388608 bytes] PHPUnit Finished (Shell Exit Code: 1)
</pre></div> </div> </div> </section> </section> <section id="wrapping-the-test-runner"> <h2>Wrapping the Test Runner<a class="headerlink" href="#wrapping-the-test-runner" title="Permalink to this heading"></a>
</h2> <p>The <code class="docutils literal notranslate"><span class="pre">PHPUnit\TextUI\Application</span></code> class is the entry point for PHPUnit’s own CLI test runner. It is not meant to be (re)used by developers who want to wrap PHPUnit to build something such as ParaTest.</p> <p>For the actual running of tests, <code class="docutils literal notranslate"><span class="pre">PHPUnit\TextUI\Application</span></code> uses <code class="docutils literal notranslate"><span class="pre">PHPUnit\TextUI\TestRunner::run()</span></code>.</p> <p><code class="docutils literal notranslate"><span class="pre">PHPUnit\TextUI\TestRunner::run()</span></code> requires a <code class="docutils literal notranslate"><span class="pre">PHPUnit\TextUI\Configuration\Configuration</span></code>, a <code class="docutils literal notranslate"><span class="pre">PHPUnit\Runner\ResultCache\ResultCache</span></code>, and a <code class="docutils literal notranslate"><span class="pre">PHPUnit\Framework\TestSuite</span></code>.</p> <p>A <code class="docutils literal notranslate"><span class="pre">PHPUnit\TextUI\Configuration\Configuration</span></code> can be built using <code class="docutils literal notranslate"><span class="pre">PHPUnit\TextUI\Configuration\Builder::build()</span></code>. You need to pass <code class="docutils literal notranslate"><span class="pre">$_SERVER['argv']</span></code> to this method. The method then parses CLI arguments/options and loads an XML configuration file, if one can be loaded.</p> <p>A <code class="docutils literal notranslate"><span class="pre">PHPUnit\Framework\TestSuite</span></code> can be built from a <code class="docutils literal notranslate"><span class="pre">PHPUnit\TextUI\Configuration\Configuration</span></code> using <code class="docutils literal notranslate"><span class="pre">PHPUnit\TextUI\Configuration\TestSuiteBuilder::build()</span></code>.</p> <p>While it is marked <code class="docutils literal notranslate"><span class="pre">@internal</span></code>, <code class="docutils literal notranslate"><span class="pre">PHPUnit\TextUI\TestRunner</span></code> is meant to be (re)used by developers who want to wrap PHPUnit’s test runner.</p> </section><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2005&ndash;2025 Sebastian Bergmann<br>Licensed under the Creative Commons Attribution 3.0 Unported License.<br>
    <a href="https://docs.phpunit.de/en/12.0/extending-phpunit.html" class="_attribution-link">https://docs.phpunit.de/en/12.0/extending-phpunit.html</a>
  </p>
</div>
