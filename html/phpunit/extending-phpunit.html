<h1>Extending PHPUnit</h1> <p>PHPUnit can be extended in various ways to make the writing of tests easier and customize the feedback you get from running tests. Here are common starting points to extend PHPUnit.</p> <div class="section" id="subclass-phpunit-framework-testcase"> <h2>Subclass PHPUnit\Framework\TestCase</h2> <p>Write custom assertions and utility methods in an abstract subclass of <code class="docutils literal"><span class="pre">PHPUnit\Framework\TestCase</span></code> and derive your test case classes from that class. This is one of the easiest ways to extend PHPUnit.</p> </div> <div class="section" id="write-custom-assertions"> <h2>Write custom assertions</h2> <p>When writing custom assertions it is the best practice to follow how PHPUnit’s own assertions are implemented. As you can see in <a class="reference internal" href="#extending-phpunit-examples-assert-php"><span class="std std-numref">Example 10.1</span></a>, the <code class="docutils literal"><span class="pre">assertTrue()</span></code> method is a wrapper around the <code class="docutils literal"><span class="pre">isTrue()</span></code> and <code class="docutils literal"><span class="pre">assertThat()</span></code> methods: <code class="docutils literal"><span class="pre">isTrue()</span></code> creates a matcher object that is passed on to <code class="docutils literal"><span class="pre">assertThat()</span></code> for evaluation.</p> <div class="literal-block-wrapper docutils container" id="extending-phpunit-examples-assert-php"> <div class="code-block-caption">
<span class="caption-number">Example 10.1 </span><span class="caption-text">The assertTrue() and isTrue() methods of the PHPUnit\Framework\Assert class</span>
</div> <div class="highlight-php">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">namespace</span> <span class="nx">PHPUnit\Framework</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">PHPUnit\Framework\Constraint\IsTrue</span><span class="p">;</span>

<span class="k">abstract</span> <span class="k">class</span> <span class="nc">Assert</span>
<span class="p">{</span>
    <span class="c1">// ...</span>

    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">assertTrue</span><span class="p">(</span><span class="nv">$condition</span><span class="p">,</span> <span class="nx">string</span> <span class="nv">$message</span> <span class="o">=</span> <span class="s1">''</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="k">static</span><span class="o">::</span><span class="na">assertThat</span><span class="p">(</span><span class="nv">$condition</span><span class="p">,</span> <span class="k">static</span><span class="o">::</span><span class="na">isTrue</span><span class="p">(),</span> <span class="nv">$message</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// ...</span>

    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">isTrue</span><span class="p">()</span><span class="o">:</span> <span class="nx">IsTrue</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">IsTrue</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div> </div> </div> <p><a class="reference internal" href="#extending-phpunit-examples-istrue-php"><span class="std std-numref">Example 10.2</span></a> shows how <code class="docutils literal"><span class="pre">PHPUnit\Framework\Constraint\IsTrue</span></code> extends the abstract base class for matcher objects (or constraints), <code class="docutils literal"><span class="pre">PHPUnit\Framework\Constraint</span></code>.</p> <div class="literal-block-wrapper docutils container" id="extending-phpunit-examples-istrue-php"> <div class="code-block-caption">
<span class="caption-number">Example 10.2 </span><span class="caption-text">The PHPUnit\FrameworkConstraint\IsTrue class</span>
</div> <div class="highlight-php">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">namespace</span> <span class="nx">PHPUnit\Framework\Constraint</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">PHPUnit\Framework\Constraint</span><span class="p">;</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">IsTrue</span> <span class="k">extends</span> <span class="nx">Constraint</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">toString</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="s1">'is true'</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">protected</span> <span class="k">function</span> <span class="nf">matches</span><span class="p">(</span><span class="nv">$other</span><span class="p">)</span><span class="o">:</span> <span class="nx">bool</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$other</span> <span class="o">===</span> <span class="k">true</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> <p>The effort of implementing the <code class="docutils literal"><span class="pre">assertTrue()</span></code> and <code class="docutils literal"><span class="pre">isTrue()</span></code> methods as well as the <code class="docutils literal"><span class="pre">PHPUnit\Framework\Constraint\IsTrue</span></code> class yields the benefit that <code class="docutils literal"><span class="pre">assertThat()</span></code> automatically takes care of evaluating the assertion and bookkeeping tasks such as counting it for statistics. Furthermore, the <code class="docutils literal"><span class="pre">isTrue()</span></code> method can be used as a matcher when configuring mock objects.</p> </div> <div class="section" id="extending-the-testrunner"> <h2>Extending the TestRunner</h2> <p>PHPUnit’s test runner can be extended by registering objects that implement one or more of the following interfaces:</p> <ul class="simple"> <li><code class="docutils literal"><span class="pre">AfterIncompleteTestHook</span></code></li> <li><code class="docutils literal"><span class="pre">AfterLastTestHook</span></code></li> <li><code class="docutils literal"><span class="pre">AfterRiskyTestHook</span></code></li> <li><code class="docutils literal"><span class="pre">AfterSkippedTestHook</span></code></li> <li><code class="docutils literal"><span class="pre">AfterSuccessfulTestHook</span></code></li> <li><code class="docutils literal"><span class="pre">AfterTestErrorHook</span></code></li> <li><code class="docutils literal"><span class="pre">AfterTestFailureHook</span></code></li> <li><code class="docutils literal"><span class="pre">AfterTestWarningHook</span></code></li> <li><code class="docutils literal"><span class="pre">AfterTestHook</span></code></li> <li><code class="docutils literal"><span class="pre">BeforeFirstTestHook</span></code></li> <li><code class="docutils literal"><span class="pre">BeforeTestHook</span></code></li> </ul> <p>Each “hook”, meaning each of the interfaces listed above, represents an event that can occur while the tests are being executed.</p> <p>See <a class="reference internal" href="configuration.html#appendixes-configuration-extensions"><span class="std std-ref">The &lt;extensions&gt; Element</span></a> for details on how to register extensions in PHPUnit’s XML configuration.</p> <p><a class="reference internal" href="#extending-phpunit-examples-testrunnerextension"><span class="std std-numref">Example 10.3</span></a> shows an example for an extension implementing <code class="docutils literal"><span class="pre">BeforeFirstTestHook</span></code> and <code class="docutils literal"><span class="pre">AfterLastTestHook</span></code>:</p> <div class="literal-block-wrapper docutils container" id="extending-phpunit-examples-testrunnerextension"> <div class="code-block-caption">
<span class="caption-number">Example 10.3 </span><span class="caption-text">TestRunner Extension Example</span>
</div> <div class="highlight-php">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">namespace</span> <span class="nx">Vendor</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">PHPUnit\Runner\BeforeFirstTestHook</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\Runner\AfterLastTestHook</span><span class="p">;</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">MyExtension</span> <span class="k">implements</span> <span class="nx">BeforeFirstTestHook</span><span class="p">,</span> <span class="nx">AfterLastTestHook</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">executeBeforeFirstTest</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="c1">// called before the first test is being run</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">executeAfterLastTest</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="c1">// called after the last test has been run</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> <div class="section" id="configuring-extensions"> <h3>Configuring extensions</h3> <p>You can configure PHPUnit extensions, assuming the extension accepts configuration values.</p> <p><a class="reference internal" href="#extending-phpunit-examples-testrunnerconfigurableextension"><span class="std std-numref">Example 10.4</span></a> shows an example how to make an extension configurable, by adding an <code class="docutils literal"><span class="pre">__constructor()</span></code> definition to the extension class:</p> <div class="literal-block-wrapper docutils container" id="extending-phpunit-examples-testrunnerconfigurableextension"> <div class="code-block-caption">
<span class="caption-number">Example 10.4 </span><span class="caption-text">TestRunner Extension with constructor</span>
</div> <div class="highlight-php">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">namespace</span> <span class="nx">Vendor</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">PHPUnit\Runner\BeforeFirstTestHook</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\Runner\AfterLastTestHook</span><span class="p">;</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">MyConfigurableExtension</span> <span class="k">implements</span> <span class="nx">BeforeFirstTestHook</span><span class="p">,</span> <span class="nx">AfterLastTestHook</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$config_value_1</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>

    <span class="k">protected</span> <span class="nv">$config_value_2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$value1</span> <span class="o">=</span> <span class="s1">''</span><span class="p">,</span> <span class="nx">int</span> <span class="nv">$value2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">config_value_1</span> <span class="o">=</span> <span class="nv">$config_1</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">config_value_2</span> <span class="o">=</span> <span class="nv">$config_2</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">executeBeforeFirstTest</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">config_value_1</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">echo</span> <span class="s1">'Testing with configuration value: '</span> <span class="o">.</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">config_value_1</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">executeAfterLastTest</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">config_value_2</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">echo</span> <span class="s1">'Second config value is OK!'</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> <p>To input configuration to the extension via XML, the XML configuration file’s <code class="docutils literal"><span class="pre">extensions</span></code> section needs to be updated to have configuration values, as shown in <a class="reference internal" href="#extending-phpunit-examples-testrunnerconfigurableextensionconfig"><span class="std std-numref">Example 10.5</span></a>:</p> <div class="literal-block-wrapper docutils container" id="extending-phpunit-examples-testrunnerconfigurableextensionconfig"> <div class="code-block-caption">
<span class="caption-number">Example 10.5 </span><span class="caption-text">TestRunner Extension configuration</span>
</div> <div class="highlight-xml">
<div class="highlight"><pre class="highlight" data-language="php"><span class="nt">&lt;extensions&gt;</span>
    <span class="nt">&lt;extension</span> <span class="na">class=</span><span class="s">"Vendor\MyUnconfigurableExtension"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;extension</span> <span class="na">class=</span><span class="s">"Vendor\MyConfigurableExtension"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;arguments&gt;</span>
            <span class="nt">&lt;string&gt;</span>Hello world!<span class="nt">&lt;/string&gt;</span>
            <span class="nt">&lt;int&gt;</span>15<span class="nt">&lt;/int&gt;</span>
        <span class="nt">&lt;/arguments&gt;</span>
    <span class="nt">&lt;/extension&gt;</span>
<span class="nt">&lt;/extensions&gt;</span>
</pre></div> </div> </div> <p>See <a class="reference internal" href="configuration.html#appendixes-configuration-extensions-extension-arguments"><span class="std std-ref">The &lt;arguments&gt; Element</span></a> for details on how to use the <code class="docutils literal"><span class="pre">arguments</span></code> configuration.</p> <p>Remember: all configuration is optional, so make sure your extension either has sane defaults in place, or that it disables itself in case configuration is missing.</p> </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2005&ndash;2020 Sebastian Bergmann<br>Licensed under the Creative Commons Attribution 3.0 Unported License.<br>
    <a href="https://phpunit.readthedocs.io/en/9.5/extending-phpunit.html" class="_attribution-link">https://phpunit.readthedocs.io/en/9.5/extending-phpunit.html</a>
  </p>
</div>
