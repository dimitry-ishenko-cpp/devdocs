<h1>Test Doubles</h1> <p>Gerard Meszaros introduces the concept of Test Doubles in his “xUnit Test Patterns” book like so:</p> <blockquote> <div>
<p>Sometimes it is just plain hard to test the system under test (SUT) because it depends on other components that cannot be used in the test environment. This could be because they aren’t available, they will not return the results needed for the test or because executing them would have undesirable side effects. In other cases, our test strategy requires us to have more control or visibility of the internal behavior of the SUT.</p> <p>When we are writing a test in which we cannot (or chose not to) use a real depended-on component (DOC), we can replace it with a Test Double. The Test Double doesn’t have to behave exactly like the real DOC; it merely has to provide the same API as the real one so that the SUT thinks it is the real one!</p> </div>
</blockquote> <p>The <code class="docutils literal notranslate"><span class="pre">createStub(string</span> <span class="pre">$type)</span></code> and <code class="docutils literal notranslate"><span class="pre">createMock(string</span> <span class="pre">$type)</span></code> methods can be used in a test to automatically generate an object that can act as a test double for the specified original type (interface or extendable class). This test double object can be used in every context where an object of the original type is expected or required.</p> <div class="admonition-limitation-final-private-and-static-methods admonition"> <p class="admonition-title">Limitation: final, private, and static methods</p> <p>Please note that <code class="docutils literal notranslate"><span class="pre">final</span></code>, <code class="docutils literal notranslate"><span class="pre">private</span></code>, and <code class="docutils literal notranslate"><span class="pre">static</span></code> methods cannot be doubled. They are ignored by PHPUnit’s test double functionality and retain their original behavior except for <code class="docutils literal notranslate"><span class="pre">static</span></code> methods which will be replaced by a method throwing an exception.</p> </div> <div class="admonition-limitation-enumerations admonition"> <p class="admonition-title">Limitation: Enumerations</p> <p>Enumerations (<code class="docutils literal notranslate"><span class="pre">enum</span></code>) are <code class="docutils literal notranslate"><span class="pre">final</span></code> classes and therefore cannot be doubled.</p> </div> <div class="admonition-favour-doubling-interfaces-over-doubling-classes admonition"> <p class="admonition-title">Favour doubling interfaces over doubling classes</p> <p>Not only because of the limitations mentioned above, but also to improve your software design, favour the doubling of interfaces over the doubling of classes.</p> </div> <section id="test-stubs"> <h2>Test Stubs<a class="headerlink" href="#test-stubs" title="Permalink to this heading"></a>
</h2> <p>The practice of replacing an object with a test double that (optionally) returns configured return values is referred to as <em>stubbing</em>. You can use a <em>test stub</em> to “replace a real component on which the SUT depends so that the test has a control point for the indirect inputs of the SUT. This allows the test to force the SUT down paths it might not otherwise execute” (Gerard Meszaros).</p> <section id="creating-test-stubs"> <h3>Creating Test Stubs<a class="headerlink" href="#creating-test-stubs" title="Permalink to this heading"></a>
</h3> <section id="createstub"> <h4>
<code class="docutils literal notranslate"><span class="pre">createStub()</span></code><a class="headerlink" href="#createstub" title="Permalink to this heading"></a>
</h4> <p>The <code class="docutils literal notranslate"><span class="pre">createStub(string</span> <span class="pre">$type)</span></code> method returns a test stub for the specified interface or extendable class.</p> <p>All methods of the original type are replaced with an implementation that returns an automatically generated value that satisfies the method’s return type declaration without calling the original method. These methods are referred to as “doubled methods”.</p> <p>The behaviour of doubled methods can be configured using methods such as <code class="docutils literal notranslate"><span class="pre">willReturn()</span></code> or <code class="docutils literal notranslate"><span class="pre">willThrowException()</span></code>. These methods are explained later.</p> </section> <section id="createstubforintersectionofinterfaces"> <h4>
<code class="docutils literal notranslate"><span class="pre">createStubForIntersectionOfInterfaces()</span></code><a class="headerlink" href="#createstubforintersectionofinterfaces" title="Permalink to this heading"></a>
</h4> <p>The <code class="docutils literal notranslate"><span class="pre">createStubForIntersectionOfInterfaces(array</span> <span class="pre">$interfaces)</span></code> method can be used to create a test stub for an intersection of interfaces based on a list of interface names.</p> <p>Consider you have the following interfaces <code class="docutils literal notranslate"><span class="pre">X</span></code> and <code class="docutils literal notranslate"><span class="pre">Y</span></code>:</p> <div class="literal-block-wrapper docutils container" id="id6"> <div class="code-block-caption">
<span class="caption-number">Example 6.1 </span><span class="caption-text">An interface named X</span><a class="headerlink" href="#id6" title="Permalink to this code"></a>
</div> <div class="highlight-php notranslate">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">interface</span> <span class="nx">X</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">m</span><span class="p">()</span><span class="o">:</span> <span class="nx">bool</span><span class="p">;</span>
<span class="p">}</span>
</pre></div> </div> </div> <div class="literal-block-wrapper docutils container" id="id7"> <div class="code-block-caption">
<span class="caption-number">Example 6.2 </span><span class="caption-text">An interface named Y</span><a class="headerlink" href="#id7" title="Permalink to this code"></a>
</div> <div class="highlight-php notranslate">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">interface</span> <span class="nx">Y</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">n</span><span class="p">()</span><span class="o">:</span> <span class="nx">int</span><span class="p">;</span>
<span class="p">}</span>
</pre></div> </div> </div> <p>And you have a class that you want to test named <code class="docutils literal notranslate"><span class="pre">Z</span></code>:</p> <div class="literal-block-wrapper docutils container" id="id8"> <div class="code-block-caption">
<span class="caption-number">Example 6.3 </span><span class="caption-text">A class named Z</span><a class="headerlink" href="#id8" title="Permalink to this code"></a>
</div> <div class="highlight-php notranslate">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">final</span> <span class="k">class</span> <span class="nc">Z</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">doSomething</span><span class="p">(</span><span class="nx">X</span><span class="o">&amp;</span><span class="nx">Y</span> <span class="nv">$input</span><span class="p">)</span><span class="o">:</span> <span class="nx">bool</span>
    <span class="p">{</span>
        <span class="nv">$result</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>

        <span class="c1">// ...</span>

        <span class="k">return</span> <span class="nv">$result</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> <p>To test <code class="docutils literal notranslate"><span class="pre">Z</span></code>, we need an object that satisfies the intersection type <code class="docutils literal notranslate"><span class="pre">X&amp;Y</span></code>. We can use the <code class="docutils literal notranslate"><span class="pre">createStubForIntersectionOfInterfaces(array</span> <span class="pre">$interfaces)</span></code> method to create a test stub that satisfies <code class="docutils literal notranslate"><span class="pre">X&amp;Y</span></code> like so:</p> <div class="literal-block-wrapper docutils container" id="id9"> <div class="code-block-caption">
<span class="caption-number">Example 6.4 </span><span class="caption-text">Using createStubForIntersectionOfInterfaces() to create a test stub for an intersection type</span><a class="headerlink" href="#id9" title="Permalink to this code"></a>
</div> <div class="highlight-php notranslate">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">StubForIntersectionExampleTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testCreateStubForIntersection</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$o</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createStubForIntersectionOfInterfaces</span><span class="p">([</span><span class="nx">X</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nx">Y</span><span class="o">::</span><span class="na">class</span><span class="p">]);</span>

        <span class="c1">// $o is of type X ...</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertInstanceOf</span><span class="p">(</span><span class="nx">X</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nv">$o</span><span class="p">);</span>

        <span class="c1">// ... and $o is of type Y</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertInstanceOf</span><span class="p">(</span><span class="nx">Y</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nv">$o</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> </section> <section id="createconfiguredstub"> <h4>
<code class="docutils literal notranslate"><span class="pre">createConfiguredStub()</span></code><a class="headerlink" href="#createconfiguredstub" title="Permalink to this heading"></a>
</h4> <p>The <code class="docutils literal notranslate"><span class="pre">createConfiguredStub()</span></code> method is a convenience wrapper around <code class="docutils literal notranslate"><span class="pre">createStub()</span></code> that allows configuring return values using an associative array (<code class="docutils literal notranslate"><span class="pre">['methodName'</span> <span class="pre">=&gt;</span> <span class="pre">&lt;return</span> <span class="pre">value&gt;]</span></code>):</p> <div class="literal-block-wrapper docutils container" id="id10"> <div class="code-block-caption">
<span class="caption-number">Example 6.5 </span><span class="caption-text">Using createConfiguredStub() to create a test stub and configure return values</span><a class="headerlink" href="#id10" title="Permalink to this code"></a>
</div> <div class="highlight-php notranslate">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">CreateConfiguredStubExampleTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testCreateConfiguredStub</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$o</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createConfiguredStub</span><span class="p">(</span>
            <span class="nx">SomeInterface</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
            <span class="p">[</span>
                <span class="s1">'doSomething'</span>     <span class="o">=&gt;</span> <span class="s1">'foo'</span><span class="p">,</span>
                <span class="s1">'doSomethingElse'</span> <span class="o">=&gt;</span> <span class="s1">'bar'</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">);</span>

        <span class="c1">// $o-&gt;doSomething() now returns 'foo'</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="s1">'foo'</span><span class="p">,</span> <span class="nv">$o</span><span class="o">-&gt;</span><span class="na">doSomething</span><span class="p">());</span>

        <span class="c1">// $o-&gt;doSomethingElse() now returns 'bar'</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="s1">'bar'</span><span class="p">,</span> <span class="nv">$o</span><span class="o">-&gt;</span><span class="na">doSomethingElse</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> </section> </section> <section id="configuring-test-stubs"> <h3>Configuring Test Stubs<a class="headerlink" href="#configuring-test-stubs" title="Permalink to this heading"></a>
</h3> <section id="willreturn"> <h4>
<code class="docutils literal notranslate"><span class="pre">willReturn()</span></code><a class="headerlink" href="#willreturn" title="Permalink to this heading"></a>
</h4> <p>Using the <code class="docutils literal notranslate"><span class="pre">willReturn()</span></code> method, for instance, you can configure a doubled method to return a specified value when it is called. This configured value must be compatible with the method’s return type declaration.</p> <p>Consider that we have a class that we want to test, <code class="docutils literal notranslate"><span class="pre">SomeClass</span></code>, which depends on <code class="docutils literal notranslate"><span class="pre">Dependency</span></code>:</p> <div class="literal-block-wrapper docutils container" id="id11"> <div class="code-block-caption">
<span class="caption-number">Example 6.6 </span><span class="caption-text">The class we want to test</span><a class="headerlink" href="#id11" title="Permalink to this code"></a>
</div> <div class="highlight-php notranslate">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">final</span> <span class="k">class</span> <span class="nc">SomeClass</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">doSomething</span><span class="p">(</span><span class="nx">Dependency</span> <span class="nv">$dependency</span><span class="p">)</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="nv">$result</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>

        <span class="c1">// ...</span>

        <span class="k">return</span> <span class="nv">$result</span> <span class="o">.</span> <span class="nv">$dependency</span><span class="o">-&gt;</span><span class="na">doSomething</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> <div class="literal-block-wrapper docutils container" id="id12"> <div class="code-block-caption">
<span class="caption-number">Example 6.7 </span><span class="caption-text">The dependency we want to stub</span><a class="headerlink" href="#id12" title="Permalink to this code"></a>
</div> <div class="highlight-php notranslate">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">interface</span> <span class="nx">Dependency</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">doSomething</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span><span class="p">;</span>
<span class="p">}</span>
</pre></div> </div> </div> <p>Here is a first example of how to use the <code class="docutils literal notranslate"><span class="pre">createStub(string</span> <span class="pre">$type)</span></code> method to create a test stub for <code class="docutils literal notranslate"><span class="pre">Dependency</span></code> so that we can test <code class="docutils literal notranslate"><span class="pre">SomeClass</span></code> without using a real implementation of <code class="docutils literal notranslate"><span class="pre">Dependency</span></code>:</p> <div class="literal-block-wrapper docutils container" id="test-doubles-test-stubs-examples-someclasstest-php"> <div class="code-block-caption">
<span class="caption-number">Example 6.8 </span><span class="caption-text">Stubbing a method call to return a fixed value</span><a class="headerlink" href="#test-doubles-test-stubs-examples-someclasstest-php" title="Permalink to this code"></a>
</div> <div class="highlight-php notranslate">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">SomeClassTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testDoesSomething</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$sut</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SomeClass</span><span class="p">;</span>

        <span class="c1">// Create a test stub for the Dependency interface</span>
        <span class="nv">$dependency</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createStub</span><span class="p">(</span><span class="nx">Dependency</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>

        <span class="c1">// Configure the test stub</span>
        <span class="nv">$dependency</span><span class="o">-&gt;</span><span class="na">method</span><span class="p">(</span><span class="s1">'doSomething'</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">willReturn</span><span class="p">(</span><span class="s1">'foo'</span><span class="p">);</span>

        <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$sut</span><span class="o">-&gt;</span><span class="na">doSomething</span><span class="p">(</span><span class="nv">$dependency</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertStringEndsWith</span><span class="p">(</span><span class="s1">'foo'</span><span class="p">,</span> <span class="nv">$result</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> <div class="admonition-limitation-methods-named-method admonition"> <p class="admonition-title">Limitation: Methods named “method”</p> <p>The example shown above only works when the original interface or class does not declare a method named “method”.</p> <p>If the original interface or class does declare a method named “method” then <code class="docutils literal notranslate"><span class="pre">$stub-&gt;expects($this-&gt;any())-&gt;method('doSomething')-&gt;willReturn('foo');</span></code> has to be used.</p> </div> <div class="admonition-deprecation-doubling-interfaces-or-classes-that-have-a-method-named-method admonition"> <p class="admonition-title">Deprecation: Doubling interfaces (or classes) that have a method named “method”</p> <p>As of PHPUnit 10.3, the support for doubling interfaces (or classes) that have a method named “method” is soft-deprecated, meaning the deprecation is in documentation only.</p> <p>Starting with PHPUnit 11, doubling interfaces (or classes) that have a method named “method” will trigger a deprecation warning. Support for doubling interfaces (or classes) that have a method named “method” will be removed in PHPUnit 12.</p> </div> <p>In the example shown above, we first use the <code class="docutils literal notranslate"><span class="pre">createStub()</span></code> method to create a test stub, an object that looks like an instance of <code class="docutils literal notranslate"><span class="pre">Dependency</span></code>.</p> <p>We then use the <a class="reference external" href="http://martinfowler.com/bliki/FluentInterface.html">Fluent Interface</a> that PHPUnit provides to specify the behavior for the test stub.</p> <p>“Behind the scenes”, PHPUnit automatically generates a new PHP class that implements the desired behavior when the <code class="docutils literal notranslate"><span class="pre">createStub()</span></code> method is used.</p> <p>Please note that <code class="docutils literal notranslate"><span class="pre">createStub()</span></code> will automatically and recursively stub return values based on a method’s return type. Consider the example shown below:</p> <div class="literal-block-wrapper docutils container" id="id13"> <div class="code-block-caption">
<span class="caption-number">Example 6.9 </span><span class="caption-text">A method with a return type declaration</span><a class="headerlink" href="#id13" title="Permalink to this code"></a>
</div> <div class="highlight-php notranslate">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">class</span> <span class="nc">C</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">m</span><span class="p">()</span><span class="o">:</span> <span class="nx">D</span>
    <span class="p">{</span>
        <span class="c1">// Do something.</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> <p>In the example shown above, the <code class="docutils literal notranslate"><span class="pre">C::m()</span></code> method has a return type declaration indicating that this method returns an object of type <code class="docutils literal notranslate"><span class="pre">D</span></code>. When a test double for <code class="docutils literal notranslate"><span class="pre">C</span></code> is created and no return value is configured for <code class="docutils literal notranslate"><span class="pre">m()</span></code> using <code class="docutils literal notranslate"><span class="pre">willReturn()</span></code> (see above), for instance, then when <code class="docutils literal notranslate"><span class="pre">m()</span></code> is invoked PHPUnit will automatically create a test double for <code class="docutils literal notranslate"><span class="pre">D</span></code> to be returned.</p> <p>Similarly, if <code class="docutils literal notranslate"><span class="pre">m</span></code> had a return type declaration for a scalar type then a return value such as <code class="docutils literal notranslate"><span class="pre">0</span></code> (for <code class="docutils literal notranslate"><span class="pre">int</span></code>), <code class="docutils literal notranslate"><span class="pre">0.0</span></code> (for <code class="docutils literal notranslate"><span class="pre">float</span></code>), or <code class="docutils literal notranslate"><span class="pre">[]</span></code> (for <code class="docutils literal notranslate"><span class="pre">array</span></code>) would be generated.</p> <p>A list of desired return values can also be specified. Here is an example:</p> <div class="literal-block-wrapper docutils container" id="id14"> <div class="code-block-caption">
<span class="caption-number">Example 6.10 </span><span class="caption-text">Using willReturn() to stub a method call to return a list of values in the specified order</span><a class="headerlink" href="#id14" title="Permalink to this code"></a>
</div> <div class="highlight-php notranslate">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">OnConsecutiveCallsExampleTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testOnConsecutiveCallsStub</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="c1">// Create a stub for the SomeClass class.</span>
        <span class="nv">$stub</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createStub</span><span class="p">(</span><span class="nx">SomeClass</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>

        <span class="c1">// Configure the stub.</span>
        <span class="nv">$stub</span><span class="o">-&gt;</span><span class="na">method</span><span class="p">(</span><span class="s1">'doSomething'</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">willReturn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>

        <span class="c1">// $stub-&gt;doSomething() returns a different value each time</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nv">$stub</span><span class="o">-&gt;</span><span class="na">doSomething</span><span class="p">());</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nv">$stub</span><span class="o">-&gt;</span><span class="na">doSomething</span><span class="p">());</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="nv">$stub</span><span class="o">-&gt;</span><span class="na">doSomething</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> </section> <section id="willthrowexception"> <h4>
<code class="docutils literal notranslate"><span class="pre">willThrowException()</span></code><a class="headerlink" href="#willthrowexception" title="Permalink to this heading"></a>
</h4> <p>Instead of returning a value, a stubbed method can also raise an exception. Here is an example that shows how to use <code class="docutils literal notranslate"><span class="pre">willThrowException()</span></code> to do this:</p> <div class="literal-block-wrapper docutils container" id="id15"> <div class="code-block-caption">
<span class="caption-number">Example 6.11 </span><span class="caption-text">Using willThrowException() to stub a method call to throw an exception</span><a class="headerlink" href="#id15" title="Permalink to this code"></a>
</div> <div class="highlight-php notranslate">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">ThrowExceptionExampleTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testThrowExceptionStub</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="c1">// Create a stub for the SomeClass class.</span>
        <span class="nv">$stub</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createStub</span><span class="p">(</span><span class="nx">SomeClass</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>

        <span class="c1">// Configure the stub.</span>
        <span class="nv">$stub</span><span class="o">-&gt;</span><span class="na">method</span><span class="p">(</span><span class="s1">'doSomething'</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">willThrowException</span><span class="p">(</span><span class="k">new</span> <span class="nx">Exception</span><span class="p">);</span>

        <span class="c1">// $stub-&gt;doSomething() throws Exception</span>
        <span class="nv">$stub</span><span class="o">-&gt;</span><span class="na">doSomething</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> </section> <section id="willreturnargument"> <h4>
<code class="docutils literal notranslate"><span class="pre">willReturnArgument()</span></code><a class="headerlink" href="#willreturnargument" title="Permalink to this heading"></a>
</h4> <p>Sometimes you want to return one of the arguments of a method call (unchanged) as the result of a stubbed method call. Here is an example that shows how you can achieve this using <code class="docutils literal notranslate"><span class="pre">willReturnArgument()</span></code>:</p> <div class="literal-block-wrapper docutils container" id="id16"> <div class="code-block-caption">
<span class="caption-number">Example 6.12 </span><span class="caption-text">Using willReturnArgument() to stub a method call to return one of the arguments</span><a class="headerlink" href="#id16" title="Permalink to this code"></a>
</div> <div class="highlight-php notranslate">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">ReturnArgumentExampleTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testReturnArgumentStub</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="c1">// Create a stub for the SomeClass class.</span>
        <span class="nv">$stub</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createStub</span><span class="p">(</span><span class="nx">SomeClass</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>

        <span class="c1">// Configure the stub.</span>
        <span class="nv">$stub</span><span class="o">-&gt;</span><span class="na">method</span><span class="p">(</span><span class="s1">'doSomething'</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">willReturnArgument</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

        <span class="c1">// $stub-&gt;doSomething('foo') returns 'foo'</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="s1">'foo'</span><span class="p">,</span> <span class="nv">$stub</span><span class="o">-&gt;</span><span class="na">doSomething</span><span class="p">(</span><span class="s1">'foo'</span><span class="p">));</span>

        <span class="c1">// $stub-&gt;doSomething('bar') returns 'bar'</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="s1">'bar'</span><span class="p">,</span> <span class="nv">$stub</span><span class="o">-&gt;</span><span class="na">doSomething</span><span class="p">(</span><span class="s1">'bar'</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> </section> <section id="willreturncallback"> <h4>
<code class="docutils literal notranslate"><span class="pre">willReturnCallback()</span></code><a class="headerlink" href="#willreturncallback" title="Permalink to this heading"></a>
</h4> <p>When the stubbed method call should return a calculated value instead of a fixed one (see <code class="docutils literal notranslate"><span class="pre">willReturn()</span></code>) or an (unchanged) argument (see <code class="docutils literal notranslate"><span class="pre">willReturnArgument()</span></code>), you can use <code class="docutils literal notranslate"><span class="pre">willReturnCallback()</span></code> to have the stubbed method return the result of a callback function or method. Here is an example:</p> <div class="literal-block-wrapper docutils container" id="id17"> <div class="code-block-caption">
<span class="caption-number">Example 6.13 </span><span class="caption-text">Using willReturnCallback() to stub a method call to return a value from a callback</span><a class="headerlink" href="#id17" title="Permalink to this code"></a>
</div> <div class="highlight-php notranslate">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">ReturnCallbackExampleTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testReturnCallbackStub</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="c1">// Create a stub for the SomeClass class.</span>
        <span class="nv">$stub</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createStub</span><span class="p">(</span><span class="nx">SomeClass</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>

        <span class="c1">// Configure the stub.</span>
        <span class="nv">$stub</span><span class="o">-&gt;</span><span class="na">method</span><span class="p">(</span><span class="s1">'doSomething'</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">willReturnCallback</span><span class="p">(</span><span class="s1">'str_rot13'</span><span class="p">);</span>

        <span class="c1">// $stub-&gt;doSomething($argument) returns str_rot13($argument)</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="s1">'fbzrguvat'</span><span class="p">,</span> <span class="nv">$stub</span><span class="o">-&gt;</span><span class="na">doSomething</span><span class="p">(</span><span class="s1">'something'</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> </section> <section id="willreturnself"> <h4>
<code class="docutils literal notranslate"><span class="pre">willReturnSelf()</span></code><a class="headerlink" href="#willreturnself" title="Permalink to this heading"></a>
</h4> <p>When testing a fluent interface, it is sometimes useful to have a stubbed method return a reference to the stubbed object. Here is an example that shows how you can use <code class="docutils literal notranslate"><span class="pre">willReturnSelf()</span></code> to achieve this:</p> <div class="literal-block-wrapper docutils container" id="id18"> <div class="code-block-caption">
<span class="caption-number">Example 6.14 </span><span class="caption-text">Using willReturnSelf() to stub a method call to return a reference to the stub object</span><a class="headerlink" href="#id18" title="Permalink to this code"></a>
</div> <div class="highlight-php notranslate">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">ReturnSelfExampleTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testReturnSelf</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="c1">// Create a stub for the SomeClass class.</span>
        <span class="nv">$stub</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createStub</span><span class="p">(</span><span class="nx">SomeClass</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>

        <span class="c1">// Configure the stub.</span>
        <span class="nv">$stub</span><span class="o">-&gt;</span><span class="na">method</span><span class="p">(</span><span class="s1">'doSomething'</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">willReturnSelf</span><span class="p">();</span>

        <span class="c1">// $stub-&gt;doSomething() returns $stub</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="nv">$stub</span><span class="p">,</span> <span class="nv">$stub</span><span class="o">-&gt;</span><span class="na">doSomething</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> </section> <section id="willreturnmap"> <h4>
<code class="docutils literal notranslate"><span class="pre">willReturnMap()</span></code><a class="headerlink" href="#willreturnmap" title="Permalink to this heading"></a>
</h4> <p>Sometimes a stubbed method should return different values depending on a predefined list of arguments. Here is an example that shows how to use <code class="docutils literal notranslate"><span class="pre">willReturnMap()</span></code> to create a map that associates arguments with corresponding return values:</p> <div class="literal-block-wrapper docutils container" id="id19"> <div class="code-block-caption">
<span class="caption-number">Example 6.15 </span><span class="caption-text">Using willReturnMap() to stub a method call to return the value from a map</span><a class="headerlink" href="#id19" title="Permalink to this code"></a>
</div> <div class="highlight-php notranslate">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">ReturnMapExampleTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testReturnMapStub</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="c1">// Create a stub for the SomeClass class.</span>
        <span class="nv">$stub</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createStub</span><span class="p">(</span><span class="nx">SomeClass</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>

        <span class="c1">// Create a map of arguments to return values.</span>
        <span class="nv">$map</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="s1">'a'</span><span class="p">,</span> <span class="s1">'b'</span><span class="p">,</span> <span class="s1">'c'</span><span class="p">,</span> <span class="s1">'d'</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">'e'</span><span class="p">,</span> <span class="s1">'f'</span><span class="p">,</span> <span class="s1">'g'</span><span class="p">,</span> <span class="s1">'h'</span><span class="p">],</span>
        <span class="p">];</span>

        <span class="c1">// Configure the stub.</span>
        <span class="nv">$stub</span><span class="o">-&gt;</span><span class="na">method</span><span class="p">(</span><span class="s1">'doSomething'</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">willReturnMap</span><span class="p">(</span><span class="nv">$map</span><span class="p">);</span>

        <span class="c1">// $stub-&gt;doSomething() returns different values depending on</span>
        <span class="c1">// the provided arguments.</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="s1">'d'</span><span class="p">,</span> <span class="nv">$stub</span><span class="o">-&gt;</span><span class="na">doSomething</span><span class="p">(</span><span class="s1">'a'</span><span class="p">,</span> <span class="s1">'b'</span><span class="p">,</span> <span class="s1">'c'</span><span class="p">));</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="s1">'h'</span><span class="p">,</span> <span class="nv">$stub</span><span class="o">-&gt;</span><span class="na">doSomething</span><span class="p">(</span><span class="s1">'e'</span><span class="p">,</span> <span class="s1">'f'</span><span class="p">,</span> <span class="s1">'g'</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> </section> <section id="get-hooked-properties"> <h4>Get-Hooked Properties<a class="headerlink" href="#get-hooked-properties" title="Permalink to this heading"></a>
</h4> <p>PHP 8.4 introduced the language feature of <a class="reference external" href="https://www.php.net/releases/8.4/en.php#property_hooks">get-hooked properties</a>.</p> <p>The example below shows an interface that declares a get-hooked property:</p> <div class="literal-block-wrapper docutils container" id="id20"> <div class="code-block-caption">
<span class="caption-number">Example 6.16 </span><span class="caption-text">Interface that declares a get-hooked property</span><a class="headerlink" href="#id20" title="Permalink to this code"></a>
</div> <div class="highlight-php notranslate">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">interface</span> <span class="nx">InterfaceWithGetHookedProperty</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nx">string</span> <span class="nv">$property</span> <span class="p">{</span> <span class="nx">get</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> <p>The behaviour of the get-hooked property <code class="docutils literal notranslate"><span class="pre">property</span></code> can be configured like so:</p> <div class="literal-block-wrapper docutils container" id="id21"> <div class="code-block-caption">
<span class="caption-number">Example 6.17 </span><span class="caption-text">Test that uses a test stub of an interface with a get-hooked property</span><a class="headerlink" href="#id21" title="Permalink to this code"></a>
</div> <div class="highlight-php notranslate">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\MockObject\Runtime\PropertyHook</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">ExampleTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testExample</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$stub</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createStub</span><span class="p">(</span>
            <span class="nx">InterfaceWithHookedProperty</span><span class="o">::</span><span class="na">class</span>
        <span class="p">);</span>

        <span class="nv">$stub</span>
            <span class="o">-&gt;</span><span class="na">method</span><span class="p">(</span><span class="nx">PropertyHook</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">'property'</span><span class="p">))</span>
            <span class="o">-&gt;</span><span class="na">willReturn</span><span class="p">(</span><span class="s1">'value'</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="s1">'value'</span><span class="p">,</span> <span class="nv">$stub</span><span class="o">-&gt;</span><span class="na">property</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> <p>In the example shown above, <code class="docutils literal notranslate"><span class="pre">PropertyHook::get('property')</span></code> to specify that we want to configure the behaviour of the method that is called when the property named <code class="docutils literal notranslate"><span class="pre">property</span></code> is accessed for reading.</p> </section> </section> </section> <section id="mock-objects"> <h2>Mock Objects<a class="headerlink" href="#mock-objects" title="Permalink to this heading"></a>
</h2> <p>The practice of replacing an object with a test double that verifies expectations, for instance asserting that a method has been called, is referred to as <em>mocking</em>.</p> <p>You can use a <em>mock object</em> “as an observation point that is used to verify the indirect outputs of the SUT as it is exercised. Typically, the mock object also includes the functionality of a test stub in that it must return values to the SUT if it hasn’t already failed the tests but the emphasis is on the verification of the indirect outputs. Therefore, a mock object is a lot more than just a test stub plus assertions; it is used in a fundamentally different way” (Gerard Meszaros).</p> <section id="creating-mock-objects"> <h3>Creating Mock Objects<a class="headerlink" href="#creating-mock-objects" title="Permalink to this heading"></a>
</h3> <section id="createmock"> <h4>
<code class="docutils literal notranslate"><span class="pre">createMock()</span></code><a class="headerlink" href="#createmock" title="Permalink to this heading"></a>
</h4> <p>The <code class="docutils literal notranslate"><span class="pre">createMock(string</span> <span class="pre">$type)</span></code> method returns a mock object for the specified interface or extendable class.</p> <p>All methods of the original type are replaced with an implementation that returns an automatically generated value that satisfies the method’s return type declaration without calling the original method. These methods are referred to as “doubled methods”.</p> <p>The behaviour of doubled methods can be configured using methods such as <code class="docutils literal notranslate"><span class="pre">willReturn()</span></code> or <code class="docutils literal notranslate"><span class="pre">willThrowException()</span></code>. These methods are explained in the section on Test Stubs above.</p> <p>Expectations for invocations of doubled methods (“method must be called with specified arguments”, “method must not be called”, etc.) can be configured using the mock object’s <code class="docutils literal notranslate"><span class="pre">expects()</span></code> method.</p> </section> <section id="createmockforintersectionofinterfaces"> <h4>
<code class="docutils literal notranslate"><span class="pre">createMockForIntersectionOfInterfaces()</span></code><a class="headerlink" href="#createmockforintersectionofinterfaces" title="Permalink to this heading"></a>
</h4> <p>The <code class="docutils literal notranslate"><span class="pre">createMockForIntersectionOfInterfaces(array</span> <span class="pre">$interfaces)</span></code> method can be used to create a mock object for an intersection of interfaces based on a list of interface names.</p> <p>Consider you have the following interfaces <code class="docutils literal notranslate"><span class="pre">X</span></code> and <code class="docutils literal notranslate"><span class="pre">Y</span></code>:</p> <div class="literal-block-wrapper docutils container" id="id22"> <div class="code-block-caption">
<span class="caption-number">Example 6.18 </span><span class="caption-text">An interface named X</span><a class="headerlink" href="#id22" title="Permalink to this code"></a>
</div> <div class="highlight-php notranslate">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">interface</span> <span class="nx">X</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">m</span><span class="p">()</span><span class="o">:</span> <span class="nx">bool</span><span class="p">;</span>
<span class="p">}</span>
</pre></div> </div> </div> <div class="literal-block-wrapper docutils container" id="id23"> <div class="code-block-caption">
<span class="caption-number">Example 6.19 </span><span class="caption-text">An interface named Y</span><a class="headerlink" href="#id23" title="Permalink to this code"></a>
</div> <div class="highlight-php notranslate">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">interface</span> <span class="nx">Y</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">n</span><span class="p">()</span><span class="o">:</span> <span class="nx">int</span><span class="p">;</span>
<span class="p">}</span>
</pre></div> </div> </div> <p>And you have a class that you want to test named <code class="docutils literal notranslate"><span class="pre">Z</span></code>:</p> <div class="literal-block-wrapper docutils container" id="id24"> <div class="code-block-caption">
<span class="caption-number">Example 6.20 </span><span class="caption-text">A class named Z</span><a class="headerlink" href="#id24" title="Permalink to this code"></a>
</div> <div class="highlight-php notranslate">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">final</span> <span class="k">class</span> <span class="nc">Z</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">doSomething</span><span class="p">(</span><span class="nx">X</span><span class="o">&amp;</span><span class="nx">Y</span> <span class="nv">$input</span><span class="p">)</span><span class="o">:</span> <span class="nx">bool</span>
    <span class="p">{</span>
        <span class="nv">$result</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>

        <span class="c1">// ...</span>

        <span class="k">return</span> <span class="nv">$result</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> <p>To test <code class="docutils literal notranslate"><span class="pre">Z</span></code>, we need an object that satisfies the intersection type <code class="docutils literal notranslate"><span class="pre">X&amp;Y</span></code>. We can use the <code class="docutils literal notranslate"><span class="pre">createMockForIntersectionOfInterfaces(array</span> <span class="pre">$interfaces)</span></code> method to create a test stub that satisfies <code class="docutils literal notranslate"><span class="pre">X&amp;Y</span></code> like so:</p> <div class="literal-block-wrapper docutils container" id="id25"> <div class="code-block-caption">
<span class="caption-number">Example 6.21 </span><span class="caption-text">Using createMockForIntersectionOfInterfaces() to create a mock object for an intersection type</span><a class="headerlink" href="#id25" title="Permalink to this code"></a>
</div> <div class="highlight-php notranslate">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">MockForIntersectionExampleTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testCreateMockForIntersection</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$o</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createMockForIntersectionOfInterfaces</span><span class="p">([</span><span class="nx">X</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nx">Y</span><span class="o">::</span><span class="na">class</span><span class="p">]);</span>

        <span class="c1">// $o is of type X ...</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertInstanceOf</span><span class="p">(</span><span class="nx">X</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nv">$o</span><span class="p">);</span>

        <span class="c1">// ... and $o is of type Y</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertInstanceOf</span><span class="p">(</span><span class="nx">Y</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nv">$o</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> </section> <section id="createconfiguredmock"> <h4>
<code class="docutils literal notranslate"><span class="pre">createConfiguredMock()</span></code><a class="headerlink" href="#createconfiguredmock" title="Permalink to this heading"></a>
</h4> <p>The <code class="docutils literal notranslate"><span class="pre">createConfiguredMock()</span></code> method is a convenience wrapper around <code class="docutils literal notranslate"><span class="pre">createMock()</span></code> that allows configuring return values using an associative array (<code class="docutils literal notranslate"><span class="pre">['methodName'</span> <span class="pre">=&gt;</span> <span class="pre">&lt;return</span> <span class="pre">value&gt;]</span></code>):</p> <div class="literal-block-wrapper docutils container" id="id26"> <div class="code-block-caption">
<span class="caption-number">Example 6.22 </span><span class="caption-text">Using createConfiguredMock() to create a mock object and configure return values</span><a class="headerlink" href="#id26" title="Permalink to this code"></a>
</div> <div class="highlight-php notranslate">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">CreateConfiguredMockExampleTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testCreateConfiguredMock</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$o</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createConfiguredMock</span><span class="p">(</span>
            <span class="nx">SomeInterface</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
            <span class="p">[</span>
                <span class="s1">'doSomething'</span>     <span class="o">=&gt;</span> <span class="s1">'foo'</span><span class="p">,</span>
                <span class="s1">'doSomethingElse'</span> <span class="o">=&gt;</span> <span class="s1">'bar'</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">);</span>

        <span class="c1">// $o-&gt;doSomething() now returns 'foo'</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="s1">'foo'</span><span class="p">,</span> <span class="nv">$o</span><span class="o">-&gt;</span><span class="na">doSomething</span><span class="p">());</span>

        <span class="c1">// $o-&gt;doSomethingElse() now returns 'bar'</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="s1">'bar'</span><span class="p">,</span> <span class="nv">$o</span><span class="o">-&gt;</span><span class="na">doSomethingElse</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> </section> <section id="getmockforabstractclass"> <h4>
<code class="docutils literal notranslate"><span class="pre">getMockForAbstractClass()</span></code><a class="headerlink" href="#getmockforabstractclass" title="Permalink to this heading"></a>
</h4> <p>The <code class="docutils literal notranslate"><span class="pre">getMockForAbstractClass()</span></code> method returns a mock object for an abstract class. All abstract methods of the given abstract class are mocked. This allows for testing the concrete methods of an abstract class.</p> <div class="literal-block-wrapper docutils container" id="id27"> <div class="code-block-caption">
<span class="caption-number">Example 6.23 </span><span class="caption-text">An abstract class with a concrete method</span><a class="headerlink" href="#id27" title="Permalink to this code"></a>
</div> <div class="highlight-php notranslate">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">abstract</span> <span class="k">class</span> <span class="nc">AbstractClass</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">concreteMethod</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">abstractMethod</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">abstract</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">abstractMethod</span><span class="p">();</span>
<span class="p">}</span>
</pre></div> </div> </div> <div class="literal-block-wrapper docutils container" id="id28"> <div class="code-block-caption">
<span class="caption-number">Example 6.24 </span><span class="caption-text">A test for a concrete method of an abstract class</span><a class="headerlink" href="#id28" title="Permalink to this code"></a>
</div> <div class="highlight-php notranslate">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">AbstractClassTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testConcreteMethod</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$stub</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getMockForAbstractClass</span><span class="p">(</span><span class="nx">AbstractClass</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>

        <span class="nv">$stub</span><span class="o">-&gt;</span><span class="na">expects</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">any</span><span class="p">())</span>
            <span class="o">-&gt;</span><span class="na">method</span><span class="p">(</span><span class="s1">'abstractMethod'</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">willReturn</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="nv">$stub</span><span class="o">-&gt;</span><span class="na">concreteMethod</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> <div class="admonition-deprecation-getmockforabstractclass-is-deprecated admonition"> <p class="admonition-title">Deprecation: <code class="docutils literal notranslate"><span class="pre">getMockForAbstractClass()</span></code> is deprecated</p> <p>As of PHPUnit 10.1, the <code class="docutils literal notranslate"><span class="pre">getMockForAbstractClass()</span></code> method is soft-deprecated, meaning its declaration is annotated with <code class="docutils literal notranslate"><span class="pre">@deprecated</span></code> so that IDEs and static analysis tools can warn about its usage.</p> <p>Starting with PHPUnit 11, using the <code class="docutils literal notranslate"><span class="pre">getMockForAbstractClass()</span></code> method will trigger a deprecation warning. The method will be removed in PHPUnit 12.</p> </div> </section> <section id="getmockfortrait"> <h4>
<code class="docutils literal notranslate"><span class="pre">getMockForTrait()</span></code><a class="headerlink" href="#getmockfortrait" title="Permalink to this heading"></a>
</h4> <p>The <code class="docutils literal notranslate"><span class="pre">getMockForTrait()</span></code> method returns a mock object that uses a specified trait. All abstract methods of the given trait are mocked. This allows for testing the concrete methods of a trait.</p> <div class="literal-block-wrapper docutils container" id="id29"> <div class="code-block-caption">
<span class="caption-number">Example 6.25 </span><span class="caption-text">A trait with an abstract method</span><a class="headerlink" href="#id29" title="Permalink to this code"></a>
</div> <div class="highlight-php notranslate">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">trait</span> <span class="nx">AbstractTrait</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">concreteMethod</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">abstractMethod</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">abstract</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">abstractMethod</span><span class="p">();</span>
<span class="p">}</span>
</pre></div> </div> </div> <div class="literal-block-wrapper docutils container" id="id30"> <div class="code-block-caption">
<span class="caption-number">Example 6.26 </span><span class="caption-text">A test for a concrete method of a trait</span><a class="headerlink" href="#id30" title="Permalink to this code"></a>
</div> <div class="highlight-php notranslate">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">AbstractTraitTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testConcreteMethod</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$mock</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getMockForTrait</span><span class="p">(</span><span class="nx">AbstractTrait</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>

        <span class="nv">$mock</span><span class="o">-&gt;</span><span class="na">expects</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">any</span><span class="p">())</span>
            <span class="o">-&gt;</span><span class="na">method</span><span class="p">(</span><span class="s1">'abstractMethod'</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">willReturn</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="nv">$mock</span><span class="o">-&gt;</span><span class="na">concreteMethod</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> <div class="admonition-deprecation-getmockfortrait-is-deprecated admonition"> <p class="admonition-title">Deprecation: <code class="docutils literal notranslate"><span class="pre">getMockForTrait()</span></code> is deprecated</p> <p>As of PHPUnit 10.1, the <code class="docutils literal notranslate"><span class="pre">getMockForTrait()</span></code> method is soft-deprecated, meaning its declaration is annotated with <code class="docutils literal notranslate"><span class="pre">@deprecated</span></code> so that IDEs and static analysis tools can warn about its usage.</p> <p>Starting with PHPUnit 11, using the <code class="docutils literal notranslate"><span class="pre">getMockForTrait()</span></code> method will trigger a deprecation warning. The method will be removed in PHPUnit 12.</p> </div> </section> <section id="getmockfromwsdl"> <h4>
<code class="docutils literal notranslate"><span class="pre">getMockFromWsdl()</span></code><a class="headerlink" href="#getmockfromwsdl" title="Permalink to this heading"></a>
</h4> <p>When your application interacts with a web service you want to test it without actually interacting with the web service. To create stubs and mocks of web services, the <code class="docutils literal notranslate"><span class="pre">getMockFromWsdl()</span></code> method can be used.</p> <p>This method returns a mock object based on a web service description in WSDL whereas <code class="docutils literal notranslate"><span class="pre">createMock()</span></code> returns a mock object based on an interface or on a class.</p> <p>Here is an example that shows how to stub the web service described in <code class="file docutils literal notranslate"><span class="pre">HelloService.wsdl</span></code>:</p> <div class="literal-block-wrapper docutils container" id="id31"> <div class="code-block-caption">
<span class="caption-number">Example 6.27 </span><span class="caption-text">Stubbing a web service</span><a class="headerlink" href="#id31" title="Permalink to this code"></a>
</div> <div class="highlight-php notranslate">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">WsdlStubExampleTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testWebserviceCanBeStubbed</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$service</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getMockFromWsdl</span><span class="p">(</span><span class="no">__DIR__</span> <span class="o">.</span> <span class="s1">'/HelloService.wsdl'</span><span class="p">);</span>

        <span class="nv">$service</span><span class="o">-&gt;</span><span class="na">method</span><span class="p">(</span><span class="s1">'sayHello'</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">willReturn</span><span class="p">(</span><span class="s1">'Hello'</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="s1">'Hello'</span><span class="p">,</span> <span class="nv">$service</span><span class="o">-&gt;</span><span class="na">sayHello</span><span class="p">(</span><span class="s1">'message'</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> <div class="admonition-deprecation-getmockfromwsdl-is-deprecated admonition"> <p class="admonition-title">Deprecation: <code class="docutils literal notranslate"><span class="pre">getMockFromWsdl()</span></code> is deprecated</p> <p>As of PHPUnit 10.1, the <code class="docutils literal notranslate"><span class="pre">getMockFromWsdl()</span></code> method is soft-deprecated, meaning its declaration is annotated with <code class="docutils literal notranslate"><span class="pre">@deprecated</span></code> so that IDEs and static analysis tools can warn about its usage.</p> <p>Starting with PHPUnit 11, using the <code class="docutils literal notranslate"><span class="pre">getMockFromWsdl()</span></code> method will trigger a deprecation warning. The method will be removed in PHPUnit 12.</p> </div> </section> </section> <section id="configuring-mock-objects"> <h3>Configuring Mock Objects<a class="headerlink" href="#configuring-mock-objects" title="Permalink to this heading"></a>
</h3> <p>Here is an example: suppose we want to test that the correct method, <code class="docutils literal notranslate"><span class="pre">update()</span></code> in our example, is called on an object that observes another object.</p> <p>Here is the code for the <code class="docutils literal notranslate"><span class="pre">Subject</span></code> class and the <code class="docutils literal notranslate"><span class="pre">Observer</span></code> interface that are part of the System under Test (SUT):</p> <div class="literal-block-wrapper docutils container" id="id32"> <div class="code-block-caption">
<span class="caption-number">Example 6.28 </span><span class="caption-text">Subject class that is part of the System under Test (SUT)</span><a class="headerlink" href="#id32" title="Permalink to this code"></a>
</div> <div class="highlight-php notranslate">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">final</span> <span class="k">class</span> <span class="nc">Subject</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="k">array</span> <span class="nv">$observers</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">attach</span><span class="p">(</span><span class="nx">Observer</span> <span class="nv">$observer</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">observers</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$observer</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">doSomething</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="c1">// ...</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">notify</span><span class="p">(</span><span class="s1">'something'</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">function</span> <span class="nf">notify</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$argument</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">observers</span> <span class="k">as</span> <span class="nv">$observer</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$observer</span><span class="o">-&gt;</span><span class="na">update</span><span class="p">(</span><span class="nv">$argument</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div> </div> </div> <div class="literal-block-wrapper docutils container" id="id33"> <div class="code-block-caption">
<span class="caption-number">Example 6.29 </span><span class="caption-text">Observer interface that is part of the System under Test (SUT)</span><a class="headerlink" href="#id33" title="Permalink to this code"></a>
</div> <div class="highlight-php notranslate">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">interface</span> <span class="nx">Observer</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">update</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$argument</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span><span class="p">;</span>
<span class="p">}</span>
</pre></div> </div> </div> <p>Here is an example that shows how to use a mock object to test the interaction between <code class="docutils literal notranslate"><span class="pre">Subject</span></code> and <code class="docutils literal notranslate"><span class="pre">Observer</span></code> objects:</p> <div class="literal-block-wrapper docutils container" id="id34"> <div class="code-block-caption">
<span class="caption-number">Example 6.30 </span><span class="caption-text">Testing that a method gets called once and with a specified argument</span><a class="headerlink" href="#id34" title="Permalink to this code"></a>
</div> <div class="highlight-php notranslate">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">SubjectTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testObserversAreUpdated</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$observer</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createMock</span><span class="p">(</span><span class="nx">Observer</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>

        <span class="nv">$observer</span><span class="o">-&gt;</span><span class="na">expects</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">once</span><span class="p">())</span>
            <span class="o">-&gt;</span><span class="na">method</span><span class="p">(</span><span class="s1">'update'</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">with</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">identicalTo</span><span class="p">(</span><span class="s1">'something'</span><span class="p">));</span>

        <span class="nv">$subject</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Subject</span><span class="p">;</span>

        <span class="nv">$subject</span><span class="o">-&gt;</span><span class="na">attach</span><span class="p">(</span><span class="nv">$observer</span><span class="p">);</span>

        <span class="nv">$subject</span><span class="o">-&gt;</span><span class="na">doSomething</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> <p>We first use the <code class="docutils literal notranslate"><span class="pre">createMock()</span></code> method to create a mock object for the <code class="docutils literal notranslate"><span class="pre">Observer</span></code>.</p> <p>Because we are interested in verifying the communication between two objects (that a method is called and which arguments it is called with), we use the <code class="docutils literal notranslate"><span class="pre">expects()</span></code> and <code class="docutils literal notranslate"><span class="pre">with()</span></code> methods to specify what this communication should look like.</p> <p>The <code class="docutils literal notranslate"><span class="pre">with()</span></code> method can take any number of arguments, corresponding to the number of arguments to the method being mocked. You can specify more advanced constraints on the method’s arguments than a simple match.</p> <p><a class="reference internal" href="assertions.html#appendixes-assertions-assertthat-tables-constraints"><span class="std std-ref">Constraints</span></a> shows the constraints that can be applied to method arguments and here is a list of the matchers that are available to specify the number of invocations:</p> <ul class="simple"> <li><p><code class="docutils literal notranslate"><span class="pre">any()</span></code> returns a matcher that matches when the method it is evaluated for is executed zero or more times</p></li> <li><p><code class="docutils literal notranslate"><span class="pre">never()</span></code> returns a matcher that matches when the method it is evaluated for is never executed</p></li> <li><p><code class="docutils literal notranslate"><span class="pre">atLeastOnce()</span></code> returns a matcher that matches when the method it is evaluated for is executed at least once</p></li> <li><p><code class="docutils literal notranslate"><span class="pre">once()</span></code> returns a matcher that matches when the method it is evaluated for is executed exactly once</p></li> <li><p><code class="docutils literal notranslate"><span class="pre">atMost(int</span> <span class="pre">$count)</span></code> returns a matcher that matches when the method it is evaluated for is executed at most <code class="docutils literal notranslate"><span class="pre">$count</span></code> times</p></li> <li><p><code class="docutils literal notranslate"><span class="pre">exactly(int</span> <span class="pre">$count)</span></code> returns a matcher that matches when the method it is evaluated for is executed exactly <code class="docutils literal notranslate"><span class="pre">$count</span></code> times</p></li> </ul> </section> </section> <section id="mockbuilder-api"> <h2>MockBuilder API<a class="headerlink" href="#mockbuilder-api" title="Permalink to this heading"></a>
</h2> <p>As mentioned before, when the defaults used by the <code class="docutils literal notranslate"><span class="pre">createStub()</span></code> and <code class="docutils literal notranslate"><span class="pre">createMock()</span></code> methods to generate the test double do not match your needs then you can use the <code class="docutils literal notranslate"><span class="pre">getMockBuilder($type)</span></code> method to customize the test double generation using a fluent interface. The methods provided by the Mock Builder are documented below.</p> <section id="setmockclassname"> <h3>
<code class="docutils literal notranslate"><span class="pre">setMockClassName()</span></code><a class="headerlink" href="#setmockclassname" title="Permalink to this heading"></a>
</h3> <p><code class="docutils literal notranslate"><span class="pre">setMockClassName($name)</span></code> can be used to specify a class name for the generated test double class.</p> <div class="admonition-deprecation-setmockclassname-is-deprecated admonition"> <p class="admonition-title">Deprecation: <code class="docutils literal notranslate"><span class="pre">setMockClassName()</span></code> is deprecated</p> <p>As of PHPUnit 10.3, the <code class="docutils literal notranslate"><span class="pre">setMockClassName()</span></code> method is soft-deprecated, meaning its declaration is annotated with <code class="docutils literal notranslate"><span class="pre">@deprecated</span></code> so that IDEs and static analysis tools can warn about its usage.</p> <p>Starting with PHPUnit 11, using the <code class="docutils literal notranslate"><span class="pre">setMockClassName()</span></code> method will trigger a deprecation warning. The method will be removed in PHPUnit 12.</p> </div> </section> <section id="setconstructorargs"> <h3>
<code class="docutils literal notranslate"><span class="pre">setConstructorArgs()</span></code><a class="headerlink" href="#setconstructorargs" title="Permalink to this heading"></a>
</h3> <p><code class="docutils literal notranslate"><span class="pre">setConstructorArgs(array</span> <span class="pre">$args)</span></code> can be called to provide a parameter array that is passed to the original class’ constructor (which is not replaced with a dummy implementation by default).</p> </section> <section id="disableoriginalconstructor"> <h3>
<code class="docutils literal notranslate"><span class="pre">disableOriginalConstructor()</span></code><a class="headerlink" href="#disableoriginalconstructor" title="Permalink to this heading"></a>
</h3> <p><code class="docutils literal notranslate"><span class="pre">disableOriginalConstructor()</span></code> can be used to disable the call to the constructor of the original class.</p> <p><code class="docutils literal notranslate"><span class="pre">enableOriginalConstructor()</span></code> can be used to make it explicit that the constructor of the original class should be called (which is the default behaviour).</p> </section> <section id="disableoriginalclone"> <h3>
<code class="docutils literal notranslate"><span class="pre">disableOriginalClone()</span></code><a class="headerlink" href="#disableoriginalclone" title="Permalink to this heading"></a>
</h3> <p><code class="docutils literal notranslate"><span class="pre">disableOriginalClone()</span></code> can be used to disable the call to the clone constructor of the original class.</p> <p><code class="docutils literal notranslate"><span class="pre">enableOriginalClone()</span></code> can be used to make it explicit that the clone constructor of the original class should be called (which is the default behaviour).</p> </section> <section id="enableargumentcloning"> <h3>
<code class="docutils literal notranslate"><span class="pre">enableArgumentCloning()</span></code><a class="headerlink" href="#enableargumentcloning" title="Permalink to this heading"></a>
</h3> <p><code class="docutils literal notranslate"><span class="pre">enableArgumentCloning()</span></code> can be used to enable the cloning of arguments passed to doubled methods.</p> <p><code class="docutils literal notranslate"><span class="pre">disableArgumentCloning()</span></code> can be used to make it explicit that arguments passed to doubled methods are not cloned (which is the default behaviour).</p> <div class="admonition-deprecation-enableargumentcloning-and-disableargumentcloning-are-deprecated admonition"> <p class="admonition-title">Deprecation: <code class="docutils literal notranslate"><span class="pre">enableArgumentCloning()</span></code> and <code class="docutils literal notranslate"><span class="pre">disableArgumentCloning()</span></code> are deprecated</p> <p>As of PHPUnit 10.1, the <code class="docutils literal notranslate"><span class="pre">enableArgumentCloning()</span></code> and <code class="docutils literal notranslate"><span class="pre">disableArgumentCloning()</span></code> methods are soft-deprecated, meaning their declaration is annotated with <code class="docutils literal notranslate"><span class="pre">@deprecated</span></code> so that IDEs and static analysis tools can warn about their usage.</p> <p>Starting with PHPUnit 11, using the <code class="docutils literal notranslate"><span class="pre">enableArgumentCloning()</span></code> and <code class="docutils literal notranslate"><span class="pre">disableArgumentCloning()</span></code> methods will trigger a deprecation warning. The methods will be removed in PHPUnit 12.</p> </div> </section> <section id="disableautoreturnvaluegeneration"> <h3>
<code class="docutils literal notranslate"><span class="pre">disableAutoReturnValueGeneration()</span></code><a class="headerlink" href="#disableautoreturnvaluegeneration" title="Permalink to this heading"></a>
</h3> <p><code class="docutils literal notranslate"><span class="pre">disableAutoReturnValueGeneration()</span></code> can be used to disable the automatic generation of return values when no return value is configured.</p> <p><code class="docutils literal notranslate"><span class="pre">enableAutoReturnValueGeneration()</span></code> can be used to make it explicit that automatic generation of return values when no return value is configured is enabled (which is the default).</p> </section> <section id="disallowmockingunknowntypes"> <h3>
<code class="docutils literal notranslate"><span class="pre">disallowMockingUnknownTypes()</span></code><a class="headerlink" href="#disallowmockingunknowntypes" title="Permalink to this heading"></a>
</h3> <p><code class="docutils literal notranslate"><span class="pre">disallowMockingUnknownTypes()</span></code> can be used to disallow the doubling of unknown types.</p> <p><code class="docutils literal notranslate"><span class="pre">allowMockingUnknownTypes()</span></code> can be used to make it explicit that the doubling of unknown types is allowed (which is the default).</p> <div class="admonition-deprecation-disallowmockingunknowntypes-and-allowmockingunknowntypes-are-deprecated admonition"> <p class="admonition-title">Deprecation: <code class="docutils literal notranslate"><span class="pre">disallowMockingUnknownTypes()</span></code> and <code class="docutils literal notranslate"><span class="pre">allowMockingUnknownTypes()</span></code> are deprecated</p> <p>As of PHPUnit 10.1, the <code class="docutils literal notranslate"><span class="pre">disallowMockingUnknownTypes()</span></code> and <code class="docutils literal notranslate"><span class="pre">allowMockingUnknownTypes()</span></code> methods are soft-deprecated, meaning their declaration is annotated with <code class="docutils literal notranslate"><span class="pre">@deprecated</span></code> so that IDEs and static analysis tools can warn about their usage.</p> <p>Starting with PHPUnit 11, using the <code class="docutils literal notranslate"><span class="pre">disallowMockingUnknownTypes()</span></code> and <code class="docutils literal notranslate"><span class="pre">allowMockingUnknownTypes()</span></code> methods will trigger a deprecation warning. The methods will be removed in PHPUnit 12.</p> </div> </section> <section id="disableautoload"> <h3>
<code class="docutils literal notranslate"><span class="pre">disableAutoload()</span></code><a class="headerlink" href="#disableautoload" title="Permalink to this heading"></a>
</h3> <p><code class="docutils literal notranslate"><span class="pre">disableAutoload()</span></code> can be used to disable PHP’s autoloading functionality during the generation of the test double class.</p> <p><code class="docutils literal notranslate"><span class="pre">enableAutoload()</span></code> can be used to make it explicit that PHP’s autoloading functionality should be enabled (which is the default behaviour).</p> <div class="admonition-deprecation-disableautoload-and-enableautoload-are-deprecated admonition"> <p class="admonition-title">Deprecation: <code class="docutils literal notranslate"><span class="pre">disableAutoload()</span></code> and <code class="docutils literal notranslate"><span class="pre">enableAutoload()</span></code> are deprecated</p> <p>As of PHPUnit 10.1, the <code class="docutils literal notranslate"><span class="pre">disableAutoload()</span></code> and <code class="docutils literal notranslate"><span class="pre">enableAutoload()</span></code> methods are soft-deprecated, meaning their declaration is annotated with <code class="docutils literal notranslate"><span class="pre">@deprecated</span></code> so that IDEs and static analysis tools can warn about their usage.</p> <p>Starting with PHPUnit 11, using the <code class="docutils literal notranslate"><span class="pre">disableAutoload()</span></code> and <code class="docutils literal notranslate"><span class="pre">enableAutoload()</span></code> methods will trigger a deprecation warning. The methods will be removed in PHPUnit 12.</p> </div> </section> <section id="enableproxyingtooriginalmethods"> <h3>
<code class="docutils literal notranslate"><span class="pre">enableProxyingToOriginalMethods()</span></code><a class="headerlink" href="#enableproxyingtooriginalmethods" title="Permalink to this heading"></a>
</h3> <p><code class="docutils literal notranslate"><span class="pre">enableProxyingToOriginalMethods()</span></code> can be used to enable the invocation of the original methods. The object to be used for invoking the original methods must be configured using <code class="docutils literal notranslate"><span class="pre">setProxyTarget()</span></code>.</p> <p><code class="docutils literal notranslate"><span class="pre">disableProxyingToOriginalMethods()</span></code> can be used to make it explicit that the original methods are not invoked (which is the default behaviour).</p> <div class="admonition-deprecation-enableproxyingtooriginalmethods-setproxytarget-and-disableproxyingtooriginalmethods-are-deprecated admonition"> <p class="admonition-title">Deprecation: <code class="docutils literal notranslate"><span class="pre">enableProxyingToOriginalMethods()</span></code>, <code class="docutils literal notranslate"><span class="pre">setProxyTarget()</span></code>, and <code class="docutils literal notranslate"><span class="pre">disableProxyingToOriginalMethods()</span></code> are deprecated</p> <p>As of PHPUnit 10.1, the <code class="docutils literal notranslate"><span class="pre">enableProxyingToOriginalMethods()</span></code>, <code class="docutils literal notranslate"><span class="pre">setProxyTarget()</span></code>, and <code class="docutils literal notranslate"><span class="pre">disableProxyingToOriginalMethods()</span></code> methods are soft-deprecated, meaning their declaration is annotated with <code class="docutils literal notranslate"><span class="pre">@deprecated</span></code> so that IDEs and static analysis tools can warn about their usage.</p> <p>Starting with PHPUnit 11, using the <code class="docutils literal notranslate"><span class="pre">enableProxyingToOriginalMethods()</span></code>, <code class="docutils literal notranslate"><span class="pre">setProxyTarget()</span></code>, and <code class="docutils literal notranslate"><span class="pre">disableProxyingToOriginalMethods()</span></code> methods will trigger a deprecation warning. The methods will be removed in PHPUnit 12.</p> </div> </section> <section id="onlymethods"> <h3>
<code class="docutils literal notranslate"><span class="pre">onlyMethods()</span></code><a class="headerlink" href="#onlymethods" title="Permalink to this heading"></a>
</h3> <p><code class="docutils literal notranslate"><span class="pre">onlyMethods(array</span> <span class="pre">$methods)</span></code> can be called on the Mock Builder object to specify the methods that are to be replaced with a configurable test double. The behavior of the other methods is not changed. The specified methods must exist in the class that is mocked.</p> </section> <section id="addmethods"> <h3>
<code class="docutils literal notranslate"><span class="pre">addMethods()</span></code><a class="headerlink" href="#addmethods" title="Permalink to this heading"></a>
</h3> <p><code class="docutils literal notranslate"><span class="pre">addMethods(array</span> <span class="pre">$methods)</span></code> can be called on the Mock Builder object to specify the methods that do not exist in the interface or class that is mocked. Methods that do exist in the interface or class remain unchanged.</p> <div class="admonition-deprecation-addmethods-is-deprecated admonition"> <p class="admonition-title">Deprecation: <code class="docutils literal notranslate"><span class="pre">addMethods()</span></code> is deprecated</p> <p>As of PHPUnit 10.1, the <code class="docutils literal notranslate"><span class="pre">addMethods()</span></code> method is soft-deprecated, meaning its declaration is annotated with <code class="docutils literal notranslate"><span class="pre">@deprecated</span></code> so that IDEs and static analysis tools can warn about its usage.</p> <p>Starting with PHPUnit 11, using the <code class="docutils literal notranslate"><span class="pre">addMethods()</span></code> method will trigger a deprecation warning. The method will be removed in PHPUnit 12.</p> </div> </section> <section id="getmock"> <h3>
<code class="docutils literal notranslate"><span class="pre">getMock()</span></code><a class="headerlink" href="#getmock" title="Permalink to this heading"></a>
</h3> <p><code class="docutils literal notranslate"><span class="pre">getMock()</span></code> generates and returns a mock object based on the configuration made using previous methods calls. The call to <code class="docutils literal notranslate"><span class="pre">getMock()</span></code> must be the last in the method chain.</p> </section> <section id="id3"> <h3>
<code class="docutils literal notranslate"><span class="pre">getMockForAbstractClass()</span></code><a class="headerlink" href="#id3" title="Permalink to this heading"></a>
</h3> <p><code class="docutils literal notranslate"><span class="pre">getMockForAbstractClass()</span></code> generates and returns a mock object based on the configuration made using previous methods calls. The call to <code class="docutils literal notranslate"><span class="pre">getMockForAbstractClass()</span></code> must be the last in the method chain.</p> <div class="admonition-deprecation-getmockforabstractclass-is-deprecated admonition"> <p class="admonition-title">Deprecation: <code class="docutils literal notranslate"><span class="pre">getMockForAbstractClass()</span></code> is deprecated</p> <p>As of PHPUnit 10.1, the <code class="docutils literal notranslate"><span class="pre">getMockForAbstractClass()</span></code> method is soft-deprecated, meaning its declaration is annotated with <code class="docutils literal notranslate"><span class="pre">@deprecated</span></code> so that IDEs and static analysis tools can warn about its usage.</p> <p>Starting with PHPUnit 11, using the <code class="docutils literal notranslate"><span class="pre">getMockForAbstractClass()</span></code> method will trigger a deprecation warning. The method will be removed in PHPUnit 12.</p> </div> </section> <section id="id4"> <h3>
<code class="docutils literal notranslate"><span class="pre">getMockForTrait()</span></code><a class="headerlink" href="#id4" title="Permalink to this heading"></a>
</h3> <p><code class="docutils literal notranslate"><span class="pre">getMockForTrait()</span></code> generates and returns a mock object based on the configuration made using previous methods calls. The call to <code class="docutils literal notranslate"><span class="pre">getMockForTrait()</span></code> must be the last in the method chain.</p> <div class="admonition-deprecation-getmockfortrait-is-deprecated admonition"> <p class="admonition-title">Deprecation: <code class="docutils literal notranslate"><span class="pre">getMockForTrait()</span></code> is deprecated</p> <p>As of PHPUnit 10.1, the <code class="docutils literal notranslate"><span class="pre">getMockForTrait()</span></code> method is soft-deprecated, meaning its declaration is annotated with <code class="docutils literal notranslate"><span class="pre">@deprecated</span></code> so that IDEs and static analysis tools can warn about its usage.</p> <p>Starting with PHPUnit 11, using the <code class="docutils literal notranslate"><span class="pre">getMockForTrait()</span></code> method will trigger a deprecation warning. The method will be removed in PHPUnit 12.</p> </div> <p>Here is an example that shows how to use the Mock Builder’s fluent interface to configure the creation of a test stub. The configuration of this test double uses the same best practice defaults used by <code class="docutils literal notranslate"><span class="pre">createStub()</span></code> and <code class="docutils literal notranslate"><span class="pre">createMock()</span></code>:</p> <div class="literal-block-wrapper docutils container" id="id35"> <div class="code-block-caption">
<span class="caption-number">Example 6.31 </span><span class="caption-text">Using the Mock Builder API to configure how the test double class is generated</span><a class="headerlink" href="#id35" title="Permalink to this code"></a>
</div> <div class="highlight-php notranslate">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">MockBuilderExampleTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testStub</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="c1">// Create a stub for the SomeClass class.</span>
        <span class="nv">$stub</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getMockBuilder</span><span class="p">(</span><span class="nx">SomeClass</span><span class="o">::</span><span class="na">class</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">disableOriginalConstructor</span><span class="p">()</span>
            <span class="o">-&gt;</span><span class="na">disableOriginalClone</span><span class="p">()</span>
            <span class="o">-&gt;</span><span class="na">disableArgumentCloning</span><span class="p">()</span>
            <span class="o">-&gt;</span><span class="na">disallowMockingUnknownTypes</span><span class="p">()</span>
            <span class="o">-&gt;</span><span class="na">getMock</span><span class="p">();</span>

        <span class="c1">// Configure the stub.</span>
        <span class="nv">$stub</span><span class="o">-&gt;</span><span class="na">method</span><span class="p">(</span><span class="s1">'doSomething'</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">willReturn</span><span class="p">(</span><span class="s1">'foo'</span><span class="p">);</span>

        <span class="c1">// Calling $stub-&gt;doSomething() will now return</span>
        <span class="c1">// 'foo'.</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="s1">'foo'</span><span class="p">,</span> <span class="nv">$stub</span><span class="o">-&gt;</span><span class="na">doSomething</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> </section> <section id="set-hooked-properties"> <h3>Set-Hooked Properties<a class="headerlink" href="#set-hooked-properties" title="Permalink to this heading"></a>
</h3> <p>PHP 8.4 introduced the language feature of <a class="reference external" href="https://www.php.net/releases/8.4/en.php#property_hooks">set-hooked properties</a>.</p> <p>The example below shows an interface that declares a set-hooked property:</p> <div class="literal-block-wrapper docutils container" id="id36"> <div class="code-block-caption">
<span class="caption-number">Example 6.32 </span><span class="caption-text">Interface that declares a set-hooked property</span><a class="headerlink" href="#id36" title="Permalink to this code"></a>
</div> <div class="highlight-php notranslate">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">interface</span> <span class="nx">InterfaceWithSetHookedProperty</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nx">string</span> <span class="nv">$property</span> <span class="p">{</span> <span class="nx">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> <p>Expectations for the set-hooked property <code class="docutils literal notranslate"><span class="pre">property</span></code> can be configured like so:</p> <div class="literal-block-wrapper docutils container" id="id37"> <div class="code-block-caption">
<span class="caption-number">Example 6.33 </span><span class="caption-text">Test that uses a mock object of an interface with a set-hooked property</span><a class="headerlink" href="#id37" title="Permalink to this code"></a>
</div> <div class="highlight-php notranslate">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\MockObject\Runtime\PropertyHook</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">SetHookedPropertyMockExampleTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testExample</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$mock</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createMock</span><span class="p">(</span>
            <span class="nx">InterfaceWithSetHookedProperty</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
        <span class="p">);</span>

        <span class="nv">$mock</span>
            <span class="o">-&gt;</span><span class="na">expects</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">once</span><span class="p">())</span>
            <span class="o">-&gt;</span><span class="na">method</span><span class="p">(</span><span class="nx">PropertyHook</span><span class="o">::</span><span class="na">set</span><span class="p">(</span><span class="s1">'property'</span><span class="p">))</span>
            <span class="o">-&gt;</span><span class="na">with</span><span class="p">(</span><span class="s1">'value'</span><span class="p">);</span>

        <span class="nv">$mock</span><span class="o">-&gt;</span><span class="na">property</span> <span class="o">=</span> <span class="s1">'value'</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> <p>In the example shown above, <code class="docutils literal notranslate"><span class="pre">PropertyHook::set('property')</span></code> to specify that we want to configure an expectation for the method that is called when the property named <code class="docutils literal notranslate"><span class="pre">property</span></code> is accessed for writing.</p> </section> </section><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2005&ndash;2025 Sebastian Bergmann<br>Licensed under the Creative Commons Attribution 3.0 Unported License.<br>
    <a href="https://docs.phpunit.de/en/12.0/test-doubles.html" class="_attribution-link">https://docs.phpunit.de/en/12.0/test-doubles.html</a>
  </p>
</div>
