<h1>Writing Tests for PHPUnit</h1> <section id="asserting-return-values"> <h2>Asserting Return Values<a class="headerlink" href="#asserting-return-values" title="Permalink to this heading"></a>
</h2> <p>This first example introduces the basic conventions and steps for writing tests with PHPUnit:</p> <ol class="arabic"> <li><p>The tests for a class <code class="docutils literal notranslate"><span class="pre">Greeter</span></code> go into a class <code class="docutils literal notranslate"><span class="pre">GreeterTest</span></code>.</p></li> <li><p><code class="docutils literal notranslate"><span class="pre">GreeterTest</span></code> inherits from <code class="docutils literal notranslate"><span class="pre">PHPUnit\Framework\TestCase</span></code>.</p></li> <li>
<p>The tests are public methods that are named <code class="docutils literal notranslate"><span class="pre">test*</span></code>.</p> <p>Alternatively, you can use the <code class="docutils literal notranslate"><span class="pre">PHPUnit\Framework\Attributes\Test</span></code> attribute on a method to mark it as a test method. See the section on the <a class="reference internal" href="attributes.html#appendixes-attributes-test"><span class="std std-ref">Test</span></a> attribute for details.</p> </li> <li><p>Inside the test methods, assertion methods such as <code class="docutils literal notranslate"><span class="pre">assertSame()</span></code> (see <a class="reference internal" href="assertions.html#appendixes-assertions"><span class="std std-ref">Assertions</span></a>) are used to assert that an actual value matches an expected value, for instance.</p></li> </ol> <div class="literal-block-wrapper docutils container" id="writing-tests-for-phpunit-examples-greeter-php"> <div class="code-block-caption">
<span class="caption-number">Example 2.1 </span><span class="caption-text">A class named <code class="docutils literal notranslate"><span class="pre">Greeter</span></code> (declared in <code class="docutils literal notranslate"><span class="pre">src/Greeter.php</span></code>)</span><a class="headerlink" href="#writing-tests-for-phpunit-examples-greeter-php" title="Permalink to this code"></a>
</div> <div class="highlight-php notranslate">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">final</span> <span class="k">class</span> <span class="nc">Greeter</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">greet</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$name</span><span class="p">)</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="s1">'Hello, '</span> <span class="o">.</span> <span class="nv">$name</span> <span class="o">.</span> <span class="s1">'!'</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> <div class="literal-block-wrapper docutils container" id="writing-tests-for-phpunit-examples-greetertest-php"> <div class="code-block-caption">
<span class="caption-number">Example 2.2 </span><span class="caption-text">A test class named <code class="docutils literal notranslate"><span class="pre">GreeterTest</span></code> (declared in <code class="docutils literal notranslate"><span class="pre">tests/GreeterTest.php</span></code>)</span><a class="headerlink" href="#writing-tests-for-phpunit-examples-greetertest-php" title="Permalink to this code"></a>
</div> <div class="highlight-php notranslate">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">GreeterTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testGreetsWithName</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$greeter</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Greeter</span><span class="p">;</span>

        <span class="nv">$greeting</span> <span class="o">=</span> <span class="nv">$greeter</span><span class="o">-&gt;</span><span class="na">greet</span><span class="p">(</span><span class="s1">'Alice'</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="s1">'Hello, Alice!'</span><span class="p">,</span> <span class="nv">$greeting</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> <p>Running the test shown above yields the output shown below:</p> <div class="highlight-none notranslate">
<div class="highlight"><pre class="highlight" data-language="php">./tools/phpunit tests/GreeterTest.php
PHPUnit 12.0.2 by Sebastian Bergmann and contributors.

Runtime:       PHP 8.4.3

.                                                                   1 / 1 (100%)

Time: 00:00, Memory: 25.29 MB

OK (1 test, 1 assertion)
</pre></div> </div> <p>Martin Fowler once said:</p> <blockquote> <div>
<p>Whenever you are tempted to type something into a <code class="docutils literal notranslate"><span class="pre">print</span></code> statement or a debugger expression, write it as a test instead.</p> </div>
</blockquote> </section> <section id="expecting-exceptions"> <h2>Expecting Exceptions<a class="headerlink" href="#expecting-exceptions" title="Permalink to this heading"></a>
</h2> <p><a class="reference internal" href="#writing-tests-for-phpunit-exceptions-examples-exceptiontest-php"><span class="std std-numref">Example 2.3</span></a> shows how to use the <code class="docutils literal notranslate"><span class="pre">expectException()</span></code> method to test whether an exception is thrown by the code under test.</p> <div class="literal-block-wrapper docutils container" id="writing-tests-for-phpunit-exceptions-examples-exceptiontest-php"> <div class="code-block-caption">
<span class="caption-number">Example 2.3 </span><span class="caption-text">Using the expectException() method</span><a class="headerlink" href="#writing-tests-for-phpunit-exceptions-examples-exceptiontest-php" title="Permalink to this code"></a>
</div> <div class="highlight-php notranslate">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">ExceptionTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testException</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">expectException</span><span class="p">(</span><span class="nx">InvalidArgumentException</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> <p>Running the test shown above yields the output shown below:</p> <div class="highlight-none notranslate">
<div class="highlight"><pre class="highlight" data-language="php">./tools/phpunit tests/ExceptionTest.php
PHPUnit 12.0.2 by Sebastian Bergmann and contributors.

Runtime:       PHP 8.4.3

F                                                                   1 / 1 (100%)

Time: 00:00, Memory: 25.29 MB

There was 1 failure:

1) ExceptionTest::testException
Failed asserting that exception of type "InvalidArgumentException" is thrown.

FAILURES!
Tests: 1, Assertions: 1, Failures: 1.
</pre></div> </div> <p>The <code class="docutils literal notranslate"><span class="pre">expectException()</span></code> method has to be used <strong>before</strong> the exception you expect to be thrown is thrown. Ideally, <code class="docutils literal notranslate"><span class="pre">expectException()</span></code> is called immediately before the code is called that is expected to throw the exception.</p> <p>In addition to the <code class="docutils literal notranslate"><span class="pre">expectException()</span></code> method the <code class="docutils literal notranslate"><span class="pre">expectExceptionCode()</span></code>, <code class="docutils literal notranslate"><span class="pre">expectExceptionMessage()</span></code>, and <code class="docutils literal notranslate"><span class="pre">expectExceptionMessageMatches()</span></code> methods exist to set up expectations for exceptions raised by the code under test.</p> <div class="admonition-note admonition"> <p class="admonition-title">Note</p> <p>Note that <code class="docutils literal notranslate"><span class="pre">expectExceptionMessage()</span></code> asserts that the <code class="docutils literal notranslate"><span class="pre">$actual</span></code> message contains the <code class="docutils literal notranslate"><span class="pre">$expected</span></code> message and does not perform an exact string comparison.</p> </div> <p>Asserting return values and expecting exceptions are two of the three most commonly performed operations in a test method. The third is verifying side effects. The verification of side effects in object collaboration is discussed in the chapter on <a class="reference internal" href="test-doubles.html#test-doubles"><span class="std std-ref">Test Doubles</span></a>.</p> </section> <section id="data-providers"> <h2>Data Providers<a class="headerlink" href="#data-providers" title="Permalink to this heading"></a>
</h2> <p>A test method can accept arbitrary arguments. These arguments are to be provided by one or more data provider methods (<code class="docutils literal notranslate"><span class="pre">additionProvider()</span></code> in the example shown below). The data provider method to be used is specified using the <code class="docutils literal notranslate"><span class="pre">PHPUnit\Framework\Attributes\DataProvider</span></code> or the <code class="docutils literal notranslate"><span class="pre">PHPUnit\Framework\Attributes\DataProviderExternal</span></code> attribute.</p> <p>A data provider method must be <code class="docutils literal notranslate"><span class="pre">public</span></code> and <code class="docutils literal notranslate"><span class="pre">static</span></code>. It must return a value that is <a class="reference external" href="https://www.php.net/manual/en/language.types.iterable.php">iterable</a>, either an array or an object that implements the <code class="docutils literal notranslate"><span class="pre">Traversable</span></code> interface. In each iteration step, it must yield an array. For each of these arrays, the test method will be called with the contents of the array as its arguments.</p> <div class="literal-block-wrapper docutils container" id="writing-tests-for-phpunit-data-providers-examples-numericdatasetstest-php"> <div class="code-block-caption">
<span class="caption-number">Example 2.4 </span><span class="caption-text">Using a data provider that returns an array of arrays</span><a class="headerlink" href="#writing-tests-for-phpunit-data-providers-examples-numericdatasetstest-php" title="Permalink to this code"></a>
</div> <div class="highlight-php notranslate">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\Attributes\DataProvider</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">NumericDataSetsTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">additionProvider</span><span class="p">()</span><span class="o">:</span> <span class="k">array</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
        <span class="p">];</span>
    <span class="p">}</span>

    <span class="p">#[</span><span class="nd">DataProvider</span><span class="p">(</span><span class="s1">'additionProvider'</span><span class="p">)]</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testAdd</span><span class="p">(</span><span class="nx">int</span> <span class="nv">$a</span><span class="p">,</span> <span class="nx">int</span> <span class="nv">$b</span><span class="p">,</span> <span class="nx">int</span> <span class="nv">$expected</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="nv">$expected</span><span class="p">,</span> <span class="nv">$a</span> <span class="o">+</span> <span class="nv">$b</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> <div class="literal-block-wrapper docutils container" id="writing-tests-for-phpunit-data-providers-examples-numericdatasetstestusingexternaldataprovider-php"> <div class="code-block-caption">
<span class="caption-number">Example 2.5 </span><span class="caption-text">Using an external data provider that returns an array of arrays</span><a class="headerlink" href="#writing-tests-for-phpunit-data-providers-examples-numericdatasetstestusingexternaldataprovider-php" title="Permalink to this code"></a>
</div> <div class="highlight-php notranslate">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\Attributes\DataProviderExternal</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">NumericDataSetsTestUsingExternalDataProvider</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="p">#[</span><span class="nd">DataProviderExternal</span><span class="p">(</span><span class="nx">ExternalDataProvider</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="s1">'additionProvider'</span><span class="p">)]</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testAdd</span><span class="p">(</span><span class="nx">int</span> <span class="nv">$a</span><span class="p">,</span> <span class="nx">int</span> <span class="nv">$b</span><span class="p">,</span> <span class="nx">int</span> <span class="nv">$expected</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="nv">$expected</span><span class="p">,</span> <span class="nv">$a</span> <span class="o">+</span> <span class="nv">$b</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">ExternalDataProvider</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">additionProvider</span><span class="p">()</span><span class="o">:</span> <span class="k">array</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
        <span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> <p>Running the test shown above yields the output shown below:</p> <div class="highlight-none notranslate">
<div class="highlight"><pre class="highlight" data-language="php">./tools/phpunit tests/NumericDataSetsTest.php
PHPUnit 12.0.2 by Sebastian Bergmann and contributors.

Runtime:       PHP 8.4.3

...F                                                                4 / 4 (100%)

Time: 00:00.001, Memory: 25.29 MB

There was 1 failure:

1) NumericDataSetsTest::testAdd with data set #3 (1, 1, 3)
Failed asserting that 2 is identical to 3.

/path/to/tests/NumericDataSetsTest.php:20

FAILURES!
Tests: 4, Assertions: 4, Failures: 1.
</pre></div> </div> <p>It is useful to name each one with a string key. Output will be more verbose as it will contain that name of a dataset that breaks a test.</p> <div class="literal-block-wrapper docutils container" id="writing-tests-for-phpunit-data-providers-examples-nameddatasetstest-php"> <div class="code-block-caption">
<span class="caption-number">Example 2.6 </span><span class="caption-text">Using a data provider with named data sets</span><a class="headerlink" href="#writing-tests-for-phpunit-data-providers-examples-nameddatasetstest-php" title="Permalink to this code"></a>
</div> <div class="highlight-php notranslate">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\Attributes\DataProvider</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">NamedDataSetsTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">additionProvider</span><span class="p">()</span><span class="o">:</span> <span class="k">array</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="s1">'adding zeros'</span>  <span class="o">=&gt;</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="s1">'zero plus one'</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="s1">'one plus zero'</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="s1">'one plus one'</span>  <span class="o">=&gt;</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
        <span class="p">];</span>
    <span class="p">}</span>

    <span class="p">#[</span><span class="nd">DataProvider</span><span class="p">(</span><span class="s1">'additionProvider'</span><span class="p">)]</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testAdd</span><span class="p">(</span><span class="nx">int</span> <span class="nv">$a</span><span class="p">,</span> <span class="nx">int</span> <span class="nv">$b</span><span class="p">,</span> <span class="nx">int</span> <span class="nv">$expected</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="nv">$expected</span><span class="p">,</span> <span class="nv">$a</span> <span class="o">+</span> <span class="nv">$b</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> <p>Running the test shown above yields the output shown below:</p> <div class="highlight-none notranslate">
<div class="highlight"><pre class="highlight" data-language="php">./tools/phpunit tests/NamedDataSetsTest.php
PHPUnit 12.0.2 by Sebastian Bergmann and contributors.

Runtime:       PHP 8.4.3

...F                                                                4 / 4 (100%)

Time: 00:00.001, Memory: 25.29 MB

There was 1 failure:

1) NamedDataSetsTest::testAdd with data set "one plus one" (1, 1, 3)
Failed asserting that 2 is identical to 3.

/path/to/tests/NamedDataSetsTest.php:20

FAILURES!
Tests: 4, Assertions: 4, Failures: 1.
</pre></div> </div> <div class="admonition-note admonition"> <p class="admonition-title">Note</p> <p>You can make the test output more verbose by defining a sentence and using the test’s parameter names as placeholders (<code class="docutils literal notranslate"><span class="pre">$a</span></code>, <code class="docutils literal notranslate"><span class="pre">$b</span></code> and <code class="docutils literal notranslate"><span class="pre">$expected</span></code> in the example above) with the <a class="reference internal" href="attributes.html#appendixes-attributes-testdox"><span class="std std-ref">TestDox</span></a> attribute. You can also refer to the name of a named data set with <code class="docutils literal notranslate"><span class="pre">$_dataName</span></code>.</p> </div> <p>When a test receives input from both a data provider method and from one or more tests it depends on, the arguments from the data provider will come before the ones from depended-upon tests. The arguments from depended-upon tests will be the same for each data set.</p> <p>When a test depends on a test that uses data providers, the depending test will be executed when the test it depends upon is successful for at least one data set. The result of a test that uses data providers cannot be injected into a depending test.</p> <div class="admonition-note admonition"> <p class="admonition-title">Note</p> <p>All data providers, including those for test methods that will not be run due to <code class="docutils literal notranslate"><span class="pre">--filter</span></code> or <code class="docutils literal notranslate"><span class="pre">--exclude-group</span></code>, for example, are executed before both the call to the <code class="docutils literal notranslate"><span class="pre">setUpBeforeClass()</span></code> static method and the first call to the <code class="docutils literal notranslate"><span class="pre">setUp()</span></code> method. You cannot access any properties of the actual test case object in methods such as <code class="docutils literal notranslate"><span class="pre">setUpBeforeClass()</span></code> or <code class="docutils literal notranslate"><span class="pre">setUp()</span></code> within a data provider.</p> </div> <div class="admonition-note admonition"> <p class="admonition-title">Note</p> <p>No code coverage data is collected while data provider methods are executed.</p> </div> </section> <section id="testing-output"> <h2>Testing Output<a class="headerlink" href="#testing-output" title="Permalink to this heading"></a>
</h2> <p>Sometimes you want to assert that the execution of a method, for instance, generates an expected output (via <code class="docutils literal notranslate"><span class="pre">echo</span></code> or <code class="docutils literal notranslate"><span class="pre">print</span></code>, for example). The <code class="docutils literal notranslate"><span class="pre">PHPUnit\Framework\TestCase</span></code> class uses PHP’s <a class="reference external" href="http://www.php.net/manual/en/ref.outcontrol.php">Output Buffering</a> feature to provide the functionality that is necessary for this.</p> <p><a class="reference internal" href="#writing-tests-for-phpunit-output-examples-outputtest-php"><span class="std std-numref">Example 2.7</span></a> shows how to use the <code class="docutils literal notranslate"><span class="pre">expectOutputString()</span></code> method to set the expected output. If this expected output is not generated, the test will be counted as a failure.</p> <div class="literal-block-wrapper docutils container" id="writing-tests-for-phpunit-output-examples-outputtest-php"> <div class="code-block-caption">
<span class="caption-number">Example 2.7 </span><span class="caption-text">Testing the output of a function or method</span><a class="headerlink" href="#writing-tests-for-phpunit-output-examples-outputtest-php" title="Permalink to this code"></a>
</div> <div class="highlight-php notranslate">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">OutputTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testExpectFooActualFoo</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">expectOutputString</span><span class="p">(</span><span class="s1">'foo'</span><span class="p">);</span>

        <span class="k">print</span> <span class="s1">'foo'</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testExpectBarActualBaz</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">expectOutputString</span><span class="p">(</span><span class="s1">'bar'</span><span class="p">);</span>

        <span class="k">print</span> <span class="s1">'baz'</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> <p>Running the test shown above yields the output shown below:</p> <div class="highlight-none notranslate">
<div class="highlight"><pre class="highlight" data-language="php">./tools/phpunit tests/OutputTest.php
PHPUnit 12.0.2 by Sebastian Bergmann and contributors.

Runtime:       PHP 8.4.3

.F                                                                  2 / 2 (100%)

Time: 00:00, Memory: 25.29 MB

There was 1 failure:

1) OutputTest::testExpectBarActualBaz
Failed asserting that two strings are identical.
--- Expected
+++ Actual
@@ @@
-'bar'
+'baz'

FAILURES!
Tests: 2, Assertions: 2, Failures: 1.
</pre></div> </div> <p><a class="reference internal" href="#writing-tests-for-phpunit-output-tables-api"><span class="std std-numref">Table 2.1</span></a> shows the methods provided for testing output</p> <table class="table docutils align-default" id="writing-tests-for-phpunit-output-tables-api"> <caption>
<span class="caption-number">Table 2.1 </span><span class="caption-text">Methods for testing output</span><a class="headerlink" href="#writing-tests-for-phpunit-output-tables-api" title="Permalink to this table"></a>
</caption> <thead> <tr class="row-odd">
<th class="head"><p>Method</p></th> <th class="head"><p>Meaning</p></th> </tr> </thead> <tbody> <tr class="row-even">
<td><p><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">expectOutputRegex(string</span> <span class="pre">$regularExpression)</span></code></p></td> <td><p>Set up the expectation that the output matches a <code class="docutils literal notranslate"><span class="pre">$regularExpression</span></code>.</p></td> </tr> <tr class="row-odd">
<td><p><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">expectOutputString(string</span> <span class="pre">$expectedString)</span></code></p></td> <td><p>Set up the expectation that the output is equal to an <code class="docutils literal notranslate"><span class="pre">$expectedString</span></code>.</p></td> </tr> </tbody> </table> </section> <section id="incomplete-tests"> <h2>Incomplete Tests<a class="headerlink" href="#incomplete-tests" title="Permalink to this heading"></a>
</h2> <p>When you are working on a new test case class, you might want to begin by writing empty test methods such as:</p> <div class="highlight-php notranslate">
<div class="highlight"><pre class="highlight" data-language="php"><span class="k">public</span> <span class="k">function</span> <span class="nf">testSomething</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
<span class="p">{</span>
<span class="p">}</span>
</pre></div> </div> <p>to keep track of the tests that you have to write.</p> <div class="admonition-note admonition"> <p class="admonition-title">Note</p> <p>Do yourself a favour and never use pointless names such as <code class="docutils literal notranslate"><span class="pre">testSomething</span></code> for your test methods.</p> </div> <p>The problem with empty test methods is that they cannot fail and may be misinterpreted as a success. This misinterpretation leads to the test reports being useless – you cannot see whether a test is actually successful or just not implemented yet.</p> <p>Calling <code class="docutils literal notranslate"><span class="pre">$this-&gt;assertTrue(false)</span></code>, for instance, in the unfinished test method does not help either, since then the test will be interpreted as a failure. This would be just as wrong as interpreting an unimplemented test as a success.</p> <p>If we think of a successful test as a green light and a test failure as a red light, then we need an additional yellow light to mark a test as being incomplete or not yet implemented.</p> <p>By calling the method <code class="docutils literal notranslate"><span class="pre">markTestIncomplete()</span></code> in a test method, we can mark the test as incomplete:</p> <div class="literal-block-wrapper docutils container" id="writing-tests-for-phpunit-incomplete-tests-examples-workinprogresstest-php"> <div class="code-block-caption">
<span class="caption-number">Example 2.8 </span><span class="caption-text">Marking a test as incomplete</span><a class="headerlink" href="#writing-tests-for-phpunit-incomplete-tests-examples-workinprogresstest-php" title="Permalink to this code"></a>
</div> <div class="highlight-php notranslate">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">WorkInProgressTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testSomething</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="c1">// Optional: Test anything here, if you want.</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="k">true</span><span class="p">,</span> <span class="s1">'This should already work.'</span><span class="p">);</span>

        <span class="c1">// Stop here and mark this test as incomplete.</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">markTestIncomplete</span><span class="p">(</span>
            <span class="s1">'This test has not been implemented yet.'</span><span class="p">,</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> <p>An incomplete test is denoted by an <code class="docutils literal notranslate"><span class="pre">I</span></code> in the output of the PHPUnit command-line test runner, as shown in the following example:</p> <div class="highlight-none notranslate">
<div class="highlight"><pre class="highlight" data-language="php">./tools/phpunit --display-incomplete tests/WorkInProgressTest.php
PHPUnit 12.0.2 by Sebastian Bergmann and contributors.

Runtime:       PHP 8.4.3

I                                                                   1 / 1 (100%)

Time: 00:00, Memory: 25.29 MB

There was 1 incomplete test:

1) WorkInProgressTest::testSomething
This test has not been implemented yet.

/path/to/tests/WorkInProgressTest.php:12

OK, but there were issues!
Tests: 1, Assertions: 1, Incomplete: 1.
</pre></div> </div> </section> <section id="skipping-tests"> <h2>Skipping Tests<a class="headerlink" href="#skipping-tests" title="Permalink to this heading"></a>
</h2> <p>Not all tests can be run in every environment. Consider, for instance, a database abstraction layer that has several drivers for the different database systems it supports. The tests for the MySQL driver can only be run if a MySQL server is available.</p> <p><a class="reference internal" href="#writing-tests-for-phpunit-skipping-tests-examples-databasetest-php"><span class="std std-numref">Example 2.9</span></a> shows a test case class, <code class="docutils literal notranslate"><span class="pre">DatabaseTest</span></code>, that contains one test method, <code class="docutils literal notranslate"><span class="pre">testConnection()</span></code>. In the test case class’ <code class="docutils literal notranslate"><span class="pre">setUp()</span></code> template method we check whether the MySQLi extension is available and use the <code class="docutils literal notranslate"><span class="pre">markTestSkipped()</span></code> method to skip the test if it is not.</p> <div class="literal-block-wrapper docutils container" id="writing-tests-for-phpunit-skipping-tests-examples-databasetest-php"> <div class="code-block-caption">
<span class="caption-number">Example 2.9 </span><span class="caption-text">Skipping a test</span><a class="headerlink" href="#writing-tests-for-phpunit-skipping-tests-examples-databasetest-php" title="Permalink to this code"></a>
</div> <div class="highlight-php notranslate">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">DatabaseTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">extension_loaded</span><span class="p">(</span><span class="s1">'pgsql'</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">markTestSkipped</span><span class="p">(</span>
                <span class="s1">'The PostgreSQL extension is not available'</span><span class="p">,</span>
            <span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testConnection</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> <p>A test that has been skipped is denoted by an <code class="docutils literal notranslate"><span class="pre">S</span></code> in the output of the PHPUnit command-line test runner, as shown in the following example:</p> <div class="highlight-none notranslate">
<div class="highlight"><pre class="highlight" data-language="php">./tools/phpunit --display-skipped tests/DatabaseTest.php
PHPUnit 12.0.2 by Sebastian Bergmann and contributors.

Runtime:       PHP 8.4.3

S                                                                   1 / 1 (100%)

Time: 00:00, Memory: 25.29 MB

There was 1 skipped test:

1) DatabaseTest::testConnection
The PostgreSQL extension is not available

OK, but some tests were skipped!
Tests: 1, Assertions: 0, Skipped: 1.
</pre></div> </div> <section id="skipping-tests-using-attributes"> <h3>Skipping Tests using Attributes<a class="headerlink" href="#skipping-tests-using-attributes" title="Permalink to this heading"></a>
</h3> <p>In addition to the above methods it is also possible to use attributes to express common preconditions for a test case:</p> <ul class="simple"> <li><p><code class="docutils literal notranslate"><span class="pre">RequiresFunction(string</span> <span class="pre">$functionName)</span></code> skips the test when no function with the specified name is declared</p></li> <li><p><code class="docutils literal notranslate"><span class="pre">RequiresMethod(string</span> <span class="pre">$className,</span> <span class="pre">string</span> <span class="pre">$functionName)</span></code> skips the test when no method with the specified name is declared</p></li> <li><p><code class="docutils literal notranslate"><span class="pre">RequiresOperatingSystem(string</span> <span class="pre">$regularExpression)</span></code> skips the test when the operating system’s name does not match the specified regular expression</p></li> <li><p><code class="docutils literal notranslate"><span class="pre">RequiresOperatingSystemFamily(string</span> <span class="pre">$operatingSystemFamily)</span></code> skips the test when the operating system’s family is not the specified one</p></li> <li><p><code class="docutils literal notranslate"><span class="pre">RequiresPhp(string</span> <span class="pre">$versionRequirement)</span></code> skips the test when the PHP version does not match the specified one</p></li> <li><p><code class="docutils literal notranslate"><span class="pre">RequiresPhpExtension(string</span> <span class="pre">$extension,</span> <span class="pre">?string</span> <span class="pre">$versionRequirement)</span></code> skips the test when the specified PHP extension is not available</p></li> <li><p><code class="docutils literal notranslate"><span class="pre">RequiresPhpunit(string</span> <span class="pre">$versionRequirement)</span></code> skips the test when the PHPUnit version does not match the specified one</p></li> <li><p><code class="docutils literal notranslate"><span class="pre">RequiresSetting(string</span> <span class="pre">$setting,</span> <span class="pre">string</span> <span class="pre">$value)</span></code> skips the test when the specified PHP configuration setting is not set to the specified value</p></li> </ul> <p>All attributes listed above are declared in the <code class="docutils literal notranslate"><span class="pre">PHPUnit\Framework\Attributes</span></code> namespace.</p> <div class="literal-block-wrapper docutils container" id="writing-tests-for-phpunit-skipping-tests-examples-databasetest-php-attributes"> <div class="code-block-caption">
<span class="caption-number">Example 2.10 </span><span class="caption-text">Skipping a test using attributes</span><a class="headerlink" href="#writing-tests-for-phpunit-skipping-tests-examples-databasetest-php-attributes" title="Permalink to this code"></a>
</div> <div class="highlight-php notranslate">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\Attributes\RequiresPhpExtension</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="p">#[</span><span class="nd">RequiresPhpExtension</span><span class="p">(</span><span class="s1">'pgsql'</span><span class="p">)]</span>
<span class="k">final</span> <span class="k">class</span> <span class="nc">DatabaseTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testConnection</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> </section> </section> <section id="test-dependencies"> <h2>Test Dependencies<a class="headerlink" href="#test-dependencies" title="Permalink to this heading"></a>
</h2> <p>Adrian Kuhn et. al. <a class="reference external" href="https://doi.org/10.1007/978-3-540-68255-4_8">wrote</a>:</p> <blockquote> <div>
<p>Unit Tests are primarily written as a good practice to help developers identify and fix bugs, to refactor code and to serve as documentation for a unit of software under test. To achieve these benefits, unit tests ideally should cover all the possible paths in a program. One unit test usually covers one specific path in one function or method. However a test method is not necessarily an encapsulated, independent entity. Often there are implicit dependencies between test methods, hidden in the implementation scenario of a test.</p> </div>
</blockquote> <p>PHPUnit supports the declaration of explicit dependencies between test methods. Such dependencies do not define the order in which the test methods are to be executed but they allow the returning of an instance of the test fixture by a producer and passing it to the dependent consumers.</p> <ul class="simple"> <li><p>A producer is a test method that yields its unit under test as return value.</p></li> <li><p>A consumer is a test method that depends on one or more producers and their return values.</p></li> </ul> <p>This example shows how to use the <code class="docutils literal notranslate"><span class="pre">PHPUnit\Framework\Attributes\Depends</span></code> attribute to express dependencies between test methods:</p> <div class="literal-block-wrapper docutils container" id="writing-tests-for-phpunit-examples-stacktest-php"> <div class="code-block-caption">
<span class="caption-number">Example 2.11 </span><span class="caption-text">Using the <code class="docutils literal notranslate"><span class="pre">Depends</span></code> attribute to express dependencies</span><a class="headerlink" href="#writing-tests-for-phpunit-examples-stacktest-php" title="Permalink to this code"></a>
</div> <div class="highlight-php notranslate">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\Attributes\Depends</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">StackTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testEmpty</span><span class="p">()</span><span class="o">:</span> <span class="k">array</span>
    <span class="p">{</span>
        <span class="nv">$stack</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEmpty</span><span class="p">(</span><span class="nv">$stack</span><span class="p">);</span>

        <span class="k">return</span> <span class="nv">$stack</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="p">#[</span><span class="nd">Depends</span><span class="p">(</span><span class="s1">'testEmpty'</span><span class="p">)]</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testPush</span><span class="p">(</span><span class="k">array</span> <span class="nv">$stack</span><span class="p">)</span><span class="o">:</span> <span class="k">array</span>
    <span class="p">{</span>
        <span class="nv">$stack</span><span class="p">[]</span> <span class="o">=</span> <span class="s1">'foo'</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="s1">'foo'</span><span class="p">,</span> <span class="nv">$stack</span><span class="p">[</span><span class="nb">count</span><span class="p">(</span><span class="nv">$stack</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertNotEmpty</span><span class="p">(</span><span class="nv">$stack</span><span class="p">);</span>

        <span class="k">return</span> <span class="nv">$stack</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="p">#[</span><span class="nd">Depends</span><span class="p">(</span><span class="s1">'testPush'</span><span class="p">)]</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testPop</span><span class="p">(</span><span class="k">array</span> <span class="nv">$stack</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="s1">'foo'</span><span class="p">,</span> <span class="nb">array_pop</span><span class="p">(</span><span class="nv">$stack</span><span class="p">));</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEmpty</span><span class="p">(</span><span class="nv">$stack</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> <p>Running the test shown above yields the output shown below:</p> <div class="highlight-none notranslate">
<div class="highlight"><pre class="highlight" data-language="php">./tools/phpunit tests/StackTest.php
PHPUnit 12.0.2 by Sebastian Bergmann and contributors.

Runtime:       PHP 8.4.3

...                                                                 3 / 3 (100%)

Time: 00:00, Memory: 25.29 MB

OK (3 tests, 5 assertions)
</pre></div> </div> <p>In the example above, the first test, <code class="docutils literal notranslate"><span class="pre">testEmpty()</span></code>, creates a new array and asserts that it is empty. The test then returns the fixture as its result. The second test, <code class="docutils literal notranslate"><span class="pre">testPush()</span></code>, depends on <code class="docutils literal notranslate"><span class="pre">testEmpty()</span></code> and is passed the result of that depended-upon test as its argument. Finally, <code class="docutils literal notranslate"><span class="pre">testPop()</span></code> depends upon <code class="docutils literal notranslate"><span class="pre">testPush()</span></code>.</p> <div class="admonition-note admonition"> <p class="admonition-title">Note</p> <p>The return value yielded by a producer is passed “as-is” to its consumers by default. This means that when a producer returns an object, a reference to that object is passed to the consumers. Instead of a reference either (a) a (deep) copy via <code class="docutils literal notranslate"><span class="pre">DependsUsingDeepClone</span></code>, or (b) a (normal shallow) clone (based on PHP keyword <code class="docutils literal notranslate"><span class="pre">clone</span></code>) via <code class="docutils literal notranslate"><span class="pre">DependsUsingShallowClone</span></code> are possible, too.</p> </div> <p>To localize defects, we want our attention to be focussed on relevant failing tests. This is why PHPUnit skips the execution of a test when a depended-upon test has failed. This improves defect localization by exploiting the dependencies between tests as shown in <a class="reference internal" href="#writing-tests-for-phpunit-examples-dependencyfailuretest-php"><span class="std std-numref">Example 2.12</span></a>.</p> <div class="literal-block-wrapper docutils container" id="writing-tests-for-phpunit-examples-dependencyfailuretest-php"> <div class="code-block-caption">
<span class="caption-number">Example 2.12 </span><span class="caption-text">Leveraging the dependencies between tests</span><a class="headerlink" href="#writing-tests-for-phpunit-examples-dependencyfailuretest-php" title="Permalink to this code"></a>
</div> <div class="highlight-php notranslate">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\Attributes\Depends</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">DependencyFailureTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testOne</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="p">#[</span><span class="nd">Depends</span><span class="p">(</span><span class="s1">'testOne'</span><span class="p">)]</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testTwo</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> <p>Running the test shown above yields the output shown below:</p> <div class="highlight-none notranslate">
<div class="highlight"><pre class="highlight" data-language="php">./tools/phpunit --display-skipped tests/DependencyFailureTest.php
PHPUnit 12.0.2 by Sebastian Bergmann and contributors.

Runtime:       PHP 8.4.3

FS                                                                  2 / 2 (100%)

Time: 00:00, Memory: 25.29 MB

There was 1 failure:

1) DependencyFailureTest::testOne
Failed asserting that false is true.

/path/to/tests/DependencyFailureTest.php:9

--

There was 1 skipped test:

1) DependencyFailureTest::testTwo
This test depends on "DependencyFailureTest::testOne" to pass

FAILURES!
Tests: 2, Assertions: 1, Failures: 1, Skipped: 1.
</pre></div> </div> <p>A test may have more than one test dependency attribute.</p> <p>By default, PHPUnit does not change the order in which tests are executed, so you have to ensure that the dependencies of a test can actually be met before the test is run.</p> <p>A test that has more than one test dependency attribute will get a fixture from the first producer as the first argument, a fixture from the second producer as the second argument, and so on.</p> </section> <section id="failure-output"> <h2>Failure Output<a class="headerlink" href="#failure-output" title="Permalink to this heading"></a>
</h2> <p>Whenever a test fails, PHPUnit tries its best to provide you with as much context as possible that can help to identify the problem.</p> <div class="literal-block-wrapper docutils container" id="writing-tests-for-phpunit-failure-output-examples-arraydifftest-php"> <div class="code-block-caption">
<span class="caption-number">Example 2.13 </span><span class="caption-text">Output generated when an array comparison fails</span><a class="headerlink" href="#writing-tests-for-phpunit-failure-output-examples-arraydifftest-php" title="Permalink to this code"></a>
</div> <div class="highlight-php notranslate">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">ArrayDiffTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testEquality</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> <p>Running the test shown above yields the output shown below:</p> <div class="highlight-none notranslate">
<div class="highlight"><pre class="highlight" data-language="php">./tools/phpunit tests/ArrayDiffTest.php
PHPUnit 12.0.2 by Sebastian Bergmann and contributors.

Runtime:       PHP 8.4.3

F                                                                   1 / 1 (100%)

Time: 00:00, Memory: 25.29 MB

There was 1 failure:

1) ArrayDiffTest::testEquality
Failed asserting that two arrays are identical.
--- Expected
+++ Actual
@@ @@
 Array &amp;0 [
     0 =&gt; 1,
     1 =&gt; 2,
-    2 =&gt; 3,
+    2 =&gt; 33,
     3 =&gt; 4,
     4 =&gt; 5,
     5 =&gt; 6,
 ]

/path/to/tests/ArrayDiffTest.php:8

FAILURES!
Tests: 1, Assertions: 1, Failures: 1.
</pre></div> </div> <p>In this example only one of the array values differs and the other values are shown to provide context on where the error occurred.</p> <p>When the generated output would be long to read PHPUnit will split it up and provide a few lines of context around every difference.</p> <div class="literal-block-wrapper docutils container" id="writing-tests-for-phpunit-failure-output-examples-longarraydifftest-php"> <div class="code-block-caption">
<span class="caption-number">Example 2.14 </span><span class="caption-text">Output when an array comparison of a long array fails</span><a class="headerlink" href="#writing-tests-for-phpunit-failure-output-examples-longarraydifftest-php" title="Permalink to this code"></a>
</div> <div class="highlight-php notranslate">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">LongArrayDiffTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testEquality</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> <p>Running the test shown above yields the output shown below:</p> <div class="highlight-none notranslate">
<div class="highlight"><pre class="highlight" data-language="php">./tools/phpunit tests/LongArrayDiffTest.php
PHPUnit 12.0.2 by Sebastian Bergmann and contributors.

Runtime:       PHP 8.4.3

F                                                                   1 / 1 (100%)

Time: 00:00.001, Memory: 25.29 MB

There was 1 failure:

1) LongArrayDiffTest::testEquality
Failed asserting that two arrays are identical.
--- Expected
+++ Actual
@@ @@
     11 =&gt; 0,
     12 =&gt; 1,
     13 =&gt; 2,
-    14 =&gt; 3,
+    14 =&gt; 33,
     15 =&gt; 4,
     16 =&gt; 5,
     17 =&gt; 6,
 ]

/path/to/tests/LongArrayDiffTest.php:8

FAILURES!
Tests: 1, Assertions: 1, Failures: 1.
</pre></div> </div> <section id="edge-cases"> <h3>Edge Cases<a class="headerlink" href="#edge-cases" title="Permalink to this heading"></a>
</h3> <p>When a comparison fails PHPUnit creates textual representations of the input values and compares those. Due to that implementation a diff might show more problems than actually exist.</p> <p>This only happens when using <code class="docutils literal notranslate"><span class="pre">assertEquals()</span></code> or other “weak” comparison functions on arrays or objects.</p> <div class="literal-block-wrapper docutils container" id="writing-tests-for-phpunit-failure-output-edge-cases-examples-arrayweakcomparisontest-php"> <div class="code-block-caption">
<span class="caption-number">Example 2.15 </span><span class="caption-text">Edge case in the diff generation when using weak comparison</span><a class="headerlink" href="#writing-tests-for-phpunit-failure-output-edge-cases-examples-arrayweakcomparisontest-php" title="Permalink to this code"></a>
</div> <div class="highlight-php notranslate">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">ArrayWeakComparisonTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testEquality</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">'1'</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> <p>Running the test shown above yields the output shown below:</p> <div class="highlight-none notranslate">
<div class="highlight"><pre class="highlight" data-language="php">./tools/phpunit tests/ArrayWeakComparisonTest.php
PHPUnit 12.0.2 by Sebastian Bergmann and contributors.

Runtime:       PHP 8.4.3

F                                                                   1 / 1 (100%)

Time: 00:00, Memory: 25.29 MB

There was 1 failure:

1) ArrayWeakComparisonTest::testEquality
Failed asserting that two arrays are equal.
--- Expected
+++ Actual
@@ @@
 Array (
-    0 =&gt; 1
+    0 =&gt; '1'
     1 =&gt; 2
-    2 =&gt; 3
+    2 =&gt; 33
     3 =&gt; 4
     4 =&gt; 5
     5 =&gt; 6
 )

/path/to/tests/ArrayWeakComparisonTest.php:8

FAILURES!
Tests: 1, Assertions: 1, Failures: 1.
</pre></div> </div> <p>In this example the difference in the first index between <code class="docutils literal notranslate"><span class="pre">1</span></code> and <code class="docutils literal notranslate"><span class="pre">'1'</span></code> is reported even though <code class="docutils literal notranslate"><span class="pre">assertEquals()</span></code> considers the values as a match.</p> </section> </section><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2005&ndash;2025 Sebastian Bergmann<br>Licensed under the Creative Commons Attribution 3.0 Unported License.<br>
    <a href="https://docs.phpunit.de/en/12.0/writing-tests-for-phpunit.html" class="_attribution-link">https://docs.phpunit.de/en/12.0/writing-tests-for-phpunit.html</a>
  </p>
</div>
