<h1 class="devsite-page-title">tf.keras.callbacks.BackupAndRestore</h1> <devsite-bookmark></devsite-bookmark>       <p>Callback to back up and restore the training state.</p> <p>Inherits From: <a href="callback.html"><code translate="no" dir="ltr">Callback</code></a></p> <pre class="devsite-click-to-copy prettyprint lang-py tfo-signature-link" translate="no" dir="ltr" data-language="cpp">
tf.keras.callbacks.BackupAndRestore(
    backup_dir
)
</pre>  <p><code translate="no" dir="ltr">BackupAndRestore</code> callback is intended to recover training from an interruption that has happened in the middle of a <a href="../model.html#fit"><code translate="no" dir="ltr">Model.fit</code></a> execution, by backing up the training states in a temporary checkpoint file (with the help of a <a href="../../train/checkpointmanager.html"><code translate="no" dir="ltr">tf.train.CheckpointManager</code></a>), at the end of each epoch. Each backup overwrites the previously written checkpoint file, so at any given time there is at most one such checkpoint file for backup/restoring purpose.</p> <p>If training restarts before completion, the training state (which includes the <code translate="no" dir="ltr">Model</code> weights and epoch number) is restored to the most recently saved state at the beginning of a new <a href="../model.html#fit"><code translate="no" dir="ltr">Model.fit</code></a> run. At the completion of a <a href="../model.html#fit"><code translate="no" dir="ltr">Model.fit</code></a> run, the temporary checkpoint file is deleted.</p> <p>Note that the user is responsible to bring jobs back after the interruption. This callback is important for the backup and restore mechanism for fault tolerance purpose, and the model to be restored from an previous checkpoint is expected to be the same as the one used to back up. If user changes arguments passed to compile or fit, the checkpoint saved for fault tolerance can become invalid.</p> <h4 id="note" data-text="Note:">Note:</h4> <ol> <li>This callback is not compatible with eager execution disabled.</li> <li>A checkpoint is saved at the end of each epoch. After restoring, <a href="../model.html#fit"><code translate="no" dir="ltr">Model.fit</code></a> redoes any partial work during the unfinished epoch in which the training got restarted (so the work done before the interruption doesn't affect the final model state).</li> <li>This works for both single worker and multi-worker modes. When <a href="../model.html#fit"><code translate="no" dir="ltr">Model.fit</code></a> is used with <a href="../../distribute.html"><code translate="no" dir="ltr">tf.distribute</code></a>, it supports <a href="../../distribute/mirroredstrategy.html"><code translate="no" dir="ltr">tf.distribute.MirroredStrategy</code></a>, <a href="../../distribute/multiworkermirroredstrategy.html"><code translate="no" dir="ltr">tf.distribute.MultiWorkerMirroredStrategy</code></a>, <a href="../../distribute/tpustrategy.html"><code translate="no" dir="ltr">tf.distribute.TPUStrategy</code></a>, and <a href="../../distribute/experimental/parameterserverstrategy.html"><code translate="no" dir="ltr">tf.distribute.experimental.ParameterServerStrategy</code></a>.</li> </ol> <h4 id="example" data-text="Example:">Example:</h4> <pre class="devsite-click-to-copy prettyprint lang-py" translate="no" dir="ltr" data-language="cpp">
class InterruptingCallback(tf.keras.callbacks.Callback):
  def on_epoch_begin(self, epoch, logs=None):
    if epoch == 4:
      raise RuntimeError('Interrupting!')
callback = tf.keras.callbacks.BackupAndRestore(backup_dir="/tmp/backup")
model = tf.keras.models.Sequential([tf.keras.layers.Dense(10)])
model.compile(tf.keras.optimizers.SGD(), loss='mse')
try:
  model.fit(np.arange(100).reshape(5, 20), np.zeros(5), epochs=10,
            batch_size=1, callbacks=[callback, InterruptingCallback()],
            verbose=0)
except:
  pass
history = model.fit(np.arange(100).reshape(5, 20), np.zeros(5), epochs=10,
            batch_size=1, callbacks=[callback], verbose=0)
# Only 6 more epochs are run, since first trainning got interrupted at
# zero-indexed epoch 4, second training will continue from 4 to 9.
len(history.history['loss'])
6
</pre>  
<table class="responsive fixed orange"> <colgroup>
<col width="214px">
<col>
</colgroup> <tr><th colspan="2">Args</th></tr> 
<tr> <td> <code translate="no" dir="ltr">backup_dir</code> </td> <td> String, path to store the checkpoint. e.g. backup_dir = os.path.join(working_dir, 'backup') This is the directory in which the system stores temporary files to recover the model from jobs terminated unexpectedly. The directory cannot be reused elsewhere to store other files, e.g. by BackupAndRestore callback of another training, or by another callback (ModelCheckpoint) of the same training. </td> </tr> </table> <h2 id="methods" data-text="Methods">Methods</h2> <h3 id="set_model" data-text="set_model"><code translate="no" dir="ltr">set_model</code></h3> <p><a target="_blank" class="external" href="https://github.com/keras-team/keras/tree/v2.9.0/keras/callbacks.py#L647-L648">View source</a></p> <pre class="devsite-click-to-copy prettyprint lang-py tfo-signature-link" translate="no" dir="ltr" data-language="cpp">
set_model(
    model
)
</pre> <h3 id="set_params" data-text="set_params"><code translate="no" dir="ltr">set_params</code></h3> <p><a target="_blank" class="external" href="https://github.com/keras-team/keras/tree/v2.9.0/keras/callbacks.py#L644-L645">View source</a></p> <pre class="devsite-click-to-copy prettyprint lang-py tfo-signature-link" translate="no" dir="ltr" data-language="cpp">
set_params(
    params
)
</pre>  <devsite-thumb-rating position="footer"> </devsite-thumb-rating><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2022 The TensorFlow Authors. All rights reserved.<br>Licensed under the Creative Commons Attribution License 4.0.<br>Code samples licensed under the Apache 2.0 License.<br>
    <a href="https://www.tensorflow.org/versions/r2.9/api_docs/python/tf/keras/callbacks/BackupAndRestore" class="_attribution-link">https://www.tensorflow.org/versions/r2.9/api_docs/python/tf/keras/callbacks/BackupAndRestore</a>
  </p>
</div>
