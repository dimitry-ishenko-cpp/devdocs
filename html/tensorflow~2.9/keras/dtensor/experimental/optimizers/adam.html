<h1 class="devsite-page-title">tf.keras.dtensor.experimental.optimizers.Adam</h1> <devsite-bookmark></devsite-bookmark>       <p>DTensor specific optimizers.</p> <p>Inherits From: <a href="../../../optimizers/experimental/adam.html"><code translate="no" dir="ltr">Adam</code></a>, <a href="../../../optimizers/experimental/optimizer.html"><code translate="no" dir="ltr">Optimizer</code></a>, <a href="../../../../module.html"><code translate="no" dir="ltr">Module</code></a></p> <pre class="devsite-click-to-copy prettyprint lang-py tfo-signature-link" translate="no" dir="ltr" data-language="cpp">
tf.keras.dtensor.experimental.optimizers.Adam(
    learning_rate=0.001,
    beta_1=0.9,
    beta_2=0.999,
    epsilon=1e-07,
    amsgrad=False,
    gradients_clip_option=None,
    ema_option=None,
    name='Adam',
    mesh=None
)
</pre>  <p>The major changes for this class is that all the variable init logic will be mesh/layout aware.</p> <p>Optimizer that implements the Adam algorithm.</p> <p>Adam optimization is a stochastic gradient descent method that is based on adaptive estimation of first-order and second-order moments.</p> <p>According to <a href="http://arxiv.org/abs/1412.6980">Kingma et al., 2014</a>, the method is "<em>computationally efficient, has little memory requirement, invariant to diagonal rescaling of gradients, and is well suited for problems that are large in terms of data/parameters</em>".</p>  
<table class="responsive fixed orange"> <colgroup>
<col width="214px">
<col>
</colgroup> <tr><th colspan="2">Args</th></tr> 
<tr> <td> <code translate="no" dir="ltr">learning_rate</code> </td> <td> A <a href="../../../../tensor.html"><code translate="no" dir="ltr">tf.Tensor</code></a>, floating point value, a schedule that is a <a href="../../../optimizers/schedules/learningrateschedule.html"><code translate="no" dir="ltr">tf.keras.optimizers.schedules.LearningRateSchedule</code></a>, or a callable that takes no arguments and returns the actual value to use. The learning rate. Defaults to 0.001. </td> </tr>
<tr> <td> <code translate="no" dir="ltr">beta_1</code> </td> <td> A float value or a constant float tensor, or a callable that takes no arguments and returns the actual value to use. The exponential decay rate for the 1st moment estimates. Defaults to 0.9. </td> </tr>
<tr> <td> <code translate="no" dir="ltr">beta_2</code> </td> <td> A float value or a constant float tensor, or a callable that takes no arguments and returns the actual value to use. The exponential decay rate for the 2nd moment estimates. Defaults to 0.999. </td> </tr>
<tr> <td> <code translate="no" dir="ltr">epsilon</code> </td> <td> A small constant for numerical stability. This epsilon is "epsilon hat" in the Kingma and Ba paper (in the formula just before Section 2.1), not the epsilon in Algorithm 1 of the paper. Defaults to 1e-7. </td> </tr>
<tr> <td> <code translate="no" dir="ltr">amsgrad</code> </td> <td> Boolean. Whether to apply AMSGrad variant of this algorithm from the paper "On the Convergence of Adam and beyond". Defaults to <code translate="no" dir="ltr">False</code>. </td> </tr>
<tr> <td> <code translate="no" dir="ltr">name</code> </td> <td> String. The name to use for momentum accumulator weights created by the optimizer. </td> </tr>
<tr> <td> <code translate="no" dir="ltr">clipnorm</code> </td> <td> Float. If set, the gradient of each weight is individually clipped so that its norm is no higher than this value. </td> </tr>
<tr> <td> <code translate="no" dir="ltr">clipvalue</code> </td> <td> Float. If set, the gradient of each weight is clipped to be no higher than this value. </td> </tr>
<tr> <td> <code translate="no" dir="ltr">global_clipnorm</code> </td> <td> Float. If set, the gradient of all weights is clipped so that their global norm is no higher than this value. </td> </tr>
<tr> <td> <code translate="no" dir="ltr">use_ema</code> </td> <td> Boolean, defaults to False. If True, exponential moving average (EMA) is applied. EMA consists of computing an exponential moving average of the weights of the model (as the weight values change after each training batch), and periodically overwriting the weights with their moving average. </td> </tr>
<tr> <td> <code translate="no" dir="ltr">ema_momentum</code> </td> <td> Float, defaults to 0.99. Only used if <code translate="no" dir="ltr">use_ema=True</code>. This is the momentum to use when computing the EMA of the model's weights: <code translate="no" dir="ltr">new_average = ema_momentum * old_average + (1 - ema_momentum) * current_variable_value</code>. </td> </tr>
<tr> <td> <code translate="no" dir="ltr">ema_overwrite_frequency</code> </td> <td> Int or None, defaults to None. Only used if <code translate="no" dir="ltr">use_ema=True</code>. Every <code translate="no" dir="ltr">ema_overwrite_frequency</code> steps of iterations, we overwrite the model variable by its moving average. If None, the optimizer does not overwrite model variables in the middle of training, and you need to explicitly overwrite the variables at the end of training by calling <code translate="no" dir="ltr">optimizer.finalize_variable_values()</code> (which updates the model variables in-place). When using the built-in <code translate="no" dir="ltr">fit()</code> training loop, this happens automatically after the last epoch, and you don't need to do anything. </td> </tr>
<tr> <td> <code translate="no" dir="ltr">jit_compile</code> </td> <td> Boolean, defaults to True. If True, the optimizer will use XLA compilation. <code translate="no" dir="ltr">jit_compile</code> cannot be True when training with <a href="../../../../distribute/experimental/parameterserverstrategy.html"><code translate="no" dir="ltr">tf.distribute.experimental.ParameterServerStrategy</code></a>. Additionally, if no GPU device is found, this flag will be ignored. </td> </tr>
<tr> <td> <code translate="no" dir="ltr">**kwargs</code> </td> <td> keyword arguments only used for backward compatibility. </td> </tr> </table> <h4 id="reference" data-text="Reference:">Reference:</h4> <ul> <li><a href="http://arxiv.org/abs/1412.6980">Kingma et al., 2014</a></li> <li>
<a href="https://openreview.net/pdf?id=ryQu7f-RZ">Reddi et al., 2018</a> for <code translate="no" dir="ltr">amsgrad</code>.</li> </ul> <h4 id="notes" data-text="Notes:">Notes:</h4> <p>The default value of 1e-7 for epsilon might not be a good default in general. For example, when training an Inception network on ImageNet a current good choice is 1.0 or 0.1. Note that since Adam uses the formulation just before Section 2.1 of the Kingma and Ba paper rather than the formulation in Algorithm 1, the "epsilon" referred to here is "epsilon hat" in the paper.</p> <p>The sparse implementation of this algorithm (used when the gradient is an IndexedSlices object, typically because of <a href="../../../../gather.html"><code translate="no" dir="ltr">tf.gather</code></a> or an embedding lookup in the forward pass) does apply momentum to variable slices even if they were not used in the forward pass (meaning they have a gradient equal to zero). Momentum decay (beta1) is also applied to the entire momentum accumulator. This means that the sparse behavior is equivalent to the dense behavior (in contrast to some momentum implementations which ignore momentum unless a variable slice was actually used).</p>  
<table class="responsive fixed orange"> <colgroup>
<col width="214px">
<col>
</colgroup> <tr><th colspan="2">Attributes</th></tr> 
<tr> <td> <code translate="no" dir="ltr">iterations</code> </td> <td> The number of training steps this <code translate="no" dir="ltr">optimizer</code> has run. <p>By default, iterations would be incremented by one every time <code translate="no" dir="ltr">apply_gradients()</code> is called. </p>
</td> </tr>
<tr> <td> <code translate="no" dir="ltr">learning_rate</code> </td> <td> 
</td> </tr> </table> <h2 id="methods" data-text="Methods">Methods</h2> <h3 id="add_variable" data-text="add_variable"><code translate="no" dir="ltr">add_variable</code></h3> <p><a target="_blank" class="external" href="https://github.com/keras-team/keras/tree/v2.9.0/keras/optimizers/optimizer_experimental/optimizer.py#L319-L341">View source</a></p> <pre class="devsite-click-to-copy prettyprint lang-py tfo-signature-link" translate="no" dir="ltr" data-language="cpp">
add_variable(
    shape, dtype=None, initializer='zeros', name=None
)
</pre> <p>Create an optimizer variable.</p>  
<table class="responsive fixed orange"> <colgroup>
<col width="214px">
<col>
</colgroup> <tr><th colspan="2">Args</th></tr> 
<tr> <td> <code translate="no" dir="ltr">shape</code> </td> <td> A list of integers, a tuple of integers, or a 1-D Tensor of type int32. Defaults to scalar if unspecified. </td> </tr>
<tr> <td> <code translate="no" dir="ltr">dtype</code> </td> <td> The DType of the optimizer variable to be created. Defaults to <a href="../../../backend/floatx.html"><code translate="no" dir="ltr">tf.keras.backend.floatx</code></a> if unspecified. </td> </tr>
<tr> <td> <code translate="no" dir="ltr">initializer</code> </td> <td> string or callable. Initializer instance. </td> </tr>
<tr> <td> <code translate="no" dir="ltr">name</code> </td> <td> The name of the optimizer variable to be created. </td> </tr> </table>  
<table class="responsive fixed orange"> <colgroup>
<col width="214px">
<col>
</colgroup> <tr><th colspan="2">Returns</th></tr> <tr class="alt"> <td colspan="2"> An optimizer variable, in the format of tf.Variable. </td> </tr> 
</table> <h3 id="add_variable_from_reference" data-text="add_variable_from_reference"><code translate="no" dir="ltr">add_variable_from_reference</code></h3> <p><a target="_blank" class="external" href="https://github.com/keras-team/keras/tree/v2.9.0/keras/dtensor/optimizers.py#L71-L105">View source</a></p> <pre class="devsite-click-to-copy prettyprint lang-py tfo-signature-link" translate="no" dir="ltr" data-language="cpp">
add_variable_from_reference(
    model_variable, variable_name, initial_value=None
)
</pre> <p>Create an optimizer variable from model variable.</p> <p>Create an optimizer variable based on the information of model variable. For example, in SGD optimizer momemtum, for each model variable, a corresponding momemtum variable is created of the same shape and dtype.</p>  
<table class="responsive fixed orange"> <colgroup>
<col width="214px">
<col>
</colgroup> <tr><th colspan="2">Args</th></tr> 
<tr> <td> <code translate="no" dir="ltr">model_variable</code> </td> <td> The corresponding model variable to the optimizer variable to be created. </td> </tr>
<tr> <td> <code translate="no" dir="ltr">variable_name</code> </td> <td> The name prefix of the optimizer variable to be created. The create variables name will follow the pattern <code translate="no" dir="ltr">{variable_name}/{model_variable.name}</code>, e.g., <code translate="no" dir="ltr">momemtum/dense_1</code>. </td> </tr>
<tr> <td> <code translate="no" dir="ltr">initial_value</code> </td> <td> The initial value of the optimizer variable, if None, the value will be default to 0. </td> </tr> </table>  
<table class="responsive fixed orange"> <colgroup>
<col width="214px">
<col>
</colgroup> <tr><th colspan="2">Returns</th></tr> <tr class="alt"> <td colspan="2"> An optimizer variable. </td> </tr> 
</table> <h3 id="apply_gradients" data-text="apply_gradients"><code translate="no" dir="ltr">apply_gradients</code></h3> <p><a target="_blank" class="external" href="https://github.com/keras-team/keras/tree/v2.9.0/keras/dtensor/optimizers.py#L117-L131">View source</a></p> <pre class="devsite-click-to-copy prettyprint lang-py tfo-signature-link" translate="no" dir="ltr" data-language="cpp">
apply_gradients(
    grads_and_vars
)
</pre> <p>Apply gradients to variables.</p>  
<table class="responsive fixed orange"> <colgroup>
<col width="214px">
<col>
</colgroup> <tr><th colspan="2">Args</th></tr> 
<tr> <td> <code translate="no" dir="ltr">grads_and_vars</code> </td> <td> List of (gradient, variable) pairs. </td> </tr> </table>  
<table class="responsive fixed orange"> <colgroup>
<col width="214px">
<col>
</colgroup> <tr><th colspan="2">Returns</th></tr> <tr class="alt"> <td colspan="2"> None </td> </tr> 
</table>  
<table class="responsive fixed orange"> <colgroup>
<col width="214px">
<col>
</colgroup> <tr><th colspan="2">Raises</th></tr> 
<tr> <td> <code translate="no" dir="ltr">TypeError</code> </td> <td> If <code translate="no" dir="ltr">grads_and_vars</code> is malformed. </td> </tr> </table> <h3 id="build" data-text="build"><code translate="no" dir="ltr">build</code></h3> <p><a target="_blank" class="external" href="https://github.com/keras-team/keras/tree/v2.9.0/keras/optimizers/optimizer_experimental/adam.py#L114-L141">View source</a></p> <pre class="devsite-click-to-copy prettyprint lang-py tfo-signature-link" translate="no" dir="ltr" data-language="cpp">
build(
    var_list
)
</pre> <p>Initialize optimizer variables.</p> <p>Adam optimizer has 3 types of variables: momentums, velocities and velocity_hat (only set when amsgrad is applied),</p>  
<table class="responsive fixed orange"> <colgroup>
<col width="214px">
<col>
</colgroup> <tr><th colspan="2">Args</th></tr> 
<tr> <td> <code translate="no" dir="ltr">var_list</code> </td> <td> list of model variables to build Adam variables on. </td> </tr> </table> <h3 id="compute_gradients" data-text="compute_gradients"><code translate="no" dir="ltr">compute_gradients</code></h3> <p><a target="_blank" class="external" href="https://github.com/keras-team/keras/tree/v2.9.0/keras/optimizers/optimizer_experimental/optimizer.py#L152-L177">View source</a></p> <pre class="devsite-click-to-copy prettyprint lang-py tfo-signature-link" translate="no" dir="ltr" data-language="cpp">
compute_gradients(
    loss, var_list, tape=None
)
</pre> <p>Compute gradients of loss on trainable variables.</p>  
<table class="responsive fixed orange"> <colgroup>
<col width="214px">
<col>
</colgroup> <tr><th colspan="2">Args</th></tr> 
<tr> <td> <code translate="no" dir="ltr">loss</code> </td> <td> <code translate="no" dir="ltr">Tensor</code> or callable. If a callable, <code translate="no" dir="ltr">loss</code> should take no arguments and return the value to minimize. </td> </tr>
<tr> <td> <code translate="no" dir="ltr">var_list</code> </td> <td> list or tuple of <code translate="no" dir="ltr">Variable</code> objects to update to minimize <code translate="no" dir="ltr">loss</code>. </td> </tr>
<tr> <td> <code translate="no" dir="ltr">tape</code> </td> <td> (Optional) <a href="../../../../gradienttape.html"><code translate="no" dir="ltr">tf.GradientTape</code></a>. If <code translate="no" dir="ltr">loss</code> is provided as a <code translate="no" dir="ltr">Tensor</code>, the tape that computed the <code translate="no" dir="ltr">loss</code> must be provided. </td> </tr> </table>  
<table class="responsive fixed orange"> <colgroup>
<col width="214px">
<col>
</colgroup> <tr><th colspan="2">Returns</th></tr> <tr class="alt"> <td colspan="2"> A list of (gradient, variable) pairs. Variable is always present, but gradient can be <code translate="no" dir="ltr">None</code>. </td> </tr> 
</table> <h3 id="finalize_variable_values" data-text="finalize_variable_values"><code translate="no" dir="ltr">finalize_variable_values</code></h3> <p><a target="_blank" class="external" href="https://github.com/keras-team/keras/tree/v2.9.0/keras/optimizers/optimizer_experimental/optimizer.py#L469-L481">View source</a></p> <pre class="devsite-click-to-copy prettyprint lang-py tfo-signature-link" translate="no" dir="ltr" data-language="cpp">
finalize_variable_values(
    var_list
)
</pre> <p>Set the final value of model's trainable variables.</p> <p>Sometimes there are some extra steps before ending the variable updates, such as overriding the model variables with its average value.</p>  
<table class="responsive fixed orange"> <colgroup>
<col width="214px">
<col>
</colgroup> <tr><th colspan="2">Args</th></tr> 
<tr> <td> <code translate="no" dir="ltr">var_list</code> </td> <td> list of model variables. </td> </tr> </table> <h3 id="from_config" data-text="from_config"><code translate="no" dir="ltr">from_config</code></h3> <p><a target="_blank" class="external" href="https://github.com/keras-team/keras/tree/v2.9.0/keras/optimizers/optimizer_experimental/optimizer.py#L518-L535">View source</a></p> <pre class="devsite-click-to-copy prettyprint lang-py tfo-signature-link" translate="no" dir="ltr" data-language="cpp">
@classmethod
from_config(
    config
)
</pre> <p>Creates an optimizer from its config.</p> <p>This method is the reverse of <code translate="no" dir="ltr">get_config</code>, capable of instantiating the same optimizer from the config dictionary.</p>  
<table class="responsive fixed orange"> <colgroup>
<col width="214px">
<col>
</colgroup> <tr><th colspan="2">Args</th></tr> 
<tr> <td> <code translate="no" dir="ltr">config</code> </td> <td> A Python dictionary, typically the output of get_config. </td> </tr> </table>  
<table class="responsive fixed orange"> <colgroup>
<col width="214px">
<col>
</colgroup> <tr><th colspan="2">Returns</th></tr> <tr class="alt"> <td colspan="2"> An optimizer instance. </td> </tr> 
</table> <h3 id="get_config" data-text="get_config"><code translate="no" dir="ltr">get_config</code></h3> <p><a target="_blank" class="external" href="https://github.com/keras-team/keras/tree/v2.9.0/keras/optimizers/optimizer_experimental/adam.py#L183-L193">View source</a></p> <pre class="devsite-click-to-copy prettyprint lang-py tfo-signature-link" translate="no" dir="ltr" data-language="cpp">
get_config()
</pre> <p>Returns the config of the optimizer.</p> <p>An optimizer config is a Python dictionary (serializable) containing the configuration of an optimizer. The same optimizer can be reinstantiated later (without any saved state) from this configuration.</p> <p>Subclass optimizer should override this method to include other hyperparameters.</p>  
<table class="responsive fixed orange"> <colgroup>
<col width="214px">
<col>
</colgroup> <tr><th colspan="2">Returns</th></tr> <tr class="alt"> <td colspan="2"> Python dictionary. </td> </tr> 
</table> <h3 id="minimize" data-text="minimize"><code translate="no" dir="ltr">minimize</code></h3> <p><a target="_blank" class="external" href="https://github.com/keras-team/keras/tree/v2.9.0/keras/optimizers/optimizer_experimental/optimizer.py#L382-L401">View source</a></p> <pre class="devsite-click-to-copy prettyprint lang-py tfo-signature-link" translate="no" dir="ltr" data-language="cpp">
minimize(
    loss, var_list, tape=None
)
</pre> <p>Minimize <code translate="no" dir="ltr">loss</code> by updating <code translate="no" dir="ltr">var_list</code>.</p> <p>This method simply computes gradient using <a href="../../../../gradienttape.html"><code translate="no" dir="ltr">tf.GradientTape</code></a> and calls <code translate="no" dir="ltr">apply_gradients()</code>. If you want to process the gradient before applying then call <a href="../../../../gradienttape.html"><code translate="no" dir="ltr">tf.GradientTape</code></a> and <code translate="no" dir="ltr">apply_gradients()</code> explicitly instead of using this function.</p>  
<table class="responsive fixed orange"> <colgroup>
<col width="214px">
<col>
</colgroup> <tr><th colspan="2">Args</th></tr> 
<tr> <td> <code translate="no" dir="ltr">loss</code> </td> <td> <code translate="no" dir="ltr">Tensor</code> or callable. If a callable, <code translate="no" dir="ltr">loss</code> should take no arguments and return the value to minimize. </td> </tr>
<tr> <td> <code translate="no" dir="ltr">var_list</code> </td> <td> list or tuple of <code translate="no" dir="ltr">Variable</code> objects to update to minimize <code translate="no" dir="ltr">loss</code>. </td> </tr>
<tr> <td> <code translate="no" dir="ltr">tape</code> </td> <td> (Optional) <a href="../../../../gradienttape.html"><code translate="no" dir="ltr">tf.GradientTape</code></a>. </td> </tr> </table>  
<table class="responsive fixed orange"> <colgroup>
<col width="214px">
<col>
</colgroup> <tr><th colspan="2">Returns</th></tr> <tr class="alt"> <td colspan="2"> None </td> </tr> 
</table> <h3 id="update_step" data-text="update_step"><code translate="no" dir="ltr">update_step</code></h3> <p><a target="_blank" class="external" href="https://github.com/keras-team/keras/tree/v2.9.0/keras/optimizers/optimizer_experimental/adam.py#L143-L181">View source</a></p> <pre class="devsite-click-to-copy prettyprint lang-py tfo-signature-link" translate="no" dir="ltr" data-language="cpp">
update_step(
    gradient, variable
)
</pre> <p>Update step given gradient and the associated model variable.</p>  <devsite-thumb-rating position="footer"> </devsite-thumb-rating><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2022 The TensorFlow Authors. All rights reserved.<br>Licensed under the Creative Commons Attribution License 4.0.<br>Code samples licensed under the Apache 2.0 License.<br>
    <a href="https://www.tensorflow.org/versions/r2.9/api_docs/python/tf/keras/dtensor/experimental/optimizers/Adam" class="_attribution-link">https://www.tensorflow.org/versions/r2.9/api_docs/python/tf/keras/dtensor/experimental/optimizers/Adam</a>
  </p>
</div>
