<h1 class="devsite-page-title">tf.experimental.dtensor.Mesh</h1> <devsite-bookmark></devsite-bookmark>       <p>Represents a Mesh configuration over a certain list of Mesh Dimensions.</p> <pre class="devsite-click-to-copy prettyprint lang-py tfo-signature-link" translate="no" dir="ltr" data-language="cpp">
tf.experimental.dtensor.Mesh(
    dim_names: List[str],
    global_device_ids: np.ndarray,
    local_device_ids: List[int],
    local_devices: List[tf.compat.v1.DeviceSpec],
    mesh_name: str = '',
    global_devices: Optional[List[tf_device.DeviceSpec]] = None
)
</pre>  <p>A mesh consists of named dimensions with sizes, which describe how a set of devices are arranged. Defining tensor layouts in terms of mesh dimensions allows us to efficiently determine the communication required when computing an operation with tensors of different layouts.</p> <p>A mesh provides information not only about the placement of the tensors but also the topology of the underlying devices. For example, we can group 8 TPUs as a 1-D array for data parallelism or a <code translate="no" dir="ltr">2x4</code> grid for (2-way) data parallelism and (4-way) model parallelism.</p> <blockquote class="note">
<strong>Note:</strong><span> the utilities <a href="create_mesh.html"><code translate="no" dir="ltr">dtensor.create_mesh</code></a> and <a href="create_distributed_mesh.html"><code translate="no" dir="ltr">dtensor.create_distributed_mesh</code></a> provide a simpler API to create meshes for single- or multi-client use cases.</span>
</blockquote>  
<table class="responsive fixed orange"> <colgroup>
<col width="214px">
<col>
</colgroup> <tr><th colspan="2">Args</th></tr> 
<tr> <td> <code translate="no" dir="ltr">dim_names</code> </td> <td> A list of strings indicating dimension names. </td> </tr>
<tr> <td> <code translate="no" dir="ltr">global_device_ids</code> </td> <td> An ndarray of global device IDs is used to compose DeviceSpecs describing the mesh. The shape of this array determines the size of each mesh dimension. Values in this array should increment sequentially from 0. This argument is the same for every DTensor client. </td> </tr>
<tr> <td> <code translate="no" dir="ltr">local_device_ids</code> </td> <td> A list of local device IDs equal to a subset of values in global_device_ids. They indicate the position of local devices in the global mesh. Different DTensor clients must contain distinct local_device_ids contents. All local_device_ids from all DTensor clients must cover every element in global_device_ids. </td> </tr>
<tr> <td> <code translate="no" dir="ltr">local_devices</code> </td> <td> The list of devices hosted locally. The elements correspond 1:1 to those of local_device_ids. </td> </tr>
<tr> <td> <code translate="no" dir="ltr">mesh_name</code> </td> <td> The name of the mesh. Currently, this is rarely used, and is mostly used to indicate whether it is a CPU, GPU, or TPU-based mesh. global_devices (optional): The list of global devices. Set when multiple device meshes are in use. </td> </tr> </table>  
<table class="responsive fixed orange"> <colgroup>
<col width="214px">
<col>
</colgroup> <tr><th colspan="2">Attributes</th></tr> 
<tr> <td> <code translate="no" dir="ltr">dim_names</code> </td> <td> 
</td> </tr>
<tr> <td> <code translate="no" dir="ltr">name</code> </td> <td> 
</td> </tr>
<tr> <td> <code translate="no" dir="ltr">size</code> </td> <td> 
</td> </tr> </table> <h2 id="methods" data-text="Methods">Methods</h2> <h3 id="as_proto" data-text="as_proto"><code translate="no" dir="ltr">as_proto</code></h3> <p><a target="_blank" class="external" href="https://github.com/tensorflow/tensorflow/blob/v2.9.0/tensorflow/dtensor/python/layout.py#L314-L339">View source</a></p> <pre class="devsite-click-to-copy prettyprint lang-py tfo-signature-link" translate="no" dir="ltr" data-language="cpp">
as_proto() -&gt; layout_pb2.MeshProto
</pre> <p>Returns mesh protobuffer.</p> <h3 id="contains_dim" data-text="contains_dim"><code translate="no" dir="ltr">contains_dim</code></h3> <p><a target="_blank" class="external" href="https://github.com/tensorflow/tensorflow/blob/v2.9.0/tensorflow/dtensor/python/layout.py#L227-L229">View source</a></p> <pre class="devsite-click-to-copy prettyprint lang-py tfo-signature-link" translate="no" dir="ltr" data-language="cpp">
contains_dim(
    dim_name: str
) -&gt; bool
</pre> <p>Returns True if a Mesh contains the given dimension name.</p> <h3 id="device_type" data-text="device_type"><code translate="no" dir="ltr">device_type</code></h3> <p><a target="_blank" class="external" href="https://github.com/tensorflow/tensorflow/blob/v2.9.0/tensorflow/dtensor/python/layout.py#L223-L225">View source</a></p> <pre class="devsite-click-to-copy prettyprint lang-py tfo-signature-link" translate="no" dir="ltr" data-language="cpp">
device_type() -&gt; str
</pre> <p>Returns the device_type of a Mesh.</p> <h3 id="dim_size" data-text="dim_size"><code translate="no" dir="ltr">dim_size</code></h3> <p><a target="_blank" class="external" href="https://github.com/tensorflow/tensorflow/blob/v2.9.0/tensorflow/dtensor/python/layout.py#L234-L241">View source</a></p> <pre class="devsite-click-to-copy prettyprint lang-py tfo-signature-link" translate="no" dir="ltr" data-language="cpp">
dim_size(
    dim_name: str
) -&gt; int
</pre> <p>Returns the size of a dimension.</p> <h3 id="from_proto" data-text="from_proto"><code translate="no" dir="ltr">from_proto</code></h3> <p><a target="_blank" class="external" href="https://github.com/tensorflow/tensorflow/blob/v2.9.0/tensorflow/dtensor/python/layout.py#L382-L407">View source</a></p> <pre class="devsite-click-to-copy prettyprint lang-py tfo-signature-link" translate="no" dir="ltr" data-language="cpp">
@staticmethod
from_proto(
    proto: layout_pb2.MeshProto
) -&gt; 'Mesh'
</pre> <p>Construct a mesh instance from input <code translate="no" dir="ltr">proto</code>.</p> <h3 id="from_string" data-text="from_string"><code translate="no" dir="ltr">from_string</code></h3> <p><a target="_blank" class="external" href="https://github.com/tensorflow/tensorflow/blob/v2.9.0/tensorflow/dtensor/python/layout.py#L341-L380">View source</a></p> <pre class="devsite-click-to-copy prettyprint lang-py tfo-signature-link" translate="no" dir="ltr" data-language="cpp">
@staticmethod
from_string(
    mesh_str: str
) -&gt; 'Mesh'
</pre> <p>Construct a mesh instance from input <code translate="no" dir="ltr">proto</code>.</p> <h3 id="host_mesh" data-text="host_mesh"><code translate="no" dir="ltr">host_mesh</code></h3> <p><a target="_blank" class="external" href="https://github.com/tensorflow/tensorflow/blob/v2.9.0/tensorflow/dtensor/python/layout.py#L196-L221">View source</a></p> <pre class="devsite-click-to-copy prettyprint lang-py tfo-signature-link" translate="no" dir="ltr" data-language="cpp">
host_mesh()
</pre> <p>Returns the 1-1 mapped host mesh.</p> <h3 id="is_remote" data-text="is_remote"><code translate="no" dir="ltr">is_remote</code></h3> <p><a target="_blank" class="external" href="https://github.com/tensorflow/tensorflow/blob/v2.9.0/tensorflow/dtensor/python/layout.py#L192-L194">View source</a></p> <pre class="devsite-click-to-copy prettyprint lang-py tfo-signature-link" translate="no" dir="ltr" data-language="cpp">
is_remote() -&gt; bool
</pre> <p>Returns True if a Mesh contains only remote devices.</p> <h3 id="local_device_ids" data-text="local_device_ids"><code translate="no" dir="ltr">local_device_ids</code></h3> <p><a target="_blank" class="external" href="https://github.com/tensorflow/tensorflow/blob/v2.9.0/tensorflow/dtensor/python/layout.py#L274-L276">View source</a></p> <pre class="devsite-click-to-copy prettyprint lang-py tfo-signature-link" translate="no" dir="ltr" data-language="cpp">
local_device_ids() -&gt; List[int]
</pre> <p>Returns a list of local device IDs.</p> <h3 id="local_device_locations" data-text="local_device_locations"><code translate="no" dir="ltr">local_device_locations</code></h3> <p><a target="_blank" class="external" href="https://github.com/tensorflow/tensorflow/blob/v2.9.0/tensorflow/dtensor/python/layout.py#L278-L285">View source</a></p> <pre class="devsite-click-to-copy prettyprint lang-py tfo-signature-link" translate="no" dir="ltr" data-language="cpp">
local_device_locations() -&gt; List[Dict[str, int]]
</pre> <p>Returns a list of local device locations.</p> <p>A device location is a dictionary from dimension names to indices on those dimensions.</p> <h3 id="local_devices" data-text="local_devices"><code translate="no" dir="ltr">local_devices</code></h3> <p><a target="_blank" class="external" href="https://github.com/tensorflow/tensorflow/blob/v2.9.0/tensorflow/dtensor/python/layout.py#L287-L289">View source</a></p> <pre class="devsite-click-to-copy prettyprint lang-py tfo-signature-link" translate="no" dir="ltr" data-language="cpp">
local_devices() -&gt; List[str]
</pre> <p>Returns a list of local device specs represented as strings.</p> <h3 id="min_global_device_id" data-text="min_global_device_id"><code translate="no" dir="ltr">min_global_device_id</code></h3> <p><a target="_blank" class="external" href="https://github.com/tensorflow/tensorflow/blob/v2.9.0/tensorflow/dtensor/python/layout.py#L269-L272">View source</a></p> <pre class="devsite-click-to-copy prettyprint lang-py tfo-signature-link" translate="no" dir="ltr" data-language="cpp">
min_global_device_id() -&gt; int
</pre> <p>Returns the minimum global device ID.</p> <h3 id="num_local_devices" data-text="num_local_devices"><code translate="no" dir="ltr">num_local_devices</code></h3> <p><a target="_blank" class="external" href="https://github.com/tensorflow/tensorflow/blob/v2.9.0/tensorflow/dtensor/python/layout.py#L291-L293">View source</a></p> <pre class="devsite-click-to-copy prettyprint lang-py tfo-signature-link" translate="no" dir="ltr" data-language="cpp">
num_local_devices() -&gt; int
</pre> <p>Returns the number of local devices.</p> <h3 id="shape" data-text="shape"><code translate="no" dir="ltr">shape</code></h3> <p><a target="_blank" class="external" href="https://github.com/tensorflow/tensorflow/blob/v2.9.0/tensorflow/dtensor/python/layout.py#L409-L411">View source</a></p> <pre class="devsite-click-to-copy prettyprint lang-py tfo-signature-link" translate="no" dir="ltr" data-language="cpp">
shape() -&gt; List[int]
</pre> <p>Returns the shape of the mesh.</p> <h3 id="to_string" data-text="to_string"><code translate="no" dir="ltr">to_string</code></h3> <p><a target="_blank" class="external" href="https://github.com/tensorflow/tensorflow/blob/v2.9.0/tensorflow/dtensor/python/layout.py#L295-L312">View source</a></p> <pre class="devsite-click-to-copy prettyprint lang-py tfo-signature-link" translate="no" dir="ltr" data-language="cpp">
to_string() -&gt; str
</pre> <p>Returns string representation of Mesh.</p> <h3 id="unravel_index" data-text="unravel_index"><code translate="no" dir="ltr">unravel_index</code></h3> <p><a target="_blank" class="external" href="https://github.com/tensorflow/tensorflow/blob/v2.9.0/tensorflow/dtensor/python/layout.py#L243-L267">View source</a></p> <pre class="devsite-click-to-copy prettyprint lang-py tfo-signature-link" translate="no" dir="ltr" data-language="cpp">
unravel_index()
</pre> <p>Returns a dictionary from device ID to {dim_name: dim_index}.</p> <p>For example, for a 3x2 mesh, return this:</p> <pre class="prettyprint" translate="no" dir="ltr" data-language="cpp">{ 0: {'x': 0, 'y', 0},
  1: {'x': 0, 'y', 1},
  2: {'x': 1, 'y', 0},
  3: {'x': 1, 'y', 1},
  4: {'x': 2, 'y', 0},
  5: {'x': 2, 'y', 1} }
</pre> <h3 id="__contains__" data-text="__contains__"><code translate="no" dir="ltr">__contains__</code></h3> <p><a target="_blank" class="external" href="https://github.com/tensorflow/tensorflow/blob/v2.9.0/tensorflow/dtensor/python/layout.py#L231-L232">View source</a></p> <pre class="devsite-click-to-copy prettyprint lang-py tfo-signature-link" translate="no" dir="ltr" data-language="cpp">
__contains__(
    dim_name: str
) -&gt; bool
</pre> <h3 id="__eq__" data-text="__eq__"><code translate="no" dir="ltr">__eq__</code></h3> <p><a target="_blank" class="external" href="https://github.com/tensorflow/tensorflow/blob/v2.9.0/tensorflow/dtensor/python/layout.py#L427-L432">View source</a></p> <pre class="devsite-click-to-copy prettyprint lang-py tfo-signature-link" translate="no" dir="ltr" data-language="cpp">
__eq__(
    other
)
</pre> <p>Return self==value.</p> <h3 id="__getitem__" data-text="__getitem__"><code translate="no" dir="ltr">__getitem__</code></h3> <p><a target="_blank" class="external" href="https://github.com/tensorflow/tensorflow/blob/v2.9.0/tensorflow/dtensor/python/layout.py#L417-L421">View source</a></p> <pre class="devsite-click-to-copy prettyprint lang-py tfo-signature-link" translate="no" dir="ltr" data-language="cpp">
__getitem__(
    dim_name: str
) -&gt; MeshDimension
</pre>  <devsite-thumb-rating position="footer"> </devsite-thumb-rating><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2022 The TensorFlow Authors. All rights reserved.<br>Licensed under the Creative Commons Attribution License 4.0.<br>Code samples licensed under the Apache 2.0 License.<br>
    <a href="https://www.tensorflow.org/versions/r2.9/api_docs/python/tf/experimental/dtensor/Mesh" class="_attribution-link">https://www.tensorflow.org/versions/r2.9/api_docs/python/tf/experimental/dtensor/Mesh</a>
  </p>
</div>
