<h1>File Descriptor Limits</h1>  <p>When using a large number of Virtual Hosts, Apache may run out of available file descriptors (sometimes called <cite>file handles</cite>) if each Virtual Host specifies different log files. The total number of file descriptors used by Apache is one for each distinct error log file, one for every other log file directive, plus 10-20 for internal use. Unix operating systems limit the number of file descriptors that may be used by a process; the limit is typically 64, and may usually be increased up to a large hard-limit.</p> <p>Although Apache attempts to increase the limit as required, this may not work if:</p> <ol> <li>Your system does not provide the <code>setrlimit()</code> system call.</li> <li>The <code>setrlimit(RLIMIT_NOFILE)</code> call does not function on your system (such as Solaris 2.3)</li> <li>The number of file descriptors required exceeds the hard limit.</li> <li>Your system imposes other limits on file descriptors, such as a limit on stdio streams only using file descriptors below 256. (Solaris 2)</li> </ol> <p>In the event of problems you can:</p> <ul> <li>Reduce the number of log files; don't specify log files in the <code class="directive"><a href="../mod/core.html#virtualhost">&lt;VirtualHost&gt;</a></code> sections, but only log to the main log files. (See <a href="#splitlogs">Splitting up your log files</a>, below, for more information on doing this.)</li> <li> If your system falls into 1 or 2 (above), then increase the file descriptor limit before starting Apache, using a script like: <div class="example"><pre>#!/bin/sh
ulimit -S -n 100
exec httpd</pre></div> </li> </ul>    <h2 id="splitlogs">Splitting up your log files</h2> <p>If you want to log multiple virtual hosts to the same log file, you may want to split up the log files afterwards in order to run statistical analysis of the various virtual hosts. This can be accomplished in the following manner.</p> <p>First, you will need to add the virtual host information to the log entries. This can be done using the <code class="directive"><a href="../mod/mod_log_config.html#logformat"> LogFormat</a></code> directive, and the <code>%v</code> variable. Add this to the beginning of your log format string:</p> <pre class="prettyprint lang-config">LogFormat "%v %h %l %u %t \"%r\" %&gt;s %b" vhost
CustomLog logs/multiple_vhost_log vhost</pre> <p>This will create a log file in the common log format, but with the canonical virtual host (whatever appears in the <code class="directive"><a href="../mod/core.html#servername">ServerName</a></code> directive) prepended to each line. (See <code class="module"><a href="../mod/mod_log_config.html">mod_log_config</a></code> for more about customizing your log files.)</p> <p>When you wish to split your log file into its component parts (one file per virtual host), you can use the program <code><a href="https://httpd.apache.org/docs/2.4/en/programs/other.html">split-logfile</a></code> to accomplish this. You'll find this program in the <code>support</code> directory of the Apache distribution.</p> <p>Run this program with the command:</p> <div class="example"><pre>split-logfile &lt; /logs/multiple_vhost_log</pre></div> <p>This program, when run with the name of your vhost log file, will generate one file for each virtual host that appears in your log file. Each file will be called <code>hostname.log</code>.</p><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2018 The Apache Software Foundation<br>Licensed under the Apache License, Version 2.0.<br>
    <a href="https://httpd.apache.org/docs/2.4/en/vhosts/fd-limits.html" class="_attribution-link">https://httpd.apache.org/docs/2.4/en/vhosts/fd-limits.html</a>
  </p>
</div>
