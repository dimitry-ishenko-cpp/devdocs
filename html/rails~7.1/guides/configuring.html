<h1>Configuring Rails Applications</h1>
<div class="_simple"> <p>This guide covers the configuration and initialization features available to Rails applications.</p>
<p>After reading this guide, you will know:</p> <ul> <li>How to adjust the behavior of your Rails applications.</li> <li>How to add additional code to be run at application start time.</li> </ul>  <h2 class="chapter">Chapters</h2> <ol class="chapters"> <li><a href="#locations-for-initialization-code">Locations for Initialization Code</a></li> <li><a href="#running-code-before-rails">Running Code Before Rails</a></li> <li>
<a href="#configuring-rails-components">Configuring Rails Components</a> <ul> <li><a href="#versioned-default-values">Versioned Default Values</a></li> <li><a href="#rails-general-configuration">Rails General Configuration</a></li> <li><a href="#configuring-assets">Configuring Assets</a></li> <li><a href="#configuring-generators">Configuring Generators</a></li> <li><a href="#configuring-middleware">Configuring Middleware</a></li> <li><a href="#configuring-i18n">Configuring i18n</a></li> <li><a href="#configuring-active-model">Configuring Active Model</a></li> <li><a href="#configuring-active-record">Configuring Active Record</a></li> <li><a href="#configuring-action-controller">Configuring Action Controller</a></li> <li><a href="#configuring-action-dispatch">Configuring Action Dispatch</a></li> <li><a href="#configuring-action-view">Configuring Action View</a></li> <li><a href="#configuring-action-mailbox">Configuring Action Mailbox</a></li> <li><a href="#configuring-action-mailer">Configuring Action Mailer</a></li> <li><a href="#configuring-active-support">Configuring Active Support</a></li> <li><a href="#configuring-active-job">Configuring Active Job</a></li> <li><a href="#configuring-action-cable">Configuring Action Cable</a></li> <li><a href="#configuring-active-storage">Configuring Active Storage</a></li> <li><a href="#configuring-action-text">Configuring Action Text</a></li> <li><a href="#configuring-a-database">Configuring a Database</a></li> <li><a href="#connection-preference">Connection Preference</a></li> <li><a href="#creating-rails-environments">Creating Rails Environments</a></li> <li><a href="#deploy-to-a-subdirectory-relative-url-root">Deploy to a Subdirectory (relative URL root)</a></li> </ul>
</li> <li><a href="#rails-environment-settings">Rails Environment Settings</a></li> <li><a href="#using-initializer-files">Using Initializer Files</a></li> <li>
<a href="#initialization-events">Initialization Events</a> <ul> <li><a href="#rails-railtie-initializer"><code>Rails::Railtie#initializer</code></a></li> <li><a href="#initializers">Initializers</a></li> </ul>
</li> <li><a href="#database-pooling">Database Pooling</a></li> <li><a href="#custom-configuration">Custom Configuration</a></li> <li><a href="#search-engines-indexing">Search Engines Indexing</a></li> <li><a href="#evented-file-system-monitor">Evented File System Monitor</a></li> </ol>   <h1 id="locations-for-initialization-code"><a class="anchorlink" href="#locations-for-initialization-code">1 Locations for Initialization Code</a></h1>
<p>Rails offers four standard spots to place initialization code:</p> <ul> <li><code>config/application.rb</code></li> <li>Environment-specific configuration files</li> <li>Initializers</li> <li>After-initializers</li> </ul> <h1 id="running-code-before-rails"><a class="anchorlink" href="#running-code-before-rails">2 Running Code Before Rails</a></h1>
<p>In the rare event that your application needs to run some code before Rails itself is loaded, put it above the call to <code>require "rails/all"</code> in <code>config/application.rb</code>.</p>
<h1 id="configuring-rails-components"><a class="anchorlink" href="#configuring-rails-components">3 Configuring Rails Components</a></h1>
<p>In general, the work of configuring Rails means configuring the components of Rails, as well as configuring Rails itself. The configuration file <code>config/application.rb</code> and environment-specific configuration files (such as <code>config/environments/production.rb</code>) allow you to specify the various settings that you want to pass down to all of the components.</p>
<p>For example, you could add this setting to <code>config/application.rb</code> file:</p> <pre data-language="ruby">config.time_zone = 'Central Time (US &amp; Canada)'</pre> <button class="clipboard-button" data-clipboard-text="config.time_zone = 'Central Time (US &amp; Canada)'
">Copy</button>  <p>This is a setting for Rails itself. If you want to pass settings to individual Rails components, you can do so via the same <code>config</code> object in <code>config/application.rb</code>:</p> <pre data-language="ruby">config.active_record.schema_format = :ruby</pre> <button class="clipboard-button" data-clipboard-text="config.active_record.schema_format = :ruby
">Copy</button>  <p>Rails will use that particular setting to configure Active Record.</p>
<div class="warning"><p>Use the public configuration methods over calling directly to the associated class. e.g. <code>Rails.application.config.action_mailer.options</code> instead of <code>ActionMailer::Base.options</code>.</p></div>
<div class="note"><p>If you need to apply configuration directly to a class, use a <a href="https://edgeapi.rubyonrails.org/classes/ActiveSupport/LazyLoadHooks.html">lazy load hook</a> in an initializer to avoid autoloading the class before initialization has completed. This will break because autoloading during initialization cannot be safely repeated when the app reloads.</p></div>
<h2 id="versioned-default-values"><a class="anchorlink" href="#versioned-default-values">3.1 Versioned Default Values</a></h2>
<p><a href="https://edgeapi.rubyonrails.org/classes/Rails/Application/Configuration.html#method-i-load_defaults"><code>config.load_defaults</code></a> loads default configuration values for a target version and all versions prior. For example, <code>config.load_defaults 6.1</code> will load defaults for all versions up to and including version 6.1.</p>
<p>Below are the default values associated with each target version. In cases of conflicting values, newer versions take precedence over older versions.</p>
<h3 id="default-values-for-target-version-7-1"><a class="anchorlink" href="#default-values-for-target-version-7-1">3.1.1 Default Values for Target Version 7.1</a></h3> <ul> <li>
<a href="#config-action-controller-allow-deprecated-parameters-hash-equality"><code>config.action_controller.allow_deprecated_parameters_hash_equality</code></a>: <code>false</code>
</li> <li>
<a href="#config-action-dispatch-debug-exception-log-level"><code>config.action_dispatch.debug_exception_log_level</code></a>: <code>:error</code>
</li> <li>
<a href="#config-action-dispatch-default-headers"><code>config.action_dispatch.default_headers</code></a>: <code>{ "X-Frame-Options" =&gt; "SAMEORIGIN", "X-XSS-Protection" =&gt; "0", "X-Content-Type-Options" =&gt; "nosniff", "X-Permitted-Cross-Domain-Policies" =&gt; "none", "Referrer-Policy" =&gt; "strict-origin-when-cross-origin" }</code>
</li> <li>
<a href="#config-action-text-sanitizer-vendor"><code>config.action_text.sanitizer_vendor</code></a>: <code>Rails::HTML::Sanitizer.best_supported_vendor</code>
</li> <li>
<a href="#config-action-view-sanitizer-vendor"><code>config.action_view.sanitizer_vendor</code></a>: <code>Rails::HTML::Sanitizer.best_supported_vendor</code>
</li> <li>
<a href="#config-active-job-use-big-decimal-serializer"><code>config.active_job.use_big_decimal_serializer</code></a>: <code>true</code>
</li> <li>
<a href="#config-active-record-allow-deprecated-singular-associations-name"><code>config.active_record.allow_deprecated_singular_associations_name</code></a>: <code>false</code>
</li> <li>
<a href="#config-active-record-before-committed-on-all-records"><code>config.active_record.before_committed_on_all_records</code></a>: <code>true</code>
</li> <li>
<a href="#config-active-record-belongs-to-required-validates-foreign-key"><code>config.active_record.belongs_to_required_validates_foreign_key</code></a>: <code>false</code>
</li> <li>
<a href="#config-active-record-commit-transaction-on-non-local-return"><code>config.active_record.commit_transaction_on_non_local_return</code></a>: <code>true</code>
</li> <li>
<a href="#config-active-record-default-column-serializer"><code>config.active_record.default_column_serializer</code></a>: <code>nil</code>
</li> <li>
<a href="#config-active-record-encryption-hash-digest-class"><code>config.active_record.encryption.hash_digest_class</code></a>: <code>OpenSSL::Digest::SHA256</code>
</li> <li>
<a href="#config-active-record-encryption-support-sha1-for-non-deterministic-encryption"><code>config.active_record.encryption.support_sha1_for_non_deterministic_encryption</code></a>: <code>false</code>
</li> <li>
<a href="#config-active-record-generate-secure-token-on"><code>config.active_record.generate_secure_token_on</code></a>: <code>:initialize</code>
</li> <li>
<a href="#config-active-record-marshalling-format-version"><code>config.active_record.marshalling_format_version</code></a>: <code>7.1</code>
</li> <li>
<a href="#config-active-record-query-log-tags-format"><code>config.active_record.query_log_tags_format</code></a>: <code>:sqlcommenter</code>
</li> <li>
<a href="#config-active-record-raise-on-assign-to-attr-readonly"><code>config.active_record.raise_on_assign_to_attr_readonly</code></a>: <code>true</code>
</li> <li>
<a href="#config-active-record-run-after-transaction-callbacks-in-order-defined"><code>config.active_record.run_after_transaction_callbacks_in_order_defined</code></a>: <code>true</code>
</li> <li>
<a href="#config-active-record-run-commit-callbacks-on-first-saved-instances-in-transaction"><code>config.active_record.run_commit_callbacks_on_first_saved_instances_in_transaction</code></a>: <code>false</code>
</li> <li>
<a href="#config-active-record-sqlite3-adapter-strict-strings-by-default"><code>config.active_record.sqlite3_adapter_strict_strings_by_default</code></a>: <code>true</code>
</li> <li>
<a href="#config-active-support-cache-format-version"><code>config.active_support.cache_format_version</code></a>: <code>7.1</code>
</li> <li>
<a href="#config-active-support-message-serializer"><code>config.active_support.message_serializer</code></a>: <code>:json_allow_marshal</code>
</li> <li>
<a href="#config-active-support-raise-on-invalid-cache-expiration-time"><code>config.active_support.raise_on_invalid_cache_expiration_time</code></a>: <code>true</code>
</li> <li>
<a href="#config-active-support-use-message-serializer-for-metadata"><code>config.active_support.use_message_serializer_for_metadata</code></a>: <code>true</code>
</li> <li>
<a href="#config-add-autoload-paths-to-load-path"><code>config.add_autoload_paths_to_load_path</code></a>: <code>false</code>
</li> <li>
<a href="#config-dom-testing-default-html-version"><code>config.dom_testing_default_html_version</code></a>: <code>defined?(Nokogiri::HTML5) ? :html5 : :html4</code>
</li> <li>
<a href="#config-log-file-size"><code>config.log_file_size</code></a>: <code>100 * 1024 * 1024</code>
</li> <li>
<a href="#config-precompile-filter-parameters"><code>config.precompile_filter_parameters</code></a>: <code>true</code>
</li> </ul> <h3 id="default-values-for-target-version-7-0"><a class="anchorlink" href="#default-values-for-target-version-7-0">3.1.2 Default Values for Target Version 7.0</a></h3> <ul> <li>
<a href="#config-action-controller-raise-on-open-redirects"><code>config.action_controller.raise_on_open_redirects</code></a>: <code>true</code>
</li> <li>
<a href="#config-action-controller-wrap-parameters-by-default"><code>config.action_controller.wrap_parameters_by_default</code></a>: <code>true</code>
</li> <li>
<a href="#config-action-dispatch-cookies-serializer"><code>config.action_dispatch.cookies_serializer</code></a>: <code>:json</code>
</li> <li>
<a href="#config-action-dispatch-default-headers"><code>config.action_dispatch.default_headers</code></a>: <code>{ "X-Frame-Options" =&gt; "SAMEORIGIN", "X-XSS-Protection" =&gt; "0", "X-Content-Type-Options" =&gt; "nosniff", "X-Download-Options" =&gt; "noopen", "X-Permitted-Cross-Domain-Policies" =&gt; "none", "Referrer-Policy" =&gt; "strict-origin-when-cross-origin" }</code>
</li> <li>
<a href="#config-action-mailer-smtp-timeout"><code>config.action_mailer.smtp_timeout</code></a>: <code>5</code>
</li> <li>
<a href="#config-action-view-apply-stylesheet-media-default"><code>config.action_view.apply_stylesheet_media_default</code></a>: <code>false</code>
</li> <li>
<a href="#config-action-view-button-to-generates-button-tag"><code>config.action_view.button_to_generates_button_tag</code></a>: <code>true</code>
</li> <li>
<a href="#config-active-record-automatic-scope-inversing"><code>config.active_record.automatic_scope_inversing</code></a>: <code>true</code>
</li> <li>
<a href="#config-active-record-partial-inserts"><code>config.active_record.partial_inserts</code></a>: <code>false</code>
</li> <li>
<a href="#config-active-record-verify-foreign-keys-for-fixtures"><code>config.active_record.verify_foreign_keys_for_fixtures</code></a>: <code>true</code>
</li> <li>
<a href="#config-active-storage-multiple-file-field-include-hidden"><code>config.active_storage.multiple_file_field_include_hidden</code></a>: <code>true</code>
</li> <li>
<a href="#config-active-storage-variant-processor"><code>config.active_storage.variant_processor</code></a>: <code>:vips</code>
</li> <li>
<a href="#config-active-storage-video-preview-arguments"><code>config.active_storage.video_preview_arguments</code></a>: <code>"-vf 'select=eq(n\\,0)+eq(key\\,1)+gt(scene\\,0.015),loop=loop=-1:size=2,trim=start_frame=1' -frames:v 1 -f image2"</code>
</li> <li>
<a href="#config-active-support-cache-format-version"><code>config.active_support.cache_format_version</code></a>: <code>7.0</code>
</li> <li>
<a href="#config-active-support-executor-around-test-case"><code>config.active_support.executor_around_test_case</code></a>: <code>true</code>
</li> <li>
<a href="#config-active-support-hash-digest-class"><code>config.active_support.hash_digest_class</code></a>: <code>OpenSSL::Digest::SHA256</code>
</li> <li>
<a href="#config-active-support-key-generator-hash-digest-class"><code>config.active_support.key_generator_hash_digest_class</code></a>: <code>OpenSSL::Digest::SHA256</code>
</li> </ul> <h3 id="default-values-for-target-version-6-1"><a class="anchorlink" href="#default-values-for-target-version-6-1">3.1.3 Default Values for Target Version 6.1</a></h3> <ul> <li>
<a href="#activesupport-utc-to-local-returns-utc-offset-times"><code>ActiveSupport.utc_to_local_returns_utc_offset_times</code></a>: <code>true</code>
</li> <li>
<a href="#config-action-dispatch-cookies-same-site-protection"><code>config.action_dispatch.cookies_same_site_protection</code></a>: <code>:lax</code>
</li> <li>
<a href="#config-action-dispatch-ssl-default-redirect-status"><code>config.action_dispatch.ssl_default_redirect_status</code></a>: <code>308</code>
</li> <li>
<a href="#config-action-mailbox-queues-incineration"><code>config.action_mailbox.queues.incineration</code></a>: <code>nil</code>
</li> <li>
<a href="#config-action-mailbox-queues-routing"><code>config.action_mailbox.queues.routing</code></a>: <code>nil</code>
</li> <li>
<a href="#config-action-mailer-deliver-later-queue-name"><code>config.action_mailer.deliver_later_queue_name</code></a>: <code>nil</code>
</li> <li>
<a href="#config-action-view-form-with-generates-remote-forms"><code>config.action_view.form_with_generates_remote_forms</code></a>: <code>false</code>
</li> <li>
<a href="#config-action-view-preload-links-header"><code>config.action_view.preload_links_header</code></a>: <code>true</code>
</li> <li>
<a href="#config-active-job-retry-jitter"><code>config.active_job.retry_jitter</code></a>: <code>0.15</code>
</li> <li>
<a href="#config-active-record-has-many-inversing"><code>config.active_record.has_many_inversing</code></a>: <code>true</code>
</li> <li>
<a href="#config-active-storage-queues-analysis"><code>config.active_storage.queues.analysis</code></a>: <code>nil</code>
</li> <li>
<a href="#config-active-storage-queues-purge"><code>config.active_storage.queues.purge</code></a>: <code>nil</code>
</li> <li>
<a href="#config-active-storage-track-variants"><code>config.active_storage.track_variants</code></a>: <code>true</code>
</li> </ul> <h3 id="default-values-for-target-version-6-0"><a class="anchorlink" href="#default-values-for-target-version-6-0">3.1.4 Default Values for Target Version 6.0</a></h3> <ul> <li>
<a href="#config-action-dispatch-use-cookies-with-metadata"><code>config.action_dispatch.use_cookies_with_metadata</code></a>: <code>true</code>
</li> <li>
<a href="#config-action-mailer-delivery-job"><code>config.action_mailer.delivery_job</code></a>: <code>"ActionMailer::MailDeliveryJob"</code>
</li> <li>
<a href="#config-action-view-default-enforce-utf8"><code>config.action_view.default_enforce_utf8</code></a>: <code>false</code>
</li> <li>
<a href="#config-active-record-collection-cache-versioning"><code>config.active_record.collection_cache_versioning</code></a>: <code>true</code>
</li> <li>
<a href="#config-active-storage-queues-analysis"><code>config.active_storage.queues.analysis</code></a>: <code>:active_storage_analysis</code>
</li> <li>
<a href="#config-active-storage-queues-purge"><code>config.active_storage.queues.purge</code></a>: <code>:active_storage_purge</code>
</li> </ul> <h3 id="default-values-for-target-version-5-2"><a class="anchorlink" href="#default-values-for-target-version-5-2">3.1.5 Default Values for Target Version 5.2</a></h3> <ul> <li>
<a href="#config-action-controller-default-protect-from-forgery"><code>config.action_controller.default_protect_from_forgery</code></a>: <code>true</code>
</li> <li>
<a href="#config-action-dispatch-use-authenticated-cookie-encryption"><code>config.action_dispatch.use_authenticated_cookie_encryption</code></a>: <code>true</code>
</li> <li>
<a href="#config-action-view-form-with-generates-ids"><code>config.action_view.form_with_generates_ids</code></a>: <code>true</code>
</li> <li>
<a href="#config-active-record-cache-versioning"><code>config.active_record.cache_versioning</code></a>: <code>true</code>
</li> <li>
<a href="#config-active-support-hash-digest-class"><code>config.active_support.hash_digest_class</code></a>: <code>OpenSSL::Digest::SHA1</code>
</li> <li>
<a href="#config-active-support-use-authenticated-message-encryption"><code>config.active_support.use_authenticated_message_encryption</code></a>: <code>true</code>
</li> </ul> <h3 id="default-values-for-target-version-5-1"><a class="anchorlink" href="#default-values-for-target-version-5-1">3.1.6 Default Values for Target Version 5.1</a></h3> <ul> <li>
<a href="#config-action-view-form-with-generates-remote-forms"><code>config.action_view.form_with_generates_remote_forms</code></a>: <code>true</code>
</li> <li>
<a href="#config-assets-unknown-asset-fallback"><code>config.assets.unknown_asset_fallback</code></a>: <code>false</code>
</li> </ul> <h3 id="default-values-for-target-version-5-0"><a class="anchorlink" href="#default-values-for-target-version-5-0">3.1.7 Default Values for Target Version 5.0</a></h3> <ul> <li>
<a href="#activesupport-to-time-preserves-timezone"><code>ActiveSupport.to_time_preserves_timezone</code></a>: <code>true</code>
</li> <li>
<a href="#config-action-controller-forgery-protection-origin-check"><code>config.action_controller.forgery_protection_origin_check</code></a>: <code>true</code>
</li> <li>
<a href="#config-action-controller-per-form-csrf-tokens"><code>config.action_controller.per_form_csrf_tokens</code></a>: <code>true</code>
</li> <li>
<a href="#config-active-record-belongs-to-required-by-default"><code>config.active_record.belongs_to_required_by_default</code></a>: <code>true</code>
</li> <li>
<a href="#config-ssl-options"><code>config.ssl_options</code></a>: <code>{ hsts: { subdomains: true } }</code>
</li> </ul> <h2 id="rails-general-configuration"><a class="anchorlink" href="#rails-general-configuration">3.2 Rails General Configuration</a></h2>
<p>The following configuration methods are to be called on a <code>Rails::Railtie</code> object, such as a subclass of <code>Rails::Engine</code> or <code>Rails::Application</code>.</p>
<h3 id="config-add-autoload-paths-to-load-path"><a class="anchorlink" href="#config-add-autoload-paths-to-load-path">3.2.1 <code>config.add_autoload_paths_to_load_path</code></a></h3>
<p>Says whether autoload paths have to be added to <code>$LOAD_PATH</code>. It is recommended to be set to <code>false</code> in <code>:zeitwerk</code> mode early, in <code>config/application.rb</code>. Zeitwerk uses absolute paths internally, and applications running in <code>:zeitwerk</code> mode do not need <code>require_dependency</code>, so models, controllers, jobs, etc. do not need to be in <code>$LOAD_PATH</code>. Setting this to <code>false</code> saves Ruby from checking these directories when resolving <code>require</code> calls with relative paths, and saves Bootsnap work and RAM, since it does not need to build an index for them.</p>
<p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>true</code></td> </tr> <tr> <td>7.1</td> <td><code>false</code></td> </tr> </tbody>
</table> <p>The <code>lib</code> directory is not affected by this flag, it is added to <code>$LOAD_PATH</code> always.</p>
<h3 id="config-after-initialize"><a class="anchorlink" href="#config-after-initialize">3.2.2 <code>config.after_initialize</code></a></h3>
<p>Takes a block which will be run <em>after</em> Rails has finished initializing the application. That includes the initialization of the framework itself, engines, and all the application's initializers in <code>config/initializers</code>. Note that this block <em>will</em> be run for rake tasks. Useful for configuring values set up by other initializers:</p> <pre data-language="ruby">config.after_initialize do
  ActionView::Base.sanitized_allowed_tags.delete 'div'
end</pre> <button class="clipboard-button" data-clipboard-text="config.after_initialize do
  ActionView::Base.sanitized_allowed_tags.delete 'div'
end
">Copy</button>  <h3 id="config-after-routes-loaded"><a class="anchorlink" href="#config-after-routes-loaded">3.2.3 <code>config.after_routes_loaded</code></a></h3>
<p>Takes a block which will be run after Rails has finished loading the application routes. This block will also be run whenever routes are reloaded.</p> <pre data-language="ruby">config.after_routes_loaded do
  # Code that does something with Rails.application.routes
end</pre> <button class="clipboard-button" data-clipboard-text="config.after_routes_loaded do
  # Code that does something with Rails.application.routes
end
">Copy</button>  <h3 id="config-allow-concurrency"><a class="anchorlink" href="#config-allow-concurrency">3.2.4 <code>config.allow_concurrency</code></a></h3>
<p>Controls whether requests should be handled concurrently. This should only be set to <code>false</code> if application code is not thread safe. Defaults to <code>true</code>.</p>
<h3 id="config-asset-host"><a class="anchorlink" href="#config-asset-host">3.2.5 <code>config.asset_host</code></a></h3>
<p>Sets the host for the assets. Useful when CDNs are used for hosting assets, or when you want to work around the concurrency constraints built-in in browsers using different domain aliases. Shorter version of <code>config.action_controller.asset_host</code>.</p>
<h3 id="config-assume-ssl"><a class="anchorlink" href="#config-assume-ssl">3.2.6 <code>config.assume_ssl</code></a></h3>
<p>Makes application believe that all requests are arriving over SSL. This is useful when proxying through a load balancer that terminates SSL, the forwarded request will appear as though its HTTP instead of HTTPS to the application. This makes redirects and cookie security target HTTP instead of HTTPS. This middleware makes the server assume that the proxy already terminated SSL, and that the request really is HTTPS.</p>
<h3 id="config-autoflush-log"><a class="anchorlink" href="#config-autoflush-log">3.2.7 <code>config.autoflush_log</code></a></h3>
<p>Enables writing log file output immediately instead of buffering. Defaults to <code>true</code>.</p>
<h3 id="config-autoload-once-paths"><a class="anchorlink" href="#config-autoload-once-paths">3.2.8 <code>config.autoload_once_paths</code></a></h3>
<p>Accepts an array of paths from which Rails will autoload constants that won't be wiped per request. Relevant if reloading is enabled, which it is by default in the <code>development</code> environment. Otherwise, all autoloading happens only once. All elements of this array must also be in <code>autoload_paths</code>. Default is an empty array.</p>
<h3 id="config-autoload-paths"><a class="anchorlink" href="#config-autoload-paths">3.2.9 <code>config.autoload_paths</code></a></h3>
<p>Accepts an array of paths from which Rails will autoload constants. Default is an empty array. Since <a href="upgrading_ruby_on_rails.html#autoloading">Rails 6</a>, it is not recommended to adjust this. See <a href="autoloading_and_reloading_constants.html#autoload-paths">Autoloading and Reloading Constants</a>.</p>
<h3 id="config-autoload-lib-ignore"><a class="anchorlink" href="#config-autoload-lib-ignore">3.2.10 <code>config.autoload_lib(ignore:)</code></a></h3>
<p>This method adds <code>lib</code> to <code>config.autoload_paths</code> and <code>config.eager_load_paths</code>.</p>
<p>Normally, the <code>lib</code> directory has subdirectories that should not be autoloaded or eager loaded. Please, pass their name relative to <code>lib</code> in the required <code>ignore</code> keyword argument. For example,</p> <pre data-language="ruby">config.autoload_lib(ignore: %w(assets tasks generators))</pre> <button class="clipboard-button" data-clipboard-text="config.autoload_lib(ignore: %w(assets tasks generators))
">Copy</button>  <p>Please, see more details in the <a href="autoloading_and_reloading_constants.html">autoloading guide</a>.</p>
<h3 id="config-autoload-lib-once-ignore"><a class="anchorlink" href="#config-autoload-lib-once-ignore">3.2.11 <code>config.autoload_lib_once(ignore:)</code></a></h3>
<p>The method <code>config.autoload_lib_once</code> is similar to <code>config.autoload_lib</code>, except that it adds <code>lib</code> to <code>config.autoload_once_paths</code> instead.</p>
<p>By calling <code>config.autoload_lib_once</code>, classes and modules in <code>lib</code> can be autoloaded, even from application initializers, but won't be reloaded.</p>
<h3 id="config-beginning-of-week"><a class="anchorlink" href="#config-beginning-of-week">3.2.12 <code>config.beginning_of_week</code></a></h3>
<p>Sets the default beginning of week for the application. Accepts a valid day of week as a symbol (e.g. <code>:monday</code>).</p>
<h3 id="config-cache-classes"><a class="anchorlink" href="#config-cache-classes">3.2.13 <code>config.cache_classes</code></a></h3>
<p>Old setting equivalent to <code>!config.enable_reloading</code>. Supported for backwards compatibility.</p>
<h3 id="config-cache-store"><a class="anchorlink" href="#config-cache-store">3.2.14 <code>config.cache_store</code></a></h3>
<p>Configures which cache store to use for Rails caching. Options include one of the symbols <code>:memory_store</code>, <code>:file_store</code>, <code>:mem_cache_store</code>, <code>:null_store</code>, <code>:redis_cache_store</code>, or an object that implements the cache API. Defaults to <code>:file_store</code>. See <a href="caching_with_rails.html#cache-stores">Cache Stores</a> for per-store configuration options.</p>
<h3 id="config-colorize-logging"><a class="anchorlink" href="#config-colorize-logging">3.2.15 <code>config.colorize_logging</code></a></h3>
<p>Specifies whether or not to use ANSI color codes when logging information. Defaults to <code>true</code>.</p>
<h3 id="config-consider-all-requests-local"><a class="anchorlink" href="#config-consider-all-requests-local">3.2.16 <code>config.consider_all_requests_local</code></a></h3>
<p>Is a flag. If <code>true</code> then any error will cause detailed debugging information to be dumped in the HTTP response, and the <code>Rails::Info</code> controller will show the application runtime context in <code>/rails/info/properties</code>. <code>true</code> by default in the development and test environments, and <code>false</code> in production. For finer-grained control, set this to <code>false</code> and implement <code>show_detailed_exceptions?</code> in controllers to specify which requests should provide debugging information on errors.</p>
<h3 id="config-console"><a class="anchorlink" href="#config-console">3.2.17 <code>config.console</code></a></h3>
<p>Allows you to set the class that will be used as console when you run <code>bin/rails console</code>. It's best to run it in the <code>console</code> block:</p> <pre data-language="ruby">console do
  # this block is called only when running console,
  # so we can safely require pry here
  require "pry"
  config.console = Pry
end</pre> <button class="clipboard-button" data-clipboard-text='console do
  # this block is called only when running console,
  # so we can safely require pry here
  require "pry"
  config.console = Pry
end
'>Copy</button>  <h3 id="config-content-security-policy-nonce-directives"><a class="anchorlink" href="#config-content-security-policy-nonce-directives">3.2.18 <code>config.content_security_policy_nonce_directives</code></a></h3>
<p>See <a href="security.html#adding-a-nonce">Adding a Nonce</a> in the Security Guide</p>
<h3 id="config-content-security-policy-nonce-generator"><a class="anchorlink" href="#config-content-security-policy-nonce-generator">3.2.19 <code>config.content_security_policy_nonce_generator</code></a></h3>
<p>See <a href="security.html#adding-a-nonce">Adding a Nonce</a> in the Security Guide</p>
<h3 id="config-content-security-policy-report-only"><a class="anchorlink" href="#config-content-security-policy-report-only">3.2.20 <code>config.content_security_policy_report_only</code></a></h3>
<p>See <a href="security.html#reporting-violations">Reporting Violations</a> in the Security Guide</p>
<h3 id="config-credentials-content-path"><a class="anchorlink" href="#config-credentials-content-path">3.2.21 <code>config.credentials.content_path</code></a></h3>
<p>The path of the encrypted credentials file.</p>
<p>Defaults to <code>config/credentials/#{Rails.env}.yml.enc</code> if it exists, or <code>config/credentials.yml.enc</code> otherwise.</p>
<div class="note"><p>In order for the <code>bin/rails credentials</code> commands to recognize this value, it must be set in <code>config/application.rb</code> or <code>config/environments/#{Rails.env}.rb</code>.</p></div>
<h3 id="config-credentials-key-path"><a class="anchorlink" href="#config-credentials-key-path">3.2.22 <code>config.credentials.key_path</code></a></h3>
<p>The path of the encrypted credentials key file.</p>
<p>Defaults to <code>config/credentials/#{Rails.env}.key</code> if it exists, or <code>config/master.key</code> otherwise.</p>
<div class="note"><p>In order for the <code>bin/rails credentials</code> commands to recognize this value, it must be set in <code>config/application.rb</code> or <code>config/environments/#{Rails.env}.rb</code>.</p></div>
<h3 id="config-debug-exception-response-format"><a class="anchorlink" href="#config-debug-exception-response-format">3.2.23 <code>config.debug_exception_response_format</code></a></h3>
<p>Sets the format used in responses when errors occur in the development environment. Defaults to <code>:api</code> for API only apps and <code>:default</code> for normal apps.</p>
<h3 id="config-disable-sandbox"><a class="anchorlink" href="#config-disable-sandbox">3.2.24 <code>config.disable_sandbox</code></a></h3>
<p>Controls whether or not someone can start a console in sandbox mode. This is helpful to avoid a long running session of sandbox console, that could lead a database server to run out of memory. Defaults to <code>false</code>.</p>
<h3 id="config-sandbox-by-default"><a class="anchorlink" href="#config-sandbox-by-default">3.2.25 <code>config.sandbox_by_default</code></a></h3>
<p>When <code>true</code>, rails console starts in sandbox mode. To start rails console in non-sandbox mode, <code>--no-sandbox</code> must be specified. This is helpful to avoid accidental writing to the production database. Defaults to <code>false</code>.</p>
<h3 id="config-dom-testing-default-html-version"><a class="anchorlink" href="#config-dom-testing-default-html-version">3.2.26 <code>config.dom_testing_default_html_version</code></a></h3>
<p>Controls whether an HTML4 parser or an HTML5 parser is used by default by the test helpers in Action View, Action Dispatch, and <code>rails-dom-testing</code>.</p>
<p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>:html4</code></td> </tr> <tr> <td>7.1</td> <td>
<code>:html5</code> (see NOTE)</td> </tr> </tbody>
</table> <div class="note"><p>Nokogiri's HTML5 parser is not supported on JRuby, so on JRuby platforms Rails will fall back to <code>:html4</code>.</p></div>
<h3 id="config-eager-load"><a class="anchorlink" href="#config-eager-load">3.2.27 <code>config.eager_load</code></a></h3>
<p>When <code>true</code>, eager loads all registered <code>config.eager_load_namespaces</code>. This includes your application, engines, Rails frameworks, and any other registered namespace.</p>
<h3 id="config-eager-load-namespaces"><a class="anchorlink" href="#config-eager-load-namespaces">3.2.28 <code>config.eager_load_namespaces</code></a></h3>
<p>Registers namespaces that are eager loaded when <code>config.eager_load</code> is set to <code>true</code>. All namespaces in the list must respond to the <code>eager_load!</code> method.</p>
<h3 id="config-eager-load-paths"><a class="anchorlink" href="#config-eager-load-paths">3.2.29 <code>config.eager_load_paths</code></a></h3>
<p>Accepts an array of paths from which Rails will eager load on boot if <code>config.eager_load</code> is true. Defaults to every folder in the <code>app</code> directory of the application.</p>
<h3 id="config-enable-reloading"><a class="anchorlink" href="#config-enable-reloading">3.2.30 <code>config.enable_reloading</code></a></h3>
<p>If <code>config.enable_reloading</code> is true, application classes and modules are reloaded in between web requests if they change. Defaults to <code>true</code> in the <code>development</code> environment, and <code>false</code> in the <code>production</code> environment.</p>
<p>The predicate <code>config.reloading_enabled?</code> is also defined.</p>
<h3 id="config-encoding"><a class="anchorlink" href="#config-encoding">3.2.31 <code>config.encoding</code></a></h3>
<p>Sets up the application-wide encoding. Defaults to UTF-8.</p>
<h3 id="config-exceptions-app"><a class="anchorlink" href="#config-exceptions-app">3.2.32 <code>config.exceptions_app</code></a></h3>
<p>Sets the exceptions application invoked by the <code>ShowException</code> middleware when an exception happens. Defaults to <code>ActionDispatch::PublicExceptions.new(Rails.public_path)</code>.</p>
<p>Exceptions applications need to handle <code>ActionDispatch::Http::MimeNegotiation::InvalidType</code> errors, which are raised when a client sends an invalid <code>Accept</code> or <code>Content-Type</code> header. The default <code>ActionDispatch::PublicExceptions</code> application does this automatically, setting <code>Content-Type</code> to <code>text/html</code> and returning a <code>406 Not Acceptable</code> status. Failure to handle this error will result in a <code>500 Internal Server Error</code>.</p>
<p>Using the <code>Rails.application.routes</code> <code>RouteSet</code> as the exceptions application also requires this special handling. It might look something like this:</p> <pre data-language="ruby"># config/application.rb
config.exceptions_app = CustomExceptionsAppWrapper.new(exceptions_app: routes)

# lib/custom_exceptions_app_wrapper.rb
class CustomExceptionsAppWrapper
  def initialize(exceptions_app:)
    @exceptions_app = exceptions_app
  end

  def call(env)
    request = ActionDispatch::Request.new(env)

    fallback_to_html_format_if_invalid_mime_type(request)

    @exceptions_app.call(env)
  end

  private
    def fallback_to_html_format_if_invalid_mime_type(request)
      request.formats
    rescue ActionDispatch::Http::MimeNegotiation::InvalidType
      request.set_header "CONTENT_TYPE", "text/html"
    end
end</pre> <button class="clipboard-button" data-clipboard-text='# config/application.rb
config.exceptions_app = CustomExceptionsAppWrapper.new(exceptions_app: routes)

# lib/custom_exceptions_app_wrapper.rb
class CustomExceptionsAppWrapper
  def initialize(exceptions_app:)
    @exceptions_app = exceptions_app
  end

  def call(env)
    request = ActionDispatch::Request.new(env)

    fallback_to_html_format_if_invalid_mime_type(request)

    @exceptions_app.call(env)
  end

  private
    def fallback_to_html_format_if_invalid_mime_type(request)
      request.formats
    rescue ActionDispatch::Http::MimeNegotiation::InvalidType
      request.set_header "CONTENT_TYPE", "text/html"
    end
end
'>Copy</button>  <h3 id="config-file-watcher"><a class="anchorlink" href="#config-file-watcher">3.2.33 <code>config.file_watcher</code></a></h3>
<p>Is the class used to detect file updates in the file system when <code>config.reload_classes_only_on_change</code> is <code>true</code>. Rails ships with <code>ActiveSupport::FileUpdateChecker</code>, the default, and <code>ActiveSupport::EventedFileUpdateChecker</code> (this one depends on the <a href="https://github.com/guard/listen">listen</a> gem). Custom classes must conform to the <code>ActiveSupport::FileUpdateChecker</code> API.</p>
<h3 id="config-filter-parameters"><a class="anchorlink" href="#config-filter-parameters">3.2.34 <code>config.filter_parameters</code></a></h3>
<p>Used for filtering out the parameters that you don't want shown in the logs, such as passwords or credit card numbers. It also filters out sensitive values of database columns when calling <code>#inspect</code> on an Active Record object. By default, Rails filters out passwords by adding the following filters in <code>config/initializers/filter_parameter_logging.rb</code>.</p> <pre data-language="ruby">Rails.application.config.filter_parameters += [
  :passw, :secret, :token, :_key, :crypt, :salt, :certificate, :otp, :ssn
]</pre> <button class="clipboard-button" data-clipboard-text="Rails.application.config.filter_parameters += [
  :passw, :secret, :token, :_key, :crypt, :salt, :certificate, :otp, :ssn
]
">Copy</button>  <p>Parameters filter works by partial matching regular expression.</p>
<h3 id="config-filter-redirect"><a class="anchorlink" href="#config-filter-redirect">3.2.35 <code>config.filter_redirect</code></a></h3>
<p>Used for filtering out redirect urls from application logs.</p> <pre data-language="ruby">Rails.application.config.filter_redirect += ['s3.amazonaws.com', /private-match/]</pre> <button class="clipboard-button" data-clipboard-text="Rails.application.config.filter_redirect += ['s3.amazonaws.com', /private-match/]
">Copy</button>  <p>The redirect filter works by testing that urls include strings or match regular expressions.</p>
<h3 id="config-force-ssl"><a class="anchorlink" href="#config-force-ssl">3.2.36 <code>config.force_ssl</code></a></h3>
<p>Forces all requests to be served over HTTPS, and sets "https://" as the default protocol when generating URLs. Enforcement of HTTPS is handled by the <code>ActionDispatch::SSL</code> middleware, which can be configured via <code>config.ssl_options</code>.</p>
<h3 id="config-helpers-paths"><a class="anchorlink" href="#config-helpers-paths">3.2.37 <code>config.helpers_paths</code></a></h3>
<p>Defines an array of additional paths to load view helpers.</p>
<h3 id="config-host-authorization"><a class="anchorlink" href="#config-host-authorization">3.2.38 <code>config.host_authorization</code></a></h3>
<p>Accepts a hash of options to configure the <a href="#actiondispatch-hostauthorization">HostAuthorization middleware</a></p>
<h3 id="config-hosts"><a class="anchorlink" href="#config-hosts">3.2.39 <code>config.hosts</code></a></h3>
<p>An array of strings, regular expressions, or <code>IPAddr</code> used to validate the <code>Host</code> header. Used by the <a href="#actiondispatch-hostauthorization">HostAuthorization middleware</a> to help prevent DNS rebinding attacks.</p>
<h3 id="config-javascript-path"><a class="anchorlink" href="#config-javascript-path">3.2.40 <code>config.javascript_path</code></a></h3>
<p>Sets the path where your app's JavaScript lives relative to the <code>app</code> directory and the default value is <code>javascript</code>. An app's configured <code>javascript_path</code> will be excluded from <code>autoload_paths</code>.</p>
<h3 id="config-log-file-size"><a class="anchorlink" href="#config-log-file-size">3.2.41 <code>config.log_file_size</code></a></h3>
<p>Defines the maximum size of the Rails log file in bytes. Defaults to <code>104_857_600</code> (100 MiB) in development and test, and unlimited in all other environments.</p>
<h3 id="config-log-formatter"><a class="anchorlink" href="#config-log-formatter">3.2.42 <code>config.log_formatter</code></a></h3>
<p>Defines the formatter of the Rails logger. This option defaults to an instance of <code>ActiveSupport::Logger::SimpleFormatter</code> for all environments. If you are setting a value for <code>config.logger</code> you must manually pass the value of your formatter to your logger before it is wrapped in an <code>ActiveSupport::TaggedLogging</code> instance, Rails will not do it for you.</p>
<h3 id="config-log-level"><a class="anchorlink" href="#config-log-level">3.2.43 <code>config.log_level</code></a></h3>
<p>Defines the verbosity of the Rails logger. This option defaults to <code>:debug</code> for all environments except production, where it defaults to <code>:info</code>. The available log levels are: <code>:debug</code>, <code>:info</code>, <code>:warn</code>, <code>:error</code>, <code>:fatal</code>, and <code>:unknown</code>.</p>
<h3 id="config-log-tags"><a class="anchorlink" href="#config-log-tags">3.2.44 <code>config.log_tags</code></a></h3>
<p>Accepts a list of methods that the <code>request</code> object responds to, a <code>Proc</code> that accepts the <code>request</code> object, or something that responds to <code>to_s</code>. This makes it easy to tag log lines with debug information like subdomain and request id - both very helpful in debugging multi-user production applications.</p>
<h3 id="config-logger"><a class="anchorlink" href="#config-logger">3.2.45 <code>config.logger</code></a></h3>
<p>Is the logger that will be used for <code>Rails.logger</code> and any related Rails logging such as <code>ActiveRecord::Base.logger</code>. It defaults to an instance of <code>ActiveSupport::TaggedLogging</code> that wraps an instance of <code>ActiveSupport::Logger</code> which outputs a log to the <code>log/</code> directory. You can supply a custom logger, to get full compatibility you must follow these guidelines:</p> <ul> <li>To support a formatter, you must manually assign a formatter from the <code>config.log_formatter</code> value to the logger.</li> <li>To support tagged logs, the log instance must be wrapped with <code>ActiveSupport::TaggedLogging</code>.</li> <li>To support silencing, the logger must include <code>ActiveSupport::LoggerSilence</code> module. The <code>ActiveSupport::Logger</code> class already includes these modules.</li> </ul>  <pre data-language="ruby">class MyLogger &lt; ::Logger
  include ActiveSupport::LoggerSilence
end

mylogger           = MyLogger.new(STDOUT)
mylogger.formatter = config.log_formatter
config.logger      = ActiveSupport::TaggedLogging.new(mylogger)</pre> <button class="clipboard-button" data-clipboard-text="class MyLogger &lt; ::Logger
  include ActiveSupport::LoggerSilence
end

mylogger           = MyLogger.new(STDOUT)
mylogger.formatter = config.log_formatter
config.logger      = ActiveSupport::TaggedLogging.new(mylogger)
">Copy</button>  <h3 id="config-middleware"><a class="anchorlink" href="#config-middleware">3.2.46 <code>config.middleware</code></a></h3>
<p>Allows you to configure the application's middleware. This is covered in depth in the <a href="#configuring-middleware">Configuring Middleware</a> section below.</p>
<h3 id="config-precompile-filter-parameters"><a class="anchorlink" href="#config-precompile-filter-parameters">3.2.47 <code>config.precompile_filter_parameters</code></a></h3>
<p>When <code>true</code>, will precompile <a href="#config-filter-parameters"><code>config.filter_parameters</code></a> using <a href="https://edgeapi.rubyonrails.org/classes/ActiveSupport/ParameterFilter.html#method-c-precompile_filters"><code>ActiveSupport::ParameterFilter.precompile_filters</code></a>.</p>
<p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>false</code></td> </tr> <tr> <td>7.1</td> <td><code>true</code></td> </tr> </tbody>
</table> <h3 id="config-public-file-server-enabled"><a class="anchorlink" href="#config-public-file-server-enabled">3.2.48 <code>config.public_file_server.enabled</code></a></h3>
<p>Configures whether Rails should serve static files from the public directory. Defaults to <code>true</code>.</p>
<p>If the server software (e.g. NGINX or Apache) should serve static files instead, set this value to <code>false</code>.</p>
<h3 id="config-railties-order"><a class="anchorlink" href="#config-railties-order">3.2.49 <code>config.railties_order</code></a></h3>
<p>Allows manually specifying the order that Railties/Engines are loaded. The default value is <code>[:all]</code>.</p> <pre data-language="ruby">config.railties_order = [Blog::Engine, :main_app, :all]</pre> <button class="clipboard-button" data-clipboard-text="config.railties_order = [Blog::Engine, :main_app, :all]
">Copy</button>  <h3 id="config-rake-eager-load"><a class="anchorlink" href="#config-rake-eager-load">3.2.50 <code>config.rake_eager_load</code></a></h3>
<p>When <code>true</code>, eager load the application when running Rake tasks. Defaults to <code>false</code>.</p>
<h3 id="config-read-encrypted-secrets"><a class="anchorlink" href="#config-read-encrypted-secrets">3.2.51 <code>config.read_encrypted_secrets</code></a></h3>
<p><em>DEPRECATED</em>: You should be using <a href="https://guides.rubyonrails.org/security.html#custom-credentials">credentials</a> instead of encrypted secrets.</p>
<p>When <code>true</code>, will try to read encrypted secrets from <code>config/secrets.yml.enc</code></p>
<h3 id="config-relative-url-root"><a class="anchorlink" href="#config-relative-url-root">3.2.52 <code>config.relative_url_root</code></a></h3>
<p>Can be used to tell Rails that you are <a href="configuring.html#deploy-to-a-subdirectory-relative-url-root">deploying to a subdirectory</a>. The default is <code>ENV['RAILS_RELATIVE_URL_ROOT']</code>.</p>
<h3 id="config-reload-classes-only-on-change"><a class="anchorlink" href="#config-reload-classes-only-on-change">3.2.53 <code>config.reload_classes_only_on_change</code></a></h3>
<p>Enables or disables reloading of classes only when tracked files change. By default tracks everything on autoload paths and is set to <code>true</code>. If <code>config.enable_reloading</code> is <code>false</code>, this option is ignored.</p>
<h3 id="config-require-master-key"><a class="anchorlink" href="#config-require-master-key">3.2.54 <code>config.require_master_key</code></a></h3>
<p>Causes the app to not boot if a master key hasn't been made available through <code>ENV["RAILS_MASTER_KEY"]</code> or the <code>config/master.key</code> file.</p>
<h3 id="config-secret-key-base"><a class="anchorlink" href="#config-secret-key-base">3.2.55 <code>config.secret_key_base</code></a></h3>
<p>The fallback for specifying the input secret for an application's key generator. It is recommended to leave this unset, and instead to specify a <code>secret_key_base</code> in <code>config/credentials.yml.enc</code>. See the <a href="https://edgeapi.rubyonrails.org/classes/Rails/Application.html#method-i-secret_key_base"><code>secret_key_base</code> API documentation</a> for more information and alternative configuration methods.</p>
<h3 id="config-server-timing"><a class="anchorlink" href="#config-server-timing">3.2.56 <code>config.server_timing</code></a></h3>
<p>When <code>true</code>, adds the <a href="#actiondispatch-servertiming"><code>ServerTiming</code> middleware</a> to the middleware stack. Defaults to <code>false</code>, but is set to <code>true</code> in the default generated <code>config/environments/development.rb</code> file.</p>
<h3 id="config-session-options"><a class="anchorlink" href="#config-session-options">3.2.57 <code>config.session_options</code></a></h3>
<p>Additional options passed to <code>config.session_store</code>. You should use <code>config.session_store</code> to set this instead of modifying it yourself.</p> <pre data-language="ruby">config.session_store :cookie_store, key: "_your_app_session"
config.session_options # =&gt; {key: "_your_app_session"}</pre> <button class="clipboard-button" data-clipboard-text='config.session_store :cookie_store, key: "_your_app_session"
config.session_options # =&gt; {key: "_your_app_session"}
'>Copy</button>  <h3 id="config-session-store"><a class="anchorlink" href="#config-session-store">3.2.58 <code>config.session_store</code></a></h3>
<p>Specifies what class to use to store the session. Possible values are <code>:cache_store</code>, <code>:cookie_store</code>, <code>:mem_cache_store</code>, a custom store, or <code>:disabled</code>. <code>:disabled</code> tells Rails not to deal with sessions.</p>
<p>This setting is configured via a regular method call, rather than a setter. This allows additional options to be passed:</p> <pre data-language="ruby">config.session_store :cookie_store, key: "_your_app_session"</pre> <button class="clipboard-button" data-clipboard-text='config.session_store :cookie_store, key: "_your_app_session"
'>Copy</button>  <p>If a custom store is specified as a symbol, it will be resolved to the <code>ActionDispatch::Session</code> namespace:</p> <pre data-language="ruby"># use ActionDispatch::Session::MyCustomStore as the session store
config.session_store :my_custom_store</pre> <button class="clipboard-button" data-clipboard-text="# use ActionDispatch::Session::MyCustomStore as the session store
config.session_store :my_custom_store
">Copy</button>  <p>The default store is a cookie store with the application name as the session key.</p>
<h3 id="config-ssl-options"><a class="anchorlink" href="#config-ssl-options">3.2.59 <code>config.ssl_options</code></a></h3>
<p>Configuration options for the <a href="https://edgeapi.rubyonrails.org/classes/ActionDispatch/SSL.html"><code>ActionDispatch::SSL</code></a> middleware.</p>
<p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>{}</code></td> </tr> <tr> <td>5.0</td> <td><code>{ hsts: { subdomains: true } }</code></td> </tr> </tbody>
</table> <h3 id="config-time-zone"><a class="anchorlink" href="#config-time-zone">3.2.60 <code>config.time_zone</code></a></h3>
<p>Sets the default time zone for the application and enables time zone awareness for Active Record.</p>
<h3 id="config-x"><a class="anchorlink" href="#config-x">3.2.61 <code>config.x</code></a></h3>
<p>Used to easily add nested custom configuration to the application config object</p> <pre data-language="ruby">config.x.payment_processing.schedule = :daily
  Rails.configuration.x.payment_processing.schedule # =&gt; :daily</pre> <button class="clipboard-button" data-clipboard-text="  config.x.payment_processing.schedule = :daily
  Rails.configuration.x.payment_processing.schedule # =&gt; :daily
">Copy</button>  <p>See <a href="#custom-configuration">Custom Configuration</a></p>
<h2 id="configuring-assets"><a class="anchorlink" href="#configuring-assets">3.3 Configuring Assets</a></h2>
<h3 id="config-assets-css-compressor"><a class="anchorlink" href="#config-assets-css-compressor">3.3.1 <code>config.assets.css_compressor</code></a></h3>
<p>Defines the CSS compressor to use. It is set by default by <code>sass-rails</code>. The unique alternative value at the moment is <code>:yui</code>, which uses the <code>yui-compressor</code> gem.</p>
<h3 id="config-assets-js-compressor"><a class="anchorlink" href="#config-assets-js-compressor">3.3.2 <code>config.assets.js_compressor</code></a></h3>
<p>Defines the JavaScript compressor to use. Possible values are <code>:terser</code>, <code>:closure</code>, <code>:uglifier</code>, and <code>:yui</code>, which require the use of the <code>terser</code>, <code>closure-compiler</code>, <code>uglifier</code>, or <code>yui-compressor</code> gems respectively.</p>
<h3 id="config-assets-gzip"><a class="anchorlink" href="#config-assets-gzip">3.3.3 <code>config.assets.gzip</code></a></h3>
<p>A flag that enables the creation of gzipped version of compiled assets, along with non-gzipped assets. Set to <code>true</code> by default.</p>
<h3 id="config-assets-paths"><a class="anchorlink" href="#config-assets-paths">3.3.4 <code>config.assets.paths</code></a></h3>
<p>Contains the paths which are used to look for assets. Appending paths to this configuration option will cause those paths to be used in the search for assets.</p>
<h3 id="config-assets-precompile"><a class="anchorlink" href="#config-assets-precompile">3.3.5 <code>config.assets.precompile</code></a></h3>
<p>Allows you to specify additional assets (other than <code>application.css</code> and <code>application.js</code>) which are to be precompiled when <code>bin/rails assets:precompile</code> is run.</p>
<h3 id="config-assets-unknown-asset-fallback"><a class="anchorlink" href="#config-assets-unknown-asset-fallback">3.3.6 <code>config.assets.unknown_asset_fallback</code></a></h3>
<p>Allows you to modify the behavior of the asset pipeline when an asset is not in the pipeline, if you use sprockets-rails 3.2.0 or newer.</p>
<p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>true</code></td> </tr> <tr> <td>5.1</td> <td><code>false</code></td> </tr> </tbody>
</table> <h3 id="config-assets-prefix"><a class="anchorlink" href="#config-assets-prefix">3.3.7 <code>config.assets.prefix</code></a></h3>
<p>Defines the prefix where assets are served from. Defaults to <code>/assets</code>.</p>
<h3 id="config-assets-manifest"><a class="anchorlink" href="#config-assets-manifest">3.3.8 <code>config.assets.manifest</code></a></h3>
<p>Defines the full path to be used for the asset precompiler's manifest file. Defaults to a file named <code>manifest-&lt;random&gt;.json</code> in the <code>config.assets.prefix</code> directory within the public folder.</p>
<h3 id="config-assets-digest"><a class="anchorlink" href="#config-assets-digest">3.3.9 <code>config.assets.digest</code></a></h3>
<p>Enables the use of SHA256 fingerprints in asset names. Set to <code>true</code> by default.</p>
<h3 id="config-assets-debug"><a class="anchorlink" href="#config-assets-debug">3.3.10 <code>config.assets.debug</code></a></h3>
<p>Disables the concatenation and compression of assets. Set to <code>true</code> by default in <code>development.rb</code>.</p>
<h3 id="config-assets-version"><a class="anchorlink" href="#config-assets-version">3.3.11 <code>config.assets.version</code></a></h3>
<p>Is an option string that is used in SHA256 hash generation. This can be changed to force all files to be recompiled.</p>
<h3 id="config-assets-compile"><a class="anchorlink" href="#config-assets-compile">3.3.12 <code>config.assets.compile</code></a></h3>
<p>Is a boolean that can be used to turn on live Sprockets compilation in production.</p>
<h3 id="config-assets-logger"><a class="anchorlink" href="#config-assets-logger">3.3.13 <code>config.assets.logger</code></a></h3>
<p>Accepts a logger conforming to the interface of Log4r or the default Ruby <code>Logger</code> class. Defaults to the same configured at <code>config.logger</code>. Setting <code>config.assets.logger</code> to <code>false</code> will turn off served assets logging.</p>
<h3 id="config-assets-quiet"><a class="anchorlink" href="#config-assets-quiet">3.3.14 <code>config.assets.quiet</code></a></h3>
<p>Disables logging of assets requests. Set to <code>true</code> by default in <code>development.rb</code>.</p>
<h2 id="configuring-generators"><a class="anchorlink" href="#configuring-generators">3.4 Configuring Generators</a></h2>
<p>Rails allows you to alter what generators are used with the <code>config.generators</code> method. This method takes a block:</p> <pre data-language="ruby">config.generators do |g|
  g.orm :active_record
  g.test_framework :test_unit
end</pre> <button class="clipboard-button" data-clipboard-text="config.generators do |g|
  g.orm :active_record
  g.test_framework :test_unit
end
">Copy</button>  <p>The full set of methods that can be used in this block are as follows:</p> <ul> <li>
<code>force_plural</code> allows pluralized model names. Defaults to <code>false</code>.</li> <li>
<code>helper</code> defines whether or not to generate helpers. Defaults to <code>true</code>.</li> <li>
<code>integration_tool</code> defines which integration tool to use to generate integration tests. Defaults to <code>:test_unit</code>.</li> <li>
<code>system_tests</code> defines which integration tool to use to generate system tests. Defaults to <code>:test_unit</code>.</li> <li>
<code>orm</code> defines which orm to use. Defaults to <code>false</code> and will use Active Record by default.</li> <li>
<code>resource_controller</code> defines which generator to use for generating a controller when using <code>bin/rails generate resource</code>. Defaults to <code>:controller</code>.</li> <li>
<code>resource_route</code> defines whether a resource route definition should be generated or not. Defaults to <code>true</code>.</li> <li>
<code>scaffold_controller</code> different from <code>resource_controller</code>, defines which generator to use for generating a <em>scaffolded</em> controller when using <code>bin/rails generate scaffold</code>. Defaults to <code>:scaffold_controller</code>.</li> <li>
<code>test_framework</code> defines which test framework to use. Defaults to <code>false</code> and will use minitest by default.</li> <li>
<code>template_engine</code> defines which template engine to use, such as ERB or Haml. Defaults to <code>:erb</code>.</li> </ul> <h2 id="configuring-middleware"><a class="anchorlink" href="#configuring-middleware">3.5 Configuring Middleware</a></h2>
<p>Every Rails application comes with a standard set of middleware which it uses in this order in the development environment:</p>
<h3 id="actiondispatch-hostauthorization"><a class="anchorlink" href="#actiondispatch-hostauthorization">3.5.1 <code>ActionDispatch::HostAuthorization</code></a></h3>
<p>Prevents against DNS rebinding and other <code>Host</code> header attacks. It is included in the development environment by default with the following configuration:</p> <pre data-language="ruby">Rails.application.config.hosts = [
  IPAddr.new("0.0.0.0/0"),        # All IPv4 addresses.
  IPAddr.new("::/0"),             # All IPv6 addresses.
  "localhost",                    # The localhost reserved domain.
  ENV["RAILS_DEVELOPMENT_HOSTS"]  # Additional comma-separated hosts for development.
]</pre> <button class="clipboard-button" data-clipboard-text='Rails.application.config.hosts = [
  IPAddr.new("0.0.0.0/0"),        # All IPv4 addresses.
  IPAddr.new("::/0"),             # All IPv6 addresses.
  "localhost",                    # The localhost reserved domain.
  ENV["RAILS_DEVELOPMENT_HOSTS"]  # Additional comma-separated hosts for development.
]
'>Copy</button>  <p>In other environments <code>Rails.application.config.hosts</code> is empty and no <code>Host</code> header checks will be done. If you want to guard against header attacks on production, you have to manually permit the allowed hosts with:</p> <pre data-language="ruby">Rails.application.config.hosts &lt;&lt; "product.com"</pre> <button class="clipboard-button" data-clipboard-text='Rails.application.config.hosts &lt;&lt; "product.com"
'>Copy</button>  <p>The host of a request is checked against the <code>hosts</code> entries with the case operator (<code>#===</code>), which lets <code>hosts</code> support entries of type <code>Regexp</code>, <code>Proc</code> and <code>IPAddr</code> to name a few. Here is an example with a regexp.</p> <pre data-language="ruby"># Allow requests from subdomains like `www.product.com` and
# `beta1.product.com`.
Rails.application.config.hosts &lt;&lt; /.*\.product\.com/</pre> <button class="clipboard-button" data-clipboard-text="# Allow requests from subdomains like `www.product.com` and
# `beta1.product.com`.
Rails.application.config.hosts &lt;&lt; /.*\.product\.com/
">Copy</button>  <p>The provided regexp will be wrapped with both anchors (<code>\A</code> and <code>\z</code>) so it must match the entire hostname. <code>/product.com/</code>, for example, once anchored, would fail to match <code>www.product.com</code>.</p>
<p>A special case is supported that allows you to permit all sub-domains:</p> <pre data-language="ruby"># Allow requests from subdomains like `www.product.com` and
# `beta1.product.com`.
Rails.application.config.hosts &lt;&lt; ".product.com"</pre> <button class="clipboard-button" data-clipboard-text='# Allow requests from subdomains like `www.product.com` and
# `beta1.product.com`.
Rails.application.config.hosts &lt;&lt; ".product.com"
'>Copy</button>  <p>You can exclude certain requests from Host Authorization checks by setting <code>config.host_authorization.exclude</code>:</p> <pre data-language="ruby"># Exclude requests for the /healthcheck/ path from host checking
Rails.application.config.host_authorization = {
  exclude: -&gt;(request) { request.path.include?('healthcheck') }
}</pre> <button class="clipboard-button" data-clipboard-text="# Exclude requests for the /healthcheck/ path from host checking
Rails.application.config.host_authorization = {
  exclude: -&gt;(request) { request.path.include?('healthcheck') }
}
">Copy</button>  <p>When a request comes to an unauthorized host, a default Rack application will run and respond with <code>403 Forbidden</code>. This can be customized by setting <code>config.host_authorization.response_app</code>. For example:</p> <pre data-language="ruby">Rails.application.config.host_authorization = {
  response_app: -&gt; env do
    [400, { "Content-Type" =&gt; "text/plain" }, ["Bad Request"]]
  end
}</pre> <button class="clipboard-button" data-clipboard-text='Rails.application.config.host_authorization = {
  response_app: -&gt; env do
    [400, { "Content-Type" =&gt; "text/plain" }, ["Bad Request"]]
  end
}
'>Copy</button>  <h3 id="actiondispatch-servertiming"><a class="anchorlink" href="#actiondispatch-servertiming">3.5.2 <code>ActionDispatch::ServerTiming</code></a></h3>
<p>Adds the <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Server-Timing"><code>Server-Timing</code></a> header to the response, which includes performance metrics from the server. This data can be viewed by inspecting the response in the Network panel of the browser's Developer Tools. Most browsers provide a Timing tab that visualizes the data.</p>
<h3 id="actiondispatch-ssl"><a class="anchorlink" href="#actiondispatch-ssl">3.5.3 <code>ActionDispatch::SSL</code></a></h3>
<p>Forces every request to be served using HTTPS. Enabled if <code>config.force_ssl</code> is set to <code>true</code>. Options passed to this can be configured by setting <code>config.ssl_options</code>.</p>
<h3 id="actiondispatch-static"><a class="anchorlink" href="#actiondispatch-static">3.5.4 <code>ActionDispatch::Static</code></a></h3>
<p>Is used to serve static assets. Disabled if <code>config.public_file_server.enabled</code> is <code>false</code>. Set <code>config.public_file_server.index_name</code> if you need to serve a static directory index file that is not named <code>index</code>. For example, to serve <code>main.html</code> instead of <code>index.html</code> for directory requests, set <code>config.public_file_server.index_name</code> to <code>"main"</code>.</p>
<h3 id="actiondispatch-executor"><a class="anchorlink" href="#actiondispatch-executor">3.5.5 <code>ActionDispatch::Executor</code></a></h3>
<p>Allows thread safe code reloading. Disabled if <code>config.allow_concurrency</code> is <code>false</code>, which causes <code>Rack::Lock</code> to be loaded. <code>Rack::Lock</code> wraps the app in mutex so it can only be called by a single thread at a time.</p>
<h3 id="activesupport-cache-strategy-localcache"><a class="anchorlink" href="#activesupport-cache-strategy-localcache">3.5.6 <code>ActiveSupport::Cache::Strategy::LocalCache</code></a></h3>
<p>Serves as a basic memory backed cache. This cache is not thread safe and is intended only for serving as a temporary memory cache for a single thread.</p>
<h3 id="rack-runtime"><a class="anchorlink" href="#rack-runtime">3.5.7 <code>Rack::Runtime</code></a></h3>
<p>Sets an <code>X-Runtime</code> header, containing the time (in seconds) taken to execute the request.</p>
<h3 id="rails-rack-logger"><a class="anchorlink" href="#rails-rack-logger">3.5.8 <code>Rails::Rack::Logger</code></a></h3>
<p>Notifies the logs that the request has begun. After request is complete, flushes all the logs.</p>
<h3 id="actiondispatch-showexceptions"><a class="anchorlink" href="#actiondispatch-showexceptions">3.5.9 <code>ActionDispatch::ShowExceptions</code></a></h3>
<p>Rescues any exception returned by the application and renders nice exception pages if the request is local or if <code>config.consider_all_requests_local</code> is set to <code>true</code>. If <code>config.action_dispatch.show_exceptions</code> is set to <code>:none</code>, exceptions will be raised regardless.</p>
<h3 id="actiondispatch-requestid"><a class="anchorlink" href="#actiondispatch-requestid">3.5.10 <code>ActionDispatch::RequestId</code></a></h3>
<p>Makes a unique X-Request-Id header available to the response and enables the <code>ActionDispatch::Request#uuid</code> method. Configurable with <code>config.action_dispatch.request_id_header</code>.</p>
<h3 id="actiondispatch-remoteip"><a class="anchorlink" href="#actiondispatch-remoteip">3.5.11 <code>ActionDispatch::RemoteIp</code></a></h3>
<p>Checks for IP spoofing attacks and gets valid <code>client_ip</code> from request headers. Configurable with the <code>config.action_dispatch.ip_spoofing_check</code>, and <code>config.action_dispatch.trusted_proxies</code> options.</p>
<h3 id="rack-sendfile"><a class="anchorlink" href="#rack-sendfile">3.5.12 <code>Rack::Sendfile</code></a></h3>
<p>Intercepts responses whose body is being served from a file and replaces it with a server specific X-Sendfile header. Configurable with <code>config.action_dispatch.x_sendfile_header</code>.</p>
<h3 id="actiondispatch-callbacks"><a class="anchorlink" href="#actiondispatch-callbacks">3.5.13 <code>ActionDispatch::Callbacks</code></a></h3>
<p>Runs the prepare callbacks before serving the request.</p>
<h3 id="actiondispatch-cookies"><a class="anchorlink" href="#actiondispatch-cookies">3.5.14 <code>ActionDispatch::Cookies</code></a></h3>
<p>Sets cookies for the request.</p>
<h3 id="actiondispatch-session-cookiestore"><a class="anchorlink" href="#actiondispatch-session-cookiestore">3.5.15 <code>ActionDispatch::Session::CookieStore</code></a></h3>
<p>Is responsible for storing the session in cookies. An alternate middleware can be used for this by changing <a href="#config-session-store"><code>config.session_store</code></a>.</p>
<h3 id="actiondispatch-flash"><a class="anchorlink" href="#actiondispatch-flash">3.5.16 <code>ActionDispatch::Flash</code></a></h3>
<p>Sets up the <code>flash</code> keys. Only available if <a href="#config-session-store"><code>config.session_store</code></a> is set to a value.</p>
<h3 id="rack-methodoverride"><a class="anchorlink" href="#rack-methodoverride">3.5.17 <code>Rack::MethodOverride</code></a></h3>
<p>Allows the method to be overridden if <code>params[:_method]</code> is set. This is the middleware which supports the PATCH, PUT, and DELETE HTTP method types.</p>
<h3 id="rack-head"><a class="anchorlink" href="#rack-head">3.5.18 <code>Rack::Head</code></a></h3>
<p>Converts HEAD requests to GET requests and serves them as so.</p>
<h3 id="adding-custom-middleware"><a class="anchorlink" href="#adding-custom-middleware">3.5.19 Adding Custom Middleware</a></h3>
<p>Besides these usual middleware, you can add your own by using the <code>config.middleware.use</code> method:</p> <pre data-language="ruby">config.middleware.use Magical::Unicorns</pre> <button class="clipboard-button" data-clipboard-text="config.middleware.use Magical::Unicorns
">Copy</button>  <p>This will put the <code>Magical::Unicorns</code> middleware on the end of the stack. You can use <code>insert_before</code> if you wish to add a middleware before another.</p> <pre data-language="ruby">config.middleware.insert_before Rack::Head, Magical::Unicorns</pre> <button class="clipboard-button" data-clipboard-text="config.middleware.insert_before Rack::Head, Magical::Unicorns
">Copy</button>  <p>Or you can insert a middleware to exact position by using indexes. For example, if you want to insert <code>Magical::Unicorns</code> middleware on top of the stack, you can do it, like so:</p> <pre data-language="ruby">config.middleware.insert_before 0, Magical::Unicorns</pre> <button class="clipboard-button" data-clipboard-text="config.middleware.insert_before 0, Magical::Unicorns
">Copy</button>  <p>There's also <code>insert_after</code> which will insert a middleware after another:</p> <pre data-language="ruby">config.middleware.insert_after Rack::Head, Magical::Unicorns</pre> <button class="clipboard-button" data-clipboard-text="config.middleware.insert_after Rack::Head, Magical::Unicorns
">Copy</button>  <p>Middlewares can also be completely swapped out and replaced with others:</p> <pre data-language="ruby">config.middleware.swap ActionController::Failsafe, Lifo::Failsafe</pre> <button class="clipboard-button" data-clipboard-text="config.middleware.swap ActionController::Failsafe, Lifo::Failsafe
">Copy</button>  <p>Middlewares can be moved from one place to another:</p> <pre data-language="ruby">config.middleware.move_before ActionDispatch::Flash, Magical::Unicorns</pre> <button class="clipboard-button" data-clipboard-text="config.middleware.move_before ActionDispatch::Flash, Magical::Unicorns
">Copy</button>  <p>This will move the <code>Magical::Unicorns</code> middleware before <code>ActionDispatch::Flash</code>. You can also move it after:</p> <pre data-language="ruby">config.middleware.move_after ActionDispatch::Flash, Magical::Unicorns</pre> <button class="clipboard-button" data-clipboard-text="config.middleware.move_after ActionDispatch::Flash, Magical::Unicorns
">Copy</button>  <p>They can also be removed from the stack completely:</p> <pre data-language="ruby">config.middleware.delete Rack::MethodOverride</pre> <button class="clipboard-button" data-clipboard-text="config.middleware.delete Rack::MethodOverride
">Copy</button>  <h2 id="configuring-i18n"><a class="anchorlink" href="#configuring-i18n">3.6 Configuring i18n</a></h2>
<p>All these configuration options are delegated to the <code>I18n</code> library.</p>
<h3 id="config-i18n-available-locales"><a class="anchorlink" href="#config-i18n-available-locales">3.6.1 <code>config.i18n.available_locales</code></a></h3>
<p>Defines the permitted available locales for the app. Defaults to all locale keys found in locale files, usually only <code>:en</code> on a new application.</p>
<h3 id="config-i18n-default-locale"><a class="anchorlink" href="#config-i18n-default-locale">3.6.2 <code>config.i18n.default_locale</code></a></h3>
<p>Sets the default locale of an application used for i18n. Defaults to <code>:en</code>.</p>
<h3 id="config-i18n-enforce-available-locales"><a class="anchorlink" href="#config-i18n-enforce-available-locales">3.6.3 <code>config.i18n.enforce_available_locales</code></a></h3>
<p>Ensures that all locales passed through i18n must be declared in the <code>available_locales</code> list, raising an <code>I18n::InvalidLocale</code> exception when setting an unavailable locale. Defaults to <code>true</code>. It is recommended not to disable this option unless strongly required, since this works as a security measure against setting any invalid locale from user input.</p>
<h3 id="config-i18n-load-path"><a class="anchorlink" href="#config-i18n-load-path">3.6.4 <code>config.i18n.load_path</code></a></h3>
<p>Sets the path Rails uses to look for locale files. Defaults to <code>config/locales/**/*.{yml,rb}</code>.</p>
<h3 id="config-i18n-raise-on-missing-translations"><a class="anchorlink" href="#config-i18n-raise-on-missing-translations">3.6.5 <code>config.i18n.raise_on_missing_translations</code></a></h3>
<p>Determines whether an error should be raised for missing translations. This defaults to <code>false</code>.</p>
<h3 id="config-i18n-fallbacks"><a class="anchorlink" href="#config-i18n-fallbacks">3.6.6 <code>config.i18n.fallbacks</code></a></h3>
<p>Sets fallback behavior for missing translations. Here are 3 usage examples for this option:</p> <ul> <li>
<p>You can set the option to <code>true</code> for using default locale as fallback, like so:</p> <pre data-language="ruby">config.i18n.fallbacks = true</pre> <button class="clipboard-button" data-clipboard-text="config.i18n.fallbacks = true
">Copy</button> </li> <li>
<p>Or you can set an array of locales as fallback, like so:</p> <pre data-language="ruby">config.i18n.fallbacks = [:tr, :en]</pre> <button class="clipboard-button" data-clipboard-text="config.i18n.fallbacks = [:tr, :en]
">Copy</button> </li> <li>
<p>Or you can set different fallbacks for locales individually. For example, if you want to use <code>:tr</code> for <code>:az</code> and <code>:de</code>, <code>:en</code> for <code>:da</code> as fallbacks, you can do it, like so:</p> <pre data-language="ruby">config.i18n.fallbacks = { az: :tr, da: [:de, :en] }
#or
config.i18n.fallbacks.map = { az: :tr, da: [:de, :en] }</pre> <button class="clipboard-button" data-clipboard-text="config.i18n.fallbacks = { az: :tr, da: [:de, :en] }
#or
config.i18n.fallbacks.map = { az: :tr, da: [:de, :en] }
">Copy</button> </li> </ul> <h2 id="configuring-active-model"><a class="anchorlink" href="#configuring-active-model">3.7 Configuring Active Model</a></h2>
<h3 id="config-active-model-i18n-customize-full-message"><a class="anchorlink" href="#config-active-model-i18n-customize-full-message">3.7.1 <code>config.active_model.i18n_customize_full_message</code></a></h3>
<p>Controls whether the <a href="https://edgeapi.rubyonrails.org/classes/ActiveModel/Error.html#method-i-full_message"><code>Error#full_message</code></a> format can be overridden in an i18n locale file. Defaults to <code>false</code>.</p>
<p>When set to <code>true</code>, <code>full_message</code> will look for a format at the attribute and model level of the locale files. The default format is <code>"%{attribute} %{message}"</code>, where <code>attribute</code> is the name of the attribute, and <code>message</code> is the validation-specific message. The following example overrides the format for all <code>Person</code> attributes, as well as the format for a specific <code>Person</code> attribute (<code>age</code>).</p> <pre data-language="ruby">class Person
  include ActiveModel::Validations

  attr_accessor :name, :age

  validates :name, :age, presence: true
end</pre> <button class="clipboard-button" data-clipboard-text="class Person
  include ActiveModel::Validations

  attr_accessor :name, :age

  validates :name, :age, presence: true
end
">Copy</button>   <pre data-language="yml">en:
  activemodel: # or activerecord:
    errors:
      models:
        person:
          # Override the format for all Person attributes:
          format: "Invalid %{attribute} (%{message})"
          attributes:
            age:
              # Override the format for the age attribute:
              format: "%{message}"
              blank: "Please fill in your %{attribute}"</pre> <button class="clipboard-button" data-clipboard-text='en:
  activemodel: # or activerecord:
    errors:
      models:
        person:
          # Override the format for all Person attributes:
          format: "Invalid %{attribute} (%{message})"
          attributes:
            age:
              # Override the format for the age attribute:
              format: "%{message}"
              blank: "Please fill in your %{attribute}"
'>Copy</button>   <pre data-language="irb">irb&gt; person = Person.new.tap(&amp;:valid?)

irb&gt; person.errors.full_messages
=&gt; [
  "Invalid Name (can't be blank)",
  "Please fill in your Age"
]

irb&gt; person.errors.messages
=&gt; {
  :name =&gt; ["can't be blank"],
  :age  =&gt; ["Please fill in your Age"]
}</pre> <button class="clipboard-button" data-clipboard-text="person = Person.new.tap(&amp;:valid?)
person.errors.full_messages
person.errors.messages
">Copy</button>  <h2 id="configuring-active-record"><a class="anchorlink" href="#configuring-active-record">3.8 Configuring Active Record</a></h2>
<p><code>config.active_record</code> includes a variety of configuration options:</p>
<h3 id="config-active-record-logger"><a class="anchorlink" href="#config-active-record-logger">3.8.1 <code>config.active_record.logger</code></a></h3>
<p>Accepts a logger conforming to the interface of Log4r or the default Ruby Logger class, which is then passed on to any new database connections made. You can retrieve this logger by calling <code>logger</code> on either an Active Record model class or an Active Record model instance. Set to <code>nil</code> to disable logging.</p>
<h3 id="config-active-record-primary-key-prefix-type"><a class="anchorlink" href="#config-active-record-primary-key-prefix-type">3.8.2 <code>config.active_record.primary_key_prefix_type</code></a></h3>
<p>Lets you adjust the naming for primary key columns. By default, Rails assumes that primary key columns are named <code>id</code> (and this configuration option doesn't need to be set). There are two other choices:</p> <ul> <li>
<code>:table_name</code> would make the primary key for the Customer class <code>customerid</code>.</li> <li>
<code>:table_name_with_underscore</code> would make the primary key for the Customer class <code>customer_id</code>.</li> </ul> <h3 id="config-active-record-table-name-prefix"><a class="anchorlink" href="#config-active-record-table-name-prefix">3.8.3 <code>config.active_record.table_name_prefix</code></a></h3>
<p>Lets you set a global string to be prepended to table names. If you set this to <code>northwest_</code>, then the Customer class will look for <code>northwest_customers</code> as its table. The default is an empty string.</p>
<h3 id="config-active-record-table-name-suffix"><a class="anchorlink" href="#config-active-record-table-name-suffix">3.8.4 <code>config.active_record.table_name_suffix</code></a></h3>
<p>Lets you set a global string to be appended to table names. If you set this to <code>_northwest</code>, then the Customer class will look for <code>customers_northwest</code> as its table. The default is an empty string.</p>
<h3 id="config-active-record-schema-migrations-table-name"><a class="anchorlink" href="#config-active-record-schema-migrations-table-name">3.8.5 <code>config.active_record.schema_migrations_table_name</code></a></h3>
<p>Lets you set a string to be used as the name of the schema migrations table.</p>
<h3 id="config-active-record-internal-metadata-table-name"><a class="anchorlink" href="#config-active-record-internal-metadata-table-name">3.8.6 <code>config.active_record.internal_metadata_table_name</code></a></h3>
<p>Lets you set a string to be used as the name of the internal metadata table.</p>
<h3 id="config-active-record-protected-environments"><a class="anchorlink" href="#config-active-record-protected-environments">3.8.7 <code>config.active_record.protected_environments</code></a></h3>
<p>Lets you set an array of names of environments where destructive actions should be prohibited.</p>
<h3 id="config-active-record-pluralize-table-names"><a class="anchorlink" href="#config-active-record-pluralize-table-names">3.8.8 <code>config.active_record.pluralize_table_names</code></a></h3>
<p>Specifies whether Rails will look for singular or plural table names in the database. If set to <code>true</code> (the default), then the Customer class will use the <code>customers</code> table. If set to <code>false</code>, then the Customer class will use the <code>customer</code> table.</p>
<h3 id="config-active-record-default-timezone"><a class="anchorlink" href="#config-active-record-default-timezone">3.8.9 <code>config.active_record.default_timezone</code></a></h3>
<p>Determines whether to use <code>Time.local</code> (if set to <code>:local</code>) or <code>Time.utc</code> (if set to <code>:utc</code>) when pulling dates and times from the database. The default is <code>:utc</code>.</p>
<h3 id="config-active-record-schema-format"><a class="anchorlink" href="#config-active-record-schema-format">3.8.10 <code>config.active_record.schema_format</code></a></h3>
<p>Controls the format for dumping the database schema to a file. The options are <code>:ruby</code> (the default) for a database-independent version that depends on migrations, or <code>:sql</code> for a set of (potentially database-dependent) SQL statements.</p>
<h3 id="config-active-record-error-on-ignored-order"><a class="anchorlink" href="#config-active-record-error-on-ignored-order">3.8.11 <code>config.active_record.error_on_ignored_order</code></a></h3>
<p>Specifies if an error should be raised if the order of a query is ignored during a batch query. The options are <code>true</code> (raise error) or <code>false</code> (warn). Default is <code>false</code>.</p>
<h3 id="config-active-record-timestamped-migrations"><a class="anchorlink" href="#config-active-record-timestamped-migrations">3.8.12 <code>config.active_record.timestamped_migrations</code></a></h3>
<p>Controls whether migrations are numbered with serial integers or with timestamps. The default is <code>true</code>, to use timestamps, which are preferred if there are multiple developers working on the same application.</p>
<h3 id="config-active-record-db-warnings-action"><a class="anchorlink" href="#config-active-record-db-warnings-action">3.8.13 <code>config.active_record.db_warnings_action</code></a></h3>
<p>Controls the action to be taken when a SQL query produces a warning. The following options are available:</p> <ul> <li><p><code>:ignore</code> - Database warnings will be ignored. This is the default.</p></li> <li><p><code>:log</code> - Database warnings will be logged via <code>ActiveRecord.logger</code> at the <code>:warn</code> level.</p></li> <li><p><code>:raise</code> - Database warnings will be raised as <code>ActiveRecord::SQLWarning</code>.</p></li> <li><p><code>:report</code> - Database warnings will be reported to subscribers of Rails' error reporter.</p></li> <li>
<p>Custom proc - A custom proc can be provided. It should accept a <code>SQLWarning</code> error object.</p>
<p>For example:</p> <pre data-language="ruby">config.active_record.db_warnings_action = -&gt;(warning) do
  # Report to custom exception reporting service
  Bugsnag.notify(warning.message) do |notification|
    notification.add_metadata(:warning_code, warning.code)
    notification.add_metadata(:warning_level, warning.level)
  end
end</pre> <button class="clipboard-button" data-clipboard-text="config.active_record.db_warnings_action = -&gt;(warning) do
  # Report to custom exception reporting service
  Bugsnag.notify(warning.message) do |notification|
    notification.add_metadata(:warning_code, warning.code)
    notification.add_metadata(:warning_level, warning.level)
  end
end
">Copy</button> </li> </ul> <h3 id="config-active-record-db-warnings-ignore"><a class="anchorlink" href="#config-active-record-db-warnings-ignore">3.8.14 <code>config.active_record.db_warnings_ignore</code></a></h3>
<p>Specifies an allowlist of warning codes and messages that will be ignored, regardless of the configured <code>db_warnings_action</code>. The default behavior is to report all warnings. Warnings to ignore can be specified as Strings or Regexps. For example:</p> <pre data-language="ruby">config.active_record.db_warnings_action = :raise
  # The following warnings will not be raised
  config.active_record.db_warnings_ignore = [
    /Invalid utf8mb4 character string/,
    "An exact warning message",
    "1062", # MySQL Error 1062: Duplicate entry
  ]</pre> <button class="clipboard-button" data-clipboard-text='  config.active_record.db_warnings_action = :raise
  # The following warnings will not be raised
  config.active_record.db_warnings_ignore = [
    /Invalid utf8mb4 character string/,
    "An exact warning message",
    "1062", # MySQL Error 1062: Duplicate entry
  ]
'>Copy</button>  <h3 id="config-active-record-migration-strategy"><a class="anchorlink" href="#config-active-record-migration-strategy">3.8.15 <code>config.active_record.migration_strategy</code></a></h3>
<p>Controls the strategy class used to perform schema statement methods in a migration. The default class delegates to the connection adapter. Custom strategies should inherit from <code>ActiveRecord::Migration::ExecutionStrategy</code>, or may inherit from <code>DefaultStrategy</code>, which will preserve the default behaviour for methods that aren't implemented:</p> <pre data-language="ruby">class CustomMigrationStrategy &lt; ActiveRecord::Migration::DefaultStrategy
  def drop_table(*)
    raise "Dropping tables is not supported!"
  end
end

config.active_record.migration_strategy = CustomMigrationStrategy</pre> <button class="clipboard-button" data-clipboard-text='class CustomMigrationStrategy &lt; ActiveRecord::Migration::DefaultStrategy
  def drop_table(*)
    raise "Dropping tables is not supported!"
  end
end

config.active_record.migration_strategy = CustomMigrationStrategy
'>Copy</button>  <h3 id="config-active-record-lock-optimistically"><a class="anchorlink" href="#config-active-record-lock-optimistically">3.8.16 <code>config.active_record.lock_optimistically</code></a></h3>
<p>Controls whether Active Record will use optimistic locking and is <code>true</code> by default.</p>
<h3 id="config-active-record-cache-timestamp-format"><a class="anchorlink" href="#config-active-record-cache-timestamp-format">3.8.17 <code>config.active_record.cache_timestamp_format</code></a></h3>
<p>Controls the format of the timestamp value in the cache key. Default is <code>:usec</code>.</p>
<h3 id="config-active-record-record-timestamps"><a class="anchorlink" href="#config-active-record-record-timestamps">3.8.18 <code>config.active_record.record_timestamps</code></a></h3>
<p>Is a boolean value which controls whether or not timestamping of <code>create</code> and <code>update</code> operations on a model occur. The default value is <code>true</code>.</p>
<h3 id="config-active-record-partial-inserts"><a class="anchorlink" href="#config-active-record-partial-inserts">3.8.19 <code>config.active_record.partial_inserts</code></a></h3>
<p>Is a boolean value and controls whether or not partial writes are used when creating new records (i.e. whether inserts only set attributes that are different from the default).</p>
<p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>true</code></td> </tr> <tr> <td>7.0</td> <td><code>false</code></td> </tr> </tbody>
</table> <h3 id="config-active-record-partial-updates"><a class="anchorlink" href="#config-active-record-partial-updates">3.8.20 <code>config.active_record.partial_updates</code></a></h3>
<p>Is a boolean value and controls whether or not partial writes are used when updating existing records (i.e. whether updates only set attributes that are dirty). Note that when using partial updates, you should also use optimistic locking <code>config.active_record.lock_optimistically</code> since concurrent updates may write attributes based on a possibly stale read state. The default value is <code>true</code>.</p>
<h3 id="config-active-record-maintain-test-schema"><a class="anchorlink" href="#config-active-record-maintain-test-schema">3.8.21 <code>config.active_record.maintain_test_schema</code></a></h3>
<p>Is a boolean value which controls whether Active Record should try to keep your test database schema up-to-date with <code>db/schema.rb</code> (or <code>db/structure.sql</code>) when you run your tests. The default is <code>true</code>.</p>
<h3 id="config-active-record-dump-schema-after-migration"><a class="anchorlink" href="#config-active-record-dump-schema-after-migration">3.8.22 <code>config.active_record.dump_schema_after_migration</code></a></h3>
<p>Is a flag which controls whether or not schema dump should happen (<code>db/schema.rb</code> or <code>db/structure.sql</code>) when you run migrations. This is set to <code>false</code> in <code>config/environments/production.rb</code> which is generated by Rails. The default value is <code>true</code> if this configuration is not set.</p>
<h3 id="config-active-record-dump-schemas"><a class="anchorlink" href="#config-active-record-dump-schemas">3.8.23 <code>config.active_record.dump_schemas</code></a></h3>
<p>Controls which database schemas will be dumped when calling <code>db:schema:dump</code>. The options are <code>:schema_search_path</code> (the default) which dumps any schemas listed in <code>schema_search_path</code>, <code>:all</code> which always dumps all schemas regardless of the <code>schema_search_path</code>, or a string of comma separated schemas.</p>
<h3 id="config-active-record-before-committed-on-all-records"><a class="anchorlink" href="#config-active-record-before-committed-on-all-records">3.8.24 <code>config.active_record.before_committed_on_all_records</code></a></h3>
<p>Enable before_committed! callbacks on all enrolled records in a transaction. The previous behavior was to only run the callbacks on the first copy of a record if there were multiple copies of the same record enrolled in the transaction.</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>false</code></td> </tr> <tr> <td>7.1</td> <td><code>true</code></td> </tr> </tbody>
</table> <h3 id="config-active-record-belongs-to-required-by-default"><a class="anchorlink" href="#config-active-record-belongs-to-required-by-default">3.8.25 <code>config.active_record.belongs_to_required_by_default</code></a></h3>
<p>Is a boolean value and controls whether a record fails validation if <code>belongs_to</code> association is not present.</p>
<p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>nil</code></td> </tr> <tr> <td>5.0</td> <td><code>true</code></td> </tr> </tbody>
</table> <h3 id="config-active-record-belongs-to-required-validates-foreign-key"><a class="anchorlink" href="#config-active-record-belongs-to-required-validates-foreign-key">3.8.26 <code>config.active_record.belongs_to_required_validates_foreign_key</code></a></h3>
<p>Enable validating only parent-related columns for presence when the parent is mandatory. The previous behavior was to validate the presence of the parent record, which performed an extra query to get the parent every time the child record was updated, even when parent has not changed.</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>true</code></td> </tr> <tr> <td>7.1</td> <td><code>false</code></td> </tr> </tbody>
</table> <h3 id="config-active-record-marshalling-format-version"><a class="anchorlink" href="#config-active-record-marshalling-format-version">3.8.27 <code>config.active_record.marshalling_format_version</code></a></h3>
<p>When set to <code>7.1</code>, enables a more efficient serialization of Active Record instance with <code>Marshal.dump</code>.</p>
<p>This changes the serialization format, so models serialized this way cannot be read by older (&lt; 7.1) versions of Rails. However, messages that use the old format can still be read, regardless of whether this optimization is enabled.</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>6.1</code></td> </tr> <tr> <td>7.1</td> <td><code>7.1</code></td> </tr> </tbody>
</table> <h3 id="config-active-record-action-on-strict-loading-violation"><a class="anchorlink" href="#config-active-record-action-on-strict-loading-violation">3.8.28 <code>config.active_record.action_on_strict_loading_violation</code></a></h3>
<p>Enables raising or logging an exception if strict_loading is set on an association. The default value is <code>:raise</code> in all environments. It can be changed to <code>:log</code> to send violations to the logger instead of raising.</p>
<h3 id="config-active-record-strict-loading-by-default"><a class="anchorlink" href="#config-active-record-strict-loading-by-default">3.8.29 <code>config.active_record.strict_loading_by_default</code></a></h3>
<p>Is a boolean value that either enables or disables strict_loading mode by default. Defaults to <code>false</code>.</p>
<h3 id="config-active-record-warn-on-records-fetched-greater-than"><a class="anchorlink" href="#config-active-record-warn-on-records-fetched-greater-than">3.8.30 <code>config.active_record.warn_on_records_fetched_greater_than</code></a></h3>
<p>Allows setting a warning threshold for query result size. If the number of records returned by a query exceeds the threshold, a warning is logged. This can be used to identify queries which might be causing a memory bloat.</p>
<h3 id="config-active-record-index-nested-attribute-errors"><a class="anchorlink" href="#config-active-record-index-nested-attribute-errors">3.8.31 <code>config.active_record.index_nested_attribute_errors</code></a></h3>
<p>Allows errors for nested <code>has_many</code> relationships to be displayed with an index as well as the error. Defaults to <code>false</code>.</p>
<h3 id="config-active-record-use-schema-cache-dump"><a class="anchorlink" href="#config-active-record-use-schema-cache-dump">3.8.32 <code>config.active_record.use_schema_cache_dump</code></a></h3>
<p>Enables users to get schema cache information from <code>db/schema_cache.yml</code> (generated by <code>bin/rails db:schema:cache:dump</code>), instead of having to send a query to the database to get this information. Defaults to <code>true</code>.</p>
<h3 id="config-active-record-cache-versioning"><a class="anchorlink" href="#config-active-record-cache-versioning">3.8.33 <code>config.active_record.cache_versioning</code></a></h3>
<p>Indicates whether to use a stable <code>#cache_key</code> method that is accompanied by a changing version in the <code>#cache_version</code> method.</p>
<p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>false</code></td> </tr> <tr> <td>5.2</td> <td><code>true</code></td> </tr> </tbody>
</table> <h3 id="config-active-record-collection-cache-versioning"><a class="anchorlink" href="#config-active-record-collection-cache-versioning">3.8.34 <code>config.active_record.collection_cache_versioning</code></a></h3>
<p>Enables the same cache key to be reused when the object being cached of type <code>ActiveRecord::Relation</code> changes by moving the volatile information (max updated at and count) of the relation's cache key into the cache version to support recycling cache key.</p>
<p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>false</code></td> </tr> <tr> <td>6.0</td> <td><code>true</code></td> </tr> </tbody>
</table> <h3 id="config-active-record-has-many-inversing"><a class="anchorlink" href="#config-active-record-has-many-inversing">3.8.35 <code>config.active_record.has_many_inversing</code></a></h3>
<p>Enables setting the inverse record when traversing <code>belongs_to</code> to <code>has_many</code> associations.</p>
<p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>false</code></td> </tr> <tr> <td>6.1</td> <td><code>true</code></td> </tr> </tbody>
</table> <h3 id="config-active-record-automatic-scope-inversing"><a class="anchorlink" href="#config-active-record-automatic-scope-inversing">3.8.36 <code>config.active_record.automatic_scope_inversing</code></a></h3>
<p>Enables automatically inferring the <code>inverse_of</code> for associations with a scope.</p>
<p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>false</code></td> </tr> <tr> <td>7.0</td> <td><code>true</code></td> </tr> </tbody>
</table> <h3 id="config-active-record-destroy-association-async-job"><a class="anchorlink" href="#config-active-record-destroy-association-async-job">3.8.37 <code>config.active_record.destroy_association_async_job</code></a></h3>
<p>Allows specifying the job that will be used to destroy the associated records in background. It defaults to <code>ActiveRecord::DestroyAssociationAsyncJob</code>.</p>
<h3 id="config-active-record-destroy-association-async-batch-size"><a class="anchorlink" href="#config-active-record-destroy-association-async-batch-size">3.8.38 <code>config.active_record.destroy_association_async_batch_size</code></a></h3>
<p>Allows specifying the maximum number of records that will be destroyed in a background job by the <code>dependent: :destroy_async</code> association option. All else equal, a lower batch size will enqueue more, shorter-running background jobs, while a higher batch size will enqueue fewer, longer-running background jobs. This option defaults to <code>nil</code>, which will cause all dependent records for a given association to be destroyed in the same background job.</p>
<h3 id="config-active-record-queues-destroy"><a class="anchorlink" href="#config-active-record-queues-destroy">3.8.39 <code>config.active_record.queues.destroy</code></a></h3>
<p>Allows specifying the Active Job queue to use for destroy jobs. When this option is <code>nil</code>, purge jobs are sent to the default Active Job queue (see <code>config.active_job.default_queue_name</code>). It defaults to <code>nil</code>.</p>
<h3 id="config-active-record-enumerate-columns-in-select-statements"><a class="anchorlink" href="#config-active-record-enumerate-columns-in-select-statements">3.8.40 <code>config.active_record.enumerate_columns_in_select_statements</code></a></h3>
<p>When <code>true</code>, will always include column names in <code>SELECT</code> statements, and avoid wildcard <code>SELECT * FROM ...</code> queries. This avoids prepared statement cache errors when adding columns to a PostgreSQL database for example. Defaults to <code>false</code>.</p>
<h3 id="config-active-record-verify-foreign-keys-for-fixtures"><a class="anchorlink" href="#config-active-record-verify-foreign-keys-for-fixtures">3.8.41 <code>config.active_record.verify_foreign_keys_for_fixtures</code></a></h3>
<p>Ensures all foreign key constraints are valid after fixtures are loaded in tests. Supported by PostgreSQL and SQLite only.</p>
<p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>false</code></td> </tr> <tr> <td>7.0</td> <td><code>true</code></td> </tr> </tbody>
</table> <h3 id="config-active-record-commit-transaction-on-non-local-return"><a class="anchorlink" href="#config-active-record-commit-transaction-on-non-local-return">3.8.42 <code>config.active_record.commit_transaction_on_non_local_return</code></a></h3>
<p>Defines whether <code>return</code>, <code>break</code> and <code>throw</code> inside a <code>transaction</code> block cause the transaction to be committed or rolled back. e.g.:</p> <pre data-language="ruby">Model.transaction do
  model.save
  return
  other_model.save # not executed
end</pre> <button class="clipboard-button" data-clipboard-text="Model.transaction do
  model.save
  return
  other_model.save # not executed
end
">Copy</button>  <p>If set to <code>false</code>, it will be rolled back.</p>
<p>If set to <code>true</code>, the above transaction will be committed.</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>false</code></td> </tr> <tr> <td>7.1</td> <td><code>true</code></td> </tr> </tbody>
</table> <p>Historically only raised errors would trigger a rollback, but in Ruby <code>2.3</code>, the <code>timeout</code> library started using <code>throw</code> to interrupt execution which had the adverse effect of committing open transactions.</p>
<p>To solve this, in Active Record 6.1 the behavior was changed to instead rollback the transaction as it was safer than to potentially commit an incomplete transaction.</p>
<p>Using <code>return</code>, <code>break</code> or <code>throw</code> inside a <code>transaction</code> block was essentially deprecated from Rails 6.1 onwards.</p>
<p>However with the release of <code>timeout 0.4.0</code>, <code>Timeout.timeout</code> now raises an error again, and Active Record is able to return to its original, less surprising, behavior.</p>
<h3 id="config-active-record-raise-on-assign-to-attr-readonly"><a class="anchorlink" href="#config-active-record-raise-on-assign-to-attr-readonly">3.8.43 <code>config.active_record.raise_on_assign_to_attr_readonly</code></a></h3>
<p>Enable raising on assignment to attr_readonly attributes. The previous behavior would allow assignment but silently not persist changes to the database.</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>false</code></td> </tr> <tr> <td>7.1</td> <td><code>true</code></td> </tr> </tbody>
</table> <h3 id="config-active-record-run-commit-callbacks-on-first-saved-instances-in-transaction"><a class="anchorlink" href="#config-active-record-run-commit-callbacks-on-first-saved-instances-in-transaction">3.8.44 <code>config.active_record.run_commit_callbacks_on_first_saved_instances_in_transaction</code></a></h3>
<p>When multiple Active Record instances change the same record within a transaction, Rails runs <code>after_commit</code> or <code>after_rollback</code> callbacks for only one of them. This option specifies how Rails chooses which instance receives the callbacks.</p>
<p>When <code>true</code>, transactional callbacks are run on the first instance to save, even though its instance state may be stale.</p>
<p>When <code>false</code>, transactional callbacks are run on the instances with the freshest instance state. Those instances are chosen as follows:</p> <ul> <li>In general, run transactional callbacks on the last instance to save a given record within the transaction.</li> <li>There are two exceptions: <ul> <li>If the record is created within the transaction, then updated by another instance, <code>after_create_commit</code> callbacks will be run on the second instance. This is instead of the <code>after_update_commit</code> callbacks that would naively be run based on that instance’s state.</li> <li>If the record is destroyed within the transaction, then <code>after_destroy_commit</code> callbacks will be fired on the last destroyed instance, even if a stale instance subsequently performed an update (which will have affected 0 rows).</li> </ul>
</li> </ul> <p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>true</code></td> </tr> <tr> <td>7.1</td> <td><code>false</code></td> </tr> </tbody>
</table> <h3 id="config-active-record-default-column-serializer"><a class="anchorlink" href="#config-active-record-default-column-serializer">3.8.45 <code>config.active_record.default_column_serializer</code></a></h3>
<p>The serializer implementation to use if none is explicitly specified for a given column.</p>
<p>Historically <code>serialize</code> and <code>store</code> while allowing to use alternative serializer implementations, would use <code>YAML</code> by default, but it's not a very efficient format and can be the source of security vulnerabilities if not carefully employed.</p>
<p>As such it is recommended to prefer stricter, more limited formats for database serialization.</p>
<p>Unfortunately there isn't really any suitable defaults available in Ruby's standard library. <code>JSON</code> could work as a format, but the <code>json</code> gems will cast unsupported types to strings which may lead to bugs.</p>
<p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>YAML</code></td> </tr> <tr> <td>7.1</td> <td><code>nil</code></td> </tr> </tbody>
</table> <h3 id="config-active-record-run-after-transaction-callbacks-in-order-defined"><a class="anchorlink" href="#config-active-record-run-after-transaction-callbacks-in-order-defined">3.8.46 <code>config.active_record.run_after_transaction_callbacks_in_order_defined</code></a></h3>
<p>When <code>true</code>, <code>after_commit</code> callbacks are executed in the order they are defined in a model. When <code>false</code>, they are executed in reverse order.</p>
<p>All other callbacks are always executed in the order they are defined in a model (unless you use <code>prepend: true</code>).</p>
<p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>false</code></td> </tr> <tr> <td>7.1</td> <td><code>true</code></td> </tr> </tbody>
</table> <h3 id="config-active-record-query-log-tags-enabled"><a class="anchorlink" href="#config-active-record-query-log-tags-enabled">3.8.47 <code>config.active_record.query_log_tags_enabled</code></a></h3>
<p>Specifies whether or not to enable adapter-level query comments. Defaults to <code>false</code>.</p>
<div class="note"><p>When this is set to <code>true</code> database prepared statements will be automatically disabled.</p></div>
<h3 id="config-active-record-query-log-tags"><a class="anchorlink" href="#config-active-record-query-log-tags">3.8.48 <code>config.active_record.query_log_tags</code></a></h3>
<p>Define an <code>Array</code> specifying the key/value tags to be inserted in an SQL comment. Defaults to <code>[ :application ]</code>, a predefined tag returning the application name.</p>
<h3 id="config-active-record-query-log-tags-format"><a class="anchorlink" href="#config-active-record-query-log-tags-format">3.8.49 <code>config.active_record.query_log_tags_format</code></a></h3>
<p>A <code>Symbol</code> specifying the formatter to use for tags. Valid values are <code>:sqlcommenter</code> and <code>:legacy</code>.</p>
<p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>:legacy</code></td> </tr> <tr> <td>7.1</td> <td><code>:sqlcommenter</code></td> </tr> </tbody>
</table> <h3 id="config-active-record-cache-query-log-tags"><a class="anchorlink" href="#config-active-record-cache-query-log-tags">3.8.50 <code>config.active_record.cache_query_log_tags</code></a></h3>
<p>Specifies whether or not to enable caching of query log tags. For applications that have a large number of queries, caching query log tags can provide a performance benefit when the context does not change during the lifetime of the request or job execution. Defaults to <code>false</code>.</p>
<h3 id="config-active-record-schema-cache-ignored-tables"><a class="anchorlink" href="#config-active-record-schema-cache-ignored-tables">3.8.51 <code>config.active_record.schema_cache_ignored_tables</code></a></h3>
<p>Define the list of table that should be ignored when generating the schema cache. It accepts an <code>Array</code> of strings, representing the table names, or regular expressions.</p>
<h3 id="config-active-record-verbose-query-logs"><a class="anchorlink" href="#config-active-record-verbose-query-logs">3.8.52 <code>config.active_record.verbose_query_logs</code></a></h3>
<p>Specifies if source locations of methods that call database queries should be logged below relevant queries. By default, the flag is <code>true</code> in development and <code>false</code> in all other environments.</p>
<h3 id="config-active-record-sqlite3-adapter-strict-strings-by-default"><a class="anchorlink" href="#config-active-record-sqlite3-adapter-strict-strings-by-default">3.8.53 <code>config.active_record.sqlite3_adapter_strict_strings_by_default</code></a></h3>
<p>Specifies whether the SQLite3Adapter should be used in a strict strings mode. The use of a strict strings mode disables double-quoted string literals.</p>
<p>SQLite has some quirks around double-quoted string literals. It first tries to consider double-quoted strings as identifier names, but if they don't exist it then considers them as string literals. Because of this, typos can silently go unnoticed. For example, it is possible to create an index for a non existing column. See <a href="https://www.sqlite.org/quirks.html#double_quoted_string_literals_are_accepted">SQLite documentation</a> for more details.</p>
<p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>false</code></td> </tr> <tr> <td>7.1</td> <td><code>true</code></td> </tr> </tbody>
</table> <h3 id="config-active-record-async-query-executor"><a class="anchorlink" href="#config-active-record-async-query-executor">3.8.54 <code>config.active_record.async_query_executor</code></a></h3>
<p>Specifies how asynchronous queries are pooled.</p>
<p>It defaults to <code>nil</code>, which means <code>load_async</code> is disabled and instead directly executes queries in the foreground. For queries to actually be performed asynchronously, it must be set to either <code>:global_thread_pool</code> or <code>:multi_thread_pool</code>.</p>
<p><code>:global_thread_pool</code> will use a single pool for all databases the application connects to. This is the preferred configuration for applications with only a single database, or applications which only ever query one database shard at a time.</p>
<p><code>:multi_thread_pool</code> will use one pool per database, and each pool size can be configured individually in <code>database.yml</code> through the <code>max_threads</code> and <code>min_thread</code> properties. This can be useful to applications regularly querying multiple databases at a time, and that need to more precisely define the max concurrency.</p>
<h3 id="config-active-record-global-executor-concurrency"><a class="anchorlink" href="#config-active-record-global-executor-concurrency">3.8.55 <code>config.active_record.global_executor_concurrency</code></a></h3>
<p>Used in conjunction with <code>config.active_record.async_query_executor = :global_thread_pool</code>, defines how many asynchronous queries can be executed concurrently.</p>
<p>Defaults to <code>4</code>.</p>
<p>This number must be considered in accordance with the database pool size configured in <code>database.yml</code>. The connection pool should be large enough to accommodate both the foreground threads (.e.g web server or job worker threads) and background threads.</p>
<h3 id="config-active-record-allow-deprecated-singular-associations-name"><a class="anchorlink" href="#config-active-record-allow-deprecated-singular-associations-name">3.8.56 <code>config.active_record.allow_deprecated_singular_associations_name</code></a></h3>
<p>This enables deprecated behavior wherein singular associations can be referred to by their plural name in <code>where</code> clauses. Setting this to <code>false</code> is more performant.</p> <pre data-language="ruby">class Comment &lt; ActiveRecord::Base
  belongs_to :post
end

Comment.where(post: post_id).count  # =&gt; 5

# When `allow_deprecated_singular_associations_name` is true:
Comment.where(posts: post_id).count # =&gt; 5 (deprecation warning)

# When `allow_deprecated_singular_associations_name` is false:
Comment.where(posts: post_id).count # =&gt; error</pre> <button class="clipboard-button" data-clipboard-text="class Comment &lt; ActiveRecord::Base
  belongs_to :post
end

Comment.where(post: post_id).count  # =&gt; 5

# When `allow_deprecated_singular_associations_name` is true:
Comment.where(posts: post_id).count # =&gt; 5 (deprecation warning)

# When `allow_deprecated_singular_associations_name` is false:
Comment.where(posts: post_id).count # =&gt; error
">Copy</button>  <p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>true</code></td> </tr> <tr> <td>7.1</td> <td><code>false</code></td> </tr> </tbody>
</table> <h3 id="config-active-record-yaml-column-permitted-classes"><a class="anchorlink" href="#config-active-record-yaml-column-permitted-classes">3.8.57 <code>config.active_record.yaml_column_permitted_classes</code></a></h3>
<p>Defaults to <code>[Symbol]</code>. Allows applications to include additional permitted classes to <code>safe_load()</code> on the <code>ActiveRecord::Coders::YAMLColumn</code>.</p>
<h3 id="config-active-record-use-yaml-unsafe-load"><a class="anchorlink" href="#config-active-record-use-yaml-unsafe-load">3.8.58 <code>config.active_record.use_yaml_unsafe_load</code></a></h3>
<p>Defaults to <code>false</code>. Allows applications to opt into using <code>unsafe_load</code> on the <code>ActiveRecord::Coders::YAMLColumn</code>.</p>
<h3 id="config-active-record-raise-int-wider-than-64bit"><a class="anchorlink" href="#config-active-record-raise-int-wider-than-64bit">3.8.59 <code>config.active_record.raise_int_wider_than_64bit</code></a></h3>
<p>Defaults to <code>true</code>. Determines whether to raise an exception or not when the PostgreSQL adapter is provided an integer that is wider than signed 64bit representation.</p>
<h3 id="config-active-record-generate-secure-token-on"><a class="anchorlink" href="#config-active-record-generate-secure-token-on">3.8.60 <code>config.active_record.generate_secure_token_on</code></a></h3>
<p>Controls when to generate a value for <code>has_secure_token</code> declarations. By default, generate the value when the model is initialized:</p> <pre data-language="ruby">class User &lt; ApplicationRecord
  has_secure_token
end

record = User.new
record.token # =&gt; "fwZcXX6SkJBJRogzMdciS7wf"</pre> <button class="clipboard-button" data-clipboard-text='class User &lt; ApplicationRecord
  has_secure_token
end

record = User.new
record.token # =&gt; "fwZcXX6SkJBJRogzMdciS7wf"
'>Copy</button>  <p>With <code>config.active_record.generate_secure_token_on = :create</code>, generate the value when the model is created:</p> <pre data-language="ruby"># config/application.rb

config.active_record.generate_secure_token_on = :create

# app/models/user.rb
class User &lt; ApplicationRecord
  has_secure_token on: :create
end

record = User.new
record.token # =&gt; nil
record.save!
record.token # =&gt; "fwZcXX6SkJBJRogzMdciS7wf"</pre> <button class="clipboard-button" data-clipboard-text='# config/application.rb

config.active_record.generate_secure_token_on = :create

# app/models/user.rb
class User &lt; ApplicationRecord
  has_secure_token on: :create
end

record = User.new
record.token # =&gt; nil
record.save!
record.token # =&gt; "fwZcXX6SkJBJRogzMdciS7wf"
'>Copy</button>  <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>:create</code></td> </tr> <tr> <td>7.1</td> <td><code>:initialize</code></td> </tr> </tbody>
</table> <h3 id="activerecord-connectionadapters-mysql2adapter-emulate-booleans-and-activerecord-connectionadapters-trilogyadapter-emulate-booleans"><a class="anchorlink" href="#activerecord-connectionadapters-mysql2adapter-emulate-booleans-and-activerecord-connectionadapters-trilogyadapter-emulate-booleans">3.8.61 <code>ActiveRecord::ConnectionAdapters::Mysql2Adapter.emulate_booleans</code> and <code>ActiveRecord::ConnectionAdapters::TrilogyAdapter.emulate_booleans</code></a></h3>
<p>Controls whether the Active Record MySQL adapter will consider all <code>tinyint(1)</code> columns as booleans. Defaults to <code>true</code>.</p>
<h3 id="activerecord-connectionadapters-postgresqladapter-create-unlogged-tables"><a class="anchorlink" href="#activerecord-connectionadapters-postgresqladapter-create-unlogged-tables">3.8.62 <code>ActiveRecord::ConnectionAdapters::PostgreSQLAdapter.create_unlogged_tables</code></a></h3>
<p>Controls whether database tables created by PostgreSQL should be "unlogged", which can speed up performance but adds a risk of data loss if the database crashes. It is highly recommended that you do not enable this in a production environment. Defaults to <code>false</code> in all environments.</p>
<p>To enable this for tests:</p> <pre data-language="ruby"># config/environments/test.rb

ActiveSupport.on_load(:active_record_postgresqladapter) do
  self.create_unlogged_tables = true
end</pre> <button class="clipboard-button" data-clipboard-text="# config/environments/test.rb

ActiveSupport.on_load(:active_record_postgresqladapter) do
  self.create_unlogged_tables = true
end
">Copy</button>  <h3 id="activerecord-connectionadapters-postgresqladapter-datetime-type"><a class="anchorlink" href="#activerecord-connectionadapters-postgresqladapter-datetime-type">3.8.63 <code>ActiveRecord::ConnectionAdapters::PostgreSQLAdapter.datetime_type</code></a></h3>
<p>Controls what native type the Active Record PostgreSQL adapter should use when you call <code>datetime</code> in a migration or schema. It takes a symbol which must correspond to one of the configured <code>NATIVE_DATABASE_TYPES</code>. The default is <code>:timestamp</code>, meaning <code>t.datetime</code> in a migration will create a "timestamp without time zone" column.</p>
<p>To use "timestamp with time zone":</p> <pre data-language="ruby"># config/application.rb

ActiveSupport.on_load(:active_record_postgresqladapter) do
  self.datetime_type = :timestamptz
end</pre> <button class="clipboard-button" data-clipboard-text="# config/application.rb

ActiveSupport.on_load(:active_record_postgresqladapter) do
  self.datetime_type = :timestamptz
end
">Copy</button>  <p>You should run <code>bin/rails db:migrate</code> to rebuild your schema.rb if you change this.</p>
<h3 id="activerecord-schemadumper-ignore-tables"><a class="anchorlink" href="#activerecord-schemadumper-ignore-tables">3.8.64 <code>ActiveRecord::SchemaDumper.ignore_tables</code></a></h3>
<p>Accepts an array of tables that should <em>not</em> be included in any generated schema file.</p>
<h3 id="activerecord-schemadumper-fk-ignore-pattern"><a class="anchorlink" href="#activerecord-schemadumper-fk-ignore-pattern">3.8.65 <code>ActiveRecord::SchemaDumper.fk_ignore_pattern</code></a></h3>
<p>Allows setting a different regular expression that will be used to decide whether a foreign key's name should be dumped to db/schema.rb or not. By default, foreign key names starting with <code>fk_rails_</code> are not exported to the database schema dump. Defaults to <code>/^fk_rails_[0-9a-f]{10}$/</code>.</p>
<h3 id="config-active-record-encryption-add-to-filter-parameters"><a class="anchorlink" href="#config-active-record-encryption-add-to-filter-parameters">3.8.66 <code>config.active_record.encryption.add_to_filter_parameters</code></a></h3>
<p>Enables automatic filtering of encrypted attributes on <code>inspect</code>.</p>
<p>The default value is <code>true</code>.</p>
<h3 id="config-active-record-encryption-hash-digest-class"><a class="anchorlink" href="#config-active-record-encryption-hash-digest-class">3.8.67 <code>config.active_record.encryption.hash_digest_class</code></a></h3>
<p>Sets the digest algorithm used by Active Record Encryption.</p>
<p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>OpenSSL::Digest::SHA1</code></td> </tr> <tr> <td>7.1</td> <td><code>OpenSSL::Digest::SHA256</code></td> </tr> </tbody>
</table> <h3 id="config-active-record-encryption-support-sha1-for-non-deterministic-encryption"><a class="anchorlink" href="#config-active-record-encryption-support-sha1-for-non-deterministic-encryption">3.8.68 <code>config.active_record.encryption.support_sha1_for_non_deterministic_encryption</code></a></h3>
<p>Enables support for decrypting existing data encrypted using a SHA-1 digest class. When <code>false</code>, it will only support the digest configured in <code>config.active_record.encryption.hash_digest_class</code>.</p>
<p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>true</code></td> </tr> <tr> <td>7.1</td> <td><code>false</code></td> </tr> </tbody>
</table> <h2 id="configuring-action-controller"><a class="anchorlink" href="#configuring-action-controller">3.9 Configuring Action Controller</a></h2>
<p><code>config.action_controller</code> includes a number of configuration settings:</p>
<h3 id="config-action-controller-asset-host"><a class="anchorlink" href="#config-action-controller-asset-host">3.9.1 <code>config.action_controller.asset_host</code></a></h3>
<p>Sets the host for the assets. Useful when CDNs are used for hosting assets rather than the application server itself. You should only use this if you have a different configuration for Action Mailer, otherwise use <code>config.asset_host</code>.</p>
<h3 id="config-action-controller-perform-caching"><a class="anchorlink" href="#config-action-controller-perform-caching">3.9.2 <code>config.action_controller.perform_caching</code></a></h3>
<p>Configures whether the application should perform the caching features provided by the Action Controller component or not. Set to <code>false</code> in the development environment, <code>true</code> in production. If it's not specified, the default will be <code>true</code>.</p>
<h3 id="config-action-controller-default-static-extension"><a class="anchorlink" href="#config-action-controller-default-static-extension">3.9.3 <code>config.action_controller.default_static_extension</code></a></h3>
<p>Configures the extension used for cached pages. Defaults to <code>.html</code>.</p>
<h3 id="config-action-controller-include-all-helpers"><a class="anchorlink" href="#config-action-controller-include-all-helpers">3.9.4 <code>config.action_controller.include_all_helpers</code></a></h3>
<p>Configures whether all view helpers are available everywhere or are scoped to the corresponding controller. If set to <code>false</code>, <code>UsersHelper</code> methods are only available for views rendered as part of <code>UsersController</code>. If <code>true</code>, <code>UsersHelper</code> methods are available everywhere. The default configuration behavior (when this option is not explicitly set to <code>true</code> or <code>false</code>) is that all view helpers are available to each controller.</p>
<h3 id="config-action-controller-logger"><a class="anchorlink" href="#config-action-controller-logger">3.9.5 <code>config.action_controller.logger</code></a></h3>
<p>Accepts a logger conforming to the interface of Log4r or the default Ruby Logger class, which is then used to log information from Action Controller. Set to <code>nil</code> to disable logging.</p>
<h3 id="config-action-controller-request-forgery-protection-token"><a class="anchorlink" href="#config-action-controller-request-forgery-protection-token">3.9.6 <code>config.action_controller.request_forgery_protection_token</code></a></h3>
<p>Sets the token parameter name for RequestForgery. Calling <code>protect_from_forgery</code> sets it to <code>:authenticity_token</code> by default.</p>
<h3 id="config-action-controller-allow-forgery-protection"><a class="anchorlink" href="#config-action-controller-allow-forgery-protection">3.9.7 <code>config.action_controller.allow_forgery_protection</code></a></h3>
<p>Enables or disables CSRF protection. By default this is <code>false</code> in the test environment and <code>true</code> in all other environments.</p>
<h3 id="config-action-controller-forgery-protection-origin-check"><a class="anchorlink" href="#config-action-controller-forgery-protection-origin-check">3.9.8 <code>config.action_controller.forgery_protection_origin_check</code></a></h3>
<p>Configures whether the HTTP <code>Origin</code> header should be checked against the site's origin as an additional CSRF defense.</p>
<p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>false</code></td> </tr> <tr> <td>5.0</td> <td><code>true</code></td> </tr> </tbody>
</table> <h3 id="config-action-controller-per-form-csrf-tokens"><a class="anchorlink" href="#config-action-controller-per-form-csrf-tokens">3.9.9 <code>config.action_controller.per_form_csrf_tokens</code></a></h3>
<p>Configures whether CSRF tokens are only valid for the method/action they were generated for.</p>
<p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>false</code></td> </tr> <tr> <td>5.0</td> <td><code>true</code></td> </tr> </tbody>
</table> <h3 id="config-action-controller-default-protect-from-forgery"><a class="anchorlink" href="#config-action-controller-default-protect-from-forgery">3.9.10 <code>config.action_controller.default_protect_from_forgery</code></a></h3>
<p>Determines whether forgery protection is added on <code>ActionController::Base</code>.</p>
<p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>false</code></td> </tr> <tr> <td>5.2</td> <td><code>true</code></td> </tr> </tbody>
</table> <h3 id="config-action-controller-relative-url-root"><a class="anchorlink" href="#config-action-controller-relative-url-root">3.9.11 <code>config.action_controller.relative_url_root</code></a></h3>
<p>Can be used to tell Rails that you are <a href="configuring.html#deploy-to-a-subdirectory-relative-url-root">deploying to a subdirectory</a>. The default is <a href="#config-relative-url-root"><code>config.relative_url_root</code></a>.</p>
<h3 id="config-action-controller-permit-all-parameters"><a class="anchorlink" href="#config-action-controller-permit-all-parameters">3.9.12 <code>config.action_controller.permit_all_parameters</code></a></h3>
<p>Sets all the parameters for mass assignment to be permitted by default. The default value is <code>false</code>.</p>
<h3 id="config-action-controller-action-on-unpermitted-parameters"><a class="anchorlink" href="#config-action-controller-action-on-unpermitted-parameters">3.9.13 <code>config.action_controller.action_on_unpermitted_parameters</code></a></h3>
<p>Controls behavior when parameters that are not explicitly permitted are found. The default value is <code>:log</code> in test and development environments, <code>false</code> otherwise. The values can be:</p> <ul> <li>
<code>false</code> to take no action</li> <li>
<code>:log</code> to emit an <code>ActiveSupport::Notifications.instrument</code> event on the <code>unpermitted_parameters.action_controller</code> topic and log at the DEBUG level</li> <li>
<code>:raise</code> to raise a <code>ActionController::UnpermittedParameters</code> exception</li> </ul> <h3 id="config-action-controller-always-permitted-parameters"><a class="anchorlink" href="#config-action-controller-always-permitted-parameters">3.9.14 <code>config.action_controller.always_permitted_parameters</code></a></h3>
<p>Sets a list of permitted parameters that are permitted by default. The default values are <code>['controller', 'action']</code>.</p>
<h3 id="config-action-controller-enable-fragment-cache-logging"><a class="anchorlink" href="#config-action-controller-enable-fragment-cache-logging">3.9.15 <code>config.action_controller.enable_fragment_cache_logging</code></a></h3>
<p>Determines whether to log fragment cache reads and writes in verbose format as follows:</p> <pre data-language="plaintext">Read fragment views/v1/2914079/v1/2914079/recordings/70182313-20160225015037000000/d0bdf2974e1ef6d31685c3b392ad0b74 (0.6ms)
Rendered messages/_message.html.erb in 1.2 ms [cache hit]
Write fragment views/v1/2914079/v1/2914079/recordings/70182313-20160225015037000000/3b4e249ac9d168c617e32e84b99218b5 (1.1ms)
Rendered recordings/threads/_thread.html.erb in 1.5 ms [cache miss]</pre> <button class="clipboard-button" data-clipboard-text="Read fragment views/v1/2914079/v1/2914079/recordings/70182313-20160225015037000000/d0bdf2974e1ef6d31685c3b392ad0b74 (0.6ms)
Rendered messages/_message.html.erb in 1.2 ms [cache hit]
Write fragment views/v1/2914079/v1/2914079/recordings/70182313-20160225015037000000/3b4e249ac9d168c617e32e84b99218b5 (1.1ms)
Rendered recordings/threads/_thread.html.erb in 1.5 ms [cache miss]
">Copy</button>  <p>By default it is set to <code>false</code> which results in following output:</p> <pre data-language="plaintext">Rendered messages/_message.html.erb in 1.2 ms [cache hit]
Rendered recordings/threads/_thread.html.erb in 1.5 ms [cache miss]</pre> <button class="clipboard-button" data-clipboard-text="Rendered messages/_message.html.erb in 1.2 ms [cache hit]
Rendered recordings/threads/_thread.html.erb in 1.5 ms [cache miss]
">Copy</button>  <h3 id="config-action-controller-raise-on-missing-callback-actions"><a class="anchorlink" href="#config-action-controller-raise-on-missing-callback-actions">3.9.16 <code>config.action_controller.raise_on_missing_callback_actions</code></a></h3>
<p>Raises an <code>AbstractController::ActionNotFound</code> when the action specified in callback's <code>:only</code> or <code>:except</code> options is missing in the controller.</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>false</code></td> </tr> <tr> <td>7.1</td> <td>
<code>true</code> (development and test), <code>false</code> (other envs)</td> </tr> </tbody>
</table> <h3 id="config-action-controller-raise-on-open-redirects"><a class="anchorlink" href="#config-action-controller-raise-on-open-redirects">3.9.17 <code>config.action_controller.raise_on_open_redirects</code></a></h3>
<p>Raises an <code>ActionController::Redirecting::UnsafeRedirectError</code> when an unpermitted open redirect occurs.</p>
<p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>false</code></td> </tr> <tr> <td>7.0</td> <td><code>true</code></td> </tr> </tbody>
</table> <h3 id="config-action-controller-log-query-tags-around-actions"><a class="anchorlink" href="#config-action-controller-log-query-tags-around-actions">3.9.18 <code>config.action_controller.log_query_tags_around_actions</code></a></h3>
<p>Determines whether controller context for query tags will be automatically updated via an <code>around_filter</code>. The default value is <code>true</code>.</p>
<h3 id="config-action-controller-wrap-parameters-by-default"><a class="anchorlink" href="#config-action-controller-wrap-parameters-by-default">3.9.19 <code>config.action_controller.wrap_parameters_by_default</code></a></h3>
<p>Configures the <a href="https://edgeapi.rubyonrails.org/classes/ActionController/ParamsWrapper.html"><code>ParamsWrapper</code></a> to wrap json request by default.</p>
<p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>false</code></td> </tr> <tr> <td>7.0</td> <td><code>true</code></td> </tr> </tbody>
</table> <h3 id="actioncontroller-base-wrap-parameters"><a class="anchorlink" href="#actioncontroller-base-wrap-parameters">3.9.20 <code>ActionController::Base.wrap_parameters</code></a></h3>
<p>Configures the <a href="https://edgeapi.rubyonrails.org/classes/ActionController/ParamsWrapper.html"><code>ParamsWrapper</code></a>. This can be called at the top level, or on individual controllers.</p>
<h3 id="config-action-controller-allow-deprecated-parameters-hash-equality"><a class="anchorlink" href="#config-action-controller-allow-deprecated-parameters-hash-equality">3.9.21 <code>config.action_controller.allow_deprecated_parameters_hash_equality</code></a></h3>
<p>Controls behavior of <code>ActionController::Parameters#==</code> with <code>Hash</code> arguments. Value of the setting determines whether an <code>ActionController::Parameters</code> instance is equal to an equivalent <code>Hash</code>.</p>
<p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>true</code></td> </tr> <tr> <td>7.1</td> <td><code>false</code></td> </tr> </tbody>
</table> <h2 id="configuring-action-dispatch"><a class="anchorlink" href="#configuring-action-dispatch">3.10 Configuring Action Dispatch</a></h2>
<h3 id="config-action-dispatch-cookies-serializer"><a class="anchorlink" href="#config-action-dispatch-cookies-serializer">3.10.1 <code>config.action_dispatch.cookies_serializer</code></a></h3>
<p>Specifies which serializer to use for cookies. Accepts the same values as <a href="#config-active-support-message-serializer"><code>config.active_support.message_serializer</code></a>, plus <code>:hybrid</code> which is an alias for <code>:json_allow_marshal</code>.</p>
<p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>:marshal</code></td> </tr> <tr> <td>7.0</td> <td><code>:json</code></td> </tr> </tbody>
</table> <h3 id="config-action-dispatch-debug-exception-log-level"><a class="anchorlink" href="#config-action-dispatch-debug-exception-log-level">3.10.2 <code>config.action_dispatch.debug_exception_log_level</code></a></h3>
<p>Configures the log level used by the <a href="https://edgeapi.rubyonrails.org/classes/ActionDispatch/DebugExceptions.html"><code>ActionDispatch::DebugExceptions</code></a> middleware when logging uncaught exceptions during requests.</p>
<p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>:fatal</code></td> </tr> <tr> <td>7.1</td> <td><code>:error</code></td> </tr> </tbody>
</table> <h3 id="config-action-dispatch-default-headers"><a class="anchorlink" href="#config-action-dispatch-default-headers">3.10.3 <code>config.action_dispatch.default_headers</code></a></h3>
<p>Is a hash with HTTP headers that are set by default in each response.</p>
<p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><pre><code>{<br>  "X-Frame-Options" =&gt; "SAMEORIGIN",<br>  "X-XSS-Protection" =&gt; "1; mode=block",<br>  "X-Content-Type-Options" =&gt; "nosniff",<br>  "X-Download-Options" =&gt; "noopen",<br>  "X-Permitted-Cross-Domain-Policies" =&gt; "none",<br>  "Referrer-Policy" =&gt; "strict-origin-when-cross-origin"<br>}</code></pre></td> </tr> <tr> <td>7.0</td> <td><pre><code>{<br>  "X-Frame-Options" =&gt; "SAMEORIGIN",<br>  "X-XSS-Protection" =&gt; "0",<br>  "X-Content-Type-Options" =&gt; "nosniff",<br>  "X-Download-Options" =&gt; "noopen",<br>  "X-Permitted-Cross-Domain-Policies" =&gt; "none",<br>  "Referrer-Policy" =&gt; "strict-origin-when-cross-origin"<br>}</code></pre></td> </tr> <tr> <td>7.1</td> <td><pre><code>{<br>  "X-Frame-Options" =&gt; "SAMEORIGIN",<br>  "X-XSS-Protection" =&gt; "0",<br>  "X-Content-Type-Options" =&gt; "nosniff",<br>  "X-Permitted-Cross-Domain-Policies" =&gt; "none",<br>  "Referrer-Policy" =&gt; "strict-origin-when-cross-origin"<br>}</code></pre></td> </tr> </tbody>
</table> <h3 id="config-action-dispatch-default-charset"><a class="anchorlink" href="#config-action-dispatch-default-charset">3.10.4 <code>config.action_dispatch.default_charset</code></a></h3>
<p>Specifies the default character set for all renders. Defaults to <code>nil</code>.</p>
<h3 id="config-action-dispatch-tld-length"><a class="anchorlink" href="#config-action-dispatch-tld-length">3.10.5 <code>config.action_dispatch.tld_length</code></a></h3>
<p>Sets the TLD (top-level domain) length for the application. Defaults to <code>1</code>.</p>
<h3 id="config-action-dispatch-ignore-accept-header"><a class="anchorlink" href="#config-action-dispatch-ignore-accept-header">3.10.6 <code>config.action_dispatch.ignore_accept_header</code></a></h3>
<p>Is used to determine whether to ignore accept headers from a request. Defaults to <code>false</code>.</p>
<h3 id="config-action-dispatch-x-sendfile-header"><a class="anchorlink" href="#config-action-dispatch-x-sendfile-header">3.10.7 <code>config.action_dispatch.x_sendfile_header</code></a></h3>
<p>Specifies server specific X-Sendfile header. This is useful for accelerated file sending from server. For example it can be set to 'X-Sendfile' for Apache.</p>
<h3 id="config-action-dispatch-http-auth-salt"><a class="anchorlink" href="#config-action-dispatch-http-auth-salt">3.10.8 <code>config.action_dispatch.http_auth_salt</code></a></h3>
<p>Sets the HTTP Auth salt value. Defaults to <code>'http authentication'</code>.</p>
<h3 id="config-action-dispatch-signed-cookie-salt"><a class="anchorlink" href="#config-action-dispatch-signed-cookie-salt">3.10.9 <code>config.action_dispatch.signed_cookie_salt</code></a></h3>
<p>Sets the signed cookies salt value. Defaults to <code>'signed cookie'</code>.</p>
<h3 id="config-action-dispatch-encrypted-cookie-salt"><a class="anchorlink" href="#config-action-dispatch-encrypted-cookie-salt">3.10.10 <code>config.action_dispatch.encrypted_cookie_salt</code></a></h3>
<p>Sets the encrypted cookies salt value. Defaults to <code>'encrypted cookie'</code>.</p>
<h3 id="config-action-dispatch-encrypted-signed-cookie-salt"><a class="anchorlink" href="#config-action-dispatch-encrypted-signed-cookie-salt">3.10.11 <code>config.action_dispatch.encrypted_signed_cookie_salt</code></a></h3>
<p>Sets the signed encrypted cookies salt value. Defaults to <code>'signed encrypted
cookie'</code>.</p>
<h3 id="config-action-dispatch-authenticated-encrypted-cookie-salt"><a class="anchorlink" href="#config-action-dispatch-authenticated-encrypted-cookie-salt">3.10.12 <code>config.action_dispatch.authenticated_encrypted_cookie_salt</code></a></h3>
<p>Sets the authenticated encrypted cookie salt. Defaults to <code>'authenticated
encrypted cookie'</code>.</p>
<h3 id="config-action-dispatch-encrypted-cookie-cipher"><a class="anchorlink" href="#config-action-dispatch-encrypted-cookie-cipher">3.10.13 <code>config.action_dispatch.encrypted_cookie_cipher</code></a></h3>
<p>Sets the cipher to be used for encrypted cookies. This defaults to <code>"aes-256-gcm"</code>.</p>
<h3 id="config-action-dispatch-signed-cookie-digest"><a class="anchorlink" href="#config-action-dispatch-signed-cookie-digest">3.10.14 <code>config.action_dispatch.signed_cookie_digest</code></a></h3>
<p>Sets the digest to be used for signed cookies. This defaults to <code>"SHA1"</code>.</p>
<h3 id="config-action-dispatch-cookies-rotations"><a class="anchorlink" href="#config-action-dispatch-cookies-rotations">3.10.15 <code>config.action_dispatch.cookies_rotations</code></a></h3>
<p>Allows rotating secrets, ciphers, and digests for encrypted and signed cookies.</p>
<h3 id="config-action-dispatch-use-authenticated-cookie-encryption"><a class="anchorlink" href="#config-action-dispatch-use-authenticated-cookie-encryption">3.10.16 <code>config.action_dispatch.use_authenticated_cookie_encryption</code></a></h3>
<p>Controls whether signed and encrypted cookies use the AES-256-GCM cipher or the older AES-256-CBC cipher.</p>
<p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>false</code></td> </tr> <tr> <td>5.2</td> <td><code>true</code></td> </tr> </tbody>
</table> <h3 id="config-action-dispatch-use-cookies-with-metadata"><a class="anchorlink" href="#config-action-dispatch-use-cookies-with-metadata">3.10.17 <code>config.action_dispatch.use_cookies_with_metadata</code></a></h3>
<p>Enables writing cookies with the purpose metadata embedded.</p>
<p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>false</code></td> </tr> <tr> <td>6.0</td> <td><code>true</code></td> </tr> </tbody>
</table> <h3 id="config-action-dispatch-perform-deep-munge"><a class="anchorlink" href="#config-action-dispatch-perform-deep-munge">3.10.18 <code>config.action_dispatch.perform_deep_munge</code></a></h3>
<p>Configures whether <code>deep_munge</code> method should be performed on the parameters. See <a href="security.html#unsafe-query-generation">Security Guide</a> for more information. It defaults to <code>true</code>.</p>
<h3 id="config-action-dispatch-rescue-responses"><a class="anchorlink" href="#config-action-dispatch-rescue-responses">3.10.19 <code>config.action_dispatch.rescue_responses</code></a></h3>
<p>Configures what exceptions are assigned to an HTTP status. It accepts a hash and you can specify pairs of exception/status. By default, this is defined as:</p> <pre><code class="highlight ruby"><span class="n">config</span><span class="p">.</span><span class="nf">action_dispatch</span><span class="p">.</span><span class="nf">rescue_responses</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s1">'ActionController::RoutingError'</span> <span class="o">=&gt;</span> <span class="ss">:not_found</span><span class="p">,</span>
  <span class="s1">'AbstractController::ActionNotFound'</span> <span class="o">=&gt;</span> <span class="ss">:not_found</span><span class="p">,</span>
  <span class="s1">'ActionController::MethodNotAllowed'</span> <span class="o">=&gt;</span> <span class="ss">:method_not_allowed</span><span class="p">,</span>
  <span class="s1">'ActionController::UnknownHttpMethod'</span> <span class="o">=&gt;</span> <span class="ss">:method_not_allowed</span><span class="p">,</span>
  <span class="s1">'ActionController::NotImplemented'</span> <span class="o">=&gt;</span> <span class="ss">:not_implemented</span><span class="p">,</span>
  <span class="s1">'ActionController::UnknownFormat'</span> <span class="o">=&gt;</span> <span class="ss">:not_acceptable</span><span class="p">,</span>
  <span class="s1">'ActionController::InvalidAuthenticityToken'</span> <span class="o">=&gt;</span> <span class="ss">:unprocessable_entity</span><span class="p">,</span>
  <span class="s1">'ActionController::InvalidCrossOriginRequest'</span> <span class="o">=&gt;</span> <span class="ss">:unprocessable_entity</span><span class="p">,</span>
  <span class="s1">'ActionDispatch::Http::Parameters::ParseError'</span> <span class="o">=&gt;</span> <span class="ss">:bad_request</span><span class="p">,</span>
  <span class="s1">'ActionController::BadRequest'</span> <span class="o">=&gt;</span> <span class="ss">:bad_request</span><span class="p">,</span>
  <span class="s1">'ActionController::ParameterMissing'</span> <span class="o">=&gt;</span> <span class="ss">:bad_request</span><span class="p">,</span>
  <span class="s1">'Rack::QueryParser::ParameterTypeError'</span> <span class="o">=&gt;</span> <span class="ss">:bad_request</span><span class="p">,</span>
  <span class="s1">'Rack::QueryParser::InvalidParameterError'</span> <span class="o">=&gt;</span> <span class="ss">:bad_request</span><span class="p">,</span>
  <span class="s1">'ActiveRecord::RecordNotFound'</span> <span class="o">=&gt;</span> <span class="ss">:not_found</span><span class="p">,</span>
  <span class="s1">'ActiveRecord::StaleObjectError'</span> <span class="o">=&gt;</span> <span class="ss">:conflict</span><span class="p">,</span>
  <span class="s1">'ActiveRecord::RecordInvalid'</span> <span class="o">=&gt;</span> <span class="ss">:unprocessable_entity</span><span class="p">,</span>
  <span class="s1">'ActiveRecord::RecordNotSaved'</span> <span class="o">=&gt;</span> <span class="ss">:unprocessable_entity</span>
<span class="p">}</span>
</code></pre> <button class="clipboard-button" data-clipboard-text="config.action_dispatch.rescue_responses = {
  'ActionController::RoutingError' =&gt; :not_found,
  'AbstractController::ActionNotFound' =&gt; :not_found,
  'ActionController::MethodNotAllowed' =&gt; :method_not_allowed,
  'ActionController::UnknownHttpMethod' =&gt; :method_not_allowed,
  'ActionController::NotImplemented' =&gt; :not_implemented,
  'ActionController::UnknownFormat' =&gt; :not_acceptable,
  'ActionController::InvalidAuthenticityToken' =&gt; :unprocessable_entity,
  'ActionController::InvalidCrossOriginRequest' =&gt; :unprocessable_entity,
  'ActionDispatch::Http::Parameters::ParseError' =&gt; :bad_request,
  'ActionController::BadRequest' =&gt; :bad_request,
  'ActionController::ParameterMissing' =&gt; :bad_request,
  'Rack::QueryParser::ParameterTypeError' =&gt; :bad_request,
  'Rack::QueryParser::InvalidParameterError' =&gt; :bad_request,
  'ActiveRecord::RecordNotFound' =&gt; :not_found,
  'ActiveRecord::StaleObjectError' =&gt; :conflict,
  'ActiveRecord::RecordInvalid' =&gt; :unprocessable_entity,
  'ActiveRecord::RecordNotSaved' =&gt; :unprocessable_entity
}
">Copy</button>  <p>Any exceptions that are not configured will be mapped to 500 Internal Server Error.</p>
<h3 id="config-action-dispatch-cookies-same-site-protection"><a class="anchorlink" href="#config-action-dispatch-cookies-same-site-protection">3.10.20 <code>config.action_dispatch.cookies_same_site_protection</code></a></h3>
<p>Configures the default value of the <code>SameSite</code> attribute when setting cookies. When set to <code>nil</code>, the <code>SameSite</code> attribute is not added. To allow the value of the <code>SameSite</code> attribute to be configured dynamically based on the request, a proc may be specified. For example:</p> <pre><code class="highlight ruby"><span class="n">config</span><span class="p">.</span><span class="nf">action_dispatch</span><span class="p">.</span><span class="nf">cookies_same_site_protection</span> <span class="o">=</span> <span class="o">-&gt;</span><span class="p">(</span><span class="n">request</span><span class="p">)</span> <span class="k">do</span>
  <span class="ss">:strict</span> <span class="k">unless</span> <span class="n">request</span><span class="p">.</span><span class="nf">user_agent</span> <span class="o">==</span> <span class="s2">"TestAgent"</span>
<span class="k">end</span>
</code></pre> <button class="clipboard-button" data-clipboard-text='config.action_dispatch.cookies_same_site_protection = -&gt;(request) do
  :strict unless request.user_agent == "TestAgent"
end
'>Copy</button>  <p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>nil</code></td> </tr> <tr> <td>6.1</td> <td><code>:lax</code></td> </tr> </tbody>
</table> <h3 id="config-action-dispatch-ssl-default-redirect-status"><a class="anchorlink" href="#config-action-dispatch-ssl-default-redirect-status">3.10.21 <code>config.action_dispatch.ssl_default_redirect_status</code></a></h3>
<p>Configures the default HTTP status code used when redirecting non-GET/HEAD requests from HTTP to HTTPS in the <code>ActionDispatch::SSL</code> middleware.</p>
<p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>307</code></td> </tr> <tr> <td>6.1</td> <td><code>308</code></td> </tr> </tbody>
</table> <h3 id="config-action-dispatch-log-rescued-responses"><a class="anchorlink" href="#config-action-dispatch-log-rescued-responses">3.10.22 <code>config.action_dispatch.log_rescued_responses</code></a></h3>
<p>Enables logging those unhandled exceptions configured in <code>rescue_responses</code>. It defaults to <code>true</code>.</p>
<h3 id="actiondispatch-callbacks-before"><a class="anchorlink" href="#actiondispatch-callbacks-before">3.10.23 <code>ActionDispatch::Callbacks.before</code></a></h3>
<p>Takes a block of code to run before the request.</p>
<h3 id="actiondispatch-callbacks-after"><a class="anchorlink" href="#actiondispatch-callbacks-after">3.10.24 <code>ActionDispatch::Callbacks.after</code></a></h3>
<p>Takes a block of code to run after the request.</p>
<h2 id="configuring-action-view"><a class="anchorlink" href="#configuring-action-view">3.11 Configuring Action View</a></h2>
<p><code>config.action_view</code> includes a small number of configuration settings:</p>
<h3 id="config-action-view-cache-template-loading"><a class="anchorlink" href="#config-action-view-cache-template-loading">3.11.1 <code>config.action_view.cache_template_loading</code></a></h3>
<p>Controls whether or not templates should be reloaded on each request. Defaults to <code>!config.enable_reloading</code>.</p>
<h3 id="config-action-view-field-error-proc"><a class="anchorlink" href="#config-action-view-field-error-proc">3.11.2 <code>config.action_view.field_error_proc</code></a></h3>
<p>Provides an HTML generator for displaying errors that come from Active Model. The block is evaluated within the context of an Action View template. The default is</p> <pre><code class="highlight ruby"><span class="no">Proc</span><span class="p">.</span><span class="nf">new</span> <span class="p">{</span> <span class="o">|</span><span class="n">html_tag</span><span class="p">,</span> <span class="n">instance</span><span class="o">|</span> <span class="n">content_tag</span> <span class="ss">:div</span><span class="p">,</span> <span class="n">html_tag</span><span class="p">,</span> <span class="ss">class: </span><span class="s2">"field_with_errors"</span> <span class="p">}</span>
</code></pre> <button class="clipboard-button" data-clipboard-text='Proc.new { |html_tag, instance| content_tag :div, html_tag, class: "field_with_errors" }
'>Copy</button>  <h3 id="config-action-view-default-form-builder"><a class="anchorlink" href="#config-action-view-default-form-builder">3.11.3 <code>config.action_view.default_form_builder</code></a></h3>
<p>Tells Rails which form builder to use by default. The default is <code>ActionView::Helpers::FormBuilder</code>. If you want your form builder class to be loaded after initialization (so it's reloaded on each request in development), you can pass it as a <code>String</code>.</p>
<h3 id="config-action-view-logger"><a class="anchorlink" href="#config-action-view-logger">3.11.4 <code>config.action_view.logger</code></a></h3>
<p>Accepts a logger conforming to the interface of Log4r or the default Ruby Logger class, which is then used to log information from Action View. Set to <code>nil</code> to disable logging.</p>
<h3 id="config-action-view-erb-trim-mode"><a class="anchorlink" href="#config-action-view-erb-trim-mode">3.11.5 <code>config.action_view.erb_trim_mode</code></a></h3>
<p>Gives the trim mode to be used by ERB. It defaults to <code>'-'</code>, which turns on trimming of tail spaces and newline when using <code>&lt;%= -%&gt;</code> or <code>&lt;%= =%&gt;</code>. See the <a href="http://www.kuwata-lab.com/erubis/users-guide.06.html#topics-trimspaces">Erubis documentation</a> for more information.</p>
<h3 id="config-action-view-frozen-string-literal"><a class="anchorlink" href="#config-action-view-frozen-string-literal">3.11.6 <code>config.action_view.frozen_string_literal</code></a></h3>
<p>Compiles the ERB template with the <code># frozen_string_literal: true</code> magic comment, making all string literals frozen and saving allocations. Set to <code>true</code> to enable it for all views.</p>
<h3 id="config-action-view-embed-authenticity-token-in-remote-forms"><a class="anchorlink" href="#config-action-view-embed-authenticity-token-in-remote-forms">3.11.7 <code>config.action_view.embed_authenticity_token_in_remote_forms</code></a></h3>
<p>Allows you to set the default behavior for <code>authenticity_token</code> in forms with <code>remote: true</code>. By default it's set to <code>false</code>, which means that remote forms will not include <code>authenticity_token</code>, which is helpful when you're fragment-caching the form. Remote forms get the authenticity from the <code>meta</code> tag, so embedding is unnecessary unless you support browsers without JavaScript. In such case you can either pass <code>authenticity_token: true</code> as a form option or set this config setting to <code>true</code>.</p>
<h3 id="config-action-view-prefix-partial-path-with-controller-namespace"><a class="anchorlink" href="#config-action-view-prefix-partial-path-with-controller-namespace">3.11.8 <code>config.action_view.prefix_partial_path_with_controller_namespace</code></a></h3>
<p>Determines whether or not partials are looked up from a subdirectory in templates rendered from namespaced controllers. For example, consider a controller named <code>Admin::ArticlesController</code> which renders this template:</p> <pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">render</span> <span class="vi">@article</span> <span class="cp">%&gt;</span>
</code></pre> <button class="clipboard-button" data-clipboard-text="&lt;%= render @article %&gt;
">Copy</button>  <p>The default setting is <code>true</code>, which uses the partial at <code>/admin/articles/_article.erb</code>. Setting the value to <code>false</code> would render <code>/articles/_article.erb</code>, which is the same behavior as rendering from a non-namespaced controller such as <code>ArticlesController</code>.</p>
<h3 id="config-action-view-automatically-disable-submit-tag"><a class="anchorlink" href="#config-action-view-automatically-disable-submit-tag">3.11.9 <code>config.action_view.automatically_disable_submit_tag</code></a></h3>
<p>Determines whether <code>submit_tag</code> should automatically disable on click, this defaults to <code>true</code>.</p>
<h3 id="config-action-view-debug-missing-translation"><a class="anchorlink" href="#config-action-view-debug-missing-translation">3.11.10 <code>config.action_view.debug_missing_translation</code></a></h3>
<p>Determines whether to wrap the missing translations key in a <code>&lt;span&gt;</code> tag or not. This defaults to <code>true</code>.</p>
<h3 id="config-action-view-form-with-generates-remote-forms"><a class="anchorlink" href="#config-action-view-form-with-generates-remote-forms">3.11.11 <code>config.action_view.form_with_generates_remote_forms</code></a></h3>
<p>Determines whether <code>form_with</code> generates remote forms or not.</p>
<p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>5.1</td> <td><code>true</code></td> </tr> <tr> <td>6.1</td> <td><code>false</code></td> </tr> </tbody>
</table> <h3 id="config-action-view-form-with-generates-ids"><a class="anchorlink" href="#config-action-view-form-with-generates-ids">3.11.12 <code>config.action_view.form_with_generates_ids</code></a></h3>
<p>Determines whether <code>form_with</code> generates ids on inputs.</p>
<p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>false</code></td> </tr> <tr> <td>5.2</td> <td><code>true</code></td> </tr> </tbody>
</table> <h3 id="config-action-view-default-enforce-utf8"><a class="anchorlink" href="#config-action-view-default-enforce-utf8">3.11.13 <code>config.action_view.default_enforce_utf8</code></a></h3>
<p>Determines whether forms are generated with a hidden tag that forces older versions of Internet Explorer to submit forms encoded in UTF-8.</p>
<p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>true</code></td> </tr> <tr> <td>6.0</td> <td><code>false</code></td> </tr> </tbody>
</table> <h3 id="config-action-view-image-loading"><a class="anchorlink" href="#config-action-view-image-loading">3.11.14 <code>config.action_view.image_loading</code></a></h3>
<p>Specifies a default value for the <code>loading</code> attribute of <code>&lt;img&gt;</code> tags rendered by the <code>image_tag</code> helper. For example, when set to <code>"lazy"</code>, <code>&lt;img&gt;</code> tags rendered by <code>image_tag</code> will include <code>loading="lazy"</code>, which <a href="https://html.spec.whatwg.org/#lazy-loading-attributes">instructs the browser to wait until an image is near the viewport to load it</a>. (This value can still be overridden per image by passing e.g. <code>loading: "eager"</code> to <code>image_tag</code>.) Defaults to <code>nil</code>.</p>
<h3 id="config-action-view-image-decoding"><a class="anchorlink" href="#config-action-view-image-decoding">3.11.15 <code>config.action_view.image_decoding</code></a></h3>
<p>Specifies a default value for the <code>decoding</code> attribute of <code>&lt;img&gt;</code> tags rendered by the <code>image_tag</code> helper. Defaults to <code>nil</code>.</p>
<h3 id="config-action-view-annotate-rendered-view-with-filenames"><a class="anchorlink" href="#config-action-view-annotate-rendered-view-with-filenames">3.11.16 <code>config.action_view.annotate_rendered_view_with_filenames</code></a></h3>
<p>Determines whether to annotate rendered view with template file names. This defaults to <code>false</code>.</p>
<h3 id="config-action-view-preload-links-header"><a class="anchorlink" href="#config-action-view-preload-links-header">3.11.17 <code>config.action_view.preload_links_header</code></a></h3>
<p>Determines whether <code>javascript_include_tag</code> and <code>stylesheet_link_tag</code> will generate a <code>Link</code> header that preload assets.</p>
<p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>nil</code></td> </tr> <tr> <td>6.1</td> <td><code>true</code></td> </tr> </tbody>
</table> <h3 id="config-action-view-button-to-generates-button-tag"><a class="anchorlink" href="#config-action-view-button-to-generates-button-tag">3.11.18 <code>config.action_view.button_to_generates_button_tag</code></a></h3>
<p>Determines whether <code>button_to</code> will render <code>&lt;button&gt;</code> element, regardless of whether or not the content is passed as the first argument or as a block.</p>
<p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>false</code></td> </tr> <tr> <td>7.0</td> <td><code>true</code></td> </tr> </tbody>
</table> <h3 id="config-action-view-apply-stylesheet-media-default"><a class="anchorlink" href="#config-action-view-apply-stylesheet-media-default">3.11.19 <code>config.action_view.apply_stylesheet_media_default</code></a></h3>
<p>Determines whether <code>stylesheet_link_tag</code> will render <code>screen</code> as the default value for the attribute <code>media</code> when it's not provided.</p>
<p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>true</code></td> </tr> <tr> <td>7.0</td> <td><code>false</code></td> </tr> </tbody>
</table> <h3 id="config-action-view-prepend-content-exfiltration-prevention"><a class="anchorlink" href="#config-action-view-prepend-content-exfiltration-prevention">3.11.20 <code>config.action_view.prepend_content_exfiltration_prevention</code></a></h3>
<p>Determines whether or not the <code>form_tag</code> and <code>button_to</code> helpers will produce HTML tags prepended with browser-safe (but technically invalid) HTML that guarantees their contents cannot be captured by any preceding unclosed tags. The default value is <code>false</code>.</p>
<h3 id="config-action-view-sanitizer-vendor"><a class="anchorlink" href="#config-action-view-sanitizer-vendor">3.11.21 <code>config.action_view.sanitizer_vendor</code></a></h3>
<p>Configures the set of HTML sanitizers used by Action View by setting <code>ActionView::Helpers::SanitizeHelper.sanitizer_vendor</code>. The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> <th>Which parses markup as</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>Rails::HTML4::Sanitizer</code></td> <td>HTML4</td> </tr> <tr> <td>7.1</td> <td>
<code>Rails::HTML5::Sanitizer</code> (see NOTE)</td> <td>HTML5</td> </tr> </tbody>
</table> <div class="note"><p><code>Rails::HTML5::Sanitizer</code> is not supported on JRuby, so on JRuby platforms Rails will fall back to <code>Rails::HTML4::Sanitizer</code>.</p></div>
<h2 id="configuring-action-mailbox"><a class="anchorlink" href="#configuring-action-mailbox">3.12 Configuring Action Mailbox</a></h2>
<p><code>config.action_mailbox</code> provides the following configuration options:</p>
<h3 id="config-action-mailbox-logger"><a class="anchorlink" href="#config-action-mailbox-logger">3.12.1 <code>config.action_mailbox.logger</code></a></h3>
<p>Contains the logger used by Action Mailbox. It accepts a logger conforming to the interface of Log4r or the default Ruby Logger class. The default is <code>Rails.logger</code>.</p> <pre><code class="highlight ruby"><span class="n">config</span><span class="p">.</span><span class="nf">action_mailbox</span><span class="p">.</span><span class="nf">logger</span> <span class="o">=</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">Logger</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="no">STDOUT</span><span class="p">)</span>
</code></pre> <button class="clipboard-button" data-clipboard-text="config.action_mailbox.logger = ActiveSupport::Logger.new(STDOUT)
">Copy</button>  <h3 id="config-action-mailbox-incinerate-after"><a class="anchorlink" href="#config-action-mailbox-incinerate-after">3.12.2 <code>config.action_mailbox.incinerate_after</code></a></h3>
<p>Accepts an <code>ActiveSupport::Duration</code> indicating how long after processing <code>ActionMailbox::InboundEmail</code> records should be destroyed. It defaults to <code>30.days</code>.</p> <pre><code class="highlight ruby"><span class="c1"># Incinerate inbound emails 14 days after processing.</span>
<span class="n">config</span><span class="p">.</span><span class="nf">action_mailbox</span><span class="p">.</span><span class="nf">incinerate_after</span> <span class="o">=</span> <span class="mi">14</span><span class="p">.</span><span class="nf">days</span>
</code></pre> <button class="clipboard-button" data-clipboard-text="# Incinerate inbound emails 14 days after processing.
config.action_mailbox.incinerate_after = 14.days
">Copy</button>  <h3 id="config-action-mailbox-queues-incineration"><a class="anchorlink" href="#config-action-mailbox-queues-incineration">3.12.3 <code>config.action_mailbox.queues.incineration</code></a></h3>
<p>Accepts a symbol indicating the Active Job queue to use for incineration jobs. When this option is <code>nil</code>, incineration jobs are sent to the default Active Job queue (see <code>config.active_job.default_queue_name</code>).</p>
<p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>:action_mailbox_incineration</code></td> </tr> <tr> <td>6.1</td> <td><code>nil</code></td> </tr> </tbody>
</table> <h3 id="config-action-mailbox-queues-routing"><a class="anchorlink" href="#config-action-mailbox-queues-routing">3.12.4 <code>config.action_mailbox.queues.routing</code></a></h3>
<p>Accepts a symbol indicating the Active Job queue to use for routing jobs. When this option is <code>nil</code>, routing jobs are sent to the default Active Job queue (see <code>config.active_job.default_queue_name</code>).</p>
<p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>:action_mailbox_routing</code></td> </tr> <tr> <td>6.1</td> <td><code>nil</code></td> </tr> </tbody>
</table> <h3 id="config-action-mailbox-storage-service"><a class="anchorlink" href="#config-action-mailbox-storage-service">3.12.5 <code>config.action_mailbox.storage_service</code></a></h3>
<p>Accepts a symbol indicating the Active Storage service to use for uploading emails. When this option is <code>nil</code>, emails are uploaded to the default Active Storage service (see <code>config.active_storage.service</code>).</p>
<h2 id="configuring-action-mailer"><a class="anchorlink" href="#configuring-action-mailer">3.13 Configuring Action Mailer</a></h2>
<p>There are a number of settings available on <code>config.action_mailer</code>:</p>
<h3 id="config-action-mailer-asset-host"><a class="anchorlink" href="#config-action-mailer-asset-host">3.13.1 <code>config.action_mailer.asset_host</code></a></h3>
<p>Sets the host for the assets. Useful when CDNs are used for hosting assets rather than the application server itself. You should only use this if you have a different configuration for Action Controller, otherwise use <code>config.asset_host</code>.</p>
<h3 id="config-action-mailer-logger"><a class="anchorlink" href="#config-action-mailer-logger">3.13.2 <code>config.action_mailer.logger</code></a></h3>
<p>Accepts a logger conforming to the interface of Log4r or the default Ruby Logger class, which is then used to log information from Action Mailer. Set to <code>nil</code> to disable logging.</p>
<h3 id="config-action-mailer-smtp-settings"><a class="anchorlink" href="#config-action-mailer-smtp-settings">3.13.3 <code>config.action_mailer.smtp_settings</code></a></h3>
<p>Allows detailed configuration for the <code>:smtp</code> delivery method. It accepts a hash of options, which can include any of these options:</p> <ul> <li>
<code>:address</code> - Allows you to use a remote mail server. Just change it from its default "localhost" setting.</li> <li>
<code>:port</code> - On the off chance that your mail server doesn't run on port 25, you can change it.</li> <li>
<code>:domain</code> - If you need to specify a HELO domain, you can do it here.</li> <li>
<code>:user_name</code> - If your mail server requires authentication, set the username in this setting.</li> <li>
<code>:password</code> - If your mail server requires authentication, set the password in this setting.</li> <li>
<code>:authentication</code> - If your mail server requires authentication, you need to specify the authentication type here. This is a symbol and one of <code>:plain</code>, <code>:login</code>, <code>:cram_md5</code>.</li> <li>
<code>:enable_starttls</code> - Use STARTTLS when connecting to your SMTP server and fail if unsupported. It defaults to <code>false</code>.</li> <li>
<code>:enable_starttls_auto</code> - Detects if STARTTLS is enabled in your SMTP server and starts to use it. It defaults to <code>true</code>.</li> <li>
<code>:openssl_verify_mode</code> - When using TLS, you can set how OpenSSL checks the certificate. This is useful if you need to validate a self-signed and/or a wildcard certificate. This can be one of the OpenSSL verify constants, <code>:none</code> or <code>:peer</code> -- or the constant directly <code>OpenSSL::SSL::VERIFY_NONE</code> or <code>OpenSSL::SSL::VERIFY_PEER</code>, respectively.</li> <li>
<code>:ssl/:tls</code> - Enables the SMTP connection to use SMTP/TLS (SMTPS: SMTP over direct TLS connection).</li> <li>
<code>:open_timeout</code> - Number of seconds to wait while attempting to open a connection.</li> <li>
<code>:read_timeout</code> - Number of seconds to wait until timing-out a read(2) call.</li> </ul> <p>Additionally, it is possible to pass any <a href="https://github.com/mikel/mail/blob/master/lib/mail/network/delivery_methods/smtp.rb">configuration option <code>Mail::SMTP</code> respects</a>.</p>
<h3 id="config-action-mailer-smtp-timeout"><a class="anchorlink" href="#config-action-mailer-smtp-timeout">3.13.4 <code>config.action_mailer.smtp_timeout</code></a></h3>
<p>Allows to configure both the <code>:open_timeout</code> and <code>:read_timeout</code> values for <code>:smtp</code> delivery method.</p>
<p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>nil</code></td> </tr> <tr> <td>7.0</td> <td><code>5</code></td> </tr> </tbody>
</table> <h3 id="config-action-mailer-sendmail-settings"><a class="anchorlink" href="#config-action-mailer-sendmail-settings">3.13.5 <code>config.action_mailer.sendmail_settings</code></a></h3>
<p>Allows detailed configuration for the <code>sendmail</code> delivery method. It accepts a hash of options, which can include any of these options:</p> <ul> <li>
<code>:location</code> - The location of the sendmail executable. Defaults to <code>/usr/sbin/sendmail</code>.</li> <li>
<code>:arguments</code> - The command line arguments. Defaults to <code>%w[ -i ]</code>.</li> </ul> <h3 id="config-action-mailer-raise-delivery-errors"><a class="anchorlink" href="#config-action-mailer-raise-delivery-errors">3.13.6 <code>config.action_mailer.raise_delivery_errors</code></a></h3>
<p>Specifies whether to raise an error if email delivery cannot be completed. It defaults to <code>true</code>.</p>
<h3 id="config-action-mailer-delivery-method"><a class="anchorlink" href="#config-action-mailer-delivery-method">3.13.7 <code>config.action_mailer.delivery_method</code></a></h3>
<p>Defines the delivery method and defaults to <code>:smtp</code>. See the <a href="action_mailer_basics.html#action-mailer-configuration">configuration section in the Action Mailer guide</a> for more info.</p>
<h3 id="config-action-mailer-perform-deliveries"><a class="anchorlink" href="#config-action-mailer-perform-deliveries">3.13.8 <code>config.action_mailer.perform_deliveries</code></a></h3>
<p>Specifies whether mail will actually be delivered and is <code>true</code> by default. It can be convenient to set it to <code>false</code> for testing.</p>
<h3 id="config-action-mailer-default-options"><a class="anchorlink" href="#config-action-mailer-default-options">3.13.9 <code>config.action_mailer.default_options</code></a></h3>
<p>Configures Action Mailer defaults. Use to set options like <code>from</code> or <code>reply_to</code> for every mailer. These default to:</p> <pre><code class="highlight ruby"><span class="p">{</span>
  <span class="ss">mime_version:  </span><span class="s2">"1.0"</span><span class="p">,</span>
  <span class="ss">charset:       </span><span class="s2">"UTF-8"</span><span class="p">,</span>
  <span class="ss">content_type: </span><span class="s2">"text/plain"</span><span class="p">,</span>
  <span class="ss">parts_order:  </span><span class="p">[</span><span class="s2">"text/plain"</span><span class="p">,</span> <span class="s2">"text/enriched"</span><span class="p">,</span> <span class="s2">"text/html"</span><span class="p">]</span>
<span class="p">}</span>
</code></pre> <button class="clipboard-button" data-clipboard-text='{
  mime_version:  "1.0",
  charset:       "UTF-8",
  content_type: "text/plain",
  parts_order:  ["text/plain", "text/enriched", "text/html"]
}
'>Copy</button>  <p>Assign a hash to set additional options:</p> <pre><code class="highlight ruby"><span class="n">config</span><span class="p">.</span><span class="nf">action_mailer</span><span class="p">.</span><span class="nf">default_options</span> <span class="o">=</span> <span class="p">{</span>
  <span class="ss">from: </span><span class="s2">"noreply@example.com"</span>
<span class="p">}</span>
</code></pre> <button class="clipboard-button" data-clipboard-text='config.action_mailer.default_options = {
  from: "noreply@example.com"
}
'>Copy</button>  <h3 id="config-action-mailer-observers"><a class="anchorlink" href="#config-action-mailer-observers">3.13.10 <code>config.action_mailer.observers</code></a></h3>
<p>Registers observers which will be notified when mail is delivered.</p> <pre><code class="highlight ruby"><span class="n">config</span><span class="p">.</span><span class="nf">action_mailer</span><span class="p">.</span><span class="nf">observers</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"MailObserver"</span><span class="p">]</span>
</code></pre> <button class="clipboard-button" data-clipboard-text='config.action_mailer.observers = ["MailObserver"]
'>Copy</button>  <h3 id="config-action-mailer-interceptors"><a class="anchorlink" href="#config-action-mailer-interceptors">3.13.11 <code>config.action_mailer.interceptors</code></a></h3>
<p>Registers interceptors which will be called before mail is sent.</p> <pre><code class="highlight ruby"><span class="n">config</span><span class="p">.</span><span class="nf">action_mailer</span><span class="p">.</span><span class="nf">interceptors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"MailInterceptor"</span><span class="p">]</span>
</code></pre> <button class="clipboard-button" data-clipboard-text='config.action_mailer.interceptors = ["MailInterceptor"]
'>Copy</button>  <h3 id="config-action-mailer-preview-interceptors"><a class="anchorlink" href="#config-action-mailer-preview-interceptors">3.13.12 <code>config.action_mailer.preview_interceptors</code></a></h3>
<p>Registers interceptors which will be called before mail is previewed.</p> <pre><code class="highlight ruby"><span class="n">config</span><span class="p">.</span><span class="nf">action_mailer</span><span class="p">.</span><span class="nf">preview_interceptors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"MyPreviewMailInterceptor"</span><span class="p">]</span>
</code></pre> <button class="clipboard-button" data-clipboard-text='config.action_mailer.preview_interceptors = ["MyPreviewMailInterceptor"]
'>Copy</button>  <h3 id="config-action-mailer-preview-paths"><a class="anchorlink" href="#config-action-mailer-preview-paths">3.13.13 <code>config.action_mailer.preview_paths</code></a></h3>
<p>Specifies the locations of mailer previews. Appending paths to this configuration option will cause those paths to be used in the search for mailer previews.</p> <pre><code class="highlight ruby"><span class="n">config</span><span class="p">.</span><span class="nf">action_mailer</span><span class="p">.</span><span class="nf">preview_paths</span> <span class="o">&lt;&lt;</span> <span class="s2">"</span><span class="si">#{</span><span class="no">Rails</span><span class="p">.</span><span class="nf">root</span><span class="si">}</span><span class="s2">/lib/mailer_previews"</span>
</code></pre> <button class="clipboard-button" data-clipboard-text='config.action_mailer.preview_paths &lt;&lt; "#{Rails.root}/lib/mailer_previews"
'>Copy</button>  <h3 id="config-action-mailer-show-previews"><a class="anchorlink" href="#config-action-mailer-show-previews">3.13.14 <code>config.action_mailer.show_previews</code></a></h3>
<p>Enable or disable mailer previews. By default this is <code>true</code> in development.</p> <pre><code class="highlight ruby"><span class="n">config</span><span class="p">.</span><span class="nf">action_mailer</span><span class="p">.</span><span class="nf">show_previews</span> <span class="o">=</span> <span class="kp">false</span>
</code></pre> <button class="clipboard-button" data-clipboard-text="config.action_mailer.show_previews = false
">Copy</button>  <h3 id="config-action-mailer-perform-caching"><a class="anchorlink" href="#config-action-mailer-perform-caching">3.13.15 <code>config.action_mailer.perform_caching</code></a></h3>
<p>Specifies whether the mailer templates should perform fragment caching or not. If it's not specified, the default will be <code>true</code>.</p>
<h3 id="config-action-mailer-deliver-later-queue-name"><a class="anchorlink" href="#config-action-mailer-deliver-later-queue-name">3.13.16 <code>config.action_mailer.deliver_later_queue_name</code></a></h3>
<p>Specifies the Active Job queue to use for the default delivery job (see <code>config.action_mailer.delivery_job</code>). When this option is set to <code>nil</code>, delivery jobs are sent to the default Active Job queue (see <code>config.active_job.default_queue_name</code>).</p>
<p>Mailer classes can override this to use a different queue. Note that this only applies when using the default delivery job. If your mailer is using a custom job, its queue will be used.</p>
<p>Ensure that your Active Job adapter is also configured to process the specified queue, otherwise delivery jobs may be silently ignored.</p>
<p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>:mailers</code></td> </tr> <tr> <td>6.1</td> <td><code>nil</code></td> </tr> </tbody>
</table> <h3 id="config-action-mailer-delivery-job"><a class="anchorlink" href="#config-action-mailer-delivery-job">3.13.17 <code>config.action_mailer.delivery_job</code></a></h3>
<p>Specifies delivery job for mail.</p>
<p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>ActionMailer::MailDeliveryJob</code></td> </tr> <tr> <td>6.0</td> <td><code>"ActionMailer::MailDeliveryJob"</code></td> </tr> </tbody>
</table> <h2 id="configuring-active-support"><a class="anchorlink" href="#configuring-active-support">3.14 Configuring Active Support</a></h2>
<p>There are a few configuration options available in Active Support:</p>
<h3 id="config-active-support-bare"><a class="anchorlink" href="#config-active-support-bare">3.14.1 <code>config.active_support.bare</code></a></h3>
<p>Enables or disables the loading of <code>active_support/all</code> when booting Rails. Defaults to <code>nil</code>, which means <code>active_support/all</code> is loaded.</p>
<h3 id="config-active-support-test-order"><a class="anchorlink" href="#config-active-support-test-order">3.14.2 <code>config.active_support.test_order</code></a></h3>
<p>Sets the order in which the test cases are executed. Possible values are <code>:random</code> and <code>:sorted</code>. Defaults to <code>:random</code>.</p>
<h3 id="config-active-support-escape-html-entities-in-json"><a class="anchorlink" href="#config-active-support-escape-html-entities-in-json">3.14.3 <code>config.active_support.escape_html_entities_in_json</code></a></h3>
<p>Enables or disables the escaping of HTML entities in JSON serialization. Defaults to <code>true</code>.</p>
<h3 id="config-active-support-use-standard-json-time-format"><a class="anchorlink" href="#config-active-support-use-standard-json-time-format">3.14.4 <code>config.active_support.use_standard_json_time_format</code></a></h3>
<p>Enables or disables serializing dates to ISO 8601 format. Defaults to <code>true</code>.</p>
<h3 id="config-active-support-time-precision"><a class="anchorlink" href="#config-active-support-time-precision">3.14.5 <code>config.active_support.time_precision</code></a></h3>
<p>Sets the precision of JSON encoded time values. Defaults to <code>3</code>.</p>
<h3 id="config-active-support-hash-digest-class"><a class="anchorlink" href="#config-active-support-hash-digest-class">3.14.6 <code>config.active_support.hash_digest_class</code></a></h3>
<p>Allows configuring the digest class to use to generate non-sensitive digests, such as the ETag header.</p>
<p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>OpenSSL::Digest::MD5</code></td> </tr> <tr> <td>5.2</td> <td><code>OpenSSL::Digest::SHA1</code></td> </tr> <tr> <td>7.0</td> <td><code>OpenSSL::Digest::SHA256</code></td> </tr> </tbody>
</table> <h3 id="config-active-support-key-generator-hash-digest-class"><a class="anchorlink" href="#config-active-support-key-generator-hash-digest-class">3.14.7 <code>config.active_support.key_generator_hash_digest_class</code></a></h3>
<p>Allows configuring the digest class to use to derive secrets from the configured secret base, such as for encrypted cookies.</p>
<p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>OpenSSL::Digest::SHA1</code></td> </tr> <tr> <td>7.0</td> <td><code>OpenSSL::Digest::SHA256</code></td> </tr> </tbody>
</table> <h3 id="config-active-support-use-authenticated-message-encryption"><a class="anchorlink" href="#config-active-support-use-authenticated-message-encryption">3.14.8 <code>config.active_support.use_authenticated_message_encryption</code></a></h3>
<p>Specifies whether to use AES-256-GCM authenticated encryption as the default cipher for encrypting messages instead of AES-256-CBC.</p>
<p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>false</code></td> </tr> <tr> <td>5.2</td> <td><code>true</code></td> </tr> </tbody>
</table> <h3 id="config-active-support-message-serializer"><a class="anchorlink" href="#config-active-support-message-serializer">3.14.9 <code>config.active_support.message_serializer</code></a></h3>
<p>Specifies the default serializer used by <a href="https://edgeapi.rubyonrails.org/classes/ActiveSupport/MessageEncryptor.html"><code>ActiveSupport::MessageEncryptor</code></a> and <a href="https://edgeapi.rubyonrails.org/classes/ActiveSupport/MessageVerifier.html"><code>ActiveSupport::MessageVerifier</code></a> instances. To make migrating between serializers easier, the provided serializers include a fallback mechanism to support multiple deserialization formats:</p> <table>
<thead> <tr> <th>Serializer</th> <th>Serialize and deserialize</th> <th>Fallback deserialize</th> </tr> </thead>
<tbody> <tr> <td><code>:marshal</code></td> <td><code>Marshal</code></td> <td>
<code>ActiveSupport::JSON</code>, <code>ActiveSupport::MessagePack</code>
</td> </tr> <tr> <td><code>:json</code></td> <td><code>ActiveSupport::JSON</code></td> <td><code>ActiveSupport::MessagePack</code></td> </tr> <tr> <td><code>:json_allow_marshal</code></td> <td><code>ActiveSupport::JSON</code></td> <td>
<code>ActiveSupport::MessagePack</code>, <code>Marshal</code>
</td> </tr> <tr> <td><code>:message_pack</code></td> <td><code>ActiveSupport::MessagePack</code></td> <td><code>ActiveSupport::JSON</code></td> </tr> <tr> <td><code>:message_pack_allow_marshal</code></td> <td><code>ActiveSupport::MessagePack</code></td> <td>
<code>ActiveSupport::JSON</code>, <code>Marshal</code>
</td> </tr> </tbody>
</table> <div class="warning"><p><code>Marshal</code> is a potential vector for deserialization attacks in cases where a message signing secret has been leaked. <em>If possible, choose a serializer that does not support <code>Marshal</code>.</em></p></div>
<div class="info"><p>The <code>:message_pack</code> and <code>:message_pack_allow_marshal</code> serializers support roundtripping some Ruby types that are not supported by JSON, such as <code>Symbol</code>. They can also provide improved performance and smaller payload sizes. However, they require the <a href="https://rubygems.org/gems/msgpack"><code>msgpack</code> gem</a>.</p></div>
<p>Each of the above serializers will emit a <a href="active_support_instrumentation.html#message-serializer-fallback-active-support"><code>message_serializer_fallback.active_support</code></a> event notification when they fall back to an alternate deserialization format, allowing you to track how often such fallbacks occur.</p>
<p>Alternatively, you can specify any serializer object that responds to <code>dump</code> and <code>load</code> methods. For example:</p> <pre><code class="highlight ruby"><span class="n">config</span><span class="p">.</span><span class="nf">active_job</span><span class="p">.</span><span class="nf">message_serializer</span> <span class="o">=</span> <span class="no">YAML</span>
</code></pre> <button class="clipboard-button" data-clipboard-text="config.active_job.message_serializer = YAML
">Copy</button>  <p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>:marshal</code></td> </tr> <tr> <td>7.1</td> <td><code>:json_allow_marshal</code></td> </tr> </tbody>
</table> <h3 id="config-active-support-use-message-serializer-for-metadata"><a class="anchorlink" href="#config-active-support-use-message-serializer-for-metadata">3.14.10 <code>config.active_support.use_message_serializer_for_metadata</code></a></h3>
<p>When <code>true</code>, enables a performance optimization that serializes message data and metadata together. This changes the message format, so messages serialized this way cannot be read by older (&lt; 7.1) versions of Rails. However, messages that use the old format can still be read, regardless of whether this optimization is enabled.</p>
<p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>false</code></td> </tr> <tr> <td>7.1</td> <td><code>true</code></td> </tr> </tbody>
</table> <h3 id="config-active-support-cache-format-version"><a class="anchorlink" href="#config-active-support-cache-format-version">3.14.11 <code>config.active_support.cache_format_version</code></a></h3>
<p>Specifies which serialization format to use for the cache. Possible values are <code>6.1</code>, <code>7.0</code>, and <code>7.1</code>.</p>
<p><code>7.0</code> serializes cache entries more efficiently.</p>
<p><code>7.1</code> further improves efficiency, and allows expired and version-mismatched cache entries to be detected without deserializing their values. It also includes an optimization for bare string values such as view fragments.</p>
<p>All formats are backward and forward compatible, meaning cache entries written in one format can be read when using another format. This behavior makes it easy to migrate between formats without invalidating the entire cache.</p>
<p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>6.1</code></td> </tr> <tr> <td>7.0</td> <td><code>7.0</code></td> </tr> <tr> <td>7.1</td> <td><code>7.1</code></td> </tr> </tbody>
</table> <h3 id="config-active-support-deprecation"><a class="anchorlink" href="#config-active-support-deprecation">3.14.12 <code>config.active_support.deprecation</code></a></h3>
<p>Configures the behavior of deprecation warnings. The options are <code>:raise</code>, <code>:stderr</code>, <code>:log</code>, <code>:notify</code>, and <code>:silence</code>.</p>
<p>In the default generated <code>config/environments</code> files, this is set to <code>:log</code> for development and <code>:stderr</code> for test, and it is omitted for production in favor of <a href="#config-active-support-report-deprecations"><code>config.active_support.report_deprecations</code></a>.</p>
<h3 id="config-active-support-disallowed-deprecation"><a class="anchorlink" href="#config-active-support-disallowed-deprecation">3.14.13 <code>config.active_support.disallowed_deprecation</code></a></h3>
<p>Configures the behavior of disallowed deprecation warnings. The options are <code>:raise</code>, <code>:stderr</code>, <code>:log</code>, <code>:notify</code>, and <code>:silence</code>.</p>
<p>In the default generated <code>config/environments</code> files, this is set to <code>:raise</code> for both development and test, and it is omitted for production in favor of <a href="#config-active-support-report-deprecations"><code>config.active_support.report_deprecations</code></a>.</p>
<h3 id="config-active-support-disallowed-deprecation-warnings"><a class="anchorlink" href="#config-active-support-disallowed-deprecation-warnings">3.14.14 <code>config.active_support.disallowed_deprecation_warnings</code></a></h3>
<p>Configures deprecation warnings that the Application considers disallowed. This allows, for example, specific deprecations to be treated as hard failures.</p>
<h3 id="config-active-support-report-deprecations"><a class="anchorlink" href="#config-active-support-report-deprecations">3.14.15 <code>config.active_support.report_deprecations</code></a></h3>
<p>When <code>false</code>, disables all deprecation warnings, including disallowed deprecations, from the <a href="https://edgeapi.rubyonrails.org/classes/Rails/Application.html#method-i-deprecators">application’s deprecators</a>. This includes all the deprecations from Rails and other gems that may add their deprecator to the collection of deprecators, but may not prevent all deprecation warnings emitted from ActiveSupport::Deprecation.</p>
<p>In the default generated <code>config/environments</code> files, this is set to <code>false</code> for production.</p>
<h3 id="config-active-support-isolation-level"><a class="anchorlink" href="#config-active-support-isolation-level">3.14.16 <code>config.active_support.isolation_level</code></a></h3>
<p>Configures the locality of most of Rails internal state. If you use a fiber based server or job processor (e.g. <code>falcon</code>), you should set it to <code>:fiber</code>. Otherwise it is best to use <code>:thread</code> locality. Defaults to <code>:thread</code>.</p>
<h3 id="config-active-support-executor-around-test-case"><a class="anchorlink" href="#config-active-support-executor-around-test-case">3.14.17 <code>config.active_support.executor_around_test_case</code></a></h3>
<p>Configure the test suite to call <code>Rails.application.executor.wrap</code> around test cases. This makes test cases behave closer to an actual request or job. Several features that are normally disabled in test, such as Active Record query cache and asynchronous queries will then be enabled.</p>
<p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>false</code></td> </tr> <tr> <td>7.0</td> <td><code>true</code></td> </tr> </tbody>
</table> <h3 id="activesupport-logger-silencer"><a class="anchorlink" href="#activesupport-logger-silencer">3.14.18 <code>ActiveSupport::Logger.silencer</code></a></h3>
<p>Is set to <code>false</code> to disable the ability to silence logging in a block. The default is <code>true</code>.</p>
<h3 id="activesupport-cache-store-logger"><a class="anchorlink" href="#activesupport-cache-store-logger">3.14.19 <code>ActiveSupport::Cache::Store.logger</code></a></h3>
<p>Specifies the logger to use within cache store operations.</p>
<h3 id="activesupport-to-time-preserves-timezone"><a class="anchorlink" href="#activesupport-to-time-preserves-timezone">3.14.20 <code>ActiveSupport.to_time_preserves_timezone</code></a></h3>
<p>Specifies whether <code>to_time</code> methods preserve the UTC offset of their receivers. If <code>false</code>, <code>to_time</code> methods will convert to the local system UTC offset instead.</p>
<p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>false</code></td> </tr> <tr> <td>5.0</td> <td><code>true</code></td> </tr> </tbody>
</table> <h3 id="activesupport-utc-to-local-returns-utc-offset-times"><a class="anchorlink" href="#activesupport-utc-to-local-returns-utc-offset-times">3.14.21 <code>ActiveSupport.utc_to_local_returns_utc_offset_times</code></a></h3>
<p>Configures <code>ActiveSupport::TimeZone.utc_to_local</code> to return a time with a UTC offset instead of a UTC time incorporating that offset.</p>
<p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>false</code></td> </tr> <tr> <td>6.1</td> <td><code>true</code></td> </tr> </tbody>
</table> <h3 id="config-active-support-raise-on-invalid-cache-expiration-time"><a class="anchorlink" href="#config-active-support-raise-on-invalid-cache-expiration-time">3.14.22 <code>config.active_support.raise_on_invalid_cache_expiration_time</code></a></h3>
<p>Specifies if an <code>ArgumentError</code> should be raised if <code>Rails.cache</code> <code>fetch</code> or <code>write</code> are given an invalid <code>expires_at</code> or <code>expires_in</code> time.</p>
<p>Options are <code>true</code>, and <code>false</code>. If <code>false</code>, the exception will be reported as <code>handled</code> and logged instead.</p>
<p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>false</code></td> </tr> <tr> <td>7.1</td> <td><code>true</code></td> </tr> </tbody>
</table> <h2 id="configuring-active-job"><a class="anchorlink" href="#configuring-active-job">3.15 Configuring Active Job</a></h2>
<p><code>config.active_job</code> provides the following configuration options:</p>
<h3 id="config-active-job-queue-adapter"><a class="anchorlink" href="#config-active-job-queue-adapter">3.15.1 <code>config.active_job.queue_adapter</code></a></h3>
<p>Sets the adapter for the queuing backend. The default adapter is <code>:async</code>. For an up-to-date list of built-in adapters see the <a href="https://edgeapi.rubyonrails.org/classes/ActiveJob/QueueAdapters.html">ActiveJob::QueueAdapters API documentation</a>.</p> <pre><code class="highlight ruby"><span class="c1"># Be sure to have the adapter's gem in your Gemfile</span>
<span class="c1"># and follow the adapter's specific installation</span>
<span class="c1"># and deployment instructions.</span>
<span class="n">config</span><span class="p">.</span><span class="nf">active_job</span><span class="p">.</span><span class="nf">queue_adapter</span> <span class="o">=</span> <span class="ss">:sidekiq</span>
</code></pre> <button class="clipboard-button" data-clipboard-text="# Be sure to have the adapter's gem in your Gemfile
# and follow the adapter's specific installation
# and deployment instructions.
config.active_job.queue_adapter = :sidekiq
">Copy</button>  <h3 id="config-active-job-default-queue-name"><a class="anchorlink" href="#config-active-job-default-queue-name">3.15.2 <code>config.active_job.default_queue_name</code></a></h3>
<p>Can be used to change the default queue name. By default this is <code>"default"</code>.</p> <pre><code class="highlight ruby"><span class="n">config</span><span class="p">.</span><span class="nf">active_job</span><span class="p">.</span><span class="nf">default_queue_name</span> <span class="o">=</span> <span class="ss">:medium_priority</span>
</code></pre> <button class="clipboard-button" data-clipboard-text="config.active_job.default_queue_name = :medium_priority
">Copy</button>  <h3 id="config-active-job-queue-name-prefix"><a class="anchorlink" href="#config-active-job-queue-name-prefix">3.15.3 <code>config.active_job.queue_name_prefix</code></a></h3>
<p>Allows you to set an optional, non-blank, queue name prefix for all jobs. By default it is blank and not used.</p>
<p>The following configuration would queue the given job on the <code>production_high_priority</code> queue when run in production:</p> <pre><code class="highlight ruby"><span class="n">config</span><span class="p">.</span><span class="nf">active_job</span><span class="p">.</span><span class="nf">queue_name_prefix</span> <span class="o">=</span> <span class="no">Rails</span><span class="p">.</span><span class="nf">env</span>
</code></pre> <button class="clipboard-button" data-clipboard-text="config.active_job.queue_name_prefix = Rails.env
">Copy</button>   <pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">GuestsCleanupJob</span> <span class="o">&lt;</span> <span class="no">ActiveJob</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">queue_as</span> <span class="ss">:high_priority</span>
  <span class="c1">#....</span>
<span class="k">end</span>
</code></pre> <button class="clipboard-button" data-clipboard-text="class GuestsCleanupJob &lt; ActiveJob::Base
  queue_as :high_priority
  #....
end
">Copy</button>  <h3 id="config-active-job-queue-name-delimiter"><a class="anchorlink" href="#config-active-job-queue-name-delimiter">3.15.4 <code>config.active_job.queue_name_delimiter</code></a></h3>
<p>Has a default value of <code>'_'</code>. If <code>queue_name_prefix</code> is set, then <code>queue_name_delimiter</code> joins the prefix and the non-prefixed queue name.</p>
<p>The following configuration would queue the provided job on the <code>video_server.low_priority</code> queue:</p> <pre><code class="highlight ruby"><span class="c1"># prefix must be set for delimiter to be used</span>
<span class="n">config</span><span class="p">.</span><span class="nf">active_job</span><span class="p">.</span><span class="nf">queue_name_prefix</span> <span class="o">=</span> <span class="s1">'video_server'</span>
<span class="n">config</span><span class="p">.</span><span class="nf">active_job</span><span class="p">.</span><span class="nf">queue_name_delimiter</span> <span class="o">=</span> <span class="s1">'.'</span>
</code></pre> <button class="clipboard-button" data-clipboard-text="# prefix must be set for delimiter to be used
config.active_job.queue_name_prefix = 'video_server'
config.active_job.queue_name_delimiter = '.'
">Copy</button>   <pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">EncoderJob</span> <span class="o">&lt;</span> <span class="no">ActiveJob</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">queue_as</span> <span class="ss">:low_priority</span>
  <span class="c1">#....</span>
<span class="k">end</span>
</code></pre> <button class="clipboard-button" data-clipboard-text="class EncoderJob &lt; ActiveJob::Base
  queue_as :low_priority
  #....
end
">Copy</button>  <h3 id="config-active-job-logger"><a class="anchorlink" href="#config-active-job-logger">3.15.5 <code>config.active_job.logger</code></a></h3>
<p>Accepts a logger conforming to the interface of Log4r or the default Ruby Logger class, which is then used to log information from Active Job. You can retrieve this logger by calling <code>logger</code> on either an Active Job class or an Active Job instance. Set to <code>nil</code> to disable logging.</p>
<h3 id="config-active-job-custom-serializers"><a class="anchorlink" href="#config-active-job-custom-serializers">3.15.6 <code>config.active_job.custom_serializers</code></a></h3>
<p>Allows to set custom argument serializers. Defaults to <code>[]</code>.</p>
<h3 id="config-active-job-log-arguments"><a class="anchorlink" href="#config-active-job-log-arguments">3.15.7 <code>config.active_job.log_arguments</code></a></h3>
<p>Controls if the arguments of a job are logged. Defaults to <code>true</code>.</p>
<h3 id="config-active-job-verbose-enqueue-logs"><a class="anchorlink" href="#config-active-job-verbose-enqueue-logs">3.15.8 <code>config.active_job.verbose_enqueue_logs</code></a></h3>
<p>Specifies if source locations of methods that enqueue background jobs should be logged below relevant enqueue log lines. By default, the flag is <code>true</code> in development and <code>false</code> in all other environments.</p>
<h3 id="config-active-job-retry-jitter"><a class="anchorlink" href="#config-active-job-retry-jitter">3.15.9 <code>config.active_job.retry_jitter</code></a></h3>
<p>Controls the amount of "jitter" (random variation) applied to the delay time calculated when retrying failed jobs.</p>
<p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>0.0</code></td> </tr> <tr> <td>6.1</td> <td><code>0.15</code></td> </tr> </tbody>
</table> <h3 id="config-active-job-log-query-tags-around-perform"><a class="anchorlink" href="#config-active-job-log-query-tags-around-perform">3.15.10 <code>config.active_job.log_query_tags_around_perform</code></a></h3>
<p>Determines whether job context for query tags will be automatically updated via an <code>around_perform</code>. The default value is <code>true</code>.</p>
<h3 id="config-active-job-use-big-decimal-serializer"><a class="anchorlink" href="#config-active-job-use-big-decimal-serializer">3.15.11 <code>config.active_job.use_big_decimal_serializer</code></a></h3>
<p>Enables the new <code>BigDecimal</code> argument serializer, which guarantees roundtripping. Without this serializer, some queue adapters may serialize <code>BigDecimal</code> arguments as simple (non-roundtrippable) strings.</p>
<div class="warning"><p>When deploying an application with multiple replicas, old (pre-Rails 7.1) replicas will not be able to deserialize <code>BigDecimal</code> arguments from this serializer. Therefore, this setting should only be enabled after all replicas have been successfully upgraded to Rails 7.1.</p></div>
<p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>false</code></td> </tr> <tr> <td>7.1</td> <td><code>true</code></td> </tr> </tbody>
</table> <h2 id="configuring-action-cable"><a class="anchorlink" href="#configuring-action-cable">3.16 Configuring Action Cable</a></h2>
<h3 id="config-action-cable-url"><a class="anchorlink" href="#config-action-cable-url">3.16.1 <code>config.action_cable.url</code></a></h3>
<p>Accepts a string for the URL for where you are hosting your Action Cable server. You would use this option if you are running Action Cable servers that are separated from your main application.</p>
<h3 id="config-action-cable-mount-path"><a class="anchorlink" href="#config-action-cable-mount-path">3.16.2 <code>config.action_cable.mount_path</code></a></h3>
<p>Accepts a string for where to mount Action Cable, as part of the main server process. Defaults to <code>/cable</code>. You can set this as nil to not mount Action Cable as part of your normal Rails server.</p>
<p>You can find more detailed configuration options in the <a href="action_cable_overview.html#configuration">Action Cable Overview</a>.</p>
<h3 id="config-action-cable-precompile-assets"><a class="anchorlink" href="#config-action-cable-precompile-assets">3.16.3 <code>config.action_cable.precompile_assets</code></a></h3>
<p>Determines whether the Action Cable assets should be added to the asset pipeline precompilation. It has no effect if Sprockets is not used. The default value is <code>true</code>.</p>
<h2 id="configuring-active-storage"><a class="anchorlink" href="#configuring-active-storage">3.17 Configuring Active Storage</a></h2>
<p><code>config.active_storage</code> provides the following configuration options:</p>
<h3 id="config-active-storage-variant-processor"><a class="anchorlink" href="#config-active-storage-variant-processor">3.17.1 <code>config.active_storage.variant_processor</code></a></h3>
<p>Accepts a symbol <code>:mini_magick</code> or <code>:vips</code>, specifying whether variant transformations and blob analysis will be performed with MiniMagick or ruby-vips.</p>
<p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>:mini_magick</code></td> </tr> <tr> <td>7.0</td> <td><code>:vips</code></td> </tr> </tbody>
</table> <h3 id="config-active-storage-analyzers"><a class="anchorlink" href="#config-active-storage-analyzers">3.17.2 <code>config.active_storage.analyzers</code></a></h3>
<p>Accepts an array of classes indicating the analyzers available for Active Storage blobs. By default, this is defined as:</p> <pre><code class="highlight ruby"><span class="n">config</span><span class="p">.</span><span class="nf">active_storage</span><span class="p">.</span><span class="nf">analyzers</span> <span class="o">=</span> <span class="p">[</span><span class="no">ActiveStorage</span><span class="o">::</span><span class="no">Analyzer</span><span class="o">::</span><span class="no">ImageAnalyzer</span><span class="o">::</span><span class="no">Vips</span><span class="p">,</span> <span class="no">ActiveStorage</span><span class="o">::</span><span class="no">Analyzer</span><span class="o">::</span><span class="no">ImageAnalyzer</span><span class="o">::</span><span class="no">ImageMagick</span><span class="p">,</span> <span class="no">ActiveStorage</span><span class="o">::</span><span class="no">Analyzer</span><span class="o">::</span><span class="no">VideoAnalyzer</span><span class="p">,</span> <span class="no">ActiveStorage</span><span class="o">::</span><span class="no">Analyzer</span><span class="o">::</span><span class="no">AudioAnalyzer</span><span class="p">]</span>
</code></pre> <button class="clipboard-button" data-clipboard-text="config.active_storage.analyzers = [ActiveStorage::Analyzer::ImageAnalyzer::Vips, ActiveStorage::Analyzer::ImageAnalyzer::ImageMagick, ActiveStorage::Analyzer::VideoAnalyzer, ActiveStorage::Analyzer::AudioAnalyzer]
">Copy</button>  <p>The image analyzers can extract width and height of an image blob; the video analyzer can extract width, height, duration, angle, aspect ratio, and presence/absence of video/audio channels of a video blob; the audio analyzer can extract duration and bit rate of an audio blob.</p>
<h3 id="config-active-storage-previewers"><a class="anchorlink" href="#config-active-storage-previewers">3.17.3 <code>config.active_storage.previewers</code></a></h3>
<p>Accepts an array of classes indicating the image previewers available in Active Storage blobs. By default, this is defined as:</p> <pre><code class="highlight ruby"><span class="n">config</span><span class="p">.</span><span class="nf">active_storage</span><span class="p">.</span><span class="nf">previewers</span> <span class="o">=</span> <span class="p">[</span><span class="no">ActiveStorage</span><span class="o">::</span><span class="no">Previewer</span><span class="o">::</span><span class="no">PopplerPDFPreviewer</span><span class="p">,</span> <span class="no">ActiveStorage</span><span class="o">::</span><span class="no">Previewer</span><span class="o">::</span><span class="no">MuPDFPreviewer</span><span class="p">,</span> <span class="no">ActiveStorage</span><span class="o">::</span><span class="no">Previewer</span><span class="o">::</span><span class="no">VideoPreviewer</span><span class="p">]</span>
</code></pre> <button class="clipboard-button" data-clipboard-text="config.active_storage.previewers = [ActiveStorage::Previewer::PopplerPDFPreviewer, ActiveStorage::Previewer::MuPDFPreviewer, ActiveStorage::Previewer::VideoPreviewer]
">Copy</button>  <p><code>PopplerPDFPreviewer</code> and <code>MuPDFPreviewer</code> can generate a thumbnail from the first page of a PDF blob; <code>VideoPreviewer</code> from the relevant frame of a video blob.</p>
<h3 id="config-active-storage-paths"><a class="anchorlink" href="#config-active-storage-paths">3.17.4 <code>config.active_storage.paths</code></a></h3>
<p>Accepts a hash of options indicating the locations of previewer/analyzer commands. The default is <code>{}</code>, meaning the commands will be looked for in the default path. Can include any of these options:</p> <ul> <li>
<code>:ffprobe</code> - The location of the ffprobe executable.</li> <li>
<code>:mutool</code> - The location of the mutool executable.</li> <li>
<code>:ffmpeg</code> - The location of the ffmpeg executable.</li> </ul>  <pre><code class="highlight ruby"><span class="n">config</span><span class="p">.</span><span class="nf">active_storage</span><span class="p">.</span><span class="nf">paths</span><span class="p">[</span><span class="ss">:ffprobe</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'/usr/local/bin/ffprobe'</span>
</code></pre> <button class="clipboard-button" data-clipboard-text="config.active_storage.paths[:ffprobe] = '/usr/local/bin/ffprobe'
">Copy</button>  <h3 id="config-active-storage-variable-content-types"><a class="anchorlink" href="#config-active-storage-variable-content-types">3.17.5 <code>config.active_storage.variable_content_types</code></a></h3>
<p>Accepts an array of strings indicating the content types that Active Storage can transform through the variant processor. By default, this is defined as:</p> <pre><code class="highlight ruby"><span class="n">config</span><span class="p">.</span><span class="nf">active_storage</span><span class="p">.</span><span class="nf">variable_content_types</span> <span class="o">=</span> <span class="sx">%w(image/png image/gif image/jpeg image/tiff image/bmp image/vnd.adobe.photoshop image/vnd.microsoft.icon image/webp image/avif image/heic image/heif)</span>
</code></pre> <button class="clipboard-button" data-clipboard-text="config.active_storage.variable_content_types = %w(image/png image/gif image/jpeg image/tiff image/bmp image/vnd.adobe.photoshop image/vnd.microsoft.icon image/webp image/avif image/heic image/heif)
">Copy</button>  <h3 id="config-active-storage-web-image-content-types"><a class="anchorlink" href="#config-active-storage-web-image-content-types">3.17.6 <code>config.active_storage.web_image_content_types</code></a></h3>
<p>Accepts an array of strings regarded as web image content types in which variants can be processed without being converted to the fallback PNG format. If you want to use <code>WebP</code> or <code>AVIF</code> variants in your application you can add <code>image/webp</code> or <code>image/avif</code> to this array. By default, this is defined as:</p> <pre><code class="highlight ruby"><span class="n">config</span><span class="p">.</span><span class="nf">active_storage</span><span class="p">.</span><span class="nf">web_image_content_types</span> <span class="o">=</span> <span class="sx">%w(image/png image/jpeg image/gif)</span>
</code></pre> <button class="clipboard-button" data-clipboard-text="config.active_storage.web_image_content_types = %w(image/png image/jpeg image/gif)
">Copy</button>  <h3 id="config-active-storage-content-types-to-serve-as-binary"><a class="anchorlink" href="#config-active-storage-content-types-to-serve-as-binary">3.17.7 <code>config.active_storage.content_types_to_serve_as_binary</code></a></h3>
<p>Accepts an array of strings indicating the content types that Active Storage will always serve as an attachment, rather than inline. By default, this is defined as:</p> <pre><code class="highlight ruby"><span class="n">config</span><span class="p">.</span><span class="nf">active_storage</span><span class="p">.</span><span class="nf">content_types_to_serve_as_binary</span> <span class="o">=</span> <span class="sx">%w(text/html image/svg+xml application/postscript application/x-shockwave-flash text/xml application/xml application/xhtml+xml application/mathml+xml text/cache-manifest)</span>
</code></pre> <button class="clipboard-button" data-clipboard-text="config.active_storage.content_types_to_serve_as_binary = %w(text/html image/svg+xml application/postscript application/x-shockwave-flash text/xml application/xml application/xhtml+xml application/mathml+xml text/cache-manifest)
">Copy</button>  <h3 id="config-active-storage-content-types-allowed-inline"><a class="anchorlink" href="#config-active-storage-content-types-allowed-inline">3.17.8 <code>config.active_storage.content_types_allowed_inline</code></a></h3>
<p>Accepts an array of strings indicating the content types that Active Storage allows to serve as inline. By default, this is defined as:</p> <pre><code class="highlight ruby"><span class="n">config</span><span class="p">.</span><span class="nf">active_storage</span><span class="p">.</span><span class="nf">content_types_allowed_inline</span> <span class="o">=</span> <span class="sx">%w(image/png image/gif image/jpeg image/tiff image/vnd.adobe.photoshop image/vnd.microsoft.icon application/pdf)</span>
</code></pre> <button class="clipboard-button" data-clipboard-text="config.active_storage.content_types_allowed_inline = %w(image/png image/gif image/jpeg image/tiff image/vnd.adobe.photoshop image/vnd.microsoft.icon application/pdf)
">Copy</button>  <h3 id="config-active-storage-queues-analysis"><a class="anchorlink" href="#config-active-storage-queues-analysis">3.17.9 <code>config.active_storage.queues.analysis</code></a></h3>
<p>Accepts a symbol indicating the Active Job queue to use for analysis jobs. When this option is <code>nil</code>, analysis jobs are sent to the default Active Job queue (see <code>config.active_job.default_queue_name</code>).</p>
<p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>6.0</td> <td><code>:active_storage_analysis</code></td> </tr> <tr> <td>6.1</td> <td><code>nil</code></td> </tr> </tbody>
</table> <h3 id="config-active-storage-queues-purge"><a class="anchorlink" href="#config-active-storage-queues-purge">3.17.10 <code>config.active_storage.queues.purge</code></a></h3>
<p>Accepts a symbol indicating the Active Job queue to use for purge jobs. When this option is <code>nil</code>, purge jobs are sent to the default Active Job queue (see <code>config.active_job.default_queue_name</code>).</p>
<p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>6.0</td> <td><code>:active_storage_purge</code></td> </tr> <tr> <td>6.1</td> <td><code>nil</code></td> </tr> </tbody>
</table> <h3 id="config-active-storage-queues-mirror"><a class="anchorlink" href="#config-active-storage-queues-mirror">3.17.11 <code>config.active_storage.queues.mirror</code></a></h3>
<p>Accepts a symbol indicating the Active Job queue to use for direct upload mirroring jobs. When this option is <code>nil</code>, mirroring jobs are sent to the default Active Job queue (see <code>config.active_job.default_queue_name</code>). The default is <code>nil</code>.</p>
<h3 id="config-active-storage-logger"><a class="anchorlink" href="#config-active-storage-logger">3.17.12 <code>config.active_storage.logger</code></a></h3>
<p>Can be used to set the logger used by Active Storage. Accepts a logger conforming to the interface of Log4r or the default Ruby Logger class.</p> <pre><code class="highlight ruby"><span class="n">config</span><span class="p">.</span><span class="nf">active_storage</span><span class="p">.</span><span class="nf">logger</span> <span class="o">=</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">Logger</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="no">STDOUT</span><span class="p">)</span>
</code></pre> <button class="clipboard-button" data-clipboard-text="config.active_storage.logger = ActiveSupport::Logger.new(STDOUT)
">Copy</button>  <h3 id="config-active-storage-service-urls-expire-in"><a class="anchorlink" href="#config-active-storage-service-urls-expire-in">3.17.13 <code>config.active_storage.service_urls_expire_in</code></a></h3>
<p>Determines the default expiry of URLs generated by:</p> <ul> <li><code>ActiveStorage::Blob#url</code></li> <li><code>ActiveStorage::Blob#service_url_for_direct_upload</code></li> <li><code>ActiveStorage::Variant#url</code></li> </ul> <p>The default is 5 minutes.</p>
<h3 id="config-active-storage-urls-expire-in"><a class="anchorlink" href="#config-active-storage-urls-expire-in">3.17.14 <code>config.active_storage.urls_expire_in</code></a></h3>
<p>Determines the default expiry of URLs in the Rails application generated by Active Storage. The default is nil.</p>
<h3 id="config-active-storage-routes-prefix"><a class="anchorlink" href="#config-active-storage-routes-prefix">3.17.15 <code>config.active_storage.routes_prefix</code></a></h3>
<p>Can be used to set the route prefix for the routes served by Active Storage. Accepts a string that will be prepended to the generated routes.</p> <pre><code class="highlight ruby"><span class="n">config</span><span class="p">.</span><span class="nf">active_storage</span><span class="p">.</span><span class="nf">routes_prefix</span> <span class="o">=</span> <span class="s1">'/files'</span>
</code></pre> <button class="clipboard-button" data-clipboard-text="config.active_storage.routes_prefix = '/files'
">Copy</button>  <p>The default is <code>/rails/active_storage</code>.</p>
<h3 id="config-active-storage-track-variants"><a class="anchorlink" href="#config-active-storage-track-variants">3.17.16 <code>config.active_storage.track_variants</code></a></h3>
<p>Determines whether variants are recorded in the database.</p>
<p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>false</code></td> </tr> <tr> <td>6.1</td> <td><code>true</code></td> </tr> </tbody>
</table> <h3 id="config-active-storage-draw-routes"><a class="anchorlink" href="#config-active-storage-draw-routes">3.17.17 <code>config.active_storage.draw_routes</code></a></h3>
<p>Can be used to toggle Active Storage route generation. The default is <code>true</code>.</p>
<h3 id="config-active-storage-resolve-model-to-route"><a class="anchorlink" href="#config-active-storage-resolve-model-to-route">3.17.18 <code>config.active_storage.resolve_model_to_route</code></a></h3>
<p>Can be used to globally change how Active Storage files are delivered.</p>
<p>Allowed values are:</p> <ul> <li>
<code>:rails_storage_redirect</code>: Redirect to signed, short-lived service URLs.</li> <li>
<code>:rails_storage_proxy</code>: Proxy files by downloading them.</li> </ul> <p>The default is <code>:rails_storage_redirect</code>.</p>
<h3 id="config-active-storage-video-preview-arguments"><a class="anchorlink" href="#config-active-storage-video-preview-arguments">3.17.19 <code>config.active_storage.video_preview_arguments</code></a></h3>
<p>Can be used to alter the way ffmpeg generates video preview images.</p>
<p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>"-y -vframes 1 -f image2"</code></td> </tr> <tr> <td>7.0</td> <td>
<code>"-vf 'select=eq(n\\,0)+eq(key\\,1)+gt(scene\\,0.015)"</code><sup><mark><strong><em>1</em></strong></mark></sup> <br> <code>+ ",loop=loop=-1:size=2,trim=start_frame=1'"</code><sup><mark><strong><em>2</em></strong></mark></sup><br> <code>+ " -frames:v 1 -f image2"</code> <br><br> <ol>
<li>Select the first video frame, plus keyframes, plus frames that meet the scene change threshold.</li> <li>Use the first video frame as a fallback when no other frames meet the criteria by looping the first (one or) two selected frames, then dropping the first looped frame.</li>
</ol>
</td> </tr> </tbody>
</table> <h3 id="config-active-storage-multiple-file-field-include-hidden"><a class="anchorlink" href="#config-active-storage-multiple-file-field-include-hidden">3.17.20 <code>config.active_storage.multiple_file_field_include_hidden</code></a></h3>
<p>In Rails 7.1 and beyond, Active Storage <code>has_many_attached</code> relationships will default to <em>replacing</em> the current collection instead of <em>appending</em> to it. Thus to support submitting an <em>empty</em> collection, when <code>multiple_file_field_include_hidden</code> is <code>true</code>, the <a href="https://edgeapi.rubyonrails.org/classes/ActionView/Helpers/FormBuilder.html#method-i-file_field"><code>file_field</code></a> helper will render an auxiliary hidden field, similar to the auxiliary field rendered by the <a href="https://edgeapi.rubyonrails.org/classes/ActionView/Helpers/FormBuilder.html#method-i-check_box"><code>check_box</code></a> helper.</p>
<p>The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>false</code></td> </tr> <tr> <td>7.0</td> <td><code>true</code></td> </tr> </tbody>
</table> <h3 id="config-active-storage-precompile-assets"><a class="anchorlink" href="#config-active-storage-precompile-assets">3.17.21 <code>config.active_storage.precompile_assets</code></a></h3>
<p>Determines whether the Active Storage assets should be added to the asset pipeline precompilation. It has no effect if Sprockets is not used. The default value is <code>true</code>.</p>
<h2 id="configuring-action-text"><a class="anchorlink" href="#configuring-action-text">3.18 Configuring Action Text</a></h2>
<h3 id="config-action-text-attachment-tag-name"><a class="anchorlink" href="#config-action-text-attachment-tag-name">3.18.1 <code>config.action_text.attachment_tag_name</code></a></h3>
<p>Accepts a string for the HTML tag used to wrap attachments. Defaults to <code>"action-text-attachment"</code>.</p>
<h3 id="config-action-text-sanitizer-vendor"><a class="anchorlink" href="#config-action-text-sanitizer-vendor">3.18.2 <code>config.action_text.sanitizer_vendor</code></a></h3>
<p>Configures the HTML sanitizer used by Action Text by setting <code>ActionText::ContentHelper.sanitizer</code> to an instance of the class returned from the vendor's <code>.safe_list_sanitizer</code> method. The default value depends on the <code>config.load_defaults</code> target version:</p> <table>
<thead> <tr> <th>Starting with version</th> <th>The default value is</th> <th>Which parses markup as</th> </tr> </thead>
<tbody> <tr> <td>(original)</td> <td><code>Rails::HTML4::Sanitizer</code></td> <td>HTML4</td> </tr> <tr> <td>7.1</td> <td>
<code>Rails::HTML5::Sanitizer</code> (see NOTE)</td> <td>HTML5</td> </tr> </tbody>
</table> <div class="note"><p><code>Rails::HTML5::Sanitizer</code> is not supported on JRuby, so on JRuby platforms Rails will fall back to <code>Rails::HTML4::Sanitizer</code>.</p></div>
<h2 id="configuring-a-database"><a class="anchorlink" href="#configuring-a-database">3.19 Configuring a Database</a></h2>
<p>Just about every Rails application will interact with a database. You can connect to the database by setting an environment variable <code>ENV['DATABASE_URL']</code> or by using a configuration file called <code>config/database.yml</code>.</p>
<p>Using the <code>config/database.yml</code> file you can specify all the information needed to access your database:</p> <pre><code class="highlight yaml"><span class="na">development</span><span class="pi">:</span>
  <span class="na">adapter</span><span class="pi">:</span> <span class="s">postgresql</span>
  <span class="na">database</span><span class="pi">:</span> <span class="s">blog_development</span>
  <span class="na">pool</span><span class="pi">:</span> <span class="m">5</span>
</code></pre> <button class="clipboard-button" data-clipboard-text="development:
  adapter: postgresql
  database: blog_development
  pool: 5
">Copy</button>  <p>This will connect to the database named <code>blog_development</code> using the <code>postgresql</code> adapter. This same information can be stored in a URL and provided via an environment variable like this:</p> <pre><code class="highlight ruby"><span class="no">ENV</span><span class="p">[</span><span class="s1">'DATABASE_URL'</span><span class="p">]</span> <span class="c1"># =&gt; "postgresql://localhost/blog_development?pool=5"</span>
</code></pre> <button class="clipboard-button" data-clipboard-text="ENV['DATABASE_URL'] # =&gt; &quot;postgresql://localhost/blog_development?pool=5&quot;
">Copy</button>  <p>The <code>config/database.yml</code> file contains sections for three different environments in which Rails can run by default:</p> <ul> <li>The <code>development</code> environment is used on your development/local computer as you interact manually with the application.</li> <li>The <code>test</code> environment is used when running automated tests.</li> <li>The <code>production</code> environment is used when you deploy your application for the world to use.</li> </ul> <p>If you wish, you can manually specify a URL inside of your <code>config/database.yml</code></p> <pre><code class="highlight yaml"><span class="na">development</span><span class="pi">:</span>
  <span class="na">url</span><span class="pi">:</span> <span class="s">postgresql://localhost/blog_development?pool=5</span>
</code></pre> <button class="clipboard-button" data-clipboard-text="development:
  url: postgresql://localhost/blog_development?pool=5
">Copy</button>  <p>The <code>config/database.yml</code> file can contain ERB tags <code>&lt;%= %&gt;</code>. Anything in the tags will be evaluated as Ruby code. You can use this to pull out data from an environment variable or to perform calculations to generate the needed connection information.</p>
<div class="info"><p>You don't have to update the database configurations manually. If you look at the options of the application generator, you will see that one of the options is named <code>--database</code>. This option allows you to choose an adapter from a list of the most used relational databases. You can even run the generator repeatedly: <code>cd .. &amp;&amp; rails new blog --database=mysql</code>. When you confirm the overwriting of the <code>config/database.yml</code> file, your application will be configured for MySQL instead of SQLite. Detailed examples of the common database connections are below.</p></div>
<h2 id="connection-preference"><a class="anchorlink" href="#connection-preference">3.20 Connection Preference</a></h2>
<p>Since there are two ways to configure your connection (using <code>config/database.yml</code> or using an environment variable) it is important to understand how they can interact.</p>
<p>If you have an empty <code>config/database.yml</code> file but your <code>ENV['DATABASE_URL']</code> is present, then Rails will connect to the database via your environment variable:</p> <pre><code class="highlight console"><span class="gp">$</span><span class="nb">cat </span>config/database.yml
<span class="gp">$</span><span class="nb">echo</span> <span class="nv">$DATABASE_URL</span>
<span class="go">postgresql://localhost/my_database
</span></code></pre> <button class="clipboard-button" data-clipboard-text="cat config/database.yml
echo $DATABASE_URL
">Copy</button>  <p>If you have a <code>config/database.yml</code> but no <code>ENV['DATABASE_URL']</code> then this file will be used to connect to your database:</p> <pre><code class="highlight console"><span class="gp">$</span><span class="nb">cat </span>config/database.yml
<span class="go">development:
  adapter: postgresql
  database: my_database
  host: localhost

</span><span class="gp">$</span><span class="nb">echo</span> <span class="nv">$DATABASE_URL</span>
</code></pre> <button class="clipboard-button" data-clipboard-text="cat config/database.yml
echo $DATABASE_URL
">Copy</button>  <p>If you have both <code>config/database.yml</code> and <code>ENV['DATABASE_URL']</code> set then Rails will merge the configuration together. To better understand this we must see some examples.</p>
<p>When duplicate connection information is provided the environment variable will take precedence:</p> <pre><code class="highlight console"><span class="gp">$</span><span class="nb">cat </span>config/database.yml
<span class="go">development:
  adapter: sqlite3
  database: NOT_my_database
  host: localhost

</span><span class="gp">$</span><span class="nb">echo</span> <span class="nv">$DATABASE_URL</span>
<span class="go">postgresql://localhost/my_database

</span><span class="gp">$</span><span class="nb">bin/rails </span>runner <span class="s1">'puts ActiveRecord::Base.configurations'</span>
<span class="gp">#</span>&lt;ActiveRecord::DatabaseConfigurations:0x00007fd50e209a28&gt;
<span class="gp">$</span><span class="nb">bin/rails </span>runner <span class="s1">'puts ActiveRecord::Base.configurations.inspect'</span>
<span class="gp">#</span>&lt;ActiveRecord::DatabaseConfigurations:0x00007fc8eab02880 @configurations<span class="o">=[</span>
<span class="gp">  #</span>&lt;ActiveRecord::DatabaseConfigurations::UrlConfig:0x00007fc8eab020b0
<span class="go">    @env_name="development", @spec_name="primary",
</span><span class="gp">    @config={"adapter"=&gt;</span><span class="s2">"postgresql"</span>, <span class="s2">"database"</span><span class="o">=&gt;</span><span class="s2">"my_database"</span>, <span class="s2">"host"</span><span class="o">=&gt;</span><span class="s2">"localhost"</span><span class="o">}</span>
<span class="gp">    @url="postgresql://localhost/my_database"&gt;</span><span class="go">  ]
</span></code></pre> <button class="clipboard-button" data-clipboard-text="cat config/database.yml
echo $DATABASE_URL
bin/rails runner 'puts ActiveRecord::Base.configurations'
bin/rails runner 'puts ActiveRecord::Base.configurations.inspect'
">Copy</button>  <p>Here the adapter, host, and database match the information in <code>ENV['DATABASE_URL']</code>.</p>
<p>If non-duplicate information is provided you will get all unique values, environment variable still takes precedence in cases of any conflicts.</p> <pre><code class="highlight console"><span class="gp">$</span><span class="nb">cat </span>config/database.yml
<span class="go">development:
  adapter: sqlite3
  pool: 5

</span><span class="gp">$</span><span class="nb">echo</span> <span class="nv">$DATABASE_URL</span>
<span class="go">postgresql://localhost/my_database

</span><span class="gp">$</span><span class="nb">bin/rails </span>runner <span class="s1">'puts ActiveRecord::Base.configurations'</span>
<span class="gp">#</span>&lt;ActiveRecord::DatabaseConfigurations:0x00007fd50e209a28&gt;
<span class="gp">$</span><span class="nb">bin/rails </span>runner <span class="s1">'puts ActiveRecord::Base.configurations.inspect'</span>
<span class="gp">#</span>&lt;ActiveRecord::DatabaseConfigurations:0x00007fc8eab02880 @configurations<span class="o">=[</span>
<span class="gp">  #</span>&lt;ActiveRecord::DatabaseConfigurations::UrlConfig:0x00007fc8eab020b0
<span class="go">    @env_name="development", @spec_name="primary",
</span><span class="gp">    @config={"adapter"=&gt;</span><span class="s2">"postgresql"</span>, <span class="s2">"database"</span><span class="o">=&gt;</span><span class="s2">"my_database"</span>, <span class="s2">"host"</span><span class="o">=&gt;</span><span class="s2">"localhost"</span>, <span class="s2">"pool"</span><span class="o">=&gt;</span>5<span class="o">}</span>
<span class="gp">    @url="postgresql://localhost/my_database"&gt;</span><span class="go">  ]
</span></code></pre> <button class="clipboard-button" data-clipboard-text="cat config/database.yml
echo $DATABASE_URL
bin/rails runner 'puts ActiveRecord::Base.configurations'
bin/rails runner 'puts ActiveRecord::Base.configurations.inspect'
">Copy</button>  <p>Since pool is not in the <code>ENV['DATABASE_URL']</code> provided connection information its information is merged in. Since <code>adapter</code> is duplicate, the <code>ENV['DATABASE_URL']</code> connection information wins.</p>
<p>The only way to explicitly not use the connection information in <code>ENV['DATABASE_URL']</code> is to specify an explicit URL connection using the <code>"url"</code> sub key:</p> <pre><code class="highlight console"><span class="gp">$</span><span class="nb">cat </span>config/database.yml
<span class="go">development:
  url: sqlite3:NOT_my_database

</span><span class="gp">$</span><span class="nb">echo</span> <span class="nv">$DATABASE_URL</span>
<span class="go">postgresql://localhost/my_database

</span><span class="gp">$</span><span class="nb">bin/rails </span>runner <span class="s1">'puts ActiveRecord::Base.configurations'</span>
<span class="gp">#</span>&lt;ActiveRecord::DatabaseConfigurations:0x00007fd50e209a28&gt;
<span class="gp">$</span><span class="nb">bin/rails </span>runner <span class="s1">'puts ActiveRecord::Base.configurations.inspect'</span>
<span class="gp">#</span>&lt;ActiveRecord::DatabaseConfigurations:0x00007fc8eab02880 @configurations<span class="o">=[</span>
<span class="gp">  #</span>&lt;ActiveRecord::DatabaseConfigurations::UrlConfig:0x00007fc8eab020b0
<span class="go">    @env_name="development", @spec_name="primary",
</span><span class="gp">    @config={"adapter"=&gt;</span><span class="s2">"sqlite3"</span>, <span class="s2">"database"</span><span class="o">=&gt;</span><span class="s2">"NOT_my_database"</span><span class="o">}</span>
<span class="gp">    @url="sqlite3:NOT_my_database"&gt;</span><span class="go">  ]
</span></code></pre> <button class="clipboard-button" data-clipboard-text="cat config/database.yml
echo $DATABASE_URL
bin/rails runner 'puts ActiveRecord::Base.configurations'
bin/rails runner 'puts ActiveRecord::Base.configurations.inspect'
">Copy</button>  <p>Here the connection information in <code>ENV['DATABASE_URL']</code> is ignored, note the different adapter and database name.</p>
<p>Since it is possible to embed ERB in your <code>config/database.yml</code> it is best practice to explicitly show you are using the <code>ENV['DATABASE_URL']</code> to connect to your database. This is especially useful in production since you should not commit secrets like your database password into your source control (such as Git).</p> <pre><code class="highlight console"><span class="gp">$</span><span class="nb">cat </span>config/database.yml
<span class="go">production:
</span><span class="gp">  url: &lt;%= ENV['DATABASE_URL'] %&gt;</span></code></pre> <button class="clipboard-button" data-clipboard-text="cat config/database.yml
">Copy</button>  <p>Now the behavior is clear, that we are only using the connection information in <code>ENV['DATABASE_URL']</code>.</p>
<h3 id="configuring-an-sqlite3-database"><a class="anchorlink" href="#configuring-an-sqlite3-database">3.20.1 Configuring an SQLite3 Database</a></h3>
<p>Rails comes with built-in support for <a href="http://www.sqlite.org">SQLite3</a>, which is a lightweight serverless database application. While a busy production environment may overload SQLite, it works well for development and testing. Rails defaults to using an SQLite database when creating a new project, but you can always change it later.</p>
<p>Here's the section of the default configuration file (<code>config/database.yml</code>) with connection information for the development environment:</p> <pre><code class="highlight yaml"><span class="na">development</span><span class="pi">:</span>
  <span class="na">adapter</span><span class="pi">:</span> <span class="s">sqlite3</span>
  <span class="na">database</span><span class="pi">:</span> <span class="s">storage/development.sqlite3</span>
  <span class="na">pool</span><span class="pi">:</span> <span class="m">5</span>
  <span class="na">timeout</span><span class="pi">:</span> <span class="m">5000</span>
</code></pre> <button class="clipboard-button" data-clipboard-text="development:
  adapter: sqlite3
  database: storage/development.sqlite3
  pool: 5
  timeout: 5000
">Copy</button>  <div class="note"><p>Rails uses an SQLite3 database for data storage by default because it is a zero configuration database that just works. Rails also supports MySQL (including MariaDB) and PostgreSQL "out of the box", and has plugins for many database systems. If you are using a database in a production environment Rails most likely has an adapter for it.</p></div>
<h3 id="configuring-a-mysql-or-mariadb-database"><a class="anchorlink" href="#configuring-a-mysql-or-mariadb-database">3.20.2 Configuring a MySQL or MariaDB Database</a></h3>
<p>If you choose to use MySQL or MariaDB instead of the shipped SQLite3 database, your <code>config/database.yml</code> will look a little different. Here's the development section:</p> <pre><code class="highlight yaml"><span class="na">development</span><span class="pi">:</span>
  <span class="na">adapter</span><span class="pi">:</span> <span class="s">mysql2</span>
  <span class="na">encoding</span><span class="pi">:</span> <span class="s">utf8mb4</span>
  <span class="na">database</span><span class="pi">:</span> <span class="s">blog_development</span>
  <span class="na">pool</span><span class="pi">:</span> <span class="m">5</span>
  <span class="na">username</span><span class="pi">:</span> <span class="s">root</span>
  <span class="na">password</span><span class="pi">:</span>
  <span class="na">socket</span><span class="pi">:</span> <span class="s">/tmp/mysql.sock</span>
</code></pre> <button class="clipboard-button" data-clipboard-text="development:
  adapter: mysql2
  encoding: utf8mb4
  database: blog_development
  pool: 5
  username: root
  password:
  socket: /tmp/mysql.sock
">Copy</button>  <p>If your development database has a root user with an empty password, this configuration should work for you. Otherwise, change the username and password in the <code>development</code> section as appropriate.</p>
<div class="note"><p>If your MySQL version is 5.5 or 5.6 and want to use the <code>utf8mb4</code> character set by default, please configure your MySQL server to support the longer key prefix by enabling <code>innodb_large_prefix</code> system variable.</p></div>
<p>Advisory Locks are enabled by default on MySQL and are used to make database migrations concurrent safe. You can disable advisory locks by setting <code>advisory_locks</code> to <code>false</code>:</p> <pre><code class="highlight yaml"><span class="na">production</span><span class="pi">:</span>
  <span class="na">adapter</span><span class="pi">:</span> <span class="s">mysql2</span>
  <span class="na">advisory_locks</span><span class="pi">:</span> <span class="kc">false</span>
</code></pre> <button class="clipboard-button" data-clipboard-text="production:
  adapter: mysql2
  advisory_locks: false
">Copy</button>  <h3 id="configuring-a-postgresql-database"><a class="anchorlink" href="#configuring-a-postgresql-database">3.20.3 Configuring a PostgreSQL Database</a></h3>
<p>If you choose to use PostgreSQL, your <code>config/database.yml</code> will be customized to use PostgreSQL databases:</p> <pre><code class="highlight yaml"><span class="na">development</span><span class="pi">:</span>
  <span class="na">adapter</span><span class="pi">:</span> <span class="s">postgresql</span>
  <span class="na">encoding</span><span class="pi">:</span> <span class="s">unicode</span>
  <span class="na">database</span><span class="pi">:</span> <span class="s">blog_development</span>
  <span class="na">pool</span><span class="pi">:</span> <span class="m">5</span>
</code></pre> <button class="clipboard-button" data-clipboard-text="development:
  adapter: postgresql
  encoding: unicode
  database: blog_development
  pool: 5
">Copy</button>  <p>By default Active Record uses database features like prepared statements and advisory locks. You might need to disable those features if you're using an external connection pooler like PgBouncer:</p> <pre><code class="highlight yaml"><span class="na">production</span><span class="pi">:</span>
  <span class="na">adapter</span><span class="pi">:</span> <span class="s">postgresql</span>
  <span class="na">prepared_statements</span><span class="pi">:</span> <span class="kc">false</span>
  <span class="na">advisory_locks</span><span class="pi">:</span> <span class="kc">false</span>
</code></pre> <button class="clipboard-button" data-clipboard-text="production:
  adapter: postgresql
  prepared_statements: false
  advisory_locks: false
">Copy</button>  <p>If enabled, Active Record will create up to <code>1000</code> prepared statements per database connection by default. To modify this behavior you can set <code>statement_limit</code> to a different value:</p> <pre><code class="highlight yaml"><span class="na">production</span><span class="pi">:</span>
  <span class="na">adapter</span><span class="pi">:</span> <span class="s">postgresql</span>
  <span class="na">statement_limit</span><span class="pi">:</span> <span class="m">200</span>
</code></pre> <button class="clipboard-button" data-clipboard-text="production:
  adapter: postgresql
  statement_limit: 200
">Copy</button>  <p>The more prepared statements in use: the more memory your database will require. If your PostgreSQL database is hitting memory limits, try lowering <code>statement_limit</code> or disabling prepared statements.</p>
<h3 id="configuring-an-sqlite3-database-for-jruby-platform"><a class="anchorlink" href="#configuring-an-sqlite3-database-for-jruby-platform">3.20.4 Configuring an SQLite3 Database for JRuby Platform</a></h3>
<p>If you choose to use SQLite3 and are using JRuby, your <code>config/database.yml</code> will look a little different. Here's the development section:</p> <pre><code class="highlight yaml"><span class="na">development</span><span class="pi">:</span>
  <span class="na">adapter</span><span class="pi">:</span> <span class="s">jdbcsqlite3</span>
  <span class="na">database</span><span class="pi">:</span> <span class="s">storage/development.sqlite3</span>
</code></pre> <button class="clipboard-button" data-clipboard-text="development:
  adapter: jdbcsqlite3
  database: storage/development.sqlite3
">Copy</button>  <h3 id="configuring-a-mysql-or-mariadb-database-for-jruby-platform"><a class="anchorlink" href="#configuring-a-mysql-or-mariadb-database-for-jruby-platform">3.20.5 Configuring a MySQL or MariaDB Database for JRuby Platform</a></h3>
<p>If you choose to use MySQL or MariaDB and are using JRuby, your <code>config/database.yml</code> will look a little different. Here's the development section:</p> <pre><code class="highlight yaml"><span class="na">development</span><span class="pi">:</span>
  <span class="na">adapter</span><span class="pi">:</span> <span class="s">jdbcmysql</span>
  <span class="na">database</span><span class="pi">:</span> <span class="s">blog_development</span>
  <span class="na">username</span><span class="pi">:</span> <span class="s">root</span>
  <span class="na">password</span><span class="pi">:</span>
</code></pre> <button class="clipboard-button" data-clipboard-text="development:
  adapter: jdbcmysql
  database: blog_development
  username: root
  password:
">Copy</button>  <h3 id="configuring-a-postgresql-database-for-jruby-platform"><a class="anchorlink" href="#configuring-a-postgresql-database-for-jruby-platform">3.20.6 Configuring a PostgreSQL Database for JRuby Platform</a></h3>
<p>If you choose to use PostgreSQL and are using JRuby, your <code>config/database.yml</code> will look a little different. Here's the development section:</p> <pre><code class="highlight yaml"><span class="na">development</span><span class="pi">:</span>
  <span class="na">adapter</span><span class="pi">:</span> <span class="s">jdbcpostgresql</span>
  <span class="na">encoding</span><span class="pi">:</span> <span class="s">unicode</span>
  <span class="na">database</span><span class="pi">:</span> <span class="s">blog_development</span>
  <span class="na">username</span><span class="pi">:</span> <span class="s">blog</span>
  <span class="na">password</span><span class="pi">:</span>
</code></pre> <button class="clipboard-button" data-clipboard-text="development:
  adapter: jdbcpostgresql
  encoding: unicode
  database: blog_development
  username: blog
  password:
">Copy</button>  <p>Change the username and password in the <code>development</code> section as appropriate.</p>
<h3 id="configuring-metadata-storage"><a class="anchorlink" href="#configuring-metadata-storage">3.20.7 Configuring Metadata Storage</a></h3>
<p>By default Rails will store information about your Rails environment and schema in an internal table named <code>ar_internal_metadata</code>.</p>
<p>To turn this off per connection, set <code>use_metadata_table</code> in your database configuration. This is useful when working with a shared database and/or database user that cannot create tables.</p> <pre><code class="highlight yaml"><span class="na">development</span><span class="pi">:</span>
  <span class="na">adapter</span><span class="pi">:</span> <span class="s">postgresql</span>
  <span class="na">use_metadata_table</span><span class="pi">:</span> <span class="kc">false</span>
</code></pre> <button class="clipboard-button" data-clipboard-text="development:
  adapter: postgresql
  use_metadata_table: false
">Copy</button>  <h3 id="configuring-retry-behaviour"><a class="anchorlink" href="#configuring-retry-behaviour">3.20.8 Configuring Retry Behaviour</a></h3>
<p>By default, Rails will automatically reconnect to the database server and retry certain queries if something goes wrong. Only safely retryable (idempotent) queries will be retried. The number of retries can be specified in your the database configuration via <code>connection_retries</code>, or disabled by setting the value to 0. The default number of retries is 1.</p> <pre><code class="highlight yaml"><span class="na">development</span><span class="pi">:</span>
  <span class="na">adapter</span><span class="pi">:</span> <span class="s">mysql2</span>
  <span class="na">connection_retries</span><span class="pi">:</span> <span class="m">3</span>
</code></pre> <button class="clipboard-button" data-clipboard-text="development:
  adapter: mysql2
  connection_retries: 3
">Copy</button>  <p>The database config also allows a <code>retry_deadline</code> to be configured. If a <code>retry_deadline</code> is configured, an otherwise-retryable query will <em>not</em> be retried if the specified time has elapsed while the query was first tried. For example, a <code>retry_deadline</code> of 5 seconds means that if 5 seconds have passed since a query was first attempted, we won't retry the query, even if it is idempotent and there are <code>connection_retries</code> left.</p>
<p>This value defaults to nil, meaning that all retryable queries are retried regardless of time elapsed. The value for this config should be specified in seconds.</p> <pre><code class="highlight yaml"><span class="na">development</span><span class="pi">:</span>
  <span class="na">adapter</span><span class="pi">:</span> <span class="s">mysql2</span>
  <span class="na">retry_deadline</span><span class="pi">:</span> <span class="m">5</span> <span class="c1"># Stop retrying queries after 5 seconds</span>
</code></pre> <button class="clipboard-button" data-clipboard-text="development:
  adapter: mysql2
  retry_deadline: 5 # Stop retrying queries after 5 seconds
">Copy</button>  <h3 id="configuring-query-cache"><a class="anchorlink" href="#configuring-query-cache">3.20.9 Configuring Query Cache</a></h3>
<p>By default, Rails automatically caches the result sets returned by queries. If Rails encounters the same query again for that request or job, it will use the cached result set as opposed to running the query against the database again.</p>
<p>The query cache is stored in memory, and to avoid using too much memory, it automatically evicts the least recently used queries when reaching a threshold. By default the threshold is <code>100</code>, but can be configured in the <code>database.yml</code>.</p> <pre><code class="highlight yaml"><span class="na">development</span><span class="pi">:</span>
  <span class="na">adapter</span><span class="pi">:</span> <span class="s">mysql2</span>
  <span class="na">query_cache</span><span class="pi">:</span> <span class="m">200</span>
</code></pre> <button class="clipboard-button" data-clipboard-text="development:
  adapter: mysql2
  query_cache: 200
">Copy</button>  <p>To entirely disable query caching, it can be set to <code>false</code></p> <pre><code class="highlight yaml"><span class="na">development</span><span class="pi">:</span>
  <span class="na">adapter</span><span class="pi">:</span> <span class="s">mysql2</span>
  <span class="na">query_cache</span><span class="pi">:</span> <span class="kc">false</span>
</code></pre> <button class="clipboard-button" data-clipboard-text="development:
  adapter: mysql2
  query_cache: false
">Copy</button>  <h2 id="creating-rails-environments"><a class="anchorlink" href="#creating-rails-environments">3.21 Creating Rails Environments</a></h2>
<p>By default Rails ships with three environments: "development", "test", and "production". While these are sufficient for most use cases, there are circumstances when you want more environments.</p>
<p>Imagine you have a server which mirrors the production environment but is only used for testing. Such a server is commonly called a "staging server". To define an environment called "staging" for this server, just create a file called <code>config/environments/staging.rb</code>. Since this is a production-like environment, you could copy the contents of <code>config/environments/production.rb</code> as a starting point and make the necessary changes from there. It's also possible to require and extend other environment configurations like this:</p> <pre><code class="highlight ruby"><span class="c1"># config/environments/staging.rb</span>
<span class="nb">require_relative</span> <span class="s2">"production"</span>

<span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">configure</span> <span class="k">do</span>
  <span class="c1"># Staging overrides</span>
<span class="k">end</span>
</code></pre> <button class="clipboard-button" data-clipboard-text='# config/environments/staging.rb
require_relative "production"

Rails.application.configure do
  # Staging overrides
end
'>Copy</button>  <p>That environment is no different than the default ones, start a server with <code>bin/rails server -e staging</code>, a console with <code>bin/rails console -e staging</code>, <code>Rails.env.staging?</code> works, etc.</p>
<h2 id="deploy-to-a-subdirectory-relative-url-root"><a class="anchorlink" href="#deploy-to-a-subdirectory-relative-url-root">3.22 Deploy to a Subdirectory (relative URL root)</a></h2>
<p>By default Rails expects that your application is running at the root (e.g. <code>/</code>). This section explains how to run your application inside a directory.</p>
<p>Let's assume we want to deploy our application to "/app1". Rails needs to know this directory to generate the appropriate routes:</p> <pre><code class="highlight ruby"><span class="n">config</span><span class="p">.</span><span class="nf">relative_url_root</span> <span class="o">=</span> <span class="s2">"/app1"</span>
</code></pre> <button class="clipboard-button" data-clipboard-text='config.relative_url_root = "/app1"
'>Copy</button>  <p>alternatively you can set the <code>RAILS_RELATIVE_URL_ROOT</code> environment variable.</p>
<p>Rails will now prepend "/app1" when generating links.</p>
<h3 id="using-passenger"><a class="anchorlink" href="#using-passenger">3.22.1 Using Passenger</a></h3>
<p>Passenger makes it easy to run your application in a subdirectory. You can find the relevant configuration in the <a href="https://www.phusionpassenger.com/library/deploy/apache/deploy/ruby/#deploying-an-app-to-a-sub-uri-or-subdirectory">Passenger manual</a>.</p>
<h3 id="using-a-reverse-proxy"><a class="anchorlink" href="#using-a-reverse-proxy">3.22.2 Using a Reverse Proxy</a></h3>
<p>Deploying your application using a reverse proxy has definite advantages over traditional deploys. They allow you to have more control over your server by layering the components required by your application.</p>
<p>Many modern web servers can be used as a proxy server to balance third-party elements such as caching servers or application servers.</p>
<p>One such application server you can use is <a href="https://bogomips.org/unicorn/">Unicorn</a> to run behind a reverse proxy.</p>
<p>In this case, you would need to configure the proxy server (NGINX, Apache, etc) to accept connections from your application server (Unicorn). By default Unicorn will listen for TCP connections on port 8080, but you can change the port or configure it to use sockets instead.</p>
<p>You can find more information in the <a href="https://bogomips.org/unicorn/README.html">Unicorn readme</a> and understand the <a href="https://bogomips.org/unicorn/PHILOSOPHY.html">philosophy</a> behind it.</p>
<p>Once you've configured the application server, you must proxy requests to it by configuring your web server appropriately. For example your NGINX config may include:</p> <pre><code class="highlight nginx"><span class="k">upstream</span> <span class="s">application_server</span> <span class="p">{</span>
  <span class="kn">server</span> <span class="nf">0.0.0.0</span><span class="p">:</span><span class="mi">8080</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">server</span> <span class="p">{</span>
  <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
  <span class="kn">server_name</span> <span class="s">localhost</span><span class="p">;</span>

  <span class="kn">root</span> <span class="n">/root/path/to/your_app/public</span><span class="p">;</span>

  <span class="kn">try_files</span> <span class="nv">$uri</span><span class="n">/index.html</span> <span class="nv">$uri</span><span class="s">.html</span> <span class="s">@app</span><span class="p">;</span>

  <span class="kn">location</span> <span class="s">@app</span> <span class="p">{</span>
    <span class="kn">proxy_set_header</span> <span class="s">X-Forwarded-For</span> <span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span>
    <span class="kn">proxy_set_header</span> <span class="s">Host</span> <span class="nv">$http_host</span><span class="p">;</span>
    <span class="kn">proxy_redirect</span> <span class="no">off</span><span class="p">;</span>
    <span class="kn">proxy_pass</span> <span class="s">http://application_server</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1"># some other configuration</span>
<span class="p">}</span>
</code></pre> <button class="clipboard-button" data-clipboard-text="upstream application_server {
  server 0.0.0.0:8080;
}

server {
  listen 80;
  server_name localhost;

  root /root/path/to/your_app/public;

  try_files $uri/index.html $uri.html @app;

  location @app {
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header Host $http_host;
    proxy_redirect off;
    proxy_pass http://application_server;
  }

  # some other configuration
}
">Copy</button>  <p>Be sure to read the <a href="https://nginx.org/en/docs/">NGINX documentation</a> for the most up-to-date information.</p>
<h1 id="rails-environment-settings"><a class="anchorlink" href="#rails-environment-settings">4 Rails Environment Settings</a></h1>
<p>Some parts of Rails can also be configured externally by supplying environment variables. The following environment variables are recognized by various parts of Rails:</p> <ul> <li><p><code>ENV["RAILS_ENV"]</code> defines the Rails environment (production, development, test, and so on) that Rails will run under.</p></li> <li><p><code>ENV["RAILS_RELATIVE_URL_ROOT"]</code> is used by the routing code to recognize URLs when you <a href="configuring.html#deploy-to-a-subdirectory-relative-url-root">deploy your application to a subdirectory</a>.</p></li> <li><p><code>ENV["RAILS_CACHE_ID"]</code> and <code>ENV["RAILS_APP_VERSION"]</code> are used to generate expanded cache keys in Rails' caching code. This allows you to have multiple separate caches from the same application.</p></li> </ul> <h1 id="using-initializer-files"><a class="anchorlink" href="#using-initializer-files">5 Using Initializer Files</a></h1>
<p>After loading the framework and any gems in your application, Rails turns to loading initializers. An initializer is any Ruby file stored under <code>config/initializers</code> in your application. You can use initializers to hold configuration settings that should be made after all of the frameworks and gems are loaded, such as options to configure settings for these parts.</p>
<p>The files in <code>config/initializers</code> (and any subdirectories of <code>config/initializers</code>) are sorted and loaded one by one as part of the <code>load_config_initializers</code> initializer.</p>
<p>If an initializer has code that relies on code in another initializer, you can combine them into a single initializer instead. This makes the dependencies more explicit, and can help surface new concepts within your application. Rails also supports numbering of initializer file names, but this can lead to file name churn. Explicitly loading initializers with <code>require</code> is not recommended, since it will cause the initializer to get loaded twice.</p>
<div class="note"><p>There is no guarantee that your initializers will run after all the gem initializers, so any initialization code that depends on a given gem having been initialized should go into a <code>config.after_initialize</code> block.</p></div>
<h1 id="initialization-events"><a class="anchorlink" href="#initialization-events">6 Initialization Events</a></h1>
<p>Rails has 5 initialization events which can be hooked into (listed in the order that they are run):</p> <ul> <li><p><code>before_configuration</code>: This is run as soon as the application constant inherits from <code>Rails::Application</code>. The <code>config</code> calls are evaluated before this happens.</p></li> <li><p><code>before_initialize</code>: This is run directly before the initialization process of the application occurs with the <code>:bootstrap_hook</code> initializer near the beginning of the Rails initialization process.</p></li> <li><p><code>to_prepare</code>: Run after the initializers are run for all Railties (including the application itself), but before eager loading and the middleware stack is built. More importantly, will run upon every code reload in <code>development</code>, but only once (during boot-up) in <code>production</code> and <code>test</code>.</p></li> <li><p><code>before_eager_load</code>: This is run directly before eager loading occurs, which is the default behavior for the <code>production</code> environment and not for the <code>development</code> environment.</p></li> <li><p><code>after_initialize</code>: Run directly after the initialization of the application, after the application initializers in <code>config/initializers</code> are run.</p></li> </ul> <p>To define an event for these hooks, use the block syntax within a <code>Rails::Application</code>, <code>Rails::Railtie</code> or <code>Rails::Engine</code> subclass:</p> <pre><code class="highlight ruby"><span class="k">module</span> <span class="nn">YourApp</span>
  <span class="k">class</span> <span class="nc">Application</span> <span class="o">&lt;</span> <span class="no">Rails</span><span class="o">::</span><span class="no">Application</span>
    <span class="n">config</span><span class="p">.</span><span class="nf">before_initialize</span> <span class="k">do</span>
      <span class="c1"># initialization code goes here</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre> <button class="clipboard-button" data-clipboard-text="module YourApp
  class Application &lt; Rails::Application
    config.before_initialize do
      # initialization code goes here
    end
  end
end
">Copy</button>  <p>Alternatively, you can also do it through the <code>config</code> method on the <code>Rails.application</code> object:</p> <pre><code class="highlight ruby"><span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">config</span><span class="p">.</span><span class="nf">before_initialize</span> <span class="k">do</span>
  <span class="c1"># initialization code goes here</span>
<span class="k">end</span>
</code></pre> <button class="clipboard-button" data-clipboard-text="Rails.application.config.before_initialize do
  # initialization code goes here
end
">Copy</button>  <div class="warning"><p>Some parts of your application, notably routing, are not yet set up at the point where the <code>after_initialize</code> block is called.</p></div>
<h2 id="rails-railtie-initializer"><a class="anchorlink" href="#rails-railtie-initializer">6.1 <code>Rails::Railtie#initializer</code></a></h2>
<p>Rails has several initializers that run on startup that are all defined by using the <code>initializer</code> method from <code>Rails::Railtie</code>. Here's an example of the <code>set_helpers_path</code> initializer from Action Controller:</p> <pre><code class="highlight ruby"><span class="n">initializer</span> <span class="s2">"action_controller.set_helpers_path"</span> <span class="k">do</span> <span class="o">|</span><span class="n">app</span><span class="o">|</span>
  <span class="no">ActionController</span><span class="o">::</span><span class="no">Helpers</span><span class="p">.</span><span class="nf">helpers_path</span> <span class="o">=</span> <span class="n">app</span><span class="p">.</span><span class="nf">helpers_paths</span>
<span class="k">end</span>
</code></pre> <button class="clipboard-button" data-clipboard-text='initializer "action_controller.set_helpers_path" do |app|
  ActionController::Helpers.helpers_path = app.helpers_paths
end
'>Copy</button>  <p>The <code>initializer</code> method takes three arguments with the first being the name for the initializer and the second being an options hash (not shown here) and the third being a block. The <code>:before</code> key in the options hash can be specified to specify which initializer this new initializer must run before, and the <code>:after</code> key will specify which initializer to run this initializer <em>after</em>.</p>
<p>Initializers defined using the <code>initializer</code> method will be run in the order they are defined in, with the exception of ones that use the <code>:before</code> or <code>:after</code> methods.</p>
<div class="warning"><p>You may put your initializer before or after any other initializer in the chain, as long as it is logical. Say you have 4 initializers called "one" through "four" (defined in that order) and you define "four" to go <em>before</em> "two" but <em>after</em> "three", that just isn't logical and Rails will not be able to determine your initializer order.</p></div>
<p>The block argument of the <code>initializer</code> method is the instance of the application itself, and so we can access the configuration on it by using the <code>config</code> method as done in the example.</p>
<p>Because <code>Rails::Application</code> inherits from <code>Rails::Railtie</code> (indirectly), you can use the <code>initializer</code> method in <code>config/application.rb</code> to define initializers for the application.</p>
<h2 id="initializers"><a class="anchorlink" href="#initializers">6.2 Initializers</a></h2>
<p>Below is a comprehensive list of all the initializers found in Rails in the order that they are defined (and therefore run in, unless otherwise stated).</p> <ul> <li><p><code>load_environment_hook</code>: Serves as a placeholder so that <code>:load_environment_config</code> can be defined to run before it.</p></li> <li><p><code>load_active_support</code>: Requires <code>active_support/dependencies</code> which sets up the basis for Active Support. Optionally requires <code>active_support/all</code> if <code>config.active_support.bare</code> is un-truthful, which is the default.</p></li> <li><p><code>initialize_logger</code>: Initializes the logger (an <code>ActiveSupport::BroadcastLogger</code> object) for the application and makes it accessible at <code>Rails.logger</code>, provided that no initializer inserted before this point has defined <code>Rails.logger</code>.</p></li> <li><p><code>initialize_cache</code>: If <code>Rails.cache</code> isn't set yet, initializes the cache by referencing the value in <code>config.cache_store</code> and stores the outcome as <code>Rails.cache</code>. If this object responds to the <code>middleware</code> method, its middleware is inserted before <code>Rack::Runtime</code> in the middleware stack.</p></li> <li><p><code>set_clear_dependencies_hook</code>: This initializer - which runs only if <code>config.enable_reloading</code> is set to <code>true</code> - uses <code>ActionDispatch::Callbacks.after</code> to remove the constants which have been referenced during the request from the object space so that they will be reloaded during the following request.</p></li> <li><p><code>bootstrap_hook</code>: Runs all configured <code>before_initialize</code> blocks.</p></li> <li><p><code>i18n.callbacks</code>: In the development environment, sets up a <code>to_prepare</code> callback which will call <code>I18n.reload!</code> if any of the locales have changed since the last request. In production this callback will only run on the first request.</p></li> <li><p><code>active_support.deprecation_behavior</code>: Sets up deprecation reporting behavior for <a href="https://edgeapi.rubyonrails.org/classes/Rails/Application.html#method-i-deprecators"><code>Rails.application.deprecators</code></a> based on <a href="#config-active-support-report-deprecations"><code>config.active_support.report_deprecations</code></a>, <a href="#config-active-support-deprecation"><code>config.active_support.deprecation</code></a>, <a href="#config-active-support-disallowed-deprecation"><code>config.active_support.disallowed_deprecation</code></a>, and <a href="#config-active-support-disallowed-deprecation-warnings"><code>config.active_support.disallowed_deprecation_warnings</code></a>.</p></li> <li><p><code>active_support.initialize_time_zone</code>: Sets the default time zone for the application based on the <code>config.time_zone</code> setting, which defaults to "UTC".</p></li> <li><p><code>active_support.initialize_beginning_of_week</code>: Sets the default beginning of week for the application based on <code>config.beginning_of_week</code> setting, which defaults to <code>:monday</code>.</p></li> <li><p><code>active_support.set_configs</code>: Sets up Active Support by using the settings in <code>config.active_support</code> by <code>send</code>'ing the method names as setters to <code>ActiveSupport</code> and passing the values through.</p></li> <li><p><code>action_dispatch.configure</code>: Configures the <code>ActionDispatch::Http::URL.tld_length</code> to be set to the value of <code>config.action_dispatch.tld_length</code>.</p></li> <li><p><code>action_view.set_configs</code>: Sets up Action View by using the settings in <code>config.action_view</code> by <code>send</code>'ing the method names as setters to <code>ActionView::Base</code> and passing the values through.</p></li> <li><p><code>action_controller.assets_config</code>: Initializes the <code>config.action_controller.assets_dir</code> to the app's public directory if not explicitly configured.</p></li> <li><p><code>action_controller.set_helpers_path</code>: Sets Action Controller's <code>helpers_path</code> to the application's <code>helpers_path</code>.</p></li> <li><p><code>action_controller.parameters_config</code>: Configures strong parameters options for <code>ActionController::Parameters</code>.</p></li> <li><p><code>action_controller.set_configs</code>: Sets up Action Controller by using the settings in <code>config.action_controller</code> by <code>send</code>'ing the method names as setters to <code>ActionController::Base</code> and passing the values through.</p></li> <li><p><code>action_controller.compile_config_methods</code>: Initializes methods for the config settings specified so that they are quicker to access.</p></li> <li><p><code>active_record.initialize_timezone</code>: Sets <code>ActiveRecord::Base.time_zone_aware_attributes</code> to <code>true</code>, as well as setting <code>ActiveRecord::Base.default_timezone</code> to UTC. When attributes are read from the database, they will be converted into the time zone specified by <code>Time.zone</code>.</p></li> <li><p><code>active_record.logger</code>: Sets <code>ActiveRecord::Base.logger</code> - if it's not already set - to <code>Rails.logger</code>.</p></li> <li><p><code>active_record.migration_error</code>: Configures middleware to check for pending migrations.</p></li> <li><p><code>active_record.check_schema_cache_dump</code>: Loads the schema cache dump if configured and available.</p></li> <li><p><code>active_record.warn_on_records_fetched_greater_than</code>: Enables warnings when queries return large numbers of records.</p></li> <li><p><code>active_record.set_configs</code>: Sets up Active Record by using the settings in <code>config.active_record</code> by <code>send</code>'ing the method names as setters to <code>ActiveRecord::Base</code> and passing the values through.</p></li> <li><p><code>active_record.initialize_database</code>: Loads the database configuration (by default) from <code>config/database.yml</code> and establishes a connection for the current environment.</p></li> <li><p><code>active_record.log_runtime</code>: Includes <code>ActiveRecord::Railties::ControllerRuntime</code> and <code>ActiveRecord::Railties::JobRuntime</code> which are responsible for reporting the time taken by Active Record calls for the request back to the logger.</p></li> <li><p><code>active_record.set_reloader_hooks</code>: Resets all reloadable connections to the database if <code>config.enable_reloading</code> is set to <code>true</code>.</p></li> <li><p><code>active_record.add_watchable_files</code>: Adds <code>schema.rb</code> and <code>structure.sql</code> files to watchable files.</p></li> <li><p><code>active_job.logger</code>: Sets <code>ActiveJob::Base.logger</code> - if it's not already set - to <code>Rails.logger</code>.</p></li> <li><p><code>active_job.set_configs</code>: Sets up Active Job by using the settings in <code>config.active_job</code> by <code>send</code>'ing the method names as setters to <code>ActiveJob::Base</code> and passing the values through.</p></li> <li><p><code>action_mailer.logger</code>: Sets <code>ActionMailer::Base.logger</code> - if it's not already set - to <code>Rails.logger</code>.</p></li> <li><p><code>action_mailer.set_configs</code>: Sets up Action Mailer by using the settings in <code>config.action_mailer</code> by <code>send</code>'ing the method names as setters to <code>ActionMailer::Base</code> and passing the values through.</p></li> <li><p><code>action_mailer.compile_config_methods</code>: Initializes methods for the config settings specified so that they are quicker to access.</p></li> <li><p><code>set_load_path</code>: This initializer runs before <code>bootstrap_hook</code>. Adds paths specified by <code>config.load_paths</code> and all autoload paths to <code>$LOAD_PATH</code>.</p></li> <li><p><code>set_autoload_paths</code>: This initializer runs before <code>bootstrap_hook</code>. Adds all sub-directories of <code>app</code> and paths specified by <code>config.autoload_paths</code>, <code>config.eager_load_paths</code> and <code>config.autoload_once_paths</code> to <code>ActiveSupport::Dependencies.autoload_paths</code>.</p></li> <li><p><code>add_routing_paths</code>: Loads (by default) all <code>config/routes.rb</code> files (in the application and railties, including engines) and sets up the routes for the application.</p></li> <li><p><code>add_locales</code>: Adds the files in <code>config/locales</code> (from the application, railties, and engines) to <code>I18n.load_path</code>, making available the translations in these files.</p></li> <li><p><code>add_view_paths</code>: Adds the directory <code>app/views</code> from the application, railties, and engines to the lookup path for view files for the application.</p></li> <li><p><code>add_mailer_preview_paths</code>: Adds the directory <code>test/mailers/previews</code> from the application, railties, and engines to the lookup path for mailer preview files for the application.</p></li> <li><p><code>load_environment_config</code>: This initializer runs before <code>load_environment_hook</code>. Loads the <code>config/environments</code> file for the current environment.</p></li> <li><p><code>prepend_helpers_path</code>: Adds the directory <code>app/helpers</code> from the application, railties, and engines to the lookup path for helpers for the application.</p></li> <li><p><code>load_config_initializers</code>: Loads all Ruby files from <code>config/initializers</code> in the application, railties, and engines. The files in this directory can be used to hold configuration settings that should be made after all of the frameworks are loaded.</p></li> <li><p><code>engines_blank_point</code>: Provides a point-in-initialization to hook into if you wish to do anything before engines are loaded. After this point, all railtie and engine initializers are run.</p></li> <li><p><code>add_generator_templates</code>: Finds templates for generators at <code>lib/templates</code> for the application, railties, and engines, and adds these to the <code>config.generators.templates</code> setting, which will make the templates available for all generators to reference.</p></li> <li><p><code>ensure_autoload_once_paths_as_subset</code>: Ensures that the <code>config.autoload_once_paths</code> only contains paths from <code>config.autoload_paths</code>. If it contains extra paths, then an exception will be raised.</p></li> <li><p><code>add_to_prepare_blocks</code>: The block for every <code>config.to_prepare</code> call in the application, a railtie, or engine is added to the <code>to_prepare</code> callbacks for Action Dispatch which will be run per request in development, or before the first request in production.</p></li> <li><p><code>add_builtin_route</code>: If the application is running under the development environment then this will append the route for <code>rails/info/properties</code> to the application routes. This route provides the detailed information such as Rails and Ruby version for <code>public/index.html</code> in a default Rails application.</p></li> <li><p><code>build_middleware_stack</code>: Builds the middleware stack for the application, returning an object which has a <code>call</code> method which takes a Rack environment object for the request.</p></li> <li><p><code>eager_load!</code>: If <code>config.eager_load</code> is <code>true</code>, runs the <code>config.before_eager_load</code> hooks and then calls <code>eager_load!</code> which will load all <code>config.eager_load_namespaces</code>.</p></li> <li><p><code>finisher_hook</code>: Provides a hook for after the initialization of process of the application is complete, as well as running all the <code>config.after_initialize</code> blocks for the application, railties, and engines.</p></li> <li><p><code>set_routes_reloader_hook</code>: Configures Action Dispatch to reload the routes file using <code>ActiveSupport::Callbacks.to_run</code>.</p></li> <li><p><code>disable_dependency_loading</code>: Disables the automatic dependency loading if the <code>config.eager_load</code> is set to <code>true</code>.</p></li> </ul> <h1 id="database-pooling"><a class="anchorlink" href="#database-pooling">7 Database Pooling</a></h1>
<p>Active Record database connections are managed by <code>ActiveRecord::ConnectionAdapters::ConnectionPool</code> which ensures that a connection pool synchronizes the amount of thread access to a limited number of database connections. This limit defaults to 5 and can be configured in <code>database.yml</code>.</p> <pre><code class="highlight yaml"><span class="na">development</span><span class="pi">:</span>
  <span class="na">adapter</span><span class="pi">:</span> <span class="s">sqlite3</span>
  <span class="na">database</span><span class="pi">:</span> <span class="s">storage/development.sqlite3</span>
  <span class="na">pool</span><span class="pi">:</span> <span class="m">5</span>
  <span class="na">timeout</span><span class="pi">:</span> <span class="m">5000</span>
</code></pre> <button class="clipboard-button" data-clipboard-text="development:
  adapter: sqlite3
  database: storage/development.sqlite3
  pool: 5
  timeout: 5000
">Copy</button>  <p>Since the connection pooling is handled inside of Active Record by default, all application servers (Thin, Puma, Unicorn, etc.) should behave the same. The database connection pool is initially empty. As demand for connections increases it will create them until it reaches the connection pool limit.</p>
<p>Any one request will check out a connection the first time it requires access to the database. At the end of the request it will check the connection back in. This means that the additional connection slot will be available again for the next request in the queue.</p>
<p>If you try to use more connections than are available, Active Record will block you and wait for a connection from the pool. If it cannot get a connection, a timeout error similar to that given below will be thrown.</p> <pre><code class="highlight plaintext">ActiveRecord::ConnectionTimeoutError - could not obtain a database connection within 5.000 seconds (waited 5.000 seconds)
</code></pre> <button class="clipboard-button" data-clipboard-text="ActiveRecord::ConnectionTimeoutError - could not obtain a database connection within 5.000 seconds (waited 5.000 seconds)
">Copy</button>  <p>If you get the above error, you might want to increase the size of the connection pool by incrementing the <code>pool</code> option in <code>database.yml</code></p>
<div class="note"><p>If you are running in a multi-threaded environment, there could be a chance that several threads may be accessing multiple connections simultaneously. So depending on your current request load, you could very well have multiple threads contending for a limited number of connections.</p></div>
<h1 id="custom-configuration"><a class="anchorlink" href="#custom-configuration">8 Custom Configuration</a></h1>
<p>You can configure your own code through the Rails configuration object with custom configuration under either the <code>config.x</code> namespace, or <code>config</code> directly. The key difference between these two is that you should be using <code>config.x</code> if you are defining <em>nested</em> configuration (ex: <code>config.x.nested.hi</code>), and just <code>config</code> for <em>single level</em> configuration (ex: <code>config.hello</code>).</p> <pre><code class="highlight ruby"><span class="n">config</span><span class="p">.</span><span class="nf">x</span><span class="p">.</span><span class="nf">payment_processing</span><span class="p">.</span><span class="nf">schedule</span> <span class="o">=</span> <span class="ss">:daily</span>
<span class="n">config</span><span class="p">.</span><span class="nf">x</span><span class="p">.</span><span class="nf">payment_processing</span><span class="p">.</span><span class="nf">retries</span>  <span class="o">=</span> <span class="mi">3</span>
<span class="n">config</span><span class="p">.</span><span class="nf">super_debugger</span> <span class="o">=</span> <span class="kp">true</span>
</code></pre> <button class="clipboard-button" data-clipboard-text="config.x.payment_processing.schedule = :daily
config.x.payment_processing.retries  = 3
config.super_debugger = true
">Copy</button>  <p>These configuration points are then available through the configuration object:</p> <pre><code class="highlight ruby"><span class="no">Rails</span><span class="p">.</span><span class="nf">configuration</span><span class="p">.</span><span class="nf">x</span><span class="p">.</span><span class="nf">payment_processing</span><span class="p">.</span><span class="nf">schedule</span> <span class="c1"># =&gt; :daily</span>
<span class="no">Rails</span><span class="p">.</span><span class="nf">configuration</span><span class="p">.</span><span class="nf">x</span><span class="p">.</span><span class="nf">payment_processing</span><span class="p">.</span><span class="nf">retries</span>  <span class="c1"># =&gt; 3</span>
<span class="no">Rails</span><span class="p">.</span><span class="nf">configuration</span><span class="p">.</span><span class="nf">x</span><span class="p">.</span><span class="nf">payment_processing</span><span class="p">.</span><span class="nf">not_set</span>  <span class="c1"># =&gt; nil</span>
<span class="no">Rails</span><span class="p">.</span><span class="nf">configuration</span><span class="p">.</span><span class="nf">super_debugger</span>                <span class="c1"># =&gt; true</span>
</code></pre> <button class="clipboard-button" data-clipboard-text="Rails.configuration.x.payment_processing.schedule # =&gt; :daily
Rails.configuration.x.payment_processing.retries  # =&gt; 3
Rails.configuration.x.payment_processing.not_set  # =&gt; nil
Rails.configuration.super_debugger                # =&gt; true
">Copy</button>  <p>You can also use <code>Rails::Application.config_for</code> to load whole configuration files:</p> <pre><code class="highlight yaml"><span class="c1"># config/payment.yml</span>
<span class="na">production</span><span class="pi">:</span>
  <span class="na">environment</span><span class="pi">:</span> <span class="s">production</span>
  <span class="na">merchant_id</span><span class="pi">:</span> <span class="s">production_merchant_id</span>
  <span class="na">public_key</span><span class="pi">:</span>  <span class="s">production_public_key</span>
  <span class="na">private_key</span><span class="pi">:</span> <span class="s">production_private_key</span>

<span class="na">development</span><span class="pi">:</span>
  <span class="na">environment</span><span class="pi">:</span> <span class="s">sandbox</span>
  <span class="na">merchant_id</span><span class="pi">:</span> <span class="s">development_merchant_id</span>
  <span class="na">public_key</span><span class="pi">:</span>  <span class="s">development_public_key</span>
  <span class="na">private_key</span><span class="pi">:</span> <span class="s">development_private_key</span>
</code></pre> <button class="clipboard-button" data-clipboard-text="# config/payment.yml
production:
  environment: production
  merchant_id: production_merchant_id
  public_key:  production_public_key
  private_key: production_private_key

development:
  environment: sandbox
  merchant_id: development_merchant_id
  public_key:  development_public_key
  private_key: development_private_key
">Copy</button>   <pre><code class="highlight ruby"><span class="c1"># config/application.rb</span>
<span class="k">module</span> <span class="nn">MyApp</span>
  <span class="k">class</span> <span class="nc">Application</span> <span class="o">&lt;</span> <span class="no">Rails</span><span class="o">::</span><span class="no">Application</span>
    <span class="n">config</span><span class="p">.</span><span class="nf">payment</span> <span class="o">=</span> <span class="n">config_for</span><span class="p">(</span><span class="ss">:payment</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre> <button class="clipboard-button" data-clipboard-text="# config/application.rb
module MyApp
  class Application &lt; Rails::Application
    config.payment = config_for(:payment)
  end
end
">Copy</button>   <pre><code class="highlight ruby"><span class="no">Rails</span><span class="p">.</span><span class="nf">configuration</span><span class="p">.</span><span class="nf">payment</span><span class="p">[</span><span class="s1">'merchant_id'</span><span class="p">]</span> <span class="c1"># =&gt; production_merchant_id or development_merchant_id</span>
</code></pre> <button class="clipboard-button" data-clipboard-text="Rails.configuration.payment['merchant_id'] # =&gt; production_merchant_id or development_merchant_id
">Copy</button>  <p><code>Rails::Application.config_for</code> supports a <code>shared</code> configuration to group common configurations. The shared configuration will be merged into the environment configuration.</p> <pre><code class="highlight yaml"><span class="c1"># config/example.yml</span>
<span class="na">shared</span><span class="pi">:</span>
  <span class="na">foo</span><span class="pi">:</span>
    <span class="na">bar</span><span class="pi">:</span>
      <span class="na">baz</span><span class="pi">:</span> <span class="m">1</span>

<span class="na">development</span><span class="pi">:</span>
  <span class="na">foo</span><span class="pi">:</span>
    <span class="na">bar</span><span class="pi">:</span>
      <span class="na">qux</span><span class="pi">:</span> <span class="m">2</span>
</code></pre> <button class="clipboard-button" data-clipboard-text="# config/example.yml
shared:
  foo:
    bar:
      baz: 1

development:
  foo:
    bar:
      qux: 2
">Copy</button>   <pre><code class="highlight ruby"><span class="c1"># development environment</span>
<span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">config_for</span><span class="p">(</span><span class="ss">:example</span><span class="p">)[</span><span class="ss">:foo</span><span class="p">][</span><span class="ss">:bar</span><span class="p">]</span> <span class="c1">#=&gt; { baz: 1, qux: 2 }</span>
</code></pre> <button class="clipboard-button" data-clipboard-text="# development environment
Rails.application.config_for(:example)[:foo][:bar] #=&gt; { baz: 1, qux: 2 }
">Copy</button>  <h1 id="search-engines-indexing"><a class="anchorlink" href="#search-engines-indexing">9 Search Engines Indexing</a></h1>
<p>Sometimes, you may want to prevent some pages of your application to be visible on search sites like Google, Bing, Yahoo, or Duck Duck Go. The robots that index these sites will first analyze the <code>http://your-site.com/robots.txt</code> file to know which pages it is allowed to index.</p>
<p>Rails creates this file for you inside the <code>/public</code> folder. By default, it allows search engines to index all pages of your application. If you want to block indexing on all pages of your application, use this:</p> <pre><code class="highlight plaintext">User-agent: *
Disallow: /
</code></pre> <button class="clipboard-button" data-clipboard-text="User-agent: *
Disallow: /
">Copy</button>  <p>To block just specific pages, it's necessary to use a more complex syntax. Learn it on the <a href="https://www.robotstxt.org/robotstxt.html">official documentation</a>.</p>
<h1 id="evented-file-system-monitor"><a class="anchorlink" href="#evented-file-system-monitor">10 Evented File System Monitor</a></h1>
<p>If the <a href="https://github.com/guard/listen">listen gem</a> is loaded Rails uses an evented file system monitor to detect changes when reloading is enabled:</p> <pre><code class="highlight ruby"><span class="n">group</span> <span class="ss">:development</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">'listen'</span><span class="p">,</span> <span class="s1">'~&gt; 3.5'</span>
<span class="k">end</span>
</code></pre> <button class="clipboard-button" data-clipboard-text="group :development do
  gem 'listen', '~&gt; 3.5'
end
">Copy</button>  <p>Otherwise, in every request Rails walks the application tree to check if anything has changed.</p>
<p>On Linux and macOS no additional gems are needed, but some are required <a href="https://github.com/guard/listen#on-bsd">for *BSD</a> and <a href="https://github.com/guard/listen#on-windows">for Windows</a>.</p>
<p>Note that <a href="https://github.com/guard/listen#issues--limitations">some setups are unsupported</a>.</p> <h2>Feedback</h2> <p> You're encouraged to help improve the quality of this guide. </p> <p> Please contribute if you see any typos or factual errors. To get started, you can read our <a href="https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation">documentation contributions</a> section. </p> <p> You may also find incomplete content or stuff that is not up to date. Please do add any missing documentation for main. Make sure to check <a href="https://edgeguides.rubyonrails.org">Edge Guides</a> first to verify if the issues are already fixed or not on the main branch. Check the <span>Ruby on Rails Guides Guidelines</span> for style and conventions. </p> <p> If for whatever reason you spot something to fix but cannot patch it yourself, please <a href="https://github.com/rails/rails/issues">open an issue</a>. </p> <p>And last but not least, any kind of discussion regarding Ruby on Rails documentation is very welcome on the <a href="https://discuss.rubyonrails.org/c/rubyonrails-docs">official Ruby on Rails Forum</a>. </p> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2004&ndash;2021 David Heinemeier Hansson<br>Licensed under the Creative Commons Attribution-ShareAlike 4.0 International License.<br>
    
  </p>
</div>
