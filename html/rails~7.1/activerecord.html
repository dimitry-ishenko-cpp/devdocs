<h1 id="module-ActiveRecord" class="module"> module ActiveRecord </h1>
<dl class="meta">
<dt>Included modules:</dt>
<dd class="meta-includes"><a class="include" href="activesupport/deprecation/deprecatedconstantaccessor.html">ActiveSupport::Deprecation::DeprecatedConstantAccessor</a></dd>
</dl> <section class="description"> <h1 id="module-ActiveRecord-label-Active+Record+--+Object-relational+mapping+in+Rails">Active Record – Object-relational mapping in Rails</h1> <p>Active Record connects classes to relational database tables to establish an almost zero-configuration persistence layer for applications. The library provides a base class that, when subclassed, sets up a mapping between the new class and an existing table in the database. In the context of an application, these classes are commonly referred to as <strong>models</strong>. Models can also be connected to other models; this is done by defining <strong>associations</strong>.</p> <p>Active Record relies heavily on naming in that it uses class and association names to establish mappings between respective database tables and foreign key columns. Although these mappings can be defined explicitly, it’s recommended to follow naming conventions, especially when getting started with the library.</p> <p>You can read more about Active Record in the <a href="https://guides.rubyonrails.org/active_record_basics.html">Active Record Basics</a> guide.</p> <p>A short rundown of some of the major features:</p> <ul>
<li> <p>Automated mapping between classes and tables, attributes and columns.</p> <pre class="ruby" data-language="ruby">class Product &lt; ActiveRecord::Base
end
</pre> <p>The Product class is automatically mapped to the table named “products”, which might look like this:</p> <pre>CREATE TABLE products (
  id bigint NOT NULL auto_increment,
  name varchar(255),
  PRIMARY KEY  (id)
);</pre> <p>This would also define the following accessors: <code>Product#name</code> and <code>Product#name=(new_name)</code>.</p> <p><span>Learn more</span></p> </li>
<li> <p><span><code>Associations</code></span> between objects defined by simple class methods.</p> <pre class="ruby" data-language="ruby">class Firm &lt; ActiveRecord::Base
  has_many   :clients
  has_one    :account
  belongs_to :conglomerate
end
</pre> <p><span>Learn more</span></p> </li>
<li> <p><a href="activerecord/aggregations.html"><code>Aggregations</code></a> of value objects.</p> <pre class="ruby" data-language="ruby">class Account &lt; ActiveRecord::Base
  composed_of :balance, class_name: 'Money',
              mapping: %w(balance amount)
  composed_of :address,
              mapping: [%w(address_street street), %w(address_city city)]
end
</pre> <p><span>Learn more</span></p> </li>
<li> <p>Validation rules that can differ for new or existing objects.</p> <pre class="ruby" data-language="ruby">class Account &lt; ActiveRecord::Base
  validates :subdomain, :name, :email_address, :password, presence: true
  validates :subdomain, uniqueness: true
  validates :terms_of_service, acceptance: true, on: :create
  validates :password, :email_address, confirmation: true, on: :create
end
</pre> <p><span>Learn more</span></p> </li>
<li> <p><a href="activerecord/callbacks.html"><code>Callbacks</code></a> available for the entire life cycle (instantiation, saving, destroying, validating, etc.).</p> <pre class="ruby" data-language="ruby">class Person &lt; ActiveRecord::Base
  before_destroy :invalidate_payment_plan
  # the `invalidate_payment_plan` method gets called just before Person#destroy
end
</pre> <p><span>Learn more</span></p> </li>
<li> <p><a href="activerecord/inheritance.html"><code>Inheritance</code></a> hierarchies.</p> <pre class="ruby" data-language="ruby">class Company &lt; ActiveRecord::Base; end
class Firm &lt; Company; end
class Client &lt; Company; end
class PriorityClient &lt; Client; end
</pre> <p><span>Learn more</span></p> </li>
<li> <p><a href="activerecord/transactions.html"><code>Transactions</code></a>.</p> <pre class="ruby" data-language="ruby"># Database transaction
Account.transaction do
  david.withdrawal(100)
  mary.deposit(100)
end
</pre> <p><span>Learn more</span></p> </li>
<li> <p>Reflections on columns, associations, and aggregations.</p> <pre class="ruby" data-language="ruby">reflection = Firm.reflect_on_association(:clients)
reflection.klass # =&gt; Client (class)
Firm.columns # Returns an array of column descriptors for the firms table
</pre> <p><span>Learn more</span></p> </li>
<li> <p>Database abstraction through simple adapters.</p> <pre class="ruby" data-language="ruby"># connect to SQLite3
ActiveRecord::Base.establish_connection(adapter: 'sqlite3', database: 'dbfile.sqlite3')

# connect to MySQL with authentication
ActiveRecord::Base.establish_connection(
  adapter:  'mysql2',
  host:     'localhost',
  username: 'me',
  password: 'secret',
  database: 'activerecord'
)
</pre> <p><span>Learn more</span> and read about the built-in support for <span>MySQL</span>, <span>PostgreSQL</span>, and <span>SQLite3</span>.</p> </li>
<li> <p>Logging support for <a href="https://github.com/colbygk/log4r">Log4r</a> and <a href="https://ruby-doc.org/stdlib/libdoc/logger/rdoc/">Logger</a>.</p> <pre class="ruby" data-language="ruby">ActiveRecord::Base.logger = ActiveSupport::Logger.new(STDOUT)
ActiveRecord::Base.logger = Log4r::Logger.new('Application Log')
</pre> </li>
<li> <p>Database agnostic schema management with Migrations.</p> <pre class="ruby" data-language="ruby">class AddSystemSettings &lt; ActiveRecord::Migration[7.1]
  def up
    create_table :system_settings do |t|
      t.string  :name
      t.string  :label
      t.text    :value
      t.string  :type
      t.integer :position
    end

    SystemSetting.create name: 'notice', label: 'Use notice?', value: 1
  end

  def down
    drop_table :system_settings
  end
end
</pre> <p><span>Learn more</span></p> </li>
</ul> <h2 id="module-ActiveRecord-label-Philosophy">Philosophy</h2> <p>Active Record is an implementation of the object-relational mapping (ORM) <a href="https://www.martinfowler.com/eaaCatalog/activeRecord.html">pattern</a> by the same name described by Martin Fowler:</p> <blockquote> <p>“An object that wraps a row in a database table or view, encapsulates the database access, and adds domain logic on that data.”</p> </blockquote> <p>Active Record attempts to provide a coherent wrapper as a solution for the inconvenience that is object-relational mapping. The prime directive for this mapping has been to minimize the amount of code needed to build a real-world domain model. This is made possible by relying on a number of conventions that make it easy for Active Record to infer complex relations and structures from a minimal amount of explicit direction.</p> <p>Convention over Configuration:</p> <ul>
<li> <p>No XML files!</p> </li>
<li> <p>Lots of reflection and run-time extension</p> </li>
<li> <p>Magic is not inherently a bad word</p> </li>
</ul> <p>Admit the Database:</p> <ul>
<li> <p>Lets you drop down to SQL for odd cases and performance</p> </li>
<li> <p>Doesn’t attempt to duplicate or replace data definitions</p> </li>
</ul> <h2 id="module-ActiveRecord-label-Download+and+installation">Download and installation</h2> <p>The latest version of Active Record can be installed with RubyGems:</p> <pre>$ gem install activerecord</pre> <p>Source code can be downloaded as part of the Rails project on GitHub:</p> <ul><li> <p><a href="https://github.com/rails/rails/tree/main/activerecord">github.com/rails/rails/tree/main/activerecord</a></p> </li></ul> <h2 id="module-ActiveRecord-label-License">License</h2> <p>Active Record is released under the MIT license:</p> <ul><li> <p><a href="https://opensource.org/licenses/MIT">opensource.org/licenses/MIT</a></p> </li></ul> <h2 id="module-ActiveRecord-label-Support">Support</h2> <p>API documentation is at:</p> <ul><li> <p><a href="https://api.rubyonrails.org">api.rubyonrails.org</a></p> </li></ul> <p>Bug reports for the Ruby on Rails project can be filed here:</p> <ul><li> <p><a href="https://github.com/rails/rails/issues">github.com/rails/rails/issues</a></p> </li></ul> <p>Feature requests should be discussed on the rails-core mailing list here:</p> <ul><li> <p><a href="https://discuss.rubyonrails.org/c/rubyonrails-core">discuss.rubyonrails.org/c/rubyonrails-core</a></p> </li></ul> </section> <section id="5Buntitled-5D" class="documentation-section"> <section class="constants-list"> <header> <h3>Constants</h3> </header> <dl> <dt id="MigrationProxy">MigrationProxy </dt>
<dd>
<p><a href="activerecord.html#MigrationProxy"><code>MigrationProxy</code></a> is used to defer loading of the actual migration classes until they are needed</p> </dd>
<dt id="Point">Point </dt>

<dt id="UnknownAttributeError">UnknownAttributeError </dt>
<dd>
<h1 id="label-Active+Model+UnknownAttributeError">Active Model UnknownAttributeError</h1> <p>Raised when unknown attributes are supplied via mass assignment.</p> <pre class="ruby" data-language="ruby">class Person
  include ActiveModel::AttributeAssignment
  include ActiveModel::Validations
end

person = Person.new
person.assign_attributes(name: 'Gorby')
# =&gt; ActiveModel::UnknownAttributeError: unknown attribute 'name' for Person.
</pre> </dd>
</dl> </section> <section class="attribute-method-details"> <header> <h3>Attributes</h3> </header> <div class="method-detail"> <div class="method-heading attribute-method-heading" id="attribute-i-application_record_class"> <span class="method-name">application_record_class</span><span class="attribute-access-type">[RW]</span> </div>  </div> <div class="method-detail"> <div class="method-heading attribute-method-heading" id="attribute-i-async_query_executor"> <span class="method-name">async_query_executor</span><span class="attribute-access-type">[RW]</span> </div>  </div> <div class="method-detail"> <div class="method-heading attribute-method-heading" id="attribute-i-before_committed_on_all_records"> <span class="method-name">before_committed_on_all_records</span><span class="attribute-access-type">[RW]</span> </div>  </div> <div class="method-detail"> <div class="method-heading attribute-method-heading" id="attribute-i-belongs_to_required_validates_foreign_key"> <span class="method-name">belongs_to_required_validates_foreign_key</span><span class="attribute-access-type">[RW]</span> </div>  </div> <div class="method-detail"> <div class="method-heading attribute-method-heading" id="attribute-i-commit_transaction_on_non_local_return"> <span class="method-name">commit_transaction_on_non_local_return</span><span class="attribute-access-type">[RW]</span> </div>  </div> <div class="method-detail"> <div class="method-heading attribute-method-heading" id="attribute-i-db_warnings_action"> <span class="method-name">db_warnings_action</span><span class="attribute-access-type">[R]</span> </div>  </div> <div class="method-detail"> <div class="method-heading attribute-method-heading" id="attribute-i-db_warnings_ignore"> <span class="method-name">db_warnings_ignore</span><span class="attribute-access-type">[RW]</span> </div>  </div> <div class="method-detail"> <div class="method-heading attribute-method-heading" id="attribute-i-default_timezone"> <span class="method-name">default_timezone</span><span class="attribute-access-type">[R]</span> </div>  </div> <div class="method-detail"> <div class="method-heading attribute-method-heading" id="attribute-i-disable_prepared_statements"> <span class="method-name">disable_prepared_statements</span><span class="attribute-access-type">[RW]</span> </div>  </div> <div class="method-detail"> <div class="method-heading attribute-method-heading" id="attribute-i-index_nested_attribute_errors"> <span class="method-name">index_nested_attribute_errors</span><span class="attribute-access-type">[RW]</span> </div>  </div> <div class="method-detail"> <div class="method-heading attribute-method-heading" id="attribute-i-lazily_load_schema_cache"> <span class="method-name">lazily_load_schema_cache</span><span class="attribute-access-type">[RW]</span> </div>  </div> <div class="method-detail"> <div class="method-heading attribute-method-heading" id="attribute-i-maintain_test_schema"> <span class="method-name">maintain_test_schema</span><span class="attribute-access-type">[RW]</span> </div>  </div> <div class="method-detail"> <div class="method-heading attribute-method-heading" id="attribute-i-query_transformers"> <span class="method-name">query_transformers</span><span class="attribute-access-type">[RW]</span> </div>  </div> <div class="method-detail"> <div class="method-heading attribute-method-heading" id="attribute-i-raise_on_assign_to_attr_readonly"> <span class="method-name">raise_on_assign_to_attr_readonly</span><span class="attribute-access-type">[RW]</span> </div>  </div> <div class="method-detail"> <div class="method-heading attribute-method-heading" id="attribute-i-reading_role"> <span class="method-name">reading_role</span><span class="attribute-access-type">[RW]</span> </div>  </div> <div class="method-detail"> <div class="method-heading attribute-method-heading" id="attribute-i-run_after_transaction_callbacks_in_order_defined"> <span class="method-name">run_after_transaction_callbacks_in_order_defined</span><span class="attribute-access-type">[RW]</span> </div>  </div> <div class="method-detail"> <div class="method-heading attribute-method-heading" id="attribute-i-schema_cache_ignored_tables"> <span class="method-name">schema_cache_ignored_tables</span><span class="attribute-access-type">[RW]</span> </div>  </div> <div class="method-detail"> <div class="method-heading attribute-method-heading" id="attribute-i-writing_role"> <span class="method-name">writing_role</span><span class="attribute-access-type">[RW]</span> </div>  </div> </section> <section id="public-class-5Buntitled-5D-method-details" class="method-section"> <header> <h3>Public Class Methods</h3> </header> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-c-db_warnings_action-3D"> <span class="method-name">db_warnings_action=</span><span class="method-args">(action)</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="db_warnings_action-3D-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record.rb, line 211
def self.db_warnings_action=(action)
  @db_warnings_action =
    case action
    when :ignore
      nil
    when :log
      -&gt;(warning) do
        warning_message = "[#{warning.class}] #{warning.message}"
        warning_message += " (#{warning.code})" if warning.code
        ActiveRecord::Base.logger.warn(warning_message)
      end
    when :raise
      -&gt;(warning) { raise warning }
    when :report
      -&gt;(warning) { Rails.error.report(warning, handled: true) }
    when Proc
      action
    else
      raise ArgumentError, "db_warnings_action must be one of :ignore, :log, :raise, :report, or a custom proc."
    end
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-c-default_timezone-3D"> <span class="method-name">default_timezone=</span><span class="method-args">(default_timezone)</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="default_timezone-3D-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record.rb, line 196
def self.default_timezone=(default_timezone)
  unless %i(local utc).include?(default_timezone)
    raise ArgumentError, "default_timezone must be either :utc (default) or :local."
  end

  @default_timezone = default_timezone
end</pre> </div> <p>Determines whether to use Time.utc (using :utc) or Time.local (using :local) when pulling dates and times from the database. This is set to :utc by default.</p>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-c-disconnect_all-21"> <span class="method-name">disconnect_all!</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="disconnect_all-21-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record.rb, line 476
def self.disconnect_all!
  ConnectionAdapters::PoolConfig.disconnect_all!
end</pre> </div> <p>Explicitly closes all database connections in all pools.</p>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-c-eager_load-21"> <span class="method-name">eager_load!</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="eager_load-21-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record.rb, line 465
def self.eager_load!
  super
  ActiveRecord::Locking.eager_load!
  ActiveRecord::Scoping.eager_load!
  ActiveRecord::Associations.eager_load!
  ActiveRecord::AttributeMethods.eager_load!
  ActiveRecord::ConnectionAdapters.eager_load!
  ActiveRecord::Encryption.eager_load!
end</pre> </div> <div class="method-calls-super"> Calls superclass method </div>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-c-gem_version"> <span class="method-name">gem_version</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="gem_version-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/gem_version.rb, line 5
def self.gem_version
  Gem::Version.new VERSION::STRING
end</pre> </div> <p>Returns the currently loaded version of Active Record as a <code>Gem::Version</code>.</p>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-c-global_executor_concurrency-3D"> <span class="method-name">global_executor_concurrency=</span><span class="method-args">(global_executor_concurrency)</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="global_executor_concurrency-3D-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record.rb, line 278
def self.global_executor_concurrency=(global_executor_concurrency)
  if self.async_query_executor.nil? || self.async_query_executor == :multi_thread_pool
    raise ArgumentError, "`global_executor_concurrency` cannot be set when using the executor is nil or set to multi_thead_pool. For multiple thread pools, please set the concurrency in your database configuration."
  end

  @global_executor_concurrency = global_executor_concurrency
end</pre> </div> <p>Set the <code>global_executor_concurrency</code>. This configuration value can only be used with the global thread pool async query executor.</p>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-c-legacy_connection_handling-3D"> <span class="method-name">legacy_connection_handling=</span><span class="method-args">(_)</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="legacy_connection_handling-3D-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record.rb, line 245
  def self.legacy_connection_handling=(_)
    raise ArgumentError, &lt;&lt;~MSG.squish
      The `legacy_connection_handling` setter was deprecated in 7.0 and removed in 7.1,
      but is still defined in your configuration. Please remove this call as it no longer
      has any effect."
    MSG
  end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-c-marshalling_format_version"> <span class="method-name">marshalling_format_version</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="marshalling_format_version-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record.rb, line 457
def self.marshalling_format_version
  Marshalling.format_version
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-c-marshalling_format_version-3D"> <span class="method-name">marshalling_format_version=</span><span class="method-args">(value)</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="marshalling_format_version-3D-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record.rb, line 461
def self.marshalling_format_version=(value)
  Marshalling.format_version = value
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-c-suppress_multiple_database_warning"> <span class="method-name">suppress_multiple_database_warning</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="suppress_multiple_database_warning-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record.rb, line 395
  def self.suppress_multiple_database_warning
    ActiveRecord.deprecator.warn(&lt;&lt;-MSG.squish)
      config.active_record.suppress_multiple_database_warning is deprecated and will be removed in Rails 7.2.
      It no longer has any effect and should be removed from the configuration file.
    MSG
  end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-c-suppress_multiple_database_warning-3D"> <span class="method-name">suppress_multiple_database_warning=</span><span class="method-args">(value)</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="suppress_multiple_database_warning-3D-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record.rb, line 402
  def self.suppress_multiple_database_warning=(value)
    ActiveRecord.deprecator.warn(&lt;&lt;-MSG.squish)
      config.active_record.suppress_multiple_database_warning= is deprecated and will be removed in Rails 7.2.
      It no longer has any effect and should be removed from the configuration file.
    MSG
  end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-c-unknown"> <span class="method-name">unknown</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="unknown-source"> <pre class="c" data-language="c"># File activerecord/lib/active_record.rb, line 298
singleton_class.attr_accessor :verbose_query_logs
</pre> </div> <p>Specifies if the methods calling database queries should be logged below their relevant queries. Defaults to false.</p>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-c-version"> <span class="method-name">version</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="version-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/version.rb, line 7
def self.version
  gem_version
end</pre> </div> <p>Returns the currently loaded version of Active Record as a <code>Gem::Version</code>.</p>  </div> </div> </section> </section><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2004&ndash;2021 David Heinemeier Hansson<br>Licensed under the MIT License.<br>
    
  </p>
</div>
