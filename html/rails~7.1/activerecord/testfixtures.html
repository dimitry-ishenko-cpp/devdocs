<h1 id="module-ActiveRecord::TestFixtures" class="module"> module ActiveRecord::TestFixtures </h1>  <section id="5Buntitled-5D" class="documentation-section"> <section id="public-class-5Buntitled-5D-method-details" class="method-section"> <header> <h3>Public Class Methods</h3> </header> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-c-fixture_paths"> <span class="method-name">fixture_paths</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="fixture_paths-source"> <pre class="c" data-language="c"># File activerecord/lib/active_record/test_fixtures.rb, line 21
      </pre> </div> <p>Returns the <a href="fixtureset.html"><code>ActiveRecord::FixtureSet</code></a> collection</p>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-c-fixture_paths-3D"> <span class="method-callseq"> fixture_paths=(fixture_paths) </span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="fixture_paths-3D-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/test_fixtures.rb, line 30
class_attribute :fixture_paths, instance_writer: false, default: []
</pre> </div>  </div> </div> </section> <section id="public-instance-5Buntitled-5D-method-details" class="method-section"> <header> <h3>Public Instance Methods</h3> </header> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-enlist_fixture_connections"> <span class="method-name">enlist_fixture_connections</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="enlist_fixture_connections-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/test_fixtures.rb, line 205
def enlist_fixture_connections
  setup_shared_connection_pool

  ActiveRecord::Base.connection_handler.connection_pool_list(:writing).map(&amp;:connection)
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-run_in_transaction-3F"> <span class="method-name">run_in_transaction?</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="run_in_transaction-3F-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/test_fixtures.rb, line 121
def run_in_transaction?
  use_transactional_tests &amp;&amp;
    !self.class.uses_transaction?(name)
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-setup_fixtures"> <span class="method-name">setup_fixtures</span><span class="method-args">(config = ActiveRecord::Base)</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="setup_fixtures-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/test_fixtures.rb, line 126
def setup_fixtures(config = ActiveRecord::Base)
  if pre_loaded_fixtures &amp;&amp; !use_transactional_tests
    raise RuntimeError, "pre_loaded_fixtures requires use_transactional_tests"
  end

  @fixture_cache = {}
  @fixture_connections = []
  @@already_loaded_fixtures ||= {}
  @connection_subscriber = nil
  @saved_pool_configs = Hash.new { |hash, key| hash[key] = {} }

  # Load fixtures once and begin transaction.
  if run_in_transaction?
    if @@already_loaded_fixtures[self.class]
      @loaded_fixtures = @@already_loaded_fixtures[self.class]
    else
      @loaded_fixtures = load_fixtures(config)
      @@already_loaded_fixtures[self.class] = @loaded_fixtures
    end

    # Begin transactions for connections already established
    @fixture_connections = enlist_fixture_connections
    @fixture_connections.each do |connection|
      connection.begin_transaction joinable: false, _lazy: false
      connection.pool.lock_thread = true if lock_threads
    end

    # When connections are established in the future, begin a transaction too
    @connection_subscriber = ActiveSupport::Notifications.subscribe("!connection.active_record") do |_, _, _, _, payload|
      connection_name = payload[:connection_name] if payload.key?(:connection_name)
      shard = payload[:shard] if payload.key?(:shard)

      if connection_name
        begin
          connection = ActiveRecord::Base.connection_handler.retrieve_connection(connection_name, shard: shard)
        rescue ConnectionNotEstablished
          connection = nil
        end

        if connection
          setup_shared_connection_pool

          if !@fixture_connections.include?(connection)
            connection.begin_transaction joinable: false, _lazy: false
            connection.pool.lock_thread = true if lock_threads
            @fixture_connections &lt;&lt; connection
          end
        end
      end
    end

  # Load fixtures for every test.
  else
    ActiveRecord::FixtureSet.reset_cache
    @@already_loaded_fixtures[self.class] = nil
    @loaded_fixtures = load_fixtures(config)
  end

  # Instantiate fixtures for every test if requested.
  instantiate_fixtures if use_instantiated_fixtures
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-teardown_fixtures"> <span class="method-name">teardown_fixtures</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="teardown_fixtures-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/test_fixtures.rb, line 188
def teardown_fixtures
  # Rollback changes if a transaction is active.
  if run_in_transaction?
    ActiveSupport::Notifications.unsubscribe(@connection_subscriber) if @connection_subscriber
    @fixture_connections.each do |connection|
      connection.rollback_transaction if connection.transaction_open?
      connection.pool.lock_thread = false
    end
    @fixture_connections.clear
    teardown_shared_connection_pool
  else
    ActiveRecord::FixtureSet.reset_cache
  end

  ActiveRecord::Base.connection_handler.clear_active_connections!(:all)
end</pre> </div>  </div> </div> </section> </section><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2004&ndash;2021 David Heinemeier Hansson<br>Licensed under the MIT License.<br>
    
  </p>
</div>
