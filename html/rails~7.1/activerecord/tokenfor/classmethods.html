<h1 id="module-ActiveRecord::TokenFor::ClassMethods" class="module"> module ActiveRecord::TokenFor::ClassMethods </h1>  <section id="5Buntitled-5D" class="documentation-section"> <section id="public-instance-5Buntitled-5D-method-details" class="method-section"> <header> <h3>Public Instance Methods</h3> </header> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-find_by_token_for"> <span class="method-name">find_by_token_for</span><span class="method-args">(purpose, token)</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="find_by_token_for-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/token_for.rb, line 90
def find_by_token_for(purpose, token)
  raise UnknownPrimaryKey.new(self) unless primary_key
  token_definitions.fetch(purpose).resolve_token(token) { |id| find_by(primary_key =&gt; id) }
end</pre> </div> <p>Finds a record using a given <code>token</code> for a predefined <code>purpose</code>. Returns <code>nil</code> if the token is invalid or the record was not found.</p>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-find_by_token_for-21"> <span class="method-name">find_by_token_for!</span><span class="method-args">(purpose, token)</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="find_by_token_for-21-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/token_for.rb, line 99
def find_by_token_for!(purpose, token)
  token_definitions.fetch(purpose).resolve_token(token) { |id| find(id) } ||
    (raise ActiveSupport::MessageVerifier::InvalidSignature)
end</pre> </div> <p>Finds a record using a given <code>token</code> for a predefined <code>purpose</code>. Raises <span><code>ActiveSupport::MessageVerifier::InvalidSignature</code></span> if the token is invalid (e.g. expired, bad format, etc). Raises <a href="../recordnotfound.html"><code>ActiveRecord::RecordNotFound</code></a> if the token is valid but the record was not found.</p>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-generates_token_for"> <span class="method-name">generates_token_for</span><span class="method-args">(purpose, expires_in: nil, &amp;block)</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="generates_token_for-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/token_for.rb, line 84
def generates_token_for(purpose, expires_in: nil, &amp;block)
  self.token_definitions = token_definitions.merge(purpose =&gt; TokenDefinition.new(self, purpose, expires_in, block))
end</pre> </div> <p>Defines the behavior of tokens generated for a specific <code>purpose</code>. A token can be generated by calling <a href="../tokenfor.html#method-i-generate_token_for"><code>TokenFor#generate_token_for</code></a> on a record. Later, that record can be fetched by calling <a href="classmethods.html#method-i-find_by_token_for"><code>find_by_token_for</code></a> (or <a href="classmethods.html#method-i-find_by_token_for-21"><code>find_by_token_for!</code></a>) with the same purpose and token.</p> <p>Tokens are signed so that they are tamper-proof. Thus they can be exposed to outside world as, for example, password reset tokens.</p> <p>By default, tokens do not expire. They can be configured to expire by specifying a duration via the <code>expires_in</code> option. The duration becomes part of the tokenâ€™s signature, so changing the value of <code>expires_in</code> will automatically invalidate previously generated tokens.</p> <p>A block may also be specified. When generating a token with <a href="../tokenfor.html#method-i-generate_token_for"><code>TokenFor#generate_token_for</code></a>, the block will be evaluated in the context of the record, and its return value will be embedded in the token as JSON. Later, when fetching the record with <a href="classmethods.html#method-i-find_by_token_for"><code>find_by_token_for</code></a>, the block will be evaluated again in the context of the fetched record. If the two JSON values do not match, the token will be treated as invalid. Note that the value returned by the block <strong>should not contain sensitive information</strong> because it will be embedded in the token as <strong>human-readable plaintext JSON</strong>.</p> <h4 id="method-i-generates_token_for-label-Examples">Examples</h4> <pre class="ruby" data-language="ruby">class User &lt; ActiveRecord::Base
  has_secure_password

  generates_token_for :password_reset, expires_in: 15.minutes do
    # Last 10 characters of password salt, which changes when password is updated:
    password_salt&amp;.last(10)
  end
end

user = User.first

token = user.generate_token_for(:password_reset)
User.find_by_token_for(:password_reset, token) # =&gt; user
# 16 minutes later...
User.find_by_token_for(:password_reset, token) # =&gt; nil

token = user.generate_token_for(:password_reset)
User.find_by_token_for(:password_reset, token) # =&gt; user
user.update!(password: "new password")
User.find_by_token_for(:password_reset, token) # =&gt; nil
</pre>  </div> </div> </section> </section><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2004&ndash;2021 David Heinemeier Hansson<br>Licensed under the MIT License.<br>
    
  </p>
</div>
