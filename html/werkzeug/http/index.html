<h1 id="http-utilities">HTTP Utilities</h1> <p>Werkzeug provides a couple of functions to parse and generate HTTP headers that are useful when implementing WSGI middlewares or whenever you are operating on a lower level layer. All this functionality is also exposed from request and response objects.</p> <section id="datetime-functions"> <h2>Datetime Functions</h2> <p>These functions simplify working with times in an HTTP context. Werkzeug produces timezone-aware <a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(in Python v3.11)"><code>datetime</code></a> objects in UTC. When passing datetime objects to Werkzeug, it assumes any naive datetime is in UTC.</p> <p>When comparing datetime values from Werkzeug, your own datetime objects must also be timezone-aware, or you must make the values from Werkzeug naive.</p> <ul class="simple"> <li>
<code>dt = datetime.now(timezone.utc)</code> gets the current time in UTC.</li> <li>
<code>dt = datetime(..., tzinfo=timezone.utc)</code> creates a time in UTC.</li> <li>
<code>dt = dt.replace(tzinfo=timezone.utc)</code> makes a naive object aware by assuming it’s in UTC.</li> <li>
<code>dt = dt.replace(tzinfo=None)</code> makes an aware object naive.</li> </ul> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.http.parse_date">
<code>werkzeug.http.parse_date(value)</code> </dt> <dd>
<p>Parse an <a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2822.html" id="index-0"><strong>RFC 2822</strong></a> date into a timezone-aware <a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(in Python v3.11)"><code>datetime.datetime</code></a> object, or <code>None</code> if parsing fails.</p> <p>This is a wrapper for <a class="reference external" href="https://docs.python.org/3/library/email.utils.html#email.utils.parsedate_to_datetime" title="(in Python v3.11)"><code>email.utils.parsedate_to_datetime()</code></a>. It returns <code>None</code> if parsing fails instead of raising an exception, and always returns a timezone-aware datetime object. If the string doesn’t have timezone information, it is assumed to be UTC.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters<span class="colon">:</span>
</dt> <dd class="field-odd">
<p><strong>value</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)">str</a><em> | </em><em>None</em>) – A string with a supported date format.</p> </dd> <dt class="field-even">Return type<span class="colon">:</span>
</dt> <dd class="field-even">
<p><a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(in Python v3.11)">datetime</a> | None</p> </dd> </dl> <details class="changelog"> <summary>Changelog</summary><div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 2.0: </span>Return a timezone-aware datetime object. Use <code>email.utils.parsedate_to_datetime</code>.</p> </div> </details>
</dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.http.http_date">
<code>werkzeug.http.http_date(timestamp=None)</code> </dt> <dd>
<p>Format a datetime object or timestamp into an <a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2822.html" id="index-1"><strong>RFC 2822</strong></a> date string.</p> <p>This is a wrapper for <a class="reference external" href="https://docs.python.org/3/library/email.utils.html#email.utils.format_datetime" title="(in Python v3.11)"><code>email.utils.format_datetime()</code></a>. It assumes naive datetime objects are in UTC instead of raising an exception.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters<span class="colon">:</span>
</dt> <dd class="field-odd">
<p><strong>timestamp</strong> (<a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(in Python v3.11)">datetime</a><em> | </em><a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.date" title="(in Python v3.11)">date</a><em> | </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.11)">int</a><em> | </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.11)">float</a><em> | </em><a class="reference external" href="https://docs.python.org/3/library/time.html#time.struct_time" title="(in Python v3.11)">struct_time</a><em> | </em><em>None</em>) – The datetime or timestamp to format. Defaults to the current time.</p> </dd> <dt class="field-even">Return type<span class="colon">:</span>
</dt> <dd class="field-even">
<p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)">str</a></p> </dd> </dl> <details class="changelog"> <summary>Changelog</summary><div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 2.0: </span>Use <code>email.utils.format_datetime</code>. Accept <code>date</code> objects.</p> </div> </details>
</dd>
</dl> </section> <section id="header-parsing"> <h2>Header Parsing</h2> <p>The following functions can be used to parse incoming HTTP headers. Because Python does not provide data structures with the semantics required by <a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2616.html" id="index-2"><strong>RFC 2616</strong></a>, Werkzeug implements some custom data structures that are <a class="reference internal" href="../datastructures/index.html#http-datastructures"><span class="std std-ref">documented separately</span></a>.</p> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.http.parse_options_header">
<code>werkzeug.http.parse_options_header(value)</code> </dt> <dd>
<p>Parse a header that consists of a value with <code>key=value</code> parameters separated by semicolons <code>;</code>. For example, the <code>Content-Type</code> header.</p> <pre data-language="python">parse_options_header("text/html; charset=UTF-8")
('text/html', {'charset': 'UTF-8'})

parse_options_header("")
("", {})
</pre> <p>This is the reverse of <code>dump_options_header()</code>.</p> <p>This parses valid parameter parts as described in <a class="reference external" href="https://httpwg.org/specs/rfc9110.html#parameter">RFC 9110</a>. Invalid parts are skipped.</p> <p>This handles continuations and charsets as described in <a class="reference external" href="https://www.rfc-editor.org/rfc/rfc2231#section-3">RFC 2231</a>, although not as strictly as the RFC. Only ASCII, UTF-8, and ISO-8859-1 charsets are accepted, otherwise the value remains quoted.</p> <p>Clients may not be consistent in how they handle a quote character within a quoted value. The <a class="reference external" href="https://html.spec.whatwg.org/#multipart-form-data">HTML Standard</a> replaces it with <code>%22</code> in multipart form data. <a class="reference external" href="https://httpwg.org/specs/rfc9110.html#quoted.strings">RFC 9110</a> uses backslash escapes in HTTP headers. Both are decoded to the <code>"</code> character.</p> <p>Clients may not be consistent in how they handle non-ASCII characters. HTML documents must declare <code>&lt;meta charset=UTF-8&gt;</code>, otherwise browsers may replace with HTML character references, which can be decoded using <a class="reference external" href="https://docs.python.org/3/library/html.html#html.unescape" title="(in Python v3.11)"><code>html.unescape()</code></a>.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters<span class="colon">:</span>
</dt> <dd class="field-odd">
<p><strong>value</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)">str</a><em> | </em><em>None</em>) – The header value to parse.</p> </dd> <dt class="field-even">Returns<span class="colon">:</span>
</dt> <dd class="field-even">
<p><code>(value, options)</code>, where <code>options</code> is a dict</p> </dd> <dt class="field-odd">Return type<span class="colon">:</span>
</dt> <dd class="field-odd">
<p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.11)">tuple</a>[<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)">str</a>, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.11)">dict</a>[<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)">str</a>, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)">str</a>]]</p> </dd> </dl> <details class="changelog"> <summary>Changelog</summary><div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 2.3: </span>Invalid parts, such as keys with no value, quoted keys, and incorrectly quoted values, are discarded instead of treating as <code>None</code>.</p> </div> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 2.3: </span>Only ASCII, UTF-8, and ISO-8859-1 are accepted for charset values.</p> </div> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 2.3: </span>Escaped quotes in quoted values, like <code>%22</code> and <code>\"</code>, are handled.</p> </div> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 2.2: </span>Option names are always converted to lowercase.</p> </div> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 2.2: </span>The <code>multiple</code> parameter was removed.</p> </div> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 0.15: </span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2231.html" id="index-3"><strong>RFC 2231</strong></a> parameter continuations are handled.</p> </div> <div class="versionadded"> <p><span class="versionmodified added">New in version 0.5.</span></p> </div> </details>
</dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.http.parse_set_header">
<code>werkzeug.http.parse_set_header(value, on_update=None)</code> </dt> <dd>
<p>Parse a set-like header and return a <a class="reference internal" href="../datastructures/index.html#werkzeug.datastructures.HeaderSet" title="werkzeug.datastructures.HeaderSet"><code>HeaderSet</code></a> object:</p> <pre data-language="python">&gt;&gt;&gt; hs = parse_set_header('token, "quoted value"')
</pre> <p>The return value is an object that treats the items case-insensitively and keeps the order of the items:</p> <pre data-language="python">&gt;&gt;&gt; 'TOKEN' in hs
True
&gt;&gt;&gt; hs.index('quoted value')
1
&gt;&gt;&gt; hs
HeaderSet(['token', 'quoted value'])
</pre> <p>To create a header from the <code>HeaderSet</code> again, use the <a class="reference internal" href="#werkzeug.http.dump_header" title="werkzeug.http.dump_header"><code>dump_header()</code></a> function.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters<span class="colon">:</span>
</dt> <dd class="field-odd">
<ul class="simple"> <li>
<strong>value</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)">str</a><em> | </em><em>None</em>) – a set header to be parsed.</li> <li>
<strong>on_update</strong> (<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Callable" title="(in Python v3.11)">Callable</a><em>[</em><em>[</em><a class="reference internal" href="../datastructures/index.html#werkzeug.datastructures.HeaderSet" title="werkzeug.datastructures.structures.HeaderSet">HeaderSet</a><em>]</em><em>, </em><em>None</em><em>] </em><em>| </em><em>None</em>) – an optional callable that is called every time a value on the <a class="reference internal" href="../datastructures/index.html#werkzeug.datastructures.HeaderSet" title="werkzeug.datastructures.HeaderSet"><code>HeaderSet</code></a> object is changed.</li> </ul> </dd> <dt class="field-even">Returns<span class="colon">:</span>
</dt> <dd class="field-even">
<p>a <a class="reference internal" href="../datastructures/index.html#werkzeug.datastructures.HeaderSet" title="werkzeug.datastructures.HeaderSet"><code>HeaderSet</code></a></p> </dd> <dt class="field-odd">Return type<span class="colon">:</span>
</dt> <dd class="field-odd">
<p><a class="reference internal" href="../datastructures/index.html#werkzeug.datastructures.HeaderSet" title="werkzeug.datastructures.structures.HeaderSet">HeaderSet</a></p> </dd> </dl> </dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.http.parse_list_header">
<code>werkzeug.http.parse_list_header(value)</code> </dt> <dd>
<p>Parse a header value that consists of a list of comma separated items according to <a class="reference external" href="https://httpwg.org/specs/rfc9110.html#abnf.extension">RFC 9110</a>.</p> <p>This extends <code>urllib.request.parse_http_list()</code> to remove surrounding quotes from values.</p> <pre data-language="python">parse_list_header('token, "quoted value"')
['token', 'quoted value']
</pre> <p>This is the reverse of <a class="reference internal" href="#werkzeug.http.dump_header" title="werkzeug.http.dump_header"><code>dump_header()</code></a>.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters<span class="colon">:</span>
</dt> <dd class="field-odd">
<p><strong>value</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)">str</a>) – The header value to parse.</p> </dd> <dt class="field-even">Return type<span class="colon">:</span>
</dt> <dd class="field-even">
<p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.11)">list</a>[<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)">str</a>]</p> </dd> </dl> </dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.http.parse_dict_header">
<code>werkzeug.http.parse_dict_header(value)</code> </dt> <dd>
<p>Parse a list header using <a class="reference internal" href="#werkzeug.http.parse_list_header" title="werkzeug.http.parse_list_header"><code>parse_list_header()</code></a>, then parse each item as a <code>key=value</code> pair.</p> <pre data-language="python">parse_dict_header('a=b, c="d, e", f')
{"a": "b", "c": "d, e", "f": None}
</pre> <p>This is the reverse of <a class="reference internal" href="#werkzeug.http.dump_header" title="werkzeug.http.dump_header"><code>dump_header()</code></a>.</p> <p>If a key does not have a value, it is <code>None</code>.</p> <p>This handles charsets for values as described in <a class="reference external" href="https://www.rfc-editor.org/rfc/rfc2231#section-3">RFC 2231</a>. Only ASCII, UTF-8, and ISO-8859-1 charsets are accepted, otherwise the value remains quoted.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters<span class="colon">:</span>
</dt> <dd class="field-odd">
<p><strong>value</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)">str</a>) – The header value to parse.</p> </dd> <dt class="field-even">Return type<span class="colon">:</span>
</dt> <dd class="field-even">
<p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.11)">dict</a>[<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)">str</a>, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)">str</a> | None]</p> </dd> </dl> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 3.0: </span>Passing bytes is not supported.</p> </div> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 3.0: </span>The <code>cls</code> argument is removed.</p> </div> <details class="changelog"> <summary>Changelog</summary><div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 2.3: </span>Added support for <code>key*=charset''value</code> encoded items.</p> </div> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 0.9: </span>The <code>cls</code> argument was added.</p> </div> </details>
</dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.http.parse_accept_header">
<code>werkzeug.http.parse_accept_header(value: str | None) → Accept</code> </dt> <dt class="sig sig-object py"> <span class="sig-prename descclassname">werkzeug.http.</span><span class="sig-name descname">parse_accept_header</span><span class="sig-paren">(</span><em class="sig-param"><span class="n">value</span><span class="p">:</span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)">str</a><span class="p">|</span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.11)">None</a></span></em>, <em class="sig-param"><span class="n">cls</span><span class="p">:</span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#type" title="(in Python v3.11)">type</a><span class="p">[</span>_TAnyAccept<span class="p">]</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint">_TAnyAccept</span></span>
</dt> <dd>
<p>Parse an <code>Accept</code> header according to <a class="reference external" href="https://httpwg.org/specs/rfc9110.html#field.accept">RFC 9110</a>.</p> <p>Returns an <a class="reference internal" href="../datastructures/index.html#werkzeug.datastructures.Accept" title="werkzeug.datastructures.Accept"><code>Accept</code></a> instance, which can sort and inspect items based on their quality parameter. When parsing <code>Accept-Charset</code>, <code>Accept-Encoding</code>, or <code>Accept-Language</code>, pass the appropriate <a class="reference internal" href="../datastructures/index.html#werkzeug.datastructures.Accept" title="werkzeug.datastructures.Accept"><code>Accept</code></a> subclass.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters<span class="colon">:</span>
</dt> <dd class="field-odd">
<ul class="simple"> <li>
<strong>value</strong> – The header value to parse.</li> <li>
<strong>cls</strong> – The <a class="reference internal" href="../datastructures/index.html#werkzeug.datastructures.Accept" title="werkzeug.datastructures.Accept"><code>Accept</code></a> class to wrap the result in.</li> </ul> </dd> <dt class="field-even">Returns<span class="colon">:</span>
</dt> <dd class="field-even">
<p>An instance of <code>cls</code>.</p> </dd> </dl> <details class="changelog"> <summary>Changelog</summary><div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 2.3: </span>Parse according to RFC 9110. Items with invalid <code>q</code> values are skipped.</p> </div> </details>
</dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.http.parse_cache_control_header">
<code>werkzeug.http.parse_cache_control_header(value: str | None, on_update: Callable[[_TAnyCC], None] | None, cls: None = None) → RequestCacheControl</code> </dt> <dt class="sig sig-object py"> <span class="sig-prename descclassname">werkzeug.http.</span><span class="sig-name descname">parse_cache_control_header</span><span class="sig-paren">(</span><em class="sig-param"><span class="n">value</span><span class="p">:</span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)">str</a><span class="p">|</span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.11)">None</a></span></em>, <em class="sig-param"><span class="n">on_update</span><span class="p">:</span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Callable" title="(in Python v3.11)">Callable</a><span class="p">[</span><span class="p">[</span>_TAnyCC<span class="p">]</span><span class="p">,</span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.11)">None</a><span class="p">]</span><span class="p">|</span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.11)">None</a></span></em>, <em class="sig-param"><span class="n">cls</span><span class="p">:</span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#type" title="(in Python v3.11)">type</a><span class="p">[</span>_TAnyCC<span class="p">]</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint">_TAnyCC</span></span>
</dt> <dd>
<p>Parse a cache control header. The RFC differs between response and request cache control, this method does not. It’s your responsibility to not use the wrong control statements.</p> <details class="changelog"> <summary>Changelog</summary><div class="versionadded"> <p><span class="versionmodified added">New in version 0.5: </span>The <code>cls</code> was added. If not specified an immutable <a class="reference internal" href="../datastructures/index.html#werkzeug.datastructures.RequestCacheControl" title="werkzeug.datastructures.RequestCacheControl"><code>RequestCacheControl</code></a> is returned.</p> </div> </details><dl class="field-list simple"> <dt class="field-odd">Parameters<span class="colon">:</span>
</dt> <dd class="field-odd">
<ul class="simple"> <li>
<strong>value</strong> – a cache control header to be parsed.</li> <li>
<strong>on_update</strong> – an optional callable that is called every time a value on the <code>CacheControl</code> object is changed.</li> <li>
<strong>cls</strong> – the class for the returned object. By default <a class="reference internal" href="../datastructures/index.html#werkzeug.datastructures.RequestCacheControl" title="werkzeug.datastructures.RequestCacheControl"><code>RequestCacheControl</code></a> is used.</li> </ul> </dd> <dt class="field-even">Returns<span class="colon">:</span>
</dt> <dd class="field-even">
<p>a <code>cls</code> object.</p> </dd> </dl> </dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.http.parse_if_range_header">
<code>werkzeug.http.parse_if_range_header(value)</code> </dt> <dd>
<p>Parses an if-range header which can be an etag or a date. Returns a <a class="reference internal" href="../datastructures/index.html#werkzeug.datastructures.IfRange" title="werkzeug.datastructures.IfRange"><code>IfRange</code></a> object.</p> <details class="changelog"> <summary>Changelog</summary><div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 2.0: </span>If the value represents a datetime, it is timezone-aware.</p> </div> <div class="versionadded"> <p><span class="versionmodified added">New in version 0.7.</span></p> </div> </details><dl class="field-list simple"> <dt class="field-odd">Parameters<span class="colon">:</span>
</dt> <dd class="field-odd">
<p><strong>value</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)">str</a><em> | </em><em>None</em>) – </p> </dd> <dt class="field-even">Return type<span class="colon">:</span>
</dt> <dd class="field-even">
<p><a class="reference internal" href="../datastructures/index.html#werkzeug.datastructures.IfRange" title="werkzeug.datastructures.range.IfRange">IfRange</a></p> </dd> </dl> </dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.http.parse_range_header">
<code>werkzeug.http.parse_range_header(value, make_inclusive=True)</code> </dt> <dd>
<p>Parses a range header into a <a class="reference internal" href="../datastructures/index.html#werkzeug.datastructures.Range" title="werkzeug.datastructures.Range"><code>Range</code></a> object. If the header is missing or malformed <code>None</code> is returned. <code>ranges</code> is a list of <code>(start, stop)</code> tuples where the ranges are non-inclusive.</p> <details class="changelog"> <summary>Changelog</summary><div class="versionadded"> <p><span class="versionmodified added">New in version 0.7.</span></p> </div> </details><dl class="field-list simple"> <dt class="field-odd">Parameters<span class="colon">:</span>
</dt> <dd class="field-odd">
<ul class="simple"> <li>
<strong>value</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)">str</a><em> | </em><em>None</em>) – </li> <li>
<strong>make_inclusive</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)">bool</a>) – </li> </ul> </dd> <dt class="field-even">Return type<span class="colon">:</span>
</dt> <dd class="field-even">
<p><a class="reference internal" href="../datastructures/index.html#werkzeug.datastructures.Range" title="werkzeug.datastructures.range.Range">Range</a> | None</p> </dd> </dl> </dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.http.parse_content_range_header">
<code>werkzeug.http.parse_content_range_header(value, on_update=None)</code> </dt> <dd>
<p>Parses a range header into a <a class="reference internal" href="../datastructures/index.html#werkzeug.datastructures.ContentRange" title="werkzeug.datastructures.ContentRange"><code>ContentRange</code></a> object or <code>None</code> if parsing is not possible.</p> <details class="changelog"> <summary>Changelog</summary><div class="versionadded"> <p><span class="versionmodified added">New in version 0.7.</span></p> </div> </details><dl class="field-list simple"> <dt class="field-odd">Parameters<span class="colon">:</span>
</dt> <dd class="field-odd">
<ul class="simple"> <li>
<strong>value</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)">str</a><em> | </em><em>None</em>) – a content range header to be parsed.</li> <li>
<strong>on_update</strong> (<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Callable" title="(in Python v3.11)">Callable</a><em>[</em><em>[</em><a class="reference internal" href="../datastructures/index.html#werkzeug.datastructures.ContentRange" title="werkzeug.datastructures.range.ContentRange">ContentRange</a><em>]</em><em>, </em><em>None</em><em>] </em><em>| </em><em>None</em>) – an optional callable that is called every time a value on the <a class="reference internal" href="../datastructures/index.html#werkzeug.datastructures.ContentRange" title="werkzeug.datastructures.ContentRange"><code>ContentRange</code></a> object is changed.</li> </ul> </dd> <dt class="field-even">Return type<span class="colon">:</span>
</dt> <dd class="field-even">
<p><a class="reference internal" href="../datastructures/index.html#werkzeug.datastructures.ContentRange" title="werkzeug.datastructures.range.ContentRange">ContentRange</a> | None</p> </dd> </dl> </dd>
</dl> </section> <section id="header-utilities"> <h2>Header Utilities</h2> <p>The following utilities operate on HTTP headers well but do not parse them. They are useful if you’re dealing with conditional responses or if you want to proxy arbitrary requests but want to remove WSGI-unsupported hop-by-hop headers. Also there is a function to create HTTP header strings from the parsed data.</p> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.http.is_entity_header">
<code>werkzeug.http.is_entity_header(header)</code> </dt> <dd>
<p>Check if a header is an entity header.</p> <details class="changelog"> <summary>Changelog</summary><div class="versionadded"> <p><span class="versionmodified added">New in version 0.5.</span></p> </div> </details><dl class="field-list simple"> <dt class="field-odd">Parameters<span class="colon">:</span>
</dt> <dd class="field-odd">
<p><strong>header</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)">str</a>) – the header to test.</p> </dd> <dt class="field-even">Returns<span class="colon">:</span>
</dt> <dd class="field-even">
<p><code>True</code> if it’s an entity header, <code>False</code> otherwise.</p> </dd> <dt class="field-odd">Return type<span class="colon">:</span>
</dt> <dd class="field-odd">
<p><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)">bool</a></p> </dd> </dl> </dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.http.is_hop_by_hop_header">
<code>werkzeug.http.is_hop_by_hop_header(header)</code> </dt> <dd>
<p>Check if a header is an HTTP/1.1 “Hop-by-Hop” header.</p> <details class="changelog"> <summary>Changelog</summary><div class="versionadded"> <p><span class="versionmodified added">New in version 0.5.</span></p> </div> </details><dl class="field-list simple"> <dt class="field-odd">Parameters<span class="colon">:</span>
</dt> <dd class="field-odd">
<p><strong>header</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)">str</a>) – the header to test.</p> </dd> <dt class="field-even">Returns<span class="colon">:</span>
</dt> <dd class="field-even">
<p><code>True</code> if it’s an HTTP/1.1 “Hop-by-Hop” header, <code>False</code> otherwise.</p> </dd> <dt class="field-odd">Return type<span class="colon">:</span>
</dt> <dd class="field-odd">
<p><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)">bool</a></p> </dd> </dl> </dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.http.remove_entity_headers">
<code>werkzeug.http.remove_entity_headers(headers, allowed=('expires', 'content-location'))</code> </dt> <dd>
<p>Remove all entity headers from a list or <code>Headers</code> object. This operation works in-place. <code>Expires</code> and <code>Content-Location</code> headers are by default not removed. The reason for this is <a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2616.html" id="index-4"><strong>RFC 2616</strong></a> section 10.3.5 which specifies some entity headers that should be sent.</p> <details class="changelog"> <summary>Changelog</summary><div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 0.5: </span>added <code>allowed</code> parameter.</p> </div> </details><dl class="field-list simple"> <dt class="field-odd">Parameters<span class="colon">:</span>
</dt> <dd class="field-odd">
<ul class="simple"> <li>
<strong>headers</strong> (<a class="reference internal" href="../datastructures/index.html#werkzeug.datastructures.Headers" title="werkzeug.datastructures.headers.Headers">Headers</a><em> | </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.11)">list</a><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.11)">tuple</a><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)">str</a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)">str</a><em>]</em><em>]</em>) – a list or <code>Headers</code> object.</li> <li>
<strong>allowed</strong> (<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Iterable" title="(in Python v3.11)">Iterable</a><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)">str</a><em>]</em>) – a list of headers that should still be allowed even though they are entity headers.</li> </ul> </dd> <dt class="field-even">Return type<span class="colon">:</span>
</dt> <dd class="field-even">
<p>None</p> </dd> </dl> </dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.http.remove_hop_by_hop_headers">
<code>werkzeug.http.remove_hop_by_hop_headers(headers)</code> </dt> <dd>
<p>Remove all HTTP/1.1 “Hop-by-Hop” headers from a list or <code>Headers</code> object. This operation works in-place.</p> <details class="changelog"> <summary>Changelog</summary><div class="versionadded"> <p><span class="versionmodified added">New in version 0.5.</span></p> </div> </details><dl class="field-list simple"> <dt class="field-odd">Parameters<span class="colon">:</span>
</dt> <dd class="field-odd">
<p><strong>headers</strong> (<a class="reference internal" href="../datastructures/index.html#werkzeug.datastructures.Headers" title="werkzeug.datastructures.headers.Headers">Headers</a><em> | </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.11)">list</a><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.11)">tuple</a><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)">str</a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)">str</a><em>]</em><em>]</em>) – a list or <code>Headers</code> object.</p> </dd> <dt class="field-even">Return type<span class="colon">:</span>
</dt> <dd class="field-even">
<p>None</p> </dd> </dl> </dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.http.is_byte_range_valid">
<code>werkzeug.http.is_byte_range_valid(start, stop, length)</code> </dt> <dd>
<p>Checks if a given byte content range is valid for the given length.</p> <details class="changelog"> <summary>Changelog</summary><div class="versionadded"> <p><span class="versionmodified added">New in version 0.7.</span></p> </div> </details><dl class="field-list simple"> <dt class="field-odd">Parameters<span class="colon">:</span>
</dt> <dd class="field-odd">
<ul class="simple"> <li>
<strong>start</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.11)">int</a><em> | </em><em>None</em>) – </li> <li>
<strong>stop</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.11)">int</a><em> | </em><em>None</em>) – </li> <li>
<strong>length</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.11)">int</a><em> | </em><em>None</em>) – </li> </ul> </dd> <dt class="field-even">Return type<span class="colon">:</span>
</dt> <dd class="field-even">
<p><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)">bool</a></p> </dd> </dl> </dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.http.quote_header_value">
<code>werkzeug.http.quote_header_value(value, allow_token=True)</code> </dt> <dd>
<p>Add double quotes around a header value. If the header contains only ASCII token characters, it will be returned unchanged. If the header contains <code>"</code> or <code>\</code> characters, they will be escaped with an additional <code>\</code> character.</p> <p>This is the reverse of <a class="reference internal" href="#werkzeug.http.unquote_header_value" title="werkzeug.http.unquote_header_value"><code>unquote_header_value()</code></a>.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters<span class="colon">:</span>
</dt> <dd class="field-odd">
<ul class="simple"> <li>
<strong>value</strong> (<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Any" title="(in Python v3.11)">Any</a>) – The value to quote. Will be converted to a string.</li> <li>
<strong>allow_token</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)">bool</a>) – Disable to quote the value even if it only has token characters.</li> </ul> </dd> <dt class="field-even">Return type<span class="colon">:</span>
</dt> <dd class="field-even">
<p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)">str</a></p> </dd> </dl> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 3.0: </span>Passing bytes is not supported.</p> </div> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 3.0: </span>The <code>extra_chars</code> parameter is removed.</p> </div> <details class="changelog"> <summary>Changelog</summary><div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 2.3: </span>The value is quoted if it is the empty string.</p> </div> <div class="versionadded"> <p><span class="versionmodified added">New in version 0.5.</span></p> </div> </details>
</dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.http.unquote_header_value">
<code>werkzeug.http.unquote_header_value(value)</code> </dt> <dd>
<p>Remove double quotes and decode slash-escaped <code>"</code> and <code>\</code> characters in a header value.</p> <p>This is the reverse of <a class="reference internal" href="#werkzeug.http.quote_header_value" title="werkzeug.http.quote_header_value"><code>quote_header_value()</code></a>.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters<span class="colon">:</span>
</dt> <dd class="field-odd">
<p><strong>value</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)">str</a>) – The header value to unquote.</p> </dd> <dt class="field-even">Return type<span class="colon">:</span>
</dt> <dd class="field-even">
<p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)">str</a></p> </dd> </dl> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 3.0: </span>The <code>is_filename</code> parameter is removed.</p> </div> </dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.http.dump_header">
<code>werkzeug.http.dump_header(iterable)</code> </dt> <dd>
<p>Produce a header value from a list of items or <code>key=value</code> pairs, separated by commas <code>,</code>.</p> <p>This is the reverse of <a class="reference internal" href="#werkzeug.http.parse_list_header" title="werkzeug.http.parse_list_header"><code>parse_list_header()</code></a>, <a class="reference internal" href="#werkzeug.http.parse_dict_header" title="werkzeug.http.parse_dict_header"><code>parse_dict_header()</code></a>, and <a class="reference internal" href="#werkzeug.http.parse_set_header" title="werkzeug.http.parse_set_header"><code>parse_set_header()</code></a>.</p> <p>If a value contains non-token characters, it will be quoted.</p> <p>If a value is <code>None</code>, the key is output alone.</p> <p>In some keys for some headers, a UTF-8 value can be encoded using a special <code>key*=UTF-8''value</code> form, where <code>value</code> is percent encoded. This function will not produce that format automatically, but if a given key ends with an asterisk <code>*</code>, the value is assumed to have that form and will not be quoted further.</p> <pre data-language="python">dump_header(["foo", "bar baz"])
'foo, "bar baz"'

dump_header({"foo": "bar baz"})
'foo="bar baz"'
</pre> <dl class="field-list simple"> <dt class="field-odd">Parameters<span class="colon">:</span>
</dt> <dd class="field-odd">
<p><strong>iterable</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.11)">dict</a><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)">str</a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Any" title="(in Python v3.11)">Any</a><em>] </em><em>| </em><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Iterable" title="(in Python v3.11)">Iterable</a><em>[</em><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Any" title="(in Python v3.11)">Any</a><em>]</em>) – The items to create a header from.</p> </dd> <dt class="field-even">Return type<span class="colon">:</span>
</dt> <dd class="field-even">
<p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)">str</a></p> </dd> </dl> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 3.0: </span>The <code>allow_token</code> parameter is removed.</p> </div> <details class="changelog"> <summary>Changelog</summary><div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 2.2.3: </span>If a key ends with <code>*</code>, its value will not be quoted.</p> </div> </details>
</dd>
</dl> </section> <section id="cookies"> <h2>Cookies</h2> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.http.parse_cookie">
<code>werkzeug.http.parse_cookie(header, cls=None)</code> </dt> <dd>
<p>Parse a cookie from a string or WSGI environ.</p> <p>The same key can be provided multiple times, the values are stored in-order. The default <code>MultiDict</code> will have the first value first, and all values can be retrieved with <code>MultiDict.getlist()</code>.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters<span class="colon">:</span>
</dt> <dd class="field-odd">
<ul class="simple"> <li>
<strong>header</strong> (<em>WSGIEnvironment</em><em> | </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)">str</a><em> | </em><em>None</em>) – The cookie header as a string, or a WSGI environ dict with a <code>HTTP_COOKIE</code> key.</li> <li>
<strong>cls</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#type" title="(in Python v3.11)">type</a><em>[</em><em>ds.MultiDict</em><em>] </em><em>| </em><em>None</em>) – A dict-like class to store the parsed cookies in. Defaults to <code>MultiDict</code>.</li> </ul> </dd> <dt class="field-even">Return type<span class="colon">:</span>
</dt> <dd class="field-even">
<p>ds.MultiDict[<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)">str</a>, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)">str</a>]</p> </dd> </dl> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 3.0: </span>Passing bytes, and the <code>charset</code> and <code>errors</code> parameters, were removed.</p> </div> <details class="changelog"> <summary>Changelog</summary><div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 1.0: </span>Returns a <code>MultiDict</code> instead of a <code>TypeConversionDict</code>.</p> </div> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 0.5: </span>Returns a <code>TypeConversionDict</code> instead of a regular dict. The <code>cls</code> parameter was added.</p> </div> </details>
</dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.http.dump_cookie">
<code>werkzeug.http.dump_cookie(key, value='', max_age=None, expires=None, path='/', domain=None, secure=False, httponly=False, sync_expires=True, max_size=4093, samesite=None)</code> </dt> <dd>
<p>Create a Set-Cookie header without the <code>Set-Cookie</code> prefix.</p> <p>The return value is usually restricted to ascii as the vast majority of values are properly escaped, but that is no guarantee. It’s tunneled through latin1 as required by <a class="pep reference external" href="https://peps.python.org/pep-3333/" id="index-5"><strong>PEP 3333</strong></a>.</p> <p>The return value is not ASCII safe if the key contains unicode characters. This is technically against the specification but happens in the wild. It’s strongly recommended to not use non-ASCII values for the keys.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters<span class="colon">:</span>
</dt> <dd class="field-odd">
<ul class="simple"> <li>
<strong>max_age</strong> (<a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.timedelta" title="(in Python v3.11)">timedelta</a><em> | </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.11)">int</a><em> | </em><em>None</em>) – should be a number of seconds, or <code>None</code> (default) if the cookie should last only as long as the client’s browser session. Additionally <code>timedelta</code> objects are accepted, too.</li> <li>
<strong>expires</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)">str</a><em> | </em><a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(in Python v3.11)">datetime</a><em> | </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.11)">int</a><em> | </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.11)">float</a><em> | </em><em>None</em>) – should be a <code>datetime</code> object or unix timestamp.</li> <li>
<strong>path</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)">str</a><em> | </em><em>None</em>) – limits the cookie to a given path, per default it will span the whole domain.</li> <li>
<strong>domain</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)">str</a><em> | </em><em>None</em>) – Use this if you want to set a cross-domain cookie. For example, <code>domain="example.com"</code> will set a cookie that is readable by the domain <code>www.example.com</code>, <code>foo.example.com</code> etc. Otherwise, a cookie will only be readable by the domain that set it.</li> <li>
<strong>secure</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)">bool</a>) – The cookie will only be available via HTTPS</li> <li>
<strong>httponly</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)">bool</a>) – disallow JavaScript to access the cookie. This is an extension to the cookie standard and probably not supported by all browsers.</li> <li>
<strong>charset</strong> – the encoding for string values.</li> <li>
<strong>sync_expires</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)">bool</a>) – automatically set expires if max_age is defined but expires not.</li> <li>
<strong>max_size</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.11)">int</a>) – Warn if the final header value exceeds this size. The default, 4093, should be safely <a class="reference external" href="http://browsercookielimits.squawky.net/">supported by most browsers</a>. Set to 0 to disable this check.</li> <li>
<strong>samesite</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)">str</a><em> | </em><em>None</em>) – Limits the scope of the cookie such that it will only be attached to requests if those requests are same-site.</li> <li>
<strong>key</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)">str</a>) – </li> <li>
<strong>value</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)">str</a>) – </li> </ul> </dd> <dt class="field-even">Return type<span class="colon">:</span>
</dt> <dd class="field-even">
<p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)">str</a></p> </dd> </dl> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 3.0: </span>Passing bytes, and the <code>charset</code> parameter, were removed.</p> </div> <details class="changelog"> <summary>Changelog</summary><div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 2.3.3: </span>The <code>path</code> parameter is <code>/</code> by default.</p> </div> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 2.3.1: </span>The value allows more characters without quoting.</p> </div> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 2.3: </span><code>localhost</code> and other names without a dot are allowed for the domain. A leading dot is ignored.</p> </div> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 2.3: </span>The <code>path</code> parameter is <code>None</code> by default.</p> </div> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 1.0.0: </span>The string <code>'None'</code> is accepted for <code>samesite</code>.</p> </div> </details>
</dd>
</dl> </section> <section id="conditional-response-helpers"> <h2>Conditional Response Helpers</h2> <p>For conditional responses the following functions might be useful:</p> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.http.parse_etags">
<code>werkzeug.http.parse_etags(value)</code> </dt> <dd>
<p>Parse an etag header.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters<span class="colon">:</span>
</dt> <dd class="field-odd">
<p><strong>value</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)">str</a><em> | </em><em>None</em>) – the tag header to parse</p> </dd> <dt class="field-even">Returns<span class="colon">:</span>
</dt> <dd class="field-even">
<p>an <a class="reference internal" href="../datastructures/index.html#werkzeug.datastructures.ETags" title="werkzeug.datastructures.ETags"><code>ETags</code></a> object.</p> </dd> <dt class="field-odd">Return type<span class="colon">:</span>
</dt> <dd class="field-odd">
<p><a class="reference internal" href="../datastructures/index.html#werkzeug.datastructures.ETags" title="werkzeug.datastructures.etag.ETags">ETags</a></p> </dd> </dl> </dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.http.quote_etag">
<code>werkzeug.http.quote_etag(etag, weak=False)</code> </dt> <dd>
<p>Quote an etag.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters<span class="colon">:</span>
</dt> <dd class="field-odd">
<ul class="simple"> <li>
<strong>etag</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)">str</a>) – the etag to quote.</li> <li>
<strong>weak</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)">bool</a>) – set to <code>True</code> to tag it “weak”.</li> </ul> </dd> <dt class="field-even">Return type<span class="colon">:</span>
</dt> <dd class="field-even">
<p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)">str</a></p> </dd> </dl> </dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.http.unquote_etag">
<code>werkzeug.http.unquote_etag(etag)</code> </dt> <dd>
<p>Unquote a single etag:</p> <pre data-language="python">&gt;&gt;&gt; unquote_etag('W/"bar"')
('bar', True)
&gt;&gt;&gt; unquote_etag('"bar"')
('bar', False)
</pre> <dl class="field-list simple"> <dt class="field-odd">Parameters<span class="colon">:</span>
</dt> <dd class="field-odd">
<p><strong>etag</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)">str</a><em> | </em><em>None</em>) – the etag identifier to unquote.</p> </dd> <dt class="field-even">Returns<span class="colon">:</span>
</dt> <dd class="field-even">
<p>a <code>(etag, weak)</code> tuple.</p> </dd> <dt class="field-odd">Return type<span class="colon">:</span>
</dt> <dd class="field-odd">
<p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.11)">tuple</a>[<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)">str</a>, <a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)">bool</a>] | <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.11)">tuple</a>[None, None]</p> </dd> </dl> </dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.http.generate_etag">
<code>werkzeug.http.generate_etag(data)</code> </dt> <dd>
<p>Generate an etag for some data.</p> <details class="changelog"> <summary>Changelog</summary><div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 2.0: </span>Use SHA-1. MD5 may not be available in some environments.</p> </div> </details><dl class="field-list simple"> <dt class="field-odd">Parameters<span class="colon">:</span>
</dt> <dd class="field-odd">
<p><strong>data</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.11)">bytes</a>) – </p> </dd> <dt class="field-even">Return type<span class="colon">:</span>
</dt> <dd class="field-even">
<p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)">str</a></p> </dd> </dl> </dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.http.is_resource_modified">
<code>werkzeug.http.is_resource_modified(environ, etag=None, data=None, last_modified=None, ignore_if_range=True)</code> </dt> <dd>
<p>Convenience method for conditional requests.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters<span class="colon">:</span>
</dt> <dd class="field-odd">
<ul class="simple"> <li>
<strong>environ</strong> (<em>WSGIEnvironment</em>) – the WSGI environment of the request to be checked.</li> <li>
<strong>etag</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)">str</a><em> | </em><em>None</em>) – the etag for the response for comparison.</li> <li>
<strong>data</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.11)">bytes</a><em> | </em><em>None</em>) – or alternatively the data of the response to automatically generate an etag using <a class="reference internal" href="#werkzeug.http.generate_etag" title="werkzeug.http.generate_etag"><code>generate_etag()</code></a>.</li> <li>
<strong>last_modified</strong> (<em>datetime</em><em> | </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)">str</a><em> | </em><em>None</em>) – an optional date of the last modification.</li> <li>
<strong>ignore_if_range</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)">bool</a>) – If <code>False</code>, <code>If-Range</code> header will be taken into account.</li> </ul> </dd> <dt class="field-even">Returns<span class="colon">:</span>
</dt> <dd class="field-even">
<p><code>True</code> if the resource was modified, otherwise <code>False</code>.</p> </dd> <dt class="field-odd">Return type<span class="colon">:</span>
</dt> <dd class="field-odd">
<p><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)">bool</a></p> </dd> </dl> <details class="changelog"> <summary>Changelog</summary><div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 2.0: </span>SHA-1 is used to generate an etag value for the data. MD5 may not be available in some environments.</p> </div> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 1.0.0: </span>The check is run for methods other than <code>GET</code> and <code>HEAD</code>.</p> </div> </details>
</dd>
</dl> </section> <section id="constants"> <h2>Constants</h2> <dl class="py data"> <dt class="sig sig-object py" id="werkzeug.http.HTTP_STATUS_CODES">
<code>werkzeug.http.HTTP_STATUS_CODES</code> </dt> <dd>
<p>A dict of status code -&gt; default status message pairs. This is used by the wrappers and other places where an integer status code is expanded to a string throughout Werkzeug.</p> </dd>
</dl> </section> <section id="module-werkzeug.formparser"> <h2 id="form-data-parsing">Form Data Parsing</h2> <p>Werkzeug provides the form parsing functions separately from the request object so that you can access form data from a plain WSGI environment.</p> <p>The following formats are currently supported by the form data parser:</p> <ul class="simple"> <li><code>application/x-www-form-urlencoded</code></li> <li><code>multipart/form-data</code></li> </ul> <p>Nested multipart is not currently supported (Werkzeug 0.9), but it isn’t used by any of the modern web browsers.</p> <p>Usage example:</p> <pre data-language="python">&gt;&gt;&gt; from io import BytesIO
&gt;&gt;&gt; from werkzeug.formparser import parse_form_data
&gt;&gt;&gt; data = (
...     b'--foo\r\nContent-Disposition: form-data; name="test"\r\n'
...     b"\r\nHello World!\r\n--foo--"
... )
&gt;&gt;&gt; environ = {
...     "wsgi.input": BytesIO(data),
...     "CONTENT_LENGTH": str(len(data)),
...     "CONTENT_TYPE": "multipart/form-data; boundary=foo",
...     "REQUEST_METHOD": "POST",
... }
&gt;&gt;&gt; stream, form, files = parse_form_data(environ)
&gt;&gt;&gt; stream.read()
b''
&gt;&gt;&gt; form['test']
'Hello World!'
&gt;&gt;&gt; not files
True
</pre> <p>Normally the WSGI environment is provided by the WSGI gateway with the incoming data as part of it. If you want to generate such fake-WSGI environments for unittesting you might want to use the <code>create_environ()</code> function or the <code>EnvironBuilder</code> instead.</p> <dl class="py class"> <dt class="sig sig-object py" id="werkzeug.formparser.FormDataParser">
<code>class werkzeug.formparser.FormDataParser(stream_factory=None, max_form_memory_size=None, max_content_length=None, cls=None, silent=True, *, max_form_parts=None)</code> </dt> <dd>
<p>This class implements parsing of form data for Werkzeug. By itself it can parse multipart and url encoded form data. It can be subclassed and extended but for most mimetypes it is a better idea to use the untouched stream and expose it as separate attributes on a request object.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters<span class="colon">:</span>
</dt> <dd class="field-odd">
<ul class="simple"> <li>
<strong>stream_factory</strong> (<em>TStreamFactory</em><em> | </em><em>None</em>) – An optional callable that returns a new read and writeable file descriptor. This callable works the same as <code>Response._get_file_stream()</code>.</li> <li>
<strong>max_form_memory_size</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.11)">int</a><em> | </em><em>None</em>) – the maximum number of bytes to be accepted for in-memory stored form data. If the data exceeds the value specified an <code>RequestEntityTooLarge</code> exception is raised.</li> <li>
<strong>max_content_length</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.11)">int</a><em> | </em><em>None</em>) – If this is provided and the transmitted data is longer than this value an <code>RequestEntityTooLarge</code> exception is raised.</li> <li>
<strong>cls</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#type" title="(in Python v3.11)">type</a><em>[</em><a class="reference internal" href="../datastructures/index.html#werkzeug.datastructures.MultiDict" title="werkzeug.datastructures.MultiDict">MultiDict</a><em>] </em><em>| </em><em>None</em>) – an optional dict class to use. If this is not specified or <code>None</code> the default <code>MultiDict</code> is used.</li> <li>
<strong>silent</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)">bool</a>) – If set to False parsing errors will not be caught.</li> <li>
<strong>max_form_parts</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.11)">int</a><em> | </em><em>None</em>) – The maximum number of multipart parts to be parsed. If this is exceeded, a <code>RequestEntityTooLarge</code> exception is raised.</li> </ul> </dd> </dl> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 3.0: </span>The <code>charset</code> and <code>errors</code> parameters were removed.</p> </div> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 3.0: </span>The <code>parse_functions</code> attribute and <code>get_parse_func</code> methods were removed.</p> </div> <details class="changelog"> <summary>Changelog</summary><div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 2.2.3: </span>Added the <code>max_form_parts</code> parameter.</p> </div> <div class="versionadded"> <p><span class="versionmodified added">New in version 0.8.</span></p> </div> </details>
</dd>
</dl> <dl class="py function"> <dt class="sig sig-object py" id="werkzeug.formparser.parse_form_data">
<code>werkzeug.formparser.parse_form_data(environ, stream_factory=None, max_form_memory_size=None, max_content_length=None, cls=None, silent=True, *, max_form_parts=None)</code> </dt> <dd>
<p>Parse the form data in the environ and return it as tuple in the form <code>(stream, form, files)</code>. You should only call this method if the transport method is <code>POST</code>, <code>PUT</code>, or <code>PATCH</code>.</p> <p>If the mimetype of the data transmitted is <code>multipart/form-data</code> the files multidict will be filled with <code>FileStorage</code> objects. If the mimetype is unknown the input stream is wrapped and returned as first argument, else the stream is empty.</p> <p>This is a shortcut for the common usage of <a class="reference internal" href="#werkzeug.formparser.FormDataParser" title="werkzeug.formparser.FormDataParser"><code>FormDataParser</code></a>.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters<span class="colon">:</span>
</dt> <dd class="field-odd">
<ul class="simple"> <li>
<strong>environ</strong> (<em>WSGIEnvironment</em>) – the WSGI environment to be used for parsing.</li> <li>
<strong>stream_factory</strong> (<em>TStreamFactory</em><em> | </em><em>None</em>) – An optional callable that returns a new read and writeable file descriptor. This callable works the same as <code>Response._get_file_stream()</code>.</li> <li>
<strong>max_form_memory_size</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.11)">int</a><em> | </em><em>None</em>) – the maximum number of bytes to be accepted for in-memory stored form data. If the data exceeds the value specified an <code>RequestEntityTooLarge</code> exception is raised.</li> <li>
<strong>max_content_length</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.11)">int</a><em> | </em><em>None</em>) – If this is provided and the transmitted data is longer than this value an <code>RequestEntityTooLarge</code> exception is raised.</li> <li>
<strong>cls</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#type" title="(in Python v3.11)">type</a><em>[</em><a class="reference internal" href="../datastructures/index.html#werkzeug.datastructures.MultiDict" title="werkzeug.datastructures.MultiDict">MultiDict</a><em>] </em><em>| </em><em>None</em>) – an optional dict class to use. If this is not specified or <code>None</code> the default <code>MultiDict</code> is used.</li> <li>
<strong>silent</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)">bool</a>) – If set to False parsing errors will not be caught.</li> <li>
<strong>max_form_parts</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.11)">int</a><em> | </em><em>None</em>) – The maximum number of multipart parts to be parsed. If this is exceeded, a <code>RequestEntityTooLarge</code> exception is raised.</li> </ul> </dd> <dt class="field-even">Returns<span class="colon">:</span>
</dt> <dd class="field-even">
<p>A tuple in the form <code>(stream, form, files)</code>.</p> </dd> <dt class="field-odd">Return type<span class="colon">:</span>
</dt> <dd class="field-odd">
<p>t_parse_result</p> </dd> </dl> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 3.0: </span>The <code>charset</code> and <code>errors</code> parameters were removed.</p> </div> <details class="changelog"> <summary>Changelog</summary><div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 2.3: </span>Added the <code>max_form_parts</code> parameter.</p> </div> <div class="versionadded"> <p><span class="versionmodified added">New in version 0.5.1: </span>Added the <code>silent</code> parameter.</p> </div> <div class="versionadded"> <p><span class="versionmodified added">New in version 0.5: </span>Added the <code>max_form_memory_size</code>, <code>max_content_length</code>, and <code>cls</code> parameters.</p> </div> </details>
</dd>
</dl> </section><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2007 Pallets<br>Licensed under the BSD 3-clause License.<br>
    <a href="https://werkzeug.palletsprojects.com/en/3.0.x/http/" class="_attribution-link">https://werkzeug.palletsprojects.com/en/3.0.x/http/</a>
  </p>
</div>
