<h1>Compose file version 2 reference</h1>

<h2 id="reference-and-guidelines">Reference and guidelines</h2> <p>These topics describe version 2 of the Compose file format.</p> <h2 id="compose-and-docker-compatibility-matrix">Compose and Docker compatibility matrix</h2> <p>There are several versions of the Compose file format – 1, 2, 2.x, and 3.x. The table below is a quick look. For full details on what each version includes and how to upgrade, see <strong><a href="../compose-versioning/index.html">About versions and upgrading</a></strong>.</p> <p>This table shows which Compose file versions support specific Docker releases.</p> <table> <thead> <tr> <th><strong>Compose file format</strong></th> <th><strong>Docker Engine release</strong></th> </tr> </thead> <tbody> <tr> <td>Compose specification</td> <td>19.03.0+</td> </tr> <tr> <td>3.8</td> <td>19.03.0+</td> </tr> <tr> <td>3.7</td> <td>18.06.0+</td> </tr> <tr> <td>3.6</td> <td>18.02.0+</td> </tr> <tr> <td>3.5</td> <td>17.12.0+</td> </tr> <tr> <td>3.4</td> <td>17.09.0+</td> </tr> <tr> <td>3.3</td> <td>17.06.0+</td> </tr> <tr> <td>3.2</td> <td>17.04.0+</td> </tr> <tr> <td>3.1</td> <td>1.13.1+</td> </tr> <tr> <td>3.0</td> <td>1.13.0+</td> </tr> <tr> <td>2.4</td> <td>17.12.0+</td> </tr> <tr> <td>2.3</td> <td>17.06.0+</td> </tr> <tr> <td>2.2</td> <td>1.13.0+</td> </tr> <tr> <td>2.1</td> <td>1.12.0+</td> </tr> <tr> <td>2.0</td> <td>1.10.0+</td> </tr> </tbody> </table> <p>In addition to Compose file format versions shown in the table, the Compose itself is on a release schedule, as shown in <a href="https://github.com/docker/compose/releases/">Compose releases</a>, but file format versions do not necessarily increment with each release. For example, Compose file format 3.0 was first introduced in <a href="https://github.com/docker/compose/releases/tag/1.10.0">Compose release 1.10.0</a>, and versioned gradually in subsequent releases.</p> <p>The latest Compose file format is defined by the <a href="https://github.com/compose-spec/compose-spec/blob/master/spec/" target="_blank" rel="noopener" class="_">Compose Specification</a> and is implemented by Docker Compose <strong>1.27.0+</strong>.</p> <h2 id="service-configuration-reference">Service configuration reference</h2> <p>The Compose file is a <a href="https://yaml.org">YAML</a> file defining <a href="#service-configuration-reference">services</a>, <a href="#network-configuration-reference">networks</a> and <a href="#volume-configuration-reference">volumes</a>. The default path for a Compose file is <code class="language-plaintext highlighter-rouge">./docker-compose.yml</code>.</p> <blockquote> <p><strong>Tip</strong>: You can use either a <code class="language-plaintext highlighter-rouge">.yml</code> or <code class="language-plaintext highlighter-rouge">.yaml</code> extension for this file. They both work.</p> </blockquote> <p>A service definition contains configuration that is applied to each container started for that service, much like passing command-line parameters to <code class="language-plaintext highlighter-rouge">docker run</code>. Likewise, network and volume definitions are analogous to <code class="language-plaintext highlighter-rouge">docker network create</code> and <code class="language-plaintext highlighter-rouge">docker volume create</code>.</p> <p>As with <code class="language-plaintext highlighter-rouge">docker run</code>, options specified in the Dockerfile, such as <code class="language-plaintext highlighter-rouge">CMD</code>, <code class="language-plaintext highlighter-rouge">EXPOSE</code>, <code class="language-plaintext highlighter-rouge">VOLUME</code>, <code class="language-plaintext highlighter-rouge">ENV</code>, are respected by default - you don’t need to specify them again in <code class="language-plaintext highlighter-rouge">docker-compose.yml</code>.</p> <p>You can use environment variables in configuration values with a Bash-like <code class="language-plaintext highlighter-rouge">${VARIABLE}</code> syntax - see <a href="#variable-substitution">variable substitution</a> for full details.</p> <p>This section contains a list of all configuration options supported by a service definition in version 2.</p> <h3 id="blkio_config">blkio_config</h3> <p>A set of configuration options to set block IO limits for this service.</p> <div class="highlight"><pre class="highlight" data-language="">version: "2.4"
services:
  foo:
    image: busybox
    blkio_config:
      weight: 300
      weight_device:
        - path: /dev/sda
          weight: 400
      device_read_bps:
        - path: /dev/sdb
          rate: '12mb'
      device_read_iops:
        - path: /dev/sdb
          rate: 120
      device_write_bps:
        - path: /dev/sdb
          rate: '1024k'
      device_write_iops:
        - path: /dev/sdb
          rate: 30
</pre></div> <h4 id="device_read_bps-device_write_bps">device_read_bps, device_write_bps</h4> <p>Set a limit in bytes per second for read / write operations on a given device. Each item in the list must have two keys:</p> <ul> <li>
<code class="language-plaintext highlighter-rouge">path</code>, defining the symbolic path to the affected device</li> <li>
<code class="language-plaintext highlighter-rouge">rate</code>, either as an integer value representing the number of bytes or as a string expressing a <a href="#specifying-byte-values">byte value</a>.</li> </ul> <h4 id="device_read_iops-device_write_iops">device_read_iops, device_write_iops</h4> <p>Set a limit in operations per second for read / write operations on a given device. Each item in the list must have two keys:</p> <ul> <li>
<code class="language-plaintext highlighter-rouge">path</code>, defining the symbolic path to the affected device</li> <li>
<code class="language-plaintext highlighter-rouge">rate</code>, as an integer value representing the permitted number of operations per second.</li> </ul> <h4 id="weight">weight</h4> <p>Modify the proportion of bandwidth allocated to this service relative to other services. Takes an integer value between 10 and 1000, with 500 being the default.</p> <h4 id="weight_device">weight_device</h4> <p>Fine-tune bandwidth allocation by device. Each item in the list must have two keys:</p> <ul> <li>
<code class="language-plaintext highlighter-rouge">path</code>, defining the symbolic path to the affected device</li> <li>
<code class="language-plaintext highlighter-rouge">weight</code>, an integer value between 10 and 1000</li> </ul> <h3 id="build">build</h3> <p>Configuration options that are applied at build time.</p> <p><code class="language-plaintext highlighter-rouge">build</code> can be specified either as a string containing a path to the build context:</p> <div class="highlight"><pre class="highlight" data-language="">version: "2.4"
services:
  webapp:
    build: ./dir
</pre></div> <p>Or, as an object with the path specified under <a href="#context">context</a> and optionally <a href="#dockerfile">Dockerfile</a> and <a href="#args">args</a>:</p> <div class="highlight"><pre class="highlight" data-language="">version: "2.4"
services:
  webapp:
    build:
      context: ./dir
      dockerfile: Dockerfile-alternate
      args:
        buildno: 1
</pre></div> <p>If you specify <code class="language-plaintext highlighter-rouge">image</code> as well as <code class="language-plaintext highlighter-rouge">build</code>, then Compose names the built image with the <code class="language-plaintext highlighter-rouge">webapp</code> and optional <code class="language-plaintext highlighter-rouge">tag</code> specified in <code class="language-plaintext highlighter-rouge">image</code>:</p> <div class="highlight"><pre class="highlight" data-language="">build: ./dir
image: webapp:tag
</pre></div> <p>This results in an image named <code class="language-plaintext highlighter-rouge">webapp</code> and tagged <code class="language-plaintext highlighter-rouge">tag</code>, built from <code class="language-plaintext highlighter-rouge">./dir</code>.</p> <h4 id="context">context</h4> <blockquote> <p>Added in <a href="../compose-versioning/index.html#version-2">version 2.0</a> file format.</p> </blockquote> <p>Either a path to a directory containing a Dockerfile, or a url to a git repository.</p> <p>When the value supplied is a relative path, it is interpreted as relative to the location of the Compose file. This directory is also the build context that is sent to the Docker daemon.</p> <p>Compose builds and tags it with a generated name, and uses that image thereafter.</p> <div class="highlight"><pre class="highlight" data-language="">build:
  context: ./dir
</pre></div> <h4 id="dockerfile">dockerfile</h4> <p>Alternate Dockerfile.</p> <p>Compose uses an alternate file to build with. A build path must also be specified.</p> <div class="highlight"><pre class="highlight" data-language="">build:
  context: .
  dockerfile: Dockerfile-alternate
</pre></div> <h4 id="args">args</h4> <blockquote> <p>Added in <a href="../compose-versioning/index.html#version-2">version 2.0</a> file format.</p> </blockquote> <p>Add build arguments, which are environment variables accessible only during the build process.</p> <p>First, specify the arguments in your Dockerfile:</p> <div class="highlight"><pre class="highlight" data-language=""># syntax=docker/dockerfile:1

ARG buildno
ARG gitcommithash

RUN echo "Build number: $buildno"
RUN echo "Based on commit: $gitcommithash"
</pre></div> <p>Then specify the arguments under the <code class="language-plaintext highlighter-rouge">build</code> key. You can pass a mapping or a list:</p> <div class="highlight"><pre class="highlight" data-language="">build:
  context: .
  args:
    buildno: 1
    gitcommithash: cdc3b19
</pre></div> <div class="highlight"><pre class="highlight" data-language="">build:
  context: .
  args:
    - buildno=1
    - gitcommithash=cdc3b19
</pre></div> <blockquote> <p>Scope of build-args</p> <p>In your Dockerfile, if you specify <code class="language-plaintext highlighter-rouge">ARG</code> before the <code class="language-plaintext highlighter-rouge">FROM</code> instruction, <code class="language-plaintext highlighter-rouge">ARG</code> is not available in the build instructions under <code class="language-plaintext highlighter-rouge">FROM</code>. If you need an argument to be available in both places, also specify it under the <code class="language-plaintext highlighter-rouge">FROM</code> instruction. Refer to the <a href="../../../engine/reference/builder/index.html#understand-how-arg-and-from-interact">understand how ARGS and FROM interact</a> section in the documentation for usage details.</p> </blockquote> <p>You can omit the value when specifying a build argument, in which case its value at build time is the value in the environment where Compose is running.</p> <div class="highlight"><pre class="highlight" data-language="">args:
  - buildno
  - gitcommithash
</pre></div> <blockquote> <p>Tip when using boolean values</p> <p>YAML boolean values (<code class="language-plaintext highlighter-rouge">"true"</code>, <code class="language-plaintext highlighter-rouge">"false"</code>, <code class="language-plaintext highlighter-rouge">"yes"</code>, <code class="language-plaintext highlighter-rouge">"no"</code>, <code class="language-plaintext highlighter-rouge">"on"</code>, <code class="language-plaintext highlighter-rouge">"off"</code>) must be enclosed in quotes, so that the parser interprets them as strings.</p> </blockquote> <h4 id="cache_from">cache_from</h4> <blockquote> <p>Added in <a href="../compose-versioning/index.html#version-22">version 2.2</a> file format</p> </blockquote> <p>A list of images that the engine uses for cache resolution.</p> <div class="highlight"><pre class="highlight" data-language="">build:
  context: .
  cache_from:
    - alpine:latest
    - corp/web_app:3.14
</pre></div> <h4 id="extra_hosts">extra_hosts</h4> <p>Add hostname mappings at build-time. Use the same values as the docker client <code class="language-plaintext highlighter-rouge">--add-host</code> parameter.</p> <div class="highlight"><pre class="highlight" data-language="">extra_hosts:
  - "somehost:162.242.195.82"
  - "otherhost:50.31.209.229"
</pre></div> <p>An entry with the ip address and hostname is created in <code class="language-plaintext highlighter-rouge">/etc/hosts</code> inside containers for this build, e.g:</p> <div class="highlight"><pre class="highlight" data-language="">162.242.195.82  somehost
50.31.209.229   otherhost
</pre></div> <h4 id="isolation">isolation</h4> <blockquote> <p>Added in <a href="../compose-versioning/index.html#version-21">version 2.1</a> file format.</p> </blockquote> <p>Specify a build’s container isolation technology. On Linux, the only supported value is <code class="language-plaintext highlighter-rouge">default</code>. On Windows, acceptable values are <code class="language-plaintext highlighter-rouge">default</code>, <code class="language-plaintext highlighter-rouge">process</code> and <code class="language-plaintext highlighter-rouge">hyperv</code>. Refer to the <a href="../../../engine/reference/commandline/run/index.html#specify-isolation-technology-for-container---isolation">Docker Engine docs</a> for details.</p> <p>If unspecified, Compose will use the <code class="language-plaintext highlighter-rouge">isolation</code> value found in the service’s definition to determine the value to use for builds.</p> <h4 id="labels">labels</h4> <blockquote> <p>Added in <a href="../compose-versioning/index.html#version-21">version 2.1</a> file format</p> </blockquote> <p>Add metadata to the resulting image using <a href="https://docs.docker.com/config/labels-custom-metadata/">Docker labels</a>. You can use either an array or a dictionary.</p> <p>It’s recommended that you use reverse-DNS notation to prevent your labels from conflicting with those used by other software.</p> <div class="highlight"><pre class="highlight" data-language="">build:
  context: .
  labels:
    com.example.description: "Accounting webapp"
    com.example.department: "Finance"
    com.example.label-with-empty-value: ""
</pre></div> <div class="highlight"><pre class="highlight" data-language="">build:
  context: .
  labels:
    - "com.example.description=Accounting webapp"
    - "com.example.department=Finance"
    - "com.example.label-with-empty-value"
</pre></div> <h4 id="network">network</h4> <blockquote> <p>Added in <a href="../compose-versioning/index.html#version-22">version 2.2</a> file format</p> </blockquote> <p>Set the network containers connect to for the <code class="language-plaintext highlighter-rouge">RUN</code> instructions during build.</p> <div class="highlight"><pre class="highlight" data-language="">build:
  context: .
  network: host
</pre></div> <div class="highlight"><pre class="highlight" data-language="">build:
  context: .
  network: custom_network_1
</pre></div> <p>Use <code class="language-plaintext highlighter-rouge">none</code> to disable networking during build:</p> <div class="highlight"><pre class="highlight" data-language="">build:
  context: .
  network: none
</pre></div> <h4 id="shm_size">shm_size</h4> <blockquote> <p>Added in <a href="../compose-versioning/index.html#version-23">version 2.3</a> file format</p> </blockquote> <p>Set the size of the <code class="language-plaintext highlighter-rouge">/dev/shm</code> partition for this build’s containers. Specify as an integer value representing the number of bytes or as a string expressing a <a href="#specifying-byte-values">byte value</a>.</p> <div class="highlight"><pre class="highlight" data-language="">build:
  context: .
  shm_size: '2gb'
</pre></div> <div class="highlight"><pre class="highlight" data-language="">build:
  context: .
  shm_size: 10000000
</pre></div> <h4 id="target">target</h4> <blockquote> <p>Added in <a href="../compose-versioning/index.html#version-23">version 2.3</a> file format</p> </blockquote> <p>Build the specified stage as defined inside the <code class="language-plaintext highlighter-rouge">Dockerfile</code>. See the <a href="https://docs.docker.com/develop/develop-images/multistage-build/">multi-stage build docs</a> for details.</p> <div class="highlight"><pre class="highlight" data-language="">build:
  context: .
  target: prod
</pre></div> <h3 id="cap_add-cap_drop">cap_add, cap_drop</h3> <p>Add or drop container capabilities. See <code class="language-plaintext highlighter-rouge">man 7 capabilities</code> for a full list.</p> <div class="highlight"><pre class="highlight" data-language="">cap_add:
  - ALL

cap_drop:
  - NET_ADMIN
  - SYS_ADMIN
</pre></div> <h3 id="cgroup_parent">cgroup_parent</h3> <p>Specify an optional parent cgroup for the container.</p> <div class="highlight"><pre class="highlight" data-language="">cgroup_parent: m-executor-abcd
</pre></div> <h3 id="command">command</h3> <p>Override the default command.</p> <div class="highlight"><pre class="highlight" data-language="">command: bundle exec thin -p 3000
</pre></div> <p>The command can also be a list, in a manner similar to <a href="../../../engine/reference/builder/index.html#cmd">dockerfile</a>:</p> <div class="highlight"><pre class="highlight" data-language="">command: ["bundle", "exec", "thin", "-p", "3000"]
</pre></div> <h3 id="container_name">container_name</h3> <p>Specify a custom container name, rather than a generated default name.</p> <div class="highlight"><pre class="highlight" data-language="">container_name: my-web-container
</pre></div> <p>Because Docker container names must be unique, you cannot scale a service beyond 1 container if you have specified a custom name. Attempting to do so results in an error.</p> <h3 id="cpu_rt_runtime-cpu_rt_period">cpu_rt_runtime, cpu_rt_period</h3> <blockquote> <p>Added in <a href="../compose-versioning/index.html#version-22">version 2.2</a> file format</p> </blockquote> <p>Configure CPU allocation parameters using the Docker daemon realtime scheduler.</p> <div class="highlight"><pre class="highlight" data-language="">cpu_rt_runtime: '400ms'
cpu_rt_period: '1400us'
</pre></div> <p>Integer values will use microseconds as units:</p> <div class="highlight"><pre class="highlight" data-language="">cpu_rt_runtime: 95000
cpu_rt_period: 11000
</pre></div> <h3 id="device_cgroup_rules">device_cgroup_rules</h3> <blockquote> <p>Added in <a href="../compose-versioning/index.html#version-23">version 2.3</a> file format.</p> </blockquote> <p>Add rules to the cgroup allowed devices list.</p> <div class="highlight"><pre class="highlight" data-language="">device_cgroup_rules:
  - 'c 1:3 mr'
  - 'a 7:* rmw'
</pre></div> <h3 id="devices">devices</h3> <p>List of device mappings. Uses the same format as the <code class="language-plaintext highlighter-rouge">--device</code> docker client create option.</p> <div class="highlight"><pre class="highlight" data-language="">devices:
  - "/dev/ttyUSB0:/dev/ttyUSB0"
</pre></div> <h3 id="depends_on">depends_on</h3> <blockquote> <p>Added in <a href="../compose-versioning/index.html#version-2">version 2.0</a> file format.</p> </blockquote> <p>Express dependency between services. Service dependencies cause the following behaviors:</p> <ul> <li>
<code class="language-plaintext highlighter-rouge">docker-compose up</code> starts services in dependency order. In the following example, <code class="language-plaintext highlighter-rouge">db</code> and <code class="language-plaintext highlighter-rouge">redis</code> are started before <code class="language-plaintext highlighter-rouge">web</code>.</li> <li>
<code class="language-plaintext highlighter-rouge">docker-compose up SERVICE</code> automatically includes <code class="language-plaintext highlighter-rouge">SERVICE</code>’s dependencies. In the example below, <code class="language-plaintext highlighter-rouge">docker-compose up web</code> also creates and starts <code class="language-plaintext highlighter-rouge">db</code> and <code class="language-plaintext highlighter-rouge">redis</code>.</li> <li>
<code class="language-plaintext highlighter-rouge">docker-compose stop</code> stops services in dependency order. In the following example, <code class="language-plaintext highlighter-rouge">web</code> is stopped before <code class="language-plaintext highlighter-rouge">db</code> and <code class="language-plaintext highlighter-rouge">redis</code>.</li> </ul> <p>Simple example:</p> <div class="highlight"><pre class="highlight" data-language="">version: "2.4"
services:
  web:
    build: .
    depends_on:
      - db
      - redis
  redis:
    image: redis
  db:
    image: postgres
</pre></div> <blockquote> <p><strong>Note</strong></p> <p><code class="language-plaintext highlighter-rouge">depends_on</code> does not wait for <code class="language-plaintext highlighter-rouge">db</code> and <code class="language-plaintext highlighter-rouge">redis</code> to be “ready” before starting <code class="language-plaintext highlighter-rouge">web</code> - only until they have been started. If you need to wait for a service to be ready, see <a href="../../startup-order/index.html">Controlling startup order</a> for more on this problem and strategies for solving it.</p> </blockquote> <blockquote> <p>Added in <a href="../compose-versioning/index.html#version-21">version 2.1</a> file format.</p> </blockquote> <p>A healthcheck indicates that you want a dependency to wait for another container to be “healthy” (as indicated by a successful state from the healthcheck) before starting.</p> <p>Example:</p> <div class="highlight"><pre class="highlight" data-language="">version: "2.4"
services:
  web:
    build: .
    depends_on:
      db:
        condition: service_healthy
      redis:
        condition: service_started
  redis:
    image: redis
  db:
    image: postgres
    healthcheck:
      test: "exit 0"
</pre></div> <p>In the above example, Compose waits for the <code class="language-plaintext highlighter-rouge">redis</code> service to be started (legacy behavior) and the <code class="language-plaintext highlighter-rouge">db</code> service to be healthy before starting <code class="language-plaintext highlighter-rouge">web</code>.</p> <p>See the <a href="#healthcheck">healthcheck section</a> for complementary information.</p> <h3 id="dns">dns</h3> <p>Custom DNS servers. Can be a single value or a list.</p> <div class="highlight"><pre class="highlight" data-language="">dns: 8.8.8.8
</pre></div> <div class="highlight"><pre class="highlight" data-language="">dns:
  - 8.8.8.8
  - 9.9.9.9
</pre></div> <h3 id="dns_opt">dns_opt</h3> <p>List of custom DNS options to be added to the container’s <code class="language-plaintext highlighter-rouge">resolv.conf</code> file.</p> <div class="highlight"><pre class="highlight" data-language="">dns_opt:
  - use-vc
  - no-tld-query
</pre></div> <h3 id="dns_search">dns_search</h3> <p>Custom DNS search domains. Can be a single value or a list.</p> <div class="highlight"><pre class="highlight" data-language="">dns_search: example.com
</pre></div> <div class="highlight"><pre class="highlight" data-language="">dns_search:
  - dc1.example.com
  - dc2.example.com
</pre></div> <h3 id="entrypoint">entrypoint</h3> <p>Override the default entrypoint.</p> <div class="highlight"><pre class="highlight" data-language="">entrypoint: /code/entrypoint.sh
</pre></div> <p>The entrypoint can also be a list, in a manner similar to <a href="../../../engine/reference/builder/index.html#entrypoint">dockerfile</a>:</p> <div class="highlight"><pre class="highlight" data-language="">entrypoint: ["php", "-d", "memory_limit=-1", "vendor/bin/phpunit"]
</pre></div> <blockquote> <p><strong>Note</strong></p> <p>Setting <code class="language-plaintext highlighter-rouge">entrypoint</code> both overrides any default entrypoint set on the service’s image with the <code class="language-plaintext highlighter-rouge">ENTRYPOINT</code> Dockerfile instruction, <em>and</em> clears out any default command on the image - meaning that if there’s a <code class="language-plaintext highlighter-rouge">CMD</code> instruction in the Dockerfile, it is ignored.</p> </blockquote> <h3 id="env_file">env_file</h3> <p>Add environment variables from a file. Can be a single value or a list.</p> <p>If you have specified a Compose file with <code class="language-plaintext highlighter-rouge">docker-compose -f FILE</code>, paths in <code class="language-plaintext highlighter-rouge">env_file</code> are relative to the directory that file is in.</p> <p>Environment variables declared in the <a href="#environment">environment</a> section <em>override</em> these values – this holds true even if those values are empty or undefined.</p> <div class="highlight"><pre class="highlight" data-language="">env_file: .env
</pre></div> <div class="highlight"><pre class="highlight" data-language="">env_file:
  - ./common.env
  - ./apps/web.env
  - /opt/runtime_opts.env
</pre></div> <p>Compose expects each line in an env file to be in <code class="language-plaintext highlighter-rouge">VAR=VAL</code> format. Lines beginning with <code class="language-plaintext highlighter-rouge">#</code> are treated as comments and are ignored. Blank lines are also ignored.</p> <div class="highlight"><pre class="highlight" data-language=""># Set Rails/Rack environment
RACK_ENV=development
</pre></div> <blockquote> <p><strong>Note</strong></p> <p>If your service specifies a <a href="#build">build</a> option, variables defined in environment files are <em>not</em> automatically visible during the build. Use the <a href="#args">args</a> sub-option of <code class="language-plaintext highlighter-rouge">build</code> to define build-time environment variables.</p> </blockquote> <p>The value of <code class="language-plaintext highlighter-rouge">VAL</code> is used as is and not modified at all. For example if the value is surrounded by quotes (as is often the case of shell variables), the quotes are included in the value passed to Compose.</p> <p>Keep in mind that <em>the order of files in the list is significant in determining the value assigned to a variable that shows up more than once</em>. The files in the list are processed from the top down. For the same variable specified in file <code class="language-plaintext highlighter-rouge">a.env</code> and assigned a different value in file <code class="language-plaintext highlighter-rouge">b.env</code>, if <code class="language-plaintext highlighter-rouge">b.env</code> is listed below (after), then the value from <code class="language-plaintext highlighter-rouge">b.env</code> stands. For example, given the following declaration in <code class="language-plaintext highlighter-rouge">docker-compose.yml</code>:</p> <div class="highlight"><pre class="highlight" data-language="">services:
  some-service:
    env_file:
      - a.env
      - b.env
</pre></div> <p>And the following files:</p> <div class="highlight"><pre class="highlight" data-language=""># a.env
VAR=1
</pre></div> <p>and</p> <div class="highlight"><pre class="highlight" data-language=""># b.env
VAR=hello
</pre></div> <p><code class="language-plaintext highlighter-rouge">$VAR</code> is <code class="language-plaintext highlighter-rouge">hello</code>.</p> <h3 id="environment">environment</h3> <p>Add environment variables. You can use either an array or a dictionary. Any boolean values (true, false, yes, no) need to be enclosed in quotes to ensure they are not converted to True or False by the YML parser.</p> <p>Environment variables with only a key are resolved to their values on the machine Compose is running on, which can be helpful for secret or host-specific values.</p> <div class="highlight"><pre class="highlight" data-language="">environment:
  RACK_ENV: development
  SHOW: 'true'
  SESSION_SECRET:
</pre></div> <div class="highlight"><pre class="highlight" data-language="">environment:
  - RACK_ENV=development
  - SHOW=true
  - SESSION_SECRET
</pre></div> <blockquote> <p><strong>Note</strong></p> <p>If your service specifies a <a href="#build">build</a> option, variables defined in <code class="language-plaintext highlighter-rouge">environment</code> are <em>not</em> automatically visible during the build. Use the <a href="#args">args</a> sub-option of <code class="language-plaintext highlighter-rouge">build</code> to define build-time environment variables.</p> </blockquote> <h3 id="expose">expose</h3> <p>Expose ports without publishing them to the host machine - they’ll only be accessible to linked services. Only the internal port can be specified.</p> <div class="highlight"><pre class="highlight" data-language="">expose:
  - "3000"
  - "8000"
</pre></div> <h3 id="extends">extends</h3> <p>Extend another service, in the current file or another, optionally overriding configuration.</p> <p>You can use <code class="language-plaintext highlighter-rouge">extends</code> on any service together with other configuration keys. The <code class="language-plaintext highlighter-rouge">extends</code> value must be a dictionary defined with a required <code class="language-plaintext highlighter-rouge">service</code> and an optional <code class="language-plaintext highlighter-rouge">file</code> key.</p> <div class="highlight"><pre class="highlight" data-language="">extends:
  file: common.yml
  service: webapp
</pre></div> <p>The <code class="language-plaintext highlighter-rouge">service</code> is the name of the service being extended, for example <code class="language-plaintext highlighter-rouge">web</code> or <code class="language-plaintext highlighter-rouge">database</code>. The <code class="language-plaintext highlighter-rouge">file</code> is the location of a Compose configuration file defining that service.</p> <p>If you omit the <code class="language-plaintext highlighter-rouge">file</code> Compose looks for the service configuration in the current file. The <code class="language-plaintext highlighter-rouge">file</code> value can be an absolute or relative path. If you specify a relative path, Compose treats it as relative to the location of the current file.</p> <p>You can extend a service that itself extends another. You can extend indefinitely. Compose does not support circular references and <code class="language-plaintext highlighter-rouge">docker-compose</code> returns an error if it encounters one.</p> <p>For more on <code class="language-plaintext highlighter-rouge">extends</code>, see the <a href="../../extends/index.html#extending-services">the extends documentation</a>.</p> <h3 id="external_links">external_links</h3> <p>Link to containers started outside this <code class="language-plaintext highlighter-rouge">docker-compose.yml</code> or even outside of Compose, especially for containers that provide shared or common services. <code class="language-plaintext highlighter-rouge">external_links</code> follow semantics similar to the legacy option <code class="language-plaintext highlighter-rouge">links</code> when specifying both the container name and the link alias (<code class="language-plaintext highlighter-rouge">CONTAINER:ALIAS</code>).</p> <div class="highlight"><pre class="highlight" data-language="">external_links:
  - redis_1
  - project_db_1:mysql
  - project_db_1:postgresql
</pre></div> <blockquote> <p><strong>Note</strong></p> <p>If you’re using the <a href="../compose-versioning/index.html#version-2">version 2 or above file format</a>, the externally-created containers must be connected to at least one of the same networks as the service that is linking to them. <a href="index.html#links">Links</a> are a legacy option. We recommend using <a href="#networks">networks</a> instead.</p> </blockquote> <h3 id="extra_hosts-1">extra_hosts</h3> <p>Add hostname mappings. Use the same values as the docker client <code class="language-plaintext highlighter-rouge">--add-host</code> parameter.</p> <div class="highlight"><pre class="highlight" data-language="">extra_hosts:
  - "somehost:162.242.195.82"
  - "otherhost:50.31.209.229"
</pre></div> <p>An entry with the ip address and hostname is created in <code class="language-plaintext highlighter-rouge">/etc/hosts</code> inside containers for this service, e.g:</p> <div class="highlight"><pre class="highlight" data-language="">162.242.195.82  somehost
50.31.209.229   otherhost
</pre></div> <h3 id="group_add">group_add</h3> <p>Specify additional groups (by name or number) which the user inside the container should be a member of. Groups must exist in both the container and the host system to be added. An example of where this is useful is when multiple containers (running as different users) need to all read or write the same file on the host system. That file can be owned by a group shared by all the containers, and specified in <code class="language-plaintext highlighter-rouge">group_add</code>. See the <a href="../../../engine/reference/run/index.html#additional-groups">Docker documentation</a> for more details.</p> <p>A full example:</p> <div class="highlight"><pre class="highlight" data-language="">version: "2.4"
services:
  myservice:
    image: alpine
    group_add:
      - mail
</pre></div> <p>Running <code class="language-plaintext highlighter-rouge">id</code> inside the created container shows that the user belongs to the <code class="language-plaintext highlighter-rouge">mail</code> group, which would not have been the case if <code class="language-plaintext highlighter-rouge">group_add</code> were not used.</p> <h3 id="healthcheck">healthcheck</h3> <blockquote> <p>Added in <a href="../compose-versioning/index.html#version-21">version 2.1</a> file format.</p> </blockquote> <p>Configure a check that’s run to determine whether or not containers for this service are “healthy”. See the docs for the <a href="../../../engine/reference/builder/index.html#healthcheck">HEALTHCHECK Dockerfile instruction</a> for details on how healthchecks work.</p> <div class="highlight"><pre class="highlight" data-language="">healthcheck:
  test: ["CMD", "curl", "-f", "http://localhost"]
  interval: 1m30s
  timeout: 10s
  retries: 3
  start_period: 40s
</pre></div> <p><code class="language-plaintext highlighter-rouge">interval</code>, <code class="language-plaintext highlighter-rouge">timeout</code> and <code class="language-plaintext highlighter-rouge">start_period</code> are specified as <a href="#specifying-durations">durations</a>.</p> <blockquote> <p>Added in <a href="../compose-versioning/index.html#version-23">version 2.3</a> file format.</p> <p>The <code class="language-plaintext highlighter-rouge">start_period</code> option was added in file format 2.3.</p> </blockquote> <p><code class="language-plaintext highlighter-rouge">test</code> must be either a string or a list. If it’s a list, the first item must be either <code class="language-plaintext highlighter-rouge">NONE</code>, <code class="language-plaintext highlighter-rouge">CMD</code> or <code class="language-plaintext highlighter-rouge">CMD-SHELL</code>. If it’s a string, it’s equivalent to specifying <code class="language-plaintext highlighter-rouge">CMD-SHELL</code> followed by that string.</p> <div class="highlight"><pre class="highlight" data-language=""># Hit the local web app
test: ["CMD", "curl", "-f", "http://localhost"]
</pre></div> <p>As above, but wrapped in <code class="language-plaintext highlighter-rouge">/bin/sh</code>. Both forms below are equivalent.</p> <div class="highlight"><pre class="highlight" data-language="">test: ["CMD-SHELL", "curl -f http://localhost || exit 1"]
</pre></div> <div class="highlight"><pre class="highlight" data-language="">test: curl -f https://localhost || exit 1
</pre></div> <p>To disable any default healthcheck set by the image, you can use <code class="language-plaintext highlighter-rouge">disable: true</code>. This is equivalent to specifying <code class="language-plaintext highlighter-rouge">test: ["NONE"]</code>.</p> <div class="highlight"><pre class="highlight" data-language="">healthcheck:
  disable: true
</pre></div> <h3 id="image">image</h3> <p>Specify the image to start the container from. Can either be a repository/tag or a partial image ID.</p> <div class="highlight"><pre class="highlight" data-language="">image: redis
</pre></div> <div class="highlight"><pre class="highlight" data-language="">image: ubuntu:18.04
</pre></div> <div class="highlight"><pre class="highlight" data-language="">image: tutum/influxdb
</pre></div> <div class="highlight"><pre class="highlight" data-language="">image: example-registry.com:4000/postgresql
</pre></div> <div class="highlight"><pre class="highlight" data-language="">image: a4bc65fd
</pre></div> <p>If the image does not exist, Compose attempts to pull it, unless you have also specified <a href="#build">build</a>, in which case it builds it using the specified options and tags it with the specified tag.</p> <h3 id="init">init</h3> <blockquote> <p>Added in <a href="../compose-versioning/index.html#version-22">version 2.2</a> file format.</p> </blockquote> <p>Run an init inside the container that forwards signals and reaps processes. Set this option to <code class="language-plaintext highlighter-rouge">true</code> to enable this feature for the service.</p> <div class="highlight"><pre class="highlight" data-language="">version: "2.4"
services:
  web:
    image: alpine:latest
    init: true
</pre></div> <blockquote> <p>The default init binary that is used is <a href="https://github.com/krallin/tini">Tini</a>, and is installed in <code class="language-plaintext highlighter-rouge">/usr/libexec/docker-init</code> on the daemon host. You can configure the daemon to use a custom init binary through the <a href="../../../engine/reference/commandline/dockerd/index.html#daemon-configuration-file"><code class="language-plaintext highlighter-rouge">init-path</code> configuration option</a>.</p> </blockquote> <h3 id="isolation-1">isolation</h3> <blockquote> <p>Added in <a href="../compose-versioning/index.html#version-21">version 2.1</a> file format.</p> </blockquote> <p>Specify a container’s isolation technology. On Linux, the only supported value is <code class="language-plaintext highlighter-rouge">default</code>. On Windows, acceptable values are <code class="language-plaintext highlighter-rouge">default</code>, <code class="language-plaintext highlighter-rouge">process</code> and <code class="language-plaintext highlighter-rouge">hyperv</code>. Refer to the <a href="../../../engine/reference/commandline/run/index.html#specify-isolation-technology-for-container---isolation">Docker Engine docs</a> for details.</p> <h3 id="labels-1">labels</h3> <p>Add metadata to containers using <a href="https://docs.docker.com/config/labels-custom-metadata/">Docker labels</a>. You can use either an array or a dictionary.</p> <p>It’s recommended that you use reverse-DNS notation to prevent your labels from conflicting with those used by other software.</p> <div class="highlight"><pre class="highlight" data-language="">labels:
  com.example.description: "Accounting webapp"
  com.example.department: "Finance"
  com.example.label-with-empty-value: ""
</pre></div> <div class="highlight"><pre class="highlight" data-language="">labels:
  - "com.example.description=Accounting webapp"
  - "com.example.department=Finance"
  - "com.example.label-with-empty-value"
</pre></div> <h3 id="links">links</h3> <p>Link to containers in another service. Either specify both the service name and a link alias (<code class="language-plaintext highlighter-rouge">"SERVICE:ALIAS"</code>), or just the service name.</p> <blockquote> <p>Links are a legacy option. We recommend using <a href="#networks">networks</a> instead.</p> </blockquote> <div class="highlight"><pre class="highlight" data-language="">web:
  links:
    - "db"
    - "db:database"
    - "redis"
</pre></div> <p>Containers for the linked service are reachable at a hostname identical to the alias, or the service name if no alias was specified.</p> <p>Links are not required to enable services to communicate - by default, any service can reach any other service at that service’s name. (See also, the <a href="../../networking/index.html#links">Links topic in Networking in Compose</a>.)</p> <p>Links also express dependency between services in the same way as <a href="#depends_on">depends_on</a>, so they determine the order of service startup.</p> <blockquote> <p><strong>Note</strong></p> <p>If you define both links and <a href="#networks">networks</a>, services with links between them must share at least one network in common to communicate. We recommend using networks instead.</p> </blockquote> <h3 id="logging">logging</h3> <p>Logging configuration for the service.</p> <div class="highlight"><pre class="highlight" data-language="">logging:
  driver: syslog
  options:
    syslog-address: "tcp://192.168.0.42:123"
</pre></div> <p>The <code class="language-plaintext highlighter-rouge">driver</code> name specifies a logging driver for the service’s containers, as with the <code class="language-plaintext highlighter-rouge">--log-driver</code> option for docker run (<a href="https://docs.docker.com/config/containers/logging/configure/">documented here</a>).</p> <p>The default value is json-file.</p> <div class="highlight"><pre class="highlight" data-language="">driver: "json-file"
</pre></div> <div class="highlight"><pre class="highlight" data-language="">driver: "syslog"
</pre></div> <div class="highlight"><pre class="highlight" data-language="">driver: "none"
</pre></div> <blockquote> <p><strong>Note</strong></p> <p>Only the <code class="language-plaintext highlighter-rouge">json-file</code> and <code class="language-plaintext highlighter-rouge">journald</code> drivers make the logs available directly from <code class="language-plaintext highlighter-rouge">docker-compose up</code> and <code class="language-plaintext highlighter-rouge">docker-compose logs</code>. Using any other driver does not print any logs.</p> </blockquote> <p>Specify logging options for the logging driver with the <code class="language-plaintext highlighter-rouge">options</code> key, as with the <code class="language-plaintext highlighter-rouge">--log-opt</code> option for <code class="language-plaintext highlighter-rouge">docker run</code>.</p> <p>Logging options are key-value pairs. An example of <code class="language-plaintext highlighter-rouge">syslog</code> options:</p> <div class="highlight"><pre class="highlight" data-language="">driver: "syslog"
options:
  syslog-address: "tcp://192.168.0.42:123"
</pre></div> <h3 id="network_mode">network_mode</h3> <blockquote> <p>Changed in <a href="../compose-versioning/index.html#version-2">version 2</a> file format.</p> </blockquote> <p>Network mode. Use the same values as the docker client <code class="language-plaintext highlighter-rouge">--network</code> parameter, plus the special form <code class="language-plaintext highlighter-rouge">service:[service name]</code>.</p> <div class="highlight"><pre class="highlight" data-language="">network_mode: "bridge"
</pre></div> <div class="highlight"><pre class="highlight" data-language="">network_mode: "host"
</pre></div> <div class="highlight"><pre class="highlight" data-language="">network_mode: "none"
</pre></div> <div class="highlight"><pre class="highlight" data-language="">network_mode: "service:[service name]"
</pre></div> <div class="highlight"><pre class="highlight" data-language="">network_mode: "container:[container name/id]"
</pre></div> <h3 id="networks">networks</h3> <blockquote> <p>Changed in <a href="../compose-versioning/index.html#version-2">version 2</a> file format.</p> </blockquote> <p>Networks to join, referencing entries under the <a href="#network-configuration-reference">top-level <code class="language-plaintext highlighter-rouge">networks</code> key</a>.</p> <div class="highlight"><pre class="highlight" data-language="">services:
  some-service:
    networks:
     - some-network
     - other-network
</pre></div> <h4 id="aliases">aliases</h4> <p>Aliases (alternative hostnames) for this service on the network. Other containers on the same network can use either the service name or this alias to connect to one of the service’s containers.</p> <p>Since <code class="language-plaintext highlighter-rouge">aliases</code> is network-scoped, the same service can have different aliases on different networks.</p> <blockquote> <p><strong>Note</strong></p> <p>A network-wide alias can be shared by multiple containers, and even by multiple services. If it is, then exactly which container the name resolves to is not guaranteed.</p> </blockquote> <p>The general format is shown here.</p> <div class="highlight"><pre class="highlight" data-language="">services:
  some-service:
    networks:
      some-network:
        aliases:
          - alias1
          - alias3
      other-network:
        aliases:
          - alias2
</pre></div> <p>In the example below, three services are provided (<code class="language-plaintext highlighter-rouge">web</code>, <code class="language-plaintext highlighter-rouge">worker</code>, and <code class="language-plaintext highlighter-rouge">db</code>), along with two networks (<code class="language-plaintext highlighter-rouge">new</code> and <code class="language-plaintext highlighter-rouge">legacy</code>). The <code class="language-plaintext highlighter-rouge">db</code> service is reachable at the hostname <code class="language-plaintext highlighter-rouge">db</code> or <code class="language-plaintext highlighter-rouge">database</code> on the <code class="language-plaintext highlighter-rouge">new</code> network, and at <code class="language-plaintext highlighter-rouge">db</code> or <code class="language-plaintext highlighter-rouge">mysql</code> on the <code class="language-plaintext highlighter-rouge">legacy</code> network.</p> <div class="highlight"><pre class="highlight" data-language="">version: "2.4"

services:
  web:
    image: "nginx:alpine"
    networks:
      - new

  worker:
    image: "my-worker-image:latest"
    networks:
      - legacy

  db:
    image: mysql
    networks:
      new:
        aliases:
          - database
      legacy:
        aliases:
          - mysql

networks:
  new:
  legacy:
</pre></div> <h4 id="ipv4_address-ipv6_address">ipv4_address, ipv6_address</h4> <p>Specify a static IP address for containers for this service when joining the network.</p> <p>The corresponding network configuration in the <a href="#network-configuration-reference">top-level networks section</a> must have an <code class="language-plaintext highlighter-rouge">ipam</code> block with subnet and gateway configurations covering each static address.</p> <blockquote> <p>If IPv6 addressing is desired, the <a href="#enable_ipv6"><code class="language-plaintext highlighter-rouge">enable_ipv6</code></a> option must be set.</p> </blockquote> <p>An example:</p> <div class="highlight"><pre class="highlight" data-language="">version: "2.4"

services:
  app:
    image: busybox
    command: ifconfig
    networks:
      app_net:
        ipv4_address: 172.16.238.10
        ipv6_address: 2001:3984:3989::10

networks:
  app_net:
    driver: bridge
    enable_ipv6: true
    ipam:
      driver: default
      config:
        - subnet: 172.16.238.0/24
          gateway: 172.16.238.1
        - subnet: 2001:3984:3989::/64
          gateway: 2001:3984:3989::1
</pre></div> <h4 id="link_local_ips">link_local_ips</h4> <blockquote> <p>Added in <a href="../compose-versioning/index.html#version-21">version 2.1</a> file format.</p> </blockquote> <p>Specify a list of link-local IPs. Link-local IPs are special IPs which belong to a well known subnet and are purely managed by the operator, usually dependent on the architecture where they are deployed. Therefore they are not managed by docker (IPAM driver).</p> <p>Example usage:</p> <div class="highlight"><pre class="highlight" data-language="">version: "2.4"
services:
  app:
    image: busybox
    command: top
    networks:
      app_net:
        link_local_ips:
          - 57.123.22.11
          - 57.123.22.13
networks:
  app_net:
    driver: bridge
</pre></div> <h4 id="priority">priority</h4> <p>Specify a priority to indicate in which order Compose should connect the service’s containers to its networks. If unspecified, the default value is <code class="language-plaintext highlighter-rouge">0</code>.</p> <p>In the following example, the <code class="language-plaintext highlighter-rouge">app</code> service connects to <code class="language-plaintext highlighter-rouge">app_net_1</code> first as it has the highest priority. It then connects to <code class="language-plaintext highlighter-rouge">app_net_3</code>, then <code class="language-plaintext highlighter-rouge">app_net_2</code>, which uses the default priority value of <code class="language-plaintext highlighter-rouge">0</code>.</p> <div class="highlight"><pre class="highlight" data-language="">version: "2.4"
services:
  app:
    image: busybox
    command: top
    networks:
      app_net_1:
        priority: 1000
      app_net_2:

      app_net_3:
        priority: 100
networks:
  app_net_1:
  app_net_2:
  app_net_3:
</pre></div> <blockquote> <p><strong>Note</strong></p> <p>If multiple networks have the same priority, the connection order is undefined.</p> </blockquote> <h3 id="pid">pid</h3> <div class="highlight"><pre class="highlight" data-language="">pid: "host"
</pre></div> <div class="highlight"><pre class="highlight" data-language="">pid: "container:custom_container_1"
</pre></div> <div class="highlight"><pre class="highlight" data-language="">pid: "service:foobar"
</pre></div> <p>If set to one of the following forms: <code class="language-plaintext highlighter-rouge">container:&lt;container_name&gt;</code>, <code class="language-plaintext highlighter-rouge">service:&lt;service_name&gt;</code>, the service shares the PID address space of the designated container or service.</p> <p>If set to “host”, the service’s PID mode is the host PID mode. This turns on sharing between container and the host operating system the PID address space. Containers launched with this flag can access and manipulate other containers in the bare-metal machine’s namespace and vice versa.</p> <blockquote> <p>Added in <a href="../compose-versioning/index.html#version-21">version 2.1</a> file format.</p> <p>The <code class="language-plaintext highlighter-rouge">service:</code> and <code class="language-plaintext highlighter-rouge">container:</code> forms require <a href="../compose-versioning/index.html#version-21">version 2.1</a> or above</p> </blockquote> <h3 id="pids_limit">pids_limit</h3> <blockquote> <p>Added in <a href="../compose-versioning/index.html#version-21">version 2.1</a> file format.</p> </blockquote> <p>Tunes a container’s PIDs limit. Set to <code class="language-plaintext highlighter-rouge">-1</code> for unlimited PIDs.</p> <div class="highlight"><pre class="highlight" data-language="">pids_limit: 10
</pre></div> <h3 id="platform">platform</h3> <blockquote> <p>Added in <a href="../compose-versioning/index.html#version-24">version 2.4</a> file format.</p> </blockquote> <p>Target platform containers for this service will run on, using the <code class="language-plaintext highlighter-rouge">os[/arch[/variant]]</code> syntax, e.g.</p> <div class="highlight"><pre class="highlight" data-language="">platform: osx
</pre></div> <div class="highlight"><pre class="highlight" data-language="">platform: windows/amd64
</pre></div> <div class="highlight"><pre class="highlight" data-language="">platform: linux/arm64/v8
</pre></div> <p>This parameter determines which version of the image will be pulled and/or on which platform the service’s build will be performed.</p> <h3 id="ports">ports</h3> <p>Expose ports. Either specify both ports (<code class="language-plaintext highlighter-rouge">HOST:CONTAINER</code>), or just the container port (an ephemeral host port is chosen).</p> <blockquote> <p><strong>Note</strong></p> <p>When mapping ports in the <code class="language-plaintext highlighter-rouge">HOST:CONTAINER</code> format, you may experience erroneous results when using a container port lower than 60, because YAML parses numbers in the format <code class="language-plaintext highlighter-rouge">xx:yy</code> as a base-60 value. For this reason, we recommend always explicitly specifying your port mappings as strings.</p> </blockquote> <div class="highlight"><pre class="highlight" data-language="">ports:
  - "3000"
  - "3000-3005"
  - "8000:8000"
  - "9090-9091:8080-8081"
  - "49100:22"
  - "127.0.0.1:8001:8001"
  - "127.0.0.1:5000-5010:5000-5010"
  - "6060:6060/udp"
  - "12400-12500:1240"
</pre></div> <h3 id="runtime">runtime</h3> <blockquote> <p>Added in <a href="../compose-versioning/index.html#version-23">version 2.3</a> file format.</p> </blockquote> <p>Specify which runtime to use for the service’s containers. Default runtime and available runtimes are listed in the output of <code class="language-plaintext highlighter-rouge">docker info</code>.</p> <div class="highlight"><pre class="highlight" data-language="">web:
  image: busybox:latest
  command: true
  runtime: runc
</pre></div> <h3 id="scale">scale</h3> <blockquote> <p>Added in <a href="../compose-versioning/index.html#version-22">version 2.2</a> file format.</p> </blockquote> <p>Specify the default number of containers to deploy for this service. Whenever you run <code class="language-plaintext highlighter-rouge">docker-compose up</code>, Compose creates or removes containers to match the specified number. This value can be overridden using the <a href="../../reference/up/index.html"><code class="language-plaintext highlighter-rouge">--scale</code></a> flag.</p> <div class="highlight"><pre class="highlight" data-language="">web:
  image: busybox:latest
  command: echo 'scaled'
  scale: 3
</pre></div> <h3 id="security_opt">security_opt</h3> <p>Override the default labeling scheme for each container.</p> <div class="highlight"><pre class="highlight" data-language="">security_opt:
  - label:user:USER
  - label:role:ROLE
</pre></div> <h3 id="stop_grace_period">stop_grace_period</h3> <p>Specify how long to wait when attempting to stop a container if it doesn’t handle SIGTERM (or whatever stop signal has been specified with <a href="#stop_signal"><code class="language-plaintext highlighter-rouge">stop_signal</code></a>), before sending SIGKILL. Specified as a <a href="#specifying-durations">duration</a>.</p> <div class="highlight"><pre class="highlight" data-language="">stop_grace_period: 1s
</pre></div> <div class="highlight"><pre class="highlight" data-language="">stop_grace_period: 1m30s
</pre></div> <p>By default, <code class="language-plaintext highlighter-rouge">stop</code> waits 10 seconds for the container to exit before sending SIGKILL.</p> <h3 id="stop_signal">stop_signal</h3> <p>Sets an alternative signal to stop the container. By default <code class="language-plaintext highlighter-rouge">stop</code> uses SIGTERM. Setting an alternative signal using <code class="language-plaintext highlighter-rouge">stop_signal</code> causes <code class="language-plaintext highlighter-rouge">stop</code> to send that signal instead.</p> <div class="highlight"><pre class="highlight" data-language="">stop_signal: SIGUSR1
</pre></div> <h3 id="storage_opt">storage_opt</h3> <blockquote> <p>Added in <a href="../compose-versioning/index.html#version-21">version 2.1</a> file format.</p> </blockquote> <p>Set storage driver options for this service.</p> <div class="highlight"><pre class="highlight" data-language="">storage_opt:
  size: '1G'
</pre></div> <h3 id="sysctls">sysctls</h3> <blockquote> <p>Added in <a href="../compose-versioning/index.html#version-21">version 2.1</a> file format.</p> </blockquote> <p>Kernel parameters to set in the container. You can use either an array or a dictionary.</p> <div class="highlight"><pre class="highlight" data-language="">sysctls:
  net.core.somaxconn: 1024
  net.ipv4.tcp_syncookies: 0
</pre></div> <div class="highlight"><pre class="highlight" data-language="">sysctls:
  - net.core.somaxconn=1024
  - net.ipv4.tcp_syncookies=0
</pre></div> <h3 id="tmpfs">tmpfs</h3> <p>Mount a temporary file system inside the container. Can be a single value or a list.</p> <div class="highlight"><pre class="highlight" data-language="">tmpfs: /run
</pre></div> <div class="highlight"><pre class="highlight" data-language="">tmpfs:
  - /run
  - /tmp
</pre></div> <h3 id="ulimits">ulimits</h3> <p>Override the default ulimits for a container. You can either specify a single limit as an integer or soft/hard limits as a mapping.</p> <div class="highlight"><pre class="highlight" data-language="">ulimits:
  nproc: 65535
  nofile:
    soft: 20000
    hard: 40000
</pre></div> <h3 id="userns_mode">userns_mode</h3> <blockquote> <p>Added in <a href="../compose-versioning/index.html#version-21">version 2.1</a> file format.</p> </blockquote> <div class="highlight"><pre class="highlight" data-language="">userns_mode: "host"
</pre></div> <p>Disables the user namespace for this service, if Docker daemon is configured with user namespaces. See <a href="../../../engine/security/userns-remap/index.html#disable-namespace-remapping-for-a-container">dockerd</a> for more information.</p> <h3 id="volumes">volumes</h3> <p>Mount host paths or named volumes. Named volumes need to be specified with the <a href="#volume-configuration-reference">top-level <code class="language-plaintext highlighter-rouge">volumes</code> key</a>.</p> <h4 id="short-syntax">Short syntax</h4> <p>The short syntax uses the generic <code class="language-plaintext highlighter-rouge">[SOURCE:]TARGET[:MODE]</code> format, where <code class="language-plaintext highlighter-rouge">SOURCE</code> can be either a host path or volume name. <code class="language-plaintext highlighter-rouge">TARGET</code> is the container path where the volume is mounted. Standard modes are <code class="language-plaintext highlighter-rouge">ro</code> for read-only and <code class="language-plaintext highlighter-rouge">rw</code> for read-write (default).</p> <p>You can mount a relative path on the host, which expands relative to the directory of the Compose configuration file being used. Relative paths should always begin with <code class="language-plaintext highlighter-rouge">.</code> or <code class="language-plaintext highlighter-rouge">..</code>.</p> <div class="highlight"><pre class="highlight" data-language="">volumes:
  # Just specify a path and let the Engine create a volume
  - /var/lib/mysql

  # Specify an absolute path mapping
  - /opt/data:/var/lib/mysql

  # Path on the host, relative to the Compose file
  - ./cache:/tmp/cache

  # User-relative path
  - ~/configs:/etc/configs/:ro

  # Named volume
  - datavolume:/var/lib/mysql
</pre></div> <h4 id="long-syntax">Long syntax</h4> <blockquote> <p>Added in <a href="../compose-versioning/index.html#version-23">version 2.3</a> file format.</p> </blockquote> <p>The long form syntax allows the configuration of additional fields that can’t be expressed in the short form.</p> <ul> <li>
<code class="language-plaintext highlighter-rouge">type</code>: the mount type <code class="language-plaintext highlighter-rouge">volume</code>, <code class="language-plaintext highlighter-rouge">bind</code>, <code class="language-plaintext highlighter-rouge">tmpfs</code> or <code class="language-plaintext highlighter-rouge">npipe</code>
</li> <li>
<code class="language-plaintext highlighter-rouge">source</code>: the source of the mount, a path on the host for a bind mount, or the name of a volume defined in the <a href="#volume-configuration-reference">top-level <code class="language-plaintext highlighter-rouge">volumes</code> key</a>. Not applicable for a tmpfs mount.</li> <li>
<code class="language-plaintext highlighter-rouge">target</code>: the path in the container where the volume is mounted</li> <li>
<code class="language-plaintext highlighter-rouge">read_only</code>: flag to set the volume as read-only</li> <li>
<code class="language-plaintext highlighter-rouge">bind</code>: configure additional bind options <ul> <li>
<code class="language-plaintext highlighter-rouge">propagation</code>: the propagation mode used for the bind</li> </ul> </li> <li>
<code class="language-plaintext highlighter-rouge">volume</code>: configure additional volume options <ul> <li>
<code class="language-plaintext highlighter-rouge">nocopy</code>: flag to disable copying of data from a container when a volume is created</li> </ul> </li> <li>
<code class="language-plaintext highlighter-rouge">tmpfs</code>: configure additional tmpfs options <ul> <li>
<code class="language-plaintext highlighter-rouge">size</code>: the size for the tmpfs mount in bytes</li> </ul> </li> </ul> <div class="highlight"><pre class="highlight" data-language="">version: "2.4"
services:
  web:
    image: nginx:alpine
    ports:
      - "80:80"
    volumes:
      - type: volume
        source: mydata
        target: /data
        volume:
          nocopy: true
      - type: bind
        source: ./static
        target: /opt/app/static

networks:
  webnet:

volumes:
  mydata:
</pre></div> <blockquote> <p><strong>Note</strong></p> <p>When creating bind mounts, using the long syntax requires the referenced folder to be created beforehand. Using the short syntax creates the folder on the fly if it doesn’t exist. See the <a href="https://docs.docker.com/storage/bind-mounts/#differences-between--v-and---mount-behavior">bind mounts documentation</a> for more information.</p> </blockquote> <h3 id="volume_driver">volume_driver</h3> <p>Specify a default volume driver to be used for all declared volumes on this service.</p> <div class="highlight"><pre class="highlight" data-language="">volume_driver: mydriver
</pre></div> <blockquote> <p><strong>Note</strong></p> <p>In <a href="../compose-versioning/index.html#version-2">version 2 files</a>, this option only applies to anonymous volumes (those specified in the image, or specified under <code class="language-plaintext highlighter-rouge">volumes</code> without an explicit named volume or host path). To configure the driver for a named volume, use the <code class="language-plaintext highlighter-rouge">driver</code> key under the entry in the <a href="#volume-configuration-reference">top-level <code class="language-plaintext highlighter-rouge">volumes</code> option</a>.</p> </blockquote> <p>See <a href="https://docs.docker.com/storage/volumes/">Docker Volumes</a> and <a href="../../../engine/extend/plugins_volume/index.html">Volume Plugins</a> for more information.</p> <h3 id="volumes_from">volumes_from</h3> <p>Mount all of the volumes from another service or container, optionally specifying read-only access (<code class="language-plaintext highlighter-rouge">ro</code>) or read-write (<code class="language-plaintext highlighter-rouge">rw</code>). If no access level is specified, then read-write is used.</p> <div class="highlight"><pre class="highlight" data-language="">volumes_from:
  - service_name
  - service_name:ro
  - container:container_name
  - container:container_name:rw
</pre></div> <blockquote> <p>Changed in <a href="../compose-versioning/index.html#version-2">version 2</a> file format.</p> </blockquote> <h3 id="restart">restart</h3> <p><code class="language-plaintext highlighter-rouge">no</code> is the default restart policy, and it doesn’t restart a container under any circumstance. When <code class="language-plaintext highlighter-rouge">always</code> is specified, the container always restarts. The <code class="language-plaintext highlighter-rouge">on-failure</code> policy restarts a container if the exit code indicates an on-failure error.</p> <div class="highlight"><pre class="highlight" data-language="">restart: "no"
</pre></div> <div class="highlight"><pre class="highlight" data-language="">restart: "always"
</pre></div> <div class="highlight"><pre class="highlight" data-language="">restart: "on-failure"
</pre></div> <div class="highlight"><pre class="highlight" data-language="">restart: "unless-stopped"
</pre></div> <h3 id="cpu-and-other-resources">cpu_count, cpu_percent, cpu_shares, cpu_period, cpu_quota, cpus, cpuset, domainname, hostname, ipc, mac_address, mem_limit, memswap_limit, mem_swappiness, mem_reservation, oom_kill_disable, oom_score_adj, privileged, read_only, shm_size, stdin_open, tty, user, working_dir</h3> <p>Each of these is a single value, analogous to its <a href="../../../engine/reference/run/index.html#runtime-constraints-on-resources">docker run</a> counterpart.</p> <blockquote> <p>Added in <a href="../compose-versioning/index.html#version-22">version 2.2</a> file format.</p> <p>The <code class="language-plaintext highlighter-rouge">cpu_count</code>, <code class="language-plaintext highlighter-rouge">cpu_percent</code>, and <code class="language-plaintext highlighter-rouge">cpus</code> options were added in <a href="../compose-versioning/index.html#version-22">version 2.2</a>.</p> </blockquote> <blockquote> <p>Added in <a href="../compose-versioning/index.html#version-21">version 2.1</a> file format.</p> <p>The <code class="language-plaintext highlighter-rouge">oom_kill_disable</code> and <code class="language-plaintext highlighter-rouge">cpu_period</code> options were added in <a href="../compose-versioning/index.html#version-21">version 2.1</a>.</p> </blockquote> <div class="highlight"><pre class="highlight" data-language="">cpu_count: 2
cpu_percent: 50
cpus: 0.5
cpu_shares: 73
cpu_quota: 50000
cpu_period: 20ms
cpuset: 0,1

user: postgresql
working_dir: /code

domainname: foo.com
hostname: foo
ipc: host
mac_address: 02:42:ac:11:65:43

mem_limit: 1000000000
memswap_limit: 2000000000
mem_reservation: 512m
privileged: true

oom_score_adj: 500
oom_kill_disable: true

read_only: true
shm_size: 64M
stdin_open: true
tty: true
</pre></div>  <h2 id="specifying-durations">Specifying durations</h2> <p>Some configuration options, such as the <code class="language-plaintext highlighter-rouge">interval</code> and <code class="language-plaintext highlighter-rouge">timeout</code> sub-options for <a href="#healthcheck"><code class="language-plaintext highlighter-rouge">healthcheck</code></a>, accept a duration as a string in a format that looks like this:</p> <div class="highlight"><pre class="highlight" data-language="">2.5s
10s
1m30s
2h32m
5h34m56s
</pre></div> <p>The supported units are <code class="language-plaintext highlighter-rouge">us</code>, <code class="language-plaintext highlighter-rouge">ms</code>, <code class="language-plaintext highlighter-rouge">s</code>, <code class="language-plaintext highlighter-rouge">m</code> and <code class="language-plaintext highlighter-rouge">h</code>.</p> <h2 id="specifying-byte-values">Specifying byte values</h2> <p>Some configuration options, such as the <code class="language-plaintext highlighter-rouge">device_read_bps</code> sub-option for <a href="#blkio_config"><code class="language-plaintext highlighter-rouge">blkio_config</code></a>, accept a byte value as a string in a format that looks like this:</p> <div class="highlight"><pre class="highlight" data-language="">2b
1024kb
2048k
300m
1gb
</pre></div> <p>The supported units are <code class="language-plaintext highlighter-rouge">b</code>, <code class="language-plaintext highlighter-rouge">k</code>, <code class="language-plaintext highlighter-rouge">m</code> and <code class="language-plaintext highlighter-rouge">g</code>, and their alternative notation <code class="language-plaintext highlighter-rouge">kb</code>, <code class="language-plaintext highlighter-rouge">mb</code> and <code class="language-plaintext highlighter-rouge">gb</code>. Decimal values are not supported at this time.</p> <h2 id="volume-configuration-reference">Volume configuration reference</h2> <p>While it is possible to declare <a href="#volumes">volumes</a> on the fly as part of the service declaration, this section allows you to create named volumes that can be reused across multiple services (without relying on <code class="language-plaintext highlighter-rouge">volumes_from</code>), and are easily retrieved and inspected using the docker command line or API. See the <a href="../../../engine/reference/commandline/volume_create/index.html">docker volume</a> subcommand documentation for more information.</p> <p>See <a href="https://docs.docker.com/storage/volumes/">use volumes</a> and <a href="../../../engine/extend/plugins_volume/index.html">volume plugins</a> for general information on volumes.</p> <p>Here’s an example of a two-service setup where a database’s data directory is shared with another service as a volume so that it can be periodically backed up:</p> <div class="highlight"><pre class="highlight" data-language="">version: "2.4"

services:
  db:
    image: db
    volumes:
      - data-volume:/var/lib/db
  backup:
    image: backup-service
    volumes:
      - data-volume:/var/lib/backup/data

volumes:
  data-volume:
</pre></div> <p>An entry under the top-level <code class="language-plaintext highlighter-rouge">volumes</code> key can be empty, in which case it uses the default driver configured by the Engine (in most cases, this is the <code class="language-plaintext highlighter-rouge">local</code> driver). Optionally, you can configure it with the following keys:</p> <h3 id="driver">driver</h3> <p>Specify which volume driver should be used for this volume. Defaults to whatever driver the Docker Engine has been configured to use, which in most cases is <code class="language-plaintext highlighter-rouge">local</code>. If the driver is not available, the Engine returns an error when <code class="language-plaintext highlighter-rouge">docker-compose up</code> tries to create the volume.</p> <div class="highlight"><pre class="highlight" data-language="">driver: foobar
</pre></div> <h3 id="driver_opts">driver_opts</h3> <p>Specify a list of options as key-value pairs to pass to the driver for this volume. Those options are driver-dependent - consult the driver’s documentation for more information. Optional.</p> <div class="highlight"><pre class="highlight" data-language="">volumes:
  example:
    driver_opts:
      type: "nfs"
      o: "addr=10.40.0.199,nolock,soft,rw"
      device: ":/docker/example"
</pre></div> <h3 id="external">external</h3> <p>If set to <code class="language-plaintext highlighter-rouge">true</code>, specifies that this volume has been created outside of Compose. <code class="language-plaintext highlighter-rouge">docker-compose up</code> does not attempt to create it, and raises an error if it doesn’t exist.</p> <p>For version 2.0 of the format, <code class="language-plaintext highlighter-rouge">external</code> cannot be used in conjunction with other volume configuration keys (<code class="language-plaintext highlighter-rouge">driver</code>, <code class="language-plaintext highlighter-rouge">driver_opts</code>, <code class="language-plaintext highlighter-rouge">labels</code>). This limitation no longer exists for <a href="../compose-versioning/index.html#version-21">version 2.1</a> and above.</p> <p>In the example below, instead of attempting to create a volume called <code class="language-plaintext highlighter-rouge">[projectname]_data</code>, Compose looks for an existing volume simply called <code class="language-plaintext highlighter-rouge">data</code> and mount it into the <code class="language-plaintext highlighter-rouge">db</code> service’s containers.</p> <div class="highlight"><pre class="highlight" data-language="">version: "2.4"

services:
  db:
    image: postgres
    volumes:
      - data:/var/lib/postgresql/data

volumes:
  data:
    external: true
</pre></div> <p>You can also specify the name of the volume separately from the name used to refer to it within the Compose file:</p> <div class="highlight"><pre class="highlight" data-language="">volumes:
  data:
    external:
      name: actual-name-of-volume
</pre></div> <blockquote class="important"> <p>Deprecated in <a href="../compose-versioning/index.html#version-21">version 2.1</a> file format.</p> <p>external.name was deprecated in version 2.1 file format use <code class="language-plaintext highlighter-rouge">name</code> instead.</p> </blockquote> <h3 id="labels-2">labels</h3> <blockquote> <p>Added in <a href="../compose-versioning/index.html#version-21">version 2.1</a> file format.</p> </blockquote> <p>Add metadata to containers using <a href="https://docs.docker.com/config/labels-custom-metadata/">Docker labels</a>. You can use either an array or a dictionary.</p> <p>It’s recommended that you use reverse-DNS notation to prevent your labels from conflicting with those used by other software.</p> <div class="highlight"><pre class="highlight" data-language="">labels:
  com.example.description: "Database volume"
  com.example.department: "IT/Ops"
  com.example.label-with-empty-value: ""
</pre></div> <div class="highlight"><pre class="highlight" data-language="">labels:
  - "com.example.description=Database volume"
  - "com.example.department=IT/Ops"
  - "com.example.label-with-empty-value"
</pre></div> <h3 id="name">name</h3> <blockquote> <p>Added in <a href="../compose-versioning/index.html#version-21">version 2.1</a> file format.</p> </blockquote> <p>Set a custom name for this volume. The name field can be used to reference volumes that contain special characters. The name is used as is and will <strong>not</strong> be scoped with the stack name.</p> <div class="highlight"><pre class="highlight" data-language="">version: "2.4"
volumes:
  data:
    name: my-app-data
</pre></div> <p>It can also be used in conjunction with the <code class="language-plaintext highlighter-rouge">external</code> property:</p> <div class="highlight"><pre class="highlight" data-language="">version: "2.4"
volumes:
  data:
    external: true
    name: my-app-data
</pre></div> <h2 id="network-configuration-reference">Network configuration reference</h2> <p>The top-level <code class="language-plaintext highlighter-rouge">networks</code> key lets you specify networks to be created. For a full explanation of Compose’s use of Docker networking features, see the <a href="../../networking/index.html">Networking guide</a>.</p> <h3 id="driver-1">driver</h3> <p>Specify which driver should be used for this network.</p> <p>The default driver depends on how the Docker Engine you’re using is configured, but in most instances it is <code class="language-plaintext highlighter-rouge">bridge</code> on a single host and <code class="language-plaintext highlighter-rouge">overlay</code> on a Swarm.</p> <p>The Docker Engine returns an error if the driver is not available.</p> <div class="highlight"><pre class="highlight" data-language="">driver: overlay
</pre></div> <blockquote> <p>Changed in <a href="../compose-versioning/index.html#version-21">version 2.1</a> file format.</p> <p>Starting with Compose file format 2.1, overlay networks are always created as <code class="language-plaintext highlighter-rouge">attachable</code>, and this is not configurable. This means that standalone containers can connect to overlay networks.</p> </blockquote> <h3 id="driver_opts-1">driver_opts</h3> <p>Specify a list of options as key-value pairs to pass to the driver for this network. Those options are driver-dependent - consult the driver’s documentation for more information. Optional.</p> <div class="highlight"><pre class="highlight" data-language="">driver_opts:
  foo: "bar"
  baz: 1
</pre></div> <h3 id="enable_ipv6">enable_ipv6</h3> <blockquote> <p>Added in <a href="../compose-versioning/index.html#version-21">version 2.1</a> file format.</p> </blockquote> <p>Enable IPv6 networking on this network.</p> <h3 id="ipam">ipam</h3> <p>Specify custom IPAM config. This is an object with several properties, each of which is optional:</p> <ul> <li>
<code class="language-plaintext highlighter-rouge">driver</code>: Custom IPAM driver, instead of the default.</li> <li>
<code class="language-plaintext highlighter-rouge">config</code>: A list with zero or more config blocks, each containing any of the following keys: <ul> <li>
<code class="language-plaintext highlighter-rouge">subnet</code>: Subnet in CIDR format that represents a network segment</li> <li>
<code class="language-plaintext highlighter-rouge">ip_range</code>: Range of IPs from which to allocate container IPs</li> <li>
<code class="language-plaintext highlighter-rouge">gateway</code>: IPv4 or IPv6 gateway for the master subnet</li> <li>
<code class="language-plaintext highlighter-rouge">aux_addresses</code>: Auxiliary IPv4 or IPv6 addresses used by Network driver, as a mapping from hostname to IP</li> </ul> </li> <li>
<code class="language-plaintext highlighter-rouge">options</code>: Driver-specific options as a key-value mapping.</li> </ul> <p>A full example:</p> <div class="highlight"><pre class="highlight" data-language="">ipam:
  driver: default
  config:
    - subnet: 172.28.0.0/16
      ip_range: 172.28.5.0/24
      gateway: 172.28.5.254
      aux_addresses:
        host1: 172.28.1.5
        host2: 172.28.1.6
        host3: 172.28.1.7
  options:
    foo: bar
    baz: "0"
</pre></div> <h3 id="internal">internal</h3> <p>By default, Docker also connects a bridge network to it to provide external connectivity. If you want to create an externally isolated overlay network, you can set this option to <code class="language-plaintext highlighter-rouge">true</code>.</p> <h3 id="labels-3">labels</h3> <blockquote> <p>Added in <a href="../compose-versioning/index.html#version-21">version 2.1</a> file format.</p> </blockquote> <p>Add metadata to containers using <a href="https://docs.docker.com/config/labels-custom-metadata/">Docker labels</a>. You can use either an array or a dictionary.</p> <p>It’s recommended that you use reverse-DNS notation to prevent your labels from conflicting with those used by other software.</p> <div class="highlight"><pre class="highlight" data-language="">labels:
  com.example.description: "Financial transaction network"
  com.example.department: "Finance"
  com.example.label-with-empty-value: ""
</pre></div> <div class="highlight"><pre class="highlight" data-language="">labels:
  - "com.example.description=Financial transaction network"
  - "com.example.department=Finance"
  - "com.example.label-with-empty-value"
</pre></div> <h3 id="external-1">external</h3> <p>If set to <code class="language-plaintext highlighter-rouge">true</code>, specifies that this network has been created outside of Compose. <code class="language-plaintext highlighter-rouge">docker-compose up</code> does not attempt to create it, and raises an error if it doesn’t exist.</p> <p>For version 2.0 of the format, <code class="language-plaintext highlighter-rouge">external</code> cannot be used in conjunction with other network configuration keys (<code class="language-plaintext highlighter-rouge">driver</code>, <code class="language-plaintext highlighter-rouge">driver_opts</code>, <code class="language-plaintext highlighter-rouge">ipam</code>, <code class="language-plaintext highlighter-rouge">internal</code>). This limitation no longer exists for <a href="../compose-versioning/index.html#version-21">version 2.1</a> and above.</p> <p>In the example below, <code class="language-plaintext highlighter-rouge">proxy</code> is the gateway to the outside world. Instead of attempting to create a network called <code class="language-plaintext highlighter-rouge">[projectname]_outside</code>, Compose looks for an existing network simply called <code class="language-plaintext highlighter-rouge">outside</code> and connect the <code class="language-plaintext highlighter-rouge">proxy</code> service’s containers to it.</p> <div class="highlight"><pre class="highlight" data-language="">version: "2.4"

services:
  proxy:
    build: ./proxy
    networks:
      - outside
      - default
  app:
    build: ./app
    networks:
      - default

networks:
  outside:
    external: true
</pre></div> <p>You can also specify the name of the network separately from the name used to refer to it within the Compose file:</p> <div class="highlight"><pre class="highlight" data-language="">version: "2.4"
networks:
  outside:
    external:
      name: actual-name-of-network
</pre></div> <p>Not supported for version 2 <code class="language-plaintext highlighter-rouge">docker-compose</code> files. Use <a href="#network_mode">network_mode</a> instead.</p> <h3 id="name-1">name</h3> <blockquote> <p>Added in <a href="../compose-versioning/index.html#version-21">version 2.1</a> file format.</p> </blockquote> <p>Set a custom name for this network. The name field can be used to reference networks which contain special characters. The name is used as is and will <strong>not</strong> be scoped with the stack name.</p> <div class="highlight"><pre class="highlight" data-language="">version: "2.4"
networks:
  network1:
    name: my-app-net
</pre></div> <p>It can also be used in conjunction with the <code class="language-plaintext highlighter-rouge">external</code> property:</p> <div class="highlight"><pre class="highlight" data-language="">version: "2.4"
networks:
  network1:
    external: true
    name: my-app-net
</pre></div> <h2 id="variable-substitution">Variable substitution</h2> <p>Your configuration options can contain environment variables. Compose uses the variable values from the shell environment in which <code class="language-plaintext highlighter-rouge">docker-compose</code> is run. For example, suppose the shell contains <code class="language-plaintext highlighter-rouge">POSTGRES_VERSION=9.3</code> and you supply this configuration:</p> <div class="highlight"><pre class="highlight" data-language="">db:
  image: "postgres:${POSTGRES_VERSION}"
</pre></div> <p>When you run <code class="language-plaintext highlighter-rouge">docker-compose up</code> with this configuration, Compose looks for the <code class="language-plaintext highlighter-rouge">POSTGRES_VERSION</code> environment variable in the shell and substitutes its value in. For this example, Compose resolves the <code class="language-plaintext highlighter-rouge">image</code> to <code class="language-plaintext highlighter-rouge">postgres:9.3</code> before running the configuration.</p> <p>If an environment variable is not set, Compose substitutes with an empty string. In the example above, if <code class="language-plaintext highlighter-rouge">POSTGRES_VERSION</code> is not set, the value for the <code class="language-plaintext highlighter-rouge">image</code> option is <code class="language-plaintext highlighter-rouge">postgres:</code>.</p> <p>You can set default values for environment variables using a <a href="../../env-file/index.html"><code class="language-plaintext highlighter-rouge">.env</code> file</a>, which Compose automatically looks for in project directory (parent folder of your Compose file). Values set in the shell environment override those set in the <code class="language-plaintext highlighter-rouge">.env</code> file.</p> <blockquote class="important"> <p>Note when using docker stack deploy</p> <p>The <code class="language-plaintext highlighter-rouge">.env file</code> feature only works when you use the <code class="language-plaintext highlighter-rouge">docker-compose up</code> command and does not work with <code class="language-plaintext highlighter-rouge">docker stack deploy</code>.</p> </blockquote> <p>Both <code class="language-plaintext highlighter-rouge">$VARIABLE</code> and <code class="language-plaintext highlighter-rouge">${VARIABLE}</code> syntax are supported. Additionally when using the <a href="../compose-versioning/index.html#version-21">2.1 file format</a>, it is possible to provide inline default values using typical shell syntax:</p> <ul> <li>
<code class="language-plaintext highlighter-rouge">${VARIABLE:-default}</code> evaluates to <code class="language-plaintext highlighter-rouge">default</code> if <code class="language-plaintext highlighter-rouge">VARIABLE</code> is unset or empty in the environment.</li> <li>
<code class="language-plaintext highlighter-rouge">${VARIABLE-default}</code> evaluates to <code class="language-plaintext highlighter-rouge">default</code> only if <code class="language-plaintext highlighter-rouge">VARIABLE</code> is unset in the environment.</li> </ul> <p>Similarly, the following syntax allows you to specify mandatory variables:</p> <ul> <li>
<code class="language-plaintext highlighter-rouge">${VARIABLE:?err}</code> exits with an error message containing <code class="language-plaintext highlighter-rouge">err</code> if <code class="language-plaintext highlighter-rouge">VARIABLE</code> is unset or empty in the environment.</li> <li>
<code class="language-plaintext highlighter-rouge">${VARIABLE?err}</code> exits with an error message containing <code class="language-plaintext highlighter-rouge">err</code> if <code class="language-plaintext highlighter-rouge">VARIABLE</code> is unset in the environment.</li> </ul> <p>Other extended shell-style features, such as <code class="language-plaintext highlighter-rouge">${VARIABLE/foo/bar}</code>, are not supported.</p> <p>You can use a <code class="language-plaintext highlighter-rouge">$$</code> (double-dollar sign) when your configuration needs a literal dollar sign. This also prevents Compose from interpolating a value, so a <code class="language-plaintext highlighter-rouge">$$</code> allows you to refer to environment variables that you don’t want processed by Compose.</p> <div class="highlight"><pre class="highlight" data-language="">web:
  build: .
  command: "$$VAR_NOT_INTERPOLATED_BY_COMPOSE"
</pre></div> <p>If you forget and use a single dollar sign (<code class="language-plaintext highlighter-rouge">$</code>), Compose interprets the value as an environment variable and warns you:</p> <div class="highlight"><pre class="highlight" data-language="">The VAR_NOT_INTERPOLATED_BY_COMPOSE is not set. Substituting an empty string.
</pre></div> <h2 id="extension-fields">Extension fields</h2> <blockquote> <p>Added in <a href="../compose-versioning/index.html#version-21">version 2.1</a> file format.</p> </blockquote> <p>It is possible to re-use configuration fragments using extension fields. Those special fields can be of any format as long as they are located at the root of your Compose file and their name start with the <code class="language-plaintext highlighter-rouge">x-</code> character sequence.</p> <blockquote> <p><strong>Note</strong></p> <p>Starting with the 3.7 format (for the 3.x series) and 2.4 format (for the 2.x series), extension fields are also allowed at the root of service, volume, network, config and secret definitions.</p> </blockquote> <div class="highlight"><pre class="highlight" data-language="">version: "3.9"
x-custom:
  items:
    - a
    - b
  options:
    max-size: '12m'
  name: "custom"
</pre></div> <p>The contents of those fields are ignored by Compose, but they can be inserted in your resource definitions using <a href="https://yaml.org/spec/1.2/spec.html#id2765878">YAML anchors</a>. For example, if you want several of your services to use the same logging configuration:</p> <div class="highlight"><pre class="highlight" data-language="">logging:
  options:
    max-size: '12m'
    max-file: '5'
  driver: json-file
</pre></div> <p>You may write your Compose file as follows:</p> <div class="highlight"><pre class="highlight" data-language="">version: "3.9"
x-logging:
  &amp;default-logging
  options:
    max-size: '12m'
    max-file: '5'
  driver: json-file

services:
  web:
    image: myapp/web:latest
    logging: *default-logging
  db:
    image: mysql:latest
    logging: *default-logging
</pre></div> <p>It is also possible to partially override values in extension fields using the <a href="https://yaml.org/type/merge.html">YAML merge type</a>. For example:</p> <div class="highlight"><pre class="highlight" data-language="">version: "3.9"
x-volumes:
  &amp;default-volume
  driver: foobar-storage

services:
  web:
    image: myapp/web:latest
    volumes: ["vol1", "vol2", "vol3"]
volumes:
  vol1: *default-volume
  vol2:
    &lt;&lt; : *default-volume
    name: volume02
  vol3:
    &lt;&lt; : *default-volume
    driver: default
    name: volume-local
</pre></div> <h2 id="compose-documentation">Compose documentation</h2> <ul> <li><a href="../../index.html">User guide</a></li> <li><a href="../../install/index.html">Installing Compose</a></li> <li><a href="../compose-versioning/index.html">Compose file versions and upgrading</a></li> <li><a href="../../samples-for-compose/index.html">Sample apps with Compose</a></li> <li><a href="../../reference/index.html">Command line reference</a></li> </ul> 
<p><a href="https://docs.docker.com/search/?q=fig">fig</a>, <a href="https://docs.docker.com/search/?q=composition">composition</a>, <a href="https://docs.docker.com/search/?q=compose%20version%202">compose version 2</a>, <a href="https://docs.docker.com/search/?q=docker">docker</a></p>
<div class="_attribution">
  <p class="_attribution-p">
    &copy; 2019 Docker, Inc.<br>Licensed under the Apache License, Version 2.0.<br>Docker and the Docker logo are trademarks or registered trademarks of Docker, Inc. in the United States and/or other countries.<br>Docker, Inc. and other parties may also have trademark rights in other terms used herein.<br>
    <a href="https://docs.docker.com/compose/compose-file/compose-file-v2/" class="_attribution-link">https://docs.docker.com/compose/compose-file/compose-file-v2/</a>
  </p>
</div>
