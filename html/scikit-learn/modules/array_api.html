<section id="array-api-support-experimental"> <h1 id="array-api">11.1. Array API support (experimental)</h1> <p>The <a class="reference external" href="https://data-apis.org/array-api/latest/">Array API</a> specification defines a standard API for all array manipulation libraries with a NumPy-like API. Scikit-learn’s Array API support requires <a class="reference external" href="https://github.com/data-apis/array-api-compat">array-api-compat</a> to be installed, and the environment variable <code>SCIPY_ARRAY_API</code> must be set to <code>1</code> before importing <code>scipy</code> and <code>scikit-learn</code>:</p> <pre data-language="python">export SCIPY_ARRAY_API=1
</pre>
<p>Please note that this environment variable is intended for temporary use. For more details, refer to SciPy’s <a class="reference external" href="https://docs.scipy.org/doc/scipy/dev/api-dev/array_api.html#using-array-api-standard-support">Array API documentation</a>.</p> <p>Some scikit-learn estimators that primarily rely on NumPy (as opposed to using Cython) to implement the algorithmic logic of their <code>fit</code>, <code>predict</code> or <code>transform</code> methods can be configured to accept any Array API compatible input datastructures and automatically dispatch operations to the underlying namespace instead of relying on NumPy.</p> <p>At this stage, this support is <strong>considered experimental</strong> and must be enabled explicitly as explained in the following.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>Currently, only <code>array-api-strict</code>, <code>cupy</code>, and <code>PyTorch</code> are known to work with scikit-learn’s estimators.</p> </div> <p>The following video provides an overview of the standard’s design principles and how it facilitates interoperability between array libraries:</p> <ul class="simple"> <li>
<a class="reference external" href="https://www.youtube.com/watch?v=c_s8tr1AizA">Scikit-learn on GPUs with Array API</a> by <a class="reference external" href="https://github.com/thomasjpfan">Thomas Fan</a> at PyData NYC 2023.</li> </ul> <section id="example-usage"> <h2>
<span class="section-number">11.1.1. </span>Example usage</h2> <p>Here is an example code snippet to demonstrate how to use <a class="reference external" href="https://cupy.dev/">CuPy</a> to run <a class="reference internal" href="generated/sklearn.discriminant_analysis.lineardiscriminantanalysis.html#sklearn.discriminant_analysis.LinearDiscriminantAnalysis" title="sklearn.discriminant_analysis.LinearDiscriminantAnalysis"><code>LinearDiscriminantAnalysis</code></a> on a GPU:</p> <pre data-language="python">&gt;&gt;&gt; from sklearn.datasets import make_classification
&gt;&gt;&gt; from sklearn import config_context
&gt;&gt;&gt; from sklearn.discriminant_analysis import LinearDiscriminantAnalysis
&gt;&gt;&gt; import cupy

&gt;&gt;&gt; X_np, y_np = make_classification(random_state=0)
&gt;&gt;&gt; X_cu = cupy.asarray(X_np)
&gt;&gt;&gt; y_cu = cupy.asarray(y_np)
&gt;&gt;&gt; X_cu.device
&lt;CUDA Device 0&gt;

&gt;&gt;&gt; with config_context(array_api_dispatch=True):
...     lda = LinearDiscriminantAnalysis()
...     X_trans = lda.fit_transform(X_cu, y_cu)
&gt;&gt;&gt; X_trans.device
&lt;CUDA Device 0&gt;
</pre> <p>After the model is trained, fitted attributes that are arrays will also be from the same Array API namespace as the training data. For example, if CuPy’s Array API namespace was used for training, then fitted attributes will be on the GPU. We provide a experimental <code>_estimator_with_converted_arrays</code> utility that transfers an estimator attributes from Array API to a ndarray:</p> <pre data-language="python">&gt;&gt;&gt; from sklearn.utils._array_api import _estimator_with_converted_arrays
&gt;&gt;&gt; cupy_to_ndarray = lambda array : array.get()
&gt;&gt;&gt; lda_np = _estimator_with_converted_arrays(lda, cupy_to_ndarray)
&gt;&gt;&gt; X_trans = lda_np.transform(X_np)
&gt;&gt;&gt; type(X_trans)
&lt;class 'numpy.ndarray'&gt;
</pre> <section id="pytorch-support"> <h3>
<span class="section-number">11.1.1.1. </span>PyTorch Support</h3> <p>PyTorch Tensors are supported by setting <code>array_api_dispatch=True</code> and passing in the tensors directly:</p> <pre data-language="python">&gt;&gt;&gt; import torch
&gt;&gt;&gt; X_torch = torch.asarray(X_np, device="cuda", dtype=torch.float32)
&gt;&gt;&gt; y_torch = torch.asarray(y_np, device="cuda", dtype=torch.float32)

&gt;&gt;&gt; with config_context(array_api_dispatch=True):
...     lda = LinearDiscriminantAnalysis()
...     X_trans = lda.fit_transform(X_torch, y_torch)
&gt;&gt;&gt; type(X_trans)
&lt;class 'torch.Tensor'&gt;
&gt;&gt;&gt; X_trans.device.type
'cuda'
</pre> </section> </section> <section id="support-for-array-api-compatible-inputs"> <h2 id="array-api-supported">
<span class="section-number">11.1.2. </span>Support for <code>Array API</code>-compatible inputs</h2> <p>Estimators and other tools in scikit-learn that support Array API compatible inputs.</p> <section id="estimators"> <h3>
<span class="section-number">11.1.2.1. </span>Estimators</h3> <ul class="simple"> <li>
<a class="reference internal" href="generated/sklearn.decomposition.pca.html#sklearn.decomposition.PCA" title="sklearn.decomposition.PCA"><code>decomposition.PCA</code></a> (with <code>svd_solver="full"</code>, <code>svd_solver="randomized"</code> and <code>power_iteration_normalizer="QR"</code>)</li> <li>
<a class="reference internal" href="generated/sklearn.linear_model.ridge.html#sklearn.linear_model.Ridge" title="sklearn.linear_model.Ridge"><code>linear_model.Ridge</code></a> (with <code>solver="svd"</code>)</li> <li>
<a class="reference internal" href="generated/sklearn.discriminant_analysis.lineardiscriminantanalysis.html#sklearn.discriminant_analysis.LinearDiscriminantAnalysis" title="sklearn.discriminant_analysis.LinearDiscriminantAnalysis"><code>discriminant_analysis.LinearDiscriminantAnalysis</code></a> (with <code>solver="svd"</code>)</li> <li><a class="reference internal" href="generated/sklearn.preprocessing.kernelcenterer.html#sklearn.preprocessing.KernelCenterer" title="sklearn.preprocessing.KernelCenterer"><code>preprocessing.KernelCenterer</code></a></li> <li><a class="reference internal" href="generated/sklearn.preprocessing.labelencoder.html#sklearn.preprocessing.LabelEncoder" title="sklearn.preprocessing.LabelEncoder"><code>preprocessing.LabelEncoder</code></a></li> <li><a class="reference internal" href="generated/sklearn.preprocessing.maxabsscaler.html#sklearn.preprocessing.MaxAbsScaler" title="sklearn.preprocessing.MaxAbsScaler"><code>preprocessing.MaxAbsScaler</code></a></li> <li><a class="reference internal" href="generated/sklearn.preprocessing.minmaxscaler.html#sklearn.preprocessing.MinMaxScaler" title="sklearn.preprocessing.MinMaxScaler"><code>preprocessing.MinMaxScaler</code></a></li> <li><a class="reference internal" href="generated/sklearn.preprocessing.normalizer.html#sklearn.preprocessing.Normalizer" title="sklearn.preprocessing.Normalizer"><code>preprocessing.Normalizer</code></a></li> </ul> </section> <section id="meta-estimators"> <h3>
<span class="section-number">11.1.2.2. </span>Meta-estimators</h3> <p>Meta-estimators that accept Array API inputs conditioned on the fact that the base estimator also does:</p> <ul class="simple"> <li><a class="reference internal" href="generated/sklearn.model_selection.gridsearchcv.html#sklearn.model_selection.GridSearchCV" title="sklearn.model_selection.GridSearchCV"><code>model_selection.GridSearchCV</code></a></li> <li><a class="reference internal" href="generated/sklearn.model_selection.randomizedsearchcv.html#sklearn.model_selection.RandomizedSearchCV" title="sklearn.model_selection.RandomizedSearchCV"><code>model_selection.RandomizedSearchCV</code></a></li> <li><a class="reference internal" href="generated/sklearn.model_selection.halvinggridsearchcv.html#sklearn.model_selection.HalvingGridSearchCV" title="sklearn.model_selection.HalvingGridSearchCV"><code>model_selection.HalvingGridSearchCV</code></a></li> <li><a class="reference internal" href="generated/sklearn.model_selection.halvingrandomsearchcv.html#sklearn.model_selection.HalvingRandomSearchCV" title="sklearn.model_selection.HalvingRandomSearchCV"><code>model_selection.HalvingRandomSearchCV</code></a></li> </ul> </section> <section id="metrics"> <h3>
<span class="section-number">11.1.2.3. </span>Metrics</h3> <ul class="simple"> <li><code>sklearn.metrics.cluster.entropy</code></li> <li><a class="reference internal" href="generated/sklearn.metrics.accuracy_score.html#sklearn.metrics.accuracy_score" title="sklearn.metrics.accuracy_score"><code>sklearn.metrics.accuracy_score</code></a></li> <li><a class="reference internal" href="generated/sklearn.metrics.d2_tweedie_score.html#sklearn.metrics.d2_tweedie_score" title="sklearn.metrics.d2_tweedie_score"><code>sklearn.metrics.d2_tweedie_score</code></a></li> <li><a class="reference internal" href="generated/sklearn.metrics.f1_score.html#sklearn.metrics.f1_score" title="sklearn.metrics.f1_score"><code>sklearn.metrics.f1_score</code></a></li> <li><a class="reference internal" href="generated/sklearn.metrics.max_error.html#sklearn.metrics.max_error" title="sklearn.metrics.max_error"><code>sklearn.metrics.max_error</code></a></li> <li><a class="reference internal" href="generated/sklearn.metrics.mean_absolute_error.html#sklearn.metrics.mean_absolute_error" title="sklearn.metrics.mean_absolute_error"><code>sklearn.metrics.mean_absolute_error</code></a></li> <li><a class="reference internal" href="generated/sklearn.metrics.mean_absolute_percentage_error.html#sklearn.metrics.mean_absolute_percentage_error" title="sklearn.metrics.mean_absolute_percentage_error"><code>sklearn.metrics.mean_absolute_percentage_error</code></a></li> <li><a class="reference internal" href="generated/sklearn.metrics.mean_gamma_deviance.html#sklearn.metrics.mean_gamma_deviance" title="sklearn.metrics.mean_gamma_deviance"><code>sklearn.metrics.mean_gamma_deviance</code></a></li> <li>
<a class="reference internal" href="generated/sklearn.metrics.mean_poisson_deviance.html#sklearn.metrics.mean_poisson_deviance" title="sklearn.metrics.mean_poisson_deviance"><code>sklearn.metrics.mean_poisson_deviance</code></a> (requires <a class="reference external" href="https://docs.scipy.org/doc/scipy/dev/api-dev/array_api.html#using-array-api-standard-support">enabling array API support for SciPy</a>)</li> <li><a class="reference internal" href="generated/sklearn.metrics.mean_squared_error.html#sklearn.metrics.mean_squared_error" title="sklearn.metrics.mean_squared_error"><code>sklearn.metrics.mean_squared_error</code></a></li> <li><a class="reference internal" href="generated/sklearn.metrics.mean_squared_log_error.html#sklearn.metrics.mean_squared_log_error" title="sklearn.metrics.mean_squared_log_error"><code>sklearn.metrics.mean_squared_log_error</code></a></li> <li><a class="reference internal" href="generated/sklearn.metrics.mean_tweedie_deviance.html#sklearn.metrics.mean_tweedie_deviance" title="sklearn.metrics.mean_tweedie_deviance"><code>sklearn.metrics.mean_tweedie_deviance</code></a></li> <li><a class="reference internal" href="generated/sklearn.metrics.multilabel_confusion_matrix.html#sklearn.metrics.multilabel_confusion_matrix" title="sklearn.metrics.multilabel_confusion_matrix"><code>sklearn.metrics.multilabel_confusion_matrix</code></a></li> <li><a class="reference internal" href="generated/sklearn.metrics.pairwise.additive_chi2_kernel.html#sklearn.metrics.pairwise.additive_chi2_kernel" title="sklearn.metrics.pairwise.additive_chi2_kernel"><code>sklearn.metrics.pairwise.additive_chi2_kernel</code></a></li> <li><a class="reference internal" href="generated/sklearn.metrics.pairwise.chi2_kernel.html#sklearn.metrics.pairwise.chi2_kernel" title="sklearn.metrics.pairwise.chi2_kernel"><code>sklearn.metrics.pairwise.chi2_kernel</code></a></li> <li><a class="reference internal" href="generated/sklearn.metrics.pairwise.cosine_similarity.html#sklearn.metrics.pairwise.cosine_similarity" title="sklearn.metrics.pairwise.cosine_similarity"><code>sklearn.metrics.pairwise.cosine_similarity</code></a></li> <li><a class="reference internal" href="generated/sklearn.metrics.pairwise.cosine_distances.html#sklearn.metrics.pairwise.cosine_distances" title="sklearn.metrics.pairwise.cosine_distances"><code>sklearn.metrics.pairwise.cosine_distances</code></a></li> <li>
<a class="reference internal" href="generated/sklearn.metrics.pairwise.euclidean_distances.html#sklearn.metrics.pairwise.euclidean_distances" title="sklearn.metrics.pairwise.euclidean_distances"><code>sklearn.metrics.pairwise.euclidean_distances</code></a> (see <a class="reference internal" href="#device-support-for-float64"><span class="std std-ref">Note on device support for float64</span></a>)</li> <li><a class="reference internal" href="generated/sklearn.metrics.pairwise.linear_kernel.html#sklearn.metrics.pairwise.linear_kernel" title="sklearn.metrics.pairwise.linear_kernel"><code>sklearn.metrics.pairwise.linear_kernel</code></a></li> <li><a class="reference internal" href="generated/sklearn.metrics.pairwise.paired_cosine_distances.html#sklearn.metrics.pairwise.paired_cosine_distances" title="sklearn.metrics.pairwise.paired_cosine_distances"><code>sklearn.metrics.pairwise.paired_cosine_distances</code></a></li> <li><a class="reference internal" href="generated/sklearn.metrics.pairwise.paired_euclidean_distances.html#sklearn.metrics.pairwise.paired_euclidean_distances" title="sklearn.metrics.pairwise.paired_euclidean_distances"><code>sklearn.metrics.pairwise.paired_euclidean_distances</code></a></li> <li><a class="reference internal" href="generated/sklearn.metrics.pairwise.polynomial_kernel.html#sklearn.metrics.pairwise.polynomial_kernel" title="sklearn.metrics.pairwise.polynomial_kernel"><code>sklearn.metrics.pairwise.polynomial_kernel</code></a></li> <li>
<a class="reference internal" href="generated/sklearn.metrics.pairwise.rbf_kernel.html#sklearn.metrics.pairwise.rbf_kernel" title="sklearn.metrics.pairwise.rbf_kernel"><code>sklearn.metrics.pairwise.rbf_kernel</code></a> (see <a class="reference internal" href="#device-support-for-float64"><span class="std std-ref">Note on device support for float64</span></a>)</li> <li><a class="reference internal" href="generated/sklearn.metrics.pairwise.sigmoid_kernel.html#sklearn.metrics.pairwise.sigmoid_kernel" title="sklearn.metrics.pairwise.sigmoid_kernel"><code>sklearn.metrics.pairwise.sigmoid_kernel</code></a></li> <li><a class="reference internal" href="generated/sklearn.metrics.precision_recall_fscore_support.html#sklearn.metrics.precision_recall_fscore_support" title="sklearn.metrics.precision_recall_fscore_support"><code>sklearn.metrics.precision_recall_fscore_support</code></a></li> <li><a class="reference internal" href="generated/sklearn.metrics.r2_score.html#sklearn.metrics.r2_score" title="sklearn.metrics.r2_score"><code>sklearn.metrics.r2_score</code></a></li> <li><a class="reference internal" href="generated/sklearn.metrics.root_mean_squared_error.html#sklearn.metrics.root_mean_squared_error" title="sklearn.metrics.root_mean_squared_error"><code>sklearn.metrics.root_mean_squared_error</code></a></li> <li><a class="reference internal" href="generated/sklearn.metrics.root_mean_squared_log_error.html#sklearn.metrics.root_mean_squared_log_error" title="sklearn.metrics.root_mean_squared_log_error"><code>sklearn.metrics.root_mean_squared_log_error</code></a></li> <li><a class="reference internal" href="generated/sklearn.metrics.zero_one_loss.html#sklearn.metrics.zero_one_loss" title="sklearn.metrics.zero_one_loss"><code>sklearn.metrics.zero_one_loss</code></a></li> </ul> </section> <section id="tools"> <h3>
<span class="section-number">11.1.2.4. </span>Tools</h3> <ul class="simple"> <li><a class="reference internal" href="generated/sklearn.model_selection.train_test_split.html#sklearn.model_selection.train_test_split" title="sklearn.model_selection.train_test_split"><code>model_selection.train_test_split</code></a></li> </ul> <p>Coverage is expected to grow over time. Please follow the dedicated <a class="reference external" href="https://github.com/scikit-learn/scikit-learn/issues/22352">meta-issue on GitHub</a> to track progress.</p> </section> <section id="type-of-return-values-and-fitted-attributes"> <h3>
<span class="section-number">11.1.2.5. </span>Type of return values and fitted attributes</h3> <p>When calling functions or methods with Array API compatible inputs, the convention is to return array values of the same array container type and device as the input data.</p> <p>Similarly, when an estimator is fitted with Array API compatible inputs, the fitted attributes will be arrays from the same library as the input and stored on the same device. The <code>predict</code> and <code>transform</code> method subsequently expect inputs from the same array library and device as the data passed to the <code>fit</code> method.</p> <p>Note however that scoring functions that return scalar values return Python scalars (typically a <code>float</code> instance) instead of an array scalar value.</p> </section> </section> <section id="common-estimator-checks"> <h2>
<span class="section-number">11.1.3. </span>Common estimator checks</h2> <p>Add the <code>array_api_support</code> tag to an estimator’s set of tags to indicate that it supports the Array API. This will enable dedicated checks as part of the common tests to verify that the estimators result’s are the same when using vanilla NumPy and Array API inputs.</p> <p>To run these checks you need to install <a class="reference external" href="https://github.com/data-apis/array-api-compat">array_api_compat</a> in your test environment. To run the full set of checks you need to install both <a class="reference external" href="https://pytorch.org/">PyTorch</a> and <a class="reference external" href="https://cupy.dev/">CuPy</a> and have a GPU. Checks that can not be executed or have missing dependencies will be automatically skipped. Therefore it’s important to run the tests with the <code>-v</code> flag to see which checks are skipped:</p> <pre data-language="python">pip install array-api-compat  # and other libraries as needed
pytest -k "array_api" -v
</pre>
<section id="note-on-mps-device-support"> <h3 id="mps-support">
<span class="section-number">11.1.3.1. </span>Note on MPS device support</h3> <p>On macOS, PyTorch can use the Metal Performance Shaders (MPS) to access hardware accelerators (e.g. the internal GPU component of the M1 or M2 chips). However, the MPS device support for PyTorch is incomplete at the time of writing. See the following github issue for more details:</p> <ul class="simple"> <li><a class="github reference external" href="https://github.com/pytorch/pytorch/issues/77764">pytorch/pytorch#77764</a></li> </ul> <p>To enable the MPS support in PyTorch, set the environment variable <code>PYTORCH_ENABLE_MPS_FALLBACK=1</code> before running the tests:</p> <pre data-language="python">PYTORCH_ENABLE_MPS_FALLBACK=1 pytest -k "array_api" -v
</pre>
<p>At the time of writing all scikit-learn tests should pass, however, the computational speed is not necessarily better than with the CPU device.</p> </section> <section id="note-on-device-support-for-float64"> <h3 id="device-support-for-float64">
<span class="section-number">11.1.3.2. </span>Note on device support for <code>float64</code>
</h3> <p>Certain operations within scikit-learn will automatically perform operations on floating-point values with <code>float64</code> precision to prevent overflows and ensure correctness (e.g., <a class="reference internal" href="generated/sklearn.metrics.pairwise.euclidean_distances.html#sklearn.metrics.pairwise.euclidean_distances" title="sklearn.metrics.pairwise.euclidean_distances"><code>metrics.pairwise.euclidean_distances</code></a>). However, certain combinations of array namespaces and devices, such as <code>PyTorch on MPS</code> (see <a class="reference internal" href="#mps-support"><span class="std std-ref">Note on MPS device support</span></a>) do not support the <code>float64</code> data type. In these cases, scikit-learn will revert to using the <code>float32</code> data type instead. This can result in different behavior (typically numerically unstable results) compared to not using array API dispatching or using a device with <code>float64</code> support.</p> </section> </section> </section><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2007&ndash;2025 The scikit-learn developers<br>Licensed under the 3-clause BSD License.<br>
    <a href="https://scikit-learn.org/1.6/modules/array_api.html" class="_attribution-link">https://scikit-learn.org/1.6/modules/array_api.html</a>
  </p>
</div>
