<h1 id="image-renditions">Generating renditions in Python</h1> <p>Rendered versions of original images generated by the Wagtail <code>{% image %}</code> template tag are called “renditions”, and are stored as new image files in the site’s <code>[media]/images</code> directory on the first invocation.</p> <p>Image renditions can also be generated dynamically from Python via the native <code>get_rendition()</code> method, for example:</p> <pre data-language="python">newimage = myimage.get_rendition('fill-300x150|jpegquality-60')
</pre> <p>If <code>myimage</code> had a filename of <code>foo.jpg</code>, a new rendition of the image file called <code>foo.fill-300x150.jpegquality-60.jpg</code> would be generated and saved into the site’s <code>[media]/images</code> directory. Argument options are identical to the <code>{% image %}</code> template tag’s filter spec, and should be separated with <code>|</code>.</p> <p>The generated <code>Rendition</code> object will have properties specific to that version of the image, such as <code>url</code>, <code>width</code> and <code>height</code>, so something like this could be used in an API generator, for example:</p> <pre data-language="python">url = myimage.get_rendition('fill-300x186|jpegquality-60').url
</pre> <p>Properties belonging to the original image from which the generated Rendition was created, such as <code>title</code>, can be accessed through the Rendition’s <code>image</code> property:</p> <pre data-language="python">    &gt;&gt;&gt; newimage.image.title
    'Blue Sky'
    &gt;&gt;&gt; newimage.image.is_landscape()
    True
</pre> <p>See also: <a class="reference internal" href="../../topics/images.html#image-tag"><span class="std std-ref">How to use images in templates</span></a></p> <section id="prefetching-image-renditions"> <h2 id="id1">Prefetching image renditions</h2> <p>When using a queryset to render a list of images or objects with images, you can prefetch the renditions needed with a single additional query. For long lists of items, or where multiple renditions are used for each item, this can provide a significant boost to performance.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 4.0: </span>The <code>prefetch_renditions</code> method is only applicable in Wagtail versions 4.0 and above.</p> </div> <section id="image-querysets"> <h3>Image QuerySets</h3> <p>When working with an Image QuerySet, you can make use of Wagtail’s built-in <code>prefetch_renditions</code> queryset method to prefetch the renditions needed.</p> <p>For example, say you were rendering a list of all the images uploaded by a certain user:</p> <pre data-language="python">def get_images_uploaded_by_user(user):
    return ImageModel.objects.filter(uploaded_by_user=user)
</pre> <p>The above can be modified slightly to prefetch the renditions of the images returned:</p> <pre data-language="python">def get_images_uploaded_by_user(user)::
    return ImageModel.objects.filter(uploaded_by_user=user).prefetch_renditions()
</pre> <p>The above will prefetch all renditions even if we may not need them.</p> <p>If images in your project tend to have very large numbers of renditions, and you know in advance the ones you need, you might want to consider specifying a set of filters to the <code>prefetch_renditions</code> method and only select the renditions you need for rendering. For example:</p> <pre data-language="python">def get_images_uploaded_by_user(user):
    # Only specify the renditions required for rendering
    return ImageModel.objects.filter(uploaded_by_user=user).prefetch_renditions(
        "fill-700x586", "min-600x400", "max-940x680"
    )
</pre> </section> <section id="non-image-querysets"> <h3>Non Image Querysets</h3> <p>If you’re working with a non Image Model, you can make use of Django’s built-in <code>prefetch_related()</code> queryset method to prefetch renditions.</p> <p>For example, say you were rendering a list of events (with thumbnail images for each). Your code might look something like this:</p> <pre data-language="python">def get_events():
    return EventPage.objects.live().select_related("listing_image")
</pre> <p>The above can be modified slightly to prefetch the renditions for listing images:</p> <pre data-language="python">def get_events():
    return EventPage.objects.live().select_related("listing_image").prefetch_related("listing_image__renditions")
</pre> <p>If you know in advance the renditions you’ll need, you can filter the renditions queryset to use:</p> <pre data-language="python">from django.db.models import Prefetch
from wagtail.images import get_image_model


def get_events():
    Image = get_image_model()
    filters = ["fill-300x186", "fill-600x400", "fill-940x680"]

    # `Prefetch` is used to fetch only the required renditions
    prefetch_images_and_renditions = Prefetch(
        "listing_image",
        queryset=Image.objects.prefetch_renditions(*filters)
    )
    return EventPage.objects.live().prefetch_related(prefetch_images_and_renditions)
</pre> </section> </section> <section id="model-methods-involved-in-rendition-generation"> <h2 id="image-rendition-methods">Model methods involved in rendition generation</h2> <div class="versionadded"> <p><span class="versionmodified added">New in version 3.0: </span>The following method references are only applicable to Wagtail versions 3.0 and above.</p> </div> <p>The following <code>AbstractImage</code> model methods are involved in finding and generating a renditions. If using a custom image model, you can customise the behaviour of either of these methods by overriding them on your model:</p>  </section><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2014-present Torchbox Ltd and individual contributors.<br>All rights are reserved.<br>Licensed under the BSD License.<br>
    <a href="https://docs.wagtail.org/en/stable/advanced_topics/images/renditions.html" class="_attribution-link">https://docs.wagtail.org/en/stable/advanced_topics/images/renditions.html</a>
  </p>
</div>
