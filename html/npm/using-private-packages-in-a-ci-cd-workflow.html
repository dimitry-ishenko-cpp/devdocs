<div class="Box-sc-g0xbh4-0 goytIH"><h1 class="components__StyledHeading-sc-13rww2g-0 components__h1-sc-13rww2g-1 cZjJlu jMmFmb components__StyledHeading-sc-13rww2g-0 cZjJlu">Using private packages in a CI/CD workflow</h1></div>


<p class="components__Paragraph-sc-13rww2g-11 cevAMF">You can use access tokens to test private npm packages with continuous integration (CI) systems, or deploy them using continuous deployment (CD) systems.</p> <h2 id="create-a-new-access-token" class="components__StyledHeading-sc-13rww2g-0 components__h2-sc-13rww2g-2 cZjJlu cYFMoP components__StyledHeading-sc-13rww2g-0 cZjJlu"><a href="#create-a-new-access-token" aria-label="Create a new access token permalink" class="Link__StyledLink-sc-14289xe-0 hysCUZ">Create a new access token</a></h2> <p class="components__Paragraph-sc-13rww2g-11 cevAMF">Create a new access token that will be used only to access npm packages from a CI/CD server.</p> <h3 id="continuous-integration" class="components__StyledHeading-sc-13rww2g-0 components__h3-sc-13rww2g-3 cZjJlu Nafes components__StyledHeading-sc-13rww2g-0 cZjJlu"><a href="#continuous-integration" aria-label="Continuous integration permalink" class="Link__StyledLink-sc-14289xe-0 hysCUZ">Continuous integration</a></h3> <p class="components__Paragraph-sc-13rww2g-11 cevAMF">When generating an access token for use in a continuous integration environment, we recommend using a granular access token with limited access to provide greater security.</p> <p class="components__Paragraph-sc-13rww2g-11 cevAMF">If you use a legacy token instead, by default, <code class="code__InlineCode-sc-izuaam-0 lnAgdq">npm token create</code> will generate a token with both read and write permissions. We recommend creating a read-only token:</p> <code class="code__InlineCode-sc-izuaam-0 lnAgdq">npm token create --read-only</code> <p class="components__Paragraph-sc-13rww2g-11 cevAMF">For more information on creating access tokens, including CIDR-whitelisted tokens, see "<a class="Link__StyledLink-sc-14289xe-0 kIxRcv" href="creating-and-viewing-access-tokens.html">Creating an access token</a>".</p> <h3 id="continuous-deployment" class="components__StyledHeading-sc-13rww2g-0 components__h3-sc-13rww2g-3 cZjJlu Nafes components__StyledHeading-sc-13rww2g-0 cZjJlu"><a href="#continuous-deployment" aria-label="Continuous deployment permalink" class="Link__StyledLink-sc-14289xe-0 hysCUZ">Continuous deployment</a></h3> <p class="components__Paragraph-sc-13rww2g-11 cevAMF">Since continuous deployment environments usually involve the creation of a deploy artifact, you may wish to create an <a class="Link__StyledLink-sc-14289xe-0 kIxRcv" href="creating-and-viewing-access-tokens.html">automation token</a> on the website. This will allow you to publish even if you have two-factor authentication enabled on your account.</p> <h3 id="interactive-workflows" class="components__StyledHeading-sc-13rww2g-0 components__h3-sc-13rww2g-3 cZjJlu Nafes components__StyledHeading-sc-13rww2g-0 cZjJlu"><a href="#interactive-workflows" aria-label="Interactive workflows permalink" class="Link__StyledLink-sc-14289xe-0 hysCUZ">Interactive workflows</a></h3> <p class="components__Paragraph-sc-13rww2g-11 cevAMF">If your workflow produces a package, but you publish it manually after validation, then you will want to create a token with read and write permissions, which are granted with the standard token creation command:</p> <code class="code__InlineCode-sc-izuaam-0 lnAgdq">npm token create</code> <h3 id="cidr-whitelists" class="components__StyledHeading-sc-13rww2g-0 components__h3-sc-13rww2g-3 cZjJlu Nafes components__StyledHeading-sc-13rww2g-0 cZjJlu"><a href="#cidr-whitelists" aria-label="CIDR whitelists permalink" class="Link__StyledLink-sc-14289xe-0 hysCUZ">CIDR whitelists</a></h3> <p class="components__Paragraph-sc-13rww2g-11 cevAMF">For increased security, you may use a CIDR-whitelisted token that can only be used from a certain IP address range. You can use a CIDR whitelist with a read and publish token or a read-only token:</p> <div class="Box-sc-g0xbh4-0 eUKtPS"><div style="color:#393A34;background-color:#f6f8fa" class="Box-sc-g0xbh4-0 bdVWRk">
<div class="Box-sc-g0xbh4-0 kFQlqn"><pre class="Box-sc-g0xbh4-0 bfdbXb prism-code language-bash" tabindex="0" data-language="javascript">npm token create --cidr=[list]
npm token create --read-only --cidr=[list]</pre></div>
</div></div> <p class="components__Paragraph-sc-13rww2g-11 cevAMF">Example:</p> <code class="code__InlineCode-sc-izuaam-0 lnAgdq">npm token create --cidr=192.0.2.0/24</code> <p class="components__Paragraph-sc-13rww2g-11 cevAMF">For more information, see "<a class="Link__StyledLink-sc-14289xe-0 kIxRcv" href="creating-and-viewing-access-tokens.html">Creating and viewing authentication tokens</a>".</p> <h2 id="set-the-token-as-an-environment-variable-on-the-cicd-server" class="components__StyledHeading-sc-13rww2g-0 components__h2-sc-13rww2g-2 cZjJlu cYFMoP components__StyledHeading-sc-13rww2g-0 cZjJlu"><a href="#set-the-token-as-an-environment-variable-on-the-cicd-server" aria-label="Set the token as an environment variable on the CI/CD server permalink" class="Link__StyledLink-sc-14289xe-0 hysCUZ">Set the token as an environment variable on the CI/CD server</a></h2> <p class="components__Paragraph-sc-13rww2g-11 cevAMF">Set your token as an environment variable, or a secret, in your CI/CD server.</p> <p class="components__Paragraph-sc-13rww2g-11 cevAMF">For example, in GitHub Actions, you would <a href="https://docs.github.com/en/actions/configuring-and-managing-workflows/creating-and-storing-encrypted-secrets" class="Link__StyledLink-sc-14289xe-0 kIxRcv">add your token as a secret</a>. Then you can make the secret available to workflows.</p> <p class="components__Paragraph-sc-13rww2g-11 cevAMF">If you named the secret <code class="code__InlineCode-sc-izuaam-0 lnAgdq">NPM_TOKEN</code>, then you would want to create an environment variable named <code class="code__InlineCode-sc-izuaam-0 lnAgdq">NPM_TOKEN</code> from that secret.</p> <div class="Box-sc-g0xbh4-0 eUKtPS"><div style="color:#393A34;background-color:#f6f8fa" class="Box-sc-g0xbh4-0 bdVWRk">
<div class="Box-sc-g0xbh4-0 kFQlqn"><pre class="Box-sc-g0xbh4-0 bfdbXb prism-code language-bash" tabindex="0" data-language="javascript">steps:
  - run: |
      npm install
  - env:
      NPM_TOKEN: ${{ secrets.NPM_TOKEN }}</pre></div>
</div></div> <p class="components__Paragraph-sc-13rww2g-11 cevAMF">Consult your CI/CD server's documentation for more details.</p> <h2 id="create-and-check-in-a-project-specific-npmrc-file" class="components__StyledHeading-sc-13rww2g-0 components__h2-sc-13rww2g-2 cZjJlu cYFMoP components__StyledHeading-sc-13rww2g-0 cZjJlu"><a href="#create-and-check-in-a-project-specific-npmrc-file" aria-label="Create and check in a project-specific .npmrc file permalink" class="Link__StyledLink-sc-14289xe-0 hysCUZ">Create and check in a project-specific .npmrc file</a></h2> <p class="components__Paragraph-sc-13rww2g-11 cevAMF">Use a project-specific <code class="code__InlineCode-sc-izuaam-0 lnAgdq">.npmrc</code> file with a variable for your token to securely authenticate your CI/CD server with npm.</p> <ol class="components__UnorderedList-sc-13rww2g-10-ol cjGnIx"> <li> <p class="components__Paragraph-sc-13rww2g-11 cevAMF">In the root directory of your project, create a custom <code class="code__InlineCode-sc-izuaam-0 lnAgdq">.npmrc</code> file with the following contents:</p> <code class="code__InlineCode-sc-izuaam-0 lnAgdq">//registry.npmjs.org/:_authToken=${NPM_TOKEN}</code> <p class="components__Paragraph-sc-13rww2g-11 cevAMF"><strong>Note:</strong> that you are specifying a literal value of <code class="code__InlineCode-sc-izuaam-0 lnAgdq">${NPM_TOKEN}</code>. The npm cli will replace this value with the contents of the <code class="code__InlineCode-sc-izuaam-0 lnAgdq">NPM_TOKEN</code> environment variable. Do <strong>not</strong> put a token in this file.</p> </li> <li> <p class="components__Paragraph-sc-13rww2g-11 cevAMF">Check in the <code class="code__InlineCode-sc-izuaam-0 lnAgdq">.npmrc</code> file.</p> </li> </ol> <h2 id="securing-your-token" class="components__StyledHeading-sc-13rww2g-0 components__h2-sc-13rww2g-2 cZjJlu cYFMoP components__StyledHeading-sc-13rww2g-0 cZjJlu"><a href="#securing-your-token" aria-label="Securing your token permalink" class="Link__StyledLink-sc-14289xe-0 hysCUZ">Securing your token</a></h2> <p class="components__Paragraph-sc-13rww2g-11 cevAMF">Your token may have permission to read private packages, publish new packages on your behalf, or change user or package settings. Protect your token.</p> <p class="components__Paragraph-sc-13rww2g-11 cevAMF">Do not add your token to version control or store it insecurely. Store it in a password manager, your cloud provider's secure storage, or your CI/CD provider's secure storage.</p> <p class="components__Paragraph-sc-13rww2g-11 cevAMF">When possible, use granular access tokens with the minimum permissions necessary, and set short expiration dates for your tokens. For more information, see "<a class="Link__StyledLink-sc-14289xe-0 kIxRcv" href="about-access-tokens.html">About access tokens</a>."</p><div class="_attribution">
  <p class="_attribution-p">
    &copy; npm, Inc. and Contributors<br>Licensed under the npm License.<br>npm is a trademark of npm, Inc.<br>
    <a href="https://docs.npmjs.com/using-private-packages-in-a-ci-cd-workflow" class="_attribution-link">https://docs.npmjs.com/using-private-packages-in-a-ci-cd-workflow</a>
  </p>
</div>
