<div class="Box-sc-g0xbh4-0 goytIH"><h1 class="components__StyledHeading-sc-13rww2g-0 components__h1-sc-13rww2g-1 cZjJlu jMmFmb components__StyledHeading-sc-13rww2g-0 cZjJlu">Generating provenance statements</h1></div>


<p class="components__Paragraph-sc-13rww2g-11 cevAMF">You can generate provenance statements for the packages you publish. This allows you to publicly establish where a package was built and who published a package, which can increase supply-chain security for your packages.</p> <h2 id="about-npm-provenance" class="components__StyledHeading-sc-13rww2g-0 components__h2-sc-13rww2g-2 cZjJlu cYFMoP components__StyledHeading-sc-13rww2g-0 cZjJlu"><a href="#about-npm-provenance" aria-label="About npm provenance permalink" class="Link__StyledLink-sc-14289xe-0 hysCUZ">About npm provenance</a></h2> <p class="components__Paragraph-sc-13rww2g-11 cevAMF">npm provenance includes two types of attestations:</p> <ul class="components__UnorderedList-sc-13rww2g-10 fqlkab"> <li>Provenance attestation</li> <li>Publish attestation</li> </ul> <p class="components__Paragraph-sc-13rww2g-11 cevAMF">The provenance attestation is established by publicly providing a link to a package's source code and build instructions from the build environment. This allows developers to verify where and how your package was built before they download it.</p> <p class="components__Paragraph-sc-13rww2g-11 cevAMF">Publish attestations are generated by the registry when a package is published by an authorized user. When an npm package is published with provenance, it is signed by Sigstore public good servers and logged in a public transparency ledger, where users can view this information.</p> <h3 id="about-sigstore" class="components__StyledHeading-sc-13rww2g-0 components__h3-sc-13rww2g-3 cZjJlu Nafes components__StyledHeading-sc-13rww2g-0 cZjJlu"><a href="#about-sigstore" aria-label="About Sigstore permalink" class="Link__StyledLink-sc-14289xe-0 hysCUZ">About Sigstore</a></h3> <p class="components__Paragraph-sc-13rww2g-11 cevAMF">Sigstore is a collection of tools and services aimed at making it easy to use short-lived, ephemeral certificates to sign software. Its three main components are a CLI tool, a certificate authority, and a time-stamping transparency log.</p> <p class="components__Paragraph-sc-13rww2g-11 cevAMF">The certificate authority federates with any OIDC provider that includes verifiable build information. It acts as an intermediary between build systems and package registries by verifying the integrity of the OIDC token, issues a signing certificate that contains that build information, and then logging the signing certificate to an immutable ledger.</p> <p class="components__Paragraph-sc-13rww2g-11 cevAMF">The transparency log service provides a public, verifiable, tamper-evident ledger of signed attestations. This ensures transparency of the public service, as well as providing a way to detect attempts to tamper with a package if a package registry were to be compromised.</p> <h2 id="provenance-limitations" class="components__StyledHeading-sc-13rww2g-0 components__h2-sc-13rww2g-2 cZjJlu cYFMoP components__StyledHeading-sc-13rww2g-0 cZjJlu"><a href="#provenance-limitations" aria-label="Provenance limitations permalink" class="Link__StyledLink-sc-14289xe-0 hysCUZ">Provenance limitations</a></h2> <ul class="components__UnorderedList-sc-13rww2g-10 fqlkab"> <li>To publish a package with provenance, you must build your package with a supported cloud CI/CD provider using a cloud-hosted runner. Today this includes GitHub Actions and GitLab CI/CD.</li> <li>When a package in the npm registry has established provenance, it does not guarantee the package has no malicious code. Instead, npm provenance provides a verifiable link to the package's source code and build instructions, which developers can then audit and determine whether to trust it or not. For more information, see "<a class="Link__StyledLink-sc-14289xe-0 kIxRcv" href="searching-for-and-choosing-packages-to-download.html#package-provenance">Searching for and choosing packages to download</a>."</li> </ul> <h2 id="prerequisites" class="components__StyledHeading-sc-13rww2g-0 components__h2-sc-13rww2g-2 cZjJlu cYFMoP components__StyledHeading-sc-13rww2g-0 cZjJlu"><a href="#prerequisites" aria-label="Prerequisites permalink" class="Link__StyledLink-sc-14289xe-0 hysCUZ">Prerequisites</a></h2> <p class="components__Paragraph-sc-13rww2g-11 cevAMF">Before you can publish your packages with provenance, you must:</p> <ul class="components__UnorderedList-sc-13rww2g-10 fqlkab"> <li> <p class="components__Paragraph-sc-13rww2g-11 cevAMF">Review the <a href="https://lfprojects.org/policies/hosted-project-tools-immutable-records/" class="Link__StyledLink-sc-14289xe-0 kIxRcv">Linux Foundation Immutable Record notice</a>, which applies to the public transparency log.</p> </li> <li> <p class="components__Paragraph-sc-13rww2g-11 cevAMF">Install the latest version of the npm CLI (ensure you are on <code class="code__InlineCode-sc-izuaam-0 lnAgdq">9.5.0+</code> as older versions don't support npm provenance). For more information, see "<a class="Link__StyledLink-sc-14289xe-0 kIxRcv" href="try-the-latest-stable-version-of-npm.html">Try the latest stable version of npm</a>."</p> </li> <li> <p class="components__Paragraph-sc-13rww2g-11 cevAMF">Ensure your <code class="code__InlineCode-sc-izuaam-0 lnAgdq">package.json</code> is configured with a public <code class="code__InlineCode-sc-izuaam-0 lnAgdq">repository</code> that matches where you are publishing with provenance from.</p> </li> <li> <p class="components__Paragraph-sc-13rww2g-11 cevAMF">Set up automation with a supported CI/CD provider to publish your packages to the npm registry. The following providers are supported:</p> <ul class="components__UnorderedList-sc-13rww2g-10 fqlkab"> <li>GitHub Actions. For more information, see "<a href="#publishing-packages-with-provenance-via-github-actions" class="Link__StyledLink-sc-14289xe-0 kIxRcv">Publishing packages with provenance via GitHub Actions</a>."</li> <li>GitLab CI/CD. For more information, see "<a href="#publishing-packages-with-provenance-via-gitlab-cicd" class="Link__StyledLink-sc-14289xe-0 kIxRcv">Publishing packages with provenance via GitLab CI/CD</a>."</li> </ul> </li> </ul> <h2 id="publishing-packages-with-provenance-via-github-actions" class="components__StyledHeading-sc-13rww2g-0 components__h2-sc-13rww2g-2 cZjJlu cYFMoP components__StyledHeading-sc-13rww2g-0 cZjJlu"><a href="#publishing-packages-with-provenance-via-github-actions" aria-label="Publishing packages with provenance via GitHub Actions permalink" class="Link__StyledLink-sc-14289xe-0 hysCUZ">Publishing packages with provenance via GitHub Actions</a></h2> <p class="components__Paragraph-sc-13rww2g-11 cevAMF">In order to establish provenance, you must use a supported cloud CI/CD provider and a cloud-hosted runner to publish your packages. GitHub Actions is a supported CI/CD platform that allows you to automate software development tasks. For more information, see <a href="https://docs.github.com/en/actions" class="Link__StyledLink-sc-14289xe-0 kIxRcv">GitHub Actions</a> in the GitHub documentation.</p> <p class="components__Paragraph-sc-13rww2g-11 cevAMF">To update your GitHub Actions workflow to publish your packages with provenance, you must:</p> <ul class="components__UnorderedList-sc-13rww2g-10 fqlkab"> <li> <p class="components__Paragraph-sc-13rww2g-11 cevAMF">Give permission to mint an ID-token:</p> <div class="Box-sc-g0xbh4-0 eUKtPS"><div style="color:#393A34;background-color:#f6f8fa" class="Box-sc-g0xbh4-0 bdVWRk">
<div class="Box-sc-g0xbh4-0 kFQlqn"><pre class="Box-sc-g0xbh4-0 bfdbXb prism-code language-yaml" tabindex="0" data-language="javascript">permissions:
  id-token: write</pre></div>
</div></div> </li> <li> <p class="components__Paragraph-sc-13rww2g-11 cevAMF">Run on a <a href="https://docs.github.com/en/actions/using-github-hosted-runners/about-github-hosted-runners#supported-runners-and-hardware-resources" class="Link__StyledLink-sc-14289xe-0 kIxRcv">GitHub-hosted runner</a>:</p> <div class="Box-sc-g0xbh4-0 eUKtPS"><div style="color:#393A34;background-color:#f6f8fa" class="Box-sc-g0xbh4-0 bdVWRk">
<div class="Box-sc-g0xbh4-0 kFQlqn"><pre class="Box-sc-g0xbh4-0 bfdbXb prism-code language-yaml" tabindex="0" data-language="javascript">runs-on: ubuntu-latest</pre></div>
</div></div> </li> <li> <p class="components__Paragraph-sc-13rww2g-11 cevAMF">Add the <code class="code__InlineCode-sc-izuaam-0 lnAgdq">--provenance</code> flag to your publish command:</p> <div class="Box-sc-g0xbh4-0 eUKtPS"><div style="color:#393A34;background-color:#f6f8fa" class="Box-sc-g0xbh4-0 bdVWRk">
<div class="Box-sc-g0xbh4-0 kFQlqn"><pre class="Box-sc-g0xbh4-0 bfdbXb prism-code language-sh" tabindex="0" data-language="javascript">npm publish --provenance</pre></div>
</div></div> </li> <li> <p class="components__Paragraph-sc-13rww2g-11 cevAMF">If you are publishing a package for the first time you will also need to explicitly set access to public:</p> <div class="Box-sc-g0xbh4-0 eUKtPS"><div style="color:#393A34;background-color:#f6f8fa" class="Box-sc-g0xbh4-0 bdVWRk">
<div class="Box-sc-g0xbh4-0 kFQlqn"><pre class="Box-sc-g0xbh4-0 bfdbXb prism-code language-sh" tabindex="0" data-language="javascript">npm publish --provenance --access public</pre></div>
</div></div> </li> </ul> <h3 id="example-github-actions-workflow" class="components__StyledHeading-sc-13rww2g-0 components__h3-sc-13rww2g-3 cZjJlu Nafes components__StyledHeading-sc-13rww2g-0 cZjJlu"><a href="#example-github-actions-workflow" aria-label="Example GitHub Actions workflow permalink" class="Link__StyledLink-sc-14289xe-0 hysCUZ">Example GitHub Actions workflow</a></h3> <p class="components__Paragraph-sc-13rww2g-11 cevAMF">This example workflow publishes a package to the npm registry with provenance.</p> <div class="Box-sc-g0xbh4-0 eUKtPS"><div style="color:#393A34;background-color:#f6f8fa" class="Box-sc-g0xbh4-0 bdVWRk">
<div class="Box-sc-g0xbh4-0 kFQlqn"><pre class="Box-sc-g0xbh4-0 bfdbXb prism-code language-yaml" tabindex="0" data-language="javascript">name: Publish Package to npmjs
on:
  release:
    types: [created]
jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      id-token: write
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '18.x'
          registry-url: 'https://registry.npmjs.org'
      - run: npm install -g npm
      - run: npm ci
      - run: npm publish --provenance --access public
        env:
          NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }}</pre></div>
</div></div> <h3 id="example-gitlab-ci-job" class="components__StyledHeading-sc-13rww2g-0 components__h3-sc-13rww2g-3 cZjJlu Nafes components__StyledHeading-sc-13rww2g-0 cZjJlu"><a href="#example-gitlab-ci-job" aria-label="Example GitLab CI job permalink" class="Link__StyledLink-sc-14289xe-0 hysCUZ">Example GitLab CI job</a></h3> <p class="components__Paragraph-sc-13rww2g-11 cevAMF">This example job publishes a package to the npm registry with provenance when a git tag is pushed. Don’t forget to define the <code class="code__InlineCode-sc-izuaam-0 lnAgdq">NPM_TOKEN</code> variable in your GitLab project settings.</p> <div class="Box-sc-g0xbh4-0 eUKtPS"><div style="color:#393A34;background-color:#f6f8fa" class="Box-sc-g0xbh4-0 bdVWRk">
<div class="Box-sc-g0xbh4-0 kFQlqn"><pre class="Box-sc-g0xbh4-0 bfdbXb prism-code language-yaml" tabindex="0" data-language="javascript">publish:
  image: 'node:20'
  rules:
    - if: $CI_COMMIT_TAG
  id_tokens:
    SIGSTORE_ID_TOKEN:
      aud: sigstore
  script:
    - npm config set //registry.npmjs.org/:_authToken "$NPM_TOKEN"
    - npm publish --provenance --access public</pre></div>
</div></div> <h3 id="using-third-party-package-publishing-tools" class="components__StyledHeading-sc-13rww2g-0 components__h3-sc-13rww2g-3 cZjJlu Nafes components__StyledHeading-sc-13rww2g-0 cZjJlu"><a href="#using-third-party-package-publishing-tools" aria-label="Using third-party package publishing tools permalink" class="Link__StyledLink-sc-14289xe-0 hysCUZ">Using third-party package publishing tools</a></h3> <p class="components__Paragraph-sc-13rww2g-11 cevAMF">If you publish your packages with tools that do not directly invoke the <code class="code__InlineCode-sc-izuaam-0 lnAgdq">npm publish</code> command, you can do one of the following in your GitHub Actions workflow to publish your packages with provenance.</p> <ul class="components__UnorderedList-sc-13rww2g-10 fqlkab"> <li>
<strong>Configure environment variables:</strong> In your GitHub Actions workflow, you can use an environment variable called <code class="code__InlineCode-sc-izuaam-0 lnAgdq">NPM_CONFIG_PROVENANCE</code>, and set it to <code class="code__InlineCode-sc-izuaam-0 lnAgdq">true</code>.</li> <li>
<strong>Configure your <code class="code__InlineCode-sc-izuaam-0 lnAgdq">package.json</code> file:</strong> You can add a <code class="code__InlineCode-sc-izuaam-0 lnAgdq">publishConfig</code> block to your <code class="code__InlineCode-sc-izuaam-0 lnAgdq">package.json</code> file: <div class="Box-sc-g0xbh4-0 eUKtPS"><div style="color:#393A34;background-color:#f6f8fa" class="Box-sc-g0xbh4-0 bdVWRk">
<div class="Box-sc-g0xbh4-0 kFQlqn"><pre class="Box-sc-g0xbh4-0 bfdbXb prism-code language-json" tabindex="0" data-language="javascript">"publishConfig": {
  "provenance": true
},</pre></div>
</div></div> </li> <li>
<strong>Add an <code class="code__InlineCode-sc-izuaam-0 lnAgdq">.npmrc</code> file:</strong> You can add an <code class="code__InlineCode-sc-izuaam-0 lnAgdq">.npmrc</code> file to your project with the following entry: <div class="Box-sc-g0xbh4-0 eUKtPS"><div style="color:#393A34;background-color:#f6f8fa" class="Box-sc-g0xbh4-0 bdVWRk">
<div class="Box-sc-g0xbh4-0 kFQlqn"><pre class="Box-sc-g0xbh4-0 bfdbXb prism-code language-ini" tabindex="0" data-language="javascript">provenance=true</pre></div>
</div></div> </li> </ul> <div class="components__StyledNote-sc-13rww2g-13 eNbdhv"><p class="components__Paragraph-sc-13rww2g-11 cevAMF"><strong>Note:</strong> At this time, <code class="code__InlineCode-sc-izuaam-0 lnAgdq">yarn</code> is not a supported tool for publishing your packages with provenance.</p></div> <h2 id="publishing-packages-with-provenance-via-gitlab-cicd" class="components__StyledHeading-sc-13rww2g-0 components__h2-sc-13rww2g-2 cZjJlu cYFMoP components__StyledHeading-sc-13rww2g-0 cZjJlu"><a href="#publishing-packages-with-provenance-via-gitlab-cicd" aria-label="Publishing packages with provenance via GitLab CI/CD permalink" class="Link__StyledLink-sc-14289xe-0 hysCUZ">Publishing packages with provenance via GitLab CI/CD</a></h2> <p class="components__Paragraph-sc-13rww2g-11 cevAMF">In order to establish provenance, you must use a supported cloud CI/CD provider and a cloud-hosted runner to publish your packages. GitLab CI/CD is a supported CI/CD platform that allows you to automate software development tasks. For more information, see <a href="https://docs.gitlab.com/ee/ci/yaml/signing_examples.html#use-sigstore-and-npm-to-generate-keyless-provenance" class="Link__StyledLink-sc-14289xe-0 kIxRcv">Generating provenance in GitLab CI/CD</a> in the GitLab documentation.</p><div class="_attribution">
  <p class="_attribution-p">
    &copy; npm, Inc. and Contributors<br>Licensed under the npm License.<br>npm is a trademark of npm, Inc.<br>
    <a href="https://docs.npmjs.com/generating-provenance-statements" class="_attribution-link">https://docs.npmjs.com/generating-provenance-statements</a>
  </p>
</div>
