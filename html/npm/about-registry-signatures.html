<div class="Box-sc-g0xbh4-0 goytIH"><h1 class="components__StyledHeading-sc-13rww2g-0 components__h1-sc-13rww2g-1 cZjJlu jMmFmb components__StyledHeading-sc-13rww2g-0 cZjJlu">About ECDSA registry signatures</h1></div>


<p class="components__Paragraph-sc-13rww2g-11 cevAMF">Packages published to the public npm registry are signed to make it possible to detect if the package content has been tampered with.</p> <p class="components__Paragraph-sc-13rww2g-11 cevAMF">Signing and verifying published packages protects against an attacker controlling a registry mirror or proxy where they attempt to intercept and tamper with the package tarball content.</p> <h2 id="migrating-from-pgp-to-ecdsa-signatures" class="components__StyledHeading-sc-13rww2g-0 components__h2-sc-13rww2g-2 cZjJlu cYFMoP components__StyledHeading-sc-13rww2g-0 cZjJlu"><a href="#migrating-from-pgp-to-ecdsa-signatures" aria-label="Migrating from PGP to ECDSA signatures permalink" class="Link__StyledLink-sc-14289xe-0 hysCUZ">Migrating from PGP to ECDSA signatures</a></h2> <div class="components__StyledNote-sc-13rww2g-13 eNbdhv"><p class="components__Paragraph-sc-13rww2g-11 cevAMF"><strong>Note:</strong> PGP-based registry signatures were deprecated on <strong>April 25th 2023</strong> and replaced by ECDSA registry signatures.</p></div> <p class="components__Paragraph-sc-13rww2g-11 cevAMF">The public npm registry is migrating away from the existing PGP signatures to ECDSA signatures that are more compact and can be verified without extra dependencies in the npm CLI.</p> <p class="components__Paragraph-sc-13rww2g-11 cevAMF">Signature verification was previously a multi-step process involving the Keybase CLI, as well as manually retrieving and parsing the signature from the package metadata.</p> <p class="components__Paragraph-sc-13rww2g-11 cevAMF">Read more about <a class="Link__StyledLink-sc-14289xe-0 kIxRcv" href="verifying-registry-signatures.html">migrating and verifying signatures</a> using the npm CLI.</p> <h2 id="supporting-signatures-on-third-party-registries" class="components__StyledHeading-sc-13rww2g-0 components__h2-sc-13rww2g-2 cZjJlu cYFMoP components__StyledHeading-sc-13rww2g-0 cZjJlu"><a href="#supporting-signatures-on-third-party-registries" aria-label="Supporting signatures on third-party registries permalink" class="Link__StyledLink-sc-14289xe-0 hysCUZ">Supporting signatures on third-party registries</a></h2> <p class="components__Paragraph-sc-13rww2g-11 cevAMF">The npm CLI supports registry signatures and signing keys provided by any registry if the following conventions are followed:</p> <p class="components__Paragraph-sc-13rww2g-11 cevAMF"><strong>1. Signatures are provided in the package's <code class="code__InlineCode-sc-izuaam-0 lnAgdq">packument</code> in each published version within the <code class="code__InlineCode-sc-izuaam-0 lnAgdq">dist</code> object:</strong></p> <div class="Box-sc-g0xbh4-0 eUKtPS"><div style="color:#393A34;background-color:#f6f8fa" class="Box-sc-g0xbh4-0 bdVWRk">
<div class="Box-sc-g0xbh4-0 kFQlqn"><pre class="Box-sc-g0xbh4-0 bfdbXb prism-code language-bash" tabindex="0" data-language="javascript">"dist":{
  ..omitted..,
  "signatures": [{
    "keyid": "SHA256:{{SHA256_PUBLIC_KEY}}",
    "sig": "a312b9c3cb4a1b693e8ebac5ee1ca9cc01f2661c14391917dcb111517f72370809..."
  }],</pre></div>
</div></div> <p class="components__Paragraph-sc-13rww2g-11 cevAMF">See this <a href="https://registry.npmjs.org/light-cycle/1.4.3" class="Link__StyledLink-sc-14289xe-0 kIxRcv">example of a signed package from the public npm registry</a>.</p> <p class="components__Paragraph-sc-13rww2g-11 cevAMF">To generate the signature, sign the package name, version and tarball sha integrity: <code class="code__InlineCode-sc-izuaam-0 lnAgdq">${package.name}@${package.version}:${package.dist.integrity}</code>.</p> <p class="components__Paragraph-sc-13rww2g-11 cevAMF">The current best practice is to use a <a href="https://en.wikipedia.org/wiki/Key_management#Key_management_system" class="Link__StyledLink-sc-14289xe-0 kIxRcv">Key Management System</a> that does the signing operation on a <a href="https://en.wikipedia.org/wiki/Hardware_security_module" class="Link__StyledLink-sc-14289xe-0 kIxRcv">Hardware Security Module (HSM)</a> in order to not directly handle the private key part, which reduces the attack surface.</p> <p class="components__Paragraph-sc-13rww2g-11 cevAMF">The <code class="code__InlineCode-sc-izuaam-0 lnAgdq">keyid</code> must match one of the public signing keys below.</p> <p class="components__Paragraph-sc-13rww2g-11 cevAMF"><strong>2. Public signing keys are provided at <code class="code__InlineCode-sc-izuaam-0 lnAgdq">registry-host.tld/-/npm/v1/keys</code> in the following format:</strong></p> <div class="Box-sc-g0xbh4-0 eUKtPS"><div style="color:#393A34;background-color:#f6f8fa" class="Box-sc-g0xbh4-0 bdVWRk">
<div class="Box-sc-g0xbh4-0 kFQlqn"><pre class="Box-sc-g0xbh4-0 bfdbXb prism-code language-bash" tabindex="0" data-language="javascript">{
  "keys": [{
    "expires": null,
    "keyid": "SHA256:{{SHA256_PUBLIC_KEY}}",
    "keytype": "ecdsa-sha2-nistp256",
    "scheme": "ecdsa-sha2-nistp256",
    "key": "{{B64_PUBLIC_KEY}}"
  }]
}</pre></div>
</div></div> <p class="components__Paragraph-sc-13rww2g-11 cevAMF">Keys response:</p> <ul class="components__UnorderedList-sc-13rww2g-10 fqlkab"> <li>
<code class="code__InlineCode-sc-izuaam-0 lnAgdq">expires</code>: null or a simplified extended <a href="https://en.wikipedia.org/wiki/ISO_8601" class="Link__StyledLink-sc-14289xe-0 kIxRcv">ISO 8601 format</a>: <code class="code__InlineCode-sc-izuaam-0 lnAgdq">YYYY-MM-DDTHH:mm:ss.sssZ</code>
</li> <li>
<code class="code__InlineCode-sc-izuaam-0 lnAgdq">keydid</code>: sha256 fingerprint of the public key</li> <li>
<code class="code__InlineCode-sc-izuaam-0 lnAgdq">keytype</code>: only <code class="code__InlineCode-sc-izuaam-0 lnAgdq">ecdsa-sha2-nistp256</code> is currently supported by the npm CLI</li> <li>
<code class="code__InlineCode-sc-izuaam-0 lnAgdq">scheme</code>: only <code class="code__InlineCode-sc-izuaam-0 lnAgdq">ecdsa-sha2-nistp256</code> is currently supported by the npm CLI</li> <li>
<code class="code__InlineCode-sc-izuaam-0 lnAgdq">key</code>: base64 encoded public key</li> </ul> <p class="components__Paragraph-sc-13rww2g-11 cevAMF">See this <a href="https://registry.npmjs.org/-/npm/v1/keys" class="Link__StyledLink-sc-14289xe-0 kIxRcv">example key's response from the public npm registry</a>.</p><div class="_attribution">
  <p class="_attribution-p">
    &copy; npm, Inc. and Contributors<br>Licensed under the npm License.<br>npm is a trademark of npm, Inc.<br>
    <a href="https://docs.npmjs.com/about-registry-signatures" class="_attribution-link">https://docs.npmjs.com/about-registry-signatures</a>
  </p>
</div>
