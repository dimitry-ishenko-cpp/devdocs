<h1 class="type-name"> module Crystal::<wbr>Macros </wbr>
</h1> <h2>  Overview </h2> <p>The <code><a href="macros.html">Macros</a></code> module is a fictitious module used to document macros and macro methods.</p> <p>You can invoke a <strong>fixed subset</strong> of methods on AST nodes at compile-time. These methods are documented on the classes in this module. Additionally, methods of the <code><a href="macros.html">Macros</a></code> module are top-level methods that you can invoke, like <code><a href="macros.html#puts%28%2Aexpressions%29%3ANop-instance-method">#puts</a></code> and <code><a href="macros.html#run%28filename%2C%2Aargs%29%3AMacroId-instance-method">#run</a></code>.</p> <h2>  Defined in: </h2> <a href="https://github.com/crystal-lang/crystal/blob/0aa30372c/src/compiler/crystal/macros.cr#L116" target="_blank"> compiler/crystal/macros.cr </a> <br> <h2>  Instance Method Summary </h2> <ul class="list-summary"> <li class="entry-summary"> <a href="#%60%28command%29%3AMacroId-instance-method" class="signature"><strong>#`</strong>(command) : MacroId</a> <div class="summary"><p>Executes a system command and returns the output as a <code><a href="macros/macroid.html">MacroId</a></code>.</p></div> </li> <li class="entry-summary"> <a href="#compare_versions%28v1%3AStringLiteral%2Cv2%3AStringLiteral%29%3ANumberLiteral-instance-method" class="signature"><strong>#compare_versions</strong>(v1 : StringLiteral, v2 : StringLiteral) : NumberLiteral</a> <div class="summary"><p>Compares two <a href="http://semver.org/">semantic versions</a>.</p></div> </li> <li class="entry-summary"> <a href="#debug%28format%3Dtrue%29%3ANop-instance-method" class="signature"><strong>#debug</strong>(format = true) : Nop</a> <div class="summary"><p>Outputs the current macro's buffer to the standard output.</p></div> </li> <li class="entry-summary"> <a href="#env%28name%29%3AStringLiteral%7CNilLiteral-instance-method" class="signature"><strong>#env</strong>(name) : StringLiteral | NilLiteral</a> <div class="summary"><p>Gets the value of an environment variable at compile-time, or <code>nil</code> if it doesn't exist.</p></div> </li> <li class="entry-summary"> <a href="#file_exists%3F%28filename%29%3ABoolLiteral-instance-method" class="signature"><strong>#file_exists?</strong>(filename) : BoolLiteral</a> <div class="summary"><p>Returns <code>true</code> if the given <em>filename</em> exists, <code>false</code> otherwise.</p></div> </li> <li class="entry-summary"> <a href="#flag%3F%28name%29%3ABoolLiteral-instance-method" class="signature"><strong>#flag?</strong>(name) : BoolLiteral</a> <div class="summary"><p>Returns whether a <a href="https://crystal-lang.org/docs/syntax_and_semantics/compile_time_flags.html">compile-time flag</a> is set.</p></div> </li> <li class="entry-summary"> <a href="#host_flag%3F%28name%29%3ABoolLiteral-instance-method" class="signature"><strong>#host_flag?</strong>(name) : BoolLiteral</a> <div class="summary"><p>Returns whether a <a href="https://crystal-lang.org/docs/syntax_and_semantics/compile_time_flags.html">compile-time flag</a> is set for the <em>host</em> platform, which can differ from the target platform (<code><a href="macros.html#flag%3F%28name%29%3ABoolLiteral-instance-method">#flag?</a></code>) during cross-compilation.</p></div> </li> <li class="entry-summary"> <a href="#p%28%2Aexpressions%29%3ANop-instance-method" class="signature"><strong>#p</strong>(*expressions) : Nop</a> <div class="summary"><p>Same as <code><a href="macros.html#puts%28%2Aexpressions%29%3ANop-instance-method">#puts</a></code>.</p></div> </li> <li class="entry-summary"> <a href="#p%21%28%2Aexpressions%29%3ANop-instance-method" class="signature"><strong>#p!</strong>(*expressions) : Nop</a> <div class="summary"><p>Prints macro expressions together with their values at compile-time.</p></div> </li> <li class="entry-summary"> <a href="#parse_type%28type_name%3AStringLiteral%29%3APath%7CGeneric%7CProcNotation%7CMetaclass-instance-method" class="signature"><strong>#parse_type</strong>(type_name : StringLiteral) : Path | Generic | ProcNotation | Metaclass</a> <div class="summary"><p>Parses <em>type_name</em> into a <code><a href="macros/path.html">Path</a></code>, <code><a href="macros/generic.html">Generic</a></code> (also used for unions), <code><a href="macros/procnotation.html">ProcNotation</a></code>, or <code><a href="macros/metaclass.html">Metaclass</a></code>.</p></div> </li> <li class="entry-summary"> <a href="#pp%28%2Aexpressions%29%3ANop-instance-method" class="signature"><strong>#pp</strong>(*expressions) : Nop</a> <div class="summary"><p>Same as <code><a href="macros.html#puts%28%2Aexpressions%29%3ANop-instance-method">#puts</a></code>.</p></div> </li> <li class="entry-summary"> <a href="#pp%21%28%2Aexpressions%29%3ANop-instance-method" class="signature"><strong>#pp!</strong>(*expressions) : Nop</a> <div class="summary"><p>Same as <code><a href="macros.html#p%21%28%2Aexpressions%29%3ANop-instance-method">#p!</a></code></p></div> </li> <li class="entry-summary"> <a href="#print%28%2Aexpressions%29%3ANop-instance-method" class="signature"><strong>#print</strong>(*expressions) : Nop</a> <div class="summary"><p>Prints AST nodes at compile-time.</p></div> </li> <li class="entry-summary"> <a href="#puts%28%2Aexpressions%29%3ANop-instance-method" class="signature"><strong>#puts</strong>(*expressions) : Nop</a> <div class="summary"><p>Prints AST nodes at compile-time.</p></div> </li> <li class="entry-summary"> <a href="#raise%28message%29%3ANoReturn-instance-method" class="signature"><strong>#raise</strong>(message) : NoReturn</a> <div class="summary"><p>Gives a compile-time error with the given <em>message</em>.</p></div> </li> <li class="entry-summary"> <a href="#read_file%28filename%29%3AStringLiteral-instance-method" class="signature"><strong>#read_file</strong>(filename) : StringLiteral</a> <div class="summary"><p>Reads a file and returns a <code><a href="macros/stringliteral.html">StringLiteral</a></code> with its contents.</p></div> </li> <li class="entry-summary"> <a href="#read_file%3F%28filename%29%3AStringLiteral%7CNilLiteral-instance-method" class="signature"><strong>#read_file?</strong>(filename) : StringLiteral | NilLiteral</a> <div class="summary"><p>Same as <code><a href="macros.html#read_file%28filename%29%3AStringLiteral-instance-method">#read_file</a></code>, except that <code>nil</code> is returned on any I/O failure instead of issuing a compile-time failure.</p></div> </li> <li class="entry-summary"> <a href="#run%28filename%2C%2Aargs%29%3AMacroId-instance-method" class="signature"><strong>#run</strong>(filename, *args) : MacroId</a> <div class="summary"><p>Compiles and execute a Crystal program and returns its output as a <code><a href="macros/macroid.html">MacroId</a></code>.</p></div> </li> <li class="entry-summary"> <a href="#skip_file%3ANop-instance-method" class="signature"><strong>#skip_file</strong> : Nop</a> <div class="summary"><p>Skips the rest of the file from which it is executed.</p></div> </li> <li class="entry-summary"> <a href="#system%28command%29%3AMacroId-instance-method" class="signature"><strong>#system</strong>(command) : MacroId</a> <div class="summary"><p>Executes a system command and returns the output as a <code><a href="macros/macroid.html">MacroId</a></code>.</p></div> </li> <li class="entry-summary"> <a href="#warning%28message%3AStringLiteral%29%3ANilLiteral-instance-method" class="signature"><strong>#warning</strong>(message : StringLiteral) : NilLiteral</a> <div class="summary"><p>Emits a compile-time warning with the given <em>message</em>.</p></div> </li> </ul>  <h2>  Instance Method Detail </h2> <div class="entry-detail" id="`(command):MacroId-instance-method"> <h3 class="signature">def <strong>`</strong>(command) : <a href="macros/macroid.html">MacroId</a><a href="https://github.com/crystal-lang/crystal/blob/0aa30372c/src/compiler/crystal/macros.cr#L221" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Executes a system command and returns the output as a <code><a href="macros/macroid.html">MacroId</a></code>. Gives a compile-time error if the command failed to execute.</p> <p>It is impossible to call this method with any regular call syntax. There is an associated literal type which calls the method with the literal content as command:</p> <pre data-language="crystal">{{ `echo hi` }} # =&gt; "hi\n"</pre> <p>See <a href="https://crystal-lang.org/reference/syntax_and_semantics/literals/command.html"><code>Command</code> literals</a> in the language reference.</p> </div>   </div> <div class="entry-detail" id="compare_versions(v1:StringLiteral,v2:StringLiteral):NumberLiteral-instance-method"> <h3 class="signature">def <strong>compare_versions</strong>(v1 : <a href="macros/stringliteral.html">StringLiteral</a>, v2 : <a href="macros/stringliteral.html">StringLiteral</a>) : <a href="macros/numberliteral.html">NumberLiteral</a><a href="https://github.com/crystal-lang/crystal/blob/0aa30372c/src/compiler/crystal/macros.cr#L125" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Compares two <a href="http://semver.org/">semantic versions</a>.</p> <p>Returns <code>-1</code>, <code>0</code> or <code>1</code> depending on whether <em>v1</em> is lower than <em>v2</em>, equal to <em>v2</em> or greater than <em>v2</em>.</p> <pre data-language="crystal">{{ compare_versions("1.10.0", "1.2.0") }} # =&gt; 1</pre> </div>   </div> <div class="entry-detail" id="debug(format=true):Nop-instance-method"> <h3 class="signature">def <strong>debug</strong>(format = true) : <a href="macros/nop.html">Nop</a><a href="https://github.com/crystal-lang/crystal/blob/0aa30372c/src/compiler/crystal/macros.cr#L133" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Outputs the current macro's buffer to the standard output. Useful for debugging a macro to see what's being generated.</p> <p>By default, the output is tried to be formatted using Crystal's formatter, but you can disable this by passing <code>false</code> to this method.</p> </div>   </div> <div class="entry-detail" id="env(name):StringLiteral|NilLiteral-instance-method"> <h3 class="signature">def <strong>env</strong>(name) : <a href="macros/stringliteral.html">StringLiteral</a> | <a href="macros/nilliteral.html">NilLiteral</a><a href="https://github.com/crystal-lang/crystal/blob/0aa30372c/src/compiler/crystal/macros.cr#L137" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Gets the value of an environment variable at compile-time, or <code>nil</code> if it doesn't exist.</p> </div>   </div> <div class="entry-detail" id="file_exists?(filename):BoolLiteral-instance-method"> <h3 class="signature">def <strong>file_exists?</strong>(filename) : <a href="macros/boolliteral.html">BoolLiteral</a><a href="https://github.com/crystal-lang/crystal/blob/0aa30372c/src/compiler/crystal/macros.cr#L242" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Returns <code>true</code> if the given <em>filename</em> exists, <code>false</code> otherwise.</p> </div>   </div> <div class="entry-detail" id="flag?(name):BoolLiteral-instance-method"> <h3 class="signature">def <strong>flag?</strong>(name) : <a href="macros/boolliteral.html">BoolLiteral</a><a href="https://github.com/crystal-lang/crystal/blob/0aa30372c/src/compiler/crystal/macros.cr#L145" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Returns whether a <a href="https://crystal-lang.org/docs/syntax_and_semantics/compile_time_flags.html">compile-time flag</a> is set.</p> <pre data-language="crystal">{{ flag?(:x86_64) }} # true or false</pre> </div>   </div> <div class="entry-detail" id="host_flag?(name):BoolLiteral-instance-method"> <h3 class="signature">def <strong>host_flag?</strong>(name) : <a href="macros/boolliteral.html">BoolLiteral</a><a href="https://github.com/crystal-lang/crystal/blob/0aa30372c/src/compiler/crystal/macros.cr#L155" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Returns whether a <a href="https://crystal-lang.org/docs/syntax_and_semantics/compile_time_flags.html">compile-time flag</a> is set for the <em>host</em> platform, which can differ from the target platform (<code><a href="macros.html#flag%3F%28name%29%3ABoolLiteral-instance-method">#flag?</a></code>) during cross-compilation.</p> <pre data-language="crystal">{{ host_flag?(:win32) }} # true or false</pre> </div>   </div> <div class="entry-detail" id="p(*expressions):Nop-instance-method"> <h3 class="signature">def <strong>p</strong>(*expressions) : <a href="macros/nop.html">Nop</a><a href="https://github.com/crystal-lang/crystal/blob/0aa30372c/src/compiler/crystal/macros.cr#L196" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Same as <code><a href="macros.html#puts%28%2Aexpressions%29%3ANop-instance-method">#puts</a></code>.</p> </div>   </div> <div class="entry-detail" id="p!(*expressions):Nop-instance-method"> <h3 class="signature">def <strong>p!</strong>(*expressions) : <a href="macros/nop.html">Nop</a><a href="https://github.com/crystal-lang/crystal/blob/0aa30372c/src/compiler/crystal/macros.cr#L204" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Prints macro expressions together with their values at compile-time. Useful for debugging macros.</p> </div>   </div> <div class="entry-detail" id="parse_type(type_name:StringLiteral):Path|Generic|ProcNotation|Metaclass-instance-method"> <h3 class="signature">def <strong>parse_type</strong>(type_name : <a href="macros/stringliteral.html">StringLiteral</a>) : <a href="macros/path.html">Path</a> | <a href="macros/generic.html">Generic</a> | <a href="macros/procnotation.html">ProcNotation</a> | <a href="macros/metaclass.html">Metaclass</a><a href="https://github.com/crystal-lang/crystal/blob/0aa30372c/src/compiler/crystal/macros.cr#L184" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Parses <em>type_name</em> into a <code><a href="macros/path.html">Path</a></code>, <code><a href="macros/generic.html">Generic</a></code> (also used for unions), <code><a href="macros/procnotation.html">ProcNotation</a></code>, or <code><a href="macros/metaclass.html">Metaclass</a></code>.</p> <p>The <code>#resolve</code> method could then be used to resolve the value into a <code><a href="macros/typenode.html">TypeNode</a></code>, if the <em>type_name</em> represents a type, otherwise the value of the constant.</p> <p>A compile time error is raised if the type/constant does not actually exist, or if a required generic argument was not provided.</p> <pre data-language="crystal">class Foo; end

struct Some::Namespace::Foo; end

module Bar(T); end

MY_CONST = 1234

{{ parse_type("Foo").resolve.class? }}                                   # =&gt; true
{{ parse_type("Some::Namespace::Foo").resolve.struct? }}                 # =&gt; true
{{ parse_type("Foo|Some::Namespace::Foo").resolve.union_types.size }}    # =&gt; 2
{{ parse_type("Bar(Int32)|Foo").resolve.union_types[0].type_vars.size }} # =&gt; 1
{{ parse_type("MY_CONST").resolve }}                                     # =&gt; 1234

{{ parse_type("MissingType").resolve }}   # Error: undefined constant MissingType
{{ parse_type("UNKNOWN_CONST").resolve }} # Error: undefined constant UNKNOWN_CONST</pre> </div>   </div> <div class="entry-detail" id="pp(*expressions):Nop-instance-method"> <h3 class="signature">def <strong>pp</strong>(*expressions) : <a href="macros/nop.html">Nop</a><a href="https://github.com/crystal-lang/crystal/blob/0aa30372c/src/compiler/crystal/macros.cr#L200" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Same as <code><a href="macros.html#puts%28%2Aexpressions%29%3ANop-instance-method">#puts</a></code>.</p> </div>   </div> <div class="entry-detail" id="pp!(*expressions):Nop-instance-method"> <h3 class="signature">def <strong>pp!</strong>(*expressions) : <a href="macros/nop.html">Nop</a><a href="https://github.com/crystal-lang/crystal/blob/0aa30372c/src/compiler/crystal/macros.cr#L208" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Same as <code><a href="macros.html#p%21%28%2Aexpressions%29%3ANop-instance-method">#p!</a></code></p> </div>   </div> <div class="entry-detail" id="print(*expressions):Nop-instance-method"> <h3 class="signature">def <strong>print</strong>(*expressions) : <a href="macros/nop.html">Nop</a><a href="https://github.com/crystal-lang/crystal/blob/0aa30372c/src/compiler/crystal/macros.cr#L192" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Prints AST nodes at compile-time. Useful for debugging macros.</p> </div>   </div> <div class="entry-detail" id="puts(*expressions):Nop-instance-method"> <h3 class="signature">def <strong>puts</strong>(*expressions) : <a href="macros/nop.html">Nop</a><a href="https://github.com/crystal-lang/crystal/blob/0aa30372c/src/compiler/crystal/macros.cr#L188" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Prints AST nodes at compile-time. Useful for debugging macros.</p> </div>   </div> <div class="entry-detail" id="raise(message):NoReturn-instance-method"> <h3 class="signature">def <strong>raise</strong>(message) : NoReturn<a href="https://github.com/crystal-lang/crystal/blob/0aa30372c/src/compiler/crystal/macros.cr#L234" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Gives a compile-time error with the given <em>message</em>.</p> </div>   </div> <div class="entry-detail" id="read_file(filename):StringLiteral-instance-method"> <h3 class="signature">def <strong>read_file</strong>(filename) : <a href="macros/stringliteral.html">StringLiteral</a><a href="https://github.com/crystal-lang/crystal/blob/0aa30372c/src/compiler/crystal/macros.cr#L257" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Reads a file and returns a <code><a href="macros/stringliteral.html">StringLiteral</a></code> with its contents.</p> <p>Gives a compile-time error if the file doesn't exist or if reading the file fails.</p> <p>To read a file relative to where the macro is defined, use:</p> <pre data-language="crystal">read_file("#{__DIR__}/some_file.txt")</pre> <p>NOTE Relative paths are resolved to the current working directory.</p> </div>   </div> <div class="entry-detail" id="read_file?(filename):StringLiteral|NilLiteral-instance-method"> <h3 class="signature">def <strong>read_file?</strong>(filename) : <a href="macros/stringliteral.html">StringLiteral</a> | <a href="macros/nilliteral.html">NilLiteral</a><a href="https://github.com/crystal-lang/crystal/blob/0aa30372c/src/compiler/crystal/macros.cr#L262" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Same as <code><a href="macros.html#read_file%28filename%29%3AStringLiteral-instance-method">#read_file</a></code>, except that <code>nil</code> is returned on any I/O failure instead of issuing a compile-time failure.</p> </div>   </div> <div class="entry-detail" id="run(filename,*args):MacroId-instance-method"> <h3 class="signature">def <strong>run</strong>(filename, *args) : <a href="macros/macroid.html">MacroId</a><a href="https://github.com/crystal-lang/crystal/blob/0aa30372c/src/compiler/crystal/macros.cr#L305" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Compiles and execute a Crystal program and returns its output as a <code><a href="macros/macroid.html">MacroId</a></code>.</p> <p>The file denoted by <em>filename</em> must be a valid Crystal program. This macro invocation passes <em>args</em> to the program as regular program arguments. This output is the result of this macro invocation, as a <code><a href="macros/macroid.html">MacroId</a></code>.</p> <p>The <code><a href="macros.html#run%28filename%2C%2Aargs%29%3AMacroId-instance-method">#run</a></code> macro is useful when the subset of available macro methods are not enough for your purposes and you need something more powerful. With <code><a href="macros.html#run%28filename%2C%2Aargs%29%3AMacroId-instance-method">#run</a></code> you can read files at compile time, connect to the internet or to a database.</p> <p>A simple example:</p> <pre data-language="crystal"># read.cr
puts File.read(ARGV[0])</pre> <pre data-language="crystal"># main.cr
macro read_file_at_compile_time(filename)
  {{ run("./read", filename).stringify }}
end

puts read_file_at_compile_time("some_file.txt")</pre> <p>The above generates a program that will have the contents of <code>some_file.txt</code>. The file, however, is read at compile time and will not be needed at runtime.</p> <p>NOTE the compiler is allowed to cache the executable generated for <em>filename</em> and only recompile it if any of the files it depends on changes (their modified time). This is why it's <strong>strongly discouraged</strong> to use a program for <code><a href="macros.html#run%28filename%2C%2Aargs%29%3AMacroId-instance-method">#run</a></code> that changes in subsequent compilations (for example, if it executes shell commands at compile time, or other macro run programs). It's also strongly discouraged to have a macro run program take a lot of time, because this will slow down compilation times. Reading files is OK, opening an HTTP connection at compile-time will most likely result in very slow compilations.</p> </div>   </div> <div class="entry-detail" id="skip_file:Nop-instance-method"> <h3 class="signature">def <strong>skip_file</strong> : <a href="macros/nop.html">Nop</a><a href="https://github.com/crystal-lang/crystal/blob/0aa30372c/src/compiler/crystal/macros.cr#L322" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Skips the rest of the file from which it is executed. Typical usage is to skip files that have platform specific code, without having to surround the most relevant code in <code>{% if flag?(...) %} ... {% end %}</code> macro blocks.</p> <p>Example:</p> <pre data-language="crystal"># sth_for_osx.cr
{% skip_file unless flag?(:darwin) %}

# Class FooForMac will only be defined if we're compiling on OS X
class FooForMac
end</pre> </div>   </div> <div class="entry-detail" id="system(command):MacroId-instance-method"> <h3 class="signature">def <strong>system</strong>(command) : <a href="macros/macroid.html">MacroId</a><a href="https://github.com/crystal-lang/crystal/blob/0aa30372c/src/compiler/crystal/macros.cr#L230" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Executes a system command and returns the output as a <code><a href="macros/macroid.html">MacroId</a></code>. Gives a compile-time error if the command failed to execute.</p> <pre data-language="crystal">{{ system("echo hi") }} # =&gt; "hi\n"</pre> </div>   </div> <div class="entry-detail" id="warning(message:StringLiteral):NilLiteral-instance-method"> <h3 class="signature">def <strong>warning</strong>(message : <a href="macros/stringliteral.html">StringLiteral</a>) : <a href="macros/nilliteral.html">NilLiteral</a><a href="https://github.com/crystal-lang/crystal/blob/0aa30372c/src/compiler/crystal/macros.cr#L238" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Emits a compile-time warning with the given <em>message</em>.</p> </div>   </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2012&ndash;2024 Manas Technology Solutions.<br>Licensed under the Apache License, Version 2.0.<br>
    <a href="https://crystal-lang.org/api/1.11.1/Crystal/Macros.html" class="_attribution-link">https://crystal-lang.org/api/1.11.1/Crystal/Macros.html</a>
  </p>
</div>
