<h1 class="type-name"> class Crystal::<wbr>EventLoop::<wbr>Polling::<wbr>Arena(T, BLOCK_BYTESIZE) </wbr></wbr></wbr>
</h1> <ul class="superclass-hierarchy">
<li class="superclass"><a href="arena.html">Crystal::EventLoop::Polling::Arena(T, BLOCK_BYTESIZE)</a></li>
<li class="superclass"><a href="../../../reference.html">Reference</a></li>
<li class="superclass"><a href="../../../object.html">Object</a></li>
</ul> <h2>  Overview </h2> <p>Generational Arena.</p> <p>The arena allocates objects <code>T</code> at a predefined index. The object iself is uninitialized (outside of having its memory initialized to zero). The object can be allocated and later retrieved using the generation index (Arena::Index) that contains both the actual index (Int32) and the generation number (UInt32). Deallocating the object increases the generation number, which allows the object to be reallocated later on. Trying to retrieve the allocation using the generation index will fail if the generation number changed (it's a new allocation).</p> <p>This arena isn't generic as it won't keep a list of free indexes. It assumes that something else will maintain the uniqueness of indexes and reuse indexes as much as possible instead of growing.</p> <p>For example this arena is used to hold <code><a href="polldescriptor.html">Crystal::EventLoop::Polling::PollDescriptor</a></code> allocations for all the fd in a program, where the fd is used as the index. They're unique to the process and the OS always reuses the lowest fd numbers before growing.</p> <p>Thread safety: the memory region is divided in blocks of size BLOCK_BYTESIZE allocated in the GC. Pointers are thus never invalidated. Mutating the blocks is protected by a mutual exclusion lock. Individual (de)allocations of objects are protected with a fine grained lock.</p> <p>Guarantees: blocks' memory is initialized to zero, which means <code>T</code> objects are initialized to zero by default, then <code><a href="arena.html#free%28index%3AIndex%2C%26%29%3ANil-instance-method">#free</a></code> will also clear the memory, so the next allocation shall be initialized to zero, too.</p> <h2>  Defined in: </h2> <a href="https://github.com/crystal-lang/crystal/blob/89944bf17/src/crystal/event_loop/polling/arena.cr#L29" target="_blank"> crystal/event_loop/polling/arena.cr </a> <br> <h2>  Constant Summary </h2> <dl> <dt class="entry-const" id="INVALID_INDEX"> <strong>INVALID_INDEX</strong> = <code>Index.new(-1, 0)</code> </dt> </dl> <h2>  Constructors </h2> <ul class="list-summary"> <li class="entry-summary"> <a href="#new%28capacity%3AInt32%29-class-method" class="signature"><strong>.new</strong>(capacity : Int32)</a> </li> </ul> <h2>  Instance Method Summary </h2> <ul class="list-summary"> <li class="entry-summary"> <a href="#allocate_at%28index%3AInt32%2C%26%3APointer%28T%29%2CIndex-%3E%29%3AIndex%7CNil-instance-method" class="signature"><strong>#allocate_at</strong>(index : Int32, &amp; : Pointer(T), Index -&gt; ) : Index | Nil</a> <div class="summary"><p>Same as <code><a href="arena.html#allocate_at%3F%28index%3AInt32%2C%26%3APointer%28T%29%2CIndex-%3E%29%3AIndex%7CNil-instance-method">#allocate_at?</a></code> but raises when already allocated.</p></div> </li> <li class="entry-summary"> <a href="#allocate_at%3F%28index%3AInt32%2C%26%3APointer%28T%29%2CIndex-%3E%29%3AIndex%7CNil-instance-method" class="signature"><strong>#allocate_at?</strong>(index : Int32, &amp; : Pointer(T), Index -&gt; ) : Index | Nil</a> <div class="summary"><p>Allocates the object at <em>index</em> unless already allocated, then yields a pointer to the object at <em>index</em> and the current generation index to later retrieve and free the allocated object.</p></div> </li> <li class="entry-summary"> <a href="#each_index%28%26%29%3ANil-instance-method" class="signature"><strong>#each_index</strong>(&amp;) : Nil</a> <div class="summary"><p>Iterates all allocated objects, yields the actual index as well as the generation index.</p></div> </li> <li class="entry-summary"> <a href="#free%28index%3AIndex%2C%26%29%3ANil-instance-method" class="signature"><strong>#free</strong>(index : Index, &amp;) : Nil</a> <div class="summary"><p>Yields the object previously allocated at <em>index</em> then releases it.</p></div> </li> <li class="entry-summary"> <a href="#get%28index%3AIndex%2C%26%29%3ANil-instance-method" class="signature"><strong>#get</strong>(index : Index, &amp;) : Nil</a> <div class="summary"><p>Yields a pointer to the object previously allocated at <em>index</em>.</p></div> </li> <li class="entry-summary"> <a href="#get%3F%28index%3AIndex%2C%26%29%3ABool-instance-method" class="signature"><strong>#get?</strong>(index : Index, &amp;) : Bool</a> <div class="summary"><p>Yields a pointer to the object previously allocated at <em>index</em> and returns true.</p></div> </li> </ul> <div class="methods-inherited"> <h3>Instance methods inherited from class <code><a href="../../../reference.html">Reference</a></code>
</h3> <a href="../../../reference.html#%3D%3D%28other%3Aself%29-instance-method" class="tooltip"> ==(other : self)<br>==(other : JSON::Any)<br>==(other : YAML::Any)<br>==(other) ==</a>, <a href="../../../reference.html#dup-instance-method" class="tooltip"> dup dup</a>, <a href="../../../reference.html#hash%28hasher%29-instance-method" class="tooltip"> hash(hasher) hash</a>, <a href="../../../reference.html#initialize-instance-method" class="tooltip"> initialize initialize</a>, <a href="../../../reference.html#inspect%28io%3AIO%29%3ANil-instance-method" class="tooltip"> inspect(io : IO) : Nil inspect</a>, <a href="../../../reference.html#object_id%3AUInt64-instance-method" class="tooltip"> object_id : UInt64 object_id</a>, <a href="../../../reference.html#pretty_print%28pp%29%3ANil-instance-method" class="tooltip"> pretty_print(pp) : Nil pretty_print</a>, <a href="../../../reference.html#same%3F%28other%3AReference%29%3ABool-instance-method" class="tooltip"> same?(other : Reference) : Bool<br>same?(other : Nil) same?</a>, <a href="../../../reference.html#to_s%28io%3AIO%29%3ANil-instance-method" class="tooltip"> to_s(io : IO) : Nil to_s</a> <h3>Constructor methods inherited from class <code><a href="../../../reference.html">Reference</a></code>
</h3> <a href="../../../reference.html#new-class-method" class="tooltip"> new new</a>, <a href="../../../reference.html#unsafe_construct%28address%3APointer%2C%2Aargs%2C%2A%2Aopts%29%3Aself-class-method" class="tooltip"> unsafe_construct(address : Pointer, *args, **opts) : self unsafe_construct</a> <h3>Class methods inherited from class <code><a href="../../../reference.html">Reference</a></code>
</h3> <a href="../../../reference.html#pre_initialize%28address%3APointer%29-class-method" class="tooltip"> pre_initialize(address : Pointer) pre_initialize</a> <h3>Instance methods inherited from class <code><a href="../../../object.html">Object</a></code>
</h3> <a href="../../../object.html#%21%3ABool-instance-method" class="tooltip"> ! : Bool !</a>, <a href="../../../object.html#%21%3D%28other%29-instance-method" class="tooltip"> !=(other) !=</a>, <a href="../../../object.html#%21~%28other%29-instance-method" class="tooltip"> !~(other) !~</a>, <a href="../../../object.html#%3D%3D%28other%29-instance-method" class="tooltip"> ==(other) ==</a>, <a href="../../../object.html#%3D%3D%3D%28other%3AJSON%3A%3AAny%29-instance-method" class="tooltip"> ===(other : JSON::Any)<br>===(other : YAML::Any)<br>===(other) ===</a>, <a href="../../../object.html#%3D~%28other%29-instance-method" class="tooltip"> =~(other) =~</a>, <a href="../../../object.html#as%28type%3AClass%29-instance-method" class="tooltip"> as(type : Class) as</a>, <a href="../../../object.html#as%3F%28type%3AClass%29-instance-method" class="tooltip"> as?(type : Class) as?</a>, <a href="../../../object.html#class-instance-method" class="tooltip"> class class</a>, <a href="../../../object.html#dup-instance-method" class="tooltip"> dup dup</a>, <a href="../../../object.html#hash%28hasher%29-instance-method" class="tooltip"> hash(hasher)<br>hash hash</a>, <a href="../../../object.html#in%3F%28collection%3AObject%29%3ABool-instance-method" class="tooltip"> in?(collection : Object) : Bool<br>in?(*values : Object) : Bool in?</a>, <a href="../../../object.html#inspect%28io%3AIO%29%3ANil-instance-method" class="tooltip"> inspect(io : IO) : Nil<br>inspect : String inspect</a>, <a href="../../../object.html#is_a%3F%28type%3AClass%29%3ABool-instance-method" class="tooltip"> is_a?(type : Class) : Bool is_a?</a>, <a href="../../../object.html#itself-instance-method" class="tooltip"> itself itself</a>, <a href="../../../object.html#nil%3F%3ABool-instance-method" class="tooltip"> nil? : Bool nil?</a>, <a href="../../../object.html#not_nil%21%28message%29-instance-method" class="tooltip"> not_nil!(message)<br>not_nil! not_nil!</a>, <a href="../../../object.html#pretty_inspect%28width%3D79%2Cnewline%3D%22%5Cn%22%2Cindent%3D0%29%3AString-instance-method" class="tooltip"> pretty_inspect(width = 79, newline = "\n", indent = 0) : String pretty_inspect</a>, <a href="../../../object.html#pretty_print%28pp%3APrettyPrint%29%3ANil-instance-method" class="tooltip"> pretty_print(pp : PrettyPrint) : Nil pretty_print</a>, <a href="../../../object.html#responds_to%3F%28name%3ASymbol%29%3ABool-instance-method" class="tooltip"> responds_to?(name : Symbol) : Bool responds_to?</a>, <a href="../../../object.html#tap%28%26%29-instance-method" class="tooltip"> tap(&amp;) tap</a>, <a href="../../../object.html#to_json%28io%3AIO%29%3ANil-instance-method" class="tooltip"> to_json(io : IO) : Nil<br>to_json : String to_json</a>, <a href="../../../object.html#to_pretty_json%28indent%3AString%3D%22%22%29%3AString-instance-method" class="tooltip"> to_pretty_json(indent : String = " ") : String<br>to_pretty_json(io : IO, indent : String = " ") : Nil to_pretty_json</a>, <a href="../../../object.html#to_s%28io%3AIO%29%3ANil-instance-method" class="tooltip"> to_s(io : IO) : Nil<br>to_s : String to_s</a>, <a href="../../../object.html#to_yaml%28io%3AIO%29%3ANil-instance-method" class="tooltip"> to_yaml(io : IO) : Nil<br>to_yaml : String to_yaml</a>, <a href="../../../object.html#try%28%26%29-instance-method" class="tooltip"> try(&amp;) try</a>, <a href="../../../object.html#unsafe_as%28type%3AT.class%29forallT-instance-method" class="tooltip"> unsafe_as(type : T.class) forall T unsafe_as</a> <h3>Class methods inherited from class <code><a href="../../../object.html">Object</a></code>
</h3> <a href="../../../object.html#from_json%28string_or_io%2Croot%3AString%29-class-method" class="tooltip"> from_json(string_or_io, root : String)<br>from_json(string_or_io) from_json</a>, <a href="../../../object.html#from_yaml%28string_or_io%3AString%7CIO%29-class-method" class="tooltip"> from_yaml(string_or_io : String | IO) from_yaml</a> <h3>Macros inherited from class <code><a href="../../../object.html">Object</a></code>
</h3> <a href="../../../object.html#class_getter%28%2Anames%2C%26block%29-macro" class="tooltip"> class_getter(*names, &amp;block) class_getter</a>, <a href="../../../object.html#class_getter%21%28%2Anames%29-macro" class="tooltip"> class_getter!(*names) class_getter!</a>, <a href="../../../object.html#class_getter%3F%28%2Anames%2C%26block%29-macro" class="tooltip"> class_getter?(*names, &amp;block) class_getter?</a>, <a href="../../../object.html#class_property%28%2Anames%2C%26block%29-macro" class="tooltip"> class_property(*names, &amp;block) class_property</a>, <a href="../../../object.html#class_property%21%28%2Anames%29-macro" class="tooltip"> class_property!(*names) class_property!</a>, <a href="../../../object.html#class_property%3F%28%2Anames%2C%26block%29-macro" class="tooltip"> class_property?(*names, &amp;block) class_property?</a>, <a href="../../../object.html#class_setter%28%2Anames%29-macro" class="tooltip"> class_setter(*names) class_setter</a>, <a href="../../../object.html#def_clone-macro" class="tooltip"> def_clone def_clone</a>, <a href="../../../object.html#def_equals%28%2Afields%29-macro" class="tooltip"> def_equals(*fields) def_equals</a>, <a href="../../../object.html#def_equals_and_hash%28%2Afields%29-macro" class="tooltip"> def_equals_and_hash(*fields) def_equals_and_hash</a>, <a href="../../../object.html#def_hash%28%2Afields%29-macro" class="tooltip"> def_hash(*fields) def_hash</a>, <a href="../../../object.html#delegate%28%2Amethods%2Ctoobject%29-macro" class="tooltip"> delegate(*methods, to object) delegate</a>, <a href="../../../object.html#forward_missing_to%28delegate%29-macro" class="tooltip"> forward_missing_to(delegate) forward_missing_to</a>, <a href="../../../object.html#getter%28%2Anames%2C%26block%29-macro" class="tooltip"> getter(*names, &amp;block) getter</a>, <a href="../../../object.html#getter%21%28%2Anames%29-macro" class="tooltip"> getter!(*names) getter!</a>, <a href="../../../object.html#getter%3F%28%2Anames%2C%26block%29-macro" class="tooltip"> getter?(*names, &amp;block) getter?</a>, <a href="../../../object.html#property%28%2Anames%2C%26block%29-macro" class="tooltip"> property(*names, &amp;block) property</a>, <a href="../../../object.html#property%21%28%2Anames%29-macro" class="tooltip"> property!(*names) property!</a>, <a href="../../../object.html#property%3F%28%2Anames%2C%26block%29-macro" class="tooltip"> property?(*names, &amp;block) property?</a>, <a href="../../../object.html#setter%28%2Anames%29-macro" class="tooltip"> setter(*names) setter</a> </div> <h2>  Constructor Detail </h2> <div class="entry-detail" id="new(capacity:Int32)-class-method"> <h3 class="signature">def self.<strong>new</strong>(capacity : <a href="../../../int32.html">Int32</a>)<a href="https://github.com/crystal-lang/crystal/blob/89944bf17/src/crystal/event_loop/polling/arena.cr#L87" target="_blank" class="view-source">Source</a>
</h3>   </div> <h2>  Instance Method Detail </h2> <div class="entry-detail" id="allocate_at(index:Int32,&amp;:Pointer(T),Index-&gt;):Index|Nil-instance-method"> <h3 class="signature">def <strong>allocate_at</strong>(index : <a href="../../../int32.html">Int32</a>, &amp; : <a href="../../../pointer.html">Pointer</a>(T), <a href="arena/index.html">Index</a> -&gt; ) : <a href="arena/index.html">Index</a> | <a href="../../../nil.html">Nil</a><a href="https://github.com/crystal-lang/crystal/blob/89944bf17/src/crystal/event_loop/polling/arena.cr#L117" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Same as <code><a href="arena.html#allocate_at%3F%28index%3AInt32%2C%26%3APointer%28T%29%2CIndex-%3E%29%3AIndex%7CNil-instance-method">#allocate_at?</a></code> but raises when already allocated.</p> </div>   </div> <div class="entry-detail" id="allocate_at?(index:Int32,&amp;:Pointer(T),Index-&gt;):Index|Nil-instance-method"> <h3 class="signature">def <strong>allocate_at?</strong>(index : <a href="../../../int32.html">Int32</a>, &amp; : <a href="../../../pointer.html">Pointer</a>(T), <a href="arena/index.html">Index</a> -&gt; ) : <a href="arena/index.html">Index</a> | <a href="../../../nil.html">Nil</a><a href="https://github.com/crystal-lang/crystal/blob/89944bf17/src/crystal/event_loop/polling/arena.cr#L101" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Allocates the object at <em>index</em> unless already allocated, then yields a pointer to the object at <em>index</em> and the current generation index to later retrieve and free the allocated object. Eventually returns the generation index.</p> <p>Does nothing if the object has already been allocated and returns <code>nil</code>.</p> <p>There are no generational checks. Raises if <em>index</em> is out of bounds.</p> </div>   </div> <div class="entry-detail" id="each_index(&amp;):Nil-instance-method"> <h3 class="signature">def <strong>each_index</strong>(&amp;) : <a href="../../../nil.html">Nil</a><a href="https://github.com/crystal-lang/crystal/blob/89944bf17/src/crystal/event_loop/polling/arena.cr#L227" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Iterates all allocated objects, yields the actual index as well as the generation index.</p> </div>   </div> <div class="entry-detail" id="free(index:Index,&amp;):Nil-instance-method"> <h3 class="signature">def <strong>free</strong>(index : <a href="arena/index.html">Index</a>, &amp;) : <a href="../../../nil.html">Nil</a><a href="https://github.com/crystal-lang/crystal/blob/89944bf17/src/crystal/event_loop/polling/arena.cr#L149" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Yields the object previously allocated at <em>index</em> then releases it.</p> <p>Does nothing if the object isn't allocated, the generation has changed or <em>index</em> is out of bounds.</p> </div>   </div> <div class="entry-detail" id="get(index:Index,&amp;):Nil-instance-method"> <h3 class="signature">def <strong>get</strong>(index : <a href="arena/index.html">Index</a>, &amp;) : <a href="../../../nil.html">Nil</a><a href="https://github.com/crystal-lang/crystal/blob/89944bf17/src/crystal/event_loop/polling/arena.cr#L126" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Yields a pointer to the object previously allocated at <em>index</em>.</p> <p>Raises if the object isn't allocated, the generation has changed (i.e. the object has been freed then reallocated) or <em>index</em> is out of bounds.</p> </div>   </div> <div class="entry-detail" id="get?(index:Index,&amp;):Bool-instance-method"> <h3 class="signature">def <strong>get?</strong>(index : <a href="arena/index.html">Index</a>, &amp;) : <a href="../../../bool.html">Bool</a><a href="https://github.com/crystal-lang/crystal/blob/89944bf17/src/crystal/event_loop/polling/arena.cr#L137" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Yields a pointer to the object previously allocated at <em>index</em> and returns true.</p> <p>Does nothing if the object isn't allocated, the generation has changed or <em>index</em> is out of bounds.</p> </div>   </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2012&ndash;2025 Manas Technology Solutions.<br>Licensed under the Apache License, Version 2.0.<br>
    <a href="https://crystal-lang.org/api/1.15.1/Crystal/EventLoop/Polling/Arena.html" class="_attribution-link">https://crystal-lang.org/api/1.15.1/Crystal/EventLoop/Polling/Arena.html</a>
  </p>
</div>
