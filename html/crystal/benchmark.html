<h1 class="type-name"> module Benchmark </h1> <h2>  Overview </h2> <p>The Benchmark module provides methods for benchmarking Crystal code, giving detailed reports on the time and memory taken for each task.</p> <p>NOTE To use <code><a href="benchmark.html">Benchmark</a></code>, you must explicitly import it with <code>require "benchmark"</code></p> <h3>
Measure the number of iterations per second of each task</h3> <pre data-language="crystal">require "benchmark"

Benchmark.ips do |x|
  x.report("short sleep") { sleep 0.01 }
  x.report("shorter sleep") { sleep 0.001 }
end</pre> <p>This generates the following output showing the mean iterations per second, the mean times per iteration, the standard deviation relative to the mean, and a comparison:</p> <pre data-language="crystal">  short sleep   88.7  ( 11.27ms) (± 3.33%)  8.90× slower
shorter sleep  789.7  (  1.27ms) (± 3.02%)       fastest</pre> <p><code><a href="benchmark/ips.html">Benchmark::IPS</a></code> defaults to 2 seconds of warmup time and 5 seconds of calculation time. This can be configured:</p> <pre data-language="crystal">require "benchmark"

Benchmark.ips(warmup: 4, calculation: 10) do |x|
  x.report("sleep") { sleep 0.01 }
end</pre> <h3>
Measure the time to construct the string given by the expression: <code>"a"*1_000_000_000</code>
</h3> <pre data-language="crystal">require "benchmark"

puts Benchmark.measure { "a"*1_000_000_000 }</pre> <p>This generates the following output:</p> <pre data-language="crystal"> 0.190000   0.220000   0.410000 (  0.420185)</pre> <p>This report shows the user CPU time, system CPU time, the sum of the user and system CPU times, and the elapsed real time. The unit of time is seconds.</p> <h3>
Do some experiments sequentially using the <code><a href="benchmark.html#bm%28%26%29-instance-method">#bm</a></code> method:</h3> <pre data-language="crystal">require "benchmark"

n = 5000000
Benchmark.bm do |x|
  x.report("times:") do
    n.times do
      a = "1"
    end
  end
  x.report("upto:") do
    1.upto(n) do
      a = "1"
    end
  end
end</pre> <p>The result:</p> <pre data-language="crystal">           user     system      total        real
times:   0.010000   0.000000   0.010000 (  0.008976)
upto:    0.010000   0.000000   0.010000 (  0.010466)</pre> <p>NOTE Make sure to always benchmark code by compiling with the <code>--release</code> flag.</p> <h2>  Extended Modules </h2> <ul class="other-types-list"> <li class="other-type"><a href="benchmark.html">Benchmark</a></li> </ul> <h2>  Defined in: </h2> <a href="https://github.com/crystal-lang/crystal/blob/0aa30372c/src/benchmark.cr#L85" target="_blank"> benchmark.cr </a> <br> <a href="https://github.com/crystal-lang/crystal/blob/0aa30372c/src/benchmark/bm.cr#L1" target="_blank"> benchmark/bm.cr </a> <br> <a href="https://github.com/crystal-lang/crystal/blob/0aa30372c/src/benchmark/ips.cr#L1" target="_blank"> benchmark/ips.cr </a> <br> <h2>  Instance Method Summary </h2> <ul class="list-summary"> <li class="entry-summary"> <a href="#bm%28%26%29-instance-method" class="signature"><strong>#bm</strong>(&amp;)</a> <div class="summary"><p>Main interface of the <code><a href="benchmark.html">Benchmark</a></code> module.</p></div> </li> <li class="entry-summary"> <a href="#ips%28calculation%3D5%2Cwarmup%3D2%2Cinteractive%3DSTDOUT.tty%3F%2C%26%29-instance-method" class="signature"><strong>#ips</strong>(calculation = 5, warmup = 2, interactive = STDOUT.tty?, &amp;)</a> <div class="summary"><p>Instruction per second interface of the <code><a href="benchmark.html">Benchmark</a></code> module.</p></div> </li> <li class="entry-summary"> <a href="#measure%28label%3D%22%22%2C%26%29%3ABM%3A%3ATms-instance-method" class="signature"><strong>#measure</strong>(label = "", &amp;) : BM::Tms</a> <div class="summary"><p>Returns the time used to execute the given block.</p></div> </li> <li class="entry-summary"> <a href="#memory%28%26%29-instance-method" class="signature"><strong>#memory</strong>(&amp;)</a> <div class="summary"><p>Returns the memory in bytes that the given block consumes.</p></div> </li> <li class="entry-summary"> <a href="#realtime%28%26%29%3ATime%3A%3ASpan-instance-method" class="signature"><strong>#realtime</strong>(&amp;) : Time::Span</a> <div class="summary"><p>Returns the elapsed real time used to execute the given block.</p></div> </li> </ul>  <h2>  Instance Method Detail </h2> <div class="entry-detail" id="bm(&amp;)-instance-method"> <h3 class="signature">def <strong>bm</strong>(&amp;)<a href="https://github.com/crystal-lang/crystal/blob/0aa30372c/src/benchmark.cr#L90" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Main interface of the <code><a href="benchmark.html">Benchmark</a></code> module. Yields a <code>Job</code> to which one can report the benchmarks. See the module's description.</p> </div>   </div> <div class="entry-detail" id="ips(calculation=5,warmup=2,interactive=STDOUT.tty?,&amp;)-instance-method"> <h3 class="signature">def <strong>ips</strong>(calculation = 5, warmup = 2, interactive = STDOUT.tty?, &amp;)<a href="https://github.com/crystal-lang/crystal/blob/0aa30372c/src/benchmark.cr#L108" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Instruction per second interface of the <code><a href="benchmark.html">Benchmark</a></code> module. Yields a <code>Job</code> to which one can report the benchmarks. See the module's description.</p> <p>The optional parameters <em>calculation</em> and <em>warmup</em> set the duration of those stages in seconds. For more detail on these stages see <code><a href="benchmark/ips.html">Benchmark::IPS</a></code>. When the <em>interactive</em> parameter is <code>true</code>, results are displayed and updated as they are calculated, otherwise all at once after they finished.</p> </div>   </div> <div class="entry-detail" id='measure(label="",&amp;):BM::Tms-instance-method'> <h3 class="signature">def <strong>measure</strong>(label = "", &amp;) : <a href="benchmark/bm/tms.html">BM::Tms</a><a href="https://github.com/crystal-lang/crystal/blob/0aa30372c/src/benchmark.cr#L121" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Returns the time used to execute the given block.</p> </div>   </div> <div class="entry-detail" id="memory(&amp;)-instance-method"> <h3 class="signature">def <strong>memory</strong>(&amp;)<a href="https://github.com/crystal-lang/crystal/blob/0aa30372c/src/benchmark.cr#L147" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Returns the memory in bytes that the given block consumes.</p> <pre data-language="crystal">Benchmark.memory { Array(Int32).new } # =&gt; 32</pre> </div>   </div> <div class="entry-detail" id="realtime(&amp;):Time::Span-instance-method"> <h3 class="signature">def <strong>realtime</strong>(&amp;) : <a href="time/span.html">Time::Span</a><a href="https://github.com/crystal-lang/crystal/blob/0aa30372c/src/benchmark.cr#L138" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Returns the elapsed real time used to execute the given block.</p> <pre data-language="crystal">Benchmark.realtime { "a" * 100_000 } # =&gt; 00:00:00.0005840</pre> </div>   </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2012&ndash;2024 Manas Technology Solutions.<br>Licensed under the Apache License, Version 2.0.<br>
    <a href="https://crystal-lang.org/api/1.11.1/Benchmark.html" class="_attribution-link">https://crystal-lang.org/api/1.11.1/Benchmark.html</a>
  </p>
</div>
