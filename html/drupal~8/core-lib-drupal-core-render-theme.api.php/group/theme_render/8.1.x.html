<h1 id="page-subtitle">Render API overview</h1>      <p>Overview of the Theme system and Render API.</p> <p>The main purpose of Drupal's Theme system is to give themes complete control over the appearance of the site, which includes the markup returned from HTTP requests and the CSS files used to style that markup. In order to ensure that a theme can completely customize the markup, module developers should avoid directly writing HTML markup for pages, blocks, and other user-visible output in their modules, and instead return structured "render arrays" (see <a href="#arrays">Render arrays</a> below). Doing this also increases usability, by ensuring that the markup used for similar functionality on different areas of the site is the same, which gives users fewer user interface patterns to learn.</p> <p>For further information on the Theme and Render APIs, see:</p> <ul> <li><a href="https://www.drupal.org/documentation/theme">https://www.drupal.org/documentation/theme</a></li> <li><a href="https://www.drupal.org/developing/api/8/render">https://www.drupal.org/developing/api/8/render</a></li> <li><a href="https://www.drupal.org/node/722174">https://www.drupal.org/node/722174</a></li> <li><a href="https://www.drupal.org/node/933976">https://www.drupal.org/node/933976</a></li> <li><a href="https://www.drupal.org/node/930760">https://www.drupal.org/node/930760</a></li> </ul> <p>@todo Check these links. Some are for Drupal 7, and might need updates for Drupal 8.</p> <h3 id="arrays">Render arrays</h3> <p>The core structure of the Render API is the render array, which is a hierarchical associative array containing data to be rendered and properties describing how the data should be rendered. A render array that is returned by a function to specify markup to be sent to the web browser or other services will eventually be rendered by a call to <a href="../../../core-includes-common.inc/function/drupal_render/8.1.x.html" title="Renders HTML given a structured array tree." class="local">drupal_render</a>(), which will recurse through the render array hierarchy if appropriate, making calls into the theme system to do the actual rendering. If a function or method actually needs to return rendered output rather than a render array, the best practice would be to create a render array, render it by calling <a href="../../../core-includes-common.inc/function/drupal_render/8.1.x.html" title="Renders HTML given a structured array tree." class="local">drupal_render</a>(), and return that result, rather than writing the markup directly. See the documentation of <a href="../../../core-includes-common.inc/function/drupal_render/8.1.x.html" title="Renders HTML given a structured array tree." class="local">drupal_render</a>() for more details of the rendering process.</p> <p>Each level in the hierarchy of a render array (including the outermost array) has one or more array elements. Array elements whose names start with '#' are known as "properties", and the array elements with other names are "children" (constituting the next level of the hierarchy); the names of children are flexible, while property names are specific to the Render API and the particular type of data being rendered. A special case of render arrays is a form array, which specifies the form elements for an HTML form; see the <a href="../../../core-core.api.php/group/form_api/8.1.x.html" title="Describes how to generate and manipulate forms and process form submissions." class="local">Form generation topic</a> for more information on forms.</p> <p>Render arrays (at each level in the hierarchy) will usually have one of the following three properties defined:</p> <ul> <li>
<strong>#type</strong>: Specifies that the array contains data and options for a particular type of "render element" (examples: 'form', for an HTML form; 'textfield', 'submit', and other HTML form element types; 'table', for a table with rows, columns, and headers). See <a href="#elements">Render elements</a> below for more on render element types.</li> <li>
<strong>#theme</strong>: Specifies that the array contains data to be themed by a particular theme hook. Modules define theme hooks by implementing <a href="../../function/hook_theme/8.1.x.html" title="Register a module or theme's theme implementations." class="local">hook_theme</a>(), which specifies the input "variables" used to provide data and options; if a <a href="../../function/hook_theme/8.1.x.html" title="Register a module or theme's theme implementations." class="local">hook_theme</a>() implementation specifies variable 'foo', then in a render array, you would provide this data using property '#foo'. Modules implementing <a href="../../function/hook_theme/8.1.x.html" title="Register a module or theme's theme implementations." class="local">hook_theme</a>() also need to provide a default implementation for each of their theme hooks, normally in a Twig file. For more information and to discover available theme hooks, see the documentation of <a href="../../function/hook_theme/8.1.x.html" title="Register a module or theme's theme implementations." class="local">hook_theme</a>() and the <a href="../themeable/8.1.x.html" title="Functions and templates for the user interface that themes can override." class="local">Default theme implementations topic.</a>
</li> <li>
<strong>#markup</strong>: Specifies that the array provides HTML markup directly. Unless the markup is very simple, such as an explanation in a paragraph tag, it is normally preferable to use #theme or #type instead, so that the theme can customize the markup. Note that the value is passed through <a href="../../../core-lib-drupal-component-utility-xss.php/function/xss-filteradmin/8.1.x.html" title="Applies a very permissive XSS/HTML filter for admin-only use." class="local">\Drupal\Component\Utility\Xss::filterAdmin</a>(), which strips known XSS vectors while allowing a permissive list of HTML tags that are not XSS vectors. (I.e, &lt;script&gt; and &lt;style&gt; are not allowed.) See <a href="../../../core-lib-drupal-component-utility-xss.php/class/xss/8.1.x.html" title="Provides helper to filter for cross-site scripting." class="local">\Drupal\Component\Utility\Xss</a>::$adminTags for the list of tags that will be allowed. If your markup needs any of the tags that are not in this whitelist, then you can implement a theme hook and template file and/or an asset library. Aternatively, you can use the render array key #allowed_tags to alter which tags are filtered.</li> <li>
<strong>#plain_text</strong>: Specifies that the array provides text that needs to be escaped. This value takes precedence over #markup if present.</li> <li>
<strong>#allowed_tags</strong>: If #markup is supplied this can be used to change which tags are using to filter the markup. The value should be an array of tags that Xss::filter() would accept. If #plain_text is set this value is ignored.</li> </ul> <p>Usage example:</p> <pre class="php" data-language="php">  $output['admin_filtered_string'] = array(
    '#markup' =&gt; '&lt;em&gt;This is filtered using the admin tag list&lt;/em&gt;',
  );
  $output['filtered_string'] = array(
    '#markup' =&gt; '&lt;em&gt;This is filtered&lt;/em&gt;',
    '#allowed_tags' =&gt; ['strong'],
  );
  $output['escaped_string'] = array(
    '#plain_text' =&gt; '&lt;em&gt;This is escaped&lt;/em&gt;',
  );
  </pre>
<p> JavaScript and CSS assets are specified in the render array using the #attached property (see <a href="#sec_attached">Attaching libraries in render arrays</a>).</p> <h3 id="elements">Render elements</h3> <p>Render elements are defined by Drupal core and modules. The primary way to define a render element is to create a render element plugin. There are two types of render element plugins:</p> <ul> <li>
<strong>Generic elements</strong>: Generic render element plugins implement <a href="../../../core-lib-drupal-core-render-element-elementinterface.php/interface/elementinterface/8.1.x.html" title="Provides an interface for render element plugins." class="local">\Drupal\Core\Render\Element\ElementInterface</a>, are annotated with <a href="../../../core-lib-drupal-core-render-annotation-renderelement.php/class/renderelement/8.1.x.html" title="Defines a render element plugin annotation object." class="local">\Drupal\Core\Render\Annotation\RenderElement</a> annotation, go in plugin namespace Element, and generally extend the <a href="../../../core-lib-drupal-core-render-element-renderelement.php/class/renderelement/8.1.x.html" title="Provides a base class for render element plugins." class="local">\Drupal\Core\Render\Element\RenderElement</a> base class.</li> <li>
<strong>Form input elements</strong>: Render elements representing form input elements implement <a href="../../../core-lib-drupal-core-render-element-formelementinterface.php/interface/formelementinterface/8.1.x.html" title="Provides an interface for form element plugins." class="local">\Drupal\Core\Render\Element\FormElementInterface</a>, are annotated with <a href="../../../core-lib-drupal-core-render-annotation-formelement.php/class/formelement/8.1.x.html" title="Defines a form element plugin annotation object." class="local">\Drupal\Core\Render\Annotation\FormElement</a> annotation, go in plugin namespace Element, and generally extend the <a href="../../../core-lib-drupal-core-render-element-formelement.php/class/formelement/8.1.x.html" title="Provides a base class for form element plugins." class="local">\Drupal\Core\Render\Element\FormElement</a> base class.</li> </ul> <p>See the <a href="../../../core-core.api.php/group/plugin_api/8.1.x.html" title="Using the Plugin API" class="local">Plugin API topic</a> for general information on plugins. You can search for classes with the RenderElement or FormElement annotation to discover what render elements are available. API reference sites (such as <a href="https://api.drupal.org">https://api.drupal.org</a>) generate lists of all existing elements from these classes. Look for the Elements link in the API Navigation block.</p> <p>Modules can define render elements by defining an element plugin.</p> <h3 id="sec_caching">Caching</h3> <p>The Drupal rendering process has the ability to cache rendered output at any level in a render array hierarchy. This allows expensive calculations to be done infrequently, and speeds up page loading. See the <a href="../../../core-core.api.php/group/cache/8.1.x.html" title="Information about the Drupal Cache API" class="local">Cache API topic</a> for general information about the cache system.</p> <p>In order to make caching possible, the following information needs to be present:</p> <ul> <li>
<strong>Cache keys</strong>: Identifiers for cacheable portions of render arrays. These should be created and added for portions of a render array that involve expensive calculations in the rendering process.</li> <li>
<strong>Cache contexts</strong>: Contexts that may affect rendering, such as user role and language. When no context is specified, it means that the render array does not vary by any context.</li> <li>
<strong>Cache tags</strong>: Tags for data that rendering depends on, such as for individual nodes or user accounts, so that when these change the cache can be automatically invalidated. If the data consists of entities, you can use <a href="../../../core-lib-drupal-core-cache-cacheabledependencyinterface.php/function/cacheabledependencyinterface-getcachetags/8.1.x.html" title="The cache tags associated with this object." class="local">\Drupal\Core\Entity\EntityInterface::getCacheTags</a>() to generate appropriate tags; configuration objects have a similar method.</li> <li>
<strong>Cache max-age</strong>: The maximum duration for which a render array may be cached. Defaults to <a href="../../../core-lib-drupal-core-cache-cache.php/class/cache/8.1.x.html" title="Helper methods for cache." class="local">\Drupal\Core\Cache\Cache</a>::PERMANENT (permanently cacheable).</li> </ul> <p>Cache information is provided in the #cache property in a render array. In this property, always supply the cache contexts, tags, and max-age if a render array varies by context, depends on some modifiable data, or depends on information that's only valid for a limited time, respectively. Cache keys should only be set on the portions of a render array that should be cached. Contexts are automatically replaced with the value for the current request (e.g. the current language) and combined with the keys to form a cache ID. The cache contexts, tags, and max-age will be propagated up the render array hierarchy to determine cacheability for containing render array sections.</p> <p>Here's an example of what a #cache property might contain:</p> <pre class="php" data-language="php">  '#cache' =&gt; [
    'keys' =&gt; ['entity_view', 'node', $node-&gt;id()],
    'contexts' =&gt; ['languages'],
    'tags' =&gt; ['node:' . $node-&gt;id()],
    'max-age' =&gt; Cache::PERMANENT,
  ],
</pre>
<p> At the response level, you'll see X-Drupal-Cache-Contexts and X-Drupal-Cache-Tags headers.</p> <p>See <a href="https://www.drupal.org/developing/api/8/render/arrays/cacheability">https://www.drupal.org/developing/api/8/render/arrays/cacheability</a> for details.</p> <h3 id="sec_attached">Attaching libraries in render arrays</h3> <p>Libraries, JavaScript settings, feeds, HTML &lt;head&gt; tags and HTML &lt;head&gt; links are attached to elements using the #attached property. The #attached property is an associative array, where the keys are the attachment types and the values are the attached data.</p> <p>The #attached property can also be used to specify HTTP headers and the response status code.</p> <p>The #attached property allows loading of asset libraries (which may contain CSS assets, JavaScript assets, and JavaScript setting assets), JavaScript settings, feeds, HTML &lt;head&gt; tags and HTML &lt;head&gt; links. Specify an array of type =&gt; value pairs, where the type (most often 'library' — for libraries, or 'drupalSettings' — for JavaScript settings) to attach these response-level values. Example:</p> <pre class="php" data-language="php">$build['#attached']['library'][] = 'core/jquery';
$build['#attached']['drupalSettings']['foo'] = 'bar';
$build['#attached']['feed'][] = [$url, $this-&gt;t('Feed title')];
</pre>
<p> See <a href="../../../core-lib-drupal-core-render-attachmentsresponseprocessorinterface.php/interface/attachmentsresponseprocessorinterface/8.1.x.html" title="Defines an interface for processing attachments of responses that have them." class="local">\Drupal\Core\Render\AttachmentsResponseProcessorInterface</a> for additional information.</p> <p>See <a href="../../../core-lib-drupal-core-asset-librarydiscoveryparser.php/function/librarydiscoveryparser-parselibraryinfo/8.1.x.html" title="Parses a given library file and allows modules and themes to alter it." class="local">\Drupal\Core\Asset\LibraryDiscoveryParser::parseLibraryInfo</a>() for more information on how to define libraries.</p> <h3 id="sec_placeholders">Placeholders in render arrays</h3> <p>Render arrays have a placeholder mechanism, which can be used to add data into the render array late in the rendering process. This works in a similar manner to <a href="../../../core-lib-drupal-component-render-formattablemarkup.php/function/formattablemarkup-placeholderformat/8.1.x.html" title="Replaces placeholders in a string with values." class="local">\Drupal\Component\Render\FormattableMarkup::placeholderFormat</a>(), with the text that ends up in the #markup property of the element at the end of the rendering process getting substitutions from placeholders that are stored in the 'placeholders' element of the #attached property.</p> <p>For example, after the rest of the rendering process was done, if your render array contained:</p> <pre class="php" data-language="php">$build['my_element'] = [
  '#attached' =&gt; ['placeholders' =&gt; ['@foo' =&gt; 'replacement']],
  '#markup' =&gt; ['Something about @foo'],
];
</pre>
<p> then #markup would end up containing 'Something about replacement'.</p> <p>Note that each placeholder value can itself be a render array, which will be rendered, and any cache tags generated during rendering will be added to the cache tags for the markup.</p> <h3 id="render_pipeline">The render pipeline</h3> <p>The term "render pipeline" refers to the process Drupal uses to take information provided by modules and render it into a response. See <a href="https://www.drupal.org/developing/api/8/render">https://www.drupal.org/developing/api/8/render</a> for more details on this process. For background on routing concepts, see <a href="../../../core-lib-drupal-core-routing-routing.api.php/group/routing/8.1.x.html" title="Route page requests to code based on URLs." class="local">Routing API.</a></p> <p>There are in fact multiple render pipelines:</p> <ul> <li>Drupal always uses the Symfony render pipeline. See <a href="http://symfony.com/doc/2.7/components/http_kernel/introduction.html">http://symfony.com/doc/2.7/components/http_kernel/introduction.html</a>
</li> <li>Within the Symfony render pipeline, there is a Drupal render pipeline, which handles controllers that return render arrays. (Symfony's render pipeline only knows how to deal with Response objects; this pipeline converts render arrays into Response objects.) These render arrays are considered the main content, and can be rendered into multiple formats: HTML, Ajax, dialog, and modal. Modules can add support for more formats, by implementing a main content renderer, which is a service tagged with 'render.main_content_renderer'.</li> <li>Finally, within the HTML main content renderer, there is another pipeline, to allow for rendering the page containing the main content in multiple ways: no decoration at all (just a page showing the main content) or blocks (a page with regions, with blocks positioned in regions around the main content). Modules can provide additional options, by implementing a page variant, which is a plugin annotated with <a href="../../../core-lib-drupal-core-display-annotation-pagedisplayvariant.php/class/pagedisplayvariant/8.1.x.html" title="Defines a page display variant annotation object." class="local">\Drupal\Core\Display\Annotation\PageDisplayVariant</a>.</li> </ul> <p>Routes whose controllers return a <a href="https://api.drupal.org/api/drupal/vendor%21symfony%21http-foundation%21Response.php/class/Response/8.1.x" title="Response represents an HTTP response." class="local">\Symfony\Component\HttpFoundation\Response</a> object are fully handled by the Symfony render pipeline.</p> <p>Routes whose controllers return the "main content" as a render array can be requested in multiple formats (HTML, JSON, etc.) and/or in a "decorated" manner, as described above.</p> <h3>See also</h3> <p> <a href="https://api.drupal.org/api/drupal/core%21core.libraries.yml/8.1.x" title="core/core.libraries.yml" class="local">core.libraries.yml</a></p> <p><a href="../../function/hook_theme/8.1.x.html" title="Register a module or theme's theme implementations." class="local">hook_theme</a>()</p> <p><a href="../themeable/8.1.x.html" title="Functions and templates for the user interface that themes can override." class="local">Theme system overview</a></p> <p><a href="https://api.drupal.org/api/drupal/vendor%21symfony%21http-kernel%21KernelEvents.php/class/KernelEvents/8.1.x" title="Contains all events thrown in the HttpKernel component." class="local">\Symfony\Component\HttpKernel\KernelEvents</a>::VIEW</p> <p><a href="../../../core-lib-drupal-core-eventsubscriber-maincontentviewsubscriber.php/class/maincontentviewsubscriber/8.1.x.html" title="View subscriber rendering main content render arrays into responses." class="local">\Drupal\Core\EventSubscriber\MainContentViewSubscriber</a></p> <p><a href="../../../core-lib-drupal-core-render-maincontent-maincontentrendererinterface.php/interface/maincontentrendererinterface/8.1.x.html" title='The interface for "main content" (' class="local">\Drupal\Core\Render\MainContent\MainContentRendererInterface</a></p> <p><a href="../../../core-lib-drupal-core-render-maincontent-htmlrenderer.php/class/htmlrenderer/8.1.x.html" title="Default main content renderer for HTML requests." class="local">\Drupal\Core\Render\MainContent\HtmlRenderer</a></p> <p><a href="../../../core-lib-drupal-core-render-renderevents.php/class/renderevents/8.1.x.html" title="Defines events for the render system." class="local">\Drupal\Core\Render\RenderEvents</a>::SELECT_PAGE_DISPLAY_VARIANT</p> <p><a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Render%21Plugin%21DisplayVariant%21SimplePageVariant.php/class/SimplePageVariant/8.1.x" title="Provides a page display variant that simply renders the main content." class="local">\Drupal\Core\Render\Plugin\DisplayVariant\SimplePageVariant</a></p> <p><a href="https://api.drupal.org/api/drupal/core%21modules%21block%21src%21Plugin%21DisplayVariant%21BlockPageVariant.php/class/BlockPageVariant/8.1.x" title="Provides a page display variant that decorates the main content with blocks." class="local">\Drupal\block\Plugin\DisplayVariant\BlockPageVariant</a></p> <p><a href="../../../core-lib-drupal-core-render-barehtmlpagerenderer.php/class/barehtmlpagerenderer/8.1.x.html" title="Default bare HTML page renderer." class="local">\Drupal\Core\Render\BareHtmlPageRenderer</a></p> <h3>File</h3> 
<dl> <dt>core/lib/Drupal/Core/Render/<a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Render%21theme.api.php/8.1.x">theme.api.php</a>, line 210</dt> <dd>Hooks and documentation related to the theme and render system.</dd> </dl> <h3>Classes</h3>  <table> <thead> <tr> <th scope="col"> Name </th> <th scope="col"> Location </th> <th scope="col"> Description </th> </tr> </thead> <tbody> <tr> <td data-th="Name"> <a href="../../../core-lib-drupal-core-render-element.php/class/element/8.1.x.html">Element</a> </td> <td data-th="Location"> core/lib/Drupal/Core/Render/<a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Render%21Element.php/8.1.x">Element.php</a> </td> <td data-th="Description"> Provides helper methods for Drupal render elements. </td> </tr> <tr> <td data-th="Name"> <a href="../../../core-lib-drupal-core-render-annotation-formelement.php/class/formelement/8.1.x.html">FormElement</a> </td> <td data-th="Location"> core/lib/Drupal/Core/Render/Annotation/<a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Render%21Annotation%21FormElement.php/8.1.x">FormElement.php</a> </td> <td data-th="Description"> Defines a form element plugin annotation object. </td> </tr> <tr> <td data-th="Name"> <a href="../../../core-lib-drupal-core-render-element-formelement.php/class/formelement/8.1.x.html">FormElement</a> </td> <td data-th="Location"> core/lib/Drupal/Core/Render/Element/<a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Render%21Element%21FormElement.php/8.1.x">FormElement.php</a> </td> <td data-th="Description"> Provides a base class for form element plugins. </td> </tr> <tr> <td data-th="Name"> <a href="../../../core-lib-drupal-core-render-annotation-renderelement.php/class/renderelement/8.1.x.html">RenderElement</a> </td> <td data-th="Location"> core/lib/Drupal/Core/Render/Annotation/<a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Render%21Annotation%21RenderElement.php/8.1.x">RenderElement.php</a> </td> <td data-th="Description"> Defines a render element plugin annotation object. </td> </tr> <tr> <td data-th="Name"> <a href="../../../core-lib-drupal-core-render-element-renderelement.php/class/renderelement/8.1.x.html">RenderElement</a> </td> <td data-th="Location"> core/lib/Drupal/Core/Render/Element/<a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Render%21Element%21RenderElement.php/8.1.x">RenderElement.php</a> </td> <td data-th="Description"> Provides a base class for render element plugins. </td> </tr> </tbody> </table>  <h3>Interfaces</h3>  <table> <thead> <tr> <th scope="col"> Name </th> <th scope="col"> Location </th> <th scope="col"> Description </th> </tr> </thead> <tbody> <tr> <td data-th="Name"> <a href="../../../core-lib-drupal-core-render-element-elementinterface.php/interface/elementinterface/8.1.x.html">ElementInterface</a> </td> <td data-th="Location"> core/lib/Drupal/Core/Render/Element/<a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Render%21Element%21ElementInterface.php/8.1.x">ElementInterface.php</a> </td> <td data-th="Description"> Provides an interface for render element plugins. </td> </tr> <tr> <td data-th="Name"> <a href="../../../core-lib-drupal-core-render-element-formelementinterface.php/interface/formelementinterface/8.1.x.html">FormElementInterface</a> </td> <td data-th="Location"> core/lib/Drupal/Core/Render/Element/<a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Render%21Element%21FormElementInterface.php/8.1.x">FormElementInterface.php</a> </td> <td data-th="Description"> Provides an interface for form element plugins. </td> </tr> </tbody> </table><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2001&ndash;2016 by the original authors<br>Licensed under the GNU General Public License, version 2 and later.<br>Drupal is a registered trademark of Dries Buytaert.<br>
    <a href="https://api.drupal.org/api/drupal/core!lib!Drupal!Core!Render!theme.api.php/group/theme_render/8.1.x" class="_attribution-link">https://api.drupal.org/api/drupal/core!lib!Drupal!Core!Render!theme.api.php/group/theme_render/8.1.x</a>
  </p>
</div>
