<h1 id="page-subtitle">class Merge</h1>      <p>General class for an abstracted MERGE query operation.</p> <p>An ANSI SQL:2003 compatible database would run the following query:</p> <pre class="php" data-language="php">MERGE INTO table_name_1 USING table_name_2 ON (condition)
  WHEN MATCHED THEN
  UPDATE SET column1 = value1 [, column2 = value2 ...]
  WHEN NOT MATCHED THEN
  INSERT (column1 [, column2 ...]) VALUES (value1 [, value2 ...
</pre>
<p> Other databases (most notably MySQL, PostgreSQL and SQLite) will emulate this statement by running a SELECT and then INSERT or UPDATE.</p> <p>By default, the two table names are identical and they are passed into the the constructor. table_name_2 can be specified by the MergeQuery::conditionTable() method. It can be either a string or a subquery.</p> <p>The condition is built exactly like SelectQuery or UpdateQuery conditions, the UPDATE query part is built similarly like an UpdateQuery and finally the INSERT query part is built similarly like an InsertQuery. However, both UpdateQuery and InsertQuery has a fields method so MergeQuery::updateFields() and MergeQuery::insertFields() needs to be called instead. MergeQuery::fields() can also be called which calls both of these methods as the common case is to use the same column-value pairs for both INSERT and UPDATE. However, this is not mandatory. Another convenient wrapper is MergeQuery::key() which adds the same column-value pairs to the condition and the INSERT query part.</p> <p>Several methods (<a href="http://php.net/key" title="mixed key(array $array)
  Fetch a key from an array" class="php-manual">key</a>(), fields(), insertFields()) can be called to set a key-value pair for the INSERT query part. Subsequent calls for the same fields override the earlier ones. The same is true for UPDATE and <a href="http://php.net/key" title="mixed key(array $array)
  Fetch a key from an array" class="php-manual">key</a>(), fields() and updateFields().</p> <h3>Hierarchy</h3> <ul>
<li class="first last">class \Drupal\Core\Database\Query\<a href="../../../core-lib-drupal-core-database-query-query.php/class/query/8.1.x.html" class="">Query</a> implements <a href="../../../core-lib-drupal-core-database-query-placeholderinterface.php/interface/placeholderinterface/8.1.x.html">PlaceholderInterface</a><ul>
<li class="first last">class \Drupal\Core\Database\Query\<a href="8.1.x.html" class="active active">Merge</a> implements <a href="../../../core-lib-drupal-core-database-query-conditioninterface.php/interface/conditioninterface/8.1.x.html">ConditionInterface</a> uses <a href="../../../core-lib-drupal-core-database-query-queryconditiontrait.php/trait/queryconditiontrait/8.1.x.html">QueryConditionTrait</a>
</li> </ul>
</li> </ul>
  <h3>File</h3> 
<dl> <dt>core/lib/Drupal/Core/Database/Query/<a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Database%21Query%21Merge.php/8.1.x">Merge.php</a>, line 46</dt>  </dl> <h3>Namespace</h3> <a href="https://api.drupal.org/api/drupal/namespace/Drupal%21Core%21Database%21Query/8.1.x">Drupal\Core\Database\Query</a>  <h3>Members</h3>   <table> <thead> <tr> <th scope="col"> Name </th> <th scope="col"> Modifiers </th> <th scope="col"> Type </th> <th scope="col"> Description </th> </tr> </thead> <tbody> <tr> <td data-th="Name"> <a href="../../property/merge-conditiontable/8.1.x.html">Merge::$conditionTable</a> </td> <td data-th="Modifiers"> protected </td> <td data-th="Type"> property </td> <td data-th="Description"> The table or subquery to be used for the condition. </td> </tr> <tr> <td data-th="Name"> <a href="../../property/merge-defaultfields/8.1.x.html">Merge::$defaultFields</a> </td> <td data-th="Modifiers"> protected </td> <td data-th="Type"> property </td> <td data-th="Description"> An array of fields which should be set to their database-defined defaults. </td> </tr> <tr> <td data-th="Name"> <a href="../../property/merge-expressionfields/8.1.x.html">Merge::$expressionFields</a> </td> <td data-th="Modifiers"> protected </td> <td data-th="Type"> property </td> <td data-th="Description"> Array of fields to update to an expression in case of a duplicate record. </td> </tr> <tr> <td data-th="Name"> <a href="../../property/merge-insertfields/8.1.x.html">Merge::$insertFields</a> </td> <td data-th="Modifiers"> protected </td> <td data-th="Type"> property </td> <td data-th="Description"> An array of fields on which to insert. </td> </tr> <tr> <td data-th="Name"> <a href="../../property/merge-insertvalues/8.1.x.html">Merge::$insertValues</a> </td> <td data-th="Modifiers"> protected </td> <td data-th="Type"> property </td> <td data-th="Description"> An array of values to be inserted. </td> </tr> <tr> <td data-th="Name"> <a href="../../property/merge-needsupdate/8.1.x.html">Merge::$needsUpdate</a> </td> <td data-th="Modifiers"> protected </td> <td data-th="Type"> property </td> <td data-th="Description"> Flag indicating whether an UPDATE is necessary. </td> </tr> <tr> <td data-th="Name"> <a href="../../property/merge-table/8.1.x.html">Merge::$table</a> </td> <td data-th="Modifiers"> protected </td> <td data-th="Type"> property </td> <td data-th="Description"> The table to be used for INSERT and UPDATE. </td> </tr> <tr> <td data-th="Name"> <a href="../../property/merge-updatefields/8.1.x.html">Merge::$updateFields</a> </td> <td data-th="Modifiers"> protected </td> <td data-th="Type"> property </td> <td data-th="Description"> An array of fields that will be updated. </td> </tr> <tr> <td data-th="Name"> <a href="../../function/merge-conditiontable/8.1.x.html">Merge::conditionTable</a> </td> <td data-th="Modifiers"> protected </td> <td data-th="Type"> function </td> <td data-th="Description"> Sets the table or subquery to be used for the condition. </td> </tr> <tr> <td data-th="Name"> <a href="../../function/merge-execute/8.1.x.html">Merge::execute</a> </td> <td data-th="Modifiers"> public </td> <td data-th="Type"> function </td> <td data-th="Description"> Runs the query against the database. <em class="api-inheritance-source">Overrides <a href="../../../core-lib-drupal-core-database-query-query.php/function/query-execute/8.1.x.html">Query::execute</a></em> </td> </tr> <tr> <td data-th="Name"> <a href="../../function/merge-expression/8.1.x.html">Merge::expression</a> </td> <td data-th="Modifiers"> public </td> <td data-th="Type"> function </td> <td data-th="Description"> Specifies fields to be updated as an expression. </td> </tr> <tr> <td data-th="Name"> <a href="../../function/merge-fields/8.1.x.html">Merge::fields</a> </td> <td data-th="Modifiers"> public </td> <td data-th="Type"> function </td> <td data-th="Description"> Sets common field-value pairs in the INSERT and UPDATE query parts. </td> </tr> <tr> <td data-th="Name"> <a href="../../function/merge-insertfields/8.1.x.html">Merge::insertFields</a> </td> <td data-th="Modifiers"> public </td> <td data-th="Type"> function </td> <td data-th="Description"> Adds a set of field-&gt;value pairs to be inserted. </td> </tr> <tr> <td data-th="Name"> <a href="../../function/merge-key/8.1.x.html">Merge::key</a> </td> <td data-th="Modifiers"> public </td> <td data-th="Type"> function </td> <td data-th="Description"> Sets a single key field to be used as condition for this query. </td> </tr> <tr> <td data-th="Name"> <a href="../../function/merge-keys/8.1.x.html">Merge::keys</a> </td> <td data-th="Modifiers"> public </td> <td data-th="Type"> function </td> <td data-th="Description"> Sets the key fields to be used as conditions for this query. </td> </tr> <tr> <td data-th="Name"> <a href="../../constant/merge-status_insert/8.1.x.html">Merge::STATUS_INSERT</a> </td> <td data-th="Modifiers"> </td> <td data-th="Type"> constant </td> <td data-th="Description"> Returned by execute() if an INSERT query has been executed. </td> </tr> <tr> <td data-th="Name"> <a href="../../constant/merge-status_update/8.1.x.html">Merge::STATUS_UPDATE</a> </td> <td data-th="Modifiers"> </td> <td data-th="Type"> constant </td> <td data-th="Description"> Returned by execute() if an UPDATE query has been executed. </td> </tr> <tr> <td data-th="Name"> <a href="../../function/merge-updatefields/8.1.x.html">Merge::updateFields</a> </td> <td data-th="Modifiers"> public </td> <td data-th="Type"> function </td> <td data-th="Description"> Adds a set of field-&gt;value pairs to be updated. </td> </tr> <tr> <td data-th="Name"> <a href="../../function/merge-usedefaults/8.1.x.html">Merge::useDefaults</a> </td> <td data-th="Modifiers"> public </td> <td data-th="Type"> function </td> <td data-th="Description"> Specifies fields for which the database-defaults should be used. </td> </tr> <tr> <td data-th="Name"> <a href="../../function/merge-__construct/8.1.x.html">Merge::__construct</a> </td> <td data-th="Modifiers"> public </td> <td data-th="Type"> function </td> <td data-th="Description"> Constructs a Merge object. <em class="api-inheritance-source">Overrides <a href="../../../core-lib-drupal-core-database-query-query.php/function/query-__construct/8.1.x.html">Query::__construct</a></em> </td> </tr> <tr> <td data-th="Name"> <a href="../../function/merge-__tostring/8.1.x.html">Merge::__toString</a> </td> <td data-th="Modifiers"> public </td> <td data-th="Type"> function </td> <td data-th="Description"> Implements PHP magic __toString method to convert the query to a string. <em class="api-inheritance-source">Overrides <a href="../../../core-lib-drupal-core-database-query-query.php/function/query-__tostring/8.1.x.html">Query::__toString</a></em> </td> </tr> <tr> <td data-th="Name"> <a href="../../../core-lib-drupal-core-database-query-query.php/property/query-comments/8.1.x.html">Query::$comments</a> </td> <td data-th="Modifiers"> protected </td> <td data-th="Type"> property </td> <td data-th="Description"> An array of comments that can be prepended to a query. </td> </tr> <tr> <td data-th="Name"> <a href="../../../core-lib-drupal-core-database-query-query.php/property/query-connection/8.1.x.html">Query::$connection</a> </td> <td data-th="Modifiers"> protected </td> <td data-th="Type"> property </td> <td data-th="Description"> The connection object on which to run this query. </td> </tr> <tr> <td data-th="Name"> <a href="../../../core-lib-drupal-core-database-query-query.php/property/query-connectionkey/8.1.x.html">Query::$connectionKey</a> </td> <td data-th="Modifiers"> protected </td> <td data-th="Type"> property </td> <td data-th="Description"> The key of the connection object. </td> </tr> <tr> <td data-th="Name"> <a href="../../../core-lib-drupal-core-database-query-query.php/property/query-connectiontarget/8.1.x.html">Query::$connectionTarget</a> </td> <td data-th="Modifiers"> protected </td> <td data-th="Type"> property </td> <td data-th="Description"> The target of the connection object. </td> </tr> <tr> <td data-th="Name"> <a href="../../../core-lib-drupal-core-database-query-query.php/property/query-nextplaceholder/8.1.x.html">Query::$nextPlaceholder</a> </td> <td data-th="Modifiers"> protected </td> <td data-th="Type"> property </td> <td data-th="Description"> The placeholder counter. </td> </tr> <tr> <td data-th="Name"> <a href="../../../core-lib-drupal-core-database-query-query.php/property/query-queryoptions/8.1.x.html">Query::$queryOptions</a> </td> <td data-th="Modifiers"> protected </td> <td data-th="Type"> property </td> <td data-th="Description"> The query options to pass on to the connection object. </td> </tr> <tr> <td data-th="Name"> <a href="../../../core-lib-drupal-core-database-query-query.php/property/query-uniqueidentifier/8.1.x.html">Query::$uniqueIdentifier</a> </td> <td data-th="Modifiers"> protected </td> <td data-th="Type"> property </td> <td data-th="Description"> A unique identifier for this query object. </td> </tr> <tr> <td data-th="Name"> <a href="../../../core-lib-drupal-core-database-query-query.php/function/query-comment/8.1.x.html">Query::comment</a> </td> <td data-th="Modifiers"> public </td> <td data-th="Type"> function </td> <td data-th="Description"> Adds a comment to the query. </td> </tr> <tr> <td data-th="Name"> <a href="../../../core-lib-drupal-core-database-query-query.php/function/query-getcomments/8.1.x.html">Query::getComments</a> </td> <td data-th="Modifiers"> public </td> <td data-th="Type"> function </td> <td data-th="Description"> Returns a reference to the comments array for the query. </td> </tr> <tr> <td data-th="Name"> <a href="../../../core-lib-drupal-core-database-query-query.php/function/query-nextplaceholder/8.1.x.html">Query::nextPlaceholder</a> </td> <td data-th="Modifiers"> public </td> <td data-th="Type"> function </td> <td data-th="Description"> Gets the next placeholder value for this query object. <em class="api-inheritance-source">Overrides <a href="../../../core-lib-drupal-core-database-query-placeholderinterface.php/function/placeholderinterface-nextplaceholder/8.1.x.html">PlaceholderInterface::nextPlaceholder</a></em> </td> </tr> <tr> <td data-th="Name"> <a href="../../../core-lib-drupal-core-database-query-query.php/function/query-uniqueidentifier/8.1.x.html">Query::uniqueIdentifier</a> </td> <td data-th="Modifiers"> public </td> <td data-th="Type"> function </td> <td data-th="Description"> Returns a unique identifier for this object. <em class="api-inheritance-source">Overrides <a href="../../../core-lib-drupal-core-database-query-placeholderinterface.php/function/placeholderinterface-uniqueidentifier/8.1.x.html">PlaceholderInterface::uniqueIdentifier</a></em> </td> </tr> <tr> <td data-th="Name"> <a href="../../../core-lib-drupal-core-database-query-query.php/function/query-__clone/8.1.x.html">Query::__clone</a> </td> <td data-th="Modifiers"> public </td> <td data-th="Type"> function </td> <td data-th="Description"> Implements the magic __clone function. </td> </tr> <tr> <td data-th="Name"> <a href="../../../core-lib-drupal-core-database-query-query.php/function/query-__sleep/8.1.x.html">Query::__sleep</a> </td> <td data-th="Modifiers"> public </td> <td data-th="Type"> function </td> <td data-th="Description"> Implements the magic __sleep function to disconnect from the database. </td> </tr> <tr> <td data-th="Name"> <a href="../../../core-lib-drupal-core-database-query-query.php/function/query-__wakeup/8.1.x.html">Query::__wakeup</a> </td> <td data-th="Modifiers"> public </td> <td data-th="Type"> function </td> <td data-th="Description"> Implements the magic __wakeup function to reconnect to the database. </td> </tr> <tr> <td data-th="Name"> <a href="../../../core-lib-drupal-core-database-query-queryconditiontrait.php/property/queryconditiontrait-condition/8.1.x.html">QueryConditionTrait::$condition</a> </td> <td data-th="Modifiers"> protected </td> <td data-th="Type"> property </td> <td data-th="Description"> The condition object for this query. </td> </tr> <tr> <td data-th="Name"> <a href="../../../core-lib-drupal-core-database-query-queryconditiontrait.php/function/queryconditiontrait-andconditiongroup/8.1.x.html">QueryConditionTrait::andConditionGroup</a> </td> <td data-th="Modifiers"> public </td> <td data-th="Type"> function </td> <td data-th="Description"> Creates a new group of conditions ANDed together. <em class="api-inheritance-source">Overrides <a href="../../../core-lib-drupal-core-database-query-conditioninterface.php/function/conditioninterface-andconditiongroup/8.1.x.html">ConditionInterface::andConditionGroup</a></em> </td> </tr> <tr> <td data-th="Name"> <a href="../../../core-lib-drupal-core-database-query-queryconditiontrait.php/function/queryconditiontrait-arguments/8.1.x.html">QueryConditionTrait::arguments</a> </td> <td data-th="Modifiers"> public </td> <td data-th="Type"> function </td> <td data-th="Description"> Gets a complete list of all values to insert into the prepared statement. <em class="api-inheritance-source">Overrides <a href="../../../core-lib-drupal-core-database-query-conditioninterface.php/function/conditioninterface-arguments/8.1.x.html">ConditionInterface::arguments</a></em> </td> </tr> <tr> <td data-th="Name"> <a href="../../../core-lib-drupal-core-database-query-queryconditiontrait.php/function/queryconditiontrait-compile/8.1.x.html">QueryConditionTrait::compile</a> </td> <td data-th="Modifiers"> public </td> <td data-th="Type"> function </td> <td data-th="Description"> Compiles the saved conditions for later retrieval. <em class="api-inheritance-source">Overrides <a href="../../../core-lib-drupal-core-database-query-conditioninterface.php/function/conditioninterface-compile/8.1.x.html">ConditionInterface::compile</a></em> </td> </tr> <tr> <td data-th="Name"> <a href="../../../core-lib-drupal-core-database-query-queryconditiontrait.php/function/queryconditiontrait-compiled/8.1.x.html">QueryConditionTrait::compiled</a> </td> <td data-th="Modifiers"> public </td> <td data-th="Type"> function </td> <td data-th="Description"> Check whether a condition has been previously compiled. <em class="api-inheritance-source">Overrides <a href="../../../core-lib-drupal-core-database-query-conditioninterface.php/function/conditioninterface-compiled/8.1.x.html">ConditionInterface::compiled</a></em> </td> </tr> <tr> <td data-th="Name"> <a href="../../../core-lib-drupal-core-database-query-queryconditiontrait.php/function/queryconditiontrait-condition/8.1.x.html">QueryConditionTrait::condition</a> </td> <td data-th="Modifiers"> public </td> <td data-th="Type"> function </td> <td data-th="Description"> Helper function: builds the most common conditional clauses. <em class="api-inheritance-source">Overrides <a href="../../../core-lib-drupal-core-database-query-conditioninterface.php/function/conditioninterface-condition/8.1.x.html">ConditionInterface::condition</a></em> </td> </tr> <tr> <td data-th="Name"> <a href="../../../core-lib-drupal-core-database-query-queryconditiontrait.php/function/queryconditiontrait-conditiongroupfactory/8.1.x.html">QueryConditionTrait::conditionGroupFactory</a> </td> <td data-th="Modifiers"> public </td> <td data-th="Type"> function </td> <td data-th="Description"> Creates an object holding a group of conditions. <em class="api-inheritance-source">Overrides <a href="../../../core-lib-drupal-core-database-query-conditioninterface.php/function/conditioninterface-conditiongroupfactory/8.1.x.html">ConditionInterface::conditionGroupFactory</a></em> </td> </tr> <tr> <td data-th="Name"> <a href="../../../core-lib-drupal-core-database-query-queryconditiontrait.php/function/queryconditiontrait-conditions/8.1.x.html">QueryConditionTrait::conditions</a> </td> <td data-th="Modifiers"> public </td> <td data-th="Type"> function </td> <td data-th="Description"> Gets a complete list of all conditions in this conditional clause. <em class="api-inheritance-source">Overrides <a href="../../../core-lib-drupal-core-database-query-conditioninterface.php/function/conditioninterface-conditions/8.1.x.html">ConditionInterface::conditions</a></em> </td> </tr> <tr> <td data-th="Name"> <a href="../../../core-lib-drupal-core-database-query-queryconditiontrait.php/function/queryconditiontrait-exists/8.1.x.html">QueryConditionTrait::exists</a> </td> <td data-th="Modifiers"> public </td> <td data-th="Type"> function </td> <td data-th="Description"> Sets a condition that the specified subquery returns values. <em class="api-inheritance-source">Overrides <a href="../../../core-lib-drupal-core-database-query-conditioninterface.php/function/conditioninterface-exists/8.1.x.html">ConditionInterface::exists</a></em> </td> </tr> <tr> <td data-th="Name"> <a href="../../../core-lib-drupal-core-database-query-queryconditiontrait.php/function/queryconditiontrait-isnotnull/8.1.x.html">QueryConditionTrait::isNotNull</a> </td> <td data-th="Modifiers"> public </td> <td data-th="Type"> function </td> <td data-th="Description"> Sets a condition that the specified field be NOT NULL. <em class="api-inheritance-source">Overrides <a href="../../../core-lib-drupal-core-database-query-conditioninterface.php/function/conditioninterface-isnotnull/8.1.x.html">ConditionInterface::isNotNull</a></em> </td> </tr> <tr> <td data-th="Name"> <a href="../../../core-lib-drupal-core-database-query-queryconditiontrait.php/function/queryconditiontrait-isnull/8.1.x.html">QueryConditionTrait::isNull</a> </td> <td data-th="Modifiers"> public </td> <td data-th="Type"> function </td> <td data-th="Description"> Sets a condition that the specified field be NULL. <em class="api-inheritance-source">Overrides <a href="../../../core-lib-drupal-core-database-query-conditioninterface.php/function/conditioninterface-isnull/8.1.x.html">ConditionInterface::isNull</a></em> </td> </tr> <tr> <td data-th="Name"> <a href="../../../core-lib-drupal-core-database-query-queryconditiontrait.php/function/queryconditiontrait-notexists/8.1.x.html">QueryConditionTrait::notExists</a> </td> <td data-th="Modifiers"> public </td> <td data-th="Type"> function </td> <td data-th="Description"> Sets a condition that the specified subquery returns no values. <em class="api-inheritance-source">Overrides <a href="../../../core-lib-drupal-core-database-query-conditioninterface.php/function/conditioninterface-notexists/8.1.x.html">ConditionInterface::notExists</a></em> </td> </tr> <tr> <td data-th="Name"> <a href="../../../core-lib-drupal-core-database-query-queryconditiontrait.php/function/queryconditiontrait-orconditiongroup/8.1.x.html">QueryConditionTrait::orConditionGroup</a> </td> <td data-th="Modifiers"> public </td> <td data-th="Type"> function </td> <td data-th="Description"> Creates a new group of conditions ORed together. <em class="api-inheritance-source">Overrides <a href="../../../core-lib-drupal-core-database-query-conditioninterface.php/function/conditioninterface-orconditiongroup/8.1.x.html">ConditionInterface::orConditionGroup</a></em> </td> </tr> <tr> <td data-th="Name"> <a href="../../../core-lib-drupal-core-database-query-queryconditiontrait.php/function/queryconditiontrait-where/8.1.x.html">QueryConditionTrait::where</a> </td> <td data-th="Modifiers"> public </td> <td data-th="Type"> function </td> <td data-th="Description"> Adds an arbitrary WHERE clause to the query. <em class="api-inheritance-source">Overrides <a href="../../../core-lib-drupal-core-database-query-conditioninterface.php/function/conditioninterface-where/8.1.x.html">ConditionInterface::where</a></em> </td> </tr> </tbody> </table><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2001&ndash;2016 by the original authors<br>Licensed under the GNU General Public License, version 2 and later.<br>Drupal is a registered trademark of Dries Buytaert.<br>
    <a href="https://api.drupal.org/api/drupal/core!lib!Drupal!Core!Database!Query!Merge.php/class/Merge/8.1.x" class="_attribution-link">https://api.drupal.org/api/drupal/core!lib!Drupal!Core!Database!Query!Merge.php/class/Merge/8.1.x</a>
  </p>
</div>
