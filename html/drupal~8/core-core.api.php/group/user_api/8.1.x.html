<h1 id="page-subtitle">User accounts, permissions, and roles</h1>      <p>API for user accounts, access checking, roles, and permissions.</p> <h3 id="sec_overview">Overview and terminology</h3> <p>Drupal's permission system is based on the concepts of accounts, roles, and permissions.</p> <p>Users (site visitors) have accounts, which include a user name, an email address, a password (or some other means of authentication), and possibly other fields (if defined on the site). Anonymous users have an implicit account that does not have a real user name or any account information.</p> <p>Each user account is assigned one or more roles. The anonymous user account automatically has the anonymous user role; real user accounts automatically have the authenticated user role, plus any roles defined on the site that they have been assigned.</p> <p>Each role, including the special anonymous and authenticated user roles, is granted one or more named permissions, which allow them to perform certain tasks or view certain content on the site. It is possible to designate a role to be the "administrator" role; if this is set up, this role is automatically granted all available permissions whenever a module is enabled that defines permissions.</p> <p>All code in Drupal that allows users to perform tasks or view content must check that the current user has the correct permission before allowing the action. In the standard case, access checking consists of answering the question "Does the current user have permission 'foo'?", and allowing or denying access based on the answer. Note that access checking should nearly always be done at the permission level, not by checking for a particular role or user ID, so that site administrators can set up user accounts and roles appropriately for their particular sites.</p> <h3 id="sec_define">Defining permissions</h3> <p>Modules define permissions via a $module.permissions.yml file. See <a href="https://api.drupal.org/api/drupal/core%21modules%21user%21src%21PermissionHandler.php/class/PermissionHandler/8.1.x" title="Provides the available permissions based on yml files." class="local">\Drupal\user\PermissionHandler</a> for documentation of permissions.yml files.</p> <h3 id="sec_access">Access permission checking</h3> <p>Depending on the situation, there are several methods for ensuring that access checks are done properly in Drupal:</p> <ul> <li>
<strong>Routes</strong>: When you register a route, include a 'requirements' section that either gives the machine name of the permission that is needed to visit the URL of the route, or tells Drupal to use an access check method or service to check access. See the <a href="../../../core-lib-drupal-core-menu-menu.api.php/group/menu/8.1.x.html" title="Define the navigation menus, local actions and tasks, and contextual links." class="local">Routing topic</a> for more information.</li> <li>
<strong>Entities</strong>: Access for various entity operations is designated either with simple permissions or access control handler classes in the entity annotation. See the <a href="../../../core-lib-drupal-core-entity-entity.api.php/group/entity_api/8.1.x.html" title="Describes how to define and manipulate content and configuration entities." class="local">Entity API topic</a> for more information.</li> <li>
<strong>Other code</strong>: There is a 'current_user' service, which can be injected into classes to provide access to the current user account (see the <a href="../container/8.1.x.html" title="Overview of the Dependency Injection Container and Services." class="local">Services and Dependency Injection topic</a> for more information on dependency injection). In code that cannot use dependency injection, you can access this service and retrieve the current user account object by calling <a href="../../../core-lib-drupal.php/function/drupal-currentuser/8.1.x.html" title="Gets the current active user." class="local">\Drupal::currentUser</a>(). Once you have a user object for the current user (implementing <a href="https://api.drupal.org/api/drupal/core%21modules%21user%21src%21UserInterface.php/interface/UserInterface/8.1.x" title="Provides an interface defining a user entity." class="local">\Drupal\user\UserInterface</a>), you can call inherited method <a href="../../../core-lib-drupal-core-session-accountinterface.php/function/accountinterface-haspermission/8.1.x.html" title="Checks whether a user has a certain permission." class="local">\Drupal\Core\Session\AccountInterface::hasPermission</a>() to check permissions, or pass this object into other functions/methods.</li> <li>
<strong>Forms</strong>: Each element of a form array can have a Boolean '#access' property, which determines whether that element is visible and/or usable. This is a common need in forms, so the current user service (described above) is injected into the form base class as method <a href="../../../core-lib-drupal-core-form-formbase.php/function/formbase-currentuser/8.1.x.html" title="Gets the current user." class="local">\Drupal\Core\Form\FormBase::currentUser</a>().</li> </ul> <h3 id="sec_entities">User and role objects</h3> <p>User objects in Drupal are entity items, implementing <a href="https://api.drupal.org/api/drupal/core%21modules%21user%21src%21UserInterface.php/interface/UserInterface/8.1.x" title="Provides an interface defining a user entity." class="local">\Drupal\user\UserInterface</a>. Role objects in Drupal are also entity items, implementing <a href="https://api.drupal.org/api/drupal/core%21modules%21user%21src%21RoleInterface.php/interface/RoleInterface/8.1.x" title="Provides an interface defining a user role entity." class="local">\Drupal\user\RoleInterface</a>. See the <a href="../../../core-lib-drupal-core-entity-entity.api.php/group/entity_api/8.1.x.html" title="Describes how to define and manipulate content and configuration entities." class="local">Entity API topic</a> for more information about entities in general (including how to load, create, modify, and query them).</p> <p>Roles often need to be manipulated in automated test code, such as to add permissions to them. Here's an example:</p> <pre class="php" data-language="php">$role = \Drupal\user\Entity\Role::load('authenticated');
$role-&gt;grantPermission('access comments');
$role-&gt;save();
</pre>
<p> Other important interfaces:</p> <ul> <li>
<strong><a href="../../../core-lib-drupal-core-session-accountinterface.php/interface/accountinterface/8.1.x.html" title="Defines an account interface which represents the current user." class="local">\Drupal\Core\Session\AccountInterface</a></strong>: The part of UserInterface that deals with access checking. In writing code that checks access, your method parameters should use this interface, not UserInterface.</li> <li>
<strong><a href="../../../core-lib-drupal-core-session-accountproxyinterface.php/interface/accountproxyinterface/8.1.x.html" title="Defines an interface for a service which has the current account stored." class="local">\Drupal\Core\Session\AccountProxyInterface</a></strong>: The interface for the current_user service (described above).</li> </ul> <h3>File</h3> 
<dl> <dt>core/<a href="https://api.drupal.org/api/drupal/core%21core.api.php/8.1.x">core.api.php</a>, line 616</dt> <dd>Documentation landing page and topics, plus core library hooks.</dd> </dl> <h3>Interfaces</h3>  <table> <thead> <tr> <th scope="col"> Name </th> <th scope="col"> Location </th> <th scope="col"> Description </th> </tr> </thead> <tbody> <tr> <td data-th="Name"> <a href="../../../core-lib-drupal-core-session-accountinterface.php/interface/accountinterface/8.1.x.html">AccountInterface</a> </td> <td data-th="Location"> core/lib/Drupal/Core/Session/<a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Session%21AccountInterface.php/8.1.x">AccountInterface.php</a> </td> <td data-th="Description"> Defines an account interface which represents the current user. </td> </tr> <tr> <td data-th="Name"> <a href="../../../core-lib-drupal-core-session-accountproxyinterface.php/interface/accountproxyinterface/8.1.x.html">AccountProxyInterface</a> </td> <td data-th="Location"> core/lib/Drupal/Core/Session/<a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Session%21AccountProxyInterface.php/8.1.x">AccountProxyInterface.php</a> </td> <td data-th="Description"> Defines an interface for a service which has the current account stored. </td> </tr> <tr> <td data-th="Name"> <a href="../../../core-lib-drupal-core-session-accountswitcherinterface.php/interface/accountswitcherinterface/8.1.x.html">AccountSwitcherInterface</a> </td> <td data-th="Location"> core/lib/Drupal/Core/Session/<a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Session%21AccountSwitcherInterface.php/8.1.x">AccountSwitcherInterface.php</a> </td> <td data-th="Description"> Defines an interface for a service for safe account switching. </td> </tr> <tr> <td data-th="Name"> <a href="https://api.drupal.org/api/drupal/core%21modules%21user%21src%21RoleInterface.php/interface/RoleInterface/8.1.x">RoleInterface</a> </td> <td data-th="Location"> core/modules/user/src/<a href="https://api.drupal.org/api/drupal/core%21modules%21user%21src%21RoleInterface.php/8.1.x">RoleInterface.php</a> </td> <td data-th="Description"> Provides an interface defining a user role entity. </td> </tr> <tr> <td data-th="Name"> <a href="https://api.drupal.org/api/drupal/core%21modules%21user%21src%21UserInterface.php/interface/UserInterface/8.1.x">UserInterface</a> </td> <td data-th="Location"> core/modules/user/src/<a href="https://api.drupal.org/api/drupal/core%21modules%21user%21src%21UserInterface.php/8.1.x">UserInterface.php</a> </td> <td data-th="Description"> Provides an interface defining a user entity. </td> </tr> </tbody> </table><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2001&ndash;2016 by the original authors<br>Licensed under the GNU General Public License, version 2 and later.<br>Drupal is a registered trademark of Dries Buytaert.<br>
    <a href="https://api.drupal.org/api/drupal/core!core.api.php/group/user_api/8.1.x" class="_attribution-link">https://api.drupal.org/api/drupal/core!core.api.php/group/user_api/8.1.x</a>
  </p>
</div>
