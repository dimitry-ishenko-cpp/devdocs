<h1 id="page-subtitle">Cache API</h1>      <p>Information about the Drupal Cache API</p> <h3 id="basics">Basics</h3> <p>Note: If not specified, all of the methods mentioned here belong to <a href="../../../core-lib-drupal-core-cache-cachebackendinterface.php/interface/cachebackendinterface/8.1.x.html" title="Defines an interface for cache implementations." class="local">\Drupal\Core\Cache\CacheBackendInterface</a>.</p> <p>The Cache API is used to store data that takes a long time to compute. Caching can either be permanent or valid only for a certain timespan, and the cache can contain any type of data.</p> <p>To use the Cache API:</p> <ul> <li>Request a cache object through <a href="../../../core-lib-drupal.php/function/drupal-cache/8.1.x.html" title="Returns the requested cache bin." class="local">\Drupal::cache</a>() or by injecting a cache service.</li> <li>Define a Cache ID (cid) value for your data. A cid is a string, which must contain enough information to uniquely identify the data. For example, if your data contains translated strings, then your cid value must include the interface text language selected for page.</li> <li>Call the get() method to attempt a cache read, to see if the cache already contains your data.</li> <li>If your data is not already in the cache, compute it and add it to the cache using the set() method. The third argument of set() can be used to control the lifetime of your cache item.</li> </ul> <p>Example:</p> <pre class="php" data-language="php">$cid = 'mymodule_example:' . \Drupal::languageManager()-&gt;getCurrentLanguage()-&gt;getId();

$data = NULL;
if ($cache = \Drupal::cache()-&gt;get($cid)) {
  $data = $cache-&gt;data;
}
else {
  $data = my_module_complicated_calculation();
  \Drupal::cache()-&gt;set($cid, $data);
}
</pre>
<p> Note the use of $data and $cache-&gt;data in the above example. Calls to <a href="../../../core-lib-drupal.php/function/drupal-cache/8.1.x.html" title="Returns the requested cache bin." class="local">\Drupal::cache</a>()-&gt;get() return a record that contains the information stored by <a href="../../../core-lib-drupal.php/function/drupal-cache/8.1.x.html" title="Returns the requested cache bin." class="local">\Drupal::cache</a>()-&gt;set() in the data property as well as additional meta information about the cached data. In order to make use of the cached data you can access it via $cache-&gt;data.</p> <h3 id="bins">Cache bins</h3> <p>Cache storage is separated into "bins", each containing various cache items. Each bin can be configured separately; see <a href="#configuration">Configuration</a>.</p> <p>When you request a cache object, you can specify the bin name in your call to <a href="../../../core-lib-drupal.php/function/drupal-cache/8.1.x.html" title="Returns the requested cache bin." class="local">\Drupal::cache</a>(). Alternatively, you can request a bin by getting service "cache.nameofbin" from the container. The default bin is called "default", with service name "cache.default", it is used to store common and frequently used caches.</p> <p>Other common cache bins are the following:</p> <ul> <li>
<strong>bootstrap</strong>: Data needed from the beginning to the end of most requests, that has a very strict limit on variations and is invalidated rarely.</li> <li>
<strong>render</strong>: Contains cached HTML strings like cached pages and blocks, can grow to large size.</li> <li>
<strong>data</strong>: Contains data that can vary by path or similar context.</li> <li>
<strong>discovery</strong>: Contains cached discovery data for things such as plugins, views_data, or YAML discovered data such as library info.</li> </ul> <p>A module can define a cache bin by defining a service in its modulename.services.yml file as follows (substituting the desired name for "nameofbin"):</p> <pre class="php" data-language="php">cache.nameofbin:
  class: Drupal\Core\Cache\CacheBackendInterface
  tags:
    - { name: cache.bin }
  factory: cache_factory:get
  arguments: [nameofbin]
</pre>
<p> See the <a href="../container/8.1.x.html" title="Overview of the Dependency Injection Container and Services." class="local">Services topic</a> for more on defining services.</p> <h3 id="delete">Deletion</h3> <p>There are two ways to remove an item from the cache:</p> <ul> <li>Deletion (using <a href="http://php.net/delete" title=" delete()
  See unlink or unset" class="php-manual">delete</a>(), deleteMultiple() or deleteAll()) permanently removes the item from the cache.</li> <li>Invalidation (using invalidate(), invalidateMultiple() or invalidateAll()) is a "soft" delete that only marks items as "invalid", meaning "not fresh" or "not fresh enough". Invalid items are not usually returned from the cache, so in most ways they behave as if they have been deleted. However, it is possible to retrieve invalid items, if they have not yet been permanently removed by the garbage collector, by passing TRUE as the second argument for get($cid, $allow_invalid).</li> </ul> <p>Use deletion if a cache item is no longer useful; for instance, if the item contains references to data that has been deleted. Use invalidation if the cached item may still be useful to some callers until it has been updated with fresh data. The fact that it was fresh a short while ago may often be sufficient.</p> <p>Invalidation is particularly useful to protect against stampedes. Rather than having multiple concurrent requests updating the same cache item when it expires or is deleted, there can be one request updating the cache, while the other requests can proceed using the stale value. As soon as the cache item has been updated, all future requests will use the updated value.</p> <h3 id="tags">Cache Tags</h3> <p>The fourth argument of the set() method can be used to specify cache tags, which are used to identify which data is included in each cache item. A cache item can have multiple cache tags (an array of cache tags), and each cache tag is a string. The convention is to generate cache tags of the form [prefix]:[suffix]. Usually, you'll want to associate the cache tags of entities, or entity listings. You won't have to manually construct cache tags for them â€” just get their cache tags via <a href="../../../core-lib-drupal-core-cache-cacheabledependencyinterface.php/function/cacheabledependencyinterface-getcachetags/8.1.x.html" title="The cache tags associated with this object." class="local">\Drupal\Core\Cache\CacheableDependencyInterface::getCacheTags</a>() and <a href="../../../core-lib-drupal-core-entity-entitytypeinterface.php/function/entitytypeinterface-getlistcachetags/8.1.x.html" title="The list cache tags associated with this entity type." class="local">\Drupal\Core\Entity\EntityTypeInterface::getListCacheTags</a>(). Data that has been tagged can be invalidated as a group: no matter the Cache ID (cid) of the cache item, no matter in which cache bin a cache item lives; as long as it is tagged with a certain cache tag, it will be invalidated.</p> <p>Because of that, cache tags are a solution to the cache invalidation problem:</p> <ul> <li>For caching to be effective, each cache item must only be invalidated when absolutely necessary. (i.e. maximizing the cache hit ratio.)</li> <li>For caching to be correct, each cache item that depends on a certain thing must be invalidated whenever that certain thing is modified.</li> </ul> <p>A typical scenario: a user has modified a node that appears in two views, three blocks and on twelve pages. Without cache tags, we couldn't possibly know which cache items to invalidate, so we'd have to invalidate everything: we had to sacrifice effectiveness to achieve correctness. With cache tags, we can have both.</p> <p>Example:</p> <pre class="php" data-language="php">// A cache item with nodes, users, and some custom module data.
$tags = array(
  'my_custom_tag',
  'node:1',
  'node:3',
  'user:7',
);
\Drupal::cache()-&gt;set($cid, $data, CacheBackendInterface::CACHE_PERMANENT, $tags);

// Invalidate all cache items with certain tags.
\Drupal\Core\Cache\Cache::invalidateTags(array('user:1'));
</pre>
<p> Drupal is a content management system, so naturally you want changes to your content to be reflected everywhere, immediately. That's why we made sure that every entity type in Drupal 8 automatically has support for cache tags: when you save an entity, you can be sure that the cache items that have the corresponding cache tags will be invalidated. This also is the case when you define your own entity types: you'll get the exact same cache tag invalidation as any of the built-in entity types, with the ability to override any of the default behavior if needed. See \Drupal\Core\Cache\CacheableDepenencyInterface::getCacheTags(), <a href="../../../core-lib-drupal-core-entity-entitytypeinterface.php/function/entitytypeinterface-getlistcachetags/8.1.x.html" title="The list cache tags associated with this entity type." class="local">\Drupal\Core\Entity\EntityTypeInterface::getListCacheTags</a>(), <a href="../../../core-lib-drupal-core-entity-entity.php/function/entity-invalidatetagsonsave/8.1.x.html" title="Invalidates an entity's cache tags upon save." class="local">\Drupal\Core\Entity\Entity::invalidateTagsOnSave</a>() and <a href="../../../core-lib-drupal-core-entity-entity.php/function/entity-invalidatetagsondelete/8.1.x.html" title="Invalidates an entity's cache tags upon delete." class="local">\Drupal\Core\Entity\Entity::invalidateTagsOnDelete</a>().</p> <h3 id="context">Cache contexts</h3> <p>Some computed data depends on contextual data, such as the user roles of the logged-in user who is viewing a page, the language the page is being rendered in, the theme being used, etc. When caching the output of such a calculation, you must cache each variation separately, along with information about which variation of the contextual data was used in the calculatation. The next time the computed data is needed, if the context matches that for an existing cached data set, the cached data can be reused; if no context matches, a new data set can be calculated and cached for later use.</p> <p>Cache contexts are services tagged with 'cache.context', whose classes implement <a href="../../../core-lib-drupal-core-cache-context-cachecontextinterface.php/interface/cachecontextinterface/8.1.x.html" title="Provides an interface for defining a cache context service." class="local">\Drupal\Core\Cache\Context\CacheContextInterface</a>. See <a href="https://www.drupal.org/developing/api/8/cache/contexts">https://www.drupal.org/developing/api/8/cache/contexts</a> for more information on cache contexts, including a list of the contexts that exist in Drupal core, and information on how to define your own contexts. See the <a href="../container/8.1.x.html" title="Overview of the Dependency Injection Container and Services." class="local">Services and the Dependency Injection Container</a> topic for more information about services.</p> <p>Typically, the cache context is specified as part of the #cache property of a render array; see the Caching section of the <a href="../../../core-lib-drupal-core-render-theme.api.php/group/theme_render/8.1.x.html" title="Overview of the Theme system and Render API." class="local">Render API overview topic</a> for details.</p> <h3 id="configuration">Configuration</h3> <p>By default cached data is stored in the database. This can be configured though so that all cached data, or that of an individual cache bin, uses a different cache backend, such as APCu or Memcache, for storage.</p> <p>In a settings.php file, you can override the service used for a particular cache bin. For example, if your service implementation of <a href="../../../core-lib-drupal-core-cache-cachebackendinterface.php/interface/cachebackendinterface/8.1.x.html" title="Defines an interface for cache implementations." class="local">\Drupal\Core\Cache\CacheBackendInterface</a> was called cache.custom, the following line would make Drupal use it for the 'cache_render' bin:</p> <pre class="php" data-language="php"> $settings['cache']['bins']['render'] = 'cache.custom';
</pre>
<p> Additionally, you can register your cache implementation to be used by default for all cache bins with:</p> <pre class="php" data-language="php"> $settings['cache']['default'] = 'cache.custom';
</pre>
<p> Finally, you can chain multiple cache backends together, see <a href="../../../core-lib-drupal-core-cache-chainedfastbackend.php/class/chainedfastbackend/8.1.x.html" title="Defines a backend with a fast and a consistent backend chain." class="local">\Drupal\Core\Cache\ChainedFastBackend</a> and <a href="../../../core-lib-drupal-core-cache-backendchain.php/class/backendchain/8.1.x.html" title="Defines a chained cache implementation for combining multiple cache backends." class="local">\Drupal\Core\Cache\BackendChain</a>.</p> <h3>See also</h3> <p> <a href="https://www.drupal.org/node/1884796">https://www.drupal.org/node/1884796</a></p> <h3>File</h3> 
<dl> <dt>core/<a href="https://api.drupal.org/api/drupal/core%21core.api.php/8.1.x">core.api.php</a>, line 405</dt> <dd>Documentation landing page and topics, plus core library hooks.</dd> </dl> <h3>Functions</h3>  <table> <thead> <tr> <th scope="col"> Name </th> <th scope="col"> Location </th> <th scope="col"> Description </th> </tr> </thead> <tbody> <tr> <td data-th="Name"> <a href="../../../core-lib-drupal.php/function/drupal-cache/8.1.x.html">Drupal::cache</a> </td> <td data-th="Location"> core/lib/<a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal.php/8.1.x">Drupal.php</a> </td> <td data-th="Description"> Returns the requested cache bin. </td> </tr> </tbody> </table>  <h3>Classes</h3>  <table> <thead> <tr> <th scope="col"> Name </th> <th scope="col"> Location </th> <th scope="col"> Description </th> </tr> </thead> <tbody> <tr> <td data-th="Name"> <a href="../../../core-lib-drupal-core-cache-backendchain.php/class/backendchain/8.1.x.html">BackendChain</a> </td> <td data-th="Location"> core/lib/Drupal/Core/Cache/<a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Cache%21BackendChain.php/8.1.x">BackendChain.php</a> </td> <td data-th="Description"> Defines a chained cache implementation for combining multiple cache backends. </td> </tr> <tr> <td data-th="Name"> <a href="../../../core-lib-drupal-core-cache-cache.php/class/cache/8.1.x.html">Cache</a> </td> <td data-th="Location"> core/lib/Drupal/Core/Cache/<a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Cache%21Cache.php/8.1.x">Cache.php</a> </td> <td data-th="Description"> Helper methods for cache. </td> </tr> <tr> <td data-th="Name"> <a href="../../../core-lib-drupal-core-cache-cacheablemetadata.php/class/cacheablemetadata/8.1.x.html">CacheableMetadata</a> </td> <td data-th="Location"> core/lib/Drupal/Core/Cache/<a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Cache%21CacheableMetadata.php/8.1.x">CacheableMetadata.php</a> </td> <td data-th="Description"> Defines a generic class for passing cacheability metadata. </td> </tr> <tr> <td data-th="Name"> <a href="../../../core-lib-drupal-core-cache-cachecollector.php/class/cachecollector/8.1.x.html">CacheCollector</a> </td> <td data-th="Location"> core/lib/Drupal/Core/Cache/<a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Cache%21CacheCollector.php/8.1.x">CacheCollector.php</a> </td> <td data-th="Description"> Default implementation for CacheCollectorInterface. </td> </tr> <tr> <td data-th="Name"> <a href="../../../core-lib-drupal-core-cache-chainedfastbackend.php/class/chainedfastbackend/8.1.x.html">ChainedFastBackend</a> </td> <td data-th="Location"> core/lib/Drupal/Core/Cache/<a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Cache%21ChainedFastBackend.php/8.1.x">ChainedFastBackend.php</a> </td> <td data-th="Description"> Defines a backend with a fast and a consistent backend chain. </td> </tr> <tr> <td data-th="Name"> <a href="../../../core-lib-drupal-core-cache-databasebackend.php/class/databasebackend/8.1.x.html">DatabaseBackend</a> </td> <td data-th="Location"> core/lib/Drupal/Core/Cache/<a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Cache%21DatabaseBackend.php/8.1.x">DatabaseBackend.php</a> </td> <td data-th="Description"> Defines a default cache implementation. </td> </tr> <tr> <td data-th="Name"> <a href="../../../core-lib-drupal-core-cache-memorybackend.php/class/memorybackend/8.1.x.html">MemoryBackend</a> </td> <td data-th="Location"> core/lib/Drupal/Core/Cache/<a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Cache%21MemoryBackend.php/8.1.x">MemoryBackend.php</a> </td> <td data-th="Description"> Defines a memory cache implementation. </td> </tr> <tr> <td data-th="Name"> <a href="../../../core-lib-drupal-core-cache-nullbackend.php/class/nullbackend/8.1.x.html">NullBackend</a> </td> <td data-th="Location"> core/lib/Drupal/Core/Cache/<a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Cache%21NullBackend.php/8.1.x">NullBackend.php</a> </td> <td data-th="Description"> Defines a stub cache implementation. </td> </tr> <tr> <td data-th="Name"> <a href="../../../core-lib-drupal-core-cache-phpbackend.php/class/phpbackend/8.1.x.html">PhpBackend</a> </td> <td data-th="Location"> core/lib/Drupal/Core/Cache/<a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Cache%21PhpBackend.php/8.1.x">PhpBackend.php</a> </td> <td data-th="Description"> Defines a PHP cache implementation. </td> </tr> </tbody> </table>  <h3>Interfaces</h3>  <table> <thead> <tr> <th scope="col"> Name </th> <th scope="col"> Location </th> <th scope="col"> Description </th> </tr> </thead> <tbody> <tr> <td data-th="Name"> <a href="../../../core-lib-drupal-core-cache-cacheabledependencyinterface.php/interface/cacheabledependencyinterface/8.1.x.html">CacheableDependencyInterface</a> </td> <td data-th="Location"> core/lib/Drupal/Core/Cache/<a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Cache%21CacheableDependencyInterface.php/8.1.x">CacheableDependencyInterface.php</a> </td> <td data-th="Description"> Defines an interface for objects which may be used by other cached objects. </td> </tr> <tr> <td data-th="Name"> <a href="../../../core-lib-drupal-core-cache-cachebackendinterface.php/interface/cachebackendinterface/8.1.x.html">CacheBackendInterface</a> </td> <td data-th="Location"> core/lib/Drupal/Core/Cache/<a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Cache%21CacheBackendInterface.php/8.1.x">CacheBackendInterface.php</a> </td> <td data-th="Description"> Defines an interface for cache implementations. </td> </tr> <tr> <td data-th="Name"> <a href="../../../core-lib-drupal-core-cache-cachecollectorinterface.php/interface/cachecollectorinterface/8.1.x.html">CacheCollectorInterface</a> </td> <td data-th="Location"> core/lib/Drupal/Core/Cache/<a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Cache%21CacheCollectorInterface.php/8.1.x">CacheCollectorInterface.php</a> </td> <td data-th="Description"> Provides a caching wrapper to be used in place of large structures. </td> </tr> <tr> <td data-th="Name"> <a href="../../../core-lib-drupal-core-cache-cachetagschecksuminterface.php/interface/cachetagschecksuminterface/8.1.x.html">CacheTagsChecksumInterface</a> </td> <td data-th="Location"> core/lib/Drupal/Core/Cache/<a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Cache%21CacheTagsChecksumInterface.php/8.1.x">CacheTagsChecksumInterface.php</a> </td> <td data-th="Description"> Provides checksums for cache tag invalidations. </td> </tr> <tr> <td data-th="Name"> <a href="../../../core-lib-drupal-core-cache-cachetagsinvalidatorinterface.php/interface/cachetagsinvalidatorinterface/8.1.x.html">CacheTagsInvalidatorInterface</a> </td> <td data-th="Location"> core/lib/Drupal/Core/Cache/<a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Cache%21CacheTagsInvalidatorInterface.php/8.1.x">CacheTagsInvalidatorInterface.php</a> </td> <td data-th="Description"> Defines required methods for classes wanting to handle cache tag changes. </td> </tr> </tbody> </table><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2001&ndash;2016 by the original authors<br>Licensed under the GNU General Public License, version 2 and later.<br>Drupal is a registered trademark of Dries Buytaert.<br>
    <a href="https://api.drupal.org/api/drupal/core!core.api.php/group/cache/8.1.x" class="_attribution-link">https://api.drupal.org/api/drupal/core!core.api.php/group/cache/8.1.x</a>
  </p>
</div>
