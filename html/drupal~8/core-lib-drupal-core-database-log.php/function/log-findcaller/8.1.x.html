<h1 id="page-subtitle">public function Log::findCaller</h1>     <pre class="signature">public <a href="../../class/log/8.1.x.html">Log</a>::findCaller()</pre> <p>Determine the routine that called this query.</p> <p>We define "the routine that called this query" as the first entry in the call stack that is not inside the includes/Drupal/Database directory, does not begin with db_ and does have a file (which excludes <a href="http://php.net/call_user_func_array" title="mixed call_user_func_array(callable $callback, array $param_arr)
  Call a callback with an array of parameters" class="php-manual">call_user_func_array</a>(), anonymous functions and similar). That makes the climbing logic very simple, and handles the variable stack depth caused by the query builders.</p> <p>See the <a href="http://php.net/debug_backtrace" title="array debug_backtrace([int $options = DEBUG_BACKTRACE_PROVIDE_OBJECT [, int $limit = '']])
  Generates a backtrace" class="php-manual">debug_backtrace</a>() function.</p> <h3>Return value</h3> <p> This method returns a stack trace entry similar to that generated by <a href="http://php.net/debug_backtrace" title="array debug_backtrace([int $options = DEBUG_BACKTRACE_PROVIDE_OBJECT [, int $limit = '']])
  Generates a backtrace" class="php-manual">debug_backtrace</a>(). However, it flattens the trace entry and the trace entry before it so that we get the function and args of the function that called into the database system, not the function and args of the database call itself.</p>  <h3>File</h3> 
<dl> <dt>core/lib/Drupal/Core/Database/<a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Database%21Log.php/8.1.x">Log.php</a>, line 144</dt>  </dl> <h3>Class</h3> 
<dl> <dt>
<a href="../../class/log/8.1.x.html">Log</a> </dt> <dd>Database query logger.</dd> </dl> <h3>Namespace</h3> <a href="https://api.drupal.org/api/drupal/namespace/Drupal%21Core%21Database/8.1.x">Drupal\Core\Database</a> <h3>Code</h3> <pre class="php" data-language="php">public function findCaller() {
  $stack = debug_backtrace();
  for ($i = 0, $stack_count = count($stack); $i &lt; $stack_count; ++$i) {
    // If the call was made from a function, 'class' will be empty. It's
    // just easier to give it a default value than to try and integrate
    // that into the if statement below.
    if (empty($stack[$i]['class'])) {
      $stack[$i]['class'] = '';
    }
    if (strpos($stack[$i]['class'], __NAMESPACE__) === FALSE &amp;&amp; strpos($stack[$i + 1]['function'], 'db_') === FALSE &amp;&amp; !empty($stack[$i]['file'])) {
      $stack[$i] += array('file' =&gt; '?', 'line' =&gt; '?', 'args' =&gt; array());
      return array(
        'file' =&gt; $stack[$i]['file'],
        'line' =&gt; $stack[$i]['line'],
        'function' =&gt; $stack[$i + 1]['function'],
        'class' =&gt; isset($stack[$i + 1]['class']) ? $stack[$i + 1]['class'] : NULL,
        'type' =&gt; isset($stack[$i + 1]['type']) ? $stack[$i + 1]['type'] : NULL,
        'args' =&gt; $stack[$i + 1]['args'],
      );
    }
  }
}
</pre><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2001&ndash;2016 by the original authors<br>Licensed under the GNU General Public License, version 2 and later.<br>Drupal is a registered trademark of Dries Buytaert.<br>
    <a href="https://api.drupal.org/api/drupal/core!lib!Drupal!Core!Database!Log.php/function/Log::findCaller/8.1.x" class="_attribution-link">https://api.drupal.org/api/drupal/core!lib!Drupal!Core!Database!Log.php/function/Log::findCaller/8.1.x</a>
  </p>
</div>
