<h1 id="page-subtitle">class EarlyRenderingControllerWrapperSubscriber</h1>      <p>Subscriber that wraps controllers, to handle early rendering.</p> <p>When controllers call <a href="../../../core-includes-common.inc/function/drupal_render/8.1.x.html" title="Renders HTML given a structured array tree." class="local">drupal_render</a>() (<a href="../../../core-lib-drupal-core-render-rendererinterface.php/function/rendererinterface-render/8.1.x.html" title="Renders HTML given a structured array tree." class="local">RendererInterface::render</a>()) outside of a render context, we call that "early rendering". Controllers should return only render arrays, but we cannot prevent controllers from doing early rendering. The problem with early rendering is that the bubbleable metadata (cacheability &amp; attachments) are lost.</p> <p>This can lead to broken pages (missing assets), stale pages (missing cache tags causing a page not to be invalidated) or even security problems (missing cache contexts causing a cached page not to be varied sufficiently).</p> <p>This event subscriber wraps all controller executions in a closure that sets up a render context. Consequently, any early rendering will have their bubbleable metadata (assets &amp; cacheability) stored on that render context.</p> <p>If the render context is empty, then the controller either did not do any rendering at all, or used the <a href="../../../core-lib-drupal-core-render-rendererinterface.php/function/rendererinterface-renderroot/8.1.x.html" title="Renders final HTML given a structured array tree." class="local">RendererInterface::renderRoot</a>() or ::renderPlain() methods. In that case, no bubbleable metadata is lost.</p> <p>If the render context is not empty, then the controller did use <a href="../../../core-includes-common.inc/function/drupal_render/8.1.x.html" title="Renders HTML given a structured array tree." class="local">drupal_render</a>(), and bubbleable metadata was collected. This bubbleable metadata is then merged onto the render array.</p> <p>In other words: this just exists to ease the transition to Drupal 8: it allows controllers that return render arrays (the majority) and \Drupal\Core\Ajax\AjaxResponse\AjaxResponse objects (a sizable minority that often involve a fair amount of rendering) to still do early rendering. But controllers that return any other kind of response are already expected to do the right thing, so if early rendering is detected in such a case, an exception is thrown.</p> <p>@todo Remove in Drupal 9.0.0, by disallowing early rendering.</p> <h3>Hierarchy</h3> <ul>
<li class="first last">class \Drupal\Core\EventSubscriber\<a href="8.1.x.html" class="active active">EarlyRenderingControllerWrapperSubscriber</a> implements <a href="https://api.drupal.org/api/drupal/vendor%21symfony%21event-dispatcher%21EventSubscriberInterface.php/interface/EventSubscriberInterface/8.1.x">EventSubscriberInterface</a>
</li> </ul>
 <h3>See also</h3> <p> <a href="../../../core-lib-drupal-core-render-rendererinterface.php/interface/rendererinterface/8.1.x.html" title="Defines an interface for turning a render array into a string." class="local">\Drupal\Core\Render\RendererInterface</a></p> <p><a href="../../../core-lib-drupal-core-render-renderer.php/class/renderer/8.1.x.html" title="Turns a render array into a HTML string." class="local">\Drupal\Core\Render\Renderer</a></p>  <h3>File</h3> 
<dl> <dt>core/lib/Drupal/Core/EventSubscriber/<a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21EventSubscriber%21EarlyRenderingControllerWrapperSubscriber.php/8.1.x">EarlyRenderingControllerWrapperSubscriber.php</a>, line 55</dt>  </dl> <h3>Namespace</h3> <a href="https://api.drupal.org/api/drupal/namespace/Drupal%21Core%21EventSubscriber/8.1.x">Drupal\Core\EventSubscriber</a>  <h3>Members</h3>   <table> <thead> <tr> <th scope="col"> Name </th> <th scope="col"> Modifiers </th> <th scope="col"> Type </th> <th scope="col"> Description </th> </tr> </thead> <tbody> <tr> <td data-th="Name"> <a href="../../property/earlyrenderingcontrollerwrappersubscriber-controllerresolver/8.1.x.html">EarlyRenderingControllerWrapperSubscriber::$controllerResolver</a> </td> <td data-th="Modifiers"> protected </td> <td data-th="Type"> property </td> <td data-th="Description"> The controller resolver. </td> </tr> <tr> <td data-th="Name"> <a href="../../property/earlyrenderingcontrollerwrappersubscriber-renderer/8.1.x.html">EarlyRenderingControllerWrapperSubscriber::$renderer</a> </td> <td data-th="Modifiers"> protected </td> <td data-th="Type"> property </td> <td data-th="Description"> The renderer. </td> </tr> <tr> <td data-th="Name"> <a href="../../function/earlyrenderingcontrollerwrappersubscriber-getsubscribedevents/8.1.x.html">EarlyRenderingControllerWrapperSubscriber::getSubscribedEvents</a> </td> <td data-th="Modifiers"> public static </td> <td data-th="Type"> function </td> <td data-th="Description"> Returns an array of event names this subscriber wants to listen to. <em class="api-inheritance-source">Overrides <a href="https://api.drupal.org/api/drupal/vendor%21symfony%21event-dispatcher%21EventSubscriberInterface.php/function/EventSubscriberInterface%3A%3AgetSubscribedEvents/8.1.x">EventSubscriberInterface::getSubscribedEvents</a></em> </td> </tr> <tr> <td data-th="Name"> <a href="../../function/earlyrenderingcontrollerwrappersubscriber-oncontroller/8.1.x.html">EarlyRenderingControllerWrapperSubscriber::onController</a> </td> <td data-th="Modifiers"> public </td> <td data-th="Type"> function </td> <td data-th="Description"> Ensures bubbleable metadata from early rendering is not lost. </td> </tr> <tr> <td data-th="Name"> <a href="../../function/earlyrenderingcontrollerwrappersubscriber-wrapcontrollerexecutioninrendercontext/8.1.x.html">EarlyRenderingControllerWrapperSubscriber::wrapControllerExecutionInRenderContext</a> </td> <td data-th="Modifiers"> protected </td> <td data-th="Type"> function </td> <td data-th="Description"> Wraps a controller execution in a render context. </td> </tr> <tr> <td data-th="Name"> <a href="../../function/earlyrenderingcontrollerwrappersubscriber-__construct/8.1.x.html">EarlyRenderingControllerWrapperSubscriber::__construct</a> </td> <td data-th="Modifiers"> public </td> <td data-th="Type"> function </td> <td data-th="Description"> Constructs a new EarlyRenderingControllerWrapperSubscriber instance. </td> </tr> </tbody> </table><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2001&ndash;2016 by the original authors<br>Licensed under the GNU General Public License, version 2 and later.<br>Drupal is a registered trademark of Dries Buytaert.<br>
    <a href="https://api.drupal.org/api/drupal/core!lib!Drupal!Core!EventSubscriber!EarlyRenderingControllerWrapperSubscriber.php/class/EarlyRenderingControllerWrapperSubscriber/8.1.x" class="_attribution-link">https://api.drupal.org/api/drupal/core!lib!Drupal!Core!EventSubscriber!EarlyRenderingControllerWrapperSubscriber.php/class/EarlyRenderingControllerWrapperSubscriber/8.1.x</a>
  </p>
</div>
