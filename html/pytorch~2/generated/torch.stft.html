<h1 id="torch-stft">torch.stft</h1> <dl class="py function"> <dt class="sig sig-object py" id="torch.stft">
<code>torch.stft(input, n_fft, hop_length=None, win_length=None, window=None, center=True, pad_mode='reflect', normalized=False, onesided=None, return_complex=None)</code> <a class="reference internal" href="https://pytorch.org/docs/2.1/_modules/torch/functional.html#stft"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<p>Short-time Fourier transform (STFT).</p> <div class="admonition warning"> <p class="admonition-title">Warning</p> <p>From version 1.8.0, <code>return_complex</code> must always be given explicitly for real inputs and <code>return_complex=False</code> has been deprecated. Strongly prefer <code>return_complex=True</code> as in a future pytorch release, this function will only return complex tensors.</p> <p>Note that <a class="reference internal" href="torch.view_as_real.html#torch.view_as_real" title="torch.view_as_real"><code>torch.view_as_real()</code></a> can be used to recover a real tensor with an extra last dimension for real and imaginary components.</p> </div> <p>The STFT computes the Fourier transform of short overlapping windows of the input. This giving frequency components of the signal as they change over time. The interface of this function is modeled after (but <em>not</em> a drop-in replacement for) <a class="reference external" href="https://librosa.org/doc/latest/generated/librosa.stft.html">librosa</a> stft function.</p> <p>Ignoring the optional batch dimension, this method computes the following expression:</p> <div class="math"> <span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>X</mi><mo stretchy="false">[</mo><mi>ω</mi><mo separator="true">,</mo><mi>m</mi><mo stretchy="false">]</mo><mo>=</mo><munderover><mo>∑</mo><mrow><mi>k</mi><mo>=</mo><mn>0</mn></mrow><mtext>win_length-1</mtext></munderover><mtext>window</mtext><mo stretchy="false">[</mo><mi>k</mi><mo stretchy="false">]</mo><mtext> input</mtext><mo stretchy="false">[</mo><mi>m</mi><mo>×</mo><mtext>hop_length</mtext><mo>+</mo><mi>k</mi><mo stretchy="false">]</mo><mi>exp</mi><mo>⁡</mo><mrow><mo fence="true">(</mo><mo>−</mo><mi>j</mi><mfrac><mrow><mn>2</mn><mi>π</mi><mo>⋅</mo><mi>ω</mi><mi>k</mi></mrow><mtext>n_fft</mtext></mfrac><mo fence="true">)</mo></mrow><mo separator="true">,</mo></mrow><annotation encoding="application/x-tex">X[\omega, m] = \sum_{k = 0}^{\text{win\_length-1}}% \text{window}[k]\ \text{input}[m \times \text{hop\_length} + k]\ % \exp\left(- j \frac{2 \pi \cdot \omega k}{\text{n\_fft}}\right), </annotation></semantics></math></span></span></span>
</div>
<p>where <span class="math"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span></span></span> is the index of the sliding window, and <span class="math"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ω</mi></mrow><annotation encoding="application/x-tex">\omega</annotation></semantics></math></span></span></span> is the frequency <span class="math"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn><mo>≤</mo><mi>ω</mi><mo>&lt;</mo><mtext>n_fft</mtext></mrow><annotation encoding="application/x-tex">0 \leq \omega &lt; \text{n\_fft}</annotation></semantics></math></span></span></span> for <code>onesided=False</code>, or <span class="math"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn><mo>≤</mo><mi>ω</mi><mo>&lt;</mo><mo stretchy="false">⌊</mo><mtext>n_fft</mtext><mi mathvariant="normal">/</mi><mn>2</mn><mo stretchy="false">⌋</mo><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">0 \leq \omega &lt; \lfloor \text{n\_fft} / 2 \rfloor + 1</annotation></semantics></math></span></span></span> for <code>onesided=True</code>.</p> <ul class="simple"> <li>
<code>input</code> must be either a 1-D time sequence or a 2-D batch of time sequences.</li> <li>If <code>hop_length</code> is <code>None</code> (default), it is treated as equal to <code>floor(n_fft / 4)</code>.</li> <li>If <code>win_length</code> is <code>None</code> (default), it is treated as equal to <code>n_fft</code>.</li> <li>
<code>window</code> can be a 1-D tensor of size <code>win_length</code>, e.g., from <a class="reference internal" href="torch.hann_window.html#torch.hann_window" title="torch.hann_window"><code>torch.hann_window()</code></a>. If <code>window</code> is <code>None</code> (default), it is treated as if having <span class="math"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span></span></span> everywhere in the window. If <span class="math"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>win_length</mtext><mo>&lt;</mo><mtext>n_fft</mtext></mrow><annotation encoding="application/x-tex">\text{win\_length} &lt; \text{n\_fft}</annotation></semantics></math></span></span></span>, <code>window</code> will be padded on both sides to length <code>n_fft</code> before being applied.</li> <li>If <code>center</code> is <code>True</code> (default), <code>input</code> will be padded on both sides so that the <span class="math"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span></span></span>-th frame is centered at time <span class="math"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>×</mo><mtext>hop_length</mtext></mrow><annotation encoding="application/x-tex">t \times \text{hop\_length}</annotation></semantics></math></span></span></span>. Otherwise, the <span class="math"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span></span></span>-th frame begins at time <span class="math"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>×</mo><mtext>hop_length</mtext></mrow><annotation encoding="application/x-tex">t \times \text{hop\_length}</annotation></semantics></math></span></span></span>.</li> <li>
<code>pad_mode</code> determines the padding method used on <code>input</code> when <code>center</code> is <code>True</code>. See <a class="reference internal" href="torch.nn.functional.pad.html#torch.nn.functional.pad" title="torch.nn.functional.pad"><code>torch.nn.functional.pad()</code></a> for all available options. Default is <code>"reflect"</code>.</li> <li>If <code>onesided</code> is <code>True</code> (default for real input), only values for <span class="math"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ω</mi></mrow><annotation encoding="application/x-tex">\omega</annotation></semantics></math></span></span></span> in <span class="math"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo fence="true">[</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mn>2</mn><mo separator="true">,</mo><mo>…</mo><mo separator="true">,</mo><mrow><mo fence="true">⌊</mo><mfrac><mtext>n_fft</mtext><mn>2</mn></mfrac><mo fence="true">⌋</mo></mrow><mo>+</mo><mn>1</mn><mo fence="true">]</mo></mrow><annotation encoding="application/x-tex">\left[0, 1, 2, \dots, \left\lfloor \frac{\text{n\_fft}}{2} \right\rfloor + 1\right]</annotation></semantics></math></span></span></span> are returned because the real-to-complex Fourier transform satisfies the conjugate symmetry, i.e., <span class="math"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo stretchy="false">[</mo><mi>m</mi><mo separator="true">,</mo><mi>ω</mi><mo stretchy="false">]</mo><mo>=</mo><mi>X</mi><mo stretchy="false">[</mo><mi>m</mi><mo separator="true">,</mo><mtext>n_fft</mtext><mo>−</mo><mi>ω</mi><msup><mo stretchy="false">]</mo><mo>∗</mo></msup></mrow><annotation encoding="application/x-tex">X[m, \omega] = X[m, \text{n\_fft} - \omega]^*</annotation></semantics></math></span></span></span>. Note if the input or window tensors are complex, then <code>onesided</code> output is not possible.</li> <li>If <code>normalized</code> is <code>True</code> (default is <code>False</code>), the function returns the normalized STFT results, i.e., multiplied by <span class="math"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mtext>frame_length</mtext><msup><mo stretchy="false">)</mo><mrow><mo>−</mo><mn>0.5</mn></mrow></msup></mrow><annotation encoding="application/x-tex">(\text{frame\_length})^{-0.5}</annotation></semantics></math></span></span></span>.</li> <li>If <code>return_complex</code> is <code>True</code> (default if input is complex), the return is a <code>input.dim() + 1</code> dimensional complex tensor. If <code>False</code>, the output is a <code>input.dim() + 2</code> dimensional real tensor where the last dimension represents the real and imaginary components.</li> </ul> <p>Returns either a complex tensor of size <span class="math"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mo>∗</mo><mo>×</mo><mi>N</mi><mo>×</mo><mi>T</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(* \times N \times T)</annotation></semantics></math></span></span></span> if <code>return_complex</code> is true, or a real tensor of size <span class="math"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mo>∗</mo><mo>×</mo><mi>N</mi><mo>×</mo><mi>T</mi><mo>×</mo><mn>2</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(* \times N \times T \times 2)</annotation></semantics></math></span></span></span>. Where <span class="math"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>∗</mo></mrow><annotation encoding="application/x-tex">*</annotation></semantics></math></span></span></span> is the optional batch size of <code>input</code>, <span class="math"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span></span></span> is the number of frequencies where STFT is applied and <span class="math"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span></span></span> is the total number of frames used.</p> <div class="admonition warning"> <p class="admonition-title">Warning</p> <p>This function changed signature at version 0.4.1. Calling with the previous signature may cause error or return incorrect result.</p> </div> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li>
<strong>input</strong> (<a class="reference internal" href="../tensors.html#torch.Tensor" title="torch.Tensor">Tensor</a>) – the input tensor of shape <code>(B?, L)</code> where <code>B?</code> is an optional batch dimension</li> <li>
<strong>n_fft</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)">int</a>) – size of Fourier transform</li> <li>
<strong>hop_length</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)">int</a><em>, </em><em>optional</em>) – the distance between neighboring sliding window frames. Default: <code>None</code> (treated as equal to <code>floor(n_fft / 4)</code>)</li> <li>
<strong>win_length</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)">int</a><em>, </em><em>optional</em>) – the size of window frame and STFT filter. Default: <code>None</code> (treated as equal to <code>n_fft</code>)</li> <li>
<strong>window</strong> (<a class="reference internal" href="../tensors.html#torch.Tensor" title="torch.Tensor">Tensor</a><em>, </em><em>optional</em>) – the optional window function. Shape must be 1d and <code>&lt;= n_fft</code> Default: <code>None</code> (treated as window of all <span class="math"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span></span></span> s)</li> <li>
<strong>center</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)">bool</a><em>, </em><em>optional</em>) – whether to pad <code>input</code> on both sides so that the <span class="math"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span></span></span>-th frame is centered at time <span class="math"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>×</mo><mtext>hop_length</mtext></mrow><annotation encoding="application/x-tex">t \times \text{hop\_length}</annotation></semantics></math></span></span></span>. Default: <code>True</code>
</li> <li>
<strong>pad_mode</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)">str</a><em>, </em><em>optional</em>) – controls the padding method used when <code>center</code> is <code>True</code>. Default: <code>"reflect"</code>
</li> <li>
<strong>normalized</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)">bool</a><em>, </em><em>optional</em>) – controls whether to return the normalized STFT results Default: <code>False</code>
</li> <li>
<strong>onesided</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)">bool</a><em>, </em><em>optional</em>) – controls whether to return half of results to avoid redundancy for real inputs. Default: <code>True</code> for real <code>input</code> and <code>window</code>, <code>False</code> otherwise.</li> <li>
<p><strong>return_complex</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)">bool</a><em>, </em><em>optional</em>) – </p>
<p>whether to return a complex tensor, or a real tensor with an extra last dimension for the real and imaginary components.</p> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 2.0: </span><code>return_complex</code> is now a required argument for real inputs, as the default is being transitioned to <code>True</code>.</p> </div> <div class="deprecated"> <p><span class="versionmodified deprecated">Deprecated since version 2.0: </span><code>return_complex=False</code> is deprecated, instead use <code>return_complex=True</code> Note that calling <a class="reference internal" href="torch.view_as_real.html#torch.view_as_real" title="torch.view_as_real"><code>torch.view_as_real()</code></a> on the output will recover the deprecated output format.</p> </div> </li> </ul> </dd> <dt class="field-even">Returns</dt> <dd class="field-even">

<dl class="simple"> <dt>
<code>A tensor containing the STFT result with shape (B?, N, T, C?) where</code> </dt>
<dd>
<ul class="simple"> <li>
<code>B?</code> is an optional batch dimnsion from the input</li> <li>
<code>N</code> is the number of frequency samples, <code>(n_fft // 2) + 1</code> for <code>onesided=True</code>, or otherwise <code>n_fft</code>.</li> <li>
<code>T</code> is the number of frames, <code>1 + L // hop_length</code> for <code>center=True</code>, or <code>1 + (L - n_fft) // hop_length</code> otherwise.</li> <li>
<code>C?</code> is an optional length-2 dimension of real and imaginary components, present when <code>return_complex=False</code>.</li> </ul> </dd> </dl> </dd> <dt class="field-odd">Return type</dt> <dd class="field-odd">
<p><a class="reference internal" href="../tensors.html#torch.Tensor" title="torch.Tensor">Tensor</a></p> </dd> </dl> </dd>
</dl><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2024, PyTorch Contributors<br>PyTorch has a BSD-style license, as found in the <a href="https://github.com/pytorch/pytorch/blob/main/LICENSE">LICENSE</a> file.<br>
    <a href="https://pytorch.org/docs/2.1/generated/torch.stft.html" class="_attribution-link">https://pytorch.org/docs/2.1/generated/torch.stft.html</a>
  </p>
</div>
