<h1 id="prop_tgt:UNITY_BUILD">UNITY_BUILD</h1> <div class="versionadded"> <p><span class="versionmodified added">New in version 3.16.</span></p> </div> <p>When this property is set to true, the target source files will be combined into batches for faster compilation. This is done by creating a (set of) unity sources which <code>#include</code> the original sources, then compiling these unity sources instead of the originals. This is known as a <em>Unity</em> or <em>Jumbo</em> build.</p> <p>CMake provides different algorithms for selecting which sources are grouped together into a <em>bucket</em>. Algorithm selection is decided by the <a class="reference internal" href="unity_build_mode.html#prop_tgt:UNITY_BUILD_MODE" title="UNITY_BUILD_MODE" id="index-0-prop_tgt:UNITY_BUILD_MODE"><code>UNITY_BUILD_MODE</code></a> target property, which has the following acceptable values:</p> <ul class="simple"> <li>
<code>BATCH</code> When in this mode CMake determines which files are grouped together. The <a class="reference internal" href="unity_build_batch_size.html#prop_tgt:UNITY_BUILD_BATCH_SIZE" title="UNITY_BUILD_BATCH_SIZE" id="index-0-prop_tgt:UNITY_BUILD_BATCH_SIZE"><code>UNITY_BUILD_BATCH_SIZE</code></a> property controls the upper limit on how many sources can be combined per unity source file.</li> <li>
<code>GROUP</code> When in this mode each target explicitly specifies how to group source files. Each source file that has the same <a class="reference internal" href="../prop_sf/unity_group.html#prop_sf:UNITY_GROUP" title="UNITY_GROUP" id="index-0-prop_sf:UNITY_GROUP"><code>UNITY_GROUP</code></a> value will be grouped together. Any sources that don't have this property will be compiled individually. The <a class="reference internal" href="unity_build_batch_size.html#prop_tgt:UNITY_BUILD_BATCH_SIZE" title="UNITY_BUILD_BATCH_SIZE" id="index-1-prop_tgt:UNITY_BUILD_BATCH_SIZE"><code>UNITY_BUILD_BATCH_SIZE</code></a> property is ignored when using this mode.</li> </ul> <p>If no explicit <a class="reference internal" href="unity_build_mode.html#prop_tgt:UNITY_BUILD_MODE" title="UNITY_BUILD_MODE" id="index-1-prop_tgt:UNITY_BUILD_MODE"><code>UNITY_BUILD_MODE</code></a> has been specified, CMake will default to <code>BATCH</code>.</p> <p>Unity builds are not currently supported for all languages. CMake version 3.26.0-rc3 supports combining <code>C</code> and <code>CXX</code> source files. For targets that mix source files from more than one language, CMake will separate the languages such that each generated unity source file only contains sources for a single language.</p> <p>This property is initialized by the value of the <a class="reference internal" href="../variable/cmake_unity_build.html#variable:CMAKE_UNITY_BUILD" title="CMAKE_UNITY_BUILD" id="index-0-variable:CMAKE_UNITY_BUILD"><code>CMAKE_UNITY_BUILD</code></a> variable when a target is created.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>Projects should not directly set the <code>UNITY_BUILD</code> property or its associated <a class="reference internal" href="../variable/cmake_unity_build.html#variable:CMAKE_UNITY_BUILD" title="CMAKE_UNITY_BUILD" id="index-1-variable:CMAKE_UNITY_BUILD"><code>CMAKE_UNITY_BUILD</code></a> variable to true. Depending on the capabilities of the build machine and compiler used, it might or might not be appropriate to enable unity builds. Therefore, this feature should be under developer control, which would normally be through the developer choosing whether or not to set the <a class="reference internal" href="../variable/cmake_unity_build.html#variable:CMAKE_UNITY_BUILD" title="CMAKE_UNITY_BUILD" id="index-2-variable:CMAKE_UNITY_BUILD"><code>CMAKE_UNITY_BUILD</code></a> variable on the <a class="reference internal" href="../manual/cmake.1.html#manual:cmake(1)" title="cmake(1)" id="index-0-manual:cmake(1)"><code>cmake(1)</code></a> command line or some other equivalent method. However, it IS recommended to set the <code>UNITY_BUILD</code> target property to false if it is known that enabling unity builds for the target can lead to problems.</p> </div>  <h2>ODR (One definition rule) errors</h2> <p>When multiple source files are included into one source file, as is done for unity builds, it can potentially lead to ODR errors. CMake provides a number of measures to help address such problems:</p> <ul class="simple"> <li>Any source file that has a non-empty <a class="reference internal" href="../prop_sf/compile_options.html#prop_sf:COMPILE_OPTIONS" title="COMPILE_OPTIONS" id="index-0-prop_sf:COMPILE_OPTIONS"><code>COMPILE_OPTIONS</code></a>, <a class="reference internal" href="../prop_sf/compile_definitions.html#prop_sf:COMPILE_DEFINITIONS" title="COMPILE_DEFINITIONS" id="index-0-prop_sf:COMPILE_DEFINITIONS"><code>COMPILE_DEFINITIONS</code></a>, <a class="reference internal" href="../prop_sf/compile_flags.html#prop_sf:COMPILE_FLAGS" title="COMPILE_FLAGS" id="index-0-prop_sf:COMPILE_FLAGS"><code>COMPILE_FLAGS</code></a>, or <a class="reference internal" href="../prop_sf/include_directories.html#prop_sf:INCLUDE_DIRECTORIES" title="INCLUDE_DIRECTORIES" id="index-0-prop_sf:INCLUDE_DIRECTORIES"><code>INCLUDE_DIRECTORIES</code></a> source property will not be combined into a unity source.</li> <li>Projects can prevent an individual source file from being combined into a unity source by setting its <a class="reference internal" href="../prop_sf/skip_unity_build_inclusion.html#prop_sf:SKIP_UNITY_BUILD_INCLUSION" title="SKIP_UNITY_BUILD_INCLUSION" id="index-0-prop_sf:SKIP_UNITY_BUILD_INCLUSION"><code>SKIP_UNITY_BUILD_INCLUSION</code></a> source property to true. This can be a more effective way to prevent problems with specific files than disabling unity builds for an entire target.</li> <li>Projects can set <a class="reference internal" href="unity_build_unique_id.html#prop_tgt:UNITY_BUILD_UNIQUE_ID" title="UNITY_BUILD_UNIQUE_ID" id="index-0-prop_tgt:UNITY_BUILD_UNIQUE_ID"><code>UNITY_BUILD_UNIQUE_ID</code></a> to cause a valid C-identifier to be generated which is unique per file in a unity build. This can be used to avoid problems with anonymous namespaces in unity builds.</li> <li>The <a class="reference internal" href="unity_build_code_before_include.html#prop_tgt:UNITY_BUILD_CODE_BEFORE_INCLUDE" title="UNITY_BUILD_CODE_BEFORE_INCLUDE" id="index-0-prop_tgt:UNITY_BUILD_CODE_BEFORE_INCLUDE"><code>UNITY_BUILD_CODE_BEFORE_INCLUDE</code></a> and <a class="reference internal" href="unity_build_code_after_include.html#prop_tgt:UNITY_BUILD_CODE_AFTER_INCLUDE" title="UNITY_BUILD_CODE_AFTER_INCLUDE" id="index-0-prop_tgt:UNITY_BUILD_CODE_AFTER_INCLUDE"><code>UNITY_BUILD_CODE_AFTER_INCLUDE</code></a> target properties can be used to inject code into the unity source files before and after every <code>#include</code> statement.</li> <li>The order of source files added to the target via commands like <a class="reference internal" href="../command/add_library.html#command:add_library" title="add_library" id="index-0-command:add_library"><code>add_library()</code></a>, <a class="reference internal" href="../command/add_executable.html#command:add_executable" title="add_executable" id="index-0-command:add_executable"><code>add_executable()</code></a> or <a class="reference internal" href="../command/target_sources.html#command:target_sources" title="target_sources" id="index-0-command:target_sources"><code>target_sources()</code></a> will be preserved in the generated unity source files. This can be used to manually enforce a specific grouping based on the <a class="reference internal" href="unity_build_batch_size.html#prop_tgt:UNITY_BUILD_BATCH_SIZE" title="UNITY_BUILD_BATCH_SIZE" id="index-2-prop_tgt:UNITY_BUILD_BATCH_SIZE"><code>UNITY_BUILD_BATCH_SIZE</code></a> target property.</li> </ul>   <div class="_attribution">
  <p class="_attribution-p">
    &copy; 2000&ndash;2023 Kitware, Inc. and Contributors<br>Licensed under the BSD 3-clause License.<br>
    <a href="https://cmake.org/cmake/help/v3.26/prop_tgt/UNITY_BUILD.html" class="_attribution-link">https://cmake.org/cmake/help/v3.26/prop_tgt/UNITY_BUILD.html</a>
  </p>
</div>
