<h1 id="module:ExternalData">ExternalData</h1>   <ul> <li><a class="reference internal" href="#introduction" id="id2">Introduction</a></li> <li><a class="reference internal" href="#module-functions" id="id3">Module Functions</a></li> <li><a class="reference internal" href="#module-variables" id="id4">Module Variables</a></li> <li>
<p><a class="reference internal" href="#referencing-files" id="id5">Referencing Files</a></p> <ul> <li><a class="reference internal" href="#referencing-single-files" id="id6">Referencing Single Files</a></li> <li><a class="reference internal" href="#referencing-file-series" id="id7">Referencing File Series</a></li> <li><a class="reference internal" href="#referencing-associated-files" id="id8">Referencing Associated Files</a></li> <li><a class="reference internal" href="#referencing-directories" id="id9">Referencing Directories</a></li> </ul> </li> <li><a class="reference internal" href="#hash-algorithms" id="id10">Hash Algorithms</a></li> <li><a class="reference internal" href="#custom-fetch-scripts" id="id11">Custom Fetch Scripts</a></li> </ul>
  <p>Manage data files stored outside source tree</p>  <h2>Introduction</h2> <p>Use this module to unambiguously reference data files stored outside the source tree and fetch them at build time from arbitrary local and remote content-addressed locations. Functions provided by this module recognize arguments with the syntax <code>DATA{&lt;name&gt;}</code> as references to external data, replace them with full paths to local copies of those data, and create build rules to fetch and update the local copies.</p> <p>For example:</p> <pre data-language="cmake">include(ExternalData)
set(ExternalData_URL_TEMPLATES "file:///local/%(algo)/%(hash)"
                               "file:////host/share/%(algo)/%(hash)"
                               "http://data.org/%(algo)/%(hash)")
ExternalData_Add_Test(MyData
  NAME MyTest
  COMMAND MyExe DATA{MyInput.png}
  )
ExternalData_Add_Target(MyData)
</pre> <p>When test <code>MyTest</code> runs the <code>DATA{MyInput.png}</code> argument will be replaced by the full path to a real instance of the data file <code>MyInput.png</code> on disk. If the source tree contains a content link such as <code>MyInput.png.md5</code> then the <code>MyData</code> target creates a real <code>MyInput.png</code> in the build tree.</p>   <h2>Module Functions</h2> <dl class="cmake command"> <dt class="sig sig-object cmake" id="command:externaldata_expand_arguments">
<code>ExternalData_Expand_Arguments</code> </dt> <dd>
<p>The <code>ExternalData_Expand_Arguments</code> function evaluates <code>DATA{}</code> references in its arguments and constructs a new list of arguments:</p> <pre data-language="none">ExternalData_Expand_Arguments(
  &lt;target&gt;   # Name of data management target
  &lt;outVar&gt;   # Output variable
  [args...]  # Input arguments, DATA{} allowed
  )
</pre> <p>It replaces each <code>DATA{}</code> reference in an argument with the full path of a real data file on disk that will exist after the <code>&lt;target&gt;</code> builds.</p> </dd>
</dl> <dl class="cmake command"> <dt class="sig sig-object cmake" id="command:externaldata_add_test">
<code>ExternalData_Add_Test</code> </dt> <dd>
<p>The <code>ExternalData_Add_Test</code> function wraps around the CMake <a class="reference internal" href="../command/add_test.html#command:add_test" title="add_test" id="index-0-command:add_test"><code>add_test()</code></a> command but supports <code>DATA{}</code> references in its arguments:</p> <pre data-language="none">ExternalData_Add_Test(
  &lt;target&gt;   # Name of data management target
  ...        # Arguments of add_test(), DATA{} allowed
  )
</pre> <p>It passes its arguments through <code>ExternalData_Expand_Arguments</code> and then invokes the <a class="reference internal" href="../command/add_test.html#command:add_test" title="add_test" id="index-1-command:add_test"><code>add_test()</code></a> command using the results.</p> </dd>
</dl> <dl class="cmake command"> <dt class="sig sig-object cmake" id="command:externaldata_add_target">
<code>ExternalData_Add_Target</code> </dt> <dd>
<p>The <code>ExternalData_Add_Target</code> function creates a custom target to manage local instances of data files stored externally:</p> <pre data-language="none">ExternalData_Add_Target(
  &lt;target&gt;                  # Name of data management target
  [SHOW_PROGRESS &lt;ON|OFF&gt;]  # Show progress during the download
  )
</pre> <p>It creates custom commands in the target as necessary to make data files available for each <code>DATA{}</code> reference previously evaluated by other functions provided by this module. Data files may be fetched from one of the URL templates specified in the <code>ExternalData_URL_TEMPLATES</code> variable, or may be found locally in one of the paths specified in the <code>ExternalData_OBJECT_STORES</code> variable.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 3.20: </span>The <code>SHOW_PROGRESS</code> argument may be passed to suppress progress information during the download of objects. If not provided, it defaults to <code>OFF</code> for <a class="reference internal" href="https://cmake.org/cmake/help/v3.26/generator/Ninja.html#generator:Ninja" title="Ninja" id="index-0-generator:Ninja"><code>Ninja</code></a> and <a class="reference internal" href="https://cmake.org/cmake/help/v3.26/generator/Ninja%20Multi-Config.html#generator:Ninja%20Multi-Config" title="Ninja Multi-Config" id="index-0-generator:Ninja Multi-Config"><code>Ninja Multi-Config</code></a> generators and <code>ON</code> otherwise.</p> </div> <p>Typically only one target is needed to manage all external data within a project. Call this function once at the end of configuration after all data references have been processed.</p> </dd>
</dl>   <h2>Module Variables</h2> <p>The following variables configure behavior. They should be set before calling any of the functions provided by this module.</p> <dl class="cmake variable"> <dt class="sig sig-object cmake" id="variable:ExternalData_BINARY_ROOT">
<code>ExternalData_BINARY_ROOT</code> </dt> <dd>
<p>The <code>ExternalData_BINARY_ROOT</code> variable may be set to the directory to hold the real data files named by expanded <code>DATA{}</code> references. The default is <code>CMAKE_BINARY_DIR</code>. The directory layout will mirror that of content links under <code>ExternalData_SOURCE_ROOT</code>.</p> </dd>
</dl> <dl class="cmake variable"> <dt class="sig sig-object cmake" id="variable:ExternalData_CUSTOM_SCRIPT_&lt;key&gt;">
<code>ExternalData_CUSTOM_SCRIPT_&lt;key&gt;</code> </dt> <dd>
<div class="versionadded"> <p><span class="versionmodified added">New in version 3.2.</span></p> </div> <p>Specify a full path to a <code>.cmake</code> custom fetch script identified by <code>&lt;key&gt;</code> in entries of the <code>ExternalData_URL_TEMPLATES</code> list. See <a class="reference internal" href="#custom-fetch-scripts">Custom Fetch Scripts</a>.</p> </dd>
</dl> <dl class="cmake variable"> <dt class="sig sig-object cmake" id="variable:ExternalData_LINK_CONTENT">
<code>ExternalData_LINK_CONTENT</code> </dt> <dd>
<p>The <code>ExternalData_LINK_CONTENT</code> variable may be set to the name of a supported hash algorithm to enable automatic conversion of real data files referenced by the <code>DATA{}</code> syntax into content links. For each such <code>&lt;file&gt;</code> a content link named <code>&lt;file&gt;&lt;ext&gt;</code> is created. The original file is renamed to the form <code>.ExternalData_&lt;algo&gt;_&lt;hash&gt;</code> to stage it for future transmission to one of the locations in the list of URL templates (by means outside the scope of this module). The data fetch rule created for the content link will use the staged object if it cannot be found using any URL template.</p> </dd>
</dl> <dl class="cmake variable"> <dt class="sig sig-object cmake" id="variable:ExternalData_NO_SYMLINKS">
<code>ExternalData_NO_SYMLINKS</code> </dt> <dd>
<div class="versionadded"> <p><span class="versionmodified added">New in version 3.3.</span></p> </div> <p>The real data files named by expanded <code>DATA{}</code> references may be made available under <code>ExternalData_BINARY_ROOT</code> using symbolic links on some platforms. The <code>ExternalData_NO_SYMLINKS</code> variable may be set to disable use of symbolic links and enable use of copies instead.</p> </dd>
</dl> <dl class="cmake variable"> <dt class="sig sig-object cmake" id="variable:ExternalData_OBJECT_STORES">
<code>ExternalData_OBJECT_STORES</code> </dt> <dd>
<p>The <code>ExternalData_OBJECT_STORES</code> variable may be set to a list of local directories that store objects using the layout <code>&lt;dir&gt;/%(algo)/%(hash)</code>. These directories will be searched first for a needed object. If the object is not available in any store then it will be fetched remotely using the URL templates and added to the first local store listed. If no stores are specified the default is a location inside the build tree.</p> </dd>
</dl> <dl class="cmake variable"> <dt class="sig sig-object cmake" id="variable:ExternalData_SERIES_PARSE">
<code>ExternalData_SERIES_PARSE</code> </dt> <dt class="sig sig-object cmake" id="variable:ExternalData_SERIES_PARSE_PREFIX">
<code>ExternalData_SERIES_PARSE_PREFIX</code> </dt> <dt class="sig sig-object cmake" id="variable:ExternalData_SERIES_PARSE_NUMBER">
<code>ExternalData_SERIES_PARSE_NUMBER</code> </dt> <dt class="sig sig-object cmake" id="variable:ExternalData_SERIES_PARSE_SUFFIX">
<code>ExternalData_SERIES_PARSE_SUFFIX</code> </dt> <dt class="sig sig-object cmake" id="variable:ExternalData_SERIES_MATCH">
<code>ExternalData_SERIES_MATCH</code> </dt> <dd>
<p>See <a class="reference internal" href="#referencing-file-series">Referencing File Series</a>.</p> </dd>
</dl> <dl class="cmake variable"> <dt class="sig sig-object cmake" id="variable:ExternalData_SOURCE_ROOT">
<code>ExternalData_SOURCE_ROOT</code> </dt> <dd>
<p>The <code>ExternalData_SOURCE_ROOT</code> variable may be set to the highest source directory containing any path named by a <code>DATA{}</code> reference. The default is <code>CMAKE_SOURCE_DIR</code>. <code>ExternalData_SOURCE_ROOT</code> and <code>CMAKE_SOURCE_DIR</code> must refer to directories within a single source distribution (e.g. they come together in one tarball).</p> </dd>
</dl> <dl class="cmake variable"> <dt class="sig sig-object cmake" id="variable:ExternalData_TIMEOUT_ABSOLUTE">
<code>ExternalData_TIMEOUT_ABSOLUTE</code> </dt> <dd>
<p>The <code>ExternalData_TIMEOUT_ABSOLUTE</code> variable sets the download absolute timeout, in seconds, with a default of <code>300</code> seconds. Set to <code>0</code> to disable enforcement.</p> </dd>
</dl> <dl class="cmake variable"> <dt class="sig sig-object cmake" id="variable:ExternalData_TIMEOUT_INACTIVITY">
<code>ExternalData_TIMEOUT_INACTIVITY</code> </dt> <dd>
<p>The <code>ExternalData_TIMEOUT_INACTIVITY</code> variable sets the download inactivity timeout, in seconds, with a default of <code>60</code> seconds. Set to <code>0</code> to disable enforcement.</p> </dd>
</dl> <dl class="cmake variable"> <dt class="sig sig-object cmake" id="variable:ExternalData_URL_ALGO_&lt;algo&gt;_&lt;key&gt;">
<code>ExternalData_URL_ALGO_&lt;algo&gt;_&lt;key&gt;</code> </dt> <dd>
<div class="versionadded"> <p><span class="versionmodified added">New in version 3.3.</span></p> </div> <p>Specify a custom URL component to be substituted for URL template placeholders of the form <code>%(algo:&lt;key&gt;)</code>, where <code>&lt;key&gt;</code> is a valid C identifier, when fetching an object referenced via hash algorithm <code>&lt;algo&gt;</code>. If not defined, the default URL component is just <code>&lt;algo&gt;</code> for any <code>&lt;key&gt;</code>.</p> </dd>
</dl> <dl class="cmake variable"> <dt class="sig sig-object cmake" id="variable:ExternalData_URL_TEMPLATES">
<code>ExternalData_URL_TEMPLATES</code> </dt> <dd>
<p>The <code>ExternalData_URL_TEMPLATES</code> may be set to provide a list of URL templates using the placeholders <code>%(algo)</code> and <code>%(hash)</code> in each template. Data fetch rules try each URL template in order by substituting the hash algorithm name for <code>%(algo)</code> and the hash value for <code>%(hash)</code>. Alternatively one may use <code>%(algo:&lt;key&gt;)</code> with <code>ExternalData_URL_ALGO_&lt;algo&gt;_&lt;key&gt;</code> variables to gain more flexibility in remote URLs.</p> </dd>
</dl>   <h2>Referencing Files</h2>  <h3>Referencing Single Files</h3> <p>The <code>DATA{}</code> syntax is literal and the <code>&lt;name&gt;</code> is a full or relative path within the source tree. The source tree must contain either a real data file at <code>&lt;name&gt;</code> or a "content link" at <code>&lt;name&gt;&lt;ext&gt;</code> containing a hash of the real file using a hash algorithm corresponding to <code>&lt;ext&gt;</code>. For example, the argument <code>DATA{img.png}</code> may be satisfied by either a real <code>img.png</code> file in the current source directory or a <code>img.png.md5</code> file containing its MD5 sum.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 3.8: </span>Multiple content links of the same name with different hash algorithms are supported (e.g. <code>img.png.sha256</code> and <code>img.png.sha1</code>) so long as they all correspond to the same real file. This allows objects to be fetched from sources indexed by different hash algorithms.</p> </div>   <h3>Referencing File Series</h3> <p>The <code>DATA{}</code> syntax can be told to fetch a file series using the form <code>DATA{&lt;name&gt;,:}</code>, where the <code>:</code> is literal. If the source tree contains a group of files or content links named like a series then a reference to one member adds rules to fetch all of them. Although all members of a series are fetched, only the file originally named by the <code>DATA{}</code> argument is substituted for it. The default configuration recognizes file series names ending with <code>#.ext</code>, <code>_#.ext</code>, <code>.#.ext</code>, or <code>-#.ext</code> where <code>#</code> is a sequence of decimal digits and <code>.ext</code> is any single extension. Configure it with a regex that parses <code>&lt;number&gt;</code> and <code>&lt;suffix&gt;</code> parts from the end of <code>&lt;name&gt;</code>:</p> <pre data-language="none">ExternalData_SERIES_PARSE = regex of the form (&lt;number&gt;)(&lt;suffix&gt;)$
</pre> <p>For more complicated cases set:</p> <pre data-language="none">ExternalData_SERIES_PARSE = regex with at least two () groups
ExternalData_SERIES_PARSE_PREFIX = &lt;prefix&gt; regex group number, if any
ExternalData_SERIES_PARSE_NUMBER = &lt;number&gt; regex group number
ExternalData_SERIES_PARSE_SUFFIX = &lt;suffix&gt; regex group number
</pre> <p>Configure series number matching with a regex that matches the <code>&lt;number&gt;</code> part of series members named <code>&lt;prefix&gt;&lt;number&gt;&lt;suffix&gt;</code>:</p> <pre data-language="none">ExternalData_SERIES_MATCH = regex matching &lt;number&gt; in all series members
</pre> <p>Note that the <code>&lt;suffix&gt;</code> of a series does not include a hash-algorithm extension.</p>   <h3>Referencing Associated Files</h3> <p>The <code>DATA{}</code> syntax can alternatively match files associated with the named file and contained in the same directory. Associated files may be specified by options using the syntax <code>DATA{&lt;name&gt;,&lt;opt1&gt;,&lt;opt2&gt;,...}</code>. Each option may specify one file by name or specify a regular expression to match file names using the syntax <code>REGEX:&lt;regex&gt;</code>. For example, the arguments:</p> <pre data-language="none">DATA{MyData/MyInput.mhd,MyInput.img}                   # File pair
DATA{MyData/MyFrames00.png,REGEX:MyFrames[0-9]+\\.png} # Series
</pre> <p>will pass <code>MyInput.mha</code> and <code>MyFrames00.png</code> on the command line but ensure that the associated files are present next to them.</p>   <h3>Referencing Directories</h3> <p>The <code>DATA{}</code> syntax may reference a directory using a trailing slash and a list of associated files. The form <code>DATA{&lt;name&gt;/,&lt;opt1&gt;,&lt;opt2&gt;,...}</code> adds rules to fetch any files in the directory that match one of the associated file options. For example, the argument <code>DATA{MyDataDir/,REGEX:.*}</code> will pass the full path to a <code>MyDataDir</code> directory on the command line and ensure that the directory contains files corresponding to every file or content link in the <code>MyDataDir</code> source directory.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 3.3: </span>In order to match associated files in subdirectories, specify a <code>RECURSE:</code> option, e.g. <code>DATA{MyDataDir/,RECURSE:,REGEX:.*}</code>.</p> </div>    <h2>Hash Algorithms</h2> <p>The following hash algorithms are supported:</p> <pre data-language="none">%(algo)     &lt;ext&gt;     Description
-------     -----     -----------
MD5         .md5      Message-Digest Algorithm 5, RFC 1321
SHA1        .sha1     US Secure Hash Algorithm 1, RFC 3174
SHA224      .sha224   US Secure Hash Algorithms, RFC 4634
SHA256      .sha256   US Secure Hash Algorithms, RFC 4634
SHA384      .sha384   US Secure Hash Algorithms, RFC 4634
SHA512      .sha512   US Secure Hash Algorithms, RFC 4634
SHA3_224    .sha3-224 Keccak SHA-3
SHA3_256    .sha3-256 Keccak SHA-3
SHA3_384    .sha3-384 Keccak SHA-3
SHA3_512    .sha3-512 Keccak SHA-3
</pre> <div class="versionadded"> <p><span class="versionmodified added">New in version 3.8: </span>Added the <code>SHA3_*</code> hash algorithms.</p> </div> <p>Note that the hashes are used only for unique data identification and download verification.</p>   <h2 id="externaldata-custom-fetch-scripts">Custom Fetch Scripts</h2> <div class="versionadded"> <p><span class="versionmodified added">New in version 3.2.</span></p> </div> <p>When a data file must be fetched from one of the URL templates specified in the <code>ExternalData_URL_TEMPLATES</code> variable, it is normally downloaded using the <a class="reference internal" href="../command/file.html#command:file" title="file" id="index-0-command:file"><code>file(DOWNLOAD)</code></a> command. One may specify usage of a custom fetch script by using a URL template of the form <code>ExternalDataCustomScript://&lt;key&gt;/&lt;loc&gt;</code>. The <code>&lt;key&gt;</code> must be a C identifier, and the <code>&lt;loc&gt;</code> must contain the <code>%(algo)</code> and <code>%(hash)</code> placeholders. A variable corresponding to the key, <code>ExternalData_CUSTOM_SCRIPT_&lt;key&gt;</code>, must be set to the full path to a <code>.cmake</code> script file. The script will be included to perform the actual fetch, and provided with the following variables:</p> <dl class="cmake variable"> <dt class="sig sig-object cmake" id="variable:ExternalData_CUSTOM_LOCATION">
<code>ExternalData_CUSTOM_LOCATION</code> </dt> <dd>
<p>When a custom fetch script is loaded, this variable is set to the location part of the URL, which will contain the substituted hash algorithm name and content hash value.</p> </dd>
</dl> <dl class="cmake variable"> <dt class="sig sig-object cmake" id="variable:ExternalData_CUSTOM_FILE">
<code>ExternalData_CUSTOM_FILE</code> </dt> <dd>
<p>When a custom fetch script is loaded, this variable is set to the full path to a file in which the script must store the fetched content. The name of the file is unspecified and should not be interpreted in any way.</p> </dd>
</dl> <p>The custom fetch script is expected to store fetched content in the file or set a variable:</p> <dl class="cmake variable"> <dt class="sig sig-object cmake" id="variable:ExternalData_CUSTOM_ERROR">
<code>ExternalData_CUSTOM_ERROR</code> </dt> <dd>
<p>When a custom fetch script fails to fetch the requested content, it must set this variable to a short one-line message describing the reason for failure.</p> </dd>
</dl>   <div class="_attribution">
  <p class="_attribution-p">
    &copy; 2000&ndash;2023 Kitware, Inc. and Contributors<br>Licensed under the BSD 3-clause License.<br>
    <a href="https://cmake.org/cmake/help/v3.26/module/ExternalData.html" class="_attribution-link">https://cmake.org/cmake/help/v3.26/module/ExternalData.html</a>
  </p>
</div>
