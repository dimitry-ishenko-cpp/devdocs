<h1 id="manual:cmake-cxxmodules(7)">cmake-cxxmodules(7)</h1> <div class="versionadded"> <p><span class="versionmodified added">Added in version 3.28.</span></p> </div> <p>C++ 20 introduced the concept of "modules" to the language. The design requires build systems to order compilations among each other to satisfy <code>import</code> statements reliably. CMake's implementation asks the compiler to scan source files for module dependencies during the build, collates scanning results to infer ordering constraints, and tells the build tool how to dynamically update the build graph.</p>  <h2>Compilation Strategy</h2> <p>With C++ modules, compiling a set of C++ sources is no longer embarrassingly parallel. That is, any given source may first require the compilation of another source file first in order to provide a "CMI" (compiled module interface) or "BMI" (binary module interface) that C++ compilers use to satisfy <code>import</code> statements in other sources. With headers, sources could share their declarations so that any consumers could compile independently. With modules, declarations are now generated into these BMI files by the compiler during compilation based on the contents of the source file and its <code>export</code> statements.</p> <p>The order necessary for compilation requires build-time resolution of the ordering because the order is controlled by the contents of the sources. This means that the ordering needs extracted from the source during the build to avoid regenerating the build graph via a configure and generate phase for every source change to get a correct build.</p> <p>The general strategy is to use a "scanner" to extract the ordering dependency information and update the build graph with new edges between existing edges by taking the per-source scan results (represented by <a class="reference external" href="https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p1689r5.html">P1689R5</a> files) and "collating" the dependencies within a target and to modules produced by targets visible to the target. The primary task is to generate "module map" files to pass to each compile rule with the paths to the BMIs needed to satisfy <code>import</code> statements. The collator also has tasks to use the build-time information to fill out information including <code>install</code> rules for the module interface units, their BMIs, and properties for any exported targets with C++ modules.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>CMake is focusing on correct builds before looking at performance improvements. There are known tactics within the chosen strategy which may offer build performance improvements. However, they are being deferred until we have a working model against which to compare them. It is also important to note that a tactic useful in one situation (e.g., clean builds) may not be performant in a different situation (e.g., incremental builds). Finding a balance and offering controls to select the tactics is future work.</p> </div>   <h2>Scanning Control</h2> <p>Whether or not sources get scanned for C++ module usage is dependent on the following queries. The first query that provides a yes/no answer is used.</p> <ul class="simple"> <li>If the source file belongs to a file set of type <code>CXX_MODULES</code>, it will be scanned.</li> <li>If the target does not use at least C++ 20, it will not be scanned.</li> <li>If the source file is not the language <code>CXX</code>, it will not be scanned.</li> <li>If the <a class="reference internal" href="../prop_sf/cxx_scan_for_modules.html#prop_sf:CXX_SCAN_FOR_MODULES" title="CXX_SCAN_FOR_MODULES" id="index-0-prop_sf:CXX_SCAN_FOR_MODULES"><code>CXX_SCAN_FOR_MODULES</code></a> source file property is set, its value will be used.</li> <li>If the <a class="reference internal" href="../prop_tgt/cxx_scan_for_modules.html#prop_tgt:CXX_SCAN_FOR_MODULES" title="CXX_SCAN_FOR_MODULES" id="index-0-prop_tgt:CXX_SCAN_FOR_MODULES"><code>CXX_SCAN_FOR_MODULES</code></a> target property is set, its value will be used. Set the <a class="reference internal" href="../variable/cmake_cxx_scan_for_modules.html#variable:CMAKE_CXX_SCAN_FOR_MODULES" title="CMAKE_CXX_SCAN_FOR_MODULES" id="index-0-variable:CMAKE_CXX_SCAN_FOR_MODULES"><code>CMAKE_CXX_SCAN_FOR_MODULES</code></a> variable to initialize this property on all targets as they are created.</li> <li>Otherwise, the source file will be scanned if the compiler and generator support scanning. See policy <a class="reference internal" href="../policy/cmp0155.html#policy:CMP0155" title="CMP0155" id="index-0-policy:CMP0155"><code>CMP0155</code></a>.</li> </ul> <p>Note that any scanned source will be excluded from any unity build (see <a class="reference internal" href="../prop_tgt/unity_build.html#prop_tgt:UNITY_BUILD" title="UNITY_BUILD" id="index-0-prop_tgt:UNITY_BUILD"><code>UNITY_BUILD</code></a>) because module-related statements can only happen at one place within a C++ translation unit.</p>   <h2>Compiler Support</h2> <p>Compilers which CMake natively supports module dependency scanning include:</p> <ul class="simple"> <li>MSVC toolset 14.34 and newer (provided with Visual Studio 17.4 and newer)</li> <li>LLVM/Clang 16.0 and newer</li> <li>GCC 14 (for the in-development branch, after 2023-09-20) and newer</li> </ul>   <h2>
<code>import std</code> Support</h2> <p>Support for <code>import std</code> is limited to the following toolchain and standard library combinations:</p> <ul class="simple"> <li>Clang 18.1.2 and newer with <code>-stdlib=libc++</code>
</li> <li>MSVC toolset 14.36 and newer (provided with Visual Studio 17.6 Preview 2 and newer)</li> </ul> <p>The <a class="reference internal" href="../variable/cmake_cxx_compiler_import_std.html#variable:CMAKE_CXX_COMPILER_IMPORT_STD" title="CMAKE_CXX_COMPILER_IMPORT_STD" id="index-0-variable:CMAKE_CXX_COMPILER_IMPORT_STD"><code>CMAKE_CXX_COMPILER_IMPORT_STD</code></a> variable may be used to detect support for a standard level with the active C++ toolchain.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This support is provided only when experimental support for <code>import std;</code> has been enabled by the <code>CMAKE_EXPERIMENTAL_CXX_IMPORT_STD</code> gate.</p> </div>   <h2>Generator Support</h2> <p>The list of generators which support scanning sources for C++ modules include:</p> <ul class="simple"> <li><a class="reference internal" href="https://cmake.org/cmake/help/latest/generator/Ninja.html#generator:Ninja" title="Ninja" id="index-0-generator:Ninja"><code>Ninja</code></a></li> <li><a class="reference internal" href="https://cmake.org/cmake/help/latest/generator/Ninja%20Multi-Config.html#generator:Ninja%20Multi-Config" title="Ninja Multi-Config" id="index-0-generator:Ninja Multi-Config"><code>Ninja Multi-Config</code></a></li> <li><a class="reference internal" href="https://cmake.org/cmake/help/latest/generator/Visual%20Studio%2017%202022.html#generator:Visual%20Studio%2017%202022" title="Visual Studio 17 2022" id="index-0-generator:Visual Studio 17 2022"><code>Visual Studio 17 2022</code></a></li> </ul>  <h3>Limitations</h3> <p>There are a number of known limitations of the current C++ module support in CMake. This does not document known limitations or bugs in compilers as these can change over time.</p> <p>For all generators:</p> <ul class="simple"> <li>Header units are not supported.</li> <li>No builtin support for <code>import std;</code> or other compiler-provided modules.</li> </ul> <p>For the Ninja Generators:</p> <ul class="simple"> <li>
<code>ninja</code> 1.11 or newer is required.</li> </ul> <p>For the <a class="reference internal" href="cmake-generators.7.html#visual-studio-generators"><span class="std std-ref">Visual Studio Generators</span></a>:</p> <ul class="simple"> <li>Only Visual Studio 2022 and MSVC toolsets 14.34 (Visual Studio 17.4) and newer.</li> <li>No support for exporting or installing BMI or module information.</li> <li>No support for compiling BMIs from <code>IMPORTED</code> targets with C++ modules (including <code>import std</code>).</li> <li>No diagnosis of using modules provided by <code>PRIVATE</code> sources from <code>PUBLIC</code> module sources.</li> </ul>    <div class="_attribution">
  <p class="_attribution-p">
    &copy; 2000&ndash;2024 Kitware, Inc. and Contributors<br>Licensed under the BSD 3-clause License.<br>
    <a href="https://cmake.org/cmake/help/latest/manual/cmake-cxxmodules.7.html" class="_attribution-link">https://cmake.org/cmake/help/latest/manual/cmake-cxxmodules.7.html</a>
  </p>
</div>
