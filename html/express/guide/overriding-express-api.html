<div id="page-doc"> <h1 id="overriding-the-express-api" data-level="4">Overriding the Express API</h1> <p>The Express API consists of various methods and properties on the request and response objects. These are inherited by prototype. There are two extension points for the Express API:</p> <ol> <li>The global prototypes at <code class="language-plaintext highlighter-rouge">express.request</code> and <code class="language-plaintext highlighter-rouge">express.response</code>.</li> <li>App-specific prototypes at <code class="language-plaintext highlighter-rouge">app.request</code> and <code class="language-plaintext highlighter-rouge">app.response</code>.</li> </ol> <p>Altering the global prototypes will affect all loaded Express apps in the same process. If desired, alterations can be made app-specific by only altering the app-specific prototypes after creating a new app.</p> <h2 id="methods">Methods</h2> <p>You can override the signature and behavior of existing methods with your own, by assigning a custom function.</p> <p>Following is an example of overriding the behavior of <a href="https://expressjs.com/index.html#res.sendStatus">res.sendStatus</a>.</p> <div class="highlight"><pre class="highlight">app.response.sendStatus = function (statusCode, type, message) {
  // code is intentionally kept simple for demonstration purpose
  return this.contentType(type)
    .status(statusCode)
    .send(message)
}
</pre></div>  <p>The above implementation completely changes the original signature of <code class="language-plaintext highlighter-rouge">res.sendStatus</code>. It now accepts a status code, encoding type, and the message to be sent to the client.</p> <p>The overridden method may now be used this way:</p> <div class="highlight"><pre class="highlight">res.sendStatus(404, 'application/json', '{"error":"resource not found"}')
</pre></div>  <h2 id="properties">Properties</h2> <p>Properties in the Express API are either:</p> <ol> <li>Assigned properties (ex: <code class="language-plaintext highlighter-rouge">req.baseUrl</code>, <code class="language-plaintext highlighter-rouge">req.originalUrl</code>)</li> <li>Defined as getters (ex: <code class="language-plaintext highlighter-rouge">req.secure</code>, <code class="language-plaintext highlighter-rouge">req.ip</code>)</li> </ol> <p>Since properties under category 1 are dynamically assigned on the <code class="language-plaintext highlighter-rouge">request</code> and <code class="language-plaintext highlighter-rouge">response</code> objects in the context of the current request-response cycle, their behavior cannot be overridden.</p> <p>Properties under category 2 can be overwritten using the Express API extensions API.</p> <p>The following code rewrites how the value of <code class="language-plaintext highlighter-rouge">req.ip</code> is to be derived. Now, it simply returns the value of the <code class="language-plaintext highlighter-rouge">Client-IP</code> request header.</p> <div class="highlight"><pre class="highlight">Object.defineProperty(app.request, 'ip', {
  configurable: true,
  enumerable: true,
  get () { return this.get('Client-IP') }
})
</pre></div>  <h2 id="prototype">Prototype</h2> <p>In order to provide the Express API, the request/response objects passed to Express (via <code class="language-plaintext highlighter-rouge">app(req, res)</code>, for example) need to inherit from the same prototype chain. By default, this is <code class="language-plaintext highlighter-rouge">http.IncomingRequest.prototype</code> for the request and <code class="language-plaintext highlighter-rouge">http.ServerResponse.prototype</code> for the response.</p> <p>Unless necessary, it is recommended that this be done only at the application level, rather than globally. Also, take care that the prototype that is being used matches the functionality as closely as possible to the default prototypes.</p> <div class="highlight"><pre class="highlight">// Use FakeRequest and FakeResponse in place of http.IncomingRequest and http.ServerResponse
// for the given app reference
Object.setPrototypeOf(Object.getPrototypeOf(app.request), FakeRequest.prototype)
Object.setPrototypeOf(Object.getPrototypeOf(app.response), FakeResponse.prototype)
</pre></div>  </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2017 StrongLoop, IBM, and other expressjs.com contributors.<br>Licensed under the Creative Commons Attribution-ShareAlike License v3.0.<br>
    <a href="https://expressjs.com/en/guide/overriding-express-api.html" class="_attribution-link">https://expressjs.com/en/guide/overriding-express-api.html</a>
  </p>
</div>
