<h1 id="collections">Using collections</h1> <p id="using-collections">Collections are a distribution format for Ansible content that can include playbooks, roles, modules, and plugins. As modules move from the core Ansible repository into collections, the module documentation will move to the <a class="reference internal" href="../collections/index.html#list-of-collections"><span class="std std-ref">collections pages</span></a>.</p> <p>You can install and use collections through <a class="reference external" href="https://galaxy.ansible.com">Ansible Galaxy</a>.</p> <ul class="simple"> <li>For details on how to <em>develop</em> collections see <a class="reference internal" href="https://docs.ansible.com/ansible/latest/dev_guide/developing_collections.html#developing-collections"><span class="std std-ref">Developing collections</span></a>.</li> <li>For the current development status of Collections and FAQ see <a class="reference external" href="https://github.com/ansible-collections/overview/blob/main/README.rst">Ansible Collections Community Guide</a>.</li> </ul>  <ul class="simple"> <li>
<p><a class="reference internal" href="#installing-collections" id="id3">Installing collections</a></p> <ul> <li><a class="reference internal" href="#installing-collections-with-ansible-galaxy" id="id4">Installing collections with <code>ansible-galaxy</code></a></li> <li><a class="reference internal" href="#installing-an-older-version-of-a-collection" id="id5">Installing an older version of a collection</a></li> <li><a class="reference internal" href="#installing-a-collection-from-a-git-repository" id="id6">Installing a collection from a git repository</a></li> <li><a class="reference internal" href="#install-multiple-collections-with-a-requirements-file" id="id7">Install multiple collections with a requirements file</a></li> <li><a class="reference internal" href="#downloading-a-collection-for-offline-use" id="id8">Downloading a collection for offline use</a></li> <li><a class="reference internal" href="#configuring-the-ansible-galaxy-client" id="id9">Configuring the <code>ansible-galaxy</code> client</a></li> </ul> </li> <li><a class="reference internal" href="#downloading-collections" id="id10">Downloading collections</a></li> <li><a class="reference internal" href="#listing-collections" id="id11">Listing collections</a></li> <li>
<p><a class="reference internal" href="#verifying-collections" id="id12">Verifying collections</a></p> <ul> <li><a class="reference internal" href="#verifying-collections-with-ansible-galaxy" id="id13">Verifying collections with <code>ansible-galaxy</code></a></li> </ul> </li> <li><a class="reference internal" href="#using-collections-in-a-playbook" id="id14">Using collections in a Playbook</a></li> <li>
<p><a class="reference internal" href="#simplifying-module-names-with-the-collections-keyword" id="id15">Simplifying module names with the <code>collections</code> keyword</a></p> <ul> <li><a class="reference internal" href="#using-collections-in-roles" id="id16">Using <code>collections</code> in roles</a></li> <li><a class="reference internal" href="#using-collections-in-playbooks" id="id17">Using <code>collections</code> in playbooks</a></li> </ul> </li> <li><a class="reference internal" href="#using-a-playbook-from-a-collection" id="id18">Using a playbook from a collection</a></li> </ul>   <h2 id="collections-installing">Installing collections</h2> <div class="admonition note" id="installing-collections"> <p class="admonition-title">Note</p> <p>If you install a collection manually as described in this paragraph, the collection will not be upgraded automatically when you upgrade the <code>ansible</code> package or <code>ansible-core</code>.</p> </div>  <h3 id="installing-collections-with-ansible-galaxy">Installing collections with <code>ansible-galaxy</code>
</h3> <p>By default, <code>ansible-galaxy collection install</code> uses <a class="reference external" href="https://galaxy.ansible.com">https://galaxy.ansible.com</a> as the Galaxy server (as listed in the <code>ansible.cfg</code> file under <a class="reference internal" href="../reference_appendices/config.html#galaxy-server"><span class="std std-ref">GALAXY_SERVER</span></a>). You do not need any further configuration.</p> <p>See <a class="reference internal" href="#galaxy-server-config"><span class="std std-ref">Configuring the ansible-galaxy client</span></a> if you are using any other Galaxy server, such as Red Hat Automation Hub.</p> <p>To install a collection hosted in Galaxy:</p> <pre data-language="bash">ansible-galaxy collection install my_namespace.my_collection
</pre> <p>To upgrade a collection to the latest available version from the Galaxy server you can use the <code>--upgrade</code> option:</p> <pre data-language="bash">ansible-galaxy collection install my_namespace.my_collection --upgrade
</pre> <p>You can also directly use the tarball from your build:</p> <pre data-language="bash">ansible-galaxy collection install my_namespace-my_collection-1.0.0.tar.gz -p ./collections
</pre> <p>You can build and install a collection from a local source directory. The <code>ansible-galaxy</code> utility builds the collection using the <code>MANIFEST.json</code> or <code>galaxy.yml</code> metadata in the directory.</p> <pre data-language="bash">ansible-galaxy collection install /path/to/collection -p ./collections
</pre> <p>You can also install multiple collections in a namespace directory.</p> <pre data-language="text">ns/
├── collection1/
│   ├── MANIFEST.json
│   └── plugins/
└── collection2/
    ├── galaxy.yml
    └── plugins/
</pre> <pre data-language="bash">ansible-galaxy collection install /path/to/ns -p ./collections
</pre> <div class="admonition note"> <p class="admonition-title">Note</p> <p>The install command automatically appends the path <code>ansible_collections</code> to the one specified with the <code>-p</code> option unless the parent directory is already in a folder called <code>ansible_collections</code>.</p> </div> <p>When using the <code>-p</code> option to specify the install path, use one of the values configured in <a class="reference internal" href="../reference_appendices/config.html#collections-paths"><span class="std std-ref">COLLECTIONS_PATHS</span></a>, as this is where Ansible itself will expect to find collections. If you don’t specify a path, <code>ansible-galaxy collection install</code> installs the collection to the first path defined in <a class="reference internal" href="../reference_appendices/config.html#collections-paths"><span class="std std-ref">COLLECTIONS_PATHS</span></a>, which by default is <code>~/.ansible/collections</code></p> <p>You can also keep a collection adjacent to the current playbook, under a <code>collections/ansible_collections/</code> directory structure.</p> <pre data-language="text">./
├── play.yml
├── collections/
│   └── ansible_collections/
│               └── my_namespace/
│                   └── my_collection/&lt;collection structure lives here&gt;
</pre> <p>See <a class="reference internal" href="https://docs.ansible.com/ansible/latest/dev_guide/developing_collections_structure.html#collection-structure"><span class="std std-ref">Collection structure</span></a> for details on the collection directory structure.</p>   <h3 id="collections-older-version">Installing an older version of a collection</h3> <p id="installing-an-older-version-of-a-collection">You can only have one version of a collection installed at a time. By default <code>ansible-galaxy</code> installs the latest available version. If you want to install a specific version, you can add a version range identifier. For example, to install the 1.0.0-beta.1 version of the collection:</p> <pre data-language="bash">ansible-galaxy collection install my_namespace.my_collection:==1.0.0-beta.1
</pre> <p>You can specify multiple range identifiers separated by <code>,</code>. Use single quotes so the shell passes the entire command, including <code>&gt;</code>, <code>!</code>, and other operators, along. For example, to install the most recent version that is greater than or equal to 1.0.0 and less than 2.0.0:</p> <pre data-language="bash">ansible-galaxy collection install 'my_namespace.my_collection:&gt;=1.0.0,&lt;2.0.0'
</pre> <p>Ansible will always install the most recent version that meets the range identifiers you specify. You can use the following range identifiers:</p> <ul class="simple"> <li>
<code>*</code>: The most recent version. This is the default.</li> <li>
<code>!=</code>: Not equal to the version specified.</li> <li>
<code>==</code>: Exactly the version specified.</li> <li>
<code>&gt;=</code>: Greater than or equal to the version specified.</li> <li>
<code>&gt;</code>: Greater than the version specified.</li> <li>
<code>&lt;=</code>: Less than or equal to the version specified.</li> <li>
<code>&lt;</code>: Less than the version specified.</li> </ul> <div class="admonition note"> <p class="admonition-title">Note</p> <p>By default <code>ansible-galaxy</code> ignores pre-release versions. To install a pre-release version, you must use the <code>==</code> range identifier to require it explicitly.</p> </div>   <h3 id="installing-a-collection-from-a-git-repository">Installing a collection from a git repository</h3> <p>You can install a collection from a git repository instead of from Galaxy or Automation Hub. As a developer, installing from a git repository lets you review your collection before you create the tarball and publish the collection. As a user, installing from a git repository lets you use collections or versions that are not in Galaxy or Automation Hub yet.</p> <p>The repository must contain a <code>galaxy.yml</code> or <code>MANIFEST.json</code> file. This file provides metadata such as the version number and namespace of the collection.</p>  <h4 id="installing-a-collection-from-a-git-repository-at-the-command-line">Installing a collection from a git repository at the command line</h4> <p>To install a collection from a git repository at the command line, use the URI of the repository instead of a collection name or path to a <code>tar.gz</code> file. Prefix the URI with <code>git+</code> (or with <code>git@</code> to use a private repository with ssh authentication). You can specify a branch, commit, or tag using the comma-separated <a class="reference external" href="https://git-scm.com/docs/gitglossary#def_commit-ish">git commit-ish</a> syntax.</p> <p>For example:</p> <pre data-language="bash"># Install a collection in a repository using the latest commit on the branch 'devel'
ansible-galaxy collection install git+https://github.com/organization/repo_name.git,devel

# Install a collection from a private github repository
ansible-galaxy collection install git@github.com:organization/repo_name.git

# Install a collection from a local git repository
ansible-galaxy collection install git+file:///home/user/path/to/repo_name.git
</pre> <div class="admonition warning"> <p class="admonition-title">Warning</p> <p>Embedding credentials into a git URI is not secure. Use safe authentication options to prevent your credentials from being exposed in logs or elsewhere.</p> <ul class="simple"> <li>Use <a class="reference external" href="https://help.github.com/en/github/authenticating-to-github/connecting-to-github-with-ssh">SSH</a> authentication</li> <li>Use <a class="reference external" href="https://linux.die.net/man/5/netrc">netrc</a> authentication</li> <li>Use <a class="reference external" href="https://git-scm.com/docs/git-config#Documentation/git-config.txt-httpextraHeader">http.extraHeader</a> in your git configuration</li> <li>Use <a class="reference external" href="https://git-scm.com/docs/git-config#Documentation/git-config.txt-urlltbasegtpushInsteadOf">url.&lt;base&gt;.pushInsteadOf</a> in your git configuration</li> </ul> </div>   <h4 id="specifying-the-collection-location-within-the-git-repository">Specifying the collection location within the git repository</h4> <p>When you install a collection from a git repository, Ansible uses the collection <code>galaxy.yml</code> or <code>MANIFEST.json</code> metadata file to build the collection. By default, Ansible searches two paths for collection <code>galaxy.yml</code> or <code>MANIFEST.json</code> metadata files:</p> <ul class="simple"> <li>The top level of the repository.</li> <li>Each directory in the repository path (one level deep).</li> </ul> <p>If a <code>galaxy.yml</code> or <code>MANIFEST.json</code> file exists in the top level of the repository, Ansible uses the collection metadata in that file to install an individual collection.</p> <pre data-language="text">├── galaxy.yml
├── plugins/
│   ├── lookup/
│   ├── modules/
│   └── module_utils/
└─── README.md
</pre> <p>If a <code>galaxy.yml</code> or <code>MANIFEST.json</code> file exists in one or more directories in the repository path (one level deep), Ansible installs each directory with a metadata file as a collection. For example, Ansible installs both collection1 and collection2 from this repository structure by default:</p> <pre data-language="text">├── collection1
│   ├── docs/
│   ├── galaxy.yml
│   └── plugins/
│       ├── inventory/
│       └── modules/
└── collection2
    ├── docs/
    ├── galaxy.yml
    ├── plugins/
    |   ├── filter/
    |   └── modules/
    └── roles/
</pre> <p>If you have a different repository structure or only want to install a subset of collections, you can add a fragment to the end of your URI (before the optional comma-separated version) to indicate the location of the metadata file or files. The path should be a directory, not the metadata file itself. For example, to install only collection2 from the example repository with two collections:</p> <pre data-language="text">ansible-galaxy collection install git+https://github.com/organization/repo_name.git#/collection2/
</pre> <p>In some repositories, the main directory corresponds to the namespace:</p> <pre data-language="text">namespace/
├── collectionA/
|   ├── docs/
|   ├── galaxy.yml
|   ├── plugins/
|   │   ├── README.md
|   │   └── modules/
|   ├── README.md
|   └── roles/
└── collectionB/
    ├── docs/
    ├── galaxy.yml
    ├── plugins/
    │   ├── connection/
    │   └── modules/
    ├── README.md
    └── roles/
</pre> <p>You can install all collections in this repository, or install one collection from a specific commit:</p> <pre data-language="bash"># Install all collections in the namespace
ansible-galaxy collection install git+https://github.com/organization/repo_name.git#/namespace/

# Install an individual collection using a specific commit
ansible-galaxy collection install git+https://github.com/organization/repo_name.git#/namespace/collectionA/,7b60ddc245bc416b72d8ea6ed7b799885110f5e5
</pre>    <h3 id="collection-requirements-file">Install multiple collections with a requirements file</h3> <p id="install-multiple-collections-with-a-requirements-file">You can set up a <code>requirements.yml</code> file to install multiple collections in one command. This file is a YAML file in the format:</p> <pre data-language="yaml+jinja">---
collections:
# With just the collection name
- my_namespace.my_collection

# With the collection name, version, and source options
- name: my_namespace.my_other_collection
  version: 'version range identifiers (default: ``*``)'
  source: 'The Galaxy URL to pull the collection from (default: ``--api-server`` from cmdline)'
</pre> <p>You can specify four keys for each collection entry:</p>  <ul class="simple"> <li><code>name</code></li> <li><code>version</code></li> <li><code>source</code></li> <li><code>type</code></li> </ul>  <p>The <code>version</code> key uses the same range identifier format documented in <a class="reference internal" href="#collections-older-version"><span class="std std-ref">Installing an older version of a collection</span></a>.</p> <p>The <code>type</code> key can be set to <code>galaxy</code>, <code>url</code>, <code>file</code>, and <code>git</code>. If <code>type</code> is omitted, the <code>name</code> key is used to implicitly determine the source of the collection.</p> <p>When you install a collection with <code>type: git</code>, the <code>version</code> key can refer to a branch or to a <a class="reference external" href="https://git-scm.com/docs/gitglossary#def_commit-ish">git commit-ish</a> object (commit or tag). For example:</p> <pre data-language="yaml">collections:
  - name: https://github.com/organization/repo_name.git
    type: git
    version: devel
</pre> <p>You can also add roles to a <code>requirements.yml</code> file, under the <code>roles</code> key. The values follow the same format as a requirements file used in older Ansible releases.</p> <pre data-language="yaml">---
roles:
  # Install a role from Ansible Galaxy.
  - name: geerlingguy.java
    version: 1.9.6

collections:
  # Install a collection from Ansible Galaxy.
  - name: geerlingguy.php_roles
    version: 0.9.3
    source: https://galaxy.ansible.com
</pre> <p>To install both roles and collections at the same time with one command, run the following:</p> <pre data-language="bash">$ ansible-galaxy install -r requirements.yml
</pre> <p>Running <code>ansible-galaxy collection install -r</code> or <code>ansible-galaxy role install -r</code> will only install collections, or roles respectively.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>Installing both roles and collections from the same requirements file will not work when specifying a custom collection or role install path. In this scenario the collections will be skipped and the command will process each like <code>ansible-galaxy role install</code> would.</p> </div>   <h3 id="collection-offline-download">Downloading a collection for offline use</h3> <p id="downloading-a-collection-for-offline-use">To download the collection tarball from Galaxy for offline use:</p> <ol class="arabic simple"> <li>Navigate to the collection page.</li> <li>Click on <span class="guilabel">Download tarball</span>.</li> </ol> <p>You may also need to manually download any dependent collections.</p>   <h3 id="galaxy-server-config">Configuring the <code>ansible-galaxy</code> client</h3> <p id="configuring-the-ansible-galaxy-client">By default, <code>ansible-galaxy</code> uses <a class="reference external" href="https://galaxy.ansible.com">https://galaxy.ansible.com</a> as the Galaxy server (as listed in the <code>ansible.cfg</code> file under <a class="reference internal" href="../reference_appendices/config.html#galaxy-server"><span class="std std-ref">GALAXY_SERVER</span></a>).</p> <p>You can use either option below to configure <code>ansible-galaxy collection</code> to use other servers (such as Red Hat Automation Hub or a custom Galaxy server):</p> <ul class="simple"> <li>Set the server list in the <a class="reference internal" href="../reference_appendices/config.html#galaxy-server-list"><span class="std std-ref">GALAXY_SERVER_LIST</span></a> configuration option in <a class="reference internal" href="../reference_appendices/config.html#ansible-configuration-settings-locations"><span class="std std-ref">The configuration file</span></a>.</li> <li>Use the <code>--server</code> command line argument to limit to an individual server.</li> </ul> <p>To configure a Galaxy server list in <code>ansible.cfg</code>:</p> <ol class="arabic simple"> <li>Add the <code>server_list</code> option under the <code>[galaxy]</code> section to one or more server names.</li> <li>Create a new section for each server name.</li> <li>Set the <code>url</code> option for each server name.</li> <li>Optionally, set the API token for each server name. Go to <a class="reference external" href="https://galaxy.ansible.com/me/preferences">https://galaxy.ansible.com/me/preferences</a> and click <span class="guilabel">Show API key</span>.</li> </ol> <div class="admonition note"> <p class="admonition-title">Note</p> <p>The <code>url</code> option for each server name must end with a forward slash <code>/</code>. If you do not set the API token in your Galaxy server list, use the <code>--api-key</code> argument to pass in the token to the <code>ansible-galaxy collection publish</code> command.</p> </div> <p>For Automation Hub, you additionally need to:</p> <ol class="arabic simple"> <li>Set the <code>auth_url</code> option for each server name.</li> <li>Set the API token for each server name. Go to <a class="reference external" href="https://cloud.redhat.com/ansible/automation-hub/token/">https://cloud.redhat.com/ansible/automation-hub/token/</a> and click :<span class="guilabel">Get API token</span> from the version dropdown to copy your API token.</li> </ol> <p>The following example shows how to configure multiple servers:</p> <pre data-language="ini">[galaxy]
server_list = automation_hub, my_org_hub, release_galaxy, test_galaxy

[galaxy_server.automation_hub]
url=https://cloud.redhat.com/api/automation-hub/
auth_url=https://sso.redhat.com/auth/realms/redhat-external/protocol/openid-connect/token
token=my_ah_token

[galaxy_server.my_org_hub]
url=https://automation.my_org/
username=my_user
password=my_pass

[galaxy_server.release_galaxy]
url=https://galaxy.ansible.com/
token=my_token

[galaxy_server.test_galaxy]
url=https://galaxy-dev.ansible.com/
token=my_test_token
</pre> <div class="admonition note"> <p class="admonition-title">Note</p> <p>You can use the <code>--server</code> command line argument to select an explicit Galaxy server in the <code>server_list</code> and the value of this argument should match the name of the server. To use a server not in the server list, set the value to the URL to access that server (all servers in the server list will be ignored). Also you cannot use the <code>--api-key</code> argument for any of the predefined servers. You can only use the <code>api_key</code> argument if you did not define a server list or if you specify a URL in the <code>--server</code> argument.</p> </div> <p><strong>Galaxy server list configuration options</strong></p> <p>The <a class="reference internal" href="../reference_appendices/config.html#galaxy-server-list"><span class="std std-ref">GALAXY_SERVER_LIST</span></a> option is a list of server identifiers in a prioritized order. When searching for a collection, the install process will search in that order, for example, <code>automation_hub</code> first, then <code>my_org_hub</code>, <code>release_galaxy</code>, and finally <code>test_galaxy</code> until the collection is found. The actual Galaxy instance is then defined under the section <code>[galaxy_server.{{ id }}]</code> where <code>{{ id }}</code> is the server identifier defined in the list. This section can then define the following keys:</p> <ul class="simple"> <li>
<code>url</code>: The URL of the Galaxy instance to connect to. Required.</li> <li>
<code>token</code>: An API token key to use for authentication against the Galaxy instance. Mutually exclusive with <code>username</code>.</li> <li>
<code>username</code>: The username to use for basic authentication against the Galaxy instance. Mutually exclusive with <code>token</code>.</li> <li>
<code>password</code>: The password to use, in conjunction with <code>username</code>, for basic authentication.</li> <li>
<code>auth_url</code>: The URL of a Keycloak server ‘token_endpoint’ if using SSO authentication (for example, Automation Hub). Mutually exclusive with <code>username</code>. Requires <code>token</code>.</li> </ul> <p>As well as defining these server options in the <code>ansible.cfg</code> file, you can also define them as environment variables. The environment variable is in the form <code>ANSIBLE_GALAXY_SERVER_{{ id }}_{{ key }}</code> where <code>{{ id }}</code> is the upper case form of the server identifier and <code>{{ key }}</code> is the key to define. For example I can define <code>token</code> for <code>release_galaxy</code> by setting <code>ANSIBLE_GALAXY_SERVER_RELEASE_GALAXY_TOKEN=secret_token</code>.</p> <p>For operations that use only one Galaxy server (for example, the <code>publish</code>, <code>info</code>, or <code>install</code> commands). the <code>ansible-galaxy collection</code> command uses the first entry in the <code>server_list</code>, unless you pass in an explicit server with the <code>--server</code> argument.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>Once a collection is found, any of its requirements are only searched within the same Galaxy instance as the parent collection. The install process will not search for a collection requirement in a different Galaxy instance.</p> </div>    <h2 id="collections-downloading">Downloading collections</h2> <p id="downloading-collections">To download a collection and its dependencies for an offline install, run <code>ansible-galaxy collection download</code>. This downloads the collections specified and their dependencies to the specified folder and creates a <code>requirements.yml</code> file which can be used to install those collections on a host without access to a Galaxy server. All the collections are downloaded by default to the <code>./collections</code> folder.</p> <p>Just like the <code>install</code> command, the collections are sourced based on the <a class="reference internal" href="#galaxy-server-config"><span class="std std-ref">configured galaxy server config</span></a>. Even if a collection to download was specified by a URL or path to a tarball, the collection will be redownloaded from the configured Galaxy server.</p> <p>Collections can be specified as one or multiple collections or with a <code>requirements.yml</code> file just like <code>ansible-galaxy collection install</code>.</p> <p>To download a single collection and its dependencies:</p> <pre data-language="bash">ansible-galaxy collection download my_namespace.my_collection
</pre> <p>To download a single collection at a specific version:</p> <pre data-language="bash">ansible-galaxy collection download my_namespace.my_collection:1.0.0
</pre> <p>To download multiple collections either specify multiple collections as command line arguments as shown above or use a requirements file in the format documented with <a class="reference internal" href="#collection-requirements-file"><span class="std std-ref">Install multiple collections with a requirements file</span></a>.</p> <pre data-language="bash">ansible-galaxy collection download -r requirements.yml
</pre> <p>You can also download a source collection directory. The collection is built with the mandatory <code>galaxy.yml</code> file.</p> <pre data-language="bash">ansible-galaxy collection download /path/to/collection

ansible-galaxy collection download git+file:///path/to/collection/.git
</pre> <p>You can download multiple source collections from a single namespace by providing the path to the namespace.</p> <pre data-language="text">ns/
├── collection1/
│   ├── galaxy.yml
│   └── plugins/
└── collection2/
    ├── galaxy.yml
    └── plugins/
</pre> <pre data-language="bash">ansible-galaxy collection install /path/to/ns
</pre> <p>All the collections are downloaded by default to the <code>./collections</code> folder but you can use <code>-p</code> or <code>--download-path</code> to specify another path:</p> <pre data-language="bash">ansible-galaxy collection download my_namespace.my_collection -p ~/offline-collections
</pre> <p>Once you have downloaded the collections, the folder contains the collections specified, their dependencies, and a <code>requirements.yml</code> file. You can use this folder as is with <code>ansible-galaxy collection install</code> to install the collections on a host without access to a Galaxy or Automation Hub server.</p> <pre data-language="bash"># This must be run from the folder that contains the offline collections and requirements.yml file downloaded
# by the internet-connected host
cd ~/offline-collections
ansible-galaxy collection install -r requirements.yml
</pre>   <h2 id="collections-listing">Listing collections</h2> <p id="listing-collections">To list installed collections, run <code>ansible-galaxy collection list</code>. This shows all of the installed collections found in the configured collections search paths. It will also show collections under development which contain a galaxy.yml file instead of a MANIFEST.json. The path where the collections are located are displayed as well as version information. If no version information is available, a <code>*</code> is displayed for the version number.</p> <pre data-language="shell"># /home/astark/.ansible/collections/ansible_collections
Collection                 Version
-------------------------- -------
cisco.aci                  0.0.5
cisco.mso                  0.0.4
sandwiches.ham             *
splunk.es                  0.0.5

# /usr/share/ansible/collections/ansible_collections
Collection        Version
----------------- -------
fortinet.fortios  1.0.6
pureport.pureport 0.0.8
sensu.sensu_go    1.3.0
</pre> <p>Run with <code>-vvv</code> to display more detailed information.</p> <p>To list a specific collection, pass a valid fully qualified collection name (FQCN) to the command <code>ansible-galaxy collection list</code>. All instances of the collection will be listed.</p> <pre data-language="shell">&gt; ansible-galaxy collection list fortinet.fortios

# /home/astark/.ansible/collections/ansible_collections
Collection       Version
---------------- -------
fortinet.fortios 1.0.1

# /usr/share/ansible/collections/ansible_collections
Collection       Version
---------------- -------
fortinet.fortios 1.0.6
</pre> <p>To search other paths for collections, use the <code>-p</code> option. Specify multiple search paths by separating them with a <code>:</code>. The list of paths specified on the command line will be added to the beginning of the configured collections search paths.</p> <pre data-language="shell">&gt; ansible-galaxy collection list -p '/opt/ansible/collections:/etc/ansible/collections'

# /opt/ansible/collections/ansible_collections
Collection      Version
--------------- -------
sandwiches.club 1.7.2

# /etc/ansible/collections/ansible_collections
Collection     Version
-------------- -------
sandwiches.pbj 1.2.0

# /home/astark/.ansible/collections/ansible_collections
Collection                 Version
-------------------------- -------
cisco.aci                  0.0.5
cisco.mso                  0.0.4
fortinet.fortios           1.0.1
sandwiches.ham             *
splunk.es                  0.0.5

# /usr/share/ansible/collections/ansible_collections
Collection        Version
----------------- -------
fortinet.fortios  1.0.6
pureport.pureport 0.0.8
sensu.sensu_go    1.3.0
</pre>   <h2 id="id2">Verifying collections</h2>  <h3 id="verifying-collections">Verifying collections with <code>ansible-galaxy</code>
</h3> <p>Once installed, you can verify that the content of the installed collection matches the content of the collection on the server. This feature expects that the collection is installed in one of the configured collection paths and that the collection exists on one of the configured galaxy servers.</p> <pre data-language="bash">ansible-galaxy collection verify my_namespace.my_collection
</pre> <p>The output of the <code>ansible-galaxy collection verify</code> command is quiet if it is successful. If a collection has been modified, the altered files are listed under the collection name.</p> <pre data-language="bash">ansible-galaxy collection verify my_namespace.my_collection
Collection my_namespace.my_collection contains modified content in the following files:
my_namespace.my_collection
    plugins/inventory/my_inventory.py
    plugins/modules/my_module.py
</pre> <p>You can use the <code>-vvv</code> flag to display additional information, such as the version and path of the installed collection, the URL of the remote collection used for validation, and successful verification output.</p> <pre data-language="bash">ansible-galaxy collection verify my_namespace.my_collection -vvv
...
Verifying 'my_namespace.my_collection:1.0.0'.
Installed collection found at '/path/to/ansible_collections/my_namespace/my_collection/'
Remote collection found at 'https://galaxy.ansible.com/download/my_namespace-my_collection-1.0.0.tar.gz'
Successfully verified that checksums for 'my_namespace.my_collection:1.0.0' match the remote collection
</pre> <p>If you have a pre-release or non-latest version of a collection installed you should include the specific version to verify. If the version is omitted, the installed collection is verified against the latest version available on the server.</p> <pre data-language="bash">ansible-galaxy collection verify my_namespace.my_collection:1.0.0
</pre> <p>In addition to the <code>namespace.collection_name:version</code> format, you can provide the collections to verify in a <code>requirements.yml</code> file. Dependencies listed in <code>requirements.yml</code> are not included in the verify process and should be verified separately.</p> <pre data-language="bash">ansible-galaxy collection verify -r requirements.yml
</pre> <p>Verifying against <code>tar.gz</code> files is not supported. If your <code>requirements.yml</code> contains paths to tar files or URLs for installation, you can use the <code>--ignore-errors</code> flag to ensure that all collections using the <code>namespace.name</code> format in the file are processed.</p>    <h2 id="collections-using-playbook">Using collections in a Playbook</h2> <p id="using-collections-in-a-playbook">Once installed, you can reference a collection content by its fully qualified collection name (FQCN):</p> <pre data-language="yaml">- hosts: all
  tasks:
    - my_namespace.my_collection.mymodule:
        option1: value
</pre> <p>This works for roles or any type of plugin distributed within the collection:</p> <pre data-language="yaml">- hosts: all
  tasks:
    - import_role:
        name: my_namespace.my_collection.role1

    - my_namespace.mycollection.mymodule:
        option1: value

    - debug:
        msg: '{{ lookup("my_namespace.my_collection.lookup1", 'param1')| my_namespace.my_collection.filter1 }}'
</pre>   <h2 id="simplifying-module-names-with-the-collections-keyword">Simplifying module names with the <code>collections</code> keyword</h2> <p>The <code>collections</code> keyword lets you define a list of collections that your role or playbook should search for unqualified module and action names. So you can use the <code>collections</code> keyword, then simply refer to modules and action plugins by their short-form names throughout that role or playbook.</p> <div class="admonition warning"> <p class="admonition-title">Warning</p> <p>If your playbook uses both the <code>collections</code> keyword and one or more roles, the roles do not inherit the collections set by the playbook. This is one of the reasons we recommend you always use FQCN. See below for roles details.</p> </div>  <h3 id="using-collections-in-roles">Using <code>collections</code> in roles</h3> <p>Within a role, you can control which collections Ansible searches for the tasks inside the role using the <code>collections</code> keyword in the role’s <code>meta/main.yml</code>. Ansible will use the collections list defined inside the role even if the playbook that calls the role defines different collections in a separate <code>collections</code> keyword entry. Roles defined inside a collection always implicitly search their own collection first, so you don’t need to use the <code>collections</code> keyword to access modules, actions, or other roles contained in the same collection.</p> <pre data-language="yaml"># myrole/meta/main.yml
collections:
  - my_namespace.first_collection
  - my_namespace.second_collection
  - other_namespace.other_collection
</pre>   <h3 id="using-collections-in-playbooks">Using <code>collections</code> in playbooks</h3> <p>In a playbook, you can control the collections Ansible searches for modules and action plugins to execute. However, any roles you call in your playbook define their own collections search order; they do not inherit the calling playbook’s settings. This is true even if the role does not define its own <code>collections</code> keyword.</p> <pre data-language="yaml">- hosts: all
  collections:
    - my_namespace.my_collection

  tasks:
    - import_role:
        name: role1

    - mymodule:
        option1: value

    - debug:
        msg: '{{ lookup("my_namespace.my_collection.lookup1", "param1")| my_namespace.my_collection.filter1 }}'
</pre> <p>The <code>collections</code> keyword merely creates an ordered ‘search path’ for non-namespaced plugin and role references. It does not install content or otherwise change Ansible’s behavior around the loading of plugins or roles. Note that an FQCN is still required for non-action or module plugins (for example, lookups, filters, tests).</p>    <h2 id="using-a-playbook-from-a-collection">Using a playbook from a collection</h2> <div class="versionadded"> <p><span class="versionmodified added">New in version 2.11.</span></p> </div> <p>You can also distribute playbooks in your collection and invoke them using the same semantics you use for plugins:</p> <pre data-language="shell">ansible-playbook my_namespace.my_collection.playbook1 -i ./myinventory
</pre> <p>From inside a playbook:</p> <pre data-language="yaml">- import_playbook: my_namespace.my_collection.playbookX
</pre> <p>A few recommendations when creating such playbooks, <code>hosts:</code> should be generic or at least have a variable input.</p> <pre data-language="yaml">- hosts: all  # Use --limit or customized inventory to restrict hosts targeted

- hosts: localhost  # For things you want to restrict to the controller

- hosts: '{{target|default("webservers")}}'  # Assumes inventory provides a 'webservers' group, but can also use ``-e 'target=host1,host2'``
</pre> <p>This will have an implied entry in the <code>collections:</code> keyword of <code>my_namespace.my_collection</code> just as with roles.</p> <div class="admonition seealso"> <p class="admonition-title">See also</p> <dl class="simple"> <dt><a class="reference internal" href="https://docs.ansible.com/ansible/latest/dev_guide/developing_collections.html#developing-collections"><span class="std std-ref">Developing collections</span></a></dt>
<dd>
<p>Develop or modify a collection.</p> </dd> <dt><a class="reference internal" href="https://docs.ansible.com/ansible/latest/dev_guide/collections_galaxy_meta.html#collections-galaxy-meta"><span class="std std-ref">Collection Galaxy metadata structure</span></a></dt>
<dd>
<p>Understand the collections metadata structure.</p> </dd> <dt><a class="reference external" href="https://groups.google.com/group/ansible-devel">Mailing List</a></dt>
<dd>
<p>The development mailing list</p> </dd> <dt><a class="reference external" href="https://libera.chat/">irc.libera.chat</a></dt>
<dd>
<p>#ansible IRC chat channel</p> </dd> </dl> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2012&ndash;2018 Michael DeHaan<br>&copy; 2018&ndash;2021 Red Hat, Inc.<br>Licensed under the GNU General Public License version 3.<br>
    <a href="https://docs.ansible.com/ansible/latest/user_guide/collections_using.html" class="_attribution-link">https://docs.ansible.com/ansible/latest/user_guide/collections_using.html</a>
  </p>
</div>
