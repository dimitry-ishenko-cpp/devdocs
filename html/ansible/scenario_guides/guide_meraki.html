<h1 id="meraki-guide">Cisco Meraki Guide</h1>  <ul class="simple" id="cisco-meraki-guide"> <li>
<p><a class="reference internal" href="#what-is-cisco-meraki" id="id1">What is Cisco Meraki?</a></p> <ul> <li><a class="reference internal" href="#ms-switches" id="id2">MS Switches</a></li> <li><a class="reference internal" href="#mx-firewalls" id="id3">MX Firewalls</a></li> <li><a class="reference internal" href="#mr-wireless-access-points" id="id4">MR Wireless Access Points</a></li> </ul> </li> <li><a class="reference internal" href="#using-the-meraki-modules" id="id5">Using the Meraki modules</a></li> <li><a class="reference internal" href="#common-parameters" id="id6">Common Parameters</a></li> <li><a class="reference internal" href="#meraki-authentication" id="id7">Meraki Authentication</a></li> <li><a class="reference internal" href="#returned-data-structures" id="id8">Returned Data Structures</a></li> <li><a class="reference internal" href="#handling-returned-data" id="id9">Handling Returned Data</a></li> <li><a class="reference internal" href="#merging-existing-and-new-data" id="id10">Merging Existing and New Data</a></li> <li><a class="reference internal" href="#error-handling" id="id11">Error Handling</a></li> </ul>   <h2 id="meraki-guide-intro">What is Cisco Meraki?</h2> <p id="what-is-cisco-meraki">Cisco Meraki is an easy-to-use, cloud-based, network infrastructure platform for enterprise environments. While most network hardware uses command-line interfaces (CLIs) for configuration, Meraki uses an easy-to-use Dashboard hosted in the Meraki cloud. No on-premises management hardware or software is required - only the network infrastructure to run your business.</p>  <h3 id="ms-switches">MS Switches</h3> <p>Meraki MS switches come in multiple flavors and form factors. Meraki switches support 10/100/1000/10000 ports, as well as Cisco’s mGig technology for 2.5/5/10Gbps copper connectivity. 8, 24, and 48 port flavors are available with PoE (802.3af/802.3at/UPoE) available on many models.</p>   <h3 id="mx-firewalls">MX Firewalls</h3> <p>Meraki’s MX firewalls support full layer 3-7 deep packet inspection. MX firewalls are compatible with a variety of VPN technologies including IPSec, SSL VPN, and Meraki’s easy-to-use AutoVPN.</p>   <h3 id="mr-wireless-access-points">MR Wireless Access Points</h3> <p>MR access points are enterprise-class, high-performance access points for the enterprise. MR access points have MIMO technology and integrated beamforming built-in for high performance applications. BLE allows for advanced location applications to be developed with no on-premises analytics platforms.</p>    <h2 id="using-the-meraki-modules">Using the Meraki modules</h2> <p>Meraki modules provide a user-friendly interface to manage your Meraki environment using Ansible. For example, details about SNMP settings for a particular organization can be discovered using the module <code>meraki_snmp &lt;meraki_snmp_module&gt;</code>.</p> <pre data-language="yaml">- name: Query SNMP settings
  meraki_snmp:
    api_key: abc123
    org_name: AcmeCorp
    state: query
  delegate_to: localhost
</pre> <p>Information about a particular object can be queried. For example, the <code>meraki_admin &lt;meraki_admin_module&gt;</code> module supports</p> <pre data-language="yaml">- name: Gather information about Jane Doe
  meraki_admin:
    api_key: abc123
    org_name: AcmeCorp
    state: query
    email: janedoe@email.com
  delegate_to: localhost
</pre>   <h2 id="common-parameters">Common Parameters</h2> <p>All Ansible Meraki modules support the following parameters which affect communication with the Meraki Dashboard API. Most of these should only be used by Meraki developers and not the general public.</p>  <dl class="simple"> <dt>host</dt>
<dd>
<p>Hostname or IP of Meraki Dashboard.</p> </dd> <dt>use_https</dt>
<dd>
<p>Specifies whether communication should be over HTTPS. (Defaults to <code>yes</code>)</p> </dd> <dt>use_proxy</dt>
<dd>
<p>Whether to use a proxy for any communication.</p> </dd> <dt>validate_certs</dt>
<dd>
<p>Determine whether certificates should be validated or trusted. (Defaults to <code>yes</code>)</p> </dd> </dl>  <p>These are the common parameters which are used for most every module.</p>  <dl class="simple"> <dt>org_name</dt>
<dd>
<p>Name of organization to perform actions in.</p> </dd> <dt>org_id</dt>
<dd>
<p>ID of organization to perform actions in.</p> </dd> <dt>net_name</dt>
<dd>
<p>Name of network to perform actions in.</p> </dd> <dt>net_id</dt>
<dd>
<p>ID of network to perform actions in.</p> </dd> <dt>state</dt>
<dd>
<p>General specification of what action to take. <code>query</code> does lookups. <code>present</code> creates or edits. <code>absent</code> deletes.</p> </dd> </dl>  <div class="admonition hint"> <p class="admonition-title">Hint</p> <p>Use the <code>org_id</code> and <code>net_id</code> parameters when possible. <code>org_name</code> and <code>net_name</code> require additional behind-the-scenes API calls to learn the ID values. <code>org_id</code> and <code>net_id</code> will perform faster.</p> </div>   <h2 id="meraki-authentication">Meraki Authentication</h2> <p>All API access with the Meraki Dashboard requires an API key. An API key can be generated from the organization’s settings page. Each play in a playbook requires the <code>api_key</code> parameter to be specified.</p> <p>The “Vault” feature of Ansible allows you to keep sensitive data such as passwords or keys in encrypted files, rather than as plain text in your playbooks or roles. These vault files can then be distributed or placed in source control. See <a class="reference internal" href="../user_guide/vault.html#playbooks-vault"><span class="std std-ref">Using encrypted variables and files</span></a> for more information.</p> <p>Meraki’s API returns a 404 error if the API key is not correct. It does not provide any specific error saying the key is incorrect. If you receive a 404 error, check the API key first.</p>   <h2 id="returned-data-structures">Returned Data Structures</h2> <p>Meraki and its related Ansible modules return most information in the form of a list. For example, this is returned information by <code>meraki_admin</code> querying administrators. It returns a list even though there’s only one.</p> <pre data-language="json">[
    {
        "orgAccess": "full",
        "name": "John Doe",
        "tags": [],
        "networks": [],
        "email": "john@doe.com",
        "id": "12345677890"
    }
]
</pre>   <h2 id="handling-returned-data">Handling Returned Data</h2> <p>Since Meraki’s response data uses lists instead of properly keyed dictionaries for responses, certain strategies should be used when querying data for particular information. For many situations, use the <code>selectattr()</code> Jinja2 function.</p>   <h2 id="merging-existing-and-new-data">Merging Existing and New Data</h2> <p>Ansible’s Meraki modules do not allow for manipulating data. For example, you may need to insert a rule in the middle of a firewall ruleset. Ansible and the Meraki modules lack a way to directly merge to manipulate data. However, a playlist can use a few tasks to split the list where you need to insert a rule and then merge them together again with the new rule added. The steps involved are as follows:</p> <ol class="arabic"> <li>
<dl> <dt>Create blank “front” and “back” lists.</dt>
<dd>
<pre data-language="YAML+Jinja">vars:
  - front_rules: []
  - back_rules: []
</pre> </dd> </dl> </li> <li>
<dl> <dt>Get existing firewall rules from Meraki and create a new variable.</dt>
<dd>
<pre data-language="YAML+Jinja">- name: Get firewall rules
  meraki_mx_l3_firewall:
    auth_key: abc123
    org_name: YourOrg
    net_name: YourNet
    state: query
  delegate_to: localhost
  register: rules
- set_fact:
    original_ruleset: '{{rules.data}}'
</pre> </dd> </dl> </li> <li>
<dl> <dt>
<code>Write the new rule. The new rule needs to be in a list so it can be merged with other lists in an upcoming step. The blank - puts the rule in a list so it can be merged.</code> </dt>
<dd>
<pre data-language="YAML+Jinja">- set_fact:
    new_rule:
      -
        - comment: Block traffic to server
          src_cidr: 192.0.1.0/24
          src_port: any
          dst_cidr: 192.0.1.2/32
          dst_port: any
          protocol: any
          policy: deny
</pre> </dd> </dl> </li> <li>
<dl> <dt>Split the rules into two lists. This assumes the existing ruleset is 2 rules long.</dt>
<dd>
<pre data-language="YAML+Jinja">- set_fact:
    front_rules: '{{front_rules + [ original_ruleset[:1] ]}}'
- set_fact:
    back_rules: '{{back_rules + [ original_ruleset[1:] ]}}'
</pre> </dd> </dl> </li> <li>
<dl> <dt>Merge rules with the new rule in the middle.</dt>
<dd>
<pre data-language="YAML+Jinja">- set_fact:
    new_ruleset: '{{front_rules + new_rule + back_rules}}'
</pre> </dd> </dl> </li> <li>
<dl> <dt>Upload new ruleset to Meraki.</dt>
<dd>
<pre data-language="YAML+Jinja">- name: Set two firewall rules
  meraki_mx_l3_firewall:
    auth_key: abc123
    org_name: YourOrg
    net_name: YourNet
    state: present
    rules: '{{ new_ruleset }}'
  delegate_to: localhost
</pre> </dd> </dl> </li> </ol>   <h2 id="error-handling">Error Handling</h2> <p>Ansible’s Meraki modules will often fail if improper or incompatible parameters are specified. However, there will likely be scenarios where the module accepts the information but the Meraki API rejects the data. If this happens, the error will be returned in the <code>body</code> field for HTTP status of 400 return code.</p> <p>Meraki’s API returns a 404 error if the API key is not correct. It does not provide any specific error saying the key is incorrect. If you receive a 404 error, check the API key first. 404 errors can also occur if improper object IDs (ex. <code>org_id</code>) are specified.</p><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2012&ndash;2018 Michael DeHaan<br>&copy; 2018&ndash;2021 Red Hat, Inc.<br>Licensed under the GNU General Public License version 3.<br>
    <a href="https://docs.ansible.com/ansible/latest/scenario_guides/guide_meraki.html" class="_attribution-link">https://docs.ansible.com/ansible/latest/scenario_guides/guide_meraki.html</a>
  </p>
</div>
