<h1 id="nios-guide">Infoblox Guide</h1>   <ul id="infoblox-guide"> <li><a class="reference internal" href="#prerequisites" id="id2">Prerequisites</a></li> <li><a class="reference internal" href="#credentials-and-authenticating" id="id3">Credentials and authenticating</a></li> <li>
<p><a class="reference internal" href="#nios-lookup-plugins" id="id4">NIOS lookup plugins</a></p> <ul> <li><a class="reference internal" href="#retrieving-all-network-views" id="id5">Retrieving all network views</a></li> <li><a class="reference internal" href="#retrieving-a-host-record" id="id6">Retrieving a host record</a></li> </ul> </li> <li>
<p><a class="reference internal" href="#use-cases-with-modules" id="id7">Use cases with modules</a></p> <ul> <li><a class="reference internal" href="#configuring-an-ipv4-network" id="id8">Configuring an IPv4 network</a></li> <li><a class="reference internal" href="#creating-a-host-record" id="id9">Creating a host record</a></li> <li><a class="reference internal" href="#creating-a-forward-dns-zone" id="id10">Creating a forward DNS zone</a></li> <li><a class="reference internal" href="#creating-a-reverse-dns-zone" id="id11">Creating a reverse DNS zone</a></li> </ul> </li> <li><a class="reference internal" href="#dynamic-inventory-script" id="id12">Dynamic inventory script</a></li> </ul>
  <p>This guide describes how to use Ansible with the Infoblox Network Identity Operating System (NIOS). With Ansible integration, you can use Ansible playbooks to automate Infoblox Core Network Services for IP address management (IPAM), DNS, and inventory tracking.</p> <p>You can review simple example tasks in the documentation for any of the <a class="reference external" href="https://docs.ansible.com/ansible/2.9/modules/list_of_net_tools_modules.html#nios-net-tools-modules" title="(in Ansible v2.9)"><span class="xref std std-ref">NIOS modules</span></a> or look at the <a class="reference internal" href="#use-cases-with-modules">Use cases with modules</a> section for more elaborate examples. See the <a class="reference external" href="https://www.infoblox.com/">Infoblox</a> website for more information on the Infoblox product.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>You can retrieve most of the example playbooks used in this guide from the <a class="reference external" href="https://github.com/network-automation/infoblox_ansible">network-automation/infoblox_ansible</a> GitHub repository.</p> </div>  <h2 id="prerequisites">Prerequisites</h2> <p>Before using Ansible <code>nios</code> modules with Infoblox, you must install the <code>infoblox-client</code> on your Ansible control node:</p> <pre data-language="bash">$ sudo pip install infoblox-client
</pre> <div class="admonition note"> <p class="admonition-title">Note</p> <p>You need an NIOS account with the WAPI feature enabled to use Ansible with Infoblox.</p> </div>   <h2 id="nios-credentials">Credentials and authenticating</h2> <p id="credentials-and-authenticating">To use Infoblox <code>nios</code> modules in playbooks, you need to configure the credentials to access your Infoblox system. The examples in this guide use credentials stored in <code>&lt;playbookdir&gt;/group_vars/nios.yml</code>. Replace these values with your Infoblox credentials:</p> <pre data-language="yaml">---
nios_provider:
  host: 192.0.0.2
  username: admin
  password: ansible
</pre>   <h2 id="nios-lookup-plugins">NIOS lookup plugins</h2> <p>Ansible includes the following lookup plugins for NIOS:</p> <ul class="simple"> <li>
<a class="reference external" href="https://docs.ansible.com/ansible/2.9/plugins/lookup/nios.html#nios-lookup" title="(in Ansible v2.9)"><span class="xref std std-ref">nios</span></a> Uses the Infoblox WAPI API to fetch NIOS specified objects, for example network views, DNS views, and host records.</li> <li>
<a class="reference external" href="https://docs.ansible.com/ansible/2.9/plugins/lookup/nios_next_ip.html#nios-next-ip-lookup" title="(in Ansible v2.9)"><span class="xref std std-ref">nios_next_ip</span></a> Provides the next available IP address from a network. Youâ€™ll see an example of this in <a class="reference internal" href="#creating-a-host-record">Creating a host record</a>.</li> <li>
<a class="reference external" href="https://docs.ansible.com/ansible/2.9/plugins/lookup/nios_next_network.html#nios-next-network-lookup" title="(in Ansible v2.9)"><span class="xref std std-ref">nios_next_network</span></a> - Returns the next available network range for a network-container.</li> </ul> <p>You must run the NIOS lookup plugins locally by specifying <code>connection: local</code>. See <a class="reference internal" href="../plugins/lookup.html#lookup-plugins"><span class="std std-ref">lookup plugins</span></a> for more detail.</p>  <h3 id="retrieving-all-network-views">Retrieving all network views</h3> <p>To retrieve all network views and save them in a variable, use the <a class="reference internal" href="../collections/ansible/builtin/set_fact_module.html#set-fact-module"><span class="std std-ref">set_fact</span></a> module with the <a class="reference external" href="https://docs.ansible.com/ansible/2.9/plugins/lookup/nios.html#nios-lookup" title="(in Ansible v2.9)"><span class="xref std std-ref">nios</span></a> lookup plugin:</p> <pre data-language="yaml">---
- hosts: nios
  connection: local
  tasks:
    - name: fetch all networkview objects
      set_fact:
        networkviews: "{{ lookup('nios', 'networkview', provider=nios_provider) }}"

    - name: check the networkviews
      debug:
        var: networkviews
</pre>   <h3 id="retrieving-a-host-record">Retrieving a host record</h3> <p>To retrieve a set of host records, use the <code>set_fact</code> module with the <code>nios</code> lookup plugin and include a filter for the specific hosts you want to retrieve:</p> <pre data-language="yaml">---
- hosts: nios
  connection: local
  tasks:
    - name: fetch host leaf01
      set_fact:
         host: "{{ lookup('nios', 'record:host', filter={'name': 'leaf01.ansible.com'}, provider=nios_provider) }}"

    - name: check the leaf01 return variable
      debug:
        var: host

    - name: debug specific variable (ipv4 address)
      debug:
        var: host.ipv4addrs[0].ipv4addr

    - name: fetch host leaf02
      set_fact:
        host: "{{ lookup('nios', 'record:host', filter={'name': 'leaf02.ansible.com'}, provider=nios_provider) }}"

    - name: check the leaf02 return variable
      debug:
        var: host
</pre> <p>If you run this <code>get_host_record.yml</code> playbook, you should see results similar to the following:</p> <pre data-language="none">$ ansible-playbook get_host_record.yml

PLAY [localhost] ***************************************************************************************

TASK [fetch host leaf01] ******************************************************************************
ok: [localhost]

TASK [check the leaf01 return variable] *************************************************************
ok: [localhost] =&gt; {
&lt; ...output shortened...&gt;
    "host": {
        "ipv4addrs": [
            {
                "configure_for_dhcp": false,
                "host": "leaf01.ansible.com",
            }
        ],
        "name": "leaf01.ansible.com",
        "view": "default"
    }
}

TASK [debug specific variable (ipv4 address)] ******************************************************
ok: [localhost] =&gt; {
    "host.ipv4addrs[0].ipv4addr": "192.168.1.11"
}

TASK [fetch host leaf02] ******************************************************************************
ok: [localhost]

TASK [check the leaf02 return variable] *************************************************************
ok: [localhost] =&gt; {
&lt; ...output shortened...&gt;
    "host": {
        "ipv4addrs": [
            {
                "configure_for_dhcp": false,
                "host": "leaf02.example.com",
                "ipv4addr": "192.168.1.12"
            }
        ],
    }
}

PLAY RECAP ******************************************************************************************
localhost                  : ok=5    changed=0    unreachable=0    failed=0
</pre> <p>The output above shows the host record for <code>leaf01.ansible.com</code> and <code>leaf02.ansible.com</code> that were retrieved by the <code>nios</code> lookup plugin. This playbook saves the information in variables which you can use in other playbooks. This allows you to use Infoblox as a single source of truth to gather and use information that changes dynamically. See <a class="reference internal" href="../user_guide/playbooks_variables.html#playbooks-variables"><span class="std std-ref">Using Variables</span></a> for more information on using Ansible variables. See the <a class="reference external" href="https://docs.ansible.com/ansible/2.9/plugins/lookup/nios.html#nios-lookup" title="(in Ansible v2.9)"><span class="xref std std-ref">nios</span></a> examples for more data options that you can retrieve.</p> <p>You can access these playbooks at <a class="reference external" href="https://github.com/network-automation/infoblox_ansible/tree/master/lookup_playbooks">Infoblox lookup playbooks</a>.</p>    <h2 id="use-cases-with-modules">Use cases with modules</h2> <p>You can use the <code>nios</code> modules in tasks to simplify common Infoblox workflows. Be sure to set up your <a class="reference internal" href="#nios-credentials"><span class="std std-ref">NIOS credentials</span></a> before following these examples.</p>  <h3 id="configuring-an-ipv4-network">Configuring an IPv4 network</h3> <p>To configure an IPv4 network, use the <a class="reference external" href="https://docs.ansible.com/ansible/2.9/modules/nios_network_module.html#nios-network-module" title="(in Ansible v2.9)"><span class="xref std std-ref">nios_network</span></a> module:</p> <pre data-language="yaml">---
- hosts: nios
  connection: local
  tasks:
    - name: Create a network on the default network view
      nios_network:
        network: 192.168.100.0/24
        comment: sets the IPv4 network
        options:
          - name: domain-name
            value: ansible.com
        state: present
        provider: "{{nios_provider}}"
</pre> <p>Notice the last parameter, <code>provider</code>, uses the variable <code>nios_provider</code> defined in the <code>group_vars/</code> directory.</p>   <h3 id="creating-a-host-record">Creating a host record</h3> <p>To create a host record named <code>leaf03.ansible.com</code> on the newly-created IPv4 network:</p> <pre data-language="yaml">---
- hosts: nios
  connection: local
  tasks:
    - name: configure an IPv4 host record
      nios_host_record:
        name: leaf03.ansible.com
        ipv4addrs:
          - ipv4addr:
              "{{ lookup('nios_next_ip', '192.168.100.0/24', provider=nios_provider)[0] }}"
        state: present
provider: "{{nios_provider}}"
</pre> <p>Notice the IPv4 address in this example uses the <a class="reference external" href="https://docs.ansible.com/ansible/2.9/plugins/lookup/nios_next_ip.html#nios-next-ip-lookup" title="(in Ansible v2.9)"><span class="xref std std-ref">nios_next_ip</span></a> lookup plugin to find the next available IPv4 address on the network.</p>   <h3 id="creating-a-forward-dns-zone">Creating a forward DNS zone</h3> <p>To configure a forward DNS zone use, the <code>nios_zone</code> module:</p> <pre data-language="yaml">---
- hosts: nios
  connection: local
  tasks:
    - name: Create a forward DNS zone called ansible-test.com
      nios_zone:
        name: ansible-test.com
        comment: local DNS zone
        state: present
        provider: "{{ nios_provider }}"
</pre>   <h3 id="creating-a-reverse-dns-zone">Creating a reverse DNS zone</h3> <p>To configure a reverse DNS zone:</p> <pre data-language="yaml">---
- hosts: nios
  connection: local
  tasks:
    - name: configure a reverse mapping zone on the system using IPV6 zone format
      nios_zone:
        name: 100::1/128
        zone_format: IPV6
        state: present
        provider: "{{ nios_provider }}"
</pre>    <h2 id="dynamic-inventory-script">Dynamic inventory script</h2> <p>You can use the Infoblox dynamic inventory script to import your network node inventory with Infoblox NIOS. To gather the inventory from Infoblox, you need two files:</p> <ul class="simple"> <li>
<a class="reference external" href="https://raw.githubusercontent.com/ansible-community/contrib-scripts/main/inventory/infoblox.yaml">infoblox.yaml</a> - A file that specifies the NIOS provider arguments and optional filters.</li> <li>
<a class="reference external" href="https://raw.githubusercontent.com/ansible-community/contrib-scripts/main/inventory/infoblox.py">infoblox.py</a> - The python script that retrieves the NIOS inventory.</li> </ul> <div class="admonition note"> <p class="admonition-title">Note</p> <p>Please note that the inventory script only works when Ansible 2.9, 2.10 or 3 have been installed. The inventory script will eventually be removed from <a class="reference external" href="https://galaxy.ansible.com/community/general">community.general</a>, and will not work if <code>community.general</code> is only installed with <code>ansible-galaxy collection install</code>. Please use the inventory plugin from <a class="reference external" href="https://galaxy.ansible.com/infoblox/nios_modules">infoblox.nios_modules</a> instead.</p> </div> <p>To use the Infoblox dynamic inventory script:</p> <ol class="arabic simple"> <li>Download the <code>infoblox.yaml</code> file and save it in the <code>/etc/ansible</code> directory.</li> <li>Modify the <code>infoblox.yaml</code> file with your NIOS credentials.</li> <li>Download the <code>infoblox.py</code> file and save it in the <code>/etc/ansible/hosts</code> directory.</li> <li>Change the permissions on the <code>infoblox.py</code> file to make the file an executable:</li> </ol> <pre data-language="bash">$ sudo chmod +x /etc/ansible/hosts/infoblox.py
</pre> <p>You can optionally use <code>./infoblox.py --list</code> to test the script. After a few minutes, you should see your Infoblox inventory in JSON format. You can explicitly use the Infoblox dynamic inventory script as follows:</p> <pre data-language="bash">$ ansible -i infoblox.py all -m ping
</pre> <p>You can also implicitly use the Infoblox dynamic inventory script by including it in your inventory directory (<code>etc/ansible/hosts</code> by default). See <a class="reference internal" href="../user_guide/intro_dynamic_inventory.html#dynamic-inventory"><span class="std std-ref">Working with dynamic inventory</span></a> for more details.</p> <div class="admonition seealso"> <p class="admonition-title">See also</p> <dl class="simple"> <dt><a class="reference external" href="https://www.infoblox.com//">Infoblox website</a></dt>
<dd>
<p>The Infoblox website</p> </dd> <dt><a class="reference external" href="https://www.infoblox.com/resources/deployment-guides/infoblox-and-ansible-integration">Infoblox and Ansible Deployment Guide</a></dt>
<dd>
<p>The deployment guide for Ansible integration provided by Infoblox.</p> </dd> <dt><a class="reference external" href="https://www.ansible.com/blog/infoblox-integration-in-ansible-2.5">Infoblox Integration in Ansible 2.5</a></dt>
<dd>
<p>Ansible blog post about Infoblox.</p> </dd> <dt><a class="reference external" href="https://docs.ansible.com/ansible/2.9/modules/list_of_net_tools_modules.html#nios-net-tools-modules" title="(in Ansible v2.9)"><span class="xref std std-ref">Ansible NIOS modules</span></a></dt>
<dd>
<p>The list of supported NIOS modules, with examples.</p> </dd> <dt><a class="reference external" href="https://github.com/network-automation/infoblox_ansible">Infoblox Ansible Examples</a></dt>
<dd>
<p>Infoblox example playbooks.</p> </dd> </dl> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2012&ndash;2018 Michael DeHaan<br>&copy; 2018&ndash;2021 Red Hat, Inc.<br>Licensed under the GNU General Public License version 3.<br>
    <a href="https://docs.ansible.com/ansible/latest/scenario_guides/guide_infoblox.html" class="_attribution-link">https://docs.ansible.com/ansible/latest/scenario_guides/guide_infoblox.html</a>
  </p>
</div>
