<h1 id="vmware-requirements">VMware Prerequisites</h1>  <ul id="vmware-prerequisites"> <li><a class="reference internal" href="#installing-vcenter-ssl-certificates-for-ansible" id="id2">Installing vCenter SSL certificates for Ansible</a></li> <li><a class="reference internal" href="#installing-esxi-ssl-certificates-for-ansible" id="id3">Installing ESXi SSL certificates for Ansible</a></li> <li><a class="reference internal" href="#using-custom-path-for-ssl-certificates" id="id4">Using custom path for SSL certificates</a></li> </ul>
   <h2 id="installing-ssl-certificates">Installing SSL Certificates</h2> <p>All vCenter and ESXi servers require SSL encryption on all connections to enforce secure communication. You must enable SSL encryption for Ansible by installing the server’s SSL certificates on your Ansible control node or delegate node.</p> <p>If the SSL certificate of your vCenter or ESXi server is not correctly installed on your Ansible control node, you will see the following warning when using Ansible VMware modules:</p> <p><code>Unable to connect to vCenter or ESXi API at xx.xx.xx.xx on TCP/443: [SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed (_ssl.c:777)</code></p> <p>To install the SSL certificate for your VMware server, and run your Ansible VMware modules in encrypted mode, please follow the instructions for the server you are running with VMware.</p>  <h3 id="installing-vcenter-ssl-certificates-for-ansible">Installing vCenter SSL certificates for Ansible</h3> <ul class="simple"> <li>From any web browser, go to the base URL of the vCenter Server without port number like <code>https://vcenter-domain.example.com</code>
</li> <li>Click the “Download trusted root CA certificates” link at the bottom of the grey box on the right and download the file.</li> <li>Change the extension of the file to .zip. The file is a ZIP file of all root certificates and all CRLs.</li> <li>Extract the contents of the zip file. The extracted directory contains a <code>.certs</code> directory that contains two types of files. Files with a number as the extension (.0, .1, and so on) are root certificates.</li> <li>Install the certificate files are trusted certificates by the process that is appropriate for your operating system.</li> </ul>   <h3 id="installing-esxi-ssl-certificates-for-ansible">Installing ESXi SSL certificates for Ansible</h3> <ul class="simple"> <li>Enable SSH Service on ESXi either by using Ansible VMware module <a class="reference external" href="https://github.com/ansible-collections/vmware/blob/main/plugins/modules/vmware_host_config_manager.py">vmware_host_service_manager</a> or manually using vSphere Web interface.</li> <li>SSH to ESXi server using administrative credentials, and navigate to directory <code>/etc/vmware/ssl</code>
</li> <li>Secure copy (SCP) <code>rui.crt</code> located in <code>/etc/vmware/ssl</code> directory to Ansible control node.</li> <li>Install the certificate file by the process that is appropriate for your operating system.</li> </ul>   <h3 id="using-custom-path-for-ssl-certificates">Using custom path for SSL certificates</h3> <p>If you need to use a custom path for SSL certificates, you can set the <code>REQUESTS_CA_BUNDLE</code> environment variable in your playbook.</p> <p>For example, if <code>/var/vmware/certs/vcenter1.crt</code> is the SSL certificate for your vCenter Server, you can use the <a class="reference internal" href="../../user_guide/playbooks_environment.html#playbooks-environment"><span class="std std-ref">environment</span></a> keyword to pass it to the modules:</p> <pre data-language="yaml">- name: Gather all tags from vCenter
  community.vmware.vmware_tag_info:
    validate_certs: True
    hostname: '{{ vcenter_hostname }}'
    username: '{{ vcenter_username }}'
    password: '{{ vcenter_password }}'
  environment:
    REQUESTS_CA_BUNDLE: /var/vmware/certs/vcenter1.crt
</pre> <p>There is a <a class="reference external" href="https://github.com/psf/requests/issues/3829">known issue</a> in <code>requests</code> library (version 2) which you may want to consider when using this environment variable. Basically, setting <code>REQUESTS_CA_BUNDLE</code> environment variable on managed nodes overrides the <code>validate_certs</code> value. This may result in unexpected behavior while running the playbook. Please see <a class="reference external" href="https://github.com/ansible-collections/community.vmware/issues/601">community.vmware issue 601</a> and <a class="reference external" href="https://github.com/vmware/vsphere-automation-sdk-python/issues/254">vmware issue 254</a> for more information.</p><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2012&ndash;2018 Michael DeHaan<br>&copy; 2018&ndash;2021 Red Hat, Inc.<br>Licensed under the GNU General Public License version 3.<br>
    <a href="https://docs.ansible.com/ansible/latest/scenario_guides/vmware_scenarios/vmware_requirements.html" class="_attribution-link">https://docs.ansible.com/ansible/latest/scenario_guides/vmware_scenarios/vmware_requirements.html</a>
  </p>
</div>
