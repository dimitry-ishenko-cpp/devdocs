<h1 id="amazon-aws-aws-secret-look-up-secrets-stored-in-aws-secrets-manager">amazon.aws.aws_secret – Look up secrets stored in AWS Secrets Manager.</h1> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This plugin is part of the <a class="reference external" href="https://galaxy.ansible.com/amazon/aws">amazon.aws collection</a> (version 1.5.1).</p> <p>You might already have this collection installed if you are using the <code>ansible</code> package. It is not included in <code>ansible-core</code>. To check whether it is installed, run <code>ansible-galaxy collection list</code>.</p> <p>To install it, use: <code>ansible-galaxy collection install amazon.aws</code>.</p> <p>To use it in a playbook, specify: <code>amazon.aws.aws_secret</code>.</p> </div>  <ul class="simple"> <li><a class="reference internal" href="#synopsis" id="id1">Synopsis</a></li> <li><a class="reference internal" href="#requirements" id="id2">Requirements</a></li> <li><a class="reference internal" href="#parameters" id="id3">Parameters</a></li> <li><a class="reference internal" href="#examples" id="id4">Examples</a></li> <li><a class="reference internal" href="#return-values" id="id5">Return Values</a></li> </ul>   <h2 id="synopsis">Synopsis</h2> <ul class="simple"> <li>Look up secrets stored in AWS Secrets Manager provided the caller has the appropriate permissions to read the secret.</li> <li>Lookup is based on the secret’s <em>Name</em> value.</li> <li>Optional parameters can be passed into this lookup; <em>version_id</em> and <em>version_stage</em>
</li> </ul>   <h2 id="requirements">Requirements</h2> <p>The below requirements are needed on the local controller node that executes this lookup.</p> <ul class="simple"> <li>boto3</li> <li>botocore&gt;=1.10.0</li> </ul>   <h2 id="parameters">Parameters</h2> <table class="documentation-table"> <tr> <th colspan="1">Parameter</th> <th>Choices/Defaults</th> <th>Configuration</th> <th width="100%">Comments</th> </tr> <tr> <td colspan="1">  <b>_terms</b>  <div> <span>string</span> / <span>required</span> </div> </td> <td> </td> <td> </td> <td> <div>Name of the secret to look up in AWS Secrets Manager.</div> </td> </tr> <tr> <td colspan="1">  <b>aws_access_key</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div> env:EC2_ACCESS_KEY </div> <div> env:AWS_ACCESS_KEY </div> <div> env:AWS_ACCESS_KEY_ID </div> </td> <td> <div>The AWS access key to use.</div> <div>
<br>aliases: aws_access_key_id</div> </td> </tr> <tr> <td colspan="1">  <b>aws_profile</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div> env:AWS_DEFAULT_PROFILE </div> <div> env:AWS_PROFILE </div> </td> <td> <div>The AWS profile</div> <div>
<br>aliases: boto_profile</div> </td> </tr> <tr> <td colspan="1">  <b>aws_secret_key</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div> env:EC2_SECRET_KEY </div> <div> env:AWS_SECRET_KEY </div> <div> env:AWS_SECRET_ACCESS_KEY </div> </td> <td> <div>The AWS secret key that corresponds to the access key.</div> <div>
<br>aliases: aws_secret_access_key</div> </td> </tr> <tr> <td colspan="1">  <b>aws_security_token</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div> env:EC2_SECURITY_TOKEN </div> <div> env:AWS_SESSION_TOKEN </div> <div> env:AWS_SECURITY_TOKEN </div> </td> <td> <div>The AWS security token if using temporary access and secret keys.</div> </td> </tr> <tr> <td colspan="1">  <b>bypath</b>  <div> <span>boolean</span> </div> <div> added in 1.4.0 of amazon.aws </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> </td> <td> <div>A boolean to indicate whether the parameter is provided as a hierarchy.</div> </td> </tr> <tr> <td colspan="1">  <b>join</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> </td> <td> <div>Join two or more entries to form an extended secret.</div> <div>This is useful for overcoming the 4096 character limit imposed by AWS.</div> <div>No effect when used with <em>bypath</em>.</div> </td> </tr> <tr> <td colspan="1">  <b>nested</b>  <div> <span>boolean</span> </div> <div> added in 1.4.0 of amazon.aws </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> </td> <td> <div>A boolean to indicate the secret contains nested values.</div> </td> </tr> <tr> <td colspan="1">  <b>on_denied</b>  <div> <span>string</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>error</b> ←</div></li> <li>skip</li> <li>warn</li> </ul> </td> <td> </td> <td> <div>Action to take if access to the secret is denied.</div> <div>
<code>error</code> will raise a fatal error when access to the secret is denied.</div> <div>
<code>skip</code> will silently ignore the denied secret.</div> <div>
<code>warn</code> will skip over the denied secret but issue a warning.</div> </td> </tr> <tr> <td colspan="1">  <b>on_missing</b>  <div> <span>string</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>error</b> ←</div></li> <li>skip</li> <li>warn</li> </ul> </td> <td> </td> <td> <div>Action to take if the secret is missing.</div> <div>
<code>error</code> will raise a fatal error when the secret is missing.</div> <div>
<code>skip</code> will silently ignore the missing secret.</div> <div>
<code>warn</code> will skip over the missing secret but issue a warning.</div> </td> </tr> <tr> <td colspan="1">  <b>region</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div> env:EC2_REGION </div> <div> env:AWS_REGION </div> </td> <td> <div>The region for which to create the connection.</div> </td> </tr> <tr> <td colspan="1">  <b>version_id</b>  <div> <span>string</span> </div> </td> <td> </td> <td> </td> <td> <div>Version of the secret(s).</div> </td> </tr> <tr> <td colspan="1">  <b>version_stage</b>  <div> <span>string</span> </div> </td> <td> </td> <td> </td> <td> <div>Stage of the secret version.</div> </td> </tr> </table> <br>  <h2 id="examples">Examples</h2> <pre data-language="yaml+jinja">- name: lookup secretsmanager secret in the current region
  debug: msg="{{ lookup('amazon.aws.aws_secret', '/path/to/secrets', bypath=true) }}"

- name: Create RDS instance with aws_secret lookup for password param
  rds:
    command: create
    instance_name: app-db
    db_engine: MySQL
    size: 10
    instance_type: db.m1.small
    username: dbadmin
    password: "{{ lookup('amazon.aws.aws_secret', 'DbSecret') }}"
    tags:
      Environment: staging

- name: skip if secret does not exist
  debug: msg="{{ lookup('amazon.aws.aws_secret', 'secret-not-exist', on_missing='skip')}}"

- name: warn if access to the secret is denied
  debug: msg="{{ lookup('amazon.aws.aws_secret', 'secret-denied', on_denied='warn')}}"

- name: lookup secretsmanager secret in the current region using the nested feature
  debug: msg="{{ lookup('amazon.aws.aws_secret', 'secrets.environments.production.password', nested=true) }}"
  # The secret can be queried using the following syntax: `aws_secret_object_name.key1.key2.key3`.
  # If an object is of the form `{"key1":{"key2":{"key3":1}}}` the query would return the value `1`.
</pre>   <h2 id="return-values">Return Values</h2> <p>Common return values are documented <a class="reference internal" href="../../../reference_appendices/common_return_values.html#common-return-values"><span class="std std-ref">here</span></a>, the following are the fields unique to this lookup:</p> <table class="documentation-table"> <tr> <th colspan="1">Key</th> <th>Returned</th> <th width="100%">Description</th> </tr> <tr> <td colspan="1">  <b>_raw</b>  <div> <span>string</span> </div> </td> <td>success</td> <td> <div>Returns the value of the secret stored in AWS Secrets Manager.</div> <br> </td> </tr> </table> <br><br> <h3 id="authors">Authors</h3> <ul class="simple"> <li>Aaron Smith &lt;<a class="reference external" href="https://docs.ansible.com/cdn-cgi/l/email-protection#c3a2a9b0aeaab7abf2f3f0fbf2e5e0f0f4f8e5e0f6f1f8e5e0f7fbf8a4aea2aaafe5e0f7f5f8a0acae">ajsmith10381<span>@</span>gmail<span>.</span>com</a>&gt;</li> </ul><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2012&ndash;2018 Michael DeHaan<br>&copy; 2018&ndash;2021 Red Hat, Inc.<br>Licensed under the GNU General Public License version 3.<br>
    <a href="https://docs.ansible.com/ansible/latest/collections/amazon/aws/aws_secret_lookup.html" class="_attribution-link">https://docs.ansible.com/ansible/latest/collections/amazon/aws/aws_secret_lookup.html</a>
  </p>
</div>
