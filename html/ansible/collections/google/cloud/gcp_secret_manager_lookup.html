<section id="google-cloud-gcp-secret-manager-lookup-get-secrets-from-google-cloud-as-a-lookup-plugin"> <h1>google.cloud.gcp_secret_manager lookup – Get Secrets from Google Cloud as a Lookup plugin</h1> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This lookup plugin is part of the <a class="reference external" href="https://galaxy.ansible.com/ui/repo/published/google/cloud/">google.cloud collection</a> (version 1.4.1).</p> <p>You might already have this collection installed if you are using the <code>ansible</code> package. It is not included in <code>ansible-core</code>. To check whether it is installed, run <code>ansible-galaxy collection list</code>.</p> <p>To install it, use: <code>ansible-galaxy collection install google.cloud</code>.</p> <p>To use it in a playbook, specify: <code>google.cloud.gcp_secret_manager</code>.</p> </div>  <ul class="simple"> <li><a class="reference internal" href="#synopsis" id="id1">Synopsis</a></li> <li><a class="reference internal" href="#keyword-parameters" id="id2">Keyword parameters</a></li> <li><a class="reference internal" href="#examples" id="id3">Examples</a></li> <li><a class="reference internal" href="#return-value" id="id4">Return Value</a></li> </ul>  <section id="synopsis"> <h2>Synopsis</h2> <ul class="simple"> <li>retrieve secret keys in Secret Manager for use in playbooks</li> <li>see <a class="reference external" href="https://cloud.google.com/iam/docs/service-account-creds">https://cloud.google.com/iam/docs/service-account-creds</a> for details on creating credentials for Google Cloud and the format of such credentials</li> <li>once a secret value is retreived, it is returned decoded. It is up to the developer to maintain secrecy of this value once returned.</li> </ul> </section> <section id="keyword-parameters"> <h2>Keyword parameters</h2> <p>This describes keyword parameters of the lookup. These are the values <code>key1=value1</code>, <code>key2=value2</code> and so on in the following examples: <code>lookup('google.cloud.gcp_secret_manager', key1=value1, key2=value2, ...)</code> and <code>query('google.cloud.gcp_secret_manager', key1=value1, key2=value2, ...)</code></p> <table class="longtable ansible-option-table docutils align-default" style="width: 100%"> <thead> <tr>
<th class="head"><p>Parameter</p></th> <th class="head"><p>Comments</p></th> </tr> </thead>  <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-google-cloud-gcp-secret-manager-lookup-parameter-access-token"><strong>access_token</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>support for GCP Access Token</p> <p>defaults to OS env variable GCP_ACCESS_TOKEN if not present</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-google-cloud-gcp-secret-manager-lookup-parameter-auth-kind"><strong>auth_kind</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>the type of authentication to use with Google Cloud (i.e. serviceaccount or machineaccount)</p> <p>defaults to OS env variable GCP_AUTH_KIND if not present</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell">    
<p class="ansible-option-title" id="ansible-collections-google-cloud-gcp-secret-manager-lookup-parameter-secret-id"><strong id="ansible-collections-google-cloud-gcp-secret-manager-lookup-parameter-key">key</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-aliases">aliases: name, secret, secret_id</span></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span> / <span class="ansible-option-required">required</span></p> </div></td> <td><div class="ansible-option-cell">
<p>the name of the secret to look up in Secret Manager</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-google-cloud-gcp-secret-manager-lookup-parameter-on-error"><strong>on_error</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>how to handle errors</p> <p>strict means raise an exception</p> <p>warn means warn, and return none</p> <p>ignore means just return none</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li>
<code><strong>"strict"</strong></code> <span class="ansible-option-choices-default-mark">← (default)</span>
</li> <li><code>"warn"</code></li> <li><code>"ignore"</code></li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-google-cloud-gcp-secret-manager-lookup-parameter-project"><strong>project</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The name of the google cloud project</p> <p>defaults to OS env variable GCP_PROJECT if not present</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-google-cloud-gcp-secret-manager-lookup-parameter-scopes"><strong>scopes</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">list</span> / <span class="ansible-option-elements">elements=string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Authenticaiton scopes for Google Secret Manager</p> <p class="ansible-option-line"><strong class="ansible-option-default-bold">Default:</strong> <code>["https://www.googleapis.com/auth/cloud-platform"]</code></p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-google-cloud-gcp-secret-manager-lookup-parameter-service-account-email"><strong>service_account_email</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>email associated with the service account</p> <p>defaults to OS env variable GCP_SERVICE_ACCOUNT_EMAIL if not present</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-google-cloud-gcp-secret-manager-lookup-parameter-service-account-file"><strong>service_account_file</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>JSON Credential file obtained from Google Cloud</p> <p>defaults to OS env variable GCP_SERVICE_ACCOUNT_FILE if not present</p> <p>see <a class="reference external" href="https://cloud.google.com/iam/docs/service-account-creds">https://cloud.google.com/iam/docs/service-account-creds</a> for details</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-google-cloud-gcp-secret-manager-lookup-parameter-service-account-info"><strong>service_account_info</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">jsonarg</span></p> </div></td> <td><div class="ansible-option-cell">
<p>JSON Object representing the contents of a service_account_file obtained from Google Cloud</p> <p>defaults to OS env variable GCP_SERVICE_ACCOUNT_INFO if not present</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-google-cloud-gcp-secret-manager-lookup-parameter-version"><strong>version</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>the version name of your secret to retrieve</p> <p class="ansible-option-line"><strong class="ansible-option-default-bold">Default:</strong> <code>"latest"</code></p> </div></td> </tr>  </table> </section> <section id="examples"> <h2>Examples</h2> <pre data-language="yaml+jinja">- name: Test secret using env variables for credentials
  ansible.builtin.debug:
    msg: "{{ lookup('google.cloud.gcp_secret_manager', key='secret_key') }}"

- name: Test secret using explicit credentials
  ansible.builtin.debug:
    msg: "{{ lookup('google.cloud.gcp_secret_manager', key='secret_key', project='project', auth_kind='serviceaccount', service_account_file='file.json') }}"

- name: Test getting specific version of a secret (old version)
  ansible.builtin.debug:
    msg: "{{ lookup('google.cloud.gcp_secret_manager', key='secret_key', version='1') }}"

- name: Test getting specific version of a secret (new version)
  ansible.builtin.debug:
    msg: "{{ lookup('google.cloud.gcp_secret_manager', key='secret_key', version='2') }}"
</pre> </section> <section id="return-value"> <h2>Return Value</h2> <table class="longtable ansible-option-table docutils align-default" style="width: 100%"> <thead> <tr>
<th class="head"><p>Key</p></th> <th class="head"><p>Description</p></th> </tr> </thead>  <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-google-cloud-gcp-secret-manager-lookup-return-raw"><strong>Return value</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">list</span> / <span class="ansible-option-elements">elements=string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>the contents of the secret requested (please use “no_log” to not expose this secret)</p> <p class="ansible-option-line"><strong class="ansible-option-returned-bold">Returned:</strong> success</p> </div></td> </tr>  </table> <section id="authors"> <h3>Authors</h3> <ul class="simple"> <li>Dave Costakos</li> </ul> <div class="admonition hint"> <p class="admonition-title">Hint</p> <p>Configuration entries for each entry type have a low to high priority order. For example, a variable that is lower in the list will override a variable that is higher up.</p> </div> </section> <section id="collection-links"> <h3>Collection links</h3> <ul class="ansible-links"> <li><span><a aria-role="button" class="ansible-link reference external" href="https://github.com/ansible-collections/google.cloud/issues" rel="noopener external" target="_blank">Issue Tracker</a></span></li> <li><span><a aria-role="button" class="ansible-link reference external" href="http://cloud.google.com" rel="noopener external" target="_blank">Homepage</a></span></li> <li><span><a aria-role="button" class="ansible-link reference external" href="https://github.com/ansible-collections/google.cloud" rel="noopener external" target="_blank">Repository (Sources)</a></span></li> </ul> </section> </section> </section><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2012&ndash;2018 Michael DeHaan<br>&copy; 2018&ndash;2024 Red Hat, Inc.<br>Licensed under the GNU General Public License version 3.<br>
    <a href="https://docs.ansible.com/ansible/latest/collections/google/cloud/gcp_secret_manager_lookup.html" class="_attribution-link">https://docs.ansible.com/ansible/latest/collections/google/cloud/gcp_secret_manager_lookup.html</a>
  </p>
</div>
