<h1 id="google-cloud-gcp-compute-google-cloud-compute-engine-inventory-source">google.cloud.gcp_compute – Google Cloud Compute Engine inventory source</h1> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This plugin is part of the <a class="reference external" href="https://galaxy.ansible.com/google/cloud">google.cloud collection</a> (version 1.0.2).</p> <p>You might already have this collection installed if you are using the <code>ansible</code> package. It is not included in <code>ansible-core</code>. To check whether it is installed, run <code>ansible-galaxy collection list</code>.</p> <p>To install it, use: <code>ansible-galaxy collection install google.cloud</code>.</p> <p>To use it in a playbook, specify: <code>google.cloud.gcp_compute</code>.</p> </div>  <ul class="simple"> <li><a class="reference internal" href="#synopsis" id="id1">Synopsis</a></li> <li><a class="reference internal" href="#requirements" id="id2">Requirements</a></li> <li><a class="reference internal" href="#parameters" id="id3">Parameters</a></li> <li><a class="reference internal" href="#examples" id="id4">Examples</a></li> </ul>   <h2 id="synopsis">Synopsis</h2> <ul class="simple"> <li>Get inventory hosts from Google Cloud Platform GCE.</li> <li>Uses a YAML configuration file that ends with gcp_compute.(yml|yaml) or gcp.(yml|yaml).</li> </ul>   <h2 id="requirements">Requirements</h2> <p>The below requirements are needed on the local controller node that executes this inventory.</p> <ul class="simple"> <li>requests &gt;= 2.18.4</li> <li>google-auth &gt;= 1.3.0</li> </ul>   <h2 id="parameters">Parameters</h2> <table class="documentation-table"> <tr> <th colspan="1">Parameter</th> <th>Choices/Defaults</th> <th>Configuration</th> <th width="100%">Comments</th> </tr> <tr> <td colspan="1">  <b>auth_kind</b>  <div> <span>string</span> / <span>required</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>application</li> <li>serviceaccount</li> <li>machineaccount</li> </ul> </td> <td> <div> env:GCP_AUTH_KIND <div> added in 2.8.2 of google.cloud </div> </div> </td> <td> <div>The type of credential used.</div> </td> </tr> <tr> <td colspan="1">  <b>cache</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div> ini entries: <p> [inventory]<br>cache = no </p> </div> <div> env:ANSIBLE_INVENTORY_CACHE </div> </td> <td> <div>Toggle to enable/disable the caching of the inventory's source data, requires a cache plugin setup to work.</div> </td> </tr> <tr> <td colspan="1">  <b>cache_connection</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div> ini entries: <p> [defaults]<br>fact_caching_connection = None </p> <p> [inventory]<br>cache_connection = None </p> </div> <div> env:ANSIBLE_CACHE_PLUGIN_CONNECTION </div> <div> env:ANSIBLE_INVENTORY_CACHE_CONNECTION </div> </td> <td> <div>Cache connection data or path, read cache plugin documentation for specifics.</div> </td> </tr> <tr> <td colspan="1">  <b>cache_plugin</b>  <div> <span>string</span> </div> </td> <td> <b>Default:</b><br><div>"memory"</div> </td> <td> <div> ini entries: <p> [defaults]<br>fact_caching = memory </p> <p> [inventory]<br>cache_plugin = memory </p> </div> <div> env:ANSIBLE_CACHE_PLUGIN </div> <div> env:ANSIBLE_INVENTORY_CACHE_PLUGIN </div> </td> <td> <div>Cache plugin to use for the inventory's source data.</div> </td> </tr> <tr> <td colspan="1">  <b>cache_prefix</b>  <div> <span>string</span> </div> </td> <td> <b>Default:</b><br><div>"ansible_inventory_"</div> </td> <td> <div> ini entries: <p> [default]<br>fact_caching_prefix = ansible_inventory_ </p> <p> [inventory]<br>cache_prefix = ansible_inventory_ </p> </div> <div> env:ANSIBLE_CACHE_PLUGIN_PREFIX </div> <div> env:ANSIBLE_INVENTORY_CACHE_PLUGIN_PREFIX </div> </td> <td> <div>Prefix to use for cache plugin files/tables</div> </td> </tr> <tr> <td colspan="1">  <b>cache_timeout</b>  <div> <span>integer</span> </div> </td> <td> <b>Default:</b><br><div>3600</div> </td> <td> <div> ini entries: <p> [defaults]<br>fact_caching_timeout = 3600 </p> <p> [inventory]<br>cache_timeout = 3600 </p> </div> <div> env:ANSIBLE_CACHE_PLUGIN_TIMEOUT </div> <div> env:ANSIBLE_INVENTORY_CACHE_TIMEOUT </div> </td> <td> <div>Cache duration in seconds</div> </td> </tr> <tr> <td colspan="1">  <b>compose</b>  <div> <span>dictionary</span> </div> </td> <td> <b>Default:</b><br><div>{}</div> </td> <td> </td> <td> <div>Create vars from jinja2 expressions.</div> </td> </tr> <tr> <td colspan="1">  <b>filters</b>  <div> <span>list</span> / <span>elements=string</span> </div> </td> <td> </td> <td> </td> <td> <div>A list of filter value pairs. Available filters are listed here <a href="https://cloud.google.com/compute/docs/reference/rest/v1/instances/aggregatedList">https://cloud.google.com/compute/docs/reference/rest/v1/instances/aggregatedList</a>. Each additional filter in the list will act be added as an AND condition (filter1 and filter2)</div> </td> </tr> <tr> <td colspan="1">  <b>folders</b>  <div> <span>list</span> / <span>elements=string</span> </div> </td> <td> </td> <td> </td> <td> <div>A folder that contains many projects</div> </td> </tr> <tr> <td colspan="1">  <b>groups</b>  <div> <span>dictionary</span> </div> </td> <td> <b>Default:</b><br><div>{}</div> </td> <td> </td> <td> <div>Add hosts to group based on Jinja2 conditionals.</div> </td> </tr> <tr> <td colspan="1">  <b>hostnames</b>  <div> <span>list</span> / <span>elements=string</span> </div> </td> <td> <b>Default:</b><br><div>["public_ip", "private_ip", "name"]</div> </td> <td> </td> <td> <div>A list of options that describe the ordering for which hostnames should be assigned. Currently supported hostnames are 'public_ip', 'private_ip', or 'name'.</div> </td> </tr> <tr> <td colspan="1">  <b>keyed_groups</b>  <div> <span>list</span> / <span>elements=string</span> </div> </td> <td> <b>Default:</b><br><div>[]</div> </td> <td> </td> <td> <div>Add hosts to group based on the values of a variable.</div> </td> </tr> <tr> <td colspan="1">  <b>leading_separator</b>  <div> <span>boolean</span> </div> <div> added in 2.11 of ansible.builtin </div> </td> <td> <ul>
<b>Choices:</b> <li>no</li> <li><div>
<b>yes</b> ←</div></li> </ul> </td> <td> </td> <td> <div>Use in conjunction with keyed_groups.</div> <div>By default, a keyed group that does not have a prefix or a separator provided will have a name that starts with an underscore.</div> <div>This is because the default prefix is "" and the default separator is "_".</div> <div>Set this option to False to omit the leading underscore (or other separator) if no prefix is given.</div> <div>If the group name is derived from a mapping the separator is still used to concatenate the items.</div> <div>To not use a separator in the group name at all, set the separator for the keyed group to an empty string instead.</div> </td> </tr> <tr> <td colspan="1">  <b>plugin</b>  <div> <span>string</span> / <span>required</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>gcp_compute</li> </ul> </td> <td> </td> <td> <div>token that ensures this is a source file for the 'gcp_compute' plugin.</div> </td> </tr> <tr> <td colspan="1">  <b>projects</b>  <div> <span>list</span> / <span>elements=string</span> </div> </td> <td> </td> <td> </td> <td> <div>A list of projects in which to describe GCE instances.</div> </td> </tr> <tr> <td colspan="1">  <b>retrieve_image_info</b>  <div> <span>boolean</span> </div> <div> added in 2.8 of google.cloud </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> </td> <td> <div>Populate the <code>image</code> host fact for the instances returned with the GCP image name</div> <div>By default this plugin does not attempt to resolve the boot image of an instance to the image name cataloged in GCP because of the performance overhead of the task.</div> <div>Unless this option is enabled, the <code>image</code> host variable will be <code>null</code>
</div> </td> </tr> <tr> <td colspan="1">  <b>scopes</b>  <div> <span>list</span> / <span>elements=string</span> </div> </td> <td> <b>Default:</b><br><div>["https://www.googleapis.com/auth/compute"]</div> </td> <td> <div> env:GCP_SCOPES <div> added in 2.8.2 of google.cloud </div> </div> </td> <td> <div>list of authentication scopes</div> </td> </tr> <tr> <td colspan="1">  <b>service_account_contents</b>  <div> <span>string</span> </div> <div> added in 2.8.2 of google.cloud </div> </td> <td> </td> <td> <div> env:GCP_SERVICE_ACCOUNT_CONTENTS </div> </td> <td> <div>A string representing the contents of a Service Account JSON file. This should not be passed in as a dictionary, but a string that has the exact contents of a service account json file (valid JSON).</div> </td> </tr> <tr> <td colspan="1">  <b>service_account_email</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div> env:GCP_SERVICE_ACCOUNT_EMAIL <div> added in 2.8.2 of google.cloud </div> </div> </td> <td> <div>An optional service account email address if machineaccount is selected and the user does not wish to use the default email.</div> </td> </tr> <tr> <td colspan="1">  <b>service_account_file</b>  <div> <span>path</span> </div> </td> <td> </td> <td> <div> env:GCP_SERVICE_ACCOUNT_FILE <div> added in 2.8.2 of google.cloud </div> </div> <div> env:GCE_CREDENTIALS_FILE_PATH <div> added in 2.8 of google.cloud </div> </div> </td> <td> <div>The path of a Service Account JSON file if serviceaccount is selected as type.</div> </td> </tr> <tr> <td colspan="1">  <b>strict</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> </td> <td> <div>If <code>yes</code> make invalid entries a fatal error, otherwise skip and continue.</div> <div>Since it is possible to use facts in the expressions they might not always be available and we ignore those errors by default.</div> </td> </tr> <tr> <td colspan="1">  <b>use_contrib_script_compatible_sanitization</b>  <div> <span>boolean</span> </div> <div> added in 2.8 of google.cloud </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> </td> <td> <div>By default this plugin is using a general group name sanitization to create safe and usable group names for use in Ansible. This option allows you to override that, in efforts to allow migration from the old inventory script.</div> <div>For this to work you should also turn off the TRANSFORM_INVALID_GROUP_CHARS setting, otherwise the core engine will just use the standard sanitization on top.</div> <div>This is not the default as such names break certain functionality as not all characters are valid Python identifiers which group names end up being used as.</div> </td> </tr> <tr> <td colspan="1">  <b>use_extra_vars</b>  <div> <span>boolean</span> </div> <div> added in 2.11 of ansible.builtin </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div> ini entries: <p> [inventory_plugins]<br>use_extra_vars = no </p> </div> <div> env:ANSIBLE_INVENTORY_USE_EXTRA_VARS </div> </td> <td> <div>Merge extra vars into the available variables for composition (highest precedence).</div> </td> </tr> <tr> <td colspan="1">  <b>vars_prefix</b>  <div> <span>string</span> </div> </td> <td> <b>Default:</b><br><div>""</div> </td> <td> </td> <td> <div>prefix to apply to host variables, does not include facts nor params</div> </td> </tr> <tr> <td colspan="1">  <b>zones</b>  <div> <span>list</span> / <span>elements=string</span> </div> </td> <td> </td> <td> </td> <td> <div>A list of regions in which to describe GCE instances. If none provided, it defaults to all zones available to a given project.</div> </td> </tr> </table> <br>  <h2 id="examples">Examples</h2> <pre data-language="yaml+jinja">plugin: google.cloud.gcp_compute
zones: # populate inventory with instances in these regions
  - us-east1-a
projects:
  - gcp-prod-gke-100
  - gcp-cicd-101
filters:
  - machineType = n1-standard-1
  - scheduling.automaticRestart = true AND machineType = n1-standard-1
service_account_file: /tmp/service_account.json
auth_kind: serviceaccount
scopes:
 - 'https://www.googleapis.com/auth/cloud-platform'
 - 'https://www.googleapis.com/auth/compute.readonly'
keyed_groups:
  # Create groups from GCE labels
  - prefix: gcp
    key: labels
hostnames:
  # List host by name instead of the default public ip
  - name
compose:
  # Set an inventory parameter to use the Public IP address to connect to the host
  # For Private ip use "networkInterfaces[0].networkIP"
  ansible_host: networkInterfaces[0].accessConfigs[0].natIP
</pre><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2012&ndash;2018 Michael DeHaan<br>&copy; 2018&ndash;2021 Red Hat, Inc.<br>Licensed under the GNU General Public License version 3.<br>
    <a href="https://docs.ansible.com/ansible/latest/collections/google/cloud/gcp_compute_inventory.html" class="_attribution-link">https://docs.ansible.com/ansible/latest/collections/google/cloud/gcp_compute_inventory.html</a>
  </p>
</div>
