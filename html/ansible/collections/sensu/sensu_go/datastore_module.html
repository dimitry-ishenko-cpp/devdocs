<section id="sensu-sensu-go-datastore-module-manage-sensu-external-datastore-providers"> <h1>sensu.sensu_go.datastore module – Manage Sensu external datastore providers</h1> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This module is part of the <a class="reference external" href="https://galaxy.ansible.com/ui/repo/published/sensu/sensu_go/">sensu.sensu_go collection</a> (version 1.14.0).</p> <p>You might already have this collection installed if you are using the <code>ansible</code> package. It is not included in <code>ansible-core</code>. To check whether it is installed, run <code>ansible-galaxy collection list</code>.</p> <p>To install it, use: <code>ansible-galaxy collection install sensu.sensu_go</code>. You need further requirements to be able to use this module, see <a class="reference internal" href="#ansible-collections-sensu-sensu-go-datastore-module-requirements"><span class="std std-ref">Requirements</span></a> for details.</p> <p>To use it in a playbook, specify: <code>sensu.sensu_go.datastore</code>.</p> </div> <p class="ansible-version-added">New in sensu.sensu_go 1.1.0</p>  <ul class="simple"> <li><a class="reference internal" href="#synopsis" id="id1">Synopsis</a></li> <li><a class="reference internal" href="#requirements" id="id2">Requirements</a></li> <li><a class="reference internal" href="#parameters" id="id3">Parameters</a></li> <li><a class="reference internal" href="#notes" id="id4">Notes</a></li> <li><a class="reference internal" href="#see-also" id="id5">See Also</a></li> <li><a class="reference internal" href="#examples" id="id6">Examples</a></li> <li><a class="reference internal" href="#return-values" id="id7">Return Values</a></li> </ul>  <section id="synopsis"> <h2>Synopsis</h2> <ul class="simple"> <li>Add or remove external datastore provider.</li> <li>For more information, refer to the Sensu documentation at <a class="reference external" href="https://docs.sensu.io/sensu-go/latest/reference/datastore/">https://docs.sensu.io/sensu-go/latest/reference/datastore/</a>.</li> </ul> </section> <section id="requirements"> <h2 id="ansible-collections-sensu-sensu-go-datastore-module-requirements">Requirements</h2> <p>The below requirements are needed on the host that executes this module.</p> <ul class="simple"> <li>python &gt;= 2.7</li> </ul> </section> <section id="parameters"> <h2>Parameters</h2> <table class="longtable ansible-option-table docutils align-default" style="width: 100%"> <thead> <tr>
<th class="head"><p>Parameter</p></th> <th class="head"><p>Comments</p></th> </tr> </thead>  <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-sensu-sensu-go-datastore-module-parameter-auth"><strong>auth</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">dictionary</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Authentication parameters. Can define each of them with ENV as well.</p> </div></td> </tr> <tr>
<td>

<div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-sensu-sensu-go-datastore-module-parameter-auth-api-key"><strong>api_key</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> <p><em class="ansible-option-versionadded">added in sensu.sensu_go 1.3.0</em></p> </div>
</td> <td>

<div class="ansible-option-cell">
<p>The API key that should be used when authenticating. If this is not set, the value of the SENSU_API_KEY environment variable will be checked.</p> <p>This replaces <em>auth.user</em> and <em>auth.password</em> parameters.</p> <p>For more information about the API key, refer to the official Sensu documentation at <a class="reference external" href="https://docs.sensu.io/sensu-go/latest/guides/use-apikey-feature/">https://docs.sensu.io/sensu-go/latest/guides/use-apikey-feature/</a>.</p> </div>
</td> </tr> <tr>
<td>

<div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-sensu-sensu-go-datastore-module-parameter-auth-ca-path"><strong>ca_path</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">path</span></p> <p><em class="ansible-option-versionadded">added in sensu.sensu_go 1.5.0</em></p> </div>
</td> <td>

<div class="ansible-option-cell">
<p>Path to the CA bundle that should be used to validate the backend certificate.</p> <p>If this parameter is not set, module will use the CA bundle that python is using.</p> <p>It is also possible to set this parameter via the <em>SENSU_CA_PATH</em> environment variable.</p> </div>
</td> </tr> <tr>
<td>

<div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-sensu-sensu-go-datastore-module-parameter-auth-password"><strong>password</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div>
</td> <td>

<div class="ansible-option-cell">
<p>The Sensu user’s password. If this is not set the value of the SENSU_PASSWORD environment variable will be checked.</p> <p>This parameter is ignored if the <em>auth.api_key</em> parameter is set.</p> <p class="ansible-option-line"><strong class="ansible-option-default-bold">Default:</strong> <code>"P@ssw0rd!"</code></p> </div>
</td> </tr> <tr>
<td>

<div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-sensu-sensu-go-datastore-module-parameter-auth-url"><strong>url</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div>
</td> <td>

<div class="ansible-option-cell">
<p>Location of the Sensu backend API. If this is not set the value of the SENSU_URL environment variable will be checked.</p> <p class="ansible-option-line"><strong class="ansible-option-default-bold">Default:</strong> <code>"http://localhost:8080"</code></p> </div>
</td> </tr> <tr>
<td>

<div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-sensu-sensu-go-datastore-module-parameter-auth-user"><strong>user</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div>
</td> <td>

<div class="ansible-option-cell">
<p>The username to use for connecting to the Sensu API. If this is not set the value of the SENSU_USER environment variable will be checked.</p> <p>This parameter is ignored if the <em>auth.api_key</em> parameter is set.</p> <p class="ansible-option-line"><strong class="ansible-option-default-bold">Default:</strong> <code>"admin"</code></p> </div>
</td> </tr> <tr>
<td>

<div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-sensu-sensu-go-datastore-module-parameter-auth-verify"><strong>verify</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">boolean</span></p> <p><em class="ansible-option-versionadded">added in sensu.sensu_go 1.5.0</em></p> </div>
</td> <td>

<div class="ansible-option-cell">
<p>Flag that controls the certificate validation.</p> <p>If you are using self-signed certificates, you can set this parameter to <code>false</code>.</p> <p>ONLY USE THIS PARAMETER IN DEVELOPMENT SCENARIOS! In you use self-signed certificates in production, see the <em>auth.ca_path</em> parameter.</p> <p>It is also possible to set this parameter via the <em>SENSU_VERIFY</em> environment variable.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li><code>false</code></li> <li>
<code><strong>true</strong></code> <span class="ansible-option-choices-default-mark">← (default)</span>
</li> </ul> </div>
</td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-sensu-sensu-go-datastore-module-parameter-batch-buffer"><strong>batch_buffer</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">integer</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Maximum number of requests to buffer in memory.</p> <p class="ansible-option-line"><strong class="ansible-option-default-bold">Default:</strong> <code>0</code></p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-sensu-sensu-go-datastore-module-parameter-batch-size"><strong>batch_size</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">integer</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Number of requests in each PostgreSQL write transaction, as specified in the PostgreSQL configuration.</p> <p class="ansible-option-line"><strong class="ansible-option-default-bold">Default:</strong> <code>1</code></p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-sensu-sensu-go-datastore-module-parameter-batch-workers"><strong>batch_workers</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">integer</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Number of Goroutines sending data to PostgreSQL, as specified in the PostgreSQL configuration.</p> <p>Set to current PostgreSQL pool size as default.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-sensu-sensu-go-datastore-module-parameter-dsn"><strong>dsn</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Attribute that specifies the data source names as a URL or PostgreSQL connection string. See the PostgreSQL docs for more information about connection strings.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-sensu-sensu-go-datastore-module-parameter-enable-round-robin"><strong>enable_round_robin</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">boolean</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Enables round robin scheduling on PostgreSQL.</p> <p>Any existing round robin scheduling will stop and migrate to PostgreSQL as entities check in with keepalives.</p> <p>Sensu will gradually delete the existing etcd scheduler state as keepalives on the etcd scheduler keys expire over time.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li>
<code><strong>false</strong></code> <span class="ansible-option-choices-default-mark">← (default)</span>
</li> <li><code>true</code></li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-sensu-sensu-go-datastore-module-parameter-max-conn-lifetime"><strong>max_conn_lifetime</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Maximum time a connection can persist before being destroyed.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-sensu-sensu-go-datastore-module-parameter-max-idle-conns"><strong>max_idle_conns</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">integer</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Maximum number of number of idle connections to retain.</p> <p class="ansible-option-line"><strong class="ansible-option-default-bold">Default:</strong> <code>2</code></p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-sensu-sensu-go-datastore-module-parameter-name"><strong>name</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span> / <span class="ansible-option-required">required</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The Sensu resource’s name. This name (in combination with the namespace where applicable) uniquely identifies the resource that Ansible operates on.</p> <p>If the resource with selected name already exists, Ansible module will update it to match the specification in the task.</p> <p>Consult the <em>name</em> metadata attribute specification in the upstream docs on <a class="reference external" href="https://docs.sensu.io/sensu-go/latest/reference/">https://docs.sensu.io/sensu-go/latest/reference/</a> for more details about valid names and other restrictions.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-sensu-sensu-go-datastore-module-parameter-pool-size"><strong>pool_size</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">integer</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The maximum number of connections to hold in the PostgreSQL connection pool.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-sensu-sensu-go-datastore-module-parameter-state"><strong>state</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Target state of the Sensu object.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li>
<code><strong>"present"</strong></code> <span class="ansible-option-choices-default-mark">← (default)</span>
</li> <li><code>"absent"</code></li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-sensu-sensu-go-datastore-module-parameter-strict"><strong>strict</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">boolean</span></p> </div></td> <td><div class="ansible-option-cell">
<p>When the PostgresConfig resource is created, configuration validation will include connecting to the PostgreSQL database and executing a query to confirm whether the connected user has permission to create database tables.</p> <p>Sensu-backend will try to connect to PostgreSQL indefinitely at 5-second intervals instead of reverting to etcd after 3 attempts.</p> <p>We recommend setting strict to true in most cases. If the connection fails or the user does not have permission to create database tables, resource configuration will fail and the configuration will not be persisted. This extended configuration is useful for debugging when you are not sure whether the configuration is correct or the database is working properly.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li>
<code><strong>false</strong></code> <span class="ansible-option-choices-default-mark">← (default)</span>
</li> <li><code>true</code></li> </ul> </div></td> </tr>  </table> </section> <section id="notes"> <h2>Notes</h2> <div class="admonition note"> <p class="admonition-title">Note</p> <ul class="simple"> <li>Currently, only one external datastore can be active at a time. The module will fail to perform its operation if this would break that invariant.</li> </ul> </div> </section> <section id="see-also"> <h2>See Also</h2> <div class="admonition seealso"> <p class="admonition-title">See also</p> <dl class="simple"> <dt><a class="reference internal" href="datastore_info_module.html#ansible-collections-sensu-sensu-go-datastore-info-module"><span class="std std-ref">sensu.sensu_go.datastore_info</span></a></dt>
<dd>
<p>List external Sensu datastore providers.</p> </dd> </dl> </div> </section> <section id="examples"> <h2>Examples</h2> <pre data-language="yaml+jinja">- name: Add external datastore
  sensu.sensu_go.datastore:
    name: my-postgres
    dsn: postgresql://user:secret@host:port/dbname

- name: Remove external datastore
  sensu.sensu_go.datastore:
    name: my-postgres
    state: absent

- name: Add external datastore with pool_size and max_conn_lifetime specified
  sensu.sensu_go.datastore:
    name: my-postgres
    dsn: postgresql://user:secret@host:port/dbname
    pool_size: 1
    max_conn_lifetime: "5m30s"
</pre> </section> <section id="return-values"> <h2>Return Values</h2> <p>Common return values are documented <a class="reference internal" href="../../../reference_appendices/common_return_values.html#common-return-values"><span class="std std-ref">here</span></a>, the following are the fields unique to this module:</p> <table class="longtable ansible-option-table docutils align-default" style="width: 100%"> <thead> <tr>
<th class="head"><p>Key</p></th> <th class="head"><p>Description</p></th> </tr> </thead>  <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-sensu-sensu-go-datastore-module-return-object"><strong>object</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">dictionary</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Object representing external datastore provider.</p> <p class="ansible-option-line"><strong class="ansible-option-returned-bold">Returned:</strong> success</p> <p class="ansible-option-line ansible-option-sample"><strong class="ansible-option-sample-bold">Sample:</strong> <code>{"batch_buffer": 0, "batch_size": 1, "batch_workers": 0, "dsn": "postgresql://user:secret@host:port/dbname", "enable_round_robin": true, "max_conn_lifetime": "5m", "max_idle_conns": 2, "metadata": {"name": "my-postgres"}, "pool_size": 20, "strict": true}</code></p> </div></td> </tr>  </table> <section id="authors"> <h3>Authors</h3> <ul class="simple"> <li>Manca Bizjak (@mancabizjak)</li> <li>Tadej Borovsak (@tadeboro)</li> </ul> </section> <section id="collection-links"> <h3>Collection links</h3> <ul class="ansible-links"> <li><span><a aria-role="button" class="ansible-link reference external" href="https://github.com/sensu/sensu-go-ansible/issues" rel="noopener external" target="_blank">Issue Tracker</a></span></li> <li><span><a aria-role="button" class="ansible-link reference external" href="https://github.com/sensu/sensu-go-ansible" rel="noopener external" target="_blank">Repository (Sources)</a></span></li> </ul> </section> </section> </section><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2012&ndash;2018 Michael DeHaan<br>&copy; 2018&ndash;2024 Red Hat, Inc.<br>Licensed under the GNU General Public License version 3.<br>
    <a href="https://docs.ansible.com/ansible/latest/collections/sensu/sensu_go/datastore_module.html" class="_attribution-link">https://docs.ansible.com/ansible/latest/collections/sensu/sensu_go/datastore_module.html</a>
  </p>
</div>
