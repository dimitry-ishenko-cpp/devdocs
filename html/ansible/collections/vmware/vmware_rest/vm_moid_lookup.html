<section id="vmware-vmware-rest-vm-moid-lookup-look-up-moid-for-vsphere-vm-objects-using-vcenter-rest-api"> <h1>vmware.vmware_rest.vm_moid lookup – Look up MoID for vSphere vm objects using vCenter REST API</h1> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This lookup plugin is part of the <a class="reference external" href="https://galaxy.ansible.com/ui/repo/published/vmware/vmware_rest/">vmware.vmware_rest collection</a> (version 3.2.0).</p> <p>You might already have this collection installed if you are using the <code>ansible</code> package. It is not included in <code>ansible-core</code>. To check whether it is installed, run <code>ansible-galaxy collection list</code>.</p> <p>To install it, use: <code>ansible-galaxy collection install vmware.vmware_rest</code>. You need further requirements to be able to use this lookup plugin, see <a class="reference internal" href="#ansible-collections-vmware-vmware-rest-vm-moid-lookup-requirements"><span class="std std-ref">Requirements</span></a> for details.</p> <p>To use it in a playbook, specify: <code>vmware.vmware_rest.vm_moid</code>.</p> </div> <p class="ansible-version-added">New in vmware.vmware_rest 2.1.0</p>  <ul class="simple"> <li><a class="reference internal" href="#synopsis" id="id1">Synopsis</a></li> <li><a class="reference internal" href="#requirements" id="id2">Requirements</a></li> <li><a class="reference internal" href="#terms" id="id3">Terms</a></li> <li><a class="reference internal" href="#keyword-parameters" id="id4">Keyword parameters</a></li> <li><a class="reference internal" href="#notes" id="id5">Notes</a></li> <li><a class="reference internal" href="#examples" id="id6">Examples</a></li> <li><a class="reference internal" href="#return-value" id="id7">Return Value</a></li> </ul>  <section id="synopsis"> <h2>Synopsis</h2> <ul class="simple"> <li>Returns Managed Object Reference (MoID) of the vSphere vm object contained in the specified path.</li> </ul> </section> <section id="requirements"> <h2 id="ansible-collections-vmware-vmware-rest-vm-moid-lookup-requirements">Requirements</h2> <p>The below requirements are needed on the local controller node that executes this lookup.</p> <ul class="simple"> <li>vSphere 7.0.3 or greater</li> <li>python &gt;= 3.6</li> <li>aiohttp</li> </ul> </section> <section id="terms"> <h2>Terms</h2> <table class="longtable ansible-option-table docutils align-default" style="width: 100%"> <thead> <tr>
<th class="head"><p>Parameter</p></th> <th class="head"><p>Comments</p></th> </tr> </thead>  <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-vmware-vmware-rest-vm-moid-lookup-parameter-terms"><strong>Terms</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span> / <span class="ansible-option-required">required</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The absolute folder path to the object you would like to lookup.</p> <p>Folder paths always start with the datacenter name, and then the object type (host, vm, network, datastore).</p> <p>If the object is in a sub folder, the sub folder path should be added after the object type (for example /my_dc/vm/some/sub_folder/vm_name_to_lookup).</p> <p>Enter the object or folder names as seen in the VCenter GUI. Do not escape spaces or special characters.</p> </div></td> </tr>  </table> </section> <section id="keyword-parameters"> <h2>Keyword parameters</h2> <p>This describes keyword parameters of the lookup. These are the values <code>key1=value1</code>, <code>key2=value2</code> and so on in the following examples: <code>lookup('vmware.vmware_rest.vm_moid', key1=value1, key2=value2, ...)</code> and <code>query('vmware.vmware_rest.vm_moid', key1=value1, key2=value2, ...)</code></p> <table class="longtable ansible-option-table docutils align-default" style="width: 100%"> <thead> <tr>
<th class="head"><p>Parameter</p></th> <th class="head"><p>Comments</p></th> </tr> </thead>  <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-vmware-vmware-rest-vm-moid-lookup-parameter-object-type"><strong>object_type</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Should not be set by the user, it is set internally when using a specific lookup plugin.</p> <p>Describes the type of object to lookup. Example, cluster, datacenter, datastore, etc.</p> <p class="ansible-option-line"><strong class="ansible-option-default-bold">Default:</strong> <code>"cluster"</code></p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-vmware-vmware-rest-vm-moid-lookup-parameter-vcenter-hostname"><strong>vcenter_hostname</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span> / <span class="ansible-option-required">required</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The hostname or IP address of the vSphere vCenter.</p> <p class="ansible-option-line"><strong class="ansible-option-configuration">Configuration:</strong></p> <ul class="simple"> <li>Environment variable: <a class="reference internal" href="../../environment_variables.html#envvar-VMWARE_HOST" id="index-0"><code>VMWARE_HOST</code></a>
</li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-vmware-vmware-rest-vm-moid-lookup-parameter-vcenter-password"><strong>vcenter_password</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span> / <span class="ansible-option-required">required</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The vSphere vCenter password.</p> <p class="ansible-option-line"><strong class="ansible-option-configuration">Configuration:</strong></p> <ul class="simple"> <li>Environment variable: <a class="reference internal" href="../../environment_variables.html#envvar-VMWARE_PASSWORD" id="index-1"><code>VMWARE_PASSWORD</code></a>
</li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-vmware-vmware-rest-vm-moid-lookup-parameter-vcenter-rest-log-file"><strong>vcenter_rest_log_file</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>You can use this optional parameter to set the location of a log file.</p> <p>This file will be used to record the HTTP REST interactions.</p> <p>The file will be stored on the host that runs the module.</p> <p class="ansible-option-line"><strong class="ansible-option-configuration">Configuration:</strong></p> <ul class="simple"> <li>Environment variable: <a class="reference internal" href="../../environment_variables.html#envvar-VMWARE_REST_LOG_FILE" id="index-2"><code>VMWARE_REST_LOG_FILE</code></a>
</li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-vmware-vmware-rest-vm-moid-lookup-parameter-vcenter-username"><strong>vcenter_username</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span> / <span class="ansible-option-required">required</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The vSphere vCenter username.</p> <p class="ansible-option-line"><strong class="ansible-option-configuration">Configuration:</strong></p> <ul class="simple"> <li>Environment variable: <a class="reference internal" href="../../environment_variables.html#envvar-VMWARE_USER" id="index-3"><code>VMWARE_USER</code></a>
</li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-vmware-vmware-rest-vm-moid-lookup-parameter-vcenter-validate-certs"><strong>vcenter_validate_certs</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">boolean</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Allows connection when SSL certificates are not valid. Set to <code>false</code> when certificates are not trusted.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li><code>false</code></li> <li>
<code><strong>true</strong></code> <span class="ansible-option-choices-default-mark">← (default)</span>
</li> </ul> <p class="ansible-option-line"><strong class="ansible-option-configuration">Configuration:</strong></p> <ul class="simple"> <li>Environment variable: <a class="reference internal" href="../../environment_variables.html#envvar-VMWARE_VALIDATE_CERTS" id="index-4"><code>VMWARE_VALIDATE_CERTS</code></a>
</li> </ul> </div></td> </tr>  </table> </section> <section id="notes"> <h2>Notes</h2> <div class="admonition note"> <p class="admonition-title">Note</p> <ul class="simple"> <li>When keyword and positional parameters are used together, positional parameters must be listed before keyword parameters: <code>lookup('vmware.vmware_rest.vm_moid', term1, term2, key1=value1, key2=value2)</code> and <code>query('vmware.vmware_rest.vm_moid', term1, term2, key1=value1, key2=value2)</code>
</li> <li>Lookup plugins are run on the ansible controller and are used to lookup information from an external resource. See <a class="reference external" href="../../../plugins/lookup.html#lookup-plugins">https://docs.ansible.com/ansible/latest/plugins/lookup.html#lookup-plugins</a>
</li> <li>This collection’s plugins allow you to quickly gather VMWare resource identifiers and either store or use them, instead of requiring multiple modules and tasks to do the same thing. See the examples section for a comparison.</li> </ul> </div> </section> <section id="examples"> <h2>Examples</h2> <pre data-language="yaml+jinja">#
#
# The examples below assume you have a datacenter named 'my_dc' and a vm named 'my_vm'.
# Replace these values as needed for your environment.
#
#

#
# Authentication / Connection Arguments
#
# You can explicitly set the connection arguments in each lookup. This may be clearer for some use cases
- name: Pass In Connection Arguments Explicitly
  ansible.builtin.debug:
    msg: &gt;-
      {{ lookup('vmware.vmware_rest.vm_moid', '/my_dc/vm/my_cluster/my_vm',
      vcenter_hostname="vcenter.test",
      vcenter_username="administrator@vsphere.local",
      vcenter_password="1234") }}

# Alternatively, you can add the connection arguments to a dictionary variable, and then pass that variable to the
# lookup plugins. This makes the individual lookup plugin calls simpler
- name: Example Playbook
  hosts: all
  vars:
    connection_args:
      vcenter_hostname: "vcenter.test"
      vcenter_username: "administrator@vsphere.local"
      vcenter_password: "1234"
  tasks:
    # Add more tasks or lookups as needed, referencing the same connection_args variable
    - name: Lookup MoID of the object
      ansible.builtin.debug:
        msg: "{{ lookup('vmware.vmware_rest.vm_moid', '/my_dc/vm/my_cluster/my_vm', **connection_args) }}"

# Finally, you can also leverage the environment variables associated with each connection arg, and avoid passing
# extra args to the lookup plugins
- name: Use a lookup plugin with VMWARE_* environment variables set
  ansible.builtin.debug:
    msg: "{{ lookup('vmware.vmware_rest.vm_moid', '/my_dc/vm/my_cluster/my_vm') }}"

#
# VM Search Path Examples
#
# VMs are located under the 'vm' folder in a datacenter. If they are not in a folder, the path
# should include the cluster name.
# The basic path for a VM should look like '/&lt;datacenter-name&gt;/vm/&lt;cluster-name&gt;/&lt;vm-name&gt;'
- name: Lookup VM Named 'my_vm' in Datacenter 'my_dc' in Cluster 'my_cluster'
  ansible.builtin.debug:
    msg: "{{ lookup('vmware.vmware_rest.folder_moid', '/my_dc/vm/my_cluster/my_vm') }}"

# If the VM is in a user created VM folder, you just include the folder name.
- name: Lookup VM Named 'my_vm' in Datacenter 'my_dc' in Folder 'production' (also in Cluster 'my_cluster')
  ansible.builtin.debug:
    msg: "{{ lookup('vmware.vmware_rest.folder_moid', '/my_dc/production/my_vm') }}"

#
# Usage in Playbooks
#
#
# The lookup plugin can be used to simplify your playbook. Here is an example of how you might use it.
#
# Without the lookup, this takes two modules which both run on the remote host. This can slow down execution
# and adds extra steps to the playbook:
- name: Look up the VM called 'my_vm' in the inventory
  vmware.vmware_rest.vcenter_vm_info:
    filter_names:
      - my_vm
  register: my_vm_info

- name: Delete a VM
  vmware.vmware_rest.vcenter_vm:
    vm: '{{ my_vm_info.value[0].vm }}'
    state: absent

# With the lookup, playbooks are shorter, quicker, and more intuitive:
- name: Delete a VM
  vmware.vmware_rest.vcenter_vm:
    vm: "{{ lookup('vmware.vmware_rest.vm_moid', '/my_dc/vm/my_vm') }}"
    state: absent
</pre> </section> <section id="return-value"> <h2>Return Value</h2> <table class="longtable ansible-option-table docutils align-default" style="width: 100%"> <thead> <tr>
<th class="head"><p>Key</p></th> <th class="head"><p>Description</p></th> </tr> </thead>  <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-vmware-vmware-rest-vm-moid-lookup-return-raw"><strong>Return value</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>MoID of the vSphere vm object</p> <p class="ansible-option-line"><strong class="ansible-option-returned-bold">Returned:</strong> success</p> <p class="ansible-option-line ansible-option-sample"><strong class="ansible-option-sample-bold">Sample:</strong> <code>"vm-1026"</code></p> </div></td> </tr>  </table> <section id="authors"> <h3>Authors</h3> <ul class="simple"> <li>Alina Buzachis (@alinabuzachis)</li> </ul> <div class="admonition hint"> <p class="admonition-title">Hint</p> <p>Configuration entries for each entry type have a low to high priority order. For example, a variable that is lower in the list will override a variable that is higher up.</p> </div> </section> <section id="collection-links"> <h3>Collection links</h3> <ul class="ansible-links"> <li><span><a aria-role="button" class="ansible-link reference external" href="https://github.com/ansible-collections/vmware.vmware_rest/issues?q=is%3Aissue+is%3Aopen+sort%3Aupdated-desc" rel="noopener external" target="_blank">Issue Tracker</a></span></li> <li><span><a aria-role="button" class="ansible-link reference external" href="https://github.com/ansible-collections/vmware.vmware_rest" rel="noopener external" target="_blank">Homepage</a></span></li> <li><span><a aria-role="button" class="ansible-link reference external" href="https://github.com/ansible-collections/vmware.vmware_rest.git" rel="noopener external" target="_blank">Repository (Sources)</a></span></li> </ul> </section> </section> </section><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2012&ndash;2018 Michael DeHaan<br>&copy; 2018&ndash;2024 Red Hat, Inc.<br>Licensed under the GNU General Public License version 3.<br>
    <a href="https://docs.ansible.com/ansible/latest/collections/vmware/vmware_rest/vm_moid_lookup.html" class="_attribution-link">https://docs.ansible.com/ansible/latest/collections/vmware/vmware_rest/vm_moid_lookup.html</a>
  </p>
</div>
