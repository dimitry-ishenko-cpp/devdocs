<section id="vmware-vmware-rest-vcenter-ovf-libraryitem-module-creates-a-library-item-in-content-library-from-a-virtual-machine-or-virtual-appliance"> <h1>vmware.vmware_rest.vcenter_ovf_libraryitem module – Creates a library item in content library from a virtual machine or virtual appliance</h1> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This module is part of the <a class="reference external" href="https://galaxy.ansible.com/ui/repo/published/vmware/vmware_rest/">vmware.vmware_rest collection</a> (version 3.2.0).</p> <p>You might already have this collection installed if you are using the <code>ansible</code> package. It is not included in <code>ansible-core</code>. To check whether it is installed, run <code>ansible-galaxy collection list</code>.</p> <p>To install it, use: <code>ansible-galaxy collection install vmware.vmware_rest</code>. You need further requirements to be able to use this module, see <a class="reference internal" href="#ansible-collections-vmware-vmware-rest-vcenter-ovf-libraryitem-module-requirements"><span class="std std-ref">Requirements</span></a> for details.</p> <p>To use it in a playbook, specify: <code>vmware.vmware_rest.vcenter_ovf_libraryitem</code>.</p> </div> <p class="ansible-version-added">New in vmware.vmware_rest 2.0.0</p>  <ul class="simple"> <li><a class="reference internal" href="#synopsis" id="id1">Synopsis</a></li> <li><a class="reference internal" href="#requirements" id="id2">Requirements</a></li> <li><a class="reference internal" href="#parameters" id="id3">Parameters</a></li> <li><a class="reference internal" href="#notes" id="id4">Notes</a></li> <li><a class="reference internal" href="#examples" id="id5">Examples</a></li> <li><a class="reference internal" href="#return-values" id="id6">Return Values</a></li> </ul>  <section id="synopsis"> <h2>Synopsis</h2> <ul class="simple"> <li>Creates a library item in content library from a virtual machine or virtual appliance. &lt;p&gt; This <a class="reference external" href="https://docs.ansible.com/cdn-cgi/l/email-protection#c0bbe6e3f3f7fbe6e3f5f2fbe6e3f4f8fbb4a5b2ad">{<span>@</span>term</a> operation} creates a library item in content library whose content is an OVF package derived from a source virtual machine or virtual appliance, using the supplied create specification. The OVF package may be stored as in a newly created library item or in an in an existing library item. For an existing library item whose content is updated by this <a class="reference external" href="https://docs.ansible.com/cdn-cgi/l/email-protection#dca7faffefebe7faffe9eee7faffe8e4e7a8b9aeb1">{<span>@</span>term</a> operation}, the original content is overwritten. Meta data such as name and description is not updated for the exisitng library item. &lt;/p&gt;</li> </ul> </section> <section id="requirements"> <h2 id="ansible-collections-vmware-vmware-rest-vcenter-ovf-libraryitem-module-requirements">Requirements</h2> <p>The below requirements are needed on the host that executes this module.</p> <ul class="simple"> <li>vSphere 7.0.3 or greater</li> <li>python &gt;= 3.6</li> <li>aiohttp</li> </ul> </section> <section id="parameters"> <h2>Parameters</h2> <table class="longtable ansible-option-table docutils align-default" style="width: 100%"> <thead> <tr>
<th class="head"><p>Parameter</p></th> <th class="head"><p>Comments</p></th> </tr> </thead>  <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-vmware-vmware-rest-vcenter-ovf-libraryitem-module-parameter-client-token"><strong>client_token</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Client-generated token used to retry a request if the client fails to get a response from the server. If the original request succeeded, the result of that request will be returned, otherwise the operation will be retried.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-vmware-vmware-rest-vcenter-ovf-libraryitem-module-parameter-create-spec"><strong>create_spec</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">dictionary</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Information used to create the OVF package from the source virtual machine or virtual appliance. Required with <em>state=[‘present’]</em></p> <p>Valid attributes are:</p> <ul class="simple"> <li>
<code>name</code> (str): Name to use in the OVF descriptor stored in the library item. ([‘present’])</li> <li>
<code>description</code> (str): Description to use in the OVF descriptor stored in the library item. ([‘present’])</li> <li>
<code>flags</code> (list): Flags to use for OVF package creation. The supported flags can be obtained using <a class="reference external" href="https://docs.ansible.com/cdn-cgi/l/email-protection#9be0bdb8a8aca0bdb8aea9a0bdb8afa3a0f7f2f5f0">{<span>@</span>link</a> ExportFlag#list}. ([‘present’])</li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-vmware-vmware-rest-vcenter-ovf-libraryitem-module-parameter-deployment-spec"><strong>deployment_spec</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">dictionary</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Specification of how the OVF package should be deployed to the target. Required with <em>state=[‘deploy’]</em></p> <p>Valid attributes are:</p> <ul class="simple"> <li>
<code>name</code> (str): Name assigned to the deployed target virtual machine or virtual appliance. ([‘deploy’])</li> <li>
<code>annotation</code> (str): Annotation assigned to the deployed target virtual machine or virtual appliance. ([‘deploy’])</li> <li>
<code>accept_all_EULA</code> (bool): Whether to accept all End User License Agreements. ([‘deploy’])</li> </ul> <p>This key is required with [‘deploy’].</p> <ul class="simple"> <li>
<code>network_mappings</code> (dict): Specification of the target network to use for sections of type ovf:NetworkSection in the OVF descriptor. The key in the {@term map} is the section identifier of the ovf:NetworkSection section in the OVF descriptor and the value is the target network to be used for deployment. ([‘deploy’])</li> <li>
<code>storage_mappings</code> (dict): Specification of the target storage to use for sections of type vmw:StorageGroupSection in the OVF descriptor. The key in the {@term map} is the section identifier of the ovf:StorageGroupSection section in the OVF descriptor and the value is the target storage specification to be used for deployment. ([‘deploy’])</li> <li>
<code>storage_provisioning</code> (str): The <code>disk_provisioning_type</code> defines the virtual disk provisioning types that can be set for a disk on the target platform. ([‘deploy’])</li> <li>Accepted values:</li> <li>eagerZeroedThick</li> <li>thick</li> <li>thin</li> <li>
<code>storage_profile_id</code> (str): Default storage profile to use for all sections of type vmw:StorageSection in the OVF descriptor. ([‘deploy’])</li> <li>
<code>locale</code> (str): The locale to use for parsing the OVF descriptor. ([‘deploy’])</li> <li>
<code>flags</code> (list): Flags to be use for deployment. The supported flag values can be obtained using <a class="reference external" href="https://docs.ansible.com/cdn-cgi/l/email-protection#770c515444404c515442454c5154434f4c1b1e191c">{<span>@</span>link</a> ImportFlag#list}. ([‘deploy’])</li> <li>
<code>additional_parameters</code> (list): Additional OVF parameters that may be needed for the deployment. Additional OVF parameters may be required by the OVF descriptor of the OVF package in the library item. Examples of OVF parameters that can be specified through this field include, but are not limited to: &lt;ul&gt; &lt;li&gt;{@link DeploymentOptionParams}&lt;/li&gt; &lt;li&gt;{@link ExtraConfigParams}&lt;/li&gt; &lt;li&gt;{@link IpAllocationParams}&lt;/li&gt; &lt;li&gt;{@link PropertyParams}&lt;/li&gt; &lt;li&gt;{@link ScaleOutParams}&lt;/li&gt; &lt;li&gt;{@link VcenterExtensionParams}&lt;/li&gt; &lt;/ul&gt; ([‘deploy’])</li> <li>
<code>default_datastore_id</code> (str): Default datastore to use for all sections of type vmw:StorageSection in the OVF descriptor. ([‘deploy’])</li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-vmware-vmware-rest-vcenter-ovf-libraryitem-module-parameter-ovf-library-item-id"><strong>ovf_library_item_id</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Identifier of the content library item containing the OVF package to be deployed. Required with <em>state=[‘deploy’, ‘filter’]</em></p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-vmware-vmware-rest-vcenter-ovf-libraryitem-module-parameter-session-timeout"><strong>session_timeout</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">float</span></p> <p><em class="ansible-option-versionadded">added in vmware.vmware_rest 2.1.0</em></p> </div></td> <td><div class="ansible-option-cell">
<p>Timeout settings for client session.</p> <p>The maximal number of seconds for the whole operation including connection establishment, request sending and response.</p> <p>The default value is 300s.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-vmware-vmware-rest-vcenter-ovf-libraryitem-module-parameter-source"><strong>source</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">dictionary</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Identifier of the virtual machine or virtual appliance to use as the source. Required with <em>state=[‘present’]</em></p> <p>Valid attributes are:</p> <ul class="simple"> <li>
<code>type</code> (str): Type of the deployable resource. ([‘present’])</li> </ul> <p>This key is required with [‘present’].</p> <ul class="simple"> <li>
<code>id</code> (str): Identifier of the deployable resource. ([‘present’])</li> </ul> <p>This key is required with [‘present’].</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-vmware-vmware-rest-vcenter-ovf-libraryitem-module-parameter-state"><strong>state</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li><code>"deploy"</code></li> <li><code>"filter"</code></li> <li>
<code><strong>"present"</strong></code> <span class="ansible-option-choices-default-mark">← (default)</span>
</li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-vmware-vmware-rest-vcenter-ovf-libraryitem-module-parameter-target"><strong>target</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">dictionary</span> / <span class="ansible-option-required">required</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Specification of the target content library and library item. This parameter is mandatory.</p> <p>Valid attributes are:</p> <ul class="simple"> <li>
<code>library_id</code> (str): Identifier of the library in which a new library item should be created. This field is not used if the <code>#library_item_id</code> field is specified. ([‘present’])</li> <li>
<code>library_item_id</code> (str): Identifier of the library item that should be should be updated. ([‘present’])</li> <li>
<code>resource_pool_id</code> (str): Identifier of the resource pool to which the virtual machine or virtual appliance should be attached. ([‘deploy’, ‘filter’])</li> </ul> <p>This key is required with [‘deploy’, ‘filter’].</p> <ul class="simple"> <li>
<code>host_id</code> (str): Identifier of the target host on which the virtual machine or virtual appliance will run. The target host must be a member of the cluster that contains the resource pool identified by <a class="reference external" href="https://docs.ansible.com/cdn-cgi/l/email-protection#c3b8e5e0f0f4f8e5e0f6f1f8e5e0f7fbf8afaaada8">{<span>@</span>link</a> #resourcePoolId}. ([‘deploy’, ‘filter’])</li> <li>
<code>folder_id</code> (str): Identifier of the vCenter folder that should contain the virtual machine or virtual appliance. The folder must be virtual machine folder. ([‘deploy’, ‘filter’])</li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-vmware-vmware-rest-vcenter-ovf-libraryitem-module-parameter-vcenter-hostname"><strong>vcenter_hostname</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span> / <span class="ansible-option-required">required</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The hostname or IP address of the vSphere vCenter</p> <p>If the value is not specified in the task, the value of environment variable <code>VMWARE_HOST</code> will be used instead.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-vmware-vmware-rest-vcenter-ovf-libraryitem-module-parameter-vcenter-password"><strong>vcenter_password</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span> / <span class="ansible-option-required">required</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The vSphere vCenter password</p> <p>If the value is not specified in the task, the value of environment variable <code>VMWARE_PASSWORD</code> will be used instead.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-vmware-vmware-rest-vcenter-ovf-libraryitem-module-parameter-vcenter-rest-log-file"><strong>vcenter_rest_log_file</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>You can use this optional parameter to set the location of a log file.</p> <p>This file will be used to record the HTTP REST interaction.</p> <p>The file will be stored on the host that run the module.</p> <p>If the value is not specified in the task, the value of</p> <p>environment variable <code>VMWARE_REST_LOG_FILE</code> will be used instead.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-vmware-vmware-rest-vcenter-ovf-libraryitem-module-parameter-vcenter-username"><strong>vcenter_username</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span> / <span class="ansible-option-required">required</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The vSphere vCenter username</p> <p>If the value is not specified in the task, the value of environment variable <code>VMWARE_USER</code> will be used instead.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-vmware-vmware-rest-vcenter-ovf-libraryitem-module-parameter-vcenter-validate-certs"><strong>vcenter_validate_certs</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">boolean</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Allows connection when SSL certificates are not valid. Set to <code>false</code> when certificates are not trusted.</p> <p>If the value is not specified in the task, the value of environment variable <code>VMWARE_VALIDATE_CERTS</code> will be used instead.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li><code>false</code></li> <li>
<code><strong>true</strong></code> <span class="ansible-option-choices-default-mark">← (default)</span>
</li> </ul> </div></td> </tr>  </table> </section> <section id="notes"> <h2>Notes</h2> <div class="admonition note"> <p class="admonition-title">Note</p> <ul class="simple"> <li>Tested on vSphere 7.0.3</li> </ul> </div> </section> <section id="examples"> <h2>Examples</h2> <pre data-language="yaml+jinja">- name: Create a VM
  vmware.vmware_rest.vcenter_vm:
    placement:
      cluster: "{{ lookup('vmware.vmware_rest.cluster_moid', '/my_dc/host/my_cluster') }}"
      datastore: "{{ lookup('vmware.vmware_rest.datastore_moid', '/my_dc/datastore/rw_datastore') }}"
      folder: "{{ lookup('vmware.vmware_rest.folder_moid', '/my_dc/vm') }}"
      resource_pool: "{{ lookup('vmware.vmware_rest.resource_pool_moid', '/my_dc/host/my_cluster/Resources') }}"
    name: test_vm1
    guest_OS: RHEL_7_64
    hardware_version: VMX_11
    memory:
      hot_add_enabled: true
      size_MiB: 1024
  register: my_vm

- name: Create a content library pointing on a NFS share
  vmware.vmware_rest.content_locallibrary:
    name: my_library_on_nfs
    description: automated
    publish_info:
      published: true
      authentication_method: NONE
    storage_backings:
    - storage_uri: nfs://datastore.test/srv/share/content-library
      type: OTHER
    state: present
  register: nfs_lib

- name: Export the VM as an OVF on the library
  vmware.vmware_rest.vcenter_ovf_libraryitem:
    session_timeout: 2900
    source:
      type: VirtualMachine
      id: '{{ my_vm.id }}'
    target:
      library_id: '{{ nfs_lib.id }}'
    create_spec:
      name: golden_image
      description: an OVF example
      flags: []
    state: present
  register: ovf_item

- name: Get the list of items of the NFS library
  vmware.vmware_rest.content_library_item_info:
    library_id: '{{ nfs_lib.id }}'
  register: lib_items

- name: Create a new VM from the OVF
  vmware.vmware_rest.vcenter_ovf_libraryitem:
    ovf_library_item_id: '{{ (lib_items.value|selectattr("name", "equalto", "golden_image")|first).id }}'
    state: deploy
    target:
      resource_pool_id: "{{ lookup('vmware.vmware_rest.resource_pool_moid', '/my_dc/host/my_cluster/Resources') }}"
    deployment_spec:
      name: my_vm_from_ovf
      accept_all_EULA: true
      storage_provisioning: thin

- name: Create a new VM from the OVF and specify the host and folder
  vmware.vmware_rest.vcenter_ovf_libraryitem:
    ovf_library_item_id: '{{ (lib_items.value|selectattr("name", "equalto", "golden_image")|first).id }}'
    state: deploy
    target:
      resource_pool_id: "{{ lookup('vmware.vmware_rest.resource_pool_moid', '/my_dc/host/my_cluster/Resources') }}"
      folder_id: "{{ lookup('vmware.vmware_rest.folder_moid', '/my_dc/vm') }}"
      host_id: "{{ lookup('vmware.vmware_rest.host_moid', '/my_dc/host/my_cluster/esxi1.test/test_vm1') }}"
    deployment_spec:
      name: my_vm_from_ovf_on_a_host
      accept_all_EULA: true
      storage_provisioning: thin
</pre> </section> <section id="return-values"> <h2>Return Values</h2> <p>Common return values are documented <a class="reference internal" href="../../../reference_appendices/common_return_values.html#common-return-values"><span class="std std-ref">here</span></a>, the following are the fields unique to this module:</p> <table class="longtable ansible-option-table docutils align-default" style="width: 100%"> <thead> <tr>
<th class="head"><p>Key</p></th> <th class="head"><p>Description</p></th> </tr> </thead>  <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-vmware-vmware-rest-vcenter-ovf-libraryitem-module-return-value"><strong>value</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">dictionary</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Create a new VM from the OVF and specify the host and folder</p> <p class="ansible-option-line"><strong class="ansible-option-returned-bold">Returned:</strong> On success</p> <p class="ansible-option-line ansible-option-sample"><strong class="ansible-option-sample-bold">Sample:</strong> <code>{"error": {"errors": [], "information": [], "warnings": []}, "resource_id": {"id": "vm-1078", "type": "VirtualMachine"}, "succeeded": 1}</code></p> </div></td> </tr>  </table> <section id="authors"> <h3>Authors</h3> <ul class="simple"> <li>Ansible Cloud Team (@ansible-collections)</li> </ul> </section> <section id="collection-links"> <h3>Collection links</h3> <ul class="ansible-links"> <li><span><a aria-role="button" class="ansible-link reference external" href="https://github.com/ansible-collections/vmware.vmware_rest/issues?q=is%3Aissue+is%3Aopen+sort%3Aupdated-desc" rel="noopener external" target="_blank">Issue Tracker</a></span></li> <li><span><a aria-role="button" class="ansible-link reference external" href="https://github.com/ansible-collections/vmware.vmware_rest" rel="noopener external" target="_blank">Homepage</a></span></li> <li><span><a aria-role="button" class="ansible-link reference external" href="https://github.com/ansible-collections/vmware.vmware_rest.git" rel="noopener external" target="_blank">Repository (Sources)</a></span></li> </ul> </section> </section> </section><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2012&ndash;2018 Michael DeHaan<br>&copy; 2018&ndash;2024 Red Hat, Inc.<br>Licensed under the GNU General Public License version 3.<br>
    <a href="https://docs.ansible.com/ansible/latest/collections/vmware/vmware_rest/vcenter_ovf_libraryitem_module.html" class="_attribution-link">https://docs.ansible.com/ansible/latest/collections/vmware/vmware_rest/vcenter_ovf_libraryitem_module.html</a>
  </p>
</div>
