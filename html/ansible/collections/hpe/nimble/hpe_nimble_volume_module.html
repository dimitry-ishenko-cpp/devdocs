<h1 id="hpe-nimble-hpe-nimble-volume-manage-the-hpe-nimble-storage-volumes">hpe.nimble.hpe_nimble_volume – Manage the HPE Nimble Storage volumes</h1> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This plugin is part of the <a class="reference external" href="https://galaxy.ansible.com/hpe/nimble">hpe.nimble collection</a> (version 1.1.3).</p> <p>You might already have this collection installed if you are using the <code>ansible</code> package. It is not included in <code>ansible-core</code>. To check whether it is installed, run <code>ansible-galaxy collection list</code>.</p> <p>To install it, use: <code>ansible-galaxy collection install hpe.nimble</code>.</p> <p>To use it in a playbook, specify: <code>hpe.nimble.hpe_nimble_volume</code>.</p> </div> <div class="versionadded"> <p><span class="versionmodified added">New in version 1.0.0: </span>of hpe.nimble</p> </div>  <ul class="simple"> <li><a class="reference internal" href="#synopsis" id="id1">Synopsis</a></li> <li><a class="reference internal" href="#requirements" id="id2">Requirements</a></li> <li><a class="reference internal" href="#parameters" id="id3">Parameters</a></li> <li><a class="reference internal" href="#notes" id="id4">Notes</a></li> <li><a class="reference internal" href="#examples" id="id5">Examples</a></li> </ul>   <h2 id="synopsis">Synopsis</h2> <ul class="simple"> <li>Manage the volumes on an HPE Nimble Storage group.</li> </ul>   <h2 id="requirements">Requirements</h2> <p>The below requirements are needed on the host that executes this module.</p> <ul class="simple"> <li>Ansible 2.9 or later</li> <li>Python 3.6 or later</li> <li>HPE Nimble Storage SDK for Python</li> <li>HPE Nimble Storage arrays running NimbleOS 5.0 or later</li> </ul>   <h2 id="parameters">Parameters</h2> <table class="documentation-table"> <tr> <th colspan="1">Parameter</th> <th>Choices/Defaults</th> <th width="100%">Comments</th> </tr> <tr> <td colspan="1">  <b>agent_type</b>  <div> <span>string</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>none</li> <li>smis</li> <li>vvol</li> <li>openstack</li> <li>openstackv2</li> </ul> </td> <td> <div>External management agent type.</div> </td> </tr> <tr> <td colspan="1">  <b>app_uuid</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Application identifier of volume.</div> </td> </tr> <tr> <td colspan="1">  <b>block_size</b>  <div> <span>integer</span> </div> </td> <td> </td> <td> <div>Size in bytes of blocks in the volume.</div> </td> </tr> <tr> <td colspan="1">  <b>cache_pinned</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>no</li> <li>yes</li> </ul> </td> <td> <div>If set to true, all the contents of this volume are kept in flash cache.</div> </td> </tr> <tr> <td colspan="1">  <b>caching</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>no</li> <li>yes</li> </ul> </td> <td> <div>Indicate caching the volume is enabled.</div> </td> </tr> <tr> <td colspan="1">  <b>change_name</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Change name of the existing source volume.</div> </td> </tr> <tr> <td colspan="1">  <b>clone</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>no</li> <li>yes</li> </ul> </td> <td> <div>Whether this volume is a clone. Use this attribute in combination with name and snapshot to create a clone by setting clone = true.</div> </td> </tr> <tr> <td colspan="1">  <b>dedupe</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>no</li> <li>yes</li> </ul> </td> <td> <div>Indicate whether dedupe is enabled.</div> </td> </tr> <tr> <td colspan="1">  <b>description</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Text description of volume.</div> </td> </tr> <tr> <td colspan="1">  <b>destination</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Name of the destination pool where the volume is moving to.</div> </td> </tr> <tr> <td colspan="1">  <b>encryption_cipher</b>  <div> <span>string</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>none</li> <li>aes_256_xts</li> </ul> </td> <td> <div>The encryption cipher of the volume.</div> </td> </tr> <tr> <td colspan="1">  <b>folder</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Name of the folder holding this volume.</div> </td> </tr> <tr> <td colspan="1">  <b>force</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>no</li> <li>yes</li> </ul> </td> <td> <div>Forcibly offline, reduce size or change read-only status a volume.</div> </td> </tr> <tr> <td colspan="1">  <b>force_vvol</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Forcibly move a virtual volume.</div> </td> </tr> <tr> <td colspan="1">  <b>host</b>  <div> <span>string</span> / <span>required</span> </div> </td> <td> </td> <td> <div>HPE Nimble Storage IP address.</div> </td> </tr> <tr> <td colspan="1">  <b>iscsi_target_scope</b>  <div> <span>string</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>volume</li> <li>group</li> </ul> </td> <td> <div>This indicates whether volume is exported under iSCSI Group Target or iSCSI volume target. This attribute is only meaningful to iSCSI system.</div> </td> </tr> <tr> <td colspan="1">  <b>limit</b>  <div> <span>integer</span> </div> </td> <td> </td> <td> <div>Limit on the volume's mapped usage, expressed as a percentage of the volume's size.</div> </td> </tr> <tr> <td colspan="1">  <b>limit_iops</b>  <div> <span>integer</span> </div> </td> <td> </td> <td> <div>IOPS limit for this volume.</div> </td> </tr> <tr> <td colspan="1">  <b>limit_mbps</b>  <div> <span>integer</span> </div> </td> <td> </td> <td> <div>Throughput limit for this volume in MB/s.</div> </td> </tr> <tr> <td colspan="1">  <b>metadata</b>  <div> <span>dictionary</span> </div> </td> <td> </td> <td> <div>User defined key-value pairs that augment an volume's attributes. List of key-value pairs. Keys must be unique and non-empty. When creating an object, values must be non-empty. When updating an object, an empty value causes the corresponding key to be removed.</div> </td> </tr> <tr> <td colspan="1">  <b>move</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>no</li> <li>yes</li> </ul> </td> <td> <div>Move a volume to different pool.</div> </td> </tr> <tr> <td colspan="1">  <b>multi_initiator</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>no</li> <li>yes</li> </ul> </td> <td> <div>For iSCSI volume target, this flag indicates whether the volume and its snapshots can be accessed from multiple initiators at the same time.</div> </td> </tr> <tr> <td colspan="1">  <b>name</b>  <div> <span>string</span> / <span>required</span> </div> </td> <td> </td> <td> <div>Name of the source volume.</div> </td> </tr> <tr> <td colspan="1">  <b>online</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>no</li> <li>yes</li> </ul> </td> <td> <div>Online state of volume, available for host initiators to establish connections.</div> </td> </tr> <tr> <td colspan="1">  <b>owned_by_group</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Name of group that currently owns the volume.</div> </td> </tr> <tr> <td colspan="1">  <b>parent</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Name of parent volume.</div> </td> </tr> <tr> <td colspan="1">  <b>password</b>  <div> <span>string</span> / <span>required</span> </div> </td> <td> </td> <td> <div>HPE Nimble Storage password.</div> </td> </tr> <tr> <td colspan="1">  <b>perf_policy</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Name of the performance policy. After creating a volume, performance policy for the volume can only be changed to another performance policy with same block size.</div> </td> </tr> <tr> <td colspan="1">  <b>pool</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Name associated with the pool in the storage pool table.</div> </td> </tr> <tr> <td colspan="1">  <b>read_only</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>no</li> <li>yes</li> </ul> </td> <td> <div>Volume is read-only.</div> </td> </tr> <tr> <td colspan="1">  <b>size</b>  <div> <span>integer</span> </div> </td> <td> </td> <td> <div>Volume size in megabytes. Size is required for creating a volume but not for cloning an existing volume.</div> </td> </tr> <tr> <td colspan="1">  <b>snapshot</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Base snapshot name. This attribute is required together with name and clone when cloning a volume with the create operation.</div> </td> </tr> <tr> <td colspan="1">  <b>state</b>  <div> <span>string</span> / <span>required</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>present</li> <li>absent</li> <li>create</li> <li>restore</li> </ul> </td> <td> <div>The volume operations.</div> </td> </tr> <tr> <td colspan="1">  <b>thinly_provisioned</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>no</li> <li>yes</li> </ul> </td> <td> <div>Set volume's provisioning level to thin.</div> </td> </tr> <tr> <td colspan="1">  <b>username</b>  <div> <span>string</span> / <span>required</span> </div> </td> <td> </td> <td> <div>HPE Nimble Storage user name.</div> </td> </tr> <tr> <td colspan="1">  <b>volcoll</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Name of volume collection of which this volume is a member. Use this attribute in update operation to associate or dissociate volumes with or from volume collections. When associating, set this attribute to the name of the volume collection. When dissociating, set this attribute to empty string.</div> </td> </tr> </table> <br>  <h2 id="notes">Notes</h2> <div class="admonition note"> <p class="admonition-title">Note</p> <ul class="simple"> <li>This module does not support <code>check_mode</code>.</li> </ul> </div>   <h2 id="examples">Examples</h2> <pre data-language="yaml+jinja"># If state is "create", then create a volume if not present. Fails if already present.
# if state is present, then create a volume if not present. Succeeds if it already exists.
- name: Create volume if not present
  hpe.nimble.hpe_nimble_volume:
    host: "{{ host }}"
    username: "{{ username }}"
    password: "{{ password }}"
    state: "{{ state | default('present') }}"
    size: "{{ size }}"
    limit_iops: "{{ limit_iops }}"
    limit_mbps: 5000
    force: false
    metadata: "{{ metadata }}" # metadata = {'mykey1': 'myval1', 'mykey2': 'myval2'}
    description: "{{ description }}"
    name: "{{ name }}"

- name: Changing volume "{{ name }}" to offline state
  hpe.nimble.hpe_nimble_volume:
    host: "{{ host }}"
    username: "{{ username }}"
    password: "{{ password }}"
    online: False
    state: present
    name: "{{ name }}"

- name: Changing volume "{{ name }}" to online state
  hpe.nimble.hpe_nimble_volume:
    host: "{{ host }}"
    username: "{{ username }}"
    password: "{{ password }}"
    online: True
    state: present
    name: "{{ name }}"

# Create a clone from the given snapshot name.
# If snapshot name is not provided then a snapshot is created on the source volume.
# Clone task only run if "parent" is specified. Snapshot is optional.
- name: Create or Refresh a clone
  hpe.nimble.hpe_nimble_volume:
    host: "{{ host }}"
    username: "{{ username }}"
    password: "{{ password }}"
    name: "{{ name }}" # name here is the name of cloned volume
    parent: "{{ parent | mandatory }}"
    snapshot: "{{ snapshot | default(None)}}"
    state: "{{ state | default('present') }}"
  when:
    - parent is defined

- name: Destroy volume (must be offline)
  hpe.nimble.hpe_nimble_volume:
    name: "{{ name }}"
    state: absent

# If no snapshot is given, then restore volume to last snapshot. Fails if no snapshots exist.
# If snapshot is provided, then restore volume from specified snapshot.
- name: Restore volume "{{ name }}"
  hpe.nimble.hpe_nimble_volume:
    host: "{{ host }}"
    username: "{{ username }}"
    password: "{{ password }}"
    name: "{{ name }}"
    snapshot: "{{ snapshot | default(None)}}"
    state: restore

- name: Delete volume "{{ name }}" (must be offline)
  hpe.nimble.hpe_nimble_volume:
    host: "{{ host }}"
    username: "{{ username }}"
    password: "{{ password }}"
    name: "{{ name }}"
    state: absent

- name: Move volume to pool
  hpe.nimble.hpe_nimble_volume:
    host: "{{ host }}"
    username: "{{ username }}"
    password: "{{ password }}"
    move: true
    name: "{{ name }}"
    state: present
    destination: "{{ destination | mandatory }}"
</pre>  <h3 id="authors">Authors</h3> <ul class="simple"> <li>HPE Nimble Storage Ansible Team (@ar-india) &lt;<a class="reference external" href="https://docs.ansible.com/cdn-cgi/l/email-protection#8be5e2e6e9e7eea6efe8f8a6f8ffe4f9eaeceea6eafeffe4e6eaffe2e4e5a6eee5ecada8b8bcb0ada8beb9b0ada8bfb3b0e3fbeeada8bfbdb0e8e4e6">nimble-dcs-storage-automation-eng<span>@</span>hpe<span>.</span>com</a>&gt;</li> </ul><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2012&ndash;2018 Michael DeHaan<br>&copy; 2018&ndash;2021 Red Hat, Inc.<br>Licensed under the GNU General Public License version 3.<br>
    <a href="https://docs.ansible.com/ansible/latest/collections/hpe/nimble/hpe_nimble_volume_module.html" class="_attribution-link">https://docs.ansible.com/ansible/latest/collections/hpe/nimble/hpe_nimble_volume_module.html</a>
  </p>
</div>
