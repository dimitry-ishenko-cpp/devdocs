<section id="ansible-posix-cgroup-perf-recap-callback-profiles-system-activity-of-tasks-and-full-execution-using-cgroups"> <h1>ansible.posix.cgroup_perf_recap callback – Profiles system activity of tasks and full execution using cgroups</h1> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This callback plugin is part of the <a class="reference external" href="https://galaxy.ansible.com/ui/repo/published/ansible/posix/">ansible.posix collection</a> (version 1.5.4).</p> <p>You might already have this collection installed if you are using the <code>ansible</code> package. It is not included in <code>ansible-core</code>. To check whether it is installed, run <code>ansible-galaxy collection list</code>.</p> <p>To install it, use: <code>ansible-galaxy collection install ansible.posix</code>. You need further requirements to be able to use this callback plugin, see <a class="reference internal" href="#ansible-collections-ansible-posix-cgroup-perf-recap-callback-requirements"><span class="std std-ref">Requirements</span></a> for details.</p> <p>To use it in a playbook, specify: <code>ansible.posix.cgroup_perf_recap</code>.</p> </div>  <ul class="simple"> <li><a class="reference internal" href="#callback-plugin" id="id1">Callback plugin</a></li> <li><a class="reference internal" href="#synopsis" id="id2">Synopsis</a></li> <li><a class="reference internal" href="#requirements" id="id3">Requirements</a></li> <li><a class="reference internal" href="#parameters" id="id4">Parameters</a></li> <li><a class="reference internal" href="#notes" id="id5">Notes</a></li> </ul>  <section id="callback-plugin"> <h2>Callback plugin</h2> <p>This plugin is an <strong>aggregate callback</strong>. It adds additional console output next to the configured stdout callback. See <a class="reference internal" href="../../../plugins/callback.html#callback-plugins"><span class="std std-ref">Callback plugins</span></a> for more information on callback plugins.</p> </section> <section id="synopsis"> <h2>Synopsis</h2> <ul class="simple"> <li>This is an ansible callback plugin utilizes cgroups to profile system activity of ansible and individual tasks, and display a recap at the end of the playbook execution</li> </ul> </section> <section id="requirements"> <h2 id="ansible-collections-ansible-posix-cgroup-perf-recap-callback-requirements">Requirements</h2> <p>The below requirements are needed on the local controller node that executes this callback.</p> <ul class="simple"> <li>whitelist in configuration</li> <li>cgroups</li> </ul> </section> <section id="parameters"> <h2>Parameters</h2> <table class="longtable ansible-option-table docutils align-default" style="width: 100%"> <thead> <tr>
<th class="head"><p>Parameter</p></th> <th class="head"><p>Comments</p></th> </tr> </thead>  <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-posix-cgroup-perf-recap-callback-parameter-control-group"><strong>control_group</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span> / <span class="ansible-option-required">required</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Name of cgroups control group</p> <p class="ansible-option-line"><strong class="ansible-option-configuration">Configuration:</strong></p> <ul> <li>
<p>INI entry:</p> <pre data-language="YAML+Jinja">[callback_cgroup_perf_recap]
control_group = VALUE
</pre> </li> <li>Environment variable: <a class="reference internal" href="../../environment_variables.html#envvar-CGROUP_CONTROL_GROUP" id="index-0"><code>CGROUP_CONTROL_GROUP</code></a>
</li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-posix-cgroup-perf-recap-callback-parameter-cpu-poll-interval"><strong>cpu_poll_interval</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">float</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Interval between CPU polling for determining CPU usage. A lower value may produce inaccurate results, a higher value may not be short enough to collect results for short tasks.</p> <p class="ansible-option-line"><strong class="ansible-option-default-bold">Default:</strong> <code>0.25</code></p> <p class="ansible-option-line"><strong class="ansible-option-configuration">Configuration:</strong></p> <ul> <li>
<p>INI entry:</p> <pre data-language="YAML+Jinja">[callback_cgroup_perf_recap]
cpu_poll_interval = 0.25
</pre> </li> <li>Environment variable: <a class="reference internal" href="../../environment_variables.html#envvar-CGROUP_CPU_POLL_INTERVAL" id="index-1"><code>CGROUP_CPU_POLL_INTERVAL</code></a>
</li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-posix-cgroup-perf-recap-callback-parameter-display-recap"><strong>display_recap</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">boolean</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Controls whether the recap is printed at the end, useful if you will automatically process the output files</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li><code>false</code></li> <li>
<code><strong>true</strong></code> <span class="ansible-option-choices-default-mark">← (default)</span>
</li> </ul> <p class="ansible-option-line"><strong class="ansible-option-configuration">Configuration:</strong></p> <ul> <li>
<p>INI entry:</p> <pre data-language="YAML+Jinja">[callback_cgroup_perf_recap]
display_recap = true
</pre> </li> <li>Environment variable: <a class="reference internal" href="../../environment_variables.html#envvar-CGROUP_DISPLAY_RECAP" id="index-2"><code>CGROUP_DISPLAY_RECAP</code></a>
</li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-posix-cgroup-perf-recap-callback-parameter-file-name-format"><strong>file_name_format</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Format of filename. Accepts <code>%(counter</code>s), <code>%(task_uuid</code>s), <code>%(feature</code>s), <code>%(ext</code>s). Defaults to <code>%(feature</code>s.%(ext)s) when <code>file_per_task</code> is <code>False</code> and <code>%(counter</code>s-%(task_uuid)s-%(feature)s.%(ext)s) when <code>True</code></p> <p class="ansible-option-line"><strong class="ansible-option-default-bold">Default:</strong> <code>"%(feature)s.%(ext)s"</code></p> <p class="ansible-option-line"><strong class="ansible-option-configuration">Configuration:</strong></p> <ul> <li>
<p>INI entry:</p> <pre data-language="YAML+Jinja">[callback_cgroup_perf_recap]
file_name_format = %(feature)s.%(ext)s
</pre> </li> <li>Environment variable: <a class="reference internal" href="../../environment_variables.html#envvar-CGROUP_FILE_NAME_FORMAT" id="index-3"><code>CGROUP_FILE_NAME_FORMAT</code></a>
</li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-posix-cgroup-perf-recap-callback-parameter-file-per-task"><strong>file_per_task</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">boolean</span></p> </div></td> <td><div class="ansible-option-cell">
<p>When set as <code>True</code> along with <code>write_files</code>, this callback will write 1 file per task instead of 1 file for the entire playbook run</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li>
<code><strong>false</strong></code> <span class="ansible-option-choices-default-mark">← (default)</span>
</li> <li><code>true</code></li> </ul> <p class="ansible-option-line"><strong class="ansible-option-configuration">Configuration:</strong></p> <ul> <li>
<p>INI entry:</p> <pre data-language="YAML+Jinja">[callback_cgroup_perf_recap]
file_per_task = false
</pre> </li> <li>Environment variable: <a class="reference internal" href="../../environment_variables.html#envvar-CGROUP_FILE_PER_TASK" id="index-4"><code>CGROUP_FILE_PER_TASK</code></a>
</li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-posix-cgroup-perf-recap-callback-parameter-memory-poll-interval"><strong>memory_poll_interval</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">float</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Interval between memory polling for determining memory usage. A lower value may produce inaccurate results, a higher value may not be short enough to collect results for short tasks.</p> <p class="ansible-option-line"><strong class="ansible-option-default-bold">Default:</strong> <code>0.25</code></p> <p class="ansible-option-line"><strong class="ansible-option-configuration">Configuration:</strong></p> <ul> <li>
<p>INI entry:</p> <pre data-language="YAML+Jinja">[callback_cgroup_perf_recap]
memory_poll_interval = 0.25
</pre> </li> <li>Environment variable: <a class="reference internal" href="../../environment_variables.html#envvar-CGROUP_MEMORY_POLL_INTERVAL" id="index-5"><code>CGROUP_MEMORY_POLL_INTERVAL</code></a>
</li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-posix-cgroup-perf-recap-callback-parameter-output-dir"><strong>output_dir</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">path</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Output directory for files containing recorded performance readings. If the value contains a single %s, the start time of the playbook run will be inserted in that space. Only the deepest level directory will be created if it does not exist, parent directories will not be created.</p> <p class="ansible-option-line"><strong class="ansible-option-default-bold">Default:</strong> <code>"/tmp/ansible-perf-%s"</code></p> <p class="ansible-option-line"><strong class="ansible-option-configuration">Configuration:</strong></p> <ul> <li>
<p>INI entry:</p> <pre data-language="YAML+Jinja">[callback_cgroup_perf_recap]
output_dir = /tmp/ansible-perf-%s
</pre> </li> <li>Environment variable: <a class="reference internal" href="../../environment_variables.html#envvar-CGROUP_OUTPUT_DIR" id="index-6"><code>CGROUP_OUTPUT_DIR</code></a>
</li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-posix-cgroup-perf-recap-callback-parameter-output-format"><strong>output_format</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Output format, either CSV or JSON-seq</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li>
<code><strong>"csv"</strong></code> <span class="ansible-option-choices-default-mark">← (default)</span>
</li> <li><code>"json"</code></li> </ul> <p class="ansible-option-line"><strong class="ansible-option-configuration">Configuration:</strong></p> <ul> <li>
<p>INI entry:</p> <pre data-language="YAML+Jinja">[callback_cgroup_perf_recap]
output_format = csv
</pre> </li> <li>Environment variable: <a class="reference internal" href="../../environment_variables.html#envvar-CGROUP_OUTPUT_FORMAT" id="index-7"><code>CGROUP_OUTPUT_FORMAT</code></a>
</li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-posix-cgroup-perf-recap-callback-parameter-pid-poll-interval"><strong>pid_poll_interval</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">float</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Interval between PID polling for determining PID count. A lower value may produce inaccurate results, a higher value may not be short enough to collect results for short tasks.</p> <p class="ansible-option-line"><strong class="ansible-option-default-bold">Default:</strong> <code>0.25</code></p> <p class="ansible-option-line"><strong class="ansible-option-configuration">Configuration:</strong></p> <ul> <li>
<p>INI entry:</p> <pre data-language="YAML+Jinja">[callback_cgroup_perf_recap]
pid_poll_interval = 0.25
</pre> </li> <li>Environment variable: <a class="reference internal" href="../../environment_variables.html#envvar-CGROUP_PID_POLL_INTERVAL" id="index-8"><code>CGROUP_PID_POLL_INTERVAL</code></a>
</li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-posix-cgroup-perf-recap-callback-parameter-write-files"><strong>write_files</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">boolean</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Dictates whether files will be written containing performance readings</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li>
<code><strong>false</strong></code> <span class="ansible-option-choices-default-mark">← (default)</span>
</li> <li><code>true</code></li> </ul> <p class="ansible-option-line"><strong class="ansible-option-configuration">Configuration:</strong></p> <ul> <li>
<p>INI entry:</p> <pre data-language="YAML+Jinja">[callback_cgroup_perf_recap]
write_files = false
</pre> </li> <li>Environment variable: <a class="reference internal" href="../../environment_variables.html#envvar-CGROUP_WRITE_FILES" id="index-9"><code>CGROUP_WRITE_FILES</code></a>
</li> </ul> </div></td> </tr>  </table> </section> <section id="notes"> <h2>Notes</h2> <div class="admonition note"> <p class="admonition-title">Note</p> <ul class="simple"> <li>Requires ansible to be run from within a cgroup, such as with <code>cgexec -g cpuacct,memory,pids:ansible_profile ansible-playbook ...</code>
</li> <li>This cgroup should only be used by ansible to get accurate results</li> <li>To create the cgroup, first use a command such as <code>sudo cgcreate -a ec2-user:ec2-user -t ec2-user:ec2-user -g cpuacct,memory,pids:ansible_profile</code>
</li> </ul> </div> <div class="admonition hint"> <p class="admonition-title">Hint</p> <p>Configuration entries for each entry type have a low to high priority order. For example, a variable that is lower in the list will override a variable that is higher up.</p> </div> <section id="collection-links"> <h3>Collection links</h3> <ul class="ansible-links"> <li><span><a aria-role="button" class="ansible-link reference external" href="https://github.com/ansible-collections/ansible.posix" rel="noopener external" target="_blank">Issue Tracker</a></span></li> <li><span><a aria-role="button" class="ansible-link reference external" href="https://github.com/ansible-collections/ansible.posix" rel="noopener external" target="_blank">Repository (Sources)</a></span></li> </ul> </section> </section> </section><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2012&ndash;2018 Michael DeHaan<br>&copy; 2018&ndash;2024 Red Hat, Inc.<br>Licensed under the GNU General Public License version 3.<br>
    <a href="https://docs.ansible.com/ansible/latest/collections/ansible/posix/cgroup_perf_recap_callback.html" class="_attribution-link">https://docs.ansible.com/ansible/latest/collections/ansible/posix/cgroup_perf_recap_callback.html</a>
  </p>
</div>
