<section id="ansible-builtin-iptables-module-modify-iptables-rules"> <h1>ansible.builtin.iptables module – Modify iptables rules</h1> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This module is part of <code>ansible-core</code> and included in all Ansible installations. In most cases, you can use the short module name <code>iptables</code> even without specifying the <a class="reference internal" href="../../../collections_guide/collections_using_playbooks.html#collections-keyword"><span class="std std-ref">collections keyword</span></a>. However, we recommend you use the <a class="reference internal" href="https://docs.ansible.com/ansible/latest/reference_appendices/glossary.html#term-Fully-Qualified-Collection-Name-FQCN"><span class="xref std std-term">Fully Qualified Collection Name (FQCN)</span></a> <code>ansible.builtin.iptables</code> for easy linking to the module documentation and to avoid conflicting with other collections that may have the same module name.</p> </div>  <ul class="simple"> <li><a class="reference internal" href="#synopsis" id="id1">Synopsis</a></li> <li><a class="reference internal" href="#parameters" id="id2">Parameters</a></li> <li><a class="reference internal" href="#attributes" id="id3">Attributes</a></li> <li><a class="reference internal" href="#notes" id="id4">Notes</a></li> <li><a class="reference internal" href="#examples" id="id5">Examples</a></li> </ul>  <section id="synopsis"> <h2>Synopsis</h2> <ul class="simple"> <li>
<a class="reference internal" href="#ansible-collections-ansible-builtin-iptables-module"><span class="std std-ref">ansible.builtin.iptables</span></a> is used to set up, maintain, and inspect the tables of IP packet filter rules in the Linux kernel.</li> <li>This module does not handle the saving and/or loading of rules, but rather only manipulates the current rules that are present in memory. This is the same as the behaviour of the <code>iptables</code> and <code>ip6tables</code> command which this module uses internally.</li> </ul> </section> <section id="parameters"> <h2>Parameters</h2> <table class="longtable ansible-option-table docutils align-default" style="width: 100%"> <thead> <tr>
<th class="head"><p>Parameter</p></th> <th class="head"><p>Comments</p></th> </tr> </thead>  <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-iptables-module-parameter-action"><strong>action</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Whether the rule should be appended at the bottom or inserted at the top.</p> <p>If the rule already exists the chain will not be modified.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li>
<code><strong>"append"</strong></code> <span class="ansible-option-choices-default-mark">← (default)</span>
</li> <li><code>"insert"</code></li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-iptables-module-parameter-chain"><strong>chain</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Specify the iptables chain to modify.</p> <p>This could be a user-defined chain or one of the standard iptables chains, like <code>INPUT</code>, <code>FORWARD</code>, <code>OUTPUT</code>, <code>PREROUTING</code>, <code>POSTROUTING</code>, <code>SECMARK</code> or <code>CONNSECMARK</code>.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-iptables-module-parameter-chain-management"><strong>chain_management</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">boolean</span></p> <p><em class="ansible-option-versionadded">added in ansible-core 2.13</em></p> </div></td> <td><div class="ansible-option-cell">
<p>If <code>true</code> and <code><strong><a class="reference internal" href="#ansible-collections-ansible-builtin-iptables-module-parameter-state"><span class="std std-ref">state</span></a></strong></code> is <code>present</code>, the chain will be created if needed.</p> <p>If <code>true</code> and <code><strong><a class="reference internal" href="#ansible-collections-ansible-builtin-iptables-module-parameter-state"><span class="std std-ref">state</span></a></strong></code> is <code>absent</code>, the chain will be deleted if the only other parameter passed are <code><strong><a class="reference internal" href="#ansible-collections-ansible-builtin-iptables-module-parameter-chain"><span class="std std-ref">chain</span></a></strong></code> and optionally <code><strong><a class="reference internal" href="#ansible-collections-ansible-builtin-iptables-module-parameter-table"><span class="std std-ref">table</span></a></strong></code>.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li>
<code><strong>false</strong></code> <span class="ansible-option-choices-default-mark">← (default)</span>
</li> <li><code>true</code></li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-iptables-module-parameter-comment"><strong>comment</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>This specifies a comment that will be added to the rule.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-iptables-module-parameter-ctstate"><strong>ctstate</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">list</span> / <span class="ansible-option-elements">elements=string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>A list of the connection states to match in the conntrack module.</p> <p>Possible values are <code>INVALID</code>, <code>NEW</code>, <code>ESTABLISHED</code>, <code>RELATED</code>, <code>UNTRACKED</code>, <code>SNAT</code>, <code>DNAT</code>.</p> <p class="ansible-option-line"><strong class="ansible-option-default-bold">Default:</strong> <code>[]</code></p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-iptables-module-parameter-destination"><strong>destination</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Destination specification.</p> <p>Address can be either a network name, a hostname, a network IP address (with /mask), or a plain IP address.</p> <p>Hostnames will be resolved once only, before the rule is submitted to the kernel. Please note that specifying any name to be resolved with a remote query such as DNS is a really bad idea.</p> <p>The mask can be either a network mask or a plain number, specifying the number of 1’s at the left side of the network mask. Thus, a mask of 24 is equivalent to 255.255.255.0. A <code>!</code> argument before the address specification inverts the sense of the address.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-iptables-module-parameter-destination-port"><strong>destination_port</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Destination port or port range specification. This can either be a service name or a port number. An inclusive range can also be specified, using the format first:last. If the first port is omitted, ‘0’ is assumed; if the last is omitted, ‘65535’ is assumed. If the first port is greater than the second one they will be swapped. This is only valid if the rule also specifies one of the following protocols: tcp, udp, dccp or sctp.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-iptables-module-parameter-destination-ports"><strong>destination_ports</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">list</span> / <span class="ansible-option-elements">elements=string</span></p> <p><em class="ansible-option-versionadded">added in ansible-core 2.11</em></p> </div></td> <td><div class="ansible-option-cell">
<p>This specifies multiple destination port numbers or port ranges to match in the multiport module.</p> <p>It can only be used in conjunction with the protocols tcp, udp, udplite, dccp and sctp.</p> <p class="ansible-option-line"><strong class="ansible-option-default-bold">Default:</strong> <code>[]</code></p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-iptables-module-parameter-dst-range"><strong>dst_range</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> <p><em class="ansible-option-versionadded">added in Ansible 2.8</em></p> </div></td> <td><div class="ansible-option-cell">
<p>Specifies the destination IP range to match in the iprange module.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-iptables-module-parameter-flush"><strong>flush</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">boolean</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Flushes the specified table and chain of all rules.</p> <p>If no chain is specified then the entire table is purged.</p> <p>Ignores all other parameters.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li>
<code><strong>false</strong></code> <span class="ansible-option-choices-default-mark">← (default)</span>
</li> <li><code>true</code></li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-iptables-module-parameter-fragment"><strong>fragment</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>This means that the rule only refers to second and further fragments of fragmented packets.</p> <p>Since there is no way to tell the source or destination ports of such a packet (or ICMP type), such a packet will not match any rules which specify them.</p> <p>When the “!” argument precedes the fragment argument, the rule will only match head fragments, or unfragmented packets.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-iptables-module-parameter-gateway"><strong>gateway</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> <p><em class="ansible-option-versionadded">added in Ansible 2.8</em></p> </div></td> <td><div class="ansible-option-cell">
<p>This specifies the IP address of the host to send the cloned packets.</p> <p>This option is only valid when <code><strong><a class="reference internal" href="#ansible-collections-ansible-builtin-iptables-module-parameter-jump"><span class="std std-ref">jump</span></a></strong></code> is set to <code>TEE</code>.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-iptables-module-parameter-gid-owner"><strong>gid_owner</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> <p><em class="ansible-option-versionadded">added in Ansible 2.9</em></p> </div></td> <td><div class="ansible-option-cell">
<p>Specifies the GID or group to use in the match by owner rule.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-iptables-module-parameter-goto"><strong>goto</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>This specifies that the processing should continue in a user-specified chain.</p> <p>Unlike the jump argument return will not continue processing in this chain but instead in the chain that called us via jump.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-iptables-module-parameter-icmp-type"><strong>icmp_type</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>This allows specification of the ICMP type, which can be a numeric ICMP type, type/code pair, or one of the ICMP type names shown by the command ‘iptables -p icmp -h’</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-iptables-module-parameter-in-interface"><strong>in_interface</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Name of an interface via which a packet was received (only for packets entering the <code>INPUT</code>, <code>FORWARD</code> and <code>PREROUTING</code> chains).</p> <p>When the <code>!</code> argument is used before the interface name, the sense is inverted.</p> <p>If the interface name ends in a <code>+</code>, then any interface which begins with this name will match.</p> <p>If this option is omitted, any interface name will match.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-iptables-module-parameter-ip-version"><strong>ip_version</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Which version of the IP protocol this rule should apply to.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li>
<code><strong>"ipv4"</strong></code> <span class="ansible-option-choices-default-mark">← (default)</span>
</li> <li><code>"ipv6"</code></li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-iptables-module-parameter-jump"><strong>jump</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>This specifies the target of the rule; i.e., what to do if the packet matches it.</p> <p>The target can be a user-defined chain (other than the one this rule is in), one of the special builtin targets that decide the fate of the packet immediately, or an extension (see EXTENSIONS below).</p> <p>If this option is omitted in a rule (and the goto parameter is not used), then matching the rule will have no effect on the packet’s fate, but the counters on the rule will be incremented.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-iptables-module-parameter-limit"><strong>limit</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Specifies the maximum average number of matches to allow per second.</p> <p>The number can specify units explicitly, using <code>/second</code>, <code>/minute</code>, <code>/hour</code> or <code>/day</code>, or parts of them (so <code>5/second</code> is the same as <code>5/s</code>).</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-iptables-module-parameter-limit-burst"><strong>limit_burst</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Specifies the maximum burst before the above limit kicks in.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-iptables-module-parameter-log-level"><strong>log_level</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> <p><em class="ansible-option-versionadded">added in Ansible 2.8</em></p> </div></td> <td><div class="ansible-option-cell">
<p>Logging level according to the syslogd-defined priorities.</p> <p>The value can be strings or numbers from 1-8.</p> <p>This parameter is only applicable if <code><strong><a class="reference internal" href="#ansible-collections-ansible-builtin-iptables-module-parameter-jump"><span class="std std-ref">jump</span></a></strong></code> is set to <code>LOG</code>.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li><code>"0"</code></li> <li><code>"1"</code></li> <li><code>"2"</code></li> <li><code>"3"</code></li> <li><code>"4"</code></li> <li><code>"5"</code></li> <li><code>"6"</code></li> <li><code>"7"</code></li> <li><code>"emerg"</code></li> <li><code>"alert"</code></li> <li><code>"crit"</code></li> <li><code>"error"</code></li> <li><code>"warning"</code></li> <li><code>"notice"</code></li> <li><code>"info"</code></li> <li><code>"debug"</code></li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-iptables-module-parameter-log-prefix"><strong>log_prefix</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Specifies a log text for the rule. Only makes sense with a LOG jump.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-iptables-module-parameter-match"><strong>match</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">list</span> / <span class="ansible-option-elements">elements=string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Specifies a match to use, that is, an extension module that tests for a specific property.</p> <p>The set of matches makes up the condition under which a target is invoked.</p> <p>Matches are evaluated first to last if specified as an array and work in short-circuit fashion, i.e. if one extension yields false, the evaluation will stop.</p> <p class="ansible-option-line"><strong class="ansible-option-default-bold">Default:</strong> <code>[]</code></p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-iptables-module-parameter-match-set"><strong>match_set</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> <p><em class="ansible-option-versionadded">added in ansible-core 2.11</em></p> </div></td> <td><div class="ansible-option-cell">
<p>Specifies a set name that can be defined by ipset.</p> <p>Must be used together with the <code><strong><a class="reference internal" href="#ansible-collections-ansible-builtin-iptables-module-parameter-match-set-flags"><span class="std std-ref">match_set_flags</span></a></strong></code> parameter.</p> <p>When the <code>!</code> argument is prepended then it inverts the rule.</p> <p>Uses the iptables set extension.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-iptables-module-parameter-match-set-flags"><strong>match_set_flags</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> <p><em class="ansible-option-versionadded">added in ansible-core 2.11</em></p> </div></td> <td><div class="ansible-option-cell">
<p>Specifies the necessary flags for the match_set parameter.</p> <p>Must be used together with the <code><strong><a class="reference internal" href="#ansible-collections-ansible-builtin-iptables-module-parameter-match-set"><span class="std std-ref">match_set</span></a></strong></code> parameter.</p> <p>Uses the iptables set extension.</p> <p>Choices <code>dst,dst</code> and <code>src,src</code> added in version 2.17.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li><code>"src"</code></li> <li><code>"dst"</code></li> <li><code>"src,dst"</code></li> <li><code>"dst,src"</code></li> <li><code>"dst,dst"</code></li> <li><code>"src,src"</code></li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-iptables-module-parameter-numeric"><strong>numeric</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">boolean</span></p> <p><em class="ansible-option-versionadded">added in ansible-core 2.15</em></p> </div></td> <td><div class="ansible-option-cell">
<p>This parameter controls the running of the list -action of iptables, which is used internally by the module</p> <p>Does not affect the actual functionality. Use this if iptables hang when creating a chain or altering policy</p> <p>If <code>true</code>, then iptables skips the DNS-lookup of the IP addresses in a chain when it uses the list -action</p> <p>Listing is used internally for example when setting a policy or creating a chain</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li>
<code><strong>false</strong></code> <span class="ansible-option-choices-default-mark">← (default)</span>
</li> <li><code>true</code></li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-iptables-module-parameter-out-interface"><strong>out_interface</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Name of an interface via which a packet is going to be sent (for packets entering the <code>FORWARD</code>, <code>OUTPUT</code> and <code>POSTROUTING</code> chains).</p> <p>When the <code>!</code> argument is used before the interface name, the sense is inverted.</p> <p>If the interface name ends in a <code>+</code>, then any interface which begins with this name will match.</p> <p>If this option is omitted, any interface name will match.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-iptables-module-parameter-policy"><strong>policy</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Set the policy for the chain to the given target.</p> <p>Only built-in chains can have policies.</p> <p>This parameter requires the <code><strong><a class="reference internal" href="#ansible-collections-ansible-builtin-iptables-module-parameter-chain"><span class="std std-ref">chain</span></a></strong></code> parameter.</p> <p>If you specify this parameter, all other parameters will be ignored.</p> <p>This parameter is used to set the default policy for the given <code><strong><a class="reference internal" href="#ansible-collections-ansible-builtin-iptables-module-parameter-chain"><span class="std std-ref">chain</span></a></strong></code>. Do not confuse this with <code><strong><a class="reference internal" href="#ansible-collections-ansible-builtin-iptables-module-parameter-jump"><span class="std std-ref">jump</span></a></strong></code> parameter.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li><code>"ACCEPT"</code></li> <li><code>"DROP"</code></li> <li><code>"QUEUE"</code></li> <li><code>"RETURN"</code></li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-iptables-module-parameter-protocol"><strong>protocol</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The protocol of the rule or of the packet to check.</p> <p>The specified protocol can be one of <code>tcp</code>, <code>udp</code>, <code>udplite</code>, <code>icmp</code>, <code>ipv6-icmp</code> or <code>icmpv6</code>, <code>esp</code>, <code>ah</code>, <code>sctp</code> or the special keyword <code>all</code>, or it can be a numeric value, representing one of these protocols or a different one.</p> <p>A protocol name from <code>/etc/protocols</code> is also allowed.</p> <p>A <code>!</code> argument before the protocol inverts the test.</p> <p>The number zero is equivalent to all.</p> <p><code>all</code> will match with all protocols and is taken as default when this option is omitted.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-iptables-module-parameter-reject-with"><strong>reject_with</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Specifies the error packet type to return while rejecting. It implies “jump: REJECT”.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-iptables-module-parameter-rule-num"><strong>rule_num</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Insert the rule as the given rule number.</p> <p>This works only with <code><a class="reference internal" href="#ansible-collections-ansible-builtin-iptables-module-parameter-action"><span class="std std-ref">action=insert</span></a></code>.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-iptables-module-parameter-set-counters"><strong>set_counters</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>This enables the administrator to initialize the packet and byte counters of a rule (during <code>INSERT</code>, <code>APPEND</code>, <code>REPLACE</code> operations).</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-iptables-module-parameter-set-dscp-mark"><strong>set_dscp_mark</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>This allows specifying a DSCP mark to be added to packets. It takes either an integer or hex value.</p> <p>If the parameter is set, <code><strong><a class="reference internal" href="#ansible-collections-ansible-builtin-iptables-module-parameter-jump"><span class="std std-ref">jump</span></a></strong></code> is set to <code>DSCP</code>.</p> <p>Mutually exclusive with <code><strong><a class="reference internal" href="#ansible-collections-ansible-builtin-iptables-module-parameter-set-dscp-mark-class"><span class="std std-ref">set_dscp_mark_class</span></a></strong></code>.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-iptables-module-parameter-set-dscp-mark-class"><strong>set_dscp_mark_class</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>This allows specifying a predefined DiffServ class which will be translated to the corresponding DSCP mark.</p> <p>If the parameter is set, <code><strong><a class="reference internal" href="#ansible-collections-ansible-builtin-iptables-module-parameter-jump"><span class="std std-ref">jump</span></a></strong></code> is set to <code>DSCP</code>.</p> <p>Mutually exclusive with <code><strong><a class="reference internal" href="#ansible-collections-ansible-builtin-iptables-module-parameter-set-dscp-mark"><span class="std std-ref">set_dscp_mark</span></a></strong></code>.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-iptables-module-parameter-source"><strong>source</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Source specification.</p> <p>Address can be either a network name, a hostname, a network IP address (with /mask), or a plain IP address.</p> <p>Hostnames will be resolved once only, before the rule is submitted to the kernel. Please note that specifying any name to be resolved with a remote query such as DNS is a really bad idea.</p> <p>The mask can be either a network mask or a plain number, specifying the number of 1’s at the left side of the network mask. Thus, a mask of 24 is equivalent to 255.255.255.0. A <code>!</code> argument before the address specification inverts the sense of the address.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-iptables-module-parameter-source-port"><strong>source_port</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Source port or port range specification.</p> <p>This can either be a service name or a port number.</p> <p>An inclusive range can also be specified, using the format <code>first:last</code>.</p> <p>If the first port is omitted, <code>0</code> is assumed; if the last is omitted, <code>65535</code> is assumed.</p> <p>If the first port is greater than the second one they will be swapped.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-iptables-module-parameter-src-range"><strong>src_range</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> <p><em class="ansible-option-versionadded">added in Ansible 2.8</em></p> </div></td> <td><div class="ansible-option-cell">
<p>Specifies the source IP range to match the iprange module.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-iptables-module-parameter-state"><strong>state</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Whether the rule should be absent or present.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li><code>"absent"</code></li> <li>
<code><strong>"present"</strong></code> <span class="ansible-option-choices-default-mark">← (default)</span>
</li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-iptables-module-parameter-syn"><strong>syn</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>This allows matching packets that have the SYN bit set and the ACK and RST bits unset.</p> <p>When negated, this matches all packets with the RST or the ACK bits set.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li>
<code><strong>"ignore"</strong></code> <span class="ansible-option-choices-default-mark">← (default)</span>
</li> <li><code>"match"</code></li> <li><code>"negate"</code></li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-iptables-module-parameter-table"><strong>table</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>This option specifies the packet matching table on which the command should operate.</p> <p>If the kernel is configured with automatic module loading, an attempt will be made to load the appropriate module for that table if it is not already there.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li>
<code><strong>"filter"</strong></code> <span class="ansible-option-choices-default-mark">← (default)</span>
</li> <li><code>"nat"</code></li> <li><code>"mangle"</code></li> <li><code>"raw"</code></li> <li><code>"security"</code></li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-iptables-module-parameter-tcp-flags"><strong>tcp_flags</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">dictionary</span></p> </div></td> <td><div class="ansible-option-cell">
<p>TCP flags specification.</p> <p><code><strong><a class="reference internal" href="#ansible-collections-ansible-builtin-iptables-module-parameter-tcp-flags"><span class="std std-ref">tcp_flags</span></a></strong></code> expects a dict with the two keys <code>flags</code> and <code>flags_set</code>.</p> </div></td> </tr> <tr>
<td>

<div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-iptables-module-parameter-tcp-flags-flags"><strong>flags</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">list</span> / <span class="ansible-option-elements">elements=string</span></p> </div>
</td> <td>

<div class="ansible-option-cell">
<p>List of flags you want to examine.</p> </div>
</td> </tr> <tr>
<td>

<div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-iptables-module-parameter-tcp-flags-flags-set"><strong>flags_set</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">list</span> / <span class="ansible-option-elements">elements=string</span></p> </div>
</td> <td>

<div class="ansible-option-cell">
<p>Flags to be set.</p> </div>
</td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-iptables-module-parameter-to-destination"><strong>to_destination</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>This specifies a destination address to use with <code>DNAT</code>.</p> <p>Without this, the destination address is never altered.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-iptables-module-parameter-to-ports"><strong>to_ports</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>This specifies a destination port or range of ports to use, without this, the destination port is never altered.</p> <p>This is only valid if the rule also specifies one of the protocol <code>tcp</code>, <code>udp</code>, <code>dccp</code> or <code>sctp</code>.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-iptables-module-parameter-to-source"><strong>to_source</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>This specifies a source address to use with <code>SNAT</code>.</p> <p>Without this, the source address is never altered.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-iptables-module-parameter-uid-owner"><strong>uid_owner</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Specifies the UID or username to use in the match by owner rule.</p> <p>From Ansible 2.6 when the <code>!</code> argument is prepended then the it inverts the rule to apply instead to all users except that one specified.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-iptables-module-parameter-wait"><strong>wait</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> <p><em class="ansible-option-versionadded">added in ansible-base 2.10</em></p> </div></td> <td><div class="ansible-option-cell">
<p>Wait N seconds for the xtables lock to prevent multiple instances of the program from running concurrently.</p> </div></td> </tr>  </table> </section> <section id="attributes"> <h2>Attributes</h2> <table class="longtable ansible-option-table docutils align-default" style="width: 100%"> <thead> <tr>
<th class="head"><p>Attribute</p></th> <th class="head"><p>Support</p></th> <th class="head"><p>Description</p></th> </tr> </thead>  <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-iptables-module-attribute-check-mode"><strong>check_mode</strong></p> 
</div></td> <td><div class="ansible-option-cell">
<p><strong class="ansible-attribute-support-label">Support: </strong><strong class="ansible-attribute-support-full">full</strong></p> </div></td> <td><div class="ansible-option-cell">
<p>Can run in check_mode and return changed status prediction without modifying target, if not supported the action will be skipped.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-iptables-module-attribute-diff-mode"><strong>diff_mode</strong></p> 
</div></td> <td><div class="ansible-option-cell">
<p><strong class="ansible-attribute-support-label">Support: </strong><strong class="ansible-attribute-support-none">none</strong></p> </div></td> <td><div class="ansible-option-cell">
<p>Will return details on what has changed (or possibly needs changing in check_mode), when in diff mode</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-iptables-module-attribute-platform"><strong>platform</strong></p> 
</div></td> <td><div class="ansible-option-cell">
<p><strong class="ansible-attribute-support-property">Platform:</strong> <strong class="ansible-attribute-support-full">linux</strong></p> </div></td> <td><div class="ansible-option-cell">
<p>Target OS/families that can be operated against</p> </div></td> </tr>  </table> </section> <section id="notes"> <h2>Notes</h2> <div class="admonition note"> <p class="admonition-title">Note</p> <ul class="simple"> <li>This module just deals with individual rules. If you need advanced chaining of rules the recommended way is to template the iptables restore file.</li> </ul> </div> </section> <section id="examples"> <h2>Examples</h2> <pre data-language="yaml+jinja">- name: Block specific IP
  ansible.builtin.iptables:
    chain: INPUT
    source: 8.8.8.8
    jump: DROP
  become: yes

- name: Forward port 80 to 8600
  ansible.builtin.iptables:
    table: nat
    chain: PREROUTING
    in_interface: eth0
    protocol: tcp
    match: tcp
    destination_port: 80
    jump: REDIRECT
    to_ports: 8600
    comment: Redirect web traffic to port 8600
  become: yes

- name: Allow related and established connections
  ansible.builtin.iptables:
    chain: INPUT
    ctstate: ESTABLISHED,RELATED
    jump: ACCEPT
  become: yes

- name: Allow new incoming SYN packets on TCP port 22 (SSH)
  ansible.builtin.iptables:
    chain: INPUT
    protocol: tcp
    destination_port: 22
    ctstate: NEW
    syn: match
    jump: ACCEPT
    comment: Accept new SSH connections.

- name: Match on IP ranges
  ansible.builtin.iptables:
    chain: FORWARD
    src_range: 192.168.1.100-192.168.1.199
    dst_range: 10.0.0.1-10.0.0.50
    jump: ACCEPT

- name: Allow source IPs defined in ipset "admin_hosts" on port 22
  ansible.builtin.iptables:
    chain: INPUT
    match_set: admin_hosts
    match_set_flags: src
    destination_port: 22
    jump: ALLOW

- name: Tag all outbound tcp packets with DSCP mark 8
  ansible.builtin.iptables:
    chain: OUTPUT
    jump: DSCP
    table: mangle
    set_dscp_mark: 8
    protocol: tcp

- name: Tag all outbound tcp packets with DSCP DiffServ class CS1
  ansible.builtin.iptables:
    chain: OUTPUT
    jump: DSCP
    table: mangle
    set_dscp_mark_class: CS1
    protocol: tcp

# Create the user-defined chain ALLOWLIST
- iptables:
    chain: ALLOWLIST
    chain_management: true

# Delete the user-defined chain ALLOWLIST
- iptables:
    chain: ALLOWLIST
    chain_management: true
    state: absent

- name: Insert a rule on line 5
  ansible.builtin.iptables:
    chain: INPUT
    protocol: tcp
    destination_port: 8080
    jump: ACCEPT
    action: insert
    rule_num: 5

# Think twice before running following task as this may lock target system
- name: Set the policy for the INPUT chain to DROP
  ansible.builtin.iptables:
    chain: INPUT
    policy: DROP

- name: Reject tcp with tcp-reset
  ansible.builtin.iptables:
    chain: INPUT
    protocol: tcp
    reject_with: tcp-reset
    ip_version: ipv4

- name: Set tcp flags
  ansible.builtin.iptables:
    chain: OUTPUT
    jump: DROP
    protocol: tcp
    tcp_flags:
      flags: ALL
      flags_set:
        - ACK
        - RST
        - SYN
        - FIN

- name: Iptables flush filter
  ansible.builtin.iptables:
    chain: "{{ item }}"
    flush: yes
  with_items:  [ 'INPUT', 'FORWARD', 'OUTPUT' ]

- name: Iptables flush nat
  ansible.builtin.iptables:
    table: nat
    chain: '{{ item }}'
    flush: yes
  with_items: [ 'INPUT', 'OUTPUT', 'PREROUTING', 'POSTROUTING' ]

- name: Log packets arriving into an user-defined chain
  ansible.builtin.iptables:
    chain: LOGGING
    action: append
    state: present
    limit: 2/second
    limit_burst: 20
    log_prefix: "IPTABLES:INFO: "
    log_level: info

- name: Allow connections on multiple ports
  ansible.builtin.iptables:
    chain: INPUT
    protocol: tcp
    destination_ports:
      - "80"
      - "443"
      - "8081:8083"
    jump: ACCEPT
</pre> <section id="authors"> <h3>Authors</h3> <ul class="simple"> <li>Linus Unnebäck (@LinusU)</li> <li>Sébastien DA ROCHA (@sebastiendarocha)</li> </ul> </section> <section id="collection-links"> <h3>Collection links</h3> <ul class="ansible-links"> <li><span><a aria-role="button" class="ansible-link reference external" href="https://github.com/ansible/ansible/issues" rel="noopener external" target="_blank">Issue Tracker</a></span></li> <li><span><a aria-role="button" class="ansible-link reference external" href="https://github.com/ansible/ansible" rel="noopener external" target="_blank">Repository (Sources)</a></span></li> <li><span><a class="reference internal" href="index.html#communication-for-ansible-builtin"><span class="std std-ref">Communication</span></a></span></li> </ul> </section> </section> </section><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2012&ndash;2018 Michael DeHaan<br>&copy; 2018&ndash;2024 Red Hat, Inc.<br>Licensed under the GNU General Public License version 3.<br>
    <a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/iptables_module.html" class="_attribution-link">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/iptables_module.html</a>
  </p>
</div>
