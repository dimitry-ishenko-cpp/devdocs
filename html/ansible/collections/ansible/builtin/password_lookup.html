<section id="ansible-builtin-password-lookup-retrieve-or-generate-a-random-password-stored-in-a-file"> <h1>ansible.builtin.password lookup – retrieve or generate a random password, stored in a file</h1> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This lookup plugin is part of <code>ansible-core</code> and included in all Ansible installations. In most cases, you can use the short plugin name <code>password</code>. However, we recommend you use the <a class="reference internal" href="https://docs.ansible.com/ansible/latest/reference_appendices/glossary.html#term-Fully-Qualified-Collection-Name-FQCN"><span class="xref std std-term">Fully Qualified Collection Name (FQCN)</span></a> <code>ansible.builtin.password</code> for easy linking to the plugin documentation and to avoid conflicting with other collections that may have the same lookup plugin name.</p> </div>  <ul class="simple"> <li><a class="reference internal" href="#synopsis" id="id1">Synopsis</a></li> <li><a class="reference internal" href="#terms" id="id2">Terms</a></li> <li><a class="reference internal" href="#keyword-parameters" id="id3">Keyword parameters</a></li> <li><a class="reference internal" href="#notes" id="id4">Notes</a></li> <li><a class="reference internal" href="#examples" id="id5">Examples</a></li> <li><a class="reference internal" href="#return-value" id="id6">Return Value</a></li> </ul>  <section id="synopsis"> <h2>Synopsis</h2> <ul class="simple"> <li>Generates a random plaintext password and stores it in a file at a given filepath.</li> <li>If the file exists previously, it will retrieve its contents, behaving just like with_file.</li> <li>Usage of variables like <code>"{{ inventory_hostname }}"</code> in the filepath can be used to set up random passwords per host, which simplifies password management in <code>"host_vars"</code> variables.</li> <li>A special case is using /dev/null as a path. The password lookup will generate a new random password each time, but will not write it to /dev/null. This can be used when you need a password without storing it on the controller.</li> </ul> </section> <section id="terms"> <h2>Terms</h2> <table class="longtable ansible-option-table docutils align-default" style="width: 100%"> <thead> <tr>
<th class="head"><p>Parameter</p></th> <th class="head"><p>Comments</p></th> </tr> </thead>  <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-password-lookup-parameter-terms"><strong>Terms</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span> / <span class="ansible-option-required">required</span></p> </div></td> <td><div class="ansible-option-cell">
<p>path to the file that stores/will store the passwords</p> </div></td> </tr>  </table> </section> <section id="keyword-parameters"> <h2>Keyword parameters</h2> <p>This describes keyword parameters of the lookup. These are the values <code>key1=value1</code>, <code>key2=value2</code> and so on in the following examples: <code>lookup('ansible.builtin.password', key1=value1, key2=value2, ...)</code> and <code>query('ansible.builtin.password', key1=value1, key2=value2, ...)</code></p> <table class="longtable ansible-option-table docutils align-default" style="width: 100%"> <thead> <tr>
<th class="head"><p>Parameter</p></th> <th class="head"><p>Comments</p></th> </tr> </thead>  <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-password-lookup-parameter-chars"><strong>chars</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">list</span> / <span class="ansible-option-elements">elements=string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>A list of names that compose a custom character set in the generated passwords.</p> <p>This parameter defines the possible character sets in the resulting password, not the required character sets. If you want to require certain character sets for passwords, you can use the <a class="reference internal" href="../../community/general/random_string_lookup.html#ansible-collections-community-general-random-string-lookup"><span class="std std-ref">community.general.random_string</span></a> lookup plugin.</p> <p>By default generated passwords contain a random mix of upper and lowercase ASCII letters, the numbers 0-9, and punctuation (”. , : - _”).</p> <p>They can be either parts of Python’s string module attributes or represented literally ( :, -).</p> <p>Though string modules can vary by Python version, valid values for both major releases include: ‘ascii_lowercase’, ‘ascii_uppercase’, ‘digits’, ‘hexdigits’, ‘octdigits’, ‘printable’, ‘punctuation’ and ‘whitespace’.</p> <p>Be aware that Python’s ‘hexdigits’ includes lower and upper case versions of a-f, so it is not a good choice as it doubles the chances of those values for systems that won’t distinguish case, distorting the expected entropy.</p> <p>when using a comma separated string, to enter comma use two commas ‘,,’ somewhere - preferably at the end. Quotes and double quotes are not supported.</p> <p class="ansible-option-line"><strong class="ansible-option-default-bold">Default:</strong> <code>["ascii_letters", "digits", ".,:-_"]</code></p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-password-lookup-parameter-encrypt"><strong>encrypt</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Which hash scheme to encrypt the returning password, should be one hash scheme from <code>passlib.hash</code>; <code>md5_crypt</code>, <code>bcrypt</code>, <code>sha256_crypt</code>, <code>sha512_crypt</code>.</p> <p>If not provided, the password will be returned in plain text.</p> <p>Note that the password is always stored as plain text, only the returning password is encrypted.</p> <p>Encrypt also forces saving the salt value for idempotence.</p> <p>Note that before 2.6 this option was incorrectly labeled as a boolean for a long time.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-password-lookup-parameter-ident"><strong>ident</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> <p><em class="ansible-option-versionadded">added in ansible-core 2.12</em></p> </div></td> <td><div class="ansible-option-cell">
<p>Specify version of Bcrypt algorithm to be used while using <code><strong><a class="reference internal" href="#ansible-collections-ansible-builtin-password-lookup-parameter-encrypt"><span class="std std-ref">encrypt</span></a></strong></code> as <code>bcrypt</code>.</p> <p>The parameter is only available for <code>bcrypt</code> - <a class="reference external" href="https://passlib.readthedocs.io/en/stable/lib/passlib.hash.bcrypt.html#passlib.hash.bcrypt">https://passlib.readthedocs.io/en/stable/lib/passlib.hash.bcrypt.html#passlib.hash.bcrypt</a>.</p> <p>Other hash types will simply ignore this parameter.</p> <p>Valid values for this parameter are: <code>2</code>, <code>2a</code>, <code>2y</code>, <code>2b</code>.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-password-lookup-parameter-length"><strong>length</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">integer</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The length of the generated password.</p> <p class="ansible-option-line"><strong class="ansible-option-default-bold">Default:</strong> <code>20</code></p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-password-lookup-parameter-seed"><strong>seed</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> <p><em class="ansible-option-versionadded">added in ansible-core 2.12</em></p> </div></td> <td><div class="ansible-option-cell">
<p>A seed to initialize the random number generator.</p> <p>Identical seeds will yield identical passwords.</p> <p>Use this for random-but-idempotent password generation.</p> </div></td> </tr>  </table> </section> <section id="notes"> <h2>Notes</h2> <div class="admonition note"> <p class="admonition-title">Note</p> <ul class="simple"> <li>When keyword and positional parameters are used together, positional parameters must be listed before keyword parameters: <code>lookup('ansible.builtin.password', term1, term2, key1=value1, key2=value2)</code> and <code>query('ansible.builtin.password', term1, term2, key1=value1, key2=value2)</code>
</li> <li>A great alternative to the password lookup plugin, if you don’t need to generate random passwords on a per-host basis, would be to use Vault in playbooks. Read the documentation there and consider using it first, it will be more desirable for most applications.</li> <li>If the file already exists, no data will be written to it. If the file has contents, those contents will be read in as the password. Empty files cause the password to return as an empty string.</li> <li>As all lookups, this runs on the Ansible host as the user running the playbook, and “become” does not apply, the target file must be readable by the playbook user, or, if it does not exist, the playbook user must have sufficient privileges to create it. (So, for example, attempts to write into areas such as /etc will fail unless the entire playbook is being run as root).</li> </ul> </div> </section> <section id="examples"> <h2>Examples</h2> <pre data-language="yaml+jinja">- name: create a mysql user with a random password
  community.mysql.mysql_user:
    name: "{{ client }}"
    password: "{{ lookup('ansible.builtin.password', 'credentials/' + client + '/' + tier + '/' + role + '/mysqlpassword', length=15) }}"
    priv: "{{ client }}_{{ tier }}_{{ role }}.*:ALL"

- name: create a mysql user with a random password using only ascii letters
  community.mysql.mysql_user:
    name: "{{ client }}"
    password: "{{ lookup('ansible.builtin.password', '/tmp/passwordfile', chars=['ascii_letters']) }}"
    priv: '{{ client }}_{{ tier }}_{{ role }}.*:ALL'

- name: create a mysql user with an 8 character random password using only digits
  community.mysql.mysql_user:
    name: "{{ client }}"
    password: "{{ lookup('ansible.builtin.password', '/tmp/passwordfile', length=8, chars=['digits']) }}"
    priv: "{{ client }}_{{ tier }}_{{ role }}.*:ALL"

- name: create a mysql user with a random password using many different char sets
  community.mysql.mysql_user:
    name: "{{ client }}"
    password: "{{ lookup('ansible.builtin.password', '/tmp/passwordfile', chars=['ascii_letters', 'digits', 'punctuation']) }}"
    priv: "{{ client }}_{{ tier }}_{{ role }}.*:ALL"

- name: create lowercase 8 character name for Kubernetes pod name
  ansible.builtin.set_fact:
    random_pod_name: "web-{{ lookup('ansible.builtin.password', '/dev/null', chars=['ascii_lowercase', 'digits'], length=8) }}"

- name: create random but idempotent password
  ansible.builtin.set_fact:
    password: "{{ lookup('ansible.builtin.password', '/dev/null', seed=inventory_hostname) }}"
</pre> </section> <section id="return-value"> <h2>Return Value</h2> <table class="longtable ansible-option-table docutils align-default" style="width: 100%"> <thead> <tr>
<th class="head"><p>Key</p></th> <th class="head"><p>Description</p></th> </tr> </thead>  <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-password-lookup-return-raw"><strong>Return value</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">list</span> / <span class="ansible-option-elements">elements=string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>a password</p> <p class="ansible-option-line"><strong class="ansible-option-returned-bold">Returned:</strong> success</p> </div></td> </tr>  </table> <section id="authors"> <h3>Authors</h3> <ul class="simple"> <li>Daniel Hokka Zakrisson</li> <li>Javier Candeira</li> <li>Maykel Moya</li> </ul> <div class="admonition hint"> <p class="admonition-title">Hint</p> <p>Configuration entries for each entry type have a low to high priority order. For example, a variable that is lower in the list will override a variable that is higher up.</p> </div> </section> <section id="collection-links"> <h3>Collection links</h3> <ul class="ansible-links"> <li><span><a aria-role="button" class="ansible-link reference external" href="https://github.com/ansible/ansible/issues" rel="noopener external" target="_blank">Issue Tracker</a></span></li> <li><span><a aria-role="button" class="ansible-link reference external" href="https://github.com/ansible/ansible" rel="noopener external" target="_blank">Repository (Sources)</a></span></li> <li><span><a class="reference internal" href="index.html#communication-for-ansible-builtin"><span class="std std-ref">Communication</span></a></span></li> </ul> </section> </section> </section><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2012&ndash;2018 Michael DeHaan<br>&copy; 2018&ndash;2024 Red Hat, Inc.<br>Licensed under the GNU General Public License version 3.<br>
    <a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/password_lookup.html" class="_attribution-link">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/password_lookup.html</a>
  </p>
</div>
