<h1 id="ansible-builtin-shell-execute-shell-commands-on-targets">ansible.builtin.shell – Execute shell commands on targets</h1> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This module is part of <code>ansible-core</code> and included in all Ansible installations. In most cases, you can use the short module name <code>shell</code> even without specifying the <code>collections:</code> keyword. However, we recommend you use the FQCN for easy linking to the module documentation and to avoid conflicting with other collections that may have the same module name.</p> </div> <div class="versionadded"> <p><span class="versionmodified added">New in version 0.2: </span>of ansible.builtin</p> </div>  <ul class="simple"> <li><a class="reference internal" href="#synopsis" id="id1">Synopsis</a></li> <li><a class="reference internal" href="#parameters" id="id2">Parameters</a></li> <li><a class="reference internal" href="#notes" id="id3">Notes</a></li> <li><a class="reference internal" href="#see-also" id="id4">See Also</a></li> <li><a class="reference internal" href="#examples" id="id5">Examples</a></li> <li><a class="reference internal" href="#return-values" id="id6">Return Values</a></li> </ul>   <h2 id="synopsis">Synopsis</h2> <ul class="simple"> <li>The <code>shell</code> module takes the command name followed by a list of space-delimited arguments.</li> <li>Either a free form command or <code>cmd</code> parameter is required, see the examples.</li> <li>It is almost exactly like the <a class="reference internal" href="command_module.html#ansible-collections-ansible-builtin-command-module"><span class="std std-ref">ansible.builtin.command</span></a> module but runs the command through a shell (<code>/bin/sh</code>) on the remote node.</li> <li>For Windows targets, use the <a class="reference internal" href="../windows/win_shell_module.html#ansible-collections-ansible-windows-win-shell-module"><span class="std std-ref">ansible.windows.win_shell</span></a> module instead.</li> </ul> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This module has a corresponding <a class="reference internal" href="../../../plugins/action.html#action-plugins"><span class="std std-ref">action plugin</span></a>.</p> </div>   <h2 id="parameters">Parameters</h2> <table class="documentation-table"> <tr> <th colspan="1">Parameter</th> <th>Choices/Defaults</th> <th width="100%">Comments</th> </tr> <tr> <td colspan="1">  <b>chdir</b>  <div> <span>path</span> </div> <div> added in 0.6 of ansible.builtin </div> </td> <td> </td> <td> <div>Change into this directory before running the command.</div> </td> </tr> <tr> <td colspan="1">  <b>cmd</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The command to run followed by optional arguments.</div> </td> </tr> <tr> <td colspan="1">  <b>creates</b>  <div> <span>path</span> </div> </td> <td> </td> <td> <div>A filename, when it already exists, this step will <b>not</b> be run.</div> </td> </tr> <tr> <td colspan="1">  <b>executable</b>  <div> <span>path</span> </div> <div> added in 0.9 of ansible.builtin </div> </td> <td> </td> <td> <div>Change the shell used to execute the command.</div> <div>This expects an absolute path to the executable.</div> </td> </tr> <tr> <td colspan="1">  <b>free_form</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The shell module takes a free form command to run, as a string.</div> <div>There is no actual parameter named 'free form'.</div> <div>See the examples on how to use this module.</div> </td> </tr> <tr> <td colspan="1">  <b>removes</b>  <div> <span>path</span> </div> <div> added in 0.8 of ansible.builtin </div> </td> <td> </td> <td> <div>A filename, when it does not exist, this step will <b>not</b> be run.</div> </td> </tr> <tr> <td colspan="1">  <b>stdin</b>  <div> <span>string</span> </div> <div> added in 2.4 of ansible.builtin </div> </td> <td> </td> <td> <div>Set the stdin of the command directly to the specified value.</div> </td> </tr> <tr> <td colspan="1">  <b>stdin_add_newline</b>  <div> <span>boolean</span> </div> <div> added in 2.8 of ansible.builtin </div> </td> <td> <ul>
<b>Choices:</b> <li>no</li> <li><div>
<b>yes</b> ←</div></li> </ul> </td> <td> <div>Whether to append a newline to stdin data.</div> </td> </tr> <tr> <td colspan="1">  <b>warn</b>  <div> <span>boolean</span> </div> <div> added in 1.8 of ansible.builtin </div> </td> <td> <ul>
<b>Choices:</b> <li>no</li> <li><div>
<b>yes</b> ←</div></li> </ul> </td> <td> <div>Whether to enable task warnings.</div> </td> </tr> </table> <br>  <h2 id="notes">Notes</h2> <div class="admonition note"> <p class="admonition-title">Note</p> <ul class="simple"> <li>If you want to execute a command securely and predictably, it may be better to use the <a class="reference internal" href="command_module.html#ansible-collections-ansible-builtin-command-module"><span class="std std-ref">ansible.builtin.command</span></a> module instead. Best practices when writing playbooks will follow the trend of using <a class="reference internal" href="command_module.html#ansible-collections-ansible-builtin-command-module"><span class="std std-ref">ansible.builtin.command</span></a> unless the <a class="reference internal" href="#ansible-collections-ansible-builtin-shell-module"><span class="std std-ref">ansible.builtin.shell</span></a> module is explicitly required. When running ad-hoc commands, use your best judgement.</li> <li>Check mode is supported when passing <code>creates</code> or <code>removes</code>. If running in check mode and either of these are specified, the module will check for the existence of the file and report the correct changed status. If these are not supplied, the task will be skipped.</li> <li>To sanitize any variables passed to the shell module, you should use <code>{{ var | quote }}</code> instead of just <code>{{ var }}</code> to make sure they do not include evil things like semicolons.</li> <li>An alternative to using inline shell scripts with this module is to use the <a class="reference internal" href="script_module.html#ansible-collections-ansible-builtin-script-module"><span class="std std-ref">ansible.builtin.script</span></a> module possibly together with the <a class="reference internal" href="template_module.html#ansible-collections-ansible-builtin-template-module"><span class="std std-ref">ansible.builtin.template</span></a> module.</li> <li>For rebooting systems, use the <a class="reference internal" href="reboot_module.html#ansible-collections-ansible-builtin-reboot-module"><span class="std std-ref">ansible.builtin.reboot</span></a> or <a class="reference internal" href="../windows/win_reboot_module.html#ansible-collections-ansible-windows-win-reboot-module"><span class="std std-ref">ansible.windows.win_reboot</span></a> module.</li> </ul> </div>   <h2 id="see-also">See Also</h2> <div class="admonition seealso"> <p class="admonition-title">See also</p> <dl class="simple"> <dt><a class="reference internal" href="command_module.html#ansible-collections-ansible-builtin-command-module"><span class="std std-ref">ansible.builtin.command</span></a></dt>
<dd>
<p>The official documentation on the <strong>ansible.builtin.command</strong> module.</p> </dd> <dt><a class="reference internal" href="raw_module.html#ansible-collections-ansible-builtin-raw-module"><span class="std std-ref">ansible.builtin.raw</span></a></dt>
<dd>
<p>The official documentation on the <strong>ansible.builtin.raw</strong> module.</p> </dd> <dt><a class="reference internal" href="script_module.html#ansible-collections-ansible-builtin-script-module"><span class="std std-ref">ansible.builtin.script</span></a></dt>
<dd>
<p>The official documentation on the <strong>ansible.builtin.script</strong> module.</p> </dd> <dt><a class="reference internal" href="../windows/win_shell_module.html#ansible-collections-ansible-windows-win-shell-module"><span class="std std-ref">ansible.windows.win_shell</span></a></dt>
<dd>
<p>The official documentation on the <strong>ansible.windows.win_shell</strong> module.</p> </dd> </dl> </div>   <h2 id="examples">Examples</h2> <pre data-language="yaml+jinja">- name: Execute the command in remote shell; stdout goes to the specified file on the remote
  ansible.builtin.shell: somescript.sh &gt;&gt; somelog.txt

- name: Change the working directory to somedir/ before executing the command
  ansible.builtin.shell: somescript.sh &gt;&gt; somelog.txt
  args:
    chdir: somedir/

# You can also use the 'args' form to provide the options.
- name: This command will change the working directory to somedir/ and will only run when somedir/somelog.txt doesn't exist
  ansible.builtin.shell: somescript.sh &gt;&gt; somelog.txt
  args:
    chdir: somedir/
    creates: somelog.txt

# You can also use the 'cmd' parameter instead of free form format.
- name: This command will change the working directory to somedir/
  ansible.builtin.shell:
    cmd: ls -l | grep log
    chdir: somedir/

- name: Run a command that uses non-posix shell-isms (in this example /bin/sh doesn't handle redirection and wildcards together but bash does)
  ansible.builtin.shell: cat &lt; /tmp/*txt
  args:
    executable: /bin/bash

- name: Run a command using a templated variable (always use quote filter to avoid injection)
  ansible.builtin.shell: cat {{ myfile|quote }}

# You can use shell to run other executables to perform actions inline
- name: Run expect to wait for a successful PXE boot via out-of-band CIMC
  ansible.builtin.shell: |
    set timeout 300
    spawn ssh admin@{{ cimc_host }}

    expect "password:"
    send "{{ cimc_password }}\n"

    expect "\n{{ cimc_name }}"
    send "connect host\n"

    expect "pxeboot.n12"
    send "\n"

    exit 0
  args:
    executable: /usr/bin/expect
  delegate_to: localhost

# Disabling warnings
- name: Using curl to connect to a host via SOCKS proxy (unsupported in uri). Ordinarily this would throw a warning
  ansible.builtin.shell: curl --socks5 localhost:9000 http://www.ansible.com
  args:
    warn: no
</pre>   <h2 id="return-values">Return Values</h2> <p>Common return values are documented <a class="reference internal" href="../../../reference_appendices/common_return_values.html#common-return-values"><span class="std std-ref">here</span></a>, the following are the fields unique to this module:</p> <table class="documentation-table"> <tr> <th colspan="1">Key</th> <th>Returned</th> <th width="100%">Description</th> </tr> <tr> <td colspan="1">  <b>cmd</b>  <div> <span>string</span> </div> </td> <td>always</td> <td> <div>The command executed by the task.</div> <br> <div><b>Sample:</b></div> <div>rabbitmqctl join_cluster rabbit@master</div> </td> </tr> <tr> <td colspan="1">  <b>delta</b>  <div> <span>string</span> </div> </td> <td>always</td> <td> <div>The command execution delta time.</div> <br> <div><b>Sample:</b></div> <div>0:00:00.325771</div> </td> </tr> <tr> <td colspan="1">  <b>end</b>  <div> <span>string</span> </div> </td> <td>always</td> <td> <div>The command execution end time.</div> <br> <div><b>Sample:</b></div> <div>2016-02-25 09:18:26.755339</div> </td> </tr> <tr> <td colspan="1">  <b>msg</b>  <div> <span>boolean</span> </div> </td> <td>always</td> <td> <div>changed</div> <br> <div><b>Sample:</b></div> <div>True</div> </td> </tr> <tr> <td colspan="1">  <b>rc</b>  <div> <span>integer</span> </div> </td> <td>always</td> <td> <div>The command return code (0 means success).</div> <br> </td> </tr> <tr> <td colspan="1">  <b>start</b>  <div> <span>string</span> </div> </td> <td>always</td> <td> <div>The command execution start time.</div> <br> <div><b>Sample:</b></div> <div>2016-02-25 09:18:26.429568</div> </td> </tr> <tr> <td colspan="1">  <b>stderr</b>  <div> <span>string</span> </div> </td> <td>always</td> <td> <div>The command standard error.</div> <br> <div><b>Sample:</b></div> <div>ls: cannot access foo: No such file or directory</div> </td> </tr> <tr> <td colspan="1">  <b>stderr_lines</b>  <div> <span>list</span> / <span>elements=string</span> </div> </td> <td>always</td> <td> <div>The command standard error split in lines.</div> <br> <div><b>Sample:</b></div> <div>[{"u'ls cannot access foo": "No such file or directory'"}, "u'ls …'"]</div> </td> </tr> <tr> <td colspan="1">  <b>stdout</b>  <div> <span>string</span> </div> </td> <td>always</td> <td> <div>The command standard output.</div> <br> <div><b>Sample:</b></div> <div>Clustering node rabbit@slave1 with rabbit@master …</div> </td> </tr> <tr> <td colspan="1">  <b>stdout_lines</b>  <div> <span>list</span> / <span>elements=string</span> </div> </td> <td>always</td> <td> <div>The command standard output split in lines.</div> <br> <div><b>Sample:</b></div> <div>["u'Clustering node rabbit@slave1 with rabbit@master …'"]</div> </td> </tr> </table> <br><br> <h3 id="authors">Authors</h3> <ul class="simple"> <li>Ansible Core Team</li> <li>Michael DeHaan</li> </ul><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2012&ndash;2018 Michael DeHaan<br>&copy; 2018&ndash;2021 Red Hat, Inc.<br>Licensed under the GNU General Public License version 3.<br>
    <a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/shell_module.html" class="_attribution-link">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/shell_module.html</a>
  </p>
</div>
