<section id="microsoft-ad-ldap-inventory-inventory-plugin-for-active-directory"> <h1>microsoft.ad.ldap inventory – Inventory plugin for Active Directory</h1> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This inventory plugin is part of the <a class="reference external" href="https://galaxy.ansible.com/ui/repo/published/microsoft/ad/">microsoft.ad collection</a> (version 1.7.1).</p> <p>You might already have this collection installed if you are using the <code>ansible</code> package. It is not included in <code>ansible-core</code>. To check whether it is installed, run <code>ansible-galaxy collection list</code>.</p> <p>To install it, use: <code>ansible-galaxy collection install microsoft.ad</code>. You need further requirements to be able to use this inventory plugin, see <a class="reference internal" href="#ansible-collections-microsoft-ad-ldap-inventory-requirements"><span class="std std-ref">Requirements</span></a> for details.</p> <p>To use it in a playbook, specify: <code>microsoft.ad.ldap</code>.</p> </div> <p class="ansible-version-added">New in microsoft.ad 1.1.0</p>  <ul class="simple"> <li><a class="reference internal" href="#synopsis" id="id1">Synopsis</a></li> <li><a class="reference internal" href="#requirements" id="id2">Requirements</a></li> <li><a class="reference internal" href="#parameters" id="id3">Parameters</a></li> <li><a class="reference internal" href="#notes" id="id4">Notes</a></li> <li><a class="reference internal" href="#examples" id="id5">Examples</a></li> </ul>  <section id="synopsis"> <h2>Synopsis</h2> <ul class="simple"> <li>Inventory plugin for Active Directory or other LDAP sources.</li> <li>Uses a YAML configuration file that ends with <code>microsoft.ad.ldap.{yml|yaml}</code>.</li> <li>Each host that is added will set the <code>inventory_hostname</code> to the <code>name</code> of the LDAP computer object and <code>ansible_host</code> to the value of the <code>dNSHostName</code> LDAP attribute if set. If the <code>dNSHostName</code> attribute is not set on the computer object then <code>ansible_host</code> is not set. See <a class="reference internal" href="docsite/guide_ldap_inventory.html#ansible-collections-microsoft-ad-docsite-guide-ldap-inventory-inventory-hostname"><span class="std std-ref">LDAP inventory hostname</span></a> for more information on how these values are set and how to adjust them.</li> <li>The host fact <code>microsoft_ad_distinguished_name</code> will also be set to the distinguished name of the host that was used to derive the host entry.</li> <li>Any other fact that is needed, needs to be defined in the <em>attributes</em> option.</li> </ul> </section> <section id="requirements"> <h2 id="ansible-collections-microsoft-ad-ldap-inventory-requirements">Requirements</h2> <p>The below requirements are needed on the local controller node that executes this inventory.</p> <ul class="simple"> <li>dnspython - For option server lookup support</li> <li>pyspnego &gt;= 0.8.0</li> <li>pyspnego[kerberos] - For Kerberos and server lookup support</li> <li>sansldap</li> <li>dpapi-ng - For LAPS decryption support</li> </ul> </section> <section id="parameters"> <h2>Parameters</h2> <table class="longtable ansible-option-table docutils align-default" style="width: 100%"> <thead> <tr>
<th class="head"><p>Parameter</p></th> <th class="head"><p>Comments</p></th> </tr> </thead>  <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-ldap-inventory-parameter-attributes"><strong>attributes</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">dictionary</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The LDAP attributes to retrieve.</p> <p>The keys specified are the LDAP attributes requested and the values for each attribute is a dictionary that reflects what host var to set it to and how.</p> <p>Each key of the inner dictionary value is the host variable name to set and the value is the template to use to derive the value. If no value is explicitly set then it will use the coerced value as returned from the LDAP attribute.</p> <p>Attributes that are denoted as single value in the LDAP schema are returned as that single value, multi valued attributes are returned as a list of values.</p> <p>See <a class="reference internal" href="docsite/guide_ldap_inventory.html#ansible-collections-microsoft-ad-docsite-guide-ldap-inventory-attributes"><span class="std std-ref">LDAP inventory attributes</span></a> for more information.</p> <p class="ansible-option-line"><strong class="ansible-option-default-bold">Default:</strong> <code>{}</code></p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-ldap-inventory-parameter-auth-protocol"><strong>auth_protocol</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The authentication protocol to use when connecting to the LDAP host.</p> <p>Defaults to <code>certificate</code> if LDAPS/StartTLS is used and <em>certificate</em> has been specified. Otherwise it defaults to <code>negotiate</code>.</p> <p><code>simple</code> is simple authentication where the user and password are sent in plaintext. It does not support any encryption so either must be used with LDAPS, or StartTLS. If using over a plaintext LDAP connection without TLS, <code>encrypt=False</code> must be specified to explicitly opt into no encryption.</p> <p><code>certificate</code> is TLS client certificate authentication. It can only be used with LDAPS or StartTLS. See <em>certificate</em> for more information on how to specify the client certificate used for authentication.</p> <p><code>negotiate</code> will attempt to negotiate Kerberos authentication with a fallback to NTLM. If Kerberos is available the Kerberos credential cache can be used if no username or password is specified.</p> <p><code>kerberos</code> will use Kerberos authentication with no NTLM fallback.</p> <p><code>ntlm</code> will use NTLM authentication with no Kerberos attempt.</p> <p><code>negotiate</code>, <code>kerberos</code>, and <code>ntlm</code> support encryption over LDAP.</p> <p>Kerberos support requires the <code>pyspnego[kerberos]</code> extras to be installed.</p> <p>See <a class="reference internal" href="docsite/guide_ldap_connection.html#ansible-collections-microsoft-ad-docsite-guide-ldap-connection-authentication"><span class="std std-ref">LDAP authentication</span></a> for more information.</p> <p>This option can be set using a Jinja2 template value.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li><code>"simple"</code></li> <li><code>"certificate"</code></li> <li><code>"negotiate"</code></li> <li><code>"kerberos"</code></li> <li><code>"ntlm"</code></li> </ul> <p class="ansible-option-line"><strong class="ansible-option-configuration">Configuration:</strong></p> <ul class="simple"> <li>Environment variable: <a class="reference internal" href="../../environment_variables.html#envvar-MICROSOFT_AD_LDAP_AUTH_PROTOCOL" id="index-0"><code>MICROSOFT_AD_LDAP_AUTH_PROTOCOL</code></a>
</li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-ldap-inventory-parameter-ca-cert"><strong>ca_cert</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Can be the path to a CA certificate PEM or DER file, directory of PEM certificates, or the CA certificate PEM string that is used for certificate validation.</p> <p>If omitted, the default CA store used for validation is dependent on the current Python settings.</p> <p>This option can be set using a Jinja2 template value.</p> <p class="ansible-option-line"><strong class="ansible-option-configuration">Configuration:</strong></p> <ul class="simple"> <li>Environment variable: <a class="reference internal" href="../../environment_variables.html#envvar-MICROSOFT_AD_LDAP_CA_CERT" id="index-1"><code>MICROSOFT_AD_LDAP_CA_CERT</code></a>
</li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-ldap-inventory-parameter-cert-validation"><strong>cert_validation</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The certificate validation behaviour when using a TLS connection.</p> <p>This can be set to <code>always</code>, <code>ignore</code>, <code>ignore_hostname</code>.</p> <p><code>always</code> will perform certificate hostname and CA validation.</p> <p><code>ignore</code> will ignore any certificate errors.</p> <p><code>ignore_hostname</code> will validate the CA trust chain but will ignore any hostname checks performed by TLS.</p> <p>See <a class="reference internal" href="docsite/guide_ldap_connection.html#ansible-collections-microsoft-ad-docsite-guide-ldap-connection-cert-validation"><span class="std std-ref">Certificate validation</span></a> for more information.</p> <p>This option can be set using a Jinja2 template value.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li>
<code><strong>"always"</strong></code> <span class="ansible-option-choices-default-mark">← (default)</span>
</li> <li><code>"ignore"</code></li> <li><code>"ignore_hostname"</code></li> </ul> <p class="ansible-option-line"><strong class="ansible-option-configuration">Configuration:</strong></p> <ul class="simple"> <li>Environment variable: <a class="reference internal" href="../../environment_variables.html#envvar-MICROSOFT_AD_LDAP_CERT_VALIDATION" id="index-2"><code>MICROSOFT_AD_LDAP_CERT_VALIDATION</code></a>
</li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-ldap-inventory-parameter-certificate"><strong>certificate</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The certificate or certificate with key bundle that is used for certificate authentication.</p> <p>The value can either be a path to a file containing the certificate or string of the PEM encoded certificate.</p> <p>If using a path to a certificate file, the file can be a PEM encoded certificate, a PEM encoded certificate and key bundle, a DER encoded certificate, or a PFX/PKCS12 encoded certificate and key bundle.</p> <p>Use <em>certificate_key</em> if the certificate specified does not contain the key.</p> <p>Use <em>certificate_password</em> if the key is encrypted with a password.</p> <p>This option can be set using a Jinja2 template value.</p> <p class="ansible-option-line"><strong class="ansible-option-configuration">Configuration:</strong></p> <ul class="simple"> <li>Environment variable: <a class="reference internal" href="../../environment_variables.html#envvar-MICROSOFT_AD_LDAP_CERTIFICATE" id="index-3"><code>MICROSOFT_AD_LDAP_CERTIFICATE</code></a>
</li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-ldap-inventory-parameter-certificate-key"><strong>certificate_key</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The certificate key that is used for certificate authentication.</p> <p>The value can either be a path to a file containing the key in the PEM or DER encoded form, or it can be the string of a PEM encoded key.</p> <p>Use <em>certificate_password</em> if the key is encrypted with a password.</p> <p>This option can be set using a Jinja2 template value.</p> <p class="ansible-option-line"><strong class="ansible-option-configuration">Configuration:</strong></p> <ul class="simple"> <li>Environment variable: <a class="reference internal" href="../../environment_variables.html#envvar-MICROSOFT_AD_LDAP_CERTIFICATE_KEY" id="index-4"><code>MICROSOFT_AD_LDAP_CERTIFICATE_KEY</code></a>
</li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-ldap-inventory-parameter-certificate-password"><strong>certificate_password</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The password used to decrypt the certificate key specified by <em>certificate</em> or <em>certificate_key</em>.</p> <p>This option can be set using a Jinja2 template value.</p> <p class="ansible-option-line"><strong class="ansible-option-configuration">Configuration:</strong></p> <ul class="simple"> <li>Environment variable: <a class="reference internal" href="../../environment_variables.html#envvar-MICROSOFT_AD_LDAP_CERTIFICATE_PASSWORD" id="index-5"><code>MICROSOFT_AD_LDAP_CERTIFICATE_PASSWORD</code></a>
</li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-ldap-inventory-parameter-compose"><strong>compose</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">dictionary</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Create vars from jinja2 expressions.</p> <p class="ansible-option-line"><strong class="ansible-option-default-bold">Default:</strong> <code>{}</code></p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-ldap-inventory-parameter-connection-timeout"><strong>connection_timeout</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">integer</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The timeout in seconds to wait until the connection is established before failing.</p> <p>This option can be set using a Jinja2 template value.</p> <p class="ansible-option-line"><strong class="ansible-option-default-bold">Default:</strong> <code>5</code></p> <p class="ansible-option-line"><strong class="ansible-option-configuration">Configuration:</strong></p> <ul class="simple"> <li>Environment variable: <a class="reference internal" href="../../environment_variables.html#envvar-MICROSOFT_AD_LDAP_CONNECTION_TIMEOUT" id="index-6"><code>MICROSOFT_AD_LDAP_CONNECTION_TIMEOUT</code></a>
</li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-ldap-inventory-parameter-encrypt"><strong>encrypt</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">boolean</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Whether encryption is required for the connection.</p> <p>Encryption can either be performed using the authentication protocol or through TLS.</p> <p>The <em>auth_protocol</em> <code>negotiate</code>, <code>kerberos</code>, and <code>ntlm</code> all support encryption over LDAP whereas <code>simple</code> does not.</p> <p>If using <code>auth_protocol=simple</code> over LDAP without TLS then this must be set to <code>False</code>. As no encryption is used, all traffic will be in plaintext and should be avoided.</p> <p>This option can be set using a Jinja2 template value.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li><code>false</code></li> <li>
<code><strong>true</strong></code> <span class="ansible-option-choices-default-mark">← (default)</span>
</li> </ul> <p class="ansible-option-line"><strong class="ansible-option-configuration">Configuration:</strong></p> <ul class="simple"> <li>Environment variable: <a class="reference internal" href="../../environment_variables.html#envvar-MICROSOFT_AD_LDAP_ENCRYPT" id="index-7"><code>MICROSOFT_AD_LDAP_ENCRYPT</code></a>
</li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-ldap-inventory-parameter-filter"><strong>filter</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The LDAP filter string used to query the computer objects.</p> <p>By default, this will be combined with the filter “(objectCategory=computer)”. Use <em>filter_without_computer</em> to override this behavior and have <em>filter</em> be the only filter used.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-ldap-inventory-parameter-filter-without-computer"><strong>filter_without_computer</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">boolean</span></p> <p><em class="ansible-option-versionadded">added in microsoft.ad 1.3.0</em></p> </div></td> <td><div class="ansible-option-cell">
<p>Will not combine the <em>filter</em> value with the default filter “(objectCategory=computer)”.</p> <p>In most cases this should be <code>false</code> but can be set to <code>true</code> to have the <em>filter</em> value specified be the only filter used.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li>
<code><strong>false</strong></code> <span class="ansible-option-choices-default-mark">← (default)</span>
</li> <li><code>true</code></li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-ldap-inventory-parameter-groups"><strong>groups</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">dictionary</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Add hosts to group based on Jinja2 conditionals.</p> <p class="ansible-option-line"><strong class="ansible-option-default-bold">Default:</strong> <code>{}</code></p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-ldap-inventory-parameter-keyed-groups"><strong>keyed_groups</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">list</span> / <span class="ansible-option-elements">elements=dictionary</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Add hosts to group based on the values of a variable.</p> <p class="ansible-option-line"><strong class="ansible-option-default-bold">Default:</strong> <code>[]</code></p> </div></td> </tr> <tr>
<td>

<div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-ldap-inventory-parameter-keyed-groups-default-value"><strong>default_value</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> <p><em class="ansible-option-versionadded">added in ansible-core 2.12</em></p> </div>
</td> <td>

<div class="ansible-option-cell">
<p>The default value when the host variable’s value is an empty string.</p> <p>This option is mutually exclusive with <code><strong><a class="reference internal" href="#ansible-collections-microsoft-ad-ldap-inventory-parameter-keyed-groups-trailing-separator"><span class="std std-ref">keyed_groups[].trailing_separator</span></a></strong></code>.</p> </div>
</td> </tr> <tr>
<td>

<div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-ldap-inventory-parameter-keyed-groups-key"><strong>key</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div>
</td> <td>

<div class="ansible-option-cell">
<p>The key from input dictionary used to generate groups</p> </div>
</td> </tr> <tr>
<td>

<div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-ldap-inventory-parameter-keyed-groups-parent-group"><strong>parent_group</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div>
</td> <td>

<div class="ansible-option-cell">
<p>parent group for keyed group</p> </div>
</td> </tr> <tr>
<td>

<div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-ldap-inventory-parameter-keyed-groups-prefix"><strong>prefix</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div>
</td> <td>

<div class="ansible-option-cell">
<p>A keyed group name will start with this prefix</p> <p class="ansible-option-line"><strong class="ansible-option-default-bold">Default:</strong> <code>""</code></p> </div>
</td> </tr> <tr>
<td>

<div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-ldap-inventory-parameter-keyed-groups-separator"><strong>separator</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div>
</td> <td>

<div class="ansible-option-cell">
<p>separator used to build the keyed group name</p> <p class="ansible-option-line"><strong class="ansible-option-default-bold">Default:</strong> <code>"_"</code></p> </div>
</td> </tr> <tr>
<td>

<div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-ldap-inventory-parameter-keyed-groups-trailing-separator"><strong>trailing_separator</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">boolean</span></p> <p><em class="ansible-option-versionadded">added in ansible-core 2.12</em></p> </div>
</td> <td>

<div class="ansible-option-cell">
<p>Set this option to <code>False</code> to omit the <code><strong><a class="reference internal" href="#ansible-collections-microsoft-ad-ldap-inventory-parameter-keyed-groups-separator"><span class="std std-ref">keyed_groups[].separator</span></a></strong></code> after the host variable when the value is an empty string.</p> <p>This option is mutually exclusive with <code><strong><a class="reference internal" href="#ansible-collections-microsoft-ad-ldap-inventory-parameter-keyed-groups-default-value"><span class="std std-ref">keyed_groups[].default_value</span></a></strong></code>.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li><code>false</code></li> <li>
<code><strong>true</strong></code> <span class="ansible-option-choices-default-mark">← (default)</span>
</li> </ul> </div>
</td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-ldap-inventory-parameter-leading-separator"><strong>leading_separator</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">boolean</span></p> <p><em class="ansible-option-versionadded">added in ansible-core 2.11</em></p> </div></td> <td><div class="ansible-option-cell">
<p>Use in conjunction with keyed_groups.</p> <p>By default, a keyed group that does not have a prefix or a separator provided will have a name that starts with an underscore.</p> <p>This is because the default prefix is “” and the default separator is “_”.</p> <p>Set this option to False to omit the leading underscore (or other separator) if no prefix is given.</p> <p>If the group name is derived from a mapping the separator is still used to concatenate the items.</p> <p>To not use a separator in the group name at all, set the separator for the keyed group to an empty string instead.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li><code>false</code></li> <li>
<code><strong>true</strong></code> <span class="ansible-option-choices-default-mark">← (default)</span>
</li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-ldap-inventory-parameter-password"><strong>password</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The password to authenticate with.</p> <p>If <em>auth_protocol</em> is <code>simple</code> and no password is specified, the bind will be performed as an unauthenticated bind.</p> <p>If <em>auth_protocol</em> is <code>negotiate</code>, <code>kerberos</code>, or <code>ntlm</code> and no password is specified, it will attempt to use the local cached credential specified by <em>username</em> if available.</p> <p>This option can be set using a Jinja2 template value.</p> <p class="ansible-option-line"><strong class="ansible-option-configuration">Configuration:</strong></p> <ul class="simple"> <li>Environment variable: <a class="reference internal" href="../../environment_variables.html#envvar-MICROSOFT_AD_LDAP_PASSWORD" id="index-8"><code>MICROSOFT_AD_LDAP_PASSWORD</code></a>
</li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-ldap-inventory-parameter-port"><strong>port</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">integer</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The LDAP port to use for the connection.</p> <p>Port 389 is used for LDAP and port 686 is used for LDAPS.</p> <p>Defaults to port <code>636</code> if <code>tls_mode=ldaps</code> otherwise <code>389</code>.</p> <p>This option can be set using a Jinja2 template value.</p> <p class="ansible-option-line"><strong class="ansible-option-configuration">Configuration:</strong></p> <ul class="simple"> <li>Environment variable: <a class="reference internal" href="../../environment_variables.html#envvar-MICROSOFT_AD_LDAP_PORT" id="index-9"><code>MICROSOFT_AD_LDAP_PORT</code></a>
</li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-ldap-inventory-parameter-search-base"><strong>search_base</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The LDAP search base to find the computer objects in.</p> <p>Defaults to the <code>defaultNamingContext</code> of the Active Directory server if not specified.</p> <p>If searching a larger Active Directory database, it is recommended to narrow the search base to speed up the queries.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-ldap-inventory-parameter-search-scope"><strong>search_scope</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The scope of the LDAP search to perform.</p> <p><code>base</code> will search only the current path or object specified by <em>search_base</em>. This is typically not useful for inventory plugins.</p> <p><code>one_level</code> will search only the immediate child objects in <em>search_base</em>.</p> <p><code>subtree</code> will search the immediate child objects and any nested objects in <em>search_base</em>.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li><code>"base"</code></li> <li><code>"one_level"</code></li> <li>
<code><strong>"subtree"</strong></code> <span class="ansible-option-choices-default-mark">← (default)</span>
</li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-ldap-inventory-parameter-server"><strong>server</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The domain controller/server to connect to.</p> <p>If not specified the server will be derived from the current krb5.conf <code>default_realm</code> setting and with an SRV DNS lookup.</p> <p>See <a class="reference internal" href="docsite/guide_ldap_connection.html#ansible-collections-microsoft-ad-docsite-guide-ldap-connection-server-lookup"><span class="std std-ref">Server lookup</span></a> for more information.</p> <p>This option can be set using a Jinja2 template value.</p> <p class="ansible-option-line"><strong class="ansible-option-configuration">Configuration:</strong></p> <ul class="simple"> <li>Environment variable: <a class="reference internal" href="../../environment_variables.html#envvar-MICROSOFT_AD_LDAP_SERVER" id="index-10"><code>MICROSOFT_AD_LDAP_SERVER</code></a>
</li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-ldap-inventory-parameter-strict"><strong>strict</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">boolean</span></p> </div></td> <td><div class="ansible-option-cell">
<p>If <code>yes</code> make invalid entries a fatal error, otherwise skip and continue.</p> <p>Since it is possible to use facts in the expressions they might not always be available and we ignore those errors by default.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li>
<code><strong>false</strong></code> <span class="ansible-option-choices-default-mark">← (default)</span>
</li> <li><code>true</code></li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-ldap-inventory-parameter-tls-mode"><strong>tls_mode</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The TLS operation to use.</p> <p>If an explicit <em>port</em> is set to <code>636</code> then this defaults to <code>ldaps</code>.</p> <p><code>ldaps</code> will connect over LDAPS (port 636).</p> <p><code>start_tls</code> will connect over LDAP (port 389) and perform the StartTLS operation before the authentication bind.</p> <p>It is recommended to use <code>ldaps</code> over <code>start_tls</code> if TLS is going to be used.</p> <p>This option can be set using a Jinja2 template value.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li><code>"ldaps"</code></li> <li><code>"start_tls"</code></li> </ul> <p class="ansible-option-line"><strong class="ansible-option-configuration">Configuration:</strong></p> <ul class="simple"> <li>Environment variable: <a class="reference internal" href="../../environment_variables.html#envvar-MICROSOFT_AD_LDAP_TLS_MODE" id="index-11"><code>MICROSOFT_AD_LDAP_TLS_MODE</code></a>
</li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-ldap-inventory-parameter-use-extra-vars"><strong>use_extra_vars</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">boolean</span></p> <p><em class="ansible-option-versionadded">added in ansible-core 2.11</em></p> </div></td> <td><div class="ansible-option-cell">
<p>Merge extra vars into the available variables for composition (highest precedence).</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li>
<code><strong>false</strong></code> <span class="ansible-option-choices-default-mark">← (default)</span>
</li> <li><code>true</code></li> </ul> <p class="ansible-option-line"><strong class="ansible-option-configuration">Configuration:</strong></p> <ul> <li>
<p>INI entry:</p> <pre data-language="YAML+Jinja">[inventory_plugins]
use_extra_vars = false
</pre> </li> <li>Environment variable: <a class="reference internal" href="../../environment_variables.html#envvar-ANSIBLE_INVENTORY_USE_EXTRA_VARS" id="index-12"><code>ANSIBLE_INVENTORY_USE_EXTRA_VARS</code></a>
</li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-ldap-inventory-parameter-username"><strong>username</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The username to authenticate with.</p> <p>If <em>auth_protocol</em> is <code>simple</code> and no username is specified, anonymous authentication is used.</p> <p>If <em>auth_protocol</em> is <code>negotiate</code>, <code>kerberos</code>, or <code>ntlm</code> and no username is specified, it will attempt to use the local cached credential if available, for example one retrieved by <code>kinit</code>.</p> <p>This option can be set using a Jinja2 template value.</p> <p class="ansible-option-line"><strong class="ansible-option-configuration">Configuration:</strong></p> <ul class="simple"> <li>Environment variable: <a class="reference internal" href="../../environment_variables.html#envvar-MICROSOFT_AD_LDAP_USERNAME" id="index-13"><code>MICROSOFT_AD_LDAP_USERNAME</code></a>
</li> </ul> </div></td> </tr>  </table> </section> <section id="notes"> <h2>Notes</h2> <div class="admonition note"> <p class="admonition-title">Note</p> <ul class="simple"> <li>See <a class="reference internal" href="docsite/guide_ldap_inventory.html#ansible-collections-microsoft-ad-docsite-guide-ldap-inventory"><span class="std std-ref">LDAP inventory</span></a> for more details on how to use this inventory plugin.</li> <li>See <a class="reference internal" href="docsite/guide_ldap_inventory.html#ansible-collections-microsoft-ad-docsite-guide-ldap-inventory-laps"><span class="std std-ref">LAPS</span></a> for more details on how this plugin can retrieve the LAPS password information.</li> <li>This plugin is a tech preview and the module options are subject to change based on feedback received.</li> <li>Unless specified otherwise in the option description, the value specified in the config file is used as is. Only the LDAP connection options allow using a Jinja2 template.</li> <li>See <a class="reference internal" href="docsite/guide_ldap_connection.html#ansible-collections-microsoft-ad-docsite-guide-ldap-connection"><span class="std std-ref">LDAP connection help</span></a> for more information about LDAP connections.</li> </ul> </div> </section> <section id="examples"> <h2>Examples</h2> <pre data-language="yaml+jinja"># Set in the file ending with microsoft.ad.ldap.yml or microsoft.ad.ldap.yaml
plugin: microsoft.ad.ldap


####################################################################
#                        Connection Options                        #
#                                                                  #
# These options control how the plugin connects to the LDAP server #
####################################################################

# Connects to ldap://dc01.domain.com:389
server: dc01.domain.com
port: 389

# Connects to ldaps://dc01.domain.com:636
server: dc01.domain.com
tls_mode: ldaps

# Connects to the global catalog
# ldap://dc01.domain.com:3268
server: dc01.domain.com
port: 3268

# Provides explicit user, will use the current Kerberos ticket if no credential
# is provided.
username: domain-user@DOMAIN.COM
password: Password123!

# Only allow Kerberos authentication.
auth_protocol: kerberos

# Verify LDAPS CA chain with custom CA chain.
tls_mode: ldaps
ca_cert: /home/user/certs/ldap.pem

# The username and password can be retrieved using a template with a lookup.
# Other connection options can also be set this way, the option description
# tells you whether it can be set to a template.
username: '{{ lookup("ansible.builtin.env", "LDAP_USERNAME") }}'
password: '{{ lookup("ansible.builtin.env", "LDAP_PASSWORD") }}'


##############################################
#               Search Options               #
#                                            #
# These options control the searching rules  #
##############################################

# Search for computer accounts in the Workshop OU.
search_base: OU=Workshop A,DC=domain,DC=com

# Filter the computer accounts returned for only ones with the dNSDomainName
# attribute set.
filter: (dNSDomainName=*)

# Filter computer accounts returned for ones starting with PROD and with the
# LAPS password set.
filter: (&amp;(sAMAccountName=PROD*)(ms-Mcs-AdmPwd=*))

# See documentation for more details
attributes:
  sAMAccountName:
    sam_account_name:
  objectSid:
    computer_sid:
  pwdLastSet:
    password_last_set: this | microsoft.ad.as_datetime
  comment:
    host_comment
  memberOf:
    # Gets the value (1) of the first RDN (0) of each memberOf instance (this).
    # For example 'CN=Domain Admins,CN=Users,DC=domain,DC=test'
    # will be returned as just 'Domain Admins'
    computer_membership: this | microsoft.ad.parse_dn | map(attribute="0.1")
  location:


############################################################################
#                             LAPS Integration                             #
#                                                                          #
# Examples on how to use the new Windows LAPS values as connection options #
############################################################################

attributes:
  # msLAPS-Password is used if no encryption has been configured.
  # Currently an encrypted LAPS password is not supported.
  msLAPS-Password:
    ansible_user: (this | from_json).n
    ansible_password: (this | from_json).p

  # msLAPS-EncryptedPassword is used if encryption has been configured.
  # If the Python dpapi-ng library is installed the `this`` value will
  # contain the entry `value` which is the decrypted value. The ``info``
  # entry will contain the reason why the value could not be decrypted.
  msLAPS-EncryptedPassword:
    ansible_user: (this.value | from_json).n
    ansible_password: (this.value | from_json).p

  # ms-Mcs-AdmPwd is used for Legacy LAPS and stores just the password.
  # The username needs to be hardcoded as a string value for this template.
  ms-Mcs-AdmPwd:
    ansible_user: '"Administrator"'
    ansible_password: this


#####################################################################
#                        Constructed Options                        #
#                                                                   #
# These options control the constructed values like vars and groups #
#####################################################################

# Build composed host variables. Requires attributes to be set in the
# attributes option to be referenced here.
compose:
  host_var: computer_sid

# Conditionals that adds found hosts to the groups specified.
groups:
  # Adds all hosts to the windows group
  windows: true

  # Uses the memberOf fact documented above to place the host in the production
  # group if it's a member of that group
  production: '"Production Group" in computer_membership'

# Adds the host to a group site_{{ location }} with the default group of
# site_unknown if the location isn't defined
keyed_groups:
  - key: location | default(omit)
    prefix: site
    default_value: unknown
</pre> <section id="authors"> <h3>Authors</h3> <ul class="simple"> <li>Jordan Borean (@jborean93)</li> </ul> <div class="admonition hint"> <p class="admonition-title">Hint</p> <p>Configuration entries for each entry type have a low to high priority order. For example, a variable that is lower in the list will override a variable that is higher up.</p> </div> </section> <section id="collection-links"> <h3>Collection links</h3> <ul class="ansible-links"> <li><span><a aria-role="button" class="ansible-link reference external" href="https://github.com/ansible-collections/microsoft.ad/issues?q=is%3Aissue+is%3Aopen+sort%3Aupdated-desc" rel="noopener external" target="_blank">Issue Tracker</a></span></li> <li><span><a aria-role="button" class="ansible-link reference external" href="https://github.com/ansible-collections/microsoft.ad" rel="noopener external" target="_blank">Repository (Sources)</a></span></li> <li><span><a aria-role="button" class="ansible-link reference external" href="https://github.com/ansible-collections/microsoft.ad/issues/new/choose" rel="noopener external" target="_blank">Report an issue</a></span></li> <li><span><a class="reference internal" href="index.html#communication-for-microsoft-ad"><span class="std std-ref">Communication</span></a></span></li> </ul> </section> </section> </section><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2012&ndash;2018 Michael DeHaan<br>&copy; 2018&ndash;2024 Red Hat, Inc.<br>Licensed under the GNU General Public License version 3.<br>
    <a href="https://docs.ansible.com/ansible/latest/collections/microsoft/ad/ldap_inventory.html" class="_attribution-link">https://docs.ansible.com/ansible/latest/collections/microsoft/ad/ldap_inventory.html</a>
  </p>
</div>
