<section id="microsoft-ad-service-account-module-manage-active-directory-service-account-objects"> <h1>microsoft.ad.service_account module – Manage Active Directory service account objects</h1> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This module is part of the <a class="reference external" href="https://galaxy.ansible.com/ui/repo/published/microsoft/ad/">microsoft.ad collection</a> (version 1.7.1).</p> <p>You might already have this collection installed if you are using the <code>ansible</code> package. It is not included in <code>ansible-core</code>. To check whether it is installed, run <code>ansible-galaxy collection list</code>.</p> <p>To install it, use: <code>ansible-galaxy collection install microsoft.ad</code>. You need further requirements to be able to use this module, see <a class="reference internal" href="#ansible-collections-microsoft-ad-service-account-module-requirements"><span class="std std-ref">Requirements</span></a> for details.</p> <p>To use it in a playbook, specify: <code>microsoft.ad.service_account</code>.</p> </div> <p class="ansible-version-added">New in microsoft.ad 1.7.0</p>  <ul class="simple"> <li><a class="reference internal" href="#synopsis" id="id1">Synopsis</a></li> <li><a class="reference internal" href="#requirements" id="id2">Requirements</a></li> <li><a class="reference internal" href="#parameters" id="id3">Parameters</a></li> <li><a class="reference internal" href="#attributes" id="id4">Attributes</a></li> <li><a class="reference internal" href="#notes" id="id5">Notes</a></li> <li><a class="reference internal" href="#see-also" id="id6">See Also</a></li> <li><a class="reference internal" href="#examples" id="id7">Examples</a></li> </ul>  <section id="synopsis"> <h2>Synopsis</h2> <ul class="simple"> <li>Manages Active Directory service account objects and their attributes.</li> <li>Currently this module only supports group managed service accounts (gMSA).</li> <li>Before creating a gMSA, the AD environment must have created a KDS root key. See <a class="reference external" href="https://learn.microsoft.com/en-us/windows-server/security/group-managed-service-accounts/create-the-key-distribution-services-kds-root-key">KDS Key</a> for more details. For the key to be effective immediately, set the effective time for 10 hours ago and do not use the <code>-EffectiveImmediately</code> parameter. See the examples for more details.</li> </ul> </section> <section id="requirements"> <h2 id="ansible-collections-microsoft-ad-service-account-module-requirements">Requirements</h2> <p>The below requirements are needed on the host that executes this module.</p> <ul class="simple"> <li>
<code>ActiveDirectory</code> PowerShell module</li> </ul> </section> <section id="parameters"> <h2>Parameters</h2> <table class="longtable ansible-option-table docutils align-default" style="width: 100%"> <thead> <tr>
<th class="head"><p>Parameter</p></th> <th class="head"><p>Comments</p></th> </tr> </thead>  <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-service-account-module-parameter-allowed-to-retrieve-password"><strong>allowed_to_retrieve_password</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">dictionary</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The principals that are allowed to retrieve the password for the service account to either add, remove, or set.</p> <p>Each subkey value is a list of values in the form of a <code>distinguishedName</code>, <code>objectGUID</code>, <code>objectSid</code>, c(sAMAccountName), or <code>userPrincipalName</code> string or a dictionary with the <em>name</em> and optional <em>server</em> key.</p> <p>This value is built into a security descriptor by the ActiveDirectory cmdlet and set on the <code>msDS-GroupMSAMembership</code> LDAP attribute.</p> <p>This corresponds to the <code>-PrincipalsAllowedToRetrieveManagedPassword</code> parameter on the AD cmdlets.</p> <p>To clear all principals, use <em>set</em> with an empty list.</p> <p>See <a class="reference internal" href="docsite/guide_attributes.html#ansible-collections-microsoft-ad-docsite-guide-attributes-dn-lookup-attributes"><span class="std std-ref">DN Lookup Attributes</span></a> for more information on how DN lookups work.</p> <p>See <a class="reference internal" href="docsite/guide_list_values.html#ansible-collections-microsoft-ad-docsite-guide-list-values"><span class="std std-ref">Setting list option values</span></a> for more information on how to add/remove/set list options.</p> </div></td> </tr> <tr>
<td>

<div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-service-account-module-parameter-allowed-to-retrieve-password-add"><strong>add</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">list</span> / <span class="ansible-option-elements">elements=any</span></p> </div>
</td> <td>

<div class="ansible-option-cell">
<p>Adds the principals specified as principals allowed to retrieve the service account password.</p> <p>Any existing principals not specified by <em>add</em> will be untouched unless specified by <em>remove</em> or not in <em>set</em>.</p> </div>
</td> </tr> <tr>
<td>

<div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-service-account-module-parameter-allowed-to-retrieve-password-lookup-failure-action"><strong>lookup_failure_action</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div>
</td> <td>

<div class="ansible-option-cell">
<p>Control the action to take when the lookup fails to find the DN.</p> <p><code>fail</code> will cause the task to fail.</p> <p><code>ignore</code> will ignore the value and continue.</p> <p><code>warn</code> will ignore the value and display a warning.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li>
<code><strong>"fail"</strong></code> <span class="ansible-option-choices-default-mark">← (default)</span>
</li> <li><code>"ignore"</code></li> <li><code>"warn"</code></li> </ul> </div>
</td> </tr> <tr>
<td>

<div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-service-account-module-parameter-allowed-to-retrieve-password-remove"><strong>remove</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">list</span> / <span class="ansible-option-elements">elements=any</span></p> </div>
</td> <td>

<div class="ansible-option-cell">
<p>Removes the principals specified as principals allowed to retrieve the service account password.</p> <p>Any existing pricipals not specified by <em>remove</em> will be untouched unless <em>set</em> is defined.</p> </div>
</td> </tr> <tr>
<td>

<div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-service-account-module-parameter-allowed-to-retrieve-password-set"><strong>set</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">list</span> / <span class="ansible-option-elements">elements=any</span></p> </div>
</td> <td>

<div class="ansible-option-cell">
<p>Sets the principals specified as principals allowed to retrieve the service account password.</p> <p>This will remove any existing principals if not specified in this list.</p> <p>Specify an empty list to remove all principals allowed to delegate.</p> </div>
</td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-service-account-module-parameter-attributes"><strong>attributes</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">dictionary</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The attributes to either add, remove, or set on the AD object.</p> <p>The value of each attribute option should be a dictionary where the key is the LDAP attribute, e.g. <code>firstName</code>, <code>comment</code> and the value is the value, or list of values, to set for that attribute.</p> <p>The attribute value(s) can either be the raw string, integer, or bool value to add, remove, or set on the attribute in question.</p> <p>The value can also be a dictionary with the <em>type</em> key set to <code>bytes</code>, <code>date_time</code>, <code>security_descriptor</code>, or <code>raw</code> and the value for this entry under the <em>value</em> key.</p> <p>The <code>bytes</code> type has a value that is a base64 encoded string of the raw bytes to set.</p> <p>The <code>date_time</code> type has a value that is the ISO 8601 DateTime string of the DateTime to set. The DateTime will be set as the Microsoft FILETIME integer value which is the number of 100 nanoseconds since 1601-01-01 in UTC.</p> <p>The <code>security_descriptor</code> type has a value that is the Security Descriptor SDDL string used for the <code>nTSecurityDescriptor</code> attribute.</p> <p>The <code>raw</code> type is the int, string, or boolean value to set.</p> <p>String attribute values are compared using a case sensitive match on the AD object being managed.</p> <p>See <a class="reference internal" href="docsite/guide_attributes.html#ansible-collections-microsoft-ad-docsite-guide-attributes"><span class="std std-ref">LDAP attributes help</span></a> for more information.</p> <p class="ansible-option-line"><strong class="ansible-option-default-bold">Default:</strong> <code>{}</code></p> </div></td> </tr> <tr>
<td>

<div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-service-account-module-parameter-attributes-add"><strong>add</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">dictionary</span></p> </div>
</td> <td>

<div class="ansible-option-cell">
<p>A dictionary of all the attributes and their value(s) to add to the AD object being managed if they are not already present.</p> <p>This is used for attributes that can contain multiple values, if the attribute only allows a single value, use <em>set</em> instead.</p> <p class="ansible-option-line"><strong class="ansible-option-default-bold">Default:</strong> <code>{}</code></p> </div>
</td> </tr> <tr>
<td>

<div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-service-account-module-parameter-attributes-remove"><strong>remove</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">dictionary</span></p> </div>
</td> <td>

<div class="ansible-option-cell">
<p>A dictionary of all the attributes and their value(s) to remove from the AD object being managed if they are present.</p> <p>This is used for attributes that can contain multiple values, if the attribute only allows a single value, use <em>set</em> instead.</p> <p class="ansible-option-line"><strong class="ansible-option-default-bold">Default:</strong> <code>{}</code></p> </div>
</td> </tr> <tr>
<td>

<div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-service-account-module-parameter-attributes-set"><strong>set</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">dictionary</span></p> </div>
</td> <td>

<div class="ansible-option-cell">
<p>A dictionary of all attributes and their value(s) to set on the AD object being managed.</p> <p>This will replace any existing values if they do not match the ones being requested.</p> <p>The order of attribute values are not checked only, only that the values requested are the only values on the object attribute.</p> <p>Set this to null or an empty list to clear any values for the attribute.</p> <p class="ansible-option-line"><strong class="ansible-option-default-bold">Default:</strong> <code>{}</code></p> </div>
</td> </tr> <tr>
<td><div class="ansible-option-cell">  
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-service-account-module-parameter-principals-allowed-to-delegate"><strong id="ansible-collections-microsoft-ad-service-account-module-parameter-delegates">delegates</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-aliases">aliases: principals_allowed_to_delegate</span></p> <p class="ansible-option-type-line"><span class="ansible-option-type">dictionary</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The principal objects that the current AD object can trust for delegation to either add, remove or set.</p> <p>This is also known as resource-based constrained delegation.</p> <p>Each subkey value is a list of values in the form of a <code>distinguishedName</code>, <code>objectGUID</code>, <code>objectSid</code>, <code>sAMAccountName</code>, or <code>userPrincipalName</code> string or a dictionary with the <em>name</em> and optional <em>server</em> key.</p> <p>This is the value set on the <code>msDS-AllowedToActOnBehalfOfOtherIdentity</code> LDAP attribute.</p> <p>This is a highly sensitive attribute as it allows the principals specified to impersonate any account when authenticating with a service running as this managed account.</p> <p>To clear all principals, use <em>set</em> with an empty list.</p> <p>See <a class="reference internal" href="docsite/guide_attributes.html#ansible-collections-microsoft-ad-docsite-guide-attributes-dn-lookup-attributes"><span class="std std-ref">DN Lookup Attributes</span></a> for more information on how DN lookups work.</p> <p>See <a class="reference internal" href="docsite/guide_list_values.html#ansible-collections-microsoft-ad-docsite-guide-list-values"><span class="std std-ref">Setting list option values</span></a> for more information on how to add/remove/set list options.</p> </div></td> </tr> <tr>
<td>

<div class="ansible-option-cell">  
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-service-account-module-parameter-principals-allowed-to-delegate-add"><strong id="ansible-collections-microsoft-ad-service-account-module-parameter-delegates-add">add</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">list</span> / <span class="ansible-option-elements">elements=any</span></p> </div>
</td> <td>

<div class="ansible-option-cell">
<p>Adds the principals specified as principals allowed to delegate to.</p> <p>Any existing principals not specified by <em>add</em> will be untouched unless specified by <em>remove</em> or not in <em>set</em>.</p> </div>
</td> </tr> <tr>
<td>

<div class="ansible-option-cell">  
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-service-account-module-parameter-principals-allowed-to-delegate-lookup-failure-action"><strong id="ansible-collections-microsoft-ad-service-account-module-parameter-delegates-lookup-failure-action">lookup_failure_action</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div>
</td> <td>

<div class="ansible-option-cell">
<p>Control the action to take when the lookup fails to find the DN.</p> <p><code>fail</code> will cause the task to fail.</p> <p><code>ignore</code> will ignore the value and continue.</p> <p><code>warn</code> will ignore the value and display a warning.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li>
<code><strong>"fail"</strong></code> <span class="ansible-option-choices-default-mark">← (default)</span>
</li> <li><code>"ignore"</code></li> <li><code>"warn"</code></li> </ul> </div>
</td> </tr> <tr>
<td>

<div class="ansible-option-cell">  
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-service-account-module-parameter-principals-allowed-to-delegate-remove"><strong id="ansible-collections-microsoft-ad-service-account-module-parameter-delegates-remove">remove</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">list</span> / <span class="ansible-option-elements">elements=any</span></p> </div>
</td> <td>

<div class="ansible-option-cell">
<p>Removes the principals specified as principals allowed to delegate to.</p> <p>Any existing pricipals not specified by <em>remove</em> will be untouched unless <em>set</em> is defined.</p> </div>
</td> </tr> <tr>
<td>

<div class="ansible-option-cell">  
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-service-account-module-parameter-principals-allowed-to-delegate-set"><strong id="ansible-collections-microsoft-ad-service-account-module-parameter-delegates-set">set</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">list</span> / <span class="ansible-option-elements">elements=any</span></p> </div>
</td> <td>

<div class="ansible-option-cell">
<p>Sets the principals specified as principals allowed to delegate to.</p> <p>This will remove any existing principals if not specified in this list.</p> <p>Specify an empty list to remove all principals allowed to delegate.</p> </div>
</td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-service-account-module-parameter-description"><strong>description</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The description of the AD object to set.</p> <p>This is the value set on the <code>description</code> LDAP attribute.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-service-account-module-parameter-display-name"><strong>display_name</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The display name of the AD object to set.</p> <p>This is the value of the <code>displayName</code> LDAP attribute.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-service-account-module-parameter-dns-hostname"><strong>dns_hostname</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Specifies the DNS name of the service account.</p> <p>This is the value set on the <code>dNSHostName</code> LDAP attribute.</p> <p>This cannot be set when <code>outbound_auth_only=True</code>, otherwise it must be defined.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-service-account-module-parameter-do-not-append-dollar-to-sam"><strong>do_not_append_dollar_to_sam</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">boolean</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Do not automatically append <code>$</code> to the <em>sam_account_name</em> value.</p> <p>This only applies when <em>sam_account_name</em> is explicitly set and can be used to create a service account without the <code>$</code> suffix.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li>
<code><strong>false</strong></code> <span class="ansible-option-choices-default-mark">← (default)</span>
</li> <li><code>true</code></li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-service-account-module-parameter-domain-credentials"><strong>domain_credentials</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">list</span> / <span class="ansible-option-elements">elements=dictionary</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Specifies the credentials that should be used when using the server specified by <em>name</em>.</p> <p>To specify credentials for the default domain server, use an entry without the <em>name</em> key or use the <em>domain_username</em> and <em>domain_password</em> option.</p> <p>This can be set under the <a class="reference internal" href="../../../playbook_guide/playbooks_module_defaults.html#module-defaults-groups"><span class="std std-ref">play’s module defaults</span></a> under the <code>group/microsoft.ad.domain</code> group.</p> <p>See <a class="reference internal" href="docsite/guide_ad_module_authentication.html#ansible-collections-microsoft-ad-docsite-guide-ad-module-authentication"><span class="std std-ref">AD authentication in modules</span></a> for more information.</p> <p class="ansible-option-line"><strong class="ansible-option-default-bold">Default:</strong> <code>[]</code></p> </div></td> </tr> <tr>
<td>

<div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-service-account-module-parameter-domain-credentials-name"><strong>name</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div>
</td> <td>

<div class="ansible-option-cell">
<p>The name of the server these credentials are for.</p> <p>This value should correspond to the value used in other options that specify a custom server to use, for example an option that references an AD identity located on a different AD server.</p> <p>This key can be omitted in one entry to specify the default credentials to use when a server is not specified instead of using <em>domain_username</em> and <em>domain_password</em>.</p> </div>
</td> </tr> <tr>
<td>

<div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-service-account-module-parameter-domain-credentials-password"><strong>password</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span> / <span class="ansible-option-required">required</span></p> </div>
</td> <td>

<div class="ansible-option-cell">
<p>The password to use when connecting to the server specified by <em>name</em>.</p> </div>
</td> </tr> <tr>
<td>

<div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-service-account-module-parameter-domain-credentials-username"><strong>username</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span> / <span class="ansible-option-required">required</span></p> </div>
</td> <td>

<div class="ansible-option-cell">
<p>The username to use when connecting to the server specified by <em>name</em>.</p> </div>
</td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-service-account-module-parameter-domain-password"><strong>domain_password</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The password for <em>domain_username</em>.</p> <p>The <em>domain_credentials</em> sub entry without a <em>name</em> key can also be used to specify the credentials for the default domain authentication.</p> <p>This can be set under the <a class="reference internal" href="../../../playbook_guide/playbooks_module_defaults.html#module-defaults-groups"><span class="std std-ref">play’s module defaults</span></a> under the <code>group/microsoft.ad.domain</code> group.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-service-account-module-parameter-domain-server"><strong>domain_server</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Specified the Active Directory Domain Services instance to connect to.</p> <p>Can be in the form of an FQDN or NetBIOS name.</p> <p>If not specified then the value is based on the default domain of the computer running PowerShell.</p> <p>Custom credentials can be specified under a <em>domain_credentials</em> entry without a <em>name</em> key or through <em>domain_username</em> and <em>domain_password</em>.</p> <p>This can be set under the <a class="reference internal" href="../../../playbook_guide/playbooks_module_defaults.html#module-defaults-groups"><span class="std std-ref">play’s module defaults</span></a> under the <code>group/microsoft.ad.domain</code> group.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-service-account-module-parameter-domain-username"><strong>domain_username</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The username to use when interacting with AD.</p> <p>If this is not set then the user that is used for authentication will be the connection user.</p> <p>Ansible will be unable to use the connection user unless auth is Kerberos with credential delegation or CredSSP, or become is used on the task.</p> <p>The <em>domain_credentials</em> sub entry without a <em>name</em> key can also be used to specify the credentials for the default domain authentication.</p> <p>This can be set under the <a class="reference internal" href="../../../playbook_guide/playbooks_module_defaults.html#module-defaults-groups"><span class="std std-ref">play’s module defaults</span></a> under the <code>group/microsoft.ad.domain</code> group.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-service-account-module-parameter-enabled"><strong>enabled</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">boolean</span></p> </div></td> <td><div class="ansible-option-cell">
<p><code>yes</code> will enable the service account.</p> <p><code>no</code> will disable the service account.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li><code>false</code></li> <li><code>true</code></li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-service-account-module-parameter-identity"><strong>identity</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The identity of the AD object used to find the AD object to manage.</p> <p>This must be specified if; <em>name</em> is not set, when trying to rename the object with a new <em>name</em>, or when trying to move the object into a different <em>path</em>.</p> <p>The identity can be in the form of a GUID representing the <code>objectGUID</code> value, the <code>userPrincipalName</code>, <code>sAMAccountName</code>, <code>objectSid</code>, or <code>distinguishedName</code>.</p> <p>If omitted, the AD object to manage is selected by the <code>distinguishedName</code> using the format <code>CN={{ name }},{{ path }}</code>. If <em>path</em> is not defined, the <code>defaultNamingContext</code> is used instead.</p> <p>When using the <a class="reference internal" href="computer_module.html#ansible-collections-microsoft-ad-computer-module"><span class="std std-ref">microsoft.ad.computer</span></a> module, the identity will automatically append <code>$</code> to the end of the <code>sAMAccountName</code> if the provided value did not result in a match and did not already have a <code>$</code> at the end.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-service-account-module-parameter-kerberos-encryption-types"><strong>kerberos_encryption_types</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">dictionary</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Specifies the Kerberos encryption types supported the AD service account.</p> <p>This is the value set on the <code>msDS-SupportedEncryptionTypes</code> LDAP attribute.</p> <p>Avoid using <code>rc4</code> or <code>des</code> as they are older an insecure encryption protocols.</p> <p>To clear all encryption types, use <em>set</em> with an empty list.</p> <p>See <a class="reference internal" href="docsite/guide_list_values.html#ansible-collections-microsoft-ad-docsite-guide-list-values"><span class="std std-ref">Setting list option values</span></a> for more information on how to add/remove/set list options.</p> </div></td> </tr> <tr>
<td>

<div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-service-account-module-parameter-kerberos-encryption-types-add"><strong>add</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">list</span> / <span class="ansible-option-elements">elements=string</span></p> </div>
</td> <td>

<div class="ansible-option-cell">
<p>The encryption types to add to the existing set.</p> <p>Any existing encryption types not specified by <em>add</em> will be untouched unless specified by <em>remove</em> or not in <em>set</em>.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li><code>"aes128"</code></li> <li><code>"aes256"</code></li> <li><code>"des"</code></li> <li><code>"rc4"</code></li> </ul> </div>
</td> </tr> <tr>
<td>

<div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-service-account-module-parameter-kerberos-encryption-types-remove"><strong>remove</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">list</span> / <span class="ansible-option-elements">elements=string</span></p> </div>
</td> <td>

<div class="ansible-option-cell">
<p>The encryption types to remove from the existing set.</p> <p>Any existing encryption types not specified by <em>remove</em> will be untouched unless <em>set</em> is defined.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li><code>"aes128"</code></li> <li><code>"aes256"</code></li> <li><code>"des"</code></li> <li><code>"rc4"</code></li> </ul> </div>
</td> </tr> <tr>
<td>

<div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-service-account-module-parameter-kerberos-encryption-types-set"><strong>set</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">list</span> / <span class="ansible-option-elements">elements=string</span></p> </div>
</td> <td>

<div class="ansible-option-cell">
<p>The encryption types to set as the only encryption types allowed by the AD service account.</p> <p>This will remove any existing encryption types if not specified in this list.</p> <p>Specify an empty list to remove all encryption types.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li><code>"aes128"</code></li> <li><code>"aes256"</code></li> <li><code>"des"</code></li> <li><code>"rc4"</code></li> </ul> </div>
</td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-service-account-module-parameter-name"><strong>name</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The <code>name</code> of the AD object to manage, this is not the <code>sAMAccountName</code> of the object but the LDAP <code>cn</code> or <code>name</code> entry of the object in the path specified. Use <em>identity</em> to select an object to manage by its <code>sAMAccountName</code>.</p> <p>If <em>identity</em> is specified, and the name of the object found by that identity does not match this value, the object will be renamed.</p> <p>This must be specified if <em>identity</em> is not set.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-service-account-module-parameter-outbound-auth-only"><strong>outbound_auth_only</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">boolean</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Marks the service account for use with client outbound authentication only.</p> <p>When set the service account can only be used for client roles only. For example it can only be used for outbound authentication attempts and cannot be used as a target authentication service principal.</p> <p>If set then <em>dns_hostname</em> cannot be set.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li>
<code><strong>false</strong></code> <span class="ansible-option-choices-default-mark">← (default)</span>
</li> <li><code>true</code></li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-service-account-module-parameter-path"><strong>path</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The path of the OU or the container where the new object should exist in.</p> <p>If creating a new object, the new object will be created at the path specified. If no path is specified then the <code>defaultNamingContext</code> of the domain will be used as the path for most object types.</p> <p>If managing an existing object found by <em>identity</em>, the path of the found object will be moved to the one specified by this option. If no path is specified, the object will not be moved.</p> <p>The modules <a class="reference internal" href="computer_module.html#ansible-collections-microsoft-ad-computer-module"><span class="std std-ref">microsoft.ad.computer</span></a>, <a class="reference internal" href="user_module.html#ansible-collections-microsoft-ad-user-module"><span class="std std-ref">microsoft.ad.user</span></a>, and <a class="reference internal" href="group_module.html#ansible-collections-microsoft-ad-group-module"><span class="std std-ref">microsoft.ad.group</span></a> have their own default path that is configured on the Active Directory domain controller.</p> <p>This can be set to the literal value <code>microsoft.ad.default_path</code> which will equal the default value used when creating a new object.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-service-account-module-parameter-protect-from-deletion"><strong>protect_from_deletion</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">boolean</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Marks the object as protected from accidental deletion.</p> <p>This applies a deny access right from deleting the object normally and the protection needs to be removed before the object can be deleted through the GUI or any other tool outside Ansible.</p> <p>Using <em>state=absent</em> will still delete the AD object even if it is marked as protected from deletion.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li><code>false</code></li> <li><code>true</code></li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-service-account-module-parameter-sam-account-name"><strong>sam_account_name</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The <code>sAMAccountName</code> value to set for the service account.</p> <p>It has a maximum of 256 characters, 15 is advised for older operating systems compatibility.</p> <p>If ommitted the value is the same as <code>name$</code> when the service account is created.</p> <p>Note that service account <code>sAMAccountName</code> values typically end with a <code>$</code>.</p> <p>By default if the <code>$</code> suffix is omitted, it will be added to the end. If <em>do_not_append_dollar_to_sam=True</em> then the provided value will be used as is without adding <code>$</code> to the end.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell">  
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-service-account-module-parameter-spns"><strong id="ansible-collections-microsoft-ad-service-account-module-parameter-spn">spn</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-aliases">aliases: spns</span></p> <p class="ansible-option-type-line"><span class="ansible-option-type">dictionary</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Specifies the service principal name(s) for the account to add, remove or set.</p> <p>This is the value set on the <code>servicePrincipalName</code> LDAP attribute.</p> <p>To clear all service principal names, use <em>set</em> with an empty list.</p> <p>See <a class="reference internal" href="docsite/guide_list_values.html#ansible-collections-microsoft-ad-docsite-guide-list-values"><span class="std std-ref">Setting list option values</span></a> for more information on how to add/remove/set list options.</p> </div></td> </tr> <tr>
<td>

<div class="ansible-option-cell">  
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-service-account-module-parameter-spns-add"><strong id="ansible-collections-microsoft-ad-service-account-module-parameter-spn-add">add</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">list</span> / <span class="ansible-option-elements">elements=string</span></p> </div>
</td> <td>

<div class="ansible-option-cell">
<p>The SPNs to add to <code>servicePrincipalName</code>.</p> </div>
</td> </tr> <tr>
<td>

<div class="ansible-option-cell">  
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-service-account-module-parameter-spns-remove"><strong id="ansible-collections-microsoft-ad-service-account-module-parameter-spn-remove">remove</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">list</span> / <span class="ansible-option-elements">elements=string</span></p> </div>
</td> <td>

<div class="ansible-option-cell">
<p>The SPNs to remove from <code>servicePrincipalName</code>.</p> </div>
</td> </tr> <tr>
<td>

<div class="ansible-option-cell">  
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-service-account-module-parameter-spns-set"><strong id="ansible-collections-microsoft-ad-service-account-module-parameter-spn-set">set</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">list</span> / <span class="ansible-option-elements">elements=string</span></p> </div>
</td> <td>

<div class="ansible-option-cell">
<p>The SPNs to set as the only values in <code>servicePrincipalName</code>.</p> <p>This will clear out any existing SPNs if not in the specified list.</p> <p>Set to an empty list to clear all SPNs on the AD object.</p> </div>
</td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-service-account-module-parameter-state"><strong>state</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Set to <code>present</code> to ensure the AD object exists.</p> <p>Set to <code>absent</code> to remove the AD object if it exists.</p> <p>The option <em>name</em> must be set when <em>state=present</em>.</p> <p>Using <code>absent</code> will recursively remove the AD object and any child objects if it’s a container. It will also remove the AD object even if the object is marked as protected from accidental deletion.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li><code>"absent"</code></li> <li>
<code><strong>"present"</strong></code> <span class="ansible-option-choices-default-mark">← (default)</span>
</li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-service-account-module-parameter-trusted-for-delegation"><strong>trusted_for_delegation</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">boolean</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Specifies whether an account is trusted for Kerberos delegation.</p> <p>This is also known as unconstrained Kerberos delegation.</p> <p>This sets the <code>ADS_UF_TRUSTED_FOR_DELEGATION</code> flag in the <code>userAccountControl</code> LDAP attribute.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li><code>false</code></li> <li><code>true</code></li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-service-account-module-parameter-upn"><strong>upn</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Configures the User Principal Name (UPN) for the account.</p> <p>The format is <code>&lt;username&gt;@&lt;domain&gt;</code>.</p> <p>This is the value set on the <code>userPrincipalName</code> LDAP attribute.</p> </div></td> </tr>  </table> </section> <section id="attributes"> <h2>Attributes</h2> <table class="longtable ansible-option-table docutils align-default" style="width: 100%"> <thead> <tr>
<th class="head"><p>Attribute</p></th> <th class="head"><p>Support</p></th> <th class="head"><p>Description</p></th> </tr> </thead>  <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-service-account-module-attribute-check-mode"><strong>check_mode</strong></p> 
</div></td> <td><div class="ansible-option-cell">
<p><strong class="ansible-attribute-support-label">Support: </strong><strong class="ansible-attribute-support-full">full</strong></p> </div></td> <td><div class="ansible-option-cell">
<p>Can run in check_mode and return changed status prediction without modifying target, if not supported the action will be skipped.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-service-account-module-attribute-diff-mode"><strong>diff_mode</strong></p> 
</div></td> <td><div class="ansible-option-cell">
<p><strong class="ansible-attribute-support-label">Support: </strong><strong class="ansible-attribute-support-full">full</strong></p> </div></td> <td><div class="ansible-option-cell">
<p>Will return details on what has changed (or possibly needs changing in check_mode), when in diff mode</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-microsoft-ad-service-account-module-attribute-platform"><strong>platform</strong></p> 
</div></td> <td><div class="ansible-option-cell">
<p><strong class="ansible-attribute-support-property">Platform:</strong> <strong class="ansible-attribute-support-full">windows</strong></p> </div></td> <td><div class="ansible-option-cell">
<p>Target OS/families that can be operated against</p> </div></td> </tr>  </table> </section> <section id="notes"> <h2>Notes</h2> <div class="admonition note"> <p class="admonition-title">Note</p> <ul class="simple"> <li>This module must be run on a Windows target host with the <code>ActiveDirectory</code> module installed.</li> <li>When matching by <em>identity</em> with a <code>sAMAccountName</code> value, the value should endd with <code>$</code>. If the provided value does not end with <code>$</code> the module will still attempt to find the service account with the provided value before attempting a fallback lookup with <code>$</code> appended to the end.</li> <li>Some LDAP attributes can have only a single value set while others can have multiple. Some attributes are also read only and cannot be changed. It is recommended to look at the schema metadata for an attribute where <code>System-Only</code> are read only values and <code>Is-Single-Value</code> are attributes with only 1 value.</li> <li>Attempting to set multiple values to a <code>Is-Single-Value</code> attribute results in undefined behaviour.</li> <li>If running on a server that is not a Domain Controller, credential delegation through CredSSP or Kerberos with delegation must be used or the <em>domain_username</em>, <em>domain_password</em> must be set.</li> </ul> </div> </section> <section id="see-also"> <h2>See Also</h2> <div class="admonition seealso"> <p class="admonition-title">See also</p> <dl class="simple"> <dt><a class="reference internal" href="object_info_module.html#ansible-collections-microsoft-ad-object-info-module"><span class="std std-ref">microsoft.ad.object_info</span></a></dt>
<dd>
<p>Gather information an Active Directory object.</p> </dd> <dt><a class="reference internal" href="object_module.html#ansible-collections-microsoft-ad-object-module"><span class="std std-ref">microsoft.ad.object</span></a></dt>
<dd>
<p>Manage Active Directory objects.</p> </dd> </dl> </div> </section> <section id="examples"> <h2>Examples</h2> <pre data-language="yaml+jinja"># A gMSA requires a KDS root key to be created. This key must be valid for
# 10 hours before it can be used. This example creates the key and sets the
# time for 10 hours ago to let it be used immediately. If your environment
# uses multiple DCs you will still need to wait 10 hours for replication to
# occur or target the DC you created the key on. Required Domain Admin or
# Enterprise Admin privileges.
- name: Create KDS root key if not present
  ansible.windows.win_powershell:
    error_action: stop
    script: |
      $Ansible.Changed = $false
      if (-not (Get-KdsRootKey)) {
          Add-KdsRootKey -EffectiveTime ((Get-Date).AddHours(-10))
          $Ansible.Changed = $true
      }

- name: Create gMSA that allows Domain Admins to use
  microsoft.ad.service_account:
    identity: MyGMSA
    dns_hostname: MyGMSA.my_org.local
    description: GMSA for Domin Admins
    state: present
    allowed_to_retrieve_password:
      set:
        - Domain Admins

- name: create gMSA that allows the ITFarmHosts computer account to retrieve the pass
  microsoft.ad.service_account:
    identity: ITFarm1
    dns_hostname: ITFarm1.contoso.com
    allowed_to_retrieve_password:
      set:
        - ITFarmHosts$
    kerberos_encryption_types:
      set:
        - aes128
        - aes256
    spn:
      add:
        - http/ITFarm1.contoso.com/contoso.com
        - http/ITFarm1.contoso.com/contoso
        - http/ITFarm1.contoso.com
        - http/ITFarm1.contoso

- name: Remove gMSA by identity
  microsoft.ad.service_account:
    identity: ITFarm1$
    state: absent

- name: Add SPNs to service account
  microsoft.ad.service_account:
    identity: MySA$
    spn:
      add:
        - HOST/MySA
        - HOST/MySA.domain.test
        - HOST/MySA.domain.test:1234

- name: Remove SPNs on the service account
  microsoft.ad.service_account:
    identity: MySA$
    spn:
      remove:
        - HOST/MySA
        - HOST/MySA.domain.test
        - HOST/MySA.domain.test:1234

- name: Add gMSA with sAMAccountName without $ suffix
  microsoft.ad.service_account:
    identity: MySA
    dns_hostname: MySA.contoso.com
    sam_account_name: MySA
    do_not_append_dollar_to_sam: true
</pre> <section id="authors"> <h3>Authors</h3> <ul class="simple"> <li>Jordan Borean (@jborean93)</li> </ul> </section> <section id="collection-links"> <h3>Collection links</h3> <ul class="ansible-links"> <li><span><a aria-role="button" class="ansible-link reference external" href="https://github.com/ansible-collections/microsoft.ad/issues?q=is%3Aissue+is%3Aopen+sort%3Aupdated-desc" rel="noopener external" target="_blank">Issue Tracker</a></span></li> <li><span><a aria-role="button" class="ansible-link reference external" href="https://github.com/ansible-collections/microsoft.ad" rel="noopener external" target="_blank">Repository (Sources)</a></span></li> <li><span><a aria-role="button" class="ansible-link reference external" href="https://github.com/ansible-collections/microsoft.ad/issues/new/choose" rel="noopener external" target="_blank">Report an issue</a></span></li> <li><span><a class="reference internal" href="index.html#communication-for-microsoft-ad"><span class="std std-ref">Communication</span></a></span></li> </ul> </section> </section> </section><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2012&ndash;2018 Michael DeHaan<br>&copy; 2018&ndash;2024 Red Hat, Inc.<br>Licensed under the GNU General Public License version 3.<br>
    <a href="https://docs.ansible.com/ansible/latest/collections/microsoft/ad/service_account_module.html" class="_attribution-link">https://docs.ansible.com/ansible/latest/collections/microsoft/ad/service_account_module.html</a>
  </p>
</div>
