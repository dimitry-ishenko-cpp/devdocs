<h1 id="community-postgresql-postgresql-set-change-a-postgresql-server-configuration-parameter">community.postgresql.postgresql_set – Change a PostgreSQL server configuration parameter</h1> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This plugin is part of the <a class="reference external" href="https://galaxy.ansible.com/community/postgresql">community.postgresql collection</a> (version 1.5.0).</p> <p>You might already have this collection installed if you are using the <code>ansible</code> package. It is not included in <code>ansible-core</code>. To check whether it is installed, run <code>ansible-galaxy collection list</code>.</p> <p>To install it, use: <code>ansible-galaxy collection install community.postgresql</code>.</p> <p>To use it in a playbook, specify: <code>community.postgresql.postgresql_set</code>.</p> </div>  <ul class="simple"> <li><a class="reference internal" href="#synopsis" id="id1">Synopsis</a></li> <li><a class="reference internal" href="#requirements" id="id2">Requirements</a></li> <li><a class="reference internal" href="#parameters" id="id3">Parameters</a></li> <li><a class="reference internal" href="#notes" id="id4">Notes</a></li> <li><a class="reference internal" href="#see-also" id="id5">See Also</a></li> <li><a class="reference internal" href="#examples" id="id6">Examples</a></li> <li><a class="reference internal" href="#return-values" id="id7">Return Values</a></li> </ul>   <h2 id="synopsis">Synopsis</h2> <ul class="simple"> <li>Allows to change a PostgreSQL server configuration parameter.</li> <li>The module uses ALTER SYSTEM command and applies changes by reload server configuration.</li> <li>ALTER SYSTEM is used for changing server configuration parameters across the entire database cluster.</li> <li>It can be more convenient and safe than the traditional method of manually editing the postgresql.conf file.</li> <li>ALTER SYSTEM writes the given parameter setting to the $PGDATA/postgresql.auto.conf file, which is read in addition to postgresql.conf.</li> <li>The module allows to reset parameter to boot_val (cluster initial value) by <em>reset=yes</em> or remove parameter string from postgresql.auto.conf and reload <em>value=default</em> (for settings with postmaster context restart is required).</li> <li>After change you can see in the ansible output the previous and the new parameter value and other information using returned values and <a class="reference internal" href="../../ansible/builtin/debug_module.html#ansible-collections-ansible-builtin-debug-module"><span class="std std-ref">ansible.builtin.debug</span></a> module.</li> </ul>   <h2 id="requirements">Requirements</h2> <p>The below requirements are needed on the host that executes this module.</p> <ul class="simple"> <li>psycopg2</li> </ul>   <h2 id="parameters">Parameters</h2> <table class="documentation-table"> <tr> <th colspan="1">Parameter</th> <th>Choices/Defaults</th> <th width="100%">Comments</th> </tr> <tr> <td colspan="1">  <b>ca_cert</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Specifies the name of a file containing SSL certificate authority (CA) certificate(s).</div> <div>If the file exists, the server's certificate will be verified to be signed by one of these authorities.</div> <div>
<br>aliases: ssl_rootcert</div> </td> </tr> <tr> <td colspan="1">  <b>db</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Name of database to connect.</div> <div>
<br>aliases: login_db</div> </td> </tr> <tr> <td colspan="1">  <b>login_host</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Host running the database.</div> <div>If you have connection issues when using <code>localhost</code>, try to use <code>127.0.0.1</code> instead.</div> </td> </tr> <tr> <td colspan="1">  <b>login_password</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The password this module should use to establish its PostgreSQL session.</div> </td> </tr> <tr> <td colspan="1">  <b>login_unix_socket</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Path to a Unix domain socket for local connections.</div> </td> </tr> <tr> <td colspan="1">  <b>login_user</b>  <div> <span>string</span> </div> </td> <td> <b>Default:</b><br><div>"postgres"</div> </td> <td> <div>The username this module should use to establish its PostgreSQL session.</div> </td> </tr> <tr> <td colspan="1">  <b>name</b>  <div> <span>string</span> / <span>required</span> </div> </td> <td> </td> <td> <div>Name of PostgreSQL server parameter. Pay attention that parameters are case sensitive (see examples below).</div> </td> </tr> <tr> <td colspan="1">  <b>port</b>  <div> <span>integer</span> </div> </td> <td> <b>Default:</b><br><div>5432</div> </td> <td> <div>Database port to connect to.</div> <div>
<br>aliases: login_port</div> </td> </tr> <tr> <td colspan="1">  <b>reset</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Restore parameter to initial state (boot_val). Mutually exclusive with <em>value</em>.</div> </td> </tr> <tr> <td colspan="1">  <b>session_role</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Switch to session_role after connecting. The specified session_role must be a role that the current login_user is a member of.</div> <div>Permissions checking for SQL commands is carried out as though the session_role were the one that had logged in originally.</div> </td> </tr> <tr> <td colspan="1">  <b>ssl_mode</b>  <div> <span>string</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>allow</li> <li>disable</li> <li><div>
<b>prefer</b> ←</div></li> <li>require</li> <li>verify-ca</li> <li>verify-full</li> </ul> </td> <td> <div>Determines whether or with what priority a secure SSL TCP/IP connection will be negotiated with the server.</div> <div>See <a href="https://www.postgresql.org/docs/current/static/libpq-ssl.html">https://www.postgresql.org/docs/current/static/libpq-ssl.html</a> for more information on the modes.</div> <div>Default of <code>prefer</code> matches libpq default.</div> </td> </tr> <tr> <td colspan="1">  <b>trust_input</b>  <div> <span>boolean</span> </div> <div> added in 0.2.0 of community.postgresql </div> </td> <td> <ul>
<b>Choices:</b> <li>no</li> <li><div>
<b>yes</b> ←</div></li> </ul> </td> <td> <div>If <code>no</code>, check whether values of parameters are potentially dangerous.</div> <div>It makes sense to use <code>no</code> only when SQL injections are possible.</div> </td> </tr> <tr> <td colspan="1">  <b>value</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Parameter value to set.</div> <div>To remove parameter string from postgresql.auto.conf and reload the server configuration you must pass <em>value=default</em>. With <em>value=default</em> the playbook always returns changed is true.</div> </td> </tr> </table> <br>  <h2 id="notes">Notes</h2> <div class="admonition note"> <p class="admonition-title">Note</p> <ul class="simple"> <li>Supported version of PostgreSQL is 9.4 and later.</li> <li>Supports <code>check_mode</code>.</li> <li>Pay attention, change setting with ‘postmaster’ context can return changed is true when actually nothing changes because the same value may be presented in several different form, for example, 1024MB, 1GB, etc. However in pg_settings system view it can be defined like 131072 number of 8kB pages. The final check of the parameter value cannot compare it because the server was not restarted and the value in pg_settings is not updated yet.</li> <li>For some parameters restart of PostgreSQL server is required. See official documentation <a class="reference external" href="https://www.postgresql.org/docs/current/view-pg-settings.html">https://www.postgresql.org/docs/current/view-pg-settings.html</a>.</li> <li>The default authentication assumes that you are either logging in as or sudo’ing to the <code>postgres</code> account on the host.</li> <li>To avoid “Peer authentication failed for user postgres” error, use postgres user as a <em>become_user</em>.</li> <li>This module uses psycopg2, a Python PostgreSQL database adapter. You must ensure that psycopg2 is installed on the host before using this module.</li> <li>If the remote host is the PostgreSQL server (which is the default case), then PostgreSQL must also be installed on the remote host.</li> <li>For Ubuntu-based systems, install the postgresql, libpq-dev, and python-psycopg2 packages on the remote host before using this module.</li> <li>The ca_cert parameter requires at least Postgres version 8.4 and <em>psycopg2</em> version 2.4.3.</li> </ul> </div>   <h2 id="see-also">See Also</h2> <div class="admonition seealso"> <p class="admonition-title">See also</p> <dl class="simple"> <dt><a class="reference internal" href="postgresql_info_module.html#ansible-collections-community-postgresql-postgresql-info-module"><span class="std std-ref">community.postgresql.postgresql_info</span></a></dt>
<dd>
<p>The official documentation on the <strong>community.postgresql.postgresql_info</strong> module.</p> </dd> <dt><a class="reference external" href="https://www.postgresql.org/docs/current/runtime-config.html">PostgreSQL server configuration</a></dt>
<dd>
<p>General information about PostgreSQL server configuration.</p> </dd> <dt><a class="reference external" href="https://www.postgresql.org/docs/current/view-pg-settings.html">PostgreSQL view pg_settings reference</a></dt>
<dd>
<p>Complete reference of the pg_settings view documentation.</p> </dd> <dt><a class="reference external" href="https://www.postgresql.org/docs/current/sql-altersystem.html">PostgreSQL ALTER SYSTEM command reference</a></dt>
<dd>
<p>Complete reference of the ALTER SYSTEM command documentation.</p> </dd> </dl> </div>   <h2 id="examples">Examples</h2> <pre data-language="yaml+jinja">- name: Restore wal_keep_segments parameter to initial state
  community.postgresql.postgresql_set:
    name: wal_keep_segments
    reset: yes

# Set work_mem parameter to 32MB and show what's been changed and restart is required or not
# (output example: "msg": "work_mem 4MB &gt;&gt; 64MB restart_req: False")
- name: Set work mem parameter
  community.postgresql.postgresql_set:
    name: work_mem
    value: 32mb
  register: set

- name: Print the result if the setting changed
  ansible.builtin.debug:
    msg: "{{ set.name }} {{ set.prev_val_pretty }} &gt;&gt; {{ set.value_pretty }} restart_req: {{ set.restart_required }}"
  when: set.changed
# Ensure that the restart of PostgreSQL server must be required for some parameters.
# In this situation you see the same parameter in prev_val_pretty and value_pretty, but 'changed=True'
# (If you passed the value that was different from the current server setting).

- name: Set log_min_duration_statement parameter to 1 second
  community.postgresql.postgresql_set:
    name: log_min_duration_statement
    value: 1s

- name: Set wal_log_hints parameter to default value (remove parameter from postgresql.auto.conf)
  community.postgresql.postgresql_set:
    name: wal_log_hints
    value: default

- name: Set TimeZone parameter (careful, case sensitive)
  community.postgresql.postgresql_set:
    name: TimeZone
    value: 'Europe/Paris'
</pre>   <h2 id="return-values">Return Values</h2> <p>Common return values are documented <a class="reference internal" href="../../../reference_appendices/common_return_values.html#common-return-values"><span class="std std-ref">here</span></a>, the following are the fields unique to this module:</p> <table class="documentation-table"> <tr> <th colspan="1">Key</th> <th>Returned</th> <th width="100%">Description</th> </tr> <tr> <td colspan="1">  <b>context</b>  <div> <span>string</span> </div> </td> <td>always</td> <td> <div>PostgreSQL setting context.</div> <br> <div><b>Sample:</b></div> <div>user</div> </td> </tr> <tr> <td colspan="1">  <b>name</b>  <div> <span>string</span> </div> </td> <td>always</td> <td> <div>Name of PostgreSQL server parameter.</div> <br> <div><b>Sample:</b></div> <div>shared_buffers</div> </td> </tr> <tr> <td colspan="1">  <b>prev_val_pretty</b>  <div> <span>string</span> </div> </td> <td>always</td> <td> <div>Information about previous state of the parameter.</div> <br> <div><b>Sample:</b></div> <div>4MB</div> </td> </tr> <tr> <td colspan="1">  <b>restart_required</b>  <div> <span>boolean</span> </div> </td> <td>always</td> <td> <div>Information about parameter current state.</div> <br> <div><b>Sample:</b></div> <div>True</div> </td> </tr> <tr> <td colspan="1">  <b>value</b>  <div> <span>dictionary</span> </div> </td> <td>always</td> <td> <div>Dictionary that contains the current parameter value (at the time of playbook finish).</div> <div>Pay attention that for real change some parameters restart of PostgreSQL server is required.</div> <div>Returns the current value in the check mode.</div> <br> <div><b>Sample:</b></div> <div>{'unit': 'b', 'value': 67108864}</div> </td> </tr> <tr> <td colspan="1">  <b>value_pretty</b>  <div> <span>string</span> </div> </td> <td>always</td> <td> <div>Information about current state of the parameter.</div> <br> <div><b>Sample:</b></div> <div>64MB</div> </td> </tr> </table> <br><br> <h3 id="authors">Authors</h3> <ul class="simple"> <li>Andrew Klychkov (@Andersson007)</li> </ul><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2012&ndash;2018 Michael DeHaan<br>&copy; 2018&ndash;2021 Red Hat, Inc.<br>Licensed under the GNU General Public License version 3.<br>
    <a href="https://docs.ansible.com/ansible/latest/collections/community/postgresql/postgresql_set_module.html" class="_attribution-link">https://docs.ansible.com/ansible/latest/collections/community/postgresql/postgresql_set_module.html</a>
  </p>
</div>
