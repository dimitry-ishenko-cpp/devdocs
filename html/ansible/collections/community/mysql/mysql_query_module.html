<h1 id="community-mysql-mysql-query-run-mysql-queries">community.mysql.mysql_query – Run MySQL queries</h1> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This plugin is part of the <a class="reference external" href="https://galaxy.ansible.com/community/mysql">community.mysql collection</a> (version 2.3.1).</p> <p>You might already have this collection installed if you are using the <code>ansible</code> package. It is not included in <code>ansible-core</code>. To check whether it is installed, run <code>ansible-galaxy collection list</code>.</p> <p>To install it, use: <code>ansible-galaxy collection install community.mysql</code>.</p> <p>To use it in a playbook, specify: <code>community.mysql.mysql_query</code>.</p> </div> <div class="versionadded"> <p><span class="versionmodified added">New in version 0.1.0: </span>of community.mysql</p> </div>  <ul class="simple"> <li><a class="reference internal" href="#synopsis" id="id1">Synopsis</a></li> <li><a class="reference internal" href="#requirements" id="id2">Requirements</a></li> <li><a class="reference internal" href="#parameters" id="id3">Parameters</a></li> <li><a class="reference internal" href="#notes" id="id4">Notes</a></li> <li><a class="reference internal" href="#see-also" id="id5">See Also</a></li> <li><a class="reference internal" href="#examples" id="id6">Examples</a></li> <li><a class="reference internal" href="#return-values" id="id7">Return Values</a></li> </ul>   <h2 id="synopsis">Synopsis</h2> <ul class="simple"> <li>Runs arbitrary MySQL queries.</li> <li>Pay attention, the module does not support check mode! All queries will be executed in autocommit mode.</li> <li>To run SQL queries from a file, use <a class="reference internal" href="mysql_db_module.html#ansible-collections-community-mysql-mysql-db-module"><span class="std std-ref">community.mysql.mysql_db</span></a> module.</li> </ul>   <h2 id="requirements">Requirements</h2> <p>The below requirements are needed on the host that executes this module.</p> <ul class="simple"> <li>PyMySQL (Python 2.7 and Python 3.X), or</li> <li>MySQLdb (Python 2.x)</li> </ul>   <h2 id="parameters">Parameters</h2> <table class="documentation-table"> <tr> <th colspan="1">Parameter</th> <th>Choices/Defaults</th> <th width="100%">Comments</th> </tr> <tr> <td colspan="1">  <b>ca_cert</b>  <div> <span>path</span> </div> </td> <td> </td> <td> <div>The path to a Certificate Authority (CA) certificate. This option, if used, must specify the same certificate as used by the server.</div> <div>
<br>aliases: ssl_ca</div> </td> </tr> <tr> <td colspan="1">  <b>check_hostname</b>  <div> <span>boolean</span> </div> <div> added in 1.1.0 of community.mysql </div> </td> <td> <ul>
<b>Choices:</b> <li>no</li> <li>yes</li> </ul> </td> <td> <div>Whether to validate the server host name when an SSL connection is required. Corresponds to MySQL CLIs <code>--ssl</code> switch.</div> <div>Setting this to <code>false</code> disables hostname verification. Use with caution.</div> <div>Requires pymysql &gt;= 0.7.11.</div> <div>This option has no effect on MySQLdb.</div> </td> </tr> <tr> <td colspan="1">  <b>client_cert</b>  <div> <span>path</span> </div> </td> <td> </td> <td> <div>The path to a client public key certificate.</div> <div>
<br>aliases: ssl_cert</div> </td> </tr> <tr> <td colspan="1">  <b>client_key</b>  <div> <span>path</span> </div> </td> <td> </td> <td> <div>The path to the client private key.</div> <div>
<br>aliases: ssl_key</div> </td> </tr> <tr> <td colspan="1">  <b>config_file</b>  <div> <span>path</span> </div> </td> <td> <b>Default:</b><br><div>"~/.my.cnf"</div> </td> <td> <div>Specify a config file from which user and password are to be read.</div> </td> </tr> <tr> <td colspan="1">  <b>connect_timeout</b>  <div> <span>integer</span> </div> </td> <td> <b>Default:</b><br><div>30</div> </td> <td> <div>The connection timeout when connecting to the MySQL server.</div> </td> </tr> <tr> <td colspan="1">  <b>login_db</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Name of database to connect to and run queries against.</div> </td> </tr> <tr> <td colspan="1">  <b>login_host</b>  <div> <span>string</span> </div> </td> <td> <b>Default:</b><br><div>"localhost"</div> </td> <td> <div>Host running the database.</div> <div>In some cases for local connections the <em>login_unix_socket=/path/to/mysqld/socket</em>, that is usually <code>/var/run/mysqld/mysqld.sock</code>, needs to be used instead of <em>login_host=localhost</em>.</div> </td> </tr> <tr> <td colspan="1">  <b>login_password</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The password used to authenticate with.</div> </td> </tr> <tr> <td colspan="1">  <b>login_port</b>  <div> <span>integer</span> </div> </td> <td> <b>Default:</b><br><div>3306</div> </td> <td> <div>Port of the MySQL server. Requires <em>login_host</em> be defined as other than localhost if login_port is used.</div> </td> </tr> <tr> <td colspan="1">  <b>login_unix_socket</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The path to a Unix domain socket for local connections.</div> </td> </tr> <tr> <td colspan="1">  <b>login_user</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The username used to authenticate with.</div> </td> </tr> <tr> <td colspan="1">  <b>named_args</b>  <div> <span>dictionary</span> </div> </td> <td> </td> <td> <div>Dictionary of key-value arguments to pass to the query.</div> <div>Mutually exclusive with <em>positional_args</em>.</div> </td> </tr> <tr> <td colspan="1">  <b>positional_args</b>  <div> <span>list</span> / <span>elements=string</span> </div> </td> <td> </td> <td> <div>List of values to be passed as positional arguments to the query.</div> <div>Mutually exclusive with <em>named_args</em>.</div> </td> </tr> <tr> <td colspan="1">  <b>query</b>  <div> <span>raw</span> / <span>required</span> </div> </td> <td> </td> <td> <div>SQL query to run. Multiple queries can be passed using YAML list syntax.</div> <div>Must be a string or YAML list containing strings.</div> </td> </tr> <tr> <td colspan="1">  <b>single_transaction</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Where passed queries run in a single transaction (<code>yes</code>) or commit them one-by-one (<code>no</code>).</div> </td> </tr> </table> <br>  <h2 id="notes">Notes</h2> <div class="admonition note"> <p class="admonition-title">Note</p> <ul class="simple"> <li>Requires the PyMySQL (Python 2.7 and Python 3.X) or MySQL-python (Python 2.X) package installed on the remote host. The Python package may be installed with apt-get install python-pymysql (Ubuntu; see <a class="reference internal" href="../../ansible/builtin/apt_module.html#ansible-collections-ansible-builtin-apt-module"><span class="std std-ref">ansible.builtin.apt</span></a>) or yum install python2-PyMySQL (RHEL/CentOS/Fedora; see <a class="reference internal" href="../../ansible/builtin/yum_module.html#ansible-collections-ansible-builtin-yum-module"><span class="std std-ref">ansible.builtin.yum</span></a>). You can also use dnf install python2-PyMySQL for newer versions of Fedora; see <a class="reference internal" href="../../ansible/builtin/dnf_module.html#ansible-collections-ansible-builtin-dnf-module"><span class="std std-ref">ansible.builtin.dnf</span></a>.</li> <li>Be sure you have PyMySQL or MySQLdb library installed on the target machine for the Python interpreter Ansible uses, for example, if it is Python 3, you must install the library for Python 3. You can also change the interpreter. For more information, see <a class="reference external" href="../../../reference_appendices/interpreter_discovery.html">https://docs.ansible.com/ansible/latest/reference_appendices/interpreter_discovery.html</a>.</li> <li>Both <code>login_password</code> and <code>login_user</code> are required when you are passing credentials. If none are present, the module will attempt to read the credentials from <code>~/.my.cnf</code>, and finally fall back to using the MySQL default login of ‘root’ with no password.</li> <li>If there are problems with local connections, using <em>login_unix_socket=/path/to/mysqld/socket</em> instead of <em>login_host=localhost</em> might help. As an example, the default MariaDB installation of version 10.4 and later uses the unix_socket authentication plugin by default that without using <em>login_unix_socket=/var/run/mysqld/mysqld.sock</em> (the default path) causes the error <code>Host '127.0.0.1' is not allowed to connect to this MariaDB server</code>.</li> <li>Alternatively, you can use the mysqlclient library instead of MySQL-python (MySQLdb) which supports both Python 2.X and Python &gt;=3.5. See <a class="reference external" href="https://pypi.org/project/mysqlclient/">https://pypi.org/project/mysqlclient/</a> how to install it.</li> </ul> </div>   <h2 id="see-also">See Also</h2> <div class="admonition seealso"> <p class="admonition-title">See also</p> <dl class="simple"> <dt><a class="reference internal" href="mysql_db_module.html#ansible-collections-community-mysql-mysql-db-module"><span class="std std-ref">community.mysql.mysql_db</span></a></dt>
<dd>
<p>The official documentation on the <strong>community.mysql.mysql_db</strong> module.</p> </dd> </dl> </div>   <h2 id="examples">Examples</h2> <pre data-language="yaml+jinja">- name: Simple select query to acme db
  community.mysql.mysql_query:
    login_db: acme
    query: SELECT * FROM orders

- name: Select query to db acme with positional arguments
  community.mysql.mysql_query:
    login_db: acme
    query: SELECT * FROM acme WHERE id = %s AND story = %s
    positional_args:
    - 1
    - test

- name: Select query to test_db with named_args
  community.mysql.mysql_query:
    login_db: test_db
    query: SELECT * FROM test WHERE id = %(id_val)s AND story = %(story_val)s
    named_args:
      id_val: 1
      story_val: test

- name: Run several insert queries against db test_db in single transaction
  community.mysql.mysql_query:
    login_db: test_db
    query:
    - INSERT INTO articles (id, story) VALUES (2, 'my_long_story')
    - INSERT INTO prices (id, price) VALUES (123, '100.00')
    single_transaction: yes
</pre>   <h2 id="return-values">Return Values</h2> <p>Common return values are documented <a class="reference internal" href="../../../reference_appendices/common_return_values.html#common-return-values"><span class="std std-ref">here</span></a>, the following are the fields unique to this module:</p> <table class="documentation-table"> <tr> <th colspan="1">Key</th> <th>Returned</th> <th width="100%">Description</th> </tr> <tr> <td colspan="1">  <b>executed_queries</b>  <div> <span>list</span> / <span>elements=string</span> </div> </td> <td>always</td> <td> <div>List of executed queries.</div> <br> <div><b>Sample:</b></div> <div>['SELECT * FROM bar', 'UPDATE bar SET id = 1 WHERE id = 2']</div> </td> </tr> <tr> <td colspan="1">  <b>query_result</b>  <div> <span>list</span> / <span>elements=string</span> </div> </td> <td>changed</td> <td> <div>List of lists (sublist for each query) containing dictionaries in column:value form representing returned rows.</div> <br> <div><b>Sample:</b></div> <div>[[{'Column': 'Value1'}, {'Column': 'Value2'}], [{'ID': 1}, {'ID': 2}]]</div> </td> </tr> <tr> <td colspan="1">  <b>rowcount</b>  <div> <span>list</span> / <span>elements=string</span> </div> </td> <td>changed</td> <td> <div>Number of affected rows for each subquery.</div> <br> <div><b>Sample:</b></div> <div>[5, 1]</div> </td> </tr> </table> <br><br> <h3 id="authors">Authors</h3> <ul class="simple"> <li>Andrew Klychkov (@Andersson007)</li> </ul><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2012&ndash;2018 Michael DeHaan<br>&copy; 2018&ndash;2021 Red Hat, Inc.<br>Licensed under the GNU General Public License version 3.<br>
    <a href="https://docs.ansible.com/ansible/latest/collections/community/mysql/mysql_query_module.html" class="_attribution-link">https://docs.ansible.com/ansible/latest/collections/community/mysql/mysql_query_module.html</a>
  </p>
</div>
