<section id="community-mysql-mysql-user-module-adds-or-removes-a-user-from-a-mysql-or-mariadb-database"> <h1>community.mysql.mysql_user module – Adds or removes a user from a MySQL or MariaDB database</h1> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This module is part of the <a class="reference external" href="https://galaxy.ansible.com/ui/repo/published/community/mysql/">community.mysql collection</a> (version 3.10.3).</p> <p>You might already have this collection installed if you are using the <code>ansible</code> package. It is not included in <code>ansible-core</code>. To check whether it is installed, run <code>ansible-galaxy collection list</code>.</p> <p>To install it, use: <code>ansible-galaxy collection install community.mysql</code>. You need further requirements to be able to use this module, see <a class="reference internal" href="#ansible-collections-community-mysql-mysql-user-module-requirements"><span class="std std-ref">Requirements</span></a> for details.</p> <p>To use it in a playbook, specify: <code>community.mysql.mysql_user</code>.</p> </div>  <ul class="simple"> <li><a class="reference internal" href="#synopsis" id="id1">Synopsis</a></li> <li><a class="reference internal" href="#requirements" id="id2">Requirements</a></li> <li><a class="reference internal" href="#parameters" id="id3">Parameters</a></li> <li><a class="reference internal" href="#attributes" id="id4">Attributes</a></li> <li><a class="reference internal" href="#notes" id="id5">Notes</a></li> <li><a class="reference internal" href="#see-also" id="id6">See Also</a></li> <li><a class="reference internal" href="#examples" id="id7">Examples</a></li> </ul>  <section id="synopsis"> <h2>Synopsis</h2> <ul class="simple"> <li>Adds or removes a user from a MySQL or MariaDB database.</li> </ul> </section> <section id="requirements"> <h2 id="ansible-collections-community-mysql-mysql-user-module-requirements">Requirements</h2> <p>The below requirements are needed on the host that executes this module.</p> <ul class="simple"> <li>PyMySQL (Python 2.7 and Python 3.x)</li> </ul> </section> <section id="parameters"> <h2>Parameters</h2> <table class="longtable ansible-option-table docutils align-default" style="width: 100%"> <thead> <tr>
<th class="head"><p>Parameter</p></th> <th class="head"><p>Comments</p></th> </tr> </thead>  <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-mysql-mysql-user-module-parameter-append-privs"><strong>append_privs</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">boolean</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Append the privileges defined by priv to the existing ones for this user instead of overwriting existing ones. Mutually exclusive with <em>subtract_privs</em>.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li>
<code><strong>false</strong></code> <span class="ansible-option-choices-default-mark">← (default)</span>
</li> <li><code>true</code></li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-mysql-mysql-user-module-parameter-attributes"><strong>attributes</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">dictionary</span></p> <p><em class="ansible-option-versionadded">added in community.mysql 3.9.0</em></p> </div></td> <td><div class="ansible-option-cell">
<p>Create, update, or delete user attributes (arbitrary ‘key: value’ comments) for the user.</p> <p>MySQL server must support the INFORMATION_SCHEMA.USER_ATTRIBUTES table. Provided since MySQL 8.0.</p> <p>To delete an existing attribute, set its value to null.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell">  
<p class="ansible-option-title" id="ansible-collections-community-mysql-mysql-user-module-parameter-ssl-ca"><strong id="ansible-collections-community-mysql-mysql-user-module-parameter-ca-cert">ca_cert</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-aliases">aliases: ssl_ca</span></p> <p class="ansible-option-type-line"><span class="ansible-option-type">path</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The path to a Certificate Authority (CA) certificate. This option, if used, must specify the same certificate as used by the server.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-mysql-mysql-user-module-parameter-check-hostname"><strong>check_hostname</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">boolean</span></p> <p><em class="ansible-option-versionadded">added in community.mysql 1.1.0</em></p> </div></td> <td><div class="ansible-option-cell">
<p>Whether to validate the server host name when an SSL connection is required. Corresponds to MySQL CLIs <code>--ssl</code> switch.</p> <p>Setting this to <code>false</code> disables hostname verification. Use with caution.</p> <p>Requires pymysql &gt;= 0.7.11.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li><code>false</code></li> <li><code>true</code></li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-mysql-mysql-user-module-parameter-check-implicit-admin"><strong>check_implicit_admin</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">boolean</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Check if mysql allows login as root/nopassword before trying supplied credentials.</p> <p>If success, passed <em>login_user</em>/<em>login_password</em> will be ignored.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li>
<code><strong>false</strong></code> <span class="ansible-option-choices-default-mark">← (default)</span>
</li> <li><code>true</code></li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell">  
<p class="ansible-option-title" id="ansible-collections-community-mysql-mysql-user-module-parameter-ssl-cert"><strong id="ansible-collections-community-mysql-mysql-user-module-parameter-client-cert">client_cert</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-aliases">aliases: ssl_cert</span></p> <p class="ansible-option-type-line"><span class="ansible-option-type">path</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The path to a client public key certificate.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell">  
<p class="ansible-option-title" id="ansible-collections-community-mysql-mysql-user-module-parameter-ssl-key"><strong id="ansible-collections-community-mysql-mysql-user-module-parameter-client-key">client_key</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-aliases">aliases: ssl_key</span></p> <p class="ansible-option-type-line"><span class="ansible-option-type">path</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The path to the client private key.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-mysql-mysql-user-module-parameter-column-case-sensitive"><strong>column_case_sensitive</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">boolean</span></p> <p><em class="ansible-option-versionadded">added in community.mysql 3.8.0</em></p> </div></td> <td><div class="ansible-option-cell">
<p>The default is <code>false</code>.</p> <p>When <code>true</code>, the module will not uppercase the field names in the privileges.</p> <p>When <code>false</code>, the field names will be upper-cased. This is the default</p> <p>This feature was introduced because MySQL 8 and above uses case sensitive fields names in privileges.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li><code>false</code></li> <li><code>true</code></li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-mysql-mysql-user-module-parameter-config-file"><strong>config_file</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">path</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Specify a config file from which user and password are to be read.</p> <p>The default config file, <code>~/.my.cnf</code>, if it exists, will be read, even if <em>config_file</em> is not specified.</p> <p>The default config file, <code>~/.my.cnf</code>, if it exists, must contain a <code>[client]</code> section as a MySQL connector requirement.</p> <p>To prevent the default config file from being read, set <em>config_file</em> to be an empty string.</p> <p class="ansible-option-line"><strong class="ansible-option-default-bold">Default:</strong> <code>"~/.my.cnf"</code></p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-mysql-mysql-user-module-parameter-connect-timeout"><strong>connect_timeout</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">integer</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The connection timeout when connecting to the MySQL server.</p> <p class="ansible-option-line"><strong class="ansible-option-default-bold">Default:</strong> <code>30</code></p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-mysql-mysql-user-module-parameter-encrypted"><strong>encrypted</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">boolean</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Indicate that the ‘password’ field is a `mysql_native_password` hash.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li>
<code><strong>false</strong></code> <span class="ansible-option-choices-default-mark">← (default)</span>
</li> <li><code>true</code></li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-mysql-mysql-user-module-parameter-force-context"><strong>force_context</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">boolean</span></p> <p><em class="ansible-option-versionadded">added in community.mysql 3.1.0</em></p> </div></td> <td><div class="ansible-option-cell">
<p>Sets the С(mysql) system database as context for the executed statements (it will be used as a database to connect to). Useful if you use binlog / replication filters in MySQL as per default the statements can not be caught by a binlog / replication filter, they require a database to be set to work, otherwise the replication can break down.</p> <p>See <a class="reference external" href="https://dev.mysql.com/doc/refman/8.0/en/replication-options-binary-log.html#option_mysqld_binlog-ignore-db">https://dev.mysql.com/doc/refman/8.0/en/replication-options-binary-log.html#option_mysqld_binlog-ignore-db</a> for a description on how binlog filters work (filtering on the primary).</p> <p>See <a class="reference external" href="https://dev.mysql.com/doc/refman/8.0/en/replication-options-replica.html#option_mysqld_replicate-ignore-db">https://dev.mysql.com/doc/refman/8.0/en/replication-options-replica.html#option_mysqld_replicate-ignore-db</a> for a description on how replication filters work (filtering on the replica).</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li>
<code><strong>false</strong></code> <span class="ansible-option-choices-default-mark">← (default)</span>
</li> <li><code>true</code></li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-mysql-mysql-user-module-parameter-host"><strong>host</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The ‘host’ part of the MySQL username.</p> <p class="ansible-option-line"><strong class="ansible-option-default-bold">Default:</strong> <code>"localhost"</code></p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-mysql-mysql-user-module-parameter-host-all"><strong>host_all</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">boolean</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Override the host option, making ansible apply changes to all hostnames for a given user.</p> <p>This option cannot be used when creating users.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li>
<code><strong>false</strong></code> <span class="ansible-option-choices-default-mark">← (default)</span>
</li> <li><code>true</code></li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-mysql-mysql-user-module-parameter-login-host"><strong>login_host</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Host running the database.</p> <p>In some cases for local connections the <em>login_unix_socket=/path/to/mysqld/socket</em>, that is usually <code>/var/run/mysqld/mysqld.sock</code>, needs to be used instead of <em>login_host=localhost</em>.</p> <p class="ansible-option-line"><strong class="ansible-option-default-bold">Default:</strong> <code>"localhost"</code></p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-mysql-mysql-user-module-parameter-login-password"><strong>login_password</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The password used to authenticate with.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-mysql-mysql-user-module-parameter-login-port"><strong>login_port</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">integer</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Port of the MySQL server. Requires <em>login_host</em> be defined as other than localhost if login_port is used.</p> <p class="ansible-option-line"><strong class="ansible-option-default-bold">Default:</strong> <code>3306</code></p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-mysql-mysql-user-module-parameter-login-unix-socket"><strong>login_unix_socket</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The path to a Unix domain socket for local connections.</p> <p>Use this parameter to avoid the <code>Please explicitly state intended protocol</code> error.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-mysql-mysql-user-module-parameter-login-user"><strong>login_user</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The username used to authenticate with.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell">  
<p class="ansible-option-title" id="ansible-collections-community-mysql-mysql-user-module-parameter-user"><strong id="ansible-collections-community-mysql-mysql-user-module-parameter-name">name</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-aliases">aliases: user</span></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span> / <span class="ansible-option-required">required</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Name of the user (role) to add or remove.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-mysql-mysql-user-module-parameter-password"><strong>password</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Set the user’s password. Only for <code>mysql_native_password</code> authentication. For other authentication plugins see the combination of <em>plugin</em>, <em>plugin_hash_string</em>, <em>plugin_auth_string</em>.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-mysql-mysql-user-module-parameter-password-expire"><strong>password_expire</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> <p><em class="ansible-option-versionadded">added in community.mysql 3.9.0</em></p> </div></td> <td><div class="ansible-option-cell">
<p><code>never</code> - <em>password</em> will never expire.</p> <p><code>default</code> - <em>password</em> is defined using global system variable <em>default_password_lifetime</em> setting.</p> <p><code>interval</code> - <em>password</em> will expire in days which is defined in <em>password_expire_interval</em>.</p> <p><code>now</code> - <em>password</em> will expire immediately.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li><code>"now"</code></li> <li><code>"never"</code></li> <li><code>"default"</code></li> <li><code>"interval"</code></li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-mysql-mysql-user-module-parameter-password-expire-interval"><strong>password_expire_interval</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">integer</span></p> <p><em class="ansible-option-versionadded">added in community.mysql 3.9.0</em></p> </div></td> <td><div class="ansible-option-cell">
<p>Number of days <em>password</em> will expire. Requires <em>password_expire=interval</em>.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-mysql-mysql-user-module-parameter-plugin"><strong>plugin</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> <p><em class="ansible-option-versionadded">added in community.mysql 0.1.0</em></p> </div></td> <td><div class="ansible-option-cell">
<p>User’s plugin to authenticate (``CREATE USER user IDENTIFIED WITH plugin``).</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-mysql-mysql-user-module-parameter-plugin-auth-string"><strong>plugin_auth_string</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> <p><em class="ansible-option-versionadded">added in community.mysql 0.1.0</em></p> </div></td> <td><div class="ansible-option-cell">
<p>User’s plugin auth_string (``CREATE USER user IDENTIFIED WITH plugin BY plugin_auth_string``).</p> <p>If <em>plugin</em> is ``pam`` (MariaDB) or ``auth_pam`` (MySQL) an optional <em>plugin_auth_string</em> can be used to choose a specific PAM service.</p> <p>You need to define a <em>salt</em> to have idempotence on password change with ``caching_sha2_password`` and ``sha256_password`` plugins.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-mysql-mysql-user-module-parameter-plugin-hash-string"><strong>plugin_hash_string</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> <p><em class="ansible-option-versionadded">added in community.mysql 0.1.0</em></p> </div></td> <td><div class="ansible-option-cell">
<p>User’s plugin hash string (``CREATE USER user IDENTIFIED WITH plugin AS plugin_hash_string``).</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-mysql-mysql-user-module-parameter-priv"><strong>priv</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">any</span></p> </div></td> <td><div class="ansible-option-cell">
<p>MySQL privileges string in the format: <code>db.table:priv1,priv2</code>.</p> <p>Multiple privileges can be specified by separating each one using a forward slash: <code>db.table1:priv/db.table2:priv</code>.</p> <p>The format is based on MySQL <code>GRANT</code> statement.</p> <p>Database and table names can be quoted, MySQL-style.</p> <p>If column privileges are used, the <code>priv1,priv2</code> part must be exactly as returned by a <code>SHOW GRANT</code> statement. If not followed, the module will always report changes. It includes grouping columns by permission (<code>SELECT(col1,col2</code>) instead of <code>SELECT(col1</code>,SELECT(col2))).</p> <p>Can be passed as a dictionary (see the examples).</p> <p>Supports GRANTs for procedures and functions (see the examples).</p> <p>Note: If you pass the same <code>db.table</code> combination to this parameter two or more times with different privileges, for example, <code>'*.*:SELECT/*.*:SHOW VIEW'</code>, only the last one will be applied, in this example, it will be <code>SHOW VIEW</code> respectively. Use <code>'*.*:SELECT,SHOW VIEW'</code> instead to apply both.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-mysql-mysql-user-module-parameter-resource-limits"><strong>resource_limits</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">dictionary</span></p> <p><em class="ansible-option-versionadded">added in community.mysql 0.1.0</em></p> </div></td> <td><div class="ansible-option-cell">
<p>Limit the user for certain server resources. Provided since MySQL 5.6 / MariaDB 10.2.</p> <p>Available options are <code>MAX_QUERIES_PER_HOUR: num</code>, <code>MAX_UPDATES_PER_HOUR: num</code>, <code>MAX_CONNECTIONS_PER_HOUR: num</code>, <code>MAX_USER_CONNECTIONS: num</code>, <code>MAX_STATEMENT_TIME: num</code> (supported only for MariaDB since collection version 3.7.0).</p> <p>Used when <em>state=present</em>, ignored otherwise.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-mysql-mysql-user-module-parameter-salt"><strong>salt</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> <p><em class="ansible-option-versionadded">added in community.mysql 3.10.0</em></p> </div></td> <td><div class="ansible-option-cell">
<p>Salt used to generate password hash from <em>plugin_auth_string</em>.</p> <p>Salt length must be 20 characters.</p> <p>Salt only support ``caching_sha2_password`` or ``sha256_password`` authentication <em>plugin</em>.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-mysql-mysql-user-module-parameter-session-vars"><strong>session_vars</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">dictionary</span></p> <p><em class="ansible-option-versionadded">added in community.mysql 3.6.0</em></p> </div></td> <td><div class="ansible-option-cell">
<p>Dictionary of session variables in form of <code>variable: value</code> to set at the beginning of module execution.</p> <p>Cannot be used to set global variables, use the <a class="reference internal" href="mysql_variables_module.html#ansible-collections-community-mysql-mysql-variables-module"><span class="std std-ref">community.mysql.mysql_variables</span></a> module instead.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-mysql-mysql-user-module-parameter-sql-log-bin"><strong>sql_log_bin</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">boolean</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Whether binary logging should be enabled or disabled for the connection.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li><code>false</code></li> <li>
<code><strong>true</strong></code> <span class="ansible-option-choices-default-mark">← (default)</span>
</li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-mysql-mysql-user-module-parameter-state"><strong>state</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Whether the user should exist.</p> <p>When <code>absent</code>, removes the user.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li><code>"absent"</code></li> <li>
<code><strong>"present"</strong></code> <span class="ansible-option-choices-default-mark">← (default)</span>
</li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-mysql-mysql-user-module-parameter-subtract-privs"><strong>subtract_privs</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">boolean</span></p> <p><em class="ansible-option-versionadded">added in community.mysql 3.2.0</em></p> </div></td> <td><div class="ansible-option-cell">
<p>Revoke the privileges defined by the <em>priv</em> option and keep other existing privileges. If set, invalid privileges in <em>priv</em> are ignored. Mutually exclusive with <em>append_privs</em>.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li>
<code><strong>false</strong></code> <span class="ansible-option-choices-default-mark">← (default)</span>
</li> <li><code>true</code></li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-mysql-mysql-user-module-parameter-tls-requires"><strong>tls_requires</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">dictionary</span></p> <p><em class="ansible-option-versionadded">added in community.mysql 1.0.0</em></p> </div></td> <td><div class="ansible-option-cell">
<p>Set requirement for secure transport as a dictionary of requirements (see the examples).</p> <p>Valid requirements are SSL, X509, SUBJECT, ISSUER, CIPHER.</p> <p>SUBJECT, ISSUER and CIPHER are complementary, and mutually exclusive with SSL and X509.</p> <p><a class="reference external" href="https://mariadb.com/kb/en/securing-connections-for-client-and-server/#requiring-tls">https://mariadb.com/kb/en/securing-connections-for-client-and-server/#requiring-tls</a>.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-mysql-mysql-user-module-parameter-update-password"><strong>update_password</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p><code>always</code> will update passwords if they differ. This affects <em>password</em> and the combination of <em>plugin</em>, <em>plugin_hash_string</em>, <em>plugin_auth_string</em>.</p> <p><code>on_create</code> will only set the password or the combination of <em>plugin</em>, <em>plugin_hash_string</em>, <em>plugin_auth_string</em> for newly created users.</p> <p><code>on_new_username</code> works like <code>on_create</code>, but it tries to reuse an existing password: If one different user with the same username exists, or multiple different users with the same username and equal <code>plugin</code> and <code>authentication_string</code> attribute, the existing <code>plugin</code> and <code>authentication_string</code> are used for the new user instead of the <em>password</em>, <em>plugin</em>, <em>plugin_hash_string</em> or <em>plugin_auth_string</em> argument.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li>
<code><strong>"always"</strong></code> <span class="ansible-option-choices-default-mark">← (default)</span>
</li> <li><code>"on_create"</code></li> <li><code>"on_new_username"</code></li> </ul> </div></td> </tr>  </table> </section> <section id="attributes"> <h2>Attributes</h2> <table class="longtable ansible-option-table docutils align-default" style="width: 100%"> <thead> <tr>
<th class="head"><p>Attribute</p></th> <th class="head"><p>Support</p></th> <th class="head"><p>Description</p></th> </tr> </thead>  <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-mysql-mysql-user-module-attribute-check-mode"><strong>check_mode</strong></p> 
</div></td> <td><div class="ansible-option-cell">
<p><strong class="ansible-attribute-support-label">Support: </strong><strong class="ansible-attribute-support-full">full</strong></p> </div></td> <td><div class="ansible-option-cell">
<p>Can run in check_mode and return changed status prediction without modifying target.</p> </div></td> </tr>  </table> </section> <section id="notes"> <h2>Notes</h2> <div class="admonition note"> <p class="admonition-title">Note</p> <ul class="simple"> <li>Compatible with MySQL or MariaDB.</li> <li>MySQL server installs with default <em>login_user</em> of <code>root</code> and no password. To secure this user as part of an idempotent playbook, you must create at least two tasks: 1) change the root user’s password, without providing any <em>login_user</em>/<em>login_password</em> details, 2) drop a <code>~/.my.cnf</code> file containing the new root credentials. Subsequent runs of the playbook will then succeed by reading the new credentials from the file.</li> <li>Currently, there is only support for the <code>mysql_native_password</code> encrypted password hash module.</li> <li>Requires the PyMySQL (Python 2.7 and Python 3.X) package installed on the remote host. The Python package may be installed with apt-get install python-pymysql (Ubuntu; see <a class="reference internal" href="../../ansible/builtin/apt_module.html#ansible-collections-ansible-builtin-apt-module"><span class="std std-ref">ansible.builtin.apt</span></a>) or yum install python2-PyMySQL (RHEL/CentOS/Fedora; see <a class="reference external" href="https://docs.ansible.com/ansible/9/collections/ansible/builtin/yum_module.html#ansible-collections-ansible-builtin-yum-module" title="(in Ansible v9)"><span class="xref std std-ref">ansible.builtin.yum</span></a>). You can also use dnf install python2-PyMySQL for newer versions of Fedora; see <a class="reference internal" href="../../ansible/builtin/dnf_module.html#ansible-collections-ansible-builtin-dnf-module"><span class="std std-ref">ansible.builtin.dnf</span></a>.</li> <li>Be sure you have PyMySQL library installed on the target machine for the Python interpreter Ansible discovers. For example if ansible discovers and uses Python 3, you need to install the Python 3 version of PyMySQL. If ansible discovers and uses Python 2, you need to install the Python 2 version of PyMySQL.</li> <li>If you have trouble, it may help to force Ansible to use the Python interpreter you need by specifying <code>ansible_python_interpreter</code>. For more information, see <a class="reference external" href="../../../reference_appendices/interpreter_discovery.html">https://docs.ansible.com/ansible/latest/reference_appendices/interpreter_discovery.html</a>.</li> <li>Both <code>login_password</code> and <code>login_user</code> are required when you are passing credentials. If none are present, the module will attempt to read the credentials from <code>~/.my.cnf</code>, and finally fall back to using the MySQL default login of ‘root’ with no password.</li> <li>If there are problems with local connections, using <em>login_unix_socket=/path/to/mysqld/socket</em> instead of <em>login_host=localhost</em> might help. As an example, the default MariaDB installation of version 10.4 and later uses the unix_socket authentication plugin by default that without using <em>login_unix_socket=/var/run/mysqld/mysqld.sock</em> (the default path) causes the error ``Host ‘127.0.0.1’ is not allowed to connect to this MariaDB server``.</li> <li>If credentials from the config file (for example, <code>/root/.my.cnf</code>) are not needed to connect to a database server, but the file exists and does not contain a <code>[client]</code> section, before any other valid directives, it will be read and this will cause the connection to fail, to prevent this set it to an empty string, (for example <code>config_file: ''</code>).</li> <li>To avoid the <code>Please explicitly state intended protocol</code> error, use the <em>login_unix_socket</em> argument, for example, <code>login_unix_socket: /run/mysqld/mysqld.sock</code>.</li> <li>Alternatively, to avoid using <em>login_unix_socket</em> argument on each invocation you can specify the socket path using the `socket` option in your MySQL config file (usually <code>~/.my.cnf</code>) on the destination host, for example <code>socket=/var/lib/mysql/mysql.sock</code>.</li> </ul> </div> </section> <section id="see-also"> <h2>See Also</h2> <div class="admonition seealso"> <p class="admonition-title">See also</p> <dl class="simple"> <dt><a class="reference internal" href="mysql_info_module.html#ansible-collections-community-mysql-mysql-info-module"><span class="std std-ref">community.mysql.mysql_info</span></a></dt>
<dd>
<p>Gather information about MySQL or MariaDB servers.</p> </dd> <dt><a class="reference external" href="https://dev.mysql.com/doc/refman/8.0/en/access-control.html">MySQL access control and account management reference</a></dt>
<dd>
<p>Complete reference of the MySQL access control and account management documentation.</p> </dd> <dt><a class="reference external" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html">MySQL provided privileges reference</a></dt>
<dd>
<p>Complete reference of the MySQL provided privileges documentation.</p> </dd> </dl> </div> </section> <section id="examples"> <h2>Examples</h2> <pre data-language="yaml+jinja"># If you encounter the "Please explicitly state intended protocol" error,
# use the login_unix_socket argument
- name: Removes anonymous user account for localhost
  community.mysql.mysql_user:
    name: ''
    host: localhost
    state: absent
    login_unix_socket: /run/mysqld/mysqld.sock

- name: Removes all anonymous user accounts
  community.mysql.mysql_user:
    name: ''
    host_all: true
    state: absent

- name: Create database user with name 'bob' and password '12345' with all database privileges
  community.mysql.mysql_user:
    name: bob
    password: 12345
    priv: '*.*:ALL'
    state: present

- name: Create database user using hashed password with all database privileges
  community.mysql.mysql_user:
    name: bob
    password: '*EE0D72C1085C46C5278932678FBE2C6A782821B4'
    encrypted: true
    priv: '*.*:ALL'
    state: present

# Set session var wsrep_on=off before creating the user
- name: Create database user with password and all database privileges and 'WITH GRANT OPTION'
  community.mysql.mysql_user:
    name: bob
    password: 12345
    priv: '*.*:ALL,GRANT'
    state: present
    session_vars:
      wsrep_on: off

- name: Create user with password, all database privileges and 'WITH GRANT OPTION' in db1 and db2
  community.mysql.mysql_user:
    state: present
    name: bob
    password: 12345dd
    priv:
      'db1.*': 'ALL,GRANT'
      'db2.*': 'ALL,GRANT'

# Use 'PROCEDURE' instead of 'FUNCTION' to apply GRANTs for a MySQL procedure instead.
- name: Grant a user the right to execute a function
  community.mysql.mysql_user:
    name: readonly
    password: 12345
    priv:
      FUNCTION my_db.my_function: EXECUTE
    state: present

- name: Modify user attributes, creating the attribute 'foo' and removing the attribute 'bar'
  community.mysql.mysql_user:
    name: bob
    attributes:
      foo: "foo"
      bar: null

- name: Modify user to require TLS connection with a valid client certificate
  community.mysql.mysql_user:
    name: bob
    tls_requires:
      x509:
    state: present

- name: Modify user to require TLS connection with a specific client certificate and cipher
  community.mysql.mysql_user:
    name: bob
    tls_requires:
      subject: '/CN=alice/O=MyDom, Inc./C=US/ST=Oregon/L=Portland'
      cipher: 'ECDHE-ECDSA-AES256-SHA384'

- name: Modify user to no longer require SSL
  community.mysql.mysql_user:
    name: bob
    tls_requires:

- name: Ensure no user named 'sally'@'localhost' exists, also passing in the auth credentials
  community.mysql.mysql_user:
    login_user: root
    login_password: 123456
    name: sally
    state: absent

# check_implicit_admin example
- name: &gt;
    Ensure no user named 'sally'@'localhost' exists, also passing in the auth credentials.
    If mysql allows root/nopassword login, try it without the credentials first.
    If it's not allowed, pass the credentials
  community.mysql.mysql_user:
    check_implicit_admin: true
    login_user: root
    login_password: 123456
    name: sally
    state: absent

- name: Ensure no user named 'sally' exists at all
  community.mysql.mysql_user:
    name: sally
    host_all: true
    state: absent

- name: Specify grants composed of more than one word
  community.mysql.mysql_user:
    name: replication
    password: 12345
    priv: "*.*:REPLICATION CLIENT"
    state: present

- name: Revoke all privileges for user 'bob' and password '12345'
  community.mysql.mysql_user:
    name: bob
    password: 12345
    priv: "*.*:USAGE"
    state: present

# Example privileges string format
# mydb.*:INSERT,UPDATE/anotherdb.*:SELECT/yetanotherdb.*:ALL

- name: Example using login_unix_socket to connect to server
  community.mysql.mysql_user:
    name: root
    password: abc123
    login_unix_socket: /var/run/mysqld/mysqld.sock

- name: Example of skipping binary logging while adding user 'bob'
  community.mysql.mysql_user:
    name: bob
    password: 12345
    priv: "*.*:USAGE"
    state: present
    sql_log_bin: false

- name: Create user 'bob' authenticated with plugin 'AWSAuthenticationPlugin'
  community.mysql.mysql_user:
    name: bob
    plugin: AWSAuthenticationPlugin
    plugin_hash_string: RDS
    priv: '*.*:ALL'
    state: present

- name: Create user 'bob' authenticated with plugin 'caching_sha2_password' and static salt
  community.mysql.mysql_user:
    name: bob
    plugin: caching_sha2_password
    plugin_auth_string: password
    salt: 1234567890abcdefghij

- name: Limit bob's resources to 10 queries per hour and 5 connections per hour
  community.mysql.mysql_user:
    name: bob
    resource_limits:
      MAX_QUERIES_PER_HOUR: 10
      MAX_CONNECTIONS_PER_HOUR: 5

- name: Ensure bob does not have the DELETE privilege
  community.mysql.mysql_user:
    name: bob
    subtract_privs: true
    priv:
      'db1.*': DELETE

# Example .my.cnf file for setting the root password
# [client]
# user=root
# password=n&lt;_665{vS43y
</pre> <section id="authors"> <h3>Authors</h3> <ul class="simple"> <li>Jonathan Mainguy (@Jmainguy)</li> <li>Benjamin Malynovytch (@bmalynovytch)</li> <li>Lukasz Tomaszkiewicz (@tomaszkiewicz)</li> <li>kmarse (@kmarse)</li> <li>Laurent Indermühle (@laurent-indermuehle)</li> </ul> </section> <section id="collection-links"> <h3>Collection links</h3> <ul class="ansible-links"> <li><span><a aria-role="button" class="ansible-link reference external" href="https://github.com/ansible-collections/community.mysql/issues" rel="noopener external" target="_blank">Issue Tracker</a></span></li> <li><span><a aria-role="button" class="ansible-link reference external" href="https://github.com/ansible-collections/community.mysql" rel="noopener external" target="_blank">Repository (Sources)</a></span></li> </ul> </section> </section> </section><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2012&ndash;2018 Michael DeHaan<br>&copy; 2018&ndash;2024 Red Hat, Inc.<br>Licensed under the GNU General Public License version 3.<br>
    <a href="https://docs.ansible.com/ansible/latest/collections/community/mysql/mysql_user_module.html" class="_attribution-link">https://docs.ansible.com/ansible/latest/collections/community/mysql/mysql_user_module.html</a>
  </p>
</div>
