<section id="community-mysql-mysql-role-module-adds-removes-or-updates-a-mysql-or-mariadb-role"> <h1>community.mysql.mysql_role module – Adds, removes, or updates a MySQL or MariaDB role</h1> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This module is part of the <a class="reference external" href="https://galaxy.ansible.com/ui/repo/published/community/mysql/">community.mysql collection</a> (version 3.10.3).</p> <p>You might already have this collection installed if you are using the <code>ansible</code> package. It is not included in <code>ansible-core</code>. To check whether it is installed, run <code>ansible-galaxy collection list</code>.</p> <p>To install it, use: <code>ansible-galaxy collection install community.mysql</code>. You need further requirements to be able to use this module, see <a class="reference internal" href="#ansible-collections-community-mysql-mysql-role-module-requirements"><span class="std std-ref">Requirements</span></a> for details.</p> <p>To use it in a playbook, specify: <code>community.mysql.mysql_role</code>.</p> </div> <p class="ansible-version-added">New in community.mysql 2.2.0</p>  <ul class="simple"> <li><a class="reference internal" href="#synopsis" id="id1">Synopsis</a></li> <li><a class="reference internal" href="#requirements" id="id2">Requirements</a></li> <li><a class="reference internal" href="#parameters" id="id3">Parameters</a></li> <li><a class="reference internal" href="#attributes" id="id4">Attributes</a></li> <li><a class="reference internal" href="#notes" id="id5">Notes</a></li> <li><a class="reference internal" href="#see-also" id="id6">See Also</a></li> <li><a class="reference internal" href="#examples" id="id7">Examples</a></li> </ul>  <section id="synopsis"> <h2>Synopsis</h2> <ul class="simple"> <li>Adds, removes, or updates a MySQL or MariaDB role.</li> <li>Roles are supported since MySQL 8.0.0 and MariaDB 10.0.5.</li> </ul> </section> <section id="requirements"> <h2 id="ansible-collections-community-mysql-mysql-role-module-requirements">Requirements</h2> <p>The below requirements are needed on the host that executes this module.</p> <ul class="simple"> <li>PyMySQL (Python 2.7 and Python 3.x)</li> </ul> </section> <section id="parameters"> <h2>Parameters</h2> <table class="longtable ansible-option-table docutils align-default" style="width: 100%"> <thead> <tr>
<th class="head"><p>Parameter</p></th> <th class="head"><p>Comments</p></th> </tr> </thead>  <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-mysql-mysql-role-module-parameter-admin"><strong>admin</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Supported by <strong>MariaDB</strong>.</p> <p>Name of the admin user of the role (the <em>login_user</em>, by default).</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-mysql-mysql-role-module-parameter-append-members"><strong>append_members</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">boolean</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Add members defined by the <em>members</em> option to the existing ones for this role instead of overwriting them.</p> <p>Mutually exclusive with the <em>detach_members</em> and <em>admin</em> option.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li>
<code><strong>false</strong></code> <span class="ansible-option-choices-default-mark">← (default)</span>
</li> <li><code>true</code></li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-mysql-mysql-role-module-parameter-append-privs"><strong>append_privs</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">boolean</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Append the privileges defined by the <em>priv</em> option to the existing ones for this role instead of overwriting them. Mutually exclusive with <em>subtract_privs</em>.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li>
<code><strong>false</strong></code> <span class="ansible-option-choices-default-mark">← (default)</span>
</li> <li><code>true</code></li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell">  
<p class="ansible-option-title" id="ansible-collections-community-mysql-mysql-role-module-parameter-ssl-ca"><strong id="ansible-collections-community-mysql-mysql-role-module-parameter-ca-cert">ca_cert</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-aliases">aliases: ssl_ca</span></p> <p class="ansible-option-type-line"><span class="ansible-option-type">path</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The path to a Certificate Authority (CA) certificate. This option, if used, must specify the same certificate as used by the server.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-mysql-mysql-role-module-parameter-check-hostname"><strong>check_hostname</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">boolean</span></p> <p><em class="ansible-option-versionadded">added in community.mysql 1.1.0</em></p> </div></td> <td><div class="ansible-option-cell">
<p>Whether to validate the server host name when an SSL connection is required. Corresponds to MySQL CLIs <code>--ssl</code> switch.</p> <p>Setting this to <code>false</code> disables hostname verification. Use with caution.</p> <p>Requires pymysql &gt;= 0.7.11.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li><code>false</code></li> <li><code>true</code></li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-mysql-mysql-role-module-parameter-check-implicit-admin"><strong>check_implicit_admin</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">boolean</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Check if mysql allows login as root/nopassword before trying supplied credentials.</p> <p>If success, passed <em>login_user</em>/<em>login_password</em> will be ignored.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li>
<code><strong>false</strong></code> <span class="ansible-option-choices-default-mark">← (default)</span>
</li> <li><code>true</code></li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell">  
<p class="ansible-option-title" id="ansible-collections-community-mysql-mysql-role-module-parameter-ssl-cert"><strong id="ansible-collections-community-mysql-mysql-role-module-parameter-client-cert">client_cert</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-aliases">aliases: ssl_cert</span></p> <p class="ansible-option-type-line"><span class="ansible-option-type">path</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The path to a client public key certificate.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell">  
<p class="ansible-option-title" id="ansible-collections-community-mysql-mysql-role-module-parameter-ssl-key"><strong id="ansible-collections-community-mysql-mysql-role-module-parameter-client-key">client_key</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-aliases">aliases: ssl_key</span></p> <p class="ansible-option-type-line"><span class="ansible-option-type">path</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The path to the client private key.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-mysql-mysql-role-module-parameter-column-case-sensitive"><strong>column_case_sensitive</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">boolean</span></p> <p><em class="ansible-option-versionadded">added in community.mysql 3.8.0</em></p> </div></td> <td><div class="ansible-option-cell">
<p>The default is <code>false</code>.</p> <p>When <code>true</code>, the module will not uppercase the field in the privileges.</p> <p>When <code>false</code>, the field names will be upper-cased. This was the default before this feature was introduced but since MySQL/MariaDB is case sensitive you should set this to <code>true</code> in most cases.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li><code>false</code></li> <li><code>true</code></li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-mysql-mysql-role-module-parameter-config-file"><strong>config_file</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">path</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Specify a config file from which user and password are to be read.</p> <p>The default config file, <code>~/.my.cnf</code>, if it exists, will be read, even if <em>config_file</em> is not specified.</p> <p>The default config file, <code>~/.my.cnf</code>, if it exists, must contain a <code>[client]</code> section as a MySQL connector requirement.</p> <p>To prevent the default config file from being read, set <em>config_file</em> to be an empty string.</p> <p class="ansible-option-line"><strong class="ansible-option-default-bold">Default:</strong> <code>"~/.my.cnf"</code></p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-mysql-mysql-role-module-parameter-connect-timeout"><strong>connect_timeout</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">integer</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The connection timeout when connecting to the MySQL server.</p> <p class="ansible-option-line"><strong class="ansible-option-default-bold">Default:</strong> <code>30</code></p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-mysql-mysql-role-module-parameter-detach-members"><strong>detach_members</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">boolean</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Detaches members defined by the <em>members</em> option from the role instead of overwriting all the current members.</p> <p>Mutually exclusive with the <em>append_members</em> and <em>admin</em> option.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li>
<code><strong>false</strong></code> <span class="ansible-option-choices-default-mark">← (default)</span>
</li> <li><code>true</code></li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-mysql-mysql-role-module-parameter-login-host"><strong>login_host</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Host running the database.</p> <p>In some cases for local connections the <em>login_unix_socket=/path/to/mysqld/socket</em>, that is usually <code>/var/run/mysqld/mysqld.sock</code>, needs to be used instead of <em>login_host=localhost</em>.</p> <p class="ansible-option-line"><strong class="ansible-option-default-bold">Default:</strong> <code>"localhost"</code></p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-mysql-mysql-role-module-parameter-login-password"><strong>login_password</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The password used to authenticate with.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-mysql-mysql-role-module-parameter-login-port"><strong>login_port</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">integer</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Port of the MySQL server. Requires <em>login_host</em> be defined as other than localhost if login_port is used.</p> <p class="ansible-option-line"><strong class="ansible-option-default-bold">Default:</strong> <code>3306</code></p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-mysql-mysql-role-module-parameter-login-unix-socket"><strong>login_unix_socket</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The path to a Unix domain socket for local connections.</p> <p>Use this parameter to avoid the <code>Please explicitly state intended protocol</code> error.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-mysql-mysql-role-module-parameter-login-user"><strong>login_user</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The username used to authenticate with.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-mysql-mysql-role-module-parameter-members"><strong>members</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">list</span> / <span class="ansible-option-elements">elements=string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>List of members of the role.</p> <p>For users, use the format <code>username@hostname</code>. Always specify the hostname part explicitly.</p> <p>For roles, use the format <code>rolename</code>.</p> <p>Mutually exclusive with <em>admin</em>.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-mysql-mysql-role-module-parameter-members-must-exist"><strong>members_must_exist</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">boolean</span></p> </div></td> <td><div class="ansible-option-cell">
<p>When <code>yes</code>, the module fails if any user in <em>members</em> does not exist.</p> <p>When <code>no</code>, users in <em>members</em> which don’t exist are simply skipped.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li><code>false</code></li> <li>
<code><strong>true</strong></code> <span class="ansible-option-choices-default-mark">← (default)</span>
</li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-mysql-mysql-role-module-parameter-name"><strong>name</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span> / <span class="ansible-option-required">required</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Name of the role to add or remove.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-mysql-mysql-role-module-parameter-priv"><strong>priv</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">any</span></p> </div></td> <td><div class="ansible-option-cell">
<p>MySQL privileges string in the format: <code>db.table:priv1,priv2</code>.</p> <p>You can specify multiple privileges by separating each one using a forward slash: <code>db.table:priv/db.table:priv</code>.</p> <p>The format is based on MySQL <code>GRANT</code> statement.</p> <p>Database and table names can be quoted, MySQL-style.</p> <p>If column privileges are used, the <code>priv1,priv2</code> part must be exactly as returned by a <code>SHOW GRANT</code> statement. If not followed, the module will always report changes. It includes grouping columns by permission (<code>SELECT(col1,col2</code>) instead of <code>SELECT(col1</code>,SELECT(col2))).</p> <p>Can be passed as a dictionary (see the examples).</p> <p>Supports GRANTs for procedures and functions (see the examples for the <a class="reference internal" href="mysql_user_module.html#ansible-collections-community-mysql-mysql-user-module"><span class="std std-ref">community.mysql.mysql_user</span></a> module).</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-mysql-mysql-role-module-parameter-set-default-role-all"><strong>set_default_role_all</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">boolean</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Is not supported by MariaDB and is silently ignored when working with MariaDB.</p> <p>If <code>yes</code>, runs <strong>SET DEFAULT ROLE ALL TO</strong> each of the <em>members</em> when changed.</p> <p>If you want to avoid this behavior, set this option to <code>no</code> explicitly.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li><code>false</code></li> <li>
<code><strong>true</strong></code> <span class="ansible-option-choices-default-mark">← (default)</span>
</li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-mysql-mysql-role-module-parameter-state"><strong>state</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>If <code>present</code> and the role does not exist, creates the role.</p> <p>If <code>present</code> and the role exists, does nothing or updates its attributes.</p> <p>If <code>absent</code>, removes the role.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li><code>"absent"</code></li> <li>
<code><strong>"present"</strong></code> <span class="ansible-option-choices-default-mark">← (default)</span>
</li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-mysql-mysql-role-module-parameter-subtract-privs"><strong>subtract_privs</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">boolean</span></p> <p><em class="ansible-option-versionadded">added in community.mysql 3.2.0</em></p> </div></td> <td><div class="ansible-option-cell">
<p>Revoke the privileges defined by the <em>priv</em> option and keep other existing privileges. If set, invalid privileges in <em>priv</em> are ignored. Mutually exclusive with <em>append_privs</em>.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li>
<code><strong>false</strong></code> <span class="ansible-option-choices-default-mark">← (default)</span>
</li> <li><code>true</code></li> </ul> </div></td> </tr>  </table> </section> <section id="attributes"> <h2>Attributes</h2> <table class="longtable ansible-option-table docutils align-default" style="width: 100%"> <thead> <tr>
<th class="head"><p>Attribute</p></th> <th class="head"><p>Support</p></th> <th class="head"><p>Description</p></th> </tr> </thead>  <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-mysql-mysql-role-module-attribute-check-mode"><strong>check_mode</strong></p> 
</div></td> <td><div class="ansible-option-cell">
<p><strong class="ansible-attribute-support-label">Support: </strong><strong class="ansible-attribute-support-full">full</strong></p> </div></td> <td><div class="ansible-option-cell">
<p>Can run in check_mode and return changed status prediction without modifying target.</p> </div></td> </tr>  </table> </section> <section id="notes"> <h2>Notes</h2> <div class="admonition note"> <p class="admonition-title">Note</p> <ul class="simple"> <li>Roles are supported since MySQL 8.0.0 and MariaDB 10.0.5.</li> <li>Pay attention that the module runs <code>SET DEFAULT ROLE ALL TO</code> all the <em>members</em> passed by default when the state has changed. If you want to avoid this behavior, set <em>set_default_role_all</em> to <code>no</code>.</li> <li>Requires the PyMySQL (Python 2.7 and Python 3.X) package installed on the remote host. The Python package may be installed with apt-get install python-pymysql (Ubuntu; see <a class="reference internal" href="../../ansible/builtin/apt_module.html#ansible-collections-ansible-builtin-apt-module"><span class="std std-ref">ansible.builtin.apt</span></a>) or yum install python2-PyMySQL (RHEL/CentOS/Fedora; see <a class="reference external" href="https://docs.ansible.com/ansible/9/collections/ansible/builtin/yum_module.html#ansible-collections-ansible-builtin-yum-module" title="(in Ansible v9)"><span class="xref std std-ref">ansible.builtin.yum</span></a>). You can also use dnf install python2-PyMySQL for newer versions of Fedora; see <a class="reference internal" href="../../ansible/builtin/dnf_module.html#ansible-collections-ansible-builtin-dnf-module"><span class="std std-ref">ansible.builtin.dnf</span></a>.</li> <li>Be sure you have PyMySQL library installed on the target machine for the Python interpreter Ansible discovers. For example if ansible discovers and uses Python 3, you need to install the Python 3 version of PyMySQL. If ansible discovers and uses Python 2, you need to install the Python 2 version of PyMySQL.</li> <li>If you have trouble, it may help to force Ansible to use the Python interpreter you need by specifying <code>ansible_python_interpreter</code>. For more information, see <a class="reference external" href="../../../reference_appendices/interpreter_discovery.html">https://docs.ansible.com/ansible/latest/reference_appendices/interpreter_discovery.html</a>.</li> <li>Both <code>login_password</code> and <code>login_user</code> are required when you are passing credentials. If none are present, the module will attempt to read the credentials from <code>~/.my.cnf</code>, and finally fall back to using the MySQL default login of ‘root’ with no password.</li> <li>If there are problems with local connections, using <em>login_unix_socket=/path/to/mysqld/socket</em> instead of <em>login_host=localhost</em> might help. As an example, the default MariaDB installation of version 10.4 and later uses the unix_socket authentication plugin by default that without using <em>login_unix_socket=/var/run/mysqld/mysqld.sock</em> (the default path) causes the error ``Host ‘127.0.0.1’ is not allowed to connect to this MariaDB server``.</li> <li>If credentials from the config file (for example, <code>/root/.my.cnf</code>) are not needed to connect to a database server, but the file exists and does not contain a <code>[client]</code> section, before any other valid directives, it will be read and this will cause the connection to fail, to prevent this set it to an empty string, (for example <code>config_file: ''</code>).</li> <li>To avoid the <code>Please explicitly state intended protocol</code> error, use the <em>login_unix_socket</em> argument, for example, <code>login_unix_socket: /run/mysqld/mysqld.sock</code>.</li> <li>Alternatively, to avoid using <em>login_unix_socket</em> argument on each invocation you can specify the socket path using the `socket` option in your MySQL config file (usually <code>~/.my.cnf</code>) on the destination host, for example <code>socket=/var/lib/mysql/mysql.sock</code>.</li> </ul> </div> </section> <section id="see-also"> <h2>See Also</h2> <div class="admonition seealso"> <p class="admonition-title">See also</p> <dl class="simple"> <dt><a class="reference internal" href="mysql_user_module.html#ansible-collections-community-mysql-mysql-user-module"><span class="std std-ref">community.mysql.mysql_user</span></a></dt>
<dd>
<p>Adds or removes a user from a MySQL or MariaDB database.</p> </dd> <dt><a class="reference external" href="https://dev.mysql.com/doc/refman/8.0/en/create-role.html">MySQL role reference</a></dt>
<dd>
<p>Complete reference of the MySQL role documentation.</p> </dd> </dl> </div> </section> <section id="examples"> <h2>Examples</h2> <pre data-language="yaml+jinja"># If you encounter the "Please explicitly state intended protocol" error,
# use the login_unix_socket argument, for example, login_unix_socket: /run/mysqld/mysqld.sock

# Example of a .my.cnf file content for setting a root password
# [client]
# user=root
# password=n&lt;_665{vS43y
#
# Example of a privileges dictionary passed through the priv option
# priv:
#   'mydb.*': 'INSERT,UPDATE'
#   'anotherdb.*': 'SELECT'
#   'yetanotherdb.*': 'ALL'
#
# You can also use the string format like in the community.mysql.mysql_user module, for example
# mydb.*:INSERT,UPDATE/anotherdb.*:SELECT/yetanotherdb.*:ALL
#
# For more examples on how to specify privileges, refer to the community.mysql.mysql_user module

# Create a role developers with all database privileges
# and add alice and bob as members.
# The statement 'SET DEFAULT ROLE ALL' to them will be run.
- name: Create role developers, add members
  community.mysql.mysql_role:
    name: developers
    state: present
    priv: '*.*:ALL'
    members:
    - 'alice@%'
    - 'bob@%'

- name: Same as above but do not run SET DEFAULT ROLE ALL TO each member
  community.mysql.mysql_role:
    name: developers
    state: present
    priv: '*.*:ALL'
    members:
    - 'alice@%'
    - 'bob@%'
    set_default_role_all: false

# Assuming that the role developers exists,
# add john to the current members
- name: Add members to an existing role
  community.mysql.mysql_role:
    name: developers
    state: present
    append_members: true
    members:
    - 'joe@localhost'

# Create role readers with the SELECT privilege
# on all tables in the fiction database
- name: Create role developers, add members
  community.mysql.mysql_role:
    name: readers
    state: present
    priv: 'fiction.*:SELECT'

# Assuming that the role readers exists,
# add the UPDATE privilege to the role on all tables in the fiction database
- name: Create role developers, add members
  community.mysql.mysql_role:
    name: readers
    state: present
    priv: 'fiction.*:UPDATE'
    append_privs: true

- name: Create role with the 'SELECT' and 'UPDATE' privileges in db1 and db2
  community.mysql.mysql_role:
    state: present
    name: foo
    priv:
      'db1.*': 'SELECT,UPDATE'
      'db2.*': 'SELECT,UPDATE'

- name: Remove joe from readers
  community.mysql.mysql_role:
    state: present
    name: readers
    members:
    - 'joe@localhost'
    detach_members: true

- name: Remove the role readers if exists
  community.mysql.mysql_role:
    state: absent
    name: readers

- name: Example of using login_unix_socket to connect to the server
  community.mysql.mysql_role:
    name: readers
    state: present
    login_unix_socket: /var/run/mysqld/mysqld.sock

# Pay attention that the admin cannot be changed later
# and will be ignored if a role currently exists.
# To change members, you need to run a separate task using the admin
# of the role as the login_user.
- name: On MariaDB, create the role readers with alice as its admin
  community.mysql.mysql_role:
    state: present
    name: readers
    admin: 'alice@%'

- name: Create the role business, add the role marketing to members
  community.mysql.mysql_role:
    state: present
    name: business
    members:
    - marketing

- name: Ensure the role foo does not have the DELETE privilege
  community.mysql.mysql_role:
    state: present
    name: foo
    subtract_privs: true
    priv:
      'db1.*': DELETE

- name: Add some members to a role and skip not-existent users
  community.mysql.mysql_role:
    state: present
    name: foo
    append_members: true
    members_must_exist: false
    members:
    - 'existing_user@localhost'
    - 'not_existing_user@localhost'

- name: Detach some members from a role and ignore not-existent users
  community.mysql.mysql_role:
    state: present
    name: foo
    detach_members: true
    members_must_exist: false
    members:
    - 'existing_user@localhost'
    - 'not_existing_user@localhost'
</pre> <section id="authors"> <h3>Authors</h3> <ul class="simple"> <li>Andrew Klychkov (@Andersson007)</li> <li>Felix Hamme (@betanummeric)</li> <li>kmarse (@kmarse)</li> <li>Laurent Indermühle (@laurent-indermuehle)</li> </ul> </section> <section id="collection-links"> <h3>Collection links</h3> <ul class="ansible-links"> <li><span><a aria-role="button" class="ansible-link reference external" href="https://github.com/ansible-collections/community.mysql/issues" rel="noopener external" target="_blank">Issue Tracker</a></span></li> <li><span><a aria-role="button" class="ansible-link reference external" href="https://github.com/ansible-collections/community.mysql" rel="noopener external" target="_blank">Repository (Sources)</a></span></li> </ul> </section> </section> </section><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2012&ndash;2018 Michael DeHaan<br>&copy; 2018&ndash;2024 Red Hat, Inc.<br>Licensed under the GNU General Public License version 3.<br>
    <a href="https://docs.ansible.com/ansible/latest/collections/community/mysql/mysql_role_module.html" class="_attribution-link">https://docs.ansible.com/ansible/latest/collections/community/mysql/mysql_role_module.html</a>
  </p>
</div>
