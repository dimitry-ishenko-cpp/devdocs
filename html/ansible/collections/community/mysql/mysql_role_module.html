<h1 id="community-mysql-mysql-role-adds-removes-or-updates-a-mysql-role">community.mysql.mysql_role – Adds, removes, or updates a MySQL role</h1> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This plugin is part of the <a class="reference external" href="https://galaxy.ansible.com/community/mysql">community.mysql collection</a> (version 2.3.1).</p> <p>You might already have this collection installed if you are using the <code>ansible</code> package. It is not included in <code>ansible-core</code>. To check whether it is installed, run <code>ansible-galaxy collection list</code>.</p> <p>To install it, use: <code>ansible-galaxy collection install community.mysql</code>.</p> <p>To use it in a playbook, specify: <code>community.mysql.mysql_role</code>.</p> </div> <div class="versionadded"> <p><span class="versionmodified added">New in version 2.2.0: </span>of community.mysql</p> </div>  <ul class="simple"> <li><a class="reference internal" href="#synopsis" id="id1">Synopsis</a></li> <li><a class="reference internal" href="#requirements" id="id2">Requirements</a></li> <li><a class="reference internal" href="#parameters" id="id3">Parameters</a></li> <li><a class="reference internal" href="#notes" id="id4">Notes</a></li> <li><a class="reference internal" href="#see-also" id="id5">See Also</a></li> <li><a class="reference internal" href="#examples" id="id6">Examples</a></li> </ul>   <h2 id="synopsis">Synopsis</h2> <ul class="simple"> <li>Adds, removes, or updates a MySQL role.</li> <li>Roles are supported since MySQL 8.0.0 and MariaDB 10.0.5.</li> </ul>   <h2 id="requirements">Requirements</h2> <p>The below requirements are needed on the host that executes this module.</p> <ul class="simple"> <li>PyMySQL (Python 2.7 and Python 3.X), or</li> <li>MySQLdb (Python 2.x)</li> </ul>   <h2 id="parameters">Parameters</h2> <table class="documentation-table"> <tr> <th colspan="1">Parameter</th> <th>Choices/Defaults</th> <th width="100%">Comments</th> </tr> <tr> <td colspan="1">  <b>admin</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Supported by <b>MariaDB</b>.</div> <div>Name of the admin user of the role (the <em>login_user</em>, by default).</div> </td> </tr> <tr> <td colspan="1">  <b>append_members</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Add members defined by the <em>members</em> option to the existing ones for this role instead of overwriting them.</div> <div>Mutually exclusive with the <em>detach_members</em> and <em>admin</em> option.</div> </td> </tr> <tr> <td colspan="1">  <b>append_privs</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Append the privileges defined by the <em>priv</em> option to the existing ones for this role instead of overwriting them.</div> </td> </tr> <tr> <td colspan="1">  <b>ca_cert</b>  <div> <span>path</span> </div> </td> <td> </td> <td> <div>The path to a Certificate Authority (CA) certificate. This option, if used, must specify the same certificate as used by the server.</div> <div>
<br>aliases: ssl_ca</div> </td> </tr> <tr> <td colspan="1">  <b>check_hostname</b>  <div> <span>boolean</span> </div> <div> added in 1.1.0 of community.mysql </div> </td> <td> <ul>
<b>Choices:</b> <li>no</li> <li>yes</li> </ul> </td> <td> <div>Whether to validate the server host name when an SSL connection is required. Corresponds to MySQL CLIs <code>--ssl</code> switch.</div> <div>Setting this to <code>false</code> disables hostname verification. Use with caution.</div> <div>Requires pymysql &gt;= 0.7.11.</div> <div>This option has no effect on MySQLdb.</div> </td> </tr> <tr> <td colspan="1">  <b>check_implicit_admin</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Check if mysql allows login as root/nopassword before trying supplied credentials.</div> <div>If success, passed <em>login_user</em>/<em>login_password</em> will be ignored.</div> </td> </tr> <tr> <td colspan="1">  <b>client_cert</b>  <div> <span>path</span> </div> </td> <td> </td> <td> <div>The path to a client public key certificate.</div> <div>
<br>aliases: ssl_cert</div> </td> </tr> <tr> <td colspan="1">  <b>client_key</b>  <div> <span>path</span> </div> </td> <td> </td> <td> <div>The path to the client private key.</div> <div>
<br>aliases: ssl_key</div> </td> </tr> <tr> <td colspan="1">  <b>config_file</b>  <div> <span>path</span> </div> </td> <td> <b>Default:</b><br><div>"~/.my.cnf"</div> </td> <td> <div>Specify a config file from which user and password are to be read.</div> </td> </tr> <tr> <td colspan="1">  <b>connect_timeout</b>  <div> <span>integer</span> </div> </td> <td> <b>Default:</b><br><div>30</div> </td> <td> <div>The connection timeout when connecting to the MySQL server.</div> </td> </tr> <tr> <td colspan="1">  <b>detach_members</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Detaches members defined by the <em>members</em> option from the role instead of overwriting all the current members.</div> <div>Mutually exclusive with the <em>append_members</em> and <em>admin</em> option.</div> </td> </tr> <tr> <td colspan="1">  <b>login_host</b>  <div> <span>string</span> </div> </td> <td> <b>Default:</b><br><div>"localhost"</div> </td> <td> <div>Host running the database.</div> <div>In some cases for local connections the <em>login_unix_socket=/path/to/mysqld/socket</em>, that is usually <code>/var/run/mysqld/mysqld.sock</code>, needs to be used instead of <em>login_host=localhost</em>.</div> </td> </tr> <tr> <td colspan="1">  <b>login_password</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The password used to authenticate with.</div> </td> </tr> <tr> <td colspan="1">  <b>login_port</b>  <div> <span>integer</span> </div> </td> <td> <b>Default:</b><br><div>3306</div> </td> <td> <div>Port of the MySQL server. Requires <em>login_host</em> be defined as other than localhost if login_port is used.</div> </td> </tr> <tr> <td colspan="1">  <b>login_unix_socket</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The path to a Unix domain socket for local connections.</div> </td> </tr> <tr> <td colspan="1">  <b>login_user</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The username used to authenticate with.</div> </td> </tr> <tr> <td colspan="1">  <b>members</b>  <div> <span>list</span> / <span>elements=string</span> </div> </td> <td> </td> <td> <div>List of members of the role.</div> <div>For users, use the format <code>username@hostname</code>. Always specify the hostname part explicitly.</div> <div>For roles, use the format <code>rolename</code>.</div> <div>Mutually exclusive with <em>admin</em>.</div> </td> </tr> <tr> <td colspan="1">  <b>name</b>  <div> <span>string</span> / <span>required</span> </div> </td> <td> </td> <td> <div>Name of the role to add or remove.</div> </td> </tr> <tr> <td colspan="1">  <b>priv</b>  <div> <span>raw</span> </div> </td> <td> </td> <td> <div>MySQL privileges string in the format: <code>db.table:priv1,priv2</code>.</div> <div>You can specify multiple privileges by separating each one using a forward slash: <code>db.table:priv/db.table:priv</code>.</div> <div>The format is based on MySQL <code>GRANT</code> statement.</div> <div>Database and table names can be quoted, MySQL-style.</div> <div>If column privileges are used, the <code>priv1,priv2</code> part must be exactly as returned by a <code>SHOW GRANT</code> statement. If not followed, the module will always report changes. It includes grouping columns by permission (<code>SELECT(col1,col2</code>) instead of <code>SELECT(col1</code>,SELECT(col2))).</div> <div>Can be passed as a dictionary (see the examples).</div> <div>Supports GRANTs for procedures and functions (see the examples for the <a href="mysql_user_module.html" class="module">community.mysql.mysql_user</a> module).</div> </td> </tr> <tr> <td colspan="1">  <b>set_default_role_all</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>no</li> <li><div>
<b>yes</b> ←</div></li> </ul> </td> <td> <div>Is not supported by MariaDB and is silently ignored when working with MariaDB.</div> <div>If <code>yes</code>, runs <b>SET DEFAULT ROLE ALL TO</b> each of the <em>members</em> when changed.</div> <div>If you want to avoid this behavior, set this option to <code>no</code> explicitly.</div> </td> </tr> <tr> <td colspan="1">  <b>state</b>  <div> <span>string</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>absent</li> <li><div>
<b>present</b> ←</div></li> </ul> </td> <td> <div>If <code>present</code> and the role does not exist, creates the role.</div> <div>If <code>present</code> and the role exists, does nothing or updates its attributes.</div> <div>If <code>absent</code>, removes the role.</div> </td> </tr> </table> <br>  <h2 id="notes">Notes</h2> <div class="admonition note"> <p class="admonition-title">Note</p> <ul class="simple"> <li>Pay attention that the module runs <code>SET DEFAULT ROLE ALL TO</code> all the <em>members</em> passed by default when the state has changed. If you want to avoid this behavior, set <em>set_default_role_all</em> to <code>no</code>.</li> <li>Supports <code>check_mode</code>.</li> <li>Requires the PyMySQL (Python 2.7 and Python 3.X) or MySQL-python (Python 2.X) package installed on the remote host. The Python package may be installed with apt-get install python-pymysql (Ubuntu; see <a class="reference internal" href="../../ansible/builtin/apt_module.html#ansible-collections-ansible-builtin-apt-module"><span class="std std-ref">ansible.builtin.apt</span></a>) or yum install python2-PyMySQL (RHEL/CentOS/Fedora; see <a class="reference internal" href="../../ansible/builtin/yum_module.html#ansible-collections-ansible-builtin-yum-module"><span class="std std-ref">ansible.builtin.yum</span></a>). You can also use dnf install python2-PyMySQL for newer versions of Fedora; see <a class="reference internal" href="../../ansible/builtin/dnf_module.html#ansible-collections-ansible-builtin-dnf-module"><span class="std std-ref">ansible.builtin.dnf</span></a>.</li> <li>Be sure you have PyMySQL or MySQLdb library installed on the target machine for the Python interpreter Ansible uses, for example, if it is Python 3, you must install the library for Python 3. You can also change the interpreter. For more information, see <a class="reference external" href="../../../reference_appendices/interpreter_discovery.html">https://docs.ansible.com/ansible/latest/reference_appendices/interpreter_discovery.html</a>.</li> <li>Both <code>login_password</code> and <code>login_user</code> are required when you are passing credentials. If none are present, the module will attempt to read the credentials from <code>~/.my.cnf</code>, and finally fall back to using the MySQL default login of ‘root’ with no password.</li> <li>If there are problems with local connections, using <em>login_unix_socket=/path/to/mysqld/socket</em> instead of <em>login_host=localhost</em> might help. As an example, the default MariaDB installation of version 10.4 and later uses the unix_socket authentication plugin by default that without using <em>login_unix_socket=/var/run/mysqld/mysqld.sock</em> (the default path) causes the error <code>Host '127.0.0.1' is not allowed to connect to this MariaDB server</code>.</li> <li>Alternatively, you can use the mysqlclient library instead of MySQL-python (MySQLdb) which supports both Python 2.X and Python &gt;=3.5. See <a class="reference external" href="https://pypi.org/project/mysqlclient/">https://pypi.org/project/mysqlclient/</a> how to install it.</li> </ul> </div>   <h2 id="see-also">See Also</h2> <div class="admonition seealso"> <p class="admonition-title">See also</p> <dl class="simple"> <dt><a class="reference internal" href="mysql_user_module.html#ansible-collections-community-mysql-mysql-user-module"><span class="std std-ref">community.mysql.mysql_user</span></a></dt>
<dd>
<p>The official documentation on the <strong>community.mysql.mysql_user</strong> module.</p> </dd> <dt><a class="reference external" href="https://dev.mysql.com/doc/refman/8.0/en/create-role.html">MySQL role reference</a></dt>
<dd>
<p>Complete reference of the MySQL role documentation.</p> </dd> </dl> </div>   <h2 id="examples">Examples</h2> <pre data-language="yaml+jinja"># Example of a .my.cnf file content for setting a root password
# [client]
# user=root
# password=n&lt;_665{vS43y
#
# Example of a privileges dictionary passed through the priv option
# priv:
#   'mydb.*': 'INSERT,UPDATE'
#   'anotherdb.*': 'SELECT'
#   'yetanotherdb.*': 'ALL'
#
# You can also use the string format like in the community.mysql.mysql_user module, for example
# mydb.*:INSERT,UPDATE/anotherdb.*:SELECT/yetanotherdb.*:ALL
#
# For more examples on how to specify privileges, refer to the community.mysql.mysql_user module

# Create a role developers with all database privileges
# and add alice and bob as members.
# The statement 'SET DEFAULT ROLE ALL' to them will be run.
- name: Create role developers, add members
  community.mysql.mysql_role:
    name: developers
    state: present
    priv: '*.*:ALL'
    members:
    - 'alice@%'
    - 'bob@%'

- name: Same as above but do not run SET DEFAULT ROLE ALL TO each member
  community.mysql.mysql_role:
    name: developers
    state: present
    priv: '*.*:ALL'
    members:
    - 'alice@%'
    - 'bob@%'
    set_default_role_all: no

# Assuming that the role developers exists,
# add john to the current members
- name: Add members to an existing role
  community.mysql.mysql_role:
    name: developers
    state: present
    append_members: yes
    members:
    - 'joe@localhost'

# Create role readers with the SELECT privilege
# on all tables in the fiction database
- name: Create role developers, add members
  community.mysql.mysql_role:
    name: readers
    state: present
    priv: 'fiction.*:SELECT'

# Assuming that the role readers exists,
# add the UPDATE privilege to the role on all tables in the fiction database
- name: Create role developers, add members
  community.mysql.mysql_role:
    name: readers
    state: present
    priv: 'fiction.*:UPDATE'
    append_privs: yes

- name: Create role with the 'SELECT' and 'UPDATE' privileges in db1 and db2
  community.mysql.mysql_role:
    state: present
    name: foo
    priv:
      'db1.*': 'SELECT,UPDATE'
      'db2.*': 'SELECT,UPDATE'

- name: Remove joe from readers
  community.mysql.mysql_role:
    state: present
    name: readers
    members:
    - 'joe@localhost'
    detach_members: yes

- name: Remove the role readers if exists
  community.mysql.mysql_role:
    state: absent
    name: readers

- name: Example of using login_unix_socket to connect to the server
  community.mysql.mysql_role:
    name: readers
    state: present
    login_unix_socket: /var/run/mysqld/mysqld.sock

# Pay attention that the admin cannot be changed later
# and will be ignored if a role currently exists.
# To change members, you need to run a separate task using the admin
# of the role as the login_user.
- name: On MariaDB, create the role readers with alice as its admin
  community.mysql.mysql_role:
    state: present
    name: readers
    admin: 'alice@%'

- name: Create the role business, add the role marketing to members
  community.mysql.mysql_role:
    state: present
    name: business
    members:
    - marketing
</pre>  <h3 id="authors">Authors</h3> <ul class="simple"> <li>Andrew Klychkov (@Andersson007)</li> </ul><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2012&ndash;2018 Michael DeHaan<br>&copy; 2018&ndash;2021 Red Hat, Inc.<br>Licensed under the GNU General Public License version 3.<br>
    <a href="https://docs.ansible.com/ansible/latest/collections/community/mysql/mysql_role_module.html" class="_attribution-link">https://docs.ansible.com/ansible/latest/collections/community/mysql/mysql_role_module.html</a>
  </p>
</div>
