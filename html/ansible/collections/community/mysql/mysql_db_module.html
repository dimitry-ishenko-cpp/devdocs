<h1 id="community-mysql-mysql-db-add-or-remove-mysql-databases-from-a-remote-host">community.mysql.mysql_db – Add or remove MySQL databases from a remote host</h1> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This plugin is part of the <a class="reference external" href="https://galaxy.ansible.com/community/mysql">community.mysql collection</a> (version 2.3.1).</p> <p>You might already have this collection installed if you are using the <code>ansible</code> package. It is not included in <code>ansible-core</code>. To check whether it is installed, run <code>ansible-galaxy collection list</code>.</p> <p>To install it, use: <code>ansible-galaxy collection install community.mysql</code>.</p> <p>To use it in a playbook, specify: <code>community.mysql.mysql_db</code>.</p> </div>  <ul class="simple"> <li><a class="reference internal" href="#synopsis" id="id1">Synopsis</a></li> <li><a class="reference internal" href="#requirements" id="id2">Requirements</a></li> <li><a class="reference internal" href="#parameters" id="id3">Parameters</a></li> <li><a class="reference internal" href="#notes" id="id4">Notes</a></li> <li><a class="reference internal" href="#see-also" id="id5">See Also</a></li> <li><a class="reference internal" href="#examples" id="id6">Examples</a></li> <li><a class="reference internal" href="#return-values" id="id7">Return Values</a></li> </ul>   <h2 id="synopsis">Synopsis</h2> <ul class="simple"> <li>Add or remove MySQL databases from a remote host.</li> </ul>   <h2 id="requirements">Requirements</h2> <p>The below requirements are needed on the host that executes this module.</p> <ul class="simple"> <li>MySQLdb (Python 2.x)</li> <li>PyMySQL (Python 2.7 and Python 3.X), or</li> <li>mysql (command line binary)</li> <li>mysqldump (command line binary)</li> </ul>   <h2 id="parameters">Parameters</h2> <table class="documentation-table"> <tr> <th colspan="1">Parameter</th> <th>Choices/Defaults</th> <th width="100%">Comments</th> </tr> <tr> <td colspan="1">  <b>ca_cert</b>  <div> <span>path</span> </div> </td> <td> </td> <td> <div>The path to a Certificate Authority (CA) certificate. This option, if used, must specify the same certificate as used by the server.</div> <div>
<br>aliases: ssl_ca</div> </td> </tr> <tr> <td colspan="1">  <b>check_hostname</b>  <div> <span>boolean</span> </div> <div> added in 1.1.0 of community.mysql </div> </td> <td> <ul>
<b>Choices:</b> <li>no</li> <li>yes</li> </ul> </td> <td> <div>Whether to validate the server host name when an SSL connection is required. Corresponds to MySQL CLIs <code>--ssl</code> switch.</div> <div>Setting this to <code>false</code> disables hostname verification. Use with caution.</div> <div>Requires pymysql &gt;= 0.7.11.</div> <div>This option has no effect on MySQLdb.</div> </td> </tr> <tr> <td colspan="1">  <b>check_implicit_admin</b>  <div> <span>boolean</span> </div> <div> added in 0.1.0 of community.mysql </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Check if mysql allows login as root/nopassword before trying supplied credentials.</div> <div>If success, passed <em>login_user</em>/<em>login_password</em> will be ignored.</div> </td> </tr> <tr> <td colspan="1">  <b>client_cert</b>  <div> <span>path</span> </div> </td> <td> </td> <td> <div>The path to a client public key certificate.</div> <div>
<br>aliases: ssl_cert</div> </td> </tr> <tr> <td colspan="1">  <b>client_key</b>  <div> <span>path</span> </div> </td> <td> </td> <td> <div>The path to the client private key.</div> <div>
<br>aliases: ssl_key</div> </td> </tr> <tr> <td colspan="1">  <b>collation</b>  <div> <span>string</span> </div> </td> <td> <b>Default:</b><br><div>""</div> </td> <td> <div>Collation mode (sorting). This only applies to new table/databases and does not update existing ones, this is a limitation of MySQL.</div> </td> </tr> <tr> <td colspan="1">  <b>config_file</b>  <div> <span>path</span> </div> </td> <td> <b>Default:</b><br><div>"~/.my.cnf"</div> </td> <td> <div>Specify a config file from which user and password are to be read.</div> </td> </tr> <tr> <td colspan="1">  <b>config_overrides_defaults</b>  <div> <span>boolean</span> </div> <div> added in 0.1.0 of community.mysql </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>If <code>yes</code>, connection parameters from <em>config_file</em> will override the default values of <em>login_host</em> and <em>login_port</em> parameters.</div> <div>Used when <em>stat</em> is <code>present</code> or <code>absent</code>, ignored otherwise.</div> <div>It needs Python 3.5+ as the default interpreter on a target host.</div> </td> </tr> <tr> <td colspan="1">  <b>connect_timeout</b>  <div> <span>integer</span> </div> </td> <td> <b>Default:</b><br><div>30</div> </td> <td> <div>The connection timeout when connecting to the MySQL server.</div> </td> </tr> <tr> <td colspan="1">  <b>dump_extra_args</b>  <div> <span>string</span> </div> <div> added in 0.1.0 of community.mysql </div> </td> <td> </td> <td> <div>Provide additional arguments for mysqldump. Used when <em>state=dump</em> only, ignored otherwise.</div> </td> </tr> <tr> <td colspan="1">  <b>encoding</b>  <div> <span>string</span> </div> </td> <td> <b>Default:</b><br><div>""</div> </td> <td> <div>Encoding mode to use, examples include <code>utf8</code> or <code>latin1_swedish_ci</code>, at creation of database, dump or importation of sql script.</div> </td> </tr> <tr> <td colspan="1">  <b>force</b>  <div> <span>boolean</span> </div> <div> added in 0.1.0 of community.mysql </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Continue dump or import even if we get an SQL error.</div> <div>Used only when <em>state</em> is <code>dump</code> or <code>import</code>.</div> </td> </tr> <tr> <td colspan="1">  <b>hex_blob</b>  <div> <span>boolean</span> </div> <div> added in 0.1.0 of community.mysql </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Dump binary columns using hexadecimal notation.</div> </td> </tr> <tr> <td colspan="1">  <b>ignore_tables</b>  <div> <span>list</span> / <span>elements=string</span> </div> </td> <td> <b>Default:</b><br><div>[]</div> </td> <td> <div>A list of table names that will be ignored in the dump of the form database_name.table_name.</div> </td> </tr> <tr> <td colspan="1">  <b>login_host</b>  <div> <span>string</span> </div> </td> <td> <b>Default:</b><br><div>"localhost"</div> </td> <td> <div>Host running the database.</div> <div>In some cases for local connections the <em>login_unix_socket=/path/to/mysqld/socket</em>, that is usually <code>/var/run/mysqld/mysqld.sock</code>, needs to be used instead of <em>login_host=localhost</em>.</div> </td> </tr> <tr> <td colspan="1">  <b>login_password</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The password used to authenticate with.</div> </td> </tr> <tr> <td colspan="1">  <b>login_port</b>  <div> <span>integer</span> </div> </td> <td> <b>Default:</b><br><div>3306</div> </td> <td> <div>Port of the MySQL server. Requires <em>login_host</em> be defined as other than localhost if login_port is used.</div> </td> </tr> <tr> <td colspan="1">  <b>login_unix_socket</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The path to a Unix domain socket for local connections.</div> </td> </tr> <tr> <td colspan="1">  <b>login_user</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The username used to authenticate with.</div> </td> </tr> <tr> <td colspan="1">  <b>master_data</b>  <div> <span>integer</span> </div> <div> added in 0.1.0 of community.mysql </div> </td> <td> <ul>
<b>Choices:</b> <li>0</li> <li>1</li> <li>2</li> </ul> <b>Default:</b><br><div>0</div> </td> <td> <div>Option to dump a master replication server to produce a dump file that can be used to set up another server as a slave of the master.</div> <div>
<code>0</code> to not include master data.</div> <div>
<code>1</code> to generate a 'CHANGE MASTER TO' statement required on the slave to start the replication process.</div> <div>
<code>2</code> to generate a commented 'CHANGE MASTER TO'.</div> <div>Can be used when <em>state=dump</em>.</div> </td> </tr> <tr> <td colspan="1">  <b>name</b>  <div> <span>list</span> / <span>elements=string</span> / <span>required</span> </div> </td> <td> </td> <td> <div>Name of the database to add or remove.</div> <div>
<em>name=all</em> may only be provided if <em>state</em> is <code>dump</code> or <code>import</code>.</div> <div>List of databases is provided with <em>state=dump</em>, <em>state=present</em> and <em>state=absent</em>.</div> <div>If <em>name=all</em> it works like --all-databases option for mysqldump (Added in 2.0).</div> <div>
<br>aliases: db</div> </td> </tr> <tr> <td colspan="1">  <b>quick</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>no</li> <li><div>
<b>yes</b> ←</div></li> </ul> </td> <td> <div>Option used for dumping large tables.</div> </td> </tr> <tr> <td colspan="1">  <b>restrict_config_file</b>  <div> <span>boolean</span> </div> <div> added in 0.1.0 of community.mysql </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Read only passed <em>config_file</em>.</div> <div>When <em>state</em> is <code>dump</code> or <code>import</code>, by default the module passes <em>config_file</em> parameter using <code>--defaults-extra-file</code> command-line argument to <code>mysql/mysqldump</code> utilities under the hood that read named option file in addition to usual option files.</div> <div>If this behavior is undesirable, use <code>yes</code> to read only named option file.</div> </td> </tr> <tr> <td colspan="1">  <b>single_transaction</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Execute the dump in a single transaction.</div> </td> </tr> <tr> <td colspan="1">  <b>skip_lock_tables</b>  <div> <span>boolean</span> </div> <div> added in 0.1.0 of community.mysql </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Skip locking tables for read. Used when <em>state=dump</em>, ignored otherwise.</div> </td> </tr> <tr> <td colspan="1">  <b>state</b>  <div> <span>string</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>absent</li> <li>dump</li> <li>import</li> <li><div>
<b>present</b> ←</div></li> </ul> </td> <td> <div>The database state.</div> </td> </tr> <tr> <td colspan="1">  <b>target</b>  <div> <span>path</span> </div> </td> <td> </td> <td> <div>Location, on the remote host, of the dump file to read from or write to.</div> <div>Uncompressed SQL files (<code>.sql</code>) as well as bzip2 (<code>.bz2</code>), gzip (<code>.gz</code>) and xz (Added in 2.0) compressed files are supported.</div> </td> </tr> <tr> <td colspan="1">  <b>unsafe_login_password</b>  <div> <span>boolean</span> </div> <div> added in 0.1.0 of community.mysql </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>If <code>no</code>, the module will safely use a shell-escaped version of the <em>login_password</em> value.</div> <div>It makes sense to use <code>yes</code> only if there are special symbols in the value and errors <code>Access denied</code> occur.</div> <div>Used only when <em>state</em> is <code>import</code> or <code>dump</code> and <em>login_password</em> is passed, ignored otherwise.</div> </td> </tr> <tr> <td colspan="1">  <b>use_shell</b>  <div> <span>boolean</span> </div> <div> added in 0.1.0 of community.mysql </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Used to prevent <code>Broken pipe</code> errors when the imported <em>target</em> file is compressed.</div> <div>If <code>yes</code>, the module will internally execute commands via a shell.</div> <div>Used when <em>state=import</em>, ignored otherwise.</div> </td> </tr> </table> <br>  <h2 id="notes">Notes</h2> <div class="admonition note"> <p class="admonition-title">Note</p> <ul class="simple"> <li>Supports <code>check_mode</code>.</li> <li>Requires the mysql and mysqldump binaries on the remote host.</li> <li>This module is <strong>not idempotent</strong> when <em>state</em> is <code>import</code>, and will import the dump file each time if run more than once.</li> <li>Requires the PyMySQL (Python 2.7 and Python 3.X) or MySQL-python (Python 2.X) package installed on the remote host. The Python package may be installed with apt-get install python-pymysql (Ubuntu; see <a class="reference internal" href="../../ansible/builtin/apt_module.html#ansible-collections-ansible-builtin-apt-module"><span class="std std-ref">ansible.builtin.apt</span></a>) or yum install python2-PyMySQL (RHEL/CentOS/Fedora; see <a class="reference internal" href="../../ansible/builtin/yum_module.html#ansible-collections-ansible-builtin-yum-module"><span class="std std-ref">ansible.builtin.yum</span></a>). You can also use dnf install python2-PyMySQL for newer versions of Fedora; see <a class="reference internal" href="../../ansible/builtin/dnf_module.html#ansible-collections-ansible-builtin-dnf-module"><span class="std std-ref">ansible.builtin.dnf</span></a>.</li> <li>Be sure you have PyMySQL or MySQLdb library installed on the target machine for the Python interpreter Ansible uses, for example, if it is Python 3, you must install the library for Python 3. You can also change the interpreter. For more information, see <a class="reference external" href="../../../reference_appendices/interpreter_discovery.html">https://docs.ansible.com/ansible/latest/reference_appendices/interpreter_discovery.html</a>.</li> <li>Both <code>login_password</code> and <code>login_user</code> are required when you are passing credentials. If none are present, the module will attempt to read the credentials from <code>~/.my.cnf</code>, and finally fall back to using the MySQL default login of ‘root’ with no password.</li> <li>If there are problems with local connections, using <em>login_unix_socket=/path/to/mysqld/socket</em> instead of <em>login_host=localhost</em> might help. As an example, the default MariaDB installation of version 10.4 and later uses the unix_socket authentication plugin by default that without using <em>login_unix_socket=/var/run/mysqld/mysqld.sock</em> (the default path) causes the error <code>Host '127.0.0.1' is not allowed to connect to this MariaDB server</code>.</li> <li>Alternatively, you can use the mysqlclient library instead of MySQL-python (MySQLdb) which supports both Python 2.X and Python &gt;=3.5. See <a class="reference external" href="https://pypi.org/project/mysqlclient/">https://pypi.org/project/mysqlclient/</a> how to install it.</li> </ul> </div>   <h2 id="see-also">See Also</h2> <div class="admonition seealso"> <p class="admonition-title">See also</p> <dl class="simple"> <dt><a class="reference internal" href="mysql_info_module.html#ansible-collections-community-mysql-mysql-info-module"><span class="std std-ref">community.mysql.mysql_info</span></a></dt>
<dd>
<p>The official documentation on the <strong>community.mysql.mysql_info</strong> module.</p> </dd> <dt><a class="reference internal" href="mysql_variables_module.html#ansible-collections-community-mysql-mysql-variables-module"><span class="std std-ref">community.mysql.mysql_variables</span></a></dt>
<dd>
<p>The official documentation on the <strong>community.mysql.mysql_variables</strong> module.</p> </dd> <dt><a class="reference internal" href="mysql_user_module.html#ansible-collections-community-mysql-mysql-user-module"><span class="std std-ref">community.mysql.mysql_user</span></a></dt>
<dd>
<p>The official documentation on the <strong>community.mysql.mysql_user</strong> module.</p> </dd> <dt><a class="reference internal" href="mysql_replication_module.html#ansible-collections-community-mysql-mysql-replication-module"><span class="std std-ref">community.mysql.mysql_replication</span></a></dt>
<dd>
<p>The official documentation on the <strong>community.mysql.mysql_replication</strong> module.</p> </dd> <dt><a class="reference external" href="https://dev.mysql.com/doc/refman/8.0/en/mysql.html">MySQL command-line client reference</a></dt>
<dd>
<p>Complete reference of the MySQL command-line client documentation.</p> </dd> <dt><a class="reference external" href="https://dev.mysql.com/doc/refman/8.0/en/mysqldump.html">mysqldump reference</a></dt>
<dd>
<p>Complete reference of the <code>mysqldump</code> client utility documentation.</p> </dd> <dt><a class="reference external" href="https://dev.mysql.com/doc/refman/8.0/en/create-database.html">CREATE DATABASE reference</a></dt>
<dd>
<p>Complete reference of the CREATE DATABASE command documentation.</p> </dd> <dt><a class="reference external" href="https://dev.mysql.com/doc/refman/8.0/en/drop-database.html">DROP DATABASE reference</a></dt>
<dd>
<p>Complete reference of the DROP DATABASE command documentation.</p> </dd> </dl> </div>   <h2 id="examples">Examples</h2> <pre data-language="yaml+jinja">- name: Create a new database with name 'bobdata'
  community.mysql.mysql_db:
    name: bobdata
    state: present

- name: Create new databases with names 'foo' and 'bar'
  community.mysql.mysql_db:
    name:
      - foo
      - bar
    state: present

# Copy database dump file to remote host and restore it to database 'my_db'
- name: Copy database dump file
  copy:
    src: dump.sql.bz2
    dest: /tmp

- name: Restore database
  community.mysql.mysql_db:
    name: my_db
    state: import
    target: /tmp/dump.sql.bz2

- name: Restore database ignoring errors
  community.mysql.mysql_db:
    name: my_db
    state: import
    target: /tmp/dump.sql.bz2
    force: yes

- name: Dump multiple databases
  community.mysql.mysql_db:
    state: dump
    name: db_1,db_2
    target: /tmp/dump.sql

- name: Dump multiple databases
  community.mysql.mysql_db:
    state: dump
    name:
      - db_1
      - db_2
    target: /tmp/dump.sql

- name: Dump all databases to hostname.sql
  community.mysql.mysql_db:
    state: dump
    name: all
    target: /tmp/dump.sql

- name: Dump all databases to hostname.sql including master data
  community.mysql.mysql_db:
    state: dump
    name: all
    target: /tmp/dump.sql
    master_data: 1

# Import of sql script with encoding option
- name: &gt;
    Import dump.sql with specific latin1 encoding,
    similar to mysql -u &lt;username&gt; --default-character-set=latin1 -p &lt;password&gt; &lt; dump.sql
  community.mysql.mysql_db:
    state: import
    name: all
    encoding: latin1
    target: /tmp/dump.sql

# Dump of database with encoding option
- name: &gt;
    Dump of Databse with specific latin1 encoding,
    similar to mysqldump -u &lt;username&gt; --default-character-set=latin1 -p &lt;password&gt; &lt;database&gt;
  community.mysql.mysql_db:
    state: dump
    name: db_1
    encoding: latin1
    target: /tmp/dump.sql

- name: Delete database with name 'bobdata'
  community.mysql.mysql_db:
    name: bobdata
    state: absent

- name: Make sure there is neither a database with name 'foo', nor one with name 'bar'
  community.mysql.mysql_db:
    name:
      - foo
      - bar
    state: absent

# Dump database with argument not directly supported by this module
# using dump_extra_args parameter
- name: Dump databases without including triggers
  community.mysql.mysql_db:
    state: dump
    name: foo
    target: /tmp/dump.sql
    dump_extra_args: --skip-triggers

- name: Try to create database as root/nopassword first. If not allowed, pass the credentials
  community.mysql.mysql_db:
    check_implicit_admin: yes
    login_user: bob
    login_password: 123456
    name: bobdata
    state: present
</pre>   <h2 id="return-values">Return Values</h2> <p>Common return values are documented <a class="reference internal" href="../../../reference_appendices/common_return_values.html#common-return-values"><span class="std std-ref">here</span></a>, the following are the fields unique to this module:</p> <table class="documentation-table"> <tr> <th colspan="1">Key</th> <th>Returned</th> <th width="100%">Description</th> </tr> <tr> <td colspan="1">  <b>db</b>  <div> <span>string</span> </div> </td> <td>always</td> <td> <div>Database names in string format delimited by white space.</div> <br> <div><b>Sample:</b></div> <div>foo bar</div> </td> </tr> <tr> <td colspan="1">  <b>db_list</b>  <div> <span>list</span> / <span>elements=string</span> </div> </td> <td>always</td> <td> <div>List of database names.</div> <br> <div><b>Sample:</b></div> <div>['foo', 'bar']</div> </td> </tr> <tr> <td colspan="1">  <b>executed_commands</b>  <div> <span>list</span> / <span>elements=string</span> </div> <div>added in 0.1.0 of community.mysql</div> </td> <td>if executed</td> <td> <div>List of commands which tried to run.</div> <br> <div><b>Sample:</b></div> <div>['CREATE DATABASE acme']</div> </td> </tr> </table> <br><br> <h3 id="authors">Authors</h3> <ul class="simple"> <li>Ansible Core Team</li> </ul><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2012&ndash;2018 Michael DeHaan<br>&copy; 2018&ndash;2021 Red Hat, Inc.<br>Licensed under the GNU General Public License version 3.<br>
    <a href="https://docs.ansible.com/ansible/latest/collections/community/mysql/mysql_db_module.html" class="_attribution-link">https://docs.ansible.com/ansible/latest/collections/community/mysql/mysql_db_module.html</a>
  </p>
</div>
