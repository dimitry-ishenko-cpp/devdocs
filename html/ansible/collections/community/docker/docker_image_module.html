<h1 id="community-docker-docker-image-manage-docker-images">community.docker.docker_image – Manage docker images</h1> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This plugin is part of the <a class="reference external" href="https://galaxy.ansible.com/community/docker">community.docker collection</a> (version 1.10.0).</p> <p>You might already have this collection installed if you are using the <code>ansible</code> package. It is not included in <code>ansible-core</code>. To check whether it is installed, run <code>ansible-galaxy collection list</code>.</p> <p>To install it, use: <code>ansible-galaxy collection install community.docker</code>.</p> <p>To use it in a playbook, specify: <code>community.docker.docker_image</code>.</p> </div>  <ul class="simple"> <li><a class="reference internal" href="#synopsis" id="id3">Synopsis</a></li> <li><a class="reference internal" href="#requirements" id="id4">Requirements</a></li> <li><a class="reference internal" href="#parameters" id="id5">Parameters</a></li> <li><a class="reference internal" href="#notes" id="id6">Notes</a></li> <li><a class="reference internal" href="#examples" id="id7">Examples</a></li> <li><a class="reference internal" href="#return-values" id="id8">Return Values</a></li> </ul>   <h2 id="synopsis">Synopsis</h2> <ul class="simple"> <li>Build, load or pull an image, making the image available for creating containers. Also supports tagging an image, pushing an image, and archiving an image to a <code>.tar</code> file.</li> </ul>   <h2 id="requirements">Requirements</h2> <p>The below requirements are needed on the host that executes this module.</p> <ul class="simple"> <li>Docker API &gt;= 1.20</li> <li>Docker SDK for Python: Please note that the <a class="reference external" href="https://pypi.org/project/docker-py/">docker-py</a> Python module has been superseded by <a class="reference external" href="https://pypi.org/project/docker/">docker</a> (see <a class="reference external" href="https://github.com/docker/docker-py/issues/1310">here</a> for details). For Python 2.6, <code>docker-py</code> must be used. Otherwise, it is recommended to install the <code>docker</code> Python module. Note that both modules should <em>not</em> be installed at the same time. Also note that when both modules are installed and one of them is uninstalled, the other might no longer function and a reinstall of it is required.</li> <li>
<a class="reference external" href="https://docker-py.readthedocs.io/en/stable/">Docker SDK for Python</a> &gt;= 1.8.0 (use <a class="reference external" href="https://pypi.org/project/docker-py/">docker-py</a> for Python 2.6)</li> </ul>   <h2 id="parameters">Parameters</h2> <table class="documentation-table"> <tr> <th colspan="3">Parameter</th> <th>Choices/Defaults</th> <th width="100%">Comments</th> </tr> <tr> <td colspan="3">  <b>api_version</b>  <div> <span>string</span> </div> </td> <td> <b>Default:</b><br><div>"auto"</div> </td> <td> <div>The version of the Docker API running on the Docker Host.</div> <div>Defaults to the latest version of the API supported by Docker SDK for Python and the docker daemon.</div> <div>If the value is not specified in the task, the value of environment variable <code>DOCKER_API_VERSION</code> will be used instead. If the environment variable is not set, the default value will be used.</div> <div>
<br>aliases: docker_api_version</div> </td> </tr> <tr> <td colspan="3">  <b>archive_path</b>  <div> <span>path</span> </div> </td> <td> </td> <td> <div>Use with state <code>present</code> to archive an image to a .tar file.</div> </td> </tr> <tr> <td colspan="3">  <b>build</b>  <div> <span>dictionary</span> </div> </td> <td> </td> <td> <div>Specifies options used for building images.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="2">  <b>args</b>  <div> <span>dictionary</span> </div> </td> <td> </td> <td> <div>Provide a dictionary of <code>key:value</code> build arguments that map to Dockerfile ARG directive.</div> <div>Docker expects the value to be a string. For convenience any non-string values will be converted to strings.</div> <div>Requires Docker API &gt;= 1.21.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="2">  <b>cache_from</b>  <div> <span>list</span> / <span>elements=string</span> </div> </td> <td> </td> <td> <div>List of image names to consider as cache source.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="2">  <b>container_limits</b>  <div> <span>dictionary</span> </div> </td> <td> </td> <td> <div>A dictionary of limits applied to each container created by the build process.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td class="elbow-placeholder"></td> <td colspan="1">  <b>cpusetcpus</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>CPUs in which to allow execution, e.g., "0-3", "0,1".</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td class="elbow-placeholder"></td> <td colspan="1">  <b>cpushares</b>  <div> <span>integer</span> </div> </td> <td> </td> <td> <div>CPU shares (relative weight).</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td class="elbow-placeholder"></td> <td colspan="1">  <b>memory</b>  <div> <span>integer</span> </div> </td> <td> </td> <td> <div>Set memory limit for build.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td class="elbow-placeholder"></td> <td colspan="1">  <b>memswap</b>  <div> <span>integer</span> </div> </td> <td> </td> <td> <div>Total memory (memory + swap), -1 to disable swap.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="2">  <b>dockerfile</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Use with state <code>present</code> and source <code>build</code> to provide an alternate name for the Dockerfile to use when building an image.</div> <div>This can also include a relative path (relative to <em>path</em>).</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="2">  <b>etc_hosts</b>  <div> <span>dictionary</span> </div> </td> <td> </td> <td> <div>Extra hosts to add to <code>/etc/hosts</code> in building containers, as a mapping of hostname to IP address.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="2">  <b>http_timeout</b>  <div> <span>integer</span> </div> </td> <td> </td> <td> <div>Timeout for HTTP requests during the image build operation. Provide a positive integer value for the number of seconds.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="2">  <b>network</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The network to use for <code>RUN</code> build instructions.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="2">  <b>nocache</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Do not use cache when building an image.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="2">  <b>path</b>  <div> <span>path</span> / <span>required</span> </div> </td> <td> </td> <td> <div>Use with state 'present' to build an image. Will be the path to a directory containing the context and Dockerfile for building an image.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="2">  <b>platform</b>  <div> <span>string</span> </div> <div> added in 1.1.0 of community.docker </div> </td> <td> </td> <td> <div>Platform in the format <code>os[/arch[/variant]]</code>.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="2">  <b>pull</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>When building an image downloads any updates to the FROM image in Dockerfile.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="2">  <b>rm</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>no</li> <li><div>
<b>yes</b> ←</div></li> </ul> </td> <td> <div>Remove intermediate containers after build.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="2">  <b>target</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>When building an image specifies an intermediate build stage by name as a final stage for the resulting image.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="2">  <b>use_config_proxy</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>no</li> <li>yes</li> </ul> </td> <td> <div>If set to <code>yes</code> and a proxy configuration is specified in the docker client configuration (by default <code>$HOME/.docker/config.json</code>), the corresponding environment variables will be set in the container being built.</div> <div>Needs Docker SDK for Python &gt;= 3.7.0.</div> </td> </tr> <tr> <td colspan="3">  <b>ca_cert</b>  <div> <span>path</span> </div> </td> <td> </td> <td> <div>Use a CA certificate when performing server verification by providing the path to a CA certificate file.</div> <div>If the value is not specified in the task and the environment variable <code>DOCKER_CERT_PATH</code> is set, the file <code>ca.pem</code> from the directory specified in the environment variable <code>DOCKER_CERT_PATH</code> will be used.</div> <div>
<br>aliases: tls_ca_cert, cacert_path</div> </td> </tr> <tr> <td colspan="3">  <b>client_cert</b>  <div> <span>path</span> </div> </td> <td> </td> <td> <div>Path to the client's TLS certificate file.</div> <div>If the value is not specified in the task and the environment variable <code>DOCKER_CERT_PATH</code> is set, the file <code>cert.pem</code> from the directory specified in the environment variable <code>DOCKER_CERT_PATH</code> will be used.</div> <div>
<br>aliases: tls_client_cert, cert_path</div> </td> </tr> <tr> <td colspan="3">  <b>client_key</b>  <div> <span>path</span> </div> </td> <td> </td> <td> <div>Path to the client's TLS key file.</div> <div>If the value is not specified in the task and the environment variable <code>DOCKER_CERT_PATH</code> is set, the file <code>key.pem</code> from the directory specified in the environment variable <code>DOCKER_CERT_PATH</code> will be used.</div> <div>
<br>aliases: tls_client_key, key_path</div> </td> </tr> <tr> <td colspan="3">  <b>debug</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Debug mode</div> </td> </tr> <tr> <td colspan="3">  <b>docker_host</b>  <div> <span>string</span> </div> </td> <td> <b>Default:</b><br><div>"unix://var/run/docker.sock"</div> </td> <td> <div>The URL or Unix socket path used to connect to the Docker API. To connect to a remote host, provide the TCP connection string. For example, <code>tcp://192.0.2.23:2376</code>. If TLS is used to encrypt the connection, the module will automatically replace <code>tcp</code> in the connection URL with <code>https</code>.</div> <div>If the value is not specified in the task, the value of environment variable <code>DOCKER_HOST</code> will be used instead. If the environment variable is not set, the default value will be used.</div> <div>
<br>aliases: docker_url</div> </td> </tr> <tr> <td colspan="3">  <b>force_absent</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Use with state <em>absent</em> to un-tag and remove all images matching the specified name.</div> </td> </tr> <tr> <td colspan="3">  <b>force_source</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Use with state <code>present</code> to build, load or pull an image (depending on the value of the <em>source</em> option) when the image already exists.</div> </td> </tr> <tr> <td colspan="3">  <b>force_tag</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Use with state <code>present</code> to force tagging an image.</div> </td> </tr> <tr> <td colspan="3">  <b>load_path</b>  <div> <span>path</span> </div> </td> <td> </td> <td> <div>Use with state <code>present</code> to load an image from a .tar file.</div> <div>Set <em>source</em> to <code>load</code> if you want to load the image.</div> </td> </tr> <tr> <td colspan="3">  <b>name</b>  <div> <span>string</span> / <span>required</span> </div> </td> <td> </td> <td> <div>Image name. Name format will be one of: <code>name</code>, <code>repository/name</code>, <code>registry_server:port/name</code>. When pushing or pulling an image the name can optionally include the tag by appending <code>:tag_name</code>.</div> <div>Note that image IDs (hashes) are only supported for <em>state=absent</em>, for <em>state=present</em> with <em>source=load</em>, and for <em>state=present</em> with <em>source=local</em>.</div> </td> </tr> <tr> <td colspan="3">  <b>pull</b>  <div> <span>dictionary</span> </div> <div> added in 1.3.0 of community.docker </div> </td> <td> </td> <td> <div>Specifies options used for pulling images.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="2">  <b>platform</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>When pulling an image, ask for this specific platform.</div> <div>Note that this value is not used to determine whether the image needs to be pulled. This might change in the future in a minor release, though.</div> </td> </tr> <tr> <td colspan="3">  <b>push</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Push the image to the registry. Specify the registry as part of the <em>name</em> or <em>repository</em> parameter.</div> </td> </tr> <tr> <td colspan="3">  <b>repository</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Use with state <code>present</code> to tag the image.</div> <div>Expects format <code>repository:tag</code>. If no tag is provided, will use the value of the <em>tag</em> parameter or <code>latest</code>.</div> <div>If <em>push=true</em>, <em>repository</em> must either include a registry, or will be assumed to belong to the default registry (Docker Hub).</div> </td> </tr> <tr> <td colspan="3">  <b>source</b>  <div> <span>string</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>build</li> <li>load</li> <li>pull</li> <li>local</li> </ul> </td> <td> <div>Determines where the module will try to retrieve the image from.</div> <div>Use <code>build</code> to build the image from a <code>Dockerfile</code>. <em>build.path</em> must be specified when this value is used.</div> <div>Use <code>load</code> to load the image from a <code>.tar</code> file. <em>load_path</em> must be specified when this value is used.</div> <div>Use <code>pull</code> to pull the image from a registry.</div> <div>Use <code>local</code> to make sure that the image is already available on the local docker daemon, i.e. do not try to build, pull or load the image.</div> </td> </tr> <tr> <td colspan="3">  <b>ssl_version</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Provide a valid SSL version number. Default value determined by ssl.py module.</div> <div>If the value is not specified in the task, the value of environment variable <code>DOCKER_SSL_VERSION</code> will be used instead.</div> </td> </tr> <tr> <td colspan="3">  <b>state</b>  <div> <span>string</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>absent</li> <li><div>
<b>present</b> ←</div></li> </ul> </td> <td> <div>Make assertions about the state of an image.</div> <div>When <code>absent</code> an image will be removed. Use the force option to un-tag and remove all images matching the provided name.</div> <div>When <code>present</code> check if an image exists using the provided name and tag. If the image is not found or the force option is used, the image will either be pulled, built or loaded, depending on the <em>source</em> option.</div> </td> </tr> <tr> <td colspan="3">  <b>tag</b>  <div> <span>string</span> </div> </td> <td> <b>Default:</b><br><div>"latest"</div> </td> <td> <div>Used to select an image when pulling. Will be added to the image when pushing, tagging or building. Defaults to <em>latest</em>.</div> <div>If <em>name</em> parameter format is <em>name:tag</em>, then tag value from <em>name</em> will take precedence.</div> </td> </tr> <tr> <td colspan="3">  <b>timeout</b>  <div> <span>integer</span> </div> </td> <td> <b>Default:</b><br><div>60</div> </td> <td> <div>The maximum amount of time in seconds to wait on a response from the API.</div> <div>If the value is not specified in the task, the value of environment variable <code>DOCKER_TIMEOUT</code> will be used instead. If the environment variable is not set, the default value will be used.</div> </td> </tr> <tr> <td colspan="3">  <b>tls</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Secure the connection to the API by using TLS without verifying the authenticity of the Docker host server. Note that if <em>validate_certs</em> is set to <code>yes</code> as well, it will take precedence.</div> <div>If the value is not specified in the task, the value of environment variable <code>DOCKER_TLS</code> will be used instead. If the environment variable is not set, the default value will be used.</div> </td> </tr> <tr> <td colspan="3">  <b>tls_hostname</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>When verifying the authenticity of the Docker Host server, provide the expected name of the server.</div> <div>If the value is not specified in the task, the value of environment variable <code>DOCKER_TLS_HOSTNAME</code> will be used instead. If the environment variable is not set, the default value will be used.</div> <div>The current default value is <code>localhost</code>. This default is deprecated and will change in community.docker 2.0.0 to be a value computed from <em>docker_host</em>. Explicitly specify <code>localhost</code> to make sure this value will still be used, and to disable the deprecation message which will be shown otherwise.</div> </td> </tr> <tr> <td colspan="3">  <b>use_ssh_client</b>  <div> <span>boolean</span> </div> <div> added in 1.5.0 of community.docker </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>For SSH transports, use the <code>ssh</code> CLI tool instead of paramiko.</div> <div>Requires Docker SDK for Python 4.4.0 or newer.</div> </td> </tr> <tr> <td colspan="3">  <b>validate_certs</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Secure the connection to the API by using TLS and verifying the authenticity of the Docker host server.</div> <div>If the value is not specified in the task, the value of environment variable <code>DOCKER_TLS_VERIFY</code> will be used instead. If the environment variable is not set, the default value will be used.</div> <div>
<br>aliases: tls_verify</div> </td> </tr> </table> <br>  <h2 id="notes">Notes</h2> <div class="admonition note"> <p class="admonition-title">Note</p> <ul class="simple"> <li>Connect to the Docker daemon by providing parameters with each task or by defining environment variables. You can define <code>DOCKER_HOST</code>, <code>DOCKER_TLS_HOSTNAME</code>, <code>DOCKER_API_VERSION</code>, <code>DOCKER_CERT_PATH</code>, <code>DOCKER_SSL_VERSION</code>, <code>DOCKER_TLS</code>, <code>DOCKER_TLS_VERIFY</code> and <code>DOCKER_TIMEOUT</code>. If you are using docker machine, run the script shipped with the product that sets up the environment. It will set these variables for you. See <a class="reference external" href="https://docs.docker.com/machine/reference/env/">https://docs.docker.com/machine/reference/env/</a> for more details.</li> <li>When connecting to Docker daemon with TLS, you might need to install additional Python packages. For the Docker SDK for Python, version 2.4 or newer, this can be done by installing <code>docker[tls]</code> with <a class="reference internal" href="../../ansible/builtin/pip_module.html#ansible-collections-ansible-builtin-pip-module"><span class="std std-ref">ansible.builtin.pip</span></a>.</li> <li>Note that the Docker SDK for Python only allows to specify the path to the Docker configuration for very few functions. In general, it will use <code>$HOME/.docker/config.json</code> if the <code>DOCKER_CONFIG</code> environment variable is not specified, and use <code>$DOCKER_CONFIG/config.json</code> otherwise.</li> <li>This module uses the <a class="reference external" href="https://docker-py.readthedocs.io/en/stable/">Docker SDK for Python</a> to communicate with the Docker daemon.</li> </ul> </div>   <h2 id="examples">Examples</h2> <pre data-language="yaml+jinja">- name: Pull an image
  community.docker.docker_image:
    name: pacur/centos-7
    source: pull
    # Select platform for pulling. If not specified, will pull whatever docker prefers.
    pull:
      platform: amd64

- name: Tag and push to docker hub
  community.docker.docker_image:
    name: pacur/centos-7:56
    repository: dcoppenhagan/myimage:7.56
    push: yes
    source: local

- name: Tag and push to local registry
  community.docker.docker_image:
    # Image will be centos:7
    name: centos
    # Will be pushed to localhost:5000/centos:7
    repository: localhost:5000/centos
    tag: 7
    push: yes
    source: local

- name: Add tag latest to image
  community.docker.docker_image:
    name: myimage:7.1.2
    repository: myimage:latest
    # As 'latest' usually already is present, we need to enable overwriting of existing tags:
    force_tag: yes
    source: local

- name: Remove image
  community.docker.docker_image:
    state: absent
    name: registry.ansible.com/chouseknecht/sinatra
    tag: v1

- name: Build an image and push it to a private repo
  community.docker.docker_image:
    build:
      path: ./sinatra
    name: registry.ansible.com/chouseknecht/sinatra
    tag: v1
    push: yes
    source: build

- name: Archive image
  community.docker.docker_image:
    name: registry.ansible.com/chouseknecht/sinatra
    tag: v1
    archive_path: my_sinatra.tar
    source: local

- name: Load image from archive and push to a private registry
  community.docker.docker_image:
    name: localhost:5000/myimages/sinatra
    tag: v1
    push: yes
    load_path: my_sinatra.tar
    source: load

- name: Build image and with build args
  community.docker.docker_image:
    name: myimage
    build:
      path: /path/to/build/dir
      args:
        log_volume: /var/log/myapp
        listen_port: 8080
    source: build

- name: Build image using cache source
  community.docker.docker_image:
    name: myimage:latest
    build:
      path: /path/to/build/dir
      # Use as cache source for building myimage
      cache_from:
        - nginx:latest
        - alpine:3.8
    source: build
</pre>   <h2 id="return-values">Return Values</h2> <p>Common return values are documented <a class="reference internal" href="../../../reference_appendices/common_return_values.html#common-return-values"><span class="std std-ref">here</span></a>, the following are the fields unique to this module:</p> <table class="documentation-table"> <tr> <th colspan="1">Key</th> <th>Returned</th> <th width="100%">Description</th> </tr> <tr> <td colspan="1">  <b>image</b>  <div> <span>dictionary</span> </div> </td> <td>success</td> <td> <div>Image inspection results for the affected image.</div> <br> </td> </tr> <tr> <td colspan="1">  <b>stdout</b>  <div> <span>string</span> </div> <div>added in 1.0.0 of community.docker</div> </td> <td>success</td> <td> <div>Docker build output when building an image.</div> <br> </td> </tr> </table> <br><br> <h3 id="authors">Authors</h3> <ul class="simple"> <li>Pavel Antonov (@softzilla)</li> <li>Chris Houseknecht (@chouseknecht)</li> <li>Sorin Sbarnea (@ssbarnea)</li> </ul><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2012&ndash;2018 Michael DeHaan<br>&copy; 2018&ndash;2021 Red Hat, Inc.<br>Licensed under the GNU General Public License version 3.<br>
    <a href="https://docs.ansible.com/ansible/latest/collections/community/docker/docker_image_module.html" class="_attribution-link">https://docs.ansible.com/ansible/latest/collections/community/docker/docker_image_module.html</a>
  </p>
</div>
