<section id="community-docker-docker-image-build-module-build-docker-images-using-docker-buildx"> <h1>community.docker.docker_image_build module – Build Docker images using Docker buildx</h1> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This module is part of the <a class="reference external" href="https://galaxy.ansible.com/ui/repo/published/community/docker/">community.docker collection</a> (version 3.13.0).</p> <p>You might already have this collection installed if you are using the <code>ansible</code> package. It is not included in <code>ansible-core</code>. To check whether it is installed, run <code>ansible-galaxy collection list</code>.</p> <p>To install it, use: <code>ansible-galaxy collection install community.docker</code>. You need further requirements to be able to use this module, see <a class="reference internal" href="#ansible-collections-community-docker-docker-image-build-module-requirements"><span class="std std-ref">Requirements</span></a> for details.</p> <p>To use it in a playbook, specify: <code>community.docker.docker_image_build</code>.</p> </div> <p class="ansible-version-added">New in community.docker 3.6.0</p>  <ul class="simple"> <li><a class="reference internal" href="#synopsis" id="id1">Synopsis</a></li> <li><a class="reference internal" href="#requirements" id="id2">Requirements</a></li> <li><a class="reference internal" href="#parameters" id="id3">Parameters</a></li> <li><a class="reference internal" href="#attributes" id="id4">Attributes</a></li> <li><a class="reference internal" href="#notes" id="id5">Notes</a></li> <li><a class="reference internal" href="#see-also" id="id6">See Also</a></li> <li><a class="reference internal" href="#examples" id="id7">Examples</a></li> <li><a class="reference internal" href="#return-values" id="id8">Return Values</a></li> </ul>  <section id="synopsis"> <h2>Synopsis</h2> <ul class="simple"> <li>This module allows you to build Docker images using Docker’s buildx plugin (BuildKit).</li> <li>Note that the module is <strong>not idempotent</strong> in the sense of classical Ansible modules. The only idempotence check is whether the built image already exists. This check can be disabled with the <code><strong><a class="reference internal" href="#ansible-collections-community-docker-docker-image-build-module-parameter-rebuild"><span class="std std-ref">rebuild</span></a></strong></code> option.</li> </ul> </section> <section id="requirements"> <h2 id="ansible-collections-community-docker-docker-image-build-module-requirements">Requirements</h2> <p>The below requirements are needed on the host that executes this module.</p> <ul class="simple"> <li>Docker CLI with Docker buildx plugin</li> </ul> </section> <section id="parameters"> <h2>Parameters</h2> <table class="longtable ansible-option-table docutils align-default" style="width: 100%"> <thead> <tr>
<th class="head"><p>Parameter</p></th> <th class="head"><p>Comments</p></th> </tr> </thead>  <tr>
<td><div class="ansible-option-cell">  
<p class="ansible-option-title" id="ansible-collections-community-docker-docker-image-build-module-parameter-docker-api-version"><strong id="ansible-collections-community-docker-docker-image-build-module-parameter-api-version">api_version</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-aliases">aliases: docker_api_version</span></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The version of the Docker API running on the Docker Host.</p> <p>Defaults to the latest version of the API supported by this collection and the docker daemon.</p> <p>If the value is not specified in the task, the value of environment variable <a class="reference internal" href="docsite/scenario_guide.html#envvar-DOCKER_API_VERSION"><code>DOCKER_API_VERSION</code></a> will be used instead. If the environment variable is not set, the default value will be used.</p> <p class="ansible-option-line"><strong class="ansible-option-default-bold">Default:</strong> <code>"auto"</code></p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-docker-docker-image-build-module-parameter-args"><strong>args</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">dictionary</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Provide a dictionary of <code>key:value</code> build arguments that map to Dockerfile ARG directive.</p> <p>Docker expects the value to be a string. For convenience any non-string values will be converted to strings.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell">    
<p class="ansible-option-title" id="ansible-collections-community-docker-docker-image-build-module-parameter-tls-ca-cert"><strong id="ansible-collections-community-docker-docker-image-build-module-parameter-ca-cert">ca_path</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-aliases">aliases: ca_cert, tls_ca_cert, cacert_path</span></p> <p class="ansible-option-type-line"><span class="ansible-option-type">path</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Use a CA certificate when performing server verification by providing the path to a CA certificate file.</p> <p>If the value is not specified in the task and the environment variable <a class="reference internal" href="docsite/scenario_guide.html#envvar-DOCKER_CERT_PATH"><code>DOCKER_CERT_PATH</code></a> is set, the file <code>ca.pem</code> from the directory specified in the environment variable <a class="reference internal" href="docsite/scenario_guide.html#envvar-DOCKER_CERT_PATH"><code>DOCKER_CERT_PATH</code></a> will be used.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-docker-docker-image-build-module-parameter-cache-from"><strong>cache_from</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">list</span> / <span class="ansible-option-elements">elements=string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>List of image names to consider as cache source.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-docker-docker-image-build-module-parameter-cli-context"><strong>cli_context</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The Docker CLI context to use.</p> <p>Mutually exclusive with <code><strong><a class="reference internal" href="#ansible-collections-community-docker-docker-image-build-module-parameter-docker-host"><span class="std std-ref">docker_host</span></a></strong></code>.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell">   
<p class="ansible-option-title" id="ansible-collections-community-docker-docker-image-build-module-parameter-tls-client-cert"><strong id="ansible-collections-community-docker-docker-image-build-module-parameter-cert-path">client_cert</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-aliases">aliases: tls_client_cert, cert_path</span></p> <p class="ansible-option-type-line"><span class="ansible-option-type">path</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Path to the client’s TLS certificate file.</p> <p>If the value is not specified in the task and the environment variable <a class="reference internal" href="docsite/scenario_guide.html#envvar-DOCKER_CERT_PATH"><code>DOCKER_CERT_PATH</code></a> is set, the file <code>cert.pem</code> from the directory specified in the environment variable <a class="reference internal" href="docsite/scenario_guide.html#envvar-DOCKER_CERT_PATH"><code>DOCKER_CERT_PATH</code></a> will be used.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell">   
<p class="ansible-option-title" id="ansible-collections-community-docker-docker-image-build-module-parameter-tls-client-key"><strong id="ansible-collections-community-docker-docker-image-build-module-parameter-client-key">client_key</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-aliases">aliases: tls_client_key, key_path</span></p> <p class="ansible-option-type-line"><span class="ansible-option-type">path</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Path to the client’s TLS key file.</p> <p>If the value is not specified in the task and the environment variable <a class="reference internal" href="docsite/scenario_guide.html#envvar-DOCKER_CERT_PATH"><code>DOCKER_CERT_PATH</code></a> is set, the file <code>key.pem</code> from the directory specified in the environment variable <a class="reference internal" href="docsite/scenario_guide.html#envvar-DOCKER_CERT_PATH"><code>DOCKER_CERT_PATH</code></a> will be used.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-docker-docker-image-build-module-parameter-docker-cli"><strong>docker_cli</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">path</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Path to the Docker CLI. If not provided, will search for Docker CLI on the <code>PATH</code>.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell">  
<p class="ansible-option-title" id="ansible-collections-community-docker-docker-image-build-module-parameter-docker-url"><strong id="ansible-collections-community-docker-docker-image-build-module-parameter-docker-host">docker_host</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-aliases">aliases: docker_url</span></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The URL or Unix socket path used to connect to the Docker API. To connect to a remote host, provide the TCP connection string. For example, <code>tcp://192.0.2.23:2376</code>. If TLS is used to encrypt the connection, the module will automatically replace <code>tcp</code> in the connection URL with <code>https</code>.</p> <p>If the value is not specified in the task, the value of environment variable <a class="reference internal" href="docsite/scenario_guide.html#envvar-DOCKER_HOST"><code>DOCKER_HOST</code></a> will be used instead. If the environment variable is not set, the default value will be used.</p> <p>Mutually exclusive with <code><strong><a class="reference internal" href="#ansible-collections-community-docker-docker-image-build-module-parameter-cli-context"><span class="std std-ref">cli_context</span></a></strong></code>. If neither <code><strong><a class="reference internal" href="#ansible-collections-community-docker-docker-image-build-module-parameter-docker-host"><span class="std std-ref">docker_host</span></a></strong></code> nor <code><strong><a class="reference internal" href="#ansible-collections-community-docker-docker-image-build-module-parameter-cli-context"><span class="std std-ref">cli_context</span></a></strong></code> are provided, the value <code>unix:///var/run/docker.sock</code> is used.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-docker-docker-image-build-module-parameter-dockerfile"><strong>dockerfile</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Provide an alternate name for the Dockerfile to use when building an image.</p> <p>This can also include a relative path (relative to <code><strong><a class="reference internal" href="#ansible-collections-community-docker-docker-image-build-module-parameter-path"><span class="std std-ref">path</span></a></strong></code>).</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-docker-docker-image-build-module-parameter-etc-hosts"><strong>etc_hosts</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">dictionary</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Extra hosts to add to <code>/etc/hosts</code> in building containers, as a mapping of hostname to IP address.</p> <p>Instead of an IP address, the special value <code>host-gateway</code> can also be used, which resolves to the host’s gateway IP and allows building containers to connect to services running on the host.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-docker-docker-image-build-module-parameter-labels"><strong>labels</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">dictionary</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Dictionary of key value pairs.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-docker-docker-image-build-module-parameter-name"><strong>name</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span> / <span class="ansible-option-required">required</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Image name. Name format will be one of: <code>name</code>, <code>repository/name</code>, <code>registry_server:port/name</code>. When pushing or pulling an image the name can optionally include the tag by appending <code>:tag_name</code>.</p> <p>Note that image IDs (hashes) and names with digest cannot be used.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-docker-docker-image-build-module-parameter-network"><strong>network</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The network to use for <code>RUN</code> build instructions.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-docker-docker-image-build-module-parameter-nocache"><strong>nocache</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">boolean</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Do not use cache when building an image.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li>
<code><strong>false</strong></code> <span class="ansible-option-choices-default-mark">← (default)</span>
</li> <li><code>true</code></li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-docker-docker-image-build-module-parameter-outputs"><strong>outputs</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">list</span> / <span class="ansible-option-elements">elements=dictionary</span></p> <p><em class="ansible-option-versionadded">added in community.docker 3.10.0</em></p> </div></td> <td><div class="ansible-option-cell">
<p>Output destinations.</p> <p>You can provide a list of exporters to export the built image in various places. Note that not all exporters might be supported by the build driver used.</p> <p>Note that depending on how this option is used, no image with name <code><strong><a class="reference internal" href="#ansible-collections-community-docker-docker-image-build-module-parameter-name"><span class="std std-ref">name</span></a></strong></code> and tag <code><strong><a class="reference internal" href="#ansible-collections-community-docker-docker-image-build-module-parameter-tag"><span class="std std-ref">tag</span></a></strong></code> might be created, which can cause the basic idempotency this module offers to not work.</p> <p>Providing an empty list to this option is equivalent to not specifying it at all. The default behavior is a single entry with <code><a class="reference internal" href="#ansible-collections-community-docker-docker-image-build-module-parameter-outputs-type"><span class="std std-ref">outputs[].type=image</span></a></code>.</p> </div></td> </tr> <tr>
<td>

<div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-docker-docker-image-build-module-parameter-outputs-context"><strong>context</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div>
</td> <td>

<div class="ansible-option-cell">
<p>Name for the Docker context where to import the result.</p> <p>Optional for <code><a class="reference internal" href="#ansible-collections-community-docker-docker-image-build-module-parameter-outputs-type"><span class="std std-ref">outputs[].type=docker</span></a></code>.</p> </div>
</td> </tr> <tr>
<td>

<div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-docker-docker-image-build-module-parameter-outputs-dest"><strong>dest</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">path</span></p> </div>
</td> <td>

<div class="ansible-option-cell">
<p>The destination path.</p> <p>Required for <code><a class="reference internal" href="#ansible-collections-community-docker-docker-image-build-module-parameter-outputs-type"><span class="std std-ref">outputs[].type=local</span></a></code>, <code><a class="reference internal" href="#ansible-collections-community-docker-docker-image-build-module-parameter-outputs-type"><span class="std std-ref">outputs[].type=tar</span></a></code>, <code><a class="reference internal" href="#ansible-collections-community-docker-docker-image-build-module-parameter-outputs-type"><span class="std std-ref">outputs[].type=oci</span></a></code>.</p> <p>Optional for <code><a class="reference internal" href="#ansible-collections-community-docker-docker-image-build-module-parameter-outputs-type"><span class="std std-ref">outputs[].type=docker</span></a></code>.</p> </div>
</td> </tr> <tr>
<td>

<div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-docker-docker-image-build-module-parameter-outputs-name"><strong>name</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div>
</td> <td>

<div class="ansible-option-cell">
<p>Name under which the image is stored under.</p> <p>If not provided, <code><strong><a class="reference internal" href="#ansible-collections-community-docker-docker-image-build-module-parameter-name"><span class="std std-ref">name</span></a></strong></code> and <code><strong><a class="reference internal" href="#ansible-collections-community-docker-docker-image-build-module-parameter-tag"><span class="std std-ref">tag</span></a></strong></code> will be used.</p> <p>Optional for <code><a class="reference internal" href="#ansible-collections-community-docker-docker-image-build-module-parameter-outputs-type"><span class="std std-ref">outputs[].type=image</span></a></code>.</p> </div>
</td> </tr> <tr>
<td>

<div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-docker-docker-image-build-module-parameter-outputs-push"><strong>push</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">boolean</span></p> </div>
</td> <td>

<div class="ansible-option-cell">
<p>Whether to push the built image to a registry.</p> <p>Only used for <code><a class="reference internal" href="#ansible-collections-community-docker-docker-image-build-module-parameter-outputs-type"><span class="std std-ref">outputs[].type=image</span></a></code>.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li>
<code><strong>false</strong></code> <span class="ansible-option-choices-default-mark">← (default)</span>
</li> <li><code>true</code></li> </ul> </div>
</td> </tr> <tr>
<td>

<div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-docker-docker-image-build-module-parameter-outputs-type"><strong>type</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span> / <span class="ansible-option-required">required</span></p> </div>
</td> <td>

<div class="ansible-option-cell">
<p>The type of exporter to use.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul> <li>
<p><code>"docker"</code>: This export type writes the single-platform result image as a Docker image specification tarball on the client. Tarballs created by this exporter are also OCI compatible.</p> <p>The destination can be provided in <code><strong><span>outputs[].dest</span></strong></code>. If not specified, the tar will be loaded automatically to the local image store.</p> <p>The Docker context where to import the result can be provided in <code><strong><span>outputs[].context</span></strong></code>.</p> </li> <li>
<p><code>"image"</code>: This exporter writes the build result as an image or a manifest list. When using this driver, the image will appear in <code>docker images</code>.</p> <p>The image name can be provided in <code><strong><span>outputs[].name</span></strong></code>. If it is not provided, <code><strong><span>name</span></strong></code> and <code><strong><span>tag</span></strong></code> will be used.</p> <p>Optionally, image can be automatically pushed to a registry by setting <code><span>outputs[].push=true</span></code>.</p> </li> <li>
<p><code>"local"</code>: This export type writes all result files to a directory on the client. The new files will be owned by the current user. On multi-platform builds, all results will be put in subdirectories by their platform.</p> <p>The destination has to be provided in <code><strong><span>outputs[].dest</span></strong></code>.</p> </li> <li>
<p><code>"oci"</code>: This export type writes the result image or manifest list as an <a class="reference external" href="https://github.com/opencontainers/image-spec/blob/v1.0.1/image-layout.md">OCI image layout</a> tarball on the client.</p> <p>The destination has to be provided in <code><strong><span>outputs[].dest</span></strong></code>.</p> </li> <li>
<p><code>"tar"</code>: This export type export type writes all result files as a single tarball on the client. On multi-platform builds, all results will be put in subdirectories by their platform.</p> <p>The destination has to be provided in <code><strong><span>outputs[].dest</span></strong></code>.</p> </li> </ul> </div>
</td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-docker-docker-image-build-module-parameter-path"><strong>path</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">path</span> / <span class="ansible-option-required">required</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The path for the build environment.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-docker-docker-image-build-module-parameter-platform"><strong>platform</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">list</span> / <span class="ansible-option-elements">elements=string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Platforms in the format <code>os[/arch[/variant]]</code>.</p> <p>Since community.docker 3.10.0 this can be a list of platforms, instead of just a single platform.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-docker-docker-image-build-module-parameter-pull"><strong>pull</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">boolean</span></p> </div></td> <td><div class="ansible-option-cell">
<p>When building an image downloads any updates to the FROM image in Dockerfile.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li>
<code><strong>false</strong></code> <span class="ansible-option-choices-default-mark">← (default)</span>
</li> <li><code>true</code></li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-docker-docker-image-build-module-parameter-rebuild"><strong>rebuild</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Defines the behavior of the module if the image to build (as specified in <code><strong><a class="reference internal" href="#ansible-collections-community-docker-docker-image-build-module-parameter-name"><span class="std std-ref">name</span></a></strong></code> and <code><strong><a class="reference internal" href="#ansible-collections-community-docker-docker-image-build-module-parameter-tag"><span class="std std-ref">tag</span></a></strong></code>) already exists.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li>
<code><strong>"never"</strong></code> <span class="ansible-option-choices-default-mark">← (default)</span>
</li> <li><code>"always"</code></li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-docker-docker-image-build-module-parameter-secrets"><strong>secrets</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">list</span> / <span class="ansible-option-elements">elements=dictionary</span></p> <p><em class="ansible-option-versionadded">added in community.docker 3.10.0</em></p> </div></td> <td><div class="ansible-option-cell">
<p>Secrets to expose to the build.</p> </div></td> </tr> <tr>
<td>

<div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-docker-docker-image-build-module-parameter-secrets-env"><strong>env</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div>
</td> <td>

<div class="ansible-option-cell">
<p>Environment value of the secret.</p> <p>Only supported and required for <code><a class="reference internal" href="#ansible-collections-community-docker-docker-image-build-module-parameter-secrets-type"><span class="std std-ref">secrets[].type=env</span></a></code>.</p> </div>
</td> </tr> <tr>
<td>

<div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-docker-docker-image-build-module-parameter-secrets-id"><strong>id</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span> / <span class="ansible-option-required">required</span></p> </div>
</td> <td>

<div class="ansible-option-cell">
<p>The secret identifier.</p> <p>The secret will be made available as a file in the container under <code>/run/secrets/&lt;id&gt;</code>.</p> </div>
</td> </tr> <tr>
<td>

<div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-docker-docker-image-build-module-parameter-secrets-src"><strong>src</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">path</span></p> </div>
</td> <td>

<div class="ansible-option-cell">
<p>Source path of the secret.</p> <p>Only supported and required for <code><a class="reference internal" href="#ansible-collections-community-docker-docker-image-build-module-parameter-secrets-type"><span class="std std-ref">secrets[].type=file</span></a></code>.</p> </div>
</td> </tr> <tr>
<td>

<div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-docker-docker-image-build-module-parameter-secrets-type"><strong>type</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span> / <span class="ansible-option-required">required</span></p> </div>
</td> <td>

<div class="ansible-option-cell">
<p>Type of the secret.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul> <li>
<p><code>"env"</code>: Reads the secret from an environment variable on the target.</p> <p>The environment variable must be named in <code><strong><span>secrets[].env</span></strong></code>.</p> <p>Note that this requires the Buildkit plugin to have version 0.6.0 or newer.</p> </li> <li>
<p><code>"file"</code>: Reads the secret from a file on the target.</p> <p>The file must be specified in <code><strong><span>secrets[].src</span></strong></code>.</p> </li> <li>
<p><code>"value"</code>: Provides the secret from a given value <code><strong><span>secrets[].value</span></strong></code>.</p> <p><strong>Note</strong> that the secret will be passed as an environment variable to <code>docker compose</code>. Use another mean of transport if you consider this not safe enough.</p> <p>Note that this requires the Buildkit plugin to have version 0.6.0 or newer.</p> </li> </ul> </div>
</td> </tr> <tr>
<td>

<div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-docker-docker-image-build-module-parameter-secrets-value"><strong>value</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div>
</td> <td>

<div class="ansible-option-cell">
<p>Value of the secret.</p> <p><strong>Note</strong> that the secret will be passed as an environment variable to <code>docker compose</code>. Use another mean of transport if you consider this not safe enough.</p> <p>Only supported and required for <code><a class="reference internal" href="#ansible-collections-community-docker-docker-image-build-module-parameter-secrets-type"><span class="std std-ref">secrets[].type=value</span></a></code>.</p> </div>
</td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-docker-docker-image-build-module-parameter-shm-size"><strong>shm_size</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Size of <code>/dev/shm</code> in format <code>&lt;number&gt;[&lt;unit&gt;]</code>. Number is positive integer. Unit can be <code>B</code> (byte), <code>K</code> (kibibyte, 1024B), <code>M</code> (mebibyte), <code>G</code> (gibibyte), <code>T</code> (tebibyte), or <code>P</code> (pebibyte).</p> <p>Omitting the unit defaults to bytes. If you omit the size entirely, Docker daemon uses <code>64M</code>.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-docker-docker-image-build-module-parameter-tag"><strong>tag</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Tag for the image name <code><strong><a class="reference internal" href="#ansible-collections-community-docker-docker-image-build-module-parameter-name"><span class="std std-ref">name</span></a></strong></code> that is to be tagged.</p> <p>If <code><strong><a class="reference internal" href="#ansible-collections-community-docker-docker-image-build-module-parameter-name"><span class="std std-ref">name</span></a></strong></code>‘s format is <code>name:tag</code>, then the tag value from <code><strong><a class="reference internal" href="#ansible-collections-community-docker-docker-image-build-module-parameter-name"><span class="std std-ref">name</span></a></strong></code> will take precedence.</p> <p class="ansible-option-line"><strong class="ansible-option-default-bold">Default:</strong> <code>"latest"</code></p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-docker-docker-image-build-module-parameter-target"><strong>target</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>When building an image specifies an intermediate build stage by name as a final stage for the resulting image.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-docker-docker-image-build-module-parameter-tls"><strong>tls</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">boolean</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Secure the connection to the API by using TLS without verifying the authenticity of the Docker host server. Note that if <code><strong><a class="reference internal" href="#ansible-collections-community-docker-docker-image-build-module-parameter-validate-certs"><span class="std std-ref">validate_certs</span></a></strong></code> is set to <code>true</code> as well, it will take precedence.</p> <p>If the value is not specified in the task, the value of environment variable <a class="reference internal" href="docsite/scenario_guide.html#envvar-DOCKER_TLS"><code>DOCKER_TLS</code></a> will be used instead. If the environment variable is not set, the default value will be used.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li>
<code><strong>false</strong></code> <span class="ansible-option-choices-default-mark">← (default)</span>
</li> <li><code>true</code></li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-docker-docker-image-build-module-parameter-tls-hostname"><strong>tls_hostname</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>When verifying the authenticity of the Docker Host server, provide the expected name of the server.</p> <p>If the value is not specified in the task, the value of environment variable <a class="reference internal" href="docsite/scenario_guide.html#envvar-DOCKER_TLS_HOSTNAME"><code>DOCKER_TLS_HOSTNAME</code></a> will be used instead. If the environment variable is not set, the default value will be used.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell">  
<p class="ansible-option-title" id="ansible-collections-community-docker-docker-image-build-module-parameter-validate-certs"><strong id="ansible-collections-community-docker-docker-image-build-module-parameter-tls-verify">validate_certs</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-aliases">aliases: tls_verify</span></p> <p class="ansible-option-type-line"><span class="ansible-option-type">boolean</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Secure the connection to the API by using TLS and verifying the authenticity of the Docker host server.</p> <p>If the value is not specified in the task, the value of environment variable <a class="reference internal" href="docsite/scenario_guide.html#envvar-DOCKER_TLS_VERIFY"><code>DOCKER_TLS_VERIFY</code></a> will be used instead. If the environment variable is not set, the default value will be used.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li>
<code><strong>false</strong></code> <span class="ansible-option-choices-default-mark">← (default)</span>
</li> <li><code>true</code></li> </ul> </div></td> </tr>  </table> </section> <section id="attributes"> <h2>Attributes</h2> <table class="longtable ansible-option-table docutils align-default" style="width: 100%"> <thead> <tr>
<th class="head"><p>Attribute</p></th> <th class="head"><p>Support</p></th> <th class="head"><p>Description</p></th> </tr> </thead>  <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-docker-docker-image-build-module-attribute-action-group"><strong>action_group</strong></p> 
</div></td> <td><div class="ansible-option-cell">
<p><strong class="ansible-attribute-support-property">Action groups:</strong> <strong class="ansible-attribute-support-full">community.docker.docker</strong>, <strong class="ansible-attribute-support-full">docker</strong></p> </div></td> <td><div class="ansible-option-cell">
<p>Use <code>group/docker</code> or <code>group/community.docker.docker</code> in <code>module_defaults</code> to set defaults for this module.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-docker-docker-image-build-module-attribute-check-mode"><strong>check_mode</strong></p> 
</div></td> <td><div class="ansible-option-cell">
<p><strong class="ansible-attribute-support-label">Support: </strong><strong class="ansible-attribute-support-full">full</strong></p> </div></td> <td><div class="ansible-option-cell">
<p>Can run in <code>check_mode</code> and return changed status prediction without modifying target.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-docker-docker-image-build-module-attribute-diff-mode"><strong>diff_mode</strong></p> 
</div></td> <td><div class="ansible-option-cell">
<p><strong class="ansible-attribute-support-label">Support: </strong><strong class="ansible-attribute-support-none">none</strong></p> </div></td> <td><div class="ansible-option-cell">
<p>Will return details on what has changed (or possibly needs changing in <code>check_mode</code>), when in diff mode.</p> </div></td> </tr>  </table> </section> <section id="notes"> <h2>Notes</h2> <div class="admonition note"> <p class="admonition-title">Note</p> <ul class="simple"> <li>Connect to the Docker daemon by providing parameters with each task or by defining environment variables. You can define <a class="reference internal" href="docsite/scenario_guide.html#envvar-DOCKER_HOST"><code>DOCKER_HOST</code></a>, <a class="reference internal" href="docsite/scenario_guide.html#envvar-DOCKER_TLS_HOSTNAME"><code>DOCKER_TLS_HOSTNAME</code></a>, <a class="reference internal" href="docsite/scenario_guide.html#envvar-DOCKER_API_VERSION"><code>DOCKER_API_VERSION</code></a>, <a class="reference internal" href="docsite/scenario_guide.html#envvar-DOCKER_CERT_PATH"><code>DOCKER_CERT_PATH</code></a>, <a class="reference internal" href="docsite/scenario_guide.html#envvar-DOCKER_TLS"><code>DOCKER_TLS</code></a>, <a class="reference internal" href="docsite/scenario_guide.html#envvar-DOCKER_TLS_VERIFY"><code>DOCKER_TLS_VERIFY</code></a> and <a class="reference internal" href="docsite/scenario_guide.html#envvar-DOCKER_TIMEOUT"><code>DOCKER_TIMEOUT</code></a>. If you are using docker machine, run the script shipped with the product that sets up the environment. It will set these variables for you. See <a class="reference external" href="https://docs.docker.com/machine/reference/env/">https://docs.docker.com/machine/reference/env/</a> for more details.</li> <li>This module does <strong>not</strong> use the <a class="reference external" href="https://docker-py.readthedocs.io/en/stable/">Docker SDK for Python</a> to communicate with the Docker daemon. It directly calls the Docker CLI program.</li> </ul> </div> </section> <section id="see-also"> <h2>See Also</h2> <div class="admonition seealso"> <p class="admonition-title">See also</p> <dl class="simple"> <dt><a class="reference internal" href="docker_image_push_module.html#ansible-collections-community-docker-docker-image-push-module"><span class="std std-ref">community.docker.docker_image_push</span></a></dt>
<dd>
<p>Push Docker images to registries.</p> </dd> <dt><a class="reference internal" href="docker_image_tag_module.html#ansible-collections-community-docker-docker-image-tag-module"><span class="std std-ref">community.docker.docker_image_tag</span></a></dt>
<dd>
<p>Tag Docker images with new names and/or tags.</p> </dd> </dl> </div> </section> <section id="examples"> <h2>Examples</h2> <pre data-language="yaml+jinja">- name: Build Python 3.12 image
  community.docker.docker_image_build:
    name: localhost/python/3.12:latest
    path: /home/user/images/python
    dockerfile: Dockerfile-3.12

- name: Build multi-platform image
  community.docker.docker_image_build:
    name: multi-platform-image
    tag: "1.5.2"
    path: /home/user/images/multi-platform
    platform:
      - linux/amd64
      - linux/arm64/v8
</pre> </section> <section id="return-values"> <h2>Return Values</h2> <p>Common return values are documented <a class="reference internal" href="../../../reference_appendices/common_return_values.html#common-return-values"><span class="std std-ref">here</span></a>, the following are the fields unique to this module:</p> <table class="longtable ansible-option-table docutils align-default" style="width: 100%"> <thead> <tr>
<th class="head"><p>Key</p></th> <th class="head"><p>Description</p></th> </tr> </thead>  <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-docker-docker-image-build-module-return-image"><strong>image</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">dictionary</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Image inspection results for the affected image.</p> <p class="ansible-option-line"><strong class="ansible-option-returned-bold">Returned:</strong> success</p> <p class="ansible-option-line ansible-option-sample"><strong class="ansible-option-sample-bold">Sample:</strong> <code>{}</code></p> </div></td> </tr>  </table> <section id="authors"> <h3>Authors</h3> <ul class="simple"> <li>Felix Fontein (@felixfontein)</li> </ul> </section> <section id="collection-links"> <h3>Collection links</h3> <ul class="ansible-links"> <li><span><a aria-role="button" class="ansible-link reference external" href="https://github.com/ansible-collections/community.docker/issues" rel="noopener external" target="_blank">Issue Tracker</a></span></li> <li><span><a aria-role="button" class="ansible-link reference external" href="https://github.com/ansible-collections/community.docker" rel="noopener external" target="_blank">Repository (Sources)</a></span></li> <li><span><a aria-role="button" class="ansible-link reference external" href="https://forum.ansible.com/tags/c/help/6/none/docker" rel="noopener external" target="_blank">Ask for help (Docker)</a></span></li> <li><span><a aria-role="button" class="ansible-link reference external" href="https://forum.ansible.com/tags/c/help/6/none/docker-compose" rel="noopener external" target="_blank">Ask for help (Docker Compose)</a></span></li> <li><span><a aria-role="button" class="ansible-link reference external" href="https://forum.ansible.com/tags/c/help/6/none/docker-swarm" rel="noopener external" target="_blank">Ask for help (Docker Swarm)</a></span></li> <li><span><a aria-role="button" class="ansible-link reference external" href="https://github.com/ansible-collections/community.docker/issues/new?assignees=&amp;labels=&amp;template=bug_report.md" rel="noopener external" target="_blank">Submit a bug report</a></span></li> <li><span><a aria-role="button" class="ansible-link reference external" href="https://github.com/ansible-collections/community.docker/issues/new?assignees=&amp;labels=&amp;template=feature_request.md" rel="noopener external" target="_blank">Request a feature</a></span></li> <li><span><a class="reference internal" href="index.html#communication-for-community-docker"><span class="std std-ref">Communication</span></a></span></li> </ul> </section> </section> </section><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2012&ndash;2018 Michael DeHaan<br>&copy; 2018&ndash;2024 Red Hat, Inc.<br>Licensed under the GNU General Public License version 3.<br>
    <a href="https://docs.ansible.com/ansible/latest/collections/community/docker/docker_image_build_module.html" class="_attribution-link">https://docs.ansible.com/ansible/latest/collections/community/docker/docker_image_build_module.html</a>
  </p>
</div>
