<h1 id="community-windows-win-pssession-configuration-manage-pssession-configurations">community.windows.win_pssession_configuration – Manage PSSession Configurations</h1> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This plugin is part of the <a class="reference external" href="https://galaxy.ansible.com/community/windows">community.windows collection</a> (version 1.7.0).</p> <p>You might already have this collection installed if you are using the <code>ansible</code> package. It is not included in <code>ansible-core</code>. To check whether it is installed, run <code>ansible-galaxy collection list</code>.</p> <p>To install it, use: <code>ansible-galaxy collection install community.windows</code>.</p> <p>To use it in a playbook, specify: <code>community.windows.win_pssession_configuration</code>.</p> </div>  <ul class="simple"> <li><a class="reference internal" href="#synopsis" id="id1">Synopsis</a></li> <li><a class="reference internal" href="#parameters" id="id2">Parameters</a></li> <li><a class="reference internal" href="#notes" id="id3">Notes</a></li> <li><a class="reference internal" href="#see-also" id="id4">See Also</a></li> <li><a class="reference internal" href="#examples" id="id5">Examples</a></li> </ul>   <h2 id="synopsis">Synopsis</h2> <ul class="simple"> <li>Register, unregister, and modify PSSession Configurations for PowerShell remoting.</li> </ul> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This module has a corresponding <a class="reference internal" href="../../../plugins/action.html#action-plugins"><span class="std std-ref">action plugin</span></a>.</p> </div>   <h2 id="parameters">Parameters</h2> <table class="documentation-table"> <tr> <th colspan="1">Parameter</th> <th>Choices/Defaults</th> <th width="100%">Comments</th> </tr> <tr> <td colspan="1">  <b>access_mode</b>  <div> <span>string</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>disabled</li> <li>local</li> <li>remote</li> </ul> </td> <td> <div>Controls whether the session configuration allows connection from the <code>local</code> machine only, both local and <code>remote</code>, or none (<code>disabled</code>).</div> </td> </tr> <tr> <td colspan="1">  <b>alias_definitions</b>  <div> <span>dictionary</span> </div> </td> <td> </td> <td> <div>A dict that defines aliases for each session.</div> </td> </tr> <tr> <td colspan="1">  <b>assemblies_to_load</b>  <div> <span>list</span> / <span>elements=string</span> </div> </td> <td> </td> <td> <div>The assemblies that should be loaded into each session.</div> </td> </tr> <tr> <td colspan="1">  <b>async_poll</b>  <div> <span>integer</span> </div> </td> <td> <b>Default:</b><br><div>1</div> </td> <td> <div>Sets a delay in seconds between each check of the asynchronous execution status.</div> <div>Replicates the functionality of the <code>poll</code> keyword.</div> <div>Has no effect in check mode.</div> <div>
<em>async_poll=0</em> is not supported.</div> </td> </tr> <tr> <td colspan="1">  <b>async_timeout</b>  <div> <span>integer</span> </div> </td> <td> <b>Default:</b><br><div>300</div> </td> <td> <div>Sets a timeout for how long in seconds to wait for asynchronous module execution and waiting for the connection to recover.</div> <div>Replicates the functionality of the <code>async</code> keyword.</div> <div>Has no effect in check mode.</div> </td> </tr> <tr> <td colspan="1">  <b>author</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The author of the session configuration.</div> <div>This value is metadata and does not affect the functionality of the session configuration.</div> <div>If not set, a value may be generated automatically.</div> <div>See also <em>lenient_config_fields</em>.</div> </td> </tr> <tr> <td colspan="1">  <b>company_name</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The company that authored the session configuration.</div> <div>This value is metadata and does not affect the functionality of the session configuration.</div> <div>If not set, a value may be generated automatically.</div> <div>See also <em>lenient_config_fields</em>.</div> </td> </tr> <tr> <td colspan="1">  <b>copyright</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The copyright statement of the session configuration.</div> <div>This value is metadata and does not affect the functionality of the session configuration.</div> <div>If not set, a value may be generated automatically.</div> <div>See also <em>lenient_config_fields</em>.</div> </td> </tr> <tr> <td colspan="1">  <b>description</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The description of the session configuration.</div> <div>This value is metadata and does not affect the functionality of the session configuration.</div> <div>See also <em>lenient_config_fields</em>.</div> </td> </tr> <tr> <td colspan="1">  <b>environment_variables</b>  <div> <span>dictionary</span> </div> </td> <td> </td> <td> <div>A dict that defines environment variables for each session.</div> </td> </tr> <tr> <td colspan="1">  <b>execution_policy</b>  <div> <span>string</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>default</li> <li>remote_signed</li> <li>restricted</li> <li>undefined</li> <li>unrestricted</li> </ul> </td> <td> <div>The execution policy controlling script execution in the PowerShell session.</div> </td> </tr> <tr> <td colspan="1">  <b>formats_to_process</b>  <div> <span>list</span> / <span>elements=path</span> </div> </td> <td> </td> <td> <div>Paths to format definition files to process for each session.</div> </td> </tr> <tr> <td colspan="1">  <b>function_definitions</b>  <div> <span>dictionary</span> </div> </td> <td> </td> <td> <div>A dict that defines functions for each session.</div> </td> </tr> <tr> <td colspan="1">  <b>group_managed_service_account</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>If the session will run as a group managed service account (gMSA) then this is the name.</div> <div>Do not use <em>run_as_credential_username</em> and <em>run_as_credential_password</em> to specify a gMSA.</div> </td> </tr> <tr> <td colspan="1">  <b>guid</b>  <div> <span>raw</span> </div> </td> <td> </td> <td> <div>The GUID (UUID) of the session configuration file.</div> <div>This value is metadata, so it only matters if you use it externally.</div> <div>If not set, a value will be generated automatically.</div> <div>Acceptable GUID formats are flexible. Any string of 32 hexadecimal digits will be accepted, with all hyphens <code>-</code> and opening/closing <code>{}</code> ignored.</div> <div>See also <em>lenient_config_fields</em>.</div> </td> </tr> <tr> <td colspan="1">  <b>language_mode</b>  <div> <span>string</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>no_language</li> <li>restricted_language</li> <li>constrained_language</li> <li>full_language</li> </ul> </td> <td> <div>Determines the language mode of the PowerShell session.</div> </td> </tr> <tr> <td colspan="1">  <b>lenient_config_fields</b>  <div> <span>list</span> / <span>elements=string</span> </div> </td> <td> <b>Default:</b><br><div>["guid", "author", "company_name", "copyright", "description"]</div> </td> <td> <div>Some fields used in the session configuration do not affect its function, and are sometimes auto-generated when not specified.</div> <div>To avoid unnecessarily changing the configuration on each run, the values of these options will only be enforced when they are explicitly specified.</div> </td> </tr> <tr> <td colspan="1">  <b>maximum_received_data_size_per_command_mb</b>  <div> <span>raw</span> </div> </td> <td> </td> <td> <div>Sets the maximum received data size per command in MB.</div> <div>Must fit into a double precision floating point value.</div> </td> </tr> <tr> <td colspan="1">  <b>maximum_received_object_size_mb</b>  <div> <span>raw</span> </div> </td> <td> </td> <td> <div>Sets the maximum object size in MB.</div> <div>Must fit into a double precision floating point value.</div> </td> </tr> <tr> <td colspan="1">  <b>modules_to_import</b>  <div> <span>list</span> / <span>elements=raw</span> </div> </td> <td> </td> <td> <div>A list of modules that should be imported into the session.</div> <div>Any valid PowerShell module spec can be used here, so simple str names or dicts can be used.</div> <div>If a dict is used, no snake_case conversion is done, so the original PowerShell names must be used.</div> </td> </tr> <tr> <td colspan="1">  <b>mount_user_drive</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>no</li> <li>yes</li> </ul> </td> <td> <div>If <code>yes</code> the session creates and mounts a user-specific PSDrive for use with file transfers.</div> </td> </tr> <tr> <td colspan="1">  <b>name</b>  <div> <span>string</span> / <span>required</span> </div> </td> <td> </td> <td> <div>The name of the session configuration to manage.</div> </td> </tr> <tr> <td colspan="1">  <b>powershell_version</b>  <div> <span>raw</span> </div> </td> <td> </td> <td> <div>The minimum required PowerShell version for this session.</div> <div>Must be a valid .Net System.Version string.</div> </td> </tr> <tr> <td colspan="1">  <b>processor_architecure</b>  <div> <span>string</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>amd64</li> <li>x86</li> </ul> </td> <td> <div>The processor architecture of the session (32 bit vs. 64 bit).</div> </td> </tr> <tr> <td colspan="1">  <b>required_groups</b>  <div> <span>dictionary</span> </div> </td> <td> </td> <td> <div>For JEA sessions, defines conditional access rules about which groups a connecting user must belong to.</div> <div>For more information see <a href="https://docs.microsoft.com/en-us/powershell/scripting/learn/remoting/jea/session-configurations#conditional-access-rules">https://docs.microsoft.com/en-us/powershell/scripting/learn/remoting/jea/session-configurations#conditional-access-rules</a>.</div> </td> </tr> <tr> <td colspan="1">  <b>role_definitions</b>  <div> <span>dictionary</span> </div> </td> <td> </td> <td> <div>A dict defining the roles for JEA sessions.</div> <div>For more information see <a href="https://docs.microsoft.com/en-us/powershell/scripting/learn/remoting/jea/session-configurations#role-definitions">https://docs.microsoft.com/en-us/powershell/scripting/learn/remoting/jea/session-configurations#role-definitions</a>.</div> </td> </tr> <tr> <td colspan="1">  <b>run_as_credential_password</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The password for <em>run_as_credential_username</em>.</div> </td> </tr> <tr> <td colspan="1">  <b>run_as_credential_username</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Used to set a RunAs account for the session. All commands executed in the session will be run as this user.</div> <div>To use a gMSA, see <em>group_managed_service_account</em>.</div> <div>To use a virtual account, see <em>run_as_virtual_account</em> and <em>run_as_virtual_account_groups</em>.</div> <div>Status will always be <code>changed</code> when a RunAs credential is set because the password cannot be retrieved for comparison.</div> </td> </tr> <tr> <td colspan="1">  <b>run_as_virtual_account</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>no</li> <li>yes</li> </ul> </td> <td> <div>If <code>yes</code> the session runs as a virtual account.</div> <div>Do not use <em>run_as_credential_username</em> and <em>run_as_credential_password</em> to specify a virtual account.</div> </td> </tr> <tr> <td colspan="1">  <b>run_as_virtual_account_groups</b>  <div> <span>list</span> / <span>elements=string</span> </div> </td> <td> </td> <td> <div>If <em>run_as_virtual_account=yes</em> this is a list of groups to add the virtual account to.</div> </td> </tr> <tr> <td colspan="1">  <b>schema_version</b>  <div> <span>raw</span> </div> </td> <td> </td> <td> <div>The schema version of the session configuration file.</div> <div>If not set, a value will be generated automatically.</div> <div>Must be a valid .Net System.Version string.</div> </td> </tr> <tr> <td colspan="1">  <b>scripts_to_process</b>  <div> <span>list</span> / <span>elements=string</span> </div> </td> <td> </td> <td> <div>A list of paths to script files ending in <code>.ps1</code> that should be applied to the session.</div> </td> </tr> <tr> <td colspan="1">  <b>security_descriptor_sddl</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>An SDDL string that controls which users and groups can connect to the session.</div> <div>If <em>role_definitions</em> is specified the security descriptor will be set based on that.</div> <div>If this option is not specified the default security descriptor will be applied.</div> </td> </tr> <tr> <td colspan="1">  <b>session_type</b>  <div> <span>string</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>default</li> <li>empty</li> <li>restricted_remote_server</li> </ul> </td> <td> <div>Controls what type of session this is.</div> </td> </tr> <tr> <td colspan="1">  <b>startup_script</b>  <div> <span>path</span> </div> </td> <td> </td> <td> <div>A script that gets run on session startup.</div> </td> </tr> <tr> <td colspan="1">  <b>state</b>  <div> <span>string</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>present</b> ←</div></li> <li>absent</li> </ul> </td> <td> <div>The desired state of the configuration.</div> </td> </tr> <tr> <td colspan="1">  <b>thread_apartment_state</b>  <div> <span>string</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>mta</li> <li>sta</li> </ul> </td> <td> <div>The apartment state for the PowerShell session.</div> </td> </tr> <tr> <td colspan="1">  <b>thread_options</b>  <div> <span>string</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>default</li> <li>reuse_thread</li> <li>use_current_thread</li> <li>use_new_thread</li> </ul> </td> <td> <div>Sets thread options for the session.</div> </td> </tr> <tr> <td colspan="1">  <b>transcript_directory</b>  <div> <span>path</span> </div> </td> <td> </td> <td> <div>Automatic session transcripts will be written to this directory.</div> </td> </tr> <tr> <td colspan="1">  <b>types_to_process</b>  <div> <span>list</span> / <span>elements=path</span> </div> </td> <td> </td> <td> <div>Paths to type definition files to process for each session.</div> </td> </tr> <tr> <td colspan="1">  <b>use_shared_process</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>no</li> <li>yes</li> </ul> </td> <td> <div>If <code>yes</code> then the session shares a process for each session.</div> </td> </tr> <tr> <td colspan="1">  <b>user_drive_maximum_size</b>  <div> <span>raw</span> </div> </td> <td> </td> <td> <div>The maximum size of the user drive in bytes.</div> <div>Must fit into an Int64.</div> </td> </tr> <tr> <td colspan="1">  <b>variable_definitions</b>  <div> <span>list</span> / <span>elements=dictionary</span> </div> </td> <td> </td> <td> <div>A list of dicts where each elements defines a variable for each session.</div> </td> </tr> <tr> <td colspan="1">  <b>visible_aliases</b>  <div> <span>list</span> / <span>elements=string</span> </div> </td> <td> </td> <td> <div>The aliases that can be used in the session.</div> <div>For more information see <a href="https://docs.microsoft.com/en-us/powershell/scripting/learn/remoting/jea/role-capabilities">https://docs.microsoft.com/en-us/powershell/scripting/learn/remoting/jea/role-capabilities</a>.</div> </td> </tr> <tr> <td colspan="1">  <b>visible_cmdlets</b>  <div> <span>list</span> / <span>elements=raw</span> </div> </td> <td> </td> <td> <div>The cmdlets that can be used in the session.</div> <div>The elements can be simple names or complex command specifications.</div> <div>For more information see <a href="https://docs.microsoft.com/en-us/powershell/scripting/learn/remoting/jea/role-capabilities">https://docs.microsoft.com/en-us/powershell/scripting/learn/remoting/jea/role-capabilities</a>.</div> </td> </tr> <tr> <td colspan="1">  <b>visible_external_commands</b>  <div> <span>list</span> / <span>elements=string</span> </div> </td> <td> </td> <td> <div>The external commands and scripts that can be used in the session.</div> <div>For more information see <a href="https://docs.microsoft.com/en-us/powershell/scripting/learn/remoting/jea/role-capabilities">https://docs.microsoft.com/en-us/powershell/scripting/learn/remoting/jea/role-capabilities</a>.</div> </td> </tr> <tr> <td colspan="1">  <b>visible_functions</b>  <div> <span>list</span> / <span>elements=raw</span> </div> </td> <td> </td> <td> <div>The functions that can be used in the session.</div> <div>The elements can be simple names or complex command specifications.</div> <div>For more information see <a href="https://docs.microsoft.com/en-us/powershell/scripting/learn/remoting/jea/role-capabilities">https://docs.microsoft.com/en-us/powershell/scripting/learn/remoting/jea/role-capabilities</a>.</div> </td> </tr> </table> <br>  <h2 id="notes">Notes</h2> <div class="admonition note"> <p class="admonition-title">Note</p> <ul class="simple"> <li>This module will restart the WinRM service on any change. This will terminate all WinRM connections including those by other Ansible runs.</li> <li>Internally this module uses <code>async</code> when not in check mode to ensure things go smoothly when restarting the WinRM service.</li> <li>The standard <code>async</code> and <code>poll</code> keywords cannot be used; instead use the <em>async_timeout</em> and <em>async_poll</em> options to control asynchronous execution.</li> <li>Options that don’t list a default value here will use the defaults of <code>New-PSSessionConfigurationFile</code> and <code>Register-PSSessionConfiguration</code>.</li> <li>If a value can be specified in both a session config file and directly in the session options, this module will prefer the setting be in the config file.</li> </ul> </div>   <h2 id="see-also">See Also</h2> <div class="admonition seealso"> <p class="admonition-title">See also</p> <dl class="simple"> <dt><a class="reference external" href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/new-pssessionconfigurationfile">C(New-PSSessionConfigurationFile) Reference</a></dt>
<dd>
<p>Details and defaults for options that end up in the session configuration file.</p> </dd> <dt><a class="reference external" href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/register-pssessionconfiguration">C(Register-PSSessionConfiguration) Reference</a></dt>
<dd>
<p>Details and defaults for options that are not specified in the session config file.</p> </dd> <dt><a class="reference external" href="https://docs.microsoft.com/en-us/powershell/scripting/learn/remoting/jea/overview">PowerShell Just Enough Administration (JEA)</a></dt>
<dd>
<p>Refer to the JEA documentation for advanced usage of some options</p> </dd> <dt><a class="reference external" href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_session_configurations">About Session Configurations</a></dt>
<dd>
<p>General information about session configurations.</p> </dd> <dt><a class="reference external" href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_session_configuration_files">About Session Configuration Files</a></dt>
<dd>
<p>General information about session configuration files.</p> </dd> </dl> </div>   <h2 id="examples">Examples</h2> <pre data-language="yaml+jinja">- name: Register a session configuration that loads modules automatically
  community.windows.win_pssession_configuration:
    name: WebAdmin
    modules_to_import:
      - WebAdministration
      - IISAdministration
    description: This endpoint has IIS modules pre-loaded

- name: Set up an admin endpoint with a restricted execution policy
  community.windows.win_pssession_configuration:
    name: GloboCorp.Admin
    company_name: Globo Corp
    description: Admin Endpoint
    execution_policy: restricted

- name: Create a complex JEA endpoint
  community.windows.win_pssession_configuration:
    name: RBAC.Endpoint
    session_type: restricted_remote_server
    run_as_virtual_account: True
    transcript_directory: '\\server\share\Transcripts'
    language_mode: no_language
    execution_policy: restricted
    role_definitions:
      'CORP\IT Support':
        RoleCapabilities:
          - PasswordResetter
          - EmployeeOffboarder
      'CORP\Webhosts':
        RoleCapabilities: IISAdmin
    visible_functions:
      - tabexpansion2
      - help
    visible_cmdlets:
      - Get-Help
      - Name: Get-Service
        Parameters:
          - Name: DependentServices
          - Name: RequiredServices
          - Name: Name
            ValidateSet:
              - WinRM
              - W3SVC
              - WAS
    visible_aliases:
      - gsv
    state: present

- name: Remove a session configuration
  community.windows.win_pssession_configuration:
    name: UnusedEndpoint
    state: absent

- name: Set a sessions configuration with tweaked async values
  community.windows.win_pssession_configuration:
    name: MySession
    description: A sample session
    async_timeout: 500
    async_poll: 5
</pre>  <h3 id="authors">Authors</h3> <ul class="simple"> <li>Brian Scholer (@briantist)</li> </ul><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2012&ndash;2018 Michael DeHaan<br>&copy; 2018&ndash;2021 Red Hat, Inc.<br>Licensed under the GNU General Public License version 3.<br>
    <a href="https://docs.ansible.com/ansible/latest/collections/community/windows/win_pssession_configuration_module.html" class="_attribution-link">https://docs.ansible.com/ansible/latest/collections/community/windows/win_pssession_configuration_module.html</a>
  </p>
</div>
