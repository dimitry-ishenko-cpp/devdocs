<h1 id="community-grafana-grafana-datasource-manage-grafana-datasources">community.grafana.grafana_datasource – Manage Grafana datasources</h1> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This plugin is part of the <a class="reference external" href="https://galaxy.ansible.com/community/grafana">community.grafana collection</a> (version 1.2.3).</p> <p>You might already have this collection installed if you are using the <code>ansible</code> package. It is not included in <code>ansible-core</code>. To check whether it is installed, run <code>ansible-galaxy collection list</code>.</p> <p>To install it, use: <code>ansible-galaxy collection install community.grafana</code>.</p> <p>To use it in a playbook, specify: <code>community.grafana.grafana_datasource</code>.</p> </div>  <ul class="simple"> <li><a class="reference internal" href="#synopsis" id="id1">Synopsis</a></li> <li><a class="reference internal" href="#parameters" id="id2">Parameters</a></li> <li><a class="reference internal" href="#notes" id="id3">Notes</a></li> <li><a class="reference internal" href="#examples" id="id4">Examples</a></li> <li><a class="reference internal" href="#return-values" id="id5">Return Values</a></li> </ul>   <h2 id="synopsis">Synopsis</h2> <ul class="simple"> <li>Create/update/delete Grafana datasources via API.</li> </ul>   <h2 id="parameters">Parameters</h2> <table class="documentation-table"> <tr> <th colspan="1">Parameter</th> <th>Choices/Defaults</th> <th width="100%">Comments</th> </tr> <tr> <td colspan="1">  <b>access</b>  <div> <span>string</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>direct</li> <li><div>
<b>proxy</b> ←</div></li> </ul> </td> <td> <div>The access mode for this datasource.</div> </td> </tr> <tr> <td colspan="1">  <b>additional_json_data</b>  <div> <span>dictionary</span> </div> </td> <td> <b>Default:</b><br><div>{}</div> </td> <td> <div>Defined data is used for datasource jsonData</div> <div>Data may be overridden by specifically defined parameters (like zabbix_user)</div> </td> </tr> <tr> <td colspan="1">  <b>additional_secure_json_data</b>  <div> <span>dictionary</span> </div> </td> <td> <b>Default:</b><br><div>{}</div> </td> <td> <div>Defined data is used for datasource secureJsonData</div> <div>Data may be overridden by specifically defined parameters (like tls_client_cert)</div> <div>Stored as secure data, see <code>enforce_secure_data</code> and notes!</div> </td> </tr> <tr> <td colspan="1">  <b>aws_access_key</b>  <div> <span>string</span> </div> </td> <td> <b>Default:</b><br><div>""</div> </td> <td> <div>AWS access key for CloudWatch datasource type when <code>aws_auth_type</code> is <code>keys</code>
</div> </td> </tr> <tr> <td colspan="1">  <b>aws_assume_role_arn</b>  <div> <span>string</span> </div> </td> <td> <b>Default:</b><br><div>""</div> </td> <td> <div>AWS IAM role arn to assume for CloudWatch datasource type when <code>aws_auth_type</code> is <code>arn</code>
</div> </td> </tr> <tr> <td colspan="1">  <b>aws_auth_type</b>  <div> <span>string</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>keys</b> ←</div></li> <li>credentials</li> <li>arn</li> </ul> </td> <td> <div>Type for AWS authentication for CloudWatch datasource type (authType of grafana api)</div> </td> </tr> <tr> <td colspan="1">  <b>aws_credentials_profile</b>  <div> <span>string</span> </div> </td> <td> <b>Default:</b><br><div>""</div> </td> <td> <div>Profile for AWS credentials for CloudWatch datasource type when <code>aws_auth_type</code> is <code>credentials</code>
</div> </td> </tr> <tr> <td colspan="1">  <b>aws_custom_metrics_namespaces</b>  <div> <span>string</span> </div> </td> <td> <b>Default:</b><br><div>""</div> </td> <td> <div>Namespaces of Custom Metrics for CloudWatch datasource type</div> </td> </tr> <tr> <td colspan="1">  <b>aws_default_region</b>  <div> <span>string</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>ap-northeast-1</li> <li>ap-northeast-2</li> <li>ap-southeast-1</li> <li>ap-southeast-2</li> <li>ap-south-1</li> <li>ca-central-1</li> <li>cn-north-1</li> <li>cn-northwest-1</li> <li>eu-central-1</li> <li>eu-west-1</li> <li>eu-west-2</li> <li>eu-west-3</li> <li>sa-east-1</li> <li><div>
<b>us-east-1</b> ←</div></li> <li>us-east-2</li> <li>us-gov-west-1</li> <li>us-west-1</li> <li>us-west-2</li> </ul> </td> <td> <div>AWS default region for CloudWatch datasource type</div> </td> </tr> <tr> <td colspan="1">  <b>aws_secret_key</b>  <div> <span>string</span> </div> </td> <td> <b>Default:</b><br><div>""</div> </td> <td> <div>AWS secret key for CloudWatch datasource type when <code>aws_auth_type</code> is <code>keys</code>
</div> </td> </tr> <tr> <td colspan="1">  <b>basic_auth_password</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The datasource basic auth password, when <code>basic auth</code> is <code>yes</code>.</div> </td> </tr> <tr> <td colspan="1">  <b>basic_auth_user</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The datasource basic auth user.</div> <div>Setting this option with basic_auth_password will enable basic auth.</div> </td> </tr> <tr> <td colspan="1">  <b>client_cert</b>  <div> <span>path</span> </div> </td> <td> </td> <td> <div>PEM formatted certificate chain file to be used for SSL client authentication.</div> <div>This file can also include the key as well, and if the key is included, <em>client_key</em> is not required</div> </td> </tr> <tr> <td colspan="1">  <b>client_key</b>  <div> <span>path</span> </div> </td> <td> </td> <td> <div>PEM formatted file that contains your private key to be used for SSL client authentication.</div> <div>If <em>client_cert</em> contains both the certificate and key, this option is not required.</div> </td> </tr> <tr> <td colspan="1">  <b>database</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Name of the database for the datasource.</div> <div>This options is required when the <code>ds_type</code> is <code>influxdb</code>, <code>elasticsearch</code> (index name), <code>mysql</code> or <code>postgres</code>.</div> </td> </tr> <tr> <td colspan="1">  <b>ds_type</b>  <div> <span>string</span> / <span>required</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>graphite</li> <li>prometheus</li> <li>elasticsearch</li> <li>influxdb</li> <li>opentsdb</li> <li>mysql</li> <li>postgres</li> <li>cloudwatch</li> <li>alexanderzobnin-zabbix-datasource</li> <li>sni-thruk-datasource</li> <li>camptocamp-prometheus-alertmanager-datasource</li> <li>loki</li> <li>redis-datasource</li> </ul> </td> <td> <div>The type of the datasource.</div> </td> </tr> <tr> <td colspan="1">  <b>ds_url</b>  <div> <span>string</span> / <span>required</span> </div> </td> <td> </td> <td> <div>The URL of the datasource.</div> </td> </tr> <tr> <td colspan="1">  <b>enforce_secure_data</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Secure data is not updated per default (see notes!)</div> <div>To update secure data you have to enable this option!</div> <div>Enabling this, the task will always report changed=True</div> </td> </tr> <tr> <td colspan="1">  <b>es_version</b>  <div> <span>integer</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>2</li> <li>5</li> <li>56</li> <li>60</li> <li>70</li> </ul> <b>Default:</b><br><div>5</div> </td> <td> <div>Elasticsearch version (for <code>ds_type = elasticsearch</code> only)</div> <div>Version 56 is for elasticsearch 5.6+ where you can specify the <code>max_concurrent_shard_requests</code> option.</div> </td> </tr> <tr> <td colspan="1">  <b>grafana_api_key</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The Grafana API key.</div> <div>If set, <code>url_username</code> and <code>url_password</code> will be ignored.</div> </td> </tr> <tr> <td colspan="1">  <b>interval</b>  <div> <span>string</span> </div> </td> <td> <ul>
<b>Choices:</b> <li> <li>Hourly</li> <li>Daily</li> <li>Weekly</li> <li>Monthly</li> <li>Yearly</li> </ul> </td> <td> <div>For elasticsearch <code>ds_type</code>, this is the index pattern used.</div> </td> </tr> <tr> <td colspan="1">  <b>is_default</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Make this datasource the default one.</div> </td> </tr> <tr> <td colspan="1">  <b>max_concurrent_shard_requests</b>  <div> <span>integer</span> </div> </td> <td> <b>Default:</b><br><div>256</div> </td> <td> <div>Starting with elasticsearch 5.6, you can specify the max concurrent shard per requests.</div> </td> </tr> <tr> <td colspan="1">  <b>name</b>  <div> <span>string</span> / <span>required</span> </div> </td> <td> </td> <td> <div>The name of the datasource.</div> </td> </tr> <tr> <td colspan="1">  <b>org_id</b>  <div> <span>integer</span> </div> </td> <td> <b>Default:</b><br><div>1</div> </td> <td> <div>Grafana Organisation ID in which the datasource should be created.</div> <div>Not used when <code>grafana_api_key</code> is set, because the <code>grafana_api_key</code> only belong to one organisation.</div> </td> </tr> <tr> <td colspan="1">  <b>password</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The datasource password.</div> <div>For encrypted password use <code>additional_secure_json_data.password</code>.</div> </td> </tr> <tr> <td colspan="1">  <b>sslmode</b>  <div> <span>string</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>disable</b> ←</div></li> <li>require</li> <li>verify-ca</li> <li>verify-full</li> </ul> </td> <td> <div>SSL mode for <code>postgres</code> datasource type.</div> </td> </tr> <tr> <td colspan="1">  <b>state</b>  <div> <span>string</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>absent</li> <li><div>
<b>present</b> ←</div></li> </ul> </td> <td> <div>Status of the datasource</div> </td> </tr> <tr> <td colspan="1">  <b>time_field</b>  <div> <span>string</span> </div> </td> <td> <b>Default:</b><br><div>"@timestamp"</div> </td> <td> <div>Name of the time field in elasticsearch ds.</div> <div>For example <code>@timestamp</code>.</div> </td> </tr> <tr> <td colspan="1">  <b>time_interval</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Minimum group by interval for <code>influxdb</code> or <code>elasticsearch</code> datasources.</div> <div>for example <code>&gt;10s</code>.</div> </td> </tr> <tr> <td colspan="1">  <b>tls_ca_cert</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The TLS CA certificate for self signed certificates.</div> <div>Only used when <code>tls_client_cert</code> and <code>tls_client_key</code> are set.</div> <div>Stored as secure data, see <code>enforce_secure_data</code> and notes!</div> </td> </tr> <tr> <td colspan="1">  <b>tls_client_cert</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The client TLS certificate.</div> <div>If <code>tls_client_cert</code> and <code>tls_client_key</code> are set, this will enable TLS authentication.</div> <div>Starts with ----- BEGIN CERTIFICATE -----</div> <div>Stored as secure data, see <code>enforce_secure_data</code> and notes!</div> </td> </tr> <tr> <td colspan="1">  <b>tls_client_key</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The client TLS private key</div> <div>Starts with ----- BEGIN RSA PRIVATE KEY -----</div> <div>Stored as secure data, see <code>enforce_secure_data</code> and notes!</div> </td> </tr> <tr> <td colspan="1">  <b>tls_skip_verify</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Skip the TLS datasource certificate verification.</div> </td> </tr> <tr> <td colspan="1">  <b>trends</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Use trends or not for zabbix datasource type.</div> </td> </tr> <tr> <td colspan="1">  <b>tsdb_resolution</b>  <div> <span>string</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>millisecond</li> <li><div>
<b>second</b> ←</div></li> </ul> </td> <td> <div>The opentsdb time resolution.</div> </td> </tr> <tr> <td colspan="1">  <b>tsdb_version</b>  <div> <span>integer</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>1</li> <li>2</li> <li>3</li> </ul> <b>Default:</b><br><div>1</div> </td> <td> <div>The opentsdb version.</div> <div>Use <code>1</code> for &lt;=2.1, <code>2</code> for ==2.2, <code>3</code> for ==2.3.</div> </td> </tr> <tr> <td colspan="1">  <b>url</b>  <div> <span>string</span> / <span>required</span> </div> </td> <td> </td> <td> <div>The Grafana URL.</div> <div>
<br>aliases: grafana_url</div> </td> </tr> <tr> <td colspan="1">  <b>url_password</b>  <div> <span>string</span> </div> </td> <td> <b>Default:</b><br><div>"admin"</div> </td> <td> <div>The Grafana password for API authentication.</div> <div>
<br>aliases: grafana_password</div> </td> </tr> <tr> <td colspan="1">  <b>url_username</b>  <div> <span>string</span> </div> </td> <td> <b>Default:</b><br><div>"admin"</div> </td> <td> <div>The Grafana user for API authentication.</div> <div>
<br>aliases: grafana_user</div> </td> </tr> <tr> <td colspan="1">  <b>use_proxy</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>no</li> <li><div>
<b>yes</b> ←</div></li> </ul> </td> <td> <div>If <code>no</code>, it will not use a proxy, even if one is defined in an environment variable on the target hosts.</div> </td> </tr> <tr> <td colspan="1">  <b>user</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The datasource login user for influxdb datasources.</div> </td> </tr> <tr> <td colspan="1">  <b>validate_certs</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>no</li> <li><div>
<b>yes</b> ←</div></li> </ul> </td> <td> <div>If <code>no</code>, SSL certificates will not be validated.</div> <div>This should only set to <code>no</code> used on personally controlled sites using self-signed certificates.</div> </td> </tr> <tr> <td colspan="1">  <b>with_credentials</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Whether credentials such as cookies or auth headers should be sent with cross-site requests.</div> </td> </tr> <tr> <td colspan="1">  <b>zabbix_password</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Password for Zabbix API</div> </td> </tr> <tr> <td colspan="1">  <b>zabbix_user</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>User for Zabbix API</div> </td> </tr> </table> <br>  <h2 id="notes">Notes</h2> <div class="admonition note"> <p class="admonition-title">Note</p> <ul class="simple"> <li>Secure data will get encrypted by the Grafana API, thus it can not be compared on subsequent runs. To workaround this, secure data will not be updated after initial creation! To force the secure data update you have to set <em>enforce_secure_data=True</em>.</li> <li>Hint, with the <code>enforce_secure_data</code> always reporting changed=True, you might just do one Task updating the datasource without any secure data and make a separate playbook/task also changing the secure data. This way it will not break any workflow.</li> </ul> </div>   <h2 id="examples">Examples</h2> <pre data-language="yaml+jinja">---
- name: Create elasticsearch datasource
  community.grafana.grafana_datasource:
    name: "datasource-elastic"
    grafana_url: "https://grafana.company.com"
    grafana_user: "admin"
    grafana_password: "xxxxxx"
    org_id: "1"
    ds_type: "elasticsearch"
    ds_url: "https://elastic.company.com:9200"
    database: "[logstash_]YYYY.MM.DD"
    basic_auth_user: "grafana"
    basic_auth_password: "******"
    time_field: "@timestamp"
    time_interval: "1m"
    interval: "Daily"
    es_version: 56
    max_concurrent_shard_requests: 42
    tls_ca_cert: "/etc/ssl/certs/ca.pem"

- name: Create influxdb datasource
  community.grafana.grafana_datasource:
    name: "datasource-influxdb"
    grafana_url: "https://grafana.company.com"
    grafana_user: "admin"
    grafana_password: "xxxxxx"
    org_id: "1"
    ds_type: "influxdb"
    ds_url: "https://influx.company.com:8086"
    database: "telegraf"
    time_interval: "&gt;10s"
    tls_ca_cert: "/etc/ssl/certs/ca.pem"

- name: Create postgres datasource
  community.grafana.grafana_datasource:
    name: "datasource-postgres"
    grafana_url: "https://grafana.company.com"
    grafana_user: "admin"
    grafana_password: "xxxxxx"
    org_id: "1"
    ds_type: "postgres"
    ds_url: "postgres.company.com:5432"
    database: "db"
    user: "postgres"
    sslmode: "verify-full"
    additional_json_data:
      postgresVersion: 12
      timescaledb: false
    additional_secure_json_data:
      password: "iampgroot"

- name: Create cloudwatch datasource
  community.grafana.grafana_datasource:
    name: "datasource-cloudwatch"
    grafana_url: "https://grafana.company.com"
    grafana_user: "admin"
    grafana_password: "xxxxxx"
    org_id: "1"
    ds_type: "cloudwatch"
    ds_url: "http://monitoring.us-west-1.amazonaws.com"
    aws_auth_type: "keys"
    aws_default_region: "us-west-1"
    aws_access_key: "speakFriendAndEnter"
    aws_secret_key: "mel10n"
    aws_custom_metrics_namespaces: "n1,n2"

- name: grafana - add thruk datasource
  community.grafana.grafana_datasource:
    name: "datasource-thruk"
    grafana_url: "https://grafana.company.com"
    grafana_user: "admin"
    grafana_password: "xxxxxx"
    org_id: "1"
    ds_type: "sni-thruk-datasource"
    ds_url: "https://thruk.company.com/sitename/thruk"
    basic_auth_user: "thruk-user"
    basic_auth_password: "******"

# handle secure data - workflow example
# this will create/update the datasource but dont update the secure data on updates
# so you can assert if all tasks are changed=False
- name: create prometheus datasource
  community.grafana.grafana_datasource:
    name: openshift_prometheus
    ds_type: prometheus
    ds_url: https://openshift-monitoring.company.com
    access: proxy
    tls_skip_verify: true
    additional_json_data:
      httpHeaderName1: "Authorization"
    additional_secure_json_data:
      httpHeaderValue1: "Bearer ihavenogroot"

# in a separate task or even play you then can force to update
# and assert if each datasource is reporting changed=True
- name: update prometheus datasource
  community.grafana.grafana_datasource:
    name: openshift_prometheus
    ds_type: prometheus
    ds_url: https://openshift-monitoring.company.com
    access: proxy
    tls_skip_verify: true
    additional_json_data:
      httpHeaderName1: "Authorization"
    additional_secure_json_data:
      httpHeaderValue1: "Bearer ihavenogroot"
    enforce_secure_data: true
</pre>   <h2 id="return-values">Return Values</h2> <p>Common return values are documented <a class="reference internal" href="../../../reference_appendices/common_return_values.html#common-return-values"><span class="std std-ref">here</span></a>, the following are the fields unique to this module:</p> <table class="documentation-table"> <tr> <th colspan="1">Key</th> <th>Returned</th> <th width="100%">Description</th> </tr> <tr> <td colspan="1">  <b>datasource</b>  <div> <span>dictionary</span> </div> </td> <td>changed</td> <td> <div>datasource created/updated by module</div> <br> <div><b>Sample:</b></div> <div>{'access': 'proxy', 'basicAuth': False, 'database': 'test_*', 'id': 1035, 'isDefault': False, 'jsonData': {'esVersion': 5, 'timeField': '@timestamp', 'timeInterval': '10s'}, 'name': 'grafana_datasource_test', 'orgId': 1, 'password': '', 'secureJsonFields': {'JustASecureTest': True}, 'type': 'elasticsearch', 'url': 'http://elastic.company.com:9200', 'user': '', 'withCredentials': False}</div> </td> </tr> </table> <br><br> <h3 id="authors">Authors</h3> <ul class="simple"> <li>Thierry Sallé (@seuf)</li> <li>Martin Wang (@martinwangjian)</li> <li>Rémi REY (@rrey)</li> </ul><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2012&ndash;2018 Michael DeHaan<br>&copy; 2018&ndash;2021 Red Hat, Inc.<br>Licensed under the GNU General Public License version 3.<br>
    <a href="https://docs.ansible.com/ansible/latest/collections/community/grafana/grafana_datasource_module.html" class="_attribution-link">https://docs.ansible.com/ansible/latest/collections/community/grafana/grafana_datasource_module.html</a>
  </p>
</div>
