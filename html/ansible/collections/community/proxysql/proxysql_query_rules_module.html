<section id="community-proxysql-proxysql-query-rules-module-modifies-query-rules-using-the-proxysql-admin-interface"> <h1>community.proxysql.proxysql_query_rules module – Modifies query rules using the proxysql admin interface</h1> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This module is part of the <a class="reference external" href="https://galaxy.ansible.com/ui/repo/published/community/proxysql/">community.proxysql collection</a> (version 1.6.0).</p> <p>You might already have this collection installed if you are using the <code>ansible</code> package. It is not included in <code>ansible-core</code>. To check whether it is installed, run <code>ansible-galaxy collection list</code>.</p> <p>To install it, use: <code>ansible-galaxy collection install community.proxysql</code>. You need further requirements to be able to use this module, see <a class="reference internal" href="#ansible-collections-community-proxysql-proxysql-query-rules-module-requirements"><span class="std std-ref">Requirements</span></a> for details.</p> <p>To use it in a playbook, specify: <code>community.proxysql.proxysql_query_rules</code>.</p> </div>  <ul class="simple"> <li><a class="reference internal" href="#synopsis" id="id1">Synopsis</a></li> <li><a class="reference internal" href="#requirements" id="id2">Requirements</a></li> <li><a class="reference internal" href="#parameters" id="id3">Parameters</a></li> <li><a class="reference internal" href="#notes" id="id4">Notes</a></li> <li><a class="reference internal" href="#examples" id="id5">Examples</a></li> <li><a class="reference internal" href="#return-values" id="id6">Return Values</a></li> </ul>  <section id="synopsis"> <h2>Synopsis</h2> <ul class="simple"> <li>The <a class="reference internal" href="#ansible-collections-community-proxysql-proxysql-query-rules-module"><span class="std std-ref">community.proxysql.proxysql_query_rules</span></a> module modifies query rules using the proxysql admin interface.</li> </ul> </section> <section id="requirements"> <h2 id="ansible-collections-community-proxysql-proxysql-query-rules-module-requirements">Requirements</h2> <p>The below requirements are needed on the host that executes this module.</p> <ul class="simple"> <li>PyMySQL</li> <li>mysqlclient</li> </ul> </section> <section id="parameters"> <h2>Parameters</h2> <table class="longtable ansible-option-table docutils align-default" style="width: 100%"> <thead> <tr>
<th class="head"><p>Parameter</p></th> <th class="head"><p>Comments</p></th> </tr> </thead>  <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-proxysql-proxysql-query-rules-module-parameter-active"><strong>active</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">boolean</span></p> </div></td> <td><div class="ansible-option-cell">
<p>A rule with <em>active</em> set to <code>False</code> will be tracked in the database, but will be never loaded in the in-memory data structures.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li><code>false</code></li> <li><code>true</code></li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-proxysql-proxysql-query-rules-module-parameter-apply"><strong>apply</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">boolean</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Used in combination with <em>flagIN</em> and <em>flagOUT</em> to create chains of rules. Setting apply to True signifies the last rule to be applied.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li><code>false</code></li> <li><code>true</code></li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-proxysql-proxysql-query-rules-module-parameter-cache-empty-result"><strong>cache_empty_result</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">boolean</span></p> <p><em class="ansible-option-versionadded">added in community.proxysql 1.1.0</em></p> </div></td> <td><div class="ansible-option-cell">
<p>Controls if resultset without rows will be cached or not.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li><code>false</code></li> <li><code>true</code></li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-proxysql-proxysql-query-rules-module-parameter-cache-ttl"><strong>cache_ttl</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">integer</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The number of milliseconds for which to cache the result of the query. Note in ProxySQL 1.1 <em>cache_ttl</em> was in seconds.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-proxysql-proxysql-query-rules-module-parameter-client-addr"><strong>client_addr</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Match traffic from a specific source.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-proxysql-proxysql-query-rules-module-parameter-comment"><strong>comment</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Free form text field, usable for a descriptive comment of the query rule.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-proxysql-proxysql-query-rules-module-parameter-config-file"><strong>config_file</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">path</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Specify a config file from which <em>login_user</em> and <em>login_password</em> are to be read.</p> <p class="ansible-option-line"><strong class="ansible-option-default-bold">Default:</strong> <code>""</code></p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-proxysql-proxysql-query-rules-module-parameter-delay"><strong>delay</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">integer</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Number of milliseconds to delay the execution of the query. This is essentially a throttling mechanism and QoS, and allows a way to give priority to queries over others. This value is added to the mysql-default_query_delay global variable that applies to all queries.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-proxysql-proxysql-query-rules-module-parameter-destination-hostgroup"><strong>destination_hostgroup</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">integer</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Route matched queries to this hostgroup. This happens unless there is a started transaction and the logged in user has <em>transaction_persistent</em> set to <code>True</code> (see <a class="reference internal" href="proxysql_mysql_users_module.html#ansible-collections-community-proxysql-proxysql-mysql-users-module"><span class="std std-ref">community.proxysql.proxysql_mysql_users</span></a>).</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-proxysql-proxysql-query-rules-module-parameter-digest"><strong>digest</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Match queries with a specific digest, as returned by stats_mysql_query_digest.digest.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-proxysql-proxysql-query-rules-module-parameter-error-msg"><strong>error_msg</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Query will be blocked, and the specified error_msg will be returned to the client.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-proxysql-proxysql-query-rules-module-parameter-flagin"><strong>flagIN</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">integer</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Used in combination with <em>flagOUT</em> and <em>apply</em> to create chains of rules.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-proxysql-proxysql-query-rules-module-parameter-flagout"><strong>flagOUT</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">integer</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Used in combination with <em>flagIN</em> and apply to create chains of rules. When set, <em>flagOUT</em> signifies the <em>flagIN</em> to be used in the next chain of rules.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-proxysql-proxysql-query-rules-module-parameter-force-delete"><strong>force_delete</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">boolean</span></p> </div></td> <td><div class="ansible-option-cell">
<p>By default we avoid deleting more than one schedule in a single batch, however if you need this behaviour and you are not concerned about the schedules deleted, you can set <em>force_delete</em> to <code>True</code>.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li>
<code><strong>false</strong></code> <span class="ansible-option-choices-default-mark">← (default)</span>
</li> <li><code>true</code></li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-proxysql-proxysql-query-rules-module-parameter-load-to-runtime"><strong>load_to_runtime</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">boolean</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Dynamically load config to runtime memory.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li><code>false</code></li> <li>
<code><strong>true</strong></code> <span class="ansible-option-choices-default-mark">← (default)</span>
</li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-proxysql-proxysql-query-rules-module-parameter-log"><strong>log</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">boolean</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Query will be logged.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li><code>false</code></li> <li><code>true</code></li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-proxysql-proxysql-query-rules-module-parameter-login-host"><strong>login_host</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The host used to connect to ProxySQL admin interface.</p> <p class="ansible-option-line"><strong class="ansible-option-default-bold">Default:</strong> <code>"127.0.0.1"</code></p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-proxysql-proxysql-query-rules-module-parameter-login-password"><strong>login_password</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The password used to authenticate to ProxySQL admin interface.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-proxysql-proxysql-query-rules-module-parameter-login-port"><strong>login_port</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">integer</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The port used to connect to ProxySQL admin interface.</p> <p class="ansible-option-line"><strong class="ansible-option-default-bold">Default:</strong> <code>6032</code></p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-proxysql-proxysql-query-rules-module-parameter-login-unix-socket"><strong>login_unix_socket</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The socket used to connect to ProxySQL admin interface.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-proxysql-proxysql-query-rules-module-parameter-login-user"><strong>login_user</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The username used to authenticate to ProxySQL admin interface.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-proxysql-proxysql-query-rules-module-parameter-match-digest"><strong>match_digest</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Regular expression that matches the query digest. The dialect of regular expressions used is that of re2 - <a class="reference external" href="https://github.com/google/re2">https://github.com/google/re2</a>.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-proxysql-proxysql-query-rules-module-parameter-match-pattern"><strong>match_pattern</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Regular expression that matches the query text. The dialect of regular expressions used is that of re2 - <a class="reference external" href="https://github.com/google/re2">https://github.com/google/re2</a>.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-proxysql-proxysql-query-rules-module-parameter-mirror-flagout"><strong>mirror_flagOUT</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">integer</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Enables query mirroring. If set <em>mirror_flagOUT</em> can be used to evaluates the mirrored query against the specified chain of rules.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-proxysql-proxysql-query-rules-module-parameter-mirror-hostgroup"><strong>mirror_hostgroup</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">integer</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Enables query mirroring. If set <em>mirror_hostgroup</em> can be used to mirror queries to the same or different hostgroup.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-proxysql-proxysql-query-rules-module-parameter-multiplex"><strong>multiplex</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">integer</span></p> <p><em class="ansible-option-versionadded">added in community.proxysql 1.1.0</em></p> </div></td> <td><div class="ansible-option-cell">
<p>If <code>0</code>, multiplex will be disabled.</p> <p>If <code>1</code>, try to enable multiplex. There can be other conditions preventing this (for example, user variables or transactions).</p> <p>If <code>2</code>, multiplexing is not disabled for just the current query.</p> <p>By default, does not change multiplexing policies.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li><code>0</code></li> <li><code>1</code></li> <li><code>2</code></li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-proxysql-proxysql-query-rules-module-parameter-negate-match-pattern"><strong>negate_match_pattern</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">boolean</span></p> </div></td> <td><div class="ansible-option-cell">
<p>If <em>negate_match_pattern</em> is set to <code>True</code>, only queries not matching the query text will be considered as a match. This acts as a NOT operator in front of the regular expression matching against match_pattern.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li><code>false</code></li> <li><code>true</code></li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-proxysql-proxysql-query-rules-module-parameter-next-query-flagin"><strong>next_query_flagIN</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">integer</span></p> <p><em class="ansible-option-versionadded">added in community.proxysql 1.3.0</em></p> </div></td> <td><div class="ansible-option-cell">
<p>When is set, its value will become the <em>flagIN</em> value for the next queries.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-proxysql-proxysql-query-rules-module-parameter-ok-msg"><strong>OK_msg</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> <p><em class="ansible-option-versionadded">added in community.proxysql 1.1.0</em></p> </div></td> <td><div class="ansible-option-cell">
<p>The specified message will be returned for a query that uses the defined rule.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-proxysql-proxysql-query-rules-module-parameter-proxy-addr"><strong>proxy_addr</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Match incoming traffic on a specific local IP.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-proxysql-proxysql-query-rules-module-parameter-proxy-port"><strong>proxy_port</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">integer</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Match incoming traffic on a specific local port.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-proxysql-proxysql-query-rules-module-parameter-re-modifiers"><strong>re_modifiers</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> <p><em class="ansible-option-versionadded">added in community.proxysql 1.3.0</em></p> </div></td> <td><div class="ansible-option-cell">
<p>Comma separated list of options to modify the behavior of the RE engine. With <code>CASELESS</code> the match is case insensitive. With <code>GLOBAL</code> the replace is global (replaces all matches and not just the first). For backward compatibility, only <code>CASELESS</code> is the enabled by default.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-proxysql-proxysql-query-rules-module-parameter-replace-pattern"><strong>replace_pattern</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>This is the pattern with which to replace the matched pattern. Note that this is optional, and when omitted, the query processor will only cache, route, or set other parameters without rewriting.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-proxysql-proxysql-query-rules-module-parameter-retries"><strong>retries</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">integer</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The maximum number of times a query needs to be re-executed in case of detected failure during the execution of the query. If retries is not specified, the global variable mysql-query_retries_on_failure applies.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-proxysql-proxysql-query-rules-module-parameter-rule-id"><strong>rule_id</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">integer</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The unique id of the rule. Rules are processed in rule_id order.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-proxysql-proxysql-query-rules-module-parameter-save-to-disk"><strong>save_to_disk</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">boolean</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Save config to sqlite db on disk to persist the configuration.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li><code>false</code></li> <li>
<code><strong>true</strong></code> <span class="ansible-option-choices-default-mark">← (default)</span>
</li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-proxysql-proxysql-query-rules-module-parameter-schemaname"><strong>schemaname</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Filtering criteria matching schemaname. If <em>schemaname</em> is non-NULL, a query will match only if the connection uses schemaname as its default schema.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-proxysql-proxysql-query-rules-module-parameter-state"><strong>state</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>When <code>present</code> - adds the rule, when <code>absent</code> - removes the rule.</p> <p class="ansible-option-line"><strong class="ansible-option-choices">Choices:</strong></p> <ul class="simple"> <li>
<code><strong>"present"</strong></code> <span class="ansible-option-choices-default-mark">← (default)</span>
</li> <li><code>"absent"</code></li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-proxysql-proxysql-query-rules-module-parameter-timeout"><strong>timeout</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">integer</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The maximum timeout in milliseconds with which the matched or rewritten query should be executed. If a query run for longer than the specific threshold, the query is automatically killed. If timeout is not specified, the global variable mysql-default_query_timeout applies.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-proxysql-proxysql-query-rules-module-parameter-username"><strong>username</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Filtering criteria matching username. If <em>username</em> is non-NULL, a query will match only if the connection is made with the correct username.</p> </div></td> </tr>  </table> </section> <section id="notes"> <h2>Notes</h2> <div class="admonition note"> <p class="admonition-title">Note</p> <ul class="simple"> <li>Supports <code>check_mode</code>.</li> </ul> </div> </section> <section id="examples"> <h2>Examples</h2> <pre data-language="yaml+jinja">---
# This example adds a rule to redirect queries from a specific user to another
# hostgroup, it saves the mysql query rule config to disk, but avoids loading
# the mysql query config config to runtime (this might be because several
# rules are being added and the user wants to push the config to runtime in a
# single batch using the community.general.proxysql_manage_config module). It
# uses supplied credentials to connect to the proxysql admin interface.

- name: Add a rule
  community.proxysql.proxysql_query_rules:
    login_user: admin
    login_password: admin
    username: 'guest_ro'
    match_pattern: "^SELECT.*"
    destination_hostgroup: 1
    active: 1
    retries: 3
    state: present
    load_to_runtime: false

# This example demonstrates the situation, if your application tries to set a
# variable that will disable multiplexing, and you think it can be filtered out,
# you can create a filter that returns OK without executing the request.

- name: Add a filter rule
  community.proxysql.proxysql_query_rules:
    login_user: admin
    login_password: admin
    match_digest: '^SET @@wait_timeout = ?'
    active: 1
    OK_msg: 'The wait_timeout variable is ignored'

# This example adds a caching rule for a query that matches the digest.
# The query digest can be obtained from the `stats_mysql_query_digest`
# table. `cache_ttl` is specified in milliseconds. Empty responses are
# not cached.

- name: Add a cache rule
  community.proxysql.proxysql_query_rules:
    login_user: admin
    login_password: admin
    rule_id: 1
    digest: 0xECA450EA500A9A55
    cache_ttl: 30000
    cache_empty_result: false
    destination_hostgroup: 1
    active: true
    state: present
    save_to_disk: true
    load_to_runtime: true

# This example demonstrates how to prevent disabling multiplexing for
# situations where a request contains @.

- name: Add a rule with multiplex
  community.proxysql.proxysql_query_rules:
    login_user: admin
    login_password: admin
    rule_id: 1
    active: 1
    match_digest: '^SELECT @@max_allowed_packet'
    multiplex: 2

# This example demonstrates how to use next_query_flagIN argument. It allows
# ProxySQL query rules to be chained. The examples shows how you can have SELECTS
# immediately follow INSERT/UPDATE/DELETE statements to query the primary hostgroup
# and avoid replication lag

- name: Add insert query rule
  proxysql_query_rules:
    match_digest: "^INSERT"
    destination_hostgroup: 1,
    next_query_flagIN: 1

- name: Add update query rule
  proxysql_query_rules:
    match_digest: "^UPDATE"
    destination_hostgroup: 1,
    next_query_flagIN: 1

- name: Add delete query rules
  proxysql_query_rules:
    match_digest: "^DELETE"
    destination_hostgroup: 1,
    next_query_flagIN: 1

- name: Add insert query rules
  proxysql_query_rules:
    match_digest: ".*"
    destination_hostgroup: 1,
    next_query_flagIN: 1
    comment: Match every queries after an INSERT/UPDATE/DELETE query

# This example removes all rules that use the username 'guest_ro', saves the
# mysql query rule config to disk, and dynamically loads the mysql query rule
# config to runtime.  It uses credentials in a supplied config file to connect
# to the proxysql admin interface.

- name: Remove rules
  community.proxysql.proxysql_query_rules:
    config_file: '~/proxysql.cnf'
    username: 'guest_ro'
    state: absent
    force_delete: true
</pre> </section> <section id="return-values"> <h2>Return Values</h2> <p>Common return values are documented <a class="reference internal" href="../../../reference_appendices/common_return_values.html#common-return-values"><span class="std std-ref">here</span></a>, the following are the fields unique to this module:</p> <table class="longtable ansible-option-table docutils align-default" style="width: 100%"> <thead> <tr>
<th class="head"><p>Key</p></th> <th class="head"><p>Description</p></th> </tr> </thead>  <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-proxysql-proxysql-query-rules-module-return-stdout"><strong>stdout</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">dictionary</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The mysql user modified or removed from proxysql.</p> <p class="ansible-option-line"><strong class="ansible-option-returned-bold">Returned:</strong> On create/update will return the newly modified rule, in all other cases will return a list of rules that match the supplied criteria.</p> <p class="ansible-option-line ansible-option-sample"><strong class="ansible-option-sample-bold">Sample:</strong> <code>{"changed": true, "msg": "Added rule to mysql_query_rules", "rules": [{"OK_msg": null, "active": "0", "apply": "0", "cache_empty_result": null, "cache_ttl": null, "client_addr": null, "comment": null, "delay": null, "destination_hostgroup": 1, "digest": null, "error_msg": null, "flagIN": "0", "flagOUT": null, "log": null, "match_digest": null, "match_pattern": null, "mirror_flagOUT": null, "mirror_hostgroup": null, "multiplex": null, "negate_match_pattern": "0", "proxy_addr": null, "proxy_port": null, "reconnect": null, "replace_pattern": null, "retries": null, "rule_id": "1", "schemaname": null, "timeout": null, "username": "guest_ro"}], "state": "present"}</code></p> </div></td> </tr>  </table> <section id="authors"> <h3>Authors</h3> <ul class="simple"> <li>Ben Mildren (@bmildren)</li> </ul> </section> <section id="collection-links"> <h3>Collection links</h3> <ul class="ansible-links"> <li><span><a aria-role="button" class="ansible-link reference external" href="https://github.com/ansible-collections/community.proxysql/issues" rel="noopener external" target="_blank">Issue Tracker</a></span></li> <li><span><a aria-role="button" class="ansible-link reference external" href="https://github.com/ansible-collections/community.proxysql" rel="noopener external" target="_blank">Repository (Sources)</a></span></li> </ul> </section> </section> </section><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2012&ndash;2018 Michael DeHaan<br>&copy; 2018&ndash;2024 Red Hat, Inc.<br>Licensed under the GNU General Public License version 3.<br>
    <a href="https://docs.ansible.com/ansible/latest/collections/community/proxysql/proxysql_query_rules_module.html" class="_attribution-link">https://docs.ansible.com/ansible/latest/collections/community/proxysql/proxysql_query_rules_module.html</a>
  </p>
</div>
