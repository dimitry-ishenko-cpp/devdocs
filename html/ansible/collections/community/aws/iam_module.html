<h1 id="community-aws-iam-manage-iam-users-groups-roles-and-keys">community.aws.iam – Manage IAM users, groups, roles and keys</h1> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This plugin is part of the <a class="reference external" href="https://galaxy.ansible.com/community/aws">community.aws collection</a> (version 1.5.0).</p> <p>You might already have this collection installed if you are using the <code>ansible</code> package. It is not included in <code>ansible-core</code>. To check whether it is installed, run <code>ansible-galaxy collection list</code>.</p> <p>To install it, use: <code>ansible-galaxy collection install community.aws</code>.</p> <p>To use it in a playbook, specify: <code>community.aws.iam</code>.</p> </div> <div class="versionadded"> <p><span class="versionmodified added">New in version 1.0.0: </span>of community.aws</p> </div>  <ul class="simple"> <li><a class="reference internal" href="#synopsis" id="id1">Synopsis</a></li> <li><a class="reference internal" href="#requirements" id="id2">Requirements</a></li> <li><a class="reference internal" href="#parameters" id="id3">Parameters</a></li> <li><a class="reference internal" href="#notes" id="id4">Notes</a></li> <li><a class="reference internal" href="#examples" id="id5">Examples</a></li> <li><a class="reference internal" href="#return-values" id="id6">Return Values</a></li> </ul>   <h2 id="synopsis">Synopsis</h2> <ul class="simple"> <li>Allows for the management of IAM users, user API keys, groups, roles.</li> </ul>   <h2 id="requirements">Requirements</h2> <p>The below requirements are needed on the host that executes this module.</p> <ul class="simple"> <li>python &gt;= 2.6</li> <li>boto</li> </ul>   <h2 id="parameters">Parameters</h2> <table class="documentation-table"> <tr> <th colspan="1">Parameter</th> <th>Choices/Defaults</th> <th width="100%">Comments</th> </tr> <tr> <td colspan="1">  <b>access_key_ids</b>  <div> <span>list</span> / <span>elements=string</span> </div> </td> <td> </td> <td> <div>A list of the keys that you want affected by the <em>access_key_state</em> parameter.</div> </td> </tr> <tr> <td colspan="1">  <b>access_key_state</b>  <div> <span>string</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>create</li> <li>remove</li> <li>active</li> <li>inactive</li> <li>Create</li> <li>Remove</li> <li>Active</li> <li>Inactive</li> </ul> </td> <td> <div>When type is user, it creates, removes, deactivates or activates a user's access key(s). Note that actions apply only to keys specified.</div> </td> </tr> <tr> <td colspan="1">  <b>aws_access_key</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>AWS access key. If not set then the value of the AWS_ACCESS_KEY_ID, AWS_ACCESS_KEY or EC2_ACCESS_KEY environment variable is used.</div> <div>If <em>profile</em> is set this parameter is ignored.</div> <div>Passing the <em>aws_access_key</em> and <em>profile</em> options at the same time has been deprecated and the options will be made mutually exclusive after 2022-06-01.</div> <div>
<br>aliases: ec2_access_key, access_key</div> </td> </tr> <tr> <td colspan="1">  <b>aws_ca_bundle</b>  <div> <span>path</span> </div> </td> <td> </td> <td> <div>The location of a CA Bundle to use when validating SSL certificates.</div> <div>Only used for boto3 based modules.</div> <div>Note: The CA Bundle is read 'module' side and may need to be explicitly copied from the controller if not run locally.</div> </td> </tr> <tr> <td colspan="1">  <b>aws_config</b>  <div> <span>dictionary</span> </div> </td> <td> </td> <td> <div>A dictionary to modify the botocore configuration.</div> <div>Parameters can be found at <a href="https://botocore.amazonaws.com/v1/documentation/api/latest/reference/config.html#botocore.config.Config">https://botocore.amazonaws.com/v1/documentation/api/latest/reference/config.html#botocore.config.Config</a>.</div> <div>Only the 'user_agent' key is used for boto modules. See <a href="http://boto.cloudhackers.com/en/latest/boto_config_tut.html#boto">http://boto.cloudhackers.com/en/latest/boto_config_tut.html#boto</a> for more boto configuration.</div> </td> </tr> <tr> <td colspan="1">  <b>aws_secret_key</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>AWS secret key. If not set then the value of the AWS_SECRET_ACCESS_KEY, AWS_SECRET_KEY, or EC2_SECRET_KEY environment variable is used.</div> <div>If <em>profile</em> is set this parameter is ignored.</div> <div>Passing the <em>aws_secret_key</em> and <em>profile</em> options at the same time has been deprecated and the options will be made mutually exclusive after 2022-06-01.</div> <div>
<br>aliases: ec2_secret_key, secret_key</div> </td> </tr> <tr> <td colspan="1">  <b>debug_botocore_endpoint_logs</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Use a botocore.endpoint logger to parse the unique (rather than total) "resource:action" API calls made during a task, outputing the set to the resource_actions key in the task results. Use the aws_resource_action callback to output to total list made during a playbook. The ANSIBLE_DEBUG_BOTOCORE_LOGS environment variable may also be used.</div> </td> </tr> <tr> <td colspan="1">  <b>ec2_url</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Url to use to connect to EC2 or your Eucalyptus cloud (by default the module will use EC2 endpoints). Ignored for modules where region is required. Must be specified for all other modules if region is not used. If not set then the value of the EC2_URL environment variable, if any, is used.</div> <div>
<br>aliases: aws_endpoint_url, endpoint_url</div> </td> </tr> <tr> <td colspan="1">  <b>groups</b>  <div> <span>list</span> / <span>elements=string</span> </div> </td> <td> </td> <td> <div>A list of groups the user should belong to. When <em>state=update</em>, will gracefully remove groups not listed.</div> </td> </tr> <tr> <td colspan="1">  <b>iam_type</b>  <div> <span>string</span> / <span>required</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>user</li> <li>group</li> <li>role</li> </ul> </td> <td> <div>Type of IAM resource.</div> </td> </tr> <tr> <td colspan="1">  <b>key_count</b>  <div> <span>integer</span> </div> </td> <td> <b>Default:</b><br><div>1</div> </td> <td> <div>When <em>access_key_state=create</em> it will ensure this quantity of keys are present.</div> </td> </tr> <tr> <td colspan="1">  <b>name</b>  <div> <span>string</span> / <span>required</span> </div> </td> <td> </td> <td> <div>Name of IAM resource to create or identify.</div> </td> </tr> <tr> <td colspan="1">  <b>new_name</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>When <em>state=update</em>, will replace <em>name</em> with <em>new_name</em> on IAM resource.</div> </td> </tr> <tr> <td colspan="1">  <b>new_path</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>When <em>state=update</em>, will replace the path with new_path on the IAM resource.</div> </td> </tr> <tr> <td colspan="1">  <b>password</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>When <em>type=user</em> and either <em>state=present</em> or <em>state=update</em>, define the users login password.</div> <div>Note that this will always return 'changed'.</div> </td> </tr> <tr> <td colspan="1">  <b>path</b>  <div> <span>string</span> </div> </td> <td> <b>Default:</b><br><div>"/"</div> </td> <td> <div>When creating or updating, specify the desired path of the resource.</div> <div>If <em>state=present</em>, it will replace the current path to match what is passed in when they do not match.</div> </td> </tr> <tr> <td colspan="1">  <b>profile</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Uses a boto profile. Only works with boto &gt;= 2.24.0.</div> <div>Using <em>profile</em> will override <em>aws_access_key</em>, <em>aws_secret_key</em> and <em>security_token</em> and support for passing them at the same time as <em>profile</em> has been deprecated.</div> <div>
<em>aws_access_key</em>, <em>aws_secret_key</em> and <em>security_token</em> will be made mutually exclusive with <em>profile</em> after 2022-06-01.</div> <div>
<br>aliases: aws_profile</div> </td> </tr> <tr> <td colspan="1">  <b>region</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The AWS region to use. If not specified then the value of the AWS_REGION or EC2_REGION environment variable, if any, is used. See <a href="http://docs.aws.amazon.com/general/latest/gr/rande.html#ec2_region">http://docs.aws.amazon.com/general/latest/gr/rande.html#ec2_region</a>
</div> <div>
<br>aliases: aws_region, ec2_region</div> </td> </tr> <tr> <td colspan="1">  <b>security_token</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>AWS STS security token. If not set then the value of the AWS_SECURITY_TOKEN or EC2_SECURITY_TOKEN environment variable is used.</div> <div>If <em>profile</em> is set this parameter is ignored.</div> <div>Passing the <em>security_token</em> and <em>profile</em> options at the same time has been deprecated and the options will be made mutually exclusive after 2022-06-01.</div> <div>
<br>aliases: aws_security_token, access_token</div> </td> </tr> <tr> <td colspan="1">  <b>state</b>  <div> <span>string</span> / <span>required</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>present</li> <li>absent</li> <li>update</li> </ul> </td> <td> <div>Whether to create, delete or update the IAM resource. Note, roles cannot be updated.</div> </td> </tr> <tr> <td colspan="1">  <b>trust_policy</b>  <div> <span>dictionary</span> </div> </td> <td> </td> <td> <div>The inline (JSON or YAML) trust policy document that grants an entity permission to assume the role.</div> <div>Mutually exclusive with <em>trust_policy_filepath</em>.</div> </td> </tr> <tr> <td colspan="1">  <b>trust_policy_filepath</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The path to the trust policy document that grants an entity permission to assume the role.</div> <div>Mutually exclusive with <em>trust_policy</em>.</div> </td> </tr> <tr> <td colspan="1">  <b>update_password</b>  <div> <span>string</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>always</b> ←</div></li> <li>on_create</li> </ul> </td> <td> <div>When to update user passwords.</div> <div>
<em>update_password=always</em> will ensure the password is set to <em>password</em>.</div> <div>
<em>update_password=on_create</em> will only set the password for newly created users.</div> </td> </tr> <tr> <td colspan="1">  <b>validate_certs</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>no</li> <li><div>
<b>yes</b> ←</div></li> </ul> </td> <td> <div>When set to "no", SSL certificates will not be validated for boto versions &gt;= 2.6.0.</div> </td> </tr> </table> <br>  <h2 id="notes">Notes</h2> <div class="admonition note"> <p class="admonition-title">Note</p> <ul class="simple"> <li>Currently boto does not support the removal of Managed Policies, the module will error out if your user/group/role has managed policies when you try to do state=absent. They will need to be removed manually.</li> <li>If parameters are not set within the module, the following environment variables can be used in decreasing order of precedence <code>AWS_URL</code> or <code>EC2_URL</code>, <code>AWS_PROFILE</code> or <code>AWS_DEFAULT_PROFILE</code>, <code>AWS_ACCESS_KEY_ID</code> or <code>AWS_ACCESS_KEY</code> or <code>EC2_ACCESS_KEY</code>, <code>AWS_SECRET_ACCESS_KEY</code> or <code>AWS_SECRET_KEY</code> or <code>EC2_SECRET_KEY</code>, <code>AWS_SECURITY_TOKEN</code> or <code>EC2_SECURITY_TOKEN</code>, <code>AWS_REGION</code> or <code>EC2_REGION</code>, <code>AWS_CA_BUNDLE</code>
</li> <li>Ansible uses the boto configuration file (typically ~/.boto) if no credentials are provided. See <a class="reference external" href="https://boto.readthedocs.io/en/latest/boto_config_tut.html">https://boto.readthedocs.io/en/latest/boto_config_tut.html</a>
</li> <li>
<code>AWS_REGION</code> or <code>EC2_REGION</code> can be typically be used to specify the AWS region, when required, but this can also be configured in the boto config file</li> </ul> </div>   <h2 id="examples">Examples</h2> <pre data-language="yaml+jinja"># Basic user creation example
- name: Create two new IAM users with API keys
  community.aws.iam:
    iam_type: user
    name: "{{ item }}"
    state: present
    password: "{{ temp_pass }}"
    access_key_state: create
  loop:
    - jcleese
    - mpython

# Advanced example, create two new groups and add the pre-existing user
# jdavila to both groups.
- name: Create Two Groups, Mario and Luigi
  community.aws.iam:
    iam_type: group
    name: "{{ item }}"
    state: present
  loop:
     - Mario
     - Luigi
  register: new_groups

- name: Update user
  community.aws.iam:
    iam_type: user
    name: jdavila
    state: update
    groups: "{{ item.created_group.group_name }}"
  loop: "{{ new_groups.results }}"

# Example of role with custom trust policy for Lambda service
- name: Create IAM role with custom trust relationship
  community.aws.iam:
    iam_type: role
    name: AAALambdaTestRole
    state: present
    trust_policy:
      Version: '2012-10-17'
      Statement:
      - Action: sts:AssumeRole
        Effect: Allow
        Principal:
          Service: lambda.amazonaws.com
</pre>   <h2 id="return-values">Return Values</h2> <p>Common return values are documented <a class="reference internal" href="../../../reference_appendices/common_return_values.html#common-return-values"><span class="std std-ref">here</span></a>, the following are the fields unique to this module:</p> <table class="documentation-table"> <tr> <th colspan="1">Key</th> <th>Returned</th> <th width="100%">Description</th> </tr> <tr> <td colspan="1">  <b>role_result</b>  <div> <span>string</span> </div> </td> <td>if iam_type=role and state=present</td> <td> <div>the IAM.role dict returned by Boto</div> <br> <div><b>Sample:</b></div> <div>{'arn': 'arn:aws:iam::A1B2C3D4E5F6:role/my-new-role', 'assume_role_policy_document': '...truncated...', 'create_date': '2017-09-02T14:32:23Z', 'path': '/', 'role_id': 'AROAA1B2C3D4E5F6G7H8I', 'role_name': 'my-new-role'}</div> </td> </tr> <tr> <td colspan="1">  <b>roles</b>  <div> <span>list</span> / <span>elements=string</span> </div> </td> <td>if iam_type=role and state=present</td> <td> <div>a list containing the name of the currently defined roles</div> <br> <div><b>Sample:</b></div> <div>['my-new-role', 'my-existing-role-1', 'my-existing-role-2', 'my-existing-role-3', 'my-existing-role-...']</div> </td> </tr> </table> <br><br> <h3 id="authors">Authors</h3> <ul class="simple"> <li>Jonathan I. Davila (@defionscode)</li> <li>Paul Seiffert (@seiffert)</li> </ul><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2012&ndash;2018 Michael DeHaan<br>&copy; 2018&ndash;2021 Red Hat, Inc.<br>Licensed under the GNU General Public License version 3.<br>
    <a href="https://docs.ansible.com/ansible/latest/collections/community/aws/iam_module.html" class="_attribution-link">https://docs.ansible.com/ansible/latest/collections/community/aws/iam_module.html</a>
  </p>
</div>
