<h1 id="community-aws-aws-api-gateway-manage-aws-api-gateway-apis">community.aws.aws_api_gateway – Manage AWS API Gateway APIs</h1> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This plugin is part of the <a class="reference external" href="https://galaxy.ansible.com/community/aws">community.aws collection</a> (version 1.5.0).</p> <p>You might already have this collection installed if you are using the <code>ansible</code> package. It is not included in <code>ansible-core</code>. To check whether it is installed, run <code>ansible-galaxy collection list</code>.</p> <p>To install it, use: <code>ansible-galaxy collection install community.aws</code>.</p> <p>To use it in a playbook, specify: <code>community.aws.aws_api_gateway</code>.</p> </div> <div class="versionadded"> <p><span class="versionmodified added">New in version 1.0.0: </span>of community.aws</p> </div>  <ul class="simple"> <li><a class="reference internal" href="#synopsis" id="id1">Synopsis</a></li> <li><a class="reference internal" href="#requirements" id="id2">Requirements</a></li> <li><a class="reference internal" href="#parameters" id="id3">Parameters</a></li> <li><a class="reference internal" href="#notes" id="id4">Notes</a></li> <li><a class="reference internal" href="#examples" id="id5">Examples</a></li> <li><a class="reference internal" href="#return-values" id="id6">Return Values</a></li> </ul>   <h2 id="synopsis">Synopsis</h2> <ul class="simple"> <li>Allows for the management of API Gateway APIs.</li> <li>Normally you should give the api_id since there is no other stable guaranteed unique identifier for the API. If you do not give api_id then a new API will be created each time this is run.</li> <li>Beware that there are very hard limits on the rate that you can call API Gateway’s REST API. You may need to patch your boto. See <a class="reference external" href="https://github.com/boto/boto3/issues/876">https://github.com/boto/boto3/issues/876</a> and discuss it with your AWS rep.</li> <li>swagger_file and swagger_text are passed directly on to AWS transparently whilst swagger_dict is an ansible dict which is converted to JSON before the API definitions are uploaded.</li> </ul>   <h2 id="requirements">Requirements</h2> <p>The below requirements are needed on the host that executes this module.</p> <ul class="simple"> <li>boto</li> <li>boto3</li> <li>python &gt;= 2.6</li> </ul>   <h2 id="parameters">Parameters</h2> <table class="documentation-table"> <tr> <th colspan="1">Parameter</th> <th>Choices/Defaults</th> <th width="100%">Comments</th> </tr> <tr> <td colspan="1">  <b>api_id</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The ID of the API you want to manage.</div> </td> </tr> <tr> <td colspan="1">  <b>aws_access_key</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>AWS access key. If not set then the value of the AWS_ACCESS_KEY_ID, AWS_ACCESS_KEY or EC2_ACCESS_KEY environment variable is used.</div> <div>If <em>profile</em> is set this parameter is ignored.</div> <div>Passing the <em>aws_access_key</em> and <em>profile</em> options at the same time has been deprecated and the options will be made mutually exclusive after 2022-06-01.</div> <div>
<br>aliases: ec2_access_key, access_key</div> </td> </tr> <tr> <td colspan="1">  <b>aws_ca_bundle</b>  <div> <span>path</span> </div> </td> <td> </td> <td> <div>The location of a CA Bundle to use when validating SSL certificates.</div> <div>Only used for boto3 based modules.</div> <div>Note: The CA Bundle is read 'module' side and may need to be explicitly copied from the controller if not run locally.</div> </td> </tr> <tr> <td colspan="1">  <b>aws_config</b>  <div> <span>dictionary</span> </div> </td> <td> </td> <td> <div>A dictionary to modify the botocore configuration.</div> <div>Parameters can be found at <a href="https://botocore.amazonaws.com/v1/documentation/api/latest/reference/config.html#botocore.config.Config">https://botocore.amazonaws.com/v1/documentation/api/latest/reference/config.html#botocore.config.Config</a>.</div> <div>Only the 'user_agent' key is used for boto modules. See <a href="http://boto.cloudhackers.com/en/latest/boto_config_tut.html#boto">http://boto.cloudhackers.com/en/latest/boto_config_tut.html#boto</a> for more boto configuration.</div> </td> </tr> <tr> <td colspan="1">  <b>aws_secret_key</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>AWS secret key. If not set then the value of the AWS_SECRET_ACCESS_KEY, AWS_SECRET_KEY, or EC2_SECRET_KEY environment variable is used.</div> <div>If <em>profile</em> is set this parameter is ignored.</div> <div>Passing the <em>aws_secret_key</em> and <em>profile</em> options at the same time has been deprecated and the options will be made mutually exclusive after 2022-06-01.</div> <div>
<br>aliases: ec2_secret_key, secret_key</div> </td> </tr> <tr> <td colspan="1">  <b>cache_enabled</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Enable API GW caching of backend responses.</div> </td> </tr> <tr> <td colspan="1">  <b>cache_size</b>  <div> <span>string</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>0.5</b> ←</div></li> <li>1.6</li> <li>6.1</li> <li>13.5</li> <li>28.4</li> <li>58.2</li> <li>118</li> <li>237</li> </ul> </td> <td> <div>Size in GB of the API GW cache, becomes effective when cache_enabled is true.</div> </td> </tr> <tr> <td colspan="1">  <b>debug_botocore_endpoint_logs</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Use a botocore.endpoint logger to parse the unique (rather than total) "resource:action" API calls made during a task, outputing the set to the resource_actions key in the task results. Use the aws_resource_action callback to output to total list made during a playbook. The ANSIBLE_DEBUG_BOTOCORE_LOGS environment variable may also be used.</div> </td> </tr> <tr> <td colspan="1">  <b>deploy_desc</b>  <div> <span>string</span> </div> </td> <td> <b>Default:</b><br><div>"Automatic deployment by Ansible."</div> </td> <td> <div>Description of the deployment.</div> <div>Recorded and visible in the AWS console.</div> </td> </tr> <tr> <td colspan="1">  <b>ec2_url</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Url to use to connect to EC2 or your Eucalyptus cloud (by default the module will use EC2 endpoints). Ignored for modules where region is required. Must be specified for all other modules if region is not used. If not set then the value of the EC2_URL environment variable, if any, is used.</div> <div>
<br>aliases: aws_endpoint_url, endpoint_url</div> </td> </tr> <tr> <td colspan="1">  <b>endpoint_type</b>  <div> <span>string</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>EDGE</b> ←</div></li> <li>REGIONAL</li> <li>PRIVATE</li> </ul> </td> <td> <div>Type of endpoint configuration.</div> <div>Use <code>EDGE</code> for an edge optimized API endpoint, <code>REGIONAL</code> for just a regional deploy or <code>PRIVATE</code> for a private API.</div> <div>This flag will only be used when creating a new API Gateway setup, not for updates.</div> </td> </tr> <tr> <td colspan="1">  <b>profile</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Uses a boto profile. Only works with boto &gt;= 2.24.0.</div> <div>Using <em>profile</em> will override <em>aws_access_key</em>, <em>aws_secret_key</em> and <em>security_token</em> and support for passing them at the same time as <em>profile</em> has been deprecated.</div> <div>
<em>aws_access_key</em>, <em>aws_secret_key</em> and <em>security_token</em> will be made mutually exclusive with <em>profile</em> after 2022-06-01.</div> <div>
<br>aliases: aws_profile</div> </td> </tr> <tr> <td colspan="1">  <b>region</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The AWS region to use. If not specified then the value of the AWS_REGION or EC2_REGION environment variable, if any, is used. See <a href="http://docs.aws.amazon.com/general/latest/gr/rande.html#ec2_region">http://docs.aws.amazon.com/general/latest/gr/rande.html#ec2_region</a>
</div> <div>
<br>aliases: aws_region, ec2_region</div> </td> </tr> <tr> <td colspan="1">  <b>security_token</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>AWS STS security token. If not set then the value of the AWS_SECURITY_TOKEN or EC2_SECURITY_TOKEN environment variable is used.</div> <div>If <em>profile</em> is set this parameter is ignored.</div> <div>Passing the <em>security_token</em> and <em>profile</em> options at the same time has been deprecated and the options will be made mutually exclusive after 2022-06-01.</div> <div>
<br>aliases: aws_security_token, access_token</div> </td> </tr> <tr> <td colspan="1">  <b>stage</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The name of the stage the API should be deployed to.</div> </td> </tr> <tr> <td colspan="1">  <b>stage_canary_settings</b>  <div> <span>dictionary</span> </div> </td> <td> </td> <td> <div>Canary settings for the deployment of the stage.</div> <div>Dict with following settings:</div> <div>
<code>percentTraffic</code>: The percent (0-100) of traffic diverted to a canary deployment.</div> <div>
<code>deploymentId</code>: The ID of the canary deployment.</div> <div>
<code>stageVariableOverrides</code>: Stage variables overridden for a canary release deployment.</div> <div>
<code>useStageCache</code>: A Boolean flag to indicate whether the canary deployment uses the stage cache or not.</div> <div>See docs <a href="https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/apigateway.html#APIGateway.Client.create_stage">https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/apigateway.html#APIGateway.Client.create_stage</a>
</div> </td> </tr> <tr> <td colspan="1">  <b>stage_variables</b>  <div> <span>dictionary</span> </div> </td> <td> </td> <td> <div>ENV variables for the stage. Define a dict of key values pairs for variables.</div> </td> </tr> <tr> <td colspan="1">  <b>state</b>  <div> <span>string</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>present</b> ←</div></li> <li>absent</li> </ul> </td> <td> <div>Create or delete API Gateway.</div> </td> </tr> <tr> <td colspan="1">  <b>swagger_dict</b>  <div> <span>json</span> </div> </td> <td> </td> <td> <div>Swagger definitions API ansible dictionary which will be converted to JSON and uploaded.</div> </td> </tr> <tr> <td colspan="1">  <b>swagger_file</b>  <div> <span>path</span> </div> </td> <td> </td> <td> <div>JSON or YAML file containing swagger definitions for API. Exactly one of <em>swagger_file</em>, <em>swagger_text</em> or <em>swagger_dict</em> must be present.</div> <div>
<br>aliases: src, api_file</div> </td> </tr> <tr> <td colspan="1">  <b>swagger_text</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Swagger definitions for API in JSON or YAML as a string direct from playbook.</div> </td> </tr> <tr> <td colspan="1">  <b>tracing_enabled</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Specifies whether active tracing with X-ray is enabled for the API GW stage.</div> </td> </tr> <tr> <td colspan="1">  <b>validate_certs</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>no</li> <li><div>
<b>yes</b> ←</div></li> </ul> </td> <td> <div>When set to "no", SSL certificates will not be validated for boto versions &gt;= 2.6.0.</div> </td> </tr> </table> <br>  <h2 id="notes">Notes</h2> <div class="admonition note"> <p class="admonition-title">Note</p> <ul class="simple"> <li>A future version of this module will probably use tags or another ID so that an API can be created only once.</li> <li>As an early work around an intermediate version will probably do the same using a tag embedded in the API name.</li> <li>If parameters are not set within the module, the following environment variables can be used in decreasing order of precedence <code>AWS_URL</code> or <code>EC2_URL</code>, <code>AWS_PROFILE</code> or <code>AWS_DEFAULT_PROFILE</code>, <code>AWS_ACCESS_KEY_ID</code> or <code>AWS_ACCESS_KEY</code> or <code>EC2_ACCESS_KEY</code>, <code>AWS_SECRET_ACCESS_KEY</code> or <code>AWS_SECRET_KEY</code> or <code>EC2_SECRET_KEY</code>, <code>AWS_SECURITY_TOKEN</code> or <code>EC2_SECURITY_TOKEN</code>, <code>AWS_REGION</code> or <code>EC2_REGION</code>, <code>AWS_CA_BUNDLE</code>
</li> <li>Ansible uses the boto configuration file (typically ~/.boto) if no credentials are provided. See <a class="reference external" href="https://boto.readthedocs.io/en/latest/boto_config_tut.html">https://boto.readthedocs.io/en/latest/boto_config_tut.html</a>
</li> <li>
<code>AWS_REGION</code> or <code>EC2_REGION</code> can be typically be used to specify the AWS region, when required, but this can also be configured in the boto config file</li> </ul> </div>   <h2 id="examples">Examples</h2> <pre data-language="yaml+jinja">- name: Setup AWS API Gateway setup on AWS and deploy API definition
  community.aws.aws_api_gateway:
    swagger_file: my_api.yml
    stage: production
    cache_enabled: true
    cache_size: '1.6'
    tracing_enabled: true
    endpoint_type: EDGE
    state: present

- name: Update API definition to deploy new version
  community.aws.aws_api_gateway:
    api_id: 'abc123321cba'
    swagger_file: my_api.yml
    deploy_desc: Make auth fix available.
    cache_enabled: true
    cache_size: '1.6'
    endpoint_type: EDGE
    state: present

- name: Update API definitions and settings and deploy as canary
  community.aws.aws_api_gateway:
    api_id: 'abc123321cba'
    swagger_file: my_api.yml
    cache_enabled: true
    cache_size: '6.1'
    canary_settings: { percentTraffic: 50.0, deploymentId: '123', useStageCache: True }
    state: present
</pre>   <h2 id="return-values">Return Values</h2> <p>Common return values are documented <a class="reference internal" href="../../../reference_appendices/common_return_values.html#common-return-values"><span class="std std-ref">here</span></a>, the following are the fields unique to this module:</p> <table class="documentation-table"> <tr> <th colspan="1">Key</th> <th>Returned</th> <th width="100%">Description</th> </tr> <tr> <td colspan="1">  <b>api_id</b>  <div> <span>string</span> </div> </td> <td>success</td> <td> <div>API id of the API endpoint created</div> <br> <div><b>Sample:</b></div> <div>0ln4zq7p86</div> </td> </tr> <tr> <td colspan="1">  <b>configure_response</b>  <div> <span>dictionary</span> </div> </td> <td>success</td> <td> <div>AWS response from the API configure call</div> <br> <div><b>Sample:</b></div> <div>{'api_key_source': 'HEADER', 'created_at': '2020-01-01T11:37:59+00:00', 'id': '0ln4zq7p86'}</div> </td> </tr> <tr> <td colspan="1">  <b>deploy_response</b>  <div> <span>dictionary</span> </div> </td> <td>success</td> <td> <div>AWS response from the API deploy call</div> <br> <div><b>Sample:</b></div> <div>{'created_date': '2020-01-01T11:36:59+00:00', 'description': 'Automatic deployment by Ansible.', 'id': 'rptv4b'}</div> </td> </tr> <tr> <td colspan="1">  <b>resource_actions</b>  <div> <span>list</span> / <span>elements=string</span> </div> </td> <td>always</td> <td> <div>Actions performed against AWS API</div> <br> <div><b>Sample:</b></div> <div>['apigateway:CreateRestApi', 'apigateway:CreateDeployment', 'apigateway:PutRestApi']</div> </td> </tr> </table> <br><br> <h3 id="authors">Authors</h3> <ul class="simple"> <li>Michael De La Rue (@mikedlr)</li> </ul><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2012&ndash;2018 Michael DeHaan<br>&copy; 2018&ndash;2021 Red Hat, Inc.<br>Licensed under the GNU General Public License version 3.<br>
    <a href="https://docs.ansible.com/ansible/latest/collections/community/aws/aws_api_gateway_module.html" class="_attribution-link">https://docs.ansible.com/ansible/latest/collections/community/aws/aws_api_gateway_module.html</a>
  </p>
</div>
