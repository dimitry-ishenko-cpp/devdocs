<h1 id="community-aws-aws-ssm-execute-via-aws-systems-manager">community.aws.aws_ssm â€“ execute via AWS Systems Manager</h1> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This plugin is part of the <a class="reference external" href="https://galaxy.ansible.com/community/aws">community.aws collection</a> (version 1.5.0).</p> <p>You might already have this collection installed if you are using the <code>ansible</code> package. It is not included in <code>ansible-core</code>. To check whether it is installed, run <code>ansible-galaxy collection list</code>.</p> <p>To install it, use: <code>ansible-galaxy collection install community.aws</code>.</p> <p>To use it in a playbook, specify: <code>community.aws.aws_ssm</code>.</p> </div>  <ul class="simple"> <li><a class="reference internal" href="#synopsis" id="id1">Synopsis</a></li> <li><a class="reference internal" href="#requirements" id="id2">Requirements</a></li> <li><a class="reference internal" href="#parameters" id="id3">Parameters</a></li> <li><a class="reference internal" href="#examples" id="id4">Examples</a></li> </ul>   <h2 id="synopsis">Synopsis</h2> <ul class="simple"> <li>This connection plugin allows ansible to execute tasks on an EC2 instance via the aws ssm CLI.</li> </ul>   <h2 id="requirements">Requirements</h2> <p>The below requirements are needed on the local controller node that executes this connection.</p> <ul class="simple"> <li>The remote EC2 instance must be running the AWS Systems Manager Agent (SSM Agent).</li> <li>The control machine must have the aws session manager plugin installed.</li> <li>The remote EC2 linux instance must have the curl installed.</li> </ul>   <h2 id="parameters">Parameters</h2> <table class="documentation-table"> <tr> <th colspan="1">Parameter</th> <th>Choices/Defaults</th> <th>Configuration</th> <th width="100%">Comments</th> </tr> <tr> <td colspan="1">  <b>access_key_id</b>  <div> <span>string</span> </div> <div> added in 1.3.0 of community.aws </div> </td> <td> </td> <td> <div> var: ansible_aws_ssm_access_key_id </div> </td> <td> <div>The STS access key to use when connecting via session-manager.</div> </td> </tr> <tr> <td colspan="1">  <b>bucket_name</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div> var: ansible_aws_ssm_bucket_name </div> </td> <td> <div>The name of the S3 bucket used for file transfers.</div> </td> </tr> <tr> <td colspan="1">  <b>instance_id</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div> var: ansible_aws_ssm_instance_id </div> </td> <td> <div>The EC2 instance ID.</div> </td> </tr> <tr> <td colspan="1">  <b>plugin</b>  <div> <span>string</span> </div> </td> <td> <b>Default:</b><br><div>"/usr/local/bin/session-manager-plugin"</div> </td> <td> <div> var: ansible_aws_ssm_plugin </div> </td> <td> <div>This defines the location of the session-manager-plugin binary.</div> </td> </tr> <tr> <td colspan="1">  <b>profile</b>  <div> <span>string</span> </div> <div> added in 1.5.0 of community.aws </div> </td> <td> </td> <td> <div> var: ansible_aws_ssm_profile </div> </td> <td> <div>Sets AWS profile to use.</div> </td> </tr> <tr> <td colspan="1">  <b>region</b>  <div> <span>string</span> </div> </td> <td> <b>Default:</b><br><div>"us-east-1"</div> </td> <td> <div> var: ansible_aws_ssm_region </div> </td> <td> <div>The region the EC2 instance is located.</div> </td> </tr> <tr> <td colspan="1">  <b>retries</b>  <div> <span>integer</span> </div> </td> <td> <b>Default:</b><br><div>3</div> </td> <td> <div> var: ansible_aws_ssm_retries </div> </td> <td> <div>Number of attempts to connect.</div> </td> </tr> <tr> <td colspan="1">  <b>secret_access_key</b>  <div> <span>string</span> </div> <div> added in 1.3.0 of community.aws </div> </td> <td> </td> <td> <div> var: ansible_aws_ssm_secret_access_key </div> </td> <td> <div>The STS secret key to use when connecting via session-manager.</div> </td> </tr> <tr> <td colspan="1">  <b>session_token</b>  <div> <span>string</span> </div> <div> added in 1.3.0 of community.aws </div> </td> <td> </td> <td> <div> var: ansible_aws_ssm_session_token </div> </td> <td> <div>The STS session token to use when connecting via session-manager.</div> </td> </tr> <tr> <td colspan="1">  <b>ssm_timeout</b>  <div> <span>integer</span> </div> </td> <td> <b>Default:</b><br><div>60</div> </td> <td> <div> var: ansible_aws_ssm_timeout </div> </td> <td> <div>Connection timeout seconds.</div> </td> </tr> </table> <br>  <h2 id="examples">Examples</h2> <pre data-language="yaml+jinja"># Stop Spooler Process on Windows Instances
- name: Stop Spooler Service on Windows Instances
  vars:
    ansible_connection: aws_ssm
    ansible_shell_type: powershell
    ansible_aws_ssm_bucket_name: nameofthebucket
    ansible_aws_ssm_region: us-east-1
  tasks:
    - name: Stop spooler service
      win_service:
        name: spooler
        state: stopped

# Install a Nginx Package on Linux Instance
- name: Install a Nginx Package
  vars:
    ansible_connection: aws_ssm
    ansible_aws_ssm_bucket_name: nameofthebucket
    ansible_aws_ssm_region: us-west-2
  tasks:
    - name: Install a Nginx Package
      yum:
        name: nginx
        state: present

# Create a directory in Windows Instances
- name: Create a directory in Windows Instance
  vars:
    ansible_connection: aws_ssm
    ansible_shell_type: powershell
    ansible_aws_ssm_bucket_name: nameofthebucket
    ansible_aws_ssm_region: us-east-1
  tasks:
    - name: Create a Directory
      win_file:
        path: C:\Windows\temp
        state: directory

# Making use of Dynamic Inventory Plugin
# =======================================
# aws_ec2.yml (Dynamic Inventory - Linux)
# This will return the Instance IDs matching the filter
#plugin: aws_ec2
#regions:
#    - us-east-1
#hostnames:
#    - instance-id
#filters:
#    tag:SSMTag: ssmlinux
# -----------------------
- name: install aws-cli
  hosts: all
  gather_facts: false
  vars:
    ansible_connection: aws_ssm
    ansible_aws_ssm_bucket_name: nameofthebucket
    ansible_aws_ssm_region: us-east-1
  tasks:
  - name: aws-cli
    raw: yum install -y awscli
    tags: aws-cli
# Execution: ansible-playbook linux.yaml -i aws_ec2.yml
# The playbook tasks will get executed on the instance ids returned from the dynamic inventory plugin using ssm connection.
# =====================================================
# aws_ec2.yml (Dynamic Inventory - Windows)
#plugin: aws_ec2
#regions:
#    - us-east-1
#hostnames:
#    - instance-id
#filters:
#    tag:SSMTag: ssmwindows
# -----------------------
- name: Create a dir.
  hosts: all
  gather_facts: false
  vars:
    ansible_connection: aws_ssm
    ansible_shell_type: powershell
    ansible_aws_ssm_bucket_name: nameofthebucket
    ansible_aws_ssm_region: us-east-1
  tasks:
    - name: Create the directory
      win_file:
        path: C:\Temp\SSM_Testing5
        state: directory
# Execution:  ansible-playbook win_file.yaml -i aws_ec2.yml
# The playbook tasks will get executed on the instance ids returned from the dynamic inventory plugin using ssm connection.
</pre>  <h3 id="authors">Authors</h3> <ul class="simple"> <li>Pat Sharkey (@psharkey) &lt;<a class="reference external" href="https://docs.ansible.com/cdn-cgi/l/email-protection#79090a11180b121c005f5a4a4e425f5a4c4b425f5a4d41421a151c165f5a4d4f421a1614">psharkey<span>@</span>cleo<span>.</span>com</a>&gt;</li> <li>HanumanthaRao MVL (@hanumantharaomvl) &lt;<a class="reference external" href="https://docs.ansible.com/cdn-cgi/l/email-protection#0b636a657e666a657f632d28383c302d283e39302d283f33306d677e733c2d283f3d30686466">hanumanth<span>@</span>flux7<span>.</span>com</a>&gt;</li> <li>Gaurav Ashtikar (@gau1991 )&lt;<a class="reference external" href="https://docs.ansible.com/cdn-cgi/l/email-protection#b4d3d5c1c6d5c2929780828fd5c7dcc0dddfd5c6929787838f929781868f9297808c8fd2d8c1cc83929780828fd7dbd9">gaurav<span>.</span>ashtikar<span>@</span>flux7<span>.</span>com</a>&gt;</li> </ul><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2012&ndash;2018 Michael DeHaan<br>&copy; 2018&ndash;2021 Red Hat, Inc.<br>Licensed under the GNU General Public License version 3.<br>
    <a href="https://docs.ansible.com/ansible/latest/collections/community/aws/aws_ssm_connection.html" class="_attribution-link">https://docs.ansible.com/ansible/latest/collections/community/aws/aws_ssm_connection.html</a>
  </p>
</div>
