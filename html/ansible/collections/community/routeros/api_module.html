<h1 id="community-routeros-api-ansible-module-for-routeros-api">community.routeros.api – Ansible module for RouterOS API</h1> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This plugin is part of the <a class="reference external" href="https://galaxy.ansible.com/community/routeros">community.routeros collection</a> (version 1.2.0).</p> <p>You might already have this collection installed if you are using the <code>ansible</code> package. It is not included in <code>ansible-core</code>. To check whether it is installed, run <code>ansible-galaxy collection list</code>.</p> <p>To install it, use: <code>ansible-galaxy collection install community.routeros</code>.</p> <p>To use it in a playbook, specify: <code>community.routeros.api</code>.</p> </div>  <ul class="simple"> <li><a class="reference internal" href="#synopsis" id="id1">Synopsis</a></li> <li><a class="reference internal" href="#requirements" id="id2">Requirements</a></li> <li><a class="reference internal" href="#parameters" id="id3">Parameters</a></li> <li><a class="reference internal" href="#notes" id="id4">Notes</a></li> <li><a class="reference internal" href="#examples" id="id5">Examples</a></li> <li><a class="reference internal" href="#return-values" id="id6">Return Values</a></li> </ul>   <h2 id="synopsis">Synopsis</h2> <ul class="simple"> <li>Ansible module for RouterOS API with python librouteros.</li> <li>This module can add, remove, update, query and execute arbitrary command in routeros via API.</li> </ul>   <h2 id="requirements">Requirements</h2> <p>The below requirements are needed on the host that executes this module.</p> <ul class="simple"> <li>librouteros</li> <li>Python &gt;= 3.6 (for librouteros)</li> </ul>   <h2 id="parameters">Parameters</h2> <table class="documentation-table"> <tr> <th colspan="1">Parameter</th> <th>Choices/Defaults</th> <th width="100%">Comments</th> </tr> <tr> <td colspan="1">  <b>add</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Will add selected arguments in selected path to RouterOS config.</div> <div>Example <code>address=1.1.1.1/32 interface=ether1</code>.</div> <div>Equivalent in RouterOS CLI <code>/ip address add address=1.1.1.1/32 interface=ether1</code>.</div> </td> </tr> <tr> <td colspan="1">  <b>ca_path</b>  <div> <span>path</span> </div> <div> added in 1.2.0 of community.routeros </div> </td> <td> </td> <td> <div>PEM formatted file that contains a CA certificate to be used for certificate validation.</div> <div>See also <em>validate_cert_hostname</em>. Only used when <em>tls=true</em> and <em>validate_certs=true</em>.</div> </td> </tr> <tr> <td colspan="1">  <b>cmd</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Execute any/arbitrary command in selected path, after the command we can add <code>.id</code>.</div> <div>Example path <code>system script</code> and cmd <code>run .id=*03</code> is equivalent in RouterOS CLI <code>/system script run number=0</code>.</div> <div>Example path <code>ip address</code> and cmd <code>print</code> is equivalent in RouterOS CLI <code>/ip address print</code>.</div> </td> </tr> <tr> <td colspan="1">  <b>hostname</b>  <div> <span>string</span> / <span>required</span> </div> </td> <td> </td> <td> <div>RouterOS hostname API.</div> </td> </tr> <tr> <td colspan="1">  <b>password</b>  <div> <span>string</span> / <span>required</span> </div> </td> <td> </td> <td> <div>RouterOS user password.</div> </td> </tr> <tr> <td colspan="1">  <b>path</b>  <div> <span>string</span> / <span>required</span> </div> </td> <td> </td> <td> <div>Main path for all other arguments.</div> <div>If other arguments are not set, api will return all items in selected path.</div> <div>Example <code>ip address</code>. Equivalent of RouterOS CLI <code>/ip address print</code>.</div> </td> </tr> <tr> <td colspan="1">  <b>port</b>  <div> <span>integer</span> </div> </td> <td> </td> <td> <div>RouterOS api port. If <em>tls</em> is set, port will apply to TLS/SSL connection.</div> <div>Defaults are <code>8728</code> for the HTTP API, and <code>8729</code> for the HTTPS API.</div> </td> </tr> <tr> <td colspan="1">  <b>query</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Query given path for selected query attributes from RouterOS aip and return '.id'.</div> <div>WHERE is key word which extend query. WHERE format is key operator value - with spaces.</div> <div>WHERE valid operators are <code>==</code>, <code>!=</code>, <code>&gt;</code>, <code>&lt;</code>.</div> <div>Example path <code>ip address</code> and query <code>.id address</code> will return only <code>.id</code> and <code>address</code> for all items in <code>ip address</code> path.</div> <div>Example path <code>ip address</code> and query <code>.id address WHERE address == 1.1.1.3/32</code>. will return only <code>.id</code> and <code>address</code> for items in <code>ip address</code> path, where address is eq to 1.1.1.3/32.</div> <div>Example path <code>interface</code> and query <code>mtu name WHERE mut &gt; 1400</code> will return only interfaces <code>mtu,name</code> where mtu is bigger than 1400.</div> <div>Equivalent in RouterOS CLI <code>/interface print where mtu &gt; 1400</code>.</div> </td> </tr> <tr> <td colspan="1">  <b>remove</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Remove config/value from RouterOS by '.id'.</div> <div>Example <code>*03</code> will remove config/value with <code>id=*03</code> in selected path.</div> <div>Equivalent in RouterOS CLI <code>/ip address remove numbers=1</code>.</div> <div>Note <code>number</code> in RouterOS CLI is different from <code>.id</code>.</div> </td> </tr> <tr> <td colspan="1">  <b>tls</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>If is set TLS will be used for RouterOS API connection.</div> <div>
<br>aliases: ssl</div> </td> </tr> <tr> <td colspan="1">  <b>update</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Update config/value in RouterOS by '.id' in selected path.</div> <div>Example <code>.id=*03 address=1.1.1.3/32</code> and path <code>ip address</code> will replace existing ip address with <code>.id=*03</code>.</div> <div>Equivalent in RouterOS CLI <code>/ip address set address=1.1.1.3/32 numbers=1</code>.</div> <div>Note <code>number</code> in RouterOS CLI is different from <code>.id</code>.</div> </td> </tr> <tr> <td colspan="1">  <b>username</b>  <div> <span>string</span> / <span>required</span> </div> </td> <td> </td> <td> <div>RouterOS login user.</div> </td> </tr> <tr> <td colspan="1">  <b>validate_cert_hostname</b>  <div> <span>boolean</span> </div> <div> added in 1.2.0 of community.routeros </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Set to <code>true</code> to validate hostnames in certificates.</div> <div>See also <em>validate_certs</em>. Only used when <em>tls=true</em> and <em>validate_certs=true</em>.</div> </td> </tr> <tr> <td colspan="1">  <b>validate_certs</b>  <div> <span>boolean</span> </div> <div> added in 1.2.0 of community.routeros </div> </td> <td> <ul>
<b>Choices:</b> <li>no</li> <li><div>
<b>yes</b> ←</div></li> </ul> </td> <td> <div>Set to <code>false</code> to skip validation of TLS certificates.</div> <div>See also <em>validate_cert_hostname</em>. Only used when <em>tls=true</em>.</div> <div>
<b>Note:</b> instead of simply deactivating certificate validations to "make things work", please consider creating your own CA certificate and using it to sign certificates used for your router. You can tell the module about your CA certificate with the <em>ca_path</em> option.</div> </td> </tr> </table> <br>  <h2 id="notes">Notes</h2> <div class="admonition note"> <p class="admonition-title">Note</p> <ul class="simple"> <li>
<em>add</em>, <em>remove</em>, <em>update</em>, <em>cmd</em> and <em>query</em> are mutually exclusive.</li> <li>
<em>check_mode</em> is not supported.</li> </ul> </div>   <h2 id="examples">Examples</h2> <pre data-language="yaml+jinja">---
- name: Use RouterOS API
  hosts: localhost
  gather_facts: no
  vars:
    hostname: "ros_api_hostname/ip"
    username: "admin"
    password: "secret_password"

    path: "ip address"

    nic: "ether2"
    ip1: "1.1.1.1/32"
    ip2: "2.2.2.2/32"
    ip3: "3.3.3.3/32"

  tasks:
    - name: Get "{{ path }} print"
      community.routeros.api:
        hostname: "{{ hostname }}"
        password: "{{ password }}"
        username: "{{ username }}"
        path: "{{ path }}"
      register: print_path

    - name: Dump "{{ path }} print" output
      ansible.builtin.debug:
        msg: '{{ print_path }}'

    - name: Add ip address "{{ ip1 }}" and "{{ ip2 }}"
      community.routeros.api:
        hostname: "{{ hostname }}"
        password: "{{ password }}"
        username: "{{ username }}"
        path: "{{ path }}"
        add: "{{ item }}"
      loop:
        - "address={{ ip1 }} interface={{ nic }}"
        - "address={{ ip2 }} interface={{ nic }}"
      register: addout

    - name: Dump "Add ip address" output - ".id" for new added items
      ansible.builtin.debug:
        msg: '{{ addout }}'

    - name: Query for ".id" in "{{ path }} WHERE address == {{ ip2 }}"
      community.routeros.api:
        hostname: "{{ hostname }}"
        password: "{{ password }}"
        username: "{{ username }}"
        path: "{{ path }}"
        query: ".id address WHERE address == {{ ip2 }}"
      register: queryout

    - name: Dump "Query for" output and set fact with ".id" for "{{ ip2 }}"
      ansible.builtin.debug:
        msg: '{{ queryout }}'

    - name: Store query_id for later usage
      ansible.builtin.set_fact:
        query_id: "{{ queryout['msg'][0]['.id'] }}"

    - name: Update ".id = {{ query_id }}" taken with custom fact "fquery_id"
      community.routeros.api:
        hostname: "{{ hostname }}"
        password: "{{ password }}"
        username: "{{ username }}"
        path: "{{ path }}"
        update: ".id={{ query_id }} address={{ ip3 }}"
      register: updateout

    - name: Dump "Update" output
      ansible.builtin.debug:
        msg: '{{ updateout }}'

    - name: Remove ips - stage 1 - query ".id" for "{{ ip2 }}" and "{{ ip3 }}"
      community.routeros.api:
        hostname: "{{ hostname }}"
        password: "{{ password }}"
        username: "{{ username }}"
        path: "{{ path }}"
        query: ".id address WHERE address == {{ item }}"
      register: id_to_remove
      loop:
        - "{{ ip2 }}"
        - "{{ ip3 }}"

    - name: Set fact for ".id" from "Remove ips - stage 1 - query"
      ansible.builtin.set_fact:
        to_be_remove: "{{ to_be_remove |default([]) + [item['msg'][0]['.id']] }}"
      loop: "{{ id_to_remove.results }}"

    - name: Dump "Remove ips - stage 1 - query" output
      ansible.builtin.debug:
        msg: '{{ to_be_remove }}'

    # Remove "{{ rmips }}" with ".id" by "to_be_remove" from query
    - name: Remove ips - stage 2 - remove "{{ ip2 }}" and "{{ ip3 }}" by '.id'
      community.routeros.api:
        hostname: "{{ hostname }}"
        password: "{{ password }}"
        username: "{{ username }}"
        path: "{{ path }}"
        remove: "{{ item }}"
      register: remove
      loop: "{{ to_be_remove }}"

    - name: Dump "Remove ips - stage 2 - remove" output
      ansible.builtin.debug:
        msg: '{{ remove }}'

    - name: Arbitrary command example "/system identity print"
      community.routeros.api:
        hostname: "{{ hostname }}"
        password: "{{ password }}"
        username: "{{ username }}"
        path: "system identity"
        cmd: "print"
      register: cmdout

    - name: Dump "Arbitrary command example" output
      ansible.builtin.debug:
        msg: "{{ cmdout }}"
</pre>   <h2 id="return-values">Return Values</h2> <p>Common return values are documented <a class="reference internal" href="../../../reference_appendices/common_return_values.html#common-return-values"><span class="std std-ref">here</span></a>, the following are the fields unique to this module:</p> <table class="documentation-table"> <tr> <th colspan="1">Key</th> <th>Returned</th> <th width="100%">Description</th> </tr> <tr> <td colspan="1">  <b>message</b>  <div> <span>list</span> / <span>elements=string</span> </div> </td> <td>always</td> <td> <div>All outputs are in list with dictionary elements returned from RouterOS api.</div> <br> <div><b>Sample:</b></div> <div><code>[{...},{...}]</code></div> </td> </tr> </table> <br><br> <h3 id="authors">Authors</h3> <ul class="simple"> <li>Nikolay Dachev (@NikolayDachev)</li> </ul><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2012&ndash;2018 Michael DeHaan<br>&copy; 2018&ndash;2021 Red Hat, Inc.<br>Licensed under the GNU General Public License version 3.<br>
    <a href="https://docs.ansible.com/ansible/latest/collections/community/routeros/api_module.html" class="_attribution-link">https://docs.ansible.com/ansible/latest/collections/community/routeros/api_module.html</a>
  </p>
</div>
