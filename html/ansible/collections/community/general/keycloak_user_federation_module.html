<h1 id="community-general-keycloak-user-federation-allows-administration-of-keycloak-user-federations-via-keycloak-api">community.general.keycloak_user_federation – Allows administration of Keycloak user federations via Keycloak API</h1> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This plugin is part of the <a class="reference external" href="https://galaxy.ansible.com/community/general">community.general collection</a> (version 3.8.1).</p> <p>You might already have this collection installed if you are using the <code>ansible</code> package. It is not included in <code>ansible-core</code>. To check whether it is installed, run <code>ansible-galaxy collection list</code>.</p> <p>To install it, use: <code>ansible-galaxy collection install community.general</code>.</p> <p>To use it in a playbook, specify: <code>community.general.keycloak_user_federation</code>.</p> </div> <div class="versionadded"> <p><span class="versionmodified added">New in version 3.7.0: </span>of community.general</p> </div>  <ul class="simple"> <li><a class="reference internal" href="#synopsis" id="id1">Synopsis</a></li> <li><a class="reference internal" href="#parameters" id="id2">Parameters</a></li> <li><a class="reference internal" href="#examples" id="id3">Examples</a></li> <li><a class="reference internal" href="#return-values" id="id4">Return Values</a></li> </ul>   <h2 id="synopsis">Synopsis</h2> <ul class="simple"> <li>This module allows you to add, remove or modify Keycloak user federations via the Keycloak REST API. It requires access to the REST API via OpenID Connect; the user connecting and the client being used must have the requisite access rights. In a default Keycloak installation, admin-cli and an admin user would work, as would a separate client definition with the scope tailored to your needs and a user having the expected roles.</li> <li>The names of module options are snake_cased versions of the camelCase ones found in the Keycloak API and its documentation at <a class="reference external" href="https://www.keycloak.org/docs-api/15.0/rest-api/index.html">https://www.keycloak.org/docs-api/15.0/rest-api/index.html</a>.</li> </ul>   <h2 id="parameters">Parameters</h2> <table class="documentation-table"> <tr> <th colspan="2">Parameter</th> <th>Choices/Defaults</th> <th width="100%">Comments</th> </tr> <tr> <td colspan="2">  <b>auth_client_id</b>  <div> <span>string</span> </div> </td> <td> <b>Default:</b><br><div>"admin-cli"</div> </td> <td> <div>OpenID Connect <em>client_id</em> to authenticate to the API with.</div> </td> </tr> <tr> <td colspan="2">  <b>auth_client_secret</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Client Secret to use in conjunction with <em>auth_client_id</em> (if required).</div> </td> </tr> <tr> <td colspan="2">  <b>auth_keycloak_url</b>  <div> <span>string</span> / <span>required</span> </div> </td> <td> </td> <td> <div>URL to the Keycloak instance.</div> <div>
<br>aliases: url</div> </td> </tr> <tr> <td colspan="2">  <b>auth_password</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Password to authenticate for API access with.</div> <div>
<br>aliases: password</div> </td> </tr> <tr> <td colspan="2">  <b>auth_realm</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Keycloak realm name to authenticate to for API access.</div> </td> </tr> <tr> <td colspan="2">  <b>auth_username</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Username to authenticate for API access with.</div> <div>
<br>aliases: username</div> </td> </tr> <tr> <td colspan="2">  <b>config</b>  <div> <span>dictionary</span> </div> </td> <td> </td> <td> <div>Dict specifying the configuration options for the provider; the contents differ depending on the value of <em>provider_id</em>. Examples are given below for <code>ldap</code> and <code>kerberos</code>. It is easiest to obtain valid config values by dumping an already-existing user federation configuration through check-mode in the <em>existing</em> field.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>allowKerberosAuthentication</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Enable/disable HTTP authentication of users with SPNEGO/Kerberos tokens. The data about authenticated users will be provisioned from this LDAP server.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>allowPasswordAuthentication</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>no</li> <li>yes</li> </ul> </td> <td> <div>Enable/disable possibility of username/password authentication against Kerberos database.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>authType</b>  <div> <span>string</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>none</b> ←</div></li> <li>simple</li> </ul> </td> <td> <div>Type of the Authentication method used during LDAP Bind operation. It is used in most of the requests sent to the LDAP server.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>batchSizeForSync</b>  <div> <span>integer</span> </div> </td> <td> <b>Default:</b><br><div>1000</div> </td> <td> <div>Count of LDAP users to be imported from LDAP to Keycloak within a single transaction.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>bindCredential</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Password of LDAP admin.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>bindDn</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>DN of LDAP user which will be used by Keycloak to access LDAP server.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>cachePolicy</b>  <div> <span>string</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>DEFAULT</b> ←</div></li> <li>EVICT_DAILY</li> <li>EVICT_WEEKLY</li> <li>MAX_LIFESPAN</li> <li>NO_CACHE</li> </ul> </td> <td> <div>Cache Policy for this storage provider.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>changedSyncPeriod</b>  <div> <span>integer</span> </div> </td> <td> <b>Default:</b><br><div>-1</div> </td> <td> <div>Period for synchronization of changed or newly created LDAP users in seconds.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>connectionPooling</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>no</li> <li><div>
<b>yes</b> ←</div></li> </ul> </td> <td> <div>Determines if Keycloak should use connection pooling for accessing LDAP server.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>connectionPoolingAuthentication</b>  <div> <span>string</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>none</li> <li>simple</li> <li>DIGEST-MD5</li> </ul> </td> <td> <div>A list of space-separated authentication types of connections that may be pooled.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>connectionPoolingDebug</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>A string that indicates the level of debug output to produce. Example valid values are <code>fine</code> (trace connection creation and removal) and <code>all</code> (all debugging information).</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>connectionPoolingInitSize</b>  <div> <span>integer</span> </div> </td> <td> </td> <td> <div>The number of connections per connection identity to create when initially creating a connection for the identity.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>connectionPoolingMaxSize</b>  <div> <span>integer</span> </div> </td> <td> </td> <td> <div>The maximum number of connections per connection identity that can be maintained concurrently.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>connectionPoolingPrefSize</b>  <div> <span>integer</span> </div> </td> <td> </td> <td> <div>The preferred number of connections per connection identity that should be maintained concurrently.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>connectionPoolingProtocol</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>A list of space-separated protocol types of connections that may be pooled. Valid types are <code>plain</code> and <code>ssl</code>.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>connectionPoolingTimeout</b>  <div> <span>integer</span> </div> </td> <td> </td> <td> <div>The number of milliseconds that an idle connection may remain in the pool without being closed and removed from the pool.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>connectionTimeout</b>  <div> <span>integer</span> </div> </td> <td> </td> <td> <div>LDAP Connection Timeout in milliseconds.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>connectionUrl</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Connection URL to your LDAP server.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>customUserSearchFilter</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Additional LDAP Filter for filtering searched users. Leave this empty if you don't need additional filter.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>debug</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>no</li> <li>yes</li> </ul> </td> <td> <div>Enable/disable debug logging to standard output for Krb5LoginModule.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>editMode</b>  <div> <span>string</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>READ_ONLY</li> <li>WRITABLE</li> <li>UNSYNCED</li> </ul> </td> <td> <div>
<code>READ_ONLY</code> is a read-only LDAP store. <code>WRITABLE</code> means data will be synced back to LDAP on demand. <code>UNSYNCED</code> means user data will be imported, but not synced back to LDAP.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>enabled</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>no</li> <li><div>
<b>yes</b> ←</div></li> </ul> </td> <td> <div>Enable/disable this user federation.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>evictionDay</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Day of the week the entry will become invalid on.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>evictionHour</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Hour of day the entry will become invalid on.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>evictionMinute</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Minute of day the entry will become invalid on.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>fullSyncPeriod</b>  <div> <span>integer</span> </div> </td> <td> <b>Default:</b><br><div>-1</div> </td> <td> <div>Period for full synchronization in seconds.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>importEnabled</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>no</li> <li><div>
<b>yes</b> ←</div></li> </ul> </td> <td> <div>If <code>true</code>, LDAP users will be imported into Keycloak DB and synced by the configured sync policies.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>kerberosRealm</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Name of kerberos realm.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>keyTab</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Location of Kerberos KeyTab file containing the credentials of server principal. For example <code>/etc/krb5.keytab</code>.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>maxLifespan</b>  <div> <span>integer</span> </div> </td> <td> </td> <td> <div>Max lifespan of cache entry in milliseconds.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>pagination</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>no</li> <li><div>
<b>yes</b> ←</div></li> </ul> </td> <td> <div>Does the LDAP server support pagination.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>priority</b>  <div> <span>integer</span> </div> </td> <td> <b>Default:</b><br><div>0</div> </td> <td> <div>Priority of provider when doing a user lookup. Lowest first.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>rdnLDAPAttribute</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Name of LDAP attribute, which is used as RDN (top attribute) of typical user DN. Usually it's the same as Username LDAP attribute, however it is not required. For example for Active directory, it is common to use <code>cn</code> as RDN attribute when username attribute might be <code>sAMAccountName</code>.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>readTimeout</b>  <div> <span>integer</span> </div> </td> <td> </td> <td> <div>LDAP Read Timeout in milliseconds. This timeout applies for LDAP read operations.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>searchScope</b>  <div> <span>string</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>1</b> ←</div></li> <li>2</li> </ul> </td> <td> <div>For one level, the search applies only for users in the DNs specified by User DNs. For subtree, the search applies to the whole subtree. See LDAP documentation for more details</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>serverPrincipal</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Full name of server principal for HTTP service including server and domain name. For example <code>HTTP/host.foo.org@FOO.ORG</code>. Use <code>*</code> to accept any service principal in the KeyTab file.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>startTls</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Encrypts the connection to LDAP using STARTTLS, which will disable connection pooling.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>syncRegistrations</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Should newly created users be created within LDAP store? Priority effects which provider is chosen to sync the new user.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>trustEmail</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>If enabled, email provided by this provider is not verified even if verification is enabled for the realm.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>updateProfileFirstLogin</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>no</li> <li>yes</li> </ul> </td> <td> <div>Update profile on first login.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>useKerberosForPasswordAuthentication</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Use Kerberos login module for authenticate username/password against Kerberos server instead of authenticating against LDAP server with Directory Service API.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>usePasswordModifyExtendedOp</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Use the LDAPv3 Password Modify Extended Operation (RFC-3062). The password modify extended operation usually requires that LDAP user already has password in the LDAP server. So when this is used with 'Sync Registrations', it can be good to add also 'Hardcoded LDAP attribute mapper' with randomly generated initial password.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>usernameLDAPAttribute</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Name of LDAP attribute, which is mapped as Keycloak username. For many LDAP server vendors it can be <code>uid</code>. For Active directory it can be <code>sAMAccountName</code> or <code>cn</code>. The attribute should be filled for all LDAP user records you want to import from LDAP to Keycloak.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>userObjectClasses</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>All values of LDAP objectClass attribute for users in LDAP divided by comma. For example <code>inetOrgPerson, organizationalPerson</code>. Newly created Keycloak users will be written to LDAP with all those object classes and existing LDAP user records are found just if they contain all those object classes.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>usersDn</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Full DN of LDAP tree where your users are. This DN is the parent of LDAP users.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>useTruststoreSpi</b>  <div> <span>string</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>always</li> <li><div>
<b>ldapsOnly</b> ←</div></li> <li>never</li> </ul> </td> <td> <div>Specifies whether LDAP connection will use the truststore SPI with the truststore configured in standalone.xml/domain.xml. <code>Always</code> means that it will always use it. <code>Never</code> means that it will not use it. <code>Only for ldaps</code> means that it will use if your connection URL use ldaps. Note even if standalone.xml/domain.xml is not configured, the default Java cacerts or certificate specified by <code>javax.net.ssl.trustStore</code> property will be used.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>uuidLDAPAttribute</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Name of LDAP attribute, which is used as unique object identifier (UUID) for objects in LDAP. For many LDAP server vendors, it is <code>entryUUID</code>; however some are different. For example for Active directory it should be <code>objectGUID</code>. If your LDAP server does not support the notion of UUID, you can use any other attribute that is supposed to be unique among LDAP users in tree.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>validatePasswordPolicy</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Determines if Keycloak should validate the password with the realm password policy before updating it.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>vendor</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>LDAP vendor (provider).</div> </td> </tr> <tr> <td colspan="2">  <b>id</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The unique ID for this user federation. If left empty, the user federation will be searched by its <em>name</em>.</div> </td> </tr> <tr> <td colspan="2">  <b>mappers</b>  <div> <span>list</span> / <span>elements=dictionary</span> </div> </td> <td> </td> <td> <div>A list of dicts defining mappers associated with this Identity Provider.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>config</b>  <div> <span>dictionary</span> </div> </td> <td> </td> <td> <div>Dict specifying the configuration options for the mapper; the contents differ depending on the value of <em>identityProviderMapper</em>.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>id</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Unique ID of this mapper.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>name</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Name of the mapper. If no ID is given, the mapper will be searched by name.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>parentId</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Unique ID for the parent of this mapper. ID of the user federation will automatically be used if left blank.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>providerId</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The mapper type for this mapper (for instance <code>user-attribute-ldap-mapper</code>).</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>providerType</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Component type for this mapper (only supported value is <code>org.keycloak.storage.ldap.mappers.LDAPStorageMapper</code>).</div> </td> </tr> <tr> <td colspan="2">  <b>name</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Display name of provider when linked in admin console.</div> </td> </tr> <tr> <td colspan="2">  <b>parent_id</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Unique ID for the parent of this user federation. Realm ID will be automatically used if left blank.</div> <div>
<br>aliases: parentId</div> </td> </tr> <tr> <td colspan="2">  <b>provider_id</b>  <div> <span>string</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>ldap</li> <li>kerberos</li> </ul> </td> <td> <div>Provider for this user federation.</div> <div>
<br>aliases: providerId</div> </td> </tr> <tr> <td colspan="2">  <b>provider_type</b>  <div> <span>string</span> </div> </td> <td> <b>Default:</b><br><div>"org.keycloak.storage.UserStorageProvider"</div> </td> <td> <div>Component type for user federation (only supported value is <code>org.keycloak.storage.UserStorageProvider</code>).</div> <div>
<br>aliases: providerType</div> </td> </tr> <tr> <td colspan="2">  <b>realm</b>  <div> <span>string</span> </div> </td> <td> <b>Default:</b><br><div>"master"</div> </td> <td> <div>The Keycloak realm under which this user federation resides.</div> </td> </tr> <tr> <td colspan="2">  <b>state</b>  <div> <span>string</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>present</b> ←</div></li> <li>absent</li> </ul> </td> <td> <div>State of the user federation.</div> <div>On <code>present</code>, the user federation will be created if it does not yet exist, or updated with the parameters you provide.</div> <div>On <code>absent</code>, the user federation will be removed if it exists.</div> </td> </tr> <tr> <td colspan="2">  <b>token</b>  <div> <span>string</span> </div> <div> added in 3.0.0 of community.general </div> </td> <td> </td> <td> <div>Authentication token for Keycloak API.</div> </td> </tr> <tr> <td colspan="2">  <b>validate_certs</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>no</li> <li><div>
<b>yes</b> ←</div></li> </ul> </td> <td> <div>Verify TLS certificates (do not disable this in production).</div> </td> </tr> </table> <br>  <h2 id="examples">Examples</h2> <pre data-language="yaml+jinja">- name: Create LDAP user federation
  community.general.keycloak_user_federation:
    auth_keycloak_url: https://keycloak.example.com/auth
    auth_realm: master
    auth_username: admin
    auth_password: password
    realm: my-realm
    name: my-ldap
    state: present
    provider_id: ldap
    provider_type: org.keycloak.storage.UserStorageProvider
    config:
      priority: 0
      enabled: true
      cachePolicy: DEFAULT
      batchSizeForSync: 1000
      editMode: READ_ONLY
      importEnabled: true
      syncRegistrations: false
      vendor: other
      usernameLDAPAttribute: uid
      rdnLDAPAttribute: uid
      uuidLDAPAttribute: entryUUID
      userObjectClasses: inetOrgPerson, organizationalPerson
      connectionUrl: ldaps://ldap.example.com:636
      usersDn: ou=Users,dc=example,dc=com
      authType: simple
      bindDn: cn=directory reader
      bindCredential: password
      searchScope: 1
      validatePasswordPolicy: false
      trustEmail: false
      useTruststoreSpi: ldapsOnly
      connectionPooling: true
      pagination: true
      allowKerberosAuthentication: false
      debug: false
      useKerberosForPasswordAuthentication: false
    mappers:
      - name: "full name"
        providerId: "full-name-ldap-mapper"
        providerType: "org.keycloak.storage.ldap.mappers.LDAPStorageMapper"
        config:
          ldap.full.name.attribute: cn
          read.only: true
          write.only: false

- name: Create Kerberos user federation
  community.general.keycloak_user_federation:
    auth_keycloak_url: https://keycloak.example.com/auth
    auth_realm: master
    auth_username: admin
    auth_password: password
    realm: my-realm
    name: my-kerberos
    state: present
    provider_id: kerberos
    provider_type: org.keycloak.storage.UserStorageProvider
    config:
      priority: 0
      enabled: true
      cachePolicy: DEFAULT
      kerberosRealm: EXAMPLE.COM
      serverPrincipal: HTTP/host.example.com@EXAMPLE.COM
      keyTab: keytab
      allowPasswordAuthentication: false
      updateProfileFirstLogin: false

- name: Delete user federation
  community.general.keycloak_user_federation:
    auth_keycloak_url: https://keycloak.example.com/auth
    auth_realm: master
    auth_username: admin
    auth_password: password
    realm: my-realm
    name: my-federation
    state: absent
</pre>   <h2 id="return-values">Return Values</h2> <p>Common return values are documented <a class="reference internal" href="../../../reference_appendices/common_return_values.html#common-return-values"><span class="std std-ref">here</span></a>, the following are the fields unique to this module:</p> <table class="documentation-table"> <tr> <th colspan="1">Key</th> <th>Returned</th> <th width="100%">Description</th> </tr> <tr> <td colspan="1">  <b>end_state</b>  <div> <span>dictionary</span> </div> </td> <td>always</td> <td> <div>Representation of user federation after module execution.</div> <br> <div><b>Sample:</b></div> <div>{'config': {'allowPasswordAuthentication': 'false', 'cachePolicy': 'DEFAULT', 'enabled': 'true', 'kerberosRealm': 'EXAMPLE.COM', 'keyTab': '/etc/krb5.keytab', 'priority': '0', 'serverPrincipal': 'HTTP/host.example.com@EXAMPLE.COM', 'updateProfileFirstLogin': 'false'}, 'id': 'cf52ae4f-4471-4435-a0cf-bb620cadc122', 'mappers': [], 'name': 'kerberos', 'parentId': 'myrealm', 'providerId': 'kerberos', 'providerType': 'org.keycloak.storage.UserStorageProvider'}</div> </td> </tr> <tr> <td colspan="1">  <b>existing</b>  <div> <span>dictionary</span> </div> </td> <td>always</td> <td> <div>Representation of existing user federation.</div> <br> <div><b>Sample:</b></div> <div>{'config': {'allowKerberosAuthentication': 'false', 'authType': 'simple', 'batchSizeForSync': '1000', 'bindCredential': '**********', 'bindDn': 'cn=directory reader', 'cachePolicy': 'DEFAULT', 'changedSyncPeriod': '-1', 'connectionPooling': 'true', 'connectionUrl': 'ldaps://ldap.example.com:636', 'debug': 'false', 'editMode': 'READ_ONLY', 'enabled': 'true', 'fullSyncPeriod': '-1', 'importEnabled': 'true', 'pagination': 'true', 'priority': '0', 'rdnLDAPAttribute': 'uid', 'searchScope': '1', 'syncRegistrations': 'false', 'trustEmail': 'false', 'useKerberosForPasswordAuthentication': 'false', 'useTruststoreSpi': 'ldapsOnly', 'userObjectClasses': 'inetOrgPerson, organizationalPerson', 'usernameLDAPAttribute': 'uid', 'usersDn': 'ou=Users,dc=example,dc=com', 'uuidLDAPAttribute': 'entryUUID', 'validatePasswordPolicy': 'false', 'vendor': 'other'}, 'id': '01122837-9047-4ae4-8ca0-6e2e891a765f', 'mappers': [{'config': {'always.read.value.from.ldap': 'false', 'is.mandatory.in.ldap': 'false', 'ldap.attribute': 'mail', 'read.only': 'true', 'user.model.attribute': 'email'}, 'id': '17d60ce2-2d44-4c2c-8b1f-1fba601b9a9f', 'name': 'email', 'parentId': '01122837-9047-4ae4-8ca0-6e2e891a765f', 'providerId': 'user-attribute-ldap-mapper', 'providerType': 'org.keycloak.storage.ldap.mappers.LDAPStorageMapper'}], 'name': 'myfed', 'parentId': 'myrealm', 'providerId': 'ldap', 'providerType': 'org.keycloak.storage.UserStorageProvider'}</div> </td> </tr> <tr> <td colspan="1">  <b>msg</b>  <div> <span>string</span> </div> </td> <td>always</td> <td> <div>Message as to what action was taken.</div> <br> <div><b>Sample:</b></div> <div>No changes required to user federation 164bb483-c613-482e-80fe-7f1431308799.</div> </td> </tr> <tr> <td colspan="1">  <b>proposed</b>  <div> <span>dictionary</span> </div> </td> <td>always</td> <td> <div>Representation of proposed changes to user federation.</div> <br> <div><b>Sample:</b></div> <div>{'config': {'allowKerberosAuthentication': 'false', 'authType': 'simple', 'batchSizeForSync': '1000', 'bindCredential': '**********', 'bindDn': 'cn=directory reader', 'cachePolicy': 'DEFAULT', 'connectionPooling': 'true', 'connectionUrl': 'ldaps://ldap.example.com:636', 'debug': 'false', 'editMode': 'READ_ONLY', 'enabled': 'true', 'importEnabled': 'true', 'pagination': 'true', 'priority': '0', 'rdnLDAPAttribute': 'uid', 'searchScope': '1', 'syncRegistrations': 'false', 'trustEmail': 'false', 'useKerberosForPasswordAuthentication': 'false', 'useTruststoreSpi': 'ldapsOnly', 'userObjectClasses': 'inetOrgPerson, organizationalPerson', 'usernameLDAPAttribute': 'uid', 'usersDn': 'ou=Users,dc=example,dc=com', 'uuidLDAPAttribute': 'entryUUID', 'validatePasswordPolicy': 'false', 'vendor': 'other'}, 'name': 'ldap', 'providerId': 'ldap', 'providerType': 'org.keycloak.storage.UserStorageProvider'}</div> </td> </tr> </table> <br><br> <h3 id="authors">Authors</h3> <ul class="simple"> <li>Laurent Paumier (@laurpaum)</li> </ul><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2012&ndash;2018 Michael DeHaan<br>&copy; 2018&ndash;2021 Red Hat, Inc.<br>Licensed under the GNU General Public License version 3.<br>
    <a href="https://docs.ansible.com/ansible/latest/collections/community/general/keycloak_user_federation_module.html" class="_attribution-link">https://docs.ansible.com/ansible/latest/collections/community/general/keycloak_user_federation_module.html</a>
  </p>
</div>
