<h1 id="community-general-dpkg-divert-override-a-debian-package-s-version-of-a-file">community.general.dpkg_divert – Override a debian package’s version of a file</h1> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This plugin is part of the <a class="reference external" href="https://galaxy.ansible.com/community/general">community.general collection</a> (version 3.8.1).</p> <p>You might already have this collection installed if you are using the <code>ansible</code> package. It is not included in <code>ansible-core</code>. To check whether it is installed, run <code>ansible-galaxy collection list</code>.</p> <p>To install it, use: <code>ansible-galaxy collection install community.general</code>.</p> <p>To use it in a playbook, specify: <code>community.general.dpkg_divert</code>.</p> </div> <div class="versionadded"> <p><span class="versionmodified added">New in version 0.2.0: </span>of community.general</p> </div>  <ul class="simple"> <li><a class="reference internal" href="#synopsis" id="id1">Synopsis</a></li> <li><a class="reference internal" href="#requirements" id="id2">Requirements</a></li> <li><a class="reference internal" href="#parameters" id="id3">Parameters</a></li> <li><a class="reference internal" href="#notes" id="id4">Notes</a></li> <li><a class="reference internal" href="#examples" id="id5">Examples</a></li> <li><a class="reference internal" href="#return-values" id="id6">Return Values</a></li> </ul>   <h2 id="synopsis">Synopsis</h2> <ul class="simple"> <li>A diversion is for <code>dpkg</code> the knowledge that only a given package (or the local administrator) is allowed to install a file at a given location. Other packages shipping their own version of this file will be forced to <em>divert</em> it, i.e. to install it at another location. It allows one to keep changes in a file provided by a debian package by preventing its overwrite at package upgrade.</li> <li>This module manages diversions of debian packages files using the <code>dpkg-divert</code> commandline tool. It can either create or remove a diversion for a given file, but also update an existing diversion to modify its <em>holder</em> and/or its <em>divert</em> location.</li> </ul>   <h2 id="requirements">Requirements</h2> <p>The below requirements are needed on the host that executes this module.</p> <ul class="simple"> <li>dpkg-divert &gt;= 1.15.0 (Debian family)</li> </ul>   <h2 id="parameters">Parameters</h2> <table class="documentation-table"> <tr> <th colspan="1">Parameter</th> <th>Choices/Defaults</th> <th width="100%">Comments</th> </tr> <tr> <td colspan="1">  <b>divert</b>  <div> <span>path</span> </div> </td> <td> </td> <td> <div>The location where the versions of file will be diverted.</div> <div>Default is to add suffix <code>.distrib</code> to the file path.</div> <div>This parameter is ignored when <em>state=absent</em>.</div> </td> </tr> <tr> <td colspan="1">  <b>force</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>When <em>rename=true</em> and <em>force=true</em>, renaming is performed even if the target of the renaming exists, i.e. the existing contents of the file at this location will be lost.</div> <div>This parameter is ignored when <em>rename=false</em>.</div> </td> </tr> <tr> <td colspan="1">  <b>holder</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The name of the package whose copy of file is not diverted, also known as the diversion holder or the package the diversion belongs to.</div> <div>The actual package does not have to be installed or even to exist for its name to be valid. If not specified, the diversion is hold by 'LOCAL', that is reserved by/for dpkg for local diversions.</div> <div>This parameter is ignored when <em>state=absent</em>.</div> </td> </tr> <tr> <td colspan="1">  <b>path</b>  <div> <span>path</span> / <span>required</span> </div> </td> <td> </td> <td> <div>The original and absolute path of the file to be diverted or undiverted. This path is unique, i.e. it is not possible to get two diversions for the same <em>path</em>.</div> </td> </tr> <tr> <td colspan="1">  <b>rename</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Actually move the file aside (when <em>state=present</em>) or back (when <em>state=absent</em>), but only when changing the state of the diversion. This parameter has no effect when attempting to add a diversion that already exists or when removing an unexisting one.</div> <div>Unless <em>force=true</em>, renaming fails if the destination file already exists (this lock being a dpkg-divert feature, and bypassing it being a module feature).</div> </td> </tr> <tr> <td colspan="1">  <b>state</b>  <div> <span>string</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>absent</li> <li><div>
<b>present</b> ←</div></li> </ul> </td> <td> <div>When <em>state=absent</em>, remove the diversion of the specified <em>path</em>; when <em>state=present</em>, create the diversion if it does not exist, or update its package <em>holder</em> or <em>divert</em> location, if it already exists.</div> </td> </tr> </table> <br>  <h2 id="notes">Notes</h2> <div class="admonition note"> <p class="admonition-title">Note</p> <ul class="simple"> <li>This module supports <em>check_mode</em> and <em>diff</em>.</li> </ul> </div>   <h2 id="examples">Examples</h2> <pre data-language="yaml+jinja">- name: Divert /usr/bin/busybox to /usr/bin/busybox.distrib and keep file in place
  community.general.dpkg_divert:
    path: /usr/bin/busybox

- name: Divert /usr/bin/busybox by package 'branding'
  community.general.dpkg_divert:
    path: /usr/bin/busybox
    holder: branding

- name: Divert and rename busybox to busybox.dpkg-divert
  community.general.dpkg_divert:
    path: /usr/bin/busybox
    divert: /usr/bin/busybox.dpkg-divert
    rename: yes

- name: Remove the busybox diversion and move the diverted file back
  community.general.dpkg_divert:
    path: /usr/bin/busybox
    state: absent
    rename: yes
    force: yes
</pre>   <h2 id="return-values">Return Values</h2> <p>Common return values are documented <a class="reference internal" href="../../../reference_appendices/common_return_values.html#common-return-values"><span class="std std-ref">here</span></a>, the following are the fields unique to this module:</p> <table class="documentation-table"> <tr> <th colspan="2">Key</th> <th>Returned</th> <th width="100%">Description</th> </tr> <tr> <td colspan="2">  <b>commands</b>  <div> <span>list</span> / <span>elements=string</span> </div> </td> <td>on_success</td> <td> <div>The dpkg-divert commands ran internally by the module.</div> <br> <div><b>Sample:</b></div> <div>[ "/usr/bin/dpkg-divert --no-rename --remove /etc/foobarrc", "/usr/bin/dpkg-divert --package ansible --no-rename --add /etc/foobarrc" ]</div> </td> </tr> <tr> <td colspan="2">  <b>diversion</b>  <div> <span>dictionary</span> </div> </td> <td>always</td> <td> <div>The status of the diversion after task execution.</div> <br> <div><b>Sample:</b></div> <div>{ "divert": "/etc/foobarrc.distrib", "holder": "LOCAL", "path": "/etc/foobarrc" "state": "present" }</div> </td> </tr> <tr> <td class="elbow-placeholder"> </td> <td colspan="1">  <b>divert</b>  <div> <span>string</span> </div> </td> <td>success</td> <td> <div>The location of the diverted file.</div> <br> </td> </tr> <tr> <td class="elbow-placeholder"> </td> <td colspan="1">  <b>holder</b>  <div> <span>string</span> </div> </td> <td>success</td> <td> <div>The package holding the diversion.</div> <br> </td> </tr> <tr> <td class="elbow-placeholder"> </td> <td colspan="1">  <b>path</b>  <div> <span>string</span> </div> </td> <td>success</td> <td> <div>The path of the file to divert/undivert.</div> <br> </td> </tr> <tr> <td class="elbow-placeholder"> </td> <td colspan="1">  <b>state</b>  <div> <span>string</span> </div> </td> <td>success</td> <td> <div>The state of the diversion.</div> <br> </td> </tr> <tr> <td colspan="2">  <b>messages</b>  <div> <span>list</span> / <span>elements=string</span> </div> </td> <td>on_success</td> <td> <div>The dpkg-divert relevant messages (stdout or stderr).</div> <br> <div><b>Sample:</b></div> <div>[ "Removing 'local diversion of /etc/foobarrc to /etc/foobarrc.distrib'", "Adding 'diversion of /etc/foobarrc to /etc/foobarrc.distrib by ansible'" ]</div> </td> </tr> </table> <br><br> <h3 id="authors">Authors</h3> <ul class="simple"> <li>quidame (@quidame)</li> </ul><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2012&ndash;2018 Michael DeHaan<br>&copy; 2018&ndash;2021 Red Hat, Inc.<br>Licensed under the GNU General Public License version 3.<br>
    <a href="https://docs.ansible.com/ansible/latest/collections/community/general/dpkg_divert_module.html" class="_attribution-link">https://docs.ansible.com/ansible/latest/collections/community/general/dpkg_divert_module.html</a>
  </p>
</div>
