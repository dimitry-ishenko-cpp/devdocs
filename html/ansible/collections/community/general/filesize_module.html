<h1 id="community-general-filesize-create-a-file-with-a-given-size-or-resize-it-if-it-exists">community.general.filesize – Create a file with a given size, or resize it if it exists</h1> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This plugin is part of the <a class="reference external" href="https://galaxy.ansible.com/community/general">community.general collection</a> (version 3.8.1).</p> <p>You might already have this collection installed if you are using the <code>ansible</code> package. It is not included in <code>ansible-core</code>. To check whether it is installed, run <code>ansible-galaxy collection list</code>.</p> <p>To install it, use: <code>ansible-galaxy collection install community.general</code>.</p> <p>To use it in a playbook, specify: <code>community.general.filesize</code>.</p> </div> <div class="versionadded"> <p><span class="versionmodified added">New in version 3.0.0: </span>of community.general</p> </div>  <ul class="simple"> <li><a class="reference internal" href="#synopsis" id="id1">Synopsis</a></li> <li><a class="reference internal" href="#requirements" id="id2">Requirements</a></li> <li><a class="reference internal" href="#parameters" id="id3">Parameters</a></li> <li><a class="reference internal" href="#notes" id="id4">Notes</a></li> <li><a class="reference internal" href="#see-also" id="id5">See Also</a></li> <li><a class="reference internal" href="#examples" id="id6">Examples</a></li> <li><a class="reference internal" href="#return-values" id="id7">Return Values</a></li> </ul>   <h2 id="synopsis">Synopsis</h2> <ul class="simple"> <li>This module is a simple wrapper around <code>dd</code> to create, extend or truncate a file, given its size. It can be used to manage swap files (that require contiguous blocks) or alternatively, huge sparse files.</li> </ul>   <h2 id="requirements">Requirements</h2> <p>The below requirements are needed on the host that executes this module.</p> <ul class="simple"> <li>dd (Data Duplicator) in PATH</li> </ul>   <h2 id="parameters">Parameters</h2> <table class="documentation-table"> <tr> <th colspan="1">Parameter</th> <th>Choices/Defaults</th> <th width="100%">Comments</th> </tr> <tr> <td colspan="1">  <b>attributes</b>  <div> <span>string</span> </div> <div> added in 2.3 of ansible.builtin </div> </td> <td> </td> <td> <div>The attributes the resulting file or directory should have.</div> <div>To get supported flags look at the man page for <em>chattr</em> on the target system.</div> <div>This string should contain the attributes in the same order as the one displayed by <em>lsattr</em>.</div> <div>The <code>=</code> operator is assumed as default, otherwise <code>+</code> or <code>-</code> operators need to be included in the string.</div> <div>
<br>aliases: attr</div> </td> </tr> <tr> <td colspan="1">  <b>blocksize</b>  <div> <span>raw</span> </div> </td> <td> </td> <td> <div>Size of blocks, in bytes if not followed by a multiplicative suffix.</div> <div>The numeric value (before the unit) <code>MUST</code> be an integer (or a <code>float</code> if it equals an integer).</div> <div>If not set, the size of blocks is guessed from the OS and commonly results in <code>512</code> or <code>4096</code> bytes, that is used internally by the module or when <em>size</em> has no unit.</div> </td> </tr> <tr> <td colspan="1">  <b>force</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Whether or not to overwrite the file if it exists, in other words, to truncate it from 0. When <code>true</code>, the module is not idempotent, that means it always reports <em>changed=true</em>.</div> <div>
<em>force=true</em> and <em>sparse=true</em> are mutually exclusive.</div> </td> </tr> <tr> <td colspan="1">  <b>group</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Name of the group that should own the file/directory, as would be fed to <em>chown</em>.</div> </td> </tr> <tr> <td colspan="1">  <b>mode</b>  <div> <span>raw</span> </div> </td> <td> </td> <td> <div>The permissions the resulting file or directory should have.</div> <div>For those used to <em>/usr/bin/chmod</em> remember that modes are actually octal numbers. You must either add a leading zero so that Ansible's YAML parser knows it is an octal number (like <code>0644</code> or <code>01777</code>) or quote it (like <code>'644'</code> or <code>'1777'</code>) so Ansible receives a string and can do its own conversion from string into number.</div> <div>Giving Ansible a number without following one of these rules will end up with a decimal number which will have unexpected results.</div> <div>As of Ansible 1.8, the mode may be specified as a symbolic mode (for example, <code>u+rwx</code> or <code>u=rw,g=r,o=r</code>).</div> <div>If <code>mode</code> is not specified and the destination file <b>does not</b> exist, the default <code>umask</code> on the system will be used when setting the mode for the newly created file.</div> <div>If <code>mode</code> is not specified and the destination file <b>does</b> exist, the mode of the existing file will be used.</div> <div>Specifying <code>mode</code> is the best way to ensure files are created with the correct permissions. See CVE-2020-1736 for further details.</div> </td> </tr> <tr> <td colspan="1">  <b>owner</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Name of the user that should own the file/directory, as would be fed to <em>chown</em>.</div> </td> </tr> <tr> <td colspan="1">  <b>path</b>  <div> <span>path</span> / <span>required</span> </div> </td> <td> </td> <td> <div>Path of the regular file to create or resize.</div> </td> </tr> <tr> <td colspan="1">  <b>selevel</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The level part of the SELinux file context.</div> <div>This is the MLS/MCS attribute, sometimes known as the <code>range</code>.</div> <div>When set to <code>_default</code>, it will use the <code>level</code> portion of the policy if available.</div> </td> </tr> <tr> <td colspan="1">  <b>serole</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The role part of the SELinux file context.</div> <div>When set to <code>_default</code>, it will use the <code>role</code> portion of the policy if available.</div> </td> </tr> <tr> <td colspan="1">  <b>setype</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The type part of the SELinux file context.</div> <div>When set to <code>_default</code>, it will use the <code>type</code> portion of the policy if available.</div> </td> </tr> <tr> <td colspan="1">  <b>seuser</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The user part of the SELinux file context.</div> <div>By default it uses the <code>system</code> policy, where applicable.</div> <div>When set to <code>_default</code>, it will use the <code>user</code> portion of the policy if available.</div> </td> </tr> <tr> <td colspan="1">  <b>size</b>  <div> <span>raw</span> / <span>required</span> </div> </td> <td> </td> <td> <div>Requested size of the file.</div> <div>The value is a number (either <code>int</code> or <code>float</code>) optionally followed by a multiplicative suffix, that can be one of <code>B</code> (bytes), <code>KB</code> or <code>kB</code> (= 1000B), <code>MB</code> or <code>mB</code> (= 1000kB), <code>GB</code> or <code>gB</code> (= 1000MB), and so on for <code>T</code>, <code>P</code>, <code>E</code>, <code>Z</code> and <code>Y</code>; or alternatively one of <code>K</code>, <code>k</code> or <code>KiB</code> (= 1024B); <code>M</code>, <code>m</code> or <code>MiB</code> (= 1024KiB); <code>G</code>, <code>g</code> or <code>GiB</code> (= 1024MiB); and so on.</div> <div>If the multiplicative suffix is not provided, the value is treated as an integer number of blocks of <em>blocksize</em> bytes each (float values are rounded to the closest integer).</div> <div>When the <em>size</em> value is equal to the current file size, does nothing.</div> <div>When the <em>size</em> value is bigger than the current file size, bytes from <em>source</em> (if <em>sparse</em> is not <code>false</code>) are appended to the file without truncating it, in other words, without modifying the existing bytes of the file.</div> <div>When the <em>size</em> value is smaller than the current file size, it is truncated to the requested value without modifying bytes before this value.</div> <div>That means that a file of any arbitrary size can be grown to any other arbitrary size, and then resized down to its initial size without modifying its initial content.</div> </td> </tr> <tr> <td colspan="1">  <b>source</b>  <div> <span>path</span> </div> </td> <td> <b>Default:</b><br><div>"/dev/zero"</div> </td> <td> <div>Device or file that provides input data to provision the file.</div> <div>This parameter is ignored when <em>sparse=true</em>.</div> </td> </tr> <tr> <td colspan="1">  <b>sparse</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Whether or not the file to create should be a sparse file.</div> <div>This option is effective only on newly created files, or when growing a file, only for the bytes to append.</div> <div>This option is not supported on OpenBSD, Solaris and AIX.</div> <div>
<em>force=true</em> and <em>sparse=true</em> are mutually exclusive.</div> </td> </tr> <tr> <td colspan="1">  <b>unsafe_writes</b>  <div> <span>boolean</span> </div> <div> added in 2.2 of ansible.builtin </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>This option is silently ignored. This module always modifies file size in-place.</div> </td> </tr> </table> <br>  <h2 id="notes">Notes</h2> <div class="admonition note"> <p class="admonition-title">Note</p> <ul class="simple"> <li>This module supports <code>check_mode</code> and <code>diff</code>.</li> </ul> </div>   <h2 id="see-also">See Also</h2> <div class="admonition seealso"> <p class="admonition-title">See also</p> <dl class="simple"> <dt><a class="reference external" href="https://man7.org/linux/man-pages/man1/dd.1.html">dd(1) manpage for Linux</a></dt>
<dd>
<p>Manual page of the GNU/Linux’s dd implementation (from GNU coreutils).</p> </dd> <dt><a class="reference external" href="https://www.ibm.com/support/knowledgecenter/ssw_aix_72/d_commands/dd.html">dd(1) manpage for IBM AIX</a></dt>
<dd>
<p>Manual page of the IBM AIX’s dd implementation.</p> </dd> <dt><a class="reference external" href="https://www.unix.com/man-page/osx/1/dd/">dd(1) manpage for Mac OSX</a></dt>
<dd>
<p>Manual page of the Mac OSX’s dd implementation.</p> </dd> <dt><a class="reference external" href="https://docs.oracle.com/cd/E36784_01/html/E36871/dd-1m.html">dd(1M) manpage for Solaris</a></dt>
<dd>
<p>Manual page of the Oracle Solaris’s dd implementation.</p> </dd> <dt><a class="reference external" href="https://www.freebsd.org/cgi/man.cgi?dd(1)">dd(1) manpage for FreeBSD</a></dt>
<dd>
<p>Manual page of the FreeBSD’s dd implementation.</p> </dd> <dt><a class="reference external" href="https://man.openbsd.org/dd">dd(1) manpage for OpenBSD</a></dt>
<dd>
<p>Manual page of the OpenBSD’s dd implementation.</p> </dd> <dt><a class="reference external" href="https://man.netbsd.org/dd.1">dd(1) manpage for NetBSD</a></dt>
<dd>
<p>Manual page of the NetBSD’s dd implementation.</p> </dd> </dl> </div>   <h2 id="examples">Examples</h2> <pre data-language="yaml+jinja">- name: Create a file of 1G filled with null bytes
  community.general.filesize:
    path: /var/bigfile
    size: 1G

- name: Extend the file to 2G (2*1024^3)
  community.general.filesize:
    path: /var/bigfile
    size: 2G

- name: Reduce the file to 2GB (2*1000^3)
  community.general.filesize:
    path: /var/bigfile
    size: 2GB

- name: Fill a file with random bytes for backing a LUKS device
  community.general.filesize:
    path: ~/diskimage.luks
    size: 512.0 MiB
    source: /dev/urandom

- name: Take a backup of MBR boot code into a file, overwriting it if it exists
  community.general.filesize:
    path: /media/sdb1/mbr.bin
    size: 440B
    source: /dev/sda
    force: true

- name: Create/resize a sparse file of/to 8TB
  community.general.filesize:
    path: /var/local/sparsefile
    size: 8TB
    sparse: true

- name: Create a file with specific size and attributes, to be used as swap space
  community.general.filesize:
    path: /var/swapfile
    size: 2G
    blocksize: 512B
    mode: u=rw,go=
    owner: root
    group: root
</pre>   <h2 id="return-values">Return Values</h2> <p>Common return values are documented <a class="reference internal" href="../../../reference_appendices/common_return_values.html#common-return-values"><span class="std std-ref">here</span></a>, the following are the fields unique to this module:</p> <table class="documentation-table"> <tr> <th colspan="2">Key</th> <th>Returned</th> <th width="100%">Description</th> </tr> <tr> <td colspan="2">  <b>cmd</b>  <div> <span>string</span> </div> </td> <td>when changed or failed</td> <td> <div>Command executed to create or resize the file.</div> <br> <div><b>Sample:</b></div> <div>/usr/bin/dd if=/dev/zero of=/var/swapfile bs=1048576 seek=3072 count=1024</div> </td> </tr> <tr> <td colspan="2">  <b>filesize</b>  <div> <span>dictionary</span> </div> </td> <td>always</td> <td> <div>Dictionary of sizes related to the file.</div> <br> </td> </tr> <tr> <td class="elbow-placeholder"> </td> <td colspan="1">  <b>blocks</b>  <div> <span>integer</span> </div> </td> <td>success</td> <td> <div>Number of blocks in the file.</div> <br> <div><b>Sample:</b></div> <div>500</div> </td> </tr> <tr> <td class="elbow-placeholder"> </td> <td colspan="1">  <b>blocksize</b>  <div> <span>integer</span> </div> </td> <td>success</td> <td> <div>Size of the blocks in bytes.</div> <br> <div><b>Sample:</b></div> <div>1024</div> </td> </tr> <tr> <td class="elbow-placeholder"> </td> <td colspan="1">  <b>bytes</b>  <div> <span>integer</span> </div> </td> <td>success</td> <td> <div>Size of the file, in bytes, as the product of <code>blocks</code> and <code>blocksize</code>.</div> <br> <div><b>Sample:</b></div> <div>512000</div> </td> </tr> <tr> <td class="elbow-placeholder"> </td> <td colspan="1">  <b>iec</b>  <div> <span>string</span> </div> </td> <td>success</td> <td> <div>Size of the file, in human-readable format, following IEC standard.</div> <br> <div><b>Sample:</b></div> <div>500.0 KiB</div> </td> </tr> <tr> <td class="elbow-placeholder"> </td> <td colspan="1">  <b>si</b>  <div> <span>string</span> </div> </td> <td>success</td> <td> <div>Size of the file, in human-readable format, following SI standard.</div> <br> <div><b>Sample:</b></div> <div>512.0 kB</div> </td> </tr> <tr> <td colspan="2">  <b>path</b>  <div> <span>string</span> </div> </td> <td>always</td> <td> <div>Realpath of the file if it is a symlink, otherwise the same than module's param.</div> <br> <div><b>Sample:</b></div> <div>/var/swap0</div> </td> </tr> <tr> <td colspan="2">  <b>size_diff</b>  <div> <span>integer</span> </div> </td> <td>always</td> <td> <div>Difference (positive or negative) between old size and new size, in bytes.</div> <br> <div><b>Sample:</b></div> <div>-1234567890</div> </td> </tr> </table> <br><br> <h3 id="authors">Authors</h3> <ul class="simple"> <li>quidame (@quidame)</li> </ul><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2012&ndash;2018 Michael DeHaan<br>&copy; 2018&ndash;2021 Red Hat, Inc.<br>Licensed under the GNU General Public License version 3.<br>
    <a href="https://docs.ansible.com/ansible/latest/collections/community/general/filesize_module.html" class="_attribution-link">https://docs.ansible.com/ansible/latest/collections/community/general/filesize_module.html</a>
  </p>
</div>
