<h1 id="community-general-keycloak-identity-provider-allows-administration-of-keycloak-identity-providers-via-keycloak-api">community.general.keycloak_identity_provider – Allows administration of Keycloak identity providers via Keycloak API</h1> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This plugin is part of the <a class="reference external" href="https://galaxy.ansible.com/community/general">community.general collection</a> (version 3.8.1).</p> <p>You might already have this collection installed if you are using the <code>ansible</code> package. It is not included in <code>ansible-core</code>. To check whether it is installed, run <code>ansible-galaxy collection list</code>.</p> <p>To install it, use: <code>ansible-galaxy collection install community.general</code>.</p> <p>To use it in a playbook, specify: <code>community.general.keycloak_identity_provider</code>.</p> </div> <div class="versionadded"> <p><span class="versionmodified added">New in version 3.6.0: </span>of community.general</p> </div>  <ul class="simple"> <li><a class="reference internal" href="#synopsis" id="id1">Synopsis</a></li> <li><a class="reference internal" href="#parameters" id="id2">Parameters</a></li> <li><a class="reference internal" href="#examples" id="id3">Examples</a></li> <li><a class="reference internal" href="#return-values" id="id4">Return Values</a></li> </ul>   <h2 id="synopsis">Synopsis</h2> <ul class="simple"> <li>This module allows you to add, remove or modify Keycloak identity providers via the Keycloak REST API. It requires access to the REST API via OpenID Connect; the user connecting and the client being used must have the requisite access rights. In a default Keycloak installation, admin-cli and an admin user would work, as would a separate client definition with the scope tailored to your needs and a user having the expected roles.</li> <li>The names of module options are snake_cased versions of the camelCase ones found in the Keycloak API and its documentation at <a class="reference external" href="https://www.keycloak.org/docs-api/15.0/rest-api/index.html">https://www.keycloak.org/docs-api/15.0/rest-api/index.html</a>.</li> </ul>   <h2 id="parameters">Parameters</h2> <table class="documentation-table"> <tr> <th colspan="2">Parameter</th> <th>Choices/Defaults</th> <th width="100%">Comments</th> </tr> <tr> <td colspan="2">  <b>add_read_token_role_on_create</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>no</li> <li>yes</li> </ul> </td> <td> <div>Enable/disable whether new users can read any stored tokens. This assigns the <code>broker.read-token</code> role.</div> <div>
<br>aliases: addReadTokenRoleOnCreate</div> </td> </tr> <tr> <td colspan="2">  <b>alias</b>  <div> <span>string</span> / <span>required</span> </div> </td> <td> </td> <td> <div>The alias uniquely identifies an identity provider and it is also used to build the redirect URI.</div> </td> </tr> <tr> <td colspan="2">  <b>auth_client_id</b>  <div> <span>string</span> </div> </td> <td> <b>Default:</b><br><div>"admin-cli"</div> </td> <td> <div>OpenID Connect <em>client_id</em> to authenticate to the API with.</div> </td> </tr> <tr> <td colspan="2">  <b>auth_client_secret</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Client Secret to use in conjunction with <em>auth_client_id</em> (if required).</div> </td> </tr> <tr> <td colspan="2">  <b>auth_keycloak_url</b>  <div> <span>string</span> / <span>required</span> </div> </td> <td> </td> <td> <div>URL to the Keycloak instance.</div> <div>
<br>aliases: url</div> </td> </tr> <tr> <td colspan="2">  <b>auth_password</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Password to authenticate for API access with.</div> <div>
<br>aliases: password</div> </td> </tr> <tr> <td colspan="2">  <b>auth_realm</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Keycloak realm name to authenticate to for API access.</div> </td> </tr> <tr> <td colspan="2">  <b>auth_username</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Username to authenticate for API access with.</div> <div>
<br>aliases: username</div> </td> </tr> <tr> <td colspan="2">  <b>authenticate_by_default</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>no</li> <li>yes</li> </ul> </td> <td> <div>Specifies if this identity provider should be used by default for authentication even before displaying login screen.</div> <div>
<br>aliases: authenticateByDefault</div> </td> </tr> <tr> <td colspan="2">  <b>config</b>  <div> <span>dictionary</span> </div> </td> <td> </td> <td> <div>Dict specifying the configuration options for the provider; the contents differ depending on the value of <em>providerId</em>. Examples are given below for <code>oidc</code> and <code>saml</code>. It is easiest to obtain valid config values by dumping an already-existing identity provider configuration through check-mode in the <em>existing</em> field.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>authorizationUrl</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The Authorization URL.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>backchannelSupported</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Does the external IDP support backchannel logout?</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>clientAuthMethod</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The client authentication method.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>clientId</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The client or client identifier registered within the identity provider.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>clientSecret</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The client or client secret registered within the identity provider.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>defaultScope</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The scopes to be sent when asking for authorization.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>entityId</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The Entity ID that will be used to uniquely identify this SAML Service Provider.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>gui_order</b>  <div> <span>integer</span> </div> </td> <td> </td> <td> <div>Number defining order of the provider in GUI (for example, on Login page).</div> <div>
<br>aliases: guiOrder</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>hide_on_login_page</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>no</li> <li>yes</li> </ul> </td> <td> <div>If hidden, login with this provider is possible only if requested explicitly, for example using the <code>kc_idp_hint</code> parameter.</div> <div>
<br>aliases: hideOnLoginPage</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>issuer</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The issuer identifier for the issuer of the response. If not provided, no validation will be performed.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>jwksUrl</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>URL where identity provider keys in JWK format are stored. See JWK specification for more details.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>logoutUrl</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>End session endpoint to use to logout user from external IDP.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>nameIDPolicyFormat</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Specifies the URI reference corresponding to a name identifier format.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>principalType</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Way to identify and track external users from the assertion.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>singleLogoutServiceUrl</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The URL that must be used to send logout requests.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>singleSignOnServiceUrl</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The URL that must be used to send authentication requests (SAML AuthnRequest).</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>sync_mode</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Default sync mode for all mappers. The sync mode determines when user data will be synced using the mappers.</div> <div>
<br>aliases: syncMode</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>tokenUrl</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The Token URL.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>useJwksUrl</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>no</li> <li>yes</li> </ul> </td> <td> <div>If the switch is on, identity provider public keys will be downloaded from given JWKS URL.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>userInfoUrl</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The User Info URL.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>validateSignature</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>no</li> <li>yes</li> </ul> </td> <td> <div>Enable/disable signature validation of external IDP signatures.</div> </td> </tr> <tr> <td colspan="2">  <b>display_name</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Friendly name for identity provider.</div> <div>
<br>aliases: displayName</div> </td> </tr> <tr> <td colspan="2">  <b>enabled</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>no</li> <li>yes</li> </ul> </td> <td> <div>Enable/disable this identity provider.</div> </td> </tr> <tr> <td colspan="2">  <b>first_broker_login_flow_alias</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Alias of authentication flow, which is triggered after first login with this identity provider.</div> <div>
<br>aliases: firstBrokerLoginFlowAlias</div> </td> </tr> <tr> <td colspan="2">  <b>link_only</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>no</li> <li>yes</li> </ul> </td> <td> <div>If true, users cannot log in through this provider. They can only link to this provider. This is useful if you don't want to allow login from the provider, but want to integrate with a provider.</div> <div>
<br>aliases: linkOnly</div> </td> </tr> <tr> <td colspan="2">  <b>mappers</b>  <div> <span>list</span> / <span>elements=dictionary</span> </div> </td> <td> </td> <td> <div>A list of dicts defining mappers associated with this Identity Provider.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>config</b>  <div> <span>dictionary</span> </div> </td> <td> </td> <td> <div>Dict specifying the configuration options for the mapper; the contents differ depending on the value of <em>identityProviderMapper</em>.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>id</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Unique ID of this mapper.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>identityProviderAlias</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Alias of the identity provider for this mapper.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>identityProviderMapper</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Type of mapper.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>name</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Name of the mapper.</div> </td> </tr> <tr> <td colspan="2">  <b>post_broker_login_flow_alias</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Alias of authentication flow, which is triggered after each login with this identity provider.</div> <div>
<br>aliases: postBrokerLoginFlowAlias</div> </td> </tr> <tr> <td colspan="2">  <b>provider_id</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Protocol used by this provider (supported values are <code>oidc</code> or <code>saml</code>).</div> <div>
<br>aliases: providerId</div> </td> </tr> <tr> <td colspan="2">  <b>realm</b>  <div> <span>string</span> </div> </td> <td> <b>Default:</b><br><div>"master"</div> </td> <td> <div>The Keycloak realm under which this identity provider resides.</div> </td> </tr> <tr> <td colspan="2">  <b>state</b>  <div> <span>string</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>present</b> ←</div></li> <li>absent</li> </ul> </td> <td> <div>State of the identity provider.</div> <div>On <code>present</code>, the identity provider will be created if it does not yet exist, or updated with the parameters you provide.</div> <div>On <code>absent</code>, the identity provider will be removed if it exists.</div> </td> </tr> <tr> <td colspan="2">  <b>store_token</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>no</li> <li>yes</li> </ul> </td> <td> <div>Enable/disable whether tokens must be stored after authenticating users.</div> <div>
<br>aliases: storeToken</div> </td> </tr> <tr> <td colspan="2">  <b>token</b>  <div> <span>string</span> </div> <div> added in 3.0.0 of community.general </div> </td> <td> </td> <td> <div>Authentication token for Keycloak API.</div> </td> </tr> <tr> <td colspan="2">  <b>trust_email</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>no</li> <li>yes</li> </ul> </td> <td> <div>If enabled, email provided by this provider is not verified even if verification is enabled for the realm.</div> <div>
<br>aliases: trustEmail</div> </td> </tr> <tr> <td colspan="2">  <b>validate_certs</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>no</li> <li><div>
<b>yes</b> ←</div></li> </ul> </td> <td> <div>Verify TLS certificates (do not disable this in production).</div> </td> </tr> </table> <br>  <h2 id="examples">Examples</h2> <pre data-language="yaml+jinja">- name: Create OIDC identity provider, authentication with credentials
  community.general.keycloak_identity_provider:
    state: present
    auth_keycloak_url: https://auth.example.com/auth
    auth_realm: master
    auth_username: admin
    auth_password: admin
    realm: myrealm
    alias: oidc-idp
    display_name: OpenID Connect IdP
    enabled: true
    provider_id: oidc
    config:
      issuer: https://idp.example.com
      authorizationUrl: https://idp.example.com/auth
      tokenUrl: https://idp.example.com/token
      userInfoUrl: https://idp.example.com/userinfo
      clientAuthMethod: client_secret_post
      clientId: my-client
      clientSecret: secret
      syncMode: FORCE
    mappers:
      - name: first_name
        identityProviderMapper: oidc-user-attribute-idp-mapper
        config:
          claim: first_name
          user.attribute: first_name
          syncMode: INHERIT
      - name: last_name
        identityProviderMapper: oidc-user-attribute-idp-mapper
        config:
          claim: last_name
          user.attribute: last_name
          syncMode: INHERIT

- name: Create SAML identity provider, authentication with credentials
  community.general.keycloak_identity_provider:
    state: present
    auth_keycloak_url: https://auth.example.com/auth
    auth_realm: master
    auth_username: admin
    auth_password: admin
    realm: myrealm
    alias: saml-idp
    display_name: SAML IdP
    enabled: true
    provider_id: saml
    config:
      entityId: https://auth.example.com/auth/realms/myrealm
      singleSignOnServiceUrl: https://idp.example.com/login
      wantAuthnRequestsSigned: true
      wantAssertionsSigned: true
    mappers:
      - name: roles
        identityProviderMapper: saml-user-attribute-idp-mapper
        config:
          user.attribute: roles
          attribute.friendly.name: User Roles
          attribute.name: roles
          syncMode: INHERIT
</pre>   <h2 id="return-values">Return Values</h2> <p>Common return values are documented <a class="reference internal" href="../../../reference_appendices/common_return_values.html#common-return-values"><span class="std std-ref">here</span></a>, the following are the fields unique to this module:</p> <table class="documentation-table"> <tr> <th colspan="1">Key</th> <th>Returned</th> <th width="100%">Description</th> </tr> <tr> <td colspan="1">  <b>end_state</b>  <div> <span>dictionary</span> </div> </td> <td>always</td> <td> <div>Representation of identity provider after module execution</div> <br> <div><b>Sample:</b></div> <div>{'addReadTokenRoleOnCreate': False, 'alias': 'my-idp', 'authenticateByDefault': False, 'config': {'authorizationUrl': 'https://idp.example.com/auth', 'clientAuthMethod': 'client_secret_post', 'clientId': 'my-client', 'clientSecret': '**********', 'issuer': 'https://idp.example.com', 'tokenUrl': 'https://idp.example.com/token', 'userInfoUrl': 'https://idp.example.com/userinfo'}, 'displayName': 'OpenID Connect IdP', 'enabled': True, 'firstBrokerLoginFlowAlias': 'first broker login', 'internalId': '4d28d7e3-1b80-45bb-8a30-5822bf55aa1c', 'linkOnly': False, 'providerId': 'oidc', 'storeToken': False, 'trustEmail': False}</div> </td> </tr> <tr> <td colspan="1">  <b>existing</b>  <div> <span>dictionary</span> </div> </td> <td>always</td> <td> <div>Representation of existing identity provider</div> <br> <div><b>Sample:</b></div> <div>{'addReadTokenRoleOnCreate': False, 'alias': 'my-idp', 'authenticateByDefault': False, 'config': {'authorizationUrl': 'https://old.example.com/auth', 'clientAuthMethod': 'client_secret_post', 'clientId': 'my-client', 'clientSecret': '**********', 'issuer': 'https://old.example.com', 'syncMode': 'FORCE', 'tokenUrl': 'https://old.example.com/token', 'userInfoUrl': 'https://old.example.com/userinfo'}, 'displayName': 'OpenID Connect IdP', 'enabled': True, 'firstBrokerLoginFlowAlias': 'first broker login', 'internalId': '4d28d7e3-1b80-45bb-8a30-5822bf55aa1c', 'linkOnly': False, 'providerId': 'oidc', 'storeToken': False, 'trustEmail': False}</div> </td> </tr> <tr> <td colspan="1">  <b>msg</b>  <div> <span>string</span> </div> </td> <td>always</td> <td> <div>Message as to what action was taken</div> <br> <div><b>Sample:</b></div> <div>Identity provider my-idp has been created</div> </td> </tr> <tr> <td colspan="1">  <b>proposed</b>  <div> <span>dictionary</span> </div> </td> <td>always</td> <td> <div>Representation of proposed changes to identity provider</div> <br> <div><b>Sample:</b></div> <div>{'config': {'authorizationUrl': 'https://idp.example.com/auth', 'clientAuthMethod': 'client_secret_post', 'clientId': 'my-client', 'clientSecret': 'secret', 'issuer': 'https://idp.example.com', 'tokenUrl': 'https://idp.example.com/token', 'userInfoUrl': 'https://idp.example.com/userinfo'}, 'displayName': 'OpenID Connect IdP', 'providerId': 'oidc'}</div> </td> </tr> </table> <br><br> <h3 id="authors">Authors</h3> <ul class="simple"> <li>Laurent Paumier (@laurpaum)</li> </ul><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2012&ndash;2018 Michael DeHaan<br>&copy; 2018&ndash;2021 Red Hat, Inc.<br>Licensed under the GNU General Public License version 3.<br>
    <a href="https://docs.ansible.com/ansible/latest/collections/community/general/keycloak_identity_provider_module.html" class="_attribution-link">https://docs.ansible.com/ansible/latest/collections/community/general/keycloak_identity_provider_module.html</a>
  </p>
</div>
