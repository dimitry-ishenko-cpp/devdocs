<h1 id="community-general-ldap-attrs-add-or-remove-multiple-ldap-attribute-values">community.general.ldap_attrs – Add or remove multiple LDAP attribute values</h1> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This plugin is part of the <a class="reference external" href="https://galaxy.ansible.com/community/general">community.general collection</a> (version 3.8.1).</p> <p>You might already have this collection installed if you are using the <code>ansible</code> package. It is not included in <code>ansible-core</code>. To check whether it is installed, run <code>ansible-galaxy collection list</code>.</p> <p>To install it, use: <code>ansible-galaxy collection install community.general</code>.</p> <p>To use it in a playbook, specify: <code>community.general.ldap_attrs</code>.</p> </div> <div class="versionadded"> <p><span class="versionmodified added">New in version 0.2.0: </span>of community.general</p> </div>  <ul class="simple"> <li><a class="reference internal" href="#synopsis" id="id1">Synopsis</a></li> <li><a class="reference internal" href="#requirements" id="id2">Requirements</a></li> <li><a class="reference internal" href="#parameters" id="id3">Parameters</a></li> <li><a class="reference internal" href="#notes" id="id4">Notes</a></li> <li><a class="reference internal" href="#examples" id="id5">Examples</a></li> <li><a class="reference internal" href="#return-values" id="id6">Return Values</a></li> </ul>   <h2 id="synopsis">Synopsis</h2> <ul class="simple"> <li>Add or remove multiple LDAP attribute values.</li> </ul>   <h2 id="requirements">Requirements</h2> <p>The below requirements are needed on the host that executes this module.</p> <ul class="simple"> <li>python-ldap</li> </ul>   <h2 id="parameters">Parameters</h2> <table class="documentation-table"> <tr> <th colspan="1">Parameter</th> <th>Choices/Defaults</th> <th width="100%">Comments</th> </tr> <tr> <td colspan="1">  <b>attributes</b>  <div> <span>dictionary</span> / <span>required</span> </div> </td> <td> </td> <td> <div>The attribute(s) and value(s) to add or remove. The complex argument format is required in order to pass a list of strings (see examples).</div> </td> </tr> <tr> <td colspan="1">  <b>bind_dn</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>A DN to bind with. If this is omitted, we'll try a SASL bind with the EXTERNAL mechanism as default.</div> <div>If this is blank, we'll use an anonymous bind.</div> </td> </tr> <tr> <td colspan="1">  <b>bind_pw</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The password to use with <em>bind_dn</em>.</div> </td> </tr> <tr> <td colspan="1">  <b>dn</b>  <div> <span>string</span> / <span>required</span> </div> </td> <td> </td> <td> <div>The DN of the entry to add or remove.</div> </td> </tr> <tr> <td colspan="1">  <b>ordered</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>If <code>yes</code>, prepend list values with X-ORDERED index numbers in all attributes specified in the current task. This is useful mostly with <em>olcAccess</em> attribute to easily manage LDAP Access Control Lists.</div> </td> </tr> <tr> <td colspan="1">  <b>referrals_chasing</b>  <div> <span>string</span> </div> <div> added in 2.0.0 of community.general </div> </td> <td> <ul>
<b>Choices:</b> <li>disabled</li> <li><div>
<b>anonymous</b> ←</div></li> </ul> </td> <td> <div>Set the referrals chasing behavior.</div> <div>
<code>anonymous</code> follow referrals anonymously. This is the default behavior.</div> <div>
<code>disabled</code> disable referrals chasing. This sets <code>OPT_REFERRALS</code> to off.</div> </td> </tr> <tr> <td colspan="1">  <b>sasl_class</b>  <div> <span>string</span> </div> <div> added in 2.0.0 of community.general </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>external</b> ←</div></li> <li>gssapi</li> </ul> </td> <td> <div>The class to use for SASL authentication.</div> <div>possible choices are <code>external</code>, <code>gssapi</code>.</div> </td> </tr> <tr> <td colspan="1">  <b>server_uri</b>  <div> <span>string</span> </div> </td> <td> <b>Default:</b><br><div>"ldapi:///"</div> </td> <td> <div>A URI to the LDAP server.</div> <div>The default value lets the underlying LDAP client library look for a UNIX domain socket in its default location.</div> </td> </tr> <tr> <td colspan="1">  <b>start_tls</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>If true, we'll use the START_TLS LDAP extension.</div> </td> </tr> <tr> <td colspan="1">  <b>state</b>  <div> <span>string</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>present</b> ←</div></li> <li>absent</li> <li>exact</li> </ul> </td> <td> <div>The state of the attribute values. If <code>present</code>, all given attribute values will be added if they're missing. If <code>absent</code>, all given attribute values will be removed if present. If <code>exact</code>, the set of attribute values will be forced to exactly those provided and no others. If <em>state=exact</em> and the attribute <em>value</em> is empty, all values for this attribute will be removed.</div> </td> </tr> <tr> <td colspan="1">  <b>validate_certs</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>no</li> <li><div>
<b>yes</b> ←</div></li> </ul> </td> <td> <div>If set to <code>no</code>, SSL certificates will not be validated.</div> <div>This should only be used on sites using self-signed certificates.</div> </td> </tr> </table> <br>  <h2 id="notes">Notes</h2> <div class="admonition note"> <p class="admonition-title">Note</p> <ul class="simple"> <li>This only deals with attributes on existing entries. To add or remove whole entries, see <a class="reference internal" href="ldap_entry_module.html#ansible-collections-community-general-ldap-entry-module"><span class="std std-ref">community.general.ldap_entry</span></a>.</li> <li>The default authentication settings will attempt to use a SASL EXTERNAL bind over a UNIX domain socket. This works well with the default Ubuntu install for example, which includes a cn=peercred,cn=external,cn=auth ACL rule allowing root to modify the server configuration. If you need to use a simple bind to access your server, pass the credentials in <em>bind_dn</em> and <em>bind_pw</em>.</li> <li>For <em>state=present</em> and <em>state=absent</em>, all value comparisons are performed on the server for maximum accuracy. For <em>state=exact</em>, values have to be compared in Python, which obviously ignores LDAP matching rules. This should work out in most cases, but it is theoretically possible to see spurious changes when target and actual values are semantically identical but lexically distinct.</li> </ul> </div>   <h2 id="examples">Examples</h2> <pre data-language="yaml+jinja">- name: Configure directory number 1 for example.com
  community.general.ldap_attrs:
    dn: olcDatabase={1}hdb,cn=config
    attributes:
        olcSuffix: dc=example,dc=com
    state: exact

# The complex argument format is required here to pass a list of ACL strings.
- name: Set up the ACL
  community.general.ldap_attrs:
    dn: olcDatabase={1}hdb,cn=config
    attributes:
        olcAccess:
          - &gt;-
            {0}to attrs=userPassword,shadowLastChange
            by self write
            by anonymous auth
            by dn="cn=admin,dc=example,dc=com" write
            by * none'
          - &gt;-
            {1}to dn.base="dc=example,dc=com"
            by dn="cn=admin,dc=example,dc=com" write
            by * read
    state: exact

# An alternative approach with automatic X-ORDERED numbering
- name: Set up the ACL
  community.general.ldap_attrs:
    dn: olcDatabase={1}hdb,cn=config
    attributes:
        olcAccess:
          - &gt;-
            to attrs=userPassword,shadowLastChange
            by self write
            by anonymous auth
            by dn="cn=admin,dc=example,dc=com" write
            by * none'
          - &gt;-
            to dn.base="dc=example,dc=com"
            by dn="cn=admin,dc=example,dc=com" write
            by * read
    ordered: yes
    state: exact

- name: Declare some indexes
  community.general.ldap_attrs:
    dn: olcDatabase={1}hdb,cn=config
    attributes:
        olcDbIndex:
            - objectClass eq
            - uid eq

- name: Set up a root user, which we can use later to bootstrap the directory
  community.general.ldap_attrs:
    dn: olcDatabase={1}hdb,cn=config
    attributes:
        olcRootDN: cn=root,dc=example,dc=com
        olcRootPW: "{SSHA}tabyipcHzhwESzRaGA7oQ/SDoBZQOGND"
    state: exact

- name: Remove an attribute with a specific value
  community.general.ldap_attrs:
    dn: uid=jdoe,ou=people,dc=example,dc=com
    attributes:
        description: "An example user account"
    state: absent
    server_uri: ldap://localhost/
    bind_dn: cn=admin,dc=example,dc=com
    bind_pw: password

- name: Remove specified attribute(s) from an entry
  community.general.ldap_attrs:
    dn: uid=jdoe,ou=people,dc=example,dc=com
    attributes:
        description: []
    state: exact
    server_uri: ldap://localhost/
    bind_dn: cn=admin,dc=example,dc=com
    bind_pw: password
</pre>   <h2 id="return-values">Return Values</h2> <p>Common return values are documented <a class="reference internal" href="../../../reference_appendices/common_return_values.html#common-return-values"><span class="std std-ref">here</span></a>, the following are the fields unique to this module:</p> <table class="documentation-table"> <tr> <th colspan="1">Key</th> <th>Returned</th> <th width="100%">Description</th> </tr> <tr> <td colspan="1">  <b>modlist</b>  <div> <span>list</span> / <span>elements=string</span> </div> </td> <td>success</td> <td> <div>list of modified parameters</div> <br> <div><b>Sample:</b></div> <div>[[2, "olcRootDN", ["cn=root,dc=example,dc=com"]]]</div> </td> </tr> </table> <br><br> <h3 id="authors">Authors</h3> <ul class="simple"> <li>Jiri Tyr (@jtyr)</li> <li>Alexander Korinek (@noles)</li> <li>Maciej Delmanowski (@drybjed)</li> </ul><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2012&ndash;2018 Michael DeHaan<br>&copy; 2018&ndash;2021 Red Hat, Inc.<br>Licensed under the GNU General Public License version 3.<br>
    <a href="https://docs.ansible.com/ansible/latest/collections/community/general/ldap_attrs_module.html" class="_attribution-link">https://docs.ansible.com/ansible/latest/collections/community/general/ldap_attrs_module.html</a>
  </p>
</div>
