<h1 id="community-general-proxmox-management-of-instances-in-proxmox-ve-cluster">community.general.proxmox – management of instances in Proxmox VE cluster</h1> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This plugin is part of the <a class="reference external" href="https://galaxy.ansible.com/community/general">community.general collection</a> (version 3.8.1).</p> <p>You might already have this collection installed if you are using the <code>ansible</code> package. It is not included in <code>ansible-core</code>. To check whether it is installed, run <code>ansible-galaxy collection list</code>.</p> <p>To install it, use: <code>ansible-galaxy collection install community.general</code>.</p> <p>To use it in a playbook, specify: <code>community.general.proxmox</code>.</p> </div>  <ul class="simple"> <li><a class="reference internal" href="#synopsis" id="id1">Synopsis</a></li> <li><a class="reference internal" href="#requirements" id="id2">Requirements</a></li> <li><a class="reference internal" href="#parameters" id="id3">Parameters</a></li> <li><a class="reference internal" href="#examples" id="id4">Examples</a></li> </ul>   <h2 id="synopsis">Synopsis</h2> <ul class="simple"> <li>allows you to create/delete/stop instances in Proxmox VE cluster</li> <li>Starting in Ansible 2.1, it automatically detects containerization type (lxc for PVE 4, openvz for older)</li> <li>From community.general 4.0.0 on, there will be no default values, see <em>proxmox_default_behavior</em>.</li> </ul>   <h2 id="requirements">Requirements</h2> <p>The below requirements are needed on the host that executes this module.</p> <ul class="simple"> <li>proxmoxer</li> <li>requests</li> </ul>   <h2 id="parameters">Parameters</h2> <table class="documentation-table"> <tr> <th colspan="1">Parameter</th> <th>Choices/Defaults</th> <th width="100%">Comments</th> </tr> <tr> <td colspan="1">  <b>api_host</b>  <div> <span>string</span> / <span>required</span> </div> </td> <td> </td> <td> <div>Specify the target host of the Proxmox VE cluster.</div> </td> </tr> <tr> <td colspan="1">  <b>api_password</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Specify the password to authenticate with.</div> <div>You can use <code>PROXMOX_PASSWORD</code> environment variable.</div> </td> </tr> <tr> <td colspan="1">  <b>api_token_id</b>  <div> <span>string</span> </div> <div> added in 1.3.0 of community.general </div> </td> <td> </td> <td> <div>Specify the token ID.</div> </td> </tr> <tr> <td colspan="1">  <b>api_token_secret</b>  <div> <span>string</span> </div> <div> added in 1.3.0 of community.general </div> </td> <td> </td> <td> <div>Specify the token secret.</div> </td> </tr> <tr> <td colspan="1">  <b>api_user</b>  <div> <span>string</span> / <span>required</span> </div> </td> <td> </td> <td> <div>Specify the user to authenticate with.</div> </td> </tr> <tr> <td colspan="1">  <b>cores</b>  <div> <span>integer</span> </div> </td> <td> </td> <td> <div>Specify number of cores per socket.</div> <div>If <em>proxmox_default_behavior</em> is set to <code>compatiblity</code> (the default value), this option has a default of <code>1</code>. Note that the default value of <em>proxmox_default_behavior</em> changes in community.general 4.0.0.</div> </td> </tr> <tr> <td colspan="1">  <b>cpus</b>  <div> <span>integer</span> </div> </td> <td> </td> <td> <div>numbers of allocated cpus for instance</div> <div>If <em>proxmox_default_behavior</em> is set to <code>compatiblity</code> (the default value), this option has a default of <code>1</code>. Note that the default value of <em>proxmox_default_behavior</em> changes in community.general 4.0.0.</div> </td> </tr> <tr> <td colspan="1">  <b>cpuunits</b>  <div> <span>integer</span> </div> </td> <td> </td> <td> <div>CPU weight for a VM</div> <div>If <em>proxmox_default_behavior</em> is set to <code>compatiblity</code> (the default value), this option has a default of <code>1000</code>. Note that the default value of <em>proxmox_default_behavior</em> changes in community.general 4.0.0.</div> </td> </tr> <tr> <td colspan="1">  <b>description</b>  <div> <span>string</span> </div> <div> added in 0.2.0 of community.general </div> </td> <td> </td> <td> <div>Specify the description for the container. Only used on the configuration web interface.</div> <div>This is saved as a comment inside the configuration file.</div> </td> </tr> <tr> <td colspan="1">  <b>disk</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>This option was previously described as "hard disk size in GB for instance" however several formats describing a lxc mount are permitted.</div> <div>Older versions of Proxmox will accept a numeric value for size using the <em>storage</em> parameter to automatically choose which storage to allocate from, however new versions enforce the <code>&lt;STORAGE&gt;:&lt;SIZE&gt;</code> syntax.</div> <div>Additional options are available by using some combination of the following key-value pairs as a comma-delimited list <code>[volume=]&lt;volume&gt; [,acl=&lt;1|0&gt;] [,mountoptions=&lt;opt[;opt...]&gt;] [,quota=&lt;1|0&gt;] [,replicate=&lt;1|0&gt;] [,ro=&lt;1|0&gt;] [,shared=&lt;1|0&gt;] [,size=&lt;DiskSize&gt;]</code>.</div> <div>See <a href="https://pve.proxmox.com/wiki/Linux_Container">https://pve.proxmox.com/wiki/Linux_Container</a> for a full description.</div> <div>If <em>proxmox_default_behavior</em> is set to <code>compatiblity</code> (the default value), this option has a default of <code>3</code>. Note that the default value of <em>proxmox_default_behavior</em> changes in community.general 4.0.0.</div> </td> </tr> <tr> <td colspan="1">  <b>features</b>  <div> <span>list</span> / <span>elements=string</span> </div> <div> added in 2.0.0 of community.general </div> </td> <td> </td> <td> <div>Specifies a list of features to be enabled. For valid options, see <a href="https://pve.proxmox.com/wiki/Linux_Container#pct_options">https://pve.proxmox.com/wiki/Linux_Container#pct_options</a>.</div> <div>Some features require the use of a privileged container.</div> </td> </tr> <tr> <td colspan="1">  <b>force</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>forcing operations</div> <div>can be used only with states <code>present</code>, <code>stopped</code>, <code>restarted</code>
</div> <div>with <code>state=present</code> force option allow to overwrite existing container</div> <div>with states <code>stopped</code> , <code>restarted</code> allow to force stop instance</div> </td> </tr> <tr> <td colspan="1">  <b>hookscript</b>  <div> <span>string</span> </div> <div> added in 0.2.0 of community.general </div> </td> <td> </td> <td> <div>Script that will be executed during various steps in the containers lifetime.</div> </td> </tr> <tr> <td colspan="1">  <b>hostname</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>the instance hostname</div> <div>required only for <code>state=present</code>
</div> <div>must be unique if vmid is not passed</div> </td> </tr> <tr> <td colspan="1">  <b>ip_address</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>specifies the address the container will be assigned</div> </td> </tr> <tr> <td colspan="1">  <b>memory</b>  <div> <span>integer</span> </div> </td> <td> </td> <td> <div>memory size in MB for instance</div> <div>If <em>proxmox_default_behavior</em> is set to <code>compatiblity</code> (the default value), this option has a default of <code>512</code>. Note that the default value of <em>proxmox_default_behavior</em> changes in community.general 4.0.0.</div> </td> </tr> <tr> <td colspan="1">  <b>mounts</b>  <div> <span>dictionary</span> </div> </td> <td> </td> <td> <div>specifies additional mounts (separate disks) for the container. As a hash/dictionary defining mount points</div> </td> </tr> <tr> <td colspan="1">  <b>nameserver</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>sets DNS server IP address for a container</div> </td> </tr> <tr> <td colspan="1">  <b>netif</b>  <div> <span>dictionary</span> </div> </td> <td> </td> <td> <div>specifies network interfaces for the container. As a hash/dictionary defining interfaces.</div> </td> </tr> <tr> <td colspan="1">  <b>node</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Proxmox VE node on which to operate.</div> <div>Only required for <em>state=present</em>.</div> <div>For every other states it will be autodiscovered.</div> </td> </tr> <tr> <td colspan="1">  <b>onboot</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>no</li> <li>yes</li> </ul> </td> <td> <div>specifies whether a VM will be started during system bootup</div> <div>If <em>proxmox_default_behavior</em> is set to <code>compatiblity</code> (the default value), this option has a default of <code>no</code>. Note that the default value of <em>proxmox_default_behavior</em> changes in community.general 4.0.0.</div> </td> </tr> <tr> <td colspan="1">  <b>ostemplate</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>the template for VM creating</div> <div>required only for <code>state=present</code>
</div> </td> </tr> <tr> <td colspan="1">  <b>password</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>the instance root password</div> </td> </tr> <tr> <td colspan="1">  <b>pool</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Add the new VM to the specified pool.</div> </td> </tr> <tr> <td colspan="1">  <b>proxmox_default_behavior</b>  <div> <span>string</span> </div> <div> added in 1.3.0 of community.general </div> </td> <td> <ul>
<b>Choices:</b> <li>compatibility</li> <li>no_defaults</li> </ul> </td> <td> <div>Various module options used to have default values. This cause problems when user expects different behavior from proxmox by default or fill options which cause problems when they have been set.</div> <div>The default value is <code>compatibility</code>, which will ensure that the default values are used when the values are not explicitly specified by the user.</div> <div>From community.general 4.0.0 on, the default value will switch to <code>no_defaults</code>. To avoid deprecation warnings, please set <em>proxmox_default_behavior</em> to an explicit value.</div> <div>This affects the <em>disk</em>, <em>cores</em>, <em>cpus</em>, <em>memory</em>, <em>onboot</em>, <em>swap</em>, <em>cpuunits</em> options.</div> </td> </tr> <tr> <td colspan="1">  <b>pubkey</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Public key to add to /root/.ssh/authorized_keys. This was added on Proxmox 4.2, it is ignored for earlier versions</div> </td> </tr> <tr> <td colspan="1">  <b>purge</b>  <div> <span>boolean</span> </div> <div> added in 2.3.0 of community.general </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Remove container from all related configurations.</div> <div>For example backup jobs, replication jobs, or HA.</div> <div>Related ACLs and Firewall entries will always be removed.</div> <div>Used with state <code>absent</code>.</div> </td> </tr> <tr> <td colspan="1">  <b>searchdomain</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>sets DNS search domain for a container</div> </td> </tr> <tr> <td colspan="1">  <b>state</b>  <div> <span>string</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>present</b> ←</div></li> <li>started</li> <li>absent</li> <li>stopped</li> <li>restarted</li> </ul> </td> <td> <div>Indicate desired state of the instance</div> </td> </tr> <tr> <td colspan="1">  <b>storage</b>  <div> <span>string</span> </div> </td> <td> <b>Default:</b><br><div>"local"</div> </td> <td> <div>target storage</div> </td> </tr> <tr> <td colspan="1">  <b>swap</b>  <div> <span>integer</span> </div> </td> <td> </td> <td> <div>swap memory size in MB for instance</div> <div>If <em>proxmox_default_behavior</em> is set to <code>compatiblity</code> (the default value), this option has a default of <code>0</code>. Note that the default value of <em>proxmox_default_behavior</em> changes in community.general 4.0.0.</div> </td> </tr> <tr> <td colspan="1">  <b>timeout</b>  <div> <span>integer</span> </div> </td> <td> <b>Default:</b><br><div>30</div> </td> <td> <div>timeout for operations</div> </td> </tr> <tr> <td colspan="1">  <b>unprivileged</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Indicate if the container should be unprivileged</div> </td> </tr> <tr> <td colspan="1">  <b>validate_certs</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>If <code>no</code>, SSL certificates will not be validated.</div> <div>This should only be used on personally controlled sites using self-signed certificates.</div> </td> </tr> <tr> <td colspan="1">  <b>vmid</b>  <div> <span>integer</span> </div> </td> <td> </td> <td> <div>Specifies the instance ID.</div> <div>If not set the next available ID will be fetched from ProxmoxAPI.</div> </td> </tr> </table> <br>  <h2 id="examples">Examples</h2> <pre data-language="yaml+jinja">- name: Create new container with minimal options
  community.general.proxmox:
    vmid: 100
    node: uk-mc02
    api_user: root@pam
    api_password: 1q2w3e
    api_host: node1
    password: 123456
    hostname: example.org
    ostemplate: 'local:vztmpl/ubuntu-14.04-x86_64.tar.gz'

- name: Create new container with hookscript and description
  community.general.proxmox:
    vmid: 100
    node: uk-mc02
    api_user: root@pam
    api_password: 1q2w3e
    api_host: node1
    password: 123456
    hostname: example.org
    ostemplate: 'local:vztmpl/ubuntu-14.04-x86_64.tar.gz'
    hookscript: 'local:snippets/vm_hook.sh'
    description: created with ansible

- name: Create new container automatically selecting the next available vmid.
  community.general.proxmox:
    node: 'uk-mc02'
    api_user: 'root@pam'
    api_password: '1q2w3e'
    api_host: 'node1'
    password: '123456'
    hostname: 'example.org'
    ostemplate: 'local:vztmpl/ubuntu-14.04-x86_64.tar.gz'

- name: Create new container with minimal options with force(it will rewrite existing container)
  community.general.proxmox:
    vmid: 100
    node: uk-mc02
    api_user: root@pam
    api_password: 1q2w3e
    api_host: node1
    password: 123456
    hostname: example.org
    ostemplate: 'local:vztmpl/ubuntu-14.04-x86_64.tar.gz'
    force: yes

- name: Create new container with minimal options use environment PROXMOX_PASSWORD variable(you should export it before)
  community.general.proxmox:
    vmid: 100
    node: uk-mc02
    api_user: root@pam
    api_host: node1
    password: 123456
    hostname: example.org
    ostemplate: 'local:vztmpl/ubuntu-14.04-x86_64.tar.gz'

- name: Create new container with minimal options defining network interface with dhcp
  community.general.proxmox:
    vmid: 100
    node: uk-mc02
    api_user: root@pam
    api_password: 1q2w3e
    api_host: node1
    password: 123456
    hostname: example.org
    ostemplate: 'local:vztmpl/ubuntu-14.04-x86_64.tar.gz'
    netif: '{"net0":"name=eth0,ip=dhcp,ip6=dhcp,bridge=vmbr0"}'

- name: Create new container with minimal options defining network interface with static ip
  community.general.proxmox:
    vmid: 100
    node: uk-mc02
    api_user: root@pam
    api_password: 1q2w3e
    api_host: node1
    password: 123456
    hostname: example.org
    ostemplate: 'local:vztmpl/ubuntu-14.04-x86_64.tar.gz'
    netif: '{"net0":"name=eth0,gw=192.168.0.1,ip=192.168.0.2/24,bridge=vmbr0"}'

- name: Create new container with minimal options defining a mount with 8GB
  community.general.proxmox:
    vmid: 100
    node: uk-mc02
    api_user: root@pam
    api_password: 1q2w3e
    api_host: node1
    password: 123456
    hostname: example.org
    ostemplate: local:vztmpl/ubuntu-14.04-x86_64.tar.gz'
    mounts: '{"mp0":"local:8,mp=/mnt/test/"}'

- name: Create new container with minimal options defining a cpu core limit
  community.general.proxmox:
    vmid: 100
    node: uk-mc02
    api_user: root@pam
    api_password: 1q2w3e
    api_host: node1
    password: 123456
    hostname: example.org
    ostemplate: local:vztmpl/ubuntu-14.04-x86_64.tar.gz'
    cores: 2

- name: Create a new container with nesting enabled and allows the use of CIFS/NFS inside the container.
  community.general.proxmox:
    vmid: 100
    node: uk-mc02
    api_user: root@pam
    api_password: 1q2w3e
    api_host: node1
    password: 123456
    hostname: example.org
    ostemplate: local:vztmpl/ubuntu-14.04-x86_64.tar.gz'
    features:
     - nesting=1
     - mount=cifs,nfs


- name: Start container
  community.general.proxmox:
    vmid: 100
    api_user: root@pam
    api_password: 1q2w3e
    api_host: node1
    state: started

- name: &gt;
    Start container with mount. You should enter a 90-second timeout because servers
    with additional disks take longer to boot
  community.general.proxmox:
    vmid: 100
    api_user: root@pam
    api_password: 1q2w3e
    api_host: node1
    state: started
    timeout: 90

- name: Stop container
  community.general.proxmox:
    vmid: 100
    api_user: root@pam
    api_password: 1q2w3e
    api_host: node1
    state: stopped

- name: Stop container with force
  community.general.proxmox:
    vmid: 100
    api_user: root@pam
    api_password: 1q2w3e
    api_host: node1
    force: yes
    state: stopped

- name: Restart container(stopped or mounted container you can't restart)
  community.general.proxmox:
    vmid: 100
    api_user: root@pam
    api_password: 1q2w3e
    api_host: node1
    state: restarted

- name: Remove container
  community.general.proxmox:
    vmid: 100
    api_user: root@pam
    api_password: 1q2w3e
    api_host: node1
    state: absent
</pre>  <h3 id="authors">Authors</h3> <ul class="simple"> <li>Sergei Antipov (@UnderGreen)</li> </ul><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2012&ndash;2018 Michael DeHaan<br>&copy; 2018&ndash;2021 Red Hat, Inc.<br>Licensed under the GNU General Public License version 3.<br>
    <a href="https://docs.ansible.com/ansible/latest/collections/community/general/proxmox_module.html" class="_attribution-link">https://docs.ansible.com/ansible/latest/collections/community/general/proxmox_module.html</a>
  </p>
</div>
