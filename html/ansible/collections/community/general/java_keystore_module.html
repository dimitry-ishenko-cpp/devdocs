<h1 id="community-general-java-keystore-create-a-java-keystore-in-jks-format">community.general.java_keystore – Create a Java keystore in JKS format</h1> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This plugin is part of the <a class="reference external" href="https://galaxy.ansible.com/community/general">community.general collection</a> (version 3.8.1).</p> <p>You might already have this collection installed if you are using the <code>ansible</code> package. It is not included in <code>ansible-core</code>. To check whether it is installed, run <code>ansible-galaxy collection list</code>.</p> <p>To install it, use: <code>ansible-galaxy collection install community.general</code>.</p> <p>To use it in a playbook, specify: <code>community.general.java_keystore</code>.</p> </div>  <ul class="simple"> <li><a class="reference internal" href="#synopsis" id="id1">Synopsis</a></li> <li><a class="reference internal" href="#requirements" id="id2">Requirements</a></li> <li><a class="reference internal" href="#parameters" id="id3">Parameters</a></li> <li><a class="reference internal" href="#notes" id="id4">Notes</a></li> <li><a class="reference internal" href="#see-also" id="id5">See Also</a></li> <li><a class="reference internal" href="#examples" id="id6">Examples</a></li> <li><a class="reference internal" href="#return-values" id="id7">Return Values</a></li> </ul>   <h2 id="synopsis">Synopsis</h2> <ul class="simple"> <li>Bundle a x509 certificate and its private key into a Java Keystore in JKS format.</li> </ul>   <h2 id="requirements">Requirements</h2> <p>The below requirements are needed on the host that executes this module.</p> <ul class="simple"> <li>openssl in PATH (when <em>ssl_backend=openssl</em>)</li> <li>keytool in PATH</li> <li>cryptography &gt;= 3.0 (when <em>ssl_backend=cryptography</em>)</li> </ul>   <h2 id="parameters">Parameters</h2> <table class="documentation-table"> <tr> <th colspan="1">Parameter</th> <th>Choices/Defaults</th> <th width="100%">Comments</th> </tr> <tr> <td colspan="1">  <b>attributes</b>  <div> <span>string</span> </div> <div> added in 2.3 of ansible.builtin </div> </td> <td> </td> <td> <div>The attributes the resulting file or directory should have.</div> <div>To get supported flags look at the man page for <em>chattr</em> on the target system.</div> <div>This string should contain the attributes in the same order as the one displayed by <em>lsattr</em>.</div> <div>The <code>=</code> operator is assumed as default, otherwise <code>+</code> or <code>-</code> operators need to be included in the string.</div> <div>
<br>aliases: attr</div> </td> </tr> <tr> <td colspan="1">  <b>certificate</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Content of the certificate used to create the keystore.</div> <div>If the fingerprint of the provided certificate does not match the fingerprint of the certificate bundled in the keystore, the keystore is regenerated with the provided certificate.</div> <div>Exactly one of <em>certificate</em> or <em>certificate_path</em> is required.</div> </td> </tr> <tr> <td colspan="1">  <b>certificate_path</b>  <div> <span>path</span> </div> <div> added in 3.0.0 of community.general </div> </td> <td> </td> <td> <div>Location of the certificate used to create the keystore.</div> <div>If the fingerprint of the provided certificate does not match the fingerprint of the certificate bundled in the keystore, the keystore is regenerated with the provided certificate.</div> <div>Exactly one of <em>certificate</em> or <em>certificate_path</em> is required.</div> </td> </tr> <tr> <td colspan="1">  <b>dest</b>  <div> <span>path</span> / <span>required</span> </div> </td> <td> </td> <td> <div>Absolute path of the generated keystore.</div> </td> </tr> <tr> <td colspan="1">  <b>force</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Keystore is created even if it already exists.</div> </td> </tr> <tr> <td colspan="1">  <b>group</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Name of the group that should own jks file.</div> </td> </tr> <tr> <td colspan="1">  <b>keystore_type</b>  <div> <span>string</span> </div> <div> added in 3.3.0 of community.general </div> </td> <td> <ul>
<b>Choices:</b> <li>jks</li> <li>pkcs12</li> </ul> </td> <td> <div>Type of the Java keystore.</div> <div>When this option is omitted and the keystore doesn't already exist, the behavior follows <code>keytool</code>'s default store type which depends on Java version; <code>pkcs12</code> since Java 9 and <code>jks</code> prior (may also be <code>pkcs12</code> if new default has been backported to this version).</div> <div>When this option is omitted and the keystore already exists, the current type is left untouched, unless another option leads to overwrite the keystore (in that case, this option behaves like for keystore creation).</div> <div>When <em>keystore_type</em> is set, the keystore is created with this type if it doesn't already exist, or is overwritten to match the given type in case of mismatch.</div> </td> </tr> <tr> <td colspan="1">  <b>mode</b>  <div> <span>raw</span> </div> </td> <td> </td> <td> <div>Mode the file should be.</div> </td> </tr> <tr> <td colspan="1">  <b>name</b>  <div> <span>string</span> / <span>required</span> </div> </td> <td> </td> <td> <div>Name of the certificate in the keystore.</div> <div>If the provided name does not exist in the keystore, the module will re-create the keystore. This behavior changed in community.general 3.0.0, before that the module would fail when the name did not match.</div> </td> </tr> <tr> <td colspan="1">  <b>owner</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Name of the user that should own jks file.</div> </td> </tr> <tr> <td colspan="1">  <b>password</b>  <div> <span>string</span> / <span>required</span> </div> </td> <td> </td> <td> <div>Password that should be used to secure the keystore.</div> <div>If the provided password fails to unlock the keystore, the module will re-create the keystore with the new passphrase. This behavior changed in community.general 3.0.0, before that the module would fail when the password did not match.</div> </td> </tr> <tr> <td colspan="1">  <b>private_key</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Content of the private key used to create the keystore.</div> <div>Exactly one of <em>private_key</em> or <em>private_key_path</em> is required.</div> </td> </tr> <tr> <td colspan="1">  <b>private_key_passphrase</b>  <div> <span>string</span> </div> <div> added in 0.2.0 of community.general </div> </td> <td> </td> <td> <div>Passphrase used to read the private key, if required.</div> </td> </tr> <tr> <td colspan="1">  <b>private_key_path</b>  <div> <span>path</span> </div> <div> added in 3.0.0 of community.general </div> </td> <td> </td> <td> <div>Location of the private key used to create the keystore.</div> <div>Exactly one of <em>private_key</em> or <em>private_key_path</em> is required.</div> </td> </tr> <tr> <td colspan="1">  <b>selevel</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The level part of the SELinux file context.</div> <div>This is the MLS/MCS attribute, sometimes known as the <code>range</code>.</div> <div>When set to <code>_default</code>, it will use the <code>level</code> portion of the policy if available.</div> </td> </tr> <tr> <td colspan="1">  <b>serole</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The role part of the SELinux file context.</div> <div>When set to <code>_default</code>, it will use the <code>role</code> portion of the policy if available.</div> </td> </tr> <tr> <td colspan="1">  <b>setype</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The type part of the SELinux file context.</div> <div>When set to <code>_default</code>, it will use the <code>type</code> portion of the policy if available.</div> </td> </tr> <tr> <td colspan="1">  <b>seuser</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The user part of the SELinux file context.</div> <div>By default it uses the <code>system</code> policy, where applicable.</div> <div>When set to <code>_default</code>, it will use the <code>user</code> portion of the policy if available.</div> </td> </tr> <tr> <td colspan="1">  <b>ssl_backend</b>  <div> <span>string</span> </div> <div> added in 3.1.0 of community.general </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>openssl</b> ←</div></li> <li>cryptography</li> </ul> </td> <td> <div>Backend for loading private keys and certificates.</div> </td> </tr> <tr> <td colspan="1">  <b>unsafe_writes</b>  <div> <span>boolean</span> </div> <div> added in 2.2 of ansible.builtin </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Influence when to use atomic operation to prevent data corruption or inconsistent reads from the target file.</div> <div>By default this module uses atomic operations to prevent data corruption or inconsistent reads from the target files, but sometimes systems are configured or just broken in ways that prevent this. One example is docker mounted files, which cannot be updated atomically from inside the container and can only be written in an unsafe manner.</div> <div>This option allows Ansible to fall back to unsafe methods of updating files when atomic operations fail (however, it doesn't force Ansible to perform unsafe writes).</div> <div>IMPORTANT! Unsafe writes are subject to race conditions and can lead to data corruption.</div> </td> </tr> </table> <br>  <h2 id="notes">Notes</h2> <div class="admonition note"> <p class="admonition-title">Note</p> <ul class="simple"> <li>
<em>certificate</em> and <em>private_key</em> require that their contents are available on the controller (either inline in a playbook, or with the <code>file</code> lookup), while <em>certificate_path</em> and <em>private_key_path</em> require that the files are available on the target host.</li> <li>By design, any change of a value of options <em>keystore_type</em>, <em>name</em> or <em>password</em>, as well as changes of key or certificate materials will cause the existing <em>dest</em> to be overwritten.</li> </ul> </div>   <h2 id="see-also">See Also</h2> <div class="admonition seealso"> <p class="admonition-title">See also</p> <dl class="simple"> <dt><a class="reference internal" href="../crypto/openssl_pkcs12_module.html#ansible-collections-community-crypto-openssl-pkcs12-module"><span class="std std-ref">community.crypto.openssl_pkcs12</span></a></dt>
<dd>
<p>The official documentation on the <strong>community.crypto.openssl_pkcs12</strong> module.</p> </dd> <dt><a class="reference internal" href="java_cert_module.html#ansible-collections-community-general-java-cert-module"><span class="std std-ref">community.general.java_cert</span></a></dt>
<dd>
<p>The official documentation on the <strong>community.general.java_cert</strong> module.</p> </dd> </dl> </div>   <h2 id="examples">Examples</h2> <pre data-language="yaml+jinja">- name: Create a keystore for the given certificate/private key pair (inline)
  community.general.java_keystore:
    name: example
    certificate: |
      -----BEGIN CERTIFICATE-----
      h19dUZ2co2fI/ibYiwxWk4aeNE6KWvCaTQOMQ8t6Uo2XKhpL/xnjoAgh1uCQN/69
      MG+34+RhUWzCfdZH7T8/qDxJw2kEPKluaYh7KnMsba+5jHjmtzix5QIDAQABo4IB
      -----END CERTIFICATE-----
    private_key: |
      -----BEGIN RSA PRIVATE KEY-----
      DBVFTEVDVFJJQ0lURSBERSBGUkFOQ0UxFzAVBgNVBAsMDjAwMDIgNTUyMDgxMzE3
      GLlDNMw/uHyME7gHFsqJA7O11VY6O5WQ4IDP3m/s5ZV6s+Nn6Lerz17VZ99
      -----END RSA PRIVATE KEY-----
    password: changeit
    dest: /etc/security/keystore.jks

- name: Create a keystore for the given certificate/private key pair (with files on controller)
  community.general.java_keystore:
    name: example
    certificate: "{{ lookup('file', '/path/to/certificate.crt') }}"
    private_key: "{{ lookup('file', '/path/to/private.key') }}"
    password: changeit
    dest: /etc/security/keystore.jks

- name: Create a keystore for the given certificate/private key pair (with files on target host)
  community.general.java_keystore:
    name: snakeoil
    certificate_path: /etc/ssl/certs/ssl-cert-snakeoil.pem
    private_key_path: /etc/ssl/private/ssl-cert-snakeoil.key
    password: changeit
    dest: /etc/security/keystore.jks
</pre>   <h2 id="return-values">Return Values</h2> <p>Common return values are documented <a class="reference internal" href="../../../reference_appendices/common_return_values.html#common-return-values"><span class="std std-ref">here</span></a>, the following are the fields unique to this module:</p> <table class="documentation-table"> <tr> <th colspan="1">Key</th> <th>Returned</th> <th width="100%">Description</th> </tr> <tr> <td colspan="1">  <b>cmd</b>  <div> <span>string</span> </div> </td> <td>changed and failure</td> <td> <div>Executed command to get action done</div> <br> <div><b>Sample:</b></div> <div>/usr/bin/openssl x509 -noout -in /tmp/user/1000/tmp8jd_lh23 -fingerprint -sha256</div> </td> </tr> <tr> <td colspan="1">  <b>err</b>  <div> <span>string</span> </div> </td> <td>failure</td> <td> <div>Output from stderr of keytool/openssl command after error of given command.</div> <br> <div><b>Sample:</b></div> <div>Keystore password is too short - must be at least 6 characters</div> </td> </tr> <tr> <td colspan="1">  <b>msg</b>  <div> <span>string</span> </div> </td> <td>changed and failure</td> <td> <div>Output from stdout of keytool/openssl command after execution of given command or an error.</div> <br> <div><b>Sample:</b></div> <div>Unable to find the current certificate fingerprint in ...</div> </td> </tr> <tr> <td colspan="1">  <b>rc</b>  <div> <span>integer</span> </div> </td> <td>changed and failure</td> <td> <div>keytool/openssl command execution return value</div> <br> <div><b>Sample:</b></div> <div>0</div> </td> </tr> </table> <br><br> <h3 id="authors">Authors</h3> <ul class="simple"> <li>Guillaume Grossetie (@Mogztter)</li> <li>quidame (@quidame)</li> </ul><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2012&ndash;2018 Michael DeHaan<br>&copy; 2018&ndash;2021 Red Hat, Inc.<br>Licensed under the GNU General Public License version 3.<br>
    <a href="https://docs.ansible.com/ansible/latest/collections/community/general/java_keystore_module.html" class="_attribution-link">https://docs.ansible.com/ansible/latest/collections/community/general/java_keystore_module.html</a>
  </p>
</div>
