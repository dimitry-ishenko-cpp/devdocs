<h1 id="community-crypto-x509-certificate-generate-and-or-check-openssl-certificates">community.crypto.x509_certificate – Generate and/or check OpenSSL certificates</h1> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This plugin is part of the <a class="reference external" href="https://galaxy.ansible.com/community/crypto">community.crypto collection</a> (version 1.9.6).</p> <p>You might already have this collection installed if you are using the <code>ansible</code> package. It is not included in <code>ansible-core</code>. To check whether it is installed, run <code>ansible-galaxy collection list</code>.</p> <p>To install it, use: <code>ansible-galaxy collection install community.crypto</code>.</p> <p>To use it in a playbook, specify: <code>community.crypto.x509_certificate</code>.</p> </div>  <ul class="simple"> <li><a class="reference internal" href="#synopsis" id="id1">Synopsis</a></li> <li><a class="reference internal" href="#requirements" id="id2">Requirements</a></li> <li><a class="reference internal" href="#parameters" id="id3">Parameters</a></li> <li><a class="reference internal" href="#notes" id="id4">Notes</a></li> <li><a class="reference internal" href="#see-also" id="id5">See Also</a></li> <li><a class="reference internal" href="#examples" id="id6">Examples</a></li> <li><a class="reference internal" href="#return-values" id="id7">Return Values</a></li> </ul>   <h2 id="synopsis">Synopsis</h2> <ul class="simple"> <li>If both the cryptography and PyOpenSSL libraries are available (and meet the minimum version requirements) cryptography will be preferred as a backend over PyOpenSSL (unless the backend is forced with <code>select_crypto_backend</code>). Please note that the PyOpenSSL backend was deprecated in Ansible 2.9 and will be removed in community.crypto 2.0.0.</li> <li>It implements a notion of provider (ie. <code>selfsigned</code>, <code>ownca</code>, <code>acme</code>, <code>assertonly</code>, <code>entrust</code>) for your certificate.</li> <li>It uses the pyOpenSSL or cryptography python library to interact with OpenSSL.</li> <li>Many properties that can be specified in this module are for validation of an existing or newly generated certificate. The proper place to specify them, if you want to receive a certificate with these properties is a CSR (Certificate Signing Request).</li> <li>Note that this module was called <code>openssl_certificate</code> when included directly in Ansible up to version 2.9. When moved to the collection <code>community.crypto</code>, it was renamed to <a class="reference internal" href="#ansible-collections-community-crypto-x509-certificate-module"><span class="std std-ref">community.crypto.x509_certificate</span></a>. From Ansible 2.10 on, it can still be used by the old short name (or by <code>ansible.builtin.openssl_certificate</code>), which redirects to <code>community.crypto.x509_certificate</code>. When using FQCNs or when using the <a class="reference external" href="../../../user_guide/collections_using.html#using-collections-in-a-playbook">collections</a> keyword, the new name <a class="reference internal" href="#ansible-collections-community-crypto-x509-certificate-module"><span class="std std-ref">community.crypto.x509_certificate</span></a> should be used to avoid a deprecation warning.</li> <li>Please note that the module regenerates existing certificate if it does not match the module’s options, or if it seems to be corrupt. If you are concerned that this could overwrite your existing certificate, consider using the <em>backup</em> option.</li> <li>The <code>assertonly</code> provider is intended for use cases where one is only interested in checking properties of a supplied certificate. Please note that this provider has been deprecated in Ansible 2.9 and will be removed in community.crypto 2.0.0. See the examples on how to emulate <code>assertonly</code> usage with <a class="reference internal" href="x509_certificate_info_module.html#ansible-collections-community-crypto-x509-certificate-info-module"><span class="std std-ref">community.crypto.x509_certificate_info</span></a>, <a class="reference internal" href="openssl_csr_info_module.html#ansible-collections-community-crypto-openssl-csr-info-module"><span class="std std-ref">community.crypto.openssl_csr_info</span></a>, <a class="reference internal" href="openssl_privatekey_info_module.html#ansible-collections-community-crypto-openssl-privatekey-info-module"><span class="std std-ref">community.crypto.openssl_privatekey_info</span></a> and <a class="reference internal" href="../../ansible/builtin/assert_module.html#ansible-collections-ansible-builtin-assert-module"><span class="std std-ref">ansible.builtin.assert</span></a>. This also allows more flexible checks than the ones offered by the <code>assertonly</code> provider.</li> <li>The <code>ownca</code> provider is intended for generating an OpenSSL certificate signed with your own CA (Certificate Authority) certificate (self-signed certificate).</li> <li>This module allows one to (re)generate OpenSSL certificates.</li> </ul>   <h2 id="requirements">Requirements</h2> <p>The below requirements are needed on the host that executes this module.</p> <ul class="simple"> <li>PyOpenSSL &gt;= 0.15 or cryptography &gt;= 1.6 (if using <code>selfsigned</code>, <code>ownca</code> or <code>assertonly</code> provider)</li> <li>acme-tiny &gt;= 4.0.0 (if using the <code>acme</code> provider)</li> </ul>   <h2 id="parameters">Parameters</h2> <table class="documentation-table"> <tr> <th colspan="1">Parameter</th> <th>Choices/Defaults</th> <th width="100%">Comments</th> </tr> <tr> <td colspan="1">  <b>acme_accountkey_path</b>  <div> <span>path</span> </div> </td> <td> </td> <td> <div>The path to the accountkey for the <code>acme</code> provider.</div> <div>This is only used by the <code>acme</code> provider.</div> </td> </tr> <tr> <td colspan="1">  <b>acme_chain</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Include the intermediate certificate to the generated certificate</div> <div>This is only used by the <code>acme</code> provider.</div> <div>Note that this is only available for older versions of <code>acme-tiny</code>. New versions include the chain automatically, and setting <em>acme_chain</em> to <code>yes</code> results in an error.</div> </td> </tr> <tr> <td colspan="1">  <b>acme_challenge_path</b>  <div> <span>path</span> </div> </td> <td> </td> <td> <div>The path to the ACME challenge directory that is served on <a href="#">http://&lt;HOST&gt;:80/.well-known/acme-challenge/</a>
</div> <div>This is only used by the <code>acme</code> provider.</div> </td> </tr> <tr> <td colspan="1">  <b>acme_directory</b>  <div> <span>string</span> </div> <div> added in 1.0.0 of community.crypto </div> </td> <td> <b>Default:</b><br><div>"https://acme-v02.api.letsencrypt.org/directory"</div> </td> <td> <div>The ACME directory to use. You can use any directory that supports the ACME protocol, such as Buypass or Let's Encrypt.</div> <div>Let's Encrypt recommends using their staging server while developing jobs. <a href="https://letsencrypt.org/docs/staging-environment/">https://letsencrypt.org/docs/staging-environment/</a>.</div> </td> </tr> <tr> <td colspan="1">  <b>attributes</b>  <div> <span>string</span> </div> <div> added in 2.3 of ansible.builtin </div> </td> <td> </td> <td> <div>The attributes the resulting file or directory should have.</div> <div>To get supported flags look at the man page for <em>chattr</em> on the target system.</div> <div>This string should contain the attributes in the same order as the one displayed by <em>lsattr</em>.</div> <div>The <code>=</code> operator is assumed as default, otherwise <code>+</code> or <code>-</code> operators need to be included in the string.</div> <div>
<br>aliases: attr</div> </td> </tr> <tr> <td colspan="1">  <b>backup</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Create a backup file including a timestamp so you can get the original certificate back if you overwrote it with a new one by accident.</div> <div>This is not used by the <code>assertonly</code> provider.</div> <div>This option is deprecated since Ansible 2.9 and will be removed with the <code>assertonly</code> provider in community.crypto 2.0.0. For alternatives, see the example on replacing <code>assertonly</code>.</div> </td> </tr> <tr> <td colspan="1">  <b>csr_content</b>  <div> <span>string</span> </div> <div> added in 1.0.0 of community.crypto </div> </td> <td> </td> <td> <div>Content of the Certificate Signing Request (CSR) used to generate this certificate.</div> <div>This is mutually exclusive with <em>csr_path</em>.</div> </td> </tr> <tr> <td colspan="1">  <b>csr_path</b>  <div> <span>path</span> </div> </td> <td> </td> <td> <div>Path to the Certificate Signing Request (CSR) used to generate this certificate.</div> <div>This is mutually exclusive with <em>csr_content</em>.</div> </td> </tr> <tr> <td colspan="1">  <b>entrust_api_client_cert_key_path</b>  <div> <span>path</span> </div> </td> <td> </td> <td> <div>The path to the private key of the client certificate used to authenticate to the Entrust Certificate Services (ECS) API.</div> <div>This is only used by the <code>entrust</code> provider.</div> <div>This is required if the provider is <code>entrust</code>.</div> </td> </tr> <tr> <td colspan="1">  <b>entrust_api_client_cert_path</b>  <div> <span>path</span> </div> </td> <td> </td> <td> <div>The path to the client certificate used to authenticate to the Entrust Certificate Services (ECS) API.</div> <div>This is only used by the <code>entrust</code> provider.</div> <div>This is required if the provider is <code>entrust</code>.</div> </td> </tr> <tr> <td colspan="1">  <b>entrust_api_key</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The key (password) for authentication to the Entrust Certificate Services (ECS) API.</div> <div>This is only used by the <code>entrust</code> provider.</div> <div>This is required if the provider is <code>entrust</code>.</div> </td> </tr> <tr> <td colspan="1">  <b>entrust_api_specification_path</b>  <div> <span>path</span> </div> </td> <td> <b>Default:</b><br><div>"https://cloud.entrust.net/EntrustCloud/documentation/cms-api-2.1.0.yaml"</div> </td> <td> <div>The path to the specification file defining the Entrust Certificate Services (ECS) API configuration.</div> <div>You can use this to keep a local copy of the specification to avoid downloading it every time the module is used.</div> <div>This is only used by the <code>entrust</code> provider.</div> </td> </tr> <tr> <td colspan="1">  <b>entrust_api_user</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The username for authentication to the Entrust Certificate Services (ECS) API.</div> <div>This is only used by the <code>entrust</code> provider.</div> <div>This is required if the provider is <code>entrust</code>.</div> </td> </tr> <tr> <td colspan="1">  <b>entrust_cert_type</b>  <div> <span>string</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>STANDARD_SSL</b> ←</div></li> <li>ADVANTAGE_SSL</li> <li>UC_SSL</li> <li>EV_SSL</li> <li>WILDCARD_SSL</li> <li>PRIVATE_SSL</li> <li>PD_SSL</li> <li>CDS_ENT_LITE</li> <li>CDS_ENT_PRO</li> <li>SMIME_ENT</li> </ul> </td> <td> <div>Specify the type of certificate requested.</div> <div>This is only used by the <code>entrust</code> provider.</div> </td> </tr> <tr> <td colspan="1">  <b>entrust_not_after</b>  <div> <span>string</span> </div> </td> <td> <b>Default:</b><br><div>"+365d"</div> </td> <td> <div>The point in time at which the certificate stops being valid.</div> <div>Time can be specified either as relative time or as an absolute timestamp.</div> <div>A valid absolute time format is <code>ASN.1 TIME</code> such as <code>2019-06-18</code>.</div> <div>A valid relative time format is <code>[+-]timespec</code> where timespec can be an integer + <code>[w | d | h | m | s]</code>, such as <code>+365d</code> or <code>+32w1d2h</code>).</div> <div>Time will always be interpreted as UTC.</div> <div>Note that only the date (day, month, year) is supported for specifying the expiry date of the issued certificate.</div> <div>The full date-time is adjusted to EST (GMT -5:00) before issuance, which may result in a certificate with an expiration date one day earlier than expected if a relative time is used.</div> <div>The minimum certificate lifetime is 90 days, and maximum is three years.</div> <div>If this value is not specified, the certificate will stop being valid 365 days the date of issue.</div> <div>This is only used by the <code>entrust</code> provider.</div> </td> </tr> <tr> <td colspan="1">  <b>entrust_requester_email</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The email of the requester of the certificate (for tracking purposes).</div> <div>This is only used by the <code>entrust</code> provider.</div> <div>This is required if the provider is <code>entrust</code>.</div> </td> </tr> <tr> <td colspan="1">  <b>entrust_requester_name</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The name of the requester of the certificate (for tracking purposes).</div> <div>This is only used by the <code>entrust</code> provider.</div> <div>This is required if the provider is <code>entrust</code>.</div> </td> </tr> <tr> <td colspan="1">  <b>entrust_requester_phone</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The phone number of the requester of the certificate (for tracking purposes).</div> <div>This is only used by the <code>entrust</code> provider.</div> <div>This is required if the provider is <code>entrust</code>.</div> </td> </tr> <tr> <td colspan="1">  <b>extended_key_usage</b>  <div> <span>list</span> / <span>elements=string</span> </div> </td> <td> </td> <td> <div>The <em>extended_key_usage</em> extension field must contain all these values.</div> <div>This is only used by the <code>assertonly</code> provider.</div> <div>This option is deprecated since Ansible 2.9 and will be removed with the <code>assertonly</code> provider in community.crypto 2.0.0. For alternatives, see the example on replacing <code>assertonly</code>.</div> <div>
<br>aliases: extendedKeyUsage</div> </td> </tr> <tr> <td colspan="1">  <b>extended_key_usage_strict</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>If set to <code>yes</code>, the <em>extended_key_usage</em> extension field must contain only these values.</div> <div>This is only used by the <code>assertonly</code> provider.</div> <div>This option is deprecated since Ansible 2.9 and will be removed with the <code>assertonly</code> provider in community.crypto 2.0.0. For alternatives, see the example on replacing <code>assertonly</code>.</div> <div>
<br>aliases: extendedKeyUsage_strict</div> </td> </tr> <tr> <td colspan="1">  <b>force</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Generate the certificate, even if it already exists.</div> </td> </tr> <tr> <td colspan="1">  <b>group</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Name of the group that should own the file/directory, as would be fed to <em>chown</em>.</div> </td> </tr> <tr> <td colspan="1">  <b>has_expired</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Checks if the certificate is expired/not expired at the time the module is executed.</div> <div>This is only used by the <code>assertonly</code> provider.</div> <div>This option is deprecated since Ansible 2.9 and will be removed with the <code>assertonly</code> provider in community.crypto 2.0.0. For alternatives, see the example on replacing <code>assertonly</code>.</div> </td> </tr> <tr> <td colspan="1">  <b>invalid_at</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The certificate must be invalid at this point in time.</div> <div>The timestamp is formatted as an ASN.1 TIME.</div> <div>This is only used by the <code>assertonly</code> provider.</div> <div>This option is deprecated since Ansible 2.9 and will be removed with the <code>assertonly</code> provider in community.crypto 2.0.0. For alternatives, see the example on replacing <code>assertonly</code>.</div> </td> </tr> <tr> <td colspan="1">  <b>issuer</b>  <div> <span>dictionary</span> </div> </td> <td> </td> <td> <div>The key/value pairs that must be present in the issuer name field of the certificate.</div> <div>If you need to specify more than one value with the same key, use a list as value.</div> <div>This is only used by the <code>assertonly</code> provider.</div> <div>This option is deprecated since Ansible 2.9 and will be removed with the <code>assertonly</code> provider in community.crypto 2.0.0. For alternatives, see the example on replacing <code>assertonly</code>.</div> </td> </tr> <tr> <td colspan="1">  <b>issuer_strict</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>If set to <code>yes</code>, the <em>issuer</em> field must contain only these values.</div> <div>This is only used by the <code>assertonly</code> provider.</div> <div>This option is deprecated since Ansible 2.9 and will be removed with the <code>assertonly</code> provider in community.crypto 2.0.0. For alternatives, see the example on replacing <code>assertonly</code>.</div> </td> </tr> <tr> <td colspan="1">  <b>key_usage</b>  <div> <span>list</span> / <span>elements=string</span> </div> </td> <td> </td> <td> <div>The <em>key_usage</em> extension field must contain all these values.</div> <div>This is only used by the <code>assertonly</code> provider.</div> <div>This option is deprecated since Ansible 2.9 and will be removed with the <code>assertonly</code> provider in community.crypto 2.0.0. For alternatives, see the example on replacing <code>assertonly</code>.</div> <div>
<br>aliases: keyUsage</div> </td> </tr> <tr> <td colspan="1">  <b>key_usage_strict</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>If set to <code>yes</code>, the <em>key_usage</em> extension field must contain only these values.</div> <div>This is only used by the <code>assertonly</code> provider.</div> <div>This option is deprecated since Ansible 2.9 and will be removed with the <code>assertonly</code> provider in community.crypto 2.0.0. For alternatives, see the example on replacing <code>assertonly</code>.</div> <div>
<br>aliases: keyUsage_strict</div> </td> </tr> <tr> <td colspan="1">  <b>mode</b>  <div> <span>raw</span> </div> </td> <td> </td> <td> <div>The permissions the resulting file or directory should have.</div> <div>For those used to <em>/usr/bin/chmod</em> remember that modes are actually octal numbers. You must either add a leading zero so that Ansible's YAML parser knows it is an octal number (like <code>0644</code> or <code>01777</code>) or quote it (like <code>'644'</code> or <code>'1777'</code>) so Ansible receives a string and can do its own conversion from string into number.</div> <div>Giving Ansible a number without following one of these rules will end up with a decimal number which will have unexpected results.</div> <div>As of Ansible 1.8, the mode may be specified as a symbolic mode (for example, <code>u+rwx</code> or <code>u=rw,g=r,o=r</code>).</div> <div>If <code>mode</code> is not specified and the destination file <b>does not</b> exist, the default <code>umask</code> on the system will be used when setting the mode for the newly created file.</div> <div>If <code>mode</code> is not specified and the destination file <b>does</b> exist, the mode of the existing file will be used.</div> <div>Specifying <code>mode</code> is the best way to ensure files are created with the correct permissions. See CVE-2020-1736 for further details.</div> </td> </tr> <tr> <td colspan="1">  <b>not_after</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The certificate must expire at this point in time.</div> <div>The timestamp is formatted as an ASN.1 TIME.</div> <div>This is only used by the <code>assertonly</code> provider.</div> <div>This option is deprecated since Ansible 2.9 and will be removed with the <code>assertonly</code> provider in community.crypto 2.0.0. For alternatives, see the example on replacing <code>assertonly</code>.</div> <div>
<br>aliases: notAfter</div> </td> </tr> <tr> <td colspan="1">  <b>not_before</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The certificate must start to become valid at this point in time.</div> <div>The timestamp is formatted as an ASN.1 TIME.</div> <div>This is only used by the <code>assertonly</code> provider.</div> <div>This option is deprecated since Ansible 2.9 and will be removed with the <code>assertonly</code> provider in community.crypto 2.0.0. For alternatives, see the example on replacing <code>assertonly</code>.</div> <div>
<br>aliases: notBefore</div> </td> </tr> <tr> <td colspan="1">  <b>ownca_content</b>  <div> <span>string</span> </div> <div> added in 1.0.0 of community.crypto </div> </td> <td> </td> <td> <div>Content of the CA (Certificate Authority) certificate.</div> <div>This is only used by the <code>ownca</code> provider.</div> <div>This is mutually exclusive with <em>ownca_path</em>.</div> </td> </tr> <tr> <td colspan="1">  <b>ownca_create_authority_key_identifier</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>no</li> <li><div>
<b>yes</b> ←</div></li> </ul> </td> <td> <div>Create a Authority Key Identifier from the CA's certificate. If the CSR provided a authority key identifier, it is ignored.</div> <div>The Authority Key Identifier is generated from the CA certificate's Subject Key Identifier, if available. If it is not available, the CA certificate's public key will be used.</div> <div>This is only used by the <code>ownca</code> provider.</div> <div>Note that this is only supported if the <code>cryptography</code> backend is used!</div> </td> </tr> <tr> <td colspan="1">  <b>ownca_create_subject_key_identifier</b>  <div> <span>string</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>create_if_not_provided</b> ←</div></li> <li>always_create</li> <li>never_create</li> </ul> </td> <td> <div>Whether to create the Subject Key Identifier (SKI) from the public key.</div> <div>A value of <code>create_if_not_provided</code> (default) only creates a SKI when the CSR does not provide one.</div> <div>A value of <code>always_create</code> always creates a SKI. If the CSR provides one, that one is ignored.</div> <div>A value of <code>never_create</code> never creates a SKI. If the CSR provides one, that one is used.</div> <div>This is only used by the <code>ownca</code> provider.</div> <div>Note that this is only supported if the <code>cryptography</code> backend is used!</div> </td> </tr> <tr> <td colspan="1">  <b>ownca_digest</b>  <div> <span>string</span> </div> </td> <td> <b>Default:</b><br><div>"sha256"</div> </td> <td> <div>The digest algorithm to be used for the <code>ownca</code> certificate.</div> <div>This is only used by the <code>ownca</code> provider.</div> </td> </tr> <tr> <td colspan="1">  <b>ownca_not_after</b>  <div> <span>string</span> </div> </td> <td> <b>Default:</b><br><div>"+3650d"</div> </td> <td> <div>The point in time at which the certificate stops being valid.</div> <div>Time can be specified either as relative time or as absolute timestamp.</div> <div>Time will always be interpreted as UTC.</div> <div>Valid format is <code>[+-]timespec | ASN.1 TIME</code> where timespec can be an integer + <code>[w | d | h | m | s]</code> (e.g. <code>+32w1d2h</code>.</div> <div>If this value is not specified, the certificate will stop being valid 10 years from now.</div> <div>Note that this value is <b>not used to determine whether an existing certificate should be regenerated</b>.</div> <div>This is only used by the <code>ownca</code> provider.</div> <div>On macOS 10.15 and onwards, TLS server certificates must have a validity period of 825 days or fewer. Please see <a href="https://support.apple.com/en-us/HT210176">https://support.apple.com/en-us/HT210176</a> for more details.</div> </td> </tr> <tr> <td colspan="1">  <b>ownca_not_before</b>  <div> <span>string</span> </div> </td> <td> <b>Default:</b><br><div>"+0s"</div> </td> <td> <div>The point in time the certificate is valid from.</div> <div>Time can be specified either as relative time or as absolute timestamp.</div> <div>Time will always be interpreted as UTC.</div> <div>Valid format is <code>[+-]timespec | ASN.1 TIME</code> where timespec can be an integer + <code>[w | d | h | m | s]</code> (e.g. <code>+32w1d2h</code>.</div> <div>If this value is not specified, the certificate will start being valid from now.</div> <div>Note that this value is <b>not used to determine whether an existing certificate should be regenerated</b>.</div> <div>This is only used by the <code>ownca</code> provider.</div> </td> </tr> <tr> <td colspan="1">  <b>ownca_path</b>  <div> <span>path</span> </div> </td> <td> </td> <td> <div>Remote absolute path of the CA (Certificate Authority) certificate.</div> <div>This is only used by the <code>ownca</code> provider.</div> <div>This is mutually exclusive with <em>ownca_content</em>.</div> </td> </tr> <tr> <td colspan="1">  <b>ownca_privatekey_content</b>  <div> <span>string</span> </div> <div> added in 1.0.0 of community.crypto </div> </td> <td> </td> <td> <div>Content of the CA (Certificate Authority) private key to use when signing the certificate.</div> <div>This is only used by the <code>ownca</code> provider.</div> <div>This is mutually exclusive with <em>ownca_privatekey_path</em>.</div> </td> </tr> <tr> <td colspan="1">  <b>ownca_privatekey_passphrase</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The passphrase for the <em>ownca_privatekey_path</em> resp. <em>ownca_privatekey_content</em>.</div> <div>This is only used by the <code>ownca</code> provider.</div> </td> </tr> <tr> <td colspan="1">  <b>ownca_privatekey_path</b>  <div> <span>path</span> </div> </td> <td> </td> <td> <div>Path to the CA (Certificate Authority) private key to use when signing the certificate.</div> <div>This is only used by the <code>ownca</code> provider.</div> <div>This is mutually exclusive with <em>ownca_privatekey_content</em>.</div> </td> </tr> <tr> <td colspan="1">  <b>ownca_version</b>  <div> <span>integer</span> </div> </td> <td> <b>Default:</b><br><div>3</div> </td> <td> <div>The version of the <code>ownca</code> certificate.</div> <div>Nowadays it should almost always be <code>3</code>.</div> <div>This is only used by the <code>ownca</code> provider.</div> </td> </tr> <tr> <td colspan="1">  <b>owner</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Name of the user that should own the file/directory, as would be fed to <em>chown</em>.</div> </td> </tr> <tr> <td colspan="1">  <b>path</b>  <div> <span>path</span> / <span>required</span> </div> </td> <td> </td> <td> <div>Remote absolute path where the generated certificate file should be created or is already located.</div> </td> </tr> <tr> <td colspan="1">  <b>privatekey_content</b>  <div> <span>string</span> </div> <div> added in 1.0.0 of community.crypto </div> </td> <td> </td> <td> <div>Path to the private key to use when signing the certificate.</div> <div>This is mutually exclusive with <em>privatekey_path</em>.</div> </td> </tr> <tr> <td colspan="1">  <b>privatekey_passphrase</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The passphrase for the <em>privatekey_path</em> resp. <em>privatekey_content</em>.</div> <div>This is required if the private key is password protected.</div> </td> </tr> <tr> <td colspan="1">  <b>privatekey_path</b>  <div> <span>path</span> </div> </td> <td> </td> <td> <div>Path to the private key to use when signing the certificate.</div> <div>This is mutually exclusive with <em>privatekey_content</em>.</div> </td> </tr> <tr> <td colspan="1">  <b>provider</b>  <div> <span>string</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>acme</li> <li>assertonly</li> <li>entrust</li> <li>ownca</li> <li>selfsigned</li> </ul> </td> <td> <div>Name of the provider to use to generate/retrieve the OpenSSL certificate.</div> <div>The <code>assertonly</code> provider will not generate files and fail if the certificate file is missing.</div> <div>The <code>assertonly</code> provider has been deprecated in Ansible 2.9 and will be removed in community.crypto 2.0.0. Please see the examples on how to emulate it with <a href="x509_certificate_info_module.html" class="module">community.crypto.x509_certificate_info</a>, <a href="openssl_csr_info_module.html" class="module">community.crypto.openssl_csr_info</a>, <a href="openssl_privatekey_info_module.html" class="module">community.crypto.openssl_privatekey_info</a> and <a href="../../ansible/builtin/assert_module.html" class="module">ansible.builtin.assert</a>.</div> <div>The <code>entrust</code> provider was added for Ansible 2.9 and requires credentials for the <a href="https://www.entrustdatacard.com/products/categories/ssl-certificates">Entrust Certificate Services</a> (ECS) API.</div> <div>Required if <em>state</em> is <code>present</code>.</div> </td> </tr> <tr> <td colspan="1">  <b>return_content</b>  <div> <span>boolean</span> </div> <div> added in 1.0.0 of community.crypto </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>If set to <code>yes</code>, will return the (current or generated) certificate's content as <em>certificate</em>.</div> </td> </tr> <tr> <td colspan="1">  <b>select_crypto_backend</b>  <div> <span>string</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>auto</b> ←</div></li> <li>cryptography</li> <li>pyopenssl</li> </ul> </td> <td> <div>Determines which crypto backend to use.</div> <div>The default choice is <code>auto</code>, which tries to use <code>cryptography</code> if available, and falls back to <code>pyopenssl</code>.</div> <div>If set to <code>pyopenssl</code>, will try to use the <a href="https://pypi.org/project/pyOpenSSL/">pyOpenSSL</a> library.</div> <div>If set to <code>cryptography</code>, will try to use the <a href="https://cryptography.io/">cryptography</a> library.</div> <div>Please note that the <code>pyopenssl</code> backend has been deprecated in Ansible 2.9, and will be removed in community.crypto 2.0.0. From that point on, only the <code>cryptography</code> backend will be available.</div> </td> </tr> <tr> <td colspan="1">  <b>selevel</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The level part of the SELinux file context.</div> <div>This is the MLS/MCS attribute, sometimes known as the <code>range</code>.</div> <div>When set to <code>_default</code>, it will use the <code>level</code> portion of the policy if available.</div> </td> </tr> <tr> <td colspan="1">  <b>selfsigned_create_subject_key_identifier</b>  <div> <span>string</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>create_if_not_provided</b> ←</div></li> <li>always_create</li> <li>never_create</li> </ul> </td> <td> <div>Whether to create the Subject Key Identifier (SKI) from the public key.</div> <div>A value of <code>create_if_not_provided</code> (default) only creates a SKI when the CSR does not provide one.</div> <div>A value of <code>always_create</code> always creates a SKI. If the CSR provides one, that one is ignored.</div> <div>A value of <code>never_create</code> never creates a SKI. If the CSR provides one, that one is used.</div> <div>This is only used by the <code>selfsigned</code> provider.</div> <div>Note that this is only supported if the <code>cryptography</code> backend is used!</div> </td> </tr> <tr> <td colspan="1">  <b>selfsigned_digest</b>  <div> <span>string</span> </div> </td> <td> <b>Default:</b><br><div>"sha256"</div> </td> <td> <div>Digest algorithm to be used when self-signing the certificate.</div> <div>This is only used by the <code>selfsigned</code> provider.</div> </td> </tr> <tr> <td colspan="1">  <b>selfsigned_not_after</b>  <div> <span>string</span> </div> </td> <td> <b>Default:</b><br><div>"+3650d"</div> </td> <td> <div>The point in time at which the certificate stops being valid.</div> <div>Time can be specified either as relative time or as absolute timestamp.</div> <div>Time will always be interpreted as UTC.</div> <div>Valid format is <code>[+-]timespec | ASN.1 TIME</code> where timespec can be an integer + <code>[w | d | h | m | s]</code> (e.g. <code>+32w1d2h</code>.</div> <div>If this value is not specified, the certificate will stop being valid 10 years from now.</div> <div>Note that this value is <b>not used to determine whether an existing certificate should be regenerated</b>.</div> <div>This is only used by the <code>selfsigned</code> provider.</div> <div>On macOS 10.15 and onwards, TLS server certificates must have a validity period of 825 days or fewer. Please see <a href="https://support.apple.com/en-us/HT210176">https://support.apple.com/en-us/HT210176</a> for more details.</div> <div>
<br>aliases: selfsigned_notAfter</div> </td> </tr> <tr> <td colspan="1">  <b>selfsigned_not_before</b>  <div> <span>string</span> </div> </td> <td> <b>Default:</b><br><div>"+0s"</div> </td> <td> <div>The point in time the certificate is valid from.</div> <div>Time can be specified either as relative time or as absolute timestamp.</div> <div>Time will always be interpreted as UTC.</div> <div>Valid format is <code>[+-]timespec | ASN.1 TIME</code> where timespec can be an integer + <code>[w | d | h | m | s]</code> (e.g. <code>+32w1d2h</code>.</div> <div>If this value is not specified, the certificate will start being valid from now.</div> <div>Note that this value is <b>not used to determine whether an existing certificate should be regenerated</b>.</div> <div>This is only used by the <code>selfsigned</code> provider.</div> <div>
<br>aliases: selfsigned_notBefore</div> </td> </tr> <tr> <td colspan="1">  <b>selfsigned_version</b>  <div> <span>integer</span> </div> </td> <td> <b>Default:</b><br><div>3</div> </td> <td> <div>Version of the <code>selfsigned</code> certificate.</div> <div>Nowadays it should almost always be <code>3</code>.</div> <div>This is only used by the <code>selfsigned</code> provider.</div> </td> </tr> <tr> <td colspan="1">  <b>serole</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The role part of the SELinux file context.</div> <div>When set to <code>_default</code>, it will use the <code>role</code> portion of the policy if available.</div> </td> </tr> <tr> <td colspan="1">  <b>setype</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The type part of the SELinux file context.</div> <div>When set to <code>_default</code>, it will use the <code>type</code> portion of the policy if available.</div> </td> </tr> <tr> <td colspan="1">  <b>seuser</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The user part of the SELinux file context.</div> <div>By default it uses the <code>system</code> policy, where applicable.</div> <div>When set to <code>_default</code>, it will use the <code>user</code> portion of the policy if available.</div> </td> </tr> <tr> <td colspan="1">  <b>signature_algorithms</b>  <div> <span>list</span> / <span>elements=string</span> </div> </td> <td> </td> <td> <div>A list of algorithms that you would accept the certificate to be signed with (e.g. ['sha256WithRSAEncryption', 'sha512WithRSAEncryption']).</div> <div>This is only used by the <code>assertonly</code> provider.</div> <div>This option is deprecated since Ansible 2.9 and will be removed with the <code>assertonly</code> provider in community.crypto 2.0.0. For alternatives, see the example on replacing <code>assertonly</code>.</div> </td> </tr> <tr> <td colspan="1">  <b>state</b>  <div> <span>string</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>absent</li> <li><div>
<b>present</b> ←</div></li> </ul> </td> <td> <div>Whether the certificate should exist or not, taking action if the state is different from what is stated.</div> </td> </tr> <tr> <td colspan="1">  <b>subject</b>  <div> <span>dictionary</span> </div> </td> <td> </td> <td> <div>The key/value pairs that must be present in the subject name field of the certificate.</div> <div>If you need to specify more than one value with the same key, use a list as value.</div> <div>This is only used by the <code>assertonly</code> provider.</div> <div>This option is deprecated since Ansible 2.9 and will be removed with the <code>assertonly</code> provider in community.crypto 2.0.0. For alternatives, see the example on replacing <code>assertonly</code>.</div> </td> </tr> <tr> <td colspan="1">  <b>subject_alt_name</b>  <div> <span>list</span> / <span>elements=string</span> </div> </td> <td> </td> <td> <div>The <em>subject_alt_name</em> extension field must contain these values.</div> <div>This is only used by the <code>assertonly</code> provider.</div> <div>This option is deprecated since Ansible 2.9 and will be removed with the <code>assertonly</code> provider in community.crypto 2.0.0. For alternatives, see the example on replacing <code>assertonly</code>.</div> <div>
<br>aliases: subjectAltName</div> </td> </tr> <tr> <td colspan="1">  <b>subject_alt_name_strict</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>If set to <code>yes</code>, the <em>subject_alt_name</em> extension field must contain only these values.</div> <div>This is only used by the <code>assertonly</code> provider.</div> <div>This option is deprecated since Ansible 2.9 and will be removed with the <code>assertonly</code> provider in community.crypto 2.0.0. For alternatives, see the example on replacing <code>assertonly</code>.</div> <div>
<br>aliases: subjectAltName_strict</div> </td> </tr> <tr> <td colspan="1">  <b>subject_strict</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>If set to <code>yes</code>, the <em>subject</em> field must contain only these values.</div> <div>This is only used by the <code>assertonly</code> provider.</div> <div>This option is deprecated since Ansible 2.9 and will be removed with the <code>assertonly</code> provider in community.crypto 2.0.0. For alternatives, see the example on replacing <code>assertonly</code>.</div> </td> </tr> <tr> <td colspan="1">  <b>unsafe_writes</b>  <div> <span>boolean</span> </div> <div> added in 2.2 of ansible.builtin </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Influence when to use atomic operation to prevent data corruption or inconsistent reads from the target file.</div> <div>By default this module uses atomic operations to prevent data corruption or inconsistent reads from the target files, but sometimes systems are configured or just broken in ways that prevent this. One example is docker mounted files, which cannot be updated atomically from inside the container and can only be written in an unsafe manner.</div> <div>This option allows Ansible to fall back to unsafe methods of updating files when atomic operations fail (however, it doesn't force Ansible to perform unsafe writes).</div> <div>IMPORTANT! Unsafe writes are subject to race conditions and can lead to data corruption.</div> </td> </tr> <tr> <td colspan="1">  <b>valid_at</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The certificate must be valid at this point in time.</div> <div>The timestamp is formatted as an ASN.1 TIME.</div> <div>This is only used by the <code>assertonly</code> provider.</div> <div>This option is deprecated since Ansible 2.9 and will be removed with the <code>assertonly</code> provider in community.crypto 2.0.0. For alternatives, see the example on replacing <code>assertonly</code>.</div> </td> </tr> <tr> <td colspan="1">  <b>valid_in</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The certificate must still be valid at this relative time offset from now.</div> <div>Valid format is <code>[+-]timespec | number_of_seconds</code> where timespec can be an integer + <code>[w | d | h | m | s]</code> (e.g. <code>+32w1d2h</code>.</div> <div>Note that if using this parameter, this module is NOT idempotent.</div> <div>This is only used by the <code>assertonly</code> provider.</div> <div>This option is deprecated since Ansible 2.9 and will be removed with the <code>assertonly</code> provider in community.crypto 2.0.0. For alternatives, see the example on replacing <code>assertonly</code>.</div> </td> </tr> <tr> <td colspan="1">  <b>version</b>  <div> <span>integer</span> </div> </td> <td> </td> <td> <div>The version of the certificate.</div> <div>Nowadays it should almost always be 3.</div> <div>This is only used by the <code>assertonly</code> provider.</div> <div>This option is deprecated since Ansible 2.9 and will be removed with the <code>assertonly</code> provider in community.crypto 2.0.0. For alternatives, see the example on replacing <code>assertonly</code>.</div> </td> </tr> </table> <br>  <h2 id="notes">Notes</h2> <div class="admonition note"> <p class="admonition-title">Note</p> <ul class="simple"> <li>Supports <code>check_mode</code>.</li> <li>All ASN.1 TIME values should be specified following the YYYYMMDDHHMMSSZ pattern.</li> <li>Date specified should be UTC. Minutes and seconds are mandatory.</li> <li>For security reason, when you use <code>ownca</code> provider, you should NOT run <a class="reference internal" href="#ansible-collections-community-crypto-x509-certificate-module"><span class="std std-ref">community.crypto.x509_certificate</span></a> on a target machine, but on a dedicated CA machine. It is recommended not to store the CA private key on the target machine. Once signed, the certificate can be moved to the target machine.</li> <li>For the <code>selfsigned</code> provider, <em>csr_path</em> and <em>csr_content</em> are optional. If not provided, a certificate without any information (Subject, Subject Alternative Names, Key Usage, etc.) is created.</li> </ul> </div>   <h2 id="see-also">See Also</h2> <div class="admonition seealso"> <p class="admonition-title">See also</p> <dl class="simple"> <dt><a class="reference internal" href="x509_certificate_pipe_module.html#ansible-collections-community-crypto-x509-certificate-pipe-module"><span class="std std-ref">community.crypto.x509_certificate_pipe</span></a></dt>
<dd>
<p>The official documentation on the <strong>community.crypto.x509_certificate_pipe</strong> module.</p> </dd> <dt><a class="reference internal" href="openssl_csr_module.html#ansible-collections-community-crypto-openssl-csr-module"><span class="std std-ref">community.crypto.openssl_csr</span></a></dt>
<dd>
<p>The official documentation on the <strong>community.crypto.openssl_csr</strong> module.</p> </dd> <dt><a class="reference internal" href="openssl_csr_pipe_module.html#ansible-collections-community-crypto-openssl-csr-pipe-module"><span class="std std-ref">community.crypto.openssl_csr_pipe</span></a></dt>
<dd>
<p>The official documentation on the <strong>community.crypto.openssl_csr_pipe</strong> module.</p> </dd> <dt><a class="reference internal" href="openssl_dhparam_module.html#ansible-collections-community-crypto-openssl-dhparam-module"><span class="std std-ref">community.crypto.openssl_dhparam</span></a></dt>
<dd>
<p>The official documentation on the <strong>community.crypto.openssl_dhparam</strong> module.</p> </dd> <dt><a class="reference internal" href="openssl_pkcs12_module.html#ansible-collections-community-crypto-openssl-pkcs12-module"><span class="std std-ref">community.crypto.openssl_pkcs12</span></a></dt>
<dd>
<p>The official documentation on the <strong>community.crypto.openssl_pkcs12</strong> module.</p> </dd> <dt><a class="reference internal" href="openssl_privatekey_module.html#ansible-collections-community-crypto-openssl-privatekey-module"><span class="std std-ref">community.crypto.openssl_privatekey</span></a></dt>
<dd>
<p>The official documentation on the <strong>community.crypto.openssl_privatekey</strong> module.</p> </dd> <dt><a class="reference internal" href="openssl_privatekey_pipe_module.html#ansible-collections-community-crypto-openssl-privatekey-pipe-module"><span class="std std-ref">community.crypto.openssl_privatekey_pipe</span></a></dt>
<dd>
<p>The official documentation on the <strong>community.crypto.openssl_privatekey_pipe</strong> module.</p> </dd> <dt><a class="reference internal" href="openssl_publickey_module.html#ansible-collections-community-crypto-openssl-publickey-module"><span class="std std-ref">community.crypto.openssl_publickey</span></a></dt>
<dd>
<p>The official documentation on the <strong>community.crypto.openssl_publickey</strong> module.</p> </dd> </dl> </div>   <h2 id="examples">Examples</h2> <pre data-language="yaml+jinja">- name: Generate a Self Signed OpenSSL certificate
  community.crypto.x509_certificate:
    path: /etc/ssl/crt/ansible.com.crt
    privatekey_path: /etc/ssl/private/ansible.com.pem
    csr_path: /etc/ssl/csr/ansible.com.csr
    provider: selfsigned

- name: Generate an OpenSSL certificate signed with your own CA certificate
  community.crypto.x509_certificate:
    path: /etc/ssl/crt/ansible.com.crt
    csr_path: /etc/ssl/csr/ansible.com.csr
    ownca_path: /etc/ssl/crt/ansible_CA.crt
    ownca_privatekey_path: /etc/ssl/private/ansible_CA.pem
    provider: ownca

- name: Generate a Let's Encrypt Certificate
  community.crypto.x509_certificate:
    path: /etc/ssl/crt/ansible.com.crt
    csr_path: /etc/ssl/csr/ansible.com.csr
    provider: acme
    acme_accountkey_path: /etc/ssl/private/ansible.com.pem
    acme_challenge_path: /etc/ssl/challenges/ansible.com/

- name: Force (re-)generate a new Let's Encrypt Certificate
  community.crypto.x509_certificate:
    path: /etc/ssl/crt/ansible.com.crt
    csr_path: /etc/ssl/csr/ansible.com.csr
    provider: acme
    acme_accountkey_path: /etc/ssl/private/ansible.com.pem
    acme_challenge_path: /etc/ssl/challenges/ansible.com/
    force: yes

- name: Generate an Entrust certificate via the Entrust Certificate Services (ECS) API
  community.crypto.x509_certificate:
    path: /etc/ssl/crt/ansible.com.crt
    csr_path: /etc/ssl/csr/ansible.com.csr
    provider: entrust
    entrust_requester_name: Jo Doe
    entrust_requester_email: jdoe@ansible.com
    entrust_requester_phone: 555-555-5555
    entrust_cert_type: STANDARD_SSL
    entrust_api_user: apiusername
    entrust_api_key: a^lv*32!cd9LnT
    entrust_api_client_cert_path: /etc/ssl/entrust/ecs-client.crt
    entrust_api_client_cert_key_path: /etc/ssl/entrust/ecs-key.crt
    entrust_api_specification_path: /etc/ssl/entrust/api-docs/cms-api-2.1.0.yaml

# The following example shows one assertonly usage using all existing options for
# assertonly, and shows how to emulate the behavior with the x509_certificate_info,
# openssl_csr_info, openssl_privatekey_info and assert modules:
- name: Usage of assertonly with all existing options
  community.crypto.x509_certificate:
    provider: assertonly
    path: /etc/ssl/crt/ansible.com.crt
    csr_path: /etc/ssl/csr/ansible.com.csr
    privatekey_path: /etc/ssl/csr/ansible.com.key
    signature_algorithms:
      - sha256WithRSAEncryption
      - sha512WithRSAEncryption
    subject:
      commonName: ansible.com
    subject_strict: yes
    issuer:
      commonName: ansible.com
    issuer_strict: yes
    has_expired: no
    version: 3
    key_usage:
      - Data Encipherment
    key_usage_strict: yes
    extended_key_usage:
      - DVCS
    extended_key_usage_strict: yes
    subject_alt_name:
      - dns:ansible.com
    subject_alt_name_strict: yes
    not_before: 20190331202428Z
    not_after: 20190413202428Z
    valid_at: "+1d10h"
    invalid_at: 20200331202428Z
    valid_in: 10  # in ten seconds

- name: Get certificate information
  community.crypto.x509_certificate_info:
    path: /etc/ssl/crt/ansible.com.crt
    # for valid_at, invalid_at and valid_in
    valid_at:
      one_day_ten_hours: "+1d10h"
      fixed_timestamp: 20200331202428Z
      ten_seconds: "+10"
  register: result

- name: Get CSR information
  community.crypto.openssl_csr_info:
    # Verifies that the CSR signature is valid; module will fail if not
    path: /etc/ssl/csr/ansible.com.csr
  register: result_csr

- name: Get private key information
  community.crypto.openssl_privatekey_info:
    path: /etc/ssl/csr/ansible.com.key
  register: result_privatekey

- assert:
    that:
      # When private key is specified for assertonly, this will be checked:
      - result.public_key == result_privatekey.public_key
      # When CSR is specified for assertonly, this will be checked:
      - result.public_key == result_csr.public_key
      - result.subject_ordered == result_csr.subject_ordered
      - result.extensions_by_oid == result_csr.extensions_by_oid
      # signature_algorithms check
      - "result.signature_algorithm == 'sha256WithRSAEncryption' or result.signature_algorithm == 'sha512WithRSAEncryption'"
      # subject and subject_strict
      - "result.subject.commonName == 'ansible.com'"
      - "result.subject | length == 1"  # the number must be the number of entries you check for
      # issuer and issuer_strict
      - "result.issuer.commonName == 'ansible.com'"
      - "result.issuer | length == 1"  # the number must be the number of entries you check for
      # has_expired
      - not result.expired
      # version
      - result.version == 3
      # key_usage and key_usage_strict
      - "'Data Encipherment' in result.key_usage"
      - "result.key_usage | length == 1"  # the number must be the number of entries you check for
      # extended_key_usage and extended_key_usage_strict
      - "'DVCS' in result.extended_key_usage"
      - "result.extended_key_usage | length == 1"  # the number must be the number of entries you check for
      # subject_alt_name and subject_alt_name_strict
      - "'dns:ansible.com' in result.subject_alt_name"
      - "result.subject_alt_name | length == 1"  # the number must be the number of entries you check for
      # not_before and not_after
      - "result.not_before == '20190331202428Z'"
      - "result.not_after == '20190413202428Z'"
      # valid_at, invalid_at and valid_in
      - "result.valid_at.one_day_ten_hours"  # for valid_at
      - "not result.valid_at.fixed_timestamp"  # for invalid_at
      - "result.valid_at.ten_seconds"  # for valid_in

# Examples for some checks one could use the assertonly provider for:
# (Please note that assertonly has been deprecated!)

# How to use the assertonly provider to implement and trigger your own custom certificate generation workflow:
- name: Check if a certificate is currently still valid, ignoring failures
  community.crypto.x509_certificate:
    path: /etc/ssl/crt/example.com.crt
    provider: assertonly
    has_expired: no
  ignore_errors: yes
  register: validity_check

- name: Run custom task(s) to get a new, valid certificate in case the initial check failed
  command: superspecialSSL recreate /etc/ssl/crt/example.com.crt
  when: validity_check.failed

- name: Check the new certificate again for validity with the same parameters, this time failing the play if it is still invalid
  community.crypto.x509_certificate:
    path: /etc/ssl/crt/example.com.crt
    provider: assertonly
    has_expired: no
  when: validity_check.failed

# Some other checks that assertonly could be used for:
- name: Verify that an existing certificate was issued by the Let's Encrypt CA and is currently still valid
  community.crypto.x509_certificate:
    path: /etc/ssl/crt/example.com.crt
    provider: assertonly
    issuer:
      O: Let's Encrypt
    has_expired: no

- name: Ensure that a certificate uses a modern signature algorithm (no SHA1, MD5 or DSA)
  community.crypto.x509_certificate:
    path: /etc/ssl/crt/example.com.crt
    provider: assertonly
    signature_algorithms:
      - sha224WithRSAEncryption
      - sha256WithRSAEncryption
      - sha384WithRSAEncryption
      - sha512WithRSAEncryption
      - sha224WithECDSAEncryption
      - sha256WithECDSAEncryption
      - sha384WithECDSAEncryption
      - sha512WithECDSAEncryption

- name: Ensure that the existing certificate belongs to the specified private key
  community.crypto.x509_certificate:
    path: /etc/ssl/crt/example.com.crt
    privatekey_path: /etc/ssl/private/example.com.pem
    provider: assertonly

- name: Ensure that the existing certificate is still valid at the winter solstice 2017
  community.crypto.x509_certificate:
    path: /etc/ssl/crt/example.com.crt
    provider: assertonly
    valid_at: 20171221162800Z

- name: Ensure that the existing certificate is still valid 2 weeks (1209600 seconds) from now
  community.crypto.x509_certificate:
    path: /etc/ssl/crt/example.com.crt
    provider: assertonly
    valid_in: 1209600

- name: Ensure that the existing certificate is only used for digital signatures and encrypting other keys
  community.crypto.x509_certificate:
    path: /etc/ssl/crt/example.com.crt
    provider: assertonly
    key_usage:
      - digitalSignature
      - keyEncipherment
    key_usage_strict: true

- name: Ensure that the existing certificate can be used for client authentication
  community.crypto.x509_certificate:
    path: /etc/ssl/crt/example.com.crt
    provider: assertonly
    extended_key_usage:
      - clientAuth

- name: Ensure that the existing certificate can only be used for client authentication and time stamping
  community.crypto.x509_certificate:
    path: /etc/ssl/crt/example.com.crt
    provider: assertonly
    extended_key_usage:
      - clientAuth
      - 1.3.6.1.5.5.7.3.8
    extended_key_usage_strict: true

- name: Ensure that the existing certificate has a certain domain in its subjectAltName
  community.crypto.x509_certificate:
    path: /etc/ssl/crt/example.com.crt
    provider: assertonly
    subject_alt_name:
      - www.example.com
      - test.example.com
</pre>   <h2 id="return-values">Return Values</h2> <p>Common return values are documented <a class="reference internal" href="../../../reference_appendices/common_return_values.html#common-return-values"><span class="std std-ref">here</span></a>, the following are the fields unique to this module:</p> <table class="documentation-table"> <tr> <th colspan="1">Key</th> <th>Returned</th> <th width="100%">Description</th> </tr> <tr> <td colspan="1">  <b>backup_file</b>  <div> <span>string</span> </div> </td> <td>changed and if <em>backup</em> is <code>yes</code>
</td> <td> <div>Name of backup file created.</div> <br> <div><b>Sample:</b></div> <div>/path/to/www.ansible.com.crt.2019-03-09@11:22~</div> </td> </tr> <tr> <td colspan="1">  <b>certificate</b>  <div> <span>string</span> </div> <div>added in 1.0.0 of community.crypto</div> </td> <td>if <em>state</em> is <code>present</code> and <em>return_content</em> is <code>yes</code>
</td> <td> <div>The (current or generated) certificate's content.</div> <br> </td> </tr> <tr> <td colspan="1">  <b>filename</b>  <div> <span>string</span> </div> </td> <td>changed or success</td> <td> <div>Path to the generated certificate.</div> <br> <div><b>Sample:</b></div> <div>/etc/ssl/crt/www.ansible.com.crt</div> </td> </tr> </table> <br><br> <h3 id="authors">Authors</h3> <ul class="simple"> <li>Yanis Guenane (@Spredzy)</li> <li>Markus Teufelberger (@MarkusTeufelberger)</li> </ul><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2012&ndash;2018 Michael DeHaan<br>&copy; 2018&ndash;2021 Red Hat, Inc.<br>Licensed under the GNU General Public License version 3.<br>
    <a href="https://docs.ansible.com/ansible/latest/collections/community/crypto/x509_certificate_module.html" class="_attribution-link">https://docs.ansible.com/ansible/latest/collections/community/crypto/x509_certificate_module.html</a>
  </p>
</div>
