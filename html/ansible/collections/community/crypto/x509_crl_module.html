<h1 id="community-crypto-x509-crl-generate-certificate-revocation-lists-crls">community.crypto.x509_crl – Generate Certificate Revocation Lists (CRLs)</h1> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This plugin is part of the <a class="reference external" href="https://galaxy.ansible.com/community/crypto">community.crypto collection</a> (version 1.9.6).</p> <p>You might already have this collection installed if you are using the <code>ansible</code> package. It is not included in <code>ansible-core</code>. To check whether it is installed, run <code>ansible-galaxy collection list</code>.</p> <p>To install it, use: <code>ansible-galaxy collection install community.crypto</code>.</p> <p>To use it in a playbook, specify: <code>community.crypto.x509_crl</code>.</p> </div> <div class="versionadded"> <p><span class="versionmodified added">New in version 1.0.0: </span>of community.crypto</p> </div>  <ul class="simple"> <li><a class="reference internal" href="#synopsis" id="id1">Synopsis</a></li> <li><a class="reference internal" href="#requirements" id="id2">Requirements</a></li> <li><a class="reference internal" href="#parameters" id="id3">Parameters</a></li> <li><a class="reference internal" href="#notes" id="id4">Notes</a></li> <li><a class="reference internal" href="#examples" id="id5">Examples</a></li> <li><a class="reference internal" href="#return-values" id="id6">Return Values</a></li> </ul>   <h2 id="synopsis">Synopsis</h2> <ul class="simple"> <li>This module allows one to (re)generate or update Certificate Revocation Lists (CRLs).</li> <li>Certificates on the revocation list can be either specified by serial number and (optionally) their issuer, or as a path to a certificate file in PEM format.</li> </ul>   <h2 id="requirements">Requirements</h2> <p>The below requirements are needed on the host that executes this module.</p> <ul class="simple"> <li>cryptography &gt;= 1.2</li> </ul>   <h2 id="parameters">Parameters</h2> <table class="documentation-table"> <tr> <th colspan="2">Parameter</th> <th>Choices/Defaults</th> <th width="100%">Comments</th> </tr> <tr> <td colspan="2">  <b>attributes</b>  <div> <span>string</span> </div> <div> added in 2.3 of ansible.builtin </div> </td> <td> </td> <td> <div>The attributes the resulting file or directory should have.</div> <div>To get supported flags look at the man page for <em>chattr</em> on the target system.</div> <div>This string should contain the attributes in the same order as the one displayed by <em>lsattr</em>.</div> <div>The <code>=</code> operator is assumed as default, otherwise <code>+</code> or <code>-</code> operators need to be included in the string.</div> <div>
<br>aliases: attr</div> </td> </tr> <tr> <td colspan="2">  <b>backup</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Create a backup file including a timestamp so you can get the original CRL back if you overwrote it with a new one by accident.</div> </td> </tr> <tr> <td colspan="2">  <b>digest</b>  <div> <span>string</span> </div> </td> <td> <b>Default:</b><br><div>"sha256"</div> </td> <td> <div>Digest algorithm to be used when signing the CRL.</div> </td> </tr> <tr> <td colspan="2">  <b>force</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Should the CRL be forced to be regenerated.</div> </td> </tr> <tr> <td colspan="2">  <b>format</b>  <div> <span>string</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>pem</b> ←</div></li> <li>der</li> </ul> </td> <td> <div>Whether the CRL file should be in PEM or DER format.</div> <div>If an existing CRL file does match everything but <em>format</em>, it will be converted to the correct format instead of regenerated.</div> </td> </tr> <tr> <td colspan="2">  <b>group</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Name of the group that should own the file/directory, as would be fed to <em>chown</em>.</div> </td> </tr> <tr> <td colspan="2">  <b>ignore_timestamps</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Whether the timestamps <em>last_update</em>, <em>next_update</em> and <em>revocation_date</em> (in <em>revoked_certificates</em>) should be ignored for idempotency checks. The timestamp <em>invalidity_date</em> in <em>revoked_certificates</em> will never be ignored.</div> <div>Use this in combination with relative timestamps for these values to get idempotency.</div> </td> </tr> <tr> <td colspan="2">  <b>issuer</b>  <div> <span>dictionary</span> </div> </td> <td> </td> <td> <div>Key/value pairs that will be present in the issuer name field of the CRL.</div> <div>If you need to specify more than one value with the same key, use a list as value.</div> <div>Required if <em>state</em> is <code>present</code>.</div> </td> </tr> <tr> <td colspan="2">  <b>last_update</b>  <div> <span>string</span> </div> </td> <td> <b>Default:</b><br><div>"+0s"</div> </td> <td> <div>The point in time from which this CRL can be trusted.</div> <div>Time can be specified either as relative time or as absolute timestamp.</div> <div>Time will always be interpreted as UTC.</div> <div>Valid format is <code>[+-]timespec | ASN.1 TIME</code> where timespec can be an integer + <code>[w | d | h | m | s]</code> (e.g. <code>+32w1d2h</code>.</div> <div>Note that if using relative time this module is NOT idempotent, except when <em>ignore_timestamps</em> is set to <code>yes</code>.</div> </td> </tr> <tr> <td colspan="2">  <b>mode</b>  <div> <span>string</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>generate</b> ←</div></li> <li>update</li> </ul> </td> <td> <div>Defines how to process entries of existing CRLs.</div> <div>If set to <code>generate</code>, makes sure that the CRL has the exact set of revoked certificates as specified in <em>revoked_certificates</em>.</div> <div>If set to <code>update</code>, makes sure that the CRL contains the revoked certificates from <em>revoked_certificates</em>, but can also contain other revoked certificates. If the CRL file already exists, all entries from the existing CRL will also be included in the new CRL. When using <code>update</code>, you might be interested in setting <em>ignore_timestamps</em> to <code>yes</code>.</div> </td> </tr> <tr> <td colspan="2">  <b>next_update</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The absolute latest point in time by which this <em>issuer</em> is expected to have issued another CRL. Many clients will treat a CRL as expired once <em>next_update</em> occurs.</div> <div>Time can be specified either as relative time or as absolute timestamp.</div> <div>Time will always be interpreted as UTC.</div> <div>Valid format is <code>[+-]timespec | ASN.1 TIME</code> where timespec can be an integer + <code>[w | d | h | m | s]</code> (e.g. <code>+32w1d2h</code>.</div> <div>Note that if using relative time this module is NOT idempotent, except when <em>ignore_timestamps</em> is set to <code>yes</code>.</div> <div>Required if <em>state</em> is <code>present</code>.</div> </td> </tr> <tr> <td colspan="2">  <b>owner</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Name of the user that should own the file/directory, as would be fed to <em>chown</em>.</div> </td> </tr> <tr> <td colspan="2">  <b>path</b>  <div> <span>path</span> / <span>required</span> </div> </td> <td> </td> <td> <div>Remote absolute path where the generated CRL file should be created or is already located.</div> </td> </tr> <tr> <td colspan="2">  <b>privatekey_content</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The content of the CA's private key to use when signing the CRL.</div> <div>Either <em>privatekey_path</em> or <em>privatekey_content</em> must be specified if <em>state</em> is <code>present</code>, but not both.</div> </td> </tr> <tr> <td colspan="2">  <b>privatekey_passphrase</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The passphrase for the <em>privatekey_path</em>.</div> <div>This is required if the private key is password protected.</div> </td> </tr> <tr> <td colspan="2">  <b>privatekey_path</b>  <div> <span>path</span> </div> </td> <td> </td> <td> <div>Path to the CA's private key to use when signing the CRL.</div> <div>Either <em>privatekey_path</em> or <em>privatekey_content</em> must be specified if <em>state</em> is <code>present</code>, but not both.</div> </td> </tr> <tr> <td colspan="2">  <b>return_content</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>If set to <code>yes</code>, will return the (current or generated) CRL's content as <em>crl</em>.</div> </td> </tr> <tr> <td colspan="2">  <b>revoked_certificates</b>  <div> <span>list</span> / <span>elements=dictionary</span> </div> </td> <td> </td> <td> <div>List of certificates to be revoked.</div> <div>Required if <em>state</em> is <code>present</code>.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>content</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Content of a certificate in PEM format.</div> <div>The serial number and issuer will be extracted from the certificate.</div> <div>Mutually exclusive with <em>path</em> and <em>serial_number</em>. One of these three options must be specified.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>invalidity_date</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The point in time it was known/suspected that the private key was compromised or that the certificate otherwise became invalid.</div> <div>Time can be specified either as relative time or as absolute timestamp.</div> <div>Time will always be interpreted as UTC.</div> <div>Valid format is <code>[+-]timespec | ASN.1 TIME</code> where timespec can be an integer + <code>[w | d | h | m | s]</code> (e.g. <code>+32w1d2h</code>.</div> <div>Note that if using relative time this module is NOT idempotent. This will NOT change when <em>ignore_timestamps</em> is set to <code>yes</code>.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>invalidity_date_critical</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Whether the invalidity date extension should be critical.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>issuer</b>  <div> <span>list</span> / <span>elements=string</span> </div> </td> <td> </td> <td> <div>The certificate's issuer.</div> <div>Example: <code>DNS:ca.example.org</code>
</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>issuer_critical</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Whether the certificate issuer extension should be critical.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>path</b>  <div> <span>path</span> </div> </td> <td> </td> <td> <div>Path to a certificate in PEM format.</div> <div>The serial number and issuer will be extracted from the certificate.</div> <div>Mutually exclusive with <em>content</em> and <em>serial_number</em>. One of these three options must be specified.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>reason</b>  <div> <span>string</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>unspecified</li> <li>key_compromise</li> <li>ca_compromise</li> <li>affiliation_changed</li> <li>superseded</li> <li>cessation_of_operation</li> <li>certificate_hold</li> <li>privilege_withdrawn</li> <li>aa_compromise</li> <li>remove_from_crl</li> </ul> </td> <td> <div>The value for the revocation reason extension.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>reason_critical</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Whether the revocation reason extension should be critical.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>revocation_date</b>  <div> <span>string</span> </div> </td> <td> <b>Default:</b><br><div>"+0s"</div> </td> <td> <div>The point in time the certificate was revoked.</div> <div>Time can be specified either as relative time or as absolute timestamp.</div> <div>Time will always be interpreted as UTC.</div> <div>Valid format is <code>[+-]timespec | ASN.1 TIME</code> where timespec can be an integer + <code>[w | d | h | m | s]</code> (e.g. <code>+32w1d2h</code>.</div> <div>Note that if using relative time this module is NOT idempotent, except when <em>ignore_timestamps</em> is set to <code>yes</code>.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>serial_number</b>  <div> <span>integer</span> </div> </td> <td> </td> <td> <div>Serial number of the certificate.</div> <div>Mutually exclusive with <em>path</em> and <em>content</em>. One of these three options must be specified.</div> </td> </tr> <tr> <td colspan="2">  <b>selevel</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The level part of the SELinux file context.</div> <div>This is the MLS/MCS attribute, sometimes known as the <code>range</code>.</div> <div>When set to <code>_default</code>, it will use the <code>level</code> portion of the policy if available.</div> </td> </tr> <tr> <td colspan="2">  <b>serole</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The role part of the SELinux file context.</div> <div>When set to <code>_default</code>, it will use the <code>role</code> portion of the policy if available.</div> </td> </tr> <tr> <td colspan="2">  <b>setype</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The type part of the SELinux file context.</div> <div>When set to <code>_default</code>, it will use the <code>type</code> portion of the policy if available.</div> </td> </tr> <tr> <td colspan="2">  <b>seuser</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The user part of the SELinux file context.</div> <div>By default it uses the <code>system</code> policy, where applicable.</div> <div>When set to <code>_default</code>, it will use the <code>user</code> portion of the policy if available.</div> </td> </tr> <tr> <td colspan="2">  <b>state</b>  <div> <span>string</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>absent</li> <li><div>
<b>present</b> ←</div></li> </ul> </td> <td> <div>Whether the CRL file should exist or not, taking action if the state is different from what is stated.</div> </td> </tr> <tr> <td colspan="2">  <b>unsafe_writes</b>  <div> <span>boolean</span> </div> <div> added in 2.2 of ansible.builtin </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Influence when to use atomic operation to prevent data corruption or inconsistent reads from the target file.</div> <div>By default this module uses atomic operations to prevent data corruption or inconsistent reads from the target files, but sometimes systems are configured or just broken in ways that prevent this. One example is docker mounted files, which cannot be updated atomically from inside the container and can only be written in an unsafe manner.</div> <div>This option allows Ansible to fall back to unsafe methods of updating files when atomic operations fail (however, it doesn't force Ansible to perform unsafe writes).</div> <div>IMPORTANT! Unsafe writes are subject to race conditions and can lead to data corruption.</div> </td> </tr> </table> <br>  <h2 id="notes">Notes</h2> <div class="admonition note"> <p class="admonition-title">Note</p> <ul class="simple"> <li>All ASN.1 TIME values should be specified following the YYYYMMDDHHMMSSZ pattern.</li> <li>Date specified should be UTC. Minutes and seconds are mandatory.</li> <li>Supports <code>check_mode</code>.</li> </ul> </div>   <h2 id="examples">Examples</h2> <pre data-language="yaml+jinja">- name: Generate a CRL
  community.crypto.x509_crl:
    path: /etc/ssl/my-ca.crl
    privatekey_path: /etc/ssl/private/my-ca.pem
    issuer:
      CN: My CA
    last_update: "+0s"
    next_update: "+7d"
    revoked_certificates:
      - serial_number: 1234
        revocation_date: 20190331202428Z
        issuer:
          CN: My CA
      - serial_number: 2345
        revocation_date: 20191013152910Z
        reason: affiliation_changed
        invalidity_date: 20191001000000Z
      - path: /etc/ssl/crt/revoked-cert.pem
        revocation_date: 20191010010203Z
</pre>   <h2 id="return-values">Return Values</h2> <p>Common return values are documented <a class="reference internal" href="../../../reference_appendices/common_return_values.html#common-return-values"><span class="std std-ref">here</span></a>, the following are the fields unique to this module:</p> <table class="documentation-table"> <tr> <th colspan="2">Key</th> <th>Returned</th> <th width="100%">Description</th> </tr> <tr> <td colspan="2">  <b>backup_file</b>  <div> <span>string</span> </div> </td> <td>changed and if <em>backup</em> is <code>yes</code>
</td> <td> <div>Name of backup file created.</div> <br> <div><b>Sample:</b></div> <div>/path/to/my-ca.crl.2019-03-09@11:22~</div> </td> </tr> <tr> <td colspan="2">  <b>crl</b>  <div> <span>string</span> </div> </td> <td>if <em>state</em> is <code>present</code> and <em>return_content</em> is <code>yes</code>
</td> <td> <div>The (current or generated) CRL's content.</div> <div>Will be the CRL itself if <em>format</em> is <code>pem</code>, and Base64 of the CRL if <em>format</em> is <code>der</code>.</div> <br> </td> </tr> <tr> <td colspan="2">  <b>digest</b>  <div> <span>string</span> </div> </td> <td>success</td> <td> <div>The signature algorithm used to sign the CRL.</div> <br> <div><b>Sample:</b></div> <div>sha256WithRSAEncryption</div> </td> </tr> <tr> <td colspan="2">  <b>filename</b>  <div> <span>string</span> </div> </td> <td>changed or success</td> <td> <div>Path to the generated CRL.</div> <br> <div><b>Sample:</b></div> <div>/path/to/my-ca.crl</div> </td> </tr> <tr> <td colspan="2">  <b>format</b>  <div> <span>string</span> </div> </td> <td>success</td> <td> <div>Whether the CRL is in PEM format (<code>pem</code>) or in DER format (<code>der</code>).</div> <br> <div><b>Sample:</b></div> <div>pem</div> </td> </tr> <tr> <td colspan="2">  <b>issuer</b>  <div> <span>dictionary</span> </div> </td> <td>success</td> <td> <div>The CRL's issuer.</div> <div>Note that for repeated values, only the last one will be returned.</div> <br> <div><b>Sample:</b></div> <div>{"organizationName": "Ansible", "commonName": "ca.example.com"}</div> </td> </tr> <tr> <td colspan="2">  <b>issuer_ordered</b>  <div> <span>list</span> / <span>elements=list</span> </div> </td> <td>success</td> <td> <div>The CRL's issuer as an ordered list of tuples.</div> <br> <div><b>Sample:</b></div> <div>[["organizationName", "Ansible"], ["commonName": "ca.example.com"]]</div> </td> </tr> <tr> <td colspan="2">  <b>last_update</b>  <div> <span>string</span> </div> </td> <td>success</td> <td> <div>The point in time from which this CRL can be trusted as ASN.1 TIME.</div> <br> <div><b>Sample:</b></div> <div>20190413202428Z</div> </td> </tr> <tr> <td colspan="2">  <b>next_update</b>  <div> <span>string</span> </div> </td> <td>success</td> <td> <div>The point in time from which a new CRL will be issued and the client has to check for it as ASN.1 TIME.</div> <br> <div><b>Sample:</b></div> <div>20190413202428Z</div> </td> </tr> <tr> <td colspan="2">  <b>privatekey</b>  <div> <span>string</span> </div> </td> <td>changed or success</td> <td> <div>Path to the private CA key.</div> <br> <div><b>Sample:</b></div> <div>/path/to/my-ca.pem</div> </td> </tr> <tr> <td colspan="2">  <b>revoked_certificates</b>  <div> <span>list</span> / <span>elements=dictionary</span> </div> </td> <td>success</td> <td> <div>List of certificates to be revoked.</div> <br> </td> </tr> <tr> <td class="elbow-placeholder"> </td> <td colspan="1">  <b>invalidity_date</b>  <div> <span>string</span> </div> </td> <td>success</td> <td> <div>The point in time it was known/suspected that the private key was compromised or that the certificate otherwise became invalid as ASN.1 TIME.</div> <br> <div><b>Sample:</b></div> <div>20190413202428Z</div> </td> </tr> <tr> <td class="elbow-placeholder"> </td> <td colspan="1">  <b>invalidity_date_critical</b>  <div> <span>boolean</span> </div> </td> <td>success</td> <td> <div>Whether the invalidity date extension is critical.</div> <br> </td> </tr> <tr> <td class="elbow-placeholder"> </td> <td colspan="1">  <b>issuer</b>  <div> <span>list</span> / <span>elements=string</span> </div> </td> <td>success</td> <td> <div>The certificate's issuer.</div> <br> <div><b>Sample:</b></div> <div>["DNS:ca.example.org"]</div> </td> </tr> <tr> <td class="elbow-placeholder"> </td> <td colspan="1">  <b>issuer_critical</b>  <div> <span>boolean</span> </div> </td> <td>success</td> <td> <div>Whether the certificate issuer extension is critical.</div> <br> </td> </tr> <tr> <td class="elbow-placeholder"> </td> <td colspan="1">  <b>reason</b>  <div> <span>string</span> </div> </td> <td>success</td> <td> <div>The value for the revocation reason extension.</div> <div>One of <code>unspecified</code>, <code>key_compromise</code>, <code>ca_compromise</code>, <code>affiliation_changed</code>, <code>superseded</code>, <code>cessation_of_operation</code>, <code>certificate_hold</code>, <code>privilege_withdrawn</code>, <code>aa_compromise</code>, and <code>remove_from_crl</code>.</div> <br> <div><b>Sample:</b></div> <div>key_compromise</div> </td> </tr> <tr> <td class="elbow-placeholder"> </td> <td colspan="1">  <b>reason_critical</b>  <div> <span>boolean</span> </div> </td> <td>success</td> <td> <div>Whether the revocation reason extension is critical.</div> <br> </td> </tr> <tr> <td class="elbow-placeholder"> </td> <td colspan="1">  <b>revocation_date</b>  <div> <span>string</span> </div> </td> <td>success</td> <td> <div>The point in time the certificate was revoked as ASN.1 TIME.</div> <br> <div><b>Sample:</b></div> <div>20190413202428Z</div> </td> </tr> <tr> <td class="elbow-placeholder"> </td> <td colspan="1">  <b>serial_number</b>  <div> <span>integer</span> </div> </td> <td>success</td> <td> <div>Serial number of the certificate.</div> <br> <div><b>Sample:</b></div> <div>1234</div> </td> </tr> </table> <br><br> <h3 id="authors">Authors</h3> <ul class="simple"> <li>Felix Fontein (@felixfontein)</li> </ul><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2012&ndash;2018 Michael DeHaan<br>&copy; 2018&ndash;2021 Red Hat, Inc.<br>Licensed under the GNU General Public License version 3.<br>
    <a href="https://docs.ansible.com/ansible/latest/collections/community/crypto/x509_crl_module.html" class="_attribution-link">https://docs.ansible.com/ansible/latest/collections/community/crypto/x509_crl_module.html</a>
  </p>
</div>
