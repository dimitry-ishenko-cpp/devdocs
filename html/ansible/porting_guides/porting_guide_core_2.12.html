<section id="ansible-core-2-12-porting-guide"> <h1 id="porting-2-12-guide-core">Ansible-core 2.12 Porting Guide</h1> <p>This section discusses the behavioral changes between <code>ansible-core</code> 2.11 and <code>ansible-core</code> 2.12.</p> <p>It is intended to assist in updating your playbooks, plugins and other parts of your Ansible infrastructure so they will work with this version of Ansible.</p> <p>We suggest you read this page along with <a class="reference external" href="https://github.com/ansible/ansible/blob/stable-2.12/changelogs/CHANGELOG-v2.12.rst">ansible-core Changelog for 2.12</a> to understand what updates you may need to make.</p> <p>This document is part of a collection on porting. The complete list of porting guides can be found at <a class="reference internal" href="porting_guides.html#porting-guides"><span class="std std-ref">porting guides</span></a>.</p>   <ul> <li><a class="reference internal" href="#playbook" id="id2">Playbook</a></li> <li><a class="reference internal" href="#python-interpreter-discovery" id="id3">Python Interpreter Discovery</a></li> <li><a class="reference internal" href="#command-line" id="id4">Command Line</a></li> <li><a class="reference internal" href="#deprecated" id="id5">Deprecated</a></li> <li>
<p><a class="reference internal" href="#modules" id="id6">Modules</a></p> <ul> <li><a class="reference internal" href="#modules-removed" id="id7">Modules removed</a></li> <li><a class="reference internal" href="#deprecation-notices" id="id8">Deprecation notices</a></li> <li><a class="reference internal" href="#noteworthy-module-changes" id="id9">Noteworthy module changes</a></li> </ul> </li> <li><a class="reference internal" href="#plugins" id="id10">Plugins</a></li> <li><a class="reference internal" href="#porting-custom-scripts" id="id11">Porting custom scripts</a></li> <li><a class="reference internal" href="#networking" id="id12">Networking</a></li> </ul>
  <section id="playbook"> <h2>Playbook</h2> <ul class="simple"> <li>When calling tasks and setting <code>async</code>, setting <code>ANSIBLE_ASYNC_DIR</code> under <code>environment:</code> is no longer valid. Instead, use the shell configuration variable <code>async_dir</code>, for example by setting <code>ansible_async_dir</code>:</li> </ul> <pre data-language="yaml">tasks:
  - dnf:
      name: '*'
      state: latest
    async: 300
    poll: 5
    vars:
      ansible_async_dir: /path/to/my/custom/dir
</pre> <ul class="simple"> <li>The <code>undef()</code> function is added to the templating environment for creating undefined variables directly in a template. Optionally, a hint may be provided for variables which are intended to be overridden.</li> </ul> <pre data-language="yaml">vars:
  old: "{{ undef }}"
  new: "{{ undef() }}"
  new_with_hint: "{{ undef(hint='You must override this variable') }}"
</pre> </section> <section id="python-interpreter-discovery"> <h2>Python Interpreter Discovery</h2> <p>The default value of <code>INTERPRETER_PYTHON</code> changed to <code>auto</code>. The list of Python interpreters in <code>INTERPRETER_PYTHON_FALLBACK</code> changed to prefer Python 3 over Python 2. The combination of these two changes means the new default behavior is to quietly prefer Python 3 over Python 2 on remote hosts. Previously a deprecation warning was issued in situations where interpreter discovery would have used Python 3 but the interpreter was set to <code>/usr/bin/python</code>.</p> <p><code>INTERPRETER_PYTHON_FALLBACK</code> can be changed from the default list of interpreters by setting the <code>ansible_interpreter_python_fallback</code> variable.</p> <p>See <a class="reference internal" href="../reference_appendices/interpreter_discovery.html#interpreter-discovery"><span class="std std-ref">interpreter discovery documentation</span></a> for more details.</p> </section> <section id="command-line"> <h2>Command Line</h2> <ul class="simple"> <li>Python 3.8 on the controller node is a hard requirement for this release. The command line scripts will not function with a lower Python version.</li> <li>
<code>ansible-vault</code> no longer supports <code>PyCrypto</code> and requires <code>cryptography</code>.</li> </ul> </section> <section id="deprecated"> <h2>Deprecated</h2> <ul class="simple"> <li>Python 2.6 on the target node is deprecated in this release. <code>ansible-core</code> 2.13 will remove support for Python 2.6.</li> <li>Bare variables in conditionals: <code>when</code> conditionals no longer automatically parse string booleans such as <code>"true"</code> and <code>"false"</code> into actual booleans. Any variable containing a non-empty string is considered true. This was previously configurable with the <code>CONDITIONAL_BARE_VARS</code> configuration option (and the <code>ANSIBLE_CONDITIONAL_BARE_VARS</code> environment variable). This setting no longer has any effect. Users can work around the issue by using the <code>|bool</code> filter:</li> </ul> <pre data-language="yaml">vars:
  teardown: 'false'

tasks:
  - include_tasks: teardown.yml
    when: teardown | bool

  - include_tasks: provision.yml
    when: not teardown | bool
</pre> <ul class="simple"> <li>The <code>_remote_checksum()</code> method in <code>ActionBase</code> is deprecated. Any action plugin using this method should use <code>_execute_remote_stat()</code> instead.</li> </ul> </section> <section id="modules"> <h2>Modules</h2> <ul class="simple"> <li>
<code>cron</code> now requires <code>name</code> to be specified in all cases.</li> <li>
<code>cron</code> no longer allows a <code>reboot</code> parameter. Use <code>special_time: reboot</code> instead.</li> <li>
<code>hostname</code> - On FreeBSD, the <code>before</code> result will no longer be <code>"temporarystub"</code> if permanent hostname file does not exist. It will instead be <code>""</code> (empty string) for consistency with other systems.</li> <li>
<code>hostname</code> - On OpenRC and Solaris based systems, the <code>before</code> result will no longer be <code>"UNKNOWN"</code> if the permanent hostname file does not exist. It will instead be <code>""</code> (empty string) for consistency with other systems.</li> <li>
<code>pip</code> now uses the <code>pip</code> Python module installed for the Ansible module’s Python interpreter, if available, unless <code>executable</code> or <code>virtualenv</code> were specified.</li> </ul> <section id="modules-removed"> <h3>Modules removed</h3> <p>The following modules no longer exist:</p> <ul class="simple"> <li>No notable changes</li> </ul> </section> <section id="deprecation-notices"> <h3>Deprecation notices</h3> <p>No notable changes</p> </section> <section id="noteworthy-module-changes"> <h3>Noteworthy module changes</h3> <p>No notable changes</p> </section> </section> <section id="plugins"> <h2>Plugins</h2> <ul class="simple"> <li>
<code>unique</code> filter with Jinja2 &lt; 2.10 is case-sensitive and now raise coherently an error if <code>case_sensitive=False</code> instead of when <code>case_sensitive=True</code>.</li> <li>Set theory filters (<code>intersect</code>, <code>difference</code>, <code>symmetric_difference</code> and <code>union</code>) are now case-sensitive. Explicitly use <code>case_sensitive=False</code> to keep previous behavior. Note: with Jinja2 &lt; 2.10, the filters were already case-sensitive by default.</li> <li>
<code>password_hash`</code> now uses <code>passlib</code> defaults when an option is unspecified, for example <code>bcrypt_sha256</code> now default to the “2b” format and if the “2a” format is required it must be specified.</li> </ul> </section> <section id="porting-custom-scripts"> <h2>Porting custom scripts</h2> <p>No notable changes</p> </section> <section id="networking"> <h2>Networking</h2> <p>No notable changes</p> </section> </section><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2012&ndash;2018 Michael DeHaan<br>&copy; 2018&ndash;2024 Red Hat, Inc.<br>Licensed under the GNU General Public License version 3.<br>
    <a href="https://docs.ansible.com/ansible/latest/porting_guides/porting_guide_core_2.12.html" class="_attribution-link">https://docs.ansible.com/ansible/latest/porting_guides/porting_guide_core_2.12.html</a>
  </p>
</div>
