<section id="ansible-core-2-17-porting-guide"> <h1 id="porting-2-17-guide-core">Ansible-core 2.17 Porting Guide</h1> <p>This section discusses the behavioral changes between <code>ansible-core</code> 2.16 and <code>ansible-core</code> 2.17.</p> <p>It is intended to assist in updating your playbooks, plugins and other parts of your Ansible infrastructure so they will work with this version of Ansible.</p> <p>We suggest you read this page along with <a class="reference external" href="https://github.com/ansible/ansible/blob/stable-2.17/changelogs/CHANGELOG-v2.17.rst">ansible-core Changelog for 2.17</a> to understand what updates you may need to make.</p> <p>This document is part of a collection on porting. The complete list of porting guides can be found at <a class="reference internal" href="porting_guides.html#porting-guides"><span class="std std-ref">porting guides</span></a>.</p>   <ul> <li><a class="reference internal" href="#playbook" id="id2">Playbook</a></li> <li><a class="reference internal" href="#command-line" id="id3">Command Line</a></li> <li><a class="reference internal" href="#deprecated" id="id4">Deprecated</a></li> <li>
<p><a class="reference internal" href="#modules" id="id5">Modules</a></p> <ul> <li><a class="reference internal" href="#modules-removed" id="id6">Modules removed</a></li> <li><a class="reference internal" href="#deprecation-notices" id="id7">Deprecation notices</a></li> <li><a class="reference internal" href="#noteworthy-module-changes" id="id8">Noteworthy module changes</a></li> </ul> </li> <li><a class="reference internal" href="#plugins" id="id9">Plugins</a></li> <li><a class="reference internal" href="#porting-custom-scripts" id="id10">Porting custom scripts</a></li> <li><a class="reference internal" href="#networking" id="id11">Networking</a></li> </ul>
  <section id="playbook"> <h2>Playbook</h2> <ul> <li>
<p>Conditionals - due to mitigation of security issue CVE-2023-5764 in ansible-core 2.16.1, conditional expressions with embedded template blocks can fail with the message “<code>Conditional is marked as unsafe, and cannot be evaluated.</code>” when an embedded template consults data from untrusted sources like module results or vars marked <code>!unsafe</code>. Conditionals with embedded templates can be a source of malicious template injection when referencing untrusted data, and can nearly always be rewritten without embedded templates. Playbook task conditional keywords such as <code>when</code> and <code>until</code> have long displayed warnings discouraging use of embedded templates in conditionals; this warning has been expanded to non-task conditionals as well, such as the <code>assert</code> action.</p> <pre data-language="yaml">- name: task with a module result (always untrusted by Ansible)
  shell: echo "hi mom"
  register: untrusted_result

# don't do it this way...
# - name: insecure conditional with embedded template consulting untrusted data
#   assert:
#     that: '"hi mom" is in {{ untrusted_result.stdout }}'

- name: securely access untrusted values directly as Jinja variables instead
  assert:
    that: '"hi mom" is in untrusted_result.stdout'
</pre> </li> <li>
<code>any_errors_fatal</code> - when a task in a block with a <code>rescue</code> section fails on a host, the <code>rescue</code> section is executed on all hosts. This occurs because <code>any_errors_fatal</code> automatically fails all hosts.</li> </ul> </section> <section id="command-line"> <h2>Command Line</h2> <ul class="simple"> <li>Python 2.7 and Python 3.6 are no longer supported remote versions. Python 3.7+ is now required for target execution.</li> </ul> </section> <section id="deprecated"> <h2>Deprecated</h2> <p>No notable changes</p> </section> <section id="modules"> <h2>Modules</h2> <p>No notable changes</p> <section id="modules-removed"> <h3>Modules removed</h3> <p>The following modules no longer exist:</p> <ul class="simple"> <li>No notable changes</li> </ul> </section> <section id="deprecation-notices"> <h3>Deprecation notices</h3> <p>No notable changes</p> </section> <section id="noteworthy-module-changes"> <h3>Noteworthy module changes</h3> <p>No notable changes</p> </section> </section> <section id="plugins"> <h2>Plugins</h2> <p>No notable changes</p> </section> <section id="porting-custom-scripts"> <h2>Porting custom scripts</h2> <p>No notable changes</p> </section> <section id="networking"> <h2>Networking</h2> <p>No notable changes</p> </section> </section><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2012&ndash;2018 Michael DeHaan<br>&copy; 2018&ndash;2024 Red Hat, Inc.<br>Licensed under the GNU General Public License version 3.<br>
    <a href="https://docs.ansible.com/ansible/latest/porting_guides/porting_guide_core_2.17.html" class="_attribution-link">https://docs.ansible.com/ansible/latest/porting_guides/porting_guide_core_2.17.html</a>
  </p>
</div>
