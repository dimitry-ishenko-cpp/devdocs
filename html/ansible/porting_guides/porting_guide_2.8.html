<section id="ansible-2-8-porting-guide"> <h1 id="porting-2-8-guide">Ansible 2.8 Porting Guide</h1> <p>This section discusses the behavioral changes between Ansible 2.7 and Ansible 2.8.</p> <p>It is intended to assist in updating your playbooks, plugins and other parts of your Ansible infrastructure so they will work with this version of Ansible.</p> <p>We suggest you read this page along with <a class="reference external" href="https://github.com/ansible/ansible/blob/stable-2.8/changelogs/CHANGELOG-v2.8.rst">Ansible Changelog for 2.8</a> to understand what updates you may need to make.</p> <p>This document is part of a collection on porting. The complete list of porting guides can be found at <a class="reference internal" href="porting_guides.html#porting-guides"><span class="std std-ref">porting guides</span></a>.</p>  <ul class="simple"> <li>
<p><a class="reference internal" href="#playbook" id="id2">Playbook</a></p> <ul> <li><a class="reference internal" href="#distribution-facts" id="id3">Distribution Facts</a></li> <li><a class="reference internal" href="#imports-as-handlers" id="id4">Imports as handlers</a></li> <li><a class="reference internal" href="#jinja-undefined-values" id="id5">Jinja Undefined values</a></li> <li><a class="reference internal" href="#module-option-conversion-to-string" id="id6">Module option conversion to string</a></li> <li><a class="reference internal" href="#command-line-facts" id="id7">Command line facts</a></li> <li>
<p><a class="reference internal" href="#bare-variables-in-conditionals" id="id8">Bare variables in conditionals</a></p> <ul> <li><a class="reference internal" href="#updating-your-playbooks" id="id9">Updating your playbooks</a></li> <li><a class="reference internal" href="#double-interpolation" id="id10">Double-interpolation</a></li> <li><a class="reference internal" href="#nested-variables" id="id11">Nested variables</a></li> </ul> </li> <li><a class="reference internal" href="#gathering-facts" id="id12">Gathering Facts</a></li> </ul> </li> <li>
<p><a class="reference internal" href="#python-interpreter-discovery" id="id13">Python Interpreter Discovery</a></p> <ul> <li><a class="reference internal" href="#retry-file-creation-default" id="id14">Retry File Creation default</a></li> </ul> </li> <li>
<p><a class="reference internal" href="#command-line" id="id15">Command Line</a></p> <ul> <li><a class="reference internal" href="#become-prompting" id="id16">Become Prompting</a></li> </ul> </li> <li><a class="reference internal" href="#deprecated" id="id17">Deprecated</a></li> <li>
<p><a class="reference internal" href="#modules" id="id18">Modules</a></p> <ul> <li><a class="reference internal" href="#modules-removed" id="id19">Modules removed</a></li> <li><a class="reference internal" href="#deprecation-notices" id="id20">Deprecation notices</a></li> <li><a class="reference internal" href="#noteworthy-module-changes" id="id21">Noteworthy module changes</a></li> </ul> </li> <li><a class="reference internal" href="#plugins" id="id22">Plugins</a></li> <li>
<p><a class="reference internal" href="#porting-custom-scripts" id="id23">Porting custom scripts</a></p> <ul> <li><a class="reference internal" href="#display-class" id="id24">Display class</a></li> </ul> </li> <li><a class="reference internal" href="#networking" id="id25">Networking</a></li> </ul>  <section id="playbook"> <h2>Playbook</h2> <section id="distribution-facts"> <h3>Distribution Facts</h3> <p>The information returned for the <code>ansible_distribution_*</code> group of facts may have changed slightly. Ansible 2.8 uses a new backend library for information about distributions: <a class="reference external" href="https://github.com/nir0s/distro">nir0s/distro</a>. This library runs on Python-3.8 and fixes many bugs, including correcting release and version names.</p> <p>The two facts used in playbooks most often, <code>ansible_distribution</code> and <code>ansible_distribution_major_version</code>, should not change. If you discover a change in these facts, please file a bug so we can address the difference. However, other facts like <code>ansible_distribution_release</code> and <code>ansible_distribution_version</code> may change as erroneous information gets corrected.</p> </section> <section id="imports-as-handlers"> <h3>Imports as handlers</h3> <p>Beginning in version 2.8, a task cannot notify <code>import_tasks</code> or a static <code>include</code> that is specified in <code>handlers</code>.</p> <p>The goal of a static import is to act as a pre-processor, where the import is replaced by the tasks defined within the imported file. When using an import, a task can notify any of the named tasks within the imported file, but not the name of the import itself.</p> <p>To achieve the results of notifying a single name but running multiple handlers, utilize <code>include_tasks</code>, or <code>listen</code> <a class="reference internal" href="../playbook_guide/playbooks_handlers.html#handlers"><span class="std std-ref">Handlers: running operations on change</span></a>.</p> </section> <section id="jinja-undefined-values"> <h3>Jinja Undefined values</h3> <p>Beginning in version 2.8, attempting to access an attribute of an Undefined value in Jinja will return another Undefined value, rather than throwing an error immediately. This means that you can now simply use a default with a value in a nested data structure when you don’t know if the intermediate values are defined.</p> <p>In Ansible 2.8:</p> <pre data-language="YAML+Jinja">{{ foo.bar.baz | default('DEFAULT') }}
</pre> <p>In Ansible 2.7 and older:</p> <pre data-language="YAML+Jinja">{{ ((foo | default({})).bar | default({})).baz | default('DEFAULT') }}
</pre> <p>or:</p> <pre data-language="YAML+Jinja">{{ foo.bar.baz if (foo is defined and foo.bar is defined and foo.bar.baz is defined) else 'DEFAULT' }}
</pre> </section> <section id="module-option-conversion-to-string"> <h3>Module option conversion to string</h3> <p>Beginning in version 2.8, Ansible will warn if a module expects a string, but a non-string value is passed and automatically converted to a string. This highlights potential problems where, for example, a <code>yes</code> or <code>true</code> (parsed as truish boolean value) would be converted to the string <code>'True'</code>, or where a version number <code>1.10</code> (parsed as float value) would be converted to <code>'1.1'</code>. Such conversions can result in unexpected behavior depending on context.</p> <p>This behavior can be changed to be an error or to be ignored by setting the <code>ANSIBLE_STRING_CONVERSION_ACTION</code> environment variable, or by setting the <code>string_conversion_action</code> configuration in the <code>defaults</code> section of <code>ansible.cfg</code>.</p> </section> <section id="command-line-facts"> <h3>Command line facts</h3> <p><code>cmdline</code> facts returned in system will be deprecated in favor of <code>proc_cmdline</code>. This change handles special case where Kernel command line parameter contains multiple values with the same key.</p> </section> <section id="bare-variables-in-conditionals"> <h3>Bare variables in conditionals</h3> <p>In Ansible 2.7 and earlier, top-level variables sometimes treated boolean strings as if they were boolean values. This led to inconsistent behavior in conditional tests built on top-level variables defined as strings. Ansible 2.8 began changing this behavior. For example, if you set two conditions like this:</p> <pre data-language="yaml">tasks:
  - include_tasks: teardown.yml
    when: teardown

  - include_tasks: provision.yml
    when: not teardown
</pre> <p>based on a variable you define <strong>as a string</strong> (with quotation marks around it):</p> <ul class="simple"> <li>In Ansible 2.7 and earlier, the two conditions above evaluated as <code>True</code> and <code>False</code> respectively if <code>teardown: 'true'</code>
</li> <li>In Ansible 2.7 and earlier, both conditions evaluated as <code>False</code> if <code>teardown: 'false'</code>
</li> <li>In Ansible 2.8 and later, you have the option of disabling conditional bare variables, so <code>when: teardown</code> always evaluates as <code>True</code> and <code>when: not teardown</code> always evaluates as <code>False</code> when <code>teardown</code> is a non-empty string (including <code>'true'</code> or <code>'false'</code>)</li> </ul> <p>Ultimately, <code>when: 'string'</code> will always evaluate as <code>True</code> and <code>when: not 'string'</code> will always evaluate as <code>False</code>, as long as <code>'string'</code> is not empty, even if the value of <code>'string'</code> itself looks like a boolean. For users with playbooks that depend on the old behavior, we added a config setting that preserves it. You can use the <code>ANSIBLE_CONDITIONAL_BARE_VARS</code> environment variable or <code>conditional_bare_variables</code> in the <code>defaults</code> section of <code>ansible.cfg</code> to select the behavior you want on your control node. The default setting is <code>true</code>, which preserves the old behavior. Set the config value or environment variable to <code>false</code> to start using the new option.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>In 2.10 the default setting for <code>conditional_bare_variables</code> will change to <code>false</code>. In 2.12 the old behavior will be deprecated.</p> </div> <section id="updating-your-playbooks"> <h4>Updating your playbooks</h4> <p>To prepare your playbooks for the new behavior, you must update your conditional statements so they accept only boolean values. For variables, you can use the <code>bool</code> filter to evaluate the string <code>'false'</code> as <code>False</code>:</p> <pre data-language="yaml">vars:
  teardown: 'false'

tasks:
  - include_tasks: teardown.yml
    when: teardown | bool

  - include_tasks: provision.yml
    when: not teardown | bool
</pre> <p>Alternatively, you can re-define your variables as boolean values (without quotation marks) instead of strings:</p> <pre data-language="yaml">vars:
  teardown: false

tasks:
  - include_tasks: teardown.yml
    when: teardown

  - include_tasks: provision.yml
    when: not teardown
</pre> <p>For dictionaries and lists, use the <code>length</code> filter to evaluate the presence of a dictionary or list as <code>True</code>:</p> <pre data-language="yaml+jinja">- debug:
  when: my_list | length &gt; 0

- debug:
  when: my_dictionary | length &gt; 0
</pre> <p>Do not use the <code>bool</code> filter with lists or dictionaries. If you use <code>bool</code> with a list or dict, Ansible will always evaluate it as <code>False</code>.</p> </section> <section id="double-interpolation"> <h4>Double-interpolation</h4> <p>The <code>conditional_bare_variables</code> setting also affects variables set based on other variables. The old behavior unexpectedly double-interpolated those variables. For example:</p> <pre data-language="yaml">vars:
  double_interpolated: 'bare_variable'
  bare_variable: false

tasks:
  - debug:
    when: double_interpolated
</pre> <ul class="simple"> <li>In Ansible 2.7 and earlier, <code>when: double_interpolated</code> evaluated to the value of <code>bare_variable</code>, in this case, <code>False</code>. If the variable <code>bare_variable</code> is undefined, the conditional fails.</li> <li>In Ansible 2.8 and later, with bare variables disabled, Ansible evaluates <code>double_interpolated</code> as the string <code>'bare_variable'</code>, which is <code>True</code>.</li> </ul> <p>To double-interpolate variable values, use curly braces:</p> <pre data-language="yaml+jinja">vars:
  double_interpolated: "{{ other_variable }}"
  other_variable: false
</pre> </section> <section id="nested-variables"> <h4>Nested variables</h4> <p>The <code>conditional_bare_variables</code> setting does not affect nested variables. Any string value assigned to a subkey is already respected and not treated as a boolean. If <code>complex_variable['subkey']</code> is a non-empty string, then <code>when: complex_variable['subkey']</code> is always <code>True</code> and <code>when: not complex_variable['subkey']</code> is always <code>False</code>. If you want a string subkey like <code>complex_variable['subkey']</code> to be evaluated as a boolean, you must use the <code>bool</code> filter.</p> </section> </section> <section id="gathering-facts"> <h3>Gathering Facts</h3> <p>In Ansible 2.8 the implicit “Gathering Facts” task in a play was changed to obey play tags. Previous to 2.8, the “Gathering Facts” task would ignore play tags and tags supplied from the command line and always run in a task.</p> <p>The behavior change affects the following example play.</p> <pre data-language="yaml">- name: Configure Webservers
  hosts: webserver
  tags:
    - webserver
  tasks:
    - name: Install nginx
      package:
        name: nginx
      tags:
        - nginx
</pre> <p>In Ansible 2.8, if you supply <code>--tags nginx</code>, the implicit “Gathering Facts” task will be skipped, as the task now inherits the tag of <code>webserver</code> instead of <code>always</code>.</p> <p>If no play level tags are set, the “Gathering Facts” task will be given a tag of <code>always</code> and will effectively match prior behavior.</p> <p>You can achieve similar results to the pre-2.8 behavior, by using an explicit <code>gather_facts</code> task in your <code>tasks</code> list.</p> <pre data-language="yaml">- name: Configure Webservers
  hosts: webserver
  gather_facts: false
  tags:
    - webserver
  tasks:
    - name: Gathering Facts
      gather_facts:
      tags:
        - always

    - name: Install nginx
      package:
        name: nginx
      tags:
        - nginx
</pre> </section> </section> <section id="python-interpreter-discovery"> <h2>Python Interpreter Discovery</h2> <p>In Ansible 2.7 and earlier, Ansible defaulted to <strong class="command">/usr/bin/python</strong> as the setting for <code>ansible_python_interpreter</code>. If you ran Ansible against a system that installed Python with a different name or a different path, your playbooks would fail with <code>/usr/bin/python: bad interpreter: No such file or directory</code> unless you either set <code>ansible_python_interpreter</code> to the correct value for that system or added a Python interpreter and any necessary dependencies at <strong class="command">usr/bin/python</strong>.</p> <p>Starting in Ansible 2.8, Ansible searches for the correct path and executable name for Python on each target system, first in a lookup table of default Python interpreters for common distros, then in an ordered fallback list of possible Python interpreter names/paths.</p> <p>It’s risky to rely on a Python interpreter set from the fallback list, because the interpreter may change on future runs. If an interpreter from higher in the fallback list gets installed (for example, as a side-effect of installing other packages), your original interpreter and its dependencies will no longer be used. For this reason, Ansible warns you when it uses a Python interpreter discovered from the fallback list. If you see this warning, the best solution is to explicitly set <code>ansible_python_interpreter</code> to the path of the correct interpreter for those target systems.</p> <p>You can still set <code>ansible_python_interpreter</code> to a specific path at any variable level (as a host variable, in vars files, in playbooks, and so on). If you prefer to use the Python interpreter discovery behavior, use one of the four new values for <code>ansible_python_interpreter</code> introduced in Ansible 2.8:</p> <table class="docutils align-default"> <thead> <tr>
<th class="head"><p>New value</p></th> <th class="head"><p>Behavior</p></th> </tr> </thead>  <tr>
<td><p>auto <br> (future default)</p></td> <td><p>If a Python interpreter is discovered, Ansible uses the discovered Python, even if <strong class="command">/usr/bin/python</strong> is also present. Warns when using the fallback list.</p></td> </tr> <tr>
<td><p><strong>auto_legacy</strong> <br> (Ansible 2.8 default)</p></td> <td>
<p>If a Python interpreter is discovered, and <strong class="command">/usr/bin/python</strong> is absent, Ansible uses the discovered Python. Warns when using the fallback list.</p> <p>If a Python interpreter is discovered, and <strong class="command">/usr/bin/python</strong> is present, Ansible uses <strong class="command">/usr/bin/python</strong> and prints a deprecation warning about future default behavior. Warns when using the fallback list.</p> </td> </tr> <tr>
<td><p>auto_legacy_silent</p></td> <td><p>Behaves like <code>auto_legacy</code> but suppresses the deprecation and fallback-list warnings.</p></td> </tr> <tr>
<td><p>auto_silent</p></td> <td><p>Behaves like <code>auto</code> but suppresses the fallback-list warning.</p></td> </tr>  </table> <p>In Ansible 2.12, Ansible will switch the default from <code>auto_legacy</code> to <code>auto</code>. The difference in behaviour is that <code>auto_legacy</code> uses <strong class="command">/usr/bin/python</strong> if present and falls back to the discovered Python when it is not present. <code>auto</code> will always use the discovered Python, regardless of whether <strong class="command">/usr/bin/python</strong> exists. The <code>auto_legacy</code> setting provides compatibility with previous versions of Ansible that always defaulted to <strong class="command">/usr/bin/python</strong>.</p> <p>If you installed Python and dependencies (<code>boto</code>, and so on) to <strong class="command">/usr/bin/python</strong> as a workaround on distros with a different default Python interpreter (for example, Ubuntu 16.04+, RHEL8, Fedora 23+), you have two options:</p>  <ol class="arabic simple"> <li>Move existing dependencies over to the default Python for each platform/distribution/version.</li> <li>Use <code>auto_legacy</code>. This setting lets Ansible find and use the workaround Python on hosts that have it, while also finding the correct default Python on newer hosts. But remember, the default will change in 4 releases.</li> </ol>  <section id="retry-file-creation-default"> <h3>Retry File Creation default</h3> <p>In Ansible 2.8, <code>retry_files_enabled</code> now defaults to <code>False</code> instead of <code>True</code>. The behavior can be modified to previous version by editing the default <code>ansible.cfg</code> file and setting the value to <code>True</code>.</p> </section> </section> <section id="command-line"> <h2>Command Line</h2> <section id="become-prompting"> <h3>Become Prompting</h3> <p>Beginning in version 2.8, by default Ansible will use the word <code>BECOME</code> to prompt you for a password for elevated privileges (<code>sudo</code> privileges on Unix systems or <code>enable</code> mode on network devices):</p> <p>By default in Ansible 2.8:</p> <pre data-language="YAML+Jinja">ansible-playbook --become --ask-become-pass site.yml
BECOME password:
</pre> <p>If you want the prompt to display the specific <code>become_method</code> you’re using, instead of the general value <code>BECOME</code>, set <a class="reference internal" href="../reference_appendices/config.html#agnostic-become-prompt"><span class="std std-ref">AGNOSTIC_BECOME_PROMPT</span></a> to <code>False</code> in your Ansible configuration.</p> <p>By default in Ansible 2.7, or with <code>AGNOSTIC_BECOME_PROMPT=False</code> in Ansible 2.8:</p> <pre data-language="YAML+Jinja">ansible-playbook --become --ask-become-pass site.yml
SUDO password:
</pre> </section> </section> <section id="deprecated"> <h2>Deprecated</h2> <ul> <li>
<p>Setting the async directory using <code>ANSIBLE_ASYNC_DIR</code> as an task/play environment key is deprecated and will be removed in Ansible 2.12. You can achieve the same result by setting <code>ansible_async_dir</code> as a variable like:</p> <pre data-language="YAML+Jinja">- name: run task with custom async directory
  command: sleep 5
  async: 10
  vars:
    ansible_async_dir: /tmp/.ansible_async
</pre> </li> <li>
<p>Plugin writers who need a <code>FactCache</code> object should be aware of two deprecations:</p> <ol class="arabic simple"> <li>The <code>FactCache</code> class has moved from <code>ansible.plugins.cache.FactCache</code> to <code>ansible.vars.fact_cache.FactCache</code>. This is because the <code>FactCache</code> is not part of the cache plugin API and cache plugin authors should not be subclassing it. <code>FactCache</code> is still available from its old location but will issue a deprecation warning when used from there. The old location will be removed in Ansible 2.12.</li> <li>The <code>FactCache.update()</code> method has been converted to follow the dict API. It now takes a dictionary as its sole argument and updates itself with the dictionary’s items. The previous API where <code>update()</code> took a key and a value will now issue a deprecation warning and will be removed in 2.12. If you need the old behavior switch to <code>FactCache.first_order_merge()</code> instead.</li> </ol> </li> <li>Supporting file-backed caching through self.cache is deprecated and will be removed in Ansible 2.12. If you maintain an inventory plugin, update it to use <code>self._cache</code> as a dictionary. For implementation details, see the <a class="reference internal" href="https://docs.ansible.com/ansible/latest/dev_guide/developing_inventory.html#inventory-plugin-caching"><span class="std std-ref">developer guide on inventory plugins</span></a>.</li> <li>
<p>Importing cache plugins directly is deprecated and will be removed in Ansible 2.12. Use the plugin_loader so direct options, environment variables, and other means of configuration can be reconciled using the config system rather than constants.</p> <pre data-language="python">from ansible.plugins.loader import cache_loader
cache = cache_loader.get('redis', **kwargs)
</pre> </li> </ul> </section> <section id="modules"> <h2>Modules</h2> <p>Major changes in popular modules are detailed here</p> <p>The exec wrapper that runs PowerShell modules has been changed to set <code>$ErrorActionPreference = "Stop"</code> globally. This may mean that custom modules can fail if they implicitly relied on this behavior. To get the old behavior back, add <code>$ErrorActionPreference = "Continue"</code> to the top of the module. This change was made to restore the old behavior of the EAP that was accidentally removed in a previous release and ensure that modules are more resilient to errors that may occur in execution.</p> <ul class="simple"> <li>Version 2.8.14 of Ansible changed the default mode of file-based tasks to <code>0o600 &amp; ~umask</code> when the user did not specify a <code>mode</code> parameter on file-based tasks. This was in response to a CVE report which we have reconsidered. As a result, the <code>mode</code> change has been reverted in 2.8.15, and <code>mode</code> will now default to <code>0o666 &amp; ~umask</code> as in previous versions of Ansible.</li> <li>If you changed any tasks to specify less restrictive permissions while using 2.8.14, those changes will be unnecessary (but will do no harm) in 2.8.15.</li> <li>To avoid the issue raised in CVE-2020-1736, specify a <code>mode</code> parameter in all file-based tasks that accept it.</li> <li>
<code>dnf</code> and <code>yum</code> - As of version 2.8.15, the <code>dnf</code> module (and <code>yum</code> action when it uses <code>dnf</code>) now correctly validates GPG signatures of packages (CVE-2020-14365). If you see an error such as <code>Failed to validate GPG signature for [package name]</code>, please ensure that you have imported the correct GPG key for the DNF repository and/or package you are using. One way to do this is with the <code>rpm_key</code> module. Although we discourage it, in some cases it may be necessary to disable the GPG check. This can be done by explicitly adding <code>disable_gpg_check: yes</code> in your <code>dnf</code> or <code>yum</code> task.</li> </ul> <section id="modules-removed"> <h3>Modules removed</h3> <p>The following modules no longer exist:</p> <ul class="simple"> <li>ec2_remote_facts</li> <li>azure</li> <li>cs_nic</li> <li>netscaler</li> <li>win_msi</li> </ul> </section> <section id="deprecation-notices"> <h3>Deprecation notices</h3> <p>The following modules will be removed in Ansible 2.12. Please update your playbooks accordingly.</p> <ul class="simple"> <li>
<code>foreman</code> use <a class="reference external" href="https://github.com/theforeman/foreman-ansible-modules">foreman-ansible-modules</a> instead.</li> <li>
<code>katello</code> use <a class="reference external" href="https://github.com/theforeman/foreman-ansible-modules">foreman-ansible-modules</a> instead.</li> <li>
<code>github_hooks</code> use <span class="xref std std-ref">github_webhook</span> and <span class="xref std std-ref">github_webhook_facts</span> instead.</li> <li>
<code>digital_ocean</code> use <span class="xref std std-ref">digital_ocean_droplet</span> instead.</li> <li>
<code>gce</code> use <span class="xref std std-ref">gcp_compute_instance</span> instead.</li> <li>
<code>gcspanner</code> use <span class="xref std std-ref">gcp_spanner_instance</span> and <span class="xref std std-ref">gcp_spanner_database</span> instead.</li> <li>
<code>gcdns_record</code> use <span class="xref std std-ref">gcp_dns_resource_record_set</span> instead.</li> <li>
<code>gcdns_zone</code> use <span class="xref std std-ref">gcp_dns_managed_zone</span> instead.</li> <li>
<code>gcp_forwarding_rule</code> use <span class="xref std std-ref">gcp_compute_global_forwarding_rule</span> or <span class="xref std std-ref">gcp_compute_forwarding_rule</span> instead.</li> <li>
<code>gcp_healthcheck</code> use <span class="xref std std-ref">gcp_compute_health_check</span>, <span class="xref std std-ref">gcp_compute_http_health_check</span>, or <span class="xref std std-ref">gcp_compute_https_health_check</span> instead.</li> <li>
<code>gcp_backend_service</code> use <span class="xref std std-ref">gcp_compute_backend_service</span> instead.</li> <li>
<code>gcp_target_proxy</code> use <span class="xref std std-ref">gcp_compute_target_http_proxy</span> instead.</li> <li>
<code>gcp_url_map</code> use <span class="xref std std-ref">gcp_compute_url_map</span> instead.</li> <li>
<code>panos</code> use the <a class="reference external" href="https://galaxy.ansible.com/PaloAltoNetworks/paloaltonetworks">Palo Alto Networks Ansible Galaxy role</a> instead.</li> </ul> </section> <section id="noteworthy-module-changes"> <h3>Noteworthy module changes</h3> <ul class="simple"> <li>The <code>foreman</code> and <code>katello</code> modules have been deprecated in favor of a set of modules that are broken out per entity with better idempotency in mind.</li> <li>The <code>foreman</code> and <code>katello</code> modules replacement is officially part of the Foreman Community and supported there.</li> <li>The <code>tower_credential</code> module originally required the <code>ssh_key_data</code> to be the path to a ssh_key_file. In order to work like AWX/Tower/RHAAP, <code>ssh_key_data</code> now contains the content of the file. The previous behavior can be achieved with <code>lookup('file', '/path/to/file')</code>.</li> <li>The <code>win_scheduled_task</code> module deprecated support for specifying a trigger repetition as a list and this format will be removed in Ansible 2.12. Instead specify the repetition as a dictionary value.</li> <li>The <code>win_feature</code> module has removed the deprecated <code>restart_needed</code> return value, use the standardized <code>reboot_required</code> value instead.</li> <li>The <code>win_package</code> module has removed the deprecated <code>restart_required</code> and <code>exit_code</code> return value, use the standardized <code>reboot_required</code> and <code>rc</code> value instead.</li> <li>The <code>win_get_url</code> module has removed the deprecated <code>win_get_url</code> return dictionary, contained values are returned directly.</li> <li>The <code>win_get_url</code> module has removed the deprecated <code>skip_certificate_validation</code> option, use the standardized <code>validate_certs</code> option instead.</li> <li>The <code>vmware_local_role_facts</code> module now returns a list of dicts instead of a dict of dicts for role information.</li> <li>If <code>docker_network</code> or <code>docker_volume</code> were called with <code>diff: yes</code>, <code>check_mode: yes</code> or <code>debug: yes</code>, a return value called <code>diff</code> was returned of type <code>list</code>. To enable proper diff output, this was changed to type <code>dict</code>; the original <code>list</code> is returned as <code>diff.differences</code>.</li> <li>The <code>na_ontap_cluster_peer</code> module has replaced <code>source_intercluster_lif</code> and <code>dest_intercluster_lif</code> string options with <code>source_intercluster_lifs</code> and <code>dest_intercluster_lifs</code> list options</li> <li>The <code>modprobe</code> module now detects kernel builtins. Previously, attempting to remove (with <code>state: absent</code>) a builtin kernel module succeeded without any error message because <code>modprobe</code> did not detect the module as <code>present</code>. Now, <code>modprobe</code> will fail if a kernel module is builtin and <code>state: absent</code> (with an error message from the modprobe binary like <code>modprobe: ERROR: Module nfs is builtin.</code>), and it will succeed without reporting changed if <code>state: present</code>. Any playbooks that are using <code>changed_when: no</code> to mask this quirk can safely remove that workaround. To get the previous behavior when applying <code>state: absent</code> to a builtin kernel module, use <code>failed_when: false</code> or <code>ignore_errors: true</code> in your playbook.</li> <li>The <code>digital_ocean</code> module has been deprecated in favor of modules that do not require external dependencies. This allows for more flexibility and better module support.</li> <li>The <code>docker_container</code> module has deprecated the returned fact <code>docker_container</code>. The same value is available as the returned variable <code>container</code>. The returned fact will be removed in Ansible 2.12.</li> <li>The <code>docker_network</code> module has deprecated the returned fact <code>docker_container</code>. The same value is available as the returned variable <code>network</code>. The returned fact will be removed in Ansible 2.12.</li> <li>The <code>docker_volume</code> module has deprecated the returned fact <code>docker_container</code>. The same value is available as the returned variable <code>volume</code>. The returned fact will be removed in Ansible 2.12.</li> <li>The <code>docker_service</code> module was renamed to <span class="xref std std-ref">docker_compose</span>.</li> <li>The renamed <code>docker_compose</code> module used to return one fact per service, named same as the service. A dictionary of these facts is returned as the regular return value <code>services</code>. The returned facts will be removed in Ansible 2.12.</li> <li>
<dl class="simple"> <dt>
<code>The docker_swarm_service module no longer sets a defaults for the following options:</code> </dt>
<dd>
<ul> <li>
<code>user</code>. Before, the default was <code>root</code>.</li> <li>
<code>update_delay</code>. Before, the default was <code>10</code>.</li> <li>
<code>update_parallelism</code>. Before, the default was <code>1</code>.</li> </ul> </dd> </dl> </li> <li>
<code>vmware_vm_facts</code> used to return dict of dict with virtual machine’s facts. Ansible 2.8 and onwards will return list of dict with virtual machine’s facts. Please see module <code>vmware_vm_facts</code> documentation for example.</li> <li>
<code>vmware_guest_snapshot</code> module used to return <code>results</code>. Since Ansible 2.8 and onwards <code>results</code> is a reserved keyword, it is replaced by <code>snapshot_results</code>. Please see module <code>vmware_guest_snapshots</code> documentation for example.</li> <li>The <code>panos</code> modules have been deprecated in favor of using the Palo Alto Networks <a class="reference external" href="https://galaxy.ansible.com/PaloAltoNetworks/paloaltonetworks">Ansible Galaxy role</a>. Contributions to the role can be made <a class="reference external" href="https://github.com/PaloAltoNetworks/ansible-pan">here</a>.</li> <li>The <code>ipa_user</code> module originally always sent <code>password</code> to FreeIPA regardless of whether the password changed. Now the module only sends <code>password</code> if <code>update_password</code> is set to <code>always</code>, which is the default.</li> <li>The <code>win_psexec</code> has deprecated the undocumented <code>extra_opts</code> module option. This will be removed in Ansible 2.10.</li> <li>The <code>win_nssm</code> module has deprecated the following options in favor of using the <code>win_service</code> module to configure the service after installing it with <code>win_nssm</code>: * <code>dependencies</code>, use <code>dependencies</code> of <code>win_service</code> instead * <code>start_mode</code>, use <code>start_mode</code> of <code>win_service</code> instead * <code>user</code>, use <code>username</code> of <code>win_service</code> instead * <code>password</code>, use <code>password</code> of <code>win_service</code> instead These options will be removed in Ansible 2.12.</li> <li>The <code>win_nssm</code> module has also deprecated the <code>start</code>, <code>stop</code>, and <code>restart</code> values of the <code>status</code> option. You should use the <code>win_service</code> module to control the running state of the service. This will be removed in Ansible 2.12.</li> <li>The <code>status</code> module option for <code>win_nssm</code> has changed its default value to <code>present</code>. Before, the default was <code>start</code>. Consequently, the service is no longer started by default after creation with <code>win_nssm</code>, and you should use the <code>win_service</code> module to start it if needed.</li> <li>The <code>app_parameters</code> module option for <code>win_nssm</code> has been deprecated; use <code>argument</code> instead. This will be removed in Ansible 2.12.</li> <li>The <code>app_parameters_free_form</code> module option for <code>win_nssm</code> has been aliased to the new <code>arguments</code> option.</li> <li>The <code>win_dsc</code> module will now validate the input options for a DSC resource. In previous versions invalid options would be ignored but are now not.</li> <li>The <code>openssl_pkcs12</code> module will now regenerate the pkcs12 file if there are differences between the file on disk and the parameters passed to the module.</li> </ul> </section> </section> <section id="plugins"> <h2>Plugins</h2> <ul> <li>Ansible no longer defaults to the <code>paramiko</code> connection plugin when using macOS as the control node. Ansible will now use the <code>ssh</code> connection plugin by default on a macOS control node. Since <code>ssh</code> supports connection persistence between tasks and playbook runs, it performs better than <code>paramiko</code>. If you are using password authentication, you will need to install <code>sshpass</code> when using the <code>ssh</code> connection plugin. Or you can explicitly set the connection type to <code>paramiko</code> to maintain the pre-2.8 behavior on macOS.</li> <li>Connection plugins have been standardized to allow use of <code>ansible_&lt;conn-type&gt;_user</code> and <code>ansible_&lt;conn-type&gt;_password</code> variables. Variables such as <code>ansible_&lt;conn-type&gt;_pass</code> and <code>ansible_&lt;conn-type&gt;_username</code> are treated with lower priority than the standardized names and may be deprecated in the future. In general, the <code>ansible_user</code> and <code>ansible_password</code> vars should be used unless there is a reason to use the connection-specific variables.</li> <li>The <code>powershell</code> shell plugin now uses <code>async_dir</code> to define the async path for the results file and the default has changed to <code>%USERPROFILE%\.ansible_async</code>. To control this path now, either set the <code>ansible_async_dir</code> variable or the <code>async_dir</code> value in the <code>powershell</code> section of the config ini.</li> <li>Order of enabled inventory plugins (<a class="reference internal" href="../reference_appendices/config.html#inventory-enabled"><span class="std std-ref">INVENTORY_ENABLED</span></a>) has been updated, <a class="reference internal" href="../collections/ansible/builtin/auto_inventory.html#auto-inventory"><span class="std std-ref">auto</span></a> is now before <a class="reference internal" href="../collections/ansible/builtin/yaml_inventory.html#yaml-inventory"><span class="std std-ref">yaml</span></a> and <a class="reference internal" href="../collections/ansible/builtin/ini_inventory.html#ini-inventory"><span class="std std-ref">ini</span></a>.</li> <li>
<p>The private <code>_options</code> attribute has been removed from the <code>CallbackBase</code> class of callback plugins. If you have a third-party callback plugin which needs to access the command line arguments, use code like the following instead of trying to use <code>self._options</code>:</p> <pre data-language="python">from ansible import context
[...]
tags = context.CLIARGS['tags']
</pre> <p><code>context.CLIARGS</code> is a read-only dictionary so normal dictionary retrieval methods like <code>CLIARGS.get('tags')</code> and <code>CLIARGS['tags']</code> work as expected but you won’t be able to modify the cli arguments at all.</p> </li> <li>Play recap now counts <code>ignored</code> and <code>rescued</code> tasks as well as <code>ok</code>, <code>changed</code>, <code>unreachable</code>, <code>failed</code> and <code>skipped</code> tasks, thanks to two additional stat counters in the <code>default</code> callback plugin. Tasks that fail and have <code>ignore_errors: yes</code> set are listed as <code>ignored</code>. Tasks that fail and then execute a rescue section are listed as <code>rescued</code>. Note that <code>rescued</code> tasks are no longer counted as <code>failed</code> as in Ansible 2.7 (and earlier).</li> <li>
<code>osx_say</code> callback plugin was renamed into <a class="reference external" href="https://docs.ansible.com/ansible/2.9/plugins/callback/say.html#say-callback" title="(in Ansible v2.9)"><span class="xref std std-ref">say</span></a>.</li> <li>Inventory plugins now support caching through cache plugins. To start using a cache plugin with your inventory see the section on caching in the <a class="reference internal" href="../plugins/inventory.html#using-inventory"><span class="std std-ref">inventory guide</span></a>. To port a custom cache plugin to be compatible with inventory see <a class="reference internal" href="https://docs.ansible.com/ansible/latest/dev_guide/developing_plugins.html#developing-cache-plugins"><span class="std std-ref">developer guide on cache plugins</span></a>.</li> </ul> </section> <section id="porting-custom-scripts"> <h2>Porting custom scripts</h2> <section id="display-class"> <h3>Display class</h3> <p>As of Ansible 2.8, the <code>Display</code> class is now a “singleton”. Instead of using <code>__main__.display</code> each file should import and instantiate <code>ansible.utils.display.Display</code> on its own.</p> <p><strong>OLD</strong> In Ansible 2.7 (and earlier) the following was used to access the <code>display</code> object:</p> <pre data-language="python">try:
    from __main__ import display
except ImportError:
    from ansible.utils.display import Display
    display = Display()
</pre> <p><strong>NEW</strong> In Ansible 2.8 the following should be used:</p> <pre data-language="python">from ansible.utils.display import Display
display = Display()
</pre> </section> </section> <section id="networking"> <h2>Networking</h2> <ul class="simple"> <li>The <code>eos_config</code>, <code>ios_config</code>, and <code>nxos_config</code> modules have removed the deprecated <code>save</code> and <code>force</code> parameters, use the <code>save_when</code> parameter to replicate their functionality.</li> <li>The <code>nxos_vrf_af</code> module has removed the <code>safi</code> parameter. This parameter was deprecated in Ansible 2.4 and has had no impact on the module since then.</li> </ul> </section> </section><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2012&ndash;2018 Michael DeHaan<br>&copy; 2018&ndash;2024 Red Hat, Inc.<br>Licensed under the GNU General Public License version 3.<br>
    <a href="https://docs.ansible.com/ansible/latest/porting_guides/porting_guide_2.8.html" class="_attribution-link">https://docs.ansible.com/ansible/latest/porting_guides/porting_guide_2.8.html</a>
  </p>
</div>
