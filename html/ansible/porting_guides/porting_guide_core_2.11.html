<section id="ansible-core-2-11-porting-guide"> <h1 id="porting-2-11-guide-core">Ansible-core 2.11 Porting Guide</h1> <p>This section discusses the behavioral changes between <code>ansible-base</code> 2.10 and <code>ansible-core</code> 2.11.</p> <p>It is intended to assist in updating your playbooks, plugins and other parts of your Ansible infrastructure so they work with this version of <code>ansible-core</code>.</p> <p>We suggest you read this page along with the <a class="reference external" href="https://github.com/ansible/ansible/blob/stable-2.11/changelogs/CHANGELOG-v2.11.rst">ansible-core Changelog for 2.11</a> to understand what updates you may need to make.</p> <p><code>ansible-core</code> is mainly of interest for developers and users who only want to use a small, controlled subset of the available collections. Regular users should install Ansible.</p> <p>The complete list of porting guides can be found at <a class="reference internal" href="porting_guides.html#porting-guides"><span class="std std-ref">porting guides</span></a>.</p>   <ul> <li><a class="reference internal" href="#playbook" id="id2">Playbook</a></li> <li><a class="reference internal" href="#command-line" id="id3">Command Line</a></li> <li><a class="reference internal" href="#deprecated" id="id4">Deprecated</a></li> <li>
<p><a class="reference internal" href="#breaking-changes" id="id5">Breaking Changes</a></p> <ul> <li><a class="reference internal" href="#changes-to-ansiblemodule" id="id6">Changes to <code>AnsibleModule</code></a></li> <li>
<a class="reference internal" href="#changes-to-ansible-module-utils-common-parameters" id="id7">Changes to </a><a class="reference internal" href="../reference_appendices/module_utils.html#module-ansible.module_utils.common.parameters" title="ansible.module_utils.common.parameters"><code>ansible.module_utils.common.parameters</code></a>
</li> </ul> </li> <li><a class="reference internal" href="#other" id="id8">Other</a></li> <li>
<p><a class="reference internal" href="#modules" id="id9">Modules</a></p> <ul> <li><a class="reference internal" href="#modules-removed" id="id10">Modules removed</a></li> <li><a class="reference internal" href="#deprecation-notices" id="id11">Deprecation notices</a></li> <li><a class="reference internal" href="#noteworthy-module-changes" id="id12">Noteworthy module changes</a></li> </ul> </li> <li><a class="reference internal" href="#plugins" id="id13">Plugins</a></li> <li><a class="reference internal" href="#porting-custom-scripts" id="id14">Porting custom scripts</a></li> </ul>
  <section id="playbook"> <h2>Playbook</h2> <ul class="simple"> <li>The <code>jinja2_native</code> setting now does not affect the template module which implicitly returns strings. For the template lookup there is a new argument <code>jinja2_native</code> (off by default) to control that functionality. The rest of the Jinja2 expressions still operate based on the <code>jinja2_native</code> setting.</li> </ul> </section> <section id="command-line"> <h2>Command Line</h2> <ul class="simple"> <li>The <code>ansible-galaxy login</code> command has been removed, as the underlying API it used for GitHub auth has been shut down. Publishing roles or collections to Galaxy with <code>ansible-galaxy</code> now requires that a Galaxy API token be passed to the CLI using a token file (default location <code>~/.ansible/galaxy_token</code>) or (insecurely) with the <code>--token</code> argument to <code>ansible-galaxy</code>.</li> </ul> </section> <section id="deprecated"> <h2>Deprecated</h2> <p>The constant <code>ansible.module_utils.basic._CHECK_ARGUMENT_TYPES_DISPATCHER</code> is deprecated. Use <a class="reference internal" href="../reference_appendices/module_utils.html#ansible.module_utils.common.parameters.DEFAULT_TYPE_VALIDATORS" title="ansible.module_utils.common.parameters.DEFAULT_TYPE_VALIDATORS"><code>ansible.module_utils.common.parameters.DEFAULT_TYPE_VALIDATORS</code></a> instead.</p> </section> <section id="breaking-changes"> <h2>Breaking Changes</h2> <section id="changes-to-ansiblemodule"> <h3>Changes to <code>AnsibleModule</code>
</h3> <p>With the move to <a class="reference internal" href="../reference_appendices/module_utils.html#ansible.module_utils.common.arg_spec.ArgumentSpecValidator" title="ansible.module_utils.common.arg_spec.ArgumentSpecValidator"><code>ArgumentSpecValidator</code></a> for performing argument spec validation, the following private methods in <a class="reference external" href="https://docs.ansible.com/ansible/2.9/reference_appendices/module_utils.html#ansible.module_utils.basic.AnsibleModule" title="(in Ansible v2.9)"><code>AnsibleModule</code></a> have been removed:</p>  <ul class="simple"> <li><code>_check_argument_types()</code></li> <li><code>_check_argument_values()</code></li> <li><code>_check_arguments()</code></li> <li>
<code>_check_mutually_exclusive()</code> –&gt; <a class="reference internal" href="../reference_appendices/module_utils.html#ansible.module_utils.common.validation.check_mutually_exclusive" title="ansible.module_utils.common.validation.check_mutually_exclusive"><code>ansible.module_utils.common.validation.check_mutually_exclusive()</code></a>
</li> <li>
<code>_check_required_arguments()</code> –&gt; <a class="reference internal" href="../reference_appendices/module_utils.html#ansible.module_utils.common.validation.check_required_arguments" title="ansible.module_utils.common.validation.check_required_arguments"><code>ansible.module_utils.common.validation.check_required_arguments()</code></a>
</li> <li>
<code>_check_required_by()</code> –&gt; <a class="reference internal" href="../reference_appendices/module_utils.html#ansible.module_utils.common.validation.check_required_by" title="ansible.module_utils.common.validation.check_required_by"><code>ansible.module_utils.common.validation.check_required_by()</code></a>
</li> <li>
<code>_check_required_if()</code> –&gt; <a class="reference internal" href="../reference_appendices/module_utils.html#ansible.module_utils.common.validation.check_required_if" title="ansible.module_utils.common.validation.check_required_if"><code>ansible.module_utils.common.validation.check_required_if()</code></a>
</li> <li>
<code>_check_required_one_of()</code> –&gt; <a class="reference internal" href="../reference_appendices/module_utils.html#ansible.module_utils.common.validation.check_required_one_of" title="ansible.module_utils.common.validation.check_required_one_of"><code>ansible.module_utils.common.validation.check_required_one_of()</code></a>
</li> <li>
<code>_check_required_together()</code> –&gt; <a class="reference internal" href="../reference_appendices/module_utils.html#ansible.module_utils.common.validation.check_required_together" title="ansible.module_utils.common.validation.check_required_together"><code>ansible.module_utils.common.validation.check_required_together()</code></a>
</li> <li>
<code>_check_type_bits()</code> –&gt; <a class="reference internal" href="../reference_appendices/module_utils.html#ansible.module_utils.common.validation.check_type_bits" title="ansible.module_utils.common.validation.check_type_bits"><code>ansible.module_utils.common.validation.check_type_bits()</code></a>
</li> <li>
<code>_check_type_bool()</code> –&gt; <a class="reference internal" href="../reference_appendices/module_utils.html#ansible.module_utils.common.validation.check_type_bool" title="ansible.module_utils.common.validation.check_type_bool"><code>ansible.module_utils.common.validation.check_type_bool()</code></a>
</li> <li>
<code>_check_type_bytes()</code> –&gt; <a class="reference internal" href="../reference_appendices/module_utils.html#ansible.module_utils.common.validation.check_type_bytes" title="ansible.module_utils.common.validation.check_type_bytes"><code>ansible.module_utils.common.validation.check_type_bytes()</code></a>
</li> <li>
<code>_check_type_dict()</code> –&gt; <a class="reference internal" href="../reference_appendices/module_utils.html#ansible.module_utils.common.validation.check_type_dict" title="ansible.module_utils.common.validation.check_type_dict"><code>ansible.module_utils.common.validation.check_type_dict()</code></a>
</li> <li>
<code>_check_type_float()</code> –&gt; <a class="reference internal" href="../reference_appendices/module_utils.html#ansible.module_utils.common.validation.check_type_float" title="ansible.module_utils.common.validation.check_type_float"><code>ansible.module_utils.common.validation.check_type_float()</code></a>
</li> <li>
<code>_check_type_int()</code> –&gt; <a class="reference internal" href="../reference_appendices/module_utils.html#ansible.module_utils.common.validation.check_type_int" title="ansible.module_utils.common.validation.check_type_int"><code>ansible.module_utils.common.validation.check_type_int()</code></a>
</li> <li>
<code>_check_type_jsonarg()</code> –&gt; <a class="reference internal" href="../reference_appendices/module_utils.html#ansible.module_utils.common.validation.check_type_jsonarg" title="ansible.module_utils.common.validation.check_type_jsonarg"><code>ansible.module_utils.common.validation.check_type_jsonarg()</code></a>
</li> <li>
<code>_check_type_list()</code> –&gt; <a class="reference internal" href="../reference_appendices/module_utils.html#ansible.module_utils.common.validation.check_type_list" title="ansible.module_utils.common.validation.check_type_list"><code>ansible.module_utils.common.validation.check_type_list()</code></a>
</li> <li>
<code>_check_type_path()</code> –&gt; <a class="reference internal" href="../reference_appendices/module_utils.html#ansible.module_utils.common.validation.check_type_path" title="ansible.module_utils.common.validation.check_type_path"><code>ansible.module_utils.common.validation.check_type_path()</code></a>
</li> <li>
<code>_check_type_raw()</code> –&gt; <a class="reference internal" href="../reference_appendices/module_utils.html#ansible.module_utils.common.validation.check_type_raw" title="ansible.module_utils.common.validation.check_type_raw"><code>ansible.module_utils.common.validation.check_type_raw()</code></a>
</li> <li>
<code>_check_type_str()</code> –&gt; <a class="reference internal" href="../reference_appendices/module_utils.html#ansible.module_utils.common.validation.check_type_str" title="ansible.module_utils.common.validation.check_type_str"><code>ansible.module_utils.common.validation.check_type_str()</code></a>
</li> <li>
<code>_count_terms()</code> –&gt; <a class="reference internal" href="../reference_appendices/module_utils.html#ansible.module_utils.common.validation.count_terms" title="ansible.module_utils.common.validation.count_terms"><code>ansible.module_utils.common.validation.count_terms()</code></a>
</li> <li><code>_get_wanted_type()</code></li> <li><code>_handle_aliases()</code></li> <li><code>_handle_no_log_values()</code></li> <li><code>_handle_options()</code></li> <li><code>_set_defaults()</code></li> <li><code>_set_fallbacks()</code></li> </ul>  <p>Modules or plugins using these private methods should use the public functions in <a class="reference internal" href="../reference_appendices/module_utils.html#module-ansible.module_utils.common.validation" title="ansible.module_utils.common.validation"><code>ansible.module_utils.common.validation</code></a> or <a class="reference internal" href="../reference_appendices/module_utils.html#ansible.module_utils.common.arg_spec.ArgumentSpecValidator.validate" title="ansible.module_utils.common.arg_spec.ArgumentSpecValidator.validate"><code>ArgumentSpecValidator.validate()</code></a> if no public function was listed above.</p> </section> <section id="changes-to-ansible-module-utils-common-parameters"> <h3>Changes to <a class="reference internal" href="../reference_appendices/module_utils.html#module-ansible.module_utils.common.parameters" title="ansible.module_utils.common.parameters"><code>ansible.module_utils.common.parameters</code></a>
</h3> <p>The following functions in <a class="reference internal" href="../reference_appendices/module_utils.html#module-ansible.module_utils.common.parameters" title="ansible.module_utils.common.parameters"><code>ansible.module_utils.common.parameters</code></a> are now private and should not be used directly. Use <a class="reference internal" href="../reference_appendices/module_utils.html#ansible.module_utils.common.arg_spec.ArgumentSpecValidator.validate" title="ansible.module_utils.common.arg_spec.ArgumentSpecValidator.validate"><code>ArgumentSpecValidator.validate()</code></a> instead.</p>  <ul class="simple"> <li><code>list_no_log_values</code></li> <li><code>list_deprecations</code></li> <li><code>handle_aliases</code></li> </ul>  </section> </section> <section id="other"> <h2>Other</h2> <ul class="simple"> <li>
<strong>Upgrading</strong>: If upgrading from <code>ansible &lt; 2.10</code> or from <code>ansible-base</code> and using pip, you must <code>pip uninstall ansible</code> or <code>pip uninstall ansible-base</code> before installing <code>ansible-core</code> to avoid conflicts.</li> <li>Python 3.8 on the controller node is a soft requirement for this release. <code>ansible-core</code> 2.11 still works with the same versions of Python that <code>ansible-base</code> 2.10 worked with, however 2.11 emits a warning when running on a controller node with a Python version less than 3.8. This warning can be disabled by setting <code>ANSIBLE_CONTROLLER_PYTHON_WARNING=False</code> in your environment. <code>ansible-core</code> 2.12 will require Python 3.8 or greater.</li> <li>The configuration system now validates the <code>choices</code> field, so any settings that violate it and were ignored in 2.10 cause an error in 2.11. For example, <code>ANSIBLE_COLLECTIONS_ON_ANSIBLE_VERSION_MISMATCH=0</code> now causes an error (valid choices are <code>ignore</code>, <code>warn</code> or <code>error</code>).</li> <li>The <code>ansible-galaxy</code> command now uses <code>resolvelib</code> for resolving dependencies. In most cases this should not make a user-facing difference beyond being more performant, but we note it here for posterity and completeness.</li> <li>If you import Python <code>module_utils</code> into any modules you maintain, you may now mark the import as optional during the module payload build by wrapping the <code>import</code> statement in a <code>try</code> or <code>if</code> block. This allows modules to use <code>module_utils</code> that may not be present in all versions of Ansible or a collection, and to perform arbitrary recovery or fallback actions during module runtime.</li> </ul> </section> <section id="modules"> <h2>Modules</h2> <ul class="simple"> <li>The <code>apt_key</code> module has explicitly defined <code>file</code> as mutually exclusive with <code>data</code>, <code>keyserver</code> and <code>url</code>. They cannot be used together anymore.</li> <li>The <code>meta</code> module now supports tags for user-defined tasks. Set the task’s tags to ‘always’ to maintain the previous behavior. Internal <code>meta</code> tasks continue to always run.</li> </ul> <section id="modules-removed"> <h3>Modules removed</h3> <p>The following modules no longer exist:</p> <ul class="simple"> <li>No notable changes</li> </ul> </section> <section id="deprecation-notices"> <h3>Deprecation notices</h3> <p>No notable changes</p> </section> <section id="noteworthy-module-changes"> <h3>Noteworthy module changes</h3> <ul class="simple"> <li>facts - On NetBSD, <code>ansible_virtualization_type</code> now tries to report a more accurate result than <code>xen</code> when virtualized and not running on Xen.</li> <li>facts - Virtualization facts now include <code>virtualization_tech_guest</code> and <code>virtualization_tech_host</code> keys. These are lists of virtualization technologies that a guest is a part of, or that a host provides, respectively. As an example, if you set up a host to provide both KVM and VirtualBox, both values are included in <code>virtualization_tech_host</code>. Similarly, a podman container running on a VM powered by KVM has a <code>virtualization_tech_guest</code> of <code>["kvm", "podman", "container"]</code>.</li> <li>The parameter <code>filter</code> type is changed from <code>string</code> to <code>list</code> in the <a class="reference internal" href="../collections/ansible/builtin/setup_module.html#setup-module"><span class="std std-ref">setup</span></a> module in order to use more than one filter. Previous behavior (using a <code>string</code>) still remains and works as a single filter.</li> </ul> </section> </section> <section id="plugins"> <h2>Plugins</h2> <ul class="simple"> <li>inventory plugins - <code>CachePluginAdjudicator.flush()</code> now calls the underlying cache plugin’s <code>flush()</code> instead of only deleting keys that it knows about. Inventory plugins should use <code>delete()</code> to remove any specific keys. As a user, this means that when an inventory plugin calls its <code>clear_cache()</code> method, facts could also be flushed from the cache. To work around this, users can configure inventory plugins to use a cache backend that is independent of the facts cache.</li> <li>callback plugins - <code>meta</code> task execution is now sent to <code>v2_playbook_on_task_start</code> like any other task. By default, only explicit meta tasks are sent there. Callback plugins can opt-in to receiving internal, implicitly created tasks to act on those as well, as noted in the plugin development documentation.</li> <li>The <code>choices</code> are now validated, so plugins that were using incorrect or incomplete choices issue an error in 2.11 if the value provided does not match. This has a simple fix: update the entries in <code>choices</code> to match reality.</li> </ul> </section> <section id="porting-custom-scripts"> <h2>Porting custom scripts</h2> <p>No notable changes</p> </section> </section><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2012&ndash;2018 Michael DeHaan<br>&copy; 2018&ndash;2024 Red Hat, Inc.<br>Licensed under the GNU General Public License version 3.<br>
    <a href="https://docs.ansible.com/ansible/latest/porting_guides/porting_guide_core_2.11.html" class="_attribution-link">https://docs.ansible.com/ansible/latest/porting_guides/porting_guide_core_2.11.html</a>
  </p>
</div>
