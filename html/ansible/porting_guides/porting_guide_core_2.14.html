<section id="ansible-core-2-14-porting-guide"> <h1 id="porting-2-14-guide-core">Ansible-core 2.14 Porting Guide</h1> <p>This section discusses the behavioral changes between <code>ansible-core</code> 2.13 and <code>ansible-core</code> 2.14.</p> <p>It is intended to assist in updating your playbooks, plugins and other parts of your Ansible infrastructure so they will work with this version of Ansible.</p> <p>We suggest you read this page along with <a class="reference external" href="https://github.com/ansible/ansible/blob/stable-2.14/changelogs/CHANGELOG-v2.14.rst">ansible-core Changelog for 2.14</a> to understand what updates you may need to make.</p> <p>This document is part of a collection on porting. The complete list of porting guides can be found at <a class="reference internal" href="porting_guides.html#porting-guides"><span class="std std-ref">porting guides</span></a>.</p>   <ul> <li><a class="reference internal" href="#playbook" id="id2">Playbook</a></li> <li><a class="reference internal" href="#command-line" id="id3">Command Line</a></li> <li><a class="reference internal" href="#deprecated" id="id4">Deprecated</a></li> <li>
<p><a class="reference internal" href="#modules" id="id5">Modules</a></p> <ul> <li><a class="reference internal" href="#modules-removed" id="id6">Modules removed</a></li> <li><a class="reference internal" href="#deprecation-notices" id="id7">Deprecation notices</a></li> <li><a class="reference internal" href="#noteworthy-module-changes" id="id8">Noteworthy module changes</a></li> </ul> </li> <li><a class="reference internal" href="#plugins" id="id9">Plugins</a></li> <li><a class="reference internal" href="#porting-custom-scripts" id="id10">Porting custom scripts</a></li> <li><a class="reference internal" href="#networking" id="id11">Networking</a></li> </ul>
  <section id="playbook"> <h2>Playbook</h2> <ul> <li>
<p>Conditionals - due to mitigation of security issue CVE-2023-5764 in ansible-core 2.14.12, conditional expressions with embedded template blocks can fail with the message “<code>Conditional is marked as unsafe, and cannot be evaluated.</code>” when an embedded template consults data from untrusted sources like module results or vars marked <code>!unsafe</code>. Conditionals with embedded templates can be a source of malicious template injection when referencing untrusted data, and can nearly always be rewritten without embedded templates. Playbook task conditional keywords such as <code>when</code> and <code>until</code> have long displayed warnings discouraging use of embedded templates in conditionals; this warning has been expanded to non-task conditionals as well, such as the <code>assert</code> action.</p> <pre data-language="yaml">- name: task with a module result (always untrusted by Ansible)
  shell: echo "hi mom"
  register: untrusted_result

# don't do it this way...
# - name: insecure conditional with embedded template consulting untrusted data
#   assert:
#     that: '"hi mom" is in {{ untrusted_result.stdout }}'

- name: securely access untrusted values directly as Jinja variables instead
  assert:
    that: '"hi mom" is in untrusted_result.stdout'
</pre> </li> <li>Variables are now evaluated lazily; only when they are actually used. For example, in ansible-core 2.14 an expression <code>{{ defined_variable or undefined_variable }}</code> does not fail on <code>undefined_variable</code> if the first part of <code>or</code> is evaluated to <code>True</code> as it is not needed to evaluate the second part. One particular case of a change in behavior to note is the task below which uses the <code>undefined</code> test. Prior to version 2.14 this would result in a fatal error trying to access the undefined value in the dictionary. In 2.14 the assertion passes as the dictionary is evaluated as undefined through one of its undefined values:</li> </ul>  <pre data-language="yaml">- assert:
    that:
      - some_defined_dict_with_undefined_values is undefined
  vars:
    dict_value: 1
    some_defined_dict_with_undefined_values:
      key1: value1
      key2: '{{ dict_value }}'
      key3: '{{ undefined_dict_value }}'
</pre>  </section> <section id="command-line"> <h2>Command Line</h2> <ul class="simple"> <li>Python 3.9 on the controller node is a hard requirement for this release.</li> <li>At startup the filesystem encoding and locale are checked to verify they are UTF-8. If not, the process exits with an error reporting the errant encoding. If you were previously using the <code>C</code> or <code>POSIX</code> locale, you may be able to use <code>C.UTF-8</code>. If you were previously using a locale such as <code>en_US.ISO-8859-1</code>, you may be able to use <code>en_US.UTF-8</code>. For simplicity it may be easiest to export the appropriate locale using the <code>LC_ALL</code> environment variable. An alternative to modifying your system locale is to run Python in UTF-8 mode; See the <a class="reference external" href="https://docs.python.org/3/using/cmdline.html#envvar-PYTHONUTF8">Python documentation</a> for more information.</li> </ul> </section> <section id="deprecated"> <h2>Deprecated</h2> <p>No notable changes</p> </section> <section id="modules"> <h2>Modules</h2> <p>No notable changes</p> <section id="modules-removed"> <h3>Modules removed</h3> <p>The following modules no longer exist:</p> <ul class="simple"> <li>No notable changes</li> </ul> </section> <section id="deprecation-notices"> <h3>Deprecation notices</h3> <p>No notable changes</p> </section> <section id="noteworthy-module-changes"> <h3>Noteworthy module changes</h3> <p>No notable changes</p> </section> </section> <section id="plugins"> <h2>Plugins</h2> <p>No notable changes</p> </section> <section id="porting-custom-scripts"> <h2>Porting custom scripts</h2> <p>No notable changes</p> </section> <section id="networking"> <h2>Networking</h2> <p>No notable changes</p> </section> </section><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2012&ndash;2018 Michael DeHaan<br>&copy; 2018&ndash;2024 Red Hat, Inc.<br>Licensed under the GNU General Public License version 3.<br>
    <a href="https://docs.ansible.com/ansible/latest/porting_guides/porting_guide_core_2.14.html" class="_attribution-link">https://docs.ansible.com/ansible/latest/porting_guides/porting_guide_core_2.14.html</a>
  </p>
</div>
