<section id="managing-vault-passwords"> <h1 id="vault-managing-passwords">Managing vault passwords</h1> <p>Managing your encrypted content is easier if you develop a strategy for managing your vault passwords. A vault password can be any string you choose. There is no special command to create a vault password. However, you need to keep track of your vault passwords. Each time you encrypt a variable or file with Ansible Vault, you must provide a password. When you use an encrypted variable or file in a command or playbook, you must provide the same password that was used to encrypt it. To develop a strategy for managing vault passwords, start with two questions:</p>  <ul class="simple"> <li>Do you want to encrypt all your content with the same password, or use different passwords for different needs?</li> <li>Where do you want to store your password or passwords?</li> </ul>  <section id="choosing-between-a-single-password-and-multiple-passwords"> <h2>Choosing between a single password and multiple passwords</h2> <p>If you have a small team or few sensitive values, you can use a single password for everything you encrypt with Ansible Vault. Store your vault password securely in a file or a secret manager as described below.</p> <p>If you have a larger team or many sensitive values, you can use multiple passwords. For example, you can use different passwords for different users or different levels of access. Depending on your needs, you might want a different password for each encrypted file, for each directory, or each environment. You might have a playbook that includes two vars files, one for the dev environment and one for the production environment, encrypted with two different passwords. When you run the playbook, you can select the correct vault password for the environment you are targeting using a vault ID.</p> </section> <section id="managing-multiple-passwords-with-vault-ids"> <h2 id="vault-ids">Managing multiple passwords with vault IDs</h2> <p>If you use multiple vault passwords, you can differentiate one password from another with vault IDs. You use the vault ID in three ways:</p>  <ul class="simple"> <li>Pass it with <a class="reference internal" href="../cli/ansible-playbook.html#cmdoption-ansible-playbook-vault-id"><code>--vault-id</code></a> to the <a class="reference internal" href="../cli/ansible-vault.html#ansible-vault"><span class="std std-ref">ansible-vault</span></a> command when you create encrypted content</li> <li>Include it wherever you store the password for that vault ID (see <a class="reference internal" href="#storing-vault-passwords"><span class="std std-ref">Storing and accessing vault passwords</span></a>)</li> <li>Pass it with <a class="reference internal" href="../cli/ansible-playbook.html#cmdoption-ansible-playbook-vault-id"><code>--vault-id</code></a> to the <a class="reference internal" href="../cli/ansible-playbook.html#ansible-playbook"><span class="std std-ref">ansible-playbook</span></a> command when you run a playbook that uses content you encrypted with that vault ID</li> </ul>  <p>When you pass a vault ID as an option to the <a class="reference internal" href="../cli/ansible-vault.html#ansible-vault"><span class="std std-ref">ansible-vault</span></a> command, you add a label (a hint or nickname) to the encrypted content. This label documents which password you used to encrypt it. The encrypted variable or file includes the vault ID label in plain text in the header. The vault ID is the last element before the encrypted content. For example:</p>  <pre data-language="yaml">my_encrypted_var: !vault |
          $ANSIBLE_VAULT;1.2;AES256;dev
          30613233633461343837653833666333643061636561303338373661313838333565653635353162
          3263363434623733343538653462613064333634333464660a663633623939393439316636633863
          61636237636537333938306331383339353265363239643939666639386530626330633337633833
          6664656334373166630a363736393262666465663432613932613036303963343263623137386239
          6330
</pre>  <p>In addition to the label, you must provide a source for the related password. The source can be a prompt, a file, or a script, depending on how you are storing your vault passwords. The pattern looks like this:</p> <pre data-language="bash">--vault-id label@source
</pre> <p>If your playbook uses multiple encrypted variables or files that you encrypted with different passwords, you must pass the vault IDs when you run that playbook. You can use <a class="reference internal" href="../cli/ansible-playbook.html#cmdoption-ansible-playbook-vault-id"><code>--vault-id</code></a> by itself, with <a class="reference internal" href="../cli/ansible-playbook.html#cmdoption-ansible-playbook-vault-password-file"><code>--vault-password-file</code></a>, or with <a class="reference internal" href="../cli/ansible-playbook.html#cmdoption-ansible-playbook-J"><code>--ask-vault-pass</code></a>. The pattern is the same as when you create encrypted content: include the label and the source for the matching password.</p> <p>See below for examples of encrypting content with vault IDs and using content encrypted with vault IDs. The <a class="reference internal" href="../cli/ansible-playbook.html#cmdoption-ansible-playbook-vault-id"><code>--vault-id</code></a> option works with any Ansible command that interacts with vaults, including <a class="reference internal" href="../cli/ansible-vault.html#ansible-vault"><span class="std std-ref">ansible-vault</span></a>, <a class="reference internal" href="../cli/ansible-playbook.html#ansible-playbook"><span class="std std-ref">ansible-playbook</span></a>, and so on.</p> <section id="limitations-of-vault-ids"> <h3>Limitations of vault IDs</h3> <p>Ansible does not enforce using the same password every time you use a particular vault ID label. You can encrypt different variables or files with the same vault ID label but different passwords. This usually happens when you type the password at a prompt and make a mistake. It is possible to use different passwords with the same vault ID label on purpose. For example, you could use each label as a reference to a class of passwords, rather than a single password. In this scenario, you must always know which specific password or file to use in context. However, you are more likely to encrypt two files with the same vault ID label and different passwords by mistake. If you encrypt two files with the same label but different passwords by accident, you can <a class="reference internal" href="vault_encrypting_content.html#rekeying-files"><span class="std std-ref">rekey</span></a> one file to fix the issue.</p> </section> <section id="enforcing-vault-id-matching"> <h3>Enforcing vault ID matching</h3> <p>By default, the vault ID label is only a hint to remind you which password you used to encrypt a variable or file. Ansible does not check that the vault ID in the header of the encrypted content matches the vault ID you provide when you use the content. Ansible decrypts all files and variables called by your command or playbook that are encrypted with the password you provide. To check the encrypted content and decrypt it only when the vault ID it contains matches the one you provide with <code>--vault-id</code>, set the config option <a class="reference internal" href="../reference_appendices/config.html#default-vault-id-match"><span class="std std-ref">DEFAULT_VAULT_ID_MATCH</span></a>. When you set <a class="reference internal" href="../reference_appendices/config.html#default-vault-id-match"><span class="std std-ref">DEFAULT_VAULT_ID_MATCH</span></a>, each password is only used to decrypt data that was encrypted with the same label. This is efficient and predictable and can reduce errors when different values are encrypted with different passwords.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>Even with the <a class="reference internal" href="../reference_appendices/config.html#default-vault-id-match"><span class="std std-ref">DEFAULT_VAULT_ID_MATCH</span></a> setting enabled, Ansible does not enforce using the same password every time you use a particular vault ID label.</p> </div> </section> </section> <section id="storing-and-accessing-vault-passwords"> <h2 id="storing-vault-passwords">Storing and accessing vault passwords</h2> <p>You can memorize your vault password or manually copy vault passwords from any source and paste them at a command-line prompt, but most users store them securely and access them as needed from within Ansible. You have two options for storing vault passwords that work from within Ansible: in files or a third-party tool, such as the system keyring or a secret manager. If you store your passwords in a third-party tool, you need a vault password client script to retrieve them from within Ansible.</p> <section id="storing-passwords-in-files"> <h3>Storing passwords in files</h3> <p>To store a vault password in a file, enter the password as a string on a single line in the file. Make sure the permissions on the file are appropriate. Do not add password files to source control.</p> <p>When you run a playbook that uses a vault password stored in a file, specify the file within the <code>--vault-password-file</code> flag. For example:</p> <pre data-language="bash">ansible-playbook --extra-vars @secrets.enc --vault-password-file secrets.pass
</pre> </section> <section id="storing-passwords-in-third-party-tools-with-vault-password-client-scripts"> <h3 id="vault-password-client-scripts">Storing passwords in third-party tools with vault password client scripts</h3> <p>You can store your vault passwords on the system keyring, in a database, or in a secret manager and retrieve them from within Ansible using a vault password client script. Enter the password as a string on a single line. If your password has a vault ID, store it in a way that works with your password storage tool.</p> <p>To create a vault password client script:</p>  <ul class="simple"> <li>Create a file with a name ending in either <code>-client</code> or <code>-client.EXTENSION</code>
</li> <li>Make the file executable</li> <li>
<dl class="simple"> <dt>Within the script itself:</dt>
<dd>
<ul> <li>Print the passwords to standard output</li> <li>Accept a <code>--vault-id</code> option</li> <li>If the script prompts for data (for example, a database password), display the prompts to the TTY.</li> </ul> </dd> </dl> </li> </ul>  <p>When you run a playbook that uses vault passwords stored in a third-party tool, specify the script as the source within the <code>--vault-id</code> flag. For example:</p> <pre data-language="bash">ansible-playbook --vault-id dev@contrib-scripts/vault/vault-keyring-client.py
</pre> <p>Ansible executes the client script with a <code>--vault-id</code> option so the script knows which vault ID label you specified. For example, a script loading passwords from a secret manager can use the vault ID label to pick either the ‘dev’ or ‘prod’ password. The example command above results in the following execution of the client script:</p> <pre data-language="bash">contrib-scripts/vault/vault-keyring-client.py --vault-id dev
</pre> <p>For an example of a client script that loads passwords from the system keyring, see the <a class="reference external" href="https://github.com/ansible-community/contrib-scripts/blob/main/vault/vault-keyring-client.py">vault-keyring-client script</a>.</p> </section> </section> </section><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2012&ndash;2018 Michael DeHaan<br>&copy; 2018&ndash;2024 Red Hat, Inc.<br>Licensed under the GNU General Public License version 3.<br>
    <a href="https://docs.ansible.com/ansible/latest/vault_guide/vault_managing_passwords.html" class="_attribution-link">https://docs.ansible.com/ansible/latest/vault_guide/vault_managing_passwords.html</a>
  </p>
</div>
