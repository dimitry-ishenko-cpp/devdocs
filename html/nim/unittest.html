<h1 class="title">std/unittest</h1> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/unittest.nim#L1" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/unittest.nim#L1" target="_blank">Edit</a>  
<p>This module implements boilerplate to make unit testing easy.</p> <p>The test status and name is printed after any output or traceback.</p> <p>Tests can be nested, however failure of a nested test will not mark the parent test as failed. Setup and teardown are inherited. Setup can be overridden locally.</p> <p>Compiled test files as well as <code><span class="Identifier">nim</span> <span class="Identifier">c</span> <span class="Operator">-</span><span class="Identifier">r</span> <span class="Operator">&lt;</span><span class="Identifier">testfile</span><span class="Operator">.</span><span class="Identifier">nim</span><span class="Operator">&gt;</span></code> exit with 0 for success (no failed tests) or 1 for failure.</p> <h2 id="testament">Testament</h2>
<p>Instead of <code><span class="Identifier">unittest</span></code>, please consider using <a href="testament.html">the Testament tool</a> which offers process isolation for your tests.</p> <p>Alternatively using <code><span class="Keyword">when</span> <span class="Identifier">isMainModule</span><span class="Punctuation">:</span> <span class="Identifier">doAssert</span> <span class="Identifier">conditionHere</span></code> is usually a much simpler solution for testing purposes.</p> <h2 id="running-a-single-test">Running a single test</h2>
<p>Specify the test name as a command line argument.</p> 
<pre class="listing" data-language="nim">nim c -r test "my test name" "another test"</pre> <p>Multiple arguments can be used.</p> <h2 id="running-a-single-test-suite">Running a single test suite</h2>
<p>Specify the suite name delimited by <code><span class="StringLit">"::"</span></code>.</p> 
<pre class="listing" data-language="nim">nim c -r test "my test name::"</pre> <h2 id="selecting-tests-by-pattern">Selecting tests by pattern</h2>
<p>A single <code>"*"</code> can be used for globbing.</p> <p>Delimit the end of a suite name with <code><span class="StringLit">"::"</span></code>.</p> <p>Tests matching <strong>any</strong> of the arguments are executed.</p> 
<pre class="listing" data-language="nim">nim c -r test fast_suite::mytest1 fast_suite::mytest2
nim c -r test "fast_suite::mytest*"
nim c -r test "auth*::" "crypto::hashing*"
# Run suites starting with 'bug #' and standalone tests starting with '#'
nim c -r test 'bug #*::' '::#*'</pre> <h2 id="examples">Examples</h2>

<pre class="listing" data-language="nim">suite "description for this stuff":
  echo "suite setup: run once before the tests"
  
  setup:
    echo "run before each test"
  
  teardown:
    echo "run after each test"
  
  test "essential truths":
    # give up and stop if this fails
    require(true)
  
  test "slightly less obvious stuff":
    # print a nasty message and move on, skipping
    # the remainder of this block
    check(1 != 1)
    check("asd"[2] == 'd')
  
  test "out of bounds error is thrown on bad access":
    let v = @[1, 2, 3]  # you can do initialization here
    expect(IndexDefect):
      discard v[4]
  
  echo "suite teardown: run once after the tests"</pre> <h2 id="limitationsslashbugs">Limitations/Bugs</h2>
<p>Since <code><span class="Identifier">check</span></code> will rewrite some expressions for supporting checkpoints (namely assigns expressions to variables), some type conversions are not supported. For example <code><span class="Identifier">check</span> <span class="FloatNumber">4.0</span> <span class="Operator">==</span> <span class="DecNumber">2</span> <span class="Operator">+</span> <span class="DecNumber">2</span></code> won't work. But <code><span class="Identifier">doAssert</span> <span class="FloatNumber">4.0</span> <span class="Operator">==</span> <span class="DecNumber">2</span> <span class="Operator">+</span> <span class="DecNumber">2</span></code> works. Make sure both sides of the operator (such as <code><span class="Operator">==</span></code>, <code><span class="Operator">&gt;=</span></code> and so on) have the same type. </p>  <h2 id="6">Imports</h2> <dl> <a href="since.html">since</a>, <a href="exitprocs.html">exitprocs</a>, <a href="macros.html">macros</a>, <a href="strutils.html">strutils</a>, <a href="streams.html">streams</a>, <a href="times.html">times</a>, <a href="sets.html">sets</a>, <a href="sequtils.html">sequtils</a>, <a href="os.html">os</a>, <a href="terminal.html">terminal</a> </dl>   <h2 id="7">Types</h2> <dl> <div id="ConsoleOutputFormatter"> <dt><pre data-language="nim">ConsoleOutputFormatter = ref object of OutputFormatter
  ## Have test results printed in color.
  ## Default is `auto` depending on `isatty(stdout)`, or override it with
  ## `-d:nimUnittestColor:auto|on|off`.
  ## 
  ## Deprecated: Setting the environment variable `NIMTEST_COLOR` to `always`
  ## or `never` changes the default for the non-js target to true or false respectively.
  ## Deprecated: the environment variable `NIMTEST_NO_COLOR`, when set, changes the
  ## default to true, if `NIMTEST_COLOR` is undefined.
  ## Set the verbosity of test results.
  ## Default is `PRINT_ALL`, or override with:
  ## `-d:nimUnittestOutputLevel:PRINT_ALL|PRINT_FAILURES|PRINT_NONE`.
  ## 
  ## Deprecated: the `NIMTEST_OUTPUT_LVL` environment variable is set for the non-js target.</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/unittest.nim#L145" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/unittest.nim#L145" target="_blank">Edit</a> </dd> </div> <div id="JUnitOutputFormatter"> <dt><pre>JUnitOutputFormatter = ref object of OutputFormatter</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/unittest.nim#L164" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/unittest.nim#L164" target="_blank">Edit</a> </dd> </div> <div id="OutputFormatter"> <dt><pre>OutputFormatter = ref object of RootObj</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/unittest.nim#L143" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/unittest.nim#L143" target="_blank">Edit</a> </dd> </div> <div id="OutputLevel"> <dt><pre data-language="nim">OutputLevel = enum
  PRINT_ALL,                ## Print as much as possible.
  PRINT_FAILURES,           ## Print only the failed tests.
  PRINT_NONE                 ## Print nothing.</pre></dt> <dd> The output verbosity of the tests. <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/unittest.nim#L130" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/unittest.nim#L130" target="_blank">Edit</a> </dd> </div> <div id="TestResult"> <dt><pre data-language="nim">TestResult = object
  suiteName*: string ## Name of the test suite that contains this test case.
                     ## Can be ``nil`` if the test case is not in a suite.
  testName*: string          ## Name of the test case
  status*: TestStatus</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/unittest.nim#L135" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/unittest.nim#L135" target="_blank">Edit</a> </dd> </div> <div id="TestStatus"> <dt><pre data-language="nim">TestStatus = enum
  OK, FAILED, SKIPPED</pre></dt> <dd> The status of a test when it is done. <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/unittest.nim#L125" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/unittest.nim#L125" target="_blank">Edit</a> </dd> </div> </dl>   <h2 id="8">Vars</h2> <dl> <div id="abortOnError"> <dt><pre data-language="nim">abortOnError {.threadvar.}: bool</pre></dt> <dd> <p>Set to true in order to quit immediately on fail. Default is false, or override with <code><span class="Operator">-</span><span class="Identifier">d</span><span class="Punctuation">:</span><span class="Identifier">nimUnittestAbortOnError</span><span class="Punctuation">:</span><span class="Identifier">on</span><span class="Operator">|</span><span class="Identifier">off</span></code>.</p> <p>Deprecated: can also override depending on whether <code><span class="Identifier">NIMTEST_ABORT_ON_ERROR</span></code> environment variable is set.</p> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/unittest.nim#L171" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/unittest.nim#L171" target="_blank">Edit</a> </dd> </div> </dl>   <h2 id="12">Procs</h2> <dl> <div id="addOutputFormatter-procs-all"> <div id="addOutputFormatter,OutputFormatter"> <dt><pre data-language="nim">proc addOutputFormatter(formatter: OutputFormatter) {....raises: [], tags: [],
    forbids: [].}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/unittest.nim#L213" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/unittest.nim#L213" target="_blank">Edit</a> </dd> </div> </div> <div id="checkpoint-procs-all"> <div id="checkpoint,string"> <dt><pre data-language="nim">proc checkpoint(msg: string) {....raises: [], tags: [], forbids: [].}</pre></dt> <dd> <p>Set a checkpoint identified by <code><span class="Identifier">msg</span></code>. Upon test failure all checkpoints encountered so far are printed out. Example:</p> 
<pre class="listing" data-language="nim">checkpoint("Checkpoint A")
check((42, "the Answer to life and everything") == (1, "a"))
checkpoint("Checkpoint B")</pre> <p>outputs "Checkpoint A" once it fails.</p> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/unittest.nim#L581" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/unittest.nim#L581" target="_blank">Edit</a> </dd> </div> </div> <div id="close-procs-all"> <div id="close,JUnitOutputFormatter"> <dt><pre data-language="nim">proc close(formatter: JUnitOutputFormatter) {....raises: [IOError, OSError],
    tags: [WriteIOEffect], forbids: [].}</pre></dt> <dd> Completes the report and closes the underlying stream. <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/unittest.nim#L336" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/unittest.nim#L336" target="_blank">Edit</a> </dd> </div> </div> <div id="defaultConsoleFormatter-procs-all"> <div id="defaultConsoleFormatter"> <dt><pre data-language="nim">proc defaultConsoleFormatter(): ConsoleOutputFormatter {....raises: [ValueError],
    tags: [ReadEnvEffect], forbids: [].}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/unittest.nim#L252" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/unittest.nim#L252" target="_blank">Edit</a> </dd> </div> </div> <div id="delOutputFormatter-procs-all"> <div id="delOutputFormatter,OutputFormatter"> <dt><pre data-language="nim">proc delOutputFormatter(formatter: OutputFormatter) {....raises: [], tags: [],
    forbids: [].}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/unittest.nim#L216" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/unittest.nim#L216" target="_blank">Edit</a> </dd> </div> </div> <div id="disableParamFiltering-procs-all"> <div id="disableParamFiltering"> <dt><pre data-language="nim">proc disableParamFiltering() {....raises: [], tags: [], forbids: [].}</pre></dt> <dd> disables filtering tests with the command line params <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/unittest.nim#L787" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/unittest.nim#L787" target="_blank">Edit</a> </dd> </div> </div> <div id="newConsoleOutputFormatter-procs-all"> <div id="newConsoleOutputFormatter,OutputLevel"> <dt><pre data-language="nim">proc newConsoleOutputFormatter(outputLevel: OutputLevel = outputLevelDefault;
                               colorOutput = true): ConsoleOutputFormatter {.
    ...raises: [], tags: [], forbids: [].}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/unittest.nim#L223" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/unittest.nim#L223" target="_blank">Edit</a> </dd> </div> </div> <div id="newJUnitOutputFormatter-procs-all"> <div id="newJUnitOutputFormatter,Stream"> <dt><pre data-language="nim">proc newJUnitOutputFormatter(stream: Stream): JUnitOutputFormatter {.
    ...raises: [IOError, OSError], tags: [WriteIOEffect], forbids: [].}</pre></dt> <dd> Creates a formatter that writes report to the specified stream in JUnit format. The <code>stream</code> is NOT closed automatically when the test are finished, because the formatter has no way to know when all tests are finished. You should invoke formatter.close() to finalize the report. <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/unittest.nim#L321" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/unittest.nim#L321" target="_blank">Edit</a> </dd> </div> </div> <div id="resetOutputFormatters-procs-all"> <div id="resetOutputFormatters"> <dt><pre data-language="nim">proc resetOutputFormatters() {....raises: [], tags: [], forbids: [].}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/unittest.nim#L220" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/unittest.nim#L220" target="_blank">Edit</a> </dd> </div> </div> </dl>   <h2 id="14">Methods</h2> <dl> <div id="failureOccurred-methods-all"> <div id="failureOccurred.e,ConsoleOutputFormatter,seq[string],string"> <dt><pre data-language="nim">method failureOccurred(formatter: ConsoleOutputFormatter;
                       checkpoints: seq[string]; stackTrace: string) {.
    ...raises: [], tags: [], forbids: [].}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/unittest.nim#L274" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/unittest.nim#L274" target="_blank">Edit</a> </dd> </div> <div id="failureOccurred.e,JUnitOutputFormatter,seq[string],string"> <dt><pre data-language="nim">method failureOccurred(formatter: JUnitOutputFormatter;
                       checkpoints: seq[string]; stackTrace: string) {.
    ...raises: [], tags: [], forbids: [].}</pre></dt> <dd> <code>stackTrace</code> is provided only if the failure occurred due to an exception. <code>checkpoints</code> is never <code>nil</code>. <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/unittest.nim#L349" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/unittest.nim#L349" target="_blank">Edit</a> </dd> </div> <div id="failureOccurred.e,OutputFormatter,seq[string],string"> <dt><pre data-language="nim">method failureOccurred(formatter: OutputFormatter; checkpoints: seq[string];
                       stackTrace: string) {.base, ...gcsafe, raises: [], tags: [],
    forbids: [].}</pre></dt> <dd> <code>stackTrace</code> is provided only if the failure occurred due to an exception. <code>checkpoints</code> is never <code>nil</code>. <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/unittest.nim#L203" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/unittest.nim#L203" target="_blank">Edit</a> </dd> </div> </div> <div id="suiteEnded-methods-all"> <div id="suiteEnded.e,ConsoleOutputFormatter"> <dt><pre data-language="nim">method suiteEnded(formatter: ConsoleOutputFormatter) {....raises: [], tags: [],
    forbids: [].}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/unittest.nim#L303" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/unittest.nim#L303" target="_blank">Edit</a> </dd> </div> <div id="suiteEnded.e,JUnitOutputFormatter"> <dt><pre data-language="nim">method suiteEnded(formatter: JUnitOutputFormatter) {....raises: [IOError, OSError],
    tags: [WriteIOEffect], forbids: [].}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/unittest.nim#L398" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/unittest.nim#L398" target="_blank">Edit</a> </dd> </div> <div id="suiteEnded.e,OutputFormatter"> <dt><pre data-language="nim">method suiteEnded(formatter: OutputFormatter) {.base, ...gcsafe, raises: [],
    tags: [], forbids: [].}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/unittest.nim#L210" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/unittest.nim#L210" target="_blank">Edit</a> </dd> </div> </div> <div id="suiteStarted-methods-all"> <div id="suiteStarted.e,ConsoleOutputFormatter,string"> <dt><pre data-language="nim">method suiteStarted(formatter: ConsoleOutputFormatter; suiteName: string) {.
    ...raises: [IOError], tags: [RootEffect, WriteIOEffect], forbids: [].}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/unittest.nim#L262" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/unittest.nim#L262" target="_blank">Edit</a> </dd> </div> <div id="suiteStarted.e,JUnitOutputFormatter,string"> <dt><pre data-language="nim">method suiteStarted(formatter: JUnitOutputFormatter; suiteName: string) {.
    ...raises: [IOError, OSError, ValueError], tags: [WriteIOEffect], forbids: [].}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/unittest.nim#L341" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/unittest.nim#L341" target="_blank">Edit</a> </dd> </div> <div id="suiteStarted.e,OutputFormatter,string"> <dt><pre data-language="nim">method suiteStarted(formatter: OutputFormatter; suiteName: string) {.base,
    ...gcsafe, raises: [], tags: [], forbids: [].}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/unittest.nim#L199" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/unittest.nim#L199" target="_blank">Edit</a> </dd> </div> </div> <div id="testEnded-methods-all"> <div id="testEnded.e,ConsoleOutputFormatter,TestResult"> <dt><pre data-language="nim">method testEnded(formatter: ConsoleOutputFormatter; testResult: TestResult) {.
    ...raises: [IOError], tags: [RootEffect, WriteIOEffect], forbids: [].}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/unittest.nim#L282" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/unittest.nim#L282" target="_blank">Edit</a> </dd> </div> <div id="testEnded.e,JUnitOutputFormatter,TestResult"> <dt><pre data-language="nim">method testEnded(formatter: JUnitOutputFormatter; testResult: TestResult) {.
    ...raises: [IOError, OSError, ValueError], tags: [TimeEffect, WriteIOEffect],
    forbids: [].}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/unittest.nim#L357" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/unittest.nim#L357" target="_blank">Edit</a> </dd> </div> <div id="testEnded.e,OutputFormatter,TestResult"> <dt><pre data-language="nim">method testEnded(formatter: OutputFormatter; testResult: TestResult) {.base,
    ...gcsafe, raises: [], tags: [], forbids: [].}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/unittest.nim#L208" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/unittest.nim#L208" target="_blank">Edit</a> </dd> </div> </div> <div id="testStarted-methods-all"> <div id="testStarted.e,ConsoleOutputFormatter,string"> <dt><pre data-language="nim">method testStarted(formatter: ConsoleOutputFormatter; testName: string) {.
    ...raises: [], tags: [], forbids: [].}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/unittest.nim#L271" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/unittest.nim#L271" target="_blank">Edit</a> </dd> </div> <div id="testStarted.e,JUnitOutputFormatter,string"> <dt><pre data-language="nim">method testStarted(formatter: JUnitOutputFormatter; testName: string) {.
    ...raises: [], tags: [TimeEffect], forbids: [].}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/unittest.nim#L344" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/unittest.nim#L344" target="_blank">Edit</a> </dd> </div> <div id="testStarted.e,OutputFormatter,string"> <dt><pre data-language="nim">method testStarted(formatter: OutputFormatter; testName: string) {.base, ...gcsafe,
    raises: [], tags: [], forbids: [].}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/unittest.nim#L201" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/unittest.nim#L201" target="_blank">Edit</a> </dd> </div> </div> </dl>   <h2 id="17">Macros</h2> <dl> <div id="check-macros-all"> <div id="check.m,untyped"> <dt><pre data-language="nim">macro check(conditions: untyped): untyped</pre></dt> <dd> Verify if a statement or a list of statements is true. A helpful error message and set checkpoints are printed out on failure (if <code>outputLevel</code> is not <code>PRINT_NONE</code>). <p><strong class="examples_text">Example:</strong></p> <pre class="listing" data-language="nim">import std/strutils

check("AKB48".toLowerAscii() == "akb48")

let teams = {'A', 'K', 'B', '4', '8'}

check:
  "AKB48".toLowerAscii() == "akb48"
  'C' notin teams</pre> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/unittest.nim#L642" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/unittest.nim#L642" target="_blank">Edit</a> </dd> </div> </div> <div id="expect-macros-all"> <div id="expect.m,varargs[typed],untyped"> <dt><pre data-language="nim">macro expect(exceptions: varargs[typed]; body: untyped): untyped</pre></dt> <dd> Test if <code><span class="Identifier">body</span></code> raises an exception found in the passed <code><span class="Identifier">exceptions</span></code>. The test passes if the raised exception is part of the acceptable exceptions. Otherwise, it fails. <p><strong class="examples_text">Example:</strong></p> <pre class="listing" data-language="nim">import std/[math, random, strutils]
proc defectiveRobot() =
  randomize()
  case rand(1..4)
  of 1: raise newException(OSError, "CANNOT COMPUTE!")
  of 2: discard parseInt("Hello World!")
  of 3: raise newException(IOError, "I can't do that Dave.")
  else: assert 2 + 2 == 5

expect IOError, OSError, ValueError, AssertionDefect:
  defectiveRobot()</pre> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/unittest.nim#L748" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/unittest.nim#L748" target="_blank">Edit</a> </dd> </div> </div> </dl>   <h2 id="18">Templates</h2> <dl> <div id="fail-templates-all"> <div id="fail.t"> <dt><pre data-language="nim">template fail()</pre></dt> <dd> <p>Print out the checkpoints encountered so far and quit if <code>abortOnError</code> is true. Otherwise, erase the checkpoints and indicate the test has failed (change exit code and test status). This template is useful for debugging, but is otherwise mostly used internally. Example:</p> 
<pre class="listing" data-language="nim">checkpoint("Checkpoint A")
complicatedProcInThread()
fail()</pre> <p>outputs "Checkpoint A" before quitting.</p> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/unittest.nim#L595" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/unittest.nim#L595" target="_blank">Edit</a> </dd> </div> </div> <div id="require-templates-all"> <div id="require.t,untyped"> <dt><pre data-language="nim">template require(conditions: untyped)</pre></dt> <dd> Same as <code><span class="Identifier">check</span></code> except any failed test causes the program to quit immediately. Any teardown statements are not executed and the failed test output is not generated. <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/unittest.nim#L738" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/unittest.nim#L738" target="_blank">Edit</a> </dd> </div> </div> <div id="skip-templates-all"> <div id="skip.t"> <dt><pre data-language="nim">template skip()</pre></dt> <dd> <p>Mark the test as skipped. Should be used directly in case when it is not possible to perform test for reasons depending on outer environment, or certain application logic conditions or configurations. The test code is still executed.</p> 
<pre class="listing" data-language="nim">if not isGLContextCreated():
  skip()</pre> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/unittest.nim#L627" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/unittest.nim#L627" target="_blank">Edit</a> </dd> </div> </div> <div id="suite-templates-all"> <div id="suite.t,,"> <dt><pre data-language="nim">template suite(name, body) {.dirty.}</pre></dt> <dd> <p>Declare a test suite identified by <code><span class="Identifier">name</span></code> with optional <code>setup</code> and/or <code>teardown</code> section.</p> <p>A test suite is a series of one or more related tests sharing a common fixture (<code>setup</code>, <code>teardown</code>). The fixture is executed for EACH test.</p> 
<pre class="listing" data-language="nim">suite "test suite for addition":
  setup:
    let result = 4
  
  test "2 + 2 = 4":
    check(2+2 == result)
  
  test "(2 + -2) != 4":
    check(2 + -2 != result)
  
  # No teardown needed</pre> <p>The suite will run the individual test cases in the order in which they were listed. With default global settings the above code prints:</p> <pre data-language="nim">[Suite] test suite for addition
  [OK] 2 + 2 = 4
  [OK] (2 + -2) != 4</pre> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/unittest.nim#L468" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/unittest.nim#L468" target="_blank">Edit</a> </dd> </div> </div> <div id="test-templates-all"> <div id="test.t,,"> <dt><pre data-language="nim">template test(name, body) {.dirty.}</pre></dt> <dd> <p>Define a single test case identified by <code><span class="Identifier">name</span></code>.</p> 
<pre class="listing" data-language="nim">test "roses are red":
  let roses = "red"
  check(roses == "red")</pre> <p>The above code outputs:</p> <pre data-language="nim">[OK] roses are red</pre> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/unittest.nim#L527" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/unittest.nim#L527" target="_blank">Edit</a> </dd> </div> </div> </dl><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2006&ndash;2024 Andreas Rumpf<br>Licensed under the MIT License.<br>
    <a href="https://nim-lang.org/docs/unittest.html" class="_attribution-link">https://nim-lang.org/docs/unittest.html</a>
  </p>
</div>
