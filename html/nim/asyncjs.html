<h1 class="title">asyncjs</h1>  
<p>This module implements types and macros for writing asynchronous code for the JS backend. It provides tools for interaction with JavaScript async API-s and libraries, writing async procedures in Nim and converting callback-based code to promises.</p> <p>A Nim procedure is asynchronous when it includes the <code>{.async.}</code> pragma. It should always have a <code>Future[T]</code> return type or not have a return type at all. A <code>Future[void]</code> return type is assumed by default.</p> <p>This is roughly equivalent to the <code>async</code> keyword in JavaScript code.</p> <pre class="listing" data-language="nim">proc loadGame(name: string): Future[Game] {.async.} =
  # code</pre>
<p>should be equivalent to</p> <pre class="listing" data-language="nim">async function loadGame(name) {
  // code
}</pre>
<p>A call to an asynchronous procedure usually needs <code>await</code> to wait for the completion of the <code>Future</code>.</p> <pre class="listing" data-language="nim">var game = await loadGame(name)</pre>
<p>Often, you might work with callback-based API-s. You can wrap them with asynchronous procedures using promises and <code>newPromise</code>:</p> <pre class="listing" data-language="nim">proc loadGame(name: string): Future[Game] =
  var promise = newPromise() do (resolve: proc(response: Game)):
    cbBasedLoadGame(name) do (game: Game):
      resolve(game)
  return promise</pre>
<p>Forward definitions work properly, you just need to always add the <code>{.async.}</code> pragma:</p> <pre class="listing" data-language="nim">proc loadGame(name: string): Future[Game] {.async.}</pre> <h2 id="javascript-compatibility">JavaScript compatibility</h2>
<p>Nim currently generates <code>async/await</code> JavaScript code which is supported in modern EcmaScript and most modern versions of browsers, Node.js and Electron. If you need to use this module with older versions of JavaScript, you can use a tool that backports the resulting JavaScript code, as babel.</p>  <h2 id="6">Imports</h2> <dl> <a href="jsffi.html">jsffi</a>, <a href="macros.html">macros</a> </dl>  <h2 id="7">Types</h2> <dl>  <dt><pre id="Future" data-language="nim">Future[T] = ref object
  future*: T</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/js/asyncjs.nim#L67" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/js/asyncjs.nim#L67" target="_blank">Edit</a> </dd>  <dt><pre id="PromiseJs" data-language="nim">PromiseJs {...}{.importcpp: "Promise".} = ref object</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/js/asyncjs.nim#L71" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/js/asyncjs.nim#L71" target="_blank">Edit</a> </dd> </dl>  <h2 id="12">Procs</h2> <dl>  <dt><pre id="newPromise%2Cproc%28proc%28T%29%29" data-language="nim">proc newPromise[T](handler: proc (resolve: proc (response: T))): Future[T] {...}{.
    importcpp: "(new Promise(#))".}</pre></dt> <dd> A helper for wrapping callback-based functions into promises and async procedures <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/js/asyncjs.nim#L150" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/js/asyncjs.nim#L150" target="_blank">Edit</a> </dd>  <dt><pre id="newPromise%2Cproc%28proc%29%29" data-language="nim">proc newPromise(handler: proc (resolve: proc ())): Future[void] {...}{.
    importcpp: "(new Promise(#))".}</pre></dt> <dd> A helper for wrapping callback-based functions into promises and async procedures <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/js/asyncjs.nim#L154" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/js/asyncjs.nim#L154" target="_blank">Edit</a> </dd> </dl>  <h2 id="17">Macros</h2> <dl>  <dt><pre id="async.m%2Cuntyped" data-language="nim">macro async(arg: untyped): untyped</pre></dt> <dd> Macro which converts normal procedures into javascript-compatible async procedures <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/js/asyncjs.nim#L140" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/js/asyncjs.nim#L140" target="_blank">Edit</a> </dd> </dl><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2006&ndash;2021 Andreas Rumpf<br>Licensed under the MIT License.<br>
    <a href="https://nim-lang.org/docs/asyncjs.html" class="_attribution-link">https://nim-lang.org/docs/asyncjs.html</a>
  </p>
</div>
