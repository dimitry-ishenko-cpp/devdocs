<h1 class="title">std/osproc</h1> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/osproc.nim#L1" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/osproc.nim#L1" target="_blank">Edit</a>  
<p>This module implements an advanced facility for executing OS processes and process communication.</p> <p><strong>See also:</strong></p> <ul class="simple">
<li><a href="os.html">os module</a></li> <li><a href="streams.html">streams module</a></li> <li><a href="memfiles.html">memfiles module</a></li> </ul>  <h2 id="6">Imports</h2> <dl> <a href="strutils.html">strutils</a>, <a href="os.html">os</a>, <a href="strtabs.html">strtabs</a>, <a href="streams.html">streams</a>, <a href="cpuinfo.html">cpuinfo</a>, <a href="streamwrapper.html">streamwrapper</a>, <a href="since.html">since</a>, <a href="winlean.html">winlean</a> </dl>   <h2 id="7">Types</h2> <dl> <div id="Process"> <dt><pre>Process = ref ProcessObj</pre></dt> <dd> Represents an operating system process. <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/osproc.nim#L73" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/osproc.nim#L73" target="_blank">Edit</a> </dd> </div> <div id="ProcessOption"> <dt><pre data-language="nim">ProcessOption = enum
  poEchoCmd,                ## Echo the command before execution.
  poUsePath, ## Asks system to search for executable using PATH environment
              ## variable.
              ## On Windows, this is the default.
  poEvalCommand, ## Pass `command` directly to the shell, without quoting.
                  ## Use it only if `command` comes from trusted source.
  poStdErrToStdOut,         ## Merge stdout and stderr to the stdout stream.
  poParentStreams,          ## Use the parent's streams.
  poInteractive, ## Optimize the buffer handling for responsiveness for
                  ## UI applications. Currently this only affects
                  ## Windows: Named pipes are used so that you can peek
                  ## at the process' output streams.
  poDaemon                   ## Windows: The program creates no Window.
                             ## Unix: Start the program as a daemon. This is still
                             ## work in progress!</pre></dt> <dd> Options that can be passed to <a href="#startProcess,string,string,openArray[string],StringTableRef,set[ProcessOption]">startProcess proc</a>. <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/osproc.nim#L41" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/osproc.nim#L41" target="_blank">Edit</a> </dd> </div> </dl>   <h2 id="12">Procs</h2> <dl> <div id="close-procs-all"> <div id="close,Process"> <dt><pre data-language="nim">proc close(p: Process) {....gcsafe, extern: "nosp$1", raises: [IOError, OSError],
                         tags: [WriteIOEffect], forbids: [].}</pre></dt> <dd> When the process has finished executing, cleanup related handles.<div class="admonition admonition-warning">
<span class="admonition-warning-text"><b>Warning:</b></span> If the process has not finished executing, this will forcibly terminate the process. Doing so may result in zombie processes and <a href="http://stackoverflow.com/questions/27021641/how-to-fix-request-failed-on-channel-0">pty leaks</a>.</div> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/osproc.nim#L155" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/osproc.nim#L155" target="_blank">Edit</a> </dd> </div> </div> <div id="countProcessors-procs-all"> <div id="countProcessors"> <dt><pre data-language="nim">proc countProcessors(): int {....gcsafe, extern: "nosp$1", raises: [], tags: [],
                              forbids: [].}</pre></dt> <dd> Returns the number of the processors/cores the machine has. Returns 0 if it cannot be detected. It is implemented just calling <code><span class="Identifier">cpuinfo</span><span class="Operator">.</span><span class="Identifier">countProcessors</span></code>. <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/osproc.nim#L332" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/osproc.nim#L332" target="_blank">Edit</a> </dd> </div> </div> <div id="errorHandle-procs-all"> <div id="errorHandle,Process"> <dt><pre data-language="nim">proc errorHandle(p: Process): FileHandle {....gcsafe, extern: "nosp$1", raises: [],
    tags: [], forbids: [].}</pre></dt> <dd> Returns <code>p</code>'s error file handle for reading from.<div class="admonition admonition-warning">
<span class="admonition-warning-text"><b>Warning:</b></span> The returned <code><span class="Identifier">FileHandle</span></code> should not be closed manually as it is closed when closing the Process <code>p</code>.</div> <p>See also:</p> <ul class="simple">
<li><a href="#inputHandle,Process">inputHandle proc</a></li> <li><a href="#outputHandle,Process">outputHandle proc</a></li> </ul> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/osproc.nim#L320" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/osproc.nim#L320" target="_blank">Edit</a> </dd> </div> </div> <div id="errorStream-procs-all"> <div id="errorStream,Process"> <dt><pre data-language="nim">proc errorStream(p: Process): Stream {....gcsafe, extern: "nosp$1", tags: [],
                                       raises: [], forbids: [].}</pre></dt> <dd> <p>Returns <code>p</code>'s error stream for reading from.</p> <p>You cannot perform peek/write/setOption operations to this stream. Use <a href="#peekableErrorStream,Process">peekableErrorStream proc</a> if you need to peek stream.</p> <div class="admonition admonition-warning">
<span class="admonition-warning-text"><b>Warning:</b></span> The returned <code><span class="Identifier">Stream</span></code> should not be closed manually as it is closed when closing the Process <code>p</code>.</div> <p>See also:</p> <ul class="simple">
<li><a href="#inputStream,Process">inputStream proc</a></li> <li><a href="#outputStream,Process">outputStream proc</a></li> </ul> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/osproc.nim#L258" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/osproc.nim#L258" target="_blank">Edit</a> </dd> </div> </div> <div id="execCmd-procs-all"> <div id="execCmd,string"> <dt><pre data-language="nim">proc execCmd(command: string): int {....gcsafe, extern: "nosp$1", tags: [
    ExecIOEffect, ReadIOEffect, RootEffect], raises: [OSError], forbids: [].}</pre></dt> <dd> <p>Executes <code>command</code> and returns its error code.</p> <p>Standard input, output, error streams are inherited from the calling process. This operation is also often called <span id="system_1">system</span>.</p> <p>See also:</p> <ul class="simple">
<li><a href="#execCmdEx,string,set[ProcessOption],StringTableRef,string,string">execCmdEx proc</a></li> <li><a href="#startProcess,string,string,openArray[string],StringTableRef,set[ProcessOption]">startProcess proc</a></li> <li><a href="#execProcess,string,string,openArray[string],StringTableRef,set[ProcessOption]">execProcess proc</a></li> </ul> <p>Example:</p> 
<pre class="listing" data-language="nim">let errC = execCmd("nim c -r mytestfile.nim")</pre> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/osproc.nim#L101" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/osproc.nim#L101" target="_blank">Edit</a> </dd> </div> </div> <div id="execCmdEx-procs-all"> <div id="execCmdEx,string,set[ProcessOption],StringTableRef,string,string"> <dt><pre data-language="nim">proc execCmdEx(command: string;
               options: set[ProcessOption] = {poStdErrToStdOut, poUsePath};
               env: StringTableRef = nil; workingDir = ""; input = ""): tuple[
    output: string, exitCode: int] {....raises: [OSError, IOError], tags: [
    ExecIOEffect, ReadIOEffect, RootEffect], gcsafe, forbids: [].}</pre></dt> <dd> <p>A convenience proc that runs the <code><span class="Identifier">command</span></code>, and returns its <code><span class="Identifier">output</span></code> and <code><span class="Identifier">exitCode</span></code>. <code><span class="Identifier">env</span></code> and <code><span class="Identifier">workingDir</span></code> params behave as for <code><span class="Identifier">startProcess</span></code>. If <code><span class="Identifier">input</span><span class="Operator">.</span><span class="Identifier">len</span> <span class="Operator">&gt;</span> <span class="DecNumber">0</span></code>, it is passed as stdin.</p> <p>Note: this could block if <code><span class="Identifier">input</span><span class="Operator">.</span><span class="Identifier">len</span></code> is greater than your OS's maximum pipe buffer size.</p> <p>See also:</p> <ul class="simple">
<li><a href="#execCmd,string">execCmd proc</a></li> <li><a href="#startProcess,string,string,openArray[string],StringTableRef,set[ProcessOption]">startProcess proc</a></li> <li><a href="#execProcess,string,string,openArray[string],StringTableRef,set[ProcessOption]">execProcess proc</a></li> </ul> <p>Example:</p> 
<pre class="listing" data-language="nim">var result = execCmdEx("nim r --hints:off -", options = {}, input = "echo 3*4")
import std/[strutils, strtabs]
stripLineEnd(result[0]) ## portable way to remove trailing newline, if any
doAssert result == ("12", 0)
doAssert execCmdEx("ls --nonexistent").exitCode != 0
when defined(posix):
  assert execCmdEx("echo $FO", env = newStringTable({"FO": "B"})) == ("B\n", 0)
  assert execCmdEx("echo $PWD", workingDir = "/") == ("/\n", 0)</pre> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/osproc.nim#L1521" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/osproc.nim#L1521" target="_blank">Edit</a> </dd> </div> </div> <div id="execProcess-procs-all"> <div id="execProcess,string,string,openArray[string],StringTableRef,set[ProcessOption]"> <dt><pre data-language="nim">proc execProcess(command: string; workingDir: string = "";
                 args: openArray[string] = []; env: StringTableRef = nil;
    options: set[ProcessOption] = {poStdErrToStdOut, poUsePath, poEvalCommand}): string {.
    ...gcsafe, extern: "nosp$1", raises: [OSError, IOError],
    tags: [ExecIOEffect, ReadIOEffect, RootEffect], forbids: [].}</pre></dt> <dd> A convenience procedure that executes <code>command</code> with <code>startProcess</code> and returns its output as a string.<div class="admonition admonition-warning">
<span class="admonition-warning-text"><b>Warning:</b></span> This function uses <code><span class="Identifier">poEvalCommand</span></code> by default for backwards compatibility. Make sure to pass options explicitly.</div> <p>See also:</p> <ul class="simple">
<li><a href="#startProcess,string,string,openArray[string],StringTableRef,set[ProcessOption]">startProcess proc</a></li> <li><a href="#execProcesses,openArray[string],proc(int),proc(int,Process)">execProcesses proc</a></li> <li><a href="#execCmd,string">execCmd proc</a></li> </ul> <p>Example:</p> 
<pre class="listing" data-language="nim">let outp = execProcess("nim", args=["c", "-r", "mytestfile.nim"], options={poUsePath})
let outp_shell = execProcess("nim c -r mytestfile.nim")
# Note: outp may have an interleave of text from the nim compile
# and any output from mytestfile when it runs</pre> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/osproc.nim#L76" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/osproc.nim#L76" target="_blank">Edit</a> </dd> </div> </div> <div id="execProcesses-procs-all"> <div id="execProcesses,openArray[string],proc(int),proc(int,Process)"> <dt><pre data-language="nim">proc execProcesses(cmds: openArray[string];
                   options = {poStdErrToStdOut, poParentStreams};
                   n = countProcessors(); beforeRunEvent: proc (idx: int) = nil;
                   afterRunEvent: proc (idx: int; p: Process) = nil): int {.
    ...gcsafe, extern: "nosp$1", raises: [ValueError, OSError, IOError],
    tags: [ExecIOEffect, TimeEffect, ReadEnvEffect, RootEffect],
    effectsOf: [beforeRunEvent, afterRunEvent], ...forbids: [].}</pre></dt> <dd> <p>Executes the commands <code><span class="Identifier">cmds</span></code> in parallel. Creates <code><span class="Identifier">n</span></code> processes that execute in parallel.</p> <p>The highest (absolute) return value of all processes is returned. Runs <code><span class="Identifier">beforeRunEvent</span></code> before running each command.</p> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/osproc.nim#L341" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/osproc.nim#L341" target="_blank">Edit</a> </dd> </div> </div> <div id="hasData-procs-all"> <div id="hasData,Process"> <dt><pre data-language="nim">proc hasData(p: Process): bool {....raises: [], tags: [], forbids: [].}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/osproc.nim#L903" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/osproc.nim#L903" target="_blank">Edit</a> </dd> </div> </div> <div id="inputHandle-procs-all"> <div id="inputHandle,Process"> <dt><pre data-language="nim">proc inputHandle(p: Process): FileHandle {....gcsafe, raises: [], extern: "nosp$1",
    tags: [], forbids: [].}</pre></dt> <dd> Returns <code>p</code>'s input file handle for writing to.<div class="admonition admonition-warning">
<span class="admonition-warning-text"><b>Warning:</b></span> The returned <code><span class="Identifier">FileHandle</span></code> should not be closed manually as it is closed when closing the Process <code>p</code>.</div> <p>See also:</p> <ul class="simple">
<li><a href="#outputHandle,Process">outputHandle proc</a></li> <li><a href="#errorHandle,Process">errorHandle proc</a></li> </ul> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/osproc.nim#L296" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/osproc.nim#L296" target="_blank">Edit</a> </dd> </div> </div> <div id="inputStream-procs-all"> <div id="inputStream,Process"> <dt><pre data-language="nim">proc inputStream(p: Process): Stream {....gcsafe, extern: "nosp$1", tags: [],
                                       raises: [], forbids: [].}</pre></dt> <dd> Returns <code>p</code>'s input stream for writing to.<div class="admonition admonition-warning">
<span class="admonition-warning-text"><b>Warning:</b></span> The returned <code><span class="Identifier">Stream</span></code> should not be closed manually as it is closed when closing the Process <code>p</code>.</div> <p>See also:</p> <ul class="simple">
<li><a href="#outputStream,Process">outputStream proc</a></li> <li><a href="#errorStream,Process">errorStream proc</a></li> </ul> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/osproc.nim#L234" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/osproc.nim#L234" target="_blank">Edit</a> </dd> </div> </div> <div id="kill-procs-all"> <div id="kill,Process"> <dt><pre data-language="nim">proc kill(p: Process) {....gcsafe, extern: "nosp$1", tags: [], raises: [OSError],
                        forbids: [].}</pre></dt> <dd> <p>Kill the process <code><span class="Identifier">p</span></code>.</p> <p>On Posix OSes the procedure sends <code>SIGKILL</code> to the process. On Windows <code>kill</code> is simply an alias for <a href="#terminate,Process">terminate()</a>.</p> <p>See also:</p> <ul class="simple">
<li><a href="#suspend,Process">suspend proc</a></li> <li><a href="#resume,Process">resume proc</a></li> <li><a href="#terminate,Process">terminate proc</a></li> <li><a href="posix_utils.html#sendSignal,Pid,int">posix_utils.sendSignal(pid: Pid, signal: int)</a></li> </ul> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/osproc.nim#L192" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/osproc.nim#L192" target="_blank">Edit</a> </dd> </div> </div> <div id="outputHandle-procs-all"> <div id="outputHandle,Process"> <dt><pre data-language="nim">proc outputHandle(p: Process): FileHandle {....gcsafe, extern: "nosp$1",
    raises: [], tags: [], forbids: [].}</pre></dt> <dd> Returns <code>p</code>'s output file handle for reading from.<div class="admonition admonition-warning">
<span class="admonition-warning-text"><b>Warning:</b></span> The returned <code><span class="Identifier">FileHandle</span></code> should not be closed manually as it is closed when closing the Process <code>p</code>.</div> <p>See also:</p> <ul class="simple">
<li><a href="#inputHandle,Process">inputHandle proc</a></li> <li><a href="#errorHandle,Process">errorHandle proc</a></li> </ul> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/osproc.nim#L308" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/osproc.nim#L308" target="_blank">Edit</a> </dd> </div> </div> <div id="outputStream-procs-all"> <div id="outputStream,Process"> <dt><pre data-language="nim">proc outputStream(p: Process): Stream {....gcsafe, extern: "nosp$1",
                                        raises: [IOError, OSError], tags: [],
                                        forbids: [].}</pre></dt> <dd> <p>Returns <code>p</code>'s output stream for reading from.</p> <p>You cannot perform peek/write/setOption operations to this stream. Use <a href="#peekableOutputStream,Process">peekableOutputStream proc</a> if you need to peek stream.</p> <div class="admonition admonition-warning">
<span class="admonition-warning-text"><b>Warning:</b></span> The returned <code><span class="Identifier">Stream</span></code> should not be closed manually as it is closed when closing the Process <code>p</code>.</div> <p>See also:</p> <ul class="simple">
<li><a href="#inputStream,Process">inputStream proc</a></li> <li><a href="#errorStream,Process">errorStream proc</a></li> </ul> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/osproc.nim#L244" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/osproc.nim#L244" target="_blank">Edit</a> </dd> </div> </div> <div id="peekableErrorStream-procs-all"> <div id="peekableErrorStream,Process"> <dt><pre data-language="nim">proc peekableErrorStream(p: Process): Stream {....gcsafe, extern: "nosp$1",
    tags: [], raises: [], forbids: [].}</pre></dt> <dd> <p>Returns <code>p</code>'s error stream for reading from.</p> <p>You can run peek operation to returned stream.</p> <div class="admonition admonition-warning">
<span class="admonition-warning-text"><b>Warning:</b></span> The returned <code><span class="Identifier">Stream</span></code> should not be closed manually as it is closed when closing the Process <code>p</code>.</div> <p>See also:</p> <ul class="simple">
<li><a href="#errorStream,Process">errorStream proc</a></li> <li><a href="#peekableOutputStream,Process">peekableOutputStream proc</a></li> </ul> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/osproc.nim#L284" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/osproc.nim#L284" target="_blank">Edit</a> </dd> </div> </div> <div id="peekableOutputStream-procs-all"> <div id="peekableOutputStream,Process"> <dt><pre data-language="nim">proc peekableOutputStream(p: Process): Stream {....gcsafe, extern: "nosp$1",
    tags: [], raises: [], forbids: [].}</pre></dt> <dd> <p>Returns <code>p</code>'s output stream for reading from.</p> <p>You can peek returned stream.</p> <div class="admonition admonition-warning">
<span class="admonition-warning-text"><b>Warning:</b></span> The returned <code><span class="Identifier">Stream</span></code> should not be closed manually as it is closed when closing the Process <code>p</code>.</div> <p>See also:</p> <ul class="simple">
<li><a href="#outputStream,Process">outputStream proc</a></li> <li><a href="#peekableErrorStream,Process">peekableErrorStream proc</a></li> </ul> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/osproc.nim#L272" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/osproc.nim#L272" target="_blank">Edit</a> </dd> </div> </div> <div id="peekExitCode-procs-all"> <div id="peekExitCode,Process"> <dt><pre data-language="nim">proc peekExitCode(p: Process): int {....gcsafe, extern: "nosp$1",
                                     raises: [OSError], tags: [], forbids: [].}</pre></dt> <dd> <p>Return <code><span class="Operator">-</span><span class="DecNumber">1</span></code> if the process is still running. Otherwise the process' exit code.</p> <p>On posix, if the process has exited because of a signal, 128 + signal number will be returned.</p> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/osproc.nim#L228" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/osproc.nim#L228" target="_blank">Edit</a> </dd> </div> </div> <div id="processID-procs-all"> <div id="processID,Process"> <dt><pre data-language="nim">proc processID(p: Process): int {....gcsafe, extern: "nosp$1", raises: [],
                                  tags: [], forbids: [].}</pre></dt> <dd> <p>Returns <code><span class="Identifier">p</span></code>'s process ID.</p> <p>See also:</p> <ul class="simple">
<li><a href="os.html#getCurrentProcessId">os.getCurrentProcessId proc</a></li> </ul> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/osproc.nim#L207" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/osproc.nim#L207" target="_blank">Edit</a> </dd> </div> </div> <div id="readLines-procs-all"> <div id="readLines,Process"> <dt><pre data-language="nim">proc readLines(p: Process): (seq[string], int) {.
    ...raises: [OSError, IOError, ValueError], tags: [ReadIOEffect, TimeEffect],
    forbids: [].}</pre></dt> <dd> <p>Convenience function for working with <code><span class="Identifier">startProcess</span></code> to read data from a background process.</p> <p>See also:</p> <ul class="simple">
<li><a href="#lines.i,Process">lines iterator</a></li> </ul> <p>Example:</p> 
<pre class="listing" data-language="nim">const opts = {poUsePath, poDaemon, poStdErrToStdOut}
var ps: seq[Process]
for prog in ["a", "b"]: # run 2 progs in parallel
  ps.add startProcess("nim", "", ["r", prog], nil, opts)
for p in ps:
  let (lines, exCode) = p.readLines
  if exCode != 0:
    for line in lines: echo line
  p.close</pre> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/osproc.nim#L489" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/osproc.nim#L489" target="_blank">Edit</a> </dd> </div> </div> <div id="resume-procs-all"> <div id="resume,Process"> <dt><pre data-language="nim">proc resume(p: Process) {....gcsafe, extern: "nosp$1", tags: [], raises: [],
                          forbids: [].}</pre></dt> <dd> <p>Resumes the process <code><span class="Identifier">p</span></code>.</p> <p>See also:</p> <ul class="simple">
<li><a href="#suspend,Process">suspend proc</a></li> <li><a href="#terminate,Process">terminate proc</a></li> <li><a href="#kill,Process">kill proc</a></li> </ul> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/osproc.nim#L171" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/osproc.nim#L171" target="_blank">Edit</a> </dd> </div> </div> <div id="running-procs-all"> <div id="running,Process"> <dt><pre data-language="nim">proc running(p: Process): bool {....gcsafe, extern: "nosp$1", raises: [OSError],
                                 tags: [], forbids: [].}</pre></dt> <dd> Returns true if the process <code><span class="Identifier">p</span></code> is still running. Returns immediately. <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/osproc.nim#L204" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/osproc.nim#L204" target="_blank">Edit</a> </dd> </div> </div> <div id="startProcess-procs-all"> <div id="startProcess,string,string,openArray[string],StringTableRef,set[ProcessOption]"> <dt><pre data-language="nim">proc startProcess(command: string; workingDir: string = "";
                  args: openArray[string] = []; env: StringTableRef = nil;
                  options: set[ProcessOption] = {poStdErrToStdOut}): owned(
    Process) {....gcsafe, extern: "nosp$1", raises: [OSError, IOError],
               tags: [ExecIOEffect, ReadEnvEffect, RootEffect], forbids: [].}</pre></dt> <dd> <p>Starts a process. <code><span class="Identifier">Command</span></code> is the executable file, <code><span class="Identifier">workingDir</span></code> is the process's working directory. If <code>workingDir == ""</code> the current directory is used (default). <code><span class="Identifier">args</span></code> are the command line arguments that are passed to the process. On many operating systems, the first command line argument is the name of the executable. <code><span class="Identifier">args</span></code> should <em>not</em> contain this argument! <code><span class="Identifier">env</span></code> is the environment that will be passed to the process. If <code>env == nil</code> (default) the environment is inherited of the parent process. <code><span class="Identifier">options</span></code> are additional flags that may be passed to <code><span class="Identifier">startProcess</span></code>. See the documentation of <a href="#ProcessOption">ProcessOption</a> for the meaning of these flags.</p> <p>You need to <a href="#close,Process">close</a> the process when done.</p> <p>Note that you can't pass any <code><span class="Identifier">args</span></code> if you use the option <code>poEvalCommand</code>, which invokes the system shell to run the specified <code><span class="Identifier">command</span></code>. In this situation you have to concatenate manually the contents of <code><span class="Identifier">args</span></code> to <code><span class="Identifier">command</span></code> carefully escaping/quoting any special characters, since it will be passed <em>as is</em> to the system shell. Each system/shell may feature different escaping rules, so try to avoid this kind of shell invocation if possible as it leads to non portable software.</p> <p>Return value: The newly created process object. Nil is never returned, but <code>OSError</code> is raised in case of an error.</p> <p>See also:</p> <ul class="simple">
<li><a href="#execProcesses,openArray[string],proc(int),proc(int,Process)">execProcesses proc</a></li> <li><a href="#execProcess,string,string,openArray[string],StringTableRef,set[ProcessOption]">execProcess proc</a></li> <li><a href="#execCmd,string">execCmd proc</a></li> </ul> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/osproc.nim#L120" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/osproc.nim#L120" target="_blank">Edit</a> </dd> </div> </div> <div id="suspend-procs-all"> <div id="suspend,Process"> <dt><pre data-language="nim">proc suspend(p: Process) {....gcsafe, extern: "nosp$1", tags: [], raises: [],
                           forbids: [].}</pre></dt> <dd> <p>Suspends the process <code><span class="Identifier">p</span></code>.</p> <p>See also:</p> <ul class="simple">
<li><a href="#resume,Process">resume proc</a></li> <li><a href="#terminate,Process">terminate proc</a></li> <li><a href="#kill,Process">kill proc</a></li> </ul> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/osproc.nim#L162" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/osproc.nim#L162" target="_blank">Edit</a> </dd> </div> </div> <div id="terminate-procs-all"> <div id="terminate,Process"> <dt><pre data-language="nim">proc terminate(p: Process) {....gcsafe, extern: "nosp$1", tags: [],
                             raises: [OSError], forbids: [].}</pre></dt> <dd> <p>Stop the process <code><span class="Identifier">p</span></code>.</p> <p>On Posix OSes the procedure sends <code>SIGTERM</code> to the process. On Windows the Win32 API function <code>TerminateProcess()</code> is called to stop the process.</p> <p>See also:</p> <ul class="simple">
<li><a href="#suspend,Process">suspend proc</a></li> <li><a href="#resume,Process">resume proc</a></li> <li><a href="#kill,Process">kill proc</a></li> <li><a href="posix_utils.html#sendSignal,Pid,int">posix_utils.sendSignal(pid: Pid, signal: int)</a></li> </ul> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/osproc.nim#L179" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/osproc.nim#L179" target="_blank">Edit</a> </dd> </div> </div> <div id="waitForExit-procs-all"> <div id="waitForExit,Process,int"> <dt><pre data-language="nim">proc waitForExit(p: Process; timeout: int = -1): int {....gcsafe, extern: "nosp$1",
    raises: [OSError, ValueError], tags: [TimeEffect], forbids: [].}</pre></dt> <dd> Waits for the process to finish and returns <code><span class="Identifier">p</span></code>'s error code.<div class="admonition admonition-warning">
<span class="admonition-warning-text"><b>Warning:</b></span> Be careful when using <code><span class="Identifier">waitForExit</span></code> for processes created without <code><span class="Identifier">poParentStreams</span></code> because they may fill output buffers, causing deadlock.</div> <p>On posix, if the process has exited because of a signal, 128 + signal number will be returned.</p> <div class="admonition admonition-warning">
<span class="admonition-warning-text"><b>Warning:</b></span> When working with <code><span class="Identifier">timeout</span></code> parameters, remember that the value is typically expressed in milliseconds, and ensure that the correct unit of time is used to avoid unexpected behavior.</div> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/osproc.nim#L214" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/osproc.nim#L214" target="_blank">Edit</a> </dd> </div> </div> </dl>   <h2 id="15">Iterators</h2> <dl> <div id="lines-iterators-all"> <div id="lines.i,Process"> <dt><pre data-language="nim">iterator lines(p: Process; keepNewLines = false): string {.
    ...raises: [OSError, IOError, ValueError], tags: [ReadIOEffect, TimeEffect],
    forbids: [].}</pre></dt> <dd> <p>Convenience iterator for working with <code><span class="Identifier">startProcess</span></code> to read data from a background process.</p> <p>See also:</p> <ul class="simple">
<li><a href="#readLines,Process">readLines proc</a></li> </ul> <p>Example:</p> 
<pre class="listing" data-language="nim">const opts = {poUsePath, poDaemon, poStdErrToStdOut}
var ps: seq[Process]
for prog in ["a", "b"]: # run 2 progs in parallel
  ps.add startProcess("nim", "", ["r", prog], nil, opts)
for p in ps:
  var i = 0
  for line in p.lines:
    echo line
    i.inc
    if i &gt; 100: break
  p.close</pre> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/osproc.nim#L460" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/osproc.nim#L460" target="_blank">Edit</a> </dd> </div> </div> </dl><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2006&ndash;2024 Andreas Rumpf<br>Licensed under the MIT License.<br>
    <a href="https://nim-lang.org/docs/osproc.html" class="_attribution-link">https://nim-lang.org/docs/osproc.html</a>
  </p>
</div>
