<h1 class="title">marshal</h1>  
<p>This module contains procs for <span id="serialization_1">serialization</span> and <span id="deserialization_1">deserialization</span> of arbitrary Nim data structures. The serialization format uses <span id="json_1">JSON</span>.</p> <p><strong>Restriction</strong>: For objects their type is <strong>not</strong> serialized. This means essentially that it does not work if the object has some other runtime type than its compiletime type.</p> <h2 id="basic-usage">Basic usage</h2>
<pre class="listing" data-language="nim">type
  A = object of RootObj
  B = object of A
    f: int

var
  a: ref A
  b: ref B

new(b)
a = b
echo($$a[]) # produces "{}", not "{f: 0}"

# unmarshal
let c = to[B]("""{"f": 2}""")
assert typeof(c) is B
assert c.f == 2

# marshal
let s = $$c
assert s == """{"f": 2}"""</pre>
<p><strong>Note</strong>: The <code>to</code> and <code>$$</code> operations are available at compile-time!</p> <h2 id="see-also">See also</h2>
<ul class="simple">
<li><a href="streams.html">streams module</a></li> <li><a href="json.html">json module</a></li> </ul>  <h2 id="6">Imports</h2> <dl> <a href="streams.html">streams</a>, <a href="typeinfo.html">typeinfo</a>, <a href="json.html">json</a>, <a href="intsets.html">intsets</a>, <a href="tables.html">tables</a>, <a href="unicode.html">unicode</a> </dl>  <h2 id="12">Procs</h2> <dl>  <dt><pre id="load%2CStream%2CT" data-language="nim">proc load[T](s: Stream; data: var T)</pre></dt> <dd> Loads <code>data</code> from the stream <code>s</code>. Raises <code>IOError</code> in case of an error. <p><strong class="examples_text">Example:</strong></p> <pre class="listing" data-language="nim">import marshal, streams
var s = newStringStream("[1, 3, 5]")
var a: array[3, int]
load(s, a)
assert a == [1, 3, 5]</pre> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/pure/marshal.nim#L279" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/marshal.nim#L279" target="_blank">Edit</a> </dd>  <dt><pre id="store%2CStream%2CT" data-language="nim">proc store[T](s: Stream; data: T)</pre></dt> <dd> Stores <code>data</code> into the stream <code>s</code>. Raises <code>IOError</code> in case of an error. <p><strong class="examples_text">Example:</strong></p> <pre class="listing" data-language="nim">import marshal, streams
var s = newStringStream("")
var a = [1, 3, 5]
store(s, a)
s.setPosition(0)
assert s.readAll() == "[1, 3, 5]"</pre> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/pure/marshal.nim#L291" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/marshal.nim#L291" target="_blank">Edit</a> </dd>  <dt><pre id="%24%24%2CT" data-language="nim">proc `$$`[T](x: T): string</pre></dt> <dd> <p>Returns a string representation of <code>x</code> (serialization, marshalling).</p> <p><strong>Note:</strong> to serialize <code>x</code> to JSON use <code>$(%x)</code> from the <code>json</code> module.</p> <p><strong class="examples_text">Example:</strong></p> <pre class="listing" data-language="nim">type
  Foo = object
    id: int
    bar: string
let x = Foo(id: 1, bar: "baz")
## serialize:
let y = $$x
assert y == """{"id": 1, "bar": "baz"}"""</pre> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/pure/marshal.nim#L306" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/marshal.nim#L306" target="_blank">Edit</a> </dd>  <dt><pre id="to%2Cstring" data-language="nim">proc to[T](data: string): T</pre></dt> <dd> Reads data and transforms it to a type <code>T</code> (deserialization, unmarshalling). <p><strong class="examples_text">Example:</strong></p> <pre class="listing" data-language="nim">type
  Foo = object
    id: int
    bar: string
let y = """{"id": 1, "bar": "baz"}"""
assert typeof(y) is string
## deserialize to type 'Foo':
let z = y.to[:Foo]
assert typeof(z) is Foo
assert z.id == 1
assert z.bar == "baz"</pre> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/pure/marshal.nim#L327" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/marshal.nim#L327" target="_blank">Edit</a> </dd> </dl><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2006&ndash;2021 Andreas Rumpf<br>Licensed under the MIT License.<br>
    <a href="https://nim-lang.org/docs/marshal.html" class="_attribution-link">https://nim-lang.org/docs/marshal.html</a>
  </p>
</div>
