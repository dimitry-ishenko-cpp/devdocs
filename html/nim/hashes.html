<h1 class="title">std/hashes</h1> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/hashes.nim#L1" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/hashes.nim#L1" target="_blank">Edit</a>  <p class="module-desc">This module implements efficient computations of hash values for diverse Nim types. All the procs are based on these two building blocks:</p>
<ul class="simple">
<li>
<a href="#!&amp;,Hash,int">!&amp; proc</a> used to start or mix a hash value, and</li> <li>
<a href="#!$,Hash">!$ proc</a> used to finish the hash value.</li> </ul> <p>If you want to implement hash procs for your custom types, you will end up writing the following kind of skeleton of code:</p> <p><strong class="examples_text">Example:</strong></p> <pre class="listing" data-language="nim">import std/hashes
type
  Something = object
    foo: int
    bar: string

iterator items(x: Something): Hash =
  yield hash(x.foo)
  yield hash(x.bar)

proc hash(x: Something): Hash =
  ## Computes a Hash from `x`.
  var h: Hash = 0
  # Iterate over parts of `x`.
  for xAtom in x:
    # Mix the atom with the partial hash.
    h = h !&amp; xAtom
  # Finish the hash.
  result = !$h</pre>If your custom types contain fields for which there already is a <code><span class="Identifier">hash</span></code> proc, you can simply hash together the hash values of the individual fields: <p><strong class="examples_text">Example:</strong></p> <pre class="listing" data-language="nim">import std/hashes
type
  Something = object
    foo: int
    bar: string

proc hash(x: Something): Hash =
  ## Computes a Hash from `x`.
  var h: Hash = 0
  h = h !&amp; hash(x.foo)
  h = h !&amp; hash(x.bar)
  result = !$h</pre>
<div class="admonition admonition-warning">
<span class="admonition-warning-text"><b>Important:</b></span> Use <code><span class="Operator">-</span><span class="Identifier">d</span><span class="Punctuation">:</span><span class="Identifier">nimPreviewHashRef</span></code> to enable hashing <code><span class="Keyword">ref</span></code>s. It is expected that this behavior becomes the new default in upcoming versions.</div> <div class="admonition admonition-info">
<span class="admonition-info-text"><b>Note:</b></span> If the type has a <code><span class="Operator">==</span></code> operator, the following must hold: If two values compare equal, their hashes must also be equal.</div> <h2 id="see-also">See also</h2>
<ul class="simple">
<li>
<a href="md5.html">md5 module</a> for the MD5 checksum algorithm</li> <li>
<a href="base64.html">base64 module</a> for a Base64 encoder and decoder</li> <li>
<a href="sha1.html">sha1 module</a> for the SHA-1 checksum algorithm</li> <li>
<a href="tables.html">tables module</a> for hash tables</li> </ul>  <h2 id="6">Imports</h2> <dl> <a href="since.html">since</a> </dl>   <h2 id="7">Types</h2> <dl> <div id="Hash"> <dt><pre>Hash = int</pre></dt> <dd> A hash value. Hash tables using these values should always have a size of a power of two so they can use the <code><span class="Keyword">and</span></code> operator instead of <code><span class="Keyword">mod</span></code> for truncation of the hash value. <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/hashes.nim#L75" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/hashes.nim#L75" target="_blank">Edit</a> </dd> </div> </dl>   <h2 id="12">Procs</h2> <dl> <div id="!$-procs-all"> <div id="!$,Hash"> <dt><pre data-language="nim">proc `!$`(h: Hash): Hash {.inline, ...raises: [], tags: [], forbids: [].}</pre></dt> <dd> <p>Finishes the computation of the hash value.</p> <p>This is only needed if you need to implement a <code><span class="Identifier">hash</span></code> proc for a new datatype.</p> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/hashes.nim#L90" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/hashes.nim#L90" target="_blank">Edit</a> </dd> </div> </div> <div id="!&amp;-procs-all"> <div id="!&amp;,Hash,int"> <dt><pre data-language="nim">proc `!&amp;`(h: Hash; val: int): Hash {.inline, ...raises: [], tags: [], forbids: [].}</pre></dt> <dd> <p>Mixes a hash value <code><span class="Identifier">h</span></code> with <code><span class="Identifier">val</span></code> to produce a new hash value.</p> <p>This is only needed if you need to implement a <code><span class="Identifier">hash</span></code> proc for a new datatype.</p> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/hashes.nim#L79" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/hashes.nim#L79" target="_blank">Edit</a> </dd> </div> </div> <div id="hash-procs-all"> <div id="hash,string,int,int"> <dt><pre data-language="nim">proc hash(sBuf: string; sPos, ePos: int): Hash {....raises: [], tags: [],
    forbids: [].}</pre></dt> <dd> <p>Efficient hashing of a string buffer, from starting position <code><span class="Identifier">sPos</span></code> to ending position <code><span class="Identifier">ePos</span></code> (included).</p> <p><code><span class="Identifier">hash</span><span class="Punctuation">(</span><span class="Identifier">myStr</span><span class="Punctuation">,</span> <span class="DecNumber">0</span><span class="Punctuation">,</span> <span class="Identifier">myStr</span><span class="Operator">.</span><span class="Identifier">high</span><span class="Punctuation">)</span></code> is equivalent to <code><span class="Identifier">hash</span><span class="Punctuation">(</span><span class="Identifier">myStr</span><span class="Punctuation">)</span></code>.</p> <p><strong class="examples_text">Example:</strong></p> <pre class="listing" data-language="nim">var a = "abracadabra"
doAssert hash(a, 0, 3) == hash(a, 7, 10)</pre> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/hashes.nim#L575" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/hashes.nim#L575" target="_blank">Edit</a> </dd> </div> <div id="hash,cstring"> <dt><pre data-language="nim">proc hash(x: cstring): Hash {....raises: [], tags: [], forbids: [].}</pre></dt> <dd> Efficient hashing of null-terminated strings. <p><strong class="examples_text">Example:</strong></p> <pre class="listing" data-language="nim">doAssert hash(cstring"abracadabra") == hash("abracadabra")
doAssert hash(cstring"AbracadabrA") == hash("AbracadabrA")
doAssert hash(cstring"abracadabra") != hash(cstring"AbracadabrA")</pre> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/hashes.nim#L551" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/hashes.nim#L551" target="_blank">Edit</a> </dd> </div> <div id="hash,float"> <dt><pre data-language="nim">proc hash(x: float): Hash {.inline, ...raises: [], tags: [], forbids: [].}</pre></dt> <dd> Efficient hashing of floats. <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/hashes.nim#L272" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/hashes.nim#L272" target="_blank">Edit</a> </dd> </div> <div id="hash,pointer"> <dt><pre data-language="nim">proc hash(x: pointer): Hash {.inline, ...raises: [], tags: [], forbids: [].}</pre></dt> <dd> Efficient <code><span class="Identifier">hash</span></code> overload. <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/hashes.nim#L231" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/hashes.nim#L231" target="_blank">Edit</a> </dd> </div> <div id="hash,string"> <dt><pre data-language="nim">proc hash(x: string): Hash {....raises: [], tags: [], forbids: [].}</pre></dt> <dd> <p>Efficient hashing of strings.</p> <p><strong>See also:</strong></p> <ul class="simple">
<li><a href="#hashIgnoreStyle,string">hashIgnoreStyle</a></li> <li><a href="#hashIgnoreCase,string">hashIgnoreCase</a></li> </ul> <p><strong class="examples_text">Example:</strong></p> <pre class="listing" data-language="nim">doAssert hash("abracadabra") != hash("AbracadabrA")</pre> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/hashes.nim#L534" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/hashes.nim#L534" target="_blank">Edit</a> </dd> </div> <div id="hash,openArray[A],int,int"> <dt><pre data-language="nim">proc hash[A](aBuf: openArray[A]; sPos, ePos: int): Hash</pre></dt> <dd> <p>Efficient hashing of portions of arrays and sequences, from starting position <code><span class="Identifier">sPos</span></code> to ending position <code><span class="Identifier">ePos</span></code> (included). There must be a <code><span class="Identifier">hash</span></code> proc defined for the element type <code><span class="Identifier">A</span></code>.</p> <p><code><span class="Identifier">hash</span><span class="Punctuation">(</span><span class="Identifier">myBuf</span><span class="Punctuation">,</span> <span class="DecNumber">0</span><span class="Punctuation">,</span> <span class="Identifier">myBuf</span><span class="Operator">.</span><span class="Identifier">high</span><span class="Punctuation">)</span></code> is equivalent to <code><span class="Identifier">hash</span><span class="Punctuation">(</span><span class="Identifier">myBuf</span><span class="Punctuation">)</span></code>.</p> <p><strong class="examples_text">Example:</strong></p> <pre class="listing" data-language="nim">let a = [1, 2, 5, 1, 2, 6]
doAssert hash(a, 0, 1) == hash(a, 3, 4)</pre> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/hashes.nim#L741" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/hashes.nim#L741" target="_blank">Edit</a> </dd> </div> <div id="hash,openArray[A]"> <dt><pre data-language="nim">proc hash[A](x: openArray[A]): Hash</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/hashes.nim#L286" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/hashes.nim#L286" target="_blank">Edit</a> </dd> </div> <div id="hash,set[A]"> <dt><pre data-language="nim">proc hash[A](x: set[A]): Hash</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/hashes.nim#L287" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/hashes.nim#L287" target="_blank">Edit</a> </dd> </div> <div id="hash,T"> <dt><pre data-language="nim">proc hash[T: Ordinal | enum](x: T): Hash {.inline.}</pre></dt> <dd> Efficient hashing of integers. <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/hashes.nim#L213" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/hashes.nim#L213" target="_blank">Edit</a> </dd> </div> <div id="hash,T_2"> <dt><pre data-language="nim">proc hash[T: tuple | object | proc | iterator {.closure.}](x: T): Hash</pre></dt> <dd> Efficient <code><span class="Identifier">hash</span></code> overload. <p><strong class="examples_text">Example:</strong></p> <pre class="listing" data-language="nim"># for `tuple|object`, `hash` must be defined for each component of `x`.
type Obj = object
  x: int
  y: string
type Obj2[T] = object
  x: int
  y: string
assert hash(Obj(x: 520, y: "Nim")) != hash(Obj(x: 520, y: "Nim2"))
# you can define custom hashes for objects (even if they're generic):
proc hash(a: Obj2): Hash = hash((a.x))
assert hash(Obj2[float](x: 520, y: "Nim")) == hash(Obj2[float](x: 520, y: "Nim2"))</pre> <p><strong class="examples_text">Example:</strong></p> <pre class="listing" data-language="nim"># proc
proc fn1() = discard
const fn1b = fn1
assert hash(fn1b) == hash(fn1)

# closure
proc outer =
  var a = 0
  proc fn2() = a.inc
  assert fn2 is "closure"
  let fn2b = fn2
  assert hash(fn2b) == hash(fn2)
  assert hash(fn2) != hash(fn1)
outer()</pre> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/hashes.nim#L679" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/hashes.nim#L679" target="_blank">Edit</a> </dd> </div> <div id="hash,ptr."> <dt><pre data-language="nim">proc hash[T](x: ptr [T]): Hash {.inline.}</pre></dt> <dd> Efficient <code><span class="Identifier">hash</span></code> overload. <p><strong class="examples_text">Example:</strong></p> <pre class="listing" data-language="nim">var a: array[10, uint8]
assert a[0].addr.hash != a[1].addr.hash
assert cast[pointer](a[0].addr).hash == a[0].addr.hash</pre> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/hashes.nim#L239" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/hashes.nim#L239" target="_blank">Edit</a> </dd> </div> <div id="hash,ref."> <dt><pre data-language="nim">proc hash[T](x: ref [T]): Hash {.inline.}</pre></dt> <dd> Efficient <code><span class="Identifier">hash</span></code> overload.<div class="admonition admonition-warning">
<span class="admonition-warning-text"><b>Important:</b></span> Use <code><span class="Operator">-</span><span class="Identifier">d</span><span class="Punctuation">:</span><span class="Identifier">nimPreviewHashRef</span></code> to enable hashing <code><span class="Keyword">ref</span></code>s. It is expected that this behavior becomes the new default in upcoming versions.</div> <p><strong class="examples_text">Example: cmd: -d:nimPreviewHashRef</strong></p> <pre class="listing" data-language="nim">type A = ref object
  x: int
let a = A(x: 3)
let ha = a.hash
assert ha != A(x: 3).hash # A(x: 3) is a different ref object from `a`.
a.x = 4
assert ha == a.hash # the hash only depends on the address</pre> <p><strong class="examples_text">Example: cmd: -d:nimPreviewHashRef</strong></p> <pre class="listing" data-language="nim"># you can overload `hash` if you want to customize semantics
type A[T] = ref object
  x, y: T
proc hash(a: A): Hash = hash(a.x)
assert A[int](x: 3, y: 4).hash == A[int](x: 3, y: 5).hash</pre> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/hashes.nim#L248" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/hashes.nim#L248" target="_blank">Edit</a> </dd> </div> </div> <div id="hashData-procs-all"> <div id="hashData,pointer,int"> <dt><pre data-language="nim">proc hashData(data: pointer; size: int): Hash {....raises: [], tags: [],
    forbids: [].}</pre></dt> <dd> Hashes an array of bytes of size <code><span class="Identifier">size</span></code>. <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/hashes.nim#L188" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/hashes.nim#L188" target="_blank">Edit</a> </dd> </div> </div> <div id="hashIdentity-procs-all"> <div id="hashIdentity,T"> <dt><pre data-language="nim">proc hashIdentity[T: Ordinal | enum](x: T): Hash {.inline.}</pre></dt> <dd> The identity hash, i.e. <code><span class="Identifier">hashIdentity</span><span class="Punctuation">(</span><span class="Identifier">x</span><span class="Punctuation">)</span> <span class="Operator">=</span> <span class="Identifier">x</span></code>. <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/hashes.nim#L204" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/hashes.nim#L204" target="_blank">Edit</a> </dd> </div> </div> <div id="hashIgnoreCase-procs-all"> <div id="hashIgnoreCase,string,int,int"> <dt><pre data-language="nim">proc hashIgnoreCase(sBuf: string; sPos, ePos: int): Hash {....raises: [], tags: [],
    forbids: [].}</pre></dt> <dd> <p>Efficient hashing of a string buffer, from starting position <code><span class="Identifier">sPos</span></code> to ending position <code><span class="Identifier">ePos</span></code> (included); case is ignored.</p> <p><strong>Note:</strong> This uses a different hashing algorithm than <code><span class="Identifier">hash</span><span class="Punctuation">(</span><span class="Identifier">string</span><span class="Punctuation">)</span></code>.</p> <p><code><span class="Identifier">hashIgnoreCase</span><span class="Punctuation">(</span><span class="Identifier">myBuf</span><span class="Punctuation">,</span> <span class="DecNumber">0</span><span class="Punctuation">,</span> <span class="Identifier">myBuf</span><span class="Operator">.</span><span class="Identifier">high</span><span class="Punctuation">)</span></code> is equivalent to <code><span class="Identifier">hashIgnoreCase</span><span class="Punctuation">(</span><span class="Identifier">myBuf</span><span class="Punctuation">)</span></code>.</p> <p><strong class="examples_text">Example:</strong></p> <pre class="listing" data-language="nim">var a = "ABracadabRA"
doAssert hashIgnoreCase(a, 0, 3) == hashIgnoreCase(a, 7, 10)</pre> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/hashes.nim#L659" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/hashes.nim#L659" target="_blank">Edit</a> </dd> </div> <div id="hashIgnoreCase,string"> <dt><pre data-language="nim">proc hashIgnoreCase(x: string): Hash {....raises: [], tags: [], forbids: [].}</pre></dt> <dd> <p>Efficient hashing of strings; case is ignored.</p> <p><strong>Note:</strong> This uses a different hashing algorithm than <code><span class="Identifier">hash</span><span class="Punctuation">(</span><span class="Identifier">string</span><span class="Punctuation">)</span></code>.</p> <p><strong>See also:</strong></p> <ul class="simple">
<li><a href="#hashIgnoreStyle,string">hashIgnoreStyle</a></li> </ul> <p><strong class="examples_text">Example:</strong></p> <pre class="listing" data-language="nim">doAssert hashIgnoreCase("ABRAcaDABRA") == hashIgnoreCase("abRACAdabra")
doAssert hashIgnoreCase("abcdefghi") != hash("abcdefghi")</pre> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/hashes.nim#L640" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/hashes.nim#L640" target="_blank">Edit</a> </dd> </div> </div> <div id="hashIgnoreStyle-procs-all"> <div id="hashIgnoreStyle,string,int,int"> <dt><pre data-language="nim">proc hashIgnoreStyle(sBuf: string; sPos, ePos: int): Hash {....raises: [],
    tags: [], forbids: [].}</pre></dt> <dd> <p>Efficient hashing of a string buffer, from starting position <code><span class="Identifier">sPos</span></code> to ending position <code><span class="Identifier">ePos</span></code> (included); style is ignored.</p> <p><strong>Note:</strong> This uses a different hashing algorithm than <code><span class="Identifier">hash</span><span class="Punctuation">(</span><span class="Identifier">string</span><span class="Punctuation">)</span></code>.</p> <p><code><span class="Identifier">hashIgnoreStyle</span><span class="Punctuation">(</span><span class="Identifier">myBuf</span><span class="Punctuation">,</span> <span class="DecNumber">0</span><span class="Punctuation">,</span> <span class="Identifier">myBuf</span><span class="Operator">.</span><span class="Identifier">high</span><span class="Punctuation">)</span></code> is equivalent to <code><span class="Identifier">hashIgnoreStyle</span><span class="Punctuation">(</span><span class="Identifier">myBuf</span><span class="Punctuation">)</span></code>.</p> <p><strong class="examples_text">Example:</strong></p> <pre class="listing" data-language="nim">var a = "ABracada_b_r_a"
doAssert hashIgnoreStyle(a, 0, 3) == hashIgnoreStyle(a, 7, a.high)</pre> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/hashes.nim#L615" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/hashes.nim#L615" target="_blank">Edit</a> </dd> </div> <div id="hashIgnoreStyle,string"> <dt><pre data-language="nim">proc hashIgnoreStyle(x: string): Hash {....raises: [], tags: [], forbids: [].}</pre></dt> <dd> <p>Efficient hashing of strings; style is ignored.</p> <p><strong>Note:</strong> This uses a different hashing algorithm than <code><span class="Identifier">hash</span><span class="Punctuation">(</span><span class="Identifier">string</span><span class="Punctuation">)</span></code>.</p> <p><strong>See also:</strong></p> <ul class="simple">
<li><a href="#hashIgnoreCase,string">hashIgnoreCase</a></li> </ul> <p><strong class="examples_text">Example:</strong></p> <pre class="listing" data-language="nim">doAssert hashIgnoreStyle("aBr_aCa_dAB_ra") == hashIgnoreStyle("abracadabra")
doAssert hashIgnoreStyle("abcdefghi") != hash("abcdefghi")</pre> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/hashes.nim#L590" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/hashes.nim#L590" target="_blank">Edit</a> </dd> </div> </div> <div id="hashWangYi1-procs-all"> <div id="hashWangYi1"> <dt><pre data-language="nim">proc hashWangYi1(x: int64 | uint64 | Hash): Hash {.inline.}</pre></dt> <dd> <p>Wang Yi's hash_v1 for 64-bit ints (see <a href="https://github.com/rurban/smhasher">https://github.com/rurban/smhasher</a> for more details). This passed all scrambling tests in Spring 2019 and is simple.</p> <p><strong>Note:</strong> It's ok to define <code><span class="Keyword">proc</span><span class="Punctuation">(</span><span class="Identifier">x</span><span class="Punctuation">:</span> <span class="Identifier">int16</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">Hash</span> <span class="Operator">=</span> <span class="Identifier">hashWangYi1</span><span class="Punctuation">(</span><span class="Identifier">Hash</span><span class="Punctuation">(</span><span class="Identifier">x</span><span class="Punctuation">)</span><span class="Punctuation">)</span></code>.</p> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/lib/pure/hashes.nim#L165" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/hashes.nim#L165" target="_blank">Edit</a> </dd> </div> </div> </dl><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2006&ndash;2024 Andreas Rumpf<br>Licensed under the MIT License.<br>
    <a href="https://nim-lang.org/docs/hashes.html" class="_attribution-link">https://nim-lang.org/docs/hashes.html</a>
  </p>
</div>
