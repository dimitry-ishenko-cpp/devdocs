<h1 class="title">smtp</h1>  
<p>This module implements the SMTP client protocol as specified by RFC 5321, this can be used to send mail to any SMTP Server.</p> <p>This module also implements the protocol used to format messages, as specified by RFC 2822.</p> <p>Example gmail use:</p> <pre class="listing" data-language="nim">var msg = createMessage("Hello from Nim's SMTP",
                        "Hello!.\n Is this awesome or what?",
                        @["foo@gmail.com"])
let smtpConn = newSmtp(useSsl = true, debug=true)
smtpConn.connect("smtp.gmail.com", Port 465)
smtpConn.auth("username", "password")
smtpConn.sendmail("username@gmail.com", @["foo@gmail.com"], $msg)</pre>
<p>Example for startTls use:</p> <pre class="listing" data-language="nim">var msg = createMessage("Hello from Nim's SMTP",
                        "Hello!.\n Is this awesome or what?",
                        @["foo@gmail.com"])
let smtpConn = newSmtp(debug=true)
smtpConn.connect("smtp.mailtrap.io", Port 2525)
smtpConn.startTls()
smtpConn.auth("username", "password")
smtpConn.sendmail("username@gmail.com", @["foo@gmail.com"], $msg)</pre>
<p>For SSL support this module relies on OpenSSL. If you want to enable SSL, compile with <code>-d:ssl</code>.</p>  <h2 id="6">Imports</h2> <dl> <a href="net.html">net</a>, <a href="strutils.html">strutils</a>, <a href="strtabs.html">strtabs</a>, <a href="base64.html">base64</a>, <a href="os.html">os</a>, <a href="strutils.html">strutils</a>, <a href="asyncnet.html">asyncnet</a>, <a href="asyncdispatch.html">asyncdispatch</a>, <a href="parsecfg.html">parsecfg</a> </dl>  <h2 id="7">Types</h2> <dl>  <dt><pre id="Message" data-language="nim">Message = object
  msgTo: seq[string]
  msgCc: seq[string]
  msgSubject: string
  msgOtherHeaders: StringTableRef
  msgBody: string</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/pure/smtp.nim#L52" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/smtp.nim#L52" target="_blank">Edit</a> </dd>  <dt><pre id="ReplyError">ReplyError = object of IOError</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/pure/smtp.nim#L59" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/smtp.nim#L59" target="_blank">Edit</a> </dd>  <dt><pre id="Smtp" data-language="nim">Smtp = SmtpBase[Socket]</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/pure/smtp.nim#L66" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/smtp.nim#L66" target="_blank">Edit</a> </dd>  <dt><pre id="AsyncSmtp" data-language="nim">AsyncSmtp = SmtpBase[AsyncSocket]</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/pure/smtp.nim#L67" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/smtp.nim#L67" target="_blank">Edit</a> </dd> </dl>  <h2 id="12">Procs</h2> <dl>  <dt><pre id="debugSend%2CAsyncSmtp%2Cstring" data-language="nim">proc debugSend(smtp: AsyncSmtp; cmd: string): owned(Future[void]) {...}{.
    raises: [Exception], tags: [RootEffect].}</pre></dt> <dd> <p>Sends <code>cmd</code> on the socket connected to the SMTP server.</p> <p>If the <code>smtp</code> object was created with <code>debug</code> enabled, debugSend will invoke <code>echo("C:" &amp; cmd)</code> before sending.</p> <p>This is a lower level proc and not something that you typically would need to call when using this module. One exception to this is if you are implementing any <a href="https://en.wikipedia.org/wiki/Extended_SMTP">SMTP extensions</a>.</p> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/pure/smtp.nim#L74" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/smtp.nim#L74" target="_blank">Edit</a> </dd>  <dt><pre id="debugSend%2CSmtp%2Cstring" data-language="nim">proc debugSend(smtp: Smtp; cmd: string) {...}{.raises: [SslError, OSError],
    tags: [WriteIOEffect].}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/pure/smtp.nim#L74" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/smtp.nim#L74" target="_blank">Edit</a> </dd>  <dt><pre id="debugRecv%2CAsyncSmtp" data-language="nim">proc debugRecv(smtp: AsyncSmtp): Future[TaintedString] {...}{.
    raises: [Exception, ValueError], tags: [RootEffect].}</pre></dt> <dd> <p>Receives a line of data from the socket connected to the SMTP server.</p> <p>If the <code>smtp</code> object was created with <code>debug</code> enabled, debugRecv will invoke <code>echo("S:" &amp; result.string)</code> after the data is received.</p> <p>This is a lower level proc and not something that you typically would need to call when using this module. One exception to this is if you are implementing any <a href="https://en.wikipedia.org/wiki/Extended_SMTP">SMTP extensions</a>.</p> <p>See <a href="#checkReply,,string">checkReply(reply)</a>.</p> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/pure/smtp.nim#L89" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/smtp.nim#L89" target="_blank">Edit</a> </dd>  <dt><pre id="debugRecv%2CSmtp" data-language="nim">proc debugRecv(smtp: Smtp): TaintedString {...}{.
    raises: [TimeoutError, OSError, SslError], tags: [ReadIOEffect, TimeEffect].}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/pure/smtp.nim#L89" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/smtp.nim#L89" target="_blank">Edit</a> </dd>  <dt><pre id="createMessage%2Cstring%2Cstring%2Cseq%5Bstring%5D%2Cseq%5Bstring%5D%2CopenArray%5Btuple%5Bstring%2Cstring%5D%5D" data-language="nim">proc createMessage(mSubject, mBody: string; mTo, mCc: seq[string];
                   otherHeaders: openArray[tuple[name, value: string]]): Message {...}{.
    raises: [], tags: [].}</pre></dt> <dd> <p>Creates a new MIME compliant message.</p> <p>You need to make sure that <code>mSubject</code>, <code>mTo</code> and <code>mCc</code> don't contain any newline characters. Failing to do so will raise <code>AssertionDefect</code>.</p> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/pure/smtp.nim#L124" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/smtp.nim#L124" target="_blank">Edit</a> </dd>  <dt><pre id="createMessage%2Cstring%2Cstring%2Cseq%5Bstring%5D%2Cseq%5Bstring%5D" data-language="nim">proc createMessage(mSubject, mBody: string; mTo, mCc: seq[string] = @[]): Message {...}{.
    raises: [], tags: [].}</pre></dt> <dd> <p>Alternate version of the above.</p> <p>You need to make sure that <code>mSubject</code>, <code>mTo</code> and <code>mCc</code> don't contain any newline characters. Failing to do so will raise <code>AssertionDefect</code>.</p> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/pure/smtp.nim#L143" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/smtp.nim#L143" target="_blank">Edit</a> </dd>  <dt><pre id="%24%2CMessage" data-language="nim">proc `$`(msg: Message): string {...}{.raises: [], tags: [].}</pre></dt> <dd> stringify for <code>Message</code>. <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/pure/smtp.nim#L159" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/smtp.nim#L159" target="_blank">Edit</a> </dd>  <dt><pre id="newSmtp%2CSslContext" data-language="nim">proc newSmtp(useSsl = false; debug = false; sslContext: SslContext = nil): Smtp {...}{.
    raises: [OSError, SslError, Exception, LibraryError, IOError],
    tags: [RootEffect, ReadDirEffect, ReadEnvEffect].}</pre></dt> <dd> Creates a new <code>Smtp</code> instance. <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/pure/smtp.nim#L174" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/smtp.nim#L174" target="_blank">Edit</a> </dd>  <dt><pre id="newAsyncSmtp%2CSslContext" data-language="nim">proc newAsyncSmtp(useSsl = false; debug = false; sslContext: SslContext = nil): AsyncSmtp {...}{.
    raises: [OSError, Exception, SslError, LibraryError, IOError],
    tags: [RootEffect, ReadDirEffect, ReadEnvEffect].}</pre></dt> <dd> Creates a new <code>AsyncSmtp</code> instance. <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/pure/smtp.nim#L189" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/smtp.nim#L189" target="_blank">Edit</a> </dd>  <dt><pre id="checkReply%2CAsyncSmtp%2Cstring" data-language="nim">proc checkReply(smtp: AsyncSmtp; reply: string): owned(Future[void]) {...}{.
    raises: [Exception], tags: [RootEffect].}</pre></dt> <dd> <p>Calls <a href="#debugRecv">debugRecv</a> and checks that the received data starts with <code>reply</code>. If the received data does not start with <code>reply</code>, then a <code>QUIT</code> command will be sent to the SMTP server and a <code>ReplyError</code> exception will be raised.</p> <p>This is a lower level proc and not something that you typically would need to call when using this module. One exception to this is if you are implementing any <a href="https://en.wikipedia.org/wiki/Extended_SMTP">SMTP extensions</a>.</p> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/pure/smtp.nim#L213" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/smtp.nim#L213" target="_blank">Edit</a> </dd>  <dt><pre id="checkReply%2CSmtp%2Cstring" data-language="nim">proc checkReply(smtp: Smtp; reply: string) {...}{.
    raises: [TimeoutError, OSError, SslError, ReplyError],
    tags: [ReadIOEffect, TimeEffect, WriteIOEffect].}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/pure/smtp.nim#L213" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/smtp.nim#L213" target="_blank">Edit</a> </dd>  <dt><pre id="helo%2CAsyncSmtp" data-language="nim">proc helo(smtp: AsyncSmtp): owned(Future[void]) {...}{.raises: [Exception],
    tags: [RootEffect].}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/pure/smtp.nim#L228" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/smtp.nim#L228" target="_blank">Edit</a> </dd>  <dt><pre id="helo%2CSmtp" data-language="nim">proc helo(smtp: Smtp) {...}{.raises: [SslError, OSError, TimeoutError, ReplyError],
                        tags: [WriteIOEffect, ReadIOEffect, TimeEffect].}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/pure/smtp.nim#L228" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/smtp.nim#L228" target="_blank">Edit</a> </dd>  <dt><pre id="connect%2CAsyncSmtp%2Cstring%2CPort" data-language="nim">proc connect(smtp: AsyncSmtp; address: string; port: Port): owned(Future[void]) {...}{.
    raises: [Exception], tags: [RootEffect].}</pre></dt> <dd> Establishes a connection with a SMTP server. May fail with ReplyError or with a socket error. <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/pure/smtp.nim#L233" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/smtp.nim#L233" target="_blank">Edit</a> </dd>  <dt><pre id="connect%2CSmtp%2Cstring%2CPort" data-language="nim">proc connect(smtp: Smtp; address: string; port: Port) {...}{.
    raises: [OSError, SslError, TimeoutError, ReplyError],
    tags: [ReadIOEffect, TimeEffect, WriteIOEffect].}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/pure/smtp.nim#L234" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/smtp.nim#L234" target="_blank">Edit</a> </dd>  <dt><pre id="startTls%2CAsyncSmtp%2CSslContext" data-language="nim">proc startTls(smtp: AsyncSmtp; sslContext: SslContext = nil): owned(Future[void]) {...}{.
    raises: [Exception], tags: [RootEffect, ReadDirEffect, ReadEnvEffect].}</pre></dt> <dd> Put the SMTP connection in TLS (Transport Layer Security) mode. May fail with ReplyError <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/pure/smtp.nim#L242" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/smtp.nim#L242" target="_blank">Edit</a> </dd>  <dt><pre id="startTls%2CSmtp%2CSslContext" data-language="nim">proc startTls(smtp: Smtp; sslContext: SslContext = nil) {...}{.raises: [SslError,
    OSError, TimeoutError, ReplyError, Exception, LibraryError, IOError], tags: [
    WriteIOEffect, ReadIOEffect, TimeEffect, RootEffect, ReadDirEffect,
    ReadEnvEffect].}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/pure/smtp.nim#L242" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/smtp.nim#L242" target="_blank">Edit</a> </dd>  <dt><pre id="auth%2CAsyncSmtp%2Cstring%2Cstring" data-language="nim">proc auth(smtp: AsyncSmtp; username, password: string): owned(Future[void]) {...}{.
    raises: [Exception], tags: [RootEffect].}</pre></dt> <dd> Sends an AUTH command to the server to login as the <code>username</code> using <code>password</code>. May fail with ReplyError. <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/pure/smtp.nim#L256" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/smtp.nim#L256" target="_blank">Edit</a> </dd>  <dt><pre id="auth%2CSmtp%2Cstring%2Cstring" data-language="nim">proc auth(smtp: Smtp; username, password: string) {...}{.
    raises: [SslError, OSError, TimeoutError, ReplyError],
    tags: [WriteIOEffect, ReadIOEffect, TimeEffect].}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/pure/smtp.nim#L256" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/smtp.nim#L256" target="_blank">Edit</a> </dd>  <dt><pre id="sendMail%2CAsyncSmtp%2Cstring%2Cseq%5Bstring%5D%2Cstring" data-language="nim">proc sendMail(smtp: AsyncSmtp; fromAddr: string; toAddrs: seq[string];
              msg: string): owned(Future[void]) {...}{.raises: [Exception],
    tags: [RootEffect].}</pre></dt> <dd> <p>Sends <code>msg</code> from <code>fromAddr</code> to the addresses specified in <code>toAddrs</code>. Messages may be formed using <code>createMessage</code> by converting the Message into a string.</p> <p>You need to make sure that <code>fromAddr</code> and <code>toAddrs</code> don't contain any newline characters. Failing to do so will raise <code>AssertionDefect</code>.</p> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/pure/smtp.nim#L270" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/smtp.nim#L270" target="_blank">Edit</a> </dd>  <dt><pre id="sendMail%2CSmtp%2Cstring%2Cseq%5Bstring%5D%2Cstring" data-language="nim">proc sendMail(smtp: Smtp; fromAddr: string; toAddrs: seq[string]; msg: string) {...}{.
    raises: [SslError, OSError, TimeoutError, ReplyError],
    tags: [WriteIOEffect, ReadIOEffect, TimeEffect].}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/pure/smtp.nim#L271" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/smtp.nim#L271" target="_blank">Edit</a> </dd>  <dt><pre id="close%2CAsyncSmtp" data-language="nim">proc close(smtp: AsyncSmtp): owned(Future[void]) {...}{.raises: [Exception],
    tags: [RootEffect].}</pre></dt> <dd> Disconnects from the SMTP server and closes the socket. <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/pure/smtp.nim#L294" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/smtp.nim#L294" target="_blank">Edit</a> </dd>  <dt><pre id="close%2CSmtp" data-language="nim">proc close(smtp: Smtp) {...}{.raises: [SslError, OSError, Exception, LibraryError],
                         tags: [WriteIOEffect, RootEffect].}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/pure/smtp.nim#L294" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/pure/smtp.nim#L294" target="_blank">Edit</a> </dd> </dl>  <h2 id="19">Exports</h2> <dl> <a href="nativesockets.html#Port"><span class="Identifier">Port</span></a> </dl><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2006&ndash;2021 Andreas Rumpf<br>Licensed under the MIT License.<br>
    <a href="https://nim-lang.org/docs/smtp.html" class="_attribution-link">https://nim-lang.org/docs/smtp.html</a>
  </p>
</div>
