<h1 class="title">Nim Compiler User Guide</h1> <a href="https://github.com/nim-lang/Nim/tree/version-2-2/doc/nimc.md#L1" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/doc/nimc.md#L1" target="_blank">Edit</a>  
<blockquote class="markdown-quote"><p>"Look at you, hacker. A pathetic creature of meat and bone, panting and sweating as you run through my corridors. How can you challenge a perfect, immortal machine?"</p></blockquote> <h2 id="introduction">Introduction</h2>
<p>This document describes the usage of the <em>Nim compiler</em> on the different supported platforms. It is not a definition of the Nim programming language (which is covered in the <a href="manual.html">manual</a>).</p> <p>Nim is free software; it is licensed under the <a href="http://www.opensource.org/licenses/mit-license.php">MIT License</a>.</p> <h2 id="compiler-usage">Compiler Usage</h2> <h3 id="compiler-usage-commandminusline-switches">Command-line switches</h3>
<p>All options that take a <code><span class="Identifier">PATH</span></code> or <code><span class="Identifier">DIR</span></code> argument are subject to path substitution:</p> <ul class="simple">
<li>
<code><span class="Operator">$</span><span class="Identifier">nim</span></code>: The global nim prefix path</li> <li>
<code><span class="Operator">$</span><span class="Identifier">lib</span></code>: The stdlib path</li> <li>
<code><span class="Operator">$</span><span class="Identifier">home</span></code> and <code><span class="Operator">~</span></code>: The user's home path</li> <li>
<code><span class="Operator">$</span><span class="Identifier">config</span></code>: The directory of the module currently being compiled</li> <li>
<code><span class="Operator">$</span><span class="Identifier">projectname</span></code>: The project file's name without file extension</li> <li>
<code><span class="Operator">$</span><span class="Identifier">projectpath</span></code> and <code><span class="Operator">$</span><span class="Identifier">projectdir</span></code>: The project file's path</li> <li>
<code><span class="Operator">$</span><span class="Identifier">nimcache</span></code>: The nimcache path</li> </ul> <p>Basic command-line switches are:</p> <p>Usage:</p> <pre data-language="nim">nim command [options] [projectfile] [arguments]</pre> <p>Command:</p> <div class="option-list">
<div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">compile, c</span></code></div>
<div class="option-list-description">compile project with default code generator (C)</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">r</span></code></div>
<div class="option-list-description">compile to $nimcache/projname, run with <code>arguments</code> using backend specified by <code>--backend</code> (default: c)</div>
</div> <div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">doc</span></code></div>
<div class="option-list-description">generate the documentation for inputfile for backend specified by <code>--backend</code> (default: c)</div>
</div> </div>
<p>Arguments: arguments are passed to the program being run (if --run option is selected)</p> <p>Options:</p> <div class="option-list">
<div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">-p, --path:PATH</span></code></div>
<div class="option-list-description">add path to search paths</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">-d, --define:SYMBOL(:VAL)</span></code></div>
<div class="option-list-description">define a conditional symbol (Optionally: Define the value for that symbol, see: "compile time define pragmas")</div>
</div> <div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">-u, --undef:SYMBOL</span></code></div>
<div class="option-list-description">undefine a conditional symbol</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">-f, --forceBuild:on|off</span></code></div>
<div class="option-list-description">force rebuilding of all modules</div>
</div> <div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">--stackTrace:on|off</span></code></div>
<div class="option-list-description">turn stack tracing on|off</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">--lineTrace:on|off</span></code></div>
<div class="option-list-description">turn line tracing on|off</div>
</div> <div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">--threads:on|off</span></code></div>
<div class="option-list-description">turn support for multi-threading on|off</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">-x, --checks:on|off</span></code></div>
<div class="option-list-description">turn all runtime checks on|off</div>
</div> <div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">-a, --assertions:on|off</span></code></div>
<div class="option-list-description">turn assertions on|off</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">--opt:none|speed|size</span></code></div>
<div class="option-list-description">optimize not at all or for speed|size Note: use -d:release for a release build!</div>
</div> <div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">--debugger:native</span></code></div>
<div class="option-list-description">use native debugger (gdb)</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">--app:console|gui|lib|staticlib</span></code></div>
<div class="option-list-description">generate a console app|GUI app|DLL|static library</div>
</div> <div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">-r, --run</span></code></div>
<div class="option-list-description">run the compiled program with given arguments</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">--eval:cmd</span></code></div>
<div class="option-list-description">evaluate nim code directly; e.g.: <code>nim --eval:"echo 1"</code> defaults to <code>e</code> (nimscript) but customizable: <code>nim r --eval:'for a in stdin.lines: echo a'</code>
</div>
</div> <div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">--fullhelp</span></code></div>
<div class="option-list-description">show all command line switches</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">-h, --help</span></code></div>
<div class="option-list-description">show this help</div>
</div> <div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">-v, --version</span></code></div>
<div class="option-list-description">show detailed version information</div>
</div> </div>
<p>Note, single letter options that take an argument require a colon. E.g. -p:PATH. </p> <hr> <p>Advanced command-line switches are:</p> Advanced commands:<div class="option-list">
<div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">compileToC, cc</span></code></div>
<div class="option-list-description">compile project with C code generator</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">compileToCpp, cpp</span></code></div>
<div class="option-list-description">compile project to C++ code</div>
</div> <div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">compileToOC, objc</span></code></div>
<div class="option-list-description">compile project to Objective C code</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">js</span></code></div>
<div class="option-list-description">compile project to Javascript</div>
</div> <div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">e</span></code></div>
<div class="option-list-description">run a Nimscript file</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">md2html</span></code></div>
<div class="option-list-description">convert a Markdown file to HTML use <code>--docCmd:skip</code> to skip compiling snippets</div>
</div> <div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">rst2html</span></code></div>
<div class="option-list-description">convert a reStructuredText file to HTML use <code>--docCmd:skip</code> to skip compiling snippets</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">md2tex</span></code></div>
<div class="option-list-description">convert a Markdown file to LaTeX</div>
</div> <div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">rst2tex</span></code></div>
<div class="option-list-description">convert a reStructuredText file to LaTeX</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">doc2tex</span></code></div>
<div class="option-list-description">extract the documentation to a LaTeX file</div>
</div> <div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">jsondoc</span></code></div>
<div class="option-list-description">extract the documentation to a json file</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">ctags</span></code></div>
<div class="option-list-description">create a tags file</div>
</div> <div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">buildIndex</span></code></div>
<div class="option-list-description">build an index for the whole documentation</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">genDepend</span></code></div>
<div class="option-list-description">generate a DOT file containing the module dependency graph</div>
</div> <div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">dump</span></code></div>
<div class="option-list-description">dump all defined conditionals and search paths see also: --dump.format:json (useful with: <code>| jq</code>)</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">check</span></code></div>
<div class="option-list-description">checks the project for syntax and semantics (can be combined with --defusages)</div>
</div> </div>
<p>Runtime checks (see -x):</p> <div class="option-list">
<div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">--objChecks:on|off</span></code></div>
<div class="option-list-description">turn obj conversion checks on|off</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">--fieldChecks:on|off</span></code></div>
<div class="option-list-description">turn case variant field checks on|off</div>
</div> <div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">--rangeChecks:on|off</span></code></div>
<div class="option-list-description">turn range checks on|off</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">--boundChecks:on|off</span></code></div>
<div class="option-list-description">turn bound checks on|off</div>
</div> <div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">--overflowChecks:on|off</span></code></div>
<div class="option-list-description">turn int over-/underflow checks on|off</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">--floatChecks:on|off</span></code></div>
<div class="option-list-description">turn all floating point (NaN/Inf) checks on|off</div>
</div> <div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">--nanChecks:on|off</span></code></div>
<div class="option-list-description">turn NaN checks on|off</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">--infChecks:on|off</span></code></div>
<div class="option-list-description">turn Inf checks on|off</div>
</div> </div>
<p>Advanced options:</p> <div class="option-list">
<div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">--defusages:FILE,LINE,COL</span></code></div>
<div class="option-list-description">find the definition and all usages of a symbol</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">-o:FILE, --out:FILE</span></code></div>
<div class="option-list-description">set the output filename</div>
</div> <div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">--outdir:DIR</span></code></div>
<div class="option-list-description">set the path where the output file will be written</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">--usenimcache</span></code></div>
<div class="option-list-description">will use <code>outdir=$$nimcache</code>, whichever it resolves to after all options have been processed</div>
</div> <div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">--stdout:on|off</span></code></div>
<div class="option-list-description">output to stdout</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">--colors:on|off</span></code></div>
<div class="option-list-description">turn compiler messages coloring on|off</div>
</div> <div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">--filenames:abs|canonical|legacyRelProj</span></code></div>
<div class="option-list-description">customize how filenames are rendered in compiler messages, defaults to <code>abs</code> (absolute)</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">--processing:dots|filenames|off</span></code></div>
<div class="option-list-description">show files as they're being processed by nim compiler</div>
</div> <div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">--unitsep:on|off</span></code></div>
<div class="option-list-description">use the ASCII unit separator (31) between error messages, useful for IDE-like tooling</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">--declaredLocs:on|off</span></code></div>
<div class="option-list-description">show declaration locations in messages</div>
</div> <div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">--spellSuggest:num</span></code></div>
<div class="option-list-description">show at most <code>num &gt;= 0</code> spelling suggestions on typos. if <code>num</code> is not specified (or <code>auto</code>), return an implementation defined set of suggestions.</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">--hints:on|off|list.</span></code></div>
<div class="option-list-description">
<code>on|off</code> enables or disables hints. <code>list</code> reports which hints are selected.</div>
</div> <div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">--hint:X:on|off</span></code></div>
<div class="option-list-description">turn specific hint X on|off. <code>hint:X</code> means <code>hint:X:on</code>, as with similar flags. <code>all</code> is the set of all hints (only <code>all:off</code> is supported).</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">--hintAsError:X:on|off</span></code></div>
<div class="option-list-description">turn specific hint X into an error on|off</div>
</div> <div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">-w:on|off|list, --warnings:on|off|list</span></code></div>
<div class="option-list-description">
<code>on|off</code> enables or disables warnings. <code>list</code> reports which warnings are selected.</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">--warning:X:on|off</span></code></div>
<div class="option-list-description">turn specific warning X on|off. <code>warning:X</code> means <code>warning:X:on</code>, as with similar flags. <code>all</code> is the set of all warning (only <code>all:off</code> is supported).</div>
</div> <div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">--warningAsError:X:on|off</span></code></div>
<div class="option-list-description">turn specific warning X into an error on|off</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">--styleCheck:off|hint|error</span></code></div>
<div class="option-list-description">produce hints or errors for Nim identifiers that do not adhere to Nim's official style guide <a href="nep1.html">https://nim-lang.org/docs/nep1.html</a>
</div>
</div> <div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">--styleCheck:usages</span></code></div>
<div class="option-list-description">only enforce consistent spellings of identifiers, do not enforce the style on declarations</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">--showAllMismatches:on|off</span></code></div>
<div class="option-list-description">show all mismatching candidates in overloading resolution</div>
</div> <div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">--lib:PATH</span></code></div>
<div class="option-list-description">set the system library path</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">--import:PATH</span></code></div>
<div class="option-list-description">add an automatically imported module see also <code>patchFile</code> in nimscript which offers more flexibility.</div>
</div> <div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">--include:PATH</span></code></div>
<div class="option-list-description">add an automatically included module</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">--nimcache:PATH</span></code></div>
<div class="option-list-description">set the path used for generated files see also <a href="nimc.html#compiler-usage-generated-c-code-directory">https://nim-lang.org/docs/nimc.html#compiler-usage-generated-c-code-directory</a>
</div>
</div> <div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">-c, --compileOnly:on|off</span></code></div>
<div class="option-list-description">compile Nim files only; do not assemble or link</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">--noLinking:on|off</span></code></div>
<div class="option-list-description">compile Nim and generated files but do not link</div>
</div> <div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">--noMain:on|off</span></code></div>
<div class="option-list-description">do not generate a main procedure</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">--genScript:on|off</span></code></div>
<div class="option-list-description">generate a compile script (in the 'nimcache' subdirectory named 'compile_$$project$$scriptext'), and a '.deps' file containing the dependencies; implies --compileOnly</div>
</div> <div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">--os:SYMBOL</span></code></div>
<div class="option-list-description">set the target operating system (cross-compilation)</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">--cpu:SYMBOL</span></code></div>
<div class="option-list-description">set the target processor (cross-compilation)</div>
</div> <div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">--debuginfo:on|off</span></code></div>
<div class="option-list-description">enables debug information</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">-t, --passC:OPTION</span></code></div>
<div class="option-list-description">pass an option to the C compiler</div>
</div> <div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">-l, --passL:OPTION</span></code></div>
<div class="option-list-description">pass an option to the linker</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">--cc:SYMBOL</span></code></div>
<div class="option-list-description">specify the C compiler</div>
</div> <div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">--cincludes:DIR</span></code></div>
<div class="option-list-description">modify the C compiler header search path</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">--clibdir:DIR</span></code></div>
<div class="option-list-description">modify the linker library search path</div>
</div> <div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">--clib:LIBNAME</span></code></div>
<div class="option-list-description">link an additional C library (you should omit platform-specific extensions)</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">--project</span></code></div>
<div class="option-list-description">document the whole project (doc)</div>
</div> <div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">--docRoot:path</span></code></div>
<div class="option-list-description">
<code>nim doc --docRoot:/foo --project --outdir:docs /foo/sub/main.nim</code> generates: docs/sub/main.html if path == @pkg, will use nimble file enclosing dir if path == @path, will use first matching dir in <code>--path</code> if path == @default (the default and most useful), will use best match among @pkg,@path. if these are nonexistent, will use project path</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">-b, --backend:c|cpp|js|objc</span></code></div>
<div class="option-list-description">sets backend to use with commands like <code>nim doc</code> or <code>nim r</code>
</div>
</div> <div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">--docCmd:cmd</span></code></div>
<div class="option-list-description">if <code>cmd == skip</code>, skips runnableExamples else, runs runnableExamples with given options, e.g.: <code>--docCmd:"-d:foo --threads:on"</code>
</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">--docSeeSrcUrl:url</span></code></div>
<div class="option-list-description">activate 'see source' for doc command (see doc.item.seesrc in config/nimdoc.cfg)</div>
</div> <div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">--docInternal</span></code></div>
<div class="option-list-description">also generate documentation for non-exported symbols</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">--lineDir:on|off</span></code></div>
<div class="option-list-description">generation of #line directive on|off</div>
</div> <div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">--embedsrc:on|off</span></code></div>
<div class="option-list-description">embeds the original source code as comments in the generated output</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">--tlsEmulation:on|off</span></code></div>
<div class="option-list-description">turn thread local storage emulation on|off</div>
</div> <div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">--implicitStatic:on|off</span></code></div>
<div class="option-list-description">turn implicit compile time evaluation on|off</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">--trmacros:on|off</span></code></div>
<div class="option-list-description">turn term rewriting macros on|off</div>
</div> <div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">--multimethods:on|off</span></code></div>
<div class="option-list-description">turn multi-methods on|off</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">--hotCodeReloading:on|off</span></code></div>
<div class="option-list-description">turn support for hot code reloading on|off</div>
</div> <div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">--excessiveStackTrace:on|off</span></code></div>
<div class="option-list-description">stack traces use full file paths</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">--stackTraceMsgs:on|off</span></code></div>
<div class="option-list-description">enable user defined stack frame msgs via <code>setFrameMsg</code>
</div>
</div> <div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">--skipCfg:on|off</span></code></div>
<div class="option-list-description">do not read the nim installation's configuration file</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">--skipUserCfg:on|off</span></code></div>
<div class="option-list-description">do not read the user's configuration file</div>
</div> <div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">--skipParentCfg:on|off</span></code></div>
<div class="option-list-description">do not read the parent dirs' configuration files</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">--skipProjCfg:on|off</span></code></div>
<div class="option-list-description">do not read the project's configuration file</div>
</div> <div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">--mm:orc|arc|refc|markAndSweep|boehm|go|none|regions</span></code></div>
<div class="option-list-description">select which memory management to use; default is 'orc'</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">--exceptions:setjmp|cpp|goto|quirky</span></code></div>
<div class="option-list-description">select the exception handling implementation</div>
</div> <div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">--index:on|off|only</span></code></div>
<div class="option-list-description">docgen: turn index file generation on|off (<code>only</code> means not generate output files like HTML)</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">--noImportdoc:on|off</span></code></div>
<div class="option-list-description">turn loading documentation <code>.idx</code> files on|off</div>
</div> <div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">--putenv:key=value</span></code></div>
<div class="option-list-description">set an environment variable</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">--NimblePath:PATH</span></code></div>
<div class="option-list-description">add a path for Nimble support</div>
</div> <div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">--noNimblePath</span></code></div>
<div class="option-list-description">deactivate the Nimble path</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">--clearNimblePath</span></code></div>
<div class="option-list-description">empty the list of Nimble package search paths</div>
</div> <div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">--cppCompileToNamespace:namespace</span></code></div>
<div class="option-list-description">use the provided namespace for the generated C++ code, if no namespace is provided "Nim" will be used</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">--nimMainPrefix:prefix</span></code></div>
<div class="option-list-description">use <code>{prefix}NimMain</code> instead of <code>NimMain</code> in the produced C/C++ code</div>
</div> <div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">--expandMacro:MACRO</span></code></div>
<div class="option-list-description">dump every generated AST from MACRO</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">--expandArc:PROCNAME</span></code></div>
<div class="option-list-description">show how PROCNAME looks like after diverse optimizations before the final backend phase (mostly ARC/ORC specific)</div>
</div> <div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">--excludePath:PATH</span></code></div>
<div class="option-list-description">exclude a path from the list of search paths</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">--dynlibOverride:SYMBOL</span></code></div>
<div class="option-list-description">marks SYMBOL so that dynlib:SYMBOL has no effect and can be statically linked instead; symbol matching is fuzzy so that --dynlibOverride:lua matches dynlib: "liblua.so.3"</div>
</div> <div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">--dynlibOverrideAll</span></code></div>
<div class="option-list-description">disables the effects of the dynlib pragma</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">--listCmd</span></code></div>
<div class="option-list-description">list the compilation commands; can be combined with <code>--hint:exec:on</code> and <code>--hint:link:on</code>
</div>
</div> <div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">--asm</span></code></div>
<div class="option-list-description">produce assembler code</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">--parallelBuild:0|1|...</span></code></div>
<div class="option-list-description">perform a parallel build value = number of processors (0 for auto-detect)</div>
</div> <div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">--incremental:on|off</span></code></div>
<div class="option-list-description">only recompile the changed modules (experimental!)</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">--verbosity:0|1|2|3</span></code></div>
<div class="option-list-description">set Nim's verbosity level (1 is default)</div>
</div> <div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">--errorMax:N</span></code></div>
<div class="option-list-description">stop compilation after N errors; 0 means unlimited</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">--maxLoopIterationsVM:N</span></code></div>
<div class="option-list-description">set max iterations for all VM loops</div>
</div> <div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">--experimental:$1</span></code></div>
<div class="option-list-description">enable experimental language feature</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">--legacy:$2</span></code></div>
<div class="option-list-description">enable obsolete/legacy language feature</div>
</div> <div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">--benchmarkVM:on|off</span></code></div>
<div class="option-list-description">turn benchmarking of VM code with cpuTime() on|off</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">--profileVM:on|off</span></code></div>
<div class="option-list-description">turn compile time VM profiler on|off</div>
</div> <div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">--panics:on|off</span></code></div>
<div class="option-list-description">turn panics into process terminations (default: off)</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">--deepcopy:on|off</span></code></div>
<div class="option-list-description">enable 'system.deepCopy' for <code>--mm:arc|orc</code>
</div>
</div> <div class="option-list-item odd">
<div class="option-list-label"><code><span class="option">--jsbigint64:on|off</span></code></div>
<div class="option-list-description">toggle the use of BigInt for 64-bit integers for the JavaScript backend (default: on)</div>
</div> <div class="option-list-item">
<div class="option-list-label"><code><span class="option">--nimBasePattern:nimbase.h</span></code></div>
<div class="option-list-description">allows to specify a custom pattern for <code>nimbase.h</code>
</div>
</div> </div> <h3 id="compiler-usage-list-of-warnings">List of warnings</h3>
<p>Each warning can be activated individually with <code>--warning:NAME:on|off</code> or in a <code><span class="Identifier">push</span></code> pragma with <code><span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">warning</span><span class="Punctuation">[</span><span class="Identifier">NAME</span><span class="Punctuation">]</span><span class="Punctuation">:</span><span class="Identifier">on</span><span class="Operator">|</span><span class="Identifier">off</span><span class="Operator">.</span><span class="Punctuation">}</span></code>.</p> <table>
<tr>
<th>Name</th>
<th>Description</th>
</tr> <tr>
<td>CannotOpenFile</td>
<td>Some file not essential for the compiler's working could not be opened.</td>
</tr> <tr>
<td>OctalEscape</td>
<td>The code contains an unsupported octal sequence.</td>
</tr> <tr>
<td>Deprecated</td>
<td>The code uses a deprecated symbol.</td>
</tr> <tr>
<td>ConfigDeprecated</td>
<td>The project makes use of a deprecated config file.</td>
</tr> <tr>
<td>SmallLshouldNotBeUsed</td>
<td>The letter 'l' should not be used as an identifier.</td>
</tr> <tr>
<td>EachIdentIsTuple</td>
<td>The code contains a confusing <code><span class="Keyword">var</span></code> declaration.</td>
</tr> <tr>
<td>CStringConv</td>
<td>Warn about dangerous implicit conversions to <code><span class="Identifier">cstring</span></code>.</td>
</tr> <tr>
<td>EnumConv</td>
<td>Warn about conversions from enum to enum.</td>
</tr> <tr>
<td>AnyEnumConv</td>
<td>Warn about any conversions to an enum type.</td>
</tr> <tr>
<td>HoleEnumConv</td>
<td>Warn about conversion to an enum with holes. These conversions are unsafe.</td>
</tr> <tr>
<td>ResultUsed</td>
<td>Warn about the usage of the built-in <code><span class="Identifier">result</span></code> variable.</td>
</tr> <tr>
<td>User</td>
<td>Some user-defined warning.</td>
</tr> </table> <h3 id="compiler-usage-list-of-hints">List of hints</h3>
<p>Each hint can be activated individually with <code>--hint:NAME:on|off</code> or in a <code><span class="Identifier">push</span></code> pragma with <code><span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">hint</span><span class="Punctuation">[</span><span class="Identifier">NAME</span><span class="Punctuation">]</span><span class="Punctuation">:</span><span class="Identifier">on</span><span class="Operator">|</span><span class="Identifier">off</span><span class="Operator">.</span><span class="Punctuation">}</span></code>.</p> <table>
<tr>
<th>Name</th>
<th>Description</th>
</tr> <tr>
<td>CC</td>
<td>Shows when the C compiler is called.</td>
</tr> <tr>
<td>CodeBegin</td>
<td></td>
</tr> <tr>
<td>CodeEnd</td>
<td></td>
</tr> <tr>
<td>CondTrue</td>
<td></td>
</tr> <tr>
<td>Conf</td>
<td>A config file was loaded.</td>
</tr> <tr>
<td>ConvToBaseNotNeeded</td>
<td></td>
</tr> <tr>
<td>ConvFromXtoItselfNotNeeded</td>
<td></td>
</tr> <tr>
<td>Dependency</td>
<td></td>
</tr> <tr>
<td>Exec</td>
<td>Program is executed.</td>
</tr> <tr>
<td>ExprAlwaysX</td>
<td></td>
</tr> <tr>
<td>ExtendedContext</td>
<td></td>
</tr> <tr>
<td>GCStats</td>
<td>Dumps statistics about the Garbage Collector.</td>
</tr> <tr>
<td>GlobalVar</td>
<td>Shows global variables declarations.</td>
</tr> <tr>
<td>Link</td>
<td>Linking phase.</td>
</tr> <tr>
<td>Name</td>
<td></td>
</tr> <tr>
<td>Path</td>
<td>Search paths modifications.</td>
</tr> <tr>
<td>Pattern</td>
<td></td>
</tr> <tr>
<td>Performance</td>
<td></td>
</tr> <tr>
<td>Processing</td>
<td>Artifact being compiled.</td>
</tr> <tr>
<td>QuitCalled</td>
<td></td>
</tr> <tr>
<td>Source</td>
<td>The source line that triggered a diagnostic message.</td>
</tr> <tr>
<td>StackTrace</td>
<td></td>
</tr> <tr>
<td>Success, SuccessX</td>
<td>Successful compilation of a library or a binary.</td>
</tr> <tr>
<td>User</td>
<td></td>
</tr> <tr>
<td>UserRaw</td>
<td></td>
</tr> <tr>
<td>XDeclaredButNotUsed</td>
<td>Unused symbols in the code.</td>
</tr> </table> <h3 id="compiler-usage-verbosity-levels">Verbosity levels</h3>
<table>
<tr>
<th>Level</th>
<th>Description</th>
</tr> <tr>
<td>0</td>
<td>Minimal output level for the compiler.</td>
</tr> <tr>
<td>1</td>
<td>Displays compilation of all the compiled files, including those imported by other modules or through the <a href="manual.html#implementation-specific-pragmas-compile-pragma">compile pragma</a>. This is the default level.</td>
</tr> <tr>
<td>2</td>
<td>Displays compilation statistics, enumerates the dynamic libraries that will be loaded by the final binary, and dumps to standard output the result of applying <a href="filters.html">a filter to the source code</a> if any filter was used during compilation.</td>
</tr> <tr>
<td>3</td>
<td>In addition to the previous levels dumps a debug stack trace for compiler developers.</td>
</tr> </table> <h3 id="compiler-usage-compileminustime-symbols">Compile-time symbols</h3>
<p>Through the <code>-d:x</code> or <code>--define:x</code> switch you can define compile-time symbols for conditional compilation. The defined switches can be checked in source code with the <a href="manual.html#statements-and-expressions-when-statement">when statement</a> and <a href="system.html#defined,untyped">defined proc</a>. The typical use of this switch is to enable builds in release mode (<code>-d:release</code>) where optimizations are enabled for better performance. Another common use is the <code>-d:ssl</code> switch to activate SSL sockets.</p> <p>Additionally, you may pass a value along with the symbol: <code>-d:x=y</code> which may be used in conjunction with the <a href="manual.html#implementation-specific-pragmas-compileminustime-define-pragmas">compile-time define pragmas</a> to override symbols during build time.</p> <p>Compile-time symbols are completely <strong>case insensitive</strong> and underscores are ignored too. <code>--define:FOO</code> and <code>--define:foo</code> are identical.</p> <p>Compile-time symbols starting with the <code><span class="Identifier">nim</span></code> prefix are reserved for the implementation and should not be used elsewhere.</p> <table>
<tr>
<th>Name</th>
<th>Description</th>
</tr> <tr>
<td>nimStdSetjmp</td>
<td>Use the standard <code><span class="Identifier">setjmp</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Operator">/</span><span class="Identifier">longjmp</span><span class="Punctuation">(</span><span class="Punctuation">)</span></code> library functions for setjmp-based exceptions. This is the default on most platforms.</td>
</tr> <tr>
<td>nimSigSetjmp</td>
<td>Use <code><span class="Identifier">sigsetjmp</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Operator">/</span><span class="Identifier">siglongjmp</span><span class="Punctuation">(</span><span class="Punctuation">)</span></code> for setjmp-based exceptions.</td>
</tr> <tr>
<td>nimRawSetjmp</td>
<td>Use <code><span class="Identifier">_setjmp</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Operator">/</span><span class="Identifier">_longjmp</span><span class="Punctuation">(</span><span class="Punctuation">)</span></code> on POSIX and <code><span class="Identifier">_setjmp</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Operator">/</span><span class="Identifier">longjmp</span><span class="Punctuation">(</span><span class="Punctuation">)</span></code> on Windows, for setjmp-based exceptions. It's the default on BSDs and BSD-like platforms, where it's significantly faster than the standard functions.</td>
</tr> <tr>
<td>nimBuiltinSetjmp</td>
<td>Use <code><span class="Identifier">__builtin_setjmp</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Operator">/</span><span class="Identifier">__builtin_longjmp</span><span class="Punctuation">(</span><span class="Punctuation">)</span></code> for setjmp-based exceptions. This will not work if an exception is being thrown and caught inside the same procedure. Useful for benchmarking.</td>
</tr> </table> <h3 id="compiler-usage-configuration-files">Configuration files</h3>
<p><strong>Note:</strong> The <em>project file name</em> is the name of the <code>.nim</code> file that is passed as a command-line argument to the compiler.</p> <p>The <code><span class="program">nim</span></code> executable processes configuration files in the following directories (in this order; later files overwrite previous settings):</p> <ol class="simple">
<li>
<code>$nim/config/nim.cfg</code>, <code>/etc/nim/nim.cfg</code> (UNIX) or <code>&lt;Nim's installation directory&gt;\config\nim.cfg</code> (Windows). This file can be skipped with the <code>--skipCfg</code> command line option.</li> <li>If environment variable <code><span class="Identifier">XDG_CONFIG_HOME</span></code> is defined, <code>$XDG_CONFIG_HOME/nim/nim.cfg</code> or <code>~/.config/nim/nim.cfg</code> (POSIX) or <code>%APPDATA%/nim/nim.cfg</code> (Windows). This file can be skipped with the <code>--skipUserCfg</code> command line option.</li> <li>
<code>$parentDir/nim.cfg</code> where <code>$parentDir</code> stands for any parent directory of the project file's path. These files can be skipped with the <code>--skipParentCfg</code> command-line option.</li> <li>
<code>$projectDir/nim.cfg</code> where <code>$projectDir</code> stands for the project file's path. This file can be skipped with the <code>--skipProjCfg</code> command-line option.</li> <li>A project can also have a project-specific configuration file named <code>$project.nim.cfg</code> that resides in the same directory as <code>$project.nim</code>. This file can be skipped with the <code>--skipProjCfg</code> command-line option.</li> </ol> <p>Command-line settings have priority over configuration file settings.</p> <p>The default build of a project is a <span id="debug-build_1">debug build</span>. To compile a <span id="release-build_1">release build</span> define the <code><span class="Identifier">release</span></code> symbol:</p> 
<pre class="listing" data-language="nim">nim c -d:release myproject.nim</pre> <p>To compile a <span id="dangerous-release-build_1">dangerous release build</span> define the <code><span class="Identifier">danger</span></code> symbol:</p> 
<pre class="listing" data-language="nim">nim c -d:danger myproject.nim</pre> <h3 id="compiler-usage-search-path-handling">Search path handling</h3>
<p>Nim has the concept of a global search path (PATH) that is queried to determine where to find imported modules or include files. If multiple files are found an ambiguity error is produced.</p> <p><code><span class="program">nim</span> <span class="option">dump</span></code> shows the contents of the PATH.</p> <p>However before the PATH is used the current directory is checked for the file's existence. So if PATH contains <code>$lib</code> and <code>$lib/bar</code> and the directory structure looks like this:</p> <pre data-language="nim">$lib/x.nim
$lib/bar/x.nim
foo/x.nim
foo/main.nim
other.nim</pre> <p>And <code><span class="Identifier">main</span></code> imports <code><span class="Identifier">x</span></code>, <code><span class="Identifier">foo</span><span class="Operator">/</span><span class="Identifier">x</span></code> is imported. If <code><span class="Identifier">other</span></code> imports <code><span class="Identifier">x</span></code> then both <code>$lib/x.nim</code> and <code>$lib/bar/x.nim</code> match but <code>$lib/x.nim</code> is used as it is the first match.</p> <h3 id="compiler-usage-generated-c-code-directory">Generated C code directory</h3>
<p>The generated files that Nim produces all go into a subdirectory called <code>nimcache</code>. Its full path is</p> <ul class="simple">
<li>
<code>$XDG_CACHE_HOME/nim/$projectname(_r|_d)</code> or <code>~/.cache/nim/$projectname(_r|_d)</code> on Posix</li> <li>
<code>$HOME\nimcache\$projectname(_r|_d)</code> on Windows.</li> </ul> <p>The <code><span class="Identifier">_r</span></code> suffix is used for release builds, <code><span class="Identifier">_d</span></code> is for debug builds.</p> <p>This makes it easy to delete all generated files.</p> <p>The <code>--nimcache</code> <a href="#compiler-usage-commandminusline-switches">compiler switch</a> can be used to to change the <code>nimcache</code> directory.</p> <p>However, the generated C code is not platform-independent. C code generated for Linux does not compile on Windows, for instance. The comment on top of the C file lists the OS, CPU, and CC the file has been compiled for.</p> <h2 id="compiler-selection">Compiler Selection</h2>
<p>To change the compiler from the default compiler (at the command line):</p> 
<pre class="listing" data-language="nim">nim c --cc:llvm_gcc --compile_only myfile.nim</pre> <p>This uses the configuration defined in <code>config\nim.cfg</code> for <code><span class="program">llvm_gcc</span></code>.</p> <p>If nimcache already contains compiled code from a different compiler for the same project, add the <code>-f</code> flag to force all files to be recompiled.</p> <p>The default compiler is defined at the top of <code>config\nim.cfg</code>. Changing this setting affects the compiler used by <code><span class="program">koch</span></code> to (re)build Nim.</p> <p>To use the <code><span class="Identifier">CC</span></code> environment variable, use <code><span class="program">nim</span> <span class="option">c</span> <span class="option">--cc:env</span> <span class="Identifier">myfile.nim</span></code>. To use the <code><span class="Identifier">CXX</span></code> environment variable, use <code><span class="program">nim</span> <span class="option">cpp</span> <span class="option">--cc:env</span> <span class="Identifier">myfile.nim</span></code>. <code>--cc:env</code> is available since Nim version 1.4.</p> <h2 id="crossminuscompilation">Cross-compilation</h2>
<p>To cross compile, use for example:</p> 
<pre class="listing" data-language="nim">nim c --cpu:i386 --os:linux --compileOnly --genScript myproject.nim</pre> <p>Then move the C code and the compile script <code><span class="program">compile_myproject.sh</span></code> to your Linux i386 machine and run the script.</p> <p>Another way is to make Nim invoke a cross compiler toolchain:</p> 
<pre class="listing" data-language="nim">nim c --cpu:arm --os:linux myproject.nim</pre> <p>For cross compilation, the compiler invokes a C compiler named like <code><span class="Operator">$</span><span class="Identifier">cpu</span><span class="Operator">.$</span><span class="Identifier">os</span><span class="Operator">.$</span><span class="Identifier">cc</span></code> (for example <code><span class="Identifier">arm</span><span class="Operator">.</span><span class="Identifier">linux</span><span class="Operator">.</span><span class="Identifier">gcc</span></code>) with options defined in <code><span class="Operator">$</span><span class="Identifier">cpu</span><span class="Operator">.$</span><span class="Identifier">os</span><span class="Operator">.$</span><span class="Identifier">cc</span><span class="Operator">.</span><span class="Identifier">options</span><span class="Operator">.</span><span class="Identifier">always</span></code>. The configuration system is used to provide meaningful defaults. For example, for Linux on a 32-bit ARM CPU, your configuration file should contain something like:</p> <pre data-language="nim">arm.linux.gcc.path = "/usr/bin"
arm.linux.gcc.exe = "arm-linux-gcc"
arm.linux.gcc.linkerexe = "arm-linux-gcc"
arm.linux.gcc.options.always = "-w -fmax-errors=3"</pre> <h2 id="crossminuscompilation-for-windows">Cross-compilation for Windows</h2>
<p>To cross-compile for Windows from Linux or macOS using the MinGW-w64 toolchain:</p> 
<pre class="listing" data-language="nim">nim c -d:mingw myproject.nim
# `nim r` also works, running the binary via `wine` or `wine64`:
nim r -d:mingw --eval:'import os; echo "a" / "b"'</pre> <p>Use <code>--cpu:i386</code> or <code>--cpu:amd64</code> to switch the CPU architecture.</p> <p>The MinGW-w64 toolchain can be installed as follows:</p> 
<pre class="listing" data-language="nim">apt install mingw-w64   # Ubuntu
yum install mingw32-gcc
yum install mingw64-gcc # CentOS - requires EPEL
brew install mingw-w64  # OSX</pre> <h2 id="crossminuscompilation-for-android">Cross-compilation for Android</h2>
<p>There are two ways to compile for Android: terminal programs (Termux) and with the NDK (Android Native Development Kit).</p> <p>The first one is to treat Android as a simple Linux and use <a href="https://wiki.termux.com">Termux</a> to connect and run the Nim compiler directly on android as if it was Linux. These programs are console-only programs that can't be distributed in the Play Store.</p> <p>Use regular <code><span class="program">nim</span> <span class="option">c</span></code> inside termux to make Android terminal programs.</p> <p>Normal Android apps are written in Java, to use Nim inside an Android app you need a small Java stub that calls out to a native library written in Nim using the <a href="https://developer.android.com/ndk">NDK</a>. You can also use <a href="https://developer.android.com/ndk/samples/sample_na">native-activity</a> to have the Java stub be auto-generated for you.</p> <p>Use <code><span class="program">nim</span> <span class="option">c</span> <span class="option">-c</span> <span class="option">--cpu:arm</span> <span class="option">--os:android</span> <span class="option">-d:androidNDK</span> <span class="option">--noMain:on</span></code> to generate the C source files you need to include in your Android Studio project. Add the generated C files to CMake build script in your Android project. Then do the final compile with Android Studio which uses Gradle to call CMake to compile the project.</p> <p>Because Nim is part of a library it can't have its own C-style <code><span class="Identifier">main</span><span class="Punctuation">(</span><span class="Punctuation">)</span></code> so you would need to define your own <code><span class="Identifier">android_main</span></code> and init the Java environment, or use a library like SDL2 or GLFM to do it. After the Android stuff is done, it's very important to call <code><span class="Identifier">NimMain</span><span class="Punctuation">(</span><span class="Punctuation">)</span></code> in order to initialize Nim's garbage collector and to run the top level statements of your program.</p> 
<pre class="listing" data-language="nim">proc NimMain() {.importc.}
proc glfmMain*(display: ptr GLFMDisplay) {.exportc.} =
  NimMain() # initialize garbage collector memory, types and stack</pre> <p>The name <code><span class="Identifier">NimMain</span></code> can be influenced via the <code><span class="Operator">--</span><span class="Identifier">nimMainPrefix</span><span class="Punctuation">:</span><span class="Identifier">prefix</span></code> switch. Use <code><span class="Operator">--</span><span class="Identifier">nimMainPrefix</span><span class="Punctuation">:</span><span class="Identifier">MyLib</span></code> and the function to call is named <code><span class="Identifier">MyLibNimMain</span></code>.</p> <h2 id="crossminuscompilation-for-ios">Cross-compilation for iOS</h2>
<p>To cross-compile for iOS you need to be on a macOS computer and use XCode. Normal languages for iOS development are Swift and Objective C. Both of these use LLVM and can be compiled into object files linked together with C, C++ or Objective C code produced by Nim.</p> <p>Use <code><span class="program">nim</span> <span class="option">c</span> <span class="option">-c</span> <span class="option">--os:ios</span> <span class="option">--noMain:on</span></code> to generate C files and include them in your XCode project. Then you can use XCode to compile, link, package and sign everything.</p> <p>Because Nim is part of a library it can't have its own C-style <code><span class="Identifier">main</span><span class="Punctuation">(</span><span class="Punctuation">)</span></code> so you would need to define <code><span class="Identifier">main</span></code> that calls <code><span class="Identifier">autoreleasepool</span></code> and <code><span class="Identifier">UIApplicationMain</span></code> to do it, or use a library like SDL2 or GLFM. After the iOS setup is done, it's very important to call <code><span class="Identifier">NimMain</span><span class="Punctuation">(</span><span class="Punctuation">)</span></code> to initialize Nim's garbage collector and to run the top-level statements of your program.</p> 
<pre class="listing" data-language="nim">proc NimMain() {.importc.}
proc glfmMain*(display: ptr GLFMDisplay) {.exportc.} =
  NimMain() # initialize garbage collector memory, types and stack</pre> <p>Note: XCode's "make clean" gets confused about the generated nim.c files, so you need to clean those files manually to do a clean build.</p> <p>The name <code><span class="Identifier">NimMain</span></code> can be influenced via the <code><span class="Operator">--</span><span class="Identifier">nimMainPrefix</span><span class="Punctuation">:</span><span class="Identifier">prefix</span></code> switch. Use <code><span class="Operator">--</span><span class="Identifier">nimMainPrefix</span><span class="Punctuation">:</span><span class="Identifier">MyLib</span></code> and the function to call is named <code><span class="Identifier">MyLibNimMain</span></code>.</p> <h2 id="crossminuscompilation-for-nintendo-switch">Cross-compilation for Nintendo Switch</h2>
<p>Simply add <code>--os:nintendoswitch</code> to your usual <code><span class="program">nim</span> <span class="option">c</span></code> or <code><span class="program">nim</span> <span class="option">cpp</span></code> command and set the <code>passC</code> and <code>passL</code> command line switches to something like:</p> 
<pre class="listing" data-language="nim">nim c ... --d:nimAllocPagesViaMalloc --mm:orc --passC="-I$DEVKITPRO/libnx/include" ...
--passL="-specs=$DEVKITPRO/libnx/switch.specs -L$DEVKITPRO/libnx/lib -lnx"</pre> <p>or setup a <code>nim.cfg</code> file like so:</p> <pre data-language="nim">#nim.cfg
--mm:orc
--d:nimAllocPagesViaMalloc
--define:nimInheritHandles
--passC="-I$DEVKITPRO/libnx/include"
--passL="-specs=$DEVKITPRO/libnx/switch.specs -L$DEVKITPRO/libnx/lib -lnx"</pre> <p>The devkitPro setup must be the same as the default with their new installer <a href="https://github.com/devkitPro/pacman/releases">here for Mac/Linux</a> or <a href="https://github.com/devkitPro/installer/releases">here for Windows</a>.</p> <p>For example, with the above-mentioned config:</p> 
<pre class="listing" data-language="nim">nim c --os:nintendoswitch switchhomebrew.nim</pre> <p>This will generate a file called <code>switchhomebrew.elf</code> which can then be turned into an nro file with the <code><span class="program">elf2nro</span></code> tool in the devkitPro release. Examples can be found at <a href="https://github.com/jyapayne/nim-libnx.git">the nim-libnx github repo</a>.</p> <p>There are a few things that don't work because the devkitPro libraries don't support them. They are:</p> <ol class="simple">
<li>Waiting for a subprocess to finish. A subprocess can be started, but right now it can't be waited on, which sort of makes subprocesses a bit hard to use</li> <li>Dynamic calls. Switch OS (Horizon) doesn't support dynamic libraries, so dlopen/dlclose are not available.</li> <li>mqueue. Sadly there are no mqueue headers.</li> <li>ucontext. No headers for these either. No coroutines for now :(</li> <li>nl_types. No headers for this.</li> <li>As mmap is not supported, the nimAllocPagesViaMalloc option has to be used.</li> </ol> <h2 id="gpu-compilation">GPU Compilation</h2>
<p>Compiling for GPU computation can be achieved with <code><span class="Operator">--</span><span class="Identifier">cc</span><span class="Punctuation">:</span><span class="Identifier">nvcc</span></code> for CUDA with nvcc, or with <code><span class="Operator">--</span><span class="Identifier">cc</span><span class="Punctuation">:</span><span class="Identifier">hipcc</span></code> for AMD GPUs with HIP. Both compilers require building for C++ with <code><span class="Identifier">nim</span> <span class="Identifier">cpp</span></code>.</p> <p>Here's a very simple CUDA kernel example using emit, which can be compiled with <code><span class="Identifier">nim</span> <span class="Identifier">cpp</span> <span class="Operator">--</span><span class="Identifier">cc</span><span class="Punctuation">:</span><span class="Identifier">nvcc</span> <span class="Operator">--</span><span class="Identifier">define</span><span class="Punctuation">:</span><span class="StringLit">"useMalloc"</span> <span class="Identifier">hello_kernel</span><span class="Operator">.</span><span class="Identifier">nim</span></code> assuming you have the CUDA toolkit installed.</p> 
<pre class="listing" data-language="nim">{.emit: """
__global__ void add(int a, int b) {
  int c;
  c = a + b;
}
""".}

proc main() =
  {.emit: """
  add&lt;&lt;&lt;1,1&gt;&gt;&gt;(2,7);
  """.}

main()</pre> <h2 id="dll-generation">DLL generation</h2>
<p><strong>Note</strong>: The same rules apply to <code><span class="Identifier">lib</span><span class="Operator">*.</span><span class="Identifier">so</span></code> shared object files on UNIX. For better readability only the DLL version is described here.</p> <p>Nim supports the generation of DLLs. However, there must be only one instance of the GC per process/address space. This instance is contained in <code>nimrtl.dll</code>. This means that every generated Nim DLL depends on <code>nimrtl.dll</code>. To generate the "nimrtl.dll" file, use the command:</p> 
<pre class="listing" data-language="nim">nim c -d:release lib/nimrtl.nim</pre> <p>To link against <code>nimrtl.dll</code> use the command:</p> 
<pre class="listing" data-language="nim">nim c -d:useNimRtl myprog.nim</pre> <h2 id="additional-compilation-switches">Additional compilation switches</h2>
<p>The standard library supports a growing number of <code><span class="Identifier">useX</span></code> conditional defines affecting how some features are implemented. This section tries to give a complete list.</p> <table>
<tr>
<th>Define</th>
<th>Effect</th>
</tr> <tr>
<td><code><span class="Identifier">release</span></code></td>
<td>Turns on the optimizer. More aggressive optimizations are possible, e.g.: <code>--passC:-ffast-math</code> (but see issue #10305)</td>
</tr> <tr>
<td><code><span class="Identifier">danger</span></code></td>
<td>Turns off all runtime checks and turns on the optimizer.</td>
</tr> <tr>
<td><code><span class="Identifier">useFork</span></code></td>
<td>Makes <code><span class="Identifier">osproc</span></code> use <code><span class="Identifier">fork</span></code> instead of <code><span class="Identifier">posix_spawn</span></code>.</td>
</tr> <tr>
<td><code><span class="Identifier">useNimRtl</span></code></td>
<td>Compile and link against <code>nimrtl.dll</code>.</td>
</tr> <tr>
<td><code><span class="Identifier">useMalloc</span></code></td>
<td>Makes Nim use C's <span id="malloc_1">malloc</span> instead of Nim's own memory manager, albeit prefixing each allocation with its size to support clearing memory on reallocation. This only works with <code>--mm:none</code>, <code>--mm:arc</code> and <code>--mm:orc</code>.</td>
</tr> <tr>
<td><code><span class="Identifier">useRealtimeGC</span></code></td>
<td>Enables support of Nim's GC for <em>soft</em> realtime systems. See the documentation of the <a href="refc.html">refc</a> for further information.</td>
</tr> <tr>
<td><code><span class="Identifier">logGC</span></code></td>
<td>Enable GC logging to stdout.</td>
</tr> <tr>
<td><code><span class="Identifier">nodejs</span></code></td>
<td>The JS target is actually <code>node.js</code>.</td>
</tr> <tr>
<td><code><span class="Identifier">ssl</span></code></td>
<td>Enables OpenSSL support for the sockets module.</td>
</tr> <tr>
<td><code><span class="Identifier">memProfiler</span></code></td>
<td>Enables memory profiling for the native GC.</td>
</tr> <tr>
<td><code><span class="Identifier">uClibc</span></code></td>
<td>Use uClibc instead of libc. (Relevant for Unix-like OSes)</td>
</tr> <tr>
<td><code><span class="Identifier">checkAbi</span></code></td>
<td>When using types from C headers, add checks that compare what's in the Nim file with what's in the C header. This may become enabled by default in the future.</td>
</tr> <tr>
<td><code><span class="Identifier">tempDir</span></code></td>
<td>This symbol takes a string as its value, like <code>--define:tempDir:/some/temp/path</code> to override the temporary directory returned by <code><span class="Identifier">os</span><span class="Operator">.</span><span class="Identifier">getTempDir</span><span class="Punctuation">(</span><span class="Punctuation">)</span></code>. The value <strong>should</strong> end with a directory separator character. (Relevant for the Android platform)</td>
</tr> <tr>
<td><code><span class="Identifier">useShPath</span></code></td>
<td>This symbol takes a string as its value, like <code>--define:useShPath:/opt/sh/bin/sh</code> to override the path for the <code><span class="program">sh</span></code> binary, in cases where it is not located in the default location <code>/bin/sh</code>.</td>
</tr> <tr>
<td><code><span class="Identifier">noSignalHandler</span></code></td>
<td>Disable the crash handler from <code>system.nim</code>.</td>
</tr> <tr>
<td><code><span class="Identifier">globalSymbols</span></code></td>
<td>Load all <code><span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">dynlib</span><span class="Operator">.</span><span class="Punctuation">}</span></code> libraries with the <code><span class="Identifier">RTLD_GLOBAL</span></code> flag on Posix systems to resolve symbols in subsequently loaded libraries.</td>
</tr> <tr>
<td><code><span class="Identifier">lto</span></code></td>
<td>Enable link-time optimization in the backend compiler and linker.</td>
</tr> <tr>
<td><code><span class="Identifier">lto_incremental</span></code></td>
<td>Enable link-time optimization and additionally enable incremental linking for compilers that support it. Currently only clang and vcc.</td>
</tr> <tr>
<td><code><span class="Identifier">strip</span></code></td>
<td>Strip debug symbols added by the backend compiler from the executable.</td>
</tr> </table> <h2 id="additional-features">Additional Features</h2>
<p>This section describes Nim's additional features that are not listed in the Nim manual. Some of the features here only make sense for the C code generator and are subject to change.</p> <h3 id="additional-features-linedir-option">LineDir option</h3>
<p>The <code>--lineDir</code> option can be turned on or off. If turned on the generated C code contains <code><span class="Preprocessor">#line</span></code> directives. This may be helpful for debugging with GDB.</p> <h3 id="additional-features-stacktrace-option">StackTrace option</h3>
<p>If the <code>--stackTrace</code> option is turned on, the generated C contains code to ensure that proper stack traces are given if the program crashes or some uncaught exception is raised.</p> <h3 id="additional-features-linetrace-option">LineTrace option</h3>
<p>The <code>--lineTrace</code> option implies the <code>stackTrace</code> option. If turned on, the generated C contains code to ensure that proper stack traces with line number information are given if the program crashes or an uncaught exception is raised.</p> <h2 id="dynliboverride">DynlibOverride</h2>
<p>By default Nim's <code><span class="Identifier">dynlib</span></code> pragma causes the compiler to generate <code><span class="Identifier">GetProcAddress</span></code> (or their Unix counterparts) calls to bind to a DLL. With the <code>dynlibOverride</code> command line switch this can be prevented and then via <code>--passL</code> the static library can be linked against. For instance, to link statically against Lua this command might work on Linux:</p> 
<pre class="listing" data-language="nim">nim c --dynlibOverride:lua --passL:liblua.lib program.nim</pre> <h2 id="backend-language-options">Backend language options</h2>
<p>The typical compiler usage involves using the <code>compile</code> or <code>c</code> command to transform a <code>.nim</code> file into one or more <code>.c</code> files which are then compiled with the platform's C compiler into a static binary. However, there are other commands to compile to C++, Objective-C, or JavaScript. More details can be read in the <a href="backends.html">Nim Backend Integration document</a>.</p> <h2 id="nim-documentation-tools">Nim documentation tools</h2>
<p>Nim provides the <span id="doc_1">doc</span> command to generate HTML documentation from <code>.nim</code> source files. Only exported symbols will appear in the output. For more details see <a href="https://nim-lang.org/docs/docgen.html">the docgen documentation</a>.</p> <h2 id="nim-idetools-integration">Nim idetools integration</h2>
<p>Nim provides language integration with external IDEs through the idetools command. See the documentation of <a href="idetools.html">idetools</a> for further information.</p> <h2 id="nim-for-embedded-systems">Nim for embedded systems</h2>
<p>While the default Nim configuration is targeted for optimal performance on modern PC hardware and operating systems with ample memory, it is very well possible to run Nim code and a good part of the Nim standard libraries on small embedded microprocessors with only a few kilobytes of memory.</p> <p>A good start is to use the <code><span class="Identifier">any</span></code> operating target together with the <code><span class="Identifier">malloc</span></code> memory allocator and the <code><span class="Identifier">arc</span></code> garbage collector. For example:</p> 
<pre class="listing" data-language="nim">nim c --os:any --mm:arc -d:useMalloc [...] x.nim</pre> <ul class="simple">
<li>
<code>--mm:arc</code> will enable the reference counting memory management instead of the default garbage collector. This enables Nim to use heap memory which is required for strings and seqs, for example.</li> <li>The <code>--os:any</code> target makes sure Nim does not depend on any specific operating system primitives. Your platform should support only some basic ANSI C library <code><span class="Identifier">stdlib</span></code> and <code><span class="Identifier">stdio</span></code> functions which should be available on almost any platform.</li> <li>The <code>-d:useMalloc</code> option configures Nim to use only the standard C memory manage primitives <code><span class="Identifier">malloc</span><span class="Punctuation">(</span><span class="Punctuation">)</span></code>, <code><span class="Identifier">free</span><span class="Punctuation">(</span><span class="Punctuation">)</span></code>, <code><span class="Identifier">realloc</span><span class="Punctuation">(</span><span class="Punctuation">)</span></code>.</li> </ul> <p>If your platform does not provide these functions it should be trivial to provide an implementation for them and link these to your program.</p> <p>For targets with very restricted memory, it might be beneficial to pass some additional flags to both the Nim compiler and the C compiler and/or linker to optimize the build for size. For example, the following flags can be used when targeting a gcc compiler:</p> <p><code>--opt:size -d:lto -d:strip</code></p> <p>The <code>--opt:size</code> flag instructs Nim to optimize code generation for small size (with the help of the C compiler), the <code>-d:lto</code> flags enable link-time optimization in the compiler and linker, the <code>-d:strip</code> strips debug symbols.</p> <p>Check the <a href="#crossminuscompilation">Cross-compilation</a> section for instructions on how to compile the program for your target.</p> <h3 id="nim-for-embedded-systems-nimallocpagesviamalloc">nimAllocPagesViaMalloc</h3>
<p>Nim's default allocator is based on TLSF, this algorithm was designed for embedded devices. This allocator gets blocks/pages of memory via a currently undocumented <code><span class="Identifier">osalloc</span></code> API which usually uses POSIX's <code><span class="Identifier">mmap</span></code> call. On many environments <code><span class="Identifier">mmap</span></code> is not available but C's <code><span class="Identifier">malloc</span></code> is. You can use the <code><span class="Identifier">nimAllocPagesViaMalloc</span></code> define to use <code><span class="Identifier">malloc</span></code> instead of <code><span class="Identifier">mmap</span></code>. <code><span class="Identifier">nimAllocPagesViaMalloc</span></code> is currently only supported with <code><span class="Operator">--</span><span class="Identifier">mm</span><span class="Punctuation">:</span><span class="Identifier">arc</span></code> or <code><span class="Operator">--</span><span class="Identifier">mm</span><span class="Punctuation">:</span><span class="Identifier">orc</span></code>. (Since version 1.6)</p> <h2 id="nimpage256-slash-nimpage512-slash-nimpage1k">nimPage256 / nimPage512 / nimPage1k</h2>
<p>Adjust the page size for Nim's GC allocator. This enables using <code><span class="Identifier">nimAllocPagesViaMalloc</span></code> on devices with less RAM. The default page size requires too much RAM to work.</p> <p>Recommended settings:</p> <ul class="simple">
<li>&lt; 32 kB of RAM use <code><span class="Identifier">nimPage256</span></code>
</li> <li>&lt; 512 kB of RAM use <code><span class="Identifier">nimPage512</span></code>
</li> <li>&lt; 2 MB of RAM use <code><span class="Identifier">nimPage1k</span></code>
</li> </ul> <p>Initial testing hasn't shown much difference between 512B or 1kB page sizes in terms of performance or latency. Using <code><span class="Identifier">nimPages256</span></code> will limit the total amount of allocatable RAM.</p> <h2 id="nimmemaligntiny">nimMemAlignTiny</h2>
<p>Sets <code><span class="Identifier">MemAlign</span></code> to <code><span class="DecNumber">4</span></code> bytes which reduces the memory alignment to better match some embedded devices.</p> <h2 id="thread-stack-size">Thread stack size</h2>
<p>Nim's thread API provides a simple wrapper around more advanced RTOS task features. Customizing the stack size and stack guard size can be done by setting <code><span class="Operator">-</span><span class="Identifier">d</span><span class="Punctuation">:</span><span class="Identifier">nimThreadStackSize</span><span class="Operator">=</span><span class="DecNumber">16384</span></code> or <code><span class="Operator">-</span><span class="Identifier">d</span><span class="Punctuation">:</span><span class="Identifier">nimThreadStackGuard</span><span class="Operator">=</span><span class="DecNumber">32</span></code>.</p> <p>Currently only Zephyr, NuttX and FreeRTOS support these configurations.</p> <h2 id="nim-for-realtime-systems">Nim for realtime systems</h2>
<p>See the <code><span class="Operator">--</span><span class="Identifier">mm</span><span class="Punctuation">:</span><span class="Identifier">arc</span></code> or <code><span class="Operator">--</span><span class="Identifier">mm</span><span class="Punctuation">:</span><span class="Identifier">orc</span></code> memory management settings in <a href="mm.html">MM</a> for further information.</p> <h2 id="signal-handling-in-nim">Signal handling in Nim</h2>
<p>The Nim programming language has no concept of Posix's signal handling mechanisms. However, the standard library offers some rudimentary support for signal handling, in particular, segmentation faults are turned into fatal errors that produce a stack trace. This can be disabled with the <code>-d:noSignalHandler</code> switch.</p> <h2 id="optimizing-for-nim">Optimizing for Nim</h2>
<p>Nim has no separate optimizer, but the C code that is produced is very efficient. Most C compilers have excellent optimizers, so usually it is not needed to optimize one's code. Nim has been designed to encourage efficient code: The most readable code in Nim is often the most efficient too.</p> <p>However, sometimes one has to optimize. Do it in the following order:</p> <ol class="simple">
<li>switch off the embedded debugger (it is <strong>slow</strong>!)</li> <li>turn on the optimizer and turn off runtime checks</li> <li>profile your code to find where the bottlenecks are</li> <li>try to find a better algorithm</li> <li>do low-level optimizations</li> </ol> <p>This section can only help you with the last item.</p> <h3 id="optimizing-for-nim-optimizing-string-handling">Optimizing string handling</h3>
<p>String assignments are sometimes expensive in Nim: They are required to copy the whole string. However, the compiler is often smart enough to not copy strings. Due to the argument passing semantics, strings are never copied when passed to subroutines. The compiler does not copy strings that are a result of a procedure call, because the callee returns a new string anyway. Thus it is efficient to do:</p> 
<pre class="listing" data-language="nim">var s = procA() # assignment will not copy the string; procA allocates a new
                # string already</pre> <p>However, it is not efficient to do:</p> 
<pre class="listing" data-language="nim">var s = varA    # assignment has to copy the whole string into a new buffer!</pre> <p>For <code><span class="Keyword">let</span></code> symbols a copy is not always necessary:</p> 
<pre class="listing" data-language="nim">let s = varA    # may only copy a pointer if it safe to do so</pre> <p>The compiler optimizes string case statements: A hashing scheme is used for them if several different string constants are used. So code like this is reasonably efficient:</p> 
<pre class="listing" data-language="nim">case normalize(k.key)
of "name": c.name = v
of "displayname": c.displayName = v
of "version": c.version = v
of "os": c.oses = split(v, {';'})
of "cpu": c.cpus = split(v, {';'})
of "authors": c.authors = split(v, {';'})
of "description": c.description = v
of "app":
  case normalize(v)
  of "console": c.app = appConsole
  of "gui": c.app = appGUI
  else: quit(errorStr(p, "expected: console or gui"))
of "license": c.license = UnixToNativePath(k.value)
else: quit(errorStr(p, "unknown variable: " &amp; k.key))</pre><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2006&ndash;2024 Andreas Rumpf<br>Licensed under the MIT License.<br>
    <a href="https://nim-lang.org/docs/nimc.html" class="_attribution-link">https://nim-lang.org/docs/nimc.html</a>
  </p>
</div>
