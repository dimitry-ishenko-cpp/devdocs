<h1 class="title">Nim Compiler User Guide</h1>  
<blockquote><p>"Look at you, hacker. A pathetic creature of meat and bone, panting and sweating as you run through my corridors. How can you challenge a perfect, immortal machine?"</p></blockquote> <h2 id="introduction">Introduction</h2>
<p>This document describes the usage of the <em>Nim compiler</em> on the different supported platforms. It is not a definition of the Nim programming language (which is covered in the <a href="manual.html">manual</a>).</p> <p>Nim is free software; it is licensed under the <a href="http://www.opensource.org/licenses/mit-license.php">MIT License</a>.</p> <h2 id="compiler-usage">Compiler Usage</h2> <h3 id="compiler-usage-commandminusline-switches">Command-line switches</h3>
<p>Basic command-line switches are:</p> <p>Usage:</p> <pre data-language="nim">nim command [options] [projectfile] [arguments]</pre> <dl>
<dt>Command:</dt> <dd>
<table frame="void">
<tr>
<th align="left">compile, c</th>
<td align="left">compile project with default code generator (C)</td> </tr> <tr>
<th align="left">r</th>
<td align="left">compile to $nimcache/projname, run with [arguments] using backend specified by <code>--backend</code> (default: c)</td> </tr> <tr>
<th align="left">doc</th>
<td align="left">generate the documentation for inputfile for backend specified by <code>--backend</code> (default: c)</td> </tr> </table>
<p>Arguments: arguments are passed to the program being run (if --run option is selected)</p> </dd> <dt>Options:</dt> <dd><table frame="void">
<tr>
<th align="left">-p, --path:PATH</th>
<td align="left">add path to search paths</td> </tr> <tr>
<th align="left">-d, --define:SYMBOL(:VAL)</th>
<td align="left">define a conditional symbol (Optionally: Define the value for that symbol, see: "compile time define pragmas")</td> </tr> <tr>
<th align="left">-u, --undef:SYMBOL</th>
<td align="left">undefine a conditional symbol</td> </tr> <tr>
<th align="left">-f, --forceBuild:on|off</th>
<td align="left">force rebuilding of all modules</td> </tr> <tr>
<th align="left">--stackTrace:on|off</th>
<td align="left">turn stack tracing on|off</td> </tr> <tr>
<th align="left">--lineTrace:on|off</th>
<td align="left">turn line tracing on|off</td> </tr> <tr>
<th align="left">--threads:on|off</th>
<td align="left">turn support for multi-threading on|off</td> </tr> <tr>
<th align="left">-x, --checks:on|off</th>
<td align="left">turn all runtime checks on|off</td> </tr> <tr>
<th align="left">-a, --assertions:on|off</th>
<td align="left">turn assertions on|off</td> </tr> <tr>
<th align="left">--opt:none|speed|size</th>
<td align="left">optimize not at all or for speed|size Note: use -d:release for a release build!</td> </tr> <tr>
<th align="left">--debugger:native</th>
<td align="left">Use native debugger (gdb)</td> </tr> <tr>
<th align="left">--app:console|gui|lib|staticlib</th>
<td align="left">generate a console app|GUI app|DLL|static library</td> </tr> <tr>
<th align="left">-r, --run</th>
<td align="left">run the compiled program with given arguments</td> </tr> <tr>
<th align="left">--fullhelp</th>
<td align="left">show all command line switches</td> </tr> <tr>
<th align="left">-h, --help</th>
<td align="left">show this help</td> </tr> <tr>
<th align="left">-v, --version</th>
<td align="left">show detailed version information</td> </tr> </table></dd> </dl> <p>Note, single letter options that take an argument require a colon. E.g. -p:PATH.</p> <hr> <p>Advanced command-line switches are:</p> <dl>
<dt>Advanced commands:</dt> <dd><table frame="void">
<tr>
<th align="left">compileToC, cc</th>
<td align="left">compile project with C code generator</td> </tr> <tr>
<th align="left">compileToCpp, cpp</th>
<td align="left">compile project to C++ code</td> </tr> <tr>
<th align="left">compileToOC, objc</th>
<td align="left">compile project to Objective C code</td> </tr> <tr>
<th align="left">js</th>
<td align="left">compile project to Javascript</td> </tr> <tr>
<th align="left">e</th>
<td align="left">run a Nimscript file</td> </tr> <tr>
<th align="left">rst2html</th>
<td align="left">convert a reStructuredText file to HTML use <code>--docCmd:skip</code> to skip compiling snippets</td> </tr> <tr>
<th align="left">rst2tex</th>
<td align="left">convert a reStructuredText file to TeX</td> </tr> <tr>
<th align="left">jsondoc</th>
<td align="left">extract the documentation to a json file</td> </tr> <tr>
<th align="left">ctags</th>
<td align="left">create a tags file</td> </tr> <tr>
<th align="left">buildIndex</th>
<td align="left">build an index for the whole documentation</td> </tr> <tr>
<th align="left">genDepend</th>
<td align="left">generate a DOT file containing the module dependency graph</td> </tr> <tr>
<th align="left">dump</th>
<td align="left">dump all defined conditionals and search paths see also: --dump.format:json (useful with: <code>| jq</code>)</td> </tr> <tr>
<th align="left">check</th>
<td align="left">checks the project for syntax and semantic</td> </tr> </table></dd> <dt>Runtime checks (see -x):</dt> <dd><table frame="void">
<tr>
<th align="left">--objChecks:on|off</th>
<td align="left">turn obj conversion checks on|off</td> </tr> <tr>
<th align="left">--fieldChecks:on|off</th>
<td align="left">turn case variant field checks on|off</td> </tr> <tr>
<th align="left">--rangeChecks:on|off</th>
<td align="left">turn range checks on|off</td> </tr> <tr>
<th align="left">--boundChecks:on|off</th>
<td align="left">turn bound checks on|off</td> </tr> <tr>
<th align="left">--overflowChecks:on|off</th>
<td align="left">turn int over-/underflow checks on|off</td> </tr> <tr>
<th align="left">--floatChecks:on|off</th>
<td align="left">turn all floating point (NaN/Inf) checks on|off</td> </tr> <tr>
<th align="left">--nanChecks:on|off</th>
<td align="left">turn NaN checks on|off</td> </tr> <tr>
<th align="left">--infChecks:on|off</th>
<td align="left">turn Inf checks on|off</td> </tr> <tr>
<th align="left">--refChecks:on|off</th>
<td align="left">turn ref checks on|off (only for --newruntime)</td> </tr> </table></dd> <dt>Advanced options:</dt> <dd><table frame="void">
<tr>
<th align="left">-o:FILE, --out:FILE</th>
<td align="left">set the output filename</td> </tr> <tr>
<th align="left">--outdir:DIR</th>
<td align="left">set the path where the output file will be written</td> </tr> <tr>
<th align="left">--usenimcache</th>
<td align="left">will use <code>outdir=$$nimcache</code>, whichever it resolves to after all options have been processed</td> </tr> <tr>
<th align="left">--stdout:on|off</th>
<td align="left">output to stdout</td> </tr> <tr>
<th align="left">--colors:on|off</th>
<td align="left">turn compiler messages coloring on|off</td> </tr> <tr>
<th align="left">--listFullPaths:on|off</th>
<td align="left">list full paths in messages</td> </tr> <tr>
<th align="left">-w:on|off|list, --warnings:on|off|list</th>
<td align="left">turn all warnings on|off or list all available</td> </tr> <tr>
<th align="left">--warning[X]:on|off</th>
<td align="left">turn specific warning X on|off</td> </tr> <tr>
<th align="left">--hints:on|off|list</th>
<td align="left">turn all hints on|off or list all available</td> </tr> <tr>
<th align="left">--hint[X]:on|off</th>
<td align="left">turn specific hint X on|off</td> </tr> <tr>
<th align="left">--warningAsError[X]:on|off</th>
<td align="left">turn specific warning X into an error on|off</td> </tr> <tr>
<th align="left">--styleCheck:off|hint|error</th>
<td align="left">produce hints or errors for Nim identifiers that do not adhere to Nim's official style guide <a href="nep1.html">https://nim-lang.org/docs/nep1.html</a>
</td> </tr> <tr>
<th align="left">--styleCheck:usages</th>
<td align="left">only enforce consistent spellings of identifiers, do not enforce the style on declarations</td> </tr> <tr>
<th align="left">--showAllMismatches:on|off</th>
<td align="left">show all mismatching candidates in overloading resolution</td> </tr> <tr>
<th align="left">--lib:PATH</th>
<td align="left">set the system library path</td> </tr> <tr>
<th align="left">--import:PATH</th>
<td align="left">add an automatically imported module</td> </tr> <tr>
<th align="left">--include:PATH</th>
<td align="left">add an automatically included module</td> </tr> <tr>
<th align="left">--nimcache:PATH</th>
<td align="left">set the path used for generated files see also <a href="nimc.html#compiler-usage-generated-c-code-directory">https://nim-lang.org/docs/nimc.html#compiler-usage-generated-c-code-directory</a>
</td> </tr> <tr>
<th align="left">-c, --compileOnly:on|off</th>
<td align="left">compile Nim files only; do not assemble or link</td> </tr> <tr>
<th align="left">--noLinking:on|off</th>
<td align="left">compile Nim and generated files but do not link</td> </tr> <tr>
<th align="left">--noMain:on|off</th>
<td align="left">do not generate a main procedure</td> </tr> <tr>
<th align="left">--genScript:on|off</th>
<td align="left">generate a compile script (in the 'nimcache' subdirectory named 'compile_$$project$$scriptext'), implies --compileOnly</td> </tr> <tr>
<th align="left">--genDeps:on|off</th>
<td align="left">generate a '.deps' file containing the dependencies</td> </tr> <tr>
<th align="left">--os:SYMBOL</th>
<td align="left">set the target operating system (cross-compilation)</td> </tr> <tr>
<th align="left">--cpu:SYMBOL</th>
<td align="left">set the target processor (cross-compilation)</td> </tr> <tr>
<th align="left">--debuginfo:on|off</th>
<td align="left">enables debug information</td> </tr> <tr>
<th align="left">-t, --passC:OPTION</th>
<td align="left">pass an option to the C compiler</td> </tr> <tr>
<th align="left">-l, --passL:OPTION</th>
<td align="left">pass an option to the linker</td> </tr> <tr>
<th align="left">--cc:SYMBOL</th>
<td align="left">specify the C compiler</td> </tr> <tr>
<th align="left">--cincludes:DIR</th>
<td align="left">modify the C compiler header search path</td> </tr> <tr>
<th align="left">--clibdir:DIR</th>
<td align="left">modify the linker library search path</td> </tr> <tr>
<th align="left">--clib:LIBNAME</th>
<td align="left">link an additional C library (you should omit platform-specific extensions)</td> </tr> <tr>
<th align="left">--project</th>
<td align="left">document the whole project (doc)</td> </tr> <tr>
<th align="left">--docRoot:path</th>
<td align="left">
<code>nim doc --docRoot:/foo --project --outdir:docs /foo/sub/main.nim</code> generates: docs/sub/main.html if path == @pkg, will use nimble file enclosing dir if path == @path, will use first matching dir in <code>--path</code> if path == @default (the default and most useful), will use best match among @pkg,@path. if these are nonexistent, will use project path</td> </tr> <tr>
<th align="left">-b, --backend:c|cpp|js|objc sets backend to use with commands like `nim doc` or `nim r`</th>
<td align="left"></td> </tr> <tr>
<th align="left">--docCmd:cmd</th>
<td align="left">if <code>cmd == skip</code>, skips runnableExamples else, runs runnableExamples with given options, e.g.: <code>--docCmd:"-d:foo --threads:on"</code>
</td> </tr> <tr>
<th align="left">--docSeeSrcUrl:url</th>
<td align="left">activate 'see source' for doc command (see doc.item.seesrc in config/nimdoc.cfg)</td> </tr> <tr>
<th align="left">--docInternal</th>
<td align="left">also generate documentation for non-exported symbols</td> </tr> <tr>
<th align="left">--lineDir:on|off</th>
<td align="left">generation of #line directive on|off</td> </tr> <tr>
<th align="left">--embedsrc:on|off</th>
<td align="left">embeds the original source code as comments in the generated output</td> </tr> <tr>
<th align="left">--threadanalysis:on|off</th>
<td align="left">turn thread analysis on|off</td> </tr> <tr>
<th align="left">--tlsEmulation:on|off</th>
<td align="left">turn thread local storage emulation on|off</td> </tr> <tr>
<th align="left">--taintMode:on|off</th>
<td align="left">turn taint mode on|off</td> </tr> <tr>
<th align="left">--implicitStatic:on|off</th>
<td align="left">turn implicit compile time evaluation on|off</td> </tr> <tr>
<th align="left">--trmacros:on|off</th>
<td align="left">turn term rewriting macros on|off</td> </tr> <tr>
<th align="left">--multimethods:on|off</th>
<td align="left">turn multi-methods on|off</td> </tr> <tr>
<th align="left">--memTracker:on|off</th>
<td align="left">turn memory tracker on|off</td> </tr> <tr>
<th align="left">--hotCodeReloading:on|off</th>
<td align="left">turn support for hot code reloading on|off</td> </tr> <tr>
<th align="left">--excessiveStackTrace:on|off</th>
<td align="left">stack traces use full file paths</td> </tr> <tr>
<th align="left">--stackTraceMsgs:on|off</th>
<td align="left">enable user defined stack frame msgs via <code>setFrameMsg</code>
</td> </tr> <tr>
<th align="left">--nilseqs:on|off</th>
<td align="left">allow 'nil' for strings/seqs for backwards compatibility</td> </tr> <tr>
<th align="left">--seqsv2:on|off</th>
<td align="left">use the new string/seq implementation based on destructors</td> </tr> <tr>
<th align="left">--skipCfg:on|off</th>
<td align="left">do not read the nim installation's configuration file</td> </tr> <tr>
<th align="left">--skipUserCfg:on|off</th>
<td align="left">do not read the user's configuration file</td> </tr> <tr>
<th align="left">--skipParentCfg:on|off</th>
<td align="left">do not read the parent dirs' configuration files</td> </tr> <tr>
<th align="left">--skipProjCfg:on|off</th>
<td align="left">do not read the project's configuration file</td> </tr> <tr>
<th align="left">--gc:refc|arc|orc|markAndSweep|boehm|go|none|regions</th>
<td align="left">select the GC to use; default is 'refc'</td> </tr> <tr>
<th align="left">--exceptions:setjmp|cpp|goto</th>
<td align="left">select the exception handling implementation</td> </tr> <tr>
<th align="left">--index:on|off</th>
<td align="left">turn index file generation on|off</td> </tr> <tr>
<th align="left">--putenv:key=value</th>
<td align="left">set an environment variable</td> </tr> <tr>
<th align="left">--NimblePath:PATH</th>
<td align="left">add a path for Nimble support</td> </tr> <tr>
<th align="left">--noNimblePath</th>
<td align="left">deactivate the Nimble path</td> </tr> <tr>
<th align="left">--clearNimblePath</th>
<td align="left">empty the list of Nimble package search paths</td> </tr> <tr>
<th align="left">--cppCompileToNamespace:namespace</th>
<td align="left">use the provided namespace for the generated C++ code, if no namespace is provided "Nim" will be used</td> </tr> <tr>
<th align="left">--expandMacro:MACRO</th>
<td align="left">dump every generated AST from MACRO</td> </tr> <tr>
<th align="left">--expandArc:PROCNAME</th>
<td align="left">show how PROCNAME looks like after diverse optimizations before the final backend phase (mostly ARC/ORC specific)</td> </tr> <tr>
<th align="left">--excludePath:PATH</th>
<td align="left">exclude a path from the list of search paths</td> </tr> <tr>
<th align="left">--dynlibOverride:SYMBOL</th>
<td align="left">marks SYMBOL so that dynlib:SYMBOL has no effect and can be statically linked instead; symbol matching is fuzzy so that --dynlibOverride:lua matches dynlib: "liblua.so.3"</td> </tr> <tr>
<th align="left">--dynlibOverrideAll</th>
<td align="left">disables the effects of the dynlib pragma</td> </tr> <tr>
<th align="left">--listCmd</th>
<td align="left">list the compilation commands; can be combined with <code>--hint:exec:on</code> and <code>--hint:link:on</code>
</td> </tr> <tr>
<th align="left">--asm</th>
<td align="left">produce assembler code</td> </tr> <tr>
<th align="left">--parallelBuild:0|1|...</th>
<td align="left">perform a parallel build value = number of processors (0 for auto-detect)</td> </tr> <tr>
<th align="left">--incremental:on|off</th>
<td align="left">only recompile the changed modules (experimental!)</td> </tr> <tr>
<th align="left">--verbosity:0|1|2|3</th>
<td align="left">set Nim's verbosity level (1 is default)</td> </tr> <tr>
<th align="left">--errorMax:N</th>
<td align="left">stop compilation after N errors; 0 means unlimited</td> </tr> <tr>
<th align="left">--maxLoopIterationsVM:N</th>
<td align="left">set max iterations for all VM loops</td> </tr> <tr>
<th align="left">--experimental:$1</th>
<td align="left">enable experimental language feature</td> </tr> <tr>
<th align="left">--legacy:$2</th>
<td align="left">enable obsolete/legacy language feature</td> </tr> <tr>
<th align="left">--useVersion:1.0</th>
<td align="left">emulate Nim version X of the Nim compiler</td> </tr> <tr>
<th align="left">--profiler:on|off</th>
<td align="left">enable profiling; requires <code>import nimprof</code>, and works better with <code>--stackTrace:on</code> see also <a href="https://nim-lang.github.io/Nim/estp.html">https://nim-lang.github.io/Nim/estp.html</a>
</td> </tr> <tr>
<th align="left">--benchmarkVM:on|off</th>
<td align="left">enable benchmarking of VM code with cpuTime()</td> </tr> <tr>
<th align="left">--profileVM:on|off</th>
<td align="left">enable compile time VM profiler</td> </tr> <tr>
<th align="left">--sinkInference:on|off</th>
<td align="left">en-/disable sink parameter inference (default: on)</td> </tr> <tr>
<th align="left">--panics:on|off</th>
<td align="left">turn panics into process terminations (default: off)</td> </tr> <tr>
<th align="left">--deepcopy:on|off</th>
<td align="left">enable 'system.deepCopy' for <code>--gc:arc|orc</code>
</td> </tr> </table></dd> </dl> <h3 id="compiler-usage-list-of-warnings">List of warnings</h3>
<p>Each warning can be activated individually with <code>--warning[NAME]:on|off</code> or in a <code>push</code> pragma.</p> <table>
<tr>
<th>Name</th>
<th>Description</th>
</tr> <tr>
<td>CannotOpenFile</td>
<td>Some file not essential for the compiler's working could not be opened.</td>
</tr> <tr>
<td>OctalEscape</td>
<td>The code contains an unsupported octal sequence.</td>
</tr> <tr>
<td>Deprecated</td>
<td>The code uses a deprecated symbol.</td>
</tr> <tr>
<td>ConfigDeprecated</td>
<td>The project makes use of a deprecated config file.</td>
</tr> <tr>
<td>SmallLshouldNotBeUsed</td>
<td>The letter 'l' should not be used as an identifier.</td>
</tr> <tr>
<td>EachIdentIsTuple</td>
<td>The code contains a confusing <code>var</code> declaration.</td>
</tr> <tr>
<td>User</td>
<td>Some user-defined warning.</td>
</tr> </table> <h3 id="compiler-usage-list-of-hints">List of hints</h3>
<p>Each hint can be activated individually with <code>--hint[NAME]:on|off</code> or in a <code>push</code> pragma.</p> <table>
<tr>
<th>Name</th>
<th>Description</th>
</tr> <tr>
<td>CC</td>
<td>Shows when the C compiler is called.</td>
</tr> <tr>
<td>CodeBegin</td>
<td></td>
</tr> <tr>
<td>CodeEnd</td>
<td></td>
</tr> <tr>
<td>CondTrue</td>
<td></td>
</tr> <tr>
<td>Conf</td>
<td>A config file was loaded.</td>
</tr> <tr>
<td>ConvToBaseNotNeeded</td>
<td></td>
</tr> <tr>
<td>ConvFromXtoItselfNotNeeded</td>
<td></td>
</tr> <tr>
<td>Dependency</td>
<td></td>
</tr> <tr>
<td>Exec</td>
<td>Program is executed.</td>
</tr> <tr>
<td>ExprAlwaysX</td>
<td></td>
</tr> <tr>
<td>ExtendedContext</td>
<td></td>
</tr> <tr>
<td>GCStats</td>
<td>Dumps statistics about the Garbage Collector.</td>
</tr> <tr>
<td>GlobalVar</td>
<td>Shows global variables declarations.</td>
</tr> <tr>
<td>LineTooLong</td>
<td>Line exceeds the maximum length.</td>
</tr> <tr>
<td>Link</td>
<td>Linking phase.</td>
</tr> <tr>
<td>Name</td>
<td></td>
</tr> <tr>
<td>Path</td>
<td>Search paths modifications.</td>
</tr> <tr>
<td>Pattern</td>
<td></td>
</tr> <tr>
<td>Performance</td>
<td></td>
</tr> <tr>
<td>Processing</td>
<td>Artifact being compiled.</td>
</tr> <tr>
<td>QuitCalled</td>
<td></td>
</tr> <tr>
<td>Source</td>
<td>The source line that triggered a diagnostic message.</td>
</tr> <tr>
<td>StackTrace</td>
<td></td>
</tr> <tr>
<td>Success, SuccessX</td>
<td>Successful compilation of a library or a binary.</td>
</tr> <tr>
<td>User</td>
<td></td>
</tr> <tr>
<td>UserRaw</td>
<td></td>
</tr> <tr>
<td>XDeclaredButNotUsed</td>
<td>Unused symbols in the code.</td>
</tr> </table> <h3 id="compiler-usage-verbosity-levels">Verbosity levels</h3>
<table>
<tr>
<th>Level</th>
<th>Description</th>
</tr> <tr>
<td>0</td>
<td>Minimal output level for the compiler.</td>
</tr> <tr>
<td>1</td>
<td>Displays compilation of all the compiled files, including those imported by other modules or through the <a href="manual.html#implementation-specific-pragmas-compile-pragma">compile pragma</a>. This is the default level.</td>
</tr> <tr>
<td>2</td>
<td>Displays compilation statistics, enumerates the dynamic libraries that will be loaded by the final binary, and dumps to standard output the result of applying <a href="filters.html">a filter to the source code</a> if any filter was used during compilation.</td>
</tr> <tr>
<td>3</td>
<td>In addition to the previous levels dumps a debug stack trace for compiler developers.</td>
</tr> </table> <h3 id="compiler-usage-compileminustime-symbols">Compile-time symbols</h3>
<p>Through the <code>-d:x</code> or <code>--define:x</code> switch you can define compile-time symbols for conditional compilation. The defined switches can be checked in source code with the <a href="manual.html#statements-and-expressions-when-statement">when statement</a> and <a href="system.html#defined,untyped">defined proc</a>. The typical use of this switch is to enable builds in release mode (<code>-d:release</code>) where optimizations are enabled for better performance. Another common use is the <code>-d:ssl</code> switch to activate SSL sockets.</p> <p>Additionally, you may pass a value along with the symbol: <code>-d:x=y</code> which may be used in conjunction with the <a href="manual.html#implementation-specific-pragmas-compileminustime-define-pragmas">compile-time define pragmas</a> to override symbols during build time.</p> <p>Compile-time symbols are completely <strong>case insensitive</strong> and underscores are ignored too. <code>--define:FOO</code> and <code>--define:foo</code> are identical.</p> <p>Compile-time symbols starting with the <code>nim</code> prefix are reserved for the implementation and should not be used elsewhere.</p> <h3 id="compiler-usage-configuration-files">Configuration files</h3>
<p><strong>Note:</strong> The <em>project file name</em> is the name of the <code>.nim</code> file that is passed as a command-line argument to the compiler.</p> <p>The <code>nim</code> executable processes configuration files in the following directories (in this order; later files overwrite previous settings):</p> <ol class="simple">
<li>
<code>$nim/config/nim.cfg</code>, <code>/etc/nim/nim.cfg</code> (UNIX) or <code>&lt;Nim's installation directory&gt;\config\nim.cfg</code> (Windows). This file can be skipped with the <code>--skipCfg</code> command line option.</li> <li>If environment variable <code>XDG_CONFIG_HOME</code> is defined, <code>$XDG_CONFIG_HOME/nim/nim.cfg</code> or <code>~/.config/nim/nim.cfg</code> (POSIX) or <code>%APPDATA%/nim/nim.cfg</code> (Windows). This file can be skipped with the <code>--skipUserCfg</code> command line option.</li> <li>
<code>$parentDir/nim.cfg</code> where <code>$parentDir</code> stands for any parent directory of the project file's path. These files can be skipped with the <code>--skipParentCfg</code> command-line option.</li> <li>
<code>$projectDir/nim.cfg</code> where <code>$projectDir</code> stands for the project file's path. This file can be skipped with the <code>--skipProjCfg</code> command-line option.</li> <li>A project can also have a project-specific configuration file named <code>$project.nim.cfg</code> that resides in the same directory as <code>$project.nim</code>. This file can be skipped with the <code>--skipProjCfg</code> command-line option.</li> </ol> <p>Command-line settings have priority over configuration file settings.</p> <p>The default build of a project is a <span id="debug-build_1">debug build</span>. To compile a <span id="release-build_1">release build</span> define the <code>release</code> symbol:</p>
<pre data-language="nim">nim c -d:release myproject.nim</pre> <blockquote>
<p>To compile a <span id="dangerous-release-build_1">dangerous release build</span> define the <code>danger</code> symbol:</p>
<pre data-language="nim">nim c -d:danger myproject.nim</pre> </blockquote> <h3 id="compiler-usage-search-path-handling">Search path handling</h3>
<p>Nim has the concept of a global search path (PATH) that is queried to determine where to find imported modules or include files. If multiple files are found an ambiguity error is produced.</p> <p><code>nim dump</code> shows the contents of the PATH.</p> <p>However before the PATH is used the current directory is checked for the file's existence. So if PATH contains <code>$lib</code> and <code>$lib/bar</code> and the directory structure looks like this:</p>
<pre data-language="nim">$lib/x.nim
$lib/bar/x.nim
foo/x.nim
foo/main.nim
other.nim</pre> <p>And <code>main</code> imports <code>x</code>, <code>foo/x</code> is imported. If <code>other</code> imports <code>x</code> then both <code>$lib/x.nim</code> and <code>$lib/bar/x.nim</code> match but <code>$lib/x.nim</code> is used as it is the first match.</p> <h3 id="compiler-usage-generated-c-code-directory">Generated C code directory</h3>
<p>The generated files that Nim produces all go into a subdirectory called <code>nimcache</code>. Its full path is</p> <ul class="simple">
<li>
<code>$XDG_CACHE_HOME/nim/$projectname(_r|_d)</code> or <code>~/.cache/nim/$projectname(_r|_d)</code> on Posix</li> <li>
<code>$HOME/nimcache/$projectname(_r|_d)</code> on Windows.</li> </ul> <p>The <code>_r</code> suffix is used for release builds, <code>_d</code> is for debug builds.</p> <p>This makes it easy to delete all generated files.</p> <p>The <code>--nimcache</code> <a href="#compiler-usage-commandminusline-switches">compiler switch</a> can be used to to change the <code>nimcache</code> directory.</p> <p>However, the generated C code is not platform-independent. C code generated for Linux does not compile on Windows, for instance. The comment on top of the C file lists the OS, CPU, and CC the file has been compiled for.</p> <h2 id="compiler-selection">Compiler Selection</h2>
<p>To change the compiler from the default compiler (at the command line):</p>
<pre data-language="nim">nim c --cc:llvm_gcc --compile_only myfile.nim</pre> <p>This uses the configuration defined in <code>config\nim.cfg</code> for <code>lvm_gcc</code>.</p> <p>If nimcache already contains compiled code from a different compiler for the same project, add the <code>-f</code> flag to force all files to be recompiled.</p> <p>The default compiler is defined at the top of <code>config\nim.cfg</code>. Changing this setting affects the compiler used by <code>koch</code> to (re)build Nim.</p> <p>To use the <code>CC</code> environment variable, use <code>nim c --cc:env myfile.nim</code>. To use the <code>CXX</code> environment variable, use <code>nim cpp --cc:env myfile.nim</code>. <code>--cc:env</code> is available since Nim version 1.4.</p> <h2 id="crossminuscompilation">Cross-compilation</h2>
<p>To cross compile, use for example:</p>
<pre data-language="nim">nim c --cpu:i386 --os:linux --compileOnly --genScript myproject.nim</pre> <p>Then move the C code and the compile script <code>compile_myproject.sh</code> to your Linux i386 machine and run the script.</p> <p>Another way is to make Nim invoke a cross compiler toolchain:</p>
<pre data-language="nim">nim c --cpu:arm --os:linux myproject.nim</pre> <p>For cross compilation, the compiler invokes a C compiler named like <code>$cpu.$os.$cc</code> (for example arm.linux.gcc) and the configuration system is used to provide meaningful defaults. For example for <code>ARM</code> your configuration file should contain something like:</p>
<pre data-language="nim">arm.linux.gcc.path = "/usr/bin"
arm.linux.gcc.exe = "arm-linux-gcc"
arm.linux.gcc.linkerexe = "arm-linux-gcc"</pre> <h2 id="crossminuscompilation-for-windows">Cross-compilation for Windows</h2>
<p>To cross-compile for Windows from Linux or macOS using the MinGW-w64 toolchain:</p>
<pre data-language="nim">nim c -d:mingw myproject.nim</pre> <p>Use <code>--cpu:i386</code> or <code>--cpu:amd64</code> to switch the CPU architecture.</p> <p>The MinGW-w64 toolchain can be installed as follows:</p>
<pre data-language="nim">Ubuntu: apt install mingw-w64
CentOS: yum install mingw32-gcc | mingw64-gcc - requires EPEL
OSX: brew install mingw-w64</pre> <h2 id="crossminuscompilation-for-android">Cross-compilation for Android</h2>
<p>There are two ways to compile for Android: terminal programs (Termux) and with the NDK (Android Native Development Kit).</p> <p>The first one is to treat Android as a simple Linux and use <a href="https://wiki.termux.com">Termux</a> to connect and run the Nim compiler directly on android as if it was Linux. These programs are console-only programs that can't be distributed in the Play Store.</p> <p>Use regular <code>nim c</code> inside termux to make Android terminal programs.</p> <p>Normal Android apps are written in Java, to use Nim inside an Android app you need a small Java stub that calls out to a native library written in Nim using the <a href="https://developer.android.com/ndk">NDK</a>. You can also use <a href="https://developer.android.com/ndk/samples/sample_na">native-activity</a> to have the Java stub be auto-generated for you.</p> <p>Use <code>nim c -c --cpu:arm --os:android -d:androidNDK --noMain:on</code> to generate the C source files you need to include in your Android Studio project. Add the generated C files to CMake build script in your Android project. Then do the final compile with Android Studio which uses Gradle to call CMake to compile the project.</p> <p>Because Nim is part of a library it can't have its own c style <code>main()</code> so you would need to define your own <code>android_main</code> and init the Java environment, or use a library like SDL2 or GLFM to do it. After the Android stuff is done, it's very important to call <code>NimMain()</code> in order to initialize Nim's garbage collector and to run the top level statements of your program.</p> <pre class="listing" data-language="nim">proc NimMain() {.importc.}
proc glfmMain*(display: ptr GLFMDisplay) {.exportc.} =
  NimMain() # initialize garbage collector memory, types and stack</pre> <h2 id="crossminuscompilation-for-ios">Cross-compilation for iOS</h2>
<p>To cross-compile for iOS you need to be on a macOS computer and use XCode. Normal languages for iOS development are Swift and Objective C. Both of these use LLVM and can be compiled into object files linked together with C, C++ or Objective C code produced by Nim.</p> <p>Use <code>nim c -c --os:ios --noMain:on</code> to generate C files and include them in your XCode project. Then you can use XCode to compile, link, package and sign everything.</p> <p>Because Nim is part of a library it can't have its own c style <code>main()</code> so you would need to define <code>main</code> that calls <code>autoreleasepool</code> and <code>UIApplicationMain</code> to do it, or use a library like SDL2 or GLFM. After the iOS setup is done, it's very important to call <code>NimMain()</code> to initialize Nim's garbage collector and to run the top-level statements of your program.</p> <pre class="listing" data-language="nim">proc NimMain() {.importc.}
proc glfmMain*(display: ptr GLFMDisplay) {.exportc.} =
  NimMain() # initialize garbage collector memory, types and stack</pre>
<p>Note: XCode's "make clean" gets confused about the generated nim.c files, so you need to clean those files manually to do a clean build.</p> <h2 id="crossminuscompilation-for-nintendo-switch">Cross-compilation for Nintendo Switch</h2>
<p>Simply add --os:nintendoswitch to your usual <code>nim c</code> or <code>nim cpp</code> command and set the <code>passC</code> and <code>passL</code> command line switches to something like:</p> <pre class="listing" data-language="nim">nim c ... --passC="-I$DEVKITPRO/libnx/include" ...
--passL="-specs=$DEVKITPRO/libnx/switch.specs -L$DEVKITPRO/libnx/lib -lnx"</pre>
<p>or setup a nim.cfg file like so:</p> <pre class="listing" data-language="nim">#nim.cfg
--passC="-I$DEVKITPRO/libnx/include"
--passL="-specs=$DEVKITPRO/libnx/switch.specs -L$DEVKITPRO/libnx/lib -lnx"</pre>
<p>The DevkitPro setup must be the same as the default with their new installer <a href="https://github.com/devkitPro/pacman/releases">here for Mac/Linux</a> or <a href="https://github.com/devkitPro/installer/releases">here for Windows</a>.</p> <p>For example, with the above-mentioned config:</p>
<pre data-language="nim">nim c --os:nintendoswitch switchhomebrew.nim</pre> <p>This will generate a file called <code>switchhomebrew.elf</code> which can then be turned into an nro file with the <code>elf2nro</code> tool in the DevkitPro release. Examples can be found at <a href="https://github.com/jyapayne/nim-libnx.git">the nim-libnx github repo</a>.</p> <p>There are a few things that don't work because the DevkitPro libraries don't support them. They are:</p> <ol class="simple">
<li>Waiting for a subprocess to finish. A subprocess can be started, but right now it can't be waited on, which sort of makes subprocesses a bit hard to use</li> <li>Dynamic calls. DevkitPro libraries have no dlopen/dlclose functions.</li> <li>Command line parameters. It doesn't make sense to have these for a console anyways, so no big deal here.</li> <li>mqueue. Sadly there are no mqueue headers.</li> <li>ucontext. No headers for these either. No coroutines for now :(</li> <li>nl_types. No headers for this.</li> </ol> <h2 id="dll-generation">DLL generation</h2>
<p>Nim supports the generation of DLLs. However, there must be only one instance of the GC per process/address space. This instance is contained in <code>nimrtl.dll</code>. This means that every generated Nim DLL depends on <code>nimrtl.dll</code>. To generate the "nimrtl.dll" file, use the command:</p>
<pre data-language="nim">nim c -d:release lib/nimrtl.nim</pre> <p>To link against <code>nimrtl.dll</code> use the command:</p>
<pre data-language="nim">nim c -d:useNimRtl myprog.nim</pre> <p><strong>Note</strong>: Currently the creation of <code>nimrtl.dll</code> with thread support has never been tested and is unlikely to work!</p> <h2 id="additional-compilation-switches">Additional compilation switches</h2>
<p>The standard library supports a growing number of <code>useX</code> conditional defines affecting how some features are implemented. This section tries to give a complete list.</p> <table>
<tr>
<th>Define</th>
<th>Effect</th>
</tr> <tr>
<td><code>release</code></td>
<td>Turns on the optimizer. More aggressive optimizations are possible, e.g.: <code>--passC:-ffast-math</code> (but see issue #10305)</td>
</tr> <tr>
<td><code>danger</code></td>
<td>Turns off all runtime checks and turns on the optimizer.</td>
</tr> <tr>
<td><code>useFork</code></td>
<td>Makes <code>osproc</code> use <code>fork</code> instead of <code>posix_spawn</code>.</td>
</tr> <tr>
<td><code>useNimRtl</code></td>
<td>Compile and link against <code>nimrtl.dll</code>.</td>
</tr> <tr>
<td><code>useMalloc</code></td>
<td>Makes Nim use C's <span id="malloc_1">malloc</span> instead of Nim's own memory manager, albeit prefixing each allocation with its size to support clearing memory on reallocation. This only works with <code>gc:none</code> and with <code>--newruntime</code>.</td>
</tr> <tr>
<td><code>useRealtimeGC</code></td>
<td>Enables support of Nim's GC for <em>soft</em> realtime systems. See the documentation of the <a href="gc.html">gc</a> for further information.</td>
</tr> <tr>
<td><code>logGC</code></td>
<td>Enable GC logging to stdout.</td>
</tr> <tr>
<td><code>nodejs</code></td>
<td>The JS target is actually <code>node.js</code>.</td>
</tr> <tr>
<td><code>ssl</code></td>
<td>Enables OpenSSL support for the sockets module.</td>
</tr> <tr>
<td><code>memProfiler</code></td>
<td>Enables memory profiling for the native GC.</td>
</tr> <tr>
<td><code>uClibc</code></td>
<td>Use uClibc instead of libc. (Relevant for Unix-like OSes)</td>
</tr> <tr>
<td><code>checkAbi</code></td>
<td>When using types from C headers, add checks that compare what's in the Nim file with what's in the C header. This may become enabled by default in the future.</td>
</tr> <tr>
<td><code>tempDir</code></td>
<td>This symbol takes a string as its value, like <code>--define:tempDir:/some/temp/path</code> to override the temporary directory returned by <code>os.getTempDir()</code>. The value <strong>should</strong> end with a directory separator character. (Relevant for the Android platform)</td>
</tr> <tr>
<td><code>useShPath</code></td>
<td>This symbol takes a string as its value, like <code>--define:useShPath:/opt/sh/bin/sh</code> to override the path for the <code>sh</code> binary, in cases where it is not located in the default location <code>/bin/sh</code>.</td>
</tr> <tr>
<td><code>noSignalHandler</code></td>
<td>Disable the crash handler from <code>system.nim</code>.</td>
</tr> <tr>
<td><code>globalSymbols</code></td>
<td>Load all <code>{.dynlib.}</code> libraries with the <code>RTLD_GLOBAL</code> flag on Posix systems to resolve symbols in subsequently loaded libraries.</td>
</tr> </table> <h2 id="additional-features">Additional Features</h2>
<p>This section describes Nim's additional features that are not listed in the Nim manual. Some of the features here only make sense for the C code generator and are subject to change.</p> <h3 id="additional-features-linedir-option">LineDir option</h3>
<p>The <code>lineDir</code> option can be turned on or off. If turned on the generated C code contains <code>#line</code> directives. This may be helpful for debugging with GDB.</p> <h3 id="additional-features-stacktrace-option">StackTrace option</h3>
<p>If the <code>stackTrace</code> option is turned on, the generated C contains code to ensure that proper stack traces are given if the program crashes or some uncaught exception is raised.</p> <h3 id="additional-features-linetrace-option">LineTrace option</h3>
<p>The <code>lineTrace</code> option implies the <code>stackTrace</code> option. If turned on, the generated C contains code to ensure that proper stack traces with line number information are given if the program crashes or an uncaught exception is raised.</p> <h2 id="dynliboverride">DynlibOverride</h2>
<p>By default Nim's <code>dynlib</code> pragma causes the compiler to generate <code>GetProcAddress</code> (or their Unix counterparts) calls to bind to a DLL. With the <code>dynlibOverride</code> command line switch this can be prevented and then via <code>--passL</code> the static library can be linked against. For instance, to link statically against Lua this command might work on Linux:</p>
<pre data-language="nim">nim c --dynlibOverride:lua --passL:liblua.lib program.nim</pre> <h2 id="backend-language-options">Backend language options</h2>
<p>The typical compiler usage involves using the <code>compile</code> or <code>c</code> command to transform a <code>.nim</code> file into one or more <code>.c</code> files which are then compiled with the platform's C compiler into a static binary. However, there are other commands to compile to C++, Objective-C, or JavaScript. More details can be read in the <a href="backends.html">Nim Backend Integration document</a>.</p> <h2 id="nim-documentation-tools">Nim documentation tools</h2>
<p>Nim provides the <span id="doc_1">doc</span> command to generate HTML documentation from <code>.nim</code> source files. Only exported symbols will appear in the output. For more details <a href="https://nim-lang.org/docs/docgen.html">see the docgen documentation</a>.</p> <h2 id="nim-idetools-integration">Nim idetools integration</h2>
<p>Nim provides language integration with external IDEs through the idetools command. See the documentation of <a href="idetools.html">idetools</a> for further information.</p> <h2 id="nim-for-embedded-systems">Nim for embedded systems</h2>
<p>While the default Nim configuration is targeted for optimal performance on modern PC hardware and operating systems with ample memory, it is very well possible to run Nim code and a good part of the Nim standard libraries on small embedded microprocessors with only a few kilobytes of memory.</p> <p>A good start is to use the <code>any</code> operating target together with the <code>malloc</code> memory allocator and the <code>arc</code> garbage collector. For example:</p> <p><code>nim c --os:any --gc:arc -d:useMalloc [...] x.nim</code></p> <ul class="simple">
<li>
<code>--gc:arc</code> will enable the reference counting memory management instead of the default garbage collector. This enables Nim to use heap memory which is required for strings and seqs, for example.</li> <li>The <code>--os:any</code> target makes sure Nim does not depend on any specific operating system primitives. Your platform should support only some basic ANSI C library <code>stdlib</code> and <code>stdio</code> functions which should be available on almost any platform.</li> <li>The <code>-d:useMalloc</code> option configures Nim to use only the standard C memory manage primitives <code>malloc()</code>, <code>free()</code>, <code>realloc()</code>.</li> </ul> <p>If your platform does not provide these functions it should be trivial to provide an implementation for them and link these to your program.</p> <p>For targets with very restricted memory, it might be beneficial to pass some additional flags to both the Nim compiler and the C compiler and/or linker to optimize the build for size. For example, the following flags can be used when targeting a gcc compiler:</p> <p><code>--opt:size --passC:-flto --passL:-flto</code></p> <p>The <code>--opt:size</code> flag instructs Nim to optimize code generation for small size (with the help of the C compiler), the <code>flto</code> flags enable link-time optimization in the compiler and linker.</p> <p>Check the <code>Cross-compilation</code> section for instructions on how to compile the program for your target.</p> <h2 id="nim-for-realtime-systems">Nim for realtime systems</h2>
<p>See the documentation of Nim's soft realtime <a href="gc.html">GC</a> for further information.</p> <h2 id="signal-handling-in-nim">Signal handling in Nim</h2>
<p>The Nim programming language has no concept of Posix's signal handling mechanisms. However, the standard library offers some rudimentary support for signal handling, in particular, segmentation faults are turned into fatal errors that produce a stack trace. This can be disabled with the <code>-d:noSignalHandler</code> switch.</p> <h2 id="optimizing-for-nim">Optimizing for Nim</h2>
<p>Nim has no separate optimizer, but the C code that is produced is very efficient. Most C compilers have excellent optimizers, so usually it is not needed to optimize one's code. Nim has been designed to encourage efficient code: The most readable code in Nim is often the most efficient too.</p> <p>However, sometimes one has to optimize. Do it in the following order:</p> <ol class="simple">
<li>switch off the embedded debugger (it is <strong>slow</strong>!)</li> <li>turn on the optimizer and turn off runtime checks</li> <li>profile your code to find where the bottlenecks are</li> <li>try to find a better algorithm</li> <li>do low-level optimizations</li> </ol> <p>This section can only help you with the last item.</p> <h3 id="optimizing-for-nim-optimizing-string-handling">Optimizing string handling</h3>
<p>String assignments are sometimes expensive in Nim: They are required to copy the whole string. However, the compiler is often smart enough to not copy strings. Due to the argument passing semantics, strings are never copied when passed to subroutines. The compiler does not copy strings that are a result of a procedure call, because the callee returns a new string anyway. Thus it is efficient to do:</p> <pre class="listing" data-language="nim">var s = procA() # assignment will not copy the string; procA allocates a new
                # string already</pre>
<p>However, it is not efficient to do:</p> <pre class="listing" data-language="nim">var s = varA    # assignment has to copy the whole string into a new buffer!</pre>
<p>For <code>let</code> symbols a copy is not always necessary:</p> <pre class="listing" data-language="nim">let s = varA    # may only copy a pointer if it safe to do so</pre>
<p>If you know what you're doing, you can also mark single-string (or sequence) objects as <span id="shallow_1">shallow</span>:</p> <pre class="listing" data-language="nim">var s = "abc"
shallow(s) # mark 's' as a shallow string
var x = s  # now might not copy the string!</pre>
<p>Usage of <code>shallow</code> is always safe once you know the string won't be modified anymore, similar to Ruby's <span id="freeze_1">freeze</span>.</p> <p>The compiler optimizes string case statements: A hashing scheme is used for them if several different string constants are used. So code like this is reasonably efficient:</p> <pre class="listing" data-language="nim">case normalize(k.key)
of "name": c.name = v
of "displayname": c.displayName = v
of "version": c.version = v
of "os": c.oses = split(v, {';'})
of "cpu": c.cpus = split(v, {';'})
of "authors": c.authors = split(v, {';'})
of "description": c.description = v
of "app":
  case normalize(v)
  of "console": c.app = appConsole
  of "gui": c.app = appGUI
  else: quit(errorStr(p, "expected: console or gui"))
of "license": c.license = UnixToNativePath(k.value)
else: quit(errorStr(p, "unknown variable: " &amp; k.key))</pre><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2006&ndash;2021 Andreas Rumpf<br>Licensed under the MIT License.<br>
    <a href="https://nim-lang.org/docs/nimc.html" class="_attribution-link">https://nim-lang.org/docs/nimc.html</a>
  </p>
</div>
