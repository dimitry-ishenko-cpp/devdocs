<h1 class="title">modulegraphs</h1>  
<p>This module implements the module graph data structure. The module graph represents a complete Nim project. Single modules can either be kept in RAM or stored in a Sqlite database.</p> <p>The caching of modules is critical for 'nimsuggest' and is tricky to get right. If module E is being edited, we need autocompletion (and type checking) for E but we don't want to recompile depending modules right away for faster turnaround times. Instead we mark the module's dependencies as 'dirty'. Let D be a dependency of E. If D is dirty, we need to recompile it and all of its dependencies that are marked as 'dirty'. 'nimsuggest sug' actually is invoked for the file being edited so we know its content changed and there is no need to compute any checksums. Instead of a recursive algorithm, we use an iterative algorithm:</p> <ul class="simple">
<li>If a module gets recompiled, its dependencies need to be updated.</li> <li>Its dependent module stays the same.</li> </ul>  <h2 id="6">Imports</h2> <dl> <a href="ast.html">ast</a>, <a href="options.html">options</a>, <a href="lineinfos.html">lineinfos</a>, <a href="idents.html">idents</a>, <a href="incremental.html">incremental</a>, <a href="btrees.html">btrees</a> </dl>  <h2 id="7">Types</h2> <dl>  <dt><pre id="SigHash">SigHash = distinct MD5Digest</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/compiler/modulegraphs.nim#L32" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/compiler/modulegraphs.nim#L32" target="_blank">Edit</a> </dd>  <dt><pre id="ModuleGraph" data-language="nim">ModuleGraph {...}{.acyclic.} = ref object
  modules*: seq[PSym]        ## indexed by int32 fileIdx
  packageSyms*: TStrTable
  deps*: IntSet
  importDeps*: Table[FileIndex, seq[FileIndex]]
  suggestMode*: bool
  invalidTransitiveClosure: bool
  inclToMod*: Table[FileIndex, FileIndex]
  importStack*: seq[FileIndex]
  backend*: RootRef
  config*: ConfigRef
  cache*: IdentCache
  vm*: RootRef
  doStopCompile*: proc (): bool {...}{.closure.}
  usageSym*: PSym
  owners*: seq[PSym]
  methods*: seq[tuple[methods: seq[PSym], dispatcher: PSym]]
  systemModule*: PSym
  sysTypes*: array[TTypeKind, PType]
  compilerprocs*: TStrTable
  exposed*: TStrTable
  intTypeCache*: array[-5 .. 64, PType]
  opContains*, opNot*: PSym
  emptyNode*: PNode
  incr*: IncrementalCtx
  canonTypes*: Table[SigHash, PType]
  symBodyHashes*: Table[int, SigHash]
  importModuleCallback*: proc (graph: ModuleGraph; m: PSym; fileIdx: FileIndex): PSym {...}{.
      nimcall.}
  includeFileCallback*: proc (graph: ModuleGraph; m: PSym; fileIdx: FileIndex): PNode {...}{.
      nimcall.}
  recordStmt*: proc (graph: ModuleGraph; m: PSym; n: PNode) {...}{.nimcall.}
  cacheSeqs*: Table[string, PNode]
  cacheCounters*: Table[string, BiggestInt]
  cacheTables*: Table[string, BTree[string, PNode]]
  passes*: seq[TPass]
  onDefinition*: proc (graph: ModuleGraph; s: PSym; info: TLineInfo) {...}{.nimcall.}
  onDefinitionResolveForward*: proc (graph: ModuleGraph; s: PSym;
                                     info: TLineInfo) {...}{.nimcall.}
  onUsage*: proc (graph: ModuleGraph; s: PSym; info: TLineInfo) {...}{.nimcall.}
  globalDestructors*: seq[PNode]
  strongSemCheck*: proc (graph: ModuleGraph; owner: PSym; body: PNode) {...}{.nimcall.}
  compatibleProps*: proc (graph: ModuleGraph; formal, actual: PType): bool {...}{.
      nimcall.}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/compiler/modulegraphs.nim#L34" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/compiler/modulegraphs.nim#L34" target="_blank">Edit</a> </dd>  <dt><pre id="TPassContext">TPassContext = object of RootObj</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/compiler/modulegraphs.nim#L78" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/compiler/modulegraphs.nim#L78" target="_blank">Edit</a> </dd>  <dt><pre id="PPassContext">PPassContext = ref TPassContext</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/compiler/modulegraphs.nim#L79" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/compiler/modulegraphs.nim#L79" target="_blank">Edit</a> </dd>  <dt><pre id="TPassOpen" data-language="nim">TPassOpen = proc (graph: ModuleGraph; module: PSym): PPassContext {...}{.nimcall.}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/compiler/modulegraphs.nim#L81" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/compiler/modulegraphs.nim#L81" target="_blank">Edit</a> </dd>  <dt><pre id="TPassClose" data-language="nim">TPassClose = proc (graph: ModuleGraph; p: PPassContext; n: PNode): PNode {...}{.
    nimcall.}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/compiler/modulegraphs.nim#L82" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/compiler/modulegraphs.nim#L82" target="_blank">Edit</a> </dd>  <dt><pre id="TPassProcess" data-language="nim">TPassProcess = proc (p: PPassContext; topLevelStmt: PNode): PNode {...}{.nimcall.}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/compiler/modulegraphs.nim#L83" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/compiler/modulegraphs.nim#L83" target="_blank">Edit</a> </dd>  <dt><pre id="TPass" data-language="nim">TPass = tuple[open: TPassOpen, process: TPassProcess, close: TPassClose,
              isFrontend: bool]</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/compiler/modulegraphs.nim#L85" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/compiler/modulegraphs.nim#L85" target="_blank">Edit</a> </dd> </dl>  <h2 id="12">Procs</h2> <dl>  <dt><pre id="%24%2CSigHash" data-language="nim">proc `$`(u: SigHash): string {...}{.raises: [], tags: [].}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/compiler/modulegraphs.nim#L125" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/compiler/modulegraphs.nim#L125" target="_blank">Edit</a> </dd>  <dt><pre id="%3D%3D%2CSigHash%2CSigHash" data-language="nim">proc `==`(a, b: SigHash): bool {...}{.raises: [], tags: [].}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/compiler/modulegraphs.nim#L128" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/compiler/modulegraphs.nim#L128" target="_blank">Edit</a> </dd>  <dt><pre id="hash%2CSigHash" data-language="nim">proc hash(u: SigHash): Hash {...}{.raises: [], tags: [].}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/compiler/modulegraphs.nim#L131" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/compiler/modulegraphs.nim#L131" target="_blank">Edit</a> </dd>  <dt><pre id="hash%2CFileIndex" data-language="nim">proc hash(x: FileIndex): Hash {...}{.borrow.}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/compiler/modulegraphs.nim#L136" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/compiler/modulegraphs.nim#L136" target="_blank">Edit</a> </dd>  <dt><pre id="stopCompile%2CModuleGraph" data-language="nim">proc stopCompile(g: ModuleGraph): bool {...}{.inline, raises: [Exception],
    tags: [RootEffect].}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/compiler/modulegraphs.nim#L164" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/compiler/modulegraphs.nim#L164" target="_blank">Edit</a> </dd>  <dt><pre id="createMagic%2CModuleGraph%2Cstring%2CTMagic" data-language="nim">proc createMagic(g: ModuleGraph; name: string; m: TMagic): PSym {...}{.raises: [],
    tags: [].}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/compiler/modulegraphs.nim#L167" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/compiler/modulegraphs.nim#L167" target="_blank">Edit</a> </dd>  <dt><pre id="newModuleGraph%2CIdentCache%2CConfigRef" data-language="nim">proc newModuleGraph(cache: IdentCache; config: ConfigRef): ModuleGraph {...}{.
    raises: [], tags: [].}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/compiler/modulegraphs.nim#L172" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/compiler/modulegraphs.nim#L172" target="_blank">Edit</a> </dd>  <dt><pre id="resetAllModules%2CModuleGraph" data-language="nim">proc resetAllModules(g: ModuleGraph) {...}{.raises: [], tags: [].}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/compiler/modulegraphs.nim#L198" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/compiler/modulegraphs.nim#L198" target="_blank">Edit</a> </dd>  <dt><pre id="getModule%2CModuleGraph%2CFileIndex" data-language="nim">proc getModule(g: ModuleGraph; fileIdx: FileIndex): PSym {...}{.raises: [], tags: [].}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/compiler/modulegraphs.nim#L210" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/compiler/modulegraphs.nim#L210" target="_blank">Edit</a> </dd>  <dt><pre id="addDep%2CModuleGraph%2CPSym%2CFileIndex" data-language="nim">proc addDep(g: ModuleGraph; m: PSym; dep: FileIndex) {...}{.raises: [], tags: [].}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/compiler/modulegraphs.nim#L216" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/compiler/modulegraphs.nim#L216" target="_blank">Edit</a> </dd>  <dt><pre id="addIncludeDep%2CModuleGraph%2CFileIndex%2CFileIndex" data-language="nim">proc addIncludeDep(g: ModuleGraph; module, includeFile: FileIndex) {...}{.raises: [],
    tags: [].}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/compiler/modulegraphs.nim#L225" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/compiler/modulegraphs.nim#L225" target="_blank">Edit</a> </dd>  <dt><pre id="parentModule%2CModuleGraph%2CFileIndex" data-language="nim">proc parentModule(g: ModuleGraph; fileIdx: FileIndex): FileIndex {...}{.raises: [],
    tags: [].}</pre></dt> <dd> returns 'fileIdx' if the file belonging to this index is directly used as a module or else the module that first references this include file. <a href="https://github.com/nim-lang/Nim/tree/version-1-4/compiler/modulegraphs.nim#L229" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/compiler/modulegraphs.nim#L229" target="_blank">Edit</a> </dd>  <dt><pre id="markDirty%2CModuleGraph%2CFileIndex" data-language="nim">proc markDirty(g: ModuleGraph; fileIdx: FileIndex) {...}{.raises: [], tags: [].}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/compiler/modulegraphs.nim#L247" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/compiler/modulegraphs.nim#L247" target="_blank">Edit</a> </dd>  <dt><pre id="markClientsDirty%2CModuleGraph%2CFileIndex" data-language="nim">proc markClientsDirty(g: ModuleGraph; fileIdx: FileIndex) {...}{.raises: [], tags: [].}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/compiler/modulegraphs.nim#L251" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/compiler/modulegraphs.nim#L251" target="_blank">Edit</a> </dd>  <dt><pre id="isDirty%2CModuleGraph%2CPSym" data-language="nim">proc isDirty(g: ModuleGraph; m: PSym): bool {...}{.raises: [], tags: [].}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/compiler/modulegraphs.nim#L265" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/compiler/modulegraphs.nim#L265" target="_blank">Edit</a> </dd> </dl>  <h2 id="18">Templates</h2> <dl>  <dt><pre id="onUse.t%2CTLineInfo%2CPSym" data-language="nim">template onUse(info: TLineInfo; s: PSym)</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/compiler/modulegraphs.nim#L160" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/compiler/modulegraphs.nim#L160" target="_blank">Edit</a> </dd>  <dt><pre id="onDef.t%2CTLineInfo%2CPSym" data-language="nim">template onDef(info: TLineInfo; s: PSym)</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/compiler/modulegraphs.nim#L161" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/compiler/modulegraphs.nim#L161" target="_blank">Edit</a> </dd>  <dt><pre id="onDefResolveForward.t%2CTLineInfo%2CPSym" data-language="nim">template onDefResolveForward(info: TLineInfo; s: PSym)</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/compiler/modulegraphs.nim#L162" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/compiler/modulegraphs.nim#L162" target="_blank">Edit</a> </dd> </dl><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2006&ndash;2021 Andreas Rumpf<br>Licensed under the MIT License.<br>
    <a href="https://nim-lang.org/docs/compiler/modulegraphs.html" class="_attribution-link">https://nim-lang.org/docs/compiler/modulegraphs.html</a>
  </p>
</div>
