<h1 class="title">varpartitions</h1> <a href="https://github.com/nim-lang/Nim/tree/version-2-0/compiler/varpartitions.nim#L1" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/compiler/varpartitions.nim#L1" target="_blank">Edit</a>  <p class="module-desc">Partition variables into different graphs. Used for Nim's write tracking, borrow checking and also for the cursor inference. The algorithm is a reinvention / variation of Steensgaard's algorithm. The used data structure is "union find" with path compression.We perform two passes over the AST:</p>
<ul class="simple">
<li>Pass one (<code>computeLiveRanges</code>): collect livetimes of local variables and whether they are potentially re-assigned.</li> <li>Pass two (<code>traverse</code>): combine local variables to abstract "graphs". Strict func checking: Ensure that graphs that are connected to const parameters are not mutated. Cursor inference: Ensure that potential cursors are not borrowed from locations that are connected to a graph that is mutated during the liveness of the cursor. (We track all possible mutations of a graph.)</li> </ul> <p>See <a href="https://nim-lang.github.io/Nim/manual_experimental.html#view-types-algorithm">https://nim-lang.github.io/Nim/manual_experimental.html#view-types-algorithm</a> for a high-level description of how borrow checking works.</p>  <h2 id="6">Imports</h2> <dl> <a href="ast.html">ast</a>, <a href="types.html">types</a>, <a href="lineinfos.html">lineinfos</a>, <a href="options.html">options</a>, <a href="msgs.html">msgs</a>, <a href="renderer.html">renderer</a>, <a href="typeallowed.html">typeallowed</a>, <a href="modulegraphs.html">modulegraphs</a>, <a href="trees.html">trees</a>, <a href="isolation_check.html">isolation_check</a> </dl>   <h2 id="7">Types</h2> <dl> <div id="Goal"> <dt><pre data-language="nim">Goal = enum
  constParameters, borrowChecking, cursorInference</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-2-0/compiler/varpartitions.nim#L94" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/compiler/varpartitions.nim#L94" target="_blank">Edit</a> </dd> </div> <div id="MutationInfo"> <dt><pre>MutationInfo = object</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-2-0/compiler/varpartitions.nim#L87" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/compiler/varpartitions.nim#L87" target="_blank">Edit</a> </dd> </div> <div id="Partitions"> <dt><pre>Partitions = object</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-2-0/compiler/varpartitions.nim#L99" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/compiler/varpartitions.nim#L99" target="_blank">Edit</a> </dd> </div> </dl>   <h2 id="12">Procs</h2> <dl> <div id="$-procs-all"> <div id="$,ConfigRef,MutationInfo"> <dt><pre data-language="nim">proc `$`(config: ConfigRef; g: MutationInfo): string {.
    ...raises: [Exception, KeyError, OSError], tags: [RootEffect, ReadDirEffect],
    forbids: [].}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-2-0/compiler/varpartitions.nim#L116" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/compiler/varpartitions.nim#L116" target="_blank">Edit</a> </dd> </div> </div> <div id="checkBorrowedLocations-procs-all"> <div id="checkBorrowedLocations,Partitions,PNode,ConfigRef"> <dt><pre data-language="nim">proc checkBorrowedLocations(par: var Partitions; body: PNode; config: ConfigRef) {....raises: [
    Exception, KeyError, OSError, ValueError, IOError, ERecoverableError], tags: [
    RootEffect, ReadDirEffect, WriteIOEffect, ReadIOEffect, ReadEnvEffect],
    forbids: [].}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-2-0/compiler/varpartitions.nim#L946" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/compiler/varpartitions.nim#L946" target="_blank">Edit</a> </dd> </div> </div> <div id="computeCursors-procs-all"> <div id="computeCursors,PSym,PNode,ModuleGraph"> <dt><pre data-language="nim">proc computeCursors(s: PSym; n: PNode; g: ModuleGraph) {....raises: [Exception,
    ValueError, KeyError, OSError, IOError, ERecoverableError], tags: [
    RootEffect, ReadDirEffect, WriteIOEffect, ReadIOEffect, ReadEnvEffect],
    forbids: [].}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-2-0/compiler/varpartitions.nim#L975" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/compiler/varpartitions.nim#L975" target="_blank">Edit</a> </dd> </div> </div> <div id="computeGraphPartitions-procs-all"> <div id="computeGraphPartitions,PSym,PNode,ModuleGraph,set[Goal]"> <dt><pre data-language="nim">proc computeGraphPartitions(s: PSym; n: PNode; g: ModuleGraph; goals: set[Goal]): Partitions {....raises: [
    Exception, ValueError, KeyError, OSError, IOError, ERecoverableError], tags: [
    RootEffect, ReadDirEffect, WriteIOEffect, ReadIOEffect, ReadEnvEffect],
    forbids: [].}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-2-0/compiler/varpartitions.nim#L901" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/compiler/varpartitions.nim#L901" target="_blank">Edit</a> </dd> </div> </div> <div id="hasSideEffect-procs-all"> <div id="hasSideEffect,Partitions,MutationInfo"> <dt><pre data-language="nim">proc hasSideEffect(c: var Partitions; info: var MutationInfo): bool {.
    ...raises: [], tags: [], forbids: [].}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-2-0/compiler/varpartitions.nim#L131" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/compiler/varpartitions.nim#L131" target="_blank">Edit</a> </dd> </div> </div> </dl><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2006&ndash;2024 Andreas Rumpf<br>Licensed under the MIT License.<br>
    <a href="https://nim-lang.org/docs/compiler/varpartitions.html" class="_attribution-link">https://nim-lang.org/docs/compiler/varpartitions.html</a>
  </p>
</div>
