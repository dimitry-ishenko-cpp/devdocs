<h1 class="title">varpartitions</h1>  <p class="module-desc">Partition variables into different graphs. Used for Nim's write tracking, borrow checking and also for the cursor inference. The algorithm is a reinvention / variation of Steensgaard's algorithm. The used data structure is "union find" with path compression.We perform two passes over the AST:</p>
<ul class="simple">
<li>Pass one (<code>computeLiveRanges</code>): collect livetimes of local variables and whether they are potentially re-assigned.</li> <li>Pass two (<code>traverse</code>): combine local variables to abstract "graphs". Strict func checking: Ensure that graphs that are connected to const parameters are not mutated.<dl>
<dt>Cursor inference: Ensure that potential cursors are not</dt> <dd>borrowed from locations that are connected to a graph that is mutated during the liveness of the cursor. (We track all possible mutations of a graph.)</dd> </dl> </li> </ul> <p>See <a href="https://nim-lang.github.io/Nim/manual_experimental.html#view-types-algorithm">https://nim-lang.github.io/Nim/manual_experimental.html#view-types-algorithm</a> for a high-level description of how borrow checking works.</p>  <h2 id="6">Imports</h2> <dl> <a href="ast.html">ast</a>, <a href="types.html">types</a>, <a href="lineinfos.html">lineinfos</a>, <a href="options.html">options</a>, <a href="msgs.html">msgs</a>, <a href="renderer.html">renderer</a>, <a href="typeallowed.html">typeallowed</a>, <a href="trees.html">trees</a>, <a href="isolation_check.html">isolation_check</a> </dl>  <h2 id="7">Types</h2> <dl>  <dt><pre id="MutationInfo" data-language="nim">MutationInfo = object
  param: PSym
  mutatedHere, connectedVia: TLineInfo
  flags: set[SubgraphFlag]
  maxMutation, minConnection: AbstractTime
  mutations: seq[AbstractTime]</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/compiler/varpartitions.nim#L83" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/compiler/varpartitions.nim#L83" target="_blank">Edit</a> </dd>  <dt><pre id="Goal" data-language="nim">Goal = enum
  constParameters, borrowChecking, cursorInference</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/compiler/varpartitions.nim#L90" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/compiler/varpartitions.nim#L90" target="_blank">Edit</a> </dd>  <dt><pre id="Partitions" data-language="nim">Partitions = object
  abstractTime: AbstractTime
  s: seq[VarIndex]
  graphs: seq[MutationInfo]
  goals: set[Goal]
  unanalysableMutation: bool
  inAsgnSource, inConstructor, inNoSideEffectSection: int
  inConditional, inLoop: int
  owner: PSym
  config: ConfigRef</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/compiler/varpartitions.nim#L95" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/compiler/varpartitions.nim#L95" target="_blank">Edit</a> </dd> </dl>  <h2 id="12">Procs</h2> <dl>  <dt><pre id="%24%2CConfigRef%2CMutationInfo" data-language="nim">proc `$`(config: ConfigRef; g: MutationInfo): string {...}{.raises: [], tags: [].}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/compiler/varpartitions.nim#L110" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/compiler/varpartitions.nim#L110" target="_blank">Edit</a> </dd>  <dt><pre id="hasSideEffect%2CPartitions%2CMutationInfo" data-language="nim">proc hasSideEffect(c: var Partitions; info: var MutationInfo): bool {...}{.
    raises: [], tags: [].}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/compiler/varpartitions.nim#L125" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/compiler/varpartitions.nim#L125" target="_blank">Edit</a> </dd>  <dt><pre id="computeGraphPartitions%2CPSym%2CPNode%2CConfigRef%2Cset%5BGoal%5D" data-language="nim">proc computeGraphPartitions(s: PSym; n: PNode; config: ConfigRef;
                            goals: set[Goal]): Partitions {...}{.
    raises: [Exception, ValueError, IOError, ERecoverableError],
    tags: [RootEffect, WriteIOEffect, ReadIOEffect, ReadEnvEffect].}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/compiler/varpartitions.nim#L845" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/compiler/varpartitions.nim#L845" target="_blank">Edit</a> </dd>  <dt><pre id="checkBorrowedLocations%2CPartitions%2CPNode%2CConfigRef" data-language="nim">proc checkBorrowedLocations(par: var Partitions; body: PNode; config: ConfigRef) {...}{.
    raises: [Exception, ValueError, IOError, ERecoverableError],
    tags: [RootEffect, WriteIOEffect, ReadIOEffect, ReadEnvEffect].}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/compiler/varpartitions.nim#L882" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/compiler/varpartitions.nim#L882" target="_blank">Edit</a> </dd>  <dt><pre id="computeCursors%2CPSym%2CPNode%2CConfigRef" data-language="nim">proc computeCursors(s: PSym; n: PNode; config: ConfigRef) {...}{.
    raises: [Exception, ValueError, IOError, ERecoverableError],
    tags: [RootEffect, WriteIOEffect, ReadIOEffect, ReadEnvEffect].}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/compiler/varpartitions.nim#L911" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/compiler/varpartitions.nim#L911" target="_blank">Edit</a> </dd> </dl><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2006&ndash;2021 Andreas Rumpf<br>Licensed under the MIT License.<br>
    <a href="https://nim-lang.org/docs/compiler/varpartitions.html" class="_attribution-link">https://nim-lang.org/docs/compiler/varpartitions.html</a>
  </p>
</div>
