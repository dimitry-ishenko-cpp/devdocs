<h1 class="title">threads</h1>  
<p>Thread support for Nim.</p> <p><strong>Note</strong>: This is part of the system module. Do not import it directly. To activate thread support you need to compile with the <code>--threads:on</code> command line switch.</p> <p>Nim's memory model for threads is quite different from other common programming languages (C, Pascal): Each thread has its own (garbage collected) heap and sharing of memory is restricted. This helps to prevent race conditions and improves efficiency. See <a href="manual.html#threads">the manual for details of this memory model</a>.</p> <h2 id="examples">Examples</h2>
<pre class="listing" data-language="nim">import locks

var
  thr: array[0..4, Thread[tuple[a,b: int]]]
  L: Lock

proc threadFunc(interval: tuple[a,b: int]) {.thread.} =
  for i in interval.a..interval.b:
    acquire(L) # lock stdout
    echo i
    release(L)

initLock(L)

for i in 0..high(thr):
  createThread(thr[i], threadFunc, (i*10, i*10+5))
joinThreads(thr)

deinitLock(L)</pre>  <h2 id="7">Types</h2> <dl>  <dt><pre data-language="nim">Thread*[TArg] = object
  core: PGcThread
  sys: SysThread
  when TArg is void:
      dataFn: proc () {...}{.nimcall, gcsafe.}

  else:
      dataFn: proc (m: TArg) {...}{.nimcall, gcsafe.}
      data: TArg</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/system/threads.nim#L84" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/system/threads.nim#L84" target="_blank">Edit</a> </dd> </dl>  <h2 id="12">Procs</h2> <dl>  <dt><pre id="onThreadDestruction%2Cproc%29" data-language="nim">proc onThreadDestruction*(handler: proc () {...}{.closure, gcsafe, raises: [].})</pre></dt> <dd> <p>Registers a <em>thread local</em> handler that is called at the thread's destruction.</p> <p>A thread is destructed when the <code>.thread</code> proc returns normally or when it raises an exception. Note that unhandled exceptions in a thread nevertheless cause the whole process to die.</p> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/system/threads.nim#L96" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/system/threads.nim#L96" target="_blank">Edit</a> </dd>  <dt><pre id="running%2CThread%5BTArg%5D" data-language="nim">proc running*[TArg](t: Thread[TArg]): bool {...}{.inline.}</pre></dt> <dd> Returns true if <code>t</code> is running. <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/system/threads.nim#L198" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/system/threads.nim#L198" target="_blank">Edit</a> </dd>  <dt><pre id="handle%2CThread%5BTArg%5D" data-language="nim">proc handle*[TArg](t: Thread[TArg]): SysThread {...}{.inline.}</pre></dt> <dd> Returns the thread handle of <code>t</code>. <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/system/threads.nim#L202" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/system/threads.nim#L202" target="_blank">Edit</a> </dd>  <dt><pre id="joinThread%2CThread%5BTArg%5D" data-language="nim">proc joinThread*[TArg](t: Thread[TArg]) {...}{.inline.}</pre></dt> <dd> Waits for the thread <code>t</code> to finish. <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/system/threads.nim#L209" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/system/threads.nim#L209" target="_blank">Edit</a> </dd>  <dt><pre id="joinThreads%2Cvarargs%5BThread%5BTArg%5D%5D" data-language="nim">proc joinThreads*[TArg](t: varargs[Thread[TArg]])</pre></dt> <dd> Waits for every thread in <code>t</code> to finish. <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/system/threads.nim#L213" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/system/threads.nim#L213" target="_blank">Edit</a> </dd>  <dt><pre id="createThread%2CThread%5BTArg%5D%2Cproc%28TArg%29%2CTArg" data-language="nim">proc createThread*[TArg](t: var Thread[TArg];
                         tp: proc (arg: TArg) {...}{.thread, nimcall.}; param: TArg)</pre></dt> <dd> <p>Creates a new thread <code>t</code> and starts its execution.</p> <p>Entry point is the proc <code>tp</code>. <code>param</code> is passed to <code>tp</code>. <code>TArg</code> can be <code>void</code> if you don't need to pass any data to the thread.</p> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/system/threads.nim#L258" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/system/threads.nim#L258" target="_blank">Edit</a> </dd>  <dt><pre id="pinToCpu%2CThread%5BArg%5D%2CNatural" data-language="nim">proc pinToCpu*[Arg](t: var Thread[Arg]; cpu: Natural)</pre></dt> <dd> <p>Pins a thread to a <span id="cpu_1">CPU</span>.</p> <p>In other words sets a thread's <span id="affinity_1">affinity</span>. If you don't know what this means, you shouldn't use this proc.</p> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/system/threads.nim#L277" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/system/threads.nim#L277" target="_blank">Edit</a> </dd>  <dt><pre id="createThread%2CThread%5Bvoid%5D%2Cproc%29" data-language="nim">proc createThread*(t: var Thread[void]; tp: proc () {...}{.thread, nimcall.})</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/system/threads.nim#L341" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/system/threads.nim#L341" target="_blank">Edit</a> </dd>  <dt><pre id="getThreadId" data-language="nim">proc getThreadId*(): int</pre></dt> <dd> Gets the ID of the currently running thread. <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/system/threads.nim#L348" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/system/threads.nim#L348" target="_blank">Edit</a> </dd> </dl><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2006&ndash;2021 Andreas Rumpf<br>Licensed under the MIT License.<br>
    <a href="https://nim-lang.org/docs/threads.html" class="_attribution-link">https://nim-lang.org/docs/threads.html</a>
  </p>
</div>
