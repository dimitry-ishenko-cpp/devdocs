<h1 class="title">db_sqlite</h1>  <p class="module-desc">A higher level <span id="sqlite_1">SQLite</span> database wrapper. This interface is implemented for other databases too. </p>
<h2 id="basic-usage">Basic usage</h2>
<p>The basic flow of using this module is:</p> <ol class="simple">
<li>Open database connection</li> <li>Execute SQL query</li> <li>Close database connection</li> </ol> <h3 id="basic-usage-parameter-substitution">Parameter substitution</h3>
<p>All <code>db_*</code> modules support the same form of parameter substitution. That is, using the <code>?</code> (question mark) to signify the place where a value should be placed. For example:</p> <pre class="listing" data-language="nim">sql"INSERT INTO my_table (colA, colB, colC) VALUES (?, ?, ?)"</pre> <h3 id="basic-usage-opening-a-connection-to-a-database">Opening a connection to a database</h3>
<pre class="listing" data-language="nim">import db_sqlite

# user, password, database name can be empty.
# These params are not used on db_sqlite module.
let db = open("mytest.db", "", "", "")
db.close()</pre> <h3 id="basic-usage-creating-a-table">Creating a table</h3>
<pre class="listing" data-language="nim">db.exec(sql"DROP TABLE IF EXISTS my_table")
db.exec(sql"""CREATE TABLE my_table (
                 id   INTEGER,
                 name VARCHAR(50) NOT NULL
              )""")</pre> <h3 id="basic-usage-inserting-data">Inserting data</h3>
<pre class="listing" data-language="nim">db.exec(sql"INSERT INTO my_table (id, name) VALUES (0, ?)",
        "Jack")</pre> <h3 id="basic-usage-larger-example">Larger example</h3>
<pre class="listing" data-language="nim">import db_sqlite, math

let db = open("mytest.db", "", "", "")

db.exec(sql"DROP TABLE IF EXISTS my_table")
db.exec(sql"""CREATE TABLE my_table (
                 id    INTEGER PRIMARY KEY,
                 name  VARCHAR(50) NOT NULL,
                 i     INT(11),
                 f     DECIMAL(18, 10)
              )""")

db.exec(sql"BEGIN")
for i in 1..1000:
  db.exec(sql"INSERT INTO my_table (name, i, f) VALUES (?, ?, ?)",
          "Item#" &amp; $i, i, sqrt(i.float))
db.exec(sql"COMMIT")

for x in db.fastRows(sql"SELECT * FROM my_table"):
  echo x

let id = db.tryInsertId(sql"""INSERT INTO my_table (name, i, f)
                              VALUES (?, ?, ?)""",
                        "Item#1001", 1001, sqrt(1001.0))
echo "Inserted item: ", db.getValue(sql"SELECT name FROM my_table WHERE id=?", id)

db.close()</pre> <h2 id="note">Note</h2>
<p>This module does not implement any ORM features such as mapping the types from the schema. Instead, a <code>seq[string]</code> is returned for each row.</p> <p>The reasoning is as follows:</p> <ol class="simple">
<li>it's close to what many DBs offer natively (char**)</li> <li>it hides the number of types that the DB supports</li> </ol> <p>(int? int64? decimal up to 10 places? geo coords?)</p> <p>3. it's convenient when all you do is to forward the data to somewhere else (echo, log, put the data into a new query)</p> <h2 id="see-also">See also</h2>
<ul class="simple">
<li>
<a href="db_odbc.html">db_odbc module</a> for ODBC database wrapper</li> <li>
<a href="db_mysql.html">db_mysql module</a> for MySQL database wrapper</li> <li>
<a href="db_postgres.html">db_postgres module</a> for PostgreSQL database wrapper</li> </ul>  <h2 id="6">Imports</h2> <dl> <a href="sqlite3.html">sqlite3</a>, <a href="macros.html">macros</a>, <a href="db_common.html">db_common</a>, <a href="since.html">since</a> </dl>  <h2 id="7">Types</h2> <dl>  <dt><pre id="DbConn">DbConn = PSqlite3</pre></dt> <dd> Encapsulates a database connection. <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/impure/db_sqlite.nim#L126" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/impure/db_sqlite.nim#L126" target="_blank">Edit</a> </dd>  <dt><pre id="Row" data-language="nim">Row = seq[string]</pre></dt> <dd> A row of a dataset. <code>NULL</code> database values will be converted to an empty string. <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/impure/db_sqlite.nim#L127" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/impure/db_sqlite.nim#L127" target="_blank">Edit</a> </dd>  <dt><pre id="InstantRow">InstantRow = PStmt</pre></dt> <dd> A handle that can be used to get a row's column text on demand. <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/impure/db_sqlite.nim#L129" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/impure/db_sqlite.nim#L129" target="_blank">Edit</a> </dd>  <dt><pre id="SqlPrepared">SqlPrepared = distinct PStmt</pre></dt> <dd> a identifier for the prepared queries <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/impure/db_sqlite.nim#L131" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/impure/db_sqlite.nim#L131" target="_blank">Edit</a> </dd> </dl>  <h2 id="12">Procs</h2> <dl>  <dt><pre id="%5B%5D%2CInstantRow%2Cint32" data-language="nim">proc `[]`(row: InstantRow; col: int32): string {...}{.inline, raises: [], tags: [].}</pre></dt> <dd> <p>Returns text for given column of the row.</p> <p>See also:</p> <ul class="simple">
<li>
<a href="#instantRows.i,DbConn,SqlQuery,varargs%5Bstring,%5D">instantRows iterator</a> example code</li> </ul> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/impure/db_sqlite.nim#L412" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/impure/db_sqlite.nim#L412" target="_blank">Edit</a> </dd>  <dt><pre id="len%2CInstantRow" data-language="nim">proc len(row: InstantRow): int32 {...}{.inline, raises: [], tags: [].}</pre></dt> <dd> <p>Returns number of columns in a row.</p> <p>See also:</p> <ul class="simple">
<li>
<a href="#instantRows.i,DbConn,SqlQuery,varargs%5Bstring,%5D">instantRows iterator</a> example code</li> </ul> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/impure/db_sqlite.nim#L428" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/impure/db_sqlite.nim#L428" target="_blank">Edit</a> </dd>  <dt><pre id="finalize%2CSqlPrepared" data-language="nim">proc finalize(sqlPrepared: SqlPrepared) {...}{.discardable, raises: [], tags: [].}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/impure/db_sqlite.nim#L726" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/impure/db_sqlite.nim#L726" target="_blank">Edit</a> </dd>  <dt><pre id="dbQuote%2Cstring" data-language="nim">proc dbQuote(s: string): string {...}{.raises: [], tags: [].}</pre></dt> <dd> Escapes the <code>'</code> (single quote) char to <code>''</code>. Because single quote is used for defining <code>VARCHAR</code> in SQL. <p><strong class="examples_text">Example:</strong></p> <pre class="listing" data-language="nim">doAssert dbQuote("'") == "''''"
doAssert dbQuote("A Foobar's pen.") == "'A Foobar''s pen.'"</pre> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/impure/db_sqlite.nim#L149" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/impure/db_sqlite.nim#L149" target="_blank">Edit</a> </dd>  <dt><pre id="tryExec%2CDbConn%2CSqlPrepared" data-language="nim">proc tryExec(db: DbConn; stmtName: SqlPrepared): bool {...}{.
    tags: [ReadDbEffect, WriteDbEffect], raises: [].}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/impure/db_sqlite.nim#L202" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/impure/db_sqlite.nim#L202" target="_blank">Edit</a> </dd>  <dt><pre id="bindParam%2CSqlPrepared%2Cint%2Cint32" data-language="nim">proc bindParam(ps: SqlPrepared; paramIdx: int; val: int32) {...}{.raises: [DbError],
    tags: [].}</pre></dt> <dd> Binds a int32 to the specified paramIndex. <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/impure/db_sqlite.nim#L736" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/impure/db_sqlite.nim#L736" target="_blank">Edit</a> </dd>  <dt><pre id="bindParam%2CSqlPrepared%2Cint%2Cint64" data-language="nim">proc bindParam(ps: SqlPrepared; paramIdx: int; val: int64) {...}{.raises: [DbError],
    tags: [].}</pre></dt> <dd> Binds a int64 to the specified paramIndex. <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/impure/db_sqlite.nim#L741" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/impure/db_sqlite.nim#L741" target="_blank">Edit</a> </dd>  <dt><pre id="bindParam%2CSqlPrepared%2Cint%2Cfloat64" data-language="nim">proc bindParam(ps: SqlPrepared; paramIdx: int; val: float64) {...}{.
    raises: [DbError], tags: [].}</pre></dt> <dd> Binds a 64bit float to the specified paramIndex. <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/impure/db_sqlite.nim#L753" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/impure/db_sqlite.nim#L753" target="_blank">Edit</a> </dd>  <dt><pre id="bindParam%2CSqlPrepared%2Cint%2Cstring" data-language="nim">proc bindParam(ps: SqlPrepared; paramIdx: int; val: string; copy = true) {...}{.
    raises: [Exception, DbError], tags: [].}</pre></dt> <dd> Binds a string to the specified paramIndex. if copy is true then SQLite makes its own private copy of the data immediately <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/impure/db_sqlite.nim#L764" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/impure/db_sqlite.nim#L764" target="_blank">Edit</a> </dd>  <dt><pre id="bindParam%2CSqlPrepared%2Cint%2CopenArray%5Bbyte%5D" data-language="nim">proc bindParam(ps: SqlPrepared; paramIdx: int; val: openArray[byte]; copy = true) {...}{.
    raises: [Exception, DbError], tags: [].}</pre></dt> <dd> binds a blob to the specified paramIndex. if copy is true then SQLite makes its own private copy of the data immediately <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/impure/db_sqlite.nim#L770" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/impure/db_sqlite.nim#L770" target="_blank">Edit</a> </dd>  <dt><pre id="bindParam%2CSqlPrepared%2Cint%2Cint" data-language="nim">proc bindParam(ps: SqlPrepared; paramIdx: int; val: int) {...}{.raises: [DbError],
    tags: [].}</pre></dt> <dd> Binds a int to the specified paramIndex. <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/impure/db_sqlite.nim#L746" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/impure/db_sqlite.nim#L746" target="_blank">Edit</a> </dd>  <dt><pre id="bindNull%2CSqlPrepared%2Cint" data-language="nim">proc bindNull(ps: SqlPrepared; paramIdx: int) {...}{.raises: [DbError], tags: [].}</pre></dt> <dd> Sets the bindparam at the specified paramIndex to null (default behaviour by sqlite). <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/impure/db_sqlite.nim#L758" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/impure/db_sqlite.nim#L758" target="_blank">Edit</a> </dd>  <dt><pre id="dbError%2CDbConn" data-language="nim">proc dbError(db: DbConn) {...}{.noreturn, raises: [DbError], tags: [].}</pre></dt> <dd> <p>Raises a <code>DbError</code> exception.</p> <p><strong>Examples:</strong></p> <pre class="listing" data-language="nim">let db = open("mytest.db", "", "", "")
if not db.tryExec(sql"SELECT * FROM not_exist_table"):
  dbError(db)
db.close()</pre> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/impure/db_sqlite.nim#L133" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/impure/db_sqlite.nim#L133" target="_blank">Edit</a> </dd>  <dt><pre id="prepare%2CDbConn%2Cstring" data-language="nim">proc prepare(db: DbConn; q: string): SqlPrepared {...}{.raises: [DbError], tags: [].}</pre></dt> <dd> Creates a new <code>SqlPrepared</code> statement. <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/impure/db_sqlite.nim#L172" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/impure/db_sqlite.nim#L172" target="_blank">Edit</a> </dd>  <dt><pre id="tryExec%2CDbConn%2CSqlQuery%2Cvarargs%5Bstring%2C%5D" data-language="nim">proc tryExec(db: DbConn; query: SqlQuery; args: varargs[string, `$`]): bool {...}{.
    tags: [ReadDbEffect, WriteDbEffect], raises: [].}</pre></dt> <dd> <p>Tries to execute the query and returns <code>true</code> if successful, <code>false</code> otherwise.</p> <p><strong>Examples:</strong></p> <pre class="listing" data-language="nim">let db = open("mytest.db", "", "", "")
if not db.tryExec(sql"SELECT * FROM my_table"):
  dbError(db)
db.close()</pre> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/impure/db_sqlite.nim#L178" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/impure/db_sqlite.nim#L178" target="_blank">Edit</a> </dd>  <dt><pre id="exec%2CDbConn%2CSqlQuery%2Cvarargs%5Bstring%2C%5D" data-language="nim">proc exec(db: DbConn; query: SqlQuery; args: varargs[string, `$`]) {...}{.
    tags: [ReadDbEffect, WriteDbEffect], raises: [DbError].}</pre></dt> <dd> <p>Executes the query and raises a <code>DbError</code> exception if not successful.</p> <p><strong>Examples:</strong></p> <pre class="listing" data-language="nim">let db = open("mytest.db", "", "", "")
try:
  db.exec(sql"INSERT INTO my_table (id, name) VALUES (?, ?)",
          1, "item#1")
except:
  stderr.writeLine(getCurrentExceptionMsg())
finally:
  db.close()</pre> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/impure/db_sqlite.nim#L211" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/impure/db_sqlite.nim#L211" target="_blank">Edit</a> </dd>  <dt><pre id="close%2CDbConn" data-language="nim">proc close(db: DbConn) {...}{.tags: [DbEffect], raises: [DbError].}</pre></dt> <dd> <p>Closes the database connection.</p> <p><strong>Examples:</strong></p> <pre class="listing" data-language="nim">let db = open("mytest.db", "", "", "")
db.close()</pre> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/impure/db_sqlite.nim#L679" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/impure/db_sqlite.nim#L679" target="_blank">Edit</a> </dd>  <dt><pre id="open%2Cstring%2Cstring%2Cstring%2Cstring" data-language="nim">proc open(connection, user, password, database: string): DbConn {...}{.
    tags: [DbEffect], raises: [DbError].}</pre></dt> <dd> <p>Opens a database connection. Raises a <code>DbError</code> exception if the connection could not be established.</p> <p><strong>Note:</strong> Only the <code>connection</code> parameter is used for <code>sqlite</code>.</p> <p><strong>Examples:</strong></p> <pre class="listing" data-language="nim">try:
  let db = open("mytest.db", "", "", "")
  ## do something...
  ## db.getAllRows(sql"SELECT * FROM my_table")
  db.close()
except:
  stderr.writeLine(getCurrentExceptionMsg())</pre> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/impure/db_sqlite.nim#L690" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/impure/db_sqlite.nim#L690" target="_blank">Edit</a> </dd>  <dt><pre id="unsafeColumnAt%2CInstantRow%2Cint32" data-language="nim">proc unsafeColumnAt(row: InstantRow; index: int32): cstring {...}{.inline,
    raises: [], tags: [].}</pre></dt> <dd> <p>Returns cstring for given column of the row.</p> <p>See also:</p> <ul class="simple">
<li>
<a href="#instantRows.i,DbConn,SqlQuery,varargs%5Bstring,%5D">instantRows iterator</a> example code</li> </ul> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/impure/db_sqlite.nim#L420" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/impure/db_sqlite.nim#L420" target="_blank">Edit</a> </dd>  <dt><pre id="getRow%2CDbConn%2CSqlQuery%2Cvarargs%5Bstring%2C%5D" data-language="nim">proc getRow(db: DbConn; query: SqlQuery; args: varargs[string, `$`]): Row {...}{.
    tags: [ReadDbEffect], raises: [DbError].}</pre></dt> <dd> <p>Retrieves a single row. If the query doesn't return any rows, this proc will return a <code>Row</code> with empty strings for each column.</p> <p><strong>Examples:</strong></p> <pre class="listing" data-language="nim">let db = open("mytest.db", "", "", "")

# Records of my_table:
# | id | name     |
# |----|----------|
# |  1 | item#1   |
# |  2 | item#2   |

doAssert db.getRow(sql"SELECT id, name FROM my_table"
                   ) == Row(@["1", "item#1"])
doAssert db.getRow(sql"SELECT id, name FROM my_table WHERE id = ?",
                   2) == Row(@["2", "item#2"])

# Returns empty.
doAssert db.getRow(sql"INSERT INTO my_table (id, name) VALUES (?, ?)",
                   3, "item#3") == @[]
doAssert db.getRow(sql"DELETE FROM my_table WHERE id = ?", 3) == @[]
doAssert db.getRow(sql"UPDATE my_table SET name = 'ITEM#1' WHERE id = ?",
                   1) == @[]
db.close()</pre> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/impure/db_sqlite.nim#L436" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/impure/db_sqlite.nim#L436" target="_blank">Edit</a> </dd>  <dt><pre id="getAllRows%2CDbConn%2CSqlQuery%2Cvarargs%5Bstring%2C%5D" data-language="nim">proc getAllRows(db: DbConn; query: SqlQuery; args: varargs[string, `$`]): seq[
    Row] {...}{.tags: [ReadDbEffect], raises: [DbError].}</pre></dt> <dd> <p>Executes the query and returns the whole result dataset.</p> <p><strong>Examples:</strong></p> <pre class="listing" data-language="nim">let db = open("mytest.db", "", "", "")

# Records of my_table:
# | id | name     |
# |----|----------|
# |  1 | item#1   |
# |  2 | item#2   |

doAssert db.getAllRows(sql"SELECT id, name FROM my_table") == @[Row(@["1", "item#1"]), Row(@["2", "item#2"])]
db.close()</pre> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/impure/db_sqlite.nim#L472" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/impure/db_sqlite.nim#L472" target="_blank">Edit</a> </dd>  <dt><pre id="getAllRows%2CDbConn%2CSqlPrepared" data-language="nim">proc getAllRows(db: DbConn; stmtName: SqlPrepared): seq[Row] {...}{.
    tags: [ReadDbEffect, WriteDbEffect], raises: [DbError].}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/impure/db_sqlite.nim#L494" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/impure/db_sqlite.nim#L494" target="_blank">Edit</a> </dd>  <dt><pre id="getValue%2CDbConn%2CSqlQuery%2Cvarargs%5Bstring%2C%5D" data-language="nim">proc getValue(db: DbConn; query: SqlQuery; args: varargs[string, `$`]): string {...}{.
    tags: [ReadDbEffect], raises: [DbError].}</pre></dt> <dd> <p>Executes the query and returns the first column of the first row of the result dataset. Returns <code>""</code> if the dataset contains no rows or the database value is <code>NULL</code>.</p> <p><strong>Examples:</strong></p> <pre class="listing" data-language="nim">let db = open("mytest.db", "", "", "")

# Records of my_table:
# | id | name     |
# |----|----------|
# |  1 | item#1   |
# |  2 | item#2   |

doAssert db.getValue(sql"SELECT name FROM my_table WHERE id = ?",
                     2) == "item#2"
doAssert db.getValue(sql"SELECT id, name FROM my_table") == "1"
doAssert db.getValue(sql"SELECT name, id FROM my_table") == "item#1"

db.close()</pre> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/impure/db_sqlite.nim#L531" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/impure/db_sqlite.nim#L531" target="_blank">Edit</a> </dd>  <dt><pre id="getValue%2CDbConn%2CSqlPrepared" data-language="nim">proc getValue(db: DbConn; stmtName: SqlPrepared): string {...}{.
    tags: [ReadDbEffect, WriteDbEffect], raises: [].}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/impure/db_sqlite.nim#L567" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/impure/db_sqlite.nim#L567" target="_blank">Edit</a> </dd>  <dt><pre id="tryInsertID%2CDbConn%2CSqlQuery%2Cvarargs%5Bstring%2C%5D" data-language="nim">proc tryInsertID(db: DbConn; query: SqlQuery; args: varargs[string, `$`]): int64 {...}{.
    tags: [WriteDbEffect], raises: [].}</pre></dt> <dd> <p>Executes the query (typically "INSERT") and returns the generated ID for the row or -1 in case of an error.</p> <p><strong>Examples:</strong></p> <pre class="listing" data-language="nim">let db = open("mytest.db", "", "", "")
db.exec(sql"CREATE TABLE my_table (id INTEGER, name VARCHAR(50) NOT NULL)")

doAssert db.tryInsertID(sql"INSERT INTO not_exist_table (id, name) VALUES (?, ?)",
                        1, "item#1") == -1
db.close()</pre> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/impure/db_sqlite.nim#L580" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/impure/db_sqlite.nim#L580" target="_blank">Edit</a> </dd>  <dt><pre id="insertID%2CDbConn%2CSqlQuery%2Cvarargs%5Bstring%2C%5D" data-language="nim">proc insertID(db: DbConn; query: SqlQuery; args: varargs[string, `$`]): int64 {...}{.
    tags: [WriteDbEffect], raises: [DbError].}</pre></dt> <dd> <p>Executes the query (typically "INSERT") and returns the generated ID for the row.</p> <p>Raises a <code>DbError</code> exception when failed to insert row. For Postgre this adds <code>RETURNING id</code> to the query, so it only works if your primary key is named <code>id</code>.</p> <p><strong>Examples:</strong></p> <pre class="listing" data-language="nim">let db = open("mytest.db", "", "", "")
db.exec(sql"CREATE TABLE my_table (id INTEGER, name VARCHAR(50) NOT NULL)")

for i in 0..2:
  let id = db.insertID(sql"INSERT INTO my_table (id, name) VALUES (?, ?)", i, "item#" &amp; $i)
  echo "LoopIndex = ", i, ", InsertID = ", id

# Output:
# LoopIndex = 0, InsertID = 1
# LoopIndex = 1, InsertID = 2
# LoopIndex = 2, InsertID = 3

db.close()</pre> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/impure/db_sqlite.nim#L608" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/impure/db_sqlite.nim#L608" target="_blank">Edit</a> </dd>  <dt><pre id="tryInsert%2CDbConn%2CSqlQuery%2Cstring%2Cvarargs%5Bstring%2C%5D" data-language="nim">proc tryInsert(db: DbConn; query: SqlQuery; pkName: string;
               args: varargs[string, `$`]): int64 {...}{.tags: [WriteDbEffect],
    raises: [].}</pre></dt> <dd> same as tryInsertID <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/impure/db_sqlite.nim#L637" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/impure/db_sqlite.nim#L637" target="_blank">Edit</a> </dd>  <dt><pre id="insert%2CDbConn%2CSqlQuery%2Cstring%2Cvarargs%5Bstring%2C%5D" data-language="nim">proc insert(db: DbConn; query: SqlQuery; pkName: string;
            args: varargs[string, `$`]): int64 {...}{.tags: [WriteDbEffect],
    raises: [DbError].}</pre></dt> <dd> same as insertId <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/impure/db_sqlite.nim#L643" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/impure/db_sqlite.nim#L643" target="_blank">Edit</a> </dd>  <dt><pre id="execAffectedRows%2CDbConn%2CSqlQuery%2Cvarargs%5Bstring%2C%5D" data-language="nim">proc execAffectedRows(db: DbConn; query: SqlQuery; args: varargs[string, `$`]): int64 {...}{.
    tags: [ReadDbEffect, WriteDbEffect], raises: [DbError].}</pre></dt> <dd> <p>Executes the query (typically "UPDATE") and returns the number of affected rows.</p> <p><strong>Examples:</strong></p> <pre class="listing" data-language="nim">let db = open("mytest.db", "", "", "")

# Records of my_table:
# | id | name     |
# |----|----------|
# |  1 | item#1   |
# |  2 | item#2   |

doAssert db.execAffectedRows(sql"UPDATE my_table SET name = 'TEST'") == 2

db.close()</pre> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/impure/db_sqlite.nim#L650" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/impure/db_sqlite.nim#L650" target="_blank">Edit</a> </dd>  <dt><pre id="execAffectedRows%2CDbConn%2CSqlPrepared" data-language="nim">proc execAffectedRows(db: DbConn; stmtName: SqlPrepared): int64 {...}{.
    tags: [ReadDbEffect, WriteDbEffect], raises: [DbError].}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/impure/db_sqlite.nim#L674" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/impure/db_sqlite.nim#L674" target="_blank">Edit</a> </dd>  <dt><pre id="setEncoding%2CDbConn%2Cstring" data-language="nim">proc setEncoding(connection: DbConn; encoding: string): bool {...}{.tags: [DbEffect],
    raises: [DbError].}</pre></dt> <dd> <p>Sets the encoding of a database connection, returns <code>true</code> for success, <code>false</code> for failure.</p> <p><strong>Note:</strong> The encoding cannot be changed once it's been set. According to SQLite3 documentation, any attempt to change the encoding after the database is created will be silently ignored.</p> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/impure/db_sqlite.nim#L714" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/impure/db_sqlite.nim#L714" target="_blank">Edit</a> </dd> </dl>  <h2 id="15">Iterators</h2> <dl>  <dt><pre id="fastRows.i%2CDbConn%2CSqlQuery%2Cvarargs%5Bstring%2C%5D" data-language="nim">iterator fastRows(db: DbConn; query: SqlQuery; args: varargs[string, `$`]): Row {...}{.
    tags: [ReadDbEffect], raises: [DbError, DbError].}</pre></dt> <dd> <p>Executes the query and iterates over the result dataset.</p> <p>This is very fast, but potentially dangerous. Use this iterator only if you require <strong>ALL</strong> the rows.</p> <p><strong>Note:</strong> Breaking the <code>fastRows()</code> iterator during a loop will cause the next database query to raise a <code>DbError</code> exception <code>unable to close due to ...</code>.</p> <p><strong>Examples:</strong></p> <pre class="listing" data-language="nim">let db = open("mytest.db", "", "", "")

# Records of my_table:
# | id | name     |
# |----|----------|
# |  1 | item#1   |
# |  2 | item#2   |

for row in db.fastRows(sql"SELECT id, name FROM my_table"):
  echo row

# Output:
# @["1", "item#1"]
# @["2", "item#2"]

db.close()</pre> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/impure/db_sqlite.nim#L250" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/impure/db_sqlite.nim#L250" target="_blank">Edit</a> </dd>  <dt><pre id="fastRows.i%2CDbConn%2CSqlPrepared" data-language="nim">iterator fastRows(db: DbConn; stmtName: SqlPrepared): Row {...}{.
    tags: [ReadDbEffect, WriteDbEffect], raises: [DbError].}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/impure/db_sqlite.nim#L291" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/impure/db_sqlite.nim#L291" target="_blank">Edit</a> </dd>  <dt><pre id="instantRows.i%2CDbConn%2CSqlQuery%2Cvarargs%5Bstring%2C%5D" data-language="nim">iterator instantRows(db: DbConn; query: SqlQuery; args: varargs[string, `$`]): InstantRow {...}{.
    tags: [ReadDbEffect], raises: [DbError, DbError].}</pre></dt> <dd> <p>Similar to <a href="#fastRows.i,DbConn,SqlQuery,varargs%5Bstring,%5D">fastRows iterator</a> but returns a handle that can be used to get column text on demand using <code>[]</code>. Returned handle is valid only within the iterator body.</p> <p><strong>Examples:</strong></p> <pre class="listing" data-language="nim">let db = open("mytest.db", "", "", "")

# Records of my_table:
# | id | name     |
# |----|----------|
# |  1 | item#1   |
# |  2 | item#2   |

for row in db.instantRows(sql"SELECT * FROM my_table"):
  echo "id:" &amp; row[0]
  echo "name:" &amp; row[1]
  echo "length:" &amp; $len(row)

# Output:
# id:1
# name:item#1
# length:2
# id:2
# name:item#2
# length:2

db.close()</pre> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/impure/db_sqlite.nim#L303" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/impure/db_sqlite.nim#L303" target="_blank">Edit</a> </dd>  <dt><pre id="instantRows.i%2CDbConn%2CSqlPrepared" data-language="nim">iterator instantRows(db: DbConn; stmtName: SqlPrepared): InstantRow {...}{.
    tags: [ReadDbEffect, WriteDbEffect], raises: [DbError].}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/impure/db_sqlite.nim#L343" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/impure/db_sqlite.nim#L343" target="_blank">Edit</a> </dd>  <dt><pre id="instantRows.i%2CDbConn%2CDbColumns%2CSqlQuery%2Cvarargs%5Bstring%2C%5D" data-language="nim">iterator instantRows(db: DbConn; columns: var DbColumns; query: SqlQuery;
                     args: varargs[string, `$`]): InstantRow {...}{.
    tags: [ReadDbEffect], raises: [DbError, DbError].}</pre></dt> <dd> <p>Similar to <a href="#instantRows.i,DbConn,SqlQuery,varargs%5Bstring,%5D">instantRows iterator</a>, but sets information about columns to <code>columns</code>.</p> <p><strong>Examples:</strong></p> <pre class="listing" data-language="nim">let db = open("mytest.db", "", "", "")

# Records of my_table:
# | id | name     |
# |----|----------|
# |  1 | item#1   |
# |  2 | item#2   |

var columns: DbColumns
for row in db.instantRows(columns, sql"SELECT * FROM my_table"):
  discard
echo columns[0]

# Output:
# (name: "id", tableName: "my_table", typ: (kind: dbNull,
# notNull: false, name: "INTEGER", size: 0, maxReprLen: 0, precision: 0,
# scale: 0, min: 0, max: 0, validValues: @[]), primaryKey: false,
# foreignKey: false)

db.close()</pre> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/impure/db_sqlite.nim#L374" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/impure/db_sqlite.nim#L374" target="_blank">Edit</a> </dd>  <dt><pre id="rows.i%2CDbConn%2CSqlQuery%2Cvarargs%5Bstring%2C%5D" data-language="nim">iterator rows(db: DbConn; query: SqlQuery; args: varargs[string, `$`]): Row {...}{.
    tags: [ReadDbEffect], raises: [DbError].}</pre></dt> <dd> <p>Similar to <a href="#fastRows.i,DbConn,SqlQuery,varargs%5Bstring,%5D">fastRows iterator</a>, but slower and safe.</p> <p><strong>Examples:</strong></p> <pre class="listing" data-language="nim">let db = open("mytest.db", "", "", "")

# Records of my_table:
# | id | name     |
# |----|----------|
# |  1 | item#1   |
# |  2 | item#2   |

for row in db.rows(sql"SELECT id, name FROM my_table"):
  echo row

## Output:
## @["1", "item#1"]
## @["2", "item#2"]

db.close()</pre> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/impure/db_sqlite.nim#L500" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/impure/db_sqlite.nim#L500" target="_blank">Edit</a> </dd>  <dt><pre id="rows.i%2CDbConn%2CSqlPrepared" data-language="nim">iterator rows(db: DbConn; stmtName: SqlPrepared): Row {...}{.
    tags: [ReadDbEffect, WriteDbEffect], raises: [DbError].}</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/impure/db_sqlite.nim#L527" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/impure/db_sqlite.nim#L527" target="_blank">Edit</a> </dd> </dl>  <h2 id="17">Macros</h2> <dl>  <dt><pre id="bindParams.m%2CSqlPrepared%2Cvarargs%5Buntyped%5D" data-language="nim">macro bindParams(ps: SqlPrepared; params: varargs[untyped]): untyped</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/impure/db_sqlite.nim#L777" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/impure/db_sqlite.nim#L777" target="_blank">Edit</a> </dd> </dl>  <h2 id="18">Templates</h2> <dl>  <dt><pre id="dbBindParamError.t%2Cint%2Cvarargs%5Buntyped%5D" data-language="nim">template dbBindParamError(paramIdx: int; val: varargs[untyped])</pre></dt> <dd> Raises a <code>DbError</code> exception. <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/impure/db_sqlite.nim#L729" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/impure/db_sqlite.nim#L729" target="_blank">Edit</a> </dd>  <dt><pre id="exec.t%2CDbConn%2CSqlPrepared%2Cvarargs%5Btyped%5D" data-language="nim">template exec(db: DbConn; stmtName: SqlPrepared; args: varargs[typed]): untyped</pre></dt> <dd> <a href="https://github.com/nim-lang/Nim/tree/version-1-4/lib/impure/db_sqlite.nim#L793" target="_blank">Source</a> <a href="https://github.com/nim-lang/Nim/edit/devel/lib/impure/db_sqlite.nim#L793" target="_blank">Edit</a> </dd> </dl>  <h2 id="19">Exports</h2> <dl> <a href="db_common.html#DbTypeKind"><span class="Identifier">DbTypeKind</span></a>, <a href="db_common.html#sql.t,string"><span class="Identifier">sql</span></a>, <a href="db_common.html#DbType"><span class="Identifier">DbType</span></a>, <a href="db_common.html#SqlQuery"><span class="Identifier">SqlQuery</span></a>, <a href="db_common.html#DbColumn"><span class="Identifier">DbColumn</span></a>, <a href="db_common.html#ReadDbEffect"><span class="Identifier">ReadDbEffect</span></a>, <a href="db_common.html#DbError"><span class="Identifier">DbError</span></a>, <a href="db_common.html#WriteDbEffect"><span class="Identifier">WriteDbEffect</span></a>, <a href="db_common.html#dbError,string"><span class="Identifier">dbError</span></a>, <a href="db_common.html#DbColumns"><span class="Identifier">DbColumns</span></a>, <a href="db_common.html#DbEffect"><span class="Identifier">DbEffect</span></a> </dl><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2006&ndash;2021 Andreas Rumpf<br>Licensed under the MIT License.<br>
    <a href="https://nim-lang.org/docs/db_sqlite.html" class="_attribution-link">https://nim-lang.org/docs/db_sqlite.html</a>
  </p>
</div>
