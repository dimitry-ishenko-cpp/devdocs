<h1 id="class-Exception" class="anchor-link class"> class Exception </h1>
<dl class="meta">
<dt>Parent:</dt>
<dd class="meta-parent"><a href="object.html">Object</a></dd>
</dl> <section class="description"> <p>Class <a href="exception.html"><code>Exception</code></a> and its subclasses are used to indicate that an error or other problem has occurred, and may need to be handled. See <span>Exceptions</span>.</p> <p>An <a href="exception.html"><code>Exception</code></a> object carries certain information:</p> <ul>
<li> <p>The type (the exception’s class), commonly <a href="standarderror.html"><code>StandardError</code></a>, <a href="runtimeerror.html"><code>RuntimeError</code></a>, or a subclass of one or the other; see <a href="exception.html#class-Exception-label-Built-In+Exception+Class+Hierarchy">Built-In Exception Class Hierarchy</a>.</p> </li>
<li> <p>An optional descriptive message; see methods <a href="exception.html#method-c-new"><code>::new</code></a>, <a href="exception.html#method-i-message"><code>message</code></a>.</p> </li>
<li> <p>Optional backtrace information; see methods <a href="exception.html#method-i-backtrace"><code>backtrace</code></a>, <a href="exception.html#method-i-backtrace_locations"><code>backtrace_locations</code></a>, <a href="exception.html#method-i-set_backtrace"><code>set_backtrace</code></a>.</p> </li>
<li> <p>An optional cause; see method <a href="exception.html#method-i-cause"><code>cause</code></a>.</p> </li>
</ul> <h2 id="class-Exception-label-Built-In+Exception+Class+Hierarchy">Built-In Exception Class Hierarchy</h2> <p>The hierarchy of built-in subclasses of class <a href="exception.html"><code>Exception</code></a>:</p> <ul>
<li> <p><a href="nomemoryerror.html"><code>NoMemoryError</code></a></p> </li>
<li> <p><a href="scripterror.html"><code>ScriptError</code></a></p> <ul>
<li> <p><a href="loaderror.html"><code>LoadError</code></a></p> </li>
<li> <p><a href="notimplementederror.html"><code>NotImplementedError</code></a></p> </li>
<li> <p><a href="syntaxerror.html"><code>SyntaxError</code></a></p> </li>
</ul> </li>
<li> <p><a href="securityerror.html"><code>SecurityError</code></a></p> </li>
<li> <p><a href="signalexception.html"><code>SignalException</code></a></p> <ul><li> <p><a href="interrupt.html"><code>Interrupt</code></a></p> </li></ul> </li>
<li> <p><a href="standarderror.html"><code>StandardError</code></a></p> <ul>
<li> <p><a href="argumenterror.html"><code>ArgumentError</code></a></p> <ul><li> <p><a href="uncaughtthrowerror.html"><code>UncaughtThrowError</code></a></p> </li></ul> </li>
<li> <p><a href="encodingerror.html"><code>EncodingError</code></a></p> </li>
<li> <p><a href="fibererror.html"><code>FiberError</code></a></p> </li>
<li> <p><a href="ioerror.html"><code>IOError</code></a></p> <ul><li> <p><a href="eoferror.html"><code>EOFError</code></a></p> </li></ul> </li>
<li> <p><a href="indexerror.html"><code>IndexError</code></a></p> <ul>
<li> <p><a href="keyerror.html"><code>KeyError</code></a></p> </li>
<li> <p><a href="stopiteration.html"><code>StopIteration</code></a></p> <ul><li> <p><a href="closedqueueerror.html"><code>ClosedQueueError</code></a></p> </li></ul> </li>
</ul> </li>
<li> <p><a href="localjumperror.html"><code>LocalJumpError</code></a></p> </li>
<li> <p><a href="nameerror.html"><code>NameError</code></a></p> <ul><li> <p><a href="nomethoderror.html"><code>NoMethodError</code></a></p> </li></ul> </li>
<li> <p><a href="rangeerror.html"><code>RangeError</code></a></p> <ul><li> <p><a href="floatdomainerror.html"><code>FloatDomainError</code></a></p> </li></ul> </li>
<li> <p><a href="regexperror.html"><code>RegexpError</code></a></p> </li>
<li> <p><a href="runtimeerror.html"><code>RuntimeError</code></a></p> <ul><li> <p><a href="frozenerror.html"><code>FrozenError</code></a></p> </li></ul> </li>
<li> <p><a href="systemcallerror.html"><code>SystemCallError</code></a></p> <ul><li> <p><a href="errno.html"><code>Errno</code></a> (and its subclasses, representing system errors)</p> </li></ul> </li>
<li> <p><a href="threaderror.html"><code>ThreadError</code></a></p> </li>
<li> <p><a href="typeerror.html"><code>TypeError</code></a></p> </li>
<li> <p><a href="zerodivisionerror.html"><code>ZeroDivisionError</code></a></p> </li>
</ul> </li>
<li> <p><a href="systemexit.html"><code>SystemExit</code></a></p> </li>
<li> <p><a href="systemstackerror.html"><code>SystemStackError</code></a></p> </li>
<li> <p><a href="fatal.html"><code>fatal</code></a></p> </li>
</ul> </section> <section id="5Buntitled-5D" class="documentation-section anchor-link"> <section id="public-class-5Buntitled-5D-method-details" class="method-section anchor-link"> <header> <h3>Public Class Methods</h3> </header> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-c-exception"> <a href="#method-c-exception" title="Link to this method"> <span class="method-callseq"> exception(message = nil) → self or new_exception </span> </a> </div> </div> <div class="method-description"> <p>Returns an exception object of the same class as <code>self</code>; useful for creating a similar exception, but with a different message.</p> <p>With <code>message</code> <code>nil</code>, returns <code>self</code>:</p> <pre class="ruby" data-language="ruby">x0 = StandardError.new('Boom') # =&gt; #&lt;StandardError: Boom&gt;
x1 = x0.exception              # =&gt; #&lt;StandardError: Boom&gt;
x0.__id__ == x1.__id__         # =&gt; true
</pre> <p>With <a href="implicit_conversion_rdoc.html#label-String-Convertible+Objects">string-convertible object</a> <code>message</code> (even the same as the original message), returns a new exception object whose class is the same as <code>self</code>, and whose message is the given <code>message</code>:</p> <pre class="ruby" data-language="ruby">x1 = x0.exception('Boom') # =&gt; #&lt;StandardError: Boom&gt;
x0..equal?(x1)            # =&gt; false
</pre> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-c-json_create"> <a href="#method-c-json_create" title="Link to this method"> <span class="method-name">json_create</span> <span class="method-args">(object)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="json_create-source"> <pre class="ruby" data-language="ruby"># File ext/json/lib/json/add/exception.rb, line 9
def self.json_create(object)
  result = new(object['m'])
  result.set_backtrace object['b']
  result
end</pre> </div>  <p>See <a href="exception.html#method-i-as_json"><code>as_json</code></a>.</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-c-new"> <a href="#method-c-new" title="Link to this method"> <span class="method-callseq"> new(message = nil) → exception </span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="new-source"> <pre class="c" data-language="c">static VALUE
exc_initialize(int argc, VALUE *argv, VALUE exc)
{
    VALUE arg;

    arg = (!rb_check_arity(argc, 0, 1) ? Qnil : argv[0]);
    return exc_init(exc, arg);
}</pre> </div>  <p>Returns a new exception object.</p> <p>The given <code>message</code> should be a <a href="implicit_conversion_rdoc.html#label-String-Convertible+Objects">string-convertible object</a>; see method <a href="exception.html#method-i-message"><code>message</code></a>; if not given, the message is the class name of the new instance (which may be the name of a subclass):</p> <p>Examples:</p> <pre class="ruby" data-language="ruby">Exception.new         # =&gt; #&lt;Exception: Exception&gt;
LoadError.new         # =&gt; #&lt;LoadError: LoadError&gt; # Subclass of Exception.
Exception.new('Boom') # =&gt; #&lt;Exception: Boom&gt;
</pre> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-c-to_tty-3F"> <a href="#method-c-to_tty-3F" title="Link to this method"> <span class="method-callseq"> to_tty? → true or false </span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="to_tty-3F-source"> <pre class="c" data-language="c">static VALUE
exc_s_to_tty_p(VALUE self)
{
    return RBOOL(rb_stderr_tty_p());
}</pre> </div>  <p>Returns <code>true</code> if exception messages will be sent to a terminal device.</p> </div> </div> </section> <section id="public-instance-5Buntitled-5D-method-details" class="method-section anchor-link"> <header> <h3>Public Instance Methods</h3> </header> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-3D-3D"> <a href="#method-i-3D-3D" title="Link to this method"> <span class="method-callseq"> self == object → true or false </span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="3D-3D-source"> <pre class="c" data-language="c">static VALUE
exc_equal(VALUE exc, VALUE obj)
{
    VALUE mesg, backtrace;

    if (exc == obj) return Qtrue;

    if (rb_obj_class(exc) != rb_obj_class(obj)) {
        int state;

        obj = rb_protect(try_convert_to_exception, obj, &amp;state);
        if (state || UNDEF_P(obj)) {
            rb_set_errinfo(Qnil);
            return Qfalse;
        }
        if (rb_obj_class(exc) != rb_obj_class(obj)) return Qfalse;
        mesg = rb_check_funcall(obj, id_message, 0, 0);
        if (UNDEF_P(mesg)) return Qfalse;
        backtrace = rb_check_funcall(obj, id_backtrace, 0, 0);
        if (UNDEF_P(backtrace)) return Qfalse;
    }
    else {
        mesg = rb_attr_get(obj, id_mesg);
        backtrace = exc_backtrace(obj);
    }

    if (!rb_equal(rb_attr_get(exc, id_mesg), mesg))
        return Qfalse;
    return rb_equal(exc_backtrace(exc), backtrace);
}</pre> </div>  <p>Returns whether <code>object</code> is the same class as <code>self</code> and its <a href="exception.html#method-i-message"><code>message</code></a> and <a href="exception.html#method-i-backtrace"><code>backtrace</code></a> are equal to those of <code>self</code>.</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-as_json"> <a href="#method-i-as_json" title="Link to this method"> <span class="method-name">as_json</span> <span class="method-args">(*)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="as_json-source"> <pre class="ruby" data-language="ruby"># File ext/json/lib/json/add/exception.rb, line 29
def as_json(*)
  {
    JSON.create_id =&gt; self.class.name,
    'm'            =&gt; message,
    'b'            =&gt; backtrace,
  }
end</pre> </div>  <p>Methods <a href="exception.html#method-i-as_json"><code>Exception#as_json</code></a> and <a href="exception.html#method-c-json_create"><code>Exception.json_create</code></a> may be used to serialize and deserialize a Exception object; see <a href="marshal.html"><code>Marshal</code></a>.</p> <p>Method <a href="exception.html#method-i-as_json"><code>Exception#as_json</code></a> serializes <code>self</code>, returning a 2-element hash representing <code>self</code>:</p> <pre class="ruby" data-language="ruby">require 'json/add/exception'
x = Exception.new('Foo').as_json # =&gt; {"json_class"=&gt;"Exception", "m"=&gt;"Foo", "b"=&gt;nil}
</pre> <p>Method <code>JSON.create</code> deserializes such a hash, returning a Exception object:</p> <pre class="ruby" data-language="ruby">Exception.json_create(x) # =&gt; #&lt;Exception: Foo&gt;
</pre> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-backtrace"> <a href="#method-i-backtrace" title="Link to this method"> <span class="method-callseq"> backtrace → array or nil </span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="backtrace-source"> <pre class="c" data-language="c">static VALUE
exc_backtrace(VALUE exc)
{
    VALUE obj;

    obj = rb_attr_get(exc, id_bt);

    if (rb_backtrace_p(obj)) {
        obj = rb_backtrace_to_str_ary(obj);
        /* rb_ivar_set(exc, id_bt, obj); */
    }

    return obj;
}</pre> </div>  <p>Returns the backtrace (the list of code locations that led to the exception), as an array of strings.</p> <p>Example (assuming the code is stored in the file named <code>t.rb</code>):</p> <pre class="ruby" data-language="ruby">def division(numerator, denominator)
  numerator / denominator
end

begin
  division(1, 0)
rescue =&gt; ex
  p ex.backtrace
  # ["t.rb:2:in 'Integer#/'", "t.rb:2:in 'Object#division'", "t.rb:6:in '&lt;main&gt;'"]
  loc = ex.backtrace.first
  p loc.class
  # String
end
</pre> <p>The value returned by this method migth be adjusted when raising (see <a href="kernel.html#method-i-raise"><code>Kernel#raise</code></a>), or during intermediate handling by <a href="exception.html#method-i-set_backtrace"><code>set_backtrace</code></a>.</p> <p>See also <a href="exception.html#method-i-backtrace_locations"><code>backtrace_locations</code></a> that provide the same value, as structured objects. (Note though that two values might not be consistent with each other when backtraces are manually adjusted.)</p> <p>see <span>Backtraces</span>.</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-backtrace_locations"> <a href="#method-i-backtrace_locations" title="Link to this method"> <span class="method-callseq"> backtrace_locations → array or nil </span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="backtrace_locations-source"> <pre class="c" data-language="c">static VALUE
exc_backtrace_locations(VALUE exc)
{
    VALUE obj;

    obj = rb_attr_get(exc, id_bt_locations);
    if (!NIL_P(obj)) {
        obj = rb_backtrace_to_location_ary(obj);
    }
    return obj;
}</pre> </div>  <p>Returns the backtrace (the list of code locations that led to the exception), as an array of <a href="thread/backtrace/location.html"><code>Thread::Backtrace::Location</code></a> instances.</p> <p>Example (assuming the code is stored in the file named <code>t.rb</code>):</p> <pre class="ruby" data-language="ruby">def division(numerator, denominator)
  numerator / denominator
end

begin
  division(1, 0)
rescue =&gt; ex
  p ex.backtrace_locations
  # ["t.rb:2:in 'Integer#/'", "t.rb:2:in 'Object#division'", "t.rb:6:in '&lt;main&gt;'"]
  loc = ex.backtrace_locations.first
  p loc.class
  # Thread::Backtrace::Location
  p loc.path
  # "t.rb"
  p loc.lineno
  # 2
  p loc.label
  # "Integer#/"
end
</pre> <p>The value returned by this method might be adjusted when raising (see <a href="kernel.html#method-i-raise"><code>Kernel#raise</code></a>), or during intermediate handling by <a href="exception.html#method-i-set_backtrace"><code>set_backtrace</code></a>.</p> <p>See also <a href="exception.html#method-i-backtrace"><code>backtrace</code></a> that provide the same value as an array of strings. (Note though that two values might not be consistent with each other when backtraces are manually adjusted.)</p> <p>See <span>Backtraces</span>.</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-cause"> <a href="#method-i-cause" title="Link to this method"> <span class="method-callseq"> cause → exception or nil </span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="cause-source"> <pre class="c" data-language="c">static VALUE
exc_cause(VALUE exc)
{
    return rb_attr_get(exc, id_cause);
}</pre> </div>  <p>Returns the previous value of global variable <code>$!</code>, which may be <code>nil</code> (see <span>Global Variables</span>):</p> <pre class="ruby" data-language="ruby">begin
  raise('Boom 0')
rescue =&gt; x0
  puts "Exception: #{x0};  $!: #{$!};  cause: #{x0.cause.inspect}."
  begin
    raise('Boom 1')
  rescue =&gt; x1
    puts "Exception: #{x1};  $!: #{$!};  cause: #{x1.cause}."
    begin
      raise('Boom 2')
    rescue =&gt; x2
      puts "Exception: #{x2};  $!: #{$!};  cause: #{x2.cause}."
    end
  end
end
</pre> <p>Output:</p> <pre>Exception: Boom 0;  $!: Boom 0;  cause: nil.
Exception: Boom 1;  $!: Boom 1;  cause: Boom 0.
Exception: Boom 2;  $!: Boom 2;  cause: Boom 1.</pre> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-detailed_message"> <a href="#method-i-detailed_message" title="Link to this method"> <span class="method-callseq"> detailed_message(highlight: false, **kwargs) → string </span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="detailed_message-source"> <pre class="c" data-language="c">static VALUE
exc_detailed_message(int argc, VALUE *argv, VALUE exc)
{
    VALUE opt;

    rb_scan_args(argc, argv, "0:", &amp;opt);

    VALUE highlight = check_highlight_keyword(opt, 0);

    extern VALUE rb_decorate_message(const VALUE eclass, VALUE emesg, int highlight);

    return rb_decorate_message(CLASS_OF(exc), rb_get_message(exc), RTEST(highlight));
}</pre> </div>  <p>Returns the message string with enhancements:</p> <ul>
<li> <p>Includes the exception class name in the first line.</p> </li>
<li> <p>If the value of keyword <code>highlight</code> is <code>true</code>, includes bolding and underlining ANSI codes (see below) to enhance the appearance of the message.</p> </li>
</ul> <p>Examples:</p> <pre class="ruby" data-language="ruby">begin
  1 / 0
rescue =&gt; x
  p x.message
  p x.detailed_message                  # Class name added.
  p x.detailed_message(highlight: true) # Class name, bolding, and underlining added.
end
</pre> <p>Output:</p> <pre class="ruby" data-language="ruby">"divided by 0"
"divided by 0 (ZeroDivisionError)"
"\e[1mdivided by 0 (\e[1;4mZeroDivisionError\e[m\e[1m)\e[m"
</pre> <p>This method is overridden by some gems in the Ruby standard library to add information:</p> <ul>
<li> <p><a href="didyoumean/correctable.html#method-i-detailed_message"><code>DidYouMean::Correctable#detailed_message</code></a>.</p> </li>
<li> <p><a href="errorhighlight/coreext.html#method-i-detailed_message"><code>ErrorHighlight::CoreExt#detailed_message</code></a>.</p> </li>
<li> <p><a href="syntaxsuggest.html#method-i-detailed_message"><code>SyntaxSuggest#detailed_message</code></a>.</p> </li>
</ul> <p>An overriding method must be tolerant of passed keyword arguments, which may include (but may not be limited to):</p> <ul>
<li> <p><code>:highlight</code>.</p> </li>
<li> <p><code>:did_you_mean</code>.</p> </li>
<li> <p><code>:error_highlight</code>.</p> </li>
<li> <p><code>:syntax_suggest</code>.</p> </li>
</ul> <p>An overriding method should also be careful with ANSI code enhancements; see <span>Messages</span>.</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-exception"> <a href="#method-i-exception" title="Link to this method"> <span class="method-callseq"> exception(message = nil) → self or new_exception </span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="exception-source"> <pre class="c" data-language="c">static VALUE
exc_exception(int argc, VALUE *argv, VALUE self)
{
    VALUE exc;

    argc = rb_check_arity(argc, 0, 1);
    if (argc == 0) return self;
    if (argc == 1 &amp;&amp; self == argv[0]) return self;
    exc = rb_obj_clone(self);
    rb_ivar_set(exc, id_mesg, argv[0]);
    return exc;
}</pre> </div>  <p>Returns an exception object of the same class as <code>self</code>; useful for creating a similar exception, but with a different message.</p> <p>With <code>message</code> <code>nil</code>, returns <code>self</code>:</p> <pre class="ruby" data-language="ruby">x0 = StandardError.new('Boom') # =&gt; #&lt;StandardError: Boom&gt;
x1 = x0.exception              # =&gt; #&lt;StandardError: Boom&gt;
x0.__id__ == x1.__id__         # =&gt; true
</pre> <p>With <a href="implicit_conversion_rdoc.html#label-String-Convertible+Objects">string-convertible object</a> <code>message</code> (even the same as the original message), returns a new exception object whose class is the same as <code>self</code>, and whose message is the given <code>message</code>:</p> <pre class="ruby" data-language="ruby">x1 = x0.exception('Boom') # =&gt; #&lt;StandardError: Boom&gt;
x0..equal?(x1)            # =&gt; false
</pre> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-full_message"> <a href="#method-i-full_message" title="Link to this method"> <span class="method-callseq"> full_message(highlight: true, order: :top) → string </span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="full_message-source"> <pre class="c" data-language="c">static VALUE
exc_full_message(int argc, VALUE *argv, VALUE exc)
{
    VALUE opt, str, emesg, errat;
    VALUE highlight, order;

    rb_scan_args(argc, argv, "0:", &amp;opt);

    highlight = check_highlight_keyword(opt, 1);
    order = check_order_keyword(opt);

    {
        if (NIL_P(opt)) opt = rb_hash_new();
        rb_hash_aset(opt, sym_highlight, highlight);
    }

    str = rb_str_new2("");
    errat = rb_get_backtrace(exc);
    emesg = rb_get_detailed_message(exc, opt);

    rb_error_write(exc, emesg, errat, str, opt, highlight, order);
    return str;
}</pre> </div>  <p>Returns an enhanced message string:</p> <ul>
<li> <p>Includes the exception class name.</p> </li>
<li> <p>If the value of keyword <code>highlight</code> is true (not <code>nil</code> or <code>false</code>), includes bolding ANSI codes (see below) to enhance the appearance of the message.</p> </li>
<li> <p>Includes the <span>backtrace</span>:</p> <ul>
<li> <p>If the value of keyword <code>order</code> is <code>:top</code> (the default), lists the error message and the innermost backtrace entry first.</p> </li>
<li> <p>If the value of keyword <code>order</code> is <code>:bottom</code>, lists the error message the the innermost entry last.</p> </li>
</ul> </li>
</ul> <p>Example:</p> <pre class="ruby" data-language="ruby">def baz
  begin
    1 / 0
  rescue =&gt; x
    pp x.message
    pp x.full_message(highlight: false).split("\n")
    pp x.full_message.split("\n")
  end
end
def bar; baz; end
def foo; bar; end
foo
</pre> <p>Output:</p> <pre class="ruby" data-language="ruby">"divided by 0"
["t.rb:3:in 'Integer#/': divided by 0 (ZeroDivisionError)",
 "\tfrom t.rb:3:in 'Object#baz'",
 "\tfrom t.rb:10:in 'Object#bar'",
 "\tfrom t.rb:11:in 'Object#foo'",
 "\tfrom t.rb:12:in '&lt;main&gt;'"]
["t.rb:3:in 'Integer#/': \e[1mdivided by 0 (\e[1;4mZeroDivisionError\e[m\e[1m)\e[m",
 "\tfrom t.rb:3:in 'Object#baz'",
 "\tfrom t.rb:10:in 'Object#bar'",
 "\tfrom t.rb:11:in 'Object#foo'",
 "\tfrom t.rb:12:in '&lt;main&gt;'"]
</pre> <p>An overriding method should be careful with ANSI code enhancements; see <span>Messages</span>.</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-inspect"> <a href="#method-i-inspect" title="Link to this method"> <span class="method-callseq"> inspect → string </span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="inspect-source"> <pre class="c" data-language="c">static VALUE
exc_inspect(VALUE exc)
{
    VALUE str, klass;

    klass = CLASS_OF(exc);
    exc = rb_obj_as_string(exc);
    if (RSTRING_LEN(exc) == 0) {
        return rb_class_name(klass);
    }

    str = rb_str_buf_new2("#&lt;");
    klass = rb_class_name(klass);
    rb_str_buf_append(str, klass);

    if (RTEST(rb_str_include(exc, rb_str_new2("\n")))) {
        rb_str_catf(str, ":%+"PRIsVALUE, exc);
    }
    else {
        rb_str_buf_cat(str, ": ", 2);
        rb_str_buf_append(str, exc);
    }

    rb_str_buf_cat(str, "&gt;", 1);

    return str;
}</pre> </div>  <p>Returns a string representation of <code>self</code>:</p> <pre class="ruby" data-language="ruby">x = RuntimeError.new('Boom')
x.inspect # =&gt; "#&lt;RuntimeError: Boom&gt;"
x = RuntimeError.new
x.inspect # =&gt; "#&lt;RuntimeError: RuntimeError&gt;"
</pre> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-message"> <a href="#method-i-message" title="Link to this method"> <span class="method-callseq"> message → string </span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="message-source"> <pre class="c" data-language="c">static VALUE
exc_message(VALUE exc)
{
    return rb_funcallv(exc, idTo_s, 0, 0);
}</pre> </div>  <p>Returns <a href="exception.html#method-i-to_s"><code>to_s</code></a>.</p> <p>See <span>Messages</span>.</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-set_backtrace"> <a href="#method-i-set_backtrace" title="Link to this method"> <span class="method-callseq"> set_backtrace(value) → value </span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="set_backtrace-source"> <pre class="c" data-language="c">static VALUE
exc_set_backtrace(VALUE exc, VALUE bt)
{
    VALUE btobj = rb_location_ary_to_backtrace(bt);
    if (RTEST(btobj)) {
        rb_ivar_set(exc, id_bt, btobj);
        rb_ivar_set(exc, id_bt_locations, btobj);
        return bt;
    }
    else {
        return rb_ivar_set(exc, id_bt, rb_check_backtrace(bt));
    }
}</pre> </div>  <p>Sets the backtrace value for <code>self</code>; returns the given <code>value</code>.</p> <p>The <code>value</code> might be:</p> <ul>
<li> <p>an array of <a href="thread/backtrace/location.html"><code>Thread::Backtrace::Location</code></a>;</p> </li>
<li> <p>an array of <a href="string.html"><code>String</code></a> instances;</p> </li>
<li> <p>a single <a href="string.html"><code>String</code></a> instance; or</p> </li>
<li> <p><code>nil</code>.</p> </li>
</ul> <p>Using array of <a href="thread/backtrace/location.html"><code>Thread::Backtrace::Location</code></a> is the most consistent option: it sets both <a href="exception.html#method-i-backtrace"><code>backtrace</code></a> and <a href="exception.html#method-i-backtrace_locations"><code>backtrace_locations</code></a>. It should be preferred when possible. The suitable array of locations can be obtained from <a href="kernel.html#method-i-caller_locations"><code>Kernel#caller_locations</code></a>, copied from another error, or just set to the adjusted result of the current error’s <a href="exception.html#method-i-backtrace_locations"><code>backtrace_locations</code></a>:</p> <pre class="ruby" data-language="ruby">require 'json'

def parse_payload(text)
  JSON.parse(text)  # test.rb, line 4
rescue JSON::ParserError =&gt; ex
  ex.set_backtrace(ex.backtrace_locations[2...])
  raise
end

parse_payload('{"wrong: "json"')
# test.rb:4:in 'Object#parse_payload': unexpected token at '{"wrong: "json"' (JSON::ParserError)
#
# An error points to the body of parse_payload method,
# hiding the parts of the backtrace related to the internals
# of the "json" library

# The error has both #backtace and #backtrace_locations set
# consistently:
begin
  parse_payload('{"wrong: "json"')
rescue =&gt; ex
  p ex.backtrace
  # ["test.rb:4:in 'Object#parse_payload'", "test.rb:20:in '&lt;main&gt;'"]
  p ex.backtrace_locations
  # ["test.rb:4:in 'Object#parse_payload'", "test.rb:20:in '&lt;main&gt;'"]
end
</pre> <p>When the desired stack of locations is not available and should be constructed from scratch, an array of strings or a singular string can be used. In this case, only <a href="exception.html#method-i-backtrace"><code>backtrace</code></a> is affected:</p> <pre class="ruby" data-language="ruby">def parse_payload(text)
  JSON.parse(text)
rescue JSON::ParserError =&gt; ex
  ex.set_backtrace(["dsl.rb:34", "framework.rb:1"])
  # The error have the new value in #backtrace:
  p ex.backtrace
  # ["dsl.rb:34", "framework.rb:1"]

  # but the original one in #backtrace_locations
  p ex.backtrace_locations
  # [".../json/common.rb:221:in 'JSON::Ext::Parser.parse'", ...]
end

parse_payload('{"wrong: "json"')
</pre> <p>Calling <a href="exception.html#method-i-set_backtrace"><code>set_backtrace</code></a> with <code>nil</code> clears up <a href="exception.html#method-i-backtrace"><code>backtrace</code></a> but doesn’t affect <a href="exception.html#method-i-backtrace_locations"><code>backtrace_locations</code></a>:</p> <pre class="ruby" data-language="ruby">def parse_payload(text)
  JSON.parse(text)
rescue JSON::ParserError =&gt; ex
  ex.set_backtrace(nil)
  p ex.backtrace
  # nil
  p ex.backtrace_locations
  # [".../json/common.rb:221:in 'JSON::Ext::Parser.parse'", ...]
end

parse_payload('{"wrong: "json"')
</pre> <p>On reraising of such an exception, both <a href="exception.html#method-i-backtrace"><code>backtrace</code></a> and <a href="exception.html#method-i-backtrace_locations"><code>backtrace_locations</code></a> is set to the place of reraising:</p> <pre class="ruby" data-language="ruby">def parse_payload(text)
  JSON.parse(text)
rescue JSON::ParserError =&gt; ex
  ex.set_backtrace(nil)
  raise # test.rb, line 7
end

begin
  parse_payload('{"wrong: "json"')
rescue =&gt; ex
  p ex.backtrace
  # ["test.rb:7:in 'Object#parse_payload'", "test.rb:11:in '&lt;main&gt;'"]
  p ex.backtrace_locations
  # ["test.rb:7:in 'Object#parse_payload'", "test.rb:11:in '&lt;main&gt;'"]
end
</pre> <p>See <span>Backtraces</span>.</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-to_json"> <a href="#method-i-to_json" title="Link to this method"> <span class="method-name">to_json</span> <span class="method-args">(*args)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="to_json-source"> <pre class="ruby" data-language="ruby"># File ext/json/lib/json/add/exception.rb, line 46
def to_json(*args)
  as_json.to_json(*args)
end</pre> </div>  <p>Returns a <a href="json.html"><code>JSON</code></a> string representing <code>self</code>:</p> <pre class="ruby" data-language="ruby">require 'json/add/exception'
puts Exception.new('Foo').to_json
</pre> <p>Output:</p> <pre class="ruby" data-language="ruby">{"json_class":"Exception","m":"Foo","b":null}
</pre> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-to_s"> <a href="#method-i-to_s" title="Link to this method"> <span class="method-callseq"> to_s → string </span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="to_s-source"> <pre class="c" data-language="c">static VALUE
exc_to_s(VALUE exc)
{
    VALUE mesg = rb_attr_get(exc, idMesg);

    if (NIL_P(mesg)) return rb_class_name(CLASS_OF(exc));
    return rb_String(mesg);
}</pre> </div>  <p>Returns a string representation of <code>self</code>:</p> <pre class="ruby" data-language="ruby">x = RuntimeError.new('Boom')
x.to_s # =&gt; "Boom"
x = RuntimeError.new
x.to_s # =&gt; "RuntimeError"
</pre> </div> </div> </section> </section><div class="_attribution">
  <p class="_attribution-p">
    Ruby Core &copy; 1993&ndash;2024 Yukihiro Matsumoto<br>Licensed under the Ruby License.<br>Ruby Standard Library &copy; contributors<br>Licensed under their own licenses.<br>
    
  </p>
</div>
