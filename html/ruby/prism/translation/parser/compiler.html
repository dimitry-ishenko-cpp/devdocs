<h1 id="class-Prism::Translation::Parser::Compiler" class="anchor-link class"> class Prism::Translation::Parser::Compiler </h1>
<dl class="meta">
<dt>Parent:</dt>
<dd class="meta-parent"><a href="../../compiler.html">Prism::Compiler</a></dd>
</dl> <section class="description"> <p>A visitor that knows how to convert a prism syntax tree into the whitequark/parser gem’s syntax tree.</p> </section> <section id="5Buntitled-5D" class="documentation-section anchor-link"> <section class="constants-list"> <header> <h3>Constants</h3> </header> <dl> <dt id="Range">Range </dt>
<dd> <p>Locations in the parser gem AST are generated using this class. We store a reference to its constant to make it slightly faster to look up.</p> </dd>
</dl> </section> <section class="attribute-method-details"> <header> <h3>Attributes</h3> </header> <div class="method-detail anchor-link"> <div class="method-heading attribute-method-heading" id="attribute-i-builder"> <a href="#attribute-i-builder" title="Link to this attribute"> <span class="method-name">builder</span> <span class="attribute-access-type">[R]</span> </a> </div> <div class="method-description"> <p>The Parser::Builders::Default instance that is being used to build the AST.</p> </div> </div> <div class="method-detail anchor-link"> <div class="method-heading attribute-method-heading" id="attribute-i-forwarding"> <a href="#attribute-i-forwarding" title="Link to this attribute"> <span class="method-name">forwarding</span> <span class="attribute-access-type">[R]</span> </a> </div> <div class="method-description"> <p>The types of values that can be forwarded in the current scope.</p> </div> </div> <div class="method-detail anchor-link"> <div class="method-heading attribute-method-heading" id="attribute-i-in_destructure"> <a href="#attribute-i-in_destructure" title="Link to this attribute"> <span class="method-name">in_destructure</span> <span class="attribute-access-type">[R]</span> </a> </div> <div class="method-description"> <p>Whether or not the current node is in a destructure.</p> </div> </div> <div class="method-detail anchor-link"> <div class="method-heading attribute-method-heading" id="attribute-i-in_pattern"> <a href="#attribute-i-in_pattern" title="Link to this attribute"> <span class="method-name">in_pattern</span> <span class="attribute-access-type">[R]</span> </a> </div> <div class="method-description"> <p>Whether or not the current node is in a pattern.</p> </div> </div> <div class="method-detail anchor-link"> <div class="method-heading attribute-method-heading" id="attribute-i-offset_cache"> <a href="#attribute-i-offset_cache" title="Link to this attribute"> <span class="method-name">offset_cache</span> <span class="attribute-access-type">[R]</span> </a> </div> <div class="method-description"> <p>The offset cache that is used to map between byte and character offsets in the file.</p> </div> </div> <div class="method-detail anchor-link"> <div class="method-heading attribute-method-heading" id="attribute-i-parser"> <a href="#attribute-i-parser" title="Link to this attribute"> <span class="method-name">parser</span> <span class="attribute-access-type">[R]</span> </a> </div> <div class="method-description"> <p>The Parser::Base instance that is being used to build the AST.</p> </div> </div> <div class="method-detail anchor-link"> <div class="method-heading attribute-method-heading" id="attribute-i-source_buffer"> <a href="#attribute-i-source_buffer" title="Link to this attribute"> <span class="method-name">source_buffer</span> <span class="attribute-access-type">[R]</span> </a> </div> <div class="method-description"> <p>The Parser::Source::Buffer instance that is holding a reference to the source code.</p> </div> </div> </section> <section id="public-class-5Buntitled-5D-method-details" class="method-section anchor-link"> <header> <h3>Public Class Methods</h3> </header> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-c-new"> <a href="#method-c-new" title="Link to this method"> <span class="method-name">new</span> <span class="method-args">(parser, offset_cache, forwarding: [], in_destructure: false, in_pattern: false)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="new-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 39
def initialize(parser, offset_cache, forwarding: [], in_destructure: false, in_pattern: false)
  @parser = parser
  @builder = parser.builder
  @source_buffer = parser.source_buffer
  @offset_cache = offset_cache

  @forwarding = forwarding
  @in_destructure = in_destructure
  @in_pattern = in_pattern
end</pre> </div>  <p>Initialize a new compiler with the given parser, offset cache, and options.</p> </div> </div> </section> <section id="public-instance-5Buntitled-5D-method-details" class="method-section anchor-link"> <header> <h3>Public Instance Methods</h3> </header> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_alias_global_variable_node"> <a href="#method-i-visit_alias_global_variable_node" title="Link to this method"> <span class="method-name">visit_alias_global_variable_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_alias_global_variable_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 58
def visit_alias_global_variable_node(node)
  builder.alias(token(node.keyword_loc), visit(node.new_name), visit(node.old_name))
end</pre> </div>  <p>alias $foo $bar ^^^^^^^^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_alias_method_node"> <a href="#method-i-visit_alias_method_node" title="Link to this method"> <span class="method-name">visit_alias_method_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_alias_method_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 52
def visit_alias_method_node(node)
  builder.alias(token(node.keyword_loc), visit(node.new_name), visit(node.old_name))
end</pre> </div>  <p>alias foo bar ^^^^^^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_alternation_pattern_node"> <a href="#method-i-visit_alternation_pattern_node" title="Link to this method"> <span class="method-name">visit_alternation_pattern_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_alternation_pattern_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 64
def visit_alternation_pattern_node(node)
  builder.match_alt(visit(node.left), token(node.operator_loc), visit(node.right))
end</pre> </div>  <p>foo =&gt; bar | baz</p> <pre>^^^^^^^^^</pre> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_and_node"> <a href="#method-i-visit_and_node" title="Link to this method"> <span class="method-name">visit_and_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_and_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 70
def visit_and_node(node)
  builder.logical_op(:and, visit(node.left), token(node.operator_loc), visit(node.right))
end</pre> </div>  <p>a and b ^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_arguments_node"> <a href="#method-i-visit_arguments_node" title="Link to this method"> <span class="method-name">visit_arguments_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_arguments_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 105
def visit_arguments_node(node)
  visit_all(node.arguments)
end</pre> </div>  <p>foo(bar)</p> <pre>^^^</pre> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_array_node"> <a href="#method-i-visit_array_node" title="Link to this method"> <span class="method-name">visit_array_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_array_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 76
def visit_array_node(node)
  builder.array(token(node.opening_loc), visit_all(node.elements), token(node.closing_loc))
end</pre> </div>  <dl class="rdoc-list label-list">
 <dd> <p>^^</p> </dd>
</dl> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_array_pattern_node"> <a href="#method-i-visit_array_pattern_node" title="Link to this method"> <span class="method-name">visit_array_pattern_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_array_pattern_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 82
def visit_array_pattern_node(node)
  elements = [*node.requireds]
  elements &lt;&lt; node.rest if !node.rest.nil? &amp;&amp; !node.rest.is_a?(ImplicitRestNode)
  elements.concat(node.posts)
  visited = visit_all(elements)

  if node.rest.is_a?(ImplicitRestNode)
    visited[-1] = builder.match_with_trailing_comma(visited[-1], token(node.rest.location))
  end

  if node.constant
    if visited.empty?
      builder.const_pattern(visit(node.constant), token(node.opening_loc), builder.array_pattern(token(node.opening_loc), visited, token(node.closing_loc)), token(node.closing_loc))
    else
      builder.const_pattern(visit(node.constant), token(node.opening_loc), builder.array_pattern(nil, visited, nil), token(node.closing_loc))
    end
  else
    builder.array_pattern(token(node.opening_loc), visited, token(node.closing_loc))
  end
end</pre> </div>  <p>foo =&gt; [bar]</p> <pre>^^^^^</pre> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_assoc_node"> <a href="#method-i-visit_assoc_node" title="Link to this method"> <span class="method-name">visit_assoc_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_assoc_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 111
def visit_assoc_node(node)
  key = node.key

  if in_pattern
    if node.value.is_a?(ImplicitNode)
      if key.is_a?(SymbolNode)
        if key.opening.nil?
          builder.match_hash_var([key.unescaped, srange(key.location)])
        else
          builder.match_hash_var_from_str(token(key.opening_loc), [builder.string_internal([key.unescaped, srange(key.value_loc)])], token(key.closing_loc))
        end
      else
        builder.match_hash_var_from_str(token(key.opening_loc), visit_all(key.parts), token(key.closing_loc))
      end
    elsif key.opening.nil?
      builder.pair_keyword([key.unescaped, srange(key.location)], visit(node.value))
    else
      builder.pair_quoted(token(key.opening_loc), [builder.string_internal([key.unescaped, srange(key.value_loc)])], token(key.closing_loc), visit(node.value))
    end
  elsif node.value.is_a?(ImplicitNode)
    if (value = node.value.value).is_a?(LocalVariableReadNode)
      builder.pair_keyword(
        [key.unescaped, srange(key)],
        builder.ident([value.name, srange(key.value_loc)]).updated(:lvar)
      )
    else
      builder.pair_label([key.unescaped, srange(key.location)])
    end
  elsif node.operator_loc
    builder.pair(visit(key), token(node.operator_loc), visit(node.value))
  elsif key.is_a?(SymbolNode) &amp;&amp; key.opening_loc.nil?
    builder.pair_keyword([key.unescaped, srange(key.location)], visit(node.value))
  else
    parts =
      if key.is_a?(SymbolNode)
        [builder.string_internal([key.unescaped, srange(key.value_loc)])]
      else
        visit_all(key.parts)
      end

    builder.pair_quoted(token(key.opening_loc), parts, token(key.closing_loc), visit(node.value))
  end
end</pre> </div>  <p>{ a: 1 }</p> <pre>^^^^</pre> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_assoc_splat_node"> <a href="#method-i-visit_assoc_splat_node" title="Link to this method"> <span class="method-name">visit_assoc_splat_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_assoc_splat_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 160
def visit_assoc_splat_node(node)
  if in_pattern
    builder.match_rest(token(node.operator_loc), token(node.value&amp;.location))
  elsif node.value.nil? &amp;&amp; forwarding.include?(:**)
    builder.forwarded_kwrestarg(token(node.operator_loc))
  else
    builder.kwsplat(token(node.operator_loc), visit(node.value))
  end
end</pre> </div>  <p>def foo(**); bar(**); end</p> <pre>^^</pre> <p>{ **foo }</p> <pre>^^^^^</pre> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_back_reference_read_node"> <a href="#method-i-visit_back_reference_read_node" title="Link to this method"> <span class="method-name">visit_back_reference_read_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_back_reference_read_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 172
def visit_back_reference_read_node(node)
  builder.back_ref(token(node.location))
end</pre> </div>  <p>$+ ^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_begin_node"> <a href="#method-i-visit_begin_node" title="Link to this method"> <span class="method-name">visit_begin_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_begin_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 178
def visit_begin_node(node)
  rescue_bodies = []

  if (rescue_clause = node.rescue_clause)
    begin
      find_start_offset = (rescue_clause.reference&amp;.location || rescue_clause.exceptions.last&amp;.location || rescue_clause.keyword_loc).end_offset
      find_end_offset = (rescue_clause.statements&amp;.location&amp;.start_offset || rescue_clause.subsequent&amp;.location&amp;.start_offset || (find_start_offset + 1))

      rescue_bodies &lt;&lt; builder.rescue_body(
        token(rescue_clause.keyword_loc),
        rescue_clause.exceptions.any? ? builder.array(nil, visit_all(rescue_clause.exceptions), nil) : nil,
        token(rescue_clause.operator_loc),
        visit(rescue_clause.reference),
        srange_find(find_start_offset, find_end_offset, ";"),
        visit(rescue_clause.statements)
      )
    end until (rescue_clause = rescue_clause.subsequent).nil?
  end

  begin_body =
    builder.begin_body(
      visit(node.statements),
      rescue_bodies,
      token(node.else_clause&amp;.else_keyword_loc),
      visit(node.else_clause),
      token(node.ensure_clause&amp;.ensure_keyword_loc),
      visit(node.ensure_clause&amp;.statements)
    )

  if node.begin_keyword_loc
    builder.begin_keyword(token(node.begin_keyword_loc), begin_body, token(node.end_keyword_loc))
  else
    begin_body
  end
end</pre> </div>  <p>begin end ^^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_block_argument_node"> <a href="#method-i-visit_block_argument_node" title="Link to this method"> <span class="method-name">visit_block_argument_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_block_argument_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 216
def visit_block_argument_node(node)
  builder.block_pass(token(node.operator_loc), visit(node.expression))
end</pre> </div>  <p>foo(&amp;bar)</p> <pre>^^^^</pre> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_block_local_variable_node"> <a href="#method-i-visit_block_local_variable_node" title="Link to this method"> <span class="method-name">visit_block_local_variable_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_block_local_variable_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 222
def visit_block_local_variable_node(node)
  builder.shadowarg(token(node.location))
end</pre> </div>  <p>foo { |; bar| }</p> <pre>^^^</pre> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_block_node"> <a href="#method-i-visit_block_node" title="Link to this method"> <span class="method-name">visit_block_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_block_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 227
def visit_block_node(node)
  raise CompilationError, "Cannot directly compile block nodes"
end</pre> </div>  <p>A block on a keyword or method call.</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_block_parameter_node"> <a href="#method-i-visit_block_parameter_node" title="Link to this method"> <span class="method-name">visit_block_parameter_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_block_parameter_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 233
def visit_block_parameter_node(node)
  builder.blockarg(token(node.operator_loc), token(node.name_loc))
end</pre> </div>  <p>def foo(&amp;bar); end</p> <pre>^^^^</pre> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_block_parameters_node"> <a href="#method-i-visit_block_parameters_node" title="Link to this method"> <span class="method-name">visit_block_parameters_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_block_parameters_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 238
def visit_block_parameters_node(node)
  [*visit(node.parameters)].concat(visit_all(node.locals))
end</pre> </div>  <p>A block’s parameters.</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_break_node"> <a href="#method-i-visit_break_node" title="Link to this method"> <span class="method-name">visit_break_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_break_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 247
def visit_break_node(node)
  builder.keyword_cmd(:break, token(node.keyword_loc), nil, visit(node.arguments) || [], nil)
end</pre> </div>  <p>break ^^^^^</p> <p>break foo ^^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_call_and_write_node"> <a href="#method-i-visit_call_and_write_node" title="Link to this method"> <span class="method-name">visit_call_and_write_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_call_and_write_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 352
def visit_call_and_write_node(node)
  call_operator_loc = node.call_operator_loc

  builder.op_assign(
    builder.call_method(
      visit(node.receiver),
      call_operator_loc.nil? ? nil : [{ "." =&gt; :dot, "&amp;." =&gt; :anddot, "::" =&gt; "::" }.fetch(call_operator_loc.slice), srange(call_operator_loc)],
      node.message_loc ? [node.read_name, srange(node.message_loc)] : nil,
      nil,
      [],
      nil
    ),
    [node.operator_loc.slice.chomp("="), srange(node.operator_loc)],
    visit(node.value)
  )
end</pre> </div>  <p>foo.bar &amp;&amp;= baz ^^^^^^^^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_call_node"> <a href="#method-i-visit_call_node" title="Link to this method"> <span class="method-name">visit_call_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_call_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 259
def visit_call_node(node)
  name = node.name
  arguments = node.arguments&amp;.arguments || []
  block = node.block

  if block.is_a?(BlockArgumentNode)
    arguments = [*arguments, block]
    block = nil
  end

  if node.call_operator_loc.nil?
    case name
    when :-@
      case (receiver = node.receiver).type
      when :integer_node, :float_node, :rational_node, :imaginary_node
        return visit(numeric_negate(node.message_loc, receiver))
      end
    when :!
      return visit_block(builder.not_op(token(node.message_loc), token(node.opening_loc), visit(node.receiver), token(node.closing_loc)), block)
    when :=~
      if (receiver = node.receiver).is_a?(RegularExpressionNode)
        return builder.match_op(visit(receiver), token(node.message_loc), visit(node.arguments.arguments.first))
      end
    when :[]
      return visit_block(builder.index(visit(node.receiver), token(node.opening_loc), visit_all(arguments), token(node.closing_loc)), block)
    when :[]=
      if node.message != "[]=" &amp;&amp; node.arguments &amp;&amp; block.nil? &amp;&amp; !node.safe_navigation?
        arguments = node.arguments.arguments[...-1]
        arguments &lt;&lt; node.block if node.block

        return visit_block(
          builder.assign(
            builder.index_asgn(
              visit(node.receiver),
              token(node.opening_loc),
              visit_all(arguments),
              token(node.closing_loc),
            ),
            srange_find(node.message_loc.end_offset, node.arguments.arguments.last.location.start_offset, "="),
            visit(node.arguments.arguments.last)
          ),
          block
        )
      end
    end
  end

  message_loc = node.message_loc
  call_operator_loc = node.call_operator_loc
  call_operator = [{ "." =&gt; :dot, "&amp;." =&gt; :anddot, "::" =&gt; "::" }.fetch(call_operator_loc.slice), srange(call_operator_loc)] if call_operator_loc

  visit_block(
    if name.end_with?("=") &amp;&amp; !message_loc.slice.end_with?("=") &amp;&amp; node.arguments &amp;&amp; block.nil?
      builder.assign(
        builder.attr_asgn(visit(node.receiver), call_operator, token(message_loc)),
        srange_find(message_loc.end_offset, node.arguments.location.start_offset, "="),
        visit(node.arguments.arguments.last)
      )
    else
      builder.call_method(
        visit(node.receiver),
        call_operator,
        message_loc ? [node.name, srange(message_loc)] : nil,
        token(node.opening_loc),
        visit_all(arguments),
        token(node.closing_loc)
      )
    end,
    block
  )
end</pre> </div>  <p>foo ^^^</p> <p>foo.bar ^^^^^^^</p> <p>foo.bar() {} ^^^^^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_call_operator_write_node"> <a href="#method-i-visit_call_operator_write_node" title="Link to this method"> <span class="method-name">visit_call_operator_write_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_call_operator_write_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 333
def visit_call_operator_write_node(node)
  call_operator_loc = node.call_operator_loc

  builder.op_assign(
    builder.call_method(
      visit(node.receiver),
      call_operator_loc.nil? ? nil : [{ "." =&gt; :dot, "&amp;." =&gt; :anddot, "::" =&gt; "::" }.fetch(call_operator_loc.slice), srange(call_operator_loc)],
      node.message_loc ? [node.read_name, srange(node.message_loc)] : nil,
      nil,
      [],
      nil
    ),
    [node.binary_operator_loc.slice.chomp("="), srange(node.binary_operator_loc)],
    visit(node.value)
  )
end</pre> </div>  <p>foo.bar += baz ^^^^^^^^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_call_or_write_node"> <a href="#method-i-visit_call_or_write_node" title="Link to this method"> <span class="method-name">visit_call_or_write_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_call_or_write_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 371
def visit_call_or_write_node(node)
  call_operator_loc = node.call_operator_loc

  builder.op_assign(
    builder.call_method(
      visit(node.receiver),
      call_operator_loc.nil? ? nil : [{ "." =&gt; :dot, "&amp;." =&gt; :anddot, "::" =&gt; "::" }.fetch(call_operator_loc.slice), srange(call_operator_loc)],
      node.message_loc ? [node.read_name, srange(node.message_loc)] : nil,
      nil,
      [],
      nil
    ),
    [node.operator_loc.slice.chomp("="), srange(node.operator_loc)],
    visit(node.value)
  )
end</pre> </div>  <p>foo.bar ||= baz ^^^^^^^^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_call_target_node"> <a href="#method-i-visit_call_target_node" title="Link to this method"> <span class="method-name">visit_call_target_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_call_target_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 390
def visit_call_target_node(node)
  call_operator_loc = node.call_operator_loc

  builder.attr_asgn(
    visit(node.receiver),
    call_operator_loc.nil? ? nil : [{ "." =&gt; :dot, "&amp;." =&gt; :anddot, "::" =&gt; "::" }.fetch(call_operator_loc.slice), srange(call_operator_loc)],
    token(node.message_loc)
  )
end</pre> </div>  <p>foo.bar, = 1 ^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_capture_pattern_node"> <a href="#method-i-visit_capture_pattern_node" title="Link to this method"> <span class="method-name">visit_capture_pattern_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_capture_pattern_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 402
def visit_capture_pattern_node(node)
  builder.match_as(visit(node.value), token(node.operator_loc), visit(node.target))
end</pre> </div>  <p>foo =&gt; bar =&gt; baz</p> <pre>^^^^^^^^^^</pre> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_case_match_node"> <a href="#method-i-visit_case_match_node" title="Link to this method"> <span class="method-name">visit_case_match_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_case_match_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 421
def visit_case_match_node(node)
  builder.case_match(
    token(node.case_keyword_loc),
    visit(node.predicate),
    visit_all(node.conditions),
    token(node.else_clause&amp;.else_keyword_loc),
    visit(node.else_clause),
    token(node.end_keyword_loc)
  )
end</pre> </div>  <p>case foo; in bar; end ^^^^^^^^^^^^^^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_case_node"> <a href="#method-i-visit_case_node" title="Link to this method"> <span class="method-name">visit_case_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_case_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 408
def visit_case_node(node)
  builder.case(
    token(node.case_keyword_loc),
    visit(node.predicate),
    visit_all(node.conditions),
    token(node.else_clause&amp;.else_keyword_loc),
    visit(node.else_clause),
    token(node.end_keyword_loc)
  )
end</pre> </div>  <p>case foo; when bar; end ^^^^^^^^^^^^^^^^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_class_node"> <a href="#method-i-visit_class_node" title="Link to this method"> <span class="method-name">visit_class_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_class_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 434
def visit_class_node(node)
  builder.def_class(
    token(node.class_keyword_loc),
    visit(node.constant_path),
    token(node.inheritance_operator_loc),
    visit(node.superclass),
    node.body&amp;.accept(copy_compiler(forwarding: [])),
    token(node.end_keyword_loc)
  )
end</pre> </div>  <p>class Foo; end ^^^^^^^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_class_variable_and_write_node"> <a href="#method-i-visit_class_variable_and_write_node" title="Link to this method"> <span class="method-name">visit_class_variable_and_write_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_class_variable_and_write_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 473
def visit_class_variable_and_write_node(node)
  builder.op_assign(
    builder.assignable(builder.cvar(token(node.name_loc))),
    [node.operator_loc.slice.chomp("="), srange(node.operator_loc)],
    visit(node.value)
  )
end</pre> </div>  <p>@@foo &amp;&amp;= bar ^^^^^^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_class_variable_operator_write_node"> <a href="#method-i-visit_class_variable_operator_write_node" title="Link to this method"> <span class="method-name">visit_class_variable_operator_write_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_class_variable_operator_write_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 463
def visit_class_variable_operator_write_node(node)
  builder.op_assign(
    builder.assignable(builder.cvar(token(node.name_loc))),
    [node.binary_operator_loc.slice.chomp("="), srange(node.binary_operator_loc)],
    visit(node.value)
  )
end</pre> </div>  <p>@@foo += bar ^^^^^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_class_variable_or_write_node"> <a href="#method-i-visit_class_variable_or_write_node" title="Link to this method"> <span class="method-name">visit_class_variable_or_write_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_class_variable_or_write_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 483
def visit_class_variable_or_write_node(node)
  builder.op_assign(
    builder.assignable(builder.cvar(token(node.name_loc))),
    [node.operator_loc.slice.chomp("="), srange(node.operator_loc)],
    visit(node.value)
  )
end</pre> </div>  <p>@@foo ||= bar ^^^^^^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_class_variable_read_node"> <a href="#method-i-visit_class_variable_read_node" title="Link to this method"> <span class="method-name">visit_class_variable_read_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_class_variable_read_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 447
def visit_class_variable_read_node(node)
  builder.cvar(token(node.location))
end</pre> </div>  <p>@@foo ^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_class_variable_target_node"> <a href="#method-i-visit_class_variable_target_node" title="Link to this method"> <span class="method-name">visit_class_variable_target_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_class_variable_target_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 493
def visit_class_variable_target_node(node)
  builder.assignable(builder.cvar(token(node.location)))
end</pre> </div>  <p>@@foo, = bar ^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_class_variable_write_node"> <a href="#method-i-visit_class_variable_write_node" title="Link to this method"> <span class="method-name">visit_class_variable_write_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_class_variable_write_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 453
def visit_class_variable_write_node(node)
  builder.assign(
    builder.assignable(builder.cvar(token(node.name_loc))),
    token(node.operator_loc),
    visit(node.value)
  )
end</pre> </div>  <p>@@foo = 1 ^^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_constant_and_write_node"> <a href="#method-i-visit_constant_and_write_node" title="Link to this method"> <span class="method-name">visit_constant_and_write_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_constant_and_write_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 524
def visit_constant_and_write_node(node)
  builder.op_assign(
    builder.assignable(builder.const([node.name, srange(node.name_loc)])),
    [node.operator_loc.slice.chomp("="), srange(node.operator_loc)],
    visit(node.value)
  )
end</pre> </div>  <p>Foo &amp;&amp;= bar ^^^^^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_constant_operator_write_node"> <a href="#method-i-visit_constant_operator_write_node" title="Link to this method"> <span class="method-name">visit_constant_operator_write_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_constant_operator_write_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 514
def visit_constant_operator_write_node(node)
  builder.op_assign(
    builder.assignable(builder.const([node.name, srange(node.name_loc)])),
    [node.binary_operator_loc.slice.chomp("="), srange(node.binary_operator_loc)],
    visit(node.value)
  )
end</pre> </div>  <p>Foo += bar ^^^^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_constant_or_write_node"> <a href="#method-i-visit_constant_or_write_node" title="Link to this method"> <span class="method-name">visit_constant_or_write_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_constant_or_write_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 534
def visit_constant_or_write_node(node)
  builder.op_assign(
    builder.assignable(builder.const([node.name, srange(node.name_loc)])),
    [node.operator_loc.slice.chomp("="), srange(node.operator_loc)],
    visit(node.value)
  )
end</pre> </div>  <p>Foo ||= bar ^^^^^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_constant_path_and_write_node"> <a href="#method-i-visit_constant_path_and_write_node" title="Link to this method"> <span class="method-name">visit_constant_path_and_write_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_constant_path_and_write_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 590
def visit_constant_path_and_write_node(node)
  builder.op_assign(
    builder.assignable(visit(node.target)),
    [node.operator_loc.slice.chomp("="), srange(node.operator_loc)],
    visit(node.value)
  )
end</pre> </div>  <p>Foo::Bar &amp;&amp;= baz ^^^^^^^^^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_constant_path_node"> <a href="#method-i-visit_constant_path_node" title="Link to this method"> <span class="method-name">visit_constant_path_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_constant_path_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 550
def visit_constant_path_node(node)
  if node.parent.nil?
    builder.const_global(
      token(node.delimiter_loc),
      [node.name, srange(node.name_loc)]
    )
  else
    builder.const_fetch(
      visit(node.parent),
      token(node.delimiter_loc),
      [node.name, srange(node.name_loc)]
    )
  end
end</pre> </div>  <p>Foo::Bar ^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_constant_path_operator_write_node"> <a href="#method-i-visit_constant_path_operator_write_node" title="Link to this method"> <span class="method-name">visit_constant_path_operator_write_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_constant_path_operator_write_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 580
def visit_constant_path_operator_write_node(node)
  builder.op_assign(
    builder.assignable(visit(node.target)),
    [node.binary_operator_loc.slice.chomp("="), srange(node.binary_operator_loc)],
    visit(node.value)
  )
end</pre> </div>  <p>Foo::Bar += baz ^^^^^^^^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_constant_path_or_write_node"> <a href="#method-i-visit_constant_path_or_write_node" title="Link to this method"> <span class="method-name">visit_constant_path_or_write_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_constant_path_or_write_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 600
def visit_constant_path_or_write_node(node)
  builder.op_assign(
    builder.assignable(visit(node.target)),
    [node.operator_loc.slice.chomp("="), srange(node.operator_loc)],
    visit(node.value)
  )
end</pre> </div>  <p>Foo::Bar ||= baz ^^^^^^^^^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_constant_path_target_node"> <a href="#method-i-visit_constant_path_target_node" title="Link to this method"> <span class="method-name">visit_constant_path_target_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_constant_path_target_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 610
def visit_constant_path_target_node(node)
  builder.assignable(visit_constant_path_node(node))
end</pre> </div>  <p>Foo::Bar, = baz ^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_constant_path_write_node"> <a href="#method-i-visit_constant_path_write_node" title="Link to this method"> <span class="method-name">visit_constant_path_write_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_constant_path_write_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 570
def visit_constant_path_write_node(node)
  builder.assign(
    builder.assignable(visit(node.target)),
    token(node.operator_loc),
    visit(node.value)
  )
end</pre> </div>  <p>Foo::Bar = 1 ^^^^^^^^^^^^</p> <p>Foo::Foo, Bar::Bar = 1 ^^^^^^^^ ^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_constant_read_node"> <a href="#method-i-visit_constant_read_node" title="Link to this method"> <span class="method-name">visit_constant_read_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_constant_read_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 499
def visit_constant_read_node(node)
  builder.const([node.name, srange(node.location)])
end</pre> </div>  <p>Foo ^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_constant_target_node"> <a href="#method-i-visit_constant_target_node" title="Link to this method"> <span class="method-name">visit_constant_target_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_constant_target_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 544
def visit_constant_target_node(node)
  builder.assignable(builder.const([node.name, srange(node.location)]))
end</pre> </div>  <p>Foo, = bar ^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_constant_write_node"> <a href="#method-i-visit_constant_write_node" title="Link to this method"> <span class="method-name">visit_constant_write_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_constant_write_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 508
def visit_constant_write_node(node)
  builder.assign(builder.assignable(builder.const([node.name, srange(node.name_loc)])), token(node.operator_loc), visit(node.value))
end</pre> </div>  <p>Foo = 1 ^^^^^^^</p> <p>Foo, Bar = 1 ^^^ ^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_def_node"> <a href="#method-i-visit_def_node" title="Link to this method"> <span class="method-name">visit_def_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_def_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 619
def visit_def_node(node)
  if node.equal_loc
    if node.receiver
      builder.def_endless_singleton(
        token(node.def_keyword_loc),
        visit(node.receiver.is_a?(ParenthesesNode) ? node.receiver.body : node.receiver),
        token(node.operator_loc),
        token(node.name_loc),
        builder.args(token(node.lparen_loc), visit(node.parameters) || [], token(node.rparen_loc), false),
        token(node.equal_loc),
        node.body&amp;.accept(copy_compiler(forwarding: find_forwarding(node.parameters)))
      )
    else
      builder.def_endless_method(
        token(node.def_keyword_loc),
        token(node.name_loc),
        builder.args(token(node.lparen_loc), visit(node.parameters) || [], token(node.rparen_loc), false),
        token(node.equal_loc),
        node.body&amp;.accept(copy_compiler(forwarding: find_forwarding(node.parameters)))
      )
    end
  elsif node.receiver
    builder.def_singleton(
      token(node.def_keyword_loc),
      visit(node.receiver.is_a?(ParenthesesNode) ? node.receiver.body : node.receiver),
      token(node.operator_loc),
      token(node.name_loc),
      builder.args(token(node.lparen_loc), visit(node.parameters) || [], token(node.rparen_loc), false),
      node.body&amp;.accept(copy_compiler(forwarding: find_forwarding(node.parameters))),
      token(node.end_keyword_loc)
    )
  else
    builder.def_method(
      token(node.def_keyword_loc),
      token(node.name_loc),
      builder.args(token(node.lparen_loc), visit(node.parameters) || [], token(node.rparen_loc), false),
      node.body&amp;.accept(copy_compiler(forwarding: find_forwarding(node.parameters))),
      token(node.end_keyword_loc)
    )
  end
end</pre> </div>  <p>def foo; end ^^^^^^^^^^^^</p> <p>def self.foo; end ^^^^^^^^^^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_defined_node"> <a href="#method-i-visit_defined_node" title="Link to this method"> <span class="method-name">visit_defined_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_defined_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 666
def visit_defined_node(node)
  builder.keyword_cmd(
    :defined?,
    token(node.keyword_loc),
    token(node.lparen_loc),
    [visit(node.value)],
    token(node.rparen_loc)
  )
end</pre> </div>  <p>defined? a ^^^^^^^^^^</p> <p>defined?(a) ^^^^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_else_node"> <a href="#method-i-visit_else_node" title="Link to this method"> <span class="method-name">visit_else_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_else_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 678
def visit_else_node(node)
  visit(node.statements)
end</pre> </div>  <p>if foo then bar else baz end</p> <pre>^^^^^^^^^^^^</pre> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_embedded_statements_node"> <a href="#method-i-visit_embedded_statements_node" title="Link to this method"> <span class="method-name">visit_embedded_statements_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_embedded_statements_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 684
def visit_embedded_statements_node(node)
  builder.begin(
    token(node.opening_loc),
    visit(node.statements),
    token(node.closing_loc)
  )
end</pre> </div>  <p>“foo #{bar}”</p> <pre>^^^^^^</pre> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_embedded_variable_node"> <a href="#method-i-visit_embedded_variable_node" title="Link to this method"> <span class="method-name">visit_embedded_variable_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_embedded_variable_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 694
def visit_embedded_variable_node(node)
  visit(node.variable)
end</pre> </div>  <p>“foo #@bar”</p> <pre>^^^^^</pre> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_ensure_node"> <a href="#method-i-visit_ensure_node" title="Link to this method"> <span class="method-name">visit_ensure_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_ensure_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 700
def visit_ensure_node(node)
  raise CompilationError, "Cannot directly compile ensure nodes"
end</pre> </div>  <p>begin; foo; ensure; bar; end</p> <pre>^^^^^^^^^^^^</pre> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_false_node"> <a href="#method-i-visit_false_node" title="Link to this method"> <span class="method-name">visit_false_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_false_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 706
def visit_false_node(node)
  builder.false(token(node.location))
end</pre> </div>  <p>false ^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_find_pattern_node"> <a href="#method-i-visit_find_pattern_node" title="Link to this method"> <span class="method-name">visit_find_pattern_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_find_pattern_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 712
def visit_find_pattern_node(node)
  elements = [node.left, *node.requireds, node.right]

  if node.constant
    builder.const_pattern(visit(node.constant), token(node.opening_loc), builder.find_pattern(nil, visit_all(elements), nil), token(node.closing_loc))
  else
    builder.find_pattern(token(node.opening_loc), visit_all(elements), token(node.closing_loc))
  end
end</pre> </div>  <p>foo =&gt; [*, bar, *]</p> <pre>^^^^^^^^^^^</pre> </div> </div> <div class="method-detail anchor-link method-alias"> <div class="method-header"> <div class="method-heading" id="method-i-visit_flip_flop_node"> <a href="#method-i-visit_flip_flop_node" title="Link to this method"> <span class="method-name">visit_flip_flop_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-description"> <p>if foo .. bar; end</p> <pre>^^^^^^^^^^</pre> </div> <div class="aliases"> Alias for: <a href="compiler.html#method-i-visit_range_node">visit_range_node</a> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_float_node"> <a href="#method-i-visit_float_node" title="Link to this method"> <span class="method-name">visit_float_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_float_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 724
def visit_float_node(node)
  visit_numeric(node, builder.float([node.value, srange(node.location)]))
end</pre> </div>  <p>1.0 ^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_for_node"> <a href="#method-i-visit_for_node" title="Link to this method"> <span class="method-name">visit_for_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_for_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 730
def visit_for_node(node)
  builder.for(
    token(node.for_keyword_loc),
    visit(node.index),
    token(node.in_keyword_loc),
    visit(node.collection),
    if (do_keyword_loc = node.do_keyword_loc)
      token(do_keyword_loc)
    else
      srange_find(node.collection.location.end_offset, (node.statements&amp;.location || node.end_keyword_loc).start_offset, ";")
    end,
    visit(node.statements),
    token(node.end_keyword_loc)
  )
end</pre> </div>  <p>for foo in bar do end ^^^^^^^^^^^^^^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_forwarding_arguments_node"> <a href="#method-i-visit_forwarding_arguments_node" title="Link to this method"> <span class="method-name">visit_forwarding_arguments_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_forwarding_arguments_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 748
def visit_forwarding_arguments_node(node)
  builder.forwarded_args(token(node.location))
end</pre> </div>  <p>def foo(…); bar(…); end</p> <pre>^^^</pre> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_forwarding_parameter_node"> <a href="#method-i-visit_forwarding_parameter_node" title="Link to this method"> <span class="method-name">visit_forwarding_parameter_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_forwarding_parameter_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 754
def visit_forwarding_parameter_node(node)
  builder.forward_arg(token(node.location))
end</pre> </div>  <p>def foo(…); end</p> <pre>^^^</pre> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_forwarding_super_node"> <a href="#method-i-visit_forwarding_super_node" title="Link to this method"> <span class="method-name">visit_forwarding_super_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_forwarding_super_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 763
def visit_forwarding_super_node(node)
  visit_block(
    builder.keyword_cmd(
      :zsuper,
      ["super", srange_offsets(node.location.start_offset, node.location.start_offset + 5)]
    ),
    node.block
  )
end</pre> </div>  <p>super ^^^^^</p> <p>super {} ^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_global_variable_and_write_node"> <a href="#method-i-visit_global_variable_and_write_node" title="Link to this method"> <span class="method-name">visit_global_variable_and_write_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_global_variable_and_write_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 801
def visit_global_variable_and_write_node(node)
  builder.op_assign(
    builder.assignable(builder.gvar(token(node.name_loc))),
    [node.operator_loc.slice.chomp("="), srange(node.operator_loc)],
    visit(node.value)
  )
end</pre> </div>  <p>$foo &amp;&amp;= bar ^^^^^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_global_variable_operator_write_node"> <a href="#method-i-visit_global_variable_operator_write_node" title="Link to this method"> <span class="method-name">visit_global_variable_operator_write_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_global_variable_operator_write_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 791
def visit_global_variable_operator_write_node(node)
  builder.op_assign(
    builder.assignable(builder.gvar(token(node.name_loc))),
    [node.binary_operator_loc.slice.chomp("="), srange(node.binary_operator_loc)],
    visit(node.value)
  )
end</pre> </div>  <p>$foo += bar ^^^^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_global_variable_or_write_node"> <a href="#method-i-visit_global_variable_or_write_node" title="Link to this method"> <span class="method-name">visit_global_variable_or_write_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_global_variable_or_write_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 811
def visit_global_variable_or_write_node(node)
  builder.op_assign(
    builder.assignable(builder.gvar(token(node.name_loc))),
    [node.operator_loc.slice.chomp("="), srange(node.operator_loc)],
    visit(node.value)
  )
end</pre> </div>  <p>$foo ||= bar ^^^^^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_global_variable_read_node"> <a href="#method-i-visit_global_variable_read_node" title="Link to this method"> <span class="method-name">visit_global_variable_read_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_global_variable_read_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 775
def visit_global_variable_read_node(node)
  builder.gvar(token(node.location))
end</pre> </div>  <p>$foo ^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_global_variable_target_node"> <a href="#method-i-visit_global_variable_target_node" title="Link to this method"> <span class="method-name">visit_global_variable_target_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_global_variable_target_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 821
def visit_global_variable_target_node(node)
  builder.assignable(builder.gvar([node.slice, srange(node.location)]))
end</pre> </div>  <p>$foo, = bar ^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_global_variable_write_node"> <a href="#method-i-visit_global_variable_write_node" title="Link to this method"> <span class="method-name">visit_global_variable_write_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_global_variable_write_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 781
def visit_global_variable_write_node(node)
  builder.assign(
    builder.assignable(builder.gvar(token(node.name_loc))),
    token(node.operator_loc),
    visit(node.value)
  )
end</pre> </div>  <p>$foo = 1 ^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_hash_node"> <a href="#method-i-visit_hash_node" title="Link to this method"> <span class="method-name">visit_hash_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_hash_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 827
def visit_hash_node(node)
  builder.associate(
    token(node.opening_loc),
    visit_all(node.elements),
    token(node.closing_loc)
  )
end</pre> </div>  <p>{} ^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_hash_pattern_node"> <a href="#method-i-visit_hash_pattern_node" title="Link to this method"> <span class="method-name">visit_hash_pattern_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_hash_pattern_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 837
def visit_hash_pattern_node(node)
  elements = [*node.elements, *node.rest]

  if node.constant
    builder.const_pattern(visit(node.constant), token(node.opening_loc), builder.hash_pattern(nil, visit_all(elements), nil), token(node.closing_loc))
  else
    builder.hash_pattern(token(node.opening_loc), visit_all(elements), token(node.closing_loc))
  end
end</pre> </div>  <p>foo =&gt; {}</p> <pre>^^</pre> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_if_node"> <a href="#method-i-visit_if_node" title="Link to this method"> <span class="method-name">visit_if_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_if_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 855
def visit_if_node(node)
  if !node.if_keyword_loc
    builder.ternary(
      visit(node.predicate),
      token(node.then_keyword_loc),
      visit(node.statements),
      token(node.subsequent.else_keyword_loc),
      visit(node.subsequent)
    )
  elsif node.if_keyword_loc.start_offset == node.location.start_offset
    builder.condition(
      token(node.if_keyword_loc),
      visit(node.predicate),
      if (then_keyword_loc = node.then_keyword_loc)
        token(then_keyword_loc)
      else
        srange_find(node.predicate.location.end_offset, (node.statements&amp;.location || node.subsequent&amp;.location || node.end_keyword_loc).start_offset, ";")
      end,
      visit(node.statements),
      case node.subsequent
      when IfNode
        token(node.subsequent.if_keyword_loc)
      when ElseNode
        token(node.subsequent.else_keyword_loc)
      end,
      visit(node.subsequent),
      if node.if_keyword != "elsif"
        token(node.end_keyword_loc)
      end
    )
  else
    builder.condition_mod(
      visit(node.statements),
      visit(node.subsequent),
      token(node.if_keyword_loc),
      visit(node.predicate)
    )
  end
end</pre> </div>  <p>if foo then bar end ^^^^^^^^^^^^^^^^^^^</p> <p>bar if foo ^^^^^^^^^^</p> <p>foo ? bar : baz ^^^^^^^^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_imaginary_node"> <a href="#method-i-visit_imaginary_node" title="Link to this method"> <span class="method-name">visit_imaginary_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_imaginary_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 897
def visit_imaginary_node(node)
  visit_numeric(node, builder.complex([Complex(0, node.numeric.value), srange(node.location)]))
end</pre> </div>  <p>1i ^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_implicit_node"> <a href="#method-i-visit_implicit_node" title="Link to this method"> <span class="method-name">visit_implicit_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_implicit_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 903
def visit_implicit_node(node)
  raise CompilationError, "Cannot directly compile implicit nodes"
end</pre> </div>  <p>{ foo: }</p> <pre>^^^^</pre> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_implicit_rest_node"> <a href="#method-i-visit_implicit_rest_node" title="Link to this method"> <span class="method-name">visit_implicit_rest_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_implicit_rest_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 909
def visit_implicit_rest_node(node)
  raise CompilationError, "Cannot compile implicit rest nodes"
end</pre> </div>  <p>foo { |bar,| }</p> <pre>^</pre> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_in_node"> <a href="#method-i-visit_in_node" title="Link to this method"> <span class="method-name">visit_in_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_in_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 915
def visit_in_node(node)
  pattern = nil
  guard = nil

  case node.pattern
  when IfNode
    pattern = within_pattern { |compiler| node.pattern.statements.accept(compiler) }
    guard = builder.if_guard(token(node.pattern.if_keyword_loc), visit(node.pattern.predicate))
  when UnlessNode
    pattern = within_pattern { |compiler| node.pattern.statements.accept(compiler) }
    guard = builder.unless_guard(token(node.pattern.keyword_loc), visit(node.pattern.predicate))
  else
    pattern = within_pattern { |compiler| node.pattern.accept(compiler) }
  end

  builder.in_pattern(
    token(node.in_loc),
    pattern,
    guard,
    if (then_loc = node.then_loc)
      token(then_loc)
    else
      srange_find(node.pattern.location.end_offset, node.statements&amp;.location&amp;.start_offset, ";")
    end,
    visit(node.statements)
  )
end</pre> </div>  <p>case foo; in bar; end ^^^^^^^^^^^^^^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_index_and_write_node"> <a href="#method-i-visit_index_and_write_node" title="Link to this method"> <span class="method-name">visit_index_and_write_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_index_and_write_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 963
def visit_index_and_write_node(node)
  arguments = node.arguments&amp;.arguments || []
  arguments &lt;&lt; node.block if node.block

  builder.op_assign(
    builder.index(
      visit(node.receiver),
      token(node.opening_loc),
      visit_all(arguments),
      token(node.closing_loc)
    ),
    [node.operator_loc.slice.chomp("="), srange(node.operator_loc)],
    visit(node.value)
  )
end</pre> </div>  <p><span>foo</span> &amp;&amp;= baz ^^^^^^^^^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_index_operator_write_node"> <a href="#method-i-visit_index_operator_write_node" title="Link to this method"> <span class="method-name">visit_index_operator_write_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_index_operator_write_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 945
def visit_index_operator_write_node(node)
  arguments = node.arguments&amp;.arguments || []
  arguments &lt;&lt; node.block if node.block

  builder.op_assign(
    builder.index(
      visit(node.receiver),
      token(node.opening_loc),
      visit_all(arguments),
      token(node.closing_loc)
    ),
    [node.binary_operator_loc.slice.chomp("="), srange(node.binary_operator_loc)],
    visit(node.value)
  )
end</pre> </div>  <p><span>foo</span> += baz ^^^^^^^^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_index_or_write_node"> <a href="#method-i-visit_index_or_write_node" title="Link to this method"> <span class="method-name">visit_index_or_write_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_index_or_write_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 981
def visit_index_or_write_node(node)
  arguments = node.arguments&amp;.arguments || []
  arguments &lt;&lt; node.block if node.block

  builder.op_assign(
    builder.index(
      visit(node.receiver),
      token(node.opening_loc),
      visit_all(arguments),
      token(node.closing_loc)
    ),
    [node.operator_loc.slice.chomp("="), srange(node.operator_loc)],
    visit(node.value)
  )
end</pre> </div>  <p><span>foo</span> ||= baz ^^^^^^^^^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_index_target_node"> <a href="#method-i-visit_index_target_node" title="Link to this method"> <span class="method-name">visit_index_target_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_index_target_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 999
def visit_index_target_node(node)
  builder.index_asgn(
    visit(node.receiver),
    token(node.opening_loc),
    visit_all(node.arguments.arguments),
    token(node.closing_loc),
  )
end</pre> </div>  <p><span>foo</span>, = 1 ^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_instance_variable_and_write_node"> <a href="#method-i-visit_instance_variable_and_write_node" title="Link to this method"> <span class="method-name">visit_instance_variable_and_write_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_instance_variable_and_write_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1036
def visit_instance_variable_and_write_node(node)
  builder.op_assign(
    builder.assignable(builder.ivar(token(node.name_loc))),
    [node.operator_loc.slice.chomp("="), srange(node.operator_loc)],
    visit(node.value)
  )
end</pre> </div>  <p>@foo &amp;&amp;= bar ^^^^^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_instance_variable_operator_write_node"> <a href="#method-i-visit_instance_variable_operator_write_node" title="Link to this method"> <span class="method-name">visit_instance_variable_operator_write_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_instance_variable_operator_write_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1026
def visit_instance_variable_operator_write_node(node)
  builder.op_assign(
    builder.assignable(builder.ivar(token(node.name_loc))),
    [node.binary_operator_loc.slice.chomp("="), srange(node.binary_operator_loc)],
    visit(node.value)
  )
end</pre> </div>  <p>@foo += bar ^^^^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_instance_variable_or_write_node"> <a href="#method-i-visit_instance_variable_or_write_node" title="Link to this method"> <span class="method-name">visit_instance_variable_or_write_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_instance_variable_or_write_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1046
def visit_instance_variable_or_write_node(node)
  builder.op_assign(
    builder.assignable(builder.ivar(token(node.name_loc))),
    [node.operator_loc.slice.chomp("="), srange(node.operator_loc)],
    visit(node.value)
  )
end</pre> </div>  <p>@foo ||= bar ^^^^^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_instance_variable_read_node"> <a href="#method-i-visit_instance_variable_read_node" title="Link to this method"> <span class="method-name">visit_instance_variable_read_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_instance_variable_read_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1010
def visit_instance_variable_read_node(node)
  builder.ivar(token(node.location))
end</pre> </div>  <p>@foo ^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_instance_variable_target_node"> <a href="#method-i-visit_instance_variable_target_node" title="Link to this method"> <span class="method-name">visit_instance_variable_target_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_instance_variable_target_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1056
def visit_instance_variable_target_node(node)
  builder.assignable(builder.ivar(token(node.location)))
end</pre> </div>  <p>@foo, = bar ^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_instance_variable_write_node"> <a href="#method-i-visit_instance_variable_write_node" title="Link to this method"> <span class="method-name">visit_instance_variable_write_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_instance_variable_write_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1016
def visit_instance_variable_write_node(node)
  builder.assign(
    builder.assignable(builder.ivar(token(node.name_loc))),
    token(node.operator_loc),
    visit(node.value)
  )
end</pre> </div>  <p>@foo = 1 ^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_integer_node"> <a href="#method-i-visit_integer_node" title="Link to this method"> <span class="method-name">visit_integer_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_integer_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1062
def visit_integer_node(node)
  visit_numeric(node, builder.integer([node.value, srange(node.location)]))
end</pre> </div>  <p>1 ^</p> </div> </div> <div class="method-detail anchor-link method-alias"> <div class="method-header"> <div class="method-heading" id="method-i-visit_interpolated_match_last_line_node"> <a href="#method-i-visit_interpolated_match_last_line_node" title="Link to this method"> <span class="method-name">visit_interpolated_match_last_line_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-description"> <p>if /foo #{bar}/ then end</p> <pre>^^^^^^^^^^^^</pre> </div> <div class="aliases"> Alias for: <a href="compiler.html#method-i-visit_interpolated_regular_expression_node">visit_interpolated_regular_expression_node</a> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_interpolated_regular_expression_node"> <a href="#method-i-visit_interpolated_regular_expression_node" title="Link to this method"> <span class="method-name">visit_interpolated_regular_expression_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_interpolated_regular_expression_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1068
def visit_interpolated_regular_expression_node(node)
  builder.regexp_compose(
    token(node.opening_loc),
    visit_all(node.parts),
    [node.closing[0], srange_offsets(node.closing_loc.start_offset, node.closing_loc.start_offset + 1)],
    builder.regexp_options([node.closing[1..], srange_offsets(node.closing_loc.start_offset + 1, node.closing_loc.end_offset)])
  )
end</pre> </div>  <p>/foo #{bar}/ ^^^^^^^^^^^^</p> </div> <div class="aliases"> Also aliased as: <a href="compiler.html#method-i-visit_interpolated_match_last_line_node">visit_interpolated_match_last_line_node</a> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_interpolated_string_node"> <a href="#method-i-visit_interpolated_string_node" title="Link to this method"> <span class="method-name">visit_interpolated_string_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_interpolated_string_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1083
def visit_interpolated_string_node(node)
  if node.heredoc?
    return visit_heredoc(node) { |children, closing| builder.string_compose(token(node.opening_loc), children, closing) }
  end

  parts = if node.parts.one? { |part| part.type == :string_node }
    node.parts.flat_map do |node|
      if node.type == :string_node &amp;&amp; node.unescaped.lines.count &gt;= 2
        start_offset = node.content_loc.start_offset

        node.unescaped.lines.map do |line|
          end_offset = start_offset + line.length
          offsets = srange_offsets(start_offset, end_offset)
          start_offset = end_offset

          builder.string_internal([line, offsets])
        end
      else
        visit(node)
      end
    end
  else
    visit_all(node.parts)
  end

  builder.string_compose(
    token(node.opening_loc),
    parts,
    token(node.closing_loc)
  )
end</pre> </div>  <p>“foo #{bar}” ^^^^^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_interpolated_symbol_node"> <a href="#method-i-visit_interpolated_symbol_node" title="Link to this method"> <span class="method-name">visit_interpolated_symbol_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_interpolated_symbol_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1117
def visit_interpolated_symbol_node(node)
  builder.symbol_compose(
    token(node.opening_loc),
    visit_all(node.parts),
    token(node.closing_loc)
  )
end</pre> </div>  <p>:“foo #{bar}” ^^^^^^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_interpolated_x_string_node"> <a href="#method-i-visit_interpolated_x_string_node" title="Link to this method"> <span class="method-name">visit_interpolated_x_string_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_interpolated_x_string_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1127
def visit_interpolated_x_string_node(node)
  if node.heredoc?
    visit_heredoc(node) { |children, closing| builder.xstring_compose(token(node.opening_loc), children, closing) }
  else
    builder.xstring_compose(
      token(node.opening_loc),
      visit_all(node.parts),
      token(node.closing_loc)
    )
  end
end</pre> </div>  <p>‘foo #{bar}` ^^^^^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_it_local_variable_read_node"> <a href="#method-i-visit_it_local_variable_read_node" title="Link to this method"> <span class="method-name">visit_it_local_variable_read_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_it_local_variable_read_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1141
def visit_it_local_variable_read_node(node)
  builder.ident([:it, srange(node.location)]).updated(:lvar)
end</pre> </div>  <p>-&gt; { it }</p> <pre>^^</pre> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_it_parameters_node"> <a href="#method-i-visit_it_parameters_node" title="Link to this method"> <span class="method-name">visit_it_parameters_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_it_parameters_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1147
def visit_it_parameters_node(node)
  builder.args(nil, [], nil, false)
end</pre> </div>  <p>-&gt; { it } ^^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_keyword_hash_node"> <a href="#method-i-visit_keyword_hash_node" title="Link to this method"> <span class="method-name">visit_keyword_hash_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_keyword_hash_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1153
def visit_keyword_hash_node(node)
  builder.associate(nil, visit_all(node.elements), nil)
end</pre> </div>  <p>foo(bar: baz)</p> <pre>^^^^^^^^</pre> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_keyword_rest_parameter_node"> <a href="#method-i-visit_keyword_rest_parameter_node" title="Link to this method"> <span class="method-name">visit_keyword_rest_parameter_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_keyword_rest_parameter_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1162
def visit_keyword_rest_parameter_node(node)
  builder.kwrestarg(
    token(node.operator_loc),
    node.name ? [node.name, srange(node.name_loc)] : nil
  )
end</pre> </div>  <p>def foo(**bar); end</p> <pre>^^^^^</pre> <p>def foo(**); end</p> <pre>^^</pre> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_lambda_node"> <a href="#method-i-visit_lambda_node" title="Link to this method"> <span class="method-name">visit_lambda_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_lambda_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1171
def visit_lambda_node(node)
  parameters = node.parameters
  implicit_parameters = parameters.is_a?(NumberedParametersNode) || parameters.is_a?(ItParametersNode)

  builder.block(
    builder.call_lambda(token(node.operator_loc)),
    [node.opening, srange(node.opening_loc)],
    if parameters.nil?
      builder.args(nil, [], nil, false)
    elsif implicit_parameters
      visit(node.parameters)
    else
      builder.args(
        token(node.parameters.opening_loc),
        visit(node.parameters),
        token(node.parameters.closing_loc),
        false
      )
    end,
    node.body&amp;.accept(copy_compiler(forwarding: implicit_parameters ? [] : find_forwarding(parameters&amp;.parameters))),
    [node.closing, srange(node.closing_loc)]
  )
end</pre> </div>  <p>-&gt; {} ^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_local_variable_and_write_node"> <a href="#method-i-visit_local_variable_and_write_node" title="Link to this method"> <span class="method-name">visit_local_variable_and_write_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_local_variable_and_write_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1223
def visit_local_variable_and_write_node(node)
  builder.op_assign(
    builder.assignable(builder.ident(token(node.name_loc))),
    [node.operator_loc.slice.chomp("="), srange(node.operator_loc)],
    visit(node.value)
  )
end</pre> </div>  <p>foo &amp;&amp;= bar ^^^^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_local_variable_operator_write_node"> <a href="#method-i-visit_local_variable_operator_write_node" title="Link to this method"> <span class="method-name">visit_local_variable_operator_write_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_local_variable_operator_write_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1213
def visit_local_variable_operator_write_node(node)
  builder.op_assign(
    builder.assignable(builder.ident(token(node.name_loc))),
    [node.binary_operator_loc.slice.chomp("="), srange(node.binary_operator_loc)],
    visit(node.value)
  )
end</pre> </div>  <p>foo += bar ^^^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_local_variable_or_write_node"> <a href="#method-i-visit_local_variable_or_write_node" title="Link to this method"> <span class="method-name">visit_local_variable_or_write_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_local_variable_or_write_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1233
def visit_local_variable_or_write_node(node)
  builder.op_assign(
    builder.assignable(builder.ident(token(node.name_loc))),
    [node.operator_loc.slice.chomp("="), srange(node.operator_loc)],
    visit(node.value)
  )
end</pre> </div>  <p>foo ||= bar ^^^^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_local_variable_read_node"> <a href="#method-i-visit_local_variable_read_node" title="Link to this method"> <span class="method-name">visit_local_variable_read_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_local_variable_read_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1197
def visit_local_variable_read_node(node)
  builder.ident([node.name, srange(node.location)]).updated(:lvar)
end</pre> </div>  <p>foo ^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_local_variable_target_node"> <a href="#method-i-visit_local_variable_target_node" title="Link to this method"> <span class="method-name">visit_local_variable_target_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_local_variable_target_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1243
def visit_local_variable_target_node(node)
  if in_pattern
    builder.assignable(builder.match_var([node.name, srange(node.location)]))
  else
    builder.assignable(builder.ident(token(node.location)))
  end
end</pre> </div>  <p>foo, = bar ^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_local_variable_write_node"> <a href="#method-i-visit_local_variable_write_node" title="Link to this method"> <span class="method-name">visit_local_variable_write_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_local_variable_write_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1203
def visit_local_variable_write_node(node)
  builder.assign(
    builder.assignable(builder.ident(token(node.name_loc))),
    token(node.operator_loc),
    visit(node.value)
  )
end</pre> </div>  <p>foo = 1 ^^^^^^^</p> </div> </div> <div class="method-detail anchor-link method-alias"> <div class="method-header"> <div class="method-heading" id="method-i-visit_match_last_line_node"> <a href="#method-i-visit_match_last_line_node" title="Link to this method"> <span class="method-name">visit_match_last_line_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-description"> <p>if /foo/ then end</p> <pre>^^^^^</pre> </div> <div class="aliases"> Alias for: <a href="compiler.html#method-i-visit_regular_expression_node">visit_regular_expression_node</a> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_match_predicate_node"> <a href="#method-i-visit_match_predicate_node" title="Link to this method"> <span class="method-name">visit_match_predicate_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_match_predicate_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1253
def visit_match_predicate_node(node)
  builder.match_pattern_p(
    visit(node.value),
    token(node.operator_loc),
    within_pattern { |compiler| node.pattern.accept(compiler) }
  )
end</pre> </div>  <p>foo in bar ^^^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_match_required_node"> <a href="#method-i-visit_match_required_node" title="Link to this method"> <span class="method-name">visit_match_required_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_match_required_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1263
def visit_match_required_node(node)
  builder.match_pattern(
    visit(node.value),
    token(node.operator_loc),
    within_pattern { |compiler| node.pattern.accept(compiler) }
  )
end</pre> </div>  <p>foo =&gt; bar ^^^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_match_write_node"> <a href="#method-i-visit_match_write_node" title="Link to this method"> <span class="method-name">visit_match_write_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_match_write_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1273
def visit_match_write_node(node)
  builder.match_op(
    visit(node.call.receiver),
    token(node.call.message_loc),
    visit(node.call.arguments.arguments.first)
  )
end</pre> </div>  <p>/(?&lt;foo&gt;foo)/ =~ bar ^^^^^^^^^^^^^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_missing_node"> <a href="#method-i-visit_missing_node" title="Link to this method"> <span class="method-name">visit_missing_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_missing_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1284
def visit_missing_node(node)
  ::AST::Node.new(:missing, [], location: ::Parser::Source::Map.new(srange(node.location)))
end</pre> </div>  <p>A node that is missing from the syntax tree. This is only used in the case of a syntax error. The parser gem doesn’t have such a concept, so we invent our own here.</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_module_node"> <a href="#method-i-visit_module_node" title="Link to this method"> <span class="method-name">visit_module_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_module_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1290
def visit_module_node(node)
  builder.def_module(
    token(node.module_keyword_loc),
    visit(node.constant_path),
    node.body&amp;.accept(copy_compiler(forwarding: [])),
    token(node.end_keyword_loc)
  )
end</pre> </div>  <p>module Foo; end ^^^^^^^^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_multi_target_node"> <a href="#method-i-visit_multi_target_node" title="Link to this method"> <span class="method-name">visit_multi_target_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_multi_target_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1301
def visit_multi_target_node(node)
  builder.multi_lhs(
    token(node.lparen_loc),
    visit_all(multi_target_elements(node)),
    token(node.rparen_loc)
  )
end</pre> </div>  <p>foo, bar = baz ^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_multi_write_node"> <a href="#method-i-visit_multi_write_node" title="Link to this method"> <span class="method-name">visit_multi_write_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_multi_write_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1311
def visit_multi_write_node(node)
  elements = multi_target_elements(node)

  if elements.length == 1 &amp;&amp; elements.first.is_a?(MultiTargetNode)
    elements = multi_target_elements(elements.first)
  end

  builder.multi_assign(
    builder.multi_lhs(
      token(node.lparen_loc),
      visit_all(elements),
      token(node.rparen_loc)
    ),
    token(node.operator_loc),
    visit(node.value)
  )
end</pre> </div>  <p>foo, bar = baz ^^^^^^^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_next_node"> <a href="#method-i-visit_next_node" title="Link to this method"> <span class="method-name">visit_next_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_next_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1334
def visit_next_node(node)
  builder.keyword_cmd(
    :next,
    token(node.keyword_loc),
    nil,
    visit(node.arguments) || [],
    nil
  )
end</pre> </div>  <p>next ^^^^</p> <p>next foo ^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_nil_node"> <a href="#method-i-visit_nil_node" title="Link to this method"> <span class="method-name">visit_nil_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_nil_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1346
def visit_nil_node(node)
  builder.nil(token(node.location))
end</pre> </div>  <p>nil ^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_no_keywords_parameter_node"> <a href="#method-i-visit_no_keywords_parameter_node" title="Link to this method"> <span class="method-name">visit_no_keywords_parameter_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_no_keywords_parameter_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1352
def visit_no_keywords_parameter_node(node)
  if in_pattern
    builder.match_nil_pattern(token(node.operator_loc), token(node.keyword_loc))
  else
    builder.kwnilarg(token(node.operator_loc), token(node.keyword_loc))
  end
end</pre> </div>  <p>def foo(**nil); end</p> <pre>^^^^^</pre> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_numbered_parameters_node"> <a href="#method-i-visit_numbered_parameters_node" title="Link to this method"> <span class="method-name">visit_numbered_parameters_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_numbered_parameters_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1362
def visit_numbered_parameters_node(node)
  builder.numargs(node.maximum)
end</pre> </div>  <p>-&gt; { _1 + _2 } ^^^^^^^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_numbered_reference_read_node"> <a href="#method-i-visit_numbered_reference_read_node" title="Link to this method"> <span class="method-name">visit_numbered_reference_read_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_numbered_reference_read_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1368
def visit_numbered_reference_read_node(node)
  builder.nth_ref([node.number, srange(node.location)])
end</pre> </div>  <p>$1 ^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_optional_keyword_parameter_node"> <a href="#method-i-visit_optional_keyword_parameter_node" title="Link to this method"> <span class="method-name">visit_optional_keyword_parameter_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_optional_keyword_parameter_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1374
def visit_optional_keyword_parameter_node(node)
  builder.kwoptarg([node.name, srange(node.name_loc)], visit(node.value))
end</pre> </div>  <p>def foo(bar: baz); end</p> <pre>^^^^^^^^</pre> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_optional_parameter_node"> <a href="#method-i-visit_optional_parameter_node" title="Link to this method"> <span class="method-name">visit_optional_parameter_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_optional_parameter_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1380
def visit_optional_parameter_node(node)
  builder.optarg(token(node.name_loc), token(node.operator_loc), visit(node.value))
end</pre> </div>  <p>def foo(bar = 1); end</p> <pre>^^^^^^^</pre> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_or_node"> <a href="#method-i-visit_or_node" title="Link to this method"> <span class="method-name">visit_or_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_or_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1386
def visit_or_node(node)
  builder.logical_op(:or, visit(node.left), token(node.operator_loc), visit(node.right))
end</pre> </div>  <p>a or b ^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_parameters_node"> <a href="#method-i-visit_parameters_node" title="Link to this method"> <span class="method-name">visit_parameters_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_parameters_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1392
def visit_parameters_node(node)
  params = []

  if node.requireds.any?
    node.requireds.each do |required|
      params &lt;&lt;
        if required.is_a?(RequiredParameterNode)
          visit(required)
        else
          required.accept(copy_compiler(in_destructure: true))
        end
    end
  end

  params.concat(visit_all(node.optionals)) if node.optionals.any?
  params &lt;&lt; visit(node.rest) if !node.rest.nil? &amp;&amp; !node.rest.is_a?(ImplicitRestNode)

  if node.posts.any?
    node.posts.each do |post|
      params &lt;&lt;
        if post.is_a?(RequiredParameterNode)
          visit(post)
        else
          post.accept(copy_compiler(in_destructure: true))
        end
    end
  end

  params.concat(visit_all(node.keywords)) if node.keywords.any?
  params &lt;&lt; visit(node.keyword_rest) if !node.keyword_rest.nil?
  params &lt;&lt; visit(node.block) if !node.block.nil?
  params
end</pre> </div>  <p>def foo(bar, *baz); end</p> <pre>^^^^^^^^^</pre> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_parentheses_node"> <a href="#method-i-visit_parentheses_node" title="Link to this method"> <span class="method-name">visit_parentheses_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_parentheses_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1431
def visit_parentheses_node(node)
  builder.begin(
    token(node.opening_loc),
    visit(node.body),
    token(node.closing_loc)
  )
end</pre> </div>  <p>() ^^</p> <p>(1) ^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_pinned_expression_node"> <a href="#method-i-visit_pinned_expression_node" title="Link to this method"> <span class="method-name">visit_pinned_expression_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_pinned_expression_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1441
def visit_pinned_expression_node(node)
  expression = builder.begin(token(node.lparen_loc), visit(node.expression), token(node.rparen_loc))
  builder.pin(token(node.operator_loc), expression)
end</pre> </div>  <p>foo =&gt; ^(bar)</p> <pre>^^^^^^</pre> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_pinned_variable_node"> <a href="#method-i-visit_pinned_variable_node" title="Link to this method"> <span class="method-name">visit_pinned_variable_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_pinned_variable_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1448
def visit_pinned_variable_node(node)
  builder.pin(token(node.operator_loc), visit(node.variable))
end</pre> </div>  <p>foo = 1 and bar =&gt; ^foo</p> <pre>^^^^</pre> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_post_execution_node"> <a href="#method-i-visit_post_execution_node" title="Link to this method"> <span class="method-name">visit_post_execution_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_post_execution_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1453
def visit_post_execution_node(node)
  builder.postexe(
    token(node.keyword_loc),
    token(node.opening_loc),
    visit(node.statements),
    token(node.closing_loc)
  )
end</pre> </div>  <p>END {}</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_pre_execution_node"> <a href="#method-i-visit_pre_execution_node" title="Link to this method"> <span class="method-name">visit_pre_execution_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_pre_execution_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1463
def visit_pre_execution_node(node)
  builder.preexe(
    token(node.keyword_loc),
    token(node.opening_loc),
    visit(node.statements),
    token(node.closing_loc)
  )
end</pre> </div>  <p>BEGIN {}</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_program_node"> <a href="#method-i-visit_program_node" title="Link to this method"> <span class="method-name">visit_program_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_program_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1473
def visit_program_node(node)
  visit(node.statements)
end</pre> </div>  <p>The top-level program node.</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_range_node"> <a href="#method-i-visit_range_node" title="Link to this method"> <span class="method-name">visit_range_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_range_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1479
def visit_range_node(node)
  if node.exclude_end?
    builder.range_exclusive(
      visit(node.left),
      token(node.operator_loc),
      visit(node.right)
    )
  else
    builder.range_inclusive(
      visit(node.left),
      token(node.operator_loc),
      visit(node.right)
    )
  end
end</pre> </div>  <p>0..5 ^^^^</p> </div> <div class="aliases"> Also aliased as: <a href="compiler.html#method-i-visit_flip_flop_node">visit_flip_flop_node</a> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_rational_node"> <a href="#method-i-visit_rational_node" title="Link to this method"> <span class="method-name">visit_rational_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_rational_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1501
def visit_rational_node(node)
  visit_numeric(node, builder.rational([node.value, srange(node.location)]))
end</pre> </div>  <p>1r ^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_redo_node"> <a href="#method-i-visit_redo_node" title="Link to this method"> <span class="method-name">visit_redo_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_redo_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1507
def visit_redo_node(node)
  builder.keyword_cmd(:redo, token(node.location))
end</pre> </div>  <p>redo ^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_regular_expression_node"> <a href="#method-i-visit_regular_expression_node" title="Link to this method"> <span class="method-name">visit_regular_expression_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_regular_expression_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1513
def visit_regular_expression_node(node)
  content = node.content
  parts =
    if content.include?("\n")
      offset = node.content_loc.start_offset
      content.lines.map do |line|
        builder.string_internal([line, srange_offsets(offset, offset += line.bytesize)])
      end
    else
      [builder.string_internal(token(node.content_loc))]
    end

  builder.regexp_compose(
    token(node.opening_loc),
    parts,
    [node.closing[0], srange_offsets(node.closing_loc.start_offset, node.closing_loc.start_offset + 1)],
    builder.regexp_options([node.closing[1..], srange_offsets(node.closing_loc.start_offset + 1, node.closing_loc.end_offset)])
  )
end</pre> </div>  <p>/foo/ ^^^^^</p> </div> <div class="aliases"> Also aliased as: <a href="compiler.html#method-i-visit_match_last_line_node">visit_match_last_line_node</a> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_required_keyword_parameter_node"> <a href="#method-i-visit_required_keyword_parameter_node" title="Link to this method"> <span class="method-name">visit_required_keyword_parameter_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_required_keyword_parameter_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1539
def visit_required_keyword_parameter_node(node)
  builder.kwarg([node.name, srange(node.name_loc)])
end</pre> </div>  <p>def foo(bar:); end</p> <pre>^^^^</pre> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_required_parameter_node"> <a href="#method-i-visit_required_parameter_node" title="Link to this method"> <span class="method-name">visit_required_parameter_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_required_parameter_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1545
def visit_required_parameter_node(node)
  builder.arg(token(node.location))
end</pre> </div>  <p>def foo(bar); end</p> <pre>^^^</pre> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_rescue_modifier_node"> <a href="#method-i-visit_rescue_modifier_node" title="Link to this method"> <span class="method-name">visit_rescue_modifier_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_rescue_modifier_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1551
def visit_rescue_modifier_node(node)
  builder.begin_body(
    visit(node.expression),
    [
      builder.rescue_body(
        token(node.keyword_loc),
        nil,
        nil,
        nil,
        nil,
        visit(node.rescue_expression)
      )
    ]
  )
end</pre> </div>  <p>foo rescue bar ^^^^^^^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_rescue_node"> <a href="#method-i-visit_rescue_node" title="Link to this method"> <span class="method-name">visit_rescue_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_rescue_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1569
def visit_rescue_node(node)
  raise CompilationError, "Cannot directly compile rescue nodes"
end</pre> </div>  <p>begin; rescue; end</p> <pre>^^^^^^^</pre> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_rest_parameter_node"> <a href="#method-i-visit_rest_parameter_node" title="Link to this method"> <span class="method-name">visit_rest_parameter_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_rest_parameter_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1578
def visit_rest_parameter_node(node)
  builder.restarg(token(node.operator_loc), token(node.name_loc))
end</pre> </div>  <p>def foo(*bar); end</p> <pre>^^^^</pre> <p>def foo(*); end</p> <pre>^</pre> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_retry_node"> <a href="#method-i-visit_retry_node" title="Link to this method"> <span class="method-name">visit_retry_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_retry_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1584
def visit_retry_node(node)
  builder.keyword_cmd(:retry, token(node.location))
end</pre> </div>  <p>retry ^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_return_node"> <a href="#method-i-visit_return_node" title="Link to this method"> <span class="method-name">visit_return_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_return_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1593
def visit_return_node(node)
  builder.keyword_cmd(
    :return,
    token(node.keyword_loc),
    nil,
    visit(node.arguments) || [],
    nil
  )
end</pre> </div>  <p>return ^^^^^^</p> <p>return 1 ^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_self_node"> <a href="#method-i-visit_self_node" title="Link to this method"> <span class="method-name">visit_self_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_self_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1605
def visit_self_node(node)
  builder.self(token(node.location))
end</pre> </div>  <p>self ^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_shareable_constant_node"> <a href="#method-i-visit_shareable_constant_node" title="Link to this method"> <span class="method-name">visit_shareable_constant_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_shareable_constant_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1610
def visit_shareable_constant_node(node)
  visit(node.write)
end</pre> </div>  <p>A shareable constant.</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_singleton_class_node"> <a href="#method-i-visit_singleton_class_node" title="Link to this method"> <span class="method-name">visit_singleton_class_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_singleton_class_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1616
def visit_singleton_class_node(node)
  builder.def_sclass(
    token(node.class_keyword_loc),
    token(node.operator_loc),
    visit(node.expression),
    node.body&amp;.accept(copy_compiler(forwarding: [])),
    token(node.end_keyword_loc)
  )
end</pre> </div>  <p>class &lt;&lt; self; end ^^^^^^^^^^^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_source_encoding_node"> <a href="#method-i-visit_source_encoding_node" title="Link to this method"> <span class="method-name">visit_source_encoding_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_source_encoding_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1628
def visit_source_encoding_node(node)
  builder.accessible(builder.__ENCODING__(token(node.location)))
end</pre> </div>  <p>__ENCODING__ ^^^^^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_source_file_node"> <a href="#method-i-visit_source_file_node" title="Link to this method"> <span class="method-name">visit_source_file_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_source_file_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1634
def visit_source_file_node(node)
  builder.accessible(builder.__FILE__(token(node.location)))
end</pre> </div>  <p>__FILE__ ^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_source_line_node"> <a href="#method-i-visit_source_line_node" title="Link to this method"> <span class="method-name">visit_source_line_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_source_line_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1640
def visit_source_line_node(node)
  builder.accessible(builder.__LINE__(token(node.location)))
end</pre> </div>  <p>__LINE__ ^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_splat_node"> <a href="#method-i-visit_splat_node" title="Link to this method"> <span class="method-name">visit_splat_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_splat_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1652
def visit_splat_node(node)
  if node.expression.nil? &amp;&amp; forwarding.include?(:*)
    builder.forwarded_restarg(token(node.operator_loc))
  elsif in_destructure
    builder.restarg(token(node.operator_loc), token(node.expression&amp;.location))
  elsif in_pattern
    builder.match_rest(token(node.operator_loc), token(node.expression&amp;.location))
  else
    builder.splat(token(node.operator_loc), visit(node.expression))
  end
end</pre> </div>  <p>foo(*bar)</p> <pre>^^^^</pre> <p>def foo((bar, *baz)); end</p> <pre>^^^^</pre> <p>def foo(*); bar(*); end</p> <pre>^</pre> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_statements_node"> <a href="#method-i-visit_statements_node" title="Link to this method"> <span class="method-name">visit_statements_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_statements_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1665
def visit_statements_node(node)
  builder.compstmt(visit_all(node.body))
end</pre> </div>  <p>A list of statements.</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_string_node"> <a href="#method-i-visit_string_node" title="Link to this method"> <span class="method-name">visit_string_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_string_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1671
def visit_string_node(node)
  if node.heredoc?
    visit_heredoc(node.to_interpolated) { |children, closing| builder.string_compose(token(node.opening_loc), children, closing) }
  elsif node.opening == "?"
    builder.character([node.unescaped, srange(node.location)])
  elsif node.opening&amp;.start_with?("%") &amp;&amp; node.unescaped.empty?
    builder.string_compose(token(node.opening_loc), [], token(node.closing_loc))
  else
    content_lines = node.content.lines
    unescaped_lines = node.unescaped.lines

    parts =
      if content_lines.length &lt;= 1 || unescaped_lines.length &lt;= 1
        [builder.string_internal([node.unescaped, srange(node.content_loc)])]
      elsif content_lines.length != unescaped_lines.length
        # This occurs when we have line continuations in the string. We
        # need to come back and fix this, but for now this stops the
        # code from breaking when we encounter it because of trying to
        # transpose arrays of different lengths.
        [builder.string_internal([node.unescaped, srange(node.content_loc)])]
      else
        start_offset = node.content_loc.start_offset

        [content_lines, unescaped_lines].transpose.map do |content_line, unescaped_line|
          end_offset = start_offset + content_line.length
          offsets = srange_offsets(start_offset, end_offset)
          start_offset = end_offset

          builder.string_internal([unescaped_line, offsets])
        end
      end

    builder.string_compose(
      token(node.opening_loc),
      parts,
      token(node.closing_loc)
    )
  end
end</pre> </div>  <p>“foo” ^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_super_node"> <a href="#method-i-visit_super_node" title="Link to this method"> <span class="method-name">visit_super_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_super_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1713
def visit_super_node(node)
  arguments = node.arguments&amp;.arguments || []
  block = node.block

  if block.is_a?(BlockArgumentNode)
    arguments = [*arguments, block]
    block = nil
  end

  visit_block(
    builder.keyword_cmd(
      :super,
      token(node.keyword_loc),
      token(node.lparen_loc),
      visit_all(arguments),
      token(node.rparen_loc)
    ),
    block
  )
end</pre> </div>  <p>super(foo) ^^^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_symbol_node"> <a href="#method-i-visit_symbol_node" title="Link to this method"> <span class="method-name">visit_symbol_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_symbol_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1736
def visit_symbol_node(node)
  if node.closing_loc.nil?
    if node.opening_loc.nil?
      builder.symbol_internal([node.unescaped, srange(node.location)])
    else
      builder.symbol([node.unescaped, srange(node.location)])
    end
  else
    parts = if node.value.lines.one?
      [builder.string_internal([node.unescaped, srange(node.value_loc)])]
    else
      start_offset = node.value_loc.start_offset

      node.value.lines.map do |line|
        end_offset = start_offset + line.length
        offsets = srange_offsets(start_offset, end_offset)
        start_offset = end_offset

        builder.string_internal([line, offsets])
      end
    end

    builder.symbol_compose(
      token(node.opening_loc),
      parts,
      token(node.closing_loc)
    )
  end
end</pre> </div>  <p>:foo ^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_true_node"> <a href="#method-i-visit_true_node" title="Link to this method"> <span class="method-name">visit_true_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_true_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1768
def visit_true_node(node)
  builder.true(token(node.location))
end</pre> </div>  <p>true ^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_undef_node"> <a href="#method-i-visit_undef_node" title="Link to this method"> <span class="method-name">visit_undef_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_undef_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1774
def visit_undef_node(node)
  builder.undef_method(token(node.keyword_loc), visit_all(node.names))
end</pre> </div>  <p>undef foo ^^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_unless_node"> <a href="#method-i-visit_unless_node" title="Link to this method"> <span class="method-name">visit_unless_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_unless_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1783
def visit_unless_node(node)
  if node.keyword_loc.start_offset == node.location.start_offset
    builder.condition(
      token(node.keyword_loc),
      visit(node.predicate),
      if (then_keyword_loc = node.then_keyword_loc)
        token(then_keyword_loc)
      else
        srange_find(node.predicate.location.end_offset, (node.statements&amp;.location || node.else_clause&amp;.location || node.end_keyword_loc).start_offset, ";")
      end,
      visit(node.else_clause),
      token(node.else_clause&amp;.else_keyword_loc),
      visit(node.statements),
      token(node.end_keyword_loc)
    )
  else
    builder.condition_mod(
      visit(node.else_clause),
      visit(node.statements),
      token(node.keyword_loc),
      visit(node.predicate)
    )
  end
end</pre> </div>  <p>unless foo; bar end ^^^^^^^^^^^^^^^^^^^</p> <p>bar unless foo ^^^^^^^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_until_node"> <a href="#method-i-visit_until_node" title="Link to this method"> <span class="method-name">visit_until_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_until_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1813
def visit_until_node(node)
  if node.location.start_offset == node.keyword_loc.start_offset
    builder.loop(
      :until,
      token(node.keyword_loc),
      visit(node.predicate),
      if (do_keyword_loc = node.do_keyword_loc)
        token(do_keyword_loc)
      else
        srange_find(node.predicate.location.end_offset, (node.statements&amp;.location || node.closing_loc).start_offset, ";")
      end,
      visit(node.statements),
      token(node.closing_loc)
    )
  else
    builder.loop_mod(
      :until,
      visit(node.statements),
      token(node.keyword_loc),
      visit(node.predicate)
    )
  end
end</pre> </div>  <p>until foo; bar end ^^^^^^^^^^^^^^^^^^</p> <p>bar until foo ^^^^^^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_when_node"> <a href="#method-i-visit_when_node" title="Link to this method"> <span class="method-name">visit_when_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_when_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1839
def visit_when_node(node)
  builder.when(
    token(node.keyword_loc),
    visit_all(node.conditions),
    if (then_keyword_loc = node.then_keyword_loc)
      token(then_keyword_loc)
    else
      srange_find(node.conditions.last.location.end_offset, node.statements&amp;.location&amp;.start_offset, ";")
    end,
    visit(node.statements)
  )
end</pre> </div>  <p>case foo; when bar; end</p> <pre>^^^^^^^^^^^^^</pre> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_while_node"> <a href="#method-i-visit_while_node" title="Link to this method"> <span class="method-name">visit_while_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_while_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1857
def visit_while_node(node)
  if node.location.start_offset == node.keyword_loc.start_offset
    builder.loop(
      :while,
      token(node.keyword_loc),
      visit(node.predicate),
      if (do_keyword_loc = node.do_keyword_loc)
        token(do_keyword_loc)
      else
        srange_find(node.predicate.location.end_offset, (node.statements&amp;.location || node.closing_loc).start_offset, ";")
      end,
      visit(node.statements),
      token(node.closing_loc)
    )
  else
    builder.loop_mod(
      :while,
      visit(node.statements),
      token(node.keyword_loc),
      visit(node.predicate)
    )
  end
end</pre> </div>  <p>while foo; bar end ^^^^^^^^^^^^^^^^^^</p> <p>bar while foo ^^^^^^^^^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_x_string_node"> <a href="#method-i-visit_x_string_node" title="Link to this method"> <span class="method-name">visit_x_string_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_x_string_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1883
def visit_x_string_node(node)
  if node.heredoc?
    visit_heredoc(node.to_interpolated) { |children, closing| builder.xstring_compose(token(node.opening_loc), children, closing) }
  else
    parts = if node.unescaped.lines.one?
      [builder.string_internal([node.unescaped, srange(node.content_loc)])]
    else
      start_offset = node.content_loc.start_offset

      node.unescaped.lines.map do |line|
        end_offset = start_offset + line.length
        offsets = srange_offsets(start_offset, end_offset)
        start_offset = end_offset

        builder.string_internal([line, offsets])
      end
    end

    builder.xstring_compose(
      token(node.opening_loc),
      parts,
      token(node.closing_loc)
    )
  end
end</pre> </div>  <p>‘foo` ^^^^^</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_yield_node"> <a href="#method-i-visit_yield_node" title="Link to this method"> <span class="method-name">visit_yield_node</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_yield_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1914
def visit_yield_node(node)
  builder.keyword_cmd(
    :yield,
    token(node.keyword_loc),
    token(node.lparen_loc),
    visit(node.arguments) || [],
    token(node.rparen_loc)
  )
end</pre> </div>  <p>yield ^^^^^</p> <p>yield 1 ^^^^^^^</p> </div> </div> </section> <section id="private-instance-5Buntitled-5D-method-details" class="method-section anchor-link"> <header> <h3>Private Instance Methods</h3> </header> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-chomped_bytesize"> <a href="#method-i-chomped_bytesize" title="Link to this method"> <span class="method-name">chomped_bytesize</span> <span class="method-args">(line)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="chomped_bytesize-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 2055
def chomped_bytesize(line)
  chomped = line.chomp
  chomped.bytesize + (chomped == line ? 0 : 1)
end</pre> </div>  <p>The parser gem automatically converts rn to n, meaning our offsets need to be adjusted to always subtract 1 from the length.</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-copy_compiler"> <a href="#method-i-copy_compiler" title="Link to this method"> <span class="method-name">copy_compiler</span> <span class="method-args">(forwarding: self.forwarding, in_destructure: self.in_destructure, in_pattern: self.in_pattern)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="copy_compiler-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1928
def copy_compiler(forwarding: self.forwarding, in_destructure: self.in_destructure, in_pattern: self.in_pattern)
  Compiler.new(parser, offset_cache, forwarding: forwarding, in_destructure: in_destructure, in_pattern: in_pattern)
end</pre> </div>  <p>Initialize a new compiler with the given option overrides, used to visit a subtree with the given options.</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-find_forwarding"> <a href="#method-i-find_forwarding" title="Link to this method"> <span class="method-name">find_forwarding</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="find_forwarding-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1935
def find_forwarding(node)
  return [] if node.nil?

  forwarding = []
  forwarding &lt;&lt; :* if node.rest.is_a?(RestParameterNode) &amp;&amp; node.rest.name.nil?
  forwarding &lt;&lt; :** if node.keyword_rest.is_a?(KeywordRestParameterNode) &amp;&amp; node.keyword_rest.name.nil?
  forwarding &lt;&lt; :&amp; if !node.block.nil? &amp;&amp; node.block.name.nil?
  forwarding |= [:&amp;, :"..."] if node.keyword_rest.is_a?(ForwardingParameterNode)

  forwarding
end</pre> </div>  <p>When *, **, &amp;, or … are used as an argument in a method call, we check if they were allowed by the current context. To determine that we build this lookup table.</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-multi_target_elements"> <a href="#method-i-multi_target_elements" title="Link to this method"> <span class="method-name">multi_target_elements</span> <span class="method-args">(node)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="multi_target_elements-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1948
def multi_target_elements(node)
  elements = [*node.lefts]
  elements &lt;&lt; node.rest if !node.rest.nil? &amp;&amp; !node.rest.is_a?(ImplicitRestNode)
  elements.concat(node.rights)
  elements
end</pre> </div>  <p>Returns the set of targets for a <a href="../../multitargetnode.html"><code>MultiTargetNode</code></a> or a <a href="../../multiwritenode.html"><code>MultiWriteNode</code></a>.</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-numeric_negate"> <a href="#method-i-numeric_negate" title="Link to this method"> <span class="method-name">numeric_negate</span> <span class="method-args">(message_loc, receiver)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="numeric_negate-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1960
def numeric_negate(message_loc, receiver)
  case receiver.type
  when :integer_node, :float_node
    receiver.copy(value: -receiver.value, location: message_loc.join(receiver.location))
  when :rational_node
    receiver.copy(numerator: -receiver.numerator, location: message_loc.join(receiver.location))
  when :imaginary_node
    receiver.copy(numeric: numeric_negate(message_loc, receiver.numeric), location: message_loc.join(receiver.location))
  end
end</pre> </div>  <p>Negate the value of a numeric node. This is a special case where you have a negative sign on one line and then a number on the next line. In normal Ruby, this will always be a method call. The parser gem, however, marks this as a numeric literal. We have to massage the tree here to get it into the correct form.</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-procarg0-3F"> <a href="#method-i-procarg0-3F" title="Link to this method"> <span class="method-name">procarg0?</span> <span class="method-args">(parameters)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="procarg0-3F-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1974
def procarg0?(parameters)
  parameters &amp;&amp;
    parameters.requireds.length == 1 &amp;&amp;
    parameters.optionals.empty? &amp;&amp;
    parameters.rest.nil? &amp;&amp;
    parameters.posts.empty? &amp;&amp;
    parameters.keywords.empty? &amp;&amp;
    parameters.keyword_rest.nil? &amp;&amp;
    parameters.block.nil?
end</pre> </div>  <p>Blocks can have a special set of parameters that automatically expand when given arrays if they have a single required parameter and no other parameters.</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-srange"> <a href="#method-i-srange" title="Link to this method"> <span class="method-name">srange</span> <span class="method-args">(location)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="srange-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1991
def srange(location)
  Range.new(source_buffer, offset_cache[location.start_offset], offset_cache[location.end_offset]) if location
end</pre> </div>  <p>Constructs a new source range from the given start and end offsets.</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-srange_find"> <a href="#method-i-srange_find" title="Link to this method"> <span class="method-name">srange_find</span> <span class="method-args">(start_offset, end_offset, character)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="srange_find-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 2006
def srange_find(start_offset, end_offset, character)
  if (match = source_buffer.source.byteslice(start_offset...end_offset)[/\A\s*#{character}/])
    final_offset = start_offset + match.bytesize
    [character, Range.new(source_buffer, offset_cache[final_offset - character.bytesize], offset_cache[final_offset])]
  end
end</pre> </div>  <p>Constructs a new source range by finding the given character between the given start offset and end offset. If the needle is not found, it returns nil. Importantly it does not search past newlines or comments.</p> <p>Note that end_offset is allowed to be nil, in which case this will search until the end of the string.</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-srange_offsets"> <a href="#method-i-srange_offsets" title="Link to this method"> <span class="method-name">srange_offsets</span> <span class="method-args">(start_offset, end_offset)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="srange_offsets-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 1996
def srange_offsets(start_offset, end_offset)
  Range.new(source_buffer, offset_cache[start_offset], offset_cache[end_offset])
end</pre> </div>  <p>Constructs a new source range from the given start and end offsets.</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-token"> <a href="#method-i-token" title="Link to this method"> <span class="method-name">token</span> <span class="method-args">(location)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="token-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 2014
def token(location)
  [location.slice, Range.new(source_buffer, offset_cache[location.start_offset], offset_cache[location.end_offset])] if location
end</pre> </div>  <p>Transform a location into a token that the parser gem expects.</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_block"> <a href="#method-i-visit_block" title="Link to this method"> <span class="method-name">visit_block</span> <span class="method-args">(call, block)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_block-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 2019
def visit_block(call, block)
  if block
    parameters = block.parameters
    implicit_parameters = parameters.is_a?(NumberedParametersNode) || parameters.is_a?(ItParametersNode)

    builder.block(
      call,
      token(block.opening_loc),
      if parameters.nil?
        builder.args(nil, [], nil, false)
      elsif implicit_parameters
        visit(parameters)
      else
        builder.args(
          token(parameters.opening_loc),
          if procarg0?(parameters.parameters)
            parameter = parameters.parameters.requireds.first
            visited = parameter.is_a?(RequiredParameterNode) ? visit(parameter) : parameter.accept(copy_compiler(in_destructure: true))
            [builder.procarg0(visited)].concat(visit_all(parameters.locals))
          else
            visit(parameters)
          end,
          token(parameters.closing_loc),
          false
        )
      end,
      block.body&amp;.accept(copy_compiler(forwarding: implicit_parameters ? [] : find_forwarding(parameters&amp;.parameters))),
      token(block.closing_loc)
    )
  else
    call
  end
end</pre> </div>  <p>Visit a block node on a call.</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_heredoc"> <a href="#method-i-visit_heredoc" title="Link to this method"> <span class="method-name">visit_heredoc</span> <span class="method-args">(node) { |children, closing_t| ... }</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_heredoc-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 2061
def visit_heredoc(node)
  children = Array.new
  indented = false

  # If this is a dedenting heredoc, then we need to insert the opening
  # content into the children as well.
  if node.opening.start_with?("&lt;&lt;~") &amp;&amp; node.parts.length &gt; 0 &amp;&amp; !node.parts.first.is_a?(StringNode)
    location = node.parts.first.location
    location = location.copy(start_offset: location.start_offset - location.start_line_slice.bytesize)
    children &lt;&lt; builder.string_internal(token(location))
    indented = true
  end

  node.parts.each do |part|
    pushing =
      if part.is_a?(StringNode) &amp;&amp; part.unescaped.include?("\n")
        unescaped = part.unescaped.lines
        escaped = part.content.lines

        escaped_lengths = []
        normalized_lengths = []

        if node.opening.end_with?("'")
          escaped.each do |line|
            escaped_lengths &lt;&lt; line.bytesize
            normalized_lengths &lt;&lt; chomped_bytesize(line)
          end
        else
          escaped
            .chunk_while { |before, after| before.match?(/(?&lt;!\\)\\\r?\n$/) }
            .each do |lines|
              escaped_lengths &lt;&lt; lines.sum(&amp;:bytesize)
              normalized_lengths &lt;&lt; lines.sum { |line| chomped_bytesize(line) }
            end
        end

        start_offset = part.location.start_offset

        unescaped.map.with_index do |unescaped_line, index|
          inner_part = builder.string_internal([unescaped_line, srange_offsets(start_offset, start_offset + normalized_lengths.fetch(index, 0))])
          start_offset += escaped_lengths.fetch(index, 0)
          inner_part
        end
      else
        [visit(part)]
      end

    pushing.each do |child|
      if child.type == :str &amp;&amp; child.children.last == ""
        # nothing
      elsif child.type == :str &amp;&amp; children.last &amp;&amp; children.last.type == :str &amp;&amp; !children.last.children.first.end_with?("\n")
        appendee = children[-1]

        location = appendee.loc
        location = location.with_expression(location.expression.join(child.loc.expression))

        children[-1] = appendee.updated(:str, [appendee.children.first &lt;&lt; child.children.first], location: location)
      else
        children &lt;&lt; child
      end
    end
  end

  closing = node.closing
  closing_t = [closing.chomp, srange_offsets(node.closing_loc.start_offset, node.closing_loc.end_offset - (closing[/\s+$/]&amp;.length || 0))]
  composed = yield children, closing_t

  composed = composed.updated(nil, children[1..-1]) if indented
  composed
end</pre> </div>  <p>Visit a heredoc that can be either a string or an xstring.</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-visit_numeric"> <a href="#method-i-visit_numeric" title="Link to this method"> <span class="method-name">visit_numeric</span> <span class="method-args">(node, value)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="visit_numeric-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 2133
def visit_numeric(node, value)
  if (slice = node.slice).match?(/^[+-]/)
    builder.unary_num(
      [slice[0].to_sym, srange_offsets(node.location.start_offset, node.location.start_offset + 1)],
      value
    )
  else
    value
  end
end</pre> </div>  <p>Visit a numeric node and account for the optional sign.</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-within_pattern"> <a href="#method-i-within_pattern" title="Link to this method"> <span class="method-name">within_pattern</span> <span class="method-args">() { |copy_compiler(in_pattern: true)| ... }</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="within_pattern-source"> <pre class="ruby" data-language="ruby"># File lib/prism/translation/parser/compiler.rb, line 2145
def within_pattern
  begin
    parser.pattern_variables.push
    yield copy_compiler(in_pattern: true)
  ensure
    parser.pattern_variables.pop
  end
end</pre> </div>  <p>Within the given block, track that we’re within a pattern.</p> </div> </div> </section> </section><div class="_attribution">
  <p class="_attribution-p">
    Ruby Core &copy; 1993&ndash;2024 Yukihiro Matsumoto<br>Licensed under the Ruby License.<br>Ruby Standard Library &copy; contributors<br>Licensed under their own licenses.<br>
    
  </p>
</div>
