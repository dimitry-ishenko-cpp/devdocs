<h1 id="class-Prism::DesugarCompiler" class="class"> class Prism::DesugarCompiler </h1>
<dl class="meta">
<dt>Parent:</dt>
<dd class="meta-parent">MutationCompiler</dd>
</dl> <section class="description"> <p><a href="desugarcompiler.html"><code>DesugarCompiler</code></a> is a compiler that desugars Ruby code into a more primitive form. This is useful for consumers that want to deal with fewer node types.</p> </section> <section id="5Buntitled-5D" class="documentation-section"> <section id="public-instance-5Buntitled-5D-method-details" class="method-section"> <header> <h3>Public Instance Methods</h3> </header> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-visit_class_variable_and_write_node"> <span class="method-name">visit_class_variable_and_write_node</span><span class="method-args">(node)</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="visit_class_variable_and_write_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/desugar_compiler.rb, line 12
def visit_class_variable_and_write_node(node)
  desugar_and_write_node(node, ClassVariableReadNode, ClassVariableWriteNode, node.name)
end</pre> </div> <p>@@foo &amp;&amp;= bar</p> <p>becomes</p> <p>@@foo &amp;&amp; @@foo = bar</p>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-visit_class_variable_operator_write_node"> <span class="method-name">visit_class_variable_operator_write_node</span><span class="method-args">(node)</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="visit_class_variable_operator_write_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/desugar_compiler.rb, line 30
def visit_class_variable_operator_write_node(node)
  desugar_operator_write_node(node, ClassVariableReadNode, ClassVariableWriteNode, node.name)
end</pre> </div> <p>@@foo += bar</p> <p>becomes</p> <p>@@foo = @@foo + bar</p>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-visit_class_variable_or_write_node"> <span class="method-name">visit_class_variable_or_write_node</span><span class="method-args">(node)</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="visit_class_variable_or_write_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/desugar_compiler.rb, line 21
def visit_class_variable_or_write_node(node)
  desugar_or_write_defined_node(node, ClassVariableReadNode, ClassVariableWriteNode, node.name)
end</pre> </div> <p>@@foo ||= bar</p> <p>becomes</p> <p>defined?(@@foo) ? @@foo : @@foo = bar</p>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-visit_constant_and_write_node"> <span class="method-name">visit_constant_and_write_node</span><span class="method-args">(node)</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="visit_constant_and_write_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/desugar_compiler.rb, line 39
def visit_constant_and_write_node(node)
  desugar_and_write_node(node, ConstantReadNode, ConstantWriteNode, node.name)
end</pre> </div> <p>Foo &amp;&amp;= bar</p> <p>becomes</p> <p>Foo &amp;&amp; Foo = bar</p>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-visit_constant_operator_write_node"> <span class="method-name">visit_constant_operator_write_node</span><span class="method-args">(node)</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="visit_constant_operator_write_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/desugar_compiler.rb, line 57
def visit_constant_operator_write_node(node)
  desugar_operator_write_node(node, ConstantReadNode, ConstantWriteNode, node.name)
end</pre> </div> <p>Foo += bar</p> <p>becomes</p> <p>Foo = Foo + bar</p>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-visit_constant_or_write_node"> <span class="method-name">visit_constant_or_write_node</span><span class="method-args">(node)</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="visit_constant_or_write_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/desugar_compiler.rb, line 48
def visit_constant_or_write_node(node)
  desugar_or_write_defined_node(node, ConstantReadNode, ConstantWriteNode, node.name)
end</pre> </div> <p>Foo ||= bar</p> <p>becomes</p> <p>defined?(Foo) ? Foo : Foo = bar</p>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-visit_global_variable_and_write_node"> <span class="method-name">visit_global_variable_and_write_node</span><span class="method-args">(node)</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="visit_global_variable_and_write_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/desugar_compiler.rb, line 66
def visit_global_variable_and_write_node(node)
  desugar_and_write_node(node, GlobalVariableReadNode, GlobalVariableWriteNode, node.name)
end</pre> </div> <p>$foo &amp;&amp;= bar</p> <p>becomes</p> <p>$foo &amp;&amp; $foo = bar</p>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-visit_global_variable_operator_write_node"> <span class="method-name">visit_global_variable_operator_write_node</span><span class="method-args">(node)</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="visit_global_variable_operator_write_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/desugar_compiler.rb, line 84
def visit_global_variable_operator_write_node(node)
  desugar_operator_write_node(node, GlobalVariableReadNode, GlobalVariableWriteNode, node.name)
end</pre> </div> <p>$foo += bar</p> <p>becomes</p> <p>$foo = $foo + bar</p>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-visit_global_variable_or_write_node"> <span class="method-name">visit_global_variable_or_write_node</span><span class="method-args">(node)</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="visit_global_variable_or_write_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/desugar_compiler.rb, line 75
def visit_global_variable_or_write_node(node)
  desugar_or_write_defined_node(node, GlobalVariableReadNode, GlobalVariableWriteNode, node.name)
end</pre> </div> <p>$foo ||= bar</p> <p>becomes</p> <p>defined?($foo) ? $foo : $foo = bar</p>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-visit_instance_variable_and_write_node"> <span class="method-name">visit_instance_variable_and_write_node</span><span class="method-args">(node)</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="visit_instance_variable_and_write_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/desugar_compiler.rb, line 93
def visit_instance_variable_and_write_node(node)
  desugar_and_write_node(node, InstanceVariableReadNode, InstanceVariableWriteNode, node.name)
end</pre> </div> <p>@foo &amp;&amp;= bar</p> <p>becomes</p> <p>@foo &amp;&amp; @foo = bar</p>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-visit_instance_variable_operator_write_node"> <span class="method-name">visit_instance_variable_operator_write_node</span><span class="method-args">(node)</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="visit_instance_variable_operator_write_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/desugar_compiler.rb, line 111
def visit_instance_variable_operator_write_node(node)
  desugar_operator_write_node(node, InstanceVariableReadNode, InstanceVariableWriteNode, node.name)
end</pre> </div> <p>@foo += bar</p> <p>becomes</p> <p>@foo = @foo + bar</p>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-visit_instance_variable_or_write_node"> <span class="method-name">visit_instance_variable_or_write_node</span><span class="method-args">(node)</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="visit_instance_variable_or_write_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/desugar_compiler.rb, line 102
def visit_instance_variable_or_write_node(node)
  desugar_or_write_node(node, InstanceVariableReadNode, InstanceVariableWriteNode, node.name)
end</pre> </div> <p>@foo ||= bar</p> <p>becomes</p> <p>@foo || @foo = bar</p>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-visit_local_variable_and_write_node"> <span class="method-name">visit_local_variable_and_write_node</span><span class="method-args">(node)</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="visit_local_variable_and_write_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/desugar_compiler.rb, line 120
def visit_local_variable_and_write_node(node)
  desugar_and_write_node(node, LocalVariableReadNode, LocalVariableWriteNode, node.name, node.depth)
end</pre> </div> <p>foo &amp;&amp;= bar</p> <p>becomes</p> <p>foo &amp;&amp; foo = bar</p>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-visit_local_variable_operator_write_node"> <span class="method-name">visit_local_variable_operator_write_node</span><span class="method-args">(node)</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="visit_local_variable_operator_write_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/desugar_compiler.rb, line 138
def visit_local_variable_operator_write_node(node)
  desugar_operator_write_node(node, LocalVariableReadNode, LocalVariableWriteNode, node.name, node.depth)
end</pre> </div> <p>foo += bar</p> <p>becomes</p> <p>foo = foo + bar</p>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-visit_local_variable_or_write_node"> <span class="method-name">visit_local_variable_or_write_node</span><span class="method-args">(node)</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="visit_local_variable_or_write_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/desugar_compiler.rb, line 129
def visit_local_variable_or_write_node(node)
  desugar_or_write_node(node, LocalVariableReadNode, LocalVariableWriteNode, node.name, node.depth)
end</pre> </div> <p>foo ||= bar</p> <p>becomes</p> <p>foo || foo = bar</p>  </div> </div> </section> <section id="private-instance-5Buntitled-5D-method-details" class="method-section"> <header> <h3>Private Instance Methods</h3> </header> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-desugar_and_write_node"> <span class="method-name">desugar_and_write_node</span><span class="method-args">(node, read_class, write_class, *arguments)</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="desugar_and_write_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/desugar_compiler.rb, line 145
def desugar_and_write_node(node, read_class, write_class, *arguments)
  AndNode.new(
    read_class.new(*arguments, node.name_loc),
    write_class.new(*arguments, node.name_loc, node.value, node.operator_loc, node.location),
    node.operator_loc,
    node.location
  )
end</pre> </div> <p>Desugar ‘x &amp;&amp;= y` to `x &amp;&amp; x = y`</p>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-desugar_operator_write_node"> <span class="method-name">desugar_operator_write_node</span><span class="method-args">(node, read_class, write_class, *arguments)</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="desugar_operator_write_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/desugar_compiler.rb, line 155
def desugar_operator_write_node(node, read_class, write_class, *arguments)
  write_class.new(
    *arguments,
    node.name_loc,
    CallNode.new(
      0,
      read_class.new(*arguments, node.name_loc),
      nil,
      node.operator_loc.slice.chomp("="),
      node.operator_loc.copy(length: node.operator_loc.length - 1),
      nil,
      ArgumentsNode.new(0, [node.value], node.value.location),
      nil,
      nil,
      node.location
    ),
    node.operator_loc.copy(start_offset: node.operator_loc.end_offset - 1, length: 1),
    node.location
  )
end</pre> </div> <p>Desugar ‘x += y` to `x = x + y`</p>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-desugar_or_write_defined_node"> <span class="method-name">desugar_or_write_defined_node</span><span class="method-args">(node, read_class, write_class, *arguments)</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="desugar_or_write_defined_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/desugar_compiler.rb, line 187
def desugar_or_write_defined_node(node, read_class, write_class, *arguments)
  IfNode.new(
    node.operator_loc,
    DefinedNode.new(nil, read_class.new(*arguments, node.name_loc), nil, node.operator_loc, node.name_loc),
    node.operator_loc,
    StatementsNode.new([read_class.new(*arguments, node.name_loc)], node.location),
    ElseNode.new(
      node.operator_loc,
      StatementsNode.new(
        [write_class.new(*arguments, node.name_loc, node.value, node.operator_loc, node.location)],
        node.location
      ),
      node.operator_loc,
      node.location
    ),
    node.operator_loc,
    node.location
  )
end</pre> </div> <p>Desugar ‘x ||= y` to `defined?(x) ? x : x = y`</p>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-desugar_or_write_node"> <span class="method-name">desugar_or_write_node</span><span class="method-args">(node, read_class, write_class, *arguments)</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="desugar_or_write_node-source"> <pre class="ruby" data-language="ruby"># File lib/prism/desugar_compiler.rb, line 177
def desugar_or_write_node(node, read_class, write_class, *arguments)
  OrNode.new(
    read_class.new(*arguments, node.name_loc),
    write_class.new(*arguments, node.name_loc, node.value, node.operator_loc, node.location),
    node.operator_loc,
    node.location
  )
end</pre> </div> <p>Desugar ‘x ||= y` to `x || x = y`</p>  </div> </div> </section> </section><div class="_attribution">
  <p class="_attribution-p">
    Ruby Core &copy; 1993&ndash;2022 Yukihiro Matsumoto<br>Licensed under the Ruby License.<br>Ruby Standard Library &copy; contributors<br>Licensed under their own licenses.<br>
    
  </p>
</div>
