<h1 id="class-IPAddr" class="anchor-link class"> class IPAddr </h1>
<dl class="meta">
<dt>Parent:</dt>
<dd class="meta-parent"><a href="object.html">Object</a></dd>
<dt>Included modules:</dt>
<dd class="meta-includes"><a class="include" href="comparable.html">Comparable</a></dd>
</dl> <section class="description"> <p><a href="ipaddr.html"><code>IPAddr</code></a> provides a set of methods to manipulate an IP address. Both IPv4 and IPv6 are supported.</p> <h2 id="class-IPAddr-label-Example">Example</h2> <pre class="ruby" data-language="ruby">require 'ipaddr'

ipaddr1 = IPAddr.new "3ffe:505:2::1"

p ipaddr1                   #=&gt; #&lt;IPAddr: IPv6:3ffe:0505:0002:0000:0000:0000:0000:0001/ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff&gt;

p ipaddr1.to_s              #=&gt; "3ffe:505:2::1"

ipaddr2 = ipaddr1.mask(48)  #=&gt; #&lt;IPAddr: IPv6:3ffe:0505:0002:0000:0000:0000:0000:0000/ffff:ffff:ffff:0000:0000:0000:0000:0000&gt;

p ipaddr2.to_s              #=&gt; "3ffe:505:2::"

ipaddr3 = IPAddr.new "192.168.2.0/24"

p ipaddr3                   #=&gt; #&lt;IPAddr: IPv4:192.168.2.0/255.255.255.0&gt;
</pre> </section> <section id="5Buntitled-5D" class="documentation-section anchor-link"> <section class="constants-list"> <header> <h3>Constants</h3> </header> <dl> <dt id="IN4MASK">IN4MASK </dt>
<dd> <p>32 bit mask for IPv4</p> </dd>
<dt id="IN6FORMAT">IN6FORMAT </dt>
<dd> <p>Format string for IPv6</p> </dd>
<dt id="IN6MASK">IN6MASK </dt>
<dd> <p>128 bit mask for IPv6</p> </dd>
<dt id="RE_IPV4ADDRLIKE">RE_IPV4ADDRLIKE </dt>
<dd> <p><a href="regexp.html"><code>Regexp</code></a> <em>internally</em> used for parsing IPv4 address.</p> </dd>
<dt id="RE_IPV6ADDRLIKE_COMPRESSED">RE_IPV6ADDRLIKE_COMPRESSED </dt>
<dd> <p><a href="regexp.html"><code>Regexp</code></a> <em>internally</em> used for parsing IPv6 address.</p> </dd>
<dt id="RE_IPV6ADDRLIKE_FULL">RE_IPV6ADDRLIKE_FULL </dt>
<dd> <p><a href="regexp.html"><code>Regexp</code></a> <em>internally</em> used for parsing IPv6 address.</p> </dd>
<dt id="VERSION">VERSION </dt>

</dl> </section> <section class="attribute-method-details"> <header> <h3>Attributes</h3> </header> <div class="method-detail anchor-link"> <div class="method-heading attribute-method-heading" id="attribute-i-family"> <a href="#attribute-i-family" title="Link to this attribute"> <span class="method-name">family</span> <span class="attribute-access-type">[R]</span> </a> </div> <div class="method-description"> <p>Returns the address family of this IP address.</p> </div> </div> </section> <section id="public-class-5Buntitled-5D-method-details" class="method-section anchor-link"> <header> <h3>Public Class Methods</h3> </header> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-c-new"> <a href="#method-c-new" title="Link to this method"> <span class="method-name">new</span> <span class="method-args">(addr = '::', family = Socket::AF_UNSPEC)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="new-source"> <pre class="ruby" data-language="ruby"># File lib/ipaddr.rb, line 643
def initialize(addr = '::', family = Socket::AF_UNSPEC)
  @mask_addr = nil
  if !addr.kind_of?(String)
    case family
    when Socket::AF_INET, Socket::AF_INET6
      set(addr.to_i, family)
      @mask_addr = (family == Socket::AF_INET) ? IN4MASK : IN6MASK
      return
    when Socket::AF_UNSPEC
      raise AddressFamilyError, "address family must be specified"
    else
      raise AddressFamilyError, "unsupported address family: #{family}"
    end
  end
  prefix, prefixlen = addr.split('/', 2)
  if prefix =~ /\A\[(.*)\]\z/i
    prefix = $1
    family = Socket::AF_INET6
  end
  if prefix =~ /\A(.*)(%\w+)\z/
    prefix = $1
    zone_id = $2
    family = Socket::AF_INET6
  end
  # It seems AI_NUMERICHOST doesn't do the job.
  #Socket.getaddrinfo(left, nil, Socket::AF_INET6, Socket::SOCK_STREAM, nil,
  #                  Socket::AI_NUMERICHOST)
  @addr = @family = nil
  if family == Socket::AF_UNSPEC || family == Socket::AF_INET
    @addr = in_addr(prefix)
    if @addr
      @family = Socket::AF_INET
    end
  end
  if !@addr &amp;&amp; (family == Socket::AF_UNSPEC || family == Socket::AF_INET6)
    @addr = in6_addr(prefix)
    @family = Socket::AF_INET6
  end
  @zone_id = zone_id
  if family != Socket::AF_UNSPEC &amp;&amp; @family != family
    raise AddressFamilyError, "address family mismatch"
  end
  if prefixlen
    mask!(prefixlen)
  else
    @mask_addr = (@family == Socket::AF_INET) ? IN4MASK : IN6MASK
  end
end</pre> </div>  <p>Creates a new ipaddr object either from a human readable IP address representation in string, or from a packed <a href="ipaddr.html#method-i-in_addr"><code>in_addr</code></a> value followed by an address family.</p> <p>In the former case, the following are the valid formats that will be recognized: “address”, “address/prefixlen” and “address/mask”, where IPv6 address may be enclosed in square brackets (‘[’ and ‘]’). If a prefixlen or a mask is specified, it returns a masked IP address. Although the address family is determined automatically from a specified string, you can specify one explicitly by the optional second argument.</p> <p>Otherwise an IP address is generated from a packed <a href="ipaddr.html#method-i-in_addr"><code>in_addr</code></a> value and an address family.</p> <p>The <a href="ipaddr.html"><code>IPAddr</code></a> class defines many methods and operators, and some of those, such as &amp;, |, include? and ==, accept a string, or a packed <a href="ipaddr.html#method-i-in_addr"><code>in_addr</code></a> value instead of an <a href="ipaddr.html"><code>IPAddr</code></a> object.</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-c-new_ntoh"> <a href="#method-c-new_ntoh" title="Link to this method"> <span class="method-name">new_ntoh</span> <span class="method-args">(addr)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="new_ntoh-source"> <pre class="ruby" data-language="ruby"># File lib/ipaddr.rb, line 107
def self.new_ntoh(addr)
  return new(ntop(addr))
end</pre> </div>  <p>Creates a new ipaddr containing the given network byte ordered string form of an IP address.</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-c-ntop"> <a href="#method-c-ntop" title="Link to this method"> <span class="method-name">ntop</span> <span class="method-args">(addr)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="ntop-source"> <pre class="ruby" data-language="ruby"># File lib/ipaddr.rb, line 114
def self.ntop(addr)
  if addr.is_a?(String) &amp;&amp; addr.encoding != Encoding::BINARY
    raise InvalidAddressError, "invalid encoding (given #{addr.encoding}, expected BINARY)"
  end

  case addr.bytesize
  when 4
    addr.unpack('C4').join('.')
  when 16
    IN6FORMAT % addr.unpack('n8')
  else
    raise AddressFamilyError, "unsupported address family"
  end
end</pre> </div>  <p>Convert a network byte ordered string form of an IP address into human readable form. It expects the string to be encoded in Encoding::ASCII_8BIT (BINARY).</p> </div> </div> </section> <section id="public-instance-5Buntitled-5D-method-details" class="method-section anchor-link"> <header> <h3>Public Instance Methods</h3> </header> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-26"> <a href="#method-i-26" title="Link to this method"> <span class="method-name">&amp;</span> <span class="method-args">(other)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="26-source"> <pre class="ruby" data-language="ruby"># File lib/ipaddr.rb, line 130
def &amp;(other)
  return self.clone.set(@addr &amp; coerce_other(other).to_i)
end</pre> </div>  <p>Returns a new ipaddr built by bitwise AND.</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-3C-3C"> <a href="#method-i-3C-3C" title="Link to this method"> <span class="method-name">&lt;&lt;</span> <span class="method-args">(num)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="3C-3C-source"> <pre class="ruby" data-language="ruby"># File lib/ipaddr.rb, line 145
def &lt;&lt;(num)
  return self.clone.set(addr_mask(@addr &lt;&lt; num))
end</pre> </div>  <p>Returns a new ipaddr built by bitwise left shift.</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-3C-3D-3E"> <a href="#method-i-3C-3D-3E" title="Link to this method"> <span class="method-name">&lt;=&gt;</span> <span class="method-args">(other)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="3C-3D-3E-source"> <pre class="ruby" data-language="ruby"># File lib/ipaddr.rb, line 422
def &lt;=&gt;(other)
  other = coerce_other(other)
rescue
  nil
else
  @addr &lt;=&gt; other.to_i if other.family == @family
end</pre> </div>  <p>Compares the ipaddr with another.</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-3D-3D"> <a href="#method-i-3D-3D" title="Link to this method"> <span class="method-name">==</span> <span class="method-args">(other)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="3D-3D-source"> <pre class="ruby" data-language="ruby"># File lib/ipaddr.rb, line 155
def ==(other)
  other = coerce_other(other)
rescue
  false
else
  @family == other.family &amp;&amp; @addr == other.to_i
end</pre> </div>  <p>Returns true if two ipaddrs are equal.</p> </div> </div> <div class="method-detail anchor-link method-alias"> <div class="method-header"> <div class="method-heading" id="method-i-3D-3D-3D"> <a href="#method-i-3D-3D-3D" title="Link to this method"> <span class="method-name">===</span> <span class="method-args">(other)</span> </a> </div> </div>  <div class="aliases"> Alias for: <a href="ipaddr.html#method-i-include-3F">include?</a> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-3E-3E"> <a href="#method-i-3E-3E" title="Link to this method"> <span class="method-name">&gt;&gt;</span> <span class="method-args">(num)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="3E-3E-source"> <pre class="ruby" data-language="ruby"># File lib/ipaddr.rb, line 140
def &gt;&gt;(num)
  return self.clone.set(@addr &gt;&gt; num)
end</pre> </div>  <p>Returns a new ipaddr built by bitwise right-shift.</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-7C"> <a href="#method-i-7C" title="Link to this method"> <span class="method-name">|</span> <span class="method-args">(other)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="7C-source"> <pre class="ruby" data-language="ruby"># File lib/ipaddr.rb, line 135
def |(other)
  return self.clone.set(@addr | coerce_other(other).to_i)
end</pre> </div>  <p>Returns a new ipaddr built by bitwise OR.</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-~"> <a href="#method-i-~" title="Link to this method"> <span class="method-name">~</span> <span class="method-args">()</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="~-source"> <pre class="ruby" data-language="ruby"># File lib/ipaddr.rb, line 150
def ~
  return self.clone.set(addr_mask(~@addr))
end</pre> </div>  <p>Returns a new ipaddr built by bitwise negation.</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-as_json"> <a href="#method-i-as_json" title="Link to this method"> <span class="method-name">as_json</span> <span class="method-args">(*)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="as_json-source"> <pre class="ruby" data-language="ruby"># File lib/ipaddr.rb, line 231
def as_json(*)
  if ipv4? &amp;&amp; prefix == 32
    to_s
  elsif ipv6? &amp;&amp; prefix == 128
    to_s
  else
    cidr
  end
end</pre> </div>  <p>Returns a string containing the IP address representation with prefix.</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-cidr"> <a href="#method-i-cidr" title="Link to this method"> <span class="method-name">cidr</span> <span class="method-args">()</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="cidr-source"> <pre class="ruby" data-language="ruby"># File lib/ipaddr.rb, line 248
def cidr
  "#{to_s}/#{prefix}"
end</pre> </div>  <p>Returns a string containing the IP address representation in cidr notation</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-eql-3F"> <a href="#method-i-eql-3F" title="Link to this method"> <span class="method-name">eql?</span> <span class="method-args">(other)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="eql-3F-source"> <pre class="ruby" data-language="ruby"># File lib/ipaddr.rb, line 432
def eql?(other)
  return self.class == other.class &amp;&amp; self.hash == other.hash &amp;&amp; self == other
end</pre> </div>  <p>Checks equality used by <a href="hash.html"><code>Hash</code></a>.</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-hash"> <a href="#method-i-hash" title="Link to this method"> <span class="method-name">hash</span> <span class="method-args">()</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="hash-source"> <pre class="ruby" data-language="ruby"># File lib/ipaddr.rb, line 437
def hash
  return ([@addr, @mask_addr, @zone_id].hash &lt;&lt; 1) | (ipv4? ? 0 : 1)
end</pre> </div>  <p>Returns a hash value used by <a href="hash.html"><code>Hash</code></a>, <a href="set.html"><code>Set</code></a>, and <a href="array.html"><code>Array</code></a> classes</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-hton"> <a href="#method-i-hton" title="Link to this method"> <span class="method-name">hton</span> <span class="method-args">()</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="hton-source"> <pre class="ruby" data-language="ruby"># File lib/ipaddr.rb, line 253
def hton
  case @family
  when Socket::AF_INET
    return [@addr].pack('N')
  when Socket::AF_INET6
    return (0..7).map { |i|
      (@addr &gt;&gt; (112 - 16 * i)) &amp; 0xffff
    }.pack('n8')
  else
    raise AddressFamilyError, "unsupported address family"
  end
end</pre> </div>  <p>Returns a network byte ordered string form of the IP address.</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-include-3F"> <a href="#method-i-include-3F" title="Link to this method"> <span class="method-name">include?</span> <span class="method-args">(other)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="include-3F-source"> <pre class="ruby" data-language="ruby"># File lib/ipaddr.rb, line 181
def include?(other)
  other = coerce_other(other)
  return false unless other.family == family
  begin_addr &lt;= other.begin_addr &amp;&amp; end_addr &gt;= other.end_addr
end</pre> </div>  <p>Returns true if the given ipaddr is in the range.</p> <p>e.g.:</p> <pre class="ruby" data-language="ruby">require 'ipaddr'
net1 = IPAddr.new("192.168.2.0/24")
net2 = IPAddr.new("192.168.2.100")
net3 = IPAddr.new("192.168.3.0")
net4 = IPAddr.new("192.168.2.0/16")
p net1.include?(net2)     #=&gt; true
p net1.include?(net3)     #=&gt; false
p net1.include?(net4)     #=&gt; false
p net4.include?(net1)     #=&gt; true
</pre> </div> <div class="aliases"> Also aliased as: <a href="ipaddr.html#method-i-3D-3D-3D">===</a> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-inspect"> <a href="#method-i-inspect" title="Link to this method"> <span class="method-name">inspect</span> <span class="method-args">()</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="inspect-source"> <pre class="ruby" data-language="ruby"># File lib/ipaddr.rb, line 477
def inspect
  case @family
  when Socket::AF_INET
    af = "IPv4"
  when Socket::AF_INET6
    af = "IPv6"
    zone_id = @zone_id.to_s
  else
    raise AddressFamilyError, "unsupported address family"
  end
  return sprintf("#&lt;%s: %s:%s%s/%s&gt;", self.class.name,
                 af, _to_string(@addr), zone_id, _to_string(@mask_addr))
end</pre> </div>  <p>Returns a string containing a human-readable representation of the ipaddr. (“#&lt;IPAddr: family:address/mask&gt;”)</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-ip6_arpa"> <a href="#method-i-ip6_arpa" title="Link to this method"> <span class="method-name">ip6_arpa</span> <span class="method-args">()</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="ip6_arpa-source"> <pre class="ruby" data-language="ruby"># File lib/ipaddr.rb, line 401
def ip6_arpa
  if !ipv6?
    raise InvalidAddressError, "not an IPv6 address: #{@addr}"
  end
  return _reverse + ".ip6.arpa"
end</pre> </div>  <p>Returns a string for DNS reverse lookup compatible with RFC3172.</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-ip6_int"> <a href="#method-i-ip6_int" title="Link to this method"> <span class="method-name">ip6_int</span> <span class="method-args">()</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="ip6_int-source"> <pre class="ruby" data-language="ruby"># File lib/ipaddr.rb, line 409
def ip6_int
  if !ipv6?
    raise InvalidAddressError, "not an IPv6 address: #{@addr}"
  end
  return _reverse + ".ip6.int"
end</pre> </div>  <p>Returns a string for DNS reverse lookup compatible with RFC1886.</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-ipv4-3F"> <a href="#method-i-ipv4-3F" title="Link to this method"> <span class="method-name">ipv4?</span> <span class="method-args">()</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="ipv4-3F-source"> <pre class="ruby" data-language="ruby"># File lib/ipaddr.rb, line 267
def ipv4?
  return @family == Socket::AF_INET
end</pre> </div>  <p>Returns true if the ipaddr is an IPv4 address.</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-ipv4_compat"> <a href="#method-i-ipv4_compat" title="Link to this method"> <span class="method-name">ipv4_compat</span> <span class="method-args">()</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="ipv4_compat-source"> <pre class="ruby" data-language="ruby"># File lib/ipaddr.rb, line 369
def ipv4_compat
  warn "IPAddr\##{__callee__} is obsolete", uplevel: 1 if $VERBOSE
  if !ipv4?
    raise InvalidAddressError, "not an IPv4 address: #{@addr}"
  end
  return self.clone.set(@addr, Socket::AF_INET6)
end</pre> </div>  <p>Returns a new ipaddr built by converting the native IPv4 address into an IPv4-compatible IPv6 address.</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-ipv4_compat-3F"> <a href="#method-i-ipv4_compat-3F" title="Link to this method"> <span class="method-name">ipv4_compat?</span> <span class="method-args">()</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="ipv4_compat-3F-source"> <pre class="ruby" data-language="ruby"># File lib/ipaddr.rb, line 341
def ipv4_compat?
  warn "IPAddr\##{__callee__} is obsolete", uplevel: 1 if $VERBOSE
  _ipv4_compat?
end</pre> </div>  <p>Returns true if the ipaddr is an IPv4-compatible IPv6 address.</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-ipv4_mapped"> <a href="#method-i-ipv4_mapped" title="Link to this method"> <span class="method-name">ipv4_mapped</span> <span class="method-args">()</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="ipv4_mapped-source"> <pre class="ruby" data-language="ruby"># File lib/ipaddr.rb, line 358
def ipv4_mapped
  if !ipv4?
    raise InvalidAddressError, "not an IPv4 address: #{@addr}"
  end
  clone = self.clone.set(@addr | 0xffff00000000, Socket::AF_INET6)
  clone.instance_variable_set(:@mask_addr, @mask_addr | 0xffffffffffffffffffffffff00000000)
  clone
end</pre> </div>  <p>Returns a new ipaddr built by converting the native IPv4 address into an IPv4-mapped IPv6 address.</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-ipv4_mapped-3F"> <a href="#method-i-ipv4_mapped-3F" title="Link to this method"> <span class="method-name">ipv4_mapped?</span> <span class="method-args">()</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="ipv4_mapped-3F-source"> <pre class="ruby" data-language="ruby"># File lib/ipaddr.rb, line 336
def ipv4_mapped?
  return ipv6? &amp;&amp; (@addr &gt;&gt; 32) == 0xffff
end</pre> </div>  <p>Returns true if the ipaddr is an IPv4-mapped IPv6 address.</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-ipv6-3F"> <a href="#method-i-ipv6-3F" title="Link to this method"> <span class="method-name">ipv6?</span> <span class="method-args">()</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="ipv6-3F-source"> <pre class="ruby" data-language="ruby"># File lib/ipaddr.rb, line 272
def ipv6?
  return @family == Socket::AF_INET6
end</pre> </div>  <p>Returns true if the ipaddr is an IPv6 address.</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-link_local-3F"> <a href="#method-i-link_local-3F" title="Link to this method"> <span class="method-name">link_local?</span> <span class="method-args">()</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="link_local-3F-source"> <pre class="ruby" data-language="ruby"># File lib/ipaddr.rb, line 321
def link_local?
  case @family
  when Socket::AF_INET
    @addr &amp; 0xffff0000 == 0xa9fe0000 # 169.254.0.0/16
  when Socket::AF_INET6
    @addr &amp; 0xffc0_0000_0000_0000_0000_0000_0000_0000 == 0xfe80_0000_0000_0000_0000_0000_0000_0000 || # fe80::/10
      (@addr &amp; 0xffff_0000_0000 == 0xffff_0000_0000 &amp;&amp; (
        @addr &amp; 0xffff0000 == 0xa9fe0000 # ::ffff:169.254.0.0/16
      ))
  else
    raise AddressFamilyError, "unsupported address family"
  end
end</pre> </div>  <p>Returns true if the ipaddr is a link-local address. IPv4 addresses in 169.254.0.0/16 reserved by RFC 3927 and link-local IPv6 Unicast Addresses in fe80::/10 reserved by RFC 4291 are considered link-local. Link-local IPv4 addresses in the IPv4-mapped IPv6 address range are also considered link-local.</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-loopback-3F"> <a href="#method-i-loopback-3F" title="Link to this method"> <span class="method-name">loopback?</span> <span class="method-args">()</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="loopback-3F-source"> <pre class="ruby" data-language="ruby"># File lib/ipaddr.rb, line 279
def loopback?
  case @family
  when Socket::AF_INET
    @addr &amp; 0xff000000 == 0x7f000000 # 127.0.0.1/8
  when Socket::AF_INET6
    @addr == 1 || # ::1
      (@addr &amp; 0xffff_0000_0000 == 0xffff_0000_0000 &amp;&amp; (
        @addr &amp; 0xff000000 == 0x7f000000 # ::ffff:127.0.0.1/8
      ))
  else
    raise AddressFamilyError, "unsupported address family"
  end
end</pre> </div>  <p>Returns true if the ipaddr is a loopback address. Loopback IPv4 addresses in the IPv4-mapped IPv6 address range are also considered as loopback addresses.</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-mask"> <a href="#method-i-mask" title="Link to this method"> <span class="method-name">mask</span> <span class="method-args">(prefixlen)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="mask-source"> <pre class="ruby" data-language="ruby"># File lib/ipaddr.rb, line 165
def mask(prefixlen)
  return self.clone.mask!(prefixlen)
end</pre> </div>  <p>Returns a new ipaddr built by masking IP address with the given prefixlen/netmask. (e.g. 8, 64, “255.255.255.0”, etc.)</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-native"> <a href="#method-i-native" title="Link to this method"> <span class="method-name">native</span> <span class="method-args">()</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="native-source"> <pre class="ruby" data-language="ruby"># File lib/ipaddr.rb, line 380
def native
  if !ipv4_mapped? &amp;&amp; !_ipv4_compat?
    return self
  end
  return self.clone.set(@addr &amp; IN4MASK, Socket::AF_INET)
end</pre> </div>  <p>Returns a new ipaddr built by converting the IPv6 address into a native IPv4 address. If the IP address is not an IPv4-mapped or IPv4-compatible IPv6 address, returns self.</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-netmask"> <a href="#method-i-netmask" title="Link to this method"> <span class="method-name">netmask</span> <span class="method-args">()</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="netmask-source"> <pre class="ruby" data-language="ruby"># File lib/ipaddr.rb, line 492
def netmask
  _to_string(@mask_addr)
end</pre> </div>  <p>Returns the netmask in string format e.g. 255.255.0.0</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-prefix"> <a href="#method-i-prefix" title="Link to this method"> <span class="method-name">prefix</span> <span class="method-args">()</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="prefix-source"> <pre class="ruby" data-language="ruby"># File lib/ipaddr.rb, line 447
def prefix
  case @family
  when Socket::AF_INET
    n = IN4MASK ^ @mask_addr
    i = 32
  when Socket::AF_INET6
    n = IN6MASK ^ @mask_addr
    i = 128
  else
    raise AddressFamilyError, "unsupported address family"
  end
  while n.positive?
    n &gt;&gt;= 1
    i -= 1
  end
  i
end</pre> </div>  <p>Returns the prefix length in bits for the ipaddr.</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-prefix-3D"> <a href="#method-i-prefix-3D" title="Link to this method"> <span class="method-name">prefix=</span> <span class="method-args">(prefix)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="prefix-3D-source"> <pre class="ruby" data-language="ruby"># File lib/ipaddr.rb, line 466
def prefix=(prefix)
  case prefix
  when Integer
    mask!(prefix)
  else
    raise InvalidPrefixError, "prefix must be an integer"
  end
end</pre> </div>  <p>Sets the prefix length in bits</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-private-3F"> <a href="#method-i-private-3F" title="Link to this method"> <span class="method-name">private?</span> <span class="method-args">()</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="private-3F-source"> <pre class="ruby" data-language="ruby"># File lib/ipaddr.rb, line 298
def private?
  case @family
  when Socket::AF_INET
    @addr &amp; 0xff000000 == 0x0a000000 ||    # 10.0.0.0/8
      @addr &amp; 0xfff00000 == 0xac100000 ||  # 172.16.0.0/12
      @addr &amp; 0xffff0000 == 0xc0a80000     # 192.168.0.0/16
  when Socket::AF_INET6
    @addr &amp; 0xfe00_0000_0000_0000_0000_0000_0000_0000 == 0xfc00_0000_0000_0000_0000_0000_0000_0000 ||
      (@addr &amp; 0xffff_0000_0000 == 0xffff_0000_0000 &amp;&amp; (
        @addr &amp; 0xff000000 == 0x0a000000 ||  # ::ffff:10.0.0.0/8
        @addr &amp; 0xfff00000 == 0xac100000 ||  # ::ffff::172.16.0.0/12
        @addr &amp; 0xffff0000 == 0xc0a80000     # ::ffff::192.168.0.0/16
      ))
  else
    raise AddressFamilyError, "unsupported address family"
  end
end</pre> </div>  <p>Returns true if the ipaddr is a private address. IPv4 addresses in 10.0.0.0/8, 172.16.0.0/12 and 192.168.0.0/16 as defined in RFC 1918 and IPv6 Unique Local Addresses in fc00::/7 as defined in RFC 4193 are considered private. Private IPv4 addresses in the IPv4-mapped IPv6 address range are also considered private.</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-reverse"> <a href="#method-i-reverse" title="Link to this method"> <span class="method-name">reverse</span> <span class="method-args">()</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="reverse-source"> <pre class="ruby" data-language="ruby"># File lib/ipaddr.rb, line 389
def reverse
  case @family
  when Socket::AF_INET
    return _reverse + ".in-addr.arpa"
  when Socket::AF_INET6
    return ip6_arpa
  else
    raise AddressFamilyError, "unsupported address family"
  end
end</pre> </div>  <p>Returns a string for DNS reverse lookup. It returns a string in RFC3172 form for an IPv6 address.</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-succ"> <a href="#method-i-succ" title="Link to this method"> <span class="method-name">succ</span> <span class="method-args">()</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="succ-source"> <pre class="ruby" data-language="ruby"># File lib/ipaddr.rb, line 417
def succ
  return self.clone.set(@addr + 1, @family)
end</pre> </div>  <p>Returns the successor to the ipaddr.</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-to_i"> <a href="#method-i-to_i" title="Link to this method"> <span class="method-name">to_i</span> <span class="method-args">()</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="to_i-source"> <pre class="ruby" data-language="ruby"># File lib/ipaddr.rb, line 189
def to_i
  return @addr
end</pre> </div>  <p>Returns the integer representation of the ipaddr.</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-to_json"> <a href="#method-i-to_json" title="Link to this method"> <span class="method-name">to_json</span> <span class="method-args">(*a)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="to_json-source"> <pre class="ruby" data-language="ruby"># File lib/ipaddr.rb, line 242
def to_json(*a)
  %Q{"#{as_json(*a)}"}
end</pre> </div>  <p>Returns a json string containing the IP address representation.</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-to_range"> <a href="#method-i-to_range" title="Link to this method"> <span class="method-name">to_range</span> <span class="method-args">()</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="to_range-source"> <pre class="ruby" data-language="ruby"># File lib/ipaddr.rb, line 442
def to_range
  self.class.new(begin_addr, @family)..self.class.new(end_addr, @family)
end</pre> </div>  <p>Creates a <a href="range.html"><code>Range</code></a> object for the network address.</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-to_s"> <a href="#method-i-to_s" title="Link to this method"> <span class="method-name">to_s</span> <span class="method-args">()</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="to_s-source"> <pre class="ruby" data-language="ruby"># File lib/ipaddr.rb, line 194
def to_s
  str = to_string
  return str if ipv4?

  str.gsub!(/\b0{1,3}([\da-f]+)\b/i, '\1')
  loop do
    break if str.sub!(/\A0:0:0:0:0:0:0:0\z/, '::')
    break if str.sub!(/\b0:0:0:0:0:0:0\b/, ':')
    break if str.sub!(/\b0:0:0:0:0:0\b/, ':')
    break if str.sub!(/\b0:0:0:0:0\b/, ':')
    break if str.sub!(/\b0:0:0:0\b/, ':')
    break if str.sub!(/\b0:0:0\b/, ':')
    break if str.sub!(/\b0:0\b/, ':')
    break
  end
  str.sub!(/:{3,}/, '::')

  if /\A::(ffff:)?([\da-f]{1,4}):([\da-f]{1,4})\z/i =~ str
    str = sprintf('::%s%d.%d.%d.%d', $1, $2.hex / 256, $2.hex % 256, $3.hex / 256, $3.hex % 256)
  end

  str
end</pre> </div>  <p>Returns a string containing the IP address representation.</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-to_string"> <a href="#method-i-to_string" title="Link to this method"> <span class="method-name">to_string</span> <span class="method-args">()</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="to_string-source"> <pre class="ruby" data-language="ruby"># File lib/ipaddr.rb, line 220
def to_string
  str = _to_string(@addr)

  if @family == Socket::AF_INET6
    str &lt;&lt; zone_id.to_s
  end

  return str
end</pre> </div>  <p>Returns a string containing the IP address representation in canonical form.</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-wildcard_mask"> <a href="#method-i-wildcard_mask" title="Link to this method"> <span class="method-name">wildcard_mask</span> <span class="method-args">()</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="wildcard_mask-source"> <pre class="ruby" data-language="ruby"># File lib/ipaddr.rb, line 497
def wildcard_mask
  case @family
  when Socket::AF_INET
    mask = IN4MASK ^ @mask_addr
  when Socket::AF_INET6
    mask = IN6MASK ^ @mask_addr
  else
    raise AddressFamilyError, "unsupported address family"
  end

  _to_string(mask)
end</pre> </div>  <p>Returns the wildcard mask in string format e.g. 0.0.255.255</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-zone_id"> <a href="#method-i-zone_id" title="Link to this method"> <span class="method-name">zone_id</span> <span class="method-args">()</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="zone_id-source"> <pre class="ruby" data-language="ruby"># File lib/ipaddr.rb, line 512
def zone_id
  if @family == Socket::AF_INET6
    @zone_id
  else
    raise InvalidAddressError, "not an IPv6 address"
  end
end</pre> </div>  <p>Returns the IPv6 zone identifier, if present. Raises <a href="ipaddr/invalidaddresserror.html"><code>InvalidAddressError</code></a> if not an IPv6 address.</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-zone_id-3D"> <a href="#method-i-zone_id-3D" title="Link to this method"> <span class="method-name">zone_id=</span> <span class="method-args">(zid)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="zone_id-3D-source"> <pre class="ruby" data-language="ruby"># File lib/ipaddr.rb, line 522
def zone_id=(zid)
  if @family == Socket::AF_INET6
    case zid
    when nil, /\A%(\w+)\z/
      @zone_id = zid
    else
      raise InvalidAddressError, "invalid zone identifier for address"
    end
  else
    raise InvalidAddressError, "not an IPv6 address"
  end
end</pre> </div>  <p>Returns the IPv6 zone identifier, if present. Raises <a href="ipaddr/invalidaddresserror.html"><code>InvalidAddressError</code></a> if not an IPv6 address.</p> </div> </div> </section> <section id="protected-instance-5Buntitled-5D-method-details" class="method-section anchor-link"> <header> <h3>Protected Instance Methods</h3> </header> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-begin_addr"> <a href="#method-i-begin_addr" title="Link to this method"> <span class="method-name">begin_addr</span> <span class="method-args">()</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="begin_addr-source"> <pre class="ruby" data-language="ruby"># File lib/ipaddr.rb, line 537
def begin_addr
  @addr &amp; @mask_addr
end</pre> </div>  </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-end_addr"> <a href="#method-i-end_addr" title="Link to this method"> <span class="method-name">end_addr</span> <span class="method-args">()</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="end_addr-source"> <pre class="ruby" data-language="ruby"># File lib/ipaddr.rb, line 541
def end_addr
  case @family
  when Socket::AF_INET
    @addr | (IN4MASK ^ @mask_addr)
  when Socket::AF_INET6
    @addr | (IN6MASK ^ @mask_addr)
  else
    raise AddressFamilyError, "unsupported address family"
  end
end</pre> </div>  </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-mask-21"> <a href="#method-i-mask-21" title="Link to this method"> <span class="method-name">mask!</span> <span class="method-args">(mask)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="mask-21-source"> <pre class="ruby" data-language="ruby"># File lib/ipaddr.rb, line 579
def mask!(mask)
  case mask
  when String
    case mask
    when /\A(0|[1-9]+\d*)\z/
      prefixlen = mask.to_i
    when /\A\d+\z/
      raise InvalidPrefixError, "leading zeros in prefix"
    else
      m = IPAddr.new(mask)
      if m.family != @family
        raise InvalidPrefixError, "address family is not same"
      end
      @mask_addr = m.to_i
      n = @mask_addr ^ m.instance_variable_get(:@mask_addr)
      unless ((n + 1) &amp; n).zero?
        raise InvalidPrefixError, "invalid mask #{mask}"
      end
      @addr &amp;= @mask_addr
      return self
    end
  else
    prefixlen = mask
  end
  case @family
  when Socket::AF_INET
    if prefixlen &lt; 0 || prefixlen &gt; 32
      raise InvalidPrefixError, "invalid length"
    end
    masklen = 32 - prefixlen
    @mask_addr = ((IN4MASK &gt;&gt; masklen) &lt;&lt; masklen)
  when Socket::AF_INET6
    if prefixlen &lt; 0 || prefixlen &gt; 128
      raise InvalidPrefixError, "invalid length"
    end
    masklen = 128 - prefixlen
    @mask_addr = ((IN6MASK &gt;&gt; masklen) &lt;&lt; masklen)
  else
    raise AddressFamilyError, "unsupported address family"
  end
  @addr = ((@addr &gt;&gt; masklen) &lt;&lt; masklen)
  return self
end</pre> </div>  <p><a href="set.html"><code>Set</code></a> current netmask to given mask.</p> </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-set"> <a href="#method-i-set" title="Link to this method"> <span class="method-name">set</span> <span class="method-args">(addr, *family)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="set-source"> <pre class="ruby" data-language="ruby"># File lib/ipaddr.rb, line 555
def set(addr, *family)
  case family[0] ? family[0] : @family
  when Socket::AF_INET
    if addr &lt; 0 || addr &gt; IN4MASK
      raise InvalidAddressError, "invalid address: #{addr}"
    end
  when Socket::AF_INET6
    if addr &lt; 0 || addr &gt; IN6MASK
      raise InvalidAddressError, "invalid address: #{addr}"
    end
  else
    raise AddressFamilyError, "unsupported address family"
  end
  @addr = addr
  if family[0]
    @family = family[0]
    if @family == Socket::AF_INET
      @mask_addr &amp;= IN4MASK
    end
  end
  return self
end</pre> </div>  <p><a href="set.html"><code>Set</code></a> +@addr+, the internal stored ip address, to given <code>addr</code>. The parameter <code>addr</code> is validated using the first <code>family</code> member, which is <code>Socket::AF_INET</code> or <code>Socket::AF_INET6</code>.</p> </div> </div> </section> <section id="private-instance-5Buntitled-5D-method-details" class="method-section anchor-link"> <header> <h3>Private Instance Methods</h3> </header> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-_ipv4_compat-3F"> <a href="#method-i-_ipv4_compat-3F" title="Link to this method"> <span class="method-name">_ipv4_compat?</span> <span class="method-args">()</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="_ipv4_compat-3F-source"> <pre class="ruby" data-language="ruby"># File lib/ipaddr.rb, line 346
def _ipv4_compat?
  if !ipv6? || (@addr &gt;&gt; 32) != 0
    return false
  end
  a = (@addr &amp; IN4MASK)
  return a != 0 &amp;&amp; a != 1
end</pre> </div>  </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-_reverse"> <a href="#method-i-_reverse" title="Link to this method"> <span class="method-name">_reverse</span> <span class="method-args">()</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="_reverse-source"> <pre class="ruby" data-language="ruby"># File lib/ipaddr.rb, line 766
def _reverse
  case @family
  when Socket::AF_INET
    return (0..3).map { |i|
      (@addr &gt;&gt; (8 * i)) &amp; 0xff
    }.join('.')
  when Socket::AF_INET6
    return ("%.32x" % @addr).reverse!.gsub!(/.(?!$)/, '\&amp;.')
  else
    raise AddressFamilyError, "unsupported address family"
  end
end</pre> </div>  </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-_to_string"> <a href="#method-i-_to_string" title="Link to this method"> <span class="method-name">_to_string</span> <span class="method-args">(addr)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="_to_string-source"> <pre class="ruby" data-language="ruby"># File lib/ipaddr.rb, line 779
def _to_string(addr)
  case @family
  when Socket::AF_INET
    return (0..3).map { |i|
      (addr &gt;&gt; (24 - 8 * i)) &amp; 0xff
    }.join('.')
  when Socket::AF_INET6
    return (("%.32x" % addr).gsub!(/.{4}(?!$)/, '\&amp;:'))
  else
    raise AddressFamilyError, "unsupported address family"
  end
end</pre> </div>  </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-addr_mask"> <a href="#method-i-addr_mask" title="Link to this method"> <span class="method-name">addr_mask</span> <span class="method-args">(addr)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="addr_mask-source"> <pre class="ruby" data-language="ruby"># File lib/ipaddr.rb, line 755
def addr_mask(addr)
  case @family
  when Socket::AF_INET
    return addr &amp; IN4MASK
  when Socket::AF_INET6
    return addr &amp; IN6MASK
  else
    raise AddressFamilyError, "unsupported address family"
  end
end</pre> </div>  </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-coerce_other"> <a href="#method-i-coerce_other" title="Link to this method"> <span class="method-name">coerce_other</span> <span class="method-args">(other)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="coerce_other-source"> <pre class="ruby" data-language="ruby"># File lib/ipaddr.rb, line 692
def coerce_other(other)
  case other
  when IPAddr
    other
  when String
    self.class.new(other)
  else
    self.class.new(other, @family)
  end
end</pre> </div>  </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-in6_addr"> <a href="#method-i-in6_addr" title="Link to this method"> <span class="method-name">in6_addr</span> <span class="method-args">(left)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="in6_addr-source"> <pre class="ruby" data-language="ruby"># File lib/ipaddr.rb, line 718
def in6_addr(left)
  case left
  when RE_IPV6ADDRLIKE_FULL
    if $2
      addr = in_addr($~[2,4])
      left = $1 + ':'
    else
      addr = 0
    end
    right = ''
  when RE_IPV6ADDRLIKE_COMPRESSED
    if $4
      left.count(':') &lt;= 6 or raise InvalidAddressError, "invalid address: #{@addr}"
      addr = in_addr($~[4,4])
      left = $1
      right = $3 + '0:0'
    else
      left.count(':') &lt;= ($1.empty? || $2.empty? ? 8 : 7) or
        raise InvalidAddressError, "invalid address: #{@addr}"
      left = $1
      right = $2
      addr = 0
    end
  else
    raise InvalidAddressError, "invalid address: #{@addr}"
  end
  l = left.split(':')
  r = right.split(':')
  rest = 8 - l.size - r.size
  if rest &lt; 0
    return nil
  end
  (l + Array.new(rest, '0') + r).inject(0) { |i, s|
    i &lt;&lt; 16 | s.hex
  } | addr
end</pre> </div>  </div> </div> <div class="method-detail anchor-link "> <div class="method-header"> <div class="method-heading" id="method-i-in_addr"> <a href="#method-i-in_addr" title="Link to this method"> <span class="method-name">in_addr</span> <span class="method-args">(addr)</span> </a> </div> </div> <div class="method-controls"> <details class="method-source-toggle"> <summary>Source</summary> </details> </div> <div class="method-description">
<div class="method-source-code" id="in_addr-source"> <pre class="ruby" data-language="ruby"># File lib/ipaddr.rb, line 703
def in_addr(addr)
  case addr
  when Array
    octets = addr
  else
    RE_IPV4ADDRLIKE.match?(addr) or return nil
    octets = addr.split('.')
  end
  octets.inject(0) { |i, s|
    (n = s.to_i) &lt; 256 or raise InvalidAddressError, "invalid address: #{@addr}"
    (s != '0') &amp;&amp; s.start_with?('0') and raise InvalidAddressError, "zero-filled number in IPv4 address is ambiguous: #{@addr}"
    i &lt;&lt; 8 | n
  }
end</pre> </div>  </div> </div> </section> </section><div class="_attribution">
  <p class="_attribution-p">
    Ruby Core &copy; 1993&ndash;2024 Yukihiro Matsumoto<br>Licensed under the Ruby License.<br>Ruby Standard Library &copy; contributors<br>Licensed under their own licenses.<br>
    
  </p>
</div>
