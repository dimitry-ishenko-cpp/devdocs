<h1>The <code>server-sent-events</code> Extension</h1> <p>The <code>Server Sent Events</code> connects to an <a rel="noopener" target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events/Using_server-sent_events">EventSource</a> directly from HTML. It manages the connections to your web server, listens for server events, and then swaps their contents into your htmx webpage in real-time.</p> <p>SSE is a lightweight alternative to WebSockets that works over existing HTTP connections, so it is easy to use through proxy servers and firewalls. Remember, SSE is a uni-directional service, so you cannot send any messages to an SSE server once the connection has been established. If you need bi-directional communication, then you should consider using <a href="../web-sockets/index.html">WebSockets</a> instead.</p> <p>This extension replaces the experimental <code>hx-sse</code> attribute built into previous versions of htmx. For help migrating from older versions, see the migration guide at the bottom of this page.</p> <p>Use the following attributes to configure how SSE connections behave:</p> <ul> <li>
<code>sse-connect="&lt;url&gt;"</code> - The URL of the SSE server.</li> <li>
<code>sse-swap="&lt;message-name&gt;"</code> - The name of the message to swap into the DOM.</li> <li>
<code>hx-trigger="sse:&lt;message-name&gt;"</code> - SSE messages can also trigger HTTP callbacks using the <a href="../../attributes/hx-trigger/index.html"><code>hx-trigger</code></a> attribute.</li> </ul> <h2 id="install">Install</h2> <pre data-lang="html" style="background-color:#1f2329;color:#abb2bf;" class="language-html "><code class="language-html" data-lang="html"><span>&lt;</span><span style="color:#e06c75;">script </span><span style="color:#d19a66;">src</span><span>=</span><span style="color:#98c379;">"https://unpkg.com/htmx.org/dist/ext/sse.js"</span><span>&gt;&lt;/</span><span style="color:#e06c75;">script</span><span>&gt;
</span></code></pre> <h2 id="usage">Usage</h2> <pre data-lang="html" style="background-color:#1f2329;color:#abb2bf;" class="language-html "><code class="language-html" data-lang="html"><span>  &lt;</span><span style="color:#e06c75;">div </span><span style="color:#d19a66;">hx-ext</span><span>=</span><span style="color:#98c379;">"sse" </span><span style="color:#d19a66;">sse-connect</span><span>=</span><span style="color:#98c379;">"/chatroom" </span><span style="color:#d19a66;">sse-swap</span><span>=</span><span style="color:#98c379;">"message"</span><span>&gt;
</span><span>      Contents of this box will be updated in real time
</span><span>      with every SSE message received from the chatroom.
</span><span>  &lt;/</span><span style="color:#e06c75;">div</span><span>&gt;
</span></code></pre> <h3 id="connecting-to-an-sse-server">Connecting to an SSE Server</h3> <p>To connect to an SSE server, use the <code>hx-ext="sse"</code> attribute to install the extension on that HTML element, then add <code>sse-connect="&lt;url&gt;"</code> to the element to make the connection.</p> <p>When designing your server application, remember that SSE works just like any HTTP request. Although you cannot send any messages to the server after you have established a connection, you can send parameters to the server along with your request. So, instead of making an SSE connection to your server at <code>https://my-server/chat-updates</code> you can also connect to <code>https://my-server/chat-updates?friends=true&amp;format=detailed</code>. This allows your server to customize its responses to what your client needs.</p> <h3 id="receiving-named-events">Receiving Named Events</h3> <p>SSE messages consist of an event name and a data packet. No other metadata is allowed in the message. Here is an example:</p> <pre data-lang="txt" style="background-color:#1f2329;color:#abb2bf;" class="language-txt "><code class="language-txt" data-lang="txt"><span>event: EventName
</span><span>data: &lt;div&gt;Content to swap into your HTML page.&lt;/div&gt;
</span></code></pre> <p>We’ll use the <code>sse-swap</code> attribute to listen for this event and swap its contents into our webpage.</p> <pre data-lang="html" style="background-color:#1f2329;color:#abb2bf;" class="language-html "><code class="language-html" data-lang="html"><span>&lt;</span><span style="color:#e06c75;">div </span><span style="color:#d19a66;">hx-ext</span><span>=</span><span style="color:#98c379;">"sse" </span><span style="color:#d19a66;">sse-connect</span><span>=</span><span style="color:#98c379;">"/event-source" </span><span style="color:#d19a66;">sse-swap</span><span>=</span><span style="color:#98c379;">"EventName"</span><span>&gt;&lt;/</span><span style="color:#e06c75;">div</span><span>&gt;
</span></code></pre> <p>Notice that the name <code>EventName</code> from the server’s message must match the value in the <code>sse-swap</code> attribute. Your server can use as many different event names as necessary, but be careful: browsers can only listen for events that have been explicitly named. So, if your server sends an event named <code>ChatroomUpdate</code> but your browser is only listening for events named <code>ChatUpdate</code> then the extra event will be discarded.</p> <h3 id="receiving-unnamed-events">Receiving Unnamed Events</h3> <p>SSE messages can also be sent without any event name. In this case, the browser uses the default name <code>message</code> in its place. The same rules specified above still apply. If your server sends an unnamed message, then you must listen for it by including <code>sse-swap="message"</code>. There is no option for using a catch-all name. Here’s how this looks:</p> <pre data-lang="txt" style="background-color:#1f2329;color:#abb2bf;" class="language-txt "><code class="language-txt" data-lang="txt"><span>data: &lt;div&gt;Content to swap into your HTML page.&lt;/div&gt;
</span></code></pre> <pre data-lang="html" style="background-color:#1f2329;color:#abb2bf;" class="language-html "><code class="language-html" data-lang="html"><span>&lt;</span><span style="color:#e06c75;">div </span><span style="color:#d19a66;">hx-ext</span><span>=</span><span style="color:#98c379;">"sse" </span><span style="color:#d19a66;">sse-connect</span><span>=</span><span style="color:#98c379;">"/event-source" </span><span style="color:#d19a66;">sse-swap</span><span>=</span><span style="color:#98c379;">"message"</span><span>&gt;&lt;/</span><span style="color:#e06c75;">div</span><span>&gt;
</span></code></pre> <h3 id="receiving-multiple-events">Receiving Multiple Events</h3> <p>You can also listen to multiple events (named or unnamed) from a single EventSource. Listeners must be either 1) the same element that contains the <code>hx-ext</code> and <code>sse-connect</code> attributes, or 2) child elements of the element containing the <code>hx-ext</code> and <code>sse-connect</code> attributes.</p> <pre data-lang="html" style="background-color:#1f2329;color:#abb2bf;" class="language-html "><code class="language-html" data-lang="html"><span>Multiple events in the same element
</span><span>&lt;</span><span style="color:#e06c75;">div </span><span style="color:#d19a66;">hx-ext</span><span>=</span><span style="color:#98c379;">"sse" </span><span style="color:#d19a66;">sse-connect</span><span>=</span><span style="color:#98c379;">"/server-url" </span><span style="color:#d19a66;">sse-swap</span><span>=</span><span style="color:#98c379;">"event1,event2"</span><span>&gt;&lt;/</span><span style="color:#e06c75;">div</span><span>&gt;
</span><span>Multiple events in different elements (from the same source).
</span><span>&lt;</span><span style="color:#e06c75;">div </span><span style="color:#d19a66;">hx-ext</span><span>=</span><span style="color:#98c379;">"sse" </span><span style="color:#d19a66;">sse-connect</span><span>=</span><span style="color:#98c379;">"/server-url"</span><span>&gt;
</span><span>    &lt;</span><span style="color:#e06c75;">div </span><span style="color:#d19a66;">sse-swap</span><span>=</span><span style="color:#98c379;">"event1"</span><span>&gt;&lt;/</span><span style="color:#e06c75;">div</span><span>&gt;
</span><span>    &lt;</span><span style="color:#e06c75;">div </span><span style="color:#d19a66;">sse-swap</span><span>=</span><span style="color:#98c379;">"event2"</span><span>&gt;&lt;/</span><span style="color:#e06c75;">div</span><span>&gt;
</span><span>&lt;/</span><span style="color:#e06c75;">div</span><span>&gt;
</span></code></pre> <h3 id="trigger-server-callbacks">Trigger Server Callbacks</h3> <p>When a connection for server sent events has been established, child elements can listen for these events by using the special <a href="../../attributes/hx-trigger/index.html"><code>hx-trigger</code></a> syntax <code>sse:&lt;event_name&gt;</code>. This, when combined with an <code>hx-get</code> or similar will trigger the element to make a request.</p> <p>Here is an example:</p> <pre data-lang="html" style="background-color:#1f2329;color:#abb2bf;" class="language-html "><code class="language-html" data-lang="html"><span>  &lt;</span><span style="color:#e06c75;">div </span><span style="color:#d19a66;">hx-ext</span><span>=</span><span style="color:#98c379;">"sse" </span><span style="color:#d19a66;">sse-connect</span><span>=</span><span style="color:#98c379;">"/event_stream"</span><span>&gt;
</span><span>    &lt;</span><span style="color:#e06c75;">div </span><span style="color:#d19a66;">hx-get</span><span>=</span><span style="color:#98c379;">"/chatroom" </span><span style="color:#d19a66;">hx-trigger</span><span>=</span><span style="color:#98c379;">"sse:chatter"</span><span>&gt;
</span><span>      ...
</span><span>    &lt;/</span><span style="color:#e06c75;">div</span><span>&gt;
</span><span>  &lt;/</span><span style="color:#e06c75;">div</span><span>&gt;
</span></code></pre> <p>This example establishes an SSE connection to the <code>event_stream</code> end point which then triggers a <code>GET</code> to the <code>/chatroom</code> url whenever the <code>chatter</code> event is seen.</p> <h3 id="automatic-reconnection">Automatic Reconnection</h3> <p>If the SSE Event Stream is closed unexpectedly, browsers are supposed to attempt to reconnect automatically. However, in rare situations this does not work and your browser can be left hanging. This extension adds its own reconnection logic (using an <a rel="noopener" target="_blank" href="https://en.wikipedia.org/wiki/Exponential_backoff">exponential-backoff algorithm</a>) on top of the browser’s automatic reconnection, so that your SSE streams will always be as reliable as possible.</p> <h3 id="testing-sse-connections-with-the-demo-server">Testing SSE Connections with the Demo Server</h3> <p>Htmx includes a demo SSE server written in Node.js that will help you to see SSE in action, and begin bootstrapping your own SSE code. It is located in the /test/ws-sse folder of the htmx distribution. Look at /test/ws-sse/README.md for instructions on running and using the test server.</p> <h3 id="migrating-from-previous-versions">Migrating from Previous Versions</h3> <p>Previous versions of htmx used a built-in tag <code>hx-sse</code> to implement Server Sent Events. This code has been migrated into an extension instead. Here are the steps you need to take to migrate to this version:</p> <table>
<thead><tr>
<th>Old Attribute</th>
<th>New Attribute</th>
<th>Comments</th>
</tr></thead>
<tbody> <tr>
<td><code>hx-sse=""</code></td>
<td><code>hx-ext="sse"</code></td>
<td>Use the <code>hx-ext="sse"</code> attribute to install the SSE extension into any HTML element.</td>
</tr> <tr>
<td><code>hx-sse="connect:&lt;url&gt;"</code></td>
<td><code>sse-connect="&lt;url&gt;"</code></td>
<td>Add a new attribute <code>sse-connect</code> to the tag that specifies the URL of the Event Stream. This attribute must be in the same tag as the <code>hx-ext</code> attribute.</td>
</tr> <tr>
<td><code>hx-sse="swap:&lt;EventName&gt;"</code></td>
<td><code>sse-swap="&lt;EventName&gt;"</code></td>
<td>Add a new attribute <code>sse-swap</code> to any elements that will be swapped in via the SSE extension. This attribute must be placed <strong>on</strong> or <strong>inside of</strong> the tag containing the <code>hx-ext</code> attribute.</td>
</tr> <tr>
<td><code>hx-trigger="sse:&lt;EventName&gt;"</code></td>
<td>NO CHANGE</td>
<td>any <code>hx-trigger</code> attributes do not need to change. The extension will identify these attributes and add listeners for any events prefixed with <code>sse:</code>
</td>
</tr> </tbody>
</table> <h3 id="additional-sse-resources">Additional SSE Resources</h3> <ul> <li><a rel="noopener" target="_blank" href="https://en.wikipedia.org/wiki/Server-sent_events">Wikipedia</a></li> <li><a rel="noopener" target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events">MDN Web Docs</a></li> <li><a rel="noopener" target="_blank" href="https://caniuse.com/eventsource">Can I Use?</a></li> </ul><div class="_attribution">
  <p class="_attribution-p">
    Licensed under the Zero-Clause BSD License.<br>
    <a href="https://htmx.org/extensions/server-sent-events/" class="_attribution-link">https://htmx.org/extensions/server-sent-events/</a>
  </p>
</div>
