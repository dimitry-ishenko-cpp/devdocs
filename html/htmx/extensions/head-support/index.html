<h1>The <code>head-support</code> Extension</h1> <p>The <code>head-support</code> extension adds support for <a rel="noopener" target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/head">head tags</a> in responses to htmx requests.</p> <p>htmx began as a library focused on <em>partial replacement</em> of HTML within the <code>body</code> tag. As such, merging additional information such as the head tag was not a focus of the library. (This is in contrast with, for example, TurboLinks, which was focused on merging entire web pages retrieved via AJAX into the browser.)</p> <p>The <a href="../../attributes/hx-boost/index.html"><code>hx-boost</code></a> attribute moved htmx closer to this world of full HTML-document support &amp; support for extracting the <code>title</code> tag out of head elements was eventually added, but full head tag support has never been a feature of the library.</p> <p>This extension addresses that shortcoming &amp; will likely be integrated into htmx for the 2.0 release.</p> <h2 id="install">Install</h2> <pre data-lang="html" style="background-color:#1f2329;color:#abb2bf;" class="language-html "><code class="language-html" data-lang="html"><span>&lt;</span><span style="color:#e06c75;">script </span><span style="color:#d19a66;">src</span><span>=</span><span style="color:#98c379;">"https://unpkg.com/htmx.org/dist/ext/head-support.js"</span><span>&gt;&lt;/</span><span style="color:#e06c75;">script</span><span>&gt;
</span></code></pre> <h2 id="usage">Usage</h2> <pre data-lang="html" style="background-color:#1f2329;color:#abb2bf;" class="language-html "><code class="language-html" data-lang="html"><span>&lt;</span><span style="color:#e06c75;">body </span><span style="color:#d19a66;">hx-ext</span><span>=</span><span style="color:#98c379;">"head-support"</span><span>&gt;
</span><span>   ...
</span></code></pre> <p>With this installed, all responses that htmx receives that contain a <code>head</code> tag in them (even if they are not complete HTML documents with a root <code>&lt;html&gt;</code> element) will be processed.</p> <p>How the head tag is handled depends on the type of htmx request.</p> <p>If the htmx request is from a boosted element, then the following merge algorithm is used:</p> <ul> <li>Elements that exist in the current head as exact textual matches will be left in place</li> <li>Elements that do not exist in the current head will be added at the end of the head tag</li> <li>Elements that exist in the current head, but not in the new head will be removed from the head</li> </ul> <p>If the htmx request is from a non-boosted element, then all content will be <em>appended</em> to the existing head element.</p> <p>If you wish to override this behavior in either case, you can place the <code>hx-head</code> attribute on the new <code>&lt;head&gt;</code> tag, with either of the following two values:</p> <ul> <li>
<code>merge</code> - follow the merging algorithm outlined above</li> <li>
<code>append</code> - append the elements to the existing head</li> </ul> <h3 id="controlling-merge-behavior">Controlling Merge Behavior</h3> <p>Beyond this, you may also control merging behavior of individual elements with the following attributes:</p> <ul> <li>If you place <code>hx-head="re-eval"</code> on a head element, it will be re-added (removed and appended) to the head tag on every request, even if it already exists. This can be useful to execute a script on every htmx request, for example.</li> <li>If you place <code>hx-preserve="true"</code> on an element, it will never be removed from the head</li> </ul> <h3 id="example">Example</h3> <p>As an example, consider the following head tag in an existing document:</p> <pre data-lang="html" style="background-color:#1f2329;color:#abb2bf;" class="language-html "><code class="language-html" data-lang="html"><span>&lt;</span><span style="color:#e06c75;">head</span><span>&gt;
</span><span>    &lt;</span><span style="color:#e06c75;">link </span><span style="color:#d19a66;">rel</span><span>=</span><span style="color:#98c379;">"stylesheet" </span><span style="color:#d19a66;">href</span><span>=</span><span style="color:#98c379;">"https://the.missing.style"</span><span>&gt;
</span><span>    &lt;</span><span style="color:#e06c75;">link </span><span style="color:#d19a66;">rel</span><span>=</span><span style="color:#98c379;">"stylesheet" </span><span style="color:#d19a66;">href</span><span>=</span><span style="color:#98c379;">"/css/site1.css"</span><span>&gt;
</span><span>    &lt;</span><span style="color:#e06c75;">script </span><span style="color:#d19a66;">src</span><span>=</span><span style="color:#98c379;">"/js/script1.js"</span><span>&gt;&lt;/</span><span style="color:#e06c75;">script</span><span>&gt;
</span><span>    &lt;</span><span style="color:#e06c75;">script </span><span style="color:#d19a66;">src</span><span>=</span><span style="color:#98c379;">"/js/script2.js"</span><span>&gt;&lt;/</span><span style="color:#e06c75;">script</span><span>&gt;
</span><span>&lt;/</span><span style="color:#e06c75;">head</span><span>&gt;
</span></code></pre> <p>If htmx receives a request containing this new head tag:</p> <pre data-lang="html" style="background-color:#1f2329;color:#abb2bf;" class="language-html "><code class="language-html" data-lang="html"><span>&lt;</span><span style="color:#e06c75;">head</span><span>&gt;
</span><span>    &lt;</span><span style="color:#e06c75;">link </span><span style="color:#d19a66;">rel</span><span>=</span><span style="color:#98c379;">"stylesheet" </span><span style="color:#d19a66;">href</span><span>=</span><span style="color:#98c379;">"https://the.missing.style"</span><span>&gt;
</span><span>    &lt;</span><span style="color:#e06c75;">link </span><span style="color:#d19a66;">rel</span><span>=</span><span style="color:#98c379;">"stylesheet" </span><span style="color:#d19a66;">href</span><span>=</span><span style="color:#98c379;">"/css/site2.css"</span><span>&gt;
</span><span>    &lt;</span><span style="color:#e06c75;">script </span><span style="color:#d19a66;">src</span><span>=</span><span style="color:#98c379;">"/js/script2.js"</span><span>&gt;&lt;/</span><span style="color:#e06c75;">script</span><span>&gt;
</span><span>    &lt;</span><span style="color:#e06c75;">script </span><span style="color:#d19a66;">src</span><span>=</span><span style="color:#98c379;">"/js/script3.js"</span><span>&gt;&lt;/</span><span style="color:#e06c75;">script</span><span>&gt;
</span><span>&lt;/</span><span style="color:#e06c75;">head</span><span>&gt;
</span></code></pre> <p>Then the following operations will occur:</p> <ul> <li>
<code>&lt;link rel="stylesheet" href="https://the.missing.style"&gt;</code> will be left alone</li> <li>
<code>&lt;link rel="stylesheet" href="/css/site1.css.html"&gt;</code> will be removed from the head</li> <li>
<code>&lt;link rel="stylesheet" href="/css/site2.css.html"&gt;</code> will be added to the head</li> <li>
<code>&lt;script src="/js/script1.js"&gt;&lt;/script&gt;</code> will be removed from the head</li> <li>
<code>&lt;script src="/js/script2.js"&gt;&lt;/script&gt;</code> will be left alone</li> <li>
<code>&lt;script src="/js/script3.js"&gt;&lt;/script&gt;</code> will be added to the head</li> </ul> <p>The final head element will look like this:</p> <pre data-lang="html" style="background-color:#1f2329;color:#abb2bf;" class="language-html "><code class="language-html" data-lang="html"><span>&lt;</span><span style="color:#e06c75;">head</span><span>&gt;
</span><span>    &lt;</span><span style="color:#e06c75;">link </span><span style="color:#d19a66;">rel</span><span>=</span><span style="color:#98c379;">"stylesheet" </span><span style="color:#d19a66;">href</span><span>=</span><span style="color:#98c379;">"https://the.missing.style"</span><span>&gt;
</span><span>    &lt;</span><span style="color:#e06c75;">script </span><span style="color:#d19a66;">src</span><span>=</span><span style="color:#98c379;">"/js/script2.js"</span><span>&gt;&lt;/</span><span style="color:#e06c75;">script</span><span>&gt;
</span><span>    &lt;</span><span style="color:#e06c75;">link </span><span style="color:#d19a66;">rel</span><span>=</span><span style="color:#98c379;">"stylesheet" </span><span style="color:#d19a66;">href</span><span>=</span><span style="color:#98c379;">"/css/site2.css"</span><span>&gt;
</span><span>    &lt;</span><span style="color:#e06c75;">script </span><span style="color:#d19a66;">src</span><span>=</span><span style="color:#98c379;">"/js/script3.js"</span><span>&gt;&lt;/</span><span style="color:#e06c75;">script</span><span>&gt;
</span><span>&lt;/</span><span style="color:#e06c75;">head</span><span>&gt;
</span></code></pre> <h2 id="events">Events</h2> <p>This extension triggers the following events:</p> <ul> <li>
<code>htmx:removingHeadElement</code> - triggered when a head element is about to be removed, with the element being removed available in <code>event.detail.headElement</code>. If <code>preventDefault()</code> is invoked on the event, the element will not be removed.</li> <li>
<code>htmx:addingHeadElement</code> - triggered when a head element is about to be added, with the element being added available in <code>event.detail.headElement</code>. If <code>preventDefault()</code> is invoked on the event, the element will not be added.</li> <li>
<code>htmx:afterHeadMerge</code> - triggered after a head tag merge has occurred, with the following values available in the event <code>detail</code>: <ul> <li>
<code>added</code> - added head elements</li> <li>
<code>kept</code> - kept head elements</li> <li>
<code>removed</code> - removed head elements</li> </ul> </li> <li>
<code>htmx:beforeHeadMerge</code> - triggered before a head merge occurs</li> </ul><div class="_attribution">
  <p class="_attribution-p">
    Licensed under the Zero-Clause BSD License.<br>
    <a href="https://htmx.org/extensions/head-support/" class="_attribution-link">https://htmx.org/extensions/head-support/</a>
  </p>
</div>
