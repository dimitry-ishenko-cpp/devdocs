<h1>The <code>preload</code> Extension</h1> <p>The <code>preload</code> extension allows you to load HTML fragments into your browser’s cache before they are requested by the user, so that additional pages appear to users to load nearly instantaneously. As a developer, you can customize its behavior to fit your applications needs and use cases.</p> <p><strong>IMPORTANT:</strong> Preloading content judiciously can improve your web application’s perceived performance, but preloading too many resources can negatively impact your visitors’ bandwidth and your server performance by initiating too many unused requests. Use this extension carefully!</p> <h2 id="install">Install</h2> <pre data-lang="html" style="background-color:#1f2329;color:#abb2bf;" class="language-html "><code class="language-html" data-lang="html"><span>&lt;</span><span style="color:#e06c75;">script </span><span style="color:#d19a66;">src</span><span>=</span><span style="color:#98c379;">"https://unpkg.com/htmx.org/dist/ext/preload.js"</span><span>&gt;&lt;/</span><span style="color:#e06c75;">script</span><span>&gt;
</span></code></pre> <h2 id="usage">Usage</h2> <p>Register the extension with htmx using the <code>hx-ext</code> attribute. Then, add a <code>preload</code> attribute to any hyperlinks and <code>hx-get</code> elements you want to preload. By default, resources will be loaded as soon as the <code>mousedown</code> event begins, giving your application a roughly 100-200ms head start on serving responses. See configuration below for other options.</p> <pre data-lang="html" style="background-color:#1f2329;color:#abb2bf;" class="language-html "><code class="language-html" data-lang="html"><span>&lt;</span><span style="color:#e06c75;">body </span><span style="color:#d19a66;">hx-ext</span><span>=</span><span style="color:#98c379;">"preload"</span><span>&gt;
</span><span>    &lt;</span><span style="color:#e06c75;">h1</span><span>&gt;What Works&lt;/</span><span style="color:#e06c75;">h2</span><span>&gt;
</span><span>    &lt;</span><span style="color:#e06c75;">a </span><span style="color:#d19a66;">href</span><span>=</span><span style="color:#98c379;">"/server/1" </span><span style="color:#d19a66;">preload</span><span>&gt;WILL BE requested using a standard XMLHttpRequest() and default options (below)&lt;/</span><span style="color:#e06c75;">a</span><span>&gt;
</span><span>    &lt;</span><span style="color:#e06c75;">button </span><span style="color:#d19a66;">hx-get</span><span>=</span><span style="color:#98c379;">"/server/2" </span><span style="color:#d19a66;">preload</span><span>&gt;WILL BE requested with additional htmx headers.&lt;/</span><span style="color:#e06c75;">button</span><span>&gt;
</span><span>    &lt;</span><span style="color:#e06c75;">h1</span><span>&gt;What WILL NOT WORK&lt;/</span><span style="color:#e06c75;">h1</span><span>&gt;
</span><span>    &lt;</span><span style="color:#e06c75;">a </span><span style="color:#d19a66;">href</span><span>=</span><span style="color:#98c379;">"/server/3"</span><span>&gt;WILL NOT be preloaded because it does not have an explicit "preload" attribute&lt;/</span><span style="color:#e06c75;">a</span><span>&gt;
</span><span>    &lt;</span><span style="color:#e06c75;">a </span><span style="color:#d19a66;">hx-post</span><span>=</span><span style="color:#98c379;">"/server/4" </span><span style="color:#d19a66;">preload</span><span>&gt;WILL NOT be preloaded because it is an HX-POST transaction.&lt;/</span><span style="color:#e06c75;">a</span><span>&gt;
</span><span>&lt;/</span><span style="color:#e06c75;">body</span><span>&gt;
</span></code></pre> <h3 id="inheriting-preload-settings">Inheriting Preload Settings</h3> <p>You can add the <code>preload</code> attribute to the top-level element that contains several <code>&lt;a href=""&gt;</code> or <code>hx-get=""</code> elements, and all of them will be preloaded. Be careful with this setting, because you can end up wasting bandwidth if you preload many more resources than you need.</p> <pre data-lang="html" style="background-color:#1f2329;color:#abb2bf;" class="language-html "><code class="language-html" data-lang="html"><span>&lt;</span><span style="color:#e06c75;">body </span><span style="color:#d19a66;">hx-ext</span><span>=</span><span style="color:#98c379;">"preload"</span><span>&gt;
</span><span>    &lt;</span><span style="color:#e06c75;">ul </span><span style="color:#d19a66;">preload</span><span>&gt;
</span><span>        &lt;</span><span style="color:#e06c75;">li</span><span>&gt;&lt;</span><span style="color:#e06c75;">a </span><span style="color:#d19a66;">href</span><span>=</span><span style="color:#98c379;">"/server/1"</span><span>&gt;This will be preloaded because of the attribute in the node above.&lt;/</span><span style="color:#e06c75;">a</span><span>&gt;
</span><span>        &lt;</span><span style="color:#e06c75;">li</span><span>&gt;&lt;</span><span style="color:#e06c75;">a </span><span style="color:#d19a66;">href</span><span>=</span><span style="color:#98c379;">"/server/2"</span><span>&gt;This will also be preloaded for the same reason.&lt;/</span><span style="color:#e06c75;">a</span><span>&gt;
</span><span>        &lt;</span><span style="color:#e06c75;">li</span><span>&gt;&lt;</span><span style="color:#e06c75;">a </span><span style="color:#d19a66;">href</span><span>=</span><span style="color:#98c379;">"/server/3"</span><span>&gt;This will be preloaded, too.  Lorem ipsum.&lt;/</span><span style="color:#e06c75;">a</span><span>&gt;
</span><span>    &lt;/</span><span style="color:#e06c75;">ul</span><span>&gt;
</span><span>&lt;/</span><span style="color:#e06c75;">body</span><span>&gt;
</span></code></pre> <h3 id="preloading-of-linked-images">Preloading of Linked Images</h3> <p>After an HTML page (or page fragment) is preloaded, this extension can also preload linked image resources. It will not load or run linked Javascript or Cascading Stylesheet content, whether linked or embedded in the preloaded HTML. To preload images as well, use the following syntax.</p> <pre data-lang="html" style="background-color:#1f2329;color:#abb2bf;" class="language-html "><code class="language-html" data-lang="html"><span>&lt;</span><span style="color:#e06c75;">div </span><span style="color:#d19a66;">hx-ext</span><span>=</span><span style="color:#98c379;">"preload"</span><span>&gt;
</span><span>    &lt;</span><span style="color:#e06c75;">a </span><span style="color:#d19a66;">href</span><span>=</span><span style="color:#98c379;">"/my-next-page" </span><span style="color:#d19a66;">preload</span><span>=</span><span style="color:#98c379;">"mouseover" </span><span style="color:#d19a66;">preload-images</span><span>=</span><span style="color:#98c379;">"true"</span><span>&gt;Next Page&lt;/</span><span style="color:#e06c75;">a</span><span>&gt;
</span><span>&lt;/</span><span style="color:#e06c75;">div</span><span>&gt;
</span></code></pre> <h3 id="configuration">Configuration</h3> <p>Defaults for this extension are chosen to balance users’ perceived performance with potential load on your servers from unused requests. As a developer, you can modify two settings to customize this behavior to your specific use cases.</p> <h4 id="preload-mousedown-default">preload=“mousedown” (DEFAULT)</h4> <p>The default behavior for this extension is to begin loading a resource when the user presses the mouse down. This is a conservative setting that guarantees the user actually intends to use the linked resource. Because user click events typically take 100-200ms to complete, this setting gives your server a significant headstart compared with a regular click.</p> <pre data-lang="html" style="background-color:#1f2329;color:#abb2bf;" class="language-html "><code class="language-html" data-lang="html"><span>&lt;</span><span style="color:#e06c75;">a </span><span style="color:#d19a66;">href</span><span>=</span><span style="color:#98c379;">"/server/1" </span><span style="color:#d19a66;">preload</span><span>=</span><span style="color:#98c379;">"mousedown"</span><span>&gt;This will be preloaded when the user begins to click.&lt;/</span><span style="color:#e06c75;">a</span><span>&gt;
</span></code></pre> <h4 id="preload-mouseover">preload=“mouseover”</h4> <p>To preload links more aggressively, you can trigger the preload to happen when the user’s mouse hovers over the link instead. To prevent many resources from being loaded when the user scrolls or moves the mouse across a large list of objects, a 100ms delay is built in to this action. If the user’s mouse leaves the element <em>before</em> this timeout expires, then the resource is not preloaded.</p> <p>Typical users hover over links for several hundred milliseconds before they click, which gives your server even more time to respond to the request than the <code>mousedown</code> option above. <a rel="noopener" target="_blank" href="http://instantclick.io/click-test">Test your own hover timing here.</a>. However, be careful when using this option because it can increase server load by requesting resources unnecessarily.</p> <pre data-lang="html" style="background-color:#1f2329;color:#abb2bf;" class="language-html "><code class="language-html" data-lang="html"><span>&lt;</span><span style="color:#e06c75;">a </span><span style="color:#d19a66;">href</span><span>=</span><span style="color:#98c379;">"/server/1" </span><span style="color:#d19a66;">preload</span><span>=</span><span style="color:#98c379;">"mouseover"</span><span>&gt;This will be preloaded when the user's mouse remains over it for more than 100ms.&lt;/</span><span style="color:#e06c75;">a</span><span>&gt;
</span></code></pre> <h4 id="preload-custom-event-name">preload=“custom-event-name”</h4> <p>Preload can also listen to any custom event within the system, triggering resources to be preloaded (if they have not already been cached by the browser). The extension itself generates an event called <code>preload:init</code> that can be used to trigger preloads as soon as an object has been processed by htmx.</p> <pre data-lang="html" style="background-color:#1f2329;color:#abb2bf;" class="language-html "><code class="language-html" data-lang="html"><span>&lt;</span><span style="color:#e06c75;">body </span><span style="color:#d19a66;">hx-ext</span><span>=</span><span style="color:#98c379;">"preload"</span><span>&gt;
</span><span>    &lt;</span><span style="color:#e06c75;">button </span><span style="color:#d19a66;">hx-get</span><span>=</span><span style="color:#98c379;">"/server" </span><span style="color:#d19a66;">preload</span><span>=</span><span style="color:#98c379;">"preload:init" </span><span style="color:#d19a66;">hx-target</span><span>=</span><span style="color:#98c379;">"idLoadMore"</span><span>&gt;Load More&lt;/</span><span style="color:#e06c75;">a</span><span>&gt;
</span><span>    &lt;</span><span style="color:#e06c75;">div </span><span style="color:#d19a66;">id</span><span>=</span><span style="color:#98c379;">"idLoadMore"</span><span>&gt;
</span><span>        Content for this DIV will be preloaded as soon as the page is ready.
</span><span>        Clicking the button above will swap it into the DOM.
</span><span>    &lt;/</span><span style="color:#e06c75;">div</span><span>&gt;
</span><span>&lt;/</span><span style="color:#e06c75;">body</span><span>&gt;
</span></code></pre> <h3 id="about-touch-events">About Touch Events</h3> <p>To accommodate touchscreen devices, an additional <code>ontouchstart</code> event handler is added whenever you specify a <code>mouseover</code> or <code>mousedown</code> trigger. This extra trigger fires immediately (no waiting period) whenever the user touches the screen, saving you 300ms of waiting time on Android, and 450ms on iOS.</p> <h3 id="limitations">Limitations</h3> <ul> <li>Links must be marked with a <code>preload</code> attribute, or have an ancestor node that has the <code>preload</code> attribute.</li> <li>Only <code>GET</code> transactions (including <code>&lt;a href=""&gt;</code> and <code>hx-get=""</code>) can be preloaded. Following REST principles, <code>GET</code> transactions are assumed to not make any significant changes to a resource. Transactions that can potentially make a change (such as <code>POST</code>, <code>PUT</code>, and <code>DELETE</code>) will not be preloaded under any circumstances.</li> <li>When listening to <code>mouseover</code> events, preload waits for 100ms before downloading the linked resource. If the mouse leaves the resource before this timeout expires, the resource is not preloaded.</li> <li>Preloaded responses will only be cached in the browser if the response headers allow it. For example, the response header <code>Cache-Control: private, max-age=60</code> allows the browser to cache the response, whereas <code>Cache-Control: no-cache</code> prevents it.</li> </ul> <h2 id="credits">Credits</h2> <p>The behavior for this plugin was inspired by the work done by <a rel="noopener" target="_blank" href="https://github.com/dieulot">Alexandre Dieulot</a> on <a rel="noopener" target="_blank" href="http://instantclick.io/">InstantClick</a>, which is released under the MIT license.</p><div class="_attribution">
  <p class="_attribution-p">
    Licensed under the Zero-Clause BSD License.<br>
    <a href="https://htmx.org/extensions/preload/" class="_attribution-link">https://htmx.org/extensions/preload/</a>
  </p>
</div>
