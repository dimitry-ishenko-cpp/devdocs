<h1 id="conditional-openapi">Conditional OpenAPI</h1> <p>If you needed to, you could use settings and environment variables to configure OpenAPI conditionally depending on the environment, and even disable it entirely.</p> <h2 id="about-security-apis-and-docs">About security, APIs, and docs</h2> <p>Hiding your documentation user interfaces in production <em>shouldn't</em> be the way to protect your API.</p> <p>That doesn't add any extra security to your API, the <em>path operations</em> will still be available where they are.</p> <p>If there's a security flaw in your code, it will still exist.</p> <p>Hiding the documentation just makes it more difficult to understand how to interact with your API, and could make it more difficult for you to debug it in production. It could be considered simply a form of <a href="https://en.wikipedia.org/wiki/Security_through_obscurity" class="external-link" target="_blank">Security through obscurity</a>.</p> <p>If you want to secure your API, there are several better things you can do, for example:</p> <ul> <li>Make sure you have well defined Pydantic models for your request bodies and responses.</li> <li>Configure any required permissions and roles using dependencies.</li> <li>Never store plaintext passwords, only password hashes.</li> <li>Implement and use well-known cryptographic tools, like Passlib and JWT tokens, etc.</li> <li>Add more granular permission controls with OAuth2 scopes where needed.</li> <li>...etc.</li> </ul> <p>Nevertheless, you might have a very specific use case where you really need to disable the API docs for some environment (e.g. for production) or depending on configurations from environment variables.</p> <h2 id="conditional-openapi-from-settings-and-env-vars">Conditional OpenAPI from settings and env vars</h2> <p>You can easily use the same Pydantic settings to configure your generated OpenAPI and the docs UIs.</p> <p>For example:</p> <div class="highlight"><pre class="language-python" data-language="python">from fastapi import FastAPI
from pydantic_settings import BaseSettings


class Settings(BaseSettings):
    openapi_url: str = "/openapi.json"


settings = Settings()

app = FastAPI(openapi_url=settings.openapi_url)


@app.get("/")
def root():
    return {"message": "Hello World"}
</pre></div> <p>Here we declare the setting <code>openapi_url</code> with the same default of <code>"/openapi.json"</code>.</p> <p>And then we use it when creating the <code>FastAPI</code> app.</p> <p>Then you could disable OpenAPI (including the UI docs) by setting the environment variable <code>OPENAPI_URL</code> to the empty string, like:</p> <div class="termy"> <div class="highlight"><pre class="language-python" data-language="python">$ OPENAPI_URL= uvicorn main:app

&lt;span style="color: green;"&gt;INFO&lt;/span&gt;:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
</pre></div> </div> <p>Then if you go to the URLs at <code>/openapi.json</code>, <code>/docs</code>, or <code>/redoc</code> you will just get a <code>404 Not Found</code> error like:</p> <div class="highlight"><pre class="language-python" data-language="python">{
    "detail": "Not Found"
}
</pre></div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2018 Sebastián Ramírez<br>Licensed under the MIT License.<br>
    <a href="https://fastapi.tiangolo.com/advanced/conditional-openapi/" class="_attribution-link">https://fastapi.tiangolo.com/advanced/conditional-openapi/</a>
  </p>
</div>
