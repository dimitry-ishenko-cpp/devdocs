<h1 id="testing-events-startup-shutdown">Testing Events: startup - shutdown</h1> <p>When you need your event handlers (<code>startup</code> and <code>shutdown</code>) to run in your tests, you can use the <code>TestClient</code> with a <code>with</code> statement:</p> <div class="highlight"><pre class="language-python" data-language="python">from fastapi import FastAPI
from fastapi.testclient import TestClient

app = FastAPI()

items = {}


@app.on_event("startup")
async def startup_event():
    items["foo"] = {"name": "Fighters"}
    items["bar"] = {"name": "Tenders"}


@app.get("/items/{item_id}")
async def read_items(item_id: str):
    return items[item_id]


def test_read_items():
    with TestClient(app) as client:
        response = client.get("/items/foo")
        assert response.status_code == 200
        assert response.json() == {"name": "Fighters"}
</pre></div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2018 Sebastián Ramírez<br>Licensed under the MIT License.<br>
    <a href="https://fastapi.tiangolo.com/advanced/testing-events/" class="_attribution-link">https://fastapi.tiangolo.com/advanced/testing-events/</a>
  </p>
</div>
