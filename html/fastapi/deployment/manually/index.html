<h1 id="run-a-server-manually-uvicorn">Run a Server Manually - Uvicorn</h1> <p>The main thing you need to run a <strong>FastAPI</strong> application in a remote server machine is an ASGI server program like <strong>Uvicorn</strong>.</p> <p>There are 3 main alternatives:</p> <ul> <li>
<a href="https://www.uvicorn.org/" class="external-link" target="_blank">Uvicorn</a>: a high performance ASGI server.</li> <li>
<a href="https://pgjones.gitlab.io/hypercorn/" class="external-link" target="_blank">Hypercorn</a>: an ASGI server compatible with HTTP/2 and Trio among other features.</li> <li>
<a href="https://github.com/django/daphne" class="external-link" target="_blank">Daphne</a>: the ASGI server built for Django Channels.</li> </ul> <h2 id="server-machine-and-server-program">Server Machine and Server Program</h2> <p>There's a small detail about names to have in mind. ðŸ’¡</p> <p>The word "<strong>server</strong>" is commonly used to refer to both the remote/cloud computer (the physical or virtual machine) and also the program that is running on that machine (e.g. Uvicorn).</p> <p>Just have that in mind when you read "server" in general, it could refer to one of those two things.</p> <p>When referring to the remote machine, it's common to call it <strong>server</strong>, but also <strong>machine</strong>, <strong>VM</strong> (virtual machine), <strong>node</strong>. Those all refer to some type of remote machine, normally running Linux, where you run programs.</p> <h2 id="install-the-server-program">Install the Server Program</h2> <p>You can install an ASGI compatible server with:</p> <div class="tabbed-set tabbed-alternate" data-tabs="1:2"> <div class="tabbed-content"> <div class="tabbed-block">
<label for="__tabbed_1_1">Uvicorn</label> <ul> <li>
<a href="https://www.uvicorn.org/" class="external-link" target="_blank">Uvicorn</a>, a lightning-fast ASGI server, built on uvloop and httptools.</li> </ul> <div class="termy"> <div class="highlight"><pre class="language-python" data-language="python">$ pip install "uvicorn[standard]"

---&gt; 100%
</pre></div> </div> <div class="admonition tip"> <p class="admonition-title">Tip</p> <p>By adding the <code>standard</code>, Uvicorn will install and use some recommended extra dependencies.</p> <p>That including <code>uvloop</code>, the high-performance drop-in replacement for <code>asyncio</code>, that provides the big concurrency performance boost.</p> </div> </div> <div class="tabbed-block">
<label for="__tabbed_1_2">Hypercorn</label> <ul> <li>
<a href="https://gitlab.com/pgjones/hypercorn" class="external-link" target="_blank">Hypercorn</a>, an ASGI server also compatible with HTTP/2.</li> </ul> <div class="termy"> <div class="highlight"><pre class="language-python" data-language="python">$ pip install hypercorn

---&gt; 100%
</pre></div> </div> <p>...or any other ASGI server.</p> </div> </div> </div> <h2 id="run-the-server-program">Run the Server Program</h2> <p>You can then run your application the same way you have done in the tutorials, but without the <code>--reload</code> option, e.g.:</p> <div class="tabbed-set tabbed-alternate" data-tabs="2:2"> <div class="tabbed-content"> <div class="tabbed-block">
<label for="__tabbed_2_1">Uvicorn</label> <div class="termy"> <div class="highlight"><pre class="language-python" data-language="python">$ uvicorn main:app --host 0.0.0.0 --port 80

&lt;span style="color: green;"&gt;INFO&lt;/span&gt;:     Uvicorn running on http://0.0.0.0:80 (Press CTRL+C to quit)
</pre></div> </div> </div> <div class="tabbed-block">
<label for="__tabbed_2_2">Hypercorn</label> <div class="termy"> <div class="highlight"><pre class="language-python" data-language="python">$ hypercorn main:app --bind 0.0.0.0:80

Running on 0.0.0.0:8080 over http (CTRL + C to quit)
</pre></div> </div> </div> </div> </div> <div class="admonition warning"> <p class="admonition-title">Warning</p> <p>Remember to remove the <code>--reload</code> option if you were using it.</p> <p>The <code>--reload</code> option consumes much more resources, is more unstable, etc.</p> <p>It helps a lot during <strong>development</strong>, but you <strong>shouldn't</strong> use it in <strong>production</strong>.</p> </div> <h2 id="hypercorn-with-trio">Hypercorn with Trio</h2> <p>Starlette and <strong>FastAPI</strong> are based on <a href="https://anyio.readthedocs.io/en/stable/" class="external-link" target="_blank">AnyIO</a>, which makes them compatible with both Python's standard library <a href="https://docs.python.org/3/library/asyncio-task.html" class="external-link" target="_blank">asyncio</a> and <a href="https://trio.readthedocs.io/en/stable/" class="external-link" target="_blank">Trio</a>.</p> <p>Nevertheless, Uvicorn is currently only compatible with asyncio, and it normally uses <a href="https://github.com/MagicStack/uvloop" class="external-link" target="_blank"><code>uvloop</code></a>, the high-performance drop-in replacement for <code>asyncio</code>.</p> <p>But if you want to directly use <strong>Trio</strong>, then you can use <strong>Hypercorn</strong> as it supports it. âœ¨</p> <h3 id="install-hypercorn-with-trio">Install Hypercorn with Trio</h3> <p>First you need to install Hypercorn with Trio support:</p> <div class="termy"> <div class="highlight"><pre class="language-python" data-language="python">$ pip install "hypercorn[trio]"
---&gt; 100%
</pre></div> </div> <h3 id="run-with-trio">Run with Trio</h3> <p>Then you can pass the command line option <code>--worker-class</code> with the value <code>trio</code>:</p> <div class="termy"> <div class="highlight"><pre class="language-python" data-language="python">$ hypercorn main:app --worker-class trio
</pre></div> </div> <p>And that will start Hypercorn with your app using Trio as the backend.</p> <p>Now you can use Trio internally in your app. Or even better, you can use AnyIO, to keep your code compatible with both Trio and asyncio. ðŸŽ‰</p> <h2 id="deployment-concepts">Deployment Concepts</h2> <p>These examples run the server program (e.g Uvicorn), starting <strong>a single process</strong>, listening on all the IPs (<code>0.0.0.0</code>) on a predefined port (e.g. <code>80</code>).</p> <p>This is the basic idea. But you will probably want to take care of some additional things, like:</p> <ul> <li>Security - HTTPS</li> <li>Running on startup</li> <li>Restarts</li> <li>Replication (the number of processes running)</li> <li>Memory</li> <li>Previous steps before starting</li> </ul> <p>I'll tell you more about each of these concepts, how to think about them, and some concrete examples with strategies to handle them in the next chapters. ðŸš€</p><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2018 SebastiÃ¡n RamÃ­rez<br>Licensed under the MIT License.<br>
    <a href="https://fastapi.tiangolo.com/deployment/manually/" class="_attribution-link">https://fastapi.tiangolo.com/deployment/manually/</a>
  </p>
</div>
