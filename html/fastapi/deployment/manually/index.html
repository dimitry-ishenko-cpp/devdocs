<h1 id="run-a-server-manually">Run a Server Manually</h1> <h2 id="use-the-fastapi-run-command">Use the <code>fastapi run</code> Command</h2> <p>In short, use <code>fastapi run</code> to serve your FastAPI application:</p> <div class="termy"> <div class="highlight"><pre class="language-python" data-language="python">$ &lt;font color="#4E9A06"&gt;fastapi&lt;/font&gt; run &lt;u style="text-decoration-style:single"&gt;main.py&lt;/u&gt;
&lt;font color="#3465A4"&gt;INFO    &lt;/font&gt; Using path &lt;font color="#3465A4"&gt;main.py&lt;/font&gt;
&lt;font color="#3465A4"&gt;INFO    &lt;/font&gt; Resolved absolute path &lt;font color="#75507B"&gt;/home/user/code/awesomeapp/&lt;/font&gt;&lt;font color="#AD7FA8"&gt;main.py&lt;/font&gt;
&lt;font color="#3465A4"&gt;INFO    &lt;/font&gt; Searching for package file structure from directories with &lt;font color="#3465A4"&gt;__init__.py&lt;/font&gt; files
&lt;font color="#3465A4"&gt;INFO    &lt;/font&gt; Importing from &lt;font color="#75507B"&gt;/home/user/code/&lt;/font&gt;&lt;font color="#AD7FA8"&gt;awesomeapp&lt;/font&gt;

 ╭─ &lt;font color="#8AE234"&gt;&lt;b&gt;Python module file&lt;/b&gt;&lt;/font&gt; ─╮
 │                      │
 │  🐍 main.py          │
 │                      │
 ╰──────────────────────╯

&lt;font color="#3465A4"&gt;INFO    &lt;/font&gt; Importing module &lt;font color="#4E9A06"&gt;main&lt;/font&gt;
&lt;font color="#3465A4"&gt;INFO    &lt;/font&gt; Found importable FastAPI app

 ╭─ &lt;font color="#8AE234"&gt;&lt;b&gt;Importable FastAPI app&lt;/b&gt;&lt;/font&gt; ─╮
 │                          │
 │  &lt;span style="background-color:#272822"&gt;&lt;font color="#FF4689"&gt;from&lt;/font&gt;&lt;/span&gt;&lt;span style="background-color:#272822"&gt;&lt;font color="#F8F8F2"&gt; main &lt;/font&gt;&lt;/span&gt;&lt;span style="background-color:#272822"&gt;&lt;font color="#FF4689"&gt;import&lt;/font&gt;&lt;/span&gt;&lt;span style="background-color:#272822"&gt;&lt;font color="#F8F8F2"&gt; app&lt;/font&gt;&lt;/span&gt;&lt;span style="background-color:#272822"&gt;  &lt;/span&gt;  │
 │                          │
 ╰──────────────────────────╯

&lt;font color="#3465A4"&gt;INFO    &lt;/font&gt; Using import string &lt;font color="#8AE234"&gt;&lt;b&gt;main:app&lt;/b&gt;&lt;/font&gt;

 &lt;font color="#4E9A06"&gt;╭─────────── FastAPI CLI - Production mode ───────────╮&lt;/font&gt;
 &lt;font color="#4E9A06"&gt;│                                                     │&lt;/font&gt;
 &lt;font color="#4E9A06"&gt;│  Serving at: http://0.0.0.0:8000                    │&lt;/font&gt;
 &lt;font color="#4E9A06"&gt;│                                                     │&lt;/font&gt;
 &lt;font color="#4E9A06"&gt;│  API docs: http://0.0.0.0:8000/docs                 │&lt;/font&gt;
 &lt;font color="#4E9A06"&gt;│                                                     │&lt;/font&gt;
 &lt;font color="#4E9A06"&gt;│  Running in production mode, for development use:   │&lt;/font&gt;
 &lt;font color="#4E9A06"&gt;│                                                     │&lt;/font&gt;
 &lt;font color="#4E9A06"&gt;│  &lt;/font&gt;&lt;font color="#8AE234"&gt;&lt;b&gt;fastapi dev&lt;/b&gt;&lt;/font&gt;&lt;font color="#4E9A06"&gt;                                        │&lt;/font&gt;
 &lt;font color="#4E9A06"&gt;│                                                     │&lt;/font&gt;
 &lt;font color="#4E9A06"&gt;╰─────────────────────────────────────────────────────╯&lt;/font&gt;

&lt;font color="#4E9A06"&gt;INFO&lt;/font&gt;:     Started server process [&lt;font color="#06989A"&gt;2306215&lt;/font&gt;]
&lt;font color="#4E9A06"&gt;INFO&lt;/font&gt;:     Waiting for application startup.
&lt;font color="#4E9A06"&gt;INFO&lt;/font&gt;:     Application startup complete.
&lt;font color="#4E9A06"&gt;INFO&lt;/font&gt;:     Uvicorn running on &lt;b&gt;http://0.0.0.0:8000&lt;/b&gt; (Press CTRL+C to quit)
</pre></div> </div> <p>That would work for most of the cases. 😎</p> <p>You could use that command for example to start your <strong>FastAPI</strong> app in a container, in a server, etc.</p> <h2 id="asgi-servers">ASGI Servers</h2> <p>Let's go a little deeper into the details.</p> <p>FastAPI uses a standard for building Python web frameworks and servers called <abbr title="Asynchronous Server Gateway Interface">ASGI</abbr>. FastAPI is an ASGI web framework.</p> <p>The main thing you need to run a <strong>FastAPI</strong> application (or any other ASGI application) in a remote server machine is an ASGI server program like <strong>Uvicorn</strong>, this is the one that comes by default in the <code>fastapi</code> command.</p> <p>There are several alternatives, including:</p> <ul> <li>
<a href="https://www.uvicorn.org/" class="external-link" target="_blank">Uvicorn</a>: a high performance ASGI server.</li> <li>
<a href="https://hypercorn.readthedocs.io/" class="external-link" target="_blank">Hypercorn</a>: an ASGI server compatible with HTTP/2 and Trio among other features.</li> <li>
<a href="https://github.com/django/daphne" class="external-link" target="_blank">Daphne</a>: the ASGI server built for Django Channels.</li> </ul> <h2 id="server-machine-and-server-program">Server Machine and Server Program</h2> <p>There's a small detail about names to keep in mind. 💡</p> <p>The word "<strong>server</strong>" is commonly used to refer to both the remote/cloud computer (the physical or virtual machine) and also the program that is running on that machine (e.g. Uvicorn).</p> <p>Just keep in mind that when you read "server" in general, it could refer to one of those two things.</p> <p>When referring to the remote machine, it's common to call it <strong>server</strong>, but also <strong>machine</strong>, <strong>VM</strong> (virtual machine), <strong>node</strong>. Those all refer to some type of remote machine, normally running Linux, where you run programs.</p> <h2 id="install-the-server-program">Install the Server Program</h2> <p>When you install FastAPI, it comes with a production server, Uvicorn, and you can start it with the <code>fastapi run</code> command.</p> <p>But you can also install an ASGI server manually:</p> <div class="tabbed-set tabbed-alternate" data-tabs="1:2"> <div class="tabbed-content"> <div class="tabbed-block">
<label for="__tabbed_1_1">Uvicorn</label> <ul> <li>
<a href="https://www.uvicorn.org/" class="external-link" target="_blank">Uvicorn</a>, a lightning-fast ASGI server, built on uvloop and httptools.</li> </ul> <div class="termy"> <div class="highlight"><pre class="language-python" data-language="python">$ pip install "uvicorn[standard]"

---&gt; 100%
</pre></div> </div> <div class="admonition tip"> <p class="admonition-title">Tip</p> <p>By adding the <code>standard</code>, Uvicorn will install and use some recommended extra dependencies.</p> <p>That including <code>uvloop</code>, the high-performance drop-in replacement for <code>asyncio</code>, that provides the big concurrency performance boost.</p> <p>When you install FastAPI with something like <code>pip install fastapi</code> you already get <code>uvicorn[standard]</code> as well.</p> </div> </div> <div class="tabbed-block">
<label for="__tabbed_1_2">Hypercorn</label> <ul> <li>
<a href="https://github.com/pgjones/hypercorn" class="external-link" target="_blank">Hypercorn</a>, an ASGI server also compatible with HTTP/2.</li> </ul> <div class="termy"> <div class="highlight"><pre class="language-python" data-language="python">$ pip install hypercorn

---&gt; 100%
</pre></div> </div> <p>...or any other ASGI server.</p> </div> </div> </div> <h2 id="run-the-server-program">Run the Server Program</h2> <p>If you installed an ASGI server manually, you would normally need to pass an import string in a special format for it to import your FastAPI application:</p> <div class="tabbed-set tabbed-alternate" data-tabs="2:2"> <div class="tabbed-content"> <div class="tabbed-block">
<label for="__tabbed_2_1">Uvicorn</label> <div class="termy"> <div class="highlight"><pre class="language-python" data-language="python">$ uvicorn main:app --host 0.0.0.0 --port 80

&lt;span style="color: green;"&gt;INFO&lt;/span&gt;:     Uvicorn running on http://0.0.0.0:80 (Press CTRL+C to quit)
</pre></div> </div> </div> <div class="tabbed-block">
<label for="__tabbed_2_2">Hypercorn</label> <div class="termy"> <div class="highlight"><pre class="language-python" data-language="python">$ hypercorn main:app --bind 0.0.0.0:80

Running on 0.0.0.0:8080 over http (CTRL + C to quit)
</pre></div> </div> </div> </div> </div> <div class="admonition note"> <p class="admonition-title">Note</p> <p>The command <code>uvicorn main:app</code> refers to:</p> <ul> <li>
<code>main</code>: the file <code>main.py</code> (the Python "module").</li> <li>
<code>app</code>: the object created inside of <code>main.py</code> with the line <code>app = FastAPI()</code>.</li> </ul> <p>It is equivalent to:</p> <div class="highlight"><pre class="language-python" data-language="python">from main import app
</pre></div> </div> <div class="admonition warning"> <p class="admonition-title">Warning</p> <p>Uvicorn and others support a <code>--reload</code> option that is useful during development.</p> <p>The <code>--reload</code> option consumes much more resources, is more unstable, etc.</p> <p>It helps a lot during <strong>development</strong>, but you <strong>shouldn't</strong> use it in <strong>production</strong>.</p> </div> <h2 id="hypercorn-with-trio">Hypercorn with Trio</h2> <p>Starlette and <strong>FastAPI</strong> are based on <a href="https://anyio.readthedocs.io/en/stable/" class="external-link" target="_blank">AnyIO</a>, which makes them compatible with both Python's standard library <a href="https://docs.python.org/3/library/asyncio-task.html" class="external-link" target="_blank">asyncio</a> and <a href="https://trio.readthedocs.io/en/stable/" class="external-link" target="_blank">Trio</a>.</p> <p>Nevertheless, Uvicorn is currently only compatible with asyncio, and it normally uses <a href="https://github.com/MagicStack/uvloop" class="external-link" target="_blank"><code>uvloop</code></a>, the high-performance drop-in replacement for <code>asyncio</code>.</p> <p>But if you want to directly use <strong>Trio</strong>, then you can use <strong>Hypercorn</strong> as it supports it. ✨</p> <h3 id="install-hypercorn-with-trio">Install Hypercorn with Trio</h3> <p>First you need to install Hypercorn with Trio support:</p> <div class="termy"> <div class="highlight"><pre class="language-python" data-language="python">$ pip install "hypercorn[trio]"
---&gt; 100%
</pre></div> </div> <h3 id="run-with-trio">Run with Trio</h3> <p>Then you can pass the command line option <code>--worker-class</code> with the value <code>trio</code>:</p> <div class="termy"> <div class="highlight"><pre class="language-python" data-language="python">$ hypercorn main:app --worker-class trio
</pre></div> </div> <p>And that will start Hypercorn with your app using Trio as the backend.</p> <p>Now you can use Trio internally in your app. Or even better, you can use AnyIO, to keep your code compatible with both Trio and asyncio. 🎉</p> <h2 id="deployment-concepts">Deployment Concepts</h2> <p>These examples run the server program (e.g Uvicorn), starting <strong>a single process</strong>, listening on all the IPs (<code>0.0.0.0</code>) on a predefined port (e.g. <code>80</code>).</p> <p>This is the basic idea. But you will probably want to take care of some additional things, like:</p> <ul> <li>Security - HTTPS</li> <li>Running on startup</li> <li>Restarts</li> <li>Replication (the number of processes running)</li> <li>Memory</li> <li>Previous steps before starting</li> </ul> <p>I'll tell you more about each of these concepts, how to think about them, and some concrete examples with strategies to handle them in the next chapters. 🚀</p><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2018 Sebastián Ramírez<br>Licensed under the MIT License.<br>
    <a href="https://fastapi.tiangolo.com/deployment/manually/" class="_attribution-link">https://fastapi.tiangolo.com/deployment/manually/</a>
  </p>
</div>
