<h1>TAP::Parser::IteratorFactory</h1>   <h2><a id="toc">CONTENTS</a></h2> <ul> <li> <a class="text-decoration-none" href="#NAME">NAME</a> </li> <li> <a class="text-decoration-none" href="#VERSION">VERSION</a> </li> <li> <a class="text-decoration-none" href="#SYNOPSIS">SYNOPSIS</a> </li> <li> <a class="text-decoration-none" href="#DESCRIPTION">DESCRIPTION</a> </li> <li> <a class="text-decoration-none" href="#METHODS">METHODS</a> <ul> <li> <a class="text-decoration-none" href="#Class-Methods">Class Methods</a> <ul> <li> <a class="text-decoration-none" href="#new">new</a> </li> <li> <a class="text-decoration-none" href="#register_handler">register_handler</a> </li> <li> <a class="text-decoration-none" href="#handlers">handlers</a> </li> </ul> </li> <li> <a class="text-decoration-none" href="#Instance-Methods">Instance Methods</a> <ul> <li> <a class="text-decoration-none" href="#config">config</a> </li> <li> <a class="text-decoration-none" href="#load_handlers">load_handlers</a> </li> <li> <a class="text-decoration-none" href="#make_iterator">make_iterator</a> </li> <li> <a class="text-decoration-none" href="#detect_source">detect_source</a> </li> </ul> </li> </ul> </li> <li> <a class="text-decoration-none" href="#SUBCLASSING">SUBCLASSING</a> <ul> <li> <a class="text-decoration-none" href="#Example">Example</a> </li> </ul> </li> <li> <a class="text-decoration-none" href="#AUTHORS">AUTHORS</a> </li> <li> <a class="text-decoration-none" href="#ATTRIBUTION">ATTRIBUTION</a> </li> <li> <a class="text-decoration-none" href="#SEE-ALSO">SEE ALSO</a> </li> </ul> <h2 id="NAME">NAME</h2> <p>TAP::Parser::IteratorFactory - Figures out which SourceHandler objects to use for a given Source</p> <h2 id="VERSION">VERSION</h2> <p>Version 3.44</p> <h2 id="SYNOPSIS">SYNOPSIS</h2> <pre data-language="perl"><code>use TAP::Parser::IteratorFactory;
my $factory = TAP::Parser::IteratorFactory-&gt;new({ %config });
my $iterator  = $factory-&gt;make_iterator( $filename );</code></pre> <h2 id="DESCRIPTION">DESCRIPTION</h2> <p>This is a factory class that takes a <a href="TAP::Parser::Source.html">TAP::Parser::Source</a> and runs it through all the registered <a href="TAP::Parser::SourceHandler.html">TAP::Parser::SourceHandler</a>s to see which one should handle the source.</p> <p>If you're a plugin author, you'll be interested in how to <a href="#register_handler">"register_handler"</a>s, how <a href="#detect_source">"detect_source"</a> works.</p> <h2 id="METHODS">METHODS</h2> <h3 id="Class-Methods">
Class Methods</h3> <h4 id="new"><code>new</code></h4> <p>Creates a new factory class:</p> <pre data-language="perl"><code>my $sf = TAP::Parser::IteratorFactory-&gt;new( $config );</code></pre> <p><code>$config</code> is optional. If given, sets <a href="#config">"config"</a> and calls <a href="#load_handlers">"load_handlers"</a>.</p> <h4 id="register_handler"><code>register_handler</code></h4> <p>Registers a new <a href="TAP::Parser::SourceHandler.html">TAP::Parser::SourceHandler</a> with this factory.</p> <pre data-language="perl"><code>__PACKAGE__-&gt;register_handler( $handler_class );</code></pre> <h4 id="handlers"><code>handlers</code></h4> <p>List of handlers that have been registered.</p> <h3 id="Instance-Methods">
Instance Methods</h3> <h4 id="config"><code>config</code></h4> <pre data-language="perl"><code>my $cfg = $sf-&gt;config;
$sf-&gt;config({ Perl =&gt; { %config } });</code></pre> <p>Chaining getter/setter for the configuration of the available source handlers. This is a hashref keyed on handler class whose values contain config to be passed onto the handlers during detection &amp; creation. Class names may be fully qualified or abbreviated, eg:</p> <pre data-language="perl"><code># these are equivalent
$sf-&gt;config({ 'TAP::Parser::SourceHandler::Perl' =&gt; { %config } });
$sf-&gt;config({ 'Perl' =&gt; { %config } });</code></pre> <h4 id="load_handlers"><code>load_handlers</code></h4> <pre data-language="perl"><code>$sf-&gt;load_handlers;</code></pre> <p>Loads the handler classes defined in <a href="#config">"config"</a>. For example, given a config:</p> <pre data-language="perl"><code>$sf-&gt;config({
  MySourceHandler =&gt; { some =&gt; 'config' },
});</code></pre> <p><code>load_handlers</code> will attempt to load the <code>MySourceHandler</code> class by looking in <code>@INC</code> for it in this order:</p> <pre data-language="perl"><code class="plaintext">TAP::Parser::SourceHandler::MySourceHandler
MySourceHandler</code></pre> <p><code>croak</code>s on error.</p> <h4 id="make_iterator"><code>make_iterator</code></h4> <pre data-language="perl"><code>my $iterator = $src_factory-&gt;make_iterator( $source );</code></pre> <p>Given a <a href="TAP::Parser::Source.html">TAP::Parser::Source</a>, finds the most suitable <a href="TAP::Parser::SourceHandler.html">TAP::Parser::SourceHandler</a> to use to create a <a href="TAP::Parser::Iterator.html">TAP::Parser::Iterator</a> (see <a href="#detect_source">"detect_source"</a>). Dies on error.</p> <h4 id="detect_source"><code>detect_source</code></h4> <p>Given a <a href="TAP::Parser::Source.html">TAP::Parser::Source</a>, detects what kind of source it is and returns <i>one</i> <a href="TAP::Parser::SourceHandler.html">TAP::Parser::SourceHandler</a> (the most confident one). Dies on error.</p> <p>The detection algorithm works something like this:</p> <pre data-language="perl"><code>for (@registered_handlers) {
  # ask them how confident they are about handling this source
  $confidence{$handler} = $handler-&gt;can_handle( $source )
}
# choose the most confident handler</code></pre> <p>Ties are handled by choosing the first handler.</p> <h2 id="SUBCLASSING">SUBCLASSING</h2> <p>Please see <a href="TAP::Parser.html#SUBCLASSING">"SUBCLASSING" in TAP::Parser</a> for a subclassing overview.</p> <h3 id="Example">Example</h3> <p>If we've done things right, you'll probably want to write a new source, rather than sub-classing this (see <a href="TAP::Parser::SourceHandler.html">TAP::Parser::SourceHandler</a> for that).</p> <p>But in case you find the need to...</p> <pre data-language="perl"><code>package MyIteratorFactory;

use strict;

use base 'TAP::Parser::IteratorFactory';

# override source detection algorithm
sub detect_source {
  my ($self, $raw_source_ref, $meta) = @_;
  # do detective work, using $meta and whatever else...
}

1;</code></pre> <h2 id="AUTHORS">AUTHORS</h2> <p>Steve Purkis</p> <h2 id="ATTRIBUTION">ATTRIBUTION</h2> <p>Originally ripped off from <a href="Test::Harness.html">Test::Harness</a>.</p> <p>Moved out of <a href="TAP::Parser.html">TAP::Parser</a> &amp; converted to a factory class to support extensible TAP source detective work by Steve Purkis.</p> <h2 id="SEE-ALSO">
SEE ALSO</h2> <p><a href="TAP::Object.html">TAP::Object</a>, <a href="TAP::Parser.html">TAP::Parser</a>, <a href="TAP::Parser::SourceHandler.html">TAP::Parser::SourceHandler</a>, <a href="TAP::Parser::SourceHandler::File.html">TAP::Parser::SourceHandler::File</a>, <a href="TAP::Parser::SourceHandler::Perl.html">TAP::Parser::SourceHandler::Perl</a>, <a href="TAP::Parser::SourceHandler::RawTAP.html">TAP::Parser::SourceHandler::RawTAP</a>, <a href="TAP::Parser::SourceHandler::Handle.html">TAP::Parser::SourceHandler::Handle</a>, <a href="TAP::Parser::SourceHandler::Executable.html">TAP::Parser::SourceHandler::Executable</a></p><div class="_attribution">
  <p class="_attribution-p">
    &copy; 1993&ndash;2023 Larry Wall and others<br>Licensed under the GNU General Public License version 1 or later, or the Artistic License.<br>The Perl logo is a trademark of the Perl Foundation.<br>
    <a href="https://perldoc.perl.org/5.38.0/TAP::Parser::IteratorFactory" class="_attribution-link">https://perldoc.perl.org/5.38.0/TAP::Parser::IteratorFactory</a>
  </p>
</div>
