<h1>autodie::Util</h1>   <h2><a id="toc">CONTENTS</a></h2> <ul> <li> <a class="text-decoration-none" href="#NAME">NAME</a> </li> <li> <a class="text-decoration-none" href="#SYNOPSIS">SYNOPSIS</a> </li> <li> <a class="text-decoration-none" href="#DESCRIPTION">DESCRIPTION</a> <ul> <li> <a class="text-decoration-none" href="#Methods">Methods</a> <ul> <li> <a class="text-decoration-none" href="#on_end_of_compile_scope">on_end_of_compile_scope</a> </li> <li> <a class="text-decoration-none" href="#fill_protos">fill_protos</a> </li> <li> <a class="text-decoration-none" href="#make_core_trampoline">make_core_trampoline</a> </li> <li> <a class="text-decoration-none" href="#install_subs">install_subs</a> </li> </ul> </li> </ul> </li> <li> <a class="text-decoration-none" href="#AUTHOR">AUTHOR</a> </li> <li> <a class="text-decoration-none" href="#LICENSE">LICENSE</a> </li> </ul> <h2 id="NAME">NAME</h2> <p>autodie::Util - Internal Utility subroutines for autodie and Fatal</p> <h2 id="SYNOPSIS">SYNOPSIS</h2> <pre data-language="perl"><code># INTERNAL API for autodie and Fatal only!

use autodie::Util qw(on_end_of_compile_scope);
on_end_of_compile_scope(sub { print "Hallo world\n"; });</code></pre> <h2 id="DESCRIPTION">DESCRIPTION</h2> <p>Internal Utilities for autodie and Fatal! This module is not a part of autodie's public API.</p> <p>This module contains utility subroutines for abstracting away the underlying magic of autodie and (ab)uses of <code>%^H</code> to call subs at the end of a (compile-time) scopes.</p> <p>Note that due to how <code>%^H</code> works, some of these utilities are only useful during the compilation phase of a perl module and relies on the internals of how perl handles references in <code>%^H</code>.</p> <h3 id="Methods">Methods</h3> <h4 id="on_end_of_compile_scope">on_end_of_compile_scope</h4> <pre data-language="perl"><code>on_end_of_compile_scope(sub { print "Hallo world\n"; });</code></pre> <p>Will invoke a sub at the end of a (compile-time) scope. The sub is called once with no arguments. Can be called multiple times (even in the same "compile-time" scope) to install multiple subs. Subs are called in a "first-in-last-out"-order (FILO or "stack"-order).</p> <h4 id="fill_protos">fill_protos</h4> <pre data-language="perl"><code class="plaintext">fill_protos('*$$;$@')</code></pre> <p>Given a Perl subroutine prototype, return a list of invocation specifications. Each specification is a listref, where the first member is the (minimum) number of arguments for this invocation specification. The remaining arguments are a string representation of how to pass the arguments correctly to a sub with the given prototype, when called with the given number of arguments.</p> <p>The specifications are returned in increasing order of arguments starting at 0 (e.g. ';$') or 1 (e.g. '$@'). Note that if the prototype is "slurpy" (e.g. ends with a "@"), the number of arguments for the last specification is a "minimum" number rather than an exact number. This can be detected by the last member of the last specification matching m/[@#]_/.</p> <h4 id="make_core_trampoline">make_core_trampoline</h4> <pre data-language="perl"><code class="plaintext">make_core_trampoline('CORE::open', 'main', prototype('CORE::open'))</code></pre> <p>Creates a trampoline for calling a core sub. Essentially, a tiny sub that figures out how we should be calling our core sub, puts in the arguments in the right way, and bounces our control over to it.</p> <p>If we could reliably use `goto &amp;` on core builtins, we wouldn't need this subroutine.</p> <h4 id="install_subs">install_subs</h4> <pre data-language="perl"><code class="plaintext">install_subs('My::Module', { 'read' =&gt; sub { die("Hallo\n"), ... }})</code></pre> <p>Given a package name and a hashref mapping names to a subroutine reference (or <code>undef</code>), this subroutine will install said subroutines on their given name in that module. If a name mapes to <code>undef</code>, any subroutine with that name in the target module will be removed (possibly "unshadowing" a CORE sub of same name).</p> <h2 id="AUTHOR">AUTHOR</h2> <p>Copyright 2013-2014, Niels Thykier &lt;niels@thykier.net&gt;</p> <h2 id="LICENSE">LICENSE</h2> <p>This module is free software. You may distribute it under the same terms as Perl itself.</p><div class="_attribution">
  <p class="_attribution-p">
    &copy; 1993&ndash;2023 Larry Wall and others<br>Licensed under the GNU General Public License version 1 or later, or the Artistic License.<br>The Perl logo is a trademark of the Perl Foundation.<br>
    <a href="https://perldoc.perl.org/5.38.0/autodie::Util" class="_attribution-link">https://perldoc.perl.org/5.38.0/autodie::Util</a>
  </p>
</div>
