<h1 class="post-title">General setup</h1>    <p>We will be making fakes, spies and stubs. By default these are created in the <em>default sandbox</em>. Be sure to <code>restore</code> this sandbox after each test.</p> <p>For example, if youâ€™re using mocha you can place this in a test file at the root level:</p> <pre data-language="javascript">afterEach(() =&gt; {
  // Restore the default sandbox here
  sinon.restore();
});
</pre> <p>On Mocha v8.0.0 or newer you can now add a root hook to your entire test suite, which will execute before/after every test:</p> <pre data-language="javascript">// tests/hooks.js

// Restores the default sandbox after every test
exports.mochaHooks = {
  afterEach() {
    sinon.restore();
  },
};
</pre> <p>This root file needs to be loaded using the <code>--require</code> option:</p> <pre data-language="javascript">mocha --require tests/hooks.js
</pre> <p>Or in Jasmine you should place it in each describe:</p> <pre data-language="javascript">describe("My test suite", () =&gt; {
  afterEach(() =&gt; {
    // Restore the default sandbox here
    sinon.restore();
  });
});
</pre> <p>Forgetting to restore your sandbox results in a memory leak.</p> <p>For more advanced setups using multiple sandboxes, please see <a href="sandbox.html">sandbox</a></p><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2010&ndash;2022 Christian Johansen<br>Licensed under the BSD License.<br>
    <a href="https://sinonjs.org/releases/v15/general-setup" class="_attribution-link">https://sinonjs.org/releases/v15/general-setup</a>
  </p>
</div>
