<h1>systemd-cryptsetup(8) — Linux manual page</h1>   <pre>
<span class="headline"><i>SYSTEMD-CRYPTSETUP</i>(8)      systemd-cryptsetup      <i>SYSTEMD-CRYPTSETUP</i>(8)</span>
</pre> <h2>
NAME </h2>
<pre>
       systemd-cryptsetup, systemd-cryptsetup@.service - Full disk
       decryption logic
</pre> <h2>
SYNOPSIS </h2>
<pre>

       <b>systemd-cryptsetup </b>[OPTIONS...] attach VOLUME SOURCE-DEVICE
                          [KEY-FILE] [CONFIG]

       <b>systemd-cryptsetup </b>[OPTIONS...] detach VOLUME

       systemd-cryptsetup@.service

       system-systemd\x2dcryptsetup.slice
</pre> <h2>
DESCRIPTION </h2>
<pre>
       systemd-cryptsetup is used to set up (with <b>attach</b>) and tear down
       (with <b>detach</b>) access to an encrypted block device. It is
       primarily used via systemd-cryptsetup@.service during early boot,
       but may also be called manually. The positional arguments <i>VOLUME</i>,
       <i>SOURCE-DEVICE</i>, <i>KEY-FILE</i>, and <i>CRYPTTAB-OPTIONS</i> have the same
       meaning as the fields in <a href="../man5/crypttab.5.html">crypttab(5)</a>.

       systemd-cryptsetup@.service is a service responsible for
       providing access to encrypted block devices. It is instantiated
       for each device that requires decryption.

       systemd-cryptsetup@.service instances are part of the
       system-systemd\x2dcryptsetup.slice slice, which is destroyed only
       very late in the shutdown procedure. This allows the encrypted
       devices to remain up until filesystems have been unmounted.

       systemd-cryptsetup@.service will ask for hard disk passwords via
       the <b>password agent logic</b>[1], in order to query the user for the
       password using the right mechanism at boot and during runtime.

       At early boot and when the system manager configuration is
       reloaded, /etc/crypttab is translated into
       systemd-cryptsetup@.service units by
       <a href="systemd-cryptsetup-generator.8.html">systemd-cryptsetup-generator(8)</a>.

       In order to unlock a volume a password or binary key is required.
       systemd-cryptsetup@.service tries to acquire a suitable password
       or binary key via the following mechanisms, tried in order:

        1. If a key file is explicitly configured (via the third column
           in /etc/crypttab), a key read from it is used. If a PKCS#11
           token, FIDO2 token or TPM2 device is configured (using the
           <i>pkcs11-uri=</i>, <i>fido2-device=</i>, <i>tpm2-device=</i> options) the key is
           decrypted before use.

        2. If no key file is configured explicitly this way, a key file
           is automatically loaded from
           /etc/cryptsetup-keys.d/<i>volume</i>.key and
           /run/cryptsetup-keys.d/<i>volume</i>.key, if present. Here too, if a
           PKCS#11/FIDO2/TPM2 token/device is configured, any key found
           this way is decrypted before use.

        3. If the <i>try-empty-password</i> option is specified then unlocking
           the volume with an empty password is attempted.

        4. The kernel keyring is then checked for a suitable cached
           password from previous attempts.

        5. Finally, the user is queried for a password, possibly
           multiple times, unless the <i>headless</i> option is set.

       If no suitable key may be acquired via any of the mechanisms
       describes above, volume activation fails.
</pre> <h2>
CREDENTIALS </h2>
<pre>
       <b>systemd-cryptsetup </b>supports the service credentials logic as
       implemented by <i>ImportCredential=</i>/<i>LoadCredential=</i>/<i>SetCredential=</i>
       (see <a href="../man5/systemd.exec.5.html">systemd.exec(5)</a> for details). The following credentials are
       used by "systemd-crypsetup@root.service" (generated by
       <b>systemd-gpt-auto-generator</b>) when passed in:

       <i>cryptsetup.passphrase</i>
           This credential specifies the passphrase of the LUKS volume.

           Added in version 256.

       <i>cryptsetup.tpm2-pin</i>
           This credential specifies the TPM pin.

           Added in version 256.

       <i>cryptsetup.fido2-pin</i>
           This credential specifies the FIDO2 token pin.

           Added in version 256.

       <i>cryptsetup.pkcs11-pin</i>
           This credential specifies the PKCS11 token pin.

           Added in version 256.

       <i>cryptsetup.luks2-pin</i>
           This credential specifies the PIN requested by generic LUKS2
           token modules.

           Added in version 256.
</pre> <h2>
SEE ALSO </h2>
<pre>
       <a href="../man1/systemd.1.html">systemd(1)</a>, <a href="systemd-cryptsetup-generator.8.html">systemd-cryptsetup-generator(8)</a>, <a href="../man5/crypttab.5.html">crypttab(5)</a>,
       <a href="../man1/systemd-cryptenroll.1.html">systemd-cryptenroll(1)</a>, <a href="cryptsetup.8.html">cryptsetup(8)</a>, <b>TPM2 PCR Measurements Made</b>
       <b>by systemd</b>[2]
</pre> <h2>
NOTES </h2>
<pre>
        1. password agent logic
           <a href="https://systemd.io/PASSWORD_AGENTS/">https://systemd.io/PASSWORD_AGENTS/</a>

        2. TPM2 PCR Measurements Made by systemd
           <a href="https://systemd.io/TPM2_PCR_MEASUREMENTS">https://systemd.io/TPM2_PCR_MEASUREMENTS</a>
</pre> <h2>
COLOPHON </h2>
<pre>
       This page is part of the <i>systemd</i> (systemd system and service
       manager) project.  Information about the project can be found at
       ⟨<a href="http://www.freedesktop.org/wiki/Software/systemd">http://www.freedesktop.org/wiki/Software/systemd</a>⟩.  If you have
       a bug report for this manual page, see
       ⟨<a href="http://www.freedesktop.org/wiki/Software/systemd/#bugreports">http://www.freedesktop.org/wiki/Software/systemd/#bugreports</a>⟩.
       This page was obtained from the project's upstream Git repository
       ⟨<a href="https://github.com/systemd/systemd.git">https://github.com/systemd/systemd.git</a>⟩ on 2024-06-14.  (At that
       time, the date of the most recent commit that was found in the
       repository was 2024-06-13.)  If you discover any rendering
       problems in this HTML version of the page, or you believe there
       is a better or more up-to-date source for the page, or you have
       corrections or improvements to the information in this COLOPHON
       (which is <i>not</i> part of the original manual page), send a mail to
       man-pages@man7.org

<span class="footline">systemd 257~devel                                  <i>SYSTEMD-CRYPTSETUP</i>(8)</span>
</pre>  <p>Pages that refer to this page: <a href="../man1/systemd-cryptenroll.1.html">systemd-cryptenroll(1)</a>, <a href="../man1/systemd-measure.1.html">systemd-measure(1)</a>, <a href="../man5/crypttab.5.html">crypttab(5)</a>, <a href="../man7/systemd.directives.7.html">systemd.directives(7)</a>, <a href="../man7/systemd.index.7.html">systemd.index(7)</a>, <a href="../man7/systemd-stub.7.html">systemd-stub(7)</a>, <a href="../man7/systemd.system-credentials.7.html">systemd.system-credentials(7)</a>, <a href="pam_systemd_loadkey.8.html">pam_systemd_loadkey(8)</a>, <a href="systemd-cryptsetup-generator.8.html">systemd-cryptsetup-generator(8)</a>, <a href="systemd-gpt-auto-generator.8.html">systemd-gpt-auto-generator(8)</a>, <a href="systemd-pcrlock.8.html">systemd-pcrlock(8)</a> </p> <hr>         <div class="_attribution">
  <p class="_attribution-p">
    ...<br>
    <a href="https://man7.org/linux/man-pages/man8/systemd-cryptsetup.8.html" class="_attribution-link">https://man7.org/linux/man-pages/man8/systemd-cryptsetup.8.html</a>
  </p>
</div>
