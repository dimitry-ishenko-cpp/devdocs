<h1>repart.d(5) — Linux manual page</h1>   <pre>
<span class="headline"><i>REPART.D</i>(5)                     repart.d                     <i>REPART.D</i>(5)</span>
</pre> <h2>
NAME </h2>
<pre>
       repart.d - Partition Definition Files for Automatic Boot-Time
       Repartitioning
</pre> <h2>
SYNOPSIS </h2>
<pre>
           /etc/repart.d/*.conf
           /run/repart.d/*.conf
           /usr/local/lib/repart.d/*.conf
           /usr/lib/repart.d/*.conf
</pre> <h2>
DESCRIPTION </h2>
<pre>
       repart.d/*.conf files describe basic properties of partitions of
       block devices of the local system. They may be used to declare
       types, names and sizes of partitions that shall exist. The
       <a href="../man8/systemd-repart.8.html">systemd-repart(8)</a> service reads these files and attempts to add
       new partitions currently missing and enlarge existing partitions
       according to these definitions. Operation is generally
       incremental, i.e. when applied, what exists already is left
       intact, and partitions are never shrunk, moved or deleted.

       These definition files are useful for implementing operating
       system images that are prepared and delivered with minimally
       sized images (for example lacking any state or swap partitions),
       and which on first boot automatically take possession of any
       remaining disk space following a few basic rules.

       Currently, support for partition definition files is only
       implemented for GPT partition tables.

       Partition files are generally matched against any partitions
       already existing on disk in a simple algorithm: the partition
       files are sorted by their filename (ignoring the directory
       prefix), and then compared in order against existing partitions
       matching the same partition type UUID. Specifically, the first
       existing partition with a specific partition type UUID is
       assigned the first definition file with the same partition type
       UUID, and the second existing partition with a specific type UUID
       the second partition file with the same type UUID, and so on. Any
       left-over partition files that have no matching existing
       partition are assumed to define new partition that shall be
       created. Such partitions are appended to the end of the partition
       table, in the order defined by their names utilizing the first
       partition slot greater than the highest slot number currently in
       use. Any existing partitions that have no matching partition file
       are left as they are.

       Note that these definitions may only be used to create and
       initialize new partitions or to grow existing ones. In the latter
       case it will not grow the contained files systems however;
       separate mechanisms, such as <a href="../man8/systemd-growfs.8.html">systemd-growfs(8)</a> may be used to
       grow the file systems inside of these partitions. Partitions may
       also be marked for automatic growing via the <i>GrowFileSystem=</i>
       setting, in which case the file system is grown on first mount by
       tools that respect this flag. See below for details.
</pre> <h2>
[PARTITION] SECTION OPTIONS </h2>
<pre>
       <i>Type=</i>
           The GPT partition type UUID to match. This may be a GPT
           partition type UUID such as
           <b>4f68bce3-e8cd-4db1-96e7-fbcaf984b709</b>, or an identifier.
           Architecture specific partition types can use one of these
           architecture identifiers: <b>alpha</b>, <b>arc</b>, <b>arm </b>(32-bit), <b>arm64</b>
           (64-bit, aka aarch64), <b>ia64</b>, <b>loongarch64</b>, <b>mips-le</b>, <b>mips64-le</b>,
           <b>parisc</b>, <b>ppc</b>, <b>ppc64</b>, <b>ppc64-le</b>, <b>riscv32</b>, <b>riscv64</b>, <b>s390</b>, <b>s390x</b>,
           <b>tilegx</b>, <b>x86 </b>(32-bit, aka i386) and <b>x86-64 </b>(64-bit, aka
           amd64).

           The supported identifiers are:

           <b>Table 1. GPT partition type identifiers</b>
           ┌───────────────────────────┬──────────────────────────┐
           │ <b>Identifier                </b>│ <b>Explanation              </b>│
           ├───────────────────────────┼──────────────────────────┤
           │ <b>esp                       </b>│ EFI System Partition     │
           ├───────────────────────────┼──────────────────────────┤
           │ <b>xbootldr                  </b>│ Extended Boot Loader     │
           │                           │ Partition                │
           ├───────────────────────────┼──────────────────────────┤
           │ <b>swap                      </b>│ Swap partition           │
           ├───────────────────────────┼──────────────────────────┤
           │ <b>home                      </b>│ Home (/home/) partition  │
           ├───────────────────────────┼──────────────────────────┤
           │ <b>srv                       </b>│ Server data (/srv/)      │
           │                           │ partition                │
           ├───────────────────────────┼──────────────────────────┤
           │ <b>var                       </b>│ Variable data (/var/)    │
           │                           │ partition                │
           ├───────────────────────────┼──────────────────────────┤
           │ <b>tmp                       </b>│ Temporary data           │
           │                           │ (/var/tmp/) partition    │
           ├───────────────────────────┼──────────────────────────┤
           │ <b>linux-generic             </b>│ Generic Linux file       │
           │                           │ system partition         │
           ├───────────────────────────┼──────────────────────────┤
           │ <b>root                      </b>│ Root file system         │
           │                           │ partition type           │
           │                           │ appropriate for the      │
           │                           │ local architecture (an   │
           │                           │ alias for an             │
           │                           │ architecture root file   │
           │                           │ system partition type    │
           │                           │ listed below, e.g.       │
           │                           │ <b>root-x86-64</b>)             │
           ├───────────────────────────┼──────────────────────────┤
           │ <b>root-verity               </b>│ Verity data for the root │
           │                           │ file system partition    │
           │                           │ for the local            │
           │                           │ architecture             │
           ├───────────────────────────┼──────────────────────────┤
           │ <b>root-verity-sig           </b>│ Verity signature data    │
           │                           │ for the root file system │
           │                           │ partition for the local  │
           │                           │ architecture             │
           ├───────────────────────────┼──────────────────────────┤
           │ <b>root-secondary            </b>│ Root file system         │
           │                           │ partition of the         │
           │                           │ secondary architecture   │
           │                           │ of the local             │
           │                           │ architecture (usually    │
           │                           │ the matching 32-bit      │
           │                           │ architecture for the     │
           │                           │ local 64-bit             │
           │                           │ architecture)            │
           ├───────────────────────────┼──────────────────────────┤
           │ <b>root-secondary-verity     </b>│ Verity data for the root │
           │                           │ file system partition of │
           │                           │ the secondary            │
           │                           │ architecture             │
           ├───────────────────────────┼──────────────────────────┤
           │ <b>root-secondary-verity-sig </b>│ Verity signature data    │
           │                           │ for the root file system │
           │                           │ partition of the         │
           │                           │ secondary architecture   │
           ├───────────────────────────┼──────────────────────────┤
           │ <b>root-{arch}               </b>│ Root file system         │
           │                           │ partition of the given   │
           │                           │ architecture (such as    │
           │                           │ <b>root-x86-64 </b>or           │
           │                           │ <b>root-riscv64</b>)            │
           ├───────────────────────────┼──────────────────────────┤
           │ <b>root-{arch}-verity        </b>│ Verity data for the root │
           │                           │ file system partition of │
           │                           │ the given architecture   │
           ├───────────────────────────┼──────────────────────────┤
           │ <b>root-{arch}-verity-sig    </b>│ Verity signature data    │
           │                           │ for the root file system │
           │                           │ partition of the given   │
           │                           │ architecture             │
           ├───────────────────────────┼──────────────────────────┤
           │ <b>usr                       </b>│ /usr/ file system        │
           │                           │ partition type           │
           │                           │ appropriate for the      │
           │                           │ local architecture (an   │
           │                           │ alias for an             │
           │                           │ architecture /usr/ file  │
           │                           │ system partition type    │
           │                           │ listed below, e.g.       │
           │                           │ <b>usr-x86-64</b>)              │
           ├───────────────────────────┼──────────────────────────┤
           │ <b>usr-verity                </b>│ Verity data for the      │
           │                           │ /usr/ file system        │
           │                           │ partition for the local  │
           │                           │ architecture             │
           ├───────────────────────────┼──────────────────────────┤
           │ <b>usr-verity-sig            </b>│ Verity signature data    │
           │                           │ for the /usr/ file       │
           │                           │ system partition for the │
           │                           │ local architecture       │
           ├───────────────────────────┼──────────────────────────┤
           │ <b>usr-secondary             </b>│ /usr/ file system        │
           │                           │ partition of the         │
           │                           │ secondary architecture   │
           │                           │ of the local             │
           │                           │ architecture (usually    │
           │                           │ the matching 32-bit      │
           │                           │ architecture for the     │
           │                           │ local 64-bit             │
           │                           │ architecture)            │
           ├───────────────────────────┼──────────────────────────┤
           │ <b>usr-secondary-verity      </b>│ Verity data for the      │
           │                           │ /usr/ file system        │
           │                           │ partition of the         │
           │                           │ secondary architecture   │
           ├───────────────────────────┼──────────────────────────┤
           │ <b>usr-secondary-verity-sig  </b>│ Verity signature data    │
           │                           │ for the /usr/ file       │
           │                           │ system partition of the  │
           │                           │ secondary architecture   │
           ├───────────────────────────┼──────────────────────────┤
           │ <b>usr-{arch}                </b>│ /usr/ file system        │
           │                           │ partition of the given   │
           │                           │ architecture             │
           ├───────────────────────────┼──────────────────────────┤
           │ <b>usr-{arch}-verity         </b>│ Verity data for the      │
           │                           │ /usr/ file system        │
           │                           │ partition of the given   │
           │                           │ architecture             │
           ├───────────────────────────┼──────────────────────────┤
           │ <b>usr-{arch}-verity-sig     </b>│ Verity signature data    │
           │                           │ for the /usr/ file       │
           │                           │ system partition of the  │
           │                           │ given architecture       │
           └───────────────────────────┴──────────────────────────┘

           This setting defaults to <b>linux-generic</b>.

           Most of the partition type UUIDs listed above are defined in
           the <b>Discoverable Partitions Specification</b>[1].

           Added in version 245.

       <i>Label=</i>
           The textual label to assign to the partition if none is
           assigned yet. Note that this setting is not used for
           matching. It is also not used when a label is already set for
           an existing partition. It is thus only used when a partition
           is newly created or when an existing one had a no label set
           (that is: an empty label). If not specified a label derived
           from the partition type is automatically used. Simple
           specifier expansion is supported, see below.

           Added in version 245.

       <i>UUID=</i>
           The UUID to assign to the partition if none is assigned yet.
           Note that this setting is not used for matching. It is also
           not used when a UUID is already set for an existing
           partition. It is thus only used when a partition is newly
           created or when an existing one had a all-zero UUID set. If
           set to "null", the UUID is set to all zeroes. If not
           specified a UUID derived from the partition type is
           automatically used.

           Added in version 246.

       <i>Priority=</i>
           A numeric priority to assign to this partition, in the range
           -2147483648...2147483647, with smaller values indicating
           higher priority, and higher values indicating smaller
           priority. This priority is used in case the configured size
           constraints on the defined partitions do not permit fitting
           all partitions onto the available disk space. If the
           partitions do not fit, the highest numeric partition priority
           of all defined partitions is determined, and all defined
           partitions with this priority are removed from the list of
           new partitions to create (which may be multiple, if the same
           priority is used for multiple partitions). The fitting
           algorithm is then tried again. If the partitions still do not
           fit, the now highest numeric partition priority is
           determined, and the matching partitions removed too, and so
           on. Partitions of a priority of 0 or lower are never removed.
           If all partitions with a priority above 0 are removed and the
           partitions still do not fit on the device the operation
           fails. Note that this priority has no effect on ordering
           partitions, for that use the alphabetical order of the
           filenames of the partition definition files. Defaults to 0.

           Added in version 245.

       <i>Weight=</i>
           A numeric weight to assign to this partition in the range
           0...1000000. Available disk space is assigned the defined
           partitions according to their relative weights (subject to
           the size constraints configured with <i>SizeMinBytes=</i>,
           <i>SizeMaxBytes=</i>), so that a partition with weight 2000 gets
           double the space as one with weight 1000, and a partition
           with weight 333 a third of that. Defaults to 1000.

           The <i>Weight=</i> setting is used to distribute available disk
           space in an "elastic" fashion, based on the disk size and
           existing partitions. If a partition shall have a fixed size
           use both <i>SizeMinBytes=</i> and <i>SizeMaxBytes=</i> with the same value
           in order to fixate the size to one value, in which case the
           weight has no effect.

           Added in version 245.

       <i>PaddingWeight=</i>
           Similar to <i>Weight=</i>, but sets a weight for the free space
           after the partition (the "padding"). When distributing
           available space the weights of all partitions and all defined
           padding is summed, and then each partition and padding gets
           the fraction defined by its weight. Defaults to 0, i.e. by
           default no padding is applied.

           Padding is useful if empty space shall be left for later
           additions or a safety margin at the end of the device or
           between partitions.

           Added in version 245.

       <i>SizeMinBytes=</i>, <i>SizeMaxBytes=</i>
           Specifies minimum and maximum size constraints in bytes.
           Takes the usual K, M, G, T, ... suffixes (to the base of
           1024). If <i>SizeMinBytes=</i> is specified the partition is created
           at or grown to at least the specified size. If <i>SizeMaxBytes=</i>
           is specified the partition is created at or grown to at most
           the specified size. The precise size is determined through
           the weight value configured with <i>Weight=</i>, see above. When
           <i>SizeMinBytes=</i> is set equal to <i>SizeMaxBytes=</i> the configured
           weight has no effect as the partition is explicitly sized to
           the specified fixed value. Note that partitions are never
           created smaller than 4096 bytes, and since partitions are
           never shrunk the previous size of the partition (in case the
           partition already exists) is also enforced as lower bound for
           the new size. The values should be specified as multiples of
           4096 bytes, and are rounded upwards (in case of
           <i>SizeMinBytes=</i>) or downwards (in case of <i>SizeMaxBytes=</i>)
           otherwise. If the backing device does not provide enough
           space to fulfill the constraints placing the partition will
           fail. For partitions that shall be created, depending on the
           setting of <i>Priority=</i> (see above) the partition might be
           dropped and the placing algorithm restarted. By default a
           minimum size constraint of 10M and no maximum size constraint
           is set.

           Added in version 245.

       <i>PaddingMinBytes=</i>, <i>PaddingMaxBytes=</i>
           Specifies minimum and maximum size constraints in bytes for
           the free space after the partition (the "padding"). Semantics
           are similar to <i>SizeMinBytes=</i> and <i>SizeMaxBytes=</i>, except that
           unlike partition sizes free space can be shrunk and can be as
           small as zero. By default no size constraints on padding are
           set, so that only <i>PaddingWeight=</i> determines the size of the
           padding applied.

           Added in version 245.

       <i>CopyBlocks=</i>
           Takes a path to a regular file, block device node or
           directory, or the special value "auto". If specified and the
           partition is newly created, the data from the specified path
           is written to the newly created partition, on the block
           level. If a directory is specified, the backing block device
           of the file system the directory is on is determined, and the
           data read directly from that. This option is useful to
           efficiently replicate existing file systems onto new
           partitions on the block level — for example to build a simple
           OS installer or an OS image builder.

           If the special value "auto" is specified, the source to copy
           from is automatically picked up from the running system (or
           the image specified with <b>--image= </b>— if used). A partition
           that matches both the configured partition type (as declared
           with <i>Type=</i> described above), and the currently mounted
           directory appropriate for that partition type is determined.
           For example, if the partition type is set to "root" the
           partition backing the root directory (/) is used as source to
           copy from — if its partition type is set to "root" as well.
           If the declared type is "usr" the partition backing /usr/ is
           used as source to copy blocks from — if its partition type is
           set to "usr" too. The logic is capable of automatically
           tracking down the backing partitions for encrypted and
           Verity-enabled volumes.  "CopyBlocks=auto" is useful for
           implementing "self-replicating" systems, i.e. systems that
           are their own installer.

           The file specified here must have a size that is a multiple
           of the basic block size 512 and not be empty. If this option
           is used, the size allocation algorithm is slightly altered:
           the partition is created at least as big as required to fit
           the data in, i.e. the data size is an additional minimum size
           value taken into consideration for the allocation algorithm,
           similar to and in addition to the <i>SizeMin=</i> value configured
           above.

           This option has no effect if the partition it is declared for
           already exists, i.e. existing data is never overwritten. Note
           that the data is copied in before the partition table is
           updated, i.e. before the partition actually is persistently
           created. This provides robustness: it is guaranteed that the
           partition either doesn't exist or exists fully populated; it
           is not possible that the partition exists but is not or only
           partially populated.

           This option cannot be combined with <i>Format=</i> or <i>CopyFiles=</i>.

           Added in version 246.

       <i>Format=</i>
           Takes a file system name, such as "ext4", "btrfs", "xfs",
           "vfat", "erofs", "squashfs" or the special value "swap". If
           specified and the partition is newly created it is formatted
           with the specified file system (or as swap device). The file
           system UUID and label are automatically derived from the
           partition UUID and label. If this option is used, the size
           allocation algorithm is slightly altered: the partition is
           created at least as big as required for the minimal file
           system of the specified type (or 4KiB if the minimal size is
           not known).

           This option has no effect if the partition already exists.

           Similarly to the behaviour of <i>CopyBlocks=</i>, the file system is
           formatted before the partition is created, ensuring that the
           partition only ever exists with a fully initialized file
           system.

           This option cannot be combined with <i>CopyBlocks=</i>.

           Added in version 247.

       <i>CopyFiles=</i>
           Takes a pair of colon separated absolute file system paths.
           The first path refers to a source file or directory on the
           host, the second path refers to a target in the file system
           of the newly created partition and formatted file system.
           This setting may be used to copy files or directories from
           the host into the file system that is created due to the
           <i>Format=</i> option. If <i>CopyFiles=</i> is used without <i>Format=</i>
           specified explicitly, "Format=" with a suitable default is
           implied (currently "vfat" for "ESP" and "XBOOTLDR"
           partitions, and "ext4" otherwise, but this may change in the
           future). This option may be used multiple times to copy
           multiple files or directories from host into the newly
           formatted file system. The colon and second path may be
           omitted in which case the source path is also used as the
           target path (relative to the root of the newly created file
           system). If the source path refers to a directory it is
           copied recursively.

           This option has no effect if the partition already exists: it
           cannot be used to copy additional files into an existing
           partition, it may only be used to populate a file system
           created anew.

           The copy operation is executed before the file system is
           registered in the partition table, thus ensuring that a file
           system populated this way only ever exists fully initialized.

           Note that <i>CopyFiles=</i> will skip copying files that aren't
           supported by the target filesystem (e.g symlinks, fifos,
           sockets and devices on vfat). When an unsupported file type
           is encountered, <b>systemd-repart </b>will skip copying this file
           and write a log message about it.

           Note that <b>systemd-repart </b>does not change the UIDs/GIDs of any
           copied files and directories. When running <b>systemd-repart </b>as
           an unprivileged user to build an image of files and
           directories owned by the same user, you can run
           <b>systemd-repart </b>in a user namespace with the current user
           mapped to the root user to make sure the files and
           directories in the image are owned by the root user.

           Note that when populating XFS filesystems with <b>systemd-repart</b>
           and loop devices are not available, populating XFS
           filesystems with files containing spaces, tabs or newlines
           might fail on old versions of <b>mkfs.xfs</b>(8) due to limitations
           of its protofile format.

           Note that when populating XFS filesystems with <b>systemd-repart</b>
           and loop devices are not available, extended attributes will
           not be copied into generated XFS filesystems due to
           limitations <b>mkfs.xfs</b>(8)'s protofile format.

           This option cannot be combined with <i>CopyBlocks=</i>.

           When <a href="../man8/systemd-repart.8.html">systemd-repart(8)</a> is invoked with the <b>--copy-source=</b>
           command line switch the file paths are taken relative to the
           specified directory. If <b>--copy-source= </b>is not used, but the
           <b>--image= </b>or <b>--root= </b>switches are used, the source paths are
           taken relative to the specified root directory or disk image
           root.

           Added in version 247.

       <i>ExcludeFiles=</i>, <i>ExcludeFilesTarget=</i>
           Takes an absolute file system path referring to a source file
           or directory on the host. This setting may be used to exclude
           files or directories from the host from being copied into the
           file system when <i>CopyFiles=</i> is used. This option may be used
           multiple times to exclude multiple files or directories from
           host from being copied into the newly formatted file system.

           If the path is a directory and ends with "/", only the
           directory's contents are excluded but not the directory
           itself. If the path is a directory and does not end with "/",
           both the directory and its contents are excluded.

           <i>ExcludeFilesTarget=</i> is like <i>ExcludeFiles=</i> except that instead
           of excluding the path on the host from being copied into the
           partition, we exclude any files and directories from being
           copied into the given path in the partition.

           When <a href="../man8/systemd-repart.8.html">systemd-repart(8)</a> is invoked with the <b>--image= </b>or
           <b>--root= </b>command line switches the paths specified are taken
           relative to the specified root directory or disk image root.

           Added in version 254.

       <i>MakeDirectories=</i>
           Takes one or more absolute paths, separated by whitespace,
           each declaring a directory to create within the new file
           system. Behaviour is similar to <i>CopyFiles=</i>, but instead of
           copying in a set of files this just creates the specified
           directories with the default mode of 0755 owned by the root
           user and group, plus all their parent directories (with the
           same ownership and access mode). To configure directories
           with different ownership or access mode, use <i>CopyFiles=</i> and
           specify a source tree to copy containing appropriately
           owned/configured directories. This option may be used more
           than once to create multiple directories. When <i>CopyFiles=</i> and
           <i>MakeDirectories=</i> are used together the former is applied
           first. If a directory listed already exists no operation is
           executed (in particular, the ownership/access mode of the
           directories is left as is).

           The primary use case for this option is to create a minimal
           set of directories that may be mounted over by other
           partitions contained in the same disk image. For example, a
           disk image where the root file system is formatted at first
           boot might want to automatically pre-create /usr/ in it this
           way, so that the "usr" partition may over-mount it.

           Consider using <a href="../man8/systemd-tmpfiles.8.html">systemd-tmpfiles(8)</a> with its <b>--image= </b>option
           to pre-create other, more complex directory hierarchies (as
           well as other inodes) with fine-grained control of ownership,
           access modes and other file attributes.

           Added in version 249.

       <i>Subvolumes=</i>
           Takes one or more absolute paths, separated by whitespace,
           each declaring a directory that should be a subvolume within
           the new file system. This option may be used more than once
           to specify multiple directories. Note that this setting does
           not create the directories themselves, that can be configured
           with <i>MakeDirectories=</i> and <i>CopyFiles=</i>.

           Note that this option only takes effect if the target
           filesystem supports subvolumes, such as "btrfs".

           Note that due to limitations of "mkfs.btrfs", this option is
           only supported when running with <b>--offline=no</b>.

           Added in version 255.

       <i>DefaultSubvolume=</i>
           Takes an absolute path specifying the default subvolume
           within the new filesystem. Note that this setting does not
           create the subvolume itself, that can be configured with
           <i>Subvolumes=</i>.

           Note that this option only takes effect if the target
           filesystem supports subvolumes, such as "btrfs".

           Note that due to limitations of "mkfs.btrfs", this option is
           only supported when running with <b>--offline=no</b>.

           Added in version 256.

       <i>Encrypt=</i>
           Takes one of "off", "key-file", "tpm2" and "key-file+tpm2"
           (alternatively, also accepts a boolean value, which is mapped
           to "off" when false, and "key-file" when true). Defaults to
           "off". If not "off" the partition will be formatted with a
           LUKS2 superblock, before the blocks configured with
           <i>CopyBlocks=</i> are copied in or the file system configured with
           <i>Format=</i> is created.

           The LUKS2 UUID is automatically derived from the partition
           UUID in a stable fashion. If "key-file" or "key-file+tpm2" is
           used, a key is added to the LUKS2 superblock, configurable
           with the <b>--key-file= </b>option to <b>systemd-repart</b>. If "tpm2" or
           "key-file+tpm2" is used, a key is added to the LUKS2
           superblock that is enrolled to the local TPM2 chip, as
           configured with the <b>--tpm2-device= </b>and <b>--tpm2-pcrs= </b>options
           to <b>systemd-repart</b>.

           When used this slightly alters the size allocation logic as
           the implicit, minimal size limits of <i>Format=</i> and <i>CopyBlocks=</i>
           are increased by the space necessary for the LUKS2 superblock
           (see above).

           This option has no effect if the partition already exists.

           Added in version 247.

       <i>Verity=</i>
           Takes one of "off", "data", "hash" or "signature". Defaults
           to "off". If set to "off" or "data", the partition is
           populated with content as specified by <i>CopyBlocks=</i> or
           <i>CopyFiles=</i>. If set to "hash", the partition will be populated
           with verity hashes from the matching verity data partition.
           If set to "signature", the partition will be populated with a
           JSON object containing a signature of the verity root hash of
           the matching verity hash partition.

           A matching verity partition is a partition with the same
           verity match key (as configured with <i>VerityMatchKey=</i>).

           If not explicitly configured, the data partition's UUID will
           be set to the first 128 bits of the verity root hash.
           Similarly, if not configured, the hash partition's UUID will
           be set to the final 128 bits of the verity root hash. The
           verity root hash itself will be included in the output of
           <b>systemd-repart</b>.

           This option has no effect if the partition already exists.

           Usage of this option in combination with <i>Encrypt=</i> is not
           supported.

           For each unique <i>VerityMatchKey=</i> value, a single verity data
           partition ("Verity=data") and a single verity hash partition
           ("Verity=hash") must be defined.

           Added in version 252.

       <i>VerityMatchKey=</i>
           Takes a short, user-chosen identifier string. This setting is
           used to find sibling verity partitions for the current verity
           partition. See the description for <i>Verity=</i>.

           Added in version 252.

       <i>VerityDataBlockSizeBytes=</i>
           Configures the data block size of the generated verity hash
           partition. Must be between 512 and 4096 bytes and must be a
           power of 2. Defaults to the sector size if configured
           explicitly, or the underlying block device sector size, or 4K
           if systemd-repart is not operating on a block device.

           Added in version 255.

       <i>VerityHashBlockSizeBytes=</i>
           Configures the hash block size of the generated verity hash
           partition. Must be between 512 and 4096 bytes and must be a
           power of 2. Defaults to the sector size if configured
           explicitly, or the underlying block device sector size, or 4K
           if systemd-repart is not operating on a block device.

           Added in version 255.

       <i>FactoryReset=</i>
           Takes a boolean argument. If specified the partition is
           marked for removal during a factory reset operation. This
           functionality is useful to implement schemes where images can
           be reset into their original state by removing partitions and
           creating them anew. Defaults to off.

           Added in version 245.

       <i>Flags=</i>
           Configures the 64-bit GPT partition flags field to set for
           the partition when creating it. This option has no effect if
           the partition already exists. If not specified the flags
           values is set to all zeroes, except for the three bits that
           can also be configured via <i>NoAuto=</i>, <i>ReadOnly=</i> and
           <i>GrowFileSystem=</i>; see below for details on the defaults for
           these three flags. Specify the flags value in hexadecimal (by
           prefixing it with "0x"), binary (prefix "0b") or decimal (no
           prefix).

           Added in version 249.

       <i>NoAuto=</i>, <i>ReadOnly=</i>, <i>GrowFileSystem=</i>
           Configures the No-Auto, Read-Only and Grow-File-System
           partition flags (bit 63, 60 and 59) of the partition table
           entry, as defined by the <b>Discoverable Partitions</b>
           <b>Specification</b>[1]. Only available for partition types
           supported by the specification. This option is a friendly way
           to set bits 63, 60 and 59 of the partition flags value
           without setting any of the other bits, and may be set via
           <i>Flags=</i> too, see above.

           If <i>Flags=</i> is used in conjunction with one or more of
           <i>NoAuto=</i>/<i>ReadOnly=</i>/<i>GrowFileSystem=</i> the latter control the
           value of the relevant flags, i.e. the high-level settings
           <i>NoAuto=</i>/<i>ReadOnly=</i>/<i>GrowFileSystem=</i> override the relevant bits
           of the low-level setting <i>Flags=</i>.

           Note that the three flags affect only automatic partition
           mounting, as implemented by <a href="../man8/systemd-gpt-auto-generator.8.html">systemd-gpt-auto-generator(8)</a> or
           the <b>--image= </b>option of various commands (such as
           <a href="../man1/systemd-nspawn.1.html">systemd-nspawn(1)</a>). It has no effect on explicit mounts, such
           as those done via <a href="../man8/mount.8.html">mount(8)</a> or <a href="fstab.5.html">fstab(5)</a>.

           If both bit 50 and 59 are set for a partition (i.e. the
           partition is marked both read-only and marked for file system
           growing) the latter is typically without effect: the
           read-only flag takes precedence in most tools reading these
           flags, and since growing the file system involves writing to
           the partition it is consequently ignored.

           <i>NoAuto=</i> defaults to off.  <i>ReadOnly=</i> defaults to on for Verity
           partition types, and off for all others.  <i>GrowFileSystem=</i>
           defaults to on for all partition types that support it,
           except if the partition is marked read-only (and thus
           effectively, defaults to off for Verity partitions).

           Added in version 249.

       <i>SplitName=</i>
           Configures the suffix to append to split artifacts when the
           <b>--split </b>option of <a href="../man8/systemd-repart.8.html">systemd-repart(8)</a> is used. Simple specifier
           expansion is supported, see below. Defaults to "%t". To
           disable split artifact generation for a partition, set
           <i>SplitName=</i> to "-".

           Added in version 252.

       <i>Minimize=</i>
           Takes one of "off", "best", and "guess" (alternatively, also
           accepts a boolean value, which is mapped to "off" when false,
           and "best" when true). Defaults to "off". If set to "best",
           the partition will have the minimal size required to store
           the sources configured with <i>CopyFiles=</i>.  "best" is currently
           only supported for read-only filesystems. If set to "guess",
           the partition is created at least as big as required to store
           the sources configured with <i>CopyFiles=</i>. Note that unless the
           filesystem is a read-only filesystem, <b>systemd-repart </b>will
           have to populate the filesystem twice to guess the minimal
           required size, so enabling this option might slow down repart
           when populating large partitions.

           Added in version 253.

       <i>MountPoint=</i>
           Specifies where and how the partition should be mounted.
           Takes at least one and at most two fields separated with a
           colon (":"). The first field specifies where the partition
           should be mounted. The second field specifies extra mount
           options to append to the default mount options. These fields
           correspond to the second and fourth column of the <a href="fstab.5.html">fstab(5)</a>
           format. This setting may be specified multiple times to mount
           the partition multiple times. This can be used to add mounts
           for different btrfs subvolumes located on the same btrfs
           partition.

           Note that this setting is only taken into account when
           <b>--generate-fstab= </b>is specified on the <b>systemd-repart </b>command
           line.

           Added in version 256.

       <i>EncryptedVolume=</i>
           Specify how the encrypted partition should be set up. Takes
           at least one and at most three fields separated with a colon
           (":"). The first field specifies the encrypted volume name
           under /dev/mapper/. If not specified, "luks-UUID" will be
           used where "UUID" is the LUKS UUID. The second field
           specifies the keyfile to use following the same format as
           specified in crypttab. The third field specifies a
           comma-delimited list of crypttab options. These fields
           correspond to the first, third and fourth column of the
           <a href="crypttab.5.html">crypttab(5)</a> format.

           Note that this setting is only taken into account when
           <b>--generate-crypttab= </b>is specified on the <b>systemd-repart</b>
           command line.

           Added in version 256.
</pre> <h2>
SPECIFIERS </h2>
<pre>
       Specifiers may be used in the <i>Label=</i>, <i>CopyBlocks=</i>, <i>CopyFiles=</i>,
       <i>MakeDirectories=</i>, <i>SplitName=</i> settings. The following expansions
       are understood:

       <b>Table 2. Specifiers available</b>
       ┌───────────┬──────────────────┬────────────────────────┐
       │ <b>Specifier </b>│ <b>Meaning          </b>│ <b>Details                </b>│
       ├───────────┼──────────────────┼────────────────────────┤
       │ "%a"      │ Architecture     │ A short string         │
       │           │                  │ identifying the        │
       │           │                  │ architecture of        │
       │           │                  │ the local system.      │
       │           │                  │ A string such as       │
       │           │                  │ <b>x86</b>, <b>x86-64 </b>or         │
       │           │                  │ <b>arm64</b>. See the         │
       │           │                  │ architectures          │
       │           │                  │ defined for            │
       │           │                  │ <i>ConditionArchitecture=</i> │
       │           │                  │ in <a href="systemd.unit.5.html">systemd.unit(5)</a>     │
       │           │                  │ for a full list.       │
       ├───────────┼──────────────────┼────────────────────────┤
       │ "%A"      │ Operating system │ The operating system   │
       │           │ image version    │ image version          │
       │           │                  │ identifier of the      │
       │           │                  │ running system, as     │
       │           │                  │ read from the          │
       │           │                  │ <i>IMAGE_VERSION=</i> field   │
       │           │                  │ of /etc/os-release. If │
       │           │                  │ not set, resolves to   │
       │           │                  │ an empty string. See   │
       │           │                  │ <a href="os-release.5.html">os-release(5)</a> for more │
       │           │                  │ information.           │
       ├───────────┼──────────────────┼────────────────────────┤
       │ "%b"      │ Boot ID          │ The boot ID of the     │
       │           │                  │ running system,        │
       │           │                  │ formatted as string.   │
       │           │                  │ See <a href="../man4/random.4.html">random(4)</a> for more │
       │           │                  │ information.           │
       ├───────────┼──────────────────┼────────────────────────┤
       │ "%B"      │ Operating system │ The operating system   │
       │           │ build ID         │ build identifier of    │
       │           │                  │ the running system, as │
       │           │                  │ read from the          │
       │           │                  │ <i>BUILD_ID=</i> field of     │
       │           │                  │ /etc/os-release. If    │
       │           │                  │ not set, resolves to   │
       │           │                  │ an empty string. See   │
       │           │                  │ <a href="os-release.5.html">os-release(5)</a> for more │
       │           │                  │ information.           │
       ├───────────┼──────────────────┼────────────────────────┤
       │ "%H"      │ Host name        │ The hostname of the    │
       │           │                  │ running system.        │
       ├───────────┼──────────────────┼────────────────────────┤
       │ "%l"      │ Short host name  │ The hostname of the    │
       │           │                  │ running system,        │
       │           │                  │ truncated at the first │
       │           │                  │ dot to remove any      │
       │           │                  │ domain component.      │
       ├───────────┼──────────────────┼────────────────────────┤
       │ "%m"      │ Machine ID       │ The machine ID of the  │
       │           │                  │ running system,        │
       │           │                  │ formatted as string.   │
       │           │                  │ See <a href="machine-id.5.html">machine-id(5)</a> for  │
       │           │                  │ more information.      │
       ├───────────┼──────────────────┼────────────────────────┤
       │ "%M"      │ Operating system │ The operating system   │
       │           │ image identifier │ image identifier of    │
       │           │                  │ the running system, as │
       │           │                  │ read from the          │
       │           │                  │ <i>IMAGE_ID=</i> field of     │
       │           │                  │ /etc/os-release. If    │
       │           │                  │ not set, resolves to   │
       │           │                  │ an empty string. See   │
       │           │                  │ <a href="os-release.5.html">os-release(5)</a> for more │
       │           │                  │ information.           │
       ├───────────┼──────────────────┼────────────────────────┤
       │ "%o"      │ Operating system │ The operating system   │
       │           │ ID               │ identifier of the      │
       │           │                  │ running system, as     │
       │           │                  │ read from the <i>ID=</i>      │
       │           │                  │ field of               │
       │           │                  │ /etc/os-release. See   │
       │           │                  │ <a href="os-release.5.html">os-release(5)</a> for more │
       │           │                  │ information.           │
       ├───────────┼──────────────────┼────────────────────────┤
       │ "%v"      │ Kernel release   │ Identical to <b>uname -r  </b>│
       │           │                  │ output.                │
       ├───────────┼──────────────────┼────────────────────────┤
       │ "%w"      │ Operating system │ The operating system   │
       │           │ version ID       │ version identifier of  │
       │           │                  │ the running system, as │
       │           │                  │ read from the          │
       │           │                  │ <i>VERSION_ID=</i> field of   │
       │           │                  │ /etc/os-release. If    │
       │           │                  │ not set, resolves to   │
       │           │                  │ an empty string. See   │
       │           │                  │ <a href="os-release.5.html">os-release(5)</a> for more │
       │           │                  │ information.           │
       ├───────────┼──────────────────┼────────────────────────┤
       │ "%W"      │ Operating system │ The operating system   │
       │           │ variant ID       │ variant identifier of  │
       │           │                  │ the running system, as │
       │           │                  │ read from the          │
       │           │                  │ <i>VARIANT_ID=</i> field of   │
       │           │                  │ /etc/os-release. If    │
       │           │                  │ not set, resolves to   │
       │           │                  │ an empty string. See   │
       │           │                  │ <a href="os-release.5.html">os-release(5)</a> for more │
       │           │                  │ information.           │
       ├───────────┼──────────────────┼────────────────────────┤
       │ "%T"      │ Directory for    │ This is either /tmp or │
       │           │ temporary files  │ the path "$TMPDIR",    │
       │           │                  │ "$TEMP" or "$TMP" are  │
       │           │                  │ set to. (Note that the │
       │           │                  │ directory may be       │
       │           │                  │ specified without a    │
       │           │                  │ trailing slash.)       │
       ├───────────┼──────────────────┼────────────────────────┤
       │ "%V"      │ Directory for    │ This is either         │
       │           │ larger and       │ /var/tmp or the path   │
       │           │ persistent       │ "$TMPDIR", "$TEMP" or  │
       │           │ temporary files  │ "$TMP" are set to.     │
       │           │                  │ (Note that the         │
       │           │                  │ directory may be       │
       │           │                  │ specified without a    │
       │           │                  │ trailing slash.)       │
       ├───────────┼──────────────────┼────────────────────────┤
       │ "%%"      │ Single percent   │ Use "%%" in place of   │
       │           │ sign             │ "%" to specify a       │
       │           │                  │ single percent sign.   │
       └───────────┴──────────────────┴────────────────────────┘

       Additionally, for the <i>SplitName=</i> setting, the following
       specifiers are also understood:

       <b>Table 3. Specifiers available</b>
       ┌───────────┬──────────────────┬────────────────────┐
       │ <b>Specifier </b>│ <b>Meaning          </b>│ <b>Details            </b>│
       ├───────────┼──────────────────┼────────────────────┤
       │ "%T"      │ Partition Type   │ The partition type │
       │           │ UUID             │ UUID, as           │
       │           │                  │ configured with    │
       │           │                  │ <i>Type=</i>              │
       ├───────────┼──────────────────┼────────────────────┤
       │ "%t"      │ Partition Type   │ The partition type │
       │           │ Identifier       │ identifier         │
       │           │                  │ corresponding to   │
       │           │                  │ the partition type │
       │           │                  │ UUID               │
       ├───────────┼──────────────────┼────────────────────┤
       │ "%U"      │ Partition UUID   │ The partition      │
       │           │                  │ UUID, as           │
       │           │                  │ configured with    │
       │           │                  │ <i>UUID=</i>              │
       ├───────────┼──────────────────┼────────────────────┤
       │ "%n"      │ Partition Number │ The partition      │
       │           │                  │ number assigned to │
       │           │                  │ the partition      │
       └───────────┴──────────────────┴────────────────────┘
</pre> <h2>
ENVIRONMENT </h2>
<pre>
       Extra filesystem formatting options can be provided using
       filesystem-specific environment variables:
       <i>$SYSTEMD_REPART_MKFS_OPTIONS_BTRFS</i>,
       <i>$SYSTEMD_REPART_MKFS_OPTIONS_XFS</i>,
       <i>$SYSTEMD_REPART_MKFS_OPTIONS_VFAT</i>,
       <i>$SYSTEMD_REPART_MKFS_OPTIONS_EROFS</i>, and
       <i>$SYSTEMD_REPART_MKFS_OPTIONS_SQUASHFS</i>. Each variable accepts
       valid <b>mkfs.</b><i>filesystem</i> command-line arguments. The content of
       those variables is passed as-is to the command, without any
       verification.
</pre> <h2>
EXAMPLES </h2>
<pre>
       <b>Example 1. Grow the root partition to the full disk size at first</b>
       <b>boot</b>

       With the following file the root partition is automatically grown
       to the full disk if possible during boot.

           # /usr/lib/repart.d/50-root.conf
           [Partition]
           Type=root

       <b>Example 2. Create a swap and home partition automatically on</b>
       <b>boot, if missing</b>

       The home partition gets all available disk space while the swap
       partition gets 1G at most and 64M at least. We set a priority &gt; 0
       on the swap partition to ensure the swap partition is not used if
       not enough space is available. For every three bytes assigned to
       the home partition the swap partition gets assigned one.

           # /usr/lib/repart.d/60-home.conf
           [Partition]
           Type=home

           # /usr/lib/repart.d/70-swap.conf
           [Partition]
           Type=swap
           SizeMinBytes=64M
           SizeMaxBytes=1G
           Priority=1
           Weight=333

       <b>Example 3. Create B partitions in an A/B Verity setup, if missing</b>

       Let's say the vendor intends to update OS images in an A/B setup,
       i.e. with two root partitions (and two matching Verity
       partitions) that shall be used alternatingly during upgrades. To
       minimize image sizes the original image is shipped only with one
       root and one Verity partition (the "A" set), and the second root
       and Verity partitions (the "B" set) shall be created on first
       boot on the free space on the medium.

           # /usr/lib/repart.d/50-root.conf
           [Partition]
           Type=root
           SizeMinBytes=512M
           SizeMaxBytes=512M

           # /usr/lib/repart.d/60-root-verity.conf
           [Partition]
           Type=root-verity
           SizeMinBytes=64M
           SizeMaxBytes=64M

       The definitions above cover the "A" set of root partition (of a
       fixed 512M size) and Verity partition for the root partition (of
       a fixed 64M size). Let's use symlinks to create the "B" set of
       partitions, since after all they shall have the same properties
       and sizes as the "A" set.

           # ln -s 50-root.conf /usr/lib/repart.d/70-root-b.conf
           # ln -s 60-root-verity.conf /usr/lib/repart.d/80-root-verity-b.conf

       <b>Example 4. Create a data partition and corresponding verity</b>
       <b>partitions from a OS tree</b>

       Assuming we have an OS tree at /var/tmp/os-tree that we want to
       package in a root partition together with matching verity
       partitions, we can do so as follows:

           # 50-root.conf
           [Partition]
           Type=root
           CopyFiles=/var/tmp/os-tree
           Verity=data
           VerityMatchKey=root
           Minimize=guess

           # 60-root-verity.conf
           [Partition]
           Type=root-verity
           Verity=hash
           VerityMatchKey=root
           # Explicitly set the hash and data block size to 4K
           VerityDataBlockSizeBytes=4096
           VerityHashBlockSizeBytes=4096
           Minimize=best

           # 70-root-verity-sig.conf
           [Partition]
           Type=root-verity-sig
           Verity=signature
           VerityMatchKey=root
</pre> <h2>
SEE ALSO </h2>
<pre>
       <a href="../man1/systemd.1.html">systemd(1)</a>, <a href="../man8/systemd-repart.8.html">systemd-repart(8)</a>, <a href="../man8/sfdisk.8.html">sfdisk(8)</a>, <a href="../man1/systemd-cryptenroll.1.html">systemd-cryptenroll(1)</a>
</pre> <h2>
NOTES </h2>
<pre>
        1. Discoverable Partitions Specification
           <a href="https://uapi-group.org/specifications/specs/discoverable_partitions_specification">https://uapi-group.org/specifications/specs/discoverable_partitions_specification</a>
</pre> <h2>
COLOPHON </h2>
<pre>
       This page is part of the <i>systemd</i> (systemd system and service
       manager) project.  Information about the project can be found at
       ⟨<a href="http://www.freedesktop.org/wiki/Software/systemd">http://www.freedesktop.org/wiki/Software/systemd</a>⟩.  If you have
       a bug report for this manual page, see
       ⟨<a href="http://www.freedesktop.org/wiki/Software/systemd/#bugreports">http://www.freedesktop.org/wiki/Software/systemd/#bugreports</a>⟩.
       This page was obtained from the project's upstream Git repository
       ⟨<a href="https://github.com/systemd/systemd.git">https://github.com/systemd/systemd.git</a>⟩ on 2024-06-14.  (At that
       time, the date of the most recent commit that was found in the
       repository was 2024-06-13.)  If you discover any rendering
       problems in this HTML version of the page, or you believe there
       is a better or more up-to-date source for the page, or you have
       corrections or improvements to the information in this COLOPHON
       (which is <i>not</i> part of the original manual page), send a mail to
       man-pages@man7.org

<span class="footline">systemd 257~devel                                            <i>REPART.D</i>(5)</span>
</pre>  <p>Pages that refer to this page: <a href="sysupdate.d.5.html">sysupdate.d(5)</a>, <a href="../man7/systemd.directives.7.html">systemd.directives(7)</a>, <a href="../man7/systemd.index.7.html">systemd.index(7)</a>, <a href="../man8/systemd-repart.8.html">systemd-repart(8)</a> </p> <hr>         <div class="_attribution">
  <p class="_attribution-p">
    ...<br>
    <a href="https://man7.org/linux/man-pages/man5/repart.d.5.html" class="_attribution-link">https://man7.org/linux/man-pages/man5/repart.d.5.html</a>
  </p>
</div>
