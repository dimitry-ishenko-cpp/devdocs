<h1>smtpd.conf(5) — Linux manual page</h1>   <pre>
<span class="headline"><i>SMTPD.CONF</i>(5)              File Formats Manual             <i>SMTPD.CONF</i>(5)</span>
</pre> <h2>
NAME </h2>
<pre>
       <b>smtpd.conf </b>— SMTP daemon configuration file
</pre> <h2>
DESCRIPTION </h2>
<pre>
       <b>smtpd.conf </b>is the configuration file for the mail daemon
       <i>smtpd</i>(8).

       When mail arrives, each “RCPT TO:” command generates a mail
       envelope.  If an envelope matches any of a pre-designated set of
       criteria (using the <b>match </b>directive), the message is accepted for
       delivery.  A copy of the message, as well as its associated
       envelopes, is saved in the mail queue and later dispatched
       according to an associated set of actions (using the <b>action</b>
       directive).  If an envelope does not match any options, it is
       rejected.  The match rules are evaluated sequentially, with the
       first match winning.

       The format of the configuration file is fairly flexible.  The
       current line can be extended over multiple lines using a
       backslash (‘\’).  Comments can be put anywhere in the file using
       a hash mark (‘#’), and extend to the end of the current line.
       Care should be taken when commenting out multi-line text: the
       comment is effective until the end of the entire block.  Argument
       names not beginning with a letter, digit, or underscore, as well
       as reserved words (such as <b>listen</b>, <b>match</b>, and <b>port</b>), must be
       quoted.  Arguments containing whitespace should be surrounded by
       double quotes (").

       Macros can be defined that are later expanded in context.  Macro
       names must start with a letter, digit, or underscore, and may
       contain any of those characters, but may not be reserved words.
       Macros are not expanded inside quotes.  For example:

             lan_addr = "192.168.0.1"
             listen on $lan_addr
             listen on $lan_addr tls auth

       The syntax of <b>smtpd.conf </b>is described below.

       <b>action </b><i>name method</i> [<i>options</i>]
               When the queue runner processes an envelope from the mail
               queue, it carries out the <b>action </b><i>name</i>, selected by the
               <b>match </b>... <b>action </b>directive when the message was received.
               The <b>action </b>directive provides configuration data for
               delivery attempts.  Required lookups are performed at the
               time of each delivery attempt.  Consequently, changing an
               <b>action </b>directive or the files it references and
               restarting the <i>smtpd</i>(8) daemon causes the changes to take
               effect for subsequent delivery attempts for the
               respective dispatcher <i>name</i>, even for messages that were
               already stuck in the queue prior to the configuration
               changes.

               The delivery <i>method</i> parameter may be one of the
               following:

               <b>expand-only</b>
                       Only accept the message if a delivery method was
                       specified in an aliases or <i>.forward</i> file.

               <b>forward-only</b>
                       Only accept the message if the recipient results
                       in a remote address after the processing of
                       aliases or forward file.

               <b>lmtp </b><i>destination</i> [<b>rcpt-to</b>]
                       Deliver the message to an LMTP server at
                       <i>destination</i>.  The location may be expressed as
                       host:port or as a UNIX socket.

                       Optionally, <b>rcpt-to </b>might be specified to use the
                       recipient email address (after expansion) instead
                       of the local user in the LMTP session as RCPT TO.

               <b>maildir </b>[<i>pathname</i>] [<b>junk</b>]
                       Deliver the message to the maildir in <i>pathname</i> if
                       specified, or by default to <i>~/Maildir</i>.

                       The <i>pathname</i> may contain format specifiers that
                       are expanded before use (see “FORMAT
                       SPECIFIERS”).

                       If the <b>junk </b>argument is provided, the message
                       will be moved to the ‘Junk’ folder if it contains
                       a positive ‘X-Spam’ header.  This folder will be
                       created under <i>pathname</i> if it does not yet exist.

               <b>mbox    </b>Deliver the message to the user's mbox with
                       <i>mail.local</i>(8).

               <b>mda </b><i>command</i>
                       Delegate the delivery to a <i>command</i> that receives
                       the message on its standard input (see “MDA
                       COMMANDS”).

                       The <i>command</i> may contain format specifiers that
                       are expanded before use (see “FORMAT
                       SPECIFIERS”).

               <b>relay   </b>Relay the message to another SMTP server.

               The local delivery methods support additional options:

               <b>alias </b>&lt;<i>table</i>&gt;
                       Use the mapping <i>table</i> for <i>aliases</i>(5) expansion.

               <b>ttl </b><i>n</i>{<b>s</b>|<b>m</b>|<b>h</b>|<b>d</b>}
                       Specify how long a message may remain in the
                       queue.

               <b>user </b><i>username</i>
                       Specify the <i>username</i> for performing the delivery,
                       to be looked up with <i>getpwnam</i>(3).

                       This is used for virtual hosting where a single
                       username is in charge of handling delivery for
                       all virtual users.

                       This option is not usable with the <b>mbox </b>delivery
                       method.

                       Only the delivery user's <i>.forward</i> file will be
                       processed.

               <b>userbase </b>&lt;<i>table</i>&gt;
                       Use the mapping <i>table</i> for user lookups instead of
                       the <i>getpwnam</i>(3) function.

                       The <b>userbase </b>does not apply to the <b>user </b>option.

               <b>virtual </b>&lt;<i>table</i>&gt;
                       Use the mapping <i>table</i> for virtual expansion.  The
                       aliasing table format is described in <i>table</i>(5).

               <b>wrapper </b><i>name</i>
                       Use the wrapper specified in <b>mda wrapper</b>.

               The relay delivery methods also support additional
               options:

               <b>backup  </b>Operate as a backup mail exchanger delivering
                       messages to any mail exchanger with higher
                       priority.

               <b>backup mx </b><i>name</i>
                       Operate as a backup mail exchanger delivering
                       messages to any mail exchanger with higher
                       priority than mail exchanger identified as <i>name</i>.

               <b>helo </b><i>heloname</i>
                       Advertise <i>heloname</i> as the hostname to other mail
                       exchangers during the HELO phase.

               <b>helo-src </b>&lt;<i>table</i>&gt;
                       Use the mapping <i>table</i> to look up a hostname
                       matching the source address, to advertise during
                       the HELO phase.

               <b>domain </b>&lt;<i>domains</i>&gt;
                       Do not perform MX lookups but look up destination
                       domain in <i>domains</i> and use matching relay url as
                       relay host.

               <b>host </b><i>relay-url</i>
                       Do not perform MX lookups but relay messages to
                       the relay host described by <i>relay-url</i>.  The
                       format for <i>relay-url</i> is
                       [<i>proto</i>://[<i>label</i>@]]<i>host</i>[:<i>port</i>].  The following
                       protocols are available:

                       smtp        Normal SMTP session with
                                   opportunistic STARTTLS (the default).
                       smtp+tls    Normal SMTP session with mandatory
                                   STARTTLS.
                       smtp+notls  Plain text SMTP session without TLS.
                       lmtp        LMTP session.  <i>port</i> is required.
                       smtps       SMTP session with forced TLS on
                                   connection.  The default port is 465.

                       Unless noted, <i>port</i> defaults to 25.

                       The <i>label</i> corresponds to an entry in a
                       credentials table, as documented in <i>table</i>(5).  It
                       is used with the “smtp+tls” and “smtps” protocols
                       for authentication.  Server certificates for
                       those protocols are verified by default.

               <b>pki </b><i>pkiname</i>
                       For secure connections, use the certificate
                       associated with <i>pkiname</i> (declared in a <b>pki</b>
                       directive) to prove the client's identity to the
                       remote mail server.

               <b>srs     </b>When relaying a mail resulting from a forward,
                       use the Sender Rewriting Scheme to rewrite sender
                       address.

               <b>tls </b>[<b>no-verify</b>]
                       Require TLS to be used when relaying, using
                       mandatory STARTTLS by default.  When used with a
                       smarthost, the protocol must not be
                       “smtp+notls://”.  If <b>no-verify </b>is specified, do
                       not require a valid certificate.

               <b>protocols </b><i>protostr</i>
                       Define the protocol versions to be used for TLS
                       sessions.  Refer to the
                       <i>tls_config_parse_protocols</i>(3) manpage for the
                       format of <i>protostr</i>.

               <b>ciphers </b><i>cipherstr</i>
                       Define the list of ciphers that may be used for
                       TLS sessions.  Refer to the
                       <i>tls_config_set_ciphers</i>(3) manpage for the format
                       of <i>cipherstr</i>.

               <b>auth </b>&lt;<i>table</i>&gt;
                       Use the mapping <i>table</i> for connecting to <i>relay-url</i>
                       using credentials.  This option is usable only
                       with <b>host </b>option.  The credential table format is
                       described in <i>table</i>(5).

               <b>mail-from </b><i>mailaddr</i>
                       Use <i>mailaddr</i> as the MAIL FROM address within the
                       SMTP transaction.

               <b>src </b><i>sourceaddr</i> | &lt;<i>sourceaddr</i>&gt;
                       Use the string or list table <i>sourceaddr</i> for the
                       source IP address, which is useful on machines
                       with multiple interfaces.  If the list contains
                       more than one address, all of them are used in
                       such a way that traffic is routed as efficiently
                       as possible.

       <b>admd </b><i>authservid</i>
               The Administrative Management Domain this mail server
               belongs to.  The authservid will be forwarded to filters
               using it to identify or mark authentication-results
               headers.  If omitted, it defaults to the server name.

       <b>bounce warn-interval </b><i>delay</i> [, <i>delay ...</i>]
               Send warning messages to the envelope sender when
               temporary delivery failures cause a message to remain in
               the queue for longer than <i>delay</i>.  Each <i>delay</i> parameter
               consists of a positive decimal integer and a unit <b>s</b>, <b>m</b>,
               <b>h</b>, or <b>d</b>.  At most four <i>delay</i> parameters can be specified.
               The default is "<b>bounce warn-interval </b>4h", sending a
               single warning after four hours.

       <b>ca </b><i>caname</i> <b>cert </b><i>cafile</i>
               Associate the Certificate Authority (CA) certificate file
               <i>cafile</i> with ca entry <i>caname</i>.  The ca entry can be
               referenced in listener rules and relay actions.

       <b>filter </b><i>chain-name</i> <b>chain </b>{<i>filter-name</i> [, <i>...</i>]}
               Register a chain of filters <i>chain-name</i>, consisting of the
               filters listed in <i>filter-name</i>.  Filters in a filter chain
               are executed in order of declaration for each phase that
               they are registered for.  A filter chain may be used in
               place of a filter for any directive except filter chains
               themselves.

       <b>filter </b><i>filter-name</i> <b>phase </b><i>phase-name</i> <b>match </b><i>conditions decision</i>
               Register a filter <i>filter-name</i>.  A <i>decision</i> about what to
               do with the mail is taken at phase <i>phase-name</i> when
               matching <i>conditions</i>.  Phases, matching conditions, and
               decisions are described in “MAIL FILTERING”, below.

       <b>filter </b><i>filter-name</i> <b>proc </b><i>proc-name</i>
               Register "proc" filter <i>filter-name</i> backed by the
               <i>proc-name</i> process.

       <b>filter </b><i>filter-name</i> <b>proc-exec </b><i>command</i>
               Register and execute "proc" filter <i>filter-name</i> from
               <i>command</i>, conformant with the <i>smtpd-filters</i>(7) API.  If
               <i>command</i> starts with a slash it is executed with an
               absolute path, otherwise it will be run from
               “/usr/local/libexec/smtpd/”.

       <b>include </b>"<i>pathname</i>"
               Replace this directive with the content of the additional
               configuration file at the absolute <i>pathname</i>.

       <b>listen on </b><i>interface</i> [<i>family</i>] [<i>options</i>]
               Listen on the <i>interface</i> for incoming connections, using
               the same syntax as <i>ifconfig</i>(8).  The <i>interface</i> parameter
               may also be an interface group, an IP address, or a
               domain name.  Listening can optionally be restricted to a
               specific address <i>family</i>, which can be either <b>inet4 </b>or
               <b>inet6</b>.

               The <i>options</i> are as follows:

               <b>auth </b>[&lt;<i>authtable</i>&gt;]
                       Support SMTPAUTH: clients may only start SMTP
                       transactions after successful authentication.
                       Users are authenticated against either their own
                       normal login credentials or a credentials table
                       <i>authtable</i>, the format of which is described in
                       <i>table</i>(5).

               <b>auth-optional </b>[&lt;<i>authtable</i>&gt;]
                       Support SMTPAUTH optionally: clients need not
                       authenticate, but may do so.  This allows a
                       <b>listen on </b>directive to both accept incoming mail
                       from untrusted senders and permit outgoing mail
                       from authenticated users (using <b>match auth</b>).  It
                       can be used in situations where it is not
                       possible to listen on a separate port (usually
                       the submission port, 587) for users to
                       authenticate.

               <b>ca </b><i>caname</i>
                       For secure connections, use the CA certificate
                       associated with <i>caname</i> (declared in a <b>ca</b>
                       directive) as the CA certificate when verifying
                       client certificates.

               <b>filter </b><i>name</i>
                       Apply filter <i>name</i> on connections handled by this
                       listener.

               <b>hostname </b><i>hostname</i>
                       Use <i>hostname</i> in the greeting banner instead of
                       the default server name.

               <b>hostnames </b>&lt;<i>names</i>&gt;
                       Override the server name for specific addresses.
                       The <i>names</i> table contains a mapping of IP
                       addresses to hostnames.  If the address on which
                       the connection arrives appears in the mapping,
                       the associated hostname is used.

               <b>mask-src</b>
                       Omit the <b>from </b>part when prepending “Received”
                       headers.

               <b>no-dsn  </b>Disable the DSN (Delivery Status Notification)
                       extension.

               <b>pki </b><i>pkiname</i>
                       For secure connections, use the certificate
                       associated with <i>pkiname</i> (declared in a <b>pki</b>
                       directive) to prove a mail server's identity.
                       This option can be used multiple times to provide
                       alternate certificates for SNI.

               <b>port </b>[<i>port</i>]
                       Listen on the given <i>port</i> instead of the default
                       port 25.

               <b>proxy-v2</b>
                       Support the PROXYv2 protocol, appropriately
                       rewriting the source address received from proxy.

               <b>received-auth</b>
                       In “Received” headers, report whether the session
                       was authenticated and by which local user.

               <b>senders </b>&lt;<i>users</i>&gt; [<b>masquerade</b>]
                       Look up the authenticated user in the <i>users</i>
                       mapping table to find the email addresses that
                       user is allowed to submit mail as.  In addition,
                       if the <b>masquerade </b>option is provided, the From
                       header is rewritten to match the sender provided
                       in the SMTP session.

               <b>smtps   </b>Support SMTPS, by default on port 465.  Mutually
                       exclusive with <b>tls</b>.

               <b>tag </b><i>tag</i>
                       Clients connecting to the listener are tagged
                       with the given <i>tag</i>.

               <b>tls     </b>Support STARTTLS, by default on port 25.
                       Mutually exclusive with <b>smtps</b>.

               <b>tls-require </b>[<b>verify</b>]
                       Like <b>tls</b>, but force clients to establish a secure
                       connection before being allowed to start an SMTP
                       transaction.  With the <b>verify </b>option, clients
                       must also provide a valid certificate to
                       establish an SMTP session.

               <b>protocols </b><i>protostr</i>
                       Define the protocol versions to be used for TLS
                       sessions.  Refer to the
                       <i>tls_config_parse_protocols</i>(3) manpage for the
                       format of <i>protostr</i>.

               <b>ciphers </b><i>cipherstr</i>
                       Define the list of ciphers that may be used for
                       TLS sessions.  Refer to the
                       <i>tls_config_set_ciphers</i>(3) manpage for the format
                       of <i>cipherstr</i>.

       <b>listen on socket </b>[<i>options</i>]
               Listen for incoming SMTP connections on the Unix domain
               socket <i>/var/run/smtpd.sock</i>.  This is done by default,
               even if the directive is absent.

               The <i>options</i> are as follows:

               <b>filter </b><i>name</i>
                       Apply filter <i>name</i> on connections handled by this
                       listener.

               <b>mask-src</b>
                       Omit the <b>from </b>part when prepending “Received”
                       headers.

               <b>no-dsn  </b>Disable the DSN (Delivery Status Notification)
                       extension.

               <b>tag </b><i>tag</i>
                       Clients connecting to the listener are tagged
                       with the given <i>tag</i>.

       <b>match </b><i>options</i> <b>action </b><i>name</i>
               If at least one mail envelope matches the <i>options</i> of one
               <b>match action </b>directive, receive the incoming message, put
               a copy into each matching envelope, and atomically save
               the envelopes to the mail spool for later processing by
               the respective dispatcher <i>name</i>.

               The following matching options are supported and can all
               be negated:

               [<b>!</b>] <b>for any</b>
                       Specify that session may address any destination.

               [<b>!</b>] <b>for local</b>
                       Specify that session may address any local
                       domain.  This is the default, and may be omitted.

               [<b>!</b>] <b>for domain </b><i>domain</i> | &lt;<i>domain</i>&gt;
                       Specify that session may address the string or
                       list table <i>domain</i>.

               [<b>!</b>] <b>for domain regex </b><i>domain</i> | &lt;<i>domain</i>&gt;
                       Specify that session may address the regex or
                       regex table <i>domain</i>.

               [<b>!</b>] <b>for rcpt-to </b><i>recipient</i> | &lt;<i>recipient</i>&gt;
                       Specify that session may address the string or
                       list table <i>recipient</i>.

               [<b>!</b>] <b>for rcpt-to regex </b><i>recipient</i> | &lt;<i>recipient</i>&gt;
                       Specify that session may address the regex or
                       regex table <i>recipient</i>.

               [<b>!</b>] <b>from any</b>
                       Specify that session may originate from any
                       source.

               [<b>!</b>] <b>from auth</b>
                       Specify that session may originate from any
                       authenticated user, no matter the source IP
                       address.

               [<b>!</b>] <b>from auth </b><i>user</i> | &lt;<i>user</i>&gt;
                       Specify that session may originate from
                       authenticated user or user list <i>user</i>, no matter
                       the source IP address.

               [<b>!</b>] <b>from auth regex </b><i>user</i> | &lt;<i>user</i>&gt;
                       Specify that session may originate from
                       authenticated regex or regex list <i>user</i>, no matter
                       the source IP address.

               [<b>!</b>] <b>from local</b>
                       Specify that session may only originate from a
                       local IP address, or from the local enqueuer.
                       This is the default, and may be omitted.

               [<b>!</b>] <b>from mail-from </b><i>sender</i> | &lt;<i>sender</i>&gt;
                       Specify that session may originate from sender or
                       sender list <i>sender</i>, no matter the source IP
                       address.

               [<b>!</b>] <b>from mail-from regex </b><i>sender</i> | &lt;<i>sender</i>&gt;
                       Specify that session may originate from regex or
                       regex list <i>sender</i>, no matter the source IP
                       address.

               [<b>!</b>] <b>from rdns</b>
                       Specify that session may only originate from an
                       IP address that resolves to a reverse DNS.

               [<b>!</b>] <b>from rdns </b><i>hostname</i> | &lt;<i>hostname</i>&gt;
                       Specify that session may only originate from an
                       IP address that resolves to a reverse DNS
                       matching string or list string <i>hostname</i>.

               [<b>!</b>] <b>from rdns regex </b><i>hostname</i> | &lt;<i>hostname</i>&gt;
                       Specify that session may only originate from an
                       IP address that resolves to a reverse DNS
                       matching regex or list regex <i>hostname</i>.

               [<b>!</b>] <b>from socket</b>
                       Specify that session may only originate from the
                       local enqueuer.

               [<b>!</b>] <b>from src </b><i>address</i> | &lt;<i>address</i>&gt;
                       Specify that session may only originate from
                       string or list table <i>address</i> which can be a
                       specific address or a subnet expressed in CIDR-
                       notation.

               [<b>!</b>] <b>from src regex </b><i>address</i> | &lt;<i>address</i>&gt;
                       Specify that session may only originate from
                       regex or regex table <i>address</i> which can be a
                       specific address or a subnet expressed in CIDR-
                       notation.

               In addition, the following transaction options may be
               matched:

               [<b>!</b>] <b>auth</b>
                       Matches transactions which have been
                       authenticated.

               [<b>!</b>] <b>auth </b><i>username</i> | &lt;<i>username</i>&gt;
                       Matches transactions which have been
                       authenticated for user or user list <i>username</i>.

               [<b>!</b>] <b>auth regex </b><i>username</i> | &lt;<i>username</i>&gt;
                       Matches transactions which have been
                       authenticated for regex or regex list <i>username</i>.

               [<b>!</b>] <b>helo </b><i>helo-name</i> | &lt;<i>helo-name</i>&gt;
                       Specify that session's HELO / EHLO should match
                       the string or list table <i>helo-name</i>.

               [<b>!</b>] <b>helo regex </b><i>helo-name</i> | &lt;<i>helo-name</i>&gt;
                       Specify that session's HELO / EHLO should match
                       the regex or regex table <i>helo-name</i>.

               [<b>!</b>] <b>mail-from </b><i>sender</i> | &lt;<i>sender</i>&gt;
                       Specify that transaction's MAIL FROM should match
                       the string or list table <i>sender</i>.

               [<b>!</b>] <b>mail-from regex </b><i>sender</i> | &lt;<i>sender</i>&gt;
                       Specify that transaction's MAIL FROM should match
                       the regex or regex table <i>sender</i>.

               [<b>!</b>] <b>rcpt-to </b><i>recipient</i> | &lt;<i>recipient</i>&gt;
                       Specify that transaction's RCPT TO should match
                       the string or list table <i>recipient</i>.

               [<b>!</b>] <b>rcpt-to regex </b><i>recipient</i> | &lt;<i>recipient</i>&gt;
                       Specify that transaction's RCPT TO should match
                       the regex or regex table <i>recipient</i>.

               [<b>!</b>] <b>tag </b><i>tag</i>
                       Matches transactions tagged with the given <i>tag</i>.

               [<b>!</b>] <b>tag regex </b><i>tag</i>
                       Matches transactions tagged with the given <i>tag</i>
                       regex.

               [<b>!</b>] <b>tls</b>
                       Specify that transaction should take place in a
                       TLS channel.

       <b>match </b><i>options</i> <b>reject</b>
               Reject the incoming message during the SMTP dialogue.
               The same <i>options</i> are supported as for the <b>match action</b>
               directive.

       <b>mda wrapper </b><i>name command</i>
               Associate <i>command</i> with the mail delivery agent wrapper
               named <i>name</i>.  When a local delivery specifies a wrapper,
               the <i>command</i> associated with the wrapper will be executed
               instead.  The command may contain format specifiers (see
               “FORMAT SPECIFIERS”).

       <b>mta max-deferred </b><i>number</i>
               When delivery to a given host is suspended due to
               temporary failures, cache at most <i>number</i> envelopes for
               that host such that they can be delivered as soon as
               another delivery succeeds to that host.  The default is
               100.

       <b>pki </b><i>pkiname</i> <b>cert </b><i>certfile</i>
               Associate certificate file <i>certfile</i> with pki entry
               <i>pkiname</i>.  The pki entry defines a keypair configuration
               that can be referenced in listener rules and relay
               actions.

               A certificate chain may be created by appending one or
               many certificates, including a Certificate Authority
               certificate, to <i>certfile</i>.  The creation of certificates
               is documented in <i>starttls</i>(8).

       <b>pki </b><i>pkiname</i> <b>key </b><i>keyfile</i>
               Associate the key located in <i>keyfile</i> with pki entry
               <i>pkiname</i>.

       <b>pki </b><i>pkiname</i> <b>dhe </b><i>params</i>
               Specify the DHE parameters to use for DHE cipher suites
               with pki entry <i>pkiname</i>.  Valid parameter values are <b>none</b>,
               <b>legacy</b>, and <b>auto</b>.  For <b>legacy</b>, a fixed key length of 1024
               bits is used, whereas for <b>auto</b>, the key length is
               determined automatically.  The default is <b>none</b>, which
               disables DHE cipher suites.

       <b>proc </b><i>proc-name command</i>
               Register an external process named <i>proc-name</i> from
               <i>command</i>, conformant with the <i>smtpd-filters</i>(7) API.  Such
               processes may be used to share the same instance between
               multiple filters.  If <i>command</i> starts with a slash it is
               executed with an absolute path, otherwise it will be run
               from “/usr/local/libexec/smtpd/”.

       <b>queue compression</b>
               Store queue files in a compressed format.  This may be
               useful to save disk space.

       <b>queue encryption </b>[<i>key</i>]
               Encrypt queue files with <i>EVP_aes_256_gcm</i>(3).  If no <i>key</i>
               is specified, it is read with <i>getpass</i>(3).  If the string
               <b>stdin </b>or a single dash (‘-’) is given instead of a <i>key</i>,
               the key is read from the standard input.

       <b>queue ttl </b><i>delay</i>
               Set the default expiration time for temporarily
               undeliverable messages, given as a positive decimal
               integer followed by a unit <b>s</b>, <b>m</b>, <b>h</b>, or <b>d</b>.  The default is
               four days (4d).

       <b>smtp ciphers </b><i>control</i>
               Set the <i>control</i> string for <i>SSL_CTX_set_cipher_list</i>(3).
               The default is "HIGH:!aNULL:!MD5".

       <b>smtp limit max-mails </b><i>count</i>
               Limit the number of messages to <i>count</i> for each session.
               The default is 100.

       <b>smtp limit max-rcpt </b><i>count</i>
               Limit the number of recipients to <i>count</i> for each
               transaction.  The default is 1000.

       <b>smtp max-message-size </b><i>size</i>
               Reject messages larger than <i>size</i>, given as a positive
               number of bytes or as a string to be parsed with
               <i>scan_scaled</i>(3).  The default is "35M".

       <b>smtp sub-addr-delim </b><i>character</i>
               When resolving the local part of a local email address,
               ignore the ASCII <i>character</i> and all characters following
               it.  The default is ‘+’.

       <b>srs key </b><i>secret</i>
               Set the secret key to use for SRS, the Sender Rewriting
               Scheme.

       <b>srs key backup </b><i>secret</i>
               Set a backup secret key to use as a fallback for SRS.
               This can be used to implement SRS key rotation.

       <b>srs ttl </b><i>delay</i>
               Set the time-to-live delay for SRS envelopes.  After this
               delay, a bounce reply to the SRS address will be
               discarded to limit risks of forged addresses.  The
               default is four days (4d).

       <b>table </b><i>name</i> [<i>type</i>:]<i>pathname</i>
               Tables provide additional configuration information for
               <i>smtpd</i>(8) in the form of lists or key-value mappings.  The
               format of the entries depends on what the table is used
               for.  Refer to <i>table</i>(5) for the exhaustive documentation.

               Each table is identified by an arbitrary, unique <i>name</i>.

               If the <i>type</i> is <b>db</b>, information is stored in a file
               created with <i>makemap</i>(8); if it is <b>file </b>or omitted,
               information is stored in a plain text file using the
               format described in <i>table</i>(5).  The <i>pathname</i> to the file
               must be absolute.

       <b>table </b><i>name</i> {<i>value</i> [, <i>...</i>]}
               Instead of using a separate file, declare a list table
               containing the given static <i>value</i>s.  The table must
               contain at least one value and may declare multiple
               values as a comma-separated (whitespace optional) list.

       <b>table </b><i>name</i> {<i>key</i>=<i>value</i> [, <i>...</i>]}
               Instead of using a separate file, declare a mapping table
               containing the given static <i>key</i>-<i>value</i> pairs.  The table
               must contain at least one key-value pair and may declare
               multiple pairs as a comma-separated (whitespace optional)
               list.

   <b>MAIL FILTERING</b>
       In a regular workflow, <i>smtpd</i>(8) may accept or reject a message
       based only on the content of envelopes.  Its decisions are about
       the handling of the message, not about the handling of an active
       session.

       Filtering extends the decision making process by allowing
       <i>smtpd</i>(8) to stop at each phase of an SMTP session, check that
       conditions are met, then decide if a session is allowed to move
       forward.

       With filtering, a session may be interrupted at any phase before
       an envelope is complete.  A message may also be rejected after
       being submitted, regardless of whether the envelope was accepted
       or not.

       The following phases are currently supported:

             connect      upon connection, before a banner is displayed
             helo         after HELO command is submitted
             ehlo         after EHLO command is submitted
             mail-from    after MAIL FROM command is submitted
             rcpt-to      after RCPT TO command is submitted
             data         after DATA command is submitted
             commit       after message is fully is submitted

       At each phase, various conditions may be matched.  The fcrdns,
       rdns, and src data are available in all phases, but other data
       must have been already submitted before they are available.

             fcrdns                   forward-confirmed reverse DNS is
                                      valid
             rdns                     session has a reverse DNS
             rdns &lt;<i>table</i>&gt;             session has a reverse DNS in table
             src &lt;<i>table</i>&gt;              source address is in table
             helo &lt;<i>table</i>&gt;             helo name is in table
             auth                     session is authenticated
             auth &lt;<i>table</i>&gt;             session username is in table
             mail-from &lt;<i>table</i>&gt;        sender address is in table
             rcpt-to &lt;<i>table</i>&gt;          recipient address is in table

       These conditions may all be negated by prefixing them with an
       exclamation mark:

             !fcrdns                  forward-confirmed reverse DNS is
                                      invalid

       Any conditions using a table may indicate that the table contains
       regular expressions by prefixing the table name with the keyword
       regex.

             helo regex &lt;<i>table</i>&gt;       helo name matches a regex in table

       Finally, a number of decisions may be taken:

             bypass                   the session or transaction
                                      bypasses filters
             disconnect <i>message</i>       the session is disconnected with
                                      message
             junk                     the session or transaction is
                                      junked, i.e., an ‘X-Spam: yes’
                                      header is added to any messages
             reject <i>message</i>           the command is rejected with
                                      message
             rewrite <i>value</i>            the command parameter is rewritten
                                      with value

       Decisions that involve a message require that the message be RFC
       valid, meaning that they should either start with a 4xx or 5xx
       status code.  Decisions can be taken at any phase, though junking
       can only happen before a message is committed.

   <b>FORMAT SPECIFIERS</b>
       Some configuration directives support expansion of their
       parameters at runtime.  Such directives (for example <b>action</b>
       <b>maildir</b>, <b>action mda</b>) may use format specifiers which are expanded
       before delivery or relaying.  The following formats are currently
       supported:

             %{sender}            sender email address, may be empty
                                  string
             %{sender.user}       user part of the sender email address,
                                  may be empty
             %{sender.domain}     domain part of the sender email
                                  address, may be empty
             %{rcpt}              recipient email address
             %{rcpt.user}         user part of the recipient email
                                  address
             %{rcpt.domain}       domain part of the recipient email
                                  address
             %{dest}              recipient email address after
                                  expansion
             %{dest.user}         user part after expansion
             %{dest.domain}       domain part after expansion
             %{user.username}     local user
             %{user.directory}    home directory of the local user
             %{mbox.from}         name used in mbox From separator lines
             %{mda}               mda command, only available for mda
                                  wrappers

       Expansion formats also support partial expansion using the
       optional bracket notations with substring offset.  For example,
       with recipient domain “example.org”:

             %{rcpt.domain[0]}       expands to “e”
             %{rcpt.domain[1]}       expands to “x”
             %{rcpt.domain[8:]}      expands to “org”
             %{rcpt.domain[-3:]}     expands to “org”
             %{rcpt.domain[0:6]}     expands to “example”
             %{rcpt.domain[0:-4]}    expands to “example”

       In addition, modifiers may be applied to the token.  For example,
       with recipient “User+Tag@Example.org”:

             %{rcpt:lowercase}          expands to
                                        “user+tag@example.org”
             %{rcpt:uppercase}          expands to
                                        “USER+TAG@EXAMPLE.ORG”
             %{rcpt:strip}              expands to “User@Example.org”
             %{rcpt:lowercase|strip}    expands to “user@example.org”

       For security concerns, expanded values are sanitized and
       potentially dangerous characters are replaced with ‘:’.  In
       situations where they are desirable, the “raw” modifier may be
       applied.  For example, with recipient “user+t?g@example.org”:

             %{rcpt}        expands to “user+t:g@example.org”
             %{rcpt:raw}    expands to “user+t?g@example.org”

   <b>MDA COMMANDS</b>
       When an action delivery method is <b>mda</b>, <i>smtpd</i>(8) runs the
       associated command for the delivery with the mail content
       provided via standard input.  The command is expected to read all
       the mail content.

       The exit code of the command reports the outcome of the delivery:
       status 0 (EX_OK) is a successful delivery; status 71 (EX_OSERR)
       and 75 (EX_TEMPFAIL) are temporary failures; and all other exit
       status are considered permanent failures.

       The following environment variables are set:

       DOMAIN              The recipient domain.
       EXTENSION           The sub address of the recipient (may be
                           unset).
       HOME                The delivery user's login directory.
       LOCAL               The local part of the recipient user address.
       LOGNAME             The login name of the user.
       ORIGINAL_RECIPIENT  The address of the original recipient.
       PATH                Set to _PATH_DEFPATH.  Traditionally
                           <i>/usr/bin:/bin</i>, but expanded to include
                           <i>/usr/sbin</i>, <i>/sbin</i>, <i>/usr/X11R6/bin</i>,
                           <i>/usr/local/bin</i>, and <i>/usr/local/sbin</i> in
                           OpenBSD.
       RECIPIENT           The address of the final recipient.
       SENDER              The address of the sender (might be empty).
       SHELL               Set to <i>/bin/sh</i>.
       USER                Synonym of LOGNAME for backwards
                           compatibility.
</pre> <h2>
FILES </h2>
<pre>
       <i>/etc/mail/smtpd.conf</i>     Default <i>smtpd</i>(8) configuration file.
       <i>/etc/mail/mailname</i>       If this file exists, the first line is
                                used as the server name.  Otherwise, the
                                server name is derived from the local
                                hostname returned by <i>gethostname</i>(3),
                                either directly if it is a fully
                                qualified domain name, or by retrieving
                                the associated canonical name through
                                <i>getaddrinfo</i>(3).
       <i>/var/run/smtpd.sock</i>      Unix domain socket for incoming SMTP
                                connections.
       <i>/var/spool/smtpd/</i>        Spool directories for mail during
                                processing.
</pre> <h2>
EXAMPLES </h2>
<pre>
       The default <b>smtpd.conf </b>file which ships with OpenBSD listens on
       the loopback network interface (<i>lo0</i>) and allows for mail from
       users and daemons on the local machine, as well as permitting
       email to remote servers.  Some more complex configurations are
       given below.

       This first example is similar to the default configuration, but
       all outgoing mail is forwarded to a remote SMTP server.  A
       secrets file is needed to specify a username and password:

             # touch /etc/mail/secrets
             # chmod 640 /etc/mail/secrets
             # chown root:_smtpd /etc/mail/secrets
             # echo "bob username:password" &gt; /etc/mail/secrets

       <b>smtpd.conf </b>would look like this:

             table aliases file:/etc/mail/aliases
             table secrets file:/etc/mail/secrets

             listen on lo0

             action "local_mail" mbox alias &lt;aliases&gt;
             action "outbound" relay host smtp+tls://bob@smtp.example.com \
                     auth &lt;secrets&gt;

             match from local for local action "local_mail"
             match from local for any action "outbound"

       In this second example, the aim is to permit mail delivery and
       relaying only for users that can authenticate (using their normal
       login credentials).  An RSA certificate must be provided to prove
       the server's identity.  The mail server listens on all interfaces
       the default routes point to.  Mail with a local destination is
       sent to an external MDA.  First, the RSA certificate is created:

             # openssl genrsa -out /etc/ssl/private/mail.example.com.key 4096
             # openssl req -new -x509 -key /etc/ssl/private/mail.example.com.key \
                     -out /etc/ssl/mail.example.com.crt -days 365
             # chmod 600 /etc/ssl/mail.example.com.crt
             # chmod 600 /etc/ssl/private/mail.example.com.key

       In the example above, a certificate valid for one year was
       created.  The configuration file would look like this:

             pki mail.example.com cert "/etc/ssl/mail.example.com.crt"
             pki mail.example.com key "/etc/ssl/private/mail.example.com.key"

             table aliases file:/etc/mail/aliases

             listen on lo0
             listen on egress tls pki mail.example.com auth

             action mda_with_aliases mda "/path/to/mda -f -" alias &lt;aliases&gt;
             action mda_without_aliases mda "/path/to/mda -f -"
             action "outbound" relay

             match for local action mda_with_aliases
             match from any for domain example.com action mda_without_aliases
             match for any action "outbound"
             match auth from any for any action "outbound"

       For sites that wish to sign messages using DKIM, the following
       example uses <b>opensmtpd-filter-dkimsign </b>for DKIM signing:

             table aliases file:/etc/mail/aliases

             filter "dkimsign" proc-exec "filter-dkimsign -d &lt;domain&gt; -s &lt;selector&gt; \
                     -k /etc/mail/dkim/private.key" user _dkimsign group _dkimsign

             listen on socket filter "dkimsign"
             listen on lo0 filter "dkimsign"

             action "local_mail" mbox alias &lt;aliases&gt;
             action "outbound" relay

             match for local action "local_mail"
             match for any action "outbound"

       Alternatively, the <b>opensmtpd-filter-rspamd </b>package may be used to
       provide integration with <b>rspamd</b>, a third-party daemon which
       provides multiple antispam features as well as DKIM signing.  As
       well as configuring <b>rspamd </b>itself, it requires use of the
       <b>proc-exec </b>keyword:

             filter "rspamd" proc-exec "filter-rspamd"

       Sites that accept non-local messages may be able to cut down on
       the volume of spam received by rejecting forged messages that
       claim to be from the local domain.  The following example uses a
       list table <i>other-relays</i> to specify the IP addresses of relays
       that may legitimately originate mail with the owner's domain as
       the sender.

             table aliases file:/etc/mail/aliases
             table other-relays file:/etc/mail/other-relays

             listen on lo0
             listen on egress

             action "local_mail" mbox alias &lt;aliases&gt;
             action "outbound" relay

             match for local action "local_mail"
             match for any action "outbound"
             match !from src &lt;other-relays&gt; mail-from "@example.com" for any \
                   reject
             match from any for domain example.com action "local_mail"
</pre> <h2>
SEE ALSO </h2>
<pre>
       <i>mailer.conf</i>(5), <i>table</i>(5), <i>smtpd-filters</i>(7), <i>makemap</i>(8), <i>smtpd</i>(8)
</pre> <h2>
HISTORY </h2>
<pre>
       <i>smtpd</i>(8) first appeared in OpenBSD 4.6.
</pre> <h2>
COLOPHON </h2>
<pre>
       This page is part of the <i>OpenSMTPD</i> (a FREE implementation of the
       server-side SMTP protocol) project.  Information about the
       project can be found at <a href="https://www.opensmtpd.org/">https://www.opensmtpd.org/</a>.  If you have
       a bug report for this manual page, see
       ⟨<a href="https://github.com/OpenSMTPD/OpenSMTPD/issues">https://github.com/OpenSMTPD/OpenSMTPD/issues</a>⟩.  This page was
       obtained from the project's upstream Git repository
       ⟨<a href="https://github.com/OpenSMTPD/OpenSMTPD.git">https://github.com/OpenSMTPD/OpenSMTPD.git</a>⟩ on 2024-06-14.  (At
       that time, the date of the most recent commit that was found in
       the repository was 2024-06-09.)  If you discover any rendering
       problems in this HTML version of the page, or you believe there
       is a better or more up-to-date source for the page, or you have
       corrections or improvements to the information in this COLOPHON
       (which is <i>not</i> part of the original manual page), send a mail to
       man-pages@man7.org

<span class="footline">GNU                          March 24, 2024                <i>SMTPD.CONF</i>(5)</span>
</pre>          <div class="_attribution">
  <p class="_attribution-p">
    ...<br>
    <a href="https://man7.org/linux/man-pages/man5/smtpd.conf.5.html" class="_attribution-link">https://man7.org/linux/man-pages/man5/smtpd.conf.5.html</a>
  </p>
</div>
