<h1>pmieconf(5) — Linux manual page</h1>   <pre>
<span class="headline"><i>PMIECONF</i>(5)                File Formats Manual               <i>PMIECONF</i>(5)</span>
</pre> <h2>
NAME </h2>
<pre>
       <b>pmieconf </b>- generalized pmie rules and customizations
</pre> <h2>
DESCRIPTION </h2>
<pre>
       The pmieconf file formats are used by the <a href="../man1/pmieconf.1.html">pmieconf(1)</a> tool as a
       way to generalize <a href="../man1/pmie.1.html">pmie(1)</a> rule sets such that they can be easily
       configured for different systems and different environments.
       There are two completely different (although closely related)
       file formats discussed here, namely ``pmieconf-rules'' and
       ``pmieconf-pmie''.

       The directory <b>$PCP_VAR_DIR/config/pmieconf </b>contains information
       about all the default system <b>pmie </b>generalized rules and
       variables, including default values for all variables.  These
       files are in the pmieconf-rules format.  Although new pmieconf-
       rules files can be added, the files in this directory should
       never be changed.  Instead, use the <b>pmieconf </b>utility to change
       variable values in the <b>pmie </b>configuration file.

       The pmieconf-pmie format allows site specific customizations of
       the rules contained in pmieconf-rules files and their associated
       variables.  The pmieconf-pmie format is generated by <b>pmieconf </b>and
       should not be edited by hand.  This generated file is in the <b>pmie</b>
       format, with some additional information held at the head of the
       file - thus, the pmieconf-pmie format is a superset of the <b>pmie</b>
       file format (extended to hold customizations to the generalized
       rules, but also containing the actual performance rules for <b>pmie</b>
       to evaluate) which can also be parsed by <b>pmie </b>(all extensions are
       hidden within comments, and are thus meaningless to <b>pmie </b>itself).

       The file <b>$PCP_VAR_DIR/config/pmieconf/config.pmie </b>contains local
       system settings for <b>pmieconf </b>configurable variables.  The
       variable settings in this file replace the default values
       specified in <b>$PCP_VAR_DIR/config/pmieconf/*/*</b>.
</pre> <h2>
PMIECONF-PMIE SYNTAX </h2>
<pre>
       All rule customization lines in a valid pmieconf-pmie
       specification are prefixed by ``//'' and are located at the head
       of the file - this allows files containing a pmieconf-pmie
       specification to be successfully parsed by <b>pmie</b>.  A pmieconf-pmie
       must always have the first line in the form:

           // pmieconf-pmie <i>version pmieconf_path</i>

       The <i>version</i> specifies which version of the pmieconf-pmie syntax
       should be used to parse this file.  Currently the only supported
       version is 1.  The <i>pmieconf_path</i> specifies the path to the
       pmieconf-rules files which were used, by <b>pmieconf</b>, to generate
       this file.  This is discussed in the <a href="../man1/pmieconf.1.html">pmieconf(1)</a> man page (see
       the <b>-r </b>option).

       The remainder of the specification consists of one line entries
       for each of the modified variables.  The syntax for each line is:

           // <i>rule_version rule_name rule_variable</i> = <i>value</i>

       The <i>rule_version</i> and <i>rule_name</i> are used to identify the rule with
       which to associate the customization.  These are followed by the
       <i>rule_variable</i> name (i.e. the variable of rule <i>rule_name</i> which has
       been changed) for which the new <i>value</i> is to be used.

       A pmieconf-pmie specification must be terminated with the ``end''
       keyword.  This is used by <b>pmieconf </b>to distinguish where the
       customizations ends, and the actual <b>pmie </b>rule component begins.
</pre> <h2>
PMIECONF-PMIE EXAMPLE </h2>
<pre>
       The following example is a valid pmieconf-pmie format file, as
       generated by <b>pmieconf</b>.  In order to make changes by hand which
       are preserved by <b>pmieconf</b>, see the comments contained in the
       generated file (below) as to where such changes should be made.

           // pmieconf-pmie 1 $PCP_VAR_DIR/config/pmieconf
           // 1 memory.exhausted delta = "4 minutes"
           // 1 memory.exhausted enabled = yes
           // 1 memory.exhausted pcplog_action = yes
           // end
           //
           // --- START GENERATED SECTION (do not change this section) ---
           //     generated by pmieconf on:  [DATESTAMP]
           //

           // 1 memory.exhausted
           delta = 4 minutes;
           some_host (
               ( avg_sample (swap.pagesout @0..9 ) ) &gt; 0 &amp;&amp;
               30 %_sample swap.pagesout &gt;= 5
           ) -&gt; shell 10 min "$PCP_BINADM_DIR/pmpost Severe demand for real memory" \
                   " %vpgsout/s@%h";

           // --- END GENERATED SECTION (changes below will be preserved) ---

       To see how this all works, you can generate this file as follows:

           # cat - | pmieconf -f /tmp/pmieconf.out \
               -r $PCP_VAR_DIR/config/pmieconf/memory:$PCP_VAR_DIR/config/pmieconf/global
           modify memory.exhausted delta "4 minutes"
           modify memory.exhausted enabled yes
           modify memory.exhausted pcplog_action yes
           ^D
           #

       Then verify that the generated file is a valid <b>pmie </b>configuration
       file using:

           # pmie -C /tmp/pmieconf.out

       This parses the file, and then exits after reporting any syntax
       errors.  Now replace -C with -v (above), and watch <b>pmie </b>do its
       work!
</pre> <h2>
PMIECONF-RULES SYNTAX </h2>
<pre>
       A pmieconf-rules specification consists of a number of separate
       data objects which together form a complete rule specification
       (note that a specification may span multiple files and even
       multiple subdirectories).  Each object must have an <i>identifier</i>
       string and a data <i>type</i>, followed by an (optional) list of
       <i>attribute</i>s.

       The generic specification of a pmieconf-rules object is thus:

           <i>type identifier</i> [ <i>attribute</i> = <i>value</i> ]* ;

       The set of valid <i>type</i>s is: "rule" (rule definition), "string"
       (arbitrary, double-quote enclosed string), "double", "integer",
       "unsigned", "percent" (real number between 0 and 100), "hostlist"
       (space separated list of host names), "instlist" (space separated
       list of metric instance names), and the four <b>pmie </b>action types,
       namely "print", "shell", "alarm", and "syslog".

       Rule names use the ``.'' character to introduce the concept of a
       rule group, e.g. "memory.exhausted" associates this rule with the
       "memory" group.  <b>pmieconf </b>can operate at either the level of rule
       groups or individual rules.  The group name "global" is reserved
       and may not be used with any rule.

       Usually when an object is created it is associated with the
       current rule.  However, if an object's name is preceded by the
       reserved group name "global", then that object is visible to all
       rules.

       The set of valid <i>attribute</i>s is: "help" (descriptive text about
       this object), "modify" (<i>value</i> is yes/no, flags whether <b>pmieconf</b>
       should allow changes), "enabled" (<i>value</i> is yes/no, flags whether
       this is on or off - only meaningful for rules and actions),
       "display" (yes/no - flags whether <b>pmieconf </b>should show this
       object), "default" (<i>value</i> determined by <i>type</i>, and is the default
       value for this object), and specific to objects of rule type are
       the "version", "predicate", and "enumerate" attributes.
       "version" and "predicate" are fairly self explanatory
       ("predicate" must equate to a valid <b>pmie </b>rule when expanded), but
       "enumerate" requires further discussion.

       The "enumerate" clause is useful when you wish to generate
       multiple, similar <b>pmie </b>rules from a single predicate.  This is
       most useful for rule definitions wishing to use the "some_inst"
       clause in the <b>pmie </b>language across multiple hosts.  For a rule to
       use these together, it must be certain that the instance list is
       the same on all of the monitored hosts.  This is rarely true, so
       the "enumerate" attribute allows us to generate multiple rules,
       expanded over variables of either type "instlist" or "hostlist".
       These variables make up the value for the "enumerate" attribute -
       which is a space-separated list of "instlist" or "hostlist"
       variable names.

       Objects can be incorporated into other object definitions using
       the $<i>identifier</i>$ syntax.  See the example later for more insight
       into how this is useful.

       When <b>pmieconf </b>is generating the <b>pmie </b>configuration file, it looks
       at each enabled rule with N enabled actions (where N &gt; 0) and
       expands the string:

           // "version" <i>identifier</i>
           delta = $delta$;
           "predicate" -&gt; $threshold$ $action1$ &amp; ... &amp; $actionN$ ;

       The delta, threshold, and action variables are defined globally
       (using the "global" keyword) for all rules, but can, of course,
       be changed at the level of an individual rule or rule group.
</pre> <h2>
PMIECONF-RULES EXAMPLE </h2>
<pre>
       The following is an example of a single pmieconf-rules
       specification, showing a number of different aspects of the
       language discussed above.  The example defines a rule
       ("memory.exhausted") and a string ("rule").

           rule    memory.exhausted
                   default = "$rule$"
                   predicate =
           "some_host (
               ( avg_sample (swap.pagesout $hosts$ @0..9 ) ) &gt; 0 &amp;&amp;
               $pct$ %_sample swap.pagesout $hosts$ @0..9 &gt;= $threshold$
           )"
                   enabled = yes
                   version = 1
                   help    =
           "The system is swapping modified pages out of main memory to the
           swap partitions, and has been doing this on at least pct of the
           last 10 evaluations of this rule.
           There appears to be insufficient main memory to meet the resident
           demands of the current workload.";

           string  rule
                   default = "Severe demand for real memory"
                   modify  = no
                   display = no;

       Note that for the above rule to be complete, "threshold" and
       "pct" would also need to be defined - for the full expression of
       this rule, refer to
       <i>$PCP_VAR_DIR/config/pmieconf/memory/exhausted</i>.
</pre> <h2>
FILES </h2>
<pre>
       <i>$PCP_VAR_DIR/config/pmieconf/</i>*/*
              generalized system resource monitoring rules
       <i>$PCP_VAR_DIR/config/pmieconf/config.pmie</i>
              default super-user settings for system resource monitoring
              rules
       <i>$HOME/.pcp/pmie/config.pmie</i>
              default user settings for system resource monitoring rules
</pre> <h2>
SEE ALSO </h2>
<pre>
       <a href="../man1/pmie.1.html">pmie(1)</a> and <a href="../man1/pmieconf.1.html">pmieconf(1)</a>.
</pre> <h2>
COLOPHON </h2>
<pre>
       This page is part of the <i>PCP</i> (Performance Co-Pilot) project.
       Information about the project can be found at 
       ⟨<a href="http://www.pcp.io/">http://www.pcp.io/</a>⟩.  If you have a bug report for this manual
       page, send it to pcp@groups.io.  This page was obtained from the
       project's upstream Git repository
       ⟨<a href="https://github.com/performancecopilot/pcp.git">https://github.com/performancecopilot/pcp.git</a>⟩ on 2024-06-14.
       (At that time, the date of the most recent commit that was found
       in the repository was 2024-06-14.)  If you discover any rendering
       problems in this HTML version of the page, or you believe there
       is a better or more up-to-date source for the page, or you have
       corrections or improvements to the information in this COLOPHON
       (which is <i>not</i> part of the original manual page), send a mail to
       man-pages@man7.org

<span class="footline">Performance Co-Pilot               PCP                       <i>PMIECONF</i>(5)</span>
</pre>  <p>Pages that refer to this page: <a href="../man1/pcpintro.1.html">pcpintro(1)</a>, <a href="../man1/pmieconf.1.html">pmieconf(1)</a> </p> <hr>         <div class="_attribution">
  <p class="_attribution-p">
    ...<br>
    <a href="https://man7.org/linux/man-pages/man5/pmieconf.5.html" class="_attribution-link">https://man7.org/linux/man-pages/man5/pmieconf.5.html</a>
  </p>
</div>
