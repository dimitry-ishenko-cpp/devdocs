<h1>pmie(1) — Linux manual page</h1>   <pre>
<span class="headline"><i>PMIE</i>(1)                  General Commands Manual                 <i>PMIE</i>(1)</span>
</pre> <h2>
NAME </h2>
<pre>
       <b>pmie </b>- inference engine for performance metrics
</pre> <h2>
SYNOPSIS </h2>
<pre>
       <b>pmie </b>[<b>-bCdeFfPqvVWxXz?</b>]  [<b>-a </b><i>archive</i>] [<b>-A </b><i>align</i>] [<b>-c </b><i>filename</i>]
       [<b>-h </b><i>host</i>] [<b>-l </b><i>logfile</i>] [<b>-m </b><i>note</i>] [<b>-j </b><i>stompfile</i>] [<b>-n </b><i>pmnsfile</i>] [<b>-o</b>
       <i>format</i>] [<b>-O </b><i>offset</i>] [<b>-S </b><i>starttime</i>] [<b>-t </b><i>interval</i>] [<b>-T </b><i>endtime</i>] [<b>-U</b>
       <i>username</i>] [<b>-Z </b><i>timezone</i>] [<i>filename ...</i>]
</pre> <h2>
DESCRIPTION </h2>
<pre>
       <b>pmie </b>accepts a collection of arithmetic, logical, and rule
       expressions to be evaluated at specified frequencies.  The base
       data for the expressions consists of performance metrics values
       delivered in real-time from any host running the Performance
       Metrics Collection Daemon (PMCD), or using historical data from
       Performance Co-Pilot (PCP) archives.

       As well as computing arithmetic and logical values, <b>pmie </b>can
       execute actions (popup alarms, write system log messages, and
       launch programs) in response to specified conditions.  Such
       actions are extremely useful in detecting, monitoring and
       correcting performance related problems.

       The expressions to be evaluated are read from configuration files
       specified by one or more <i>filename</i> arguments.  In the absence of
       any <i>filename</i>, expressions are read from standard input.

       Output from <b>pmie </b>is directed to standard output and standard
       error as follows:

       <b>stdout</b>
            Expression values printed in the verbose <b>-v </b>mode and the
            output of <b>print </b>actions.

       <b>stderr</b>
            Error and warning messages for any syntactic or semantic
            problems during expression parsing, and any semantic or
            performance metrics availability problems during expression
            evaluation.
</pre> <h2>
OPTIONS </h2>
<pre>
       The available command line options are:

       <b>-a </b><i>archive</i>, <b>--archive</b>=<i>archive</i>
            <i>archive</i> which is a comma-separated list of names, each of
            which may be the base name of an archive or the name of a
            directory containing one or more archives written by
            <a href="pmlogger.1.html">pmlogger(1)</a>.  Multiple instances of the <b>-a </b>flag may appear
            on the command line to specify a list of sets of archives.
            In this case, it is required that only one set of archives
            be present for any one host.  Also, any explicit host names
            occurring in a <b>pmie </b>expression must match the host name
            recorded in one of the archive labels.  In the case of
            multiple sets of archives, timestamps recorded in the
            archives are used to ensure temporal consistency.

       <b>-A </b><i>align</i>, <b>--align</b>=<i>align</i>
            Force the initial time window to be aligned on the boundary
            of a natural time unit <i>align</i>.  Refer to <a href="pcpintro.1.html">PCPIntro(1)</a> for a
            complete description of the syntax for <i>align</i>.

       <b>-b</b>, <b>--buffer</b>
            Output will be line buffered and standard output is attached
            to standard error.  This is most useful for background
            execution in conjunction with the <b>-l </b>option.  The <b>-b </b>option
            is always used for <b>pmie </b>instances launched from
            <a href="pmie_check.1.html">pmie_check(1)</a>.

       <b>-c </b><i>config</i>, <b>--config</b>=<i>config</i>
            An alternative to specifying <i>filename</i> at the end of the
            command line.

       <b>-C</b>, <b>--check</b>
            Parse the configuration file(s) and exit before performing
            any evaluations.  Any errors in the configuration file are
            reported.

       <b>-d</b>, <b>--interact</b>
            Normally <b>pmie </b>would be launched as a non-interactive process
            to monitor and manage the performance of one or more hosts.
            Given the <b>-d </b>flag however, execution is interactive and the
            user is presented with a menu of options.  Interactive mode
            is useful mainly for debugging new expressions.

       <b>-e</b>, <b>--timestamp</b>
            When used with <b>-V</b>, <b>-v </b>or <b>-W</b>, this option forces timestamps
            to be reported with each expression.  The timestamps are in
            <a href="../man3/ctime.3.html">ctime(3)</a> format, enclosed in parenthesis and appear after
            the expression name and before the expression value, e.g.
                 expr_1 (Tue Feb  6 19:55:10 2001): 12

       <b>-f</b>, <b>--foreground</b>
            If the <b>-l </b>option is specified and there is no <b>-a </b>option
            (i.e. real-time monitoring) then <b>pmie </b>is run as a daemon in
            the background (in all other cases foreground is the
            default).  The <b>-f </b>(and <b>-F</b>, see below) options force <b>pmie </b>to
            be run in the foreground, independent of any other options.

       <b>-F</b>, <b>--systemd</b>
            Like <b>-f</b>, the <b>-F </b>option runs <b>pmie </b>in the foreground, but also
            does some housekeeping (like create a pid file, change user
            id and notify <a href="systemd.1.html">systemd(1)</a> when <b>pmie </b>has started or is
            shutting down).  This is intended for use when <b>pmie </b>is
            launched from <a href="systemd.1.html">systemd(1)</a> and the daemonising has already
            been done.  The <b>-f </b>and <b>-F </b>options are mutually exclusive.

       <b>-h </b><i>host</i>, <b>--host</b>=<i>host</i>
            By default performance data is fetched from the local host
            (in real-time mode) or the host for the first named set of
            archives on the command line (in archive mode).  The <i>host</i>
            argument overrides this default.  It does not override hosts
            explicitly named in the expressions being evaluated.  The
            <i>host</i> argument is interpreted as a connection specification
            for <i>pmNewContext</i>, and is later mapped to the remote pmcd's
            self-reported host name for reporting purposes.  See also
            the %h vs. %c substitutions in rule action strings below.

       <b>-j </b><i>file</i>
            An alternative STOMP protocol configuration is loaded from
            <i>stompfile</i>.  If this option is not used, and the <i>stomp</i> action
            is used in any rule, the default location
            <i>$PCP_SYSCONF_DIR/pmie/config/stomp</i> will be used.

       <b>-l </b><i>logfile</i>, <b>--logfile</b>=<i>logfile</i>
            Standard error is sent to <i>logfile</i>.

       <b>-m </b><i>note</i>, <b>--note</b>=<i>note</i>
            Used to indicate where <b>pmie </b>has been launched from, e.g.
            <a href="pmie_check.1.html">pmie_check(1)</a> and <a href="pmie_daily.1.html">pmie_daily(1)</a> use <b>-m pmie_check </b>and this
            is used by <b>pmie </b>to determine if it needs to be restarted
            should the PMCD hostname change, as described in the
            HOSTNAME CHANGES section below.

       <b>-n </b><i>pmnsfile</i>, <b>--namespace</b>=<i>pmnsfile</i>
            An alternative Performance Metrics Name Space (PMNS) is
            loaded from the file <i>pmnsfile</i>.

       <b>-o </b><i>format</i>, <b>--format</b>=<i>format</i>
            When precessing performance data from an archive, the <b>-o</b>
            option may be used to specify an alternate output <i>format</i>
            when a rule action is executed.  See the <b>DIFFERENCES IN HOST</b>
            <b>AND ARCHIVE MODES </b>section for a description of how the
            output <i>format</i> may be constructed.

       <b>-O </b><i>origin</i>, <b>--origin</b>=<i>origin</i>
            Specify the <i>origin</i> of the time window.  See <a href="pcpintro.1.html">PCPIntro(1)</a> for
            complete description of this option.

       <b>-P</b>, <b>--primary</b>
            Identifies this as the primary <b>pmie </b>instance for a host.
            See the ``AUTOMATIC RESTART'' section below for further
            details.

       <b>-q</b>, <b>--quiet</b>
            Suppresses diagnostic messages that would be printed to
            standard output by default, especially the "evaluator
            exiting" message as this can confuse scripts.

       <b>-S </b><i>starttime</i>, <b>--start</b>=<i>starttime</i>
            Specify the <i>starttime</i> of the time window.  See <a href="pcpintro.1.html">PCPIntro(1)</a>
            for complete description of this option.

       <b>-t </b><i>interval</i>, <b>--interval</b>=<i>interval</i>
            The <i>interval</i> argument follows the syntax described in
            <a href="pcpintro.1.html">PCPIntro(1)</a>, and in the simplest form may be an unsigned
            integer (the implied units in this case are seconds).  The
            value is used to determine the sample interval for
            expressions that do not explicitly set their sample interval
            using the <b>pmie </b>variable delta described below.  The default
            is 10.0 seconds.

       <b>-T </b><i>endtime</i>, <b>--finish</b>=<i>endtime</i>
            Specify the <i>endtime</i> of the time window.  See <a href="pcpintro.1.html">PCPIntro(1)</a> for
            complete description of this option.

       <b>-U </b><i>username</i>, <b>--username</b>=<i>username</i>
            User account under which to run <b>pmie</b>.  The default is the
            current user account for interactive use.  When run as a
            daemon, the unprivileged "pcp" account is used in current
            versions of PCP, but in older versions the superuser account
            ("root") was used by default.

       <b>-v   </b>Unless one of the verbose options <b>-V</b>, <b>-v </b>or <b>-W </b>appears on
            the command line, expressions are evaluated silently, the
            only output is as a result of any actions being executed.
            In the verbose mode, specified using the <b>-v </b>flag, the value
            of each expression is printed as it is evaluated.  The
            values are in canonical units; bytes in the dimension of
            ``space'', seconds in the dimension of ``time'' and events
            in the dimension of ``count''.  See <a href="../man3/pmlookupdesc.3.html">pmLookupDesc(3)</a> for
            details of the supported dimension and scaling mechanisms
            for performance metrics.  The verbose mode is useful in
            monitoring the value of given expressions, evaluating
            derived performance metrics, passing these values on to
            other tools for further processing and in debugging new
            expressions.

       <b>-V</b>, <b>--verbose</b>
            This option has the same effect as the <b>-v </b>option, except
            that the name of the host and instance (if applicable) are
            printed as well as expression values.

       <b>-W   </b>This option has the same effect as the <b>-V </b>option described
            above, except that for boolean expressions, only those names
            and values that make the expression true are printed.  These
            are the same names and values accessible to rule actions as
            the %h, %i, %c and %v bindings, as described below.

       <b>-x</b>, <b>--secret-agent</b>
            Execute in domain agent mode.  This mode is used within the
            Performance Co-Pilot product to derive values for summary
            metrics, see <a href="pmdasummary.1.html">pmdasummary(1)</a>.  Only restricted functionality
            is available in this mode (expressions with actions may <b>not</b>
            be used).

       <b>-X</b>, <b>--secret-applet</b>
            Run in secret applet mode (thin client).

       <b>-z</b>, <b>--hostzone</b>
            Change the reporting timezone to the timezone of the host
            that is the source of the performance metrics, as identified
            via either the <b>-h </b>option or the first named set of archives
            (as described above for the <b>-a </b>option).

       <b>-Z </b><i>timezone</i>, <b>--timezone</b>=<i>timezone</i>
            Change the reporting timezone to <i>timezone</i> in the format of
            the environment variable <b>TZ </b>as described in <a href="../man7/environ.7.html">environ(7)</a>.

       <b>-?</b>, <b>--help</b>
            Display usage message and exit.
</pre> <h2>
EXAMPLES </h2>
<pre>
       The following example expressions demonstrate some of the
       capabilities of the inference engine.

       The directory <i>$PCP_DEMOS_DIR/pmie</i> contains a number of other
       annotated examples of <b>pmie </b>expressions.

       The variable delta controls expression evaluation frequency.
       Specify that subsequent expressions be evaluated once a second,
       until further notice:

            delta = 1 sec;

       If the total context switch rate exceeds 10000 per second per
       CPU, then display an alarm notifier:

            kernel.all.pswitch / hinv.ncpu &gt; 10000 count/sec
            -&gt; alarm "high context switch rate %v";

       If the high context switch rate is sustained for 10 consecutive
       samples, then launch <a href="top.1.html">top(1)</a> in an <b>xterm</b>(1) window to monitor
       processes, but do this at most once every 5 minutes:

            all_sample (
                kernel.all.pswitch @0..9 &gt; 10 Kcount/sec * hinv.ncpu
            ) -&gt; shell 5 min "xterm -e 'top'";

       The following rules are evaluated once every 20 seconds:

            delta = 20 sec;

       If any disk is performing more than 60 I/Os per second, then
       print a message identifying the busy disk to standard output and
       launch <b>dkvis</b>(1):

            some_inst (
                disk.dev.total &gt; 60 count/sec
            ) -&gt; print "busy disks:" " %i" &amp;
                 shell 5 min "dkvis";

       Refine the preceding rule to apply only between the hours of 9am
       and 5pm, and to require 3 of 4 consecutive samples to exceed the
       threshold before executing the action:

            $hour &gt;= 9 &amp;&amp; $hour &lt;= 17 &amp;&amp;
            some_inst (
              75 %_sample (
                disk.dev.total @0..3 &gt; 60 count/sec
              )
            ) -&gt; print "disks busy for 20 sec:" " [%h]%i";

       The following two rules are evaluated once every 10 minutes:

            delta = 10 min;

       If either the / or the /usr filesystem is more than 95% full,
       display an alarm popup, but not if it has already been displayed
       during the last 4 hours:

            filesys.free #'/dev/root' /
                filesys.capacity #'/dev/root' &lt; 0.05
            -&gt; alarm 4 hour "root filesystem (almost) full";

            filesys.free #'/dev/usr' /
                filesys.capacity #'/dev/usr' &lt; 0.05
            -&gt; alarm 4 hour "/usr filesystem (almost) full";

       The following rule requires a machine that supports the lmsensors
       metrics.  If the machine environment temperature rises more than
       2 degrees over a 10 minute interval, write an entry in the system
       log:

            lmsensors.coretemp_isa.temp1 @0 - lmsensors.coretemp_isa.temp1 @1 &gt; 2
            -&gt; alarm "temperature rising fast" &amp;
               syslog "machine room temperature rise alarm";

       And something interesting if you have performance problems with
       your Oracle database:

            // back to 30sec evaluations
            delta = 30 sec;
            sid = "ptg1";       # $ORACLE_SID setting
            lid = "223";        # latch ID from v$latch
            lru = "#'$sid/$lid cache buffers lru chain'";
            host = ":moomba.melbourne.sgi.com";
            gets = "oracle.latch.gets $host $lru";
            total = "oracle.latch.gets $host $lru +
                     oracle.latch.misses $host $lru +
                     oracle.latch.immisses $host $lru";

            $total &gt; 100 &amp;&amp; $gets / $total &lt; 0.2
            -&gt; alarm "high lru latch contention in database $sid";

       The following <b>ruleset </b>will emit exactly one message depending on
       the availability and value of the 1-minute load average.

            delta = 1 minute;
            ruleset
                 kernel.all.load #'1 minute' &gt; 10 * hinv.ncpu -&gt;
                     print "extreme load average %v"
            else kernel.all.load #'1 minute' &gt; 2 * hinv.ncpu -&gt;
                     print "moderate load average %v"
            unknown -&gt;
                     print "load average unavailable"
            otherwise -&gt;
                     print "load average OK"
            ;

       The following rule will emit a message when some filesystem is
       more than 75% full and is filling at a rate that if sustained
       would fill the filesystem to 100% in less than 30 minutes.

            some_inst (
                100 * filesys.used / filesys.capacity &gt; 75 &amp;&amp;
                filesys.used + 30min * (rate filesys.used) &gt; filesys.capacity
            ) -&gt; print "filesystem will be full within 30 mins:" " %i";

       If the metric mypmda.errors counts errors then the following rule
       will emit a message if the rate of errors exceeds 1 per second
       provided the error count is less than 100.

            mypmda.errors &gt; 1 &amp;&amp; instant mypmda.errors &lt; 100
            -&gt; print "high error rate: %v";
</pre> <h2>
QUICK START </h2>
<pre>
       The <b>pmie </b>specification language is powerful and large.

       To expedite rapid development of <b>pmie </b>rules, the <a href="pmieconf.1.html">pmieconf(1)</a> tool
       provides a facility for generating a <b>pmie </b>configuration file from
       a set of generalized <b>pmie </b>rules.  The supplied set of rules
       covers a wide range of performance scenarios.

       The <i>Performance Co-Pilot User's and Administrator's Guide</i>
       provides a detailed tutorial-style chapter covering <b>pmie</b>.
</pre> <h2>
EXPRESSION SYNTAX </h2>
<pre>
       This description is terse and informal.  For a more comprehensive
       description see the <i>Performance Co-Pilot User's and</i>
       <i>Administrator's Guide</i>.

       A <b>pmie </b>specification is a sequence of semicolon terminated
       expressions.

       Basic operators are modeled on the arithmetic, relational and
       Boolean operators of the C programming language.  Precedence
       rules are as expected, although the use of parentheses is
       encouraged to enhance readability and remove ambiguity.

       Operands are performance metric names (see <a href="../man5/pmns.5.html">PMNS(5)</a>) and the
       normal literal constants.

       Operands involving performance metrics may produce sets of
       values, as a result of enumeration in the dimensions of <b>hosts</b>,
       <b>instances </b>and <b>time</b>.  Special qualifiers may appear after a
       performance metric name to define the enumeration in each
       dimension.  For example,

           kernel.percpu.cpu.user :foo :bar #cpu0 @0..2

       defines 6 values corresponding to the time spent executing in
       user mode on CPU 0 on the hosts ``foo'' and ``bar'' over the last
       3 consecutive samples.  The default interpretation in the absence
       of <b>: </b>(host), <b># </b>(instance) and <b>@ </b>(time) qualifiers is all
       instances at the most recent sample time for the default source
       of PCP performance metrics.

       Host and instance names that do not follow the rules for
       variables in programming languages, i.e. alphabetic optionally
       followed by alphanumerics, should be enclosed in single quotes.

       Expression evaluation follows the law of ``least surprises''.
       Where performance metrics have the semantics of a counter, <b>pmie</b>
       will automatically convert to a rate based upon consecutive
       samples and the time interval between these samples.  All numeric
       expressions are evaluated in double precision, and where
       appropriate, automatically scaled into canonical units of
       ``bytes'', ``seconds'' and ``counts''.

       A <b>rule </b>is a special form of expression that specifies a condition
       or logical expression, a special operator (<b>-&gt;</b>) and actions to be
       performed when the condition is found to be true.

       The following table summarizes the basic <b>pmie </b>operators:

     ┌─────────────────┬────────────────────────────────────────────────┐
     │    Operators    │                  Explanation                   │
     ├─────────────────┼────────────────────────────────────────────────┤
     │ + - * /         │ Arithmetic                                     │
     │ &lt; &lt;= == &gt;= &gt; != │ Relational (value comparison)                  │
     │ ! &amp;&amp; ||         │ Boolean                                        │
     │ -&gt;              │ Rule                                           │
     │ <b>rising          </b>│ Boolean, false to true transition              │
     │ <b>falling         </b>│ Boolean, true to false transition              │
     │ <b>rate            </b>│ Explicit rate conversion (rarely required)     │
     │ <b>instant         </b>│ No automatic rate conversion (rarely required) │
     └─────────────────┴────────────────────────────────────────────────┘

       All operators are supported for numeric-valued operands and
       expressions.  For string-valued operands, namely literal string
       constants enclosed in double quotes or metrics with a data type
       of string (<b>PM_TYPE_STRING</b>), <b>only </b>the operators <b>== </b>and <b>!= </b>are
       supported.

       The <b>rate </b>and <b>instant </b>operators are the logical inverse of one
       another, so an arithmetic expression <i>expr</i> is equal to <b>rate</b>
       <b>instant </b><i>expr</i>.  The more useful cases involve using <b>rate </b>with a
       metric that is not a counter to determine the rate of change over
       time or <b>instant </b>with a metric that is a counter to determine if
       the current value is above or below some threshold.

       Aggregate operators may be used to aggregate or summarize along
       one dimension of a set-valued expression.  The following
       aggregate operators map from a logical expression to a logical
       expression of lower dimension.

     ┌──────────────────────────┬─────────────┬──────────────────────────┐
     │        Operators         │    Type     │       Explanation        │
     ├──────────────────────────┼─────────────┼──────────────────────────┤
     │ <b>some_inst                </b>│ Existential │ True if at least one set │
     │ <b>some_host                </b>│             │ member is true in the    │
     │ <b>some_sample              </b>│             │ associated dimension     │
     ├──────────────────────────┼─────────────┼──────────────────────────┤
     │ <b>all_inst                 </b>│ Universal   │ True if all set members  │
     │ <b>all_host                 </b>│             │ are true in the          │
     │ <b>all_sample               </b>│             │ associated dimension     │
     ├──────────────────────────┼─────────────┼──────────────────────────┤
     │ <i>N</i><b>%_inst                  </b>│ Percentile  │ True if at least <i>N</i>       │
     │ <i>N</i><b>%_host                  </b>│             │ percent of set members   │
     │ <i>N</i><b>%_sample                </b>│             │ are true in the          │
     │                          │             │ associated dimension     │
     └──────────────────────────┴─────────────┴──────────────────────────┘

       The following instantial operators may be used to filter or limit
       a set-valued logical expression, based on regular expression
       matching of instance names.  The logical expression must be a set
       involving the dimension of instances, and the regular expression
       is of the form used by <b>egrep</b>(1) or the Extended Regular
       Expressions of <a href="../man3/regcomp.3.html">regcomp(3)</a>.

         ┌──────────────┬──────────────────────────────────────────┐
         │  Operators   │               Explanation                │
         ├──────────────┼──────────────────────────────────────────┤
         │ <b>match_inst   </b>│ For each value of the logical expression │
         │              │ that is ``true'', the result is ``true'' │
         │              │ if the associated instance name matches  │
         │              │ the regular expression.  Otherwise the   │
         │              │ result is ``false''.                     │
         ├──────────────┼──────────────────────────────────────────┤
         │ <b>nomatch_inst </b>│ For each value of the logical expression │
         │              │ that is ``true'', the result is ``true'' │
         │              │ if the associated instance name does <b>not </b>│
         │              │ match the regular expression.  Otherwise │
         │              │ the result is ``false''.                 │
         └──────────────┴──────────────────────────────────────────┘

       For example, the expression below will be ``true'' for disks
       attached to controllers 2 or 3 performing more than 20 operations
       per second:
            match_inst "^dks[23]d" disk.dev.total &gt; 20;

       The following aggregate operators map from an arithmetic
       expression to an arithmetic expression of lower dimension.

      ┌──────────────────────────┬───────────┬──────────────────────────┐
      │        Operators         │   Type    │       Explanation        │
      ├──────────────────────────┼───────────┼──────────────────────────┤
      │ <b>min_inst                 </b>│ Extrema   │ Minimum value across all │
      │ <b>min_host                 </b>│           │ set members in the       │
      │ <b>min_sample               </b>│           │ associated dimension     │
      ├──────────────────────────┼───────────┼──────────────────────────┤
      │ <b>max_inst                 </b>│ Extrema   │ Maximum value across all │
      │ <b>max_host                 </b>│           │ set members in the       │
      │ <b>max_sample               </b>│           │ associated dimension     │
      ├──────────────────────────┼───────────┼──────────────────────────┤
      │ <b>sum_inst                 </b>│ Aggregate │ Sum of values across all │
      │ <b>sum_host                 </b>│           │ set members in the       │
      │ <b>sum_sample               </b>│           │ associated dimension     │
      ├──────────────────────────┼───────────┼──────────────────────────┤
      │ <b>avg_inst                 </b>│ Aggregate │ Average value across all │
      │ <b>avg_host                 </b>│           │ set members in the       │
      │ <b>avg_sample               </b>│           │ associated dimension     │
      └──────────────────────────┴───────────┴──────────────────────────┘

       The aggregate operators count_inst, count_host and count_sample
       map from a logical expression to an arithmetic expression of
       lower dimension by counting the number of set members for which
       the expression is true in the associated dimension.

       For action rules, the following actions are defined:
            ┌───────────┬────────────────────────────────────────┐
            │ Operators │              Explanation               │
            ├───────────┼────────────────────────────────────────┤
            │ <b>alarm     </b>│ Raise a visible alarm with <b>xconfirm</b>(1) │
            │ <b>print     </b>│ Display on standard output             │
            │ <b>shell     </b>│ Execute with <b>sh</b>(1)                     │
            │ <b>stomp     </b>│ Send a STOMP message to a JMS server   │
            │ <b>syslog    </b>│ Append a message to system log file    │
            └───────────┴────────────────────────────────────────┘

       Multiple actions may be separated by the &amp; and | operators to
       specify respectively sequential execution (both actions are
       executed) and alternate execution (the second action will only be
       executed if the execution of the first action returns a non-zero
       error status.

       Arguments to actions are an optional suppression time, and then
       one or more expressions (a string is an expression in this
       context).  Strings appearing as arguments to an action may
       include the following special selectors that will be replaced at
       the time the action is executed.

       <b>%h  </b>Host name(s) that make the left-most top-level expression in
           the condition true.

       <b>%c  </b>Connection specification string(s) or files for a PCP tool to
           reach the hosts or archives that make the left-most top-level
           expression in the condition true.

       <b>%i  </b>Instance(s) that make the left-most top-level expression in
           the condition true.

       <b>%v  </b>One value from the left-most top-level expression in the
           condition for each host and instance pair that makes the
           condition true.

       Note that expansion of the special selectors is done by repeating
       the whole argument once for each unique binding to any of the
       qualifying special selectors.  For example if a rule were true
       for the host <b>mumble </b>with instances <b>grunt </b>and <b>snort</b>, and for host
       <b>fumble </b>the instance <b>puff </b>makes the rule true, then the action
            ...
            -&gt; shell myscript "Warning: %h:%i busy ";
       will execute <b>myscript </b>with the argument string "Warning:
       mumble:grunt busy Warning: mumble:snort busy Warning: fumble:puff
       busy".

       By comparison, if the action
            ...
            -&gt; shell myscript "Warning! busy:" " %h:%i";
       were executed under the same circumstances, then <b>myscript </b>would
       be executed with the argument string "Warning! busy: mumble:grunt
       mumble:snort fumble:puff".

       The semantics of the expansion of the special selectors leads to
       a common usage pattern in an action, where one argument is a
       constant (contains no special selectors) the second argument
       contains the desired special selectors with minimal separator
       characters, and an optional third argument provides a constant
       postscript (e.g. to terminate any argument quoting from the first
       argument).  If necessary post-processing (e.g. in <b>myscript</b>) can
       provide the necessary enumeration over each unique expansion of
       the string containing just the special selectors.

       For complex conditions, the bindings to these selectors is not
       obvious.  It is strongly recommended that <b>pmie </b>be used in the
       debugging mode (specify the <b>-W </b>command line option in particular)
       during rule development.
</pre> <h2>
BOOLEAN EXPRESSIONS </h2>
<pre>
       <b>pmie </b>expressions that have the semantics of a Boolean, e.g.
       foo.bar &gt; 10 or <b>some_inst </b>( my.table &lt; 0 ) are assigned the
       values <b>true </b>or <b>false </b>or <b>unknown</b>.  A value is <b>unknown </b>if one or
       more of the underlying metric values is unavailable, e.g.
       <a href="pmcd.1.html">pmcd(1)</a> on the host cannot be contacted, the metric is not in the
       PCP archive, no values are currently available, insufficient
       values have been fetched to allow a rate converted value to be
       computed or insufficient values have been fetched to instantiate
       the required number of samples in the temporal domain.

       Boolean operators follow the normal rules of Kleene logic (aka
       3-valued logic) when combining values that include <b>unknown</b>:
                 ┌─────────────┬───────────────────────────┐
                 │             │             B             │
                 │   A <b>and </b>B   ├─────────┬───────┬─────────┤
                 │             │  <b>true   </b>│ <b>false </b>│ <b>unknown </b>│
                 ├───┬─────────┼─────────┼───────┼─────────┤
                 │   │  <b>true   </b>│  <b>true   </b>│ <b>false </b>│ <b>unknown </b>│
                 │   ├─────────┼─────────┼───────┼─────────┤
                 │ A │  <b>false  </b>│  <b>false  </b>│ <b>false </b>│  <b>false  </b>│
                 │   ├─────────┼─────────┼───────┼─────────┤
                 │   │ <b>unknown </b>│ <b>unknown </b>│ <b>false </b>│ <b>unknown </b>│
                 └───┴─────────┴─────────┴───────┴─────────┘
                  ┌─────────────┬──────────────────────────┐
                  │             │            B             │
                  │   A <b>or </b>B    ├──────┬─────────┬─────────┤
                  │             │ <b>true </b>│  <b>false  </b>│ <b>unknown </b>│
                  ├───┬─────────┼──────┼─────────┼─────────┤
                  │   │  <b>true   </b>│ <b>true </b>│  <b>true   </b>│  <b>true   </b>│
                  │   ├─────────┼──────┼─────────┼─────────┤
                  │ A │  <b>false  </b>│ <b>true </b>│  <b>false  </b>│ <b>unknown </b>│
                  │   ├─────────┼──────┼─────────┼─────────┤
                  │   │ <b>unknown </b>│ <b>true </b>│ <b>unknown </b>│ <b>unknown </b>│
                  └───┴─────────┴──────┴─────────┴─────────┘
                            ┌─────────┬─────────┐
                            │    A    │  <b>not </b>A  │
                            ├─────────┼─────────┤
                            │  <b>true   </b>│  <b>false  </b>│
                            ├─────────┼─────────┤
                            │  <b>false  </b>│  <b>true   </b>│
                            ├─────────┼─────────┤
                            │ <b>unknown </b>│ <b>unknown </b>│
                            └─────────┴─────────┘
</pre> <h2>
RULESETS </h2>
<pre>
       The <b>ruleset </b>clause is used to define a set of rules and actions
       that are evaluated in order until some action is executed, at
       which point the remaining rules and actions are skipped until the
       <b>ruleset </b>is again scheduled for evaluation.  The keyword <b>else </b>is
       used to separate rules.  After one or more regular rules (with a
       predicate and an action), a <b>ruleset </b>may include an optional
            <b>unknown </b>-&gt; action
       clause, optionally followed by a
            <b>otherwise </b>-&gt; action
       clause.

       If all of the predicates in the rules evaluate to <b>unknown </b>and an
       <b>unknown </b>clause has been specified then action associated with the
       <b>unknown </b>clause will be executed.

       If no rule predicate is <b>true </b>and the <b>unknown </b>action is either not
       specified or not executed and an <b>otherwise </b>clause has been
       specified, then the action associated with the <b>otherwise </b>clause
       will be executed.
</pre> <h2>
SCALE FACTORS </h2>
<pre>
       Scale factors may be appended to arithmetic expressions and force
       linear scaling of the value to canonical units.  Simple scale
       factors are constructed from the keywords: <b>nanosecond</b>, <b>nanosec</b>,
       <b>nsec</b>, <b>microsecond</b>, <b>microsec</b>, <b>usec</b>, <b>millisecond</b>, <b>millisec</b>, <b>msec</b>,
       <b>second</b>, <b>sec</b>, <b>minute</b>, <b>min</b>, <b>hour</b>, <b>byte</b>, <b>Kbyte</b>, <b>Mbyte</b>, <b>Gbyte</b>, <b>Tbyte</b>,
       <b>count</b>, <b>Kcount </b>and <b>Mcount</b>, and the operator /, for example
       ``<b>Kbytes / hour</b>''.
</pre> <h2>
MACROS </h2>
<pre>
       Macros are defined using expressions of the form:

            <i>name</i> = <i>constexpr</i>;

       Where <i>name</i> follows the normal rules for variables in programming
       languages, i.e. alphabetic optionally followed by alphanumerics.
       <i>constexpr</i> must be a constant expression, either a string
       (enclosed in double quotes) or an arithmetic expression
       optionally followed by a scale factor.

       Macros are expanded when their name, prefixed by a dollar ($)
       appears in an expression, and macros may be nested within a
       <i>constexpr</i> string.

       The following reserved macro names are understood.

       <b>minute </b>Current minute of the hour.

       <b>hour   </b>Current hour of the day, in the range 0 to 23.

       <b>day    </b>Current day of the month, in the range 1 to 31.

       <b>month  </b>Current month of the year, in the range 0 (January) to 11
              (December).

       <b>year   </b>Current year.

       <b>day_of_week</b>
              Current day of the week, in the range 0 (Sunday) to 6
              (Saturday).

       <b>delta  </b>Sample interval in effect for this expression.

       Dates and times are presented in the reporting time zone (see
       description of <b>-Z </b>and <b>-z </b>command line options above).
</pre> <h2>
AUTOMATIC RESTART </h2>
<pre>
       It is often useful for <b>pmie </b>processes to be started and stopped
       when the local host is booted or shutdown, or when they have been
       detected as no longer running (when they have unexpectedly exited
       for some reason).  Refer to <a href="pmie_check.1.html">pmie_check(1)</a> for details on
       automating this process.

       Optionally, each system running <a href="pmcd.1.html">pmcd(1)</a> may also be configured to
       run a ``primary'' <b>pmie </b>instance.  This <b>pmie </b>instance is launched
       by <b>$PCP_RC_DIR/pmie</b>, and is affected by the files
       <i>$PCP_SYSCONF_DIR/pmie/control</i>, <i>$PCP_SYSCONF_DIR/pmie/control</i>.d
       (use <b>chkconfig</b>(8), <a href="systemctl.1.html">systemctl(1)</a> or similar platform-specific
       commands to activate or disable the primary <b>pmie </b>instance) and
       <i>$PCP_VAR_DIR/config/pmie/config.default</i> (the default initial
       configuration file for the primary <b>pmie</b>).

       The primary <b>pmie </b>instance is identified by the <b>-P </b>option.  There
       may be at most one ``primary'' <b>pmie </b>instance on each system.  The
       primary <b>pmie </b>instance (if any) must be running on the same host
       as the <a href="pmcd.1.html">pmcd(1)</a> to which it connects (if any), so the <b>-h </b>and <b>-P</b>
       options are mutually exclusive.
</pre> <h2>
EVENT MONITORING </h2>
<pre>
       It is common for production systems to be monitored in a central
       location.  Traditionally on UNIX systems this has been performed
       by the system log facilities - see <a href="logger.1.html">logger(1)</a>, and <b>syslogd</b>(1).  On
       Windows, communication with the system event log is handled by
       <b>pcp-eventlog</b>(1).

       <b>pmie </b>fits into this model when rules use the <i>syslog</i> action.  Note
       that if the action string begins with -p (priority) and/or -t
       (tag) then these are extracted from the string and treated in the
       same way as in <a href="logger.1.html">logger(1)</a> and <b>pcp-eventlog</b>(1).

       However, it is common to have other event monitoring frameworks
       also, into which you may wish to incorporate performance events
       from <b>pmie</b>.  You can often use the <i>shell</i> action to send events to
       these frameworks, as they usually provide their a program for
       injecting events into the framework from external sources.

       A final option is use of the <i>stomp</i> (Streaming Text Oriented
       Messaging Protocol) action, which allows <b>pmie </b>to connect to a
       central JMS (Java Messaging System) server and send events to the
       PMIE topic.  Tools can be written to extract these text messages
       and present them to operations people (via desktop popup windows,
       etc).  Use of the <i>stomp</i> action requires a stomp configuration
       file to be setup, which specifies the location of the JMS server
       host, port number, and username/password.

       The format of this file is as follows:

            host=messages.sgi.com   # this is the JMS server (required)
            port=61616              # and its listening here (required)
            timeout=2               # seconds to wait for server (optional)
            username=joe            # (required)
            password=j03ST0MP       # (required)
            topic=PMIE              # JMS topic for pmie messages (optional)

       The timeout value specifies the time (in seconds) that <b>pmie</b>
       should wait for acknowledgements from the JMS server after
       sending a message (as required by the STOMP protocol).  Note that
       on startup, <b>pmie </b>will wait indefinitely for a connection, and
       will not begin rule evaluation until that initial connection has
       been established.  Should the connection to the JMS server be
       lost at any time while <b>pmie </b>is running, <b>pmie </b>will attempt to
       reconnect on each subsequent truthful evaluation of a rule with a
       <i>stomp</i> action, but not more than once per minute.  This is to
       avoid contributing to network congestion.  In this situation,
       where the STOMP connection to the JMS server has been severed,
       the <i>stomp</i> action will return a non-zero error value.
</pre> <h2>
DIFFERENCES IN HOST AND ARCHIVE MODES </h2>
<pre>
       When running in host mode, the <b>delta </b>interval for each rule
       determines a real-time delay between rule evaluation, so <b>pmie</b>
       spends most if its time sleeping and waiting for the next
       scheduled rule evaluation.

       When running in archive mode, <b>pmie </b>uses the <b>delta </b>interval for
       each rule to determine how frequently the rules are evaluated
       against the archive data, but unlike host mode there are no real-
       time delays as the archive is ``replayed'' as fast as possible.

       In archive mode when a rule predicate evaluates <b>true </b>then the
       action is modified, so that rather than posting to <i>syslog</i> or
       raising a visible <i>alarm</i> or running a <i>shell</i> command or sending a
       <i>stomp</i> message, <b>pmie </b>prints the name of the action, the timestamp
       from the archive when the rule predicate triggering the action
       was <b>true </b>and all of the arguments that would have been passed to
       the real action in host mode.

       For example, given the rule:
            delta = 10 sec;
            kernel.all.nprocs &gt; 10 * hinv.ncpu -&gt; print "lotsaprocs:" "
            %v";
       when run against an archive, the output appears as:
            print Mon Sep  4 00:10:21 2017: lotsaprocs: 1292
            print Mon Sep  4 00:10:31 2017: lotsaprocs: 1294
            print Mon Sep  4 00:10:41 2017: lotsaprocs: 1291
            ...

       The rationale is that the context in which the action would have
       been executed (in host mode) was at a time in the past and the
       possibly on a different host (if the archive was collected from
       one host, but <b>pmie </b>is being run on a different host).  So
       flooding <i>syslog</i> with misleading messages or an avalanche visual
       alarms or a lot of STOMP messages or a shell command that might
       not even work on the host where <b>pmie </b>is being run, are all
       examples of ``badness'' to be avoided.  Rather the output is text
       in a regular format suitable for post-processing with a range of
       filters and performance analysis tools.

       The output format can be changed using the <b>-o </b>option which
       consists of literal characters with the following embedded
       ``meta-field'' tokens:

       <b>%a  </b>The name of the action, e.g.  <b>print</b>, <b>syslog</b>, etc.

       <b>%d  </b>The date and time in <a href="../man3/ctime.3.html">ctime(3)</a> format when the action would
           have been executed.

       <b>%f  </b>The name of the configuration file containing the action
           being executed, else <b>&lt;stdin&gt; </b>if the rules were read from
           standard input.

       <b>%l  </b>The (approximate) line number in the configuration file for
           the action being executed.

       <b>%m  </b>The message component of the action.

       <b>%u  </b>The date and time when the action would have been executed in
           extended <a href="../man3/ctime.3.html">ctime(3)</a> format with microsecond precision for the
           time.

       <b>%%  </b>A literal percent character.

       The default output format is equivalent to a <i>format</i> of <b>%a %d: %m</b>.
</pre> <h2>
SIGNALS </h2>
<pre>
       If <b>pmie </b>is sent a SIGHUP signal, the <i>logfile</i> will be closed,
       unlinked and re-opened.  This is used by <a href="pmie_daily.1.html">pmie_daily(1)</a> to achieve
       nightly log rotation.

       Most of the time <b>pmie </b>is sleeping, waiting until the next set of
       rules needs to be evaluated.  Sending <b>pmie </b>a SIGUSR1 signal will
       cause the details for the next set of rules to be dumped on
       <i>logfile</i>, including how long the current sleep is and how much
       time remains.  The scheduling of rules is not changed by this
       action.
</pre> <h2>
HOSTNAME CHANGES </h2>
<pre>
       The hostname of the PMCD that is providing metrics to <b>pmie </b>is
       used in several ways.

       PMCD's hostname is user internally to provide a value for the %h
       substitutions in rule action strings.

       For <b>pmie </b>instances using a local PMCD that are launched and
       managed by <a href="pmie_check.1.html">pmie_check(1)</a> and <a href="pmie_daily.1.html">pmie_daily(1)</a>, (or the <a href="systemd.1.html">systemd(1)</a> or
       <a href="../man8/cron.8.html">cron(8)</a> services that use these scripts), the local hostname may
       also be used to construct the name of a directory where the <b>pmie</b>
       logs for one host are stored, e.g. <b>$PCP_LOG_DIR/pmie/</b><i>&lt;hostname&gt;</i>.

       The hostname of the PMCD host may change during boot time when
       the system transitions from a temporary hostname to a persistent
       hostname, or by explicit administrative action anytime after the
       system has been booted.  When this happens, <b>pmie </b>may need to take
       special action, specifically if the <b>pmie </b>instance was launched
       from <a href="pmie_check.1.html">pmie_check(1)</a> or <a href="pmie_daily.1.html">pmie_daily(1)</a>, then <b>pmie </b>must exit.  Under
       normal circumstances <a href="systemd.1.html">systemd(1)</a> or <a href="../man8/cron.8.html">cron(8)</a> will launch a new <b>pmie</b>
       shortly thereafter, and this new <b>pmie </b>instance will be operating
       in the context of the new hostname for the host where PMCD is
       running.
</pre> <h2>
BUGS </h2>
<pre>
       The lexical scanner and parser will attempt to recover after an
       error in the input expressions.  Parsing resumes after skipping
       input up to the next semi-colon (;), however during this skipping
       process the scanner is ignorant of comments and strings, so an
       embedded semi-colon may cause parsing to resume at an unexpected
       place.  This behavior is largely benign, as until the initial
       syntax error is corrected, <b>pmie </b>will not attempt any expression
       evaluation.
</pre> <h2>
FILES </h2>
<pre>
       <i>$PCP_DEMOS_DIR/pmie/*</i>
            annotated example rules

       <i>$PCP_VAR_DIR/pmns/*</i>
            default PMNS specification files

       <i>$PCP_TMP_DIR/pmie</i>
            <b>pmie </b>maintains files in this directory to identify the
            running <b>pmie </b>instances and to export runtime information
            about each instance - this data forms the basis of the
            pmcd.pmie performance metrics

       <i>$PCP_PMIECONTROL_PATH</i>
            the default set of <b>pmie </b>instances to start at boot time -
            refer to <a href="pmie_check.1.html">pmie_check(1)</a> for details
</pre> <h2>
PCP ENVIRONMENT </h2>
<pre>
       Environment variables with the prefix <b>PCP_ </b>are used to
       parameterize the file and directory names used by PCP.  On each
       installation, the file <i>/etc/pcp.conf</i> contains the local values
       for these variables.  The <b>$PCP_CONF </b>variable may be used to
       specify an alternative configuration file, as described in
       <a href="../man5/pcp.conf.5.html">pcp.conf(5)</a>.

       When executing shell actions, <b>pmie </b>overrides two variables - IFS
       and PATH - in the environment of the child process.  IFS is set
       to "\t\n".  The PATH is set to a combination of a default path
       for all platforms ("/usr/sbin:/sbin:/usr/bin:/bin") and several
       configurable components.  These are (in this order):
       <b>$PCP_BIN_DIR</b>, <b>$PCP_BINADM_DIR </b>and <b>$PCP_PLATFORM_PATHS</b>.

       When executing popup alarm actions, <b>pmie </b>will use the value of
       <b>$PCP_XCONFIRM_PROG </b>as the visual notification program to run.
       This is typically set to <a href="pmconfirm.1.html">pmconfirm(1)</a>, a cross-platform dialog
       box.
</pre> <h2>
UNIX SEE ALSO </h2>
<pre>
       <a href="logger.1.html">logger(1)</a>.
</pre> <h2>
WINDOWS SEE ALSO </h2>
<pre>
       <b>pcp-eventlog</b>(1).
</pre> <h2>
SEE ALSO </h2>
<pre>
       <a href="pcpintro.1.html">PCPIntro(1)</a>, <a href="pmcd.1.html">pmcd(1)</a>, <a href="pmconfirm.1.html">pmconfirm(1)</a>, <a href="pmie_check.1.html">pmie_check(1)</a>, <a href="pmieconf.1.html">pmieconf(1)</a>,
       <a href="pmie_daily.1.html">pmie_daily(1)</a>, <a href="pminfo.1.html">pminfo(1)</a>, <a href="pmlogdump.1.html">pmlogdump(1)</a>, <a href="pmlogger.1.html">pmlogger(1)</a>, <a href="pmval.1.html">pmval(1)</a>,
       <a href="systemd.1.html">systemd(1)</a>, <a href="../man3/ctime.3.html">ctime(3)</a>, <a href="../man3/pmapi.3.html">PMAPI(3)</a>, <a href="../man5/pcp.conf.5.html">pcp.conf(5)</a>, <a href="../man5/pcp.env.5.html">pcp.env(5)</a> and
       <a href="../man5/pmns.5.html">PMNS(5)</a>.
</pre> <h2>
USER GUIDE </h2>
<pre>
       For a more complete description of the <b>pmie </b>language, refer to
       the <b>Performance Co-Pilot Users and Administrators Guide</b>.  This is
       available online from:
           <b><a href="https://pcp.readthedocs.io/en/latest/UAG/PerformanceMetricsInferenceEngine.html">https://pcp.readthedocs.io/en/latest/UAG/PerformanceMetricsInferenceEngine.html</a> </b>
</pre> <h2>
COLOPHON </h2>
<pre>
       This page is part of the <i>PCP</i> (Performance Co-Pilot) project.
       Information about the project can be found at 
       ⟨<a href="http://www.pcp.io/">http://www.pcp.io/</a>⟩.  If you have a bug report for this manual
       page, send it to pcp@groups.io.  This page was obtained from the
       project's upstream Git repository
       ⟨<a href="https://github.com/performancecopilot/pcp.git">https://github.com/performancecopilot/pcp.git</a>⟩ on 2024-06-14.
       (At that time, the date of the most recent commit that was found
       in the repository was 2024-06-14.)  If you discover any rendering
       problems in this HTML version of the page, or you believe there
       is a better or more up-to-date source for the page, or you have
       corrections or improvements to the information in this COLOPHON
       (which is <i>not</i> part of the original manual page), send a mail to
       man-pages@man7.org

<span class="footline">Performance Co-Pilot               PCP                           <i>PMIE</i>(1)</span>
</pre>  <p>Pages that refer to this page: <a href="autofsd-probe.1.html">autofsd-probe(1)</a>, <a href="ganglia2pcp.1.html">ganglia2pcp(1)</a>, <a href="iostat2pcp.1.html">iostat2pcp(1)</a>, <a href="mrtg2pcp.1.html">mrtg2pcp(1)</a>, <a href="pcp.1.html">pcp(1)</a>, <a href="pcpcompat.1.html">pcpcompat(1)</a>, <a href="pcpintro.1.html">pcpintro(1)</a>, <a href="pmdamysql.1.html">pmdamysql(1)</a>, <a href="pmdasummary.1.html">pmdasummary(1)</a>, <a href="pmfind.1.html">pmfind(1)</a>, <a href="pmfind_check.1.html">pmfind_check(1)</a>, <a href="pmie2col.1.html">pmie2col(1)</a>, <a href="pmie_check.1.html">pmie_check(1)</a>, <a href="pmieconf.1.html">pmieconf(1)</a>, <a href="pmie_dump_stats.1.html">pmie_dump_stats(1)</a>, <a href="pmiestatus.1.html">pmiestatus(1)</a>, <a href="pmlogger_check.1.html">pmlogger_check(1)</a>, <a href="pmlogger_daily.1.html">pmlogger_daily(1)</a>, <a href="pmpost.1.html">pmpost(1)</a>, <a href="sar2pcp.1.html">sar2pcp(1)</a>, <a href="sheet2pcp.1.html">sheet2pcp(1)</a>, <a href="telnet-probe.1.html">telnet-probe(1)</a>, <a href="../man3/__pmcleanmapdir.3.html">__pmcleanmapdir(3)</a>, <a href="../man3/pmregisterderived.3.html">pmregisterderived(3)</a>, <a href="../man5/pmieconf.5.html">pmieconf(5)</a> </p> <hr>         <div class="_attribution">
  <p class="_attribution-p">
    ...<br>
    <a href="https://man7.org/linux/man-pages/man1/pmie.1.html" class="_attribution-link">https://man7.org/linux/man-pages/man1/pmie.1.html</a>
  </p>
</div>
