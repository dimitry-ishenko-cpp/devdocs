<h1>pmlogrewrite(1) — Linux manual page</h1>   <pre>
<span class="headline"><i>PMLOGREWRITE</i>(1)          General Commands Manual         <i>PMLOGREWRITE</i>(1)</span>
</pre> <h2>
NAME </h2>
<pre>
       <b>pmlogrewrite </b>- rewrite Performance Co-Pilot archives
</pre> <h2>
SYNOPSIS </h2>
<pre>
       <b>pmlogrewrite </b>[<b>-Cdiqsvw?</b>]  [<b>-c </b><i>config</i>] [<b>-V </b><i>version</i>] <i>inlog</i> [<i>outlog</i>]
</pre> <h2>
DESCRIPTION </h2>
<pre>
       <b>pmlogrewrite </b>reads a set of Performance Co-Pilot (PCP) archives
       identified by <i>inlog</i> and creates a PCP archive in <i>outlog</i>.  Under
       normal usage, the <b>-c </b>option will be used to nominate a
       configuration file or files that contains specifications (see the
       <b>REWRITING RULES SYNTAX </b>section below) that describe how the data
       and metadata from <i>inlog</i> should be transformed to produce <i>outlog</i>.

       The typical uses for <b>pmlogrewrite </b>would be to accommodate the
       evolution of Performance Metric Domain Agents (PMDAs) where the
       names, metadata and semantics of metrics and their associated
       instance domains may change over time, e.g. promoting the type of
       a metric from a 32-bit to a 64-bit integer, or renaming a group
       of metrics.  Refer to the <b>EXAMPLES </b>section for some additional
       use cases.

       <b>pmlogrewrite </b>may also be used to redact sensitive information
       from PCP archives in situations where the archives need to be
       shipped to another organization or to meet privacy policies or
       legislative requirements.  See <a href="pmlogredact.1.html">pmlogredact(1)</a> for an example use
       of <b>pmlogrewrite </b>in this context.

       <b>pmlogrewrite </b>is most useful where PMDA changes, or errors in the
       production environment, result in archives that cannot be
       combined with <a href="pmlogextract.1.html">pmlogextract(1)</a>.  By pre-processing the archives
       with <b>pmlogrewrite </b>the resulting archives may be able to be merged
       with <a href="pmlogextract.1.html">pmlogextract(1)</a>.

       The input <i>inlog</i> must be a set of PCP archives created by
       <a href="pmlogger.1.html">pmlogger(1)</a>, or possibly one of the tools that read and create
       PCP archives, e.g.  <a href="pmlogextract.1.html">pmlogextract(1)</a> and <a href="pmlogreduce.1.html">pmlogreduce(1)</a>.  <i>inlog</i> is
       a comma-separated list of names, each of which may be the base
       name of an archive or the name of a directory containing one or
       more archives.

       If no <b>-c </b>option is specified, then the default behavior simply
       creates <i>outlog</i> as a copy of <i>inlog</i>.  This is a little more
       complicated than <a href="cat.1.html">cat(1)</a>, as each PCP archive is made up of
       several physical files.

       While <b>pmlogrewrite </b>may be used to repair some data consistency
       issues in PCP archives, there is also a class of repair tasks
       that cannot be handled by <b>pmlogrewrite </b>and <a href="pmloglabel.1.html">pmloglabel(1)</a> may be a
       useful tool in these cases.
</pre> <h2>
OPTIONS </h2>
<pre>
       The available command line options are:

       <b>-c </b><i>config</i>, <b>--config</b>=<i>config</i>
            If <i>config</i> is a file or symbolic link, read and parse
            rewriting rules from there.  If <i>config</i> is a directory, then
            all of the files or symbolic links in that directory
            (excluding those beginning with a period ``.'') will be used
            to provide the rewriting rules.  Multiple <b>-c </b>options are
            allowed.

       <b>-C</b>, <b>--check</b>
            Parse the rewriting rules and quit.  <i>outlog</i> is not created,
            so this command line argument is optional with <b>-C</b>.  When <b>-C</b>
            is specified, this also sets <b>-v </b>and <b>-w </b>so that all warnings
            and verbose messages are displayed as <i>config</i> is parsed.

       <b>-d</b>, <b>--desperate</b>
            Desperate mode.  Normally if a fatal error occurs, all trace
            of the partially written PCP archive <i>outlog</i> is removed.
            With the <b>-d </b>option, the partially created <i>outlog</i> archive is
            not removed.

       <b>-i   </b>Rather than creating <i>outlog</i>, <i>inlog</i> is rewritten in place
            when the <b>-i </b>option is used.  A new archive is created using
            temporary file names and then renamed to <i>inlog</i> in such a way
            that if any errors (not warnings) are encountered, <i>inlog</i>
            remains unaltered.

       <b>-q</b>, <b>--quick</b>
            Quick mode, where if there are no rewriting actions to be
            performed (none of the global data, instance domains or
            metrics from <i>inlog</i> will be changed), then <b>pmlogrewrite </b>will
            exit (with status 0, so success) immediately after parsing
            the configuration file(s) and <i>outlog</i> is not created.

       <b>-s</b>, <b>--scale</b>
            When the ``units'' of a metric are changed, if the dimension
            in terms of space, time and count is unaltered, then the
            scaling factor is being changed, e.g. BYTE to KBYTE, or
            MSEC-1 to USEC-1, or the composite MBYTE.SEC-1 to
            KBYTE.USEC-1.  The motivation may be (a) that the original
            metadata was wrong but the values in <i>inlog</i> are correct, or
            (b) the metadata is changing so the values need to change as
            well.  The default <b>pmlogrewrite </b>behaviour matches case (a).
            If case (b) applies, then use the <b>-s </b>option and the values
            of all the metrics with a scale factor change in each result
            will be rescaled.  For finer control over value rescaling
            refer to the <i><b>RESCALE</b> </i>option for the <i><b>UNITS</b> </i>clause of the
            metric rewriting rule described below.

       <b>-v</b>, <b>--verbose</b>
            Enable verbose mode.

       <b>-V </b><i>version</i>, <b>--version</b>=<i>version</i>
            Specifies the version of the output PCP archive being
            produced.  Currently versions 2 and 3 of the archive format
            is supported.  The version of <i>inlog</i> must be at least <i>version</i>
            (so version upgrade is allowed, but version downgrade is
            not).  By default, in the absence of the <i>-V</i> option, the
            version of <i>outlog</i> is the same as the version of <i>inlog</i>.

       <b>-w</b>, <b>--warnings</b>
            Emit warnings.  Normally <b>pmlogrewrite </b>remains silent for any
            warning that is not fatal and it is expected that for a
            particular archive, some (or indeed, all) of the rewriting
            specifications may not apply.  For example, changes to a
            PMDA may be captured in a set of rewriting rules, but a
            single archive may not contain all of the modified metrics
            nor all of the modified instance domains and/or instances.
            Because these cases are expected, they do not prevent
            <b>pmlogrewrite </b>executing, and rules that do not apply to <i>inlog</i>
            are silently ignored by default.  Similarly, some rewriting
            rules may involve no change because the metadata in <i>inlog</i>
            already matches the intent of the rewriting rule to correct
            data from a previous version of a PMDA.  The <b>-w </b>flag forces
            warnings to be emitted for all of these cases.

       <b>-?</b>, <b>--help</b>
            Display usage message and exit.

       The argument <i>outlog</i> is required in all cases, except when <b>-i </b>is
       specified.
</pre> <h2>
REWRITING RULES SYNTAX </h2>
<pre>
       A configuration file contains zero or more rewriting rules as
       defined below.

       Keywords and special punctuation characters are shown below in
       <i><b>bolditalic</b> </i>font and are case-insensitive, so <i><b>METRIC</b></i>, <i><b>metric</b> </i>and
       <i><b>Metric</b> </i>are all equivalent in rewriting rules.

       The character ``#'' introduces a comment and the remainder of the
       line is ignored.  Otherwise the input is relatively free format
       with optional white space (spaces, tabs or newlines) between
       lexical items in the rules.

       A <b>global </b>rewriting rule has the form:

       <i><b>GLOBAL { </b>globalspec</i> ...  <b>}</b>

       where <i>globalspec</i> is zero or more of the following clauses:

           <i><b>HOSTNAME -&gt; </b>hostname</i>

               Modifies the label records in the <i>outlog</i> PCP archive, so
               that the metrics will appear to have been collected from
               the host <i>hostname</i>.

           <i><b>TIME -&gt; </b>delta</i>

               Both metric values and the instance domain metadata in a
               PCP archive carry timestamps.  This clause forces all the
               timestamps to be adjusted by <i>delta</i>, where <i>delta</i> is an
               optional sign ``+'' (the default) or ``-'', an optional
               number of hours followed by a colon ``:'', an optional
               number of minutes followed by a colon ``:'', a number of
               seconds, an optional fraction of seconds following a
               period ``.''.  The simplest example would be ``30'' to
               increase the timestamps by 30 seconds.  A more complex
               example would be ``-23:59:59.999'' to move the timestamps
               backwards by one millisecond less than one day.

           <b>TIMEZONE -&gt; "</b>timezone<b>"</b>
           <b>TZ -&gt; "</b>timezone<b>"</b>

               Modifies the label records in the <i>outlog</i> PCP archive, so
               that the metrics will appear to have been collected from
               a host with a local timezone of <i>timezone</i>.  <i>timezone</i> must
               be enclosed in double quotes, and should conform to the
               valid timezone syntax rules for the local platform,
               usually a Posix TZ format, e.g. <b>AEST-10</b>.  See <a href="../man3/tzset.3.html">tzset(3)</a>
               for more information.

               <i><b>TZ</b> </i>is an alias for <i><b>TIMEZONE</b></i>.

           <b>ZONEINFO -&gt; "</b>zoneinfo<b>"</b>

               Modifies the label records in the <i>outlog</i> PCP archive, so
               that the metrics will appear to have been collected from
               a host with a local timezone of <i>zoneinfo</i>.  <i>zoneinfo</i> must
               be enclosed in double quotes, and should conform to the
               valid zoneinfo timezone syntax rules for the local
               platform, usually a colon followed by a pathname below
               <i>/usr/share/zoneinfo</i>, e.g. <b>:Africa/Timbuktu</b>.  See <a href="../man3/tzset.3.html">tzset(3)</a>
               for more information.

               The <i><b>zoneinfo</b> </i>clause is only allowed if the output archive
               version is at least 3.

           <i><b>FEATURES -&gt; </b>feature-bits</i>

               Modifies the label records in the <i>outlog</i> PCP archive, so
               that the metrics will appear to have been collected from
               system with a <a href="pmlogger.1.html">pmlogger(1)</a> that supports the ``features''
               defined by the integer value <i>feature-bits</i>, which is
               formed by ``or''ing the desired feature flags as defined
               in <a href="../man5/logarchive.5.html">LOGARCHIVE(5)</a>.  Alternatively, <i>feature-bits</i> can be
               specified using the ``macro'' <i><b>BITS()</b> </i>that takes a comma
               separated argument list of integers (in the inclusive
               range 0 to 31) and sets the corresponding bits.  For
               example
                   features -&gt; bits(31,7,1)

               The <i><b>features</b> </i>clause is only allowed if the output archive
               version is at least 3.

       An <b>indom </b>rewriting rule modifies an instance domain and has the
       form:

       <i><b>INDOM </b>domain<b>.</b>serial <b>{ </b>indomspec</i> ...  <b>}</b>

       where <i>domain</i> and <i>serial</i> identify one or more existing instance
       domains from <i>inlog</i> - typically <i>domain</i> would be an integer in the
       range 1 to 510 and <i>serial</i> would be an integer in the range 0 to
       4194304.

       As a special case <i>serial</i> could be an asterisk ``*'' which means
       the rule applies to every instance domain with a domain number of
       <i>domain</i>.

       If a designated instance domain is not in <i>inlog</i> the rule has no
       effect.

       The <i>indomspec</i> is zero or more of the following clauses:

           <i><b>INAME</b> </i>"<i>oldname</i>" <i><b>-&gt;</b> </i>"<i>newname</i>"

               The instance identified by the external instance name
               <i>oldname</i> is renamed to <i>newname</i>.  Both <i>oldname</i> and <i>newname</i>
               must be enclosed in double quotes.

               As a special case, the new name may be the keyword <b>DELETE</b>
               (with no double quotes), and then the instance <i>oldname</i>
               will be expunged from <i>outlog</i> which removes it from the
               instance domain metadata and removes all values of this
               instance for all the associated metrics.

               If the instance names contain any embedded spaces then
               special care needs to be taken in respect of the PCP
               instance naming rule that treats the leading non-space
               part of the instance name as the unique portion of the
               name for the purposes of matching and ensuring uniqueness
               within an instance domain, refer to <a href="../man3/pmdainstance.3.html">pmdaInstance(3)</a> for a
               discussion of this issue.

               As an illustration, consider the hypothetical instance
               domain for a metric which contains 2 instances with the
               following names:
                   red
                   eek urk

               Then some possible <i><b>INAME</b> </i>clauses might be:

               "eek" -&gt; "yellow like a flower"
                      Acceptable, <i>oldname</i> "eek" matches the "eek urk"
                      instance.

               "red" -&gt; "eek"
                      Error, <i>newname</i> "eek" matches the existing "eek
                      urk" instance.

               "eek urk" -&gt; "red of another hue"
                      Error, <i>newname</i> "red of another hue" matches the
                      existing "red" instance.

           <i><b>INAME REPLACE</b> </i>/<i>pattern</i>/ <i><b>-&gt;</b> </i>"<i>replacement</i>"

               Every external instance name in the instance domain is
               matched against the regular expression <i>pattern</i> and when a
               match is found, the name is changed based on the parts of
               the name matched by <i>pattern</i> and the <i>replacement</i> recipe.
               <i>pattern</i> follows the syntax of a Posix Extended Regular
               Expression (see <a href="../man7/regex.7.html">regex(7)</a>) and <i>replacement</i> follows the
               syntax of the <b>s </b>command of <a href="sed.1.html">sed(1)</a>, so <b>&amp; </b>and <b>\1 </b>through <b>\9</b>
               may be used to select all or substrings of the instance
               name that matches <i>pattern.</i>

               Note that the match-and-replace is done at most once per
               external instance name, so if there are repeated
               sequences of the name that match <i>pattern</i> only the <b>first</b>
               one will be matched and <i>replacement</i> applied.

               <i>pattern</i> is normally enclosed in slashes (/) or double
               quotes (").  An escape (\) may be used before any of the
               metacharacters described in <a href="../man3/regex.3.html">regex(3)</a> to specify a literal
               character, e.g. \( or \[ or \+ ...  The enclosing
               delimiters cannot be escaped, so to embed a literal
               slash, use double quotes as the delimiter, or vice versa.

               <i>replacement</i> is normally enclosed by double quotes (") or
               slashes (/).  An escape (\) may be used before <b>&amp; </b>or <b>\ </b>to
               specify these characters literally.  The enclosing
               delimiters cannot be escaped, so to embed a double quote,
               use slashes as the delimiter, or vice versa.

               If the instance names after replacement contain any
               embedded spaces then special care needs to be taken in
               respect of the PCP instance naming rule that treats the
               leading non-space part of the instance name as the unique
               portion of the name for the purposes of matching and
               ensuring uniqueness within an instance domain.  Refer to
               <a href="../man3/pmdainstance.3.html">pmdaInstance(3)</a> for a discussion of this issue.

               Here are some examples:

               { iname replace /[a-z]*foo[a-z]*/ -&gt; "FOO" }
                      replace any word containing "foo" with "FOO"

               { iname replace "([0-9]+) /.*/(.*)" -&gt; "\1 \2" }
                      removes a directory path, so the instance name
                      (for one of the proc PMDA's metrics) "2981799
                      /home/kenj/bin/foobar" would become "2981799
                      foobar", hiding the user's home directory and
                      implicitly the user's login name

           <b>INAME REDACT</b>

               Replace every external instance name in the instance
               domain by the string "<i>inst</i> <b>[redacted]</b>" where <i>inst</i> is the
               internal instance identifier in ASCII format.

           <i><b>INDOM -&gt; </b>newdomain<b>.</b>newserial</i>

               Modifies the metadata for the instance domain and every
               metric associated with the instance domain.  As a special
               case, <i>newserial</i> could be an asterisk ``*'' which means
               use <i>serial</i> from the <b>indom </b>rewriting rule, although this
               is most useful when <i>serial</i> is also an asterisk.  So for
               example:
                   indom 29.* { indom -&gt; 109.* }
               will move all instance domains from domain 29 to domain
               109.

           <i><b>INDOM -&gt; DUPLICATE </b>newdomain<b>.</b>newserial</i>

               A special case of the previous <i><b>INDOM</b> </i>clause where the
               instance domain is a duplicate copy of the <i>domain<b>.</b>serial</i>
               instance domain from the <i>indom</i> rewriting rule, and then
               any mapping rules are applied to the copied
               <i>newdomain<b>.</b>newserial</i> instance domain.  This is useful when
               a PMDA is split and the same instance domain needs to be
               replicated for domain <i>domain</i> and domain <i>newdomain</i>.  So
               for example if the metrics <i>foo.one</i> and <i>foo.two</i> are both
               defined over instance domain 12.34, and <i>foo.two</i> is moved
               to another PMDA using domain 27, then the following
               rewriting rules could be used:
                   indom 12.34 { indom -&gt; duplicate 27.34 }
                   metric foo.two { indom -&gt; 27.34 pmid -&gt; 27.*.*  }

           <i><b>INST </b>oldid <b>-&gt; </b>newid</i>

               The instance identified by the internal instance
               identifier <i>oldid</i> is renumbered to <i>newid</i>.  Both <i>oldid</i> and
               <i>newid</i> are integers in the range 0 to 231-1.

               As a special case, <i>newid</i> may be the keyword <i><b>DELETE</b> </i>and
               then the instance <i>oldid</i> will be expunged from <i>outlog</i>
               which removes it from the instance domain metadata and
               removes all values of this instance for all the
               associated metrics.

       A <b>metric </b>rewriting rule has the form:

       <i><b>METRIC </b>metricid <b>{ </b>metricspec</i> ...  <b>}</b>

       where <i>metricid</i> identifies one or more existing metrics from <i>inlog</i>
       using either a metric name, or the internal encoding for a
       metric's PMID as <i>domain<b>.</b>cluster<b>.</b>item</i>.  In the latter case,
       typically <i>domain</i> would be an integer in the range 1 to 510,
       <i>cluster</i> would be an integer in the range 0 to 4095, and <i>item</i>
       would be an integer in the range 0 to 1023.

       As special cases <i>item</i> could be an asterisk ``*'' which means the
       rule applies to every metric with a domain number of <i>domain</i> and a
       cluster number of <i>cluster</i>, or <i>cluster</i> could be an asterisk which
       means the rule applies to every metric with a domain number of
       <i>domain</i> and an item number of <i>item</i>, or both <i>cluster</i> and <i>item</i> could
       be asterisks, and rule applies to every metric with a domain
       number of <i>domain</i>.

       If a designated metric is not in <i>inlog</i> the rule has no effect.

       The <i>metricspec</i> is zero or more of the following clauses:

           <b>DELETE</b>

               The metric is completely removed from <i>outlog</i>, both the
               metadata and all values in results are expunged.

           <i><b>INDOM -&gt; </b>newdomain<b>.</b>newserial</i> [ <i>pick</i> ]

               Modifies the metadata to change the instance domain for
               this metric.  The new instance domain must exist in
               <i>outlog</i>.

               The optional <i>pick</i> clause may be used to select one input
               value, or compute an aggregate value from the instances
               in an input result, or assign an internal instance
               identifier to a single output value.  If no <i>pick</i> clause
               is specified, the default behaviour is to copy all input
               values from each input result to an output result,
               however if the input instance domain is singular (indom
               <b>PM_INDOM_NULL</b>) then the one output value must be assigned
               an internal instance identifier, which is 0 by default,
               unless over-ridden by a <i><b>INST</b> </i>or <i><b>INAME</b> </i>clause as defined
               below.

               The choices for <i>pick</i> are as follows:

               <b>OUTPUT FIRST</b>
                      choose the value of the first instance from each
                      input result

               <b>OUTPUT LAST</b>
                      choose the value of the last instance from each
                      input result

               <i><b>OUTPUT INST </b>instid</i>
                      choose the value of the instance with internal
                      instance identifier <i>instid</i> from each result; the
                      sequence of rewriting rules ensures the <b>OUTPUT</b>
                      processing happens before instance identifier
                      renumbering from any associated <b>indom </b>rule, so
                      <i>instid</i> should be one of the internal instance
                      identifiers that appears in <i>inlog</i>

               <i><b>OUTPUT INAME</b> </i>"<i>name</i>"
                      choose the value of the instance with <i>name</i> for its
                      external instance name from each result; the
                      sequence of rewriting rules ensures the <b>OUTPUT</b>
                      processing happens before instance renaming from
                      any associated <b>indom </b>rule, so <i>name</i> should be one
                      of the external instance names that appears in
                      <i>inlog</i>

               <b>OUTPUT MIN</b>
                      choose the smallest value in each result (metric
                      type must be numeric and output instance will be 0
                      for a non-singular instance domain)

               <b>OUTPUT MAX</b>
                      choose the largest value in each result (metric
                      type must be numeric and output instance will be 0
                      for a non-singular instance domain)

               <b>OUTPUT SUM</b>
                      choose the sum of all values in each result
                      (metric type must be numeric and output instance
                      will be 0 for a non-singular instance domain)

               <b>OUTPUT AVG</b>
                      choose the average of all values in each result
                      (metric type must be numeric and output instance
                      will be 0 for a non-singular instance domain)

               If the input instance domain is singular (indom
               <b>PM_INDOM_NULL</b>) then independent of any <i>pick</i>
               specifications, there is at most one value in each input
               result and so <i><b>FIRST</b></i>, <i><b>LAST</b></i>, <i><b>MIN</b></i>, <i><b>MAX</b></i>, <i><b>SUM</b> </i>and <i><b>AVG</b> </i>are all
               equivalent and the output instance identifier will be 0.

               In general it is an error to specify a rewriting action
               for the same metadata or result values more than once,
               e.g. more than one <i><b>INDOM</b> </i>clause for the same instance
               domain.  The one exception is the possible interaction
               between the <i><b>INDOM</b> </i>clauses in the <b>indom </b>and <b>metric </b>rules.
               For example the metric <i>sample.bin</i> is defined over the
               instance domain 29.2 in <i>inlog</i> and the following is
               acceptable (albeit redundant):
                   indom 29.* { indom -&gt; 109.* }
                   metric sample.bin { indom -&gt; 109.2 }
               However the following is an error, because the instance
               domain for <i>sample.bin</i> has two conflicting definitions:
                   indom 29.* { indom -&gt; 109.* }
                   metric sample.bin { indom -&gt; 123.2 }

           <i><b>INDOM -&gt; NULL</b></i>[ <i>pick</i> ]

               The metric (which must have been previously defined over
               an instance domain) is being modified to be a singular
               metric.  This involves a metadata change and collapsing
               all results for this metric so that multiple values
               become one value.

               The optional <i>pick</i> part of the clause defines how the one
               value for each result should be calculated and follows
               the same rules as described for the non-NULL <i><b>INDOM</b> </i>case
               above.

               In the absence of <i>pick</i>, the default is <i><b>OUTPUT FIRST</b></i>.

           <i><b>NAME -&gt; </b>newname</i>

               Renames the metric in the PCP archive's metadata that
               supports the Performance Metrics Name Space (PMNS).
               <i>newname</i> should not match any existing name in the
               archive's PMNS and must follow the syntactic rules for
               valid metric names as outlined in <a href="../man5/pmns.5.html">PMNS(5)</a>.

           <i><b>PMID -&gt; </b>newdomain<b>.</b>newcluster<b>.</b>newitem</i>

               Modifies the metadata and results to renumber the
               metric's PMID.  As special cases, <i>newcluster</i> could be an
               asterisk ``*'' which means use <i>cluster</i> from the <b>metric</b>
               rewriting rule and/or <i>item</i> could be an asterisk which
               means use <i>item</i> from the <b>metric </b>rewriting rule.  This is
               most useful when <i>cluster</i> and/or <i>item</i> is also an asterisk.
               So for example:
                   metric 30.*.* { pmid -&gt; 123.*.* }
               will move all metrics from domain 30 to domain 123.

           <i><b>SEM -&gt; </b>newsem</i>

               Change the semantics of the metric.  <i>newsem</i> should be the
               XXX part of the name of one of the <b>PM_SEM_XXX </b>macros
               defined in &lt;pcp/pmapi.h&gt; or <a href="../man3/pmlookupdesc.3.html">pmLookupDesc(3)</a>, e.g.
               <i><b>COUNTER</b> </i>for <b>PM_TYPE_COUNTER</b>.

               No data value rewriting is performed as a result of the
               <i><b>SEM</b> </i>clause, so the usefulness is limited to cases where a
               version of the associated PMDA was exporting incorrect
               semantics for the metric.  <a href="pmlogreduce.1.html">pmlogreduce(1)</a> may provide an
               alternative in cases where re-computation of result
               values is desired.

           <i><b>TYPE -&gt; </b>newtype</i>

               Change the type of the metric which alters the metadata
               and may change the encoding of values in results.
               <i>newtype</i> should be the XXX part of the name of one of the
               <b>PM_TYPE_XXX </b>macros defined in &lt;pcp/pmapi.h&gt; or
               <a href="../man3/pmlookupdesc.3.html">pmLookupDesc(3)</a>, e.g.  <i><b>FLOAT</b> </i>for <b>PM_TYPE_FLOAT</b>.

               Type conversion is only supported for cases where the old
               and new metric type is numeric, so <b>PM_TYPE_STRING</b>,
               <b>PM_TYPE_AGGREGATE </b>and <b>PM_TYPE_EVENT </b>are not allowed.
               Even for the numeric cases, some conversions may produce
               run-time errors, e.g. integer overflow, or attempting to
               rewrite a negative value into an unsigned type.

           <i><b>TYPE IF </b>oldtype <b>-&gt; </b>newtype</i>

               The same as the preceding <i><b>TYPE</b> </i>clause, except the type of
               the metric is only changed to <i>newtype</i> if the type of the
               metric in <i>inlog</i> is <i>oldtype.</i>

               This useful in cases where the type of <i>metricid</i> in <i>inlog</i>
               may be platform dependent and so more than one type
               rewriting rule is required.

           <i><b>UNITS -&gt; </b>newunits</i> [ <i><b>RESCALE</b> </i>]

               <i>newunits</i> is six values separated by commas.  The first 3
               values describe the dimension of the metric along the
               dimensions of space, time and count; these are integer
               values, usually 0, 1 or -1.  The remaining 3 values
               describe the scale of the metric's values in the
               dimensions of space, time and count.  Space scale values
               should be 0 (if the space dimension is 0), else the XXX
               part of the name of one of the <b>PM_SPACE_XXX </b>macros, e.g.
               <i><b>KBYTE</b> </i>for <b>PM_TYPE_KBYTE</b>.  Time scale values should be 0
               (if the time dimension is 0), else the XXX part of the
               name of one of the <b>PM_TIME_XXX </b>macros, e.g.  <i><b>SEC</b> </i>for
               <b>PM_TIME_SEC</b>.  Count scale values should be 0 (if the time
               dimension is 0), else <i><b>ONE</b> </i>for <b>PM_COUNT_ONE</b>.

               The <b>PM_SPACE_XXX</b>, <b>PM_TIME_XXX </b>and <b>PM_COUNT_XXX </b>macros are
               defined in &lt;pcp/pmapi.h&gt; or <a href="../man3/pmlookupdesc.3.html">pmLookupDesc(3)</a>.

               When the scale is changed (but the dimension is
               unaltered) the optional keyword <i><b>RESCALE</b> </i>may be used to
               chose value rescaling as per the <b>-s </b>command line option,
               but applied to just this metric.

           <i><b>VALUE REPLACE</b> </i>/<i>pattern</i>/ <i><b>-&gt;</b> </i>"<i>replacement</i>"

               The value for every instance of the metric is matched
               against the regular expression <i>pattern</i> and when a match
               is found, the value is changed based on the parts of the
               value matched by <i>pattern</i> and the <i>replacement</i> recipe.
               <i>pattern</i> follows the syntax of a Posix Extended Regular
               Expression (see <a href="../man7/regex.7.html">regex(7)</a>) and <i>replacement</i> follows the
               syntax of the <b>s </b>command of <a href="sed.1.html">sed(1)</a>, so <b>&amp; </b>and <b>\1 </b>through <b>\9</b>
               may be used to select all or substrings of the value that
               matches <i>pattern.</i>

               Note that the match-and-replace is done at most once per
               metric value, so if there are repeated sequences of the
               metric value that match <i>pattern</i> only the <b>first </b>one will
               be matched and <i>replacement</i> applied.

               <i>pattern</i> is normally enclosed in slashes (/) or double
               quotes (").  An escape (\) may be used before any of the
               metacharacters described in <a href="../man3/regex.3.html">regex(3)</a> to specify a literal
               character, e.g. \( or \[ or \+ ...  The enclosing
               delimiters cannot be escaped, so to embed a literal
               slash, use double quotes as the delimiter, or vice versa.

               <i>replacement</i> is normally enclosed by double quotes (") or
               slashes (/).  An escape (\) may be used before <b>&amp; </b>or <b>\ </b>to
               specify these characters literally.  The enclosing
               delimiters cannot be escaped, so to embed a double quote,
               use slashes as the delimiter, or vice versa.

               The <i><b>REPLACE</b> </i>keyword is optional.

               This clause can only be applied to metrics with values of
               type <b>PM_TYPE_STRING</b>.

               Here are some examples:

               { value /.*/ -&gt; "" }
                      remove the value everywhere

               value "/.*/(.*)" -&gt; "\1" }
                      removes a directory path, so the metric value
                      "mumble /home/kenj/bin/foobar fumble" would become
                      "mumble foobar fumble", hiding the user's home
                      directory and implicitly the user's login name

           When changing the domain number for a metric or instance
           domain, the new domain number will usually match an existing
           PMDA's domain number.  If this is not the case, then the new
           domain number should not be randomly chosen; consult
           <b>$PCP_VAR_DIR/pmns/stdpmid </b>for domain numbers that are already
           assigned to PMDAs.

       A <b>text </b>rewriting rule modifies a help text record and has the
       form:

       <i><b>TEXT </b>textid</i> [ <i>texttype</i> ] [ "<i>textcontent</i>" ] <i><b>{ </b>textspec</i> ...  <b>}</b>

       where <i>textid</i> identifies the metric or instance domain with which
       the text is currently associated, and is either <i><b>METRIC </b>metricid</i>
       or <i><b>INDOM </b>domain<b>.</b>serial</i>.

       <i>metricid</i> has the same form and meaning as for a <i><b>METRIC</b> </i>rewriting
       rule (see above) and <i>domain<b>.</b>serial</i> has the same form and meaning
       as for an <i><b>INDOM</b> </i>rewriting rule (see above).

       The optional <i>texttype</i> identifies the type of text and may be one
       of <i><b>ONELINE</b> </i>to select the one line help text, <i><b>HELP</b> </i>to select the
       full help text, or <i><b>ALL</b> </i>or an asterisk ``*'' to select both types
       of help text.  If <i>texttype</i> is not specified, then the default is
       <i><b>ONELINE</b></i>.

       The optional <i>textcontent</i> further restricts the selected text
       records to those containing the specified content.  Characters
       such as double quotes may be escaped by preceding them with a
       backslash ``\''.

       If a designated help text record is not in <i>inlog</i> the rule has no
       effect.

       The <i>textspec</i> is zero or more of the following clauses:

           <b>DELETE</b>

               The selected text is completely removed from <i>outlog</i>.

           <i><b>INDOM -&gt; </b>newdomain<b>.</b>newserial</i>

               Re-associates the text with the specified instance
               domain.  As a special case, <i>newserial</i> could be an
               asterisk ``*'' which means use <i>serial</i> from the <b>text</b>
               rewriting rule, although this is most useful when <i>serial</i>
               is also an asterisk.  So for example:
                   text indom 29.* all { indom -&gt; 109.* }
               will re-associate all text associated with instance
               domains from domain 29 to domain 109.

           <i><b>METRIC -&gt; </b>newdomain<b>.</b>newcluster<b>.</b>newitem</i>

               Re-associates the text with the specified metric.  As
               special cases, <i>newcluster</i> could be an asterisk ``*''
               which means use <i>cluster</i> from the <b>text </b>rewriting rule
               and/or <i>item</i> could be an asterisk which means use <i>item</i>
               from the <b>text </b>rewriting rule.  This is most useful when
               <i>cluster</i> and/or <i>item</i> is also an asterisk.  So for example:
                   text metric 30.*.* all { metric -&gt; 123.*.* }
               will re-associate all text associated with metrics from
               domain 30 to domain 123.

           <b>TEXT -&gt; "</b>new-text<b>"</b>

               Replaces the content of the selected text with <i>new-text</i>.

       A <b>label </b>rewriting rule modifies a label record and has the form:

       <i><b>LABEL </b>labelid</i> [ <i>instance</i> ] [ <b>"</b>label-name[1m"[24m [22m] [ <b>"</b>label-value[1m"[24m [22m] <b>{</b>
       <i>labelspec</i> ...  <b>}</b>

       where <i>labelid</i> refers to the global context or identifies the
       metric domain, metric cluster, metric item, instance domain, or
       instance domain instances with which the label is currently
       associated, and is either <i><b>CONTEXT</b> </i>or <i><b>DOMAIN </b>domainid</i> or <b>CLUSTER</b>
       <i>domainid<b>.</b>clusterid</i> or <i><b>ITEM </b>metricid</i> or <i><b>INDOM </b>domain<b>.</b>serial</i> or
       <i><b>INSTANCES </b>domain<b>.</b>serial</i>.

       <i>metricid</i> has the same form and meaning as for a <i><b>METRIC</b> </i>rewriting
       rule (see above).  <i>clusterid</i> may be an asterisk ``*'' which means
       the rule applies to every metric with a domain number of <i>domainid</i>
       in the same way as an asterisk may be used for the cluster within
       <i>metricid</i>.

       <i>domain<b>.</b>serial</i> has the same form and meaning as for an <b>INDOM</b>
       rewriting rule (see above).

       In the case of an <i><b>INSTANCES </b>labelid</i>, the name or number of a
       specific instance may be optionally specified as <i>instance</i>.  This
       name or number number may be omitted or specified as an asterisk
       ``*'' to indicate that labels for all instances of the specified
       instance domain are selected.  If an instance name is specified,
       it must be within double quotes.  If the instance name contains
       any embedded spaces then special care needs to be taken in
       respect of the PCP instance naming rule that treats the leading
       non-space part of the instance name as the unique portion of the
       name for the purposes of matching and ensuring uniqueness within
       an instance domain, refer to <a href="../man3/pmdainstance.3.html">pmdaInstance(3)</a> for a discussion of
       this issue.

       In all cases, a <b>"</b>label-name[1m"[24m [22mand/or a <b>"</b>label-value[1m"[24m [22mmay be
       optionally specified in double quotes in order to select labels
       with the given name and/or given value.  These may individually
       be omitted or specified as asterisks ``*'' to indicate that
       labels with all names and/or values are selected.

       If a designated label record is not in <i>inlog</i> the rule has no
       effect.

       The <i>labelspec</i> is zero or more of the following clauses:

           <b>DELETE</b>

               The selected labels are completely removed from <i>outlog</i>.

           <b>NEW "</b>new-label-name<b>" "</b>new-label-value<b>"</b>

               A new label with the name <b>"</b>new-label-name[1m"[24m [22mand the value
               <b>"</b>new-label-value[1m"[24m [22mis created and associated with the
               specified <i>labelid</i> and optional <i>instance</i> (in the case of a
               <i><b>INSTANCES </b>labelid</i>).  If <b>"</b>label-name[1m"[24m [22mor <b>"</b>label-value<b>"</b>
               were specified, then they are ignored with a warning.  If
               <i>instance</i> is not specified for an <i><b>INSTANCES </b>labelid</i>, then
               a new label will be created for each instance in the
               specified instance domain.

           <b>LABEL -&gt; "</b>new-label-name<b>"</b>

               The name of the selected label(s) is changed to <i><b>"</b>new-</i>
               label-name[1m"[24m[22m.

           <b>VALUE -&gt; "</b>new-label-value<b>"</b>

               The value of the selected label(s) is changed to <i><b>"</b>new-</i>
               label-value[1m"[24m[22m.

           <i><b>DOMAIN -&gt; </b>newdomain</i>

               Re-associates the selected label(s) with the specified
               metric domain.  For example:
                   label domain 30 { domain -&gt; 123 }
               will re-associate all labels associated with domains from
               domain 30 to domain 123.

           <i><b>CLUSTER -&gt; </b>newdomain<b>.</b>newcluster</i>

               Re-associates the selected label(s) with the specified
               metric cluster.  As a special case, <i>newcluster</i> could be
               an asterisk ``*'' which means use <i>cluster</i> from the <b>label</b>
               rewriting rule.  This is most useful when <i>cluster</i> is also
               an asterisk.  So for example:
                   label cluster 30.* { cluster -&gt; 123.* }
               will re-associate all labels associated with clusters
               from domain 30 to domain 123.

           <i><b>ITEM -&gt; </b>newdomain<b>.</b>newcluster<b>.</b>newitem</i>

               Re-associates the selected label(s) with the specified
               metric item.  As special cases, <i>newcluster</i> could be an
               asterisk ``*'' which means use <i>cluster</i> from the <b>label</b>
               rewriting rule and/or <i>item</i> could be an asterisk which
               means use <i>item</i> from the <b>label </b>rewriting rule.  This is
               most useful when <i>cluster</i> and/or <i>item</i> is also an asterisk.
               So for example:
                   label item 30.*.* { item -&gt; 123.*.* }
               will re-associate all labels associated with metrics from
               domain 30 to domain 123.

           <i><b>INDOM -&gt; </b>newdomain<b>.</b>newserial</i>

               Re-associates the selected label(s) with the specified
               instance domain.  As a special case, <i>newserial</i> could be
               an asterisk ``*'' which means use <i>serial</i> from the <b>label</b>
               rewriting rule, although this is most useful when <i>serial</i>
               is also an asterisk.  So for example:
                   label indom 29.* { indom -&gt; 109.* }
               will re-associate all labels associated with instance
               domains from domain 29 to domain 109.

           <i><b>INSTANCES -&gt; </b>newdomain<b>.</b>newserial</i>

               This is the same as <i><b>INDOM</b> </i>except that it re-associates
               the selected label(s) with the instances of the specified
               instance domain.
</pre> <h2>
EXAMPLES </h2>
<pre>
       To promote the values of the per-disk IOPS metrics to 64-bit to
       allow aggregation over a long time period for capacity planning,
       or because the PMDA has changed to export 64-bit counters and we
       want to convert old archives so they can be processed alongside
       new archives.
           metric disk.dev.read { type -&gt; U64 }
           metric disk.dev.write { type -&gt; U64 }
           metric disk.dev.total { type -&gt; U64 }

       The instances associated with the load average metric
       <b>kernel.all.load </b>could be renamed and renumbered by the rules
       below.
           # for the Linux PMDA, the kernel.all.load metric is defined
           # over instance domain 60.2
           indom 60.2 {
               inst 1 -&gt; 60 iname "1 minute" -&gt; "60 second"
               inst 5 -&gt; 300 iname "5 minute" -&gt; "300 second"
               inst 15 -&gt; 900 iname "15 minute" -&gt; "900 second"
           }

       If we decide to split the ``proc'' metrics out of the Linux PMDA,
       this will involve changing the domain number for the PMID of
       these metrics and the associated instance domains.  The rules
       below would rewrite an old archive to match the changes after the
       PMDA split.
           # all Linux proc metrics are in 7 clusters
           metric 60.8.* { pmid -&gt; 123.*.* }
           metric 60.9.* { pmid -&gt; 123.*.* }
           metric 60.13.* { pmid -&gt; 123.*.* }
           metric 60.24.* { pmid -&gt; 123.*.* }
           metric 60.31.* { pmid -&gt; 123.*.* }
           metric 60.32.* { pmid -&gt; 123.*.* }
           metric 60.51.* { pmid -&gt; 123.*.* }
           # only one instance domain for Linux proc metrics
           indom 60.9 { indom -&gt; 123.0 }

       If the metric foo.count_em was exported as a native ``long'' then
       it could be a 32-bit integer on some platforms and a 64-bit
       integer on other platforms.  Subsequent investigations show the
       value is in fact unsigned, so the following rules could be used.
           metric foo.count_em {
                type if 32 -&gt; U32
                type if 64 -&gt; U64
           }
</pre> <h2>
DIAGNOSTICS </h2>
<pre>
       All error conditions detected by <b>pmlogrewrite </b>are reported on
       <i>stderr</i> with textual (if sometimes terse) explanation.

       Should the input archive be corrupted (this can happen if the
       <b>pmlogger </b>instance writing the archive suddenly dies), then
       <b>pmlogrewrite </b>will detect and report the position of the
       corruption in the file, and any subsequent information from that
       archive will not be processed.

       If the input archive contains no archive records then an ``empty
       archive'' warning is issued and no processing is performed.

       If any error is detected, <b>pmlogrewrite </b>will exit with a non-zero
       status.
</pre> <h2>
FILES </h2>
<pre>
       For each of the <i>inlog</i> and <i>outlog</i> archives, several physical files
       are used.

       <i>archive</i><b>.meta</b>
            metadata (metric descriptions, instance domains, etc.) for
            the archive

       <i>archive</i><b>.0</b>
            initial volume of metrics values (subsequent volumes have
            suffixes <b>1</b>, <b>2</b>, ...).

       <i>archive</i><b>.index</b>
            temporal index to support rapid random access to the other
            files in the archive.
</pre> <h2>
PCP ENVIRONMENT </h2>
<pre>
       Environment variables with the prefix <b>PCP_ </b>are used to
       parameterize the file and directory names used by PCP.  On each
       installation, the file <i>/etc/pcp.conf</i> contains the local values
       for these variables.  The <b>$PCP_CONF </b>variable may be used to
       specify an alternative configuration file, as described in
       <a href="../man5/pcp.conf.5.html">pcp.conf(5)</a>.

       For environment variables affecting PCP tools, see
       <a href="../man3/pmgetoptions.3.html">pmGetOptions(3)</a>.
</pre> <h2>
SEE ALSO </h2>
<pre>
       <a href="pcpintro.1.html">PCPIntro(1)</a>, <a href="pmlogdump.1.html">pmlogdump(1)</a>, <a href="pmlogextract.1.html">pmlogextract(1)</a>, <a href="pmlogger.1.html">pmlogger(1)</a>,
       <a href="pmloglabel.1.html">pmloglabel(1)</a>, <a href="pmlogredact.1.html">pmlogredact(1)</a>, <a href="pmlogreduce.1.html">pmlogreduce(1)</a>, <a href="../man3/pmapi.3.html">PMAPI(3)</a>,
       <a href="../man3/pmdainstance.3.html">pmdaInstance(3)</a>, <a href="../man3/pmlookupdesc.3.html">pmLookupDesc(3)</a>, <a href="../man3/tzset.3.html">tzset(3)</a>, <a href="../man5/logarchive.5.html">LOGARCHIVE(5)</a>,
       <a href="../man5/pcp.conf.5.html">pcp.conf(5)</a>, <a href="../man5/pcp.env.5.html">pcp.env(5)</a>, <a href="../man5/pmns.5.html">PMNS(5)</a> and <a href="../man7/regex.7.html">regex(7)</a>.
</pre> <h2>
COLOPHON </h2>
<pre>
       This page is part of the <i>PCP</i> (Performance Co-Pilot) project.
       Information about the project can be found at 
       ⟨<a href="http://www.pcp.io/">http://www.pcp.io/</a>⟩.  If you have a bug report for this manual
       page, send it to pcp@groups.io.  This page was obtained from the
       project's upstream Git repository
       ⟨<a href="https://github.com/performancecopilot/pcp.git">https://github.com/performancecopilot/pcp.git</a>⟩ on 2024-06-14.
       (At that time, the date of the most recent commit that was found
       in the repository was 2024-06-14.)  If you discover any rendering
       problems in this HTML version of the page, or you believe there
       is a better or more up-to-date source for the page, or you have
       corrections or improvements to the information in this COLOPHON
       (which is <i>not</i> part of the original manual page), send a mail to
       man-pages@man7.org

<span class="footline">Performance Co-Pilot                                     <i>PMLOGREWRITE</i>(1)</span>
</pre>  <p>Pages that refer to this page: <a href="pmdaperfevent.1.html">pmdaperfevent(1)</a>, <a href="pmlogcheck.1.html">pmlogcheck(1)</a>, <a href="pmlogextract.1.html">pmlogextract(1)</a>, <a href="pmlogger_daily.1.html">pmlogger_daily(1)</a>, <a href="pmlogger_rewrite.1.html">pmlogger_rewrite(1)</a>, <a href="pmloglabel.1.html">pmloglabel(1)</a>, <a href="pmlogredact.1.html">pmlogredact(1)</a>, <a href="../man3/pmdainit.3.html">pmdainit(3)</a>, <a href="../man3/pmnewcontext.3.html">pmnewcontext(3)</a>, <a href="../man5/logarchive.5.html">LOGARCHIVE(5)</a> </p> <hr>         <div class="_attribution">
  <p class="_attribution-p">
    ...<br>
    <a href="https://man7.org/linux/man-pages/man1/pmlogrewrite.1.html" class="_attribution-link">https://man7.org/linux/man-pages/man1/pmlogrewrite.1.html</a>
  </p>
</div>
