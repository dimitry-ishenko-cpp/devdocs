<h1>resolver(3) — Linux manual page</h1>   <pre>
<span class="headline"><i>resolver</i>(3)             Library Functions Manual             <i>resolver</i>(3)</span>
</pre> <h2>
NAME </h2>
<pre>
       res_ninit, res_nquery, res_nsearch, res_nquerydomain,
       res_nmkquery, res_nsend, res_nclose, res_init, res_query,
       res_search, res_querydomain, res_mkquery, res_send, dn_comp,
       dn_expand - resolver routines
</pre> <h2>
LIBRARY </h2>
<pre>
       Resolver library (<i>libresolv</i>, <i>-lresolv</i>)
</pre> <h2>
SYNOPSIS </h2>
<pre>
       <b>#include &lt;netinet/in.h&gt;</b>
       <b>#include &lt;arpa/nameser.h&gt;</b>
       <b>#include &lt;resolv.h&gt;</b>

       <b>struct __res_state;</b>
       <b>typedef struct __res_state *res_state;</b>

       <b>int res_ninit(res_state </b><i>statep</i><b>);</b>

       <b>void res_nclose(res_state </b><i>statep</i><b>);</b>

       <b>int res_nquery(res_state </b><i>statep</i><b>,</b>
                  <b>const char *</b><i>dname</i><b>, int </b><i>class</i><b>, int </b><i>type</i><b>,</b>
                  <b>unsigned char </b><i>answer</i><b>[.</b><i>anslen</i><b>], int </b><i>anslen</i><b>);</b>

       <b>int res_nsearch(res_state </b><i>statep</i><b>,</b>
                  <b>const char *</b><i>dname</i><b>, int </b><i>class</i><b>, int </b><i>type</i><b>,</b>
                  <b>unsigned char </b><i>answer</i><b>[.</b><i>anslen</i><b>], int </b><i>anslen</i><b>);</b>

       <b>int res_nquerydomain(res_state </b><i>statep</i><b>,</b>
                  <b>const char *</b><i>name</i><b>, const char *</b><i>domain</i><b>,</b>
                  <b>int </b><i>class</i><b>, int </b><i>type</i><b>, unsigned char </b><i>answer</i><b>[.</b><i>anslen</i><b>],</b>
                  <b>int </b><i>anslen</i><b>);</b>

       <b>int res_nmkquery(res_state </b><i>statep</i><b>,</b>
                  <b>int </b><i>op</i><b>, const char *</b><i>dname</i><b>, int </b><i>class</i><b>,</b>
                  <b>int </b><i>type</i><b>, const unsigned char </b><i>data</i><b>[.</b><i>datalen</i><b>], int </b><i>datalen</i><b>,</b>
                  <b>const unsigned char *</b><i>newrr</i><b>,</b>
                  <b>unsigned char </b><i>buf</i><b>[.</b><i>buflen</i><b>], int </b><i>buflen</i><b>);</b>

       <b>int res_nsend(res_state </b><i>statep</i><b>,</b>
                  <b>const unsigned char </b><i>msg</i><b>[.</b><i>msglen</i><b>], int </b><i>msglen</i><b>,</b>
                  <b>unsigned char </b><i>answer</i><b>[.</b><i>anslen</i><b>], int </b><i>anslen</i><b>);</b>

       <b>int dn_comp(const char *</b><i>exp_dn</i><b>, unsigned char </b><i>comp_dn</i><b>[.</b><i>length</i><b>],</b>
                  <b>int </b><i>length</i><b>, unsigned char **</b><i>dnptrs</i><b>,</b>
                  <b>unsigned char **</b><i>lastdnptr</i><b>);</b>

       <b>int dn_expand(const unsigned char *</b><i>msg</i><b>,</b>
                  <b>const unsigned char *</b><i>eomorig</i><b>,</b>
                  <b>const unsigned char *</b><i>comp_dn</i><b>, char </b><i>exp_dn</i><b>[.</b><i>length</i><b>],</b>
                  <b>int </b><i>length</i><b>);</b>

       <b>[[deprecated]] extern struct __res_state _res;</b>

       <b>[[deprecated]] int res_init(void);</b>

       <b>[[deprecated]]</b>
       <b>int res_query(const char *</b><i>dname</i><b>, int </b><i>class</i><b>, int </b><i>type</i><b>,</b>
                  <b>unsigned char </b><i>answer</i><b>[.</b><i>anslen</i><b>], int </b><i>anslen</i><b>);</b>

       <b>[[deprecated]]</b>
       <b>int res_search(const char *</b><i>dname</i><b>, int </b><i>class</i><b>, int </b><i>type</i><b>,</b>
                  <b>unsigned char </b><i>answer</i><b>[.</b><i>anslen</i><b>], int </b><i>anslen</i><b>);</b>

       <b>[[deprecated]]</b>
       <b>int res_querydomain(const char *</b><i>name</i><b>, const char *</b><i>domain</i><b>,</b>
                  <b>int </b><i>class</i><b>, int </b><i>type</i><b>, unsigned char </b><i>answer</i><b>[.</b><i>anslen</i><b>],</b>
                  <b>int </b><i>anslen</i><b>);</b>

       <b>[[deprecated]]</b>
       <b>int res_mkquery(int </b><i>op</i><b>, const char *</b><i>dname</i><b>, int </b><i>class</i><b>,</b>
                  <b>int </b><i>type</i><b>, const unsigned char </b><i>data</i><b>[.</b><i>datalen</i><b>], int </b><i>datalen</i><b>,</b>
                  <b>const unsigned char *</b><i>newrr</i><b>,</b>
                  <b>unsigned char </b><i>buf</i><b>[.</b><i>buflen</i><b>], int </b><i>buflen</i><b>);</b>

       <b>[[deprecated]]</b>
       <b>int res_send(const unsigned char </b><i>msg</i><b>[.</b><i>msglen</i><b>], int </b><i>msglen</i><b>,</b>
                  <b>unsigned char </b><i>answer</i><b>[.</b><i>anslen</i><b>], int </b><i>anslen</i><b>);</b>
</pre> <h2>
DESCRIPTION </h2>
<pre>
       <b>Note: </b>This page is incomplete (various resolver functions
       provided by glibc are not described) and likely out of date.

       The functions described below make queries to and interpret the
       responses from Internet domain name servers.

       The API consists of a set of more modern, reentrant functions and
       an older set of nonreentrant functions that have been superseded.
       The traditional resolver interfaces such as <b>res_init</b>() and
       <b>res_query</b>() use some static (global) state stored in the <i>_res</i>
       structure, rendering these functions non-thread-safe.  BIND 8.2
       introduced a set of new interfaces <b>res_ninit</b>(), <b>res_nquery</b>(), and
       so on, which take a <i>res_state</i> as their first argument, so you can
       use a per-thread resolver state.

       The <b>res_ninit</b>() and <b>res_init</b>() functions read the configuration
       files (see <a href="../man5/resolv.conf.5.html">resolv.conf(5)</a>) to get the default domain name and
       name server address(es).  If no server is given, the local host
       is tried.  If no domain is given, that associated with the local
       host is used.  It can be overridden with the environment variable
       <b>LOCALDOMAIN</b>.  <b>res_ninit</b>() or <b>res_init</b>() is normally executed by
       the first call to one of the other functions.  Every call to
       <b>res_ninit</b>() requires a corresponding call to <b>res_nclose</b>() to free
       memory allocated by <b>res_ninit</b>() and subsequent calls to
       <b>res_nquery</b>().

       The <b>res_nquery</b>() and <b>res_query</b>() functions query the name server
       for the fully qualified domain name <i>name</i> of specified <i>type</i> and
       <i>class</i>.  The reply is left in the buffer <i>answer</i> of length <i>anslen</i>
       supplied by the caller.

       The <b>res_nsearch</b>() and <b>res_search</b>() functions make a query and
       waits for the response like <b>res_nquery</b>() and <b>res_query</b>(), but in
       addition they implement the default and search rules controlled
       by <b>RES_DEFNAMES </b>and <b>RES_DNSRCH </b>(see description of <i>_res</i> options
       below).

       The <b>res_nquerydomain</b>() and <b>res_querydomain</b>() functions make a
       query using <b>res_nquery</b>()/<b>res_query</b>() on the concatenation of <i>name</i>
       and <i>domain</i>.

       The following functions are lower-level routines used by
       <b>res_nquery</b>()/<b>res_query</b>().

       The <b>res_nmkquery</b>() and <b>res_mkquery</b>() functions construct a query
       message in <i>buf</i> of length <i>buflen</i> for the domain name <i>dname</i>.  The
       query type <i>op</i> is one of the following (typically <b>QUERY</b>):

       <b>QUERY  </b>Standard query.

       <b>IQUERY </b>Inverse query.  This option was removed in glibc 2.26,
              since it has not been supported by DNS servers for a very
              long time.

       <b>NS_NOTIFY_OP</b>
              Notify secondary of SOA (Start of Authority) change.

       <i>newrr</i> is currently unused.

       The <b>res_nsend</b>() and <b>res_send</b>() function send a preformatted query
       given in <i>msg</i> of length <i>msglen</i> and returns the answer in <i>answer</i>
       which is of length <i>anslen</i>.  They will call <b>res_ninit</b>()/<b>res_init</b>()
       if it has not already been called.

       The <b>dn_comp</b>() function compresses the domain name <i>exp_dn</i> and
       stores it in the buffer <i>comp_dn</i> of length <i>length</i>.  The
       compression uses an array of pointers <i>dnptrs</i> to previously
       compressed names in the current message.  The first pointer
       points to the beginning of the message and the list ends with
       NULL.  The limit of the array is specified by <i>lastdnptr</i>.  If
       <i>dnptr</i> is NULL, domain names are not compressed.  If <i>lastdnptr</i> is
       NULL, the list of labels is not updated.

       The <b>dn_expand</b>() function expands the compressed domain name
       <i>comp_dn</i> to a full domain name, which is placed in the buffer
       <i>exp_dn</i> of size <i>length</i>.  The compressed name is contained in a
       query or reply message, and <i>msg</i> points to the beginning of the
       message.

       The resolver routines use configuration and state information
       contained in a <i>__res_state</i> structure (either passed as the <i>statep</i>
       argument, or in the global variable <i>_res</i>, in the case of the
       older nonreentrant functions).  The only field of this structure
       that is normally manipulated by the user is the <i>options</i> field.
       This field can contain the bitwise "OR" of the following options:

       <b>RES_INIT</b>
              True if <b>res_ninit</b>() or <b>res_init</b>() has been called.

       <b>RES_DEBUG</b>
              Print debugging messages.  This option is available only
              if glibc was built with debugging enabled, which is not
              the default.

       <b>RES_AAONLY </b>(unimplemented; deprecated in glibc 2.25)
              Accept authoritative answers only.  <b>res_send</b>() continues
              until it finds an authoritative answer or returns an
              error.  This option was present but unimplemented until
              glibc 2.24; since glibc 2.25, it is deprecated, and its
              usage produces a warning.

       <b>RES_USEVC</b>
              Use TCP connections for queries rather than UDP datagrams.

       <b>RES_PRIMARY </b>(unimplemented; deprecated in glibc 2.25)
              Query primary domain name server only.  This option was
              present but unimplemented until glibc 2.24; since glibc
              2.25, it is deprecated, and its usage produces a warning.

       <b>RES_IGNTC</b>
              Ignore truncation errors.  Don't retry with TCP.

       <b>RES_RECURSE</b>
              Set the recursion desired bit in queries.  Recursion is
              carried out by the domain name server, not by <b>res_send</b>().
              [Enabled by default].

       <b>RES_DEFNAMES</b>
              If set, <b>res_search</b>() will append the default domain name
              to single component names—that is, those that do not
              contain a dot.  [Enabled by default].

       <b>RES_STAYOPEN</b>
              Used with <b>RES_USEVC </b>to keep the TCP connection open
              between queries.

       <b>RES_DNSRCH</b>
              If set, <b>res_search</b>() will search for hostnames in the
              current domain and in parent domains.  This option is used
              by <a href="gethostbyname.3.html">gethostbyname(3)</a>.  [Enabled by default].

       <b>RES_INSECURE1</b>
              Accept a response from a wrong server.  This can be used
              to detect potential security hazards, but you need to
              compile glibc with debugging enabled and use <b>RES_DEBUG</b>
              option (for debug purpose only).

       <b>RES_INSECURE2</b>
              Accept a response which contains a wrong query.  This can
              be used to detect potential security hazards, but you need
              to compile glibc with debugging enabled and use <b>RES_DEBUG</b>
              option (for debug purpose only).

       <b>RES_NOALIASES</b>
              Disable usage of <b>HOSTALIASES </b>environment variable.

       <b>RES_USE_INET6</b>
              Try an AAAA query before an A query inside the
              <a href="gethostbyname.3.html">gethostbyname(3)</a> function, and map IPv4 responses in IPv6
              "tunneled form" if no AAAA records are found but an A
              record set exists.  Since glibc 2.25, this option is
              deprecated, and its usage produces a warning; applications
              should use <a href="getaddrinfo.3.html">getaddrinfo(3)</a>, rather than <a href="gethostbyname.3.html">gethostbyname(3)</a>.

       <b>RES_ROTATE</b>
              Causes round-robin selection of name servers from among
              those listed.  This has the effect of spreading the query
              load among all listed servers, rather than having all
              clients try the first listed server first every time.

       <b>RES_NOCHECKNAME </b>(unimplemented; deprecated in glibc 2.25)
              Disable the modern BIND checking of incoming hostnames and
              mail names for invalid characters such as underscore (_),
              non-ASCII, or control characters.  This option was present
              until glibc 2.24; since glibc 2.25, it is deprecated, and
              its usage produces a warning.

       <b>RES_KEEPTSIG </b>(unimplemented; deprecated in glibc 2.25)
              Do not strip TSIG records.  This option was present but
              unimplemented until glibc 2.24; since glibc 2.25, it is
              deprecated, and its usage produces a warning.

       <b>RES_BLAST </b>(unimplemented; deprecated in glibc 2.25)
              Send each query simultaneously and recursively to all
              servers.  This option was present but unimplemented until
              glibc 2.24; since glibc 2.25, it is deprecated, and its
              usage produces a warning.

       <b>RES_USEBSTRING </b>(glibc 2.3.4 to glibc 2.24)
              Make reverse IPv6 lookups using the bit-label format
              described in RFC 2673; if this option is not set (which is
              the default), then nibble format is used.  This option was
              removed in glibc 2.25, since it relied on a backward-
              incompatible DNS extension that was never deployed on the
              Internet.

       <b>RES_NOIP6DOTINT </b>(glibc 2.24 and earlier)
              Use <i>ip6.arpa</i> zone in IPv6 reverse lookup instead of
              <i>ip6.int</i>, which is deprecated since glibc 2.3.4.  This
              option is present up to and including glibc 2.24, where it
              is enabled by default.  In glibc 2.25, this option was
              removed.

       <b>RES_USE_EDNS0 </b>(since glibc 2.6)
              Enables support for the DNS extensions (EDNS0) described
              in RFC 2671.

       <b>RES_SNGLKUP </b>(since glibc 2.10)
              By default, glibc performs IPv4 and IPv6 lookups in
              parallel since glibc 2.9.  Some appliance DNS servers
              cannot handle these queries properly and make the requests
              time out.  This option disables the behavior and makes
              glibc perform the IPv6 and IPv4 requests sequentially (at
              the cost of some slowdown of the resolving process).

       <b>RES_SNGLKUPREOP</b>
              When <b>RES_SNGLKUP </b>option is enabled, opens a new socket for
              the each request.

       <b>RES_USE_DNSSEC</b>
              Use DNSSEC with OK bit in OPT record.  This option implies
              <b>RES_USE_EDNS0</b>.

       <b>RES_NOTLDQUERY</b>
              Do not look up unqualified name as a top-level domain
              (TLD).

       <b>RES_DEFAULT</b>
              Default option which implies: <b>RES_RECURSE</b>, <b>RES_DEFNAMES</b>,
              <b>RES_DNSRCH</b>, and <b>RES_NOIP6DOTINT</b>.
</pre> <h2>
RETURN VALUE </h2>
<pre>
       The <b>res_ninit</b>() and <b>res_init</b>() functions return 0 on success, or
       -1 if an error occurs.

       The <b>res_nquery</b>(), <b>res_query</b>(), <b>res_nsearch</b>(), <b>res_search</b>(),
       <b>res_nquerydomain</b>(), <b>res_querydomain</b>(), <b>res_nmkquery</b>(),
       <b>res_mkquery</b>(), <b>res_nsend</b>(), and <b>res_send</b>() functions return the
       length of the response, or -1 if an error occurs.

       The <b>dn_comp</b>() and <b>dn_expand</b>() functions return the length of the
       compressed name, or -1 if an error occurs.

       In the case of an error return from <b>res_nquery</b>(), <b>res_query</b>(),
       <b>res_nsearch</b>(), <b>res_search</b>(), <b>res_nquerydomain</b>(), or
       <b>res_querydomain</b>(), the global variable <i>h_errno</i> (see
       <a href="gethostbyname.3.html">gethostbyname(3)</a>) can be consulted to determine the cause of the
       error.
</pre> <h2>
FILES </h2>
<pre>
       <i>/etc/resolv.conf</i>
              resolver configuration file

       <i>/etc/host.conf</i>
              resolver configuration file
</pre> <h2>
ATTRIBUTES </h2>
<pre>
       For an explanation of the terms used in this section, see
       <a href="../man7/attributes.7.html">attributes(7)</a>.
       ┌──────────────────────────────┬───────────────┬────────────────┐
       │ <b>Interface                    </b>│ <b>Attribute     </b>│ <b>Value          </b>│
       ├──────────────────────────────┼───────────────┼────────────────┤
       │ <b>res_ninit</b>(), <b>res_nclose</b>(),   │ Thread safety │ MT-Safe locale │
       │ <b>res_nquery</b>(), <b>res_nsearch</b>(), │               │                │
       │ <b>res_nquerydomain</b>(),          │               │                │
       │ <b>res_nsend</b>()                  │               │                │
       ├──────────────────────────────┼───────────────┼────────────────┤
       │ <b>res_nmkquery</b>(), <b>dn_comp</b>(),   │ Thread safety │ MT-Safe        │
       │ <b>dn_expand</b>()                  │               │                │
       └──────────────────────────────┴───────────────┴────────────────┘
</pre> <h2>
STANDARDS </h2>
<pre>
       None.
</pre> <h2>
HISTORY </h2>
<pre>
       4.3BSD.
</pre> <h2>
SEE ALSO </h2>
<pre>
       <a href="gethostbyname.3.html">gethostbyname(3)</a>, <a href="../man5/resolv.conf.5.html">resolv.conf(5)</a>, <a href="../man5/resolver.5.html">resolver(5)</a>, <a href="../man7/hostname.7.html">hostname(7)</a>,
       <b>named</b>(8)

       The GNU C library source file <i>resolv/README</i>.
</pre> <h2>
COLOPHON </h2>
<pre>
       This page is part of the <i>man-pages</i> (Linux kernel and C library
       user-space interface documentation) project.  Information about
       the project can be found at 
       ⟨<a href="https://www.kernel.org/doc/man-pages/">https://www.kernel.org/doc/man-pages/</a>⟩.  If you have a bug report
       for this manual page, see
       ⟨<a href="https://git.kernel.org/pub/scm/docs/man-pages/man-pages.git/tree/CONTRIBUTING">https://git.kernel.org/pub/scm/docs/man-pages/man-pages.git/tree/CONTRIBUTING</a>⟩.
       This page was obtained from the tarball man-pages-6.9.1.tar.gz
       fetched from
       ⟨<a href="https://mirrors.edge.kernel.org/pub/linux/docs/man-pages/">https://mirrors.edge.kernel.org/pub/linux/docs/man-pages/</a>⟩ on
       2024-06-26.  If you discover any rendering problems in this HTML
       version of the page, or you believe there is a better or more up-
       to-date source for the page, or you have corrections or
       improvements to the information in this COLOPHON (which is <i>not</i>
       part of the original manual page), send a mail to
       man-pages@man7.org

<span class="footline">Linux man-pages 6.9.1          2024-05-02                    <i>resolver</i>(3)</span>
</pre>  <p>Pages that refer to this page: <a href="../man1/hostname.1.html">hostname(1)</a>, <a href="../man1/pmdanetcheck.1.html">pmdanetcheck(1)</a>, <a href="gethostbyname.3.html">gethostbyname(3)</a>, <a href="../man5/hosts.5.html">hosts(5)</a>, <a href="../man5/resolv.conf.5.html">resolv.conf(5)</a> </p> <hr>         <div class="_attribution">
  <p class="_attribution-p">
    ...<br>
    <a href="https://man7.org/linux/man-pages/man3/res_nsearch.3.html" class="_attribution-link">https://man7.org/linux/man-pages/man3/res_nsearch.3.html</a>
  </p>
</div>
