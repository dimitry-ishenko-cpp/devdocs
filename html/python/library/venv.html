 <span id="venv-creation-of-virtual-environments"></span><h1>venv — Creation of virtual environments</h1> <div class="versionadded"> <p><span class="versionmodified added">Added in version 3.3.</span></p> </div> <p><strong>Source code:</strong> <a class="extlink-source reference external" href="https://github.com/python/cpython/tree/3.13/Lib/venv/">Lib/venv/</a></p>  <p id="venv-intro"><span id="venv-def"></span>The <code>venv</code> module supports creating lightweight “virtual environments”, each with their own independent set of Python packages installed in their <a class="reference internal" href="site.html#module-site" title="site: Module responsible for site-specific configuration."><code>site</code></a> directories. A virtual environment is created on top of an existing Python installation, known as the virtual environment’s “base” Python, and may optionally be isolated from the packages in the base environment, so only those explicitly installed in the virtual environment are available.</p> <p>When used from within a virtual environment, common installation tools such as <a class="extlink-pypi reference external" href="https://pypi.org/project/pip/">pip</a> will install Python packages into a virtual environment without needing to be told to do so explicitly.</p> <p>A virtual environment is (amongst other things):</p> <ul class="simple"> <li>Used to contain a specific Python interpreter and software libraries and binaries which are needed to support a project (library or application). These are by default isolated from software in other virtual environments and Python interpreters and libraries installed in the operating system.</li> <li>Contained in a directory, conventionally either named <code>venv</code> or <code>.venv</code> in the project directory, or under a container directory for lots of virtual environments, such as <code>~/.virtualenvs</code>.</li> <li>Not checked into source control systems such as Git.</li> <li>Considered as disposable – it should be simple to delete and recreate it from scratch. You don’t place any project code in the environment</li> <li>Not considered as movable or copyable – you just recreate the same environment in the target location.</li> </ul> <p>See <span class="target" id="index-1"></span><a class="pep reference external" href="https://peps.python.org/pep-0405/"><strong>PEP 405</strong></a> for more background on Python virtual environments.</p> <div class="admonition seealso"> <p class="admonition-title">See also</p> <p><a class="reference external" href="https://packaging.python.org/guides/installing-using-pip-and-virtual-environments/#create-and-use-virtual-environments">Python Packaging User Guide: Creating and using virtual environments</a></p> </div> <div class="availability docutils container"> <p><a class="reference internal" href="https://docs.python.org/3.13/library/intro.html#availability"><span class="std std-ref">Availability</span></a>: not WASI, not iOS.</p> <p>This module does not work or is not available on WebAssembly platforms, or on iOS. See <a class="reference internal" href="https://docs.python.org/3.13/library/intro.html#wasm-availability"><span class="std std-ref">WebAssembly platforms</span></a> for more information on WASM availability; see <a class="reference internal" href="https://docs.python.org/3.13/library/intro.html#ios-availability"><span class="std std-ref">iOS</span></a> for more information on iOS availability.</p> </div> <section id="creating-virtual-environments"> <h2>Creating virtual environments</h2> <p>Creation of <a class="reference internal" href="#venv-def"><span class="std std-ref">virtual environments</span></a> is done by executing the command <code>venv</code>:</p> <pre data-language="python">python -m venv /path/to/new/virtual/environment
</pre> <p>Running this command creates the target directory (creating any parent directories that don’t exist already) and places a <code>pyvenv.cfg</code> file in it with a <code>home</code> key pointing to the Python installation from which the command was run (a common name for the target directory is <code>.venv</code>). It also creates a <code>bin</code> (or <code>Scripts</code> on Windows) subdirectory containing a copy/symlink of the Python binary/binaries (as appropriate for the platform or arguments used at environment creation time). It also creates an (initially empty) <code>lib/pythonX.Y/site-packages</code> subdirectory (on Windows, this is <code>Lib\site-packages</code>). If an existing directory is specified, it will be re-used.</p> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 3.5: </span>The use of <code>venv</code> is now recommended for creating virtual environments.</p> </div> <div class="deprecated"> <p><span class="versionmodified deprecated">Deprecated since version 3.6: </span><code>pyvenv</code> was the recommended tool for creating virtual environments for Python 3.3 and 3.4, and is <a class="reference internal" href="https://docs.python.org/3.13/whatsnew/3.6.html#whatsnew36-venv"><span class="std std-ref">deprecated in Python 3.6</span></a>.</p> </div> <p>On Windows, invoke the <code>venv</code> command as follows:</p> <pre data-language="none">c:\&gt;Python35\python -m venv c:\path\to\myenv
</pre> <p>Alternatively, if you configured the <code>PATH</code> and <code>PATHEXT</code> variables for your <a class="reference internal" href="../using/windows.html#using-on-windows"><span class="std std-ref">Python installation</span></a>:</p> <pre data-language="none">c:\&gt;python -m venv c:\path\to\myenv
</pre> <p>The command, if run with <code>-h</code>, will show the available options:</p> <pre data-language="none">usage: venv [-h] [--system-site-packages] [--symlinks | --copies] [--clear]
            [--upgrade] [--without-pip] [--prompt PROMPT] [--upgrade-deps]
            [--without-scm-ignore-file]
            ENV_DIR [ENV_DIR ...]

Creates virtual Python environments in one or more target directories.

positional arguments:
ENV_DIR               A directory to create the environment in.

options:
-h, --help            show this help message and exit
--system-site-packages
                        Give the virtual environment access to the system
                        site-packages dir.
--symlinks            Try to use symlinks rather than copies, when
                        symlinks are not the default for the platform.
--copies              Try to use copies rather than symlinks, even when
                        symlinks are the default for the platform.
--clear               Delete the contents of the environment directory if
                        it already exists, before environment creation.
--upgrade             Upgrade the environment directory to use this
                        version of Python, assuming Python has been upgraded
                        in-place.
--without-pip         Skips installing or upgrading pip in the virtual
                        environment (pip is bootstrapped by default)
--prompt PROMPT       Provides an alternative prompt prefix for this
                        environment.
--upgrade-deps        Upgrade core dependencies (pip) to the latest
                        version in PyPI
--without-scm-ignore-file
                        Skips adding the default SCM ignore file to the
                        environment directory (the default is a .gitignore
                        file).

Once an environment has been created, you may wish to activate it, e.g. by
sourcing an activate script in its bin directory.
</pre> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 3.13: </span><code>--without-scm-ignore-file</code> was added along with creating an ignore file for <code>git</code> by default.</p> </div> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 3.12: </span><code>setuptools</code> is no longer a core venv dependency.</p> </div> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 3.9: </span>Add <code>--upgrade-deps</code> option to upgrade pip + setuptools to the latest on PyPI</p> </div> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 3.4: </span>Installs pip by default, added the <code>--without-pip</code> and <code>--copies</code> options</p> </div> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 3.4: </span>In earlier versions, if the target directory already existed, an error was raised, unless the <code>--clear</code> or <code>--upgrade</code> option was provided.</p> </div> <div class="admonition note"> <p class="admonition-title">Note</p> <p>While symlinks are supported on Windows, they are not recommended. Of particular note is that double-clicking <code>python.exe</code> in File Explorer will resolve the symlink eagerly and ignore the virtual environment.</p> </div> <div class="admonition note"> <p class="admonition-title">Note</p> <p>On Microsoft Windows, it may be required to enable the <code>Activate.ps1</code> script by setting the execution policy for the user. You can do this by issuing the following PowerShell command:</p> <p>PS C:&gt; Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser</p> <p>See <a class="reference external" href="https://go.microsoft.com/fwlink/?LinkID=135170">About Execution Policies</a> for more information.</p> </div> <p>The created <code>pyvenv.cfg</code> file also includes the <code>include-system-site-packages</code> key, set to <code>true</code> if <code>venv</code> is run with the <code>--system-site-packages</code> option, <code>false</code> otherwise.</p> <p>Unless the <code>--without-pip</code> option is given, <a class="reference internal" href="ensurepip.html#module-ensurepip" title='ensurepip: Bootstrapping the "pip" installer into an existing Python installation or virtual environment.'><code>ensurepip</code></a> will be invoked to bootstrap <code>pip</code> into the virtual environment.</p> <p>Multiple paths can be given to <code>venv</code>, in which case an identical virtual environment will be created, according to the given options, at each provided path.</p> </section> <section id="how-venvs-work"> <span id="venv-explanation"></span><h2>How venvs work</h2> <p>When a Python interpreter is running from a virtual environment, <a class="reference internal" href="sys.html#sys.prefix" title="sys.prefix"><code>sys.prefix</code></a> and <a class="reference internal" href="sys.html#sys.exec_prefix" title="sys.exec_prefix"><code>sys.exec_prefix</code></a> point to the directories of the virtual environment, whereas <a class="reference internal" href="sys.html#sys.base_prefix" title="sys.base_prefix"><code>sys.base_prefix</code></a> and <a class="reference internal" href="sys.html#sys.base_exec_prefix" title="sys.base_exec_prefix"><code>sys.base_exec_prefix</code></a> point to those of the base Python used to create the environment. It is sufficient to check <code>sys.prefix != sys.base_prefix</code> to determine if the current interpreter is running from a virtual environment.</p> <p>A virtual environment may be “activated” using a script in its binary directory (<code>bin</code> on POSIX; <code>Scripts</code> on Windows). This will prepend that directory to your <span class="target" id="index-2"></span><code>PATH</code>, so that running <strong class="program">python</strong> will invoke the environment’s Python interpreter and you can run installed scripts without having to use their full path. The invocation of the activation script is platform-specific (<code><em>&lt;venv&gt;</em></code> must be replaced by the path to the directory containing the virtual environment):</p> <table class="docutils align-default"> <thead> <tr>
<th class="head"><p>Platform</p></th> <th class="head"><p>Shell</p></th> <th class="head"><p>Command to activate virtual environment</p></th> </tr> </thead>  <tr>
<td rowspan="4"><p>POSIX</p></td> <td><p>bash/zsh</p></td> <td><p><code>$ source <em>&lt;venv&gt;</em>/bin/activate</code></p></td> </tr> <tr>
<td><p>fish</p></td> <td><p><code>$ source <em>&lt;venv&gt;</em>/bin/activate.fish</code></p></td> </tr> <tr>
<td><p>csh/tcsh</p></td> <td><p><code>$ source <em>&lt;venv&gt;</em>/bin/activate.csh</code></p></td> </tr> <tr>
<td><p>PowerShell</p></td> <td><p><code>$ <em>&lt;venv&gt;</em>/bin/Activate.ps1</code></p></td> </tr> <tr>
<td rowspan="2"><p>Windows</p></td> <td><p>cmd.exe</p></td> <td><p><code>C:\&gt; <em>&lt;venv&gt;</em>\Scripts\activate.bat</code></p></td> </tr> <tr>
<td><p>PowerShell</p></td> <td><p><code>PS C:\&gt; <em>&lt;venv&gt;</em>\Scripts\Activate.ps1</code></p></td> </tr>  </table> <div class="versionadded"> <p><span class="versionmodified added">Added in version 3.4: </span><strong class="program">fish</strong> and <strong class="program">csh</strong> activation scripts.</p> </div> <div class="versionadded"> <p><span class="versionmodified added">Added in version 3.8: </span>PowerShell activation scripts installed under POSIX for PowerShell Core support.</p> </div> <p>You don’t specifically <em>need</em> to activate a virtual environment, as you can just specify the full path to that environment’s Python interpreter when invoking Python. Furthermore, all scripts installed in the environment should be runnable without activating it.</p> <p>In order to achieve this, scripts installed into virtual environments have a “shebang” line which points to the environment’s Python interpreter, i.e. <code>#!/<em>&lt;path-to-venv&gt;</em>/bin/python</code>. This means that the script will run with that interpreter regardless of the value of <span class="target" id="index-3"></span><code>PATH</code>. On Windows, “shebang” line processing is supported if you have the <a class="reference internal" href="../using/windows.html#launcher"><span class="std std-ref">Python Launcher for Windows</span></a> installed. Thus, double-clicking an installed script in a Windows Explorer window should run it with the correct interpreter without the environment needing to be activated or on the <span class="target" id="index-4"></span><code>PATH</code>.</p> <p>When a virtual environment has been activated, the <code>VIRTUAL_ENV</code> environment variable is set to the path of the environment. Since explicitly activating a virtual environment is not required to use it, <code>VIRTUAL_ENV</code> cannot be relied upon to determine whether a virtual environment is being used.</p> <div class="admonition warning"> <p class="admonition-title">Warning</p> <p>Because scripts installed in environments should not expect the environment to be activated, their shebang lines contain the absolute paths to their environment’s interpreters. Because of this, environments are inherently non-portable, in the general case. You should always have a simple means of recreating an environment (for example, if you have a requirements file <code>requirements.txt</code>, you can invoke <code>pip install -r
requirements.txt</code> using the environment’s <code>pip</code> to install all of the packages needed by the environment). If for any reason you need to move the environment to a new location, you should recreate it at the desired location and delete the one at the old location. If you move an environment because you moved a parent directory of it, you should recreate the environment in its new location. Otherwise, software installed into the environment may not work as expected.</p> </div> <p>You can deactivate a virtual environment by typing <code>deactivate</code> in your shell. The exact mechanism is platform-specific and is an internal implementation detail (typically, a script or shell function will be used).</p> </section> <section id="api"> <span id="venv-api"></span><h2>API</h2> <p>The high-level method described above makes use of a simple API which provides mechanisms for third-party virtual environment creators to customize environment creation according to their needs, the <a class="reference internal" href="#venv.EnvBuilder" title="venv.EnvBuilder"><code>EnvBuilder</code></a> class.</p> <dl class="py class"> <dt class="sig sig-object py" id="venv.EnvBuilder">
<code>class venv.EnvBuilder(system_site_packages=False, clear=False, symlinks=False, upgrade=False, with_pip=False, prompt=None, upgrade_deps=False, *, scm_ignore_files=frozenset())</code> </dt> <dd>
<p>The <a class="reference internal" href="#venv.EnvBuilder" title="venv.EnvBuilder"><code>EnvBuilder</code></a> class accepts the following keyword arguments on instantiation:</p> <ul class="simple"> <li>
<code>system_site_packages</code> – a Boolean value indicating that the system Python site-packages should be available to the environment (defaults to <code>False</code>).</li> <li>
<code>clear</code> – a Boolean value which, if true, will delete the contents of any existing target directory, before creating the environment.</li> <li>
<code>symlinks</code> – a Boolean value indicating whether to attempt to symlink the Python binary rather than copying.</li> <li>
<code>upgrade</code> – a Boolean value which, if true, will upgrade an existing environment with the running Python - for use when that Python has been upgraded in-place (defaults to <code>False</code>).</li> <li>
<code>with_pip</code> – a Boolean value which, if true, ensures pip is installed in the virtual environment. This uses <a class="reference internal" href="ensurepip.html#module-ensurepip" title='ensurepip: Bootstrapping the "pip" installer into an existing Python installation or virtual environment.'><code>ensurepip</code></a> with the <code>--default-pip</code> option.</li> <li>
<code>prompt</code> – a String to be used after virtual environment is activated (defaults to <code>None</code> which means directory name of the environment would be used). If the special string <code>"."</code> is provided, the basename of the current directory is used as the prompt.</li> <li>
<code>upgrade_deps</code> – Update the base venv modules to the latest on PyPI</li> <li>
<code>scm_ignore_files</code> – Create ignore files based for the specified source control managers (SCM) in the iterable. Support is defined by having a method named <code>create_{scm}_ignore_file</code>. The only value supported by default is <code>"git"</code> via <a class="reference internal" href="#venv.EnvBuilder.create_git_ignore_file" title="venv.EnvBuilder.create_git_ignore_file"><code>create_git_ignore_file()</code></a>.</li> </ul> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 3.4: </span>Added the <code>with_pip</code> parameter</p> </div> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 3.6: </span>Added the <code>prompt</code> parameter</p> </div> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 3.9: </span>Added the <code>upgrade_deps</code> parameter</p> </div> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 3.13: </span>Added the <code>scm_ignore_files</code> parameter</p> </div> <p>Creators of third-party virtual environment tools will be free to use the provided <a class="reference internal" href="#venv.EnvBuilder" title="venv.EnvBuilder"><code>EnvBuilder</code></a> class as a base class.</p> <p>The returned env-builder is an object which has a method, <code>create</code>:</p> <dl class="py method"> <dt class="sig sig-object py" id="venv.EnvBuilder.create">
<code>create(env_dir)</code> </dt> <dd>
<p>Create a virtual environment by specifying the target directory (absolute or relative to the current directory) which is to contain the virtual environment. The <code>create</code> method will either create the environment in the specified directory, or raise an appropriate exception.</p> <p>The <code>create</code> method of the <a class="reference internal" href="#venv.EnvBuilder" title="venv.EnvBuilder"><code>EnvBuilder</code></a> class illustrates the hooks available for subclass customization:</p> <pre data-language="python">def create(self, env_dir):
    """
    Create a virtualized Python environment in a directory.
    env_dir is the target directory to create an environment in.
    """
    env_dir = os.path.abspath(env_dir)
    context = self.ensure_directories(env_dir)
    self.create_configuration(context)
    self.setup_python(context)
    self.setup_scripts(context)
    self.post_setup(context)
</pre> <p>Each of the methods <a class="reference internal" href="#venv.EnvBuilder.ensure_directories" title="venv.EnvBuilder.ensure_directories"><code>ensure_directories()</code></a>, <a class="reference internal" href="#venv.EnvBuilder.create_configuration" title="venv.EnvBuilder.create_configuration"><code>create_configuration()</code></a>, <a class="reference internal" href="#venv.EnvBuilder.setup_python" title="venv.EnvBuilder.setup_python"><code>setup_python()</code></a>, <a class="reference internal" href="#venv.EnvBuilder.setup_scripts" title="venv.EnvBuilder.setup_scripts"><code>setup_scripts()</code></a> and <a class="reference internal" href="#venv.EnvBuilder.post_setup" title="venv.EnvBuilder.post_setup"><code>post_setup()</code></a> can be overridden.</p> </dd>
</dl> <dl class="py method"> <dt class="sig sig-object py" id="venv.EnvBuilder.ensure_directories">
<code>ensure_directories(env_dir)</code> </dt> <dd>
<p>Creates the environment directory and all necessary subdirectories that don’t already exist, and returns a context object. This context object is just a holder for attributes (such as paths) for use by the other methods. If the <a class="reference internal" href="#venv.EnvBuilder" title="venv.EnvBuilder"><code>EnvBuilder</code></a> is created with the arg <code>clear=True</code>, contents of the environment directory will be cleared and then all necessary subdirectories will be recreated.</p> <p>The returned context object is a <a class="reference internal" href="types.html#types.SimpleNamespace" title="types.SimpleNamespace"><code>types.SimpleNamespace</code></a> with the following attributes:</p> <ul class="simple"> <li>
<code>env_dir</code> - The location of the virtual environment. Used for <code>__VENV_DIR__</code> in activation scripts (see <a class="reference internal" href="#venv.EnvBuilder.install_scripts" title="venv.EnvBuilder.install_scripts"><code>install_scripts()</code></a>).</li> <li>
<code>env_name</code> - The name of the virtual environment. Used for <code>__VENV_NAME__</code> in activation scripts (see <a class="reference internal" href="#venv.EnvBuilder.install_scripts" title="venv.EnvBuilder.install_scripts"><code>install_scripts()</code></a>).</li> <li>
<code>prompt</code> - The prompt to be used by the activation scripts. Used for <code>__VENV_PROMPT__</code> in activation scripts (see <a class="reference internal" href="#venv.EnvBuilder.install_scripts" title="venv.EnvBuilder.install_scripts"><code>install_scripts()</code></a>).</li> <li>
<code>executable</code> - The underlying Python executable used by the virtual environment. This takes into account the case where a virtual environment is created from another virtual environment.</li> <li>
<code>inc_path</code> - The include path for the virtual environment.</li> <li>
<code>lib_path</code> - The purelib path for the virtual environment.</li> <li>
<code>bin_path</code> - The script path for the virtual environment.</li> <li>
<code>bin_name</code> - The name of the script path relative to the virtual environment location. Used for <code>__VENV_BIN_NAME__</code> in activation scripts (see <a class="reference internal" href="#venv.EnvBuilder.install_scripts" title="venv.EnvBuilder.install_scripts"><code>install_scripts()</code></a>).</li> <li>
<code>env_exe</code> - The name of the Python interpreter in the virtual environment. Used for <code>__VENV_PYTHON__</code> in activation scripts (see <a class="reference internal" href="#venv.EnvBuilder.install_scripts" title="venv.EnvBuilder.install_scripts"><code>install_scripts()</code></a>).</li> <li>
<code>env_exec_cmd</code> - The name of the Python interpreter, taking into account filesystem redirections. This can be used to run Python in the virtual environment.</li> </ul> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 3.11: </span>The <em>venv</em> <a class="reference internal" href="sysconfig.html#installation-paths"><span class="std std-ref">sysconfig installation scheme</span></a> is used to construct the paths of the created directories.</p> </div> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 3.12: </span>The attribute <code>lib_path</code> was added to the context, and the context object was documented.</p> </div> </dd>
</dl> <dl class="py method"> <dt class="sig sig-object py" id="venv.EnvBuilder.create_configuration">
<code>create_configuration(context)</code> </dt> <dd>
<p>Creates the <code>pyvenv.cfg</code> configuration file in the environment.</p> </dd>
</dl> <dl class="py method"> <dt class="sig sig-object py" id="venv.EnvBuilder.setup_python">
<code>setup_python(context)</code> </dt> <dd>
<p>Creates a copy or symlink to the Python executable in the environment. On POSIX systems, if a specific executable <code>python3.x</code> was used, symlinks to <code>python</code> and <code>python3</code> will be created pointing to that executable, unless files with those names already exist.</p> </dd>
</dl> <dl class="py method"> <dt class="sig sig-object py" id="venv.EnvBuilder.setup_scripts">
<code>setup_scripts(context)</code> </dt> <dd>
<p>Installs activation scripts appropriate to the platform into the virtual environment.</p> </dd>
</dl> <dl class="py method"> <dt class="sig sig-object py" id="venv.EnvBuilder.upgrade_dependencies">
<code>upgrade_dependencies(context)</code> </dt> <dd>
<p>Upgrades the core venv dependency packages (currently <code>pip</code>) in the environment. This is done by shelling out to the <code>pip</code> executable in the environment.</p> <div class="versionadded"> <p><span class="versionmodified added">Added in version 3.9.</span></p> </div> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 3.12: </span><code>setuptools</code> is no longer a core venv dependency.</p> </div> </dd>
</dl> <dl class="py method"> <dt class="sig sig-object py" id="venv.EnvBuilder.post_setup">
<code>post_setup(context)</code> </dt> <dd>
<p>A placeholder method which can be overridden in third party implementations to pre-install packages in the virtual environment or perform other post-creation steps.</p> </dd>
</dl> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 3.7.2: </span>Windows now uses redirector scripts for <code>python[w].exe</code> instead of copying the actual binaries. In 3.7.2 only <a class="reference internal" href="#venv.EnvBuilder.setup_python" title="venv.EnvBuilder.setup_python"><code>setup_python()</code></a> does nothing unless running from a build in the source tree.</p> </div> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 3.7.3: </span>Windows copies the redirector scripts as part of <a class="reference internal" href="#venv.EnvBuilder.setup_python" title="venv.EnvBuilder.setup_python"><code>setup_python()</code></a> instead of <a class="reference internal" href="#venv.EnvBuilder.setup_scripts" title="venv.EnvBuilder.setup_scripts"><code>setup_scripts()</code></a>. This was not the case in 3.7.2. When using symlinks, the original executables will be linked.</p> </div> <p>In addition, <a class="reference internal" href="#venv.EnvBuilder" title="venv.EnvBuilder"><code>EnvBuilder</code></a> provides this utility method that can be called from <a class="reference internal" href="#venv.EnvBuilder.setup_scripts" title="venv.EnvBuilder.setup_scripts"><code>setup_scripts()</code></a> or <a class="reference internal" href="#venv.EnvBuilder.post_setup" title="venv.EnvBuilder.post_setup"><code>post_setup()</code></a> in subclasses to assist in installing custom scripts into the virtual environment.</p> <dl class="py method"> <dt class="sig sig-object py" id="venv.EnvBuilder.install_scripts">
<code>install_scripts(context, path)</code> </dt> <dd>
<p><em>path</em> is the path to a directory that should contain subdirectories “common”, “posix”, “nt”, each containing scripts destined for the bin directory in the environment. The contents of “common” and the directory corresponding to <a class="reference internal" href="os.html#os.name" title="os.name"><code>os.name</code></a> are copied after some text replacement of placeholders:</p> <ul class="simple"> <li>
<code>__VENV_DIR__</code> is replaced with the absolute path of the environment directory.</li> <li>
<code>__VENV_NAME__</code> is replaced with the environment name (final path segment of environment directory).</li> <li>
<code>__VENV_PROMPT__</code> is replaced with the prompt (the environment name surrounded by parentheses and with a following space)</li> <li>
<code>__VENV_BIN_NAME__</code> is replaced with the name of the bin directory (either <code>bin</code> or <code>Scripts</code>).</li> <li>
<code>__VENV_PYTHON__</code> is replaced with the absolute path of the environment’s executable.</li> </ul> <p>The directories are allowed to exist (for when an existing environment is being upgraded).</p> </dd>
</dl> <dl class="py method"> <dt class="sig sig-object py" id="venv.EnvBuilder.create_git_ignore_file">
<code>create_git_ignore_file(context)</code> </dt> <dd>
<p>Creates a <code>.gitignore</code> file within the virtual environment that causes the entire directory to be ignored by the <code>git</code> source control manager.</p> <div class="versionadded"> <p><span class="versionmodified added">Added in version 3.13.</span></p> </div> </dd>
</dl> </dd>
</dl> <p>There is also a module-level convenience function:</p> <dl class="py function"> <dt class="sig sig-object py" id="venv.create">
<code>venv.create(env_dir, system_site_packages=False, clear=False, symlinks=False, with_pip=False, prompt=None, upgrade_deps=False, *, scm_ignore_files=frozenset())</code> </dt> <dd>
<p>Create an <a class="reference internal" href="#venv.EnvBuilder" title="venv.EnvBuilder"><code>EnvBuilder</code></a> with the given keyword arguments, and call its <a class="reference internal" href="#venv.EnvBuilder.create" title="venv.EnvBuilder.create"><code>create()</code></a> method with the <em>env_dir</em> argument.</p> <div class="versionadded"> <p><span class="versionmodified added">Added in version 3.3.</span></p> </div> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 3.4: </span>Added the <code>with_pip</code> parameter</p> </div> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 3.6: </span>Added the <code>prompt</code> parameter</p> </div> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 3.9: </span>Added the <code>upgrade_deps</code> parameter</p> </div> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 3.13: </span>Added the <code>scm_ignore_files</code> parameter</p> </div> </dd>
</dl> </section> <section id="an-example-of-extending-envbuilder"> <h2>An example of extending <code>EnvBuilder</code>
</h2> <p>The following script shows how to extend <a class="reference internal" href="#venv.EnvBuilder" title="venv.EnvBuilder"><code>EnvBuilder</code></a> by implementing a subclass which installs setuptools and pip into a created virtual environment:</p> <pre data-language="python">import os
import os.path
from subprocess import Popen, PIPE
import sys
from threading import Thread
from urllib.parse import urlparse
from urllib.request import urlretrieve
import venv

class ExtendedEnvBuilder(venv.EnvBuilder):
    """
    This builder installs setuptools and pip so that you can pip or
    easy_install other packages into the created virtual environment.

    :param nodist: If true, setuptools and pip are not installed into the
                   created virtual environment.
    :param nopip: If true, pip is not installed into the created
                  virtual environment.
    :param progress: If setuptools or pip are installed, the progress of the
                     installation can be monitored by passing a progress
                     callable. If specified, it is called with two
                     arguments: a string indicating some progress, and a
                     context indicating where the string is coming from.
                     The context argument can have one of three values:
                     'main', indicating that it is called from virtualize()
                     itself, and 'stdout' and 'stderr', which are obtained
                     by reading lines from the output streams of a subprocess
                     which is used to install the app.

                     If a callable is not specified, default progress
                     information is output to sys.stderr.
    """

    def __init__(self, *args, **kwargs):
        self.nodist = kwargs.pop('nodist', False)
        self.nopip = kwargs.pop('nopip', False)
        self.progress = kwargs.pop('progress', None)
        self.verbose = kwargs.pop('verbose', False)
        super().__init__(*args, **kwargs)

    def post_setup(self, context):
        """
        Set up any packages which need to be pre-installed into the
        virtual environment being created.

        :param context: The information for the virtual environment
                        creation request being processed.
        """
        os.environ['VIRTUAL_ENV'] = context.env_dir
        if not self.nodist:
            self.install_setuptools(context)
        # Can't install pip without setuptools
        if not self.nopip and not self.nodist:
            self.install_pip(context)

    def reader(self, stream, context):
        """
        Read lines from a subprocess' output stream and either pass to a progress
        callable (if specified) or write progress information to sys.stderr.
        """
        progress = self.progress
        while True:
            s = stream.readline()
            if not s:
                break
            if progress is not None:
                progress(s, context)
            else:
                if not self.verbose:
                    sys.stderr.write('.')
                else:
                    sys.stderr.write(s.decode('utf-8'))
                sys.stderr.flush()
        stream.close()

    def install_script(self, context, name, url):
        _, _, path, _, _, _ = urlparse(url)
        fn = os.path.split(path)[-1]
        binpath = context.bin_path
        distpath = os.path.join(binpath, fn)
        # Download script into the virtual environment's binaries folder
        urlretrieve(url, distpath)
        progress = self.progress
        if self.verbose:
            term = '\n'
        else:
            term = ''
        if progress is not None:
            progress('Installing %s ...%s' % (name, term), 'main')
        else:
            sys.stderr.write('Installing %s ...%s' % (name, term))
            sys.stderr.flush()
        # Install in the virtual environment
        args = [context.env_exe, fn]
        p = Popen(args, stdout=PIPE, stderr=PIPE, cwd=binpath)
        t1 = Thread(target=self.reader, args=(p.stdout, 'stdout'))
        t1.start()
        t2 = Thread(target=self.reader, args=(p.stderr, 'stderr'))
        t2.start()
        p.wait()
        t1.join()
        t2.join()
        if progress is not None:
            progress('done.', 'main')
        else:
            sys.stderr.write('done.\n')
        # Clean up - no longer needed
        os.unlink(distpath)

    def install_setuptools(self, context):
        """
        Install setuptools in the virtual environment.

        :param context: The information for the virtual environment
                        creation request being processed.
        """
        url = "https://bootstrap.pypa.io/ez_setup.py"
        self.install_script(context, 'setuptools', url)
        # clear up the setuptools archive which gets downloaded
        pred = lambda o: o.startswith('setuptools-') and o.endswith('.tar.gz')
        files = filter(pred, os.listdir(context.bin_path))
        for f in files:
            f = os.path.join(context.bin_path, f)
            os.unlink(f)

    def install_pip(self, context):
        """
        Install pip in the virtual environment.

        :param context: The information for the virtual environment
                        creation request being processed.
        """
        url = 'https://bootstrap.pypa.io/get-pip.py'
        self.install_script(context, 'pip', url)


def main(args=None):
    import argparse

    parser = argparse.ArgumentParser(prog=__name__,
                                     description='Creates virtual Python '
                                                 'environments in one or '
                                                 'more target '
                                                 'directories.')
    parser.add_argument('dirs', metavar='ENV_DIR', nargs='+',
                        help='A directory in which to create the '
                             'virtual environment.')
    parser.add_argument('--no-setuptools', default=False,
                        action='store_true', dest='nodist',
                        help="Don't install setuptools or pip in the "
                             "virtual environment.")
    parser.add_argument('--no-pip', default=False,
                        action='store_true', dest='nopip',
                        help="Don't install pip in the virtual "
                             "environment.")
    parser.add_argument('--system-site-packages', default=False,
                        action='store_true', dest='system_site',
                        help='Give the virtual environment access to the '
                             'system site-packages dir.')
    if os.name == 'nt':
        use_symlinks = False
    else:
        use_symlinks = True
    parser.add_argument('--symlinks', default=use_symlinks,
                        action='store_true', dest='symlinks',
                        help='Try to use symlinks rather than copies, '
                             'when symlinks are not the default for '
                             'the platform.')
    parser.add_argument('--clear', default=False, action='store_true',
                        dest='clear', help='Delete the contents of the '
                                           'virtual environment '
                                           'directory if it already '
                                           'exists, before virtual '
                                           'environment creation.')
    parser.add_argument('--upgrade', default=False, action='store_true',
                        dest='upgrade', help='Upgrade the virtual '
                                             'environment directory to '
                                             'use this version of '
                                             'Python, assuming Python '
                                             'has been upgraded '
                                             'in-place.')
    parser.add_argument('--verbose', default=False, action='store_true',
                        dest='verbose', help='Display the output '
                                             'from the scripts which '
                                             'install setuptools and pip.')
    options = parser.parse_args(args)
    if options.upgrade and options.clear:
        raise ValueError('you cannot supply --upgrade and --clear together.')
    builder = ExtendedEnvBuilder(system_site_packages=options.system_site,
                                   clear=options.clear,
                                   symlinks=options.symlinks,
                                   upgrade=options.upgrade,
                                   nodist=options.nodist,
                                   nopip=options.nopip,
                                   verbose=options.verbose)
    for d in options.dirs:
        builder.create(d)

if __name__ == '__main__':
    rc = 1
    try:
        main()
        rc = 0
    except Exception as e:
        print('Error: %s' % e, file=sys.stderr)
    sys.exit(rc)
</pre> <p>This script is also available for download <a class="reference external" href="https://gist.github.com/vsajip/4673395">online</a>.</p> </section> <div class="_attribution">
  <p class="_attribution-p">
    &copy; 2001&ndash;2024 Python Software Foundation<br>Licensed under the PSF License.<br>
    <a href="https://docs.python.org/3.13/library/venv.html" class="_attribution-link">https://docs.python.org/3.13/library/venv.html</a>
  </p>
</div>
