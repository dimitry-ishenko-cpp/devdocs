<h1>salt.states.netacl</h1> <div class="section" id="network-acl"> <h2>Network ACL</h2> <p>Manage the firewall configuration on the network device managed through NAPALM. The firewall configuration is generated by <a class="reference external" href="https://github.com/google/capirca">Capirca</a>.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2017.7.0.</span></p> </div> <dl class="field-list simple"> <dt class="field-odd">codeauthor</dt> <dd class="field-odd">
<p>Mircea Ulinic &lt;<a class="reference external" href="mailto:ping%40mirceaulinic.net.html">ping<span>@</span>mirceaulinic<span>.</span>net</a>&gt;</p> </dd> <dt class="field-even">maturity</dt> <dd class="field-even">
<p>new</p> </dd> <dt class="field-odd">depends</dt> <dd class="field-odd">
<p>capirca, napalm</p> </dd> <dt class="field-even">platform</dt> <dd class="field-even">
<p>unix</p> </dd> </dl> <div class="section" id="dependencies"> <h3>Dependencies</h3> <div class="section" id="id1"> <h4>Capirca</h4> <p>To install Capirca, execute: <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">capirca</span></code>.</p> </div> <div class="section" id="napalm"> <h4>NAPALM</h4> <p>To be able to load configuration on network devices, it requires <a class="reference external" href="https://napalm.readthedocs.io">NAPALM</a> library to be installed: <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">napalm</span></code>. Please check <a class="reference external" href="https://napalm.readthedocs.io/en/latest/installation.html">Installation</a> for complete details.</p> <dl class="py function"> <h3 id="salt.states.netacl.filter"> salt.states.netacl.filter(name, filter_name, filter_options=None, terms=None, prepend=True, pillar_key='acl', pillarenv=None, saltenv=None, merge_pillar=False, only_lower_merge=False, revision_id=None, revision_no=None, revision_date=True, revision_date_format='%Y/%m/%d', test=False, commit=True, debug=False)</h3> <dd>
<p>Generate and load the configuration of a policy filter.</p> <dl> <dt>filter_name</dt>
<dd>
<p>The name of the policy filter.</p> </dd> <dt>filter_options</dt>
<dd>
<p>Additional filter options. These options are platform-specific. See the complete list of <a class="reference external" href="https://github.com/google/capirca/wiki/Policy-format#header-section">options</a>.</p> </dd> <dt>terms</dt>
<dd>
<p>Dictionary of terms for this policy filter. If not specified or empty, will try to load the configuration from the pillar, unless <code class="docutils literal notranslate"><span class="pre">merge_pillar</span></code> is set as <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p> </dd> <dt>prepend: <code class="docutils literal notranslate"><span class="pre">True</span></code>
</dt>
<dd>
<p>When <code class="docutils literal notranslate"><span class="pre">merge_pillar</span></code> is set as <code class="docutils literal notranslate"><span class="pre">True</span></code>, the final list of terms generated by merging the terms from <code class="docutils literal notranslate"><span class="pre">terms</span></code> with those defined in the pillar (if any): new terms are prepended at the beginning, while existing ones will preserve the position. To add the new terms at the end of the list, set this argument to <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p> </dd> <dt>pillar_key: <code class="docutils literal notranslate"><span class="pre">acl</span></code>
</dt>
<dd>
<p>The key in the pillar containing the default attributes values. Default: <code class="docutils literal notranslate"><span class="pre">acl</span></code>.</p> </dd> <dt>pillarenv</dt>
<dd>
<p>Query the master to generate fresh pillar data on the fly, specifically from the requested pillar environment.</p> </dd> <dt>saltenv</dt>
<dd>
<p>Included only for compatibility with <a class="reference internal" href="https://docs.saltproject.io/en/latest/ref/configuration/minion.html#std-conf_minion-pillarenv_from_saltenv"><code class="xref std std-conf_minion docutils literal notranslate"><span class="pre">pillarenv_from_saltenv</span></code></a>, and is otherwise ignored.</p> </dd> <dt>merge_pillar: <code class="docutils literal notranslate"><span class="pre">False</span></code>
</dt>
<dd>
<p>Merge <code class="docutils literal notranslate"><span class="pre">terms</span></code> with the corresponding value from the pillar. Default: <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>By default this state does not merge, to avoid any unexpected behaviours.</p> <p>The merge logic depends on the <code class="docutils literal notranslate"><span class="pre">prepend</span></code> argument.</p> <p>The terms specified through the <code class="docutils literal notranslate"><span class="pre">terms</span></code> argument have higher priority than the pillar.</p> </div> </dd> <dt>only_lower_merge: <code class="docutils literal notranslate"><span class="pre">False</span></code>
</dt>
<dd>
<p>Specify if it should merge only the terms fields. Otherwise it will try to merge also filters fields. Default: <code class="docutils literal notranslate"><span class="pre">False</span></code>. This option requires <code class="docutils literal notranslate"><span class="pre">merge_pillar</span></code>, otherwise it is ignored.</p> </dd> <dt>revision_id</dt>
<dd>
<p>Add a comment in the filter config having the description for the changes applied.</p> </dd> <dt>revision_no</dt>
<dd>
<p>The revision count.</p> </dd> <dt>revision_date: <code class="docutils literal notranslate"><span class="pre">True</span></code>
</dt>
<dd>
<p>Boolean flag: display the date when the filter configuration was generated. Default: <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p> </dd> <dt>revision_date_format: <code class="docutils literal notranslate"><span class="pre">%Y/%m/%d</span></code>
</dt>
<dd>
<p>The date format to be used when generating the perforce data. Default: <code class="docutils literal notranslate"><span class="pre">%Y/%m/%d</span></code> (&lt;year&gt;/&lt;month&gt;/&lt;day&gt;).</p> </dd> <dt>test: <code class="docutils literal notranslate"><span class="pre">False</span></code>
</dt>
<dd>
<p>Dry run? If set as <code class="docutils literal notranslate"><span class="pre">True</span></code>, will apply the config, discard and return the changes. Default: <code class="docutils literal notranslate"><span class="pre">False</span></code> and will commit the changes on the device.</p> </dd> <dt>commit: <code class="docutils literal notranslate"><span class="pre">True</span></code>
</dt>
<dd>
<p>Commit? Default: <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p> </dd> <dt>debug: <code class="docutils literal notranslate"><span class="pre">False</span></code>
</dt>
<dd>
<p>Debug mode. Will insert a new key under the output dictionary, as <code class="docutils literal notranslate"><span class="pre">loaded_config</span></code> containing the raw configuration loaded on the device.</p> </dd> </dl> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt 'edge01.flw01' state.sls router.acl test=True</pre> <p>Output Example:</p> <pre class="highlight-text notranslate" data-language="text">edge01.flw01:
----------
          ID: my-filter
    Function: netacl.filter
      Result: None
     Comment: Testing mode: Configuration discarded.
     Started: 12:24:40.598232
    Duration: 2437.139 ms
     Changes:
              ----------
              diff:
                  ---
                  +++
                  @@ -1228,9 +1228,24 @@
                  !
                  +ipv4 access-list my-filter
                  + 10 remark $Id: my-filter_state $
                  + 20 remark $Revision: 5 $
                  + 30 remark my-other-term
                  + 40 permit tcp any range 5678 5680 any
                  +!
                  +!
              loaded:
                  ! $Id: my-filter_state $
                  ! $Revision: 5 $
                  no ipv6 access-list my-filter
                  ipv6 access-list my-filter
                   remark $Id: my-filter_state $
                   remark $Revision: 5 $
                   remark my-other-term
                   permit tcp any range 5678 5680 any
                  exit

Summary for edge01.flw01
------------
Succeeded: 1 (unchanged=1, changed=1)
Failed:    0
------------
Total states run:     1
Total run time:   2.437 s</pre> <p>Pillar example:</p> <pre class="highlight-yaml notranslate" data-language="yaml">acl:
  - my-filter:
      options:
        - inet6
      terms:
        - my-term:
            source_port: [1234, 1235]
            protocol:
              - tcp
              - udp
            source_address: 1.2.3.4
            action: reject
        - my-other-term:
            source_port:
              - [5678, 5680]
            protocol: tcp
            action: accept</pre> <p>State SLS Example:</p> <pre class="highlight-jinja notranslate" data-language="jinja">{%- set filter_name = 'my-filter' -%}
{%- set my_filter_cfg = salt.netacl.get_filter_pillar(filter_name, pillar_key='firewall') -%}
my_first_filter_state:
  netacl.filter:
    - filter_name: {{ filter_name }}
    - options: {{ my_filter_cfg['options'] | json }}
    - terms: {{ my_filter_cfg['terms'] | json }}
    - revision_date: false
    - revision_no: 5
    - debug: true</pre> <p>Or:</p> <pre class="highlight-yaml notranslate" data-language="yaml">my_first_filter_state:
  netacl.filter:
    - filter_name: my-filter
    - merge_pillar: true
    - pillar_key: firewall
    - revision_date: false
    - revision_no: 5
    - debug: true</pre> <p>In the example above, as <code class="docutils literal notranslate"><span class="pre">inet6</span></code> has been specified in the <code class="docutils literal notranslate"><span class="pre">filter_options</span></code>, the configuration chunk referring to <code class="docutils literal notranslate"><span class="pre">my-term</span></code> has been ignored as it referred to IPv4 only (from <code class="docutils literal notranslate"><span class="pre">source_address</span></code> field).</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>The first method allows the user to eventually apply complex manipulation and / or retrieve the data from external services before passing the data to the state. The second one is more straightforward, for less complex cases when loading the data directly from the pillar is sufficient.</p> </div> <div class="admonition note"> <p class="admonition-title">Note</p> <p>When passing retrieved pillar data into the state file, it is strongly recommended to use the json serializer explicitly (`` | json``), instead of relying on the default Python serializer.</p> </div> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.netacl.managed"> salt.states.netacl.managed(name, filters=None, prepend=True, pillar_key='acl', pillarenv=None, saltenv=None, merge_pillar=False, only_lower_merge=False, revision_id=None, revision_no=None, revision_date=True, revision_date_format='%Y/%m/%d', test=False, commit=True, debug=False)</h3> <dd>
<p>Manage the whole firewall configuration.</p> <dl> <dt>filters</dt>
<dd>
<p>Dictionary of filters for this policy. If not specified or empty, will try to load the configuration from the pillar, unless <code class="docutils literal notranslate"><span class="pre">merge_pillar</span></code> is set as <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p> </dd> <dt>prepend: <code class="docutils literal notranslate"><span class="pre">True</span></code>
</dt>
<dd>
<p>When <code class="docutils literal notranslate"><span class="pre">merge_pillar</span></code> is set as <code class="docutils literal notranslate"><span class="pre">True</span></code>, the final list of filters generated by merging the filters from <code class="docutils literal notranslate"><span class="pre">filters</span></code> with those defined in the pillar (if any): new filters are prepended at the beginning, while existing ones will preserve the position. To add the new filters at the end of the list, set this argument to <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p> </dd> <dt>pillar_key: <code class="docutils literal notranslate"><span class="pre">acl</span></code>
</dt>
<dd>
<p>The key in the pillar containing the default attributes values. Default: <code class="docutils literal notranslate"><span class="pre">acl</span></code>.</p> </dd> <dt>pillarenv</dt>
<dd>
<p>Query the master to generate fresh pillar data on the fly, specifically from the requested pillar environment.</p> </dd> <dt>saltenv</dt>
<dd>
<p>Included only for compatibility with <a class="reference internal" href="https://docs.saltproject.io/en/latest/ref/configuration/minion.html#std-conf_minion-pillarenv_from_saltenv"><code class="xref std std-conf_minion docutils literal notranslate"><span class="pre">pillarenv_from_saltenv</span></code></a>, and is otherwise ignored.</p> </dd> <dt>merge_pillar: <code class="docutils literal notranslate"><span class="pre">False</span></code>
</dt>
<dd>
<p>Merge the <code class="docutils literal notranslate"><span class="pre">filters</span></code> will the corresponding values from the pillar. Default: <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>By default this state does not merge, to avoid any unexpected behaviours.</p> <p>The merge logic depends on the <code class="docutils literal notranslate"><span class="pre">prepend</span></code> argument.</p> <p>The filters specified through the <code class="docutils literal notranslate"><span class="pre">filters</span></code> argument have higher priority than the pillar.</p> </div> </dd> <dt>only_lower_merge: <code class="docutils literal notranslate"><span class="pre">False</span></code>
</dt>
<dd>
<p>Specify if it should merge only the filters and terms fields. Otherwise it will try to merge everything at the policy level. Default: <code class="docutils literal notranslate"><span class="pre">False</span></code>. This option requires <code class="docutils literal notranslate"><span class="pre">merge_pillar</span></code>, otherwise it is ignored.</p> </dd> <dt>test: <code class="docutils literal notranslate"><span class="pre">False</span></code>
</dt>
<dd>
<p>Dry run? If set as <code class="docutils literal notranslate"><span class="pre">True</span></code>, will apply the config, discard and return the changes. Default: <code class="docutils literal notranslate"><span class="pre">False</span></code> and will commit the changes on the device.</p> </dd> <dt>revision_id</dt>
<dd>
<p>Add a comment in the policy config having the description for the changes applied.</p> </dd> <dt>revision_no</dt>
<dd>
<p>The revision count.</p> </dd> <dt>revision_date: <code class="docutils literal notranslate"><span class="pre">True</span></code>
</dt>
<dd>
<p>Boolean flag: display the date when the policy configuration was generated. Default: <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p> </dd> <dt>revision_date_format: <code class="docutils literal notranslate"><span class="pre">%Y/%m/%d</span></code>
</dt>
<dd>
<p>The date format to be used when generating the perforce data. Default: <code class="docutils literal notranslate"><span class="pre">%Y/%m/%d</span></code> (&lt;year&gt;/&lt;month&gt;/&lt;day&gt;).</p> </dd> <dt>commit: <code class="docutils literal notranslate"><span class="pre">True</span></code>
</dt>
<dd>
<p>Commit? Default: <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p> </dd> <dt>debug: <code class="docutils literal notranslate"><span class="pre">False</span></code>
</dt>
<dd>
<p>Debug mode. Will insert a new key under the output dictionary, as <code class="docutils literal notranslate"><span class="pre">loaded_config</span></code> containing the raw configuration loaded on the device.</p> </dd> </dl> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt 'edge01.bjm01' state.sls router.acl test=True</pre> <p>Output Example:</p> <pre class="highlight-text notranslate" data-language="text">edge01.bjm01:
-------------
              ID: netacl_example
        Function: netacl.managed
          Result: None
         Comment: Testing mode: Configuration discarded.
         Started: 12:03:24.807023
        Duration: 5569.453 ms
         Changes:
                  ----------
                  diff:
                      [edit firewall]
                      +    family inet {
                      +        /*
                      +         ** $Id: netacl_example $
                      +         ** $Date: 2017/07/03 $
                      +         ** $Revision: 2 $
                      +         **
                      +         */
                      +        filter my-filter {
                      +            interface-specific;
                      +            term my-term {
                      +                from {
                      +                    source-address {
                      +                        1.2.3.4/32;
                      +                    }
                      +                    protocol [ tcp udp ];
                      +                    source-port [ 1234 1235 ];
                      +                }
                      +                then {
                      +                    reject;
                      +                }
                      +            }
                      +            term my-other-term {
                      +                from {
                      +                    protocol tcp;
                      +                    source-port 5678-5680;
                      +                }
                      +                then accept;
                      +            }
                      +        }
                      +        /*
                      +         ** $Id: netacl_example $
                      +         ** $Date: 2017/07/03 $
                      +         ** $Revision: 2 $
                      +         **
                      +         */
                      +        filter block-icmp {
                      +            interface-specific;
                      +            term first-term {
                      +                from {
                      +                    protocol icmp;
                      +                }
                      +                then {
                      +                    reject;
                      +                }
                      +            }
                      +        }
                      +    }
                  loaded:
                      firewall {
                          family inet {
                              replace:
                              /*
                              ** $Id: netacl_example $
                              ** $Date: 2017/07/03 $
                              ** $Revision: 2 $
                              **
                              */
                              filter my-filter {
                                  interface-specific;
                                  term my-term {
                                      from {
                                          source-address {
                                              1.2.3.4/32;
                                          }
                                          protocol [ tcp udp ];
                                          source-port [ 1234 1235 ];
                                      }
                                      then {
                                          reject;
                                      }
                                  }
                                  term my-other-term {
                                      from {
                                          protocol tcp;
                                          source-port 5678-5680;
                                      }
                                      then accept;
                                  }
                              }
                          }
                      }
                      firewall {
                          family inet {
                              replace:
                              /*
                              ** $Id: netacl_example $
                              ** $Date: 2017/07/03 $
                              ** $Revision: 2 $
                              **
                              */
                              filter block-icmp {
                                  interface-specific;
                                  term first-term {
                                      from {
                                          protocol icmp;
                                      }
                                      then {
                                          reject;
                                      }
                                  }
                              }
                          }
                      }

    Summary for edge01.bjm01
    ------------
    Succeeded: 1 (unchanged=1, changed=1)
    Failed:    0
    ------------
    Total states run:     1
    Total run time:   5.569 s</pre> <p>The policy configuration has been loaded from the pillar, having the following structure:</p> <pre class="highlight-yaml notranslate" data-language="yaml">firewall:
  - my-filter:
      terms:
        - my-term:
            source_port: [1234, 1235]
            protocol:
              - tcp
              - udp
            source_address: 1.2.3.4
            action: reject
        - my-other-term:
            source_port:
              - [5678, 5680]
            protocol: tcp
            action: accept
  - block-icmp:
      terms:
        - first-term:
            protocol:
              - icmp
            action: reject</pre> <p>Example SLS file:</p> <pre class="highlight-jinja notranslate" data-language="jinja">{%- set fw_filters = pillar.get('firewall', {}) -%}
netacl_example:
  netacl.managed:
    - filters: {{ fw_filters | json }}
    - revision_no: 2
    - debug: true</pre> <p>Or:</p> <pre class="highlight-yaml notranslate" data-language="yaml">netacl_example:
  netacl.managed:
    - pillar_key: firewall
    - merge_pillar: true
    - revision_no: 2
    - debug: true</pre> <div class="admonition note"> <p class="admonition-title">Note</p> <p>The first method allows the user to eventually apply complex manipulation and / or retrieve the data from external services before passing the data to the state. The second one is more straightforward, for less complex cases when loading the data directly from the pillar is sufficient.</p> </div> <div class="admonition note"> <p class="admonition-title">Note</p> <p>When passing retrieved pillar data into the state file, it is strongly recommended to use the json serializer explicitly (`` | json``), instead of relying on the default Python serializer.</p> </div> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.netacl.term"> salt.states.netacl.term(name, filter_name, term_name, filter_options=None, pillar_key='acl', pillarenv=None, saltenv=None, merge_pillar=False, revision_id=None, revision_no=None, revision_date=True, revision_date_format='%Y/%m/%d', test=False, commit=True, debug=False, source_service=None, destination_service=None, **term_fields)</h3> <dd>
<p>Manage the configuration of a specific policy term.</p> <dl> <dt>filter_name</dt>
<dd>
<p>The name of the policy filter.</p> </dd> <dt>term_name</dt>
<dd>
<p>The name of the term.</p> </dd> <dt>filter_options</dt>
<dd>
<p>Additional filter options. These options are platform-specific. See the complete list of <a class="reference external" href="https://github.com/google/capirca/wiki/Policy-format#header-section">options</a>.</p> </dd> <dt>pillar_key: <code class="docutils literal notranslate"><span class="pre">acl</span></code>
</dt>
<dd>
<p>The key in the pillar containing the default attributes values. Default: <code class="docutils literal notranslate"><span class="pre">acl</span></code>.</p> </dd> <dt>pillarenv</dt>
<dd>
<p>Query the master to generate fresh pillar data on the fly, specifically from the requested pillar environment.</p> </dd> <dt>saltenv</dt>
<dd>
<p>Included only for compatibility with <a class="reference internal" href="https://docs.saltproject.io/en/latest/ref/configuration/minion.html#std-conf_minion-pillarenv_from_saltenv"><code class="xref std std-conf_minion docutils literal notranslate"><span class="pre">pillarenv_from_saltenv</span></code></a>, and is otherwise ignored.</p> </dd> <dt>merge_pillar: <code class="docutils literal notranslate"><span class="pre">False</span></code>
</dt>
<dd>
<p>Merge the CLI variables with the pillar. Default: <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p> <p>The properties specified through the state arguments have higher priority than the pillar.</p> </dd> <dt>revision_id</dt>
<dd>
<p>Add a comment in the term config having the description for the changes applied.</p> </dd> <dt>revision_no</dt>
<dd>
<p>The revision count.</p> </dd> <dt>revision_date: <code class="docutils literal notranslate"><span class="pre">True</span></code>
</dt>
<dd>
<p>Boolean flag: display the date when the term configuration was generated. Default: <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p> </dd> <dt>revision_date_format: <code class="docutils literal notranslate"><span class="pre">%Y/%m/%d</span></code>
</dt>
<dd>
<p>The date format to be used when generating the perforce data. Default: <code class="docutils literal notranslate"><span class="pre">%Y/%m/%d</span></code> (&lt;year&gt;/&lt;month&gt;/&lt;day&gt;).</p> </dd> <dt>test: <code class="docutils literal notranslate"><span class="pre">False</span></code>
</dt>
<dd>
<p>Dry run? If set as <code class="docutils literal notranslate"><span class="pre">True</span></code>, will apply the config, discard and return the changes. Default: <code class="docutils literal notranslate"><span class="pre">False</span></code> and will commit the changes on the device.</p> </dd> <dt>commit: <code class="docutils literal notranslate"><span class="pre">True</span></code>
</dt>
<dd>
<p>Commit? Default: <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p> </dd> <dt>debug: <code class="docutils literal notranslate"><span class="pre">False</span></code>
</dt>
<dd>
<p>Debug mode. Will insert a new key under the output dictionary, as <code class="docutils literal notranslate"><span class="pre">loaded_config</span></code> containing the raw configuration loaded on the device.</p> </dd> <dt>source_service</dt>
<dd>
<p>A special service to choose from. This is a helper so the user is able to select a source just using the name, instead of specifying a source_port and protocol.</p> <p>As this module is available on Unix platforms only, it reads the <a class="reference external" href="http://www.iana.org/assignments/port-numbers">IANA</a> port assignment from /etc/services.</p> <p>If the user requires additional shortcuts to be referenced, they can add entries under /etc/services, which can be managed using the <a class="reference internal" href="salt.states.file.html#module-salt.states.file" title="salt.states.file"><code class="xref py py-mod docutils literal notranslate"><span class="pre">file</span> <span class="pre">state</span></code></a>.</p> </dd> <dt>destination_service</dt>
<dd>
<p>A special service to choose from. This is a helper so the user is able to select a source just using the name, instead of specifying a destination_port and protocol. Allows the same options as <code class="docutils literal notranslate"><span class="pre">source_service</span></code>.</p> </dd> <dt>term_fields</dt>
<dd>
<p>Term attributes. To see what fields are supported, please consult the list of supported <a class="reference external" href="https://github.com/google/capirca/wiki/Policy-format#keywords">keywords</a>. Some platforms have few other <a class="reference external" href="https://github.com/google/capirca/wiki/Policy-format#optionally-supported-keywords">optional</a> keywords.</p> </dd> </dl> <div class="admonition note"> <p class="admonition-title">Note</p> <p>The following fields are accepted:</p> <ul class="simple"> <li><p>action</p></li> <li><p>address</p></li> <li><p>address_exclude</p></li> <li><p>comment</p></li> <li><p>counter</p></li> <li><p>expiration</p></li> <li><p>destination_address</p></li> <li><p>destination_address_exclude</p></li> <li><p>destination_port</p></li> <li><p>destination_prefix</p></li> <li><p>forwarding_class</p></li> <li><p>forwarding_class_except</p></li> <li><p>logging</p></li> <li><p>log_name</p></li> <li><p>loss_priority</p></li> <li><p>option</p></li> <li><p>policer</p></li> <li><p>port</p></li> <li><p>precedence</p></li> <li><p>principals</p></li> <li><p>protocol</p></li> <li><p>protocol_except</p></li> <li><p>qos</p></li> <li><p>pan_application</p></li> <li><p>routing_instance</p></li> <li><p>source_address</p></li> <li><p>source_address_exclude</p></li> <li><p>source_port</p></li> <li><p>source_prefix</p></li> <li><p>verbatim</p></li> <li><p>packet_length</p></li> <li><p>fragment_offset</p></li> <li><p>hop_limit</p></li> <li><p>icmp_type</p></li> <li><p>ether_type</p></li> <li><p>traffic_class_count</p></li> <li><p>traffic_type</p></li> <li><p>translated</p></li> <li><p>dscp_set</p></li> <li><p>dscp_match</p></li> <li><p>dscp_except</p></li> <li><p>next_ip</p></li> <li><p>flexible_match_range</p></li> <li><p>source_prefix_except</p></li> <li><p>destination_prefix_except</p></li> <li><p>vpn</p></li> <li><p>source_tag</p></li> <li><p>destination_tag</p></li> <li><p>source_interface</p></li> <li><p>destination_interface</p></li> <li><p>flattened</p></li> <li><p>flattened_addr</p></li> <li><p>flattened_saddr</p></li> <li><p>flattened_daddr</p></li> <li><p>priority</p></li> </ul> </div> <div class="admonition note"> <p class="admonition-title">Note</p> <p>The following fields can be also a single value and a list of values:</p> <ul class="simple"> <li><p>action</p></li> <li><p>address</p></li> <li><p>address_exclude</p></li> <li><p>comment</p></li> <li><p>destination_address</p></li> <li><p>destination_address_exclude</p></li> <li><p>destination_port</p></li> <li><p>destination_prefix</p></li> <li><p>forwarding_class</p></li> <li><p>forwarding_class_except</p></li> <li><p>logging</p></li> <li><p>option</p></li> <li><p>port</p></li> <li><p>precedence</p></li> <li><p>principals</p></li> <li><p>protocol</p></li> <li><p>protocol_except</p></li> <li><p>pan_application</p></li> <li><p>source_address</p></li> <li><p>source_address_exclude</p></li> <li><p>source_port</p></li> <li><p>source_prefix</p></li> <li><p>verbatim</p></li> <li><p>icmp_type</p></li> <li><p>ether_type</p></li> <li><p>traffic_type</p></li> <li><p>dscp_match</p></li> <li><p>dscp_except</p></li> <li><p>flexible_match_range</p></li> <li><p>source_prefix_except</p></li> <li><p>destination_prefix_except</p></li> <li><p>source_tag</p></li> <li><p>destination_tag</p></li> <li><p>source_service</p></li> <li><p>destination_service</p></li> </ul> <p>Example: <code class="docutils literal notranslate"><span class="pre">destination_address</span></code> can be either defined as:</p> <pre class="highlight-yaml notranslate" data-language="yaml">destination_address: 172.17.17.1/24</pre> <p>or as a list of destination IP addresses:</p> <pre class="highlight-yaml notranslate" data-language="yaml">destination_address:
    - 172.17.17.1/24
    - 172.17.19.1/24</pre> <p>or a list of services to be matched:</p> <pre class="highlight-yaml notranslate" data-language="yaml">source_service:
    - ntp
    - snmp
    - ldap
    - bgpd</pre> </div> <div class="admonition note"> <p class="admonition-title">Note</p> <p>The port fields <code class="docutils literal notranslate"><span class="pre">source_port</span></code> and <code class="docutils literal notranslate"><span class="pre">destination_port</span></code> can be used as above to select either a single value, either a list of values, but also they can select port ranges. Example:</p> <pre class="highlight-yaml notranslate" data-language="yaml">source_port:
    - [1000, 2000]
    - [3000, 4000]</pre> <p>With the configuration above, the user is able to select the 1000-2000 and 3000-4000 source port ranges.</p> </div> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt 'edge01.bjm01' state.sls router.acl</pre> <p>Output Example:</p> <pre class="highlight-text notranslate" data-language="text">edge01.bjm01:
----------
          ID: update_icmp_first_term
    Function: netacl.term
      Result: None
     Comment: Testing mode: Configuration discarded.
     Started: 12:49:09.174179
    Duration: 5751.882 ms
     Changes:
              ----------
              diff:
                  [edit firewall]
                  +    family inet {
                  +        /*
                  +         ** $Id: update_icmp_first_term $
                  +         ** $Date: 2017/02/30 $
                  +         **
                  +         */
                  +        filter block-icmp {
                  +            term first-term {
                  +                from {
                  +                    protocol icmp;
                  +                }
                  +                then {
                  +                    reject;
                  +                }
                  +            }
                  +        }
                  +    }

Summary for edge01.bjm01
------------
Succeeded: 1 (unchanged=1, changed=1)
Failed:    0
------------
Total states run:     1
Total run time:   5.752 s</pre> <p>Pillar example:</p> <pre class="highlight-yaml notranslate" data-language="yaml">firewall:
  - block-icmp:
      terms:
        - first-term:
            protocol:
              - icmp
            action: reject</pre> <p>State SLS example:</p> <pre class="highlight-jinja notranslate" data-language="jinja">{%- set filter_name = 'block-icmp' -%}
{%- set term_name = 'first-term' -%}
{%- set my_term_cfg = salt.netacl.get_term_pillar(filter_name, term_name) -%}

update_icmp_first_term:
  netacl.term:
    - filter_name: {{ filter_name }}
    - filter_options:
        - not-interface-specific
    - term_name: {{ term_name }}
    - {{ my_term_cfg | json }}</pre> <p>Or directly referencing the pillar keys:</p> <pre class="highlight-yaml notranslate" data-language="yaml">update_icmp_first_term:
  netacl.term:
    - filter_name: block-icmp
    - filter_options:
        - not-interface-specific
    - term_name: first-term
    - merge_pillar: true</pre> <div class="admonition note"> <p class="admonition-title">Note</p> <p>The first method allows the user to eventually apply complex manipulation and / or retrieve the data from external services before passing the data to the state. The second one is more straightforward, for less complex cases when loading the data directly from the pillar is sufficient.</p> </div> <div class="admonition note"> <p class="admonition-title">Note</p> <p>When passing retrieved pillar data into the state file, it is strongly recommended to use the json serializer explicitly (`` | json``), instead of relying on the default Python serializer.</p> </div> </dd>
</dl> </div> </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2021 SaltStack.<br>Licensed under the Apache License, Version 2.0.<br>
    <a href="https://docs.saltproject.io/en/latest/ref/states/all/salt.states.netacl.html" class="_attribution-link">https://docs.saltproject.io/en/latest/ref/states/all/salt.states.netacl.html</a>
  </p>
</div>
