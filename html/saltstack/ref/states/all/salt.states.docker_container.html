<h1>salt.states.docker_container</h1> <p>Management of Docker containers</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2017.7.0.</span></p> </div> <dl class="field-list simple"> <dt class="field-odd">depends</dt> <dd class="field-odd">
<p><a class="reference external" href="https://pypi.python.org/pypi/docker">docker</a> Python module</p> </dd> </dl> <div class="admonition note"> <p class="admonition-title">Note</p> <p>Older releases of the Python bindings for Docker were called <a class="reference external" href="https://pypi.python.org/pypi/docker-py">docker-py</a> in PyPI. All releases of <a class="reference external" href="https://pypi.python.org/pypi/docker">docker</a>, and releases of <a class="reference external" href="https://pypi.python.org/pypi/docker-py">docker-py</a> &gt;= 1.6.0 are supported. These python bindings can easily be installed using <a class="reference internal" href="../../modules/all/salt.modules.pip.html#salt.modules.pip.install" title="salt.modules.pip.install"><code class="xref py py-func docutils literal notranslate"><span class="pre">pip.install</span></code></a>:</p> <pre class="highlight-bash notranslate" data-language="bash">salt myminion pip.install docker</pre> <p>To upgrade from <a class="reference external" href="https://pypi.python.org/pypi/docker-py">docker-py</a> to <a class="reference external" href="https://pypi.python.org/pypi/docker">docker</a>, you must first uninstall <a class="reference external" href="https://pypi.python.org/pypi/docker-py">docker-py</a>, and then install <a class="reference external" href="https://pypi.python.org/pypi/docker">docker</a>:</p> <pre class="highlight-bash notranslate" data-language="bash">salt myminion pip.uninstall docker-py
salt myminion pip.install docker</pre> </div> <p>These states were moved from the <code class="xref py py-mod docutils literal notranslate"><span class="pre">docker</span></code> state module (formerly called <strong>dockerng</strong>) in the 2017.7.0 release. When running the <a class="reference internal" href="#salt.states.docker_container.running" title="salt.states.docker_container.running"><code class="xref py py-func docutils literal notranslate"><span class="pre">docker_container.running</span></code></a> state for the first time after upgrading to 2017.7.0, your container(s) may be replaced. The changes may show diffs for certain parameters which say that the old value was an empty string, and the new value is <code class="docutils literal notranslate"><span class="pre">None</span></code>. This is due to the fact that in prior releases Salt was passing empty strings for these values when creating the container if they were undefined in the SLS file, where now Salt simply does not pass any arguments not explicitly defined in the SLS file. Subsequent runs of the state should not replace the container if the configuration remains unchanged.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>To pull from a Docker registry, authentication must be configured. See <a class="reference internal" href="../../modules/all/salt.modules.dockermod.html#docker-authentication"><span class="std std-ref">here</span></a> for more information on how to configure access to docker registries in <a class="reference internal" href="https://docs.saltproject.io/en/latest/topics/pillar/index.html#pillar"><span class="std std-ref">Pillar</span></a> data.</p> </div> <dl class="py function"> <h3 id="salt.states.docker_container.absent"> salt.states.docker_container.absent(name, force=False)</h3> <dd>
<p>Ensure that a container is absent</p> <dl class="simple"> <dt>name</dt>
<dd>
<p>Name of the container</p> </dd> <dt>force<span class="classifier">False</span>
</dt>
<dd>
<p>Set to <code class="docutils literal notranslate"><span class="pre">True</span></code> to remove the container even if it is running</p> </dd> </dl> <p>Usage Examples:</p> <pre class="highlight-yaml notranslate" data-language="yaml">mycontainer:
  docker_container.absent

multiple_containers:
  docker_container.absent:
    - names:
      - foo
      - bar
      - baz</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.docker_container.mod_watch"> salt.states.docker_container.mod_watch(name, sfun=None, **kwargs)</h3> <dd>
<p>The docker_container watcher, called to invoke the watch command.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This state exists to support special handling of the <code class="docutils literal notranslate"><span class="pre">watch</span></code> <a class="reference internal" href="https://docs.saltproject.io/en/latest/ref/states/requisites.html#requisites"><span class="std std-ref">requisite</span></a>. It should not be called directly.</p> <p>Parameters for this function should be set by the state being triggered.</p> </div> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.docker_container.run"> salt.states.docker_container.run(name, image=None, bg=False, failhard=True, replace=False, force=False, skip_translate=None, ignore_collisions=False, validate_ip_addrs=True, client_timeout=60, **kwargs)</h3> <dd>
<div class="versionadded"> <p><span class="versionmodified added">New in version 2018.3.0.</span></p> </div> <div class="admonition note"> <p class="admonition-title">Note</p> <p>If no tag is specified in the image name, and nothing matching the specified image is pulled on the minion, the <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">pull</span></code> that retrieves the image will pull <em>all tags</em> for the image. A tag of <code class="docutils literal notranslate"><span class="pre">latest</span></code> is not implicit for the pull. For this reason, it is recommended to specify the image in <code class="docutils literal notranslate"><span class="pre">repo:tag</span></code> notation.</p> </div> <p>Like the <a class="reference internal" href="salt.states.cmd.html#salt.states.cmd.run" title="salt.states.cmd.run"><code class="xref py py-func docutils literal notranslate"><span class="pre">cmd.run</span></code></a> state, only for Docker. Does the equivalent of a <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span></code> and returns information about the container that was created, as well as its output.</p> <p>This state accepts the same arguments as <a class="reference internal" href="#salt.states.docker_container.running" title="salt.states.docker_container.running"><code class="xref py py-func docutils literal notranslate"><span class="pre">docker_container.running</span></code></a>, with the exception of <code class="docutils literal notranslate"><span class="pre">watch_action</span></code>, <code class="docutils literal notranslate"><span class="pre">start</span></code>, and <code class="docutils literal notranslate"><span class="pre">shutdown_timeout</span></code> (though the <code class="docutils literal notranslate"><span class="pre">force</span></code> argument has a different meaning in this state).</p> <p>In addition, this state accepts the arguments from <a class="reference internal" href="../../modules/all/salt.modules.dockermod.html#salt.modules.dockermod.logs" title="salt.modules.dockermod.logs"><code class="xref py py-func docutils literal notranslate"><span class="pre">docker.logs</span></code></a>, with the exception of <code class="docutils literal notranslate"><span class="pre">follow</span></code>, to control how logs are returned.</p> <p>Additionally, the following arguments are supported:</p> <dl> <dt>creates</dt>
<dd>
<p>A path or list of paths. Only run if one or more of the specified paths do not exist on the minion.</p> </dd> <dt>bg<span class="classifier">False</span>
</dt>
<dd>
<p>If <code class="docutils literal notranslate"><span class="pre">True</span></code>, run container in background and do not await or deliver its results.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This may not be useful in cases where other states depend on the results of this state. Also, the logs will be inaccessible once the container exits if <code class="docutils literal notranslate"><span class="pre">auto_remove</span></code> is set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, so keep this in mind.</p> </div> </dd> <dt>failhard<span class="classifier">True</span>
</dt>
<dd>
<p>If <code class="docutils literal notranslate"><span class="pre">True</span></code>, the state will return a <code class="docutils literal notranslate"><span class="pre">False</span></code> result if the exit code of the container is non-zero. When this argument is set to <code class="docutils literal notranslate"><span class="pre">False</span></code>, the state will return a <code class="docutils literal notranslate"><span class="pre">True</span></code> result regardless of the container's exit code.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This has no effect if <code class="docutils literal notranslate"><span class="pre">bg</span></code> is set to <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p> </div> </dd> <dt>replace<span class="classifier">False</span>
</dt>
<dd>
<p>If <code class="docutils literal notranslate"><span class="pre">True</span></code>, and if the named container already exists, this will remove the existing container. The default behavior is to return a <code class="docutils literal notranslate"><span class="pre">False</span></code> result when the container already exists.</p> </dd> <dt>force<span class="classifier">False</span>
</dt>
<dd>
<p>If <code class="docutils literal notranslate"><span class="pre">True</span></code>, and the named container already exists, <em>and</em> <code class="docutils literal notranslate"><span class="pre">replace</span></code> is also set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, then the container will be forcibly removed. Otherwise, the state will not proceed and will return a <code class="docutils literal notranslate"><span class="pre">False</span></code> result.</p> </dd> </dl> <p>CLI Examples:</p> <pre class="highlight-bash notranslate" data-language="bash">salt myminion docker.run_container myuser/myimage command=/usr/local/bin/myscript.sh</pre> <p><strong>USAGE EXAMPLE</strong></p> <pre class="highlight-jinja notranslate" data-language="jinja">{% set pkg_version = salt.pillar.get('pkg_version', '1.0-1') %}
build_package:
  docker_container.run:
    - image: myuser/builder:latest
    - binds: /home/myuser/builds:/build_dir
    - command: /scripts/build.sh {{ pkg_version }}
    - creates: /home/myuser/builds/myapp-{{ pkg_version }}.noarch.rpm
    - replace: True
    - networks:
      - mynet
    - require:
      - docker_network: mynet</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.docker_container.running"> salt.states.docker_container.running(name, image=None, skip_translate=None, ignore_collisions=False, validate_ip_addrs=True, force=False, watch_action='force', start=True, shutdown_timeout=None, client_timeout=60, networks=None, **kwargs)</h3> <dd>
<p>Ensure that a container with a specific configuration is present and running</p> <dl> <dt>name</dt>
<dd>
<p>Name of the container</p> </dd> <dt>image</dt>
<dd>
<p>Image to use for the container</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This state will pull the image if it is not present. However, if the image needs to be built from a Dockerfile or loaded from a saved image, or if you would like to use requisites to trigger a replacement of the container when the image is updated, then the <code class="xref py py-func docutils literal notranslate"><span class="pre">docker_image.present</span></code> state should be used to manage the image.</p> </div> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 2018.3.0: </span>If no tag is specified in the image name, and nothing matching the specified image is pulled on the minion, the <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">pull</span></code> that retrieves the image will pull <em>all tags</em> for the image. A tag of <code class="docutils literal notranslate"><span class="pre">latest</span></code> is no longer implicit for the pull. For this reason, it is recommended to specify the image in <code class="docutils literal notranslate"><span class="pre">repo:tag</span></code> notation.</p> </div> </dd> </dl> <dl id="docker-container-running-skip-translate"> <dt>skip_translate</dt>
<dd>
<p>This function translates Salt CLI or SLS input into the format which <a class="reference external" href="https://pypi.python.org/pypi/docker-py">docker-py</a> expects. However, in the event that Salt's translation logic fails (due to potential changes in the Docker Remote API, or to bugs in the translation code), this argument can be used to exert granular control over which arguments are translated and which are not.</p> <p>Pass this argument as a comma-separated list (or Python list) of arguments, and translation for each passed argument name will be skipped. Alternatively, pass <code class="docutils literal notranslate"><span class="pre">True</span></code> and <em>all</em> translation will be skipped.</p> <p>Skipping tranlsation allows for arguments to be formatted directly in the format which <a class="reference external" href="https://pypi.python.org/pypi/docker-py">docker-py</a> expects. This allows for API changes and other issues to be more easily worked around. An example of using this option to skip translation would be:</p> <p>For example, imagine that there is an issue with processing the <code class="docutils literal notranslate"><span class="pre">port_bindings</span></code> argument, and the following configuration no longer works as expected:</p> <pre class="highlight-yaml notranslate" data-language="yaml">mycontainer:
  docker_container.running:
    - image: 7.3.1611
    - port_bindings:
      - 10.2.9.10:8080:80</pre> <p>By using <code class="docutils literal notranslate"><span class="pre">skip_translate</span></code>, you can forego the input translation and configure the port binding in the format <a class="reference external" href="https://pypi.python.org/pypi/docker-py">docker-py</a> needs:</p> <pre class="highlight-yaml notranslate" data-language="yaml">mycontainer:
  docker_container.running:
    - image: 7.3.1611
    - skip_translate: port_bindings
    - port_bindings: {8080: [('10.2.9.10', 80)], '4193/udp': 9314}</pre> <p>See the following links for more information:</p> <ul class="simple"> <li><p><a class="reference external" href="http://docker-py.readthedocs.io/en/stable/api.html#docker.api.container.ContainerApiMixin.create_container">docker-py Low-level API</a></p></li> <li><p><a class="reference external" href="https://docs.docker.com/engine/api/v1.33/#operation/ContainerCreate">Docker Engine API</a></p></li> </ul> </dd> </dl> <dl> <dt>ignore_collisions<span class="classifier">False</span>
</dt>
<dd>
<p>Since many of <a class="reference external" href="https://pypi.python.org/pypi/docker-py">docker-py</a>'s arguments differ in name from their CLI counterparts (with which most Docker users are more familiar), Salt detects usage of these and aliases them to the <a class="reference external" href="https://pypi.python.org/pypi/docker-py">docker-py</a> version of that argument so that both CLI and API versions of a given argument are supported. However, if both the alias and the <a class="reference external" href="https://pypi.python.org/pypi/docker-py">docker-py</a> version of the same argument (e.g. <code class="docutils literal notranslate"><span class="pre">env</span></code> and <code class="docutils literal notranslate"><span class="pre">environment</span></code>) are used, an error will be raised. Set this argument to <code class="docutils literal notranslate"><span class="pre">True</span></code> to suppress these errors and keep the <a class="reference external" href="https://pypi.python.org/pypi/docker-py">docker-py</a> version of the argument.</p> </dd> <dt>validate_ip_addrs<span class="classifier">True</span>
</dt>
<dd>
<p>For parameters which accept IP addresses as input, IP address validation will be performed. To disable, set this to <code class="docutils literal notranslate"><span class="pre">False</span></code></p> </dd> <dt>force<span class="classifier">False</span>
</dt>
<dd>
<p>Set this parameter to <code class="docutils literal notranslate"><span class="pre">True</span></code> to force Salt to re-create the container irrespective of whether or not it is configured as desired.</p> </dd> <dt>watch_action<span class="classifier">force</span>
</dt>
<dd>
<p>Control what type of action is taken when this state <a class="reference internal" href="https://docs.saltproject.io/en/latest/ref/states/requisites.html#requisites-watch"><span class="std std-ref">watches</span></a> another state that has changes. The default action is <code class="docutils literal notranslate"><span class="pre">force</span></code>, which runs the state with <code class="docutils literal notranslate"><span class="pre">force</span></code> set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, triggering a rebuild of the container.</p> <p>If any other value is passed, it will be assumed to be a kill signal. If the container matches the specified configuration, and is running, then the action will be to send that signal to the container. Kill signals can be either strings or numbers, and are defined in the <strong>Standard Signals</strong> section of the <code class="docutils literal notranslate"><span class="pre">signal(7)</span></code> manpage. Run <code class="docutils literal notranslate"><span class="pre">man</span> <span class="pre">7</span>
<span class="pre">signal</span></code> on a Linux host to browse this manpage. For example:</p> <pre class="highlight-yaml notranslate" data-language="yaml">mycontainer:
  docker_container.running:
    - image: busybox
    - watch_action: SIGHUP
    - watch:
      - file: some_file</pre> <div class="admonition note"> <p class="admonition-title">Note</p> <p>If the container differs from the specified configuration, or is not running, then instead of sending a signal to the container, the container will be re-created/started and no signal will be sent.</p> </div> </dd> <dt>start<span class="classifier">True</span>
</dt>
<dd>
<p>Set to <code class="docutils literal notranslate"><span class="pre">False</span></code> to suppress starting of the container if it exists, matches the desired configuration, but is not running. This is useful for data-only containers, or for non-daemonized container processes, such as the Django <code class="docutils literal notranslate"><span class="pre">migrate</span></code> and <code class="docutils literal notranslate"><span class="pre">collectstatic</span></code> commands. In instances such as this, the container only needs to be started the first time.</p> </dd> <dt>shutdown_timeout</dt>
<dd>
<p>If the container needs to be replaced, the container will be stopped using <a class="reference internal" href="../../modules/all/salt.modules.dockermod.html#salt.modules.dockermod.stop" title="salt.modules.dockermod.stop"><code class="xref py py-func docutils literal notranslate"><span class="pre">docker.stop</span></code></a>. If a <code class="docutils literal notranslate"><span class="pre">shutdown_timout</span></code> is not set, and the container was created using <code class="docutils literal notranslate"><span class="pre">stop_timeout</span></code>, that timeout will be used. If neither of these values were set, then a timeout of 10 seconds will be used.</p> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 2017.7.0: </span>This option was renamed from <code class="docutils literal notranslate"><span class="pre">stop_timeout</span></code> to <code class="docutils literal notranslate"><span class="pre">shutdown_timeout</span></code> to accommodate the <code class="docutils literal notranslate"><span class="pre">stop_timeout</span></code> container configuration setting.</p> </div> </dd> <dt>client_timeout<span class="classifier">60</span>
</dt>
<dd>
<p>Timeout in seconds for the Docker client. This is not a timeout for this function, but for receiving a response from the API.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This is only used if Salt needs to pull the requested image.</p> </div> </dd> </dl> <p id="salt-states-docker-container-network-management"><strong>NETWORK MANAGEMENT</strong></p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2018.3.0.</span></p> </div> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 2019.2.0: </span>If the <code class="docutils literal notranslate"><span class="pre">networks</span></code> option is used, any networks (including the default <code class="docutils literal notranslate"><span class="pre">bridge</span></code> network) which are not specified will be disconnected.</p> </div> <p>The <code class="docutils literal notranslate"><span class="pre">networks</span></code> argument can be used to ensure that a container is attached to one or more networks. Optionally, arguments can be passed to the networks. In the example below, <code class="docutils literal notranslate"><span class="pre">net1</span></code> is being configured with arguments, while <code class="docutils literal notranslate"><span class="pre">net2</span></code> and <code class="docutils literal notranslate"><span class="pre">bridge</span></code> are being configured <em>without</em> arguments:</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: myuser/myimage:foo
    - networks:
      - net1:
        - aliases:
          - bar
          - baz
        - ipv4_address: 10.0.20.50
      - net2
      - bridge
    - require:
      - docker_network: net1
      - docker_network: net2</pre> <p>The supported arguments are the ones from the docker-py's <a class="reference external" href="https://docker-py.readthedocs.io/en/stable/api.html#docker.api.network.NetworkApiMixin.connect_container_to_network">connect_container_to_network</a> function (other than <code class="docutils literal notranslate"><span class="pre">container</span></code> and <code class="docutils literal notranslate"><span class="pre">net_id</span></code>).</p> <div class="admonition important"> <p class="admonition-title">Important</p> <p>Unlike with the arguments described in the <strong>CONTAINER CONFIGURATION PARAMETERS</strong> section below, these network configuration parameters are not translated at all. Consult the <a class="reference external" href="https://docker-py.readthedocs.io/en/stable/api.html#docker.api.network.NetworkApiMixin.connect_container_to_network">connect_container_to_network</a> documentation for the correct type/format of data to pass.</p> </div> <p>To start a container with no network connectivity (only possible in 2019.2.0 and later) pass this option as an empty list. For example:</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: myuser/myimage:foo
    - networks: []</pre> <p><strong>CONTAINER CONFIGURATION PARAMETERS</strong></p> <dl> <dt>auto_remove (or <em>rm</em>)<span class="classifier">False</span>
</dt>
<dd>
<p>Enable auto-removal of the container on daemon side when the container’s process exits (analogous to running a docker container with <code class="docutils literal notranslate"><span class="pre">--rm</span></code> on the CLI).</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - auto_remove: True</pre> </dd> <dt>binds</dt>
<dd>
<p>Files/directories to bind mount. Each bind mount should be passed in one of the following formats:</p> <ul class="simple"> <li><p><code class="docutils literal notranslate"><span class="pre">&lt;host_path&gt;:&lt;container_path&gt;</span></code> - <code class="docutils literal notranslate"><span class="pre">host_path</span></code> is mounted within the container as <code class="docutils literal notranslate"><span class="pre">container_path</span></code> with read-write access.</p></li> <li><p><code class="docutils literal notranslate"><span class="pre">&lt;host_path&gt;:&lt;container_path&gt;:&lt;selinux_context&gt;</span></code> - <code class="docutils literal notranslate"><span class="pre">host_path</span></code> is mounted within the container as <code class="docutils literal notranslate"><span class="pre">container_path</span></code> with read-write access. Additionally, the specified selinux context will be set within the container.</p></li> <li><p><code class="docutils literal notranslate"><span class="pre">&lt;host_path&gt;:&lt;container_path&gt;:&lt;read_only&gt;</span></code> - <code class="docutils literal notranslate"><span class="pre">host_path</span></code> is mounted within the container as <code class="docutils literal notranslate"><span class="pre">container_path</span></code>, with the read-only or read-write setting explicitly defined.</p></li> <li><p><code class="docutils literal notranslate"><span class="pre">&lt;host_path&gt;:&lt;container_path&gt;:&lt;read_only&gt;,&lt;selinux_context&gt;</span></code> - <code class="docutils literal notranslate"><span class="pre">host_path</span></code> is mounted within the container as <code class="docutils literal notranslate"><span class="pre">container_path</span></code>, with the read-only or read-write setting explicitly defined. Additionally, the specified selinux context will be set within the container.</p></li> </ul> <p><code class="docutils literal notranslate"><span class="pre">&lt;read_only&gt;</span></code> can be either <code class="docutils literal notranslate"><span class="pre">rw</span></code> for read-write access, or <code class="docutils literal notranslate"><span class="pre">ro</span></code> for read-only access. When omitted, it is assumed to be read-write.</p> <p><code class="docutils literal notranslate"><span class="pre">&lt;selinux_context&gt;</span></code> can be <code class="docutils literal notranslate"><span class="pre">z</span></code> if the volume is shared between multiple containers, or <code class="docutils literal notranslate"><span class="pre">Z</span></code> if the volume should be private.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>When both <code class="docutils literal notranslate"><span class="pre">&lt;read_only&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;selinux_context&gt;</span></code> are specified, there must be a comma before <code class="docutils literal notranslate"><span class="pre">&lt;selinux_context&gt;</span></code>.</p> </div> <p>Binds can be expressed as a comma-separated list or a YAML list. The below two examples are equivalent:</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - binds: /srv/www:/var/www:ro,/etc/foo.conf:/usr/local/etc/foo.conf:rw</pre> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - binds:
      - /srv/www:/var/www:ro
      - /home/myuser/conf/foo.conf:/etc/foo.conf:rw</pre> <p>However, in cases where both ro/rw and an selinux context are combined, the only option is to use a YAML list, like so:</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - binds:
      - /srv/www:/var/www:ro,Z
      - /home/myuser/conf/foo.conf:/etc/foo.conf:rw,Z</pre> <p>Since the second bind in the previous example is mounted read-write, the <code class="docutils literal notranslate"><span class="pre">rw</span></code> and comma can be dropped. For example:</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - binds:
      - /srv/www:/var/www:ro,Z
      - /home/myuser/conf/foo.conf:/etc/foo.conf:Z</pre> </dd> <dt>blkio_weight</dt>
<dd>
<p>Block IO weight (relative weight), accepts a weight value between 10 and 1000.</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - blkio_weight: 100</pre> </dd> <dt>blkio_weight_device</dt>
<dd>
<p>Block IO weight (relative device weight), specified as a list of expressions in the format <code class="docutils literal notranslate"><span class="pre">PATH:RATE</span></code></p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - blkio_weight_device: /dev/sda:100</pre> </dd> <dt>cap_add</dt>
<dd>
<p>List of capabilities to add within the container. Can be expressed as a comma-separated list or a Python list. The below two examples are equivalent:</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - cap_add: SYS_ADMIN,MKNOD</pre> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - cap_add:
      - SYS_ADMIN
      - MKNOD</pre> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This option requires Docker 1.2.0 or newer.</p> </div> </dd> <dt>cap_drop</dt>
<dd>
<p>List of capabilities to drop within the container. Can be expressed as a comma-separated list or a Python list. The below two examples are equivalent:</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - cap_drop: SYS_ADMIN,MKNOD</pre> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - cap_drop:
      - SYS_ADMIN
      - MKNOD</pre> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This option requires Docker 1.2.0 or newer.</p> </div> </dd> <dt>command (or <em>cmd</em>)</dt>
<dd>
<p>Command to run in the container</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - command: bash</pre> </dd> <dt>cpuset_cpus (or <em>cpuset</em>)</dt>
<dd>
<p>CPUs on which which to allow execution, specified as a string containing a range (e.g. <code class="docutils literal notranslate"><span class="pre">0-3</span></code>) or a comma-separated list of CPUs (e.g. <code class="docutils literal notranslate"><span class="pre">0,1</span></code>).</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - cpuset_cpus: "0,1"</pre> </dd> <dt>cpuset_mems</dt>
<dd>
<p>Memory nodes on which which to allow execution, specified as a string containing a range (e.g. <code class="docutils literal notranslate"><span class="pre">0-3</span></code>) or a comma-separated list of MEMs (e.g. <code class="docutils literal notranslate"><span class="pre">0,1</span></code>). Only effective on NUMA systems.</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - cpuset_mems: "0,1"</pre> </dd> <dt>cpu_group</dt>
<dd>
<p>The length of a CPU period in microseconds</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - cpu_group: 100000</pre> </dd> <dt>cpu_period</dt>
<dd>
<p>Microseconds of CPU time that the container can get in a CPU period</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - cpu_period: 50000</pre> </dd> <dt>cpu_shares</dt>
<dd>
<p>CPU shares (relative weight), specified as an integer between 2 and 1024.</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - cpu_shares: 512</pre> </dd> <dt>detach<span class="classifier">False</span>
</dt>
<dd>
<p>If <code class="docutils literal notranslate"><span class="pre">True</span></code>, run the container's command in the background (daemon mode)</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - detach: True</pre> </dd> <dt>devices</dt>
<dd>
<p>List of host devices to expose within the container. Can be expressed as a comma-separated list or a YAML list. The below two examples are equivalent:</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - devices: /dev/net/tun,/dev/xvda1:/dev/xvda1,/dev/xvdb1:/dev/xvdb1:r</pre> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - devices:
      - /dev/net/tun
      - /dev/xvda1:/dev/xvda1
      - /dev/xvdb1:/dev/xvdb1:r</pre> </dd> <dt>device_read_bps</dt>
<dd>
<p>Limit read rate (bytes per second) from a device, specified as a list of expressions in the format <code class="docutils literal notranslate"><span class="pre">PATH:RATE</span></code>, where <code class="docutils literal notranslate"><span class="pre">RATE</span></code> is either an integer number of bytes, or a string ending in <code class="docutils literal notranslate"><span class="pre">kb</span></code>, <code class="docutils literal notranslate"><span class="pre">mb</span></code>, or <code class="docutils literal notranslate"><span class="pre">gb</span></code>. Can be expressed as a comma-separated list or a YAML list. The below two examples are equivalent:</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - devices_read_bps: /dev/sda:1mb,/dev/sdb:5mb</pre> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - devices_read_bps:
      - /dev/sda:1mb
      - /dev/sdb:5mb</pre> </dd> <dt>device_read_iops</dt>
<dd>
<p>Limit read rate (I/O per second) from a device, specified as a list of expressions in the format <code class="docutils literal notranslate"><span class="pre">PATH:RATE</span></code>, where <code class="docutils literal notranslate"><span class="pre">RATE</span></code> is a number of I/O operations. Can be expressed as a comma-separated list or a YAML list. The below two examples are equivalent:</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - devices_read_iops: /dev/sda:1000,/dev/sdb:500</pre> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - devices_read_iops:
      - /dev/sda:1000
      - /dev/sdb:500</pre> </dd> <dt>device_write_bps</dt>
<dd>
<p>Limit write rate (bytes per second) from a device, specified as a list of expressions in the format <code class="docutils literal notranslate"><span class="pre">PATH:RATE</span></code>, where <code class="docutils literal notranslate"><span class="pre">RATE</span></code> is either an integer number of bytes, or a string ending in <code class="docutils literal notranslate"><span class="pre">kb</span></code>, <code class="docutils literal notranslate"><span class="pre">mb</span></code>, or <code class="docutils literal notranslate"><span class="pre">gb</span></code>. Can be expressed as a comma-separated list or a YAML list. The below two examples are equivalent:</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - devices_write_bps: /dev/sda:1mb,/dev/sdb:5mb</pre> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - devices_write_bps:
      - /dev/sda:1mb
      - /dev/sdb:5mb</pre> </dd> <dt>device_write_iops</dt>
<dd>
<p>Limit write rate (I/O per second) from a device, specified as a list of expressions in the format <code class="docutils literal notranslate"><span class="pre">PATH:RATE</span></code>, where <code class="docutils literal notranslate"><span class="pre">RATE</span></code> is a number of I/O operations. Can be expressed as a comma-separated list or a YAML list. The below two examples are equivalent:</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - devices_write_iops: /dev/sda:1000,/dev/sdb:500</pre> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - devices_write_iops:
      - /dev/sda:1000
      - /dev/sdb:500</pre> </dd> <dt>dns</dt>
<dd>
<p>List of DNS nameservers. Can be expressed as a comma-separated list or a YAML list. The below two examples are equivalent:</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - dns: 8.8.8.8,8.8.4.4</pre> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - dns:
      - 8.8.8.8
      - 8.8.4.4</pre> <div class="admonition note"> <p class="admonition-title">Note</p> <p>To skip IP address validation, use <code class="docutils literal notranslate"><span class="pre">validate_ip_addrs=False</span></code></p> </div> </dd> <dt>dns_opt</dt>
<dd>
<p>Additional options to be added to the container’s <code class="docutils literal notranslate"><span class="pre">resolv.conf</span></code> file. Can be expressed as a comma-separated list or a YAML list. The below two examples are equivalent:</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - dns_opt: ndots:9</pre> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - dns_opt:
      - ndots:9</pre> </dd> <dt>dns_search</dt>
<dd>
<p>List of DNS search domains. Can be expressed as a comma-separated list or a YAML list. The below two examples are equivalent:</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - dns_search: foo1.domain.tld,foo2.domain.tld</pre> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - dns_search:
      - foo1.domain.tld
      - foo2.domain.tld</pre> </dd> <dt>domainname</dt>
<dd>
<p>The domain name to use for the container</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - dommainname: domain.tld</pre> </dd> <dt>entrypoint</dt>
<dd>
<p>Entrypoint for the container</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - entrypoint: "mycmd --arg1 --arg2"</pre> <p>This argument can also be specified as a list:</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - entrypoint:
      - mycmd
      - --arg1
      - --arg2</pre> </dd> <dt>environment</dt>
<dd>
<p>Either a list of variable/value mappings, or a list of strings in the format <code class="docutils literal notranslate"><span class="pre">VARNAME=value</span></code>. The below three examples are equivalent:</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - environment:
      - VAR1: value
      - VAR2: value</pre> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - environment: 'VAR1=value,VAR2=value'</pre> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - environment:
      - VAR1=value
      - VAR2=value</pre> </dd> <dt>extra_hosts</dt>
<dd>
<p>Additional hosts to add to the container's /etc/hosts file. Can be expressed as a comma-separated list or a Python list. The below two examples are equivalent:</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - extra_hosts: web1:10.9.8.7,web2:10.9.8.8</pre> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - extra_hosts:
      - web1:10.9.8.7
      - web2:10.9.8.8</pre> <div class="admonition note"> <p class="admonition-title">Note</p> <p>To skip IP address validation, use <code class="docutils literal notranslate"><span class="pre">validate_ip_addrs=False</span></code></p> </div> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This option requires Docker 1.3.0 or newer.</p> </div> </dd> <dt>group_add</dt>
<dd>
<p>List of additional group names and/or IDs that the container process will run as. Can be expressed as a comma-separated list or a YAML list. The below two examples are equivalent:</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - group_add: web,network</pre> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - group_add:
      - web
      - network</pre> </dd> <dt>hostname</dt>
<dd>
<p>Hostname of the container. If not provided, the value passed as the container's``name`` will be used for the hostname.</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - hostname: web1</pre> <div class="admonition warning"> <p class="admonition-title">Warning</p> <p><code class="docutils literal notranslate"><span class="pre">hostname</span></code> cannot be set if <code class="docutils literal notranslate"><span class="pre">network_mode</span></code> is set to <code class="docutils literal notranslate"><span class="pre">host</span></code>. The below example will result in an error:</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - hostname: web1
    - network_mode: host</pre> </div> </dd> <dt>interactive (or <em>stdin_open</em>)<span class="classifier">False</span>
</dt>
<dd>
<p>Leave stdin open, even if not attached</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - interactive: True</pre> </dd> <dt>ipc_mode (or <em>ipc</em>)</dt>
<dd>
<p>Set the IPC mode for the container. The default behavior is to create a private IPC namespace for the container, but this option can be used to change that behavior:</p> <ul class="simple"> <li><p><code class="docutils literal notranslate"><span class="pre">container:&lt;container_name_or_id&gt;</span></code> reuses another container shared memory, semaphores and message queues</p></li> <li><p><code class="docutils literal notranslate"><span class="pre">host</span></code>: use the host's shared memory, semaphores and message queues</p></li> </ul> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - ipc_mode: container:foo</pre> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - ipc_mode: host</pre> <div class="admonition warning"> <p class="admonition-title">Warning</p> <p>Using <code class="docutils literal notranslate"><span class="pre">host</span></code> gives the container full access to local shared memory and is therefore considered insecure.</p> </div> </dd> <dt>isolation</dt>
<dd>
<p>Specifies the type of isolation technology used by containers</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - isolation: hyperv</pre> <div class="admonition note"> <p class="admonition-title">Note</p> <p>The default value on Windows server is <code class="docutils literal notranslate"><span class="pre">process</span></code>, while the default value on Windows client is <code class="docutils literal notranslate"><span class="pre">hyperv</span></code>. On Linux, only <code class="docutils literal notranslate"><span class="pre">default</span></code> is supported.</p> </div> </dd> <dt>labels</dt>
<dd>
<p>Add metadata to the container. Labels can be set both with and without values, and labels with values can be passed either as <code class="docutils literal notranslate"><span class="pre">key=value</span></code> or <code class="docutils literal notranslate"><span class="pre">key:</span> <span class="pre">value</span></code> pairs. For example, while the below would be very confusing to read, it is technically valid, and demonstrates the different ways in which labels can be passed:</p> <pre class="highlight-yaml notranslate" data-language="yaml">mynet:
  docker_network.present:
    - labels:
      - foo
      - bar=baz
      - hello: world</pre> <p>The labels can also simply be passed as a YAML dictionary, though this can be error-prone due to some <a class="reference internal" href="https://docs.saltproject.io/en/latest/topics/troubleshooting/yaml_idiosyncrasies.html#yaml-idiosyncrasies"><span class="std std-ref">idiosyncrasies</span></a> with how PyYAML loads nested data structures:</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_network.present:
    - labels:
        foo: ''
        bar: baz
        hello: world</pre> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 2018.3.0: </span>Methods for specifying labels can now be mixed. Earlier releases required either labels with or without values.</p> </div> </dd> <dt>links</dt>
<dd>
<p>Link this container to another. Links can be specified as a list of mappings or a comma-separated or Python list of expressions in the format <code class="docutils literal notranslate"><span class="pre">&lt;container_name_or_id&gt;:&lt;link_alias&gt;</span></code>. The below three examples are equivalent:</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - links:
      - web1: link1
      - web2: link2</pre> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - links: web1:link1,web2:link2</pre> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - links:
      - web1:link1
      - web2:link2</pre> </dd> <dt>log_driver and log_opt</dt>
<dd>
<p>Set container's logging driver and options to configure that driver. Requires Docker 1.6 or newer.</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - log_driver: syslog
    - log_opt:
      - syslog-address: tcp://192.168.0.42
      - syslog-facility: daemon</pre> <p>The <code class="docutils literal notranslate"><span class="pre">log_opt</span></code> can also be expressed as a comma-separated or YAML list of <code class="docutils literal notranslate"><span class="pre">key=value</span></code> pairs. The below two examples are equivalent to the above one:</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - log_driver: syslog
    - log_opt: "syslog-address=tcp://192.168.0.42,syslog-facility=daemon"</pre> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - log_driver: syslog
    - log_opt:
      - syslog-address=tcp://192.168.0.42
      - syslog-facility=daemon</pre> <div class="admonition note"> <p class="admonition-title">Note</p> <p>The logging driver feature was improved in Docker 1.13 introducing option name changes. Please see Docker's <a class="reference external" href="https://docs.docker.com/engine/admin/logging/overview/">Configure logging drivers</a> documentation for more information.</p> </div> </dd> <dt>lxc_conf</dt>
<dd>
<p>Additional LXC configuration parameters to set before starting the container. Either a list of variable/value mappings, or a list of strings in the format <code class="docutils literal notranslate"><span class="pre">VARNAME=value</span></code>. The below three examples are equivalent:</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - lxc_conf:
      - lxc.utsname: docker
      - lxc.arch: x86_64</pre> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - lxc_conf: lxc.utsname=docker,lxc.arch=x86_64</pre> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - lxc_conf:
      - lxc.utsname=docker
      - lxc.arch=x86_64</pre> <div class="admonition note"> <p class="admonition-title">Note</p> <p>These LXC configuration parameters will only have the desired effect if the container is using the LXC execution driver, which has been deprecated for some time.</p> </div> </dd> <dt>mac_address</dt>
<dd>
<p>MAC address to use for the container. If not specified, a random MAC address will be used.</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - mac_address: 01:23:45:67:89:0a</pre> </dd> <dt>mem_limit (or <em>memory</em>)<span class="classifier">0</span>
</dt>
<dd>
<p>Memory limit. Can be specified in bytes or using single-letter units (i.e. <code class="docutils literal notranslate"><span class="pre">512M</span></code>, <code class="docutils literal notranslate"><span class="pre">2G</span></code>, etc.). A value of <code class="docutils literal notranslate"><span class="pre">0</span></code> (the default) means no memory limit.</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - mem_limit: 512M</pre> </dd> <dt>mem_swappiness</dt>
<dd>
<p>Tune a container's memory swappiness behavior. Accepts an integer between 0 and 100.</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - mem_swappiness: 60</pre> </dd> <dt>memswap_limit (or <em>memory_swap</em>)<span class="classifier">-1</span>
</dt>
<dd>
<p>Total memory limit (memory plus swap). Set to <code class="docutils literal notranslate"><span class="pre">-1</span></code> to disable swap. A value of <code class="docutils literal notranslate"><span class="pre">0</span></code> means no swap limit.</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - memswap_limit: 1G</pre> </dd> <dt>network_disabled<span class="classifier">False</span>
</dt>
<dd>
<p>If <code class="docutils literal notranslate"><span class="pre">True</span></code>, networking will be disabled within the container</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - network_disabled: True</pre> </dd> <dt>network_mode<span class="classifier">bridge</span>
</dt>
<dd>
<p>One of the following:</p> <ul> <li><p><code class="docutils literal notranslate"><span class="pre">bridge</span></code> - Creates a new network stack for the container on the docker bridge</p></li> <li><p><code class="docutils literal notranslate"><span class="pre">none</span></code> - No networking (equivalent of the Docker CLI argument <code class="docutils literal notranslate"><span class="pre">--net=none</span></code>). Not to be confused with Python's <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p></li> <li><p><code class="docutils literal notranslate"><span class="pre">container:&lt;name_or_id&gt;</span></code> - Reuses another container's network stack</p></li> <li>
<p><code class="docutils literal notranslate"><span class="pre">host</span></code> - Use the host's network stack inside the container</p> <div class="admonition warning"> <p class="admonition-title">Warning</p> <p>Using <code class="docutils literal notranslate"><span class="pre">host</span></code> mode gives the container full access to the hosts system's services (such as D-bus), and is therefore considered insecure.</p> </div> </li> </ul> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - network_mode: "none"</pre> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - network_mode: container:web1</pre> </dd> <dt>oom_kill_disable</dt>
<dd>
<p>Whether to disable OOM killer</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - oom_kill_disable: False</pre> </dd> <dt>oom_score_adj</dt>
<dd>
<p>An integer value containing the score given to the container in order to tune OOM killer preferences</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - oom_score_adj: 500</pre> </dd> <dt>pid_mode</dt>
<dd>
<p>Set to <code class="docutils literal notranslate"><span class="pre">host</span></code> to use the host container's PID namespace within the container. Requires Docker 1.5.0 or newer.</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - pid_mode: host</pre> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This option requires Docker 1.5.0 or newer.</p> </div> </dd> <dt>pids_limit</dt>
<dd>
<p>Set the container's PID limit. Set to <code class="docutils literal notranslate"><span class="pre">-1</span></code> for unlimited.</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - pids_limit: 2000</pre> </dd> <dt>port_bindings (or <em>publish</em>)</dt>
<dd>
<p>Bind exposed ports. Port bindings should be passed in the same way as the <code class="docutils literal notranslate"><span class="pre">--publish</span></code> argument to the <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span></code> CLI command:</p> <ul class="simple"> <li><p><code class="docutils literal notranslate"><span class="pre">ip:hostPort:containerPort</span></code> - Bind a specific IP and port on the host to a specific port within the container.</p></li> <li><p><code class="docutils literal notranslate"><span class="pre">ip::containerPort</span></code> - Bind a specific IP and an ephemeral port to a specific port within the container.</p></li> <li><p><code class="docutils literal notranslate"><span class="pre">hostPort:containerPort</span></code> - Bind a specific port on all of the host's interfaces to a specific port within the container.</p></li> <li><p><code class="docutils literal notranslate"><span class="pre">containerPort</span></code> - Bind an ephemeral port on all of the host's interfaces to a specific port within the container.</p></li> </ul> <p>Multiple bindings can be separated by commas, or expressed as a YAML list, and port ranges can be defined using dashes. The below two examples are equivalent:</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - port_bindings: "4505-4506:14505-14506,2123:2123/udp,8080"</pre> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - port_bindings:
      - 4505-4506:14505-14506
      - 2123:2123/udp
      - 8080</pre> <div class="admonition note"> <p class="admonition-title">Note</p> <p>When specifying a protocol, it must be passed in the <code class="docutils literal notranslate"><span class="pre">containerPort</span></code> value, as seen in the examples above.</p> </div> </dd> <dt>ports</dt>
<dd>
<p>A list of ports to expose on the container. Can either be a comma-separated list or a YAML list. If the protocol is omitted, the port will be assumed to be a TCP port. The below two examples are equivalent:</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - ports: 1111,2222/udp</pre> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - ports:
      - 1111
      - 2222/udp</pre> </dd> <dt>privileged<span class="classifier">False</span>
</dt>
<dd>
<p>If <code class="docutils literal notranslate"><span class="pre">True</span></code>, runs the exec process with extended privileges</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - privileged: True</pre> </dd> <dt>publish_all_ports (or <em>publish_all</em>)<span class="classifier">False</span>
</dt>
<dd>
<p>Publish all ports to the host</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - ports: 8080
    - publish_all_ports: True</pre> </dd> <dt>read_only<span class="classifier">False</span>
</dt>
<dd>
<p>If <code class="docutils literal notranslate"><span class="pre">True</span></code>, mount the container’s root filesystem as read only</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - read_only: True</pre> </dd> <dt>restart_policy (or <em>restart</em>)</dt>
<dd>
<p>Set a restart policy for the container. Must be passed as a string in the format <code class="docutils literal notranslate"><span class="pre">policy[:retry_count]</span></code> where <code class="docutils literal notranslate"><span class="pre">policy</span></code> is one of <code class="docutils literal notranslate"><span class="pre">always</span></code>, <code class="docutils literal notranslate"><span class="pre">unless-stopped</span></code>, or <code class="docutils literal notranslate"><span class="pre">on-failure</span></code>, and <code class="docutils literal notranslate"><span class="pre">retry_count</span></code> is an optional limit to the number of retries. The retry count is ignored when using the <code class="docutils literal notranslate"><span class="pre">always</span></code> or <code class="docutils literal notranslate"><span class="pre">unless-stopped</span></code> restart policy.</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - restart_policy: on-failure:5

bar:
  docker_container.running:
    - image: bar/baz:latest
    - restart_policy: always</pre> </dd> <dt>security_opt (or <em>security_opts</em>):</dt>
<dd>
<p>Security configuration for MLS systems such as SELinux and AppArmor. Can be expressed as a comma-separated list or a YAML list. The below two examples are equivalent:</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - security_opt: apparmor:unconfined</pre> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - security_opt:
      - apparmor:unconfined</pre> <div class="admonition important"> <p class="admonition-title">Important</p> <p>Some security options can contain commas. In these cases, this argument <em>must</em> be passed as a Python list, as splitting by comma will result in an invalid configuration.</p> </div> <div class="admonition note"> <p class="admonition-title">Note</p> <p>See the documentation for security_opt at <a class="reference external" href="https://docs.docker.com/engine/reference/run/#security-configuration">https://docs.docker.com/engine/reference/run/#security-configuration</a></p> </div> </dd> <dt>shm_size</dt>
<dd>
<p>Size of /dev/shm</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - shm_size: 128M</pre> </dd> <dt>stop_signal</dt>
<dd>
<p>Specify the signal docker will send to the container when stopping. Useful when running systemd as PID 1 inside the container.</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - stop_signal: SIGRTMIN+3</pre> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This option requires Docker 1.9.0 or newer and docker-py 1.7.0 or newer.</p> </div> <div class="versionadded"> <p><span class="versionmodified added">New in version 2016.11.0.</span></p> </div> </dd> <dt>stop_timeout</dt>
<dd>
<p>Timeout to stop the container, in seconds</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - stop_timeout: 5</pre> <div class="admonition note"> <p class="admonition-title">Note</p> <p>In releases prior to 2017.7.0, this option was not set in the container configuration, but rather this timeout was enforced only when shutting down an existing container to replace it. To remove the ambiguity, and to allow for the container to have a stop timeout set for it, the old <code class="docutils literal notranslate"><span class="pre">stop_timeout</span></code> argument has been renamed to <code class="docutils literal notranslate"><span class="pre">shutdown_timeout</span></code>, while <code class="docutils literal notranslate"><span class="pre">stop_timeout</span></code> now refer's to the container's configured stop timeout.</p> </div> </dd> <dt>storage_opt</dt>
<dd>
<p>Storage driver options for the container. Can be either a list of strings in the format <code class="docutils literal notranslate"><span class="pre">option=value</span></code>, or a list of mappings between option and value. The below three examples are equivalent:</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - storage_opt:
      - dm.basesize: 40G</pre> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - storage_opt: dm.basesize=40G</pre> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - storage_opt:
      - dm.basesize=40G</pre> </dd> <dt>sysctls (or <em>sysctl</em>)</dt>
<dd>
<p>Set sysctl options for the container. Can be either a list of strings in the format <code class="docutils literal notranslate"><span class="pre">option=value</span></code>, or a list of mappings between option and value. The below three examples are equivalent:</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - sysctls:
      - fs.nr_open: 1048576
      - kernel.pid_max: 32768</pre> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - sysctls: fs.nr_open=1048576,kernel.pid_max=32768</pre> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - sysctls:
      - fs.nr_open=1048576
      - kernel.pid_max=32768</pre> </dd> <dt>tmpfs</dt>
<dd>
<p>A map of container directories which should be replaced by tmpfs mounts and their corresponding mount options.</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - tmpfs:
      - /run: rw,noexec,nosuid,size=65536k</pre> </dd> <dt>tty<span class="classifier">False</span>
</dt>
<dd>
<p>Attach TTYs</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - tty: True</pre> </dd> <dt>ulimits</dt>
<dd>
<p>List of ulimits. These limits should be passed in the format <code class="docutils literal notranslate"><span class="pre">&lt;ulimit_name&gt;:&lt;soft_limit&gt;:&lt;hard_limit&gt;</span></code>, with the hard limit being optional. Can be expressed as a comma-separated list or a YAML list. The below two examples are equivalent:</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - ulimits: nofile=1024:1024,nproc=60</pre> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - ulimits:
      - nofile=1024:1024
      - nproc=60</pre> </dd> <dt>user</dt>
<dd>
<p>User under which to run exec process</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - user: foo</pre> </dd> <dt>userns_mode (or <em>user_ns_mode</em>)</dt>
<dd>
<p>Sets the user namsepace mode, when the user namespace remapping option is enabled</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - userns_mode: host</pre> </dd> <dt>volumes (or <em>volume</em>)</dt>
<dd>
<p>List of directories to expose as volumes. Can be expressed as a comma-separated list or a YAML list. The below two examples are equivalent:</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - volumes: /mnt/vol1,/mnt/vol2</pre> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - volumes:
      - /mnt/vol1
      - /mnt/vol2</pre> </dd> <dt>volumes_from</dt>
<dd>
<p>Container names or IDs from which the container will get volumes. Can be expressed as a comma-separated list or a YAML list. The below two examples are equivalent:</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - volumes_from: foo</pre> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - volumes_from:
      - foo</pre> </dd> <dt>volume_driver</dt>
<dd>
<p>sets the container's volume driver</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - volume_driver: foobar</pre> </dd> <dt>working_dir (or <em>workdir</em>)</dt>
<dd>
<p>Working directory inside the container</p> <pre class="highlight-yaml notranslate" data-language="yaml">foo:
  docker_container.running:
    - image: bar/baz:latest
    - working_dir: /var/log/nginx</pre> </dd> </dl> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.docker_container.stopped"> salt.states.docker_container.stopped(name=None, containers=None, shutdown_timeout=None, unpause=False, error_on_absent=True, **kwargs)</h3> <dd>
<p>Ensure that a container (or containers) is stopped</p> <dl> <dt>name</dt>
<dd>
<p>Name or ID of the container</p> </dd> <dt>containers</dt>
<dd>
<p>Run this state on more than one container at a time. The following two examples accomplish the same thing:</p> <pre class="highlight-yaml notranslate" data-language="yaml">stopped_containers:
  docker_container.stopped:
    - names:
      - foo
      - bar
      - baz</pre> <pre class="highlight-yaml notranslate" data-language="yaml">stopped_containers:
  docker_container.stopped:
    - containers:
      - foo
      - bar
      - baz</pre> <p>However, the second example will be a bit quicker since Salt will stop all specified containers in a single run, rather than executing the state separately on each image (as it would in the first example).</p> </dd> <dt>shutdown_timeout</dt>
<dd>
<p>Timeout for graceful shutdown of the container. If this timeout is exceeded, the container will be killed. If this value is not passed, then the container's configured <code class="docutils literal notranslate"><span class="pre">stop_timeout</span></code> will be observed. If <code class="docutils literal notranslate"><span class="pre">stop_timeout</span></code> was also unset on the container, then a timeout of 10 seconds will be used.</p> </dd> <dt>unpause<span class="classifier">False</span>
</dt>
<dd>
<p>Set to <code class="docutils literal notranslate"><span class="pre">True</span></code> to unpause any paused containers before stopping. If unset, then an error will be raised for any container that was paused.</p> </dd> <dt>error_on_absent<span class="classifier">True</span>
</dt>
<dd>
<p>By default, this state will return an error if any of the specified containers are absent. Set this to <code class="docutils literal notranslate"><span class="pre">False</span></code> to suppress that error.</p> </dd> </dl> </dd>
</dl><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2021 SaltStack.<br>Licensed under the Apache License, Version 2.0.<br>
    <a href="https://docs.saltproject.io/en/latest/ref/states/all/salt.states.docker_container.html" class="_attribution-link">https://docs.saltproject.io/en/latest/ref/states/all/salt.states.docker_container.html</a>
  </p>
</div>
