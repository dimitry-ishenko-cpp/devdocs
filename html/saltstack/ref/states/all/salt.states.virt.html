<h1>salt.states.virt</h1> <div class="section" id="manage-virt"> <h2>Manage virt</h2> <p>For the key certificate this state uses the external pillar in the master to call for the generation and signing of certificates for systems running libvirt:</p> <pre class="highlight-yaml notranslate" data-language="yaml">libvirt_keys:
  virt.keys</pre> <dl class="py function"> <h3 id="salt.states.virt.defined"> salt.states.virt.defined(name, cpu=None, mem=None, vm_type=None, disk_profile=None, disks=None, nic_profile=None, interfaces=None, graphics=None, seed=True, install=True, pub_key=None, priv_key=None, connection=None, username=None, password=None, os_type=None, arch=None, boot=None, numatune=None, boot_dev=None, hypervisor_features=None, clock=None, serials=None, consoles=None, stop_on_reboot=False, live=True, host_devices=None)</h3> <dd>
<p>Starts an existing guest, or defines and starts a new VM with specified arguments.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 3001.</span></p> </div> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li><p><strong>name</strong> -- name of the virtual machine to run</p></li> <li>
<p><strong>cpu</strong> -- </p>
<p>Number of virtual CPUs to assign to the virtual machine or a dictionary with detailed information to configure cpu model and topology, numa node tuning, cpu tuning and iothreads allocation. The structure of the dictionary is documented in <a class="reference internal" href="../../modules/all/salt.modules.virt.html#init-cpu-def"><span class="std std-ref">cpu parameters definition</span></a>.</p> <pre class="highlight-yaml notranslate" data-language="yaml">cpu:
  placement: static
  cpuset: 0-11
  current: 5
  maximum: 12
  vcpus:
    0:
      enabled: 'yes'
      hotpluggable: 'no'
      order: 1
    1:
      enabled: 'no'
      hotpluggable: 'yes'
  match: minimum
  mode: custom
  check: full
  vendor: Intel
  model:
    name: core2duo
    fallback: allow
    vendor_id: GenuineIntel
  topology:
    sockets: 1
    cores: 12
    threads: 1
  cache:
    level: 3
    mode: emulate
  feature:
    policy: optional
    name: lahf_lm
  numa:
    0:
       cpus: 0-3
       memory: 1g
       discard: 'yes'
       distances:
         0: 10     # sibling id : value
         1: 21
         2: 31
         3: 41
    1:
       cpus: 4-6
       memory: 1g
       memAccess: shared
       distances:
         0: 21
         1: 10
         2: 21
         3: 31
  tuning:
       vcpupin:
         0: 1-4,^2  # vcpuid : cpuset
         1: 0,1
         2: 2,3
         3: 0,4
       emulatorpin: 1-3
       iothreadpin:
         1: 5,6    # iothread id: cpuset
         2: 7,8
       shares: 2048
       period: 1000000
       quota: -1
       global_period: 1000000
       global_quota: -1
       emulator_period: 1000000
       emulator_quota: -1
       iothread_period: 1000000
       iothread_quota: -1
       vcpusched:
         - scheduler: fifo
           priority: 1
         - scheduler: fifo
           priority: 2
           vcpus: 1-3
         - scheduler: rr
           priority: 3
           vcpus: 4
       iothreadsched:
         - scheduler: batch
           iothreads: 2
       emulatorsched:
         scheduler: idle
       cachetune:
         0-3:      # vcpus set
           0:      # cache id
             level: 3
             type: both
             size: 4
           1:
             level: 3
             type: both
             size: 6
           monitor:
             1: 3
             0-3: 3
         4-5:
           monitor:
             4: 3  # vcpus: level
             5: 3
       memorytune:
         0-3:      # vcpus set
           0: 60   # node id: bandwidth
         4-5:
           0: 60
  iothreads: 4</pre> <div class="versionadded"> <p><span class="versionmodified added">New in version 3003.</span></p> </div> </li> <li>
<p><strong>mem</strong> -- </p>
<p>Amount of memory to allocate to the virtual machine in MiB. Since 3002, a dictionary can be used to contain detailed configuration which support memory allocation or tuning. Supported parameters are <code class="docutils literal notranslate"><span class="pre">boot</span></code>, <code class="docutils literal notranslate"><span class="pre">current</span></code>, <code class="docutils literal notranslate"><span class="pre">max</span></code>, <code class="docutils literal notranslate"><span class="pre">slots</span></code>, <code class="docutils literal notranslate"><span class="pre">hard_limit</span></code>, <code class="docutils literal notranslate"><span class="pre">soft_limit</span></code>, <code class="docutils literal notranslate"><span class="pre">swap_hard_limit</span></code>, <code class="docutils literal notranslate"><span class="pre">min_guarantee</span></code>, <code class="docutils literal notranslate"><span class="pre">hugepages</span></code> , <code class="docutils literal notranslate"><span class="pre">nosharepages</span></code>, <code class="docutils literal notranslate"><span class="pre">locked</span></code>, <code class="docutils literal notranslate"><span class="pre">source</span></code>, <code class="docutils literal notranslate"><span class="pre">access</span></code>, <code class="docutils literal notranslate"><span class="pre">allocation</span></code> and <code class="docutils literal notranslate"><span class="pre">discard</span></code>. The structure of the dictionary is documented in <a class="reference internal" href="../../modules/all/salt.modules.virt.html#init-mem-def"><span class="std std-ref">Memory parameter definition</span></a>. Both decimal and binary base are supported. Detail unit specification is documented in <a class="reference internal" href="../../modules/all/salt.modules.virt.html#virt-units"><span class="std std-ref">Units specification</span></a>. Please note that the value for <code class="docutils literal notranslate"><span class="pre">slots</span></code> must be an integer.</p> <pre class="highlight-yaml notranslate" data-language="yaml">boot: 1g
current: 1g
max: 1g
slots: 10
hard_limit: 1024
soft_limit: 512m
swap_hard_limit: 1g
min_guarantee: 512mib
hugepages:
  - size: 2m
  - nodeset: 0-2
    size: 1g
  - nodeset: 3
    size: 2g
nosharepages: True
locked: True
source: file
access: shared
allocation: immediate
discard: True</pre> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 3002.</span></p> </div> </li> <li><p><strong>vm_type</strong> -- force virtual machine type for the new VM. The default value is taken from the host capabilities. This could be useful for example to use <code class="docutils literal notranslate"><span class="pre">'qemu'</span></code> type instead of the <code class="docutils literal notranslate"><span class="pre">'kvm'</span></code> one.</p></li> <li><p><strong>disk_profile</strong> -- Name of the disk profile to use for the new virtual machine</p></li> <li><p><strong>disks</strong> -- List of disk to create for the new virtual machine. See <a class="reference internal" href="../../modules/all/salt.modules.virt.html#init-disk-def"><span class="std std-ref">Disks Definitions</span></a> for more details on the items on this list.</p></li> <li><p><strong>nic_profile</strong> -- Name of the network interfaces profile to use for the new virtual machine</p></li> <li><p><strong>interfaces</strong> -- List of network interfaces to create for the new virtual machine. See <a class="reference internal" href="../../modules/all/salt.modules.virt.html#init-nic-def"><span class="std std-ref">Network Interfaces Definitions</span></a> for more details on the items on this list.</p></li> <li><p><strong>graphics</strong> -- Graphics device to create for the new virtual machine. See <a class="reference internal" href="../../modules/all/salt.modules.virt.html#init-graphics-def"><span class="std std-ref">Graphics Definition</span></a> for more details on this dictionary</p></li> <li><p><strong>saltenv</strong> -- Fileserver environment (Default: <code class="docutils literal notranslate"><span class="pre">'base'</span></code>). See <a class="reference internal" href="../../modules/all/salt.modules.cp.html#module-salt.modules.cp" title="salt.modules.cp"><code class="xref py py-mod docutils literal notranslate"><span class="pre">cp</span> <span class="pre">module</span> <span class="pre">for</span> <span class="pre">more</span> <span class="pre">details</span></code></a></p></li> <li><p><strong>seed</strong> -- <code class="docutils literal notranslate"><span class="pre">True</span></code> to seed the disk image. Only used when the <code class="docutils literal notranslate"><span class="pre">image</span></code> parameter is provided. (Default: <code class="docutils literal notranslate"><span class="pre">True</span></code>)</p></li> <li><p><strong>install</strong> -- install salt minion if absent (Default: <code class="docutils literal notranslate"><span class="pre">True</span></code>)</p></li> <li><p><strong>pub_key</strong> -- public key to seed with (Default: <code class="docutils literal notranslate"><span class="pre">None</span></code>)</p></li> <li><p><strong>priv_key</strong> -- public key to seed with (Default: <code class="docutils literal notranslate"><span class="pre">None</span></code>)</p></li> <li><p><strong>seed_cmd</strong> -- Salt command to execute to seed the image. (Default: <code class="docutils literal notranslate"><span class="pre">'seed.apply'</span></code>)</p></li> <li><p><strong>connection</strong> -- libvirt connection URI, overriding defaults</p></li> <li><p><strong>username</strong> -- username to connect with, overriding defaults</p></li> <li><p><strong>password</strong> -- password to connect with, overriding defaults</p></li> <li><p><strong>os_type</strong> -- type of virtualization as found in the <code class="docutils literal notranslate"><span class="pre">//os/type</span></code> element of the libvirt definition. The default value is taken from the host capabilities, with a preference for <code class="docutils literal notranslate"><span class="pre">hvm</span></code>. Only used when creating a new virtual machine.</p></li> <li><p><strong>arch</strong> -- architecture of the virtual machine. The default value is taken from the host capabilities, but <code class="docutils literal notranslate"><span class="pre">x86_64</span></code> is prefed over <code class="docutils literal notranslate"><span class="pre">i686</span></code>. Only used when creating a new virtual machine.</p></li> <li>
<p><strong>boot</strong> -- </p>
<p>Specifies kernel, initial ramdisk and kernel command line parameters for the virtual machine. This is an optional parameter, all of the keys are optional within the dictionary.</p> <p>Refer to <a class="reference internal" href="../../modules/all/salt.modules.virt.html#init-boot-def"><span class="std std-ref">Boot parameters definition</span></a> for the complete boot parameters description.</p> <p>To update any boot parameters, specify the new path for each. To remove any boot parameters, pass a None object, for instance: 'kernel': <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 3000.</span></p> </div> </li> <li>
<p><strong>boot_dev</strong> -- </p>
<p>Space separated list of devices to boot from sorted by decreasing priority. Values can be <code class="docutils literal notranslate"><span class="pre">hd</span></code>, <code class="docutils literal notranslate"><span class="pre">fd</span></code>, <code class="docutils literal notranslate"><span class="pre">cdrom</span></code> or <code class="docutils literal notranslate"><span class="pre">network</span></code>.</p> <p>By default, the value will <code class="docutils literal notranslate"><span class="pre">"hd"</span></code>.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 3002.</span></p> </div> </li> <li>
<p><strong>numatune</strong> -- </p>
<p>The optional numatune element provides details of how to tune the performance of a NUMA host via controlling NUMA policy for domain process. The optional <code class="docutils literal notranslate"><span class="pre">memory</span></code> element specifies how to allocate memory for the domain process on a NUMA host. <code class="docutils literal notranslate"><span class="pre">memnode</span></code> elements can specify memory allocation policies per each guest NUMA node. The definition used in the dictionary can be found at <a class="reference internal" href="../../modules/all/salt.modules.virt.html#init-cpu-def"><span class="std std-ref">cpu parameters definition</span></a>.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 3003.</span></p> </div> <pre class="highlight-python notranslate" data-language="python">{
    'memory': {'mode': 'strict', 'nodeset': '0-11'},
    'memnodes': {0: {'mode': 'strict', 'nodeset': 1}, 1: {'mode': 'preferred', 'nodeset': 2}}
}</pre> </li> <li>
<p><strong>hypervisor_features</strong> -- </p>
<p>Enable or disable hypervisor-specific features on the virtual machine.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 3003.</span></p> </div> <pre class="highlight-yaml notranslate" data-language="yaml">hypervisor_features:
  kvm-hint-dedicated: True</pre> </li> <li>
<p><strong>clock</strong> -- </p>
<p>Configure the guest clock. The value is a dictionary with the following keys:</p> <dl class="simple"> <dt>adjustment</dt>
<dd>
<p>time adjustment in seconds or <code class="docutils literal notranslate"><span class="pre">reset</span></code></p> </dd> <dt>utc</dt>
<dd>
<p>set to <code class="docutils literal notranslate"><span class="pre">False</span></code> to use the host local time as the guest clock. Defaults to <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p> </dd> <dt>timezone</dt>
<dd>
<p>synchronize the guest to the correspding timezone</p> </dd> <dt>timers</dt>
<dd>
<p>a dictionary associating the timer name with its configuration. This configuration is a dictionary with the properties <code class="docutils literal notranslate"><span class="pre">track</span></code>, <code class="docutils literal notranslate"><span class="pre">tickpolicy</span></code>, <code class="docutils literal notranslate"><span class="pre">catchup</span></code>, <code class="docutils literal notranslate"><span class="pre">frequency</span></code>, <code class="docutils literal notranslate"><span class="pre">mode</span></code>, <code class="docutils literal notranslate"><span class="pre">present</span></code>, <code class="docutils literal notranslate"><span class="pre">slew</span></code>, <code class="docutils literal notranslate"><span class="pre">threshold</span></code> and <code class="docutils literal notranslate"><span class="pre">limit</span></code>. See <a class="reference external" href="https://libvirt.org/formatdomain.html#time-keeping">libvirt time keeping documentation</a> for the possible values.</p> </dd> </dl> <div class="versionadded"> <p><span class="versionmodified added">New in version 3003.</span></p> </div> <p>Set the clock to local time using an offset in seconds .. code-block:: yaml</p> <blockquote> <div>
<dl class="simple"> <dt>clock:</dt>
<dd>
<p>adjustment: 3600 utc: False</p> </dd> </dl> </div>
</blockquote> <p>Set the clock to a specific time zone:</p> <pre class="highlight-yaml notranslate" data-language="yaml">clock:
  timezone: CEST</pre> </li> <li>
<p><strong>serials</strong> -- </p>
<p>Dictionary providing details on the serials connection to create. (Default: <code class="docutils literal notranslate"><span class="pre">None</span></code>) See <a class="reference internal" href="../../modules/all/salt.modules.virt.html#init-chardevs-def"><span class="std std-ref">Serials and Consoles Definitions</span></a> for more details on the possible values.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 3003.</span></p> </div> </li> <li>
<p><strong>consoles</strong> -- </p>
<p>Dictionary providing details on the consoles device to create. (Default: <code class="docutils literal notranslate"><span class="pre">None</span></code>) See <a class="reference internal" href="../../modules/all/salt.modules.virt.html#init-chardevs-def"><span class="std std-ref">Serials and Consoles Definitions</span></a> for more details on the possible values.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 3003.</span></p> </div> </li> <li>
<p><strong>stop_on_reboot</strong> -- </p>
<p>If set to <code class="docutils literal notranslate"><span class="pre">True</span></code> the guest will stop instead of rebooting. This is specially useful when creating a virtual machine with an installation cdrom or an autoinstallation needing a special first boot configuration. Defaults to <code class="docutils literal notranslate"><span class="pre">False</span></code></p> <div class="versionadded"> <p><span class="versionmodified added">New in version 3003.</span></p> </div> </li> <li>
<p><strong>live</strong> -- </p>
<p>If set to <code class="docutils literal notranslate"><span class="pre">False</span></code> the changes will not be applied live to the running instance, but will only apply at the next start. Note that reboot will not take those changes.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 3003.</span></p> </div> </li> <li>
<p><strong>host_devices</strong> -- </p>
<p>List of host devices to passthrough to the guest. The value is a list of device names as provided by the <a class="reference internal" href="../../modules/all/salt.modules.virt.html#salt.modules.virt.node_devices" title="salt.modules.virt.node_devices"><code class="xref py py-func docutils literal notranslate"><span class="pre">node_devices()</span></code></a> function. (Default: <code class="docutils literal notranslate"><span class="pre">None</span></code>)</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 3003.</span></p> </div> </li> </ul> </dd> </dl> <p class="rubric">Example States</p> <p>Make sure a virtual machine called <code class="docutils literal notranslate"><span class="pre">domain_name</span></code> is defined:</p> <pre class="highlight-yaml notranslate" data-language="yaml">domain_name:
  virt.defined:
    - cpu: 2
    - mem: 2048
    - boot_dev: network hd
    - disk_profile: prod
    - disks:
      - name: system
        size: 8192
        overlay_image: True
        pool: default
        image: /path/to/image.qcow2
      - name: data
        size: 16834
    - nic_profile: prod
    - interfaces:
      - name: eth0
        mac: 01:23:45:67:89:AB
      - name: eth1
        type: network
        source: admin
    - graphics:
        type: spice
        listen:
            type: address
            address: 192.168.0.125</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.virt.keys"> salt.states.virt.keys(name, basepath='/etc/pki', **kwargs)</h3> <dd>
<p>Manage libvirt keys.</p> <dl class="simple"> <dt>name</dt>
<dd>
<p>The name variable used to track the execution</p> </dd> <dt>basepath</dt>
<dd>
<p>Defaults to <code class="docutils literal notranslate"><span class="pre">/etc/pki</span></code>, this is the root location used for libvirt keys on the hypervisor</p> </dd> </dl> <p>The following parameters are optional:</p> <blockquote> <div>
<dl class="simple"> <dt>country</dt>
<dd>
<p>The country that the certificate should use. Defaults to US.</p> </dd> </dl> <div class="versionadded"> <p><span class="versionmodified added">New in version 2018.3.0.</span></p> </div> <dl class="simple"> <dt>state</dt>
<dd>
<p>The state that the certificate should use. Defaults to Utah.</p> </dd> </dl> <div class="versionadded"> <p><span class="versionmodified added">New in version 2018.3.0.</span></p> </div> <dl class="simple"> <dt>locality</dt>
<dd>
<p>The locality that the certificate should use. Defaults to Salt Lake City.</p> </dd> </dl> <div class="versionadded"> <p><span class="versionmodified added">New in version 2018.3.0.</span></p> </div> <dl class="simple"> <dt>organization</dt>
<dd>
<p>The organization that the certificate should use. Defaults to Salted.</p> </dd> </dl> <div class="versionadded"> <p><span class="versionmodified added">New in version 2018.3.0.</span></p> </div> <dl class="simple"> <dt>expiration_days</dt>
<dd>
<p>The number of days that the certificate should be valid for. Defaults to 365 days (1 year)</p> </dd> </dl> <div class="versionadded"> <p><span class="versionmodified added">New in version 2018.3.0.</span></p> </div> </div>
</blockquote> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.virt.network_defined"> salt.states.virt.network_defined(name, bridge, forward, vport=None, tag=None, ipv4_config=None, ipv6_config=None, autostart=True, connection=None, username=None, password=None, mtu=None, domain=None, nat=None, interfaces=None, addresses=None, physical_function=None, dns=None)</h3> <dd>
<p>Defines a new network with specified arguments.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li><p><strong>name</strong> -- Network name</p></li> <li><p><strong>bridge</strong> -- Bridge name</p></li> <li>
<p><strong>forward</strong> -- </p>
<p>Forward mode(bridge, router, nat)</p> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 3003: </span>a <code class="docutils literal notranslate"><span class="pre">None</span></code> value creates an isolated network with no forwarding at all</p> </div> </li> <li>
<p><strong>vport</strong> -- </p>
<p>Virtualport type (Default: <code class="docutils literal notranslate"><span class="pre">'None'</span></code>) The value can also be a dictionary with <code class="docutils literal notranslate"><span class="pre">type</span></code> and <code class="docutils literal notranslate"><span class="pre">parameters</span></code> keys. The <code class="docutils literal notranslate"><span class="pre">parameters</span></code> value is a dictionary of virtual port parameters.</p> <pre class="highlight-yaml notranslate" data-language="yaml">- vport:
    type: openvswitch
    parameters:
      interfaceid: 09b11c53-8b5c-4eeb-8f00-d84eaa0aaa4f</pre> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 3003: </span>possible dictionary value</p> </div> </li> <li>
<p><strong>tag</strong> -- </p>
<p>Vlan tag (Default: <code class="docutils literal notranslate"><span class="pre">'None'</span></code>) The value can also be a dictionary with the <code class="docutils literal notranslate"><span class="pre">tags</span></code> and optional <code class="docutils literal notranslate"><span class="pre">trunk</span></code> keys. <code class="docutils literal notranslate"><span class="pre">trunk</span></code> is a boolean value indicating whether to use VLAN trunking. <code class="docutils literal notranslate"><span class="pre">tags</span></code> is a list of dictionaries with keys <code class="docutils literal notranslate"><span class="pre">id</span></code> and <code class="docutils literal notranslate"><span class="pre">nativeMode</span></code>. The <code class="docutils literal notranslate"><span class="pre">nativeMode</span></code> value can be one of <code class="docutils literal notranslate"><span class="pre">tagged</span></code> or <code class="docutils literal notranslate"><span class="pre">untagged</span></code>.</p> <pre class="highlight-yaml notranslate" data-language="yaml">- tag:
    trunk: True
    tags:
      - id: 42
        nativeMode: untagged
      - id: 47</pre> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 3003: </span>possible dictionary value</p> </div> </li> <li><p><strong>ipv4_config</strong> -- IPv4 network configuration. See the <a class="reference internal" href="../../modules/all/salt.modules.virt.html#salt.modules.virt.network_define" title="salt.modules.virt.network_define"><code class="xref py py-func docutils literal notranslate"><span class="pre">virt.network_define</span></code></a> function corresponding parameter documentation for more details on this dictionary. (Default: None).</p></li> <li><p><strong>ipv6_config</strong> -- IPv6 network configuration. See the <a class="reference internal" href="../../modules/all/salt.modules.virt.html#salt.modules.virt.network_define" title="salt.modules.virt.network_define"><code class="xref py py-func docutils literal notranslate"><span class="pre">virt.network_define</span></code></a> function corresponding parameter documentation for more details on this dictionary. (Default: None).</p></li> <li><p><strong>autostart</strong> -- Network autostart (default <code class="docutils literal notranslate"><span class="pre">'True'</span></code>)</p></li> <li><p><strong>connection</strong> -- libvirt connection URI, overriding defaults</p></li> <li><p><strong>username</strong> -- username to connect with, overriding defaults</p></li> <li><p><strong>password</strong> -- password to connect with, overriding defaults</p></li> <li>
<p><strong>mtu</strong> -- </p>
<p>size of the Maximum Transmission Unit (MTU) of the network. (default <code class="docutils literal notranslate"><span class="pre">None</span></code>)</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 3003.</span></p> </div> </li> <li>
<p><strong>domain</strong> -- </p>
<p>DNS domain name of the DHCP server. The value is a dictionary with a mandatory <code class="docutils literal notranslate"><span class="pre">name</span></code> property and an optional <code class="docutils literal notranslate"><span class="pre">localOnly</span></code> boolean one. (default <code class="docutils literal notranslate"><span class="pre">None</span></code>)</p> <pre class="highlight-yaml notranslate" data-language="yaml">- domain:
    name: lab.acme.org
    localOnly: True</pre> <div class="versionadded"> <p><span class="versionmodified added">New in version 3003.</span></p> </div> </li> <li>
<p><strong>nat</strong> -- </p>
<p>addresses and ports to route in NAT forward mode. The value is a dictionary with optional keys <code class="docutils literal notranslate"><span class="pre">address</span></code> and <code class="docutils literal notranslate"><span class="pre">port</span></code>. Both values are a dictionary with <code class="docutils literal notranslate"><span class="pre">start</span></code> and <code class="docutils literal notranslate"><span class="pre">end</span></code> values. (default <code class="docutils literal notranslate"><span class="pre">None</span></code>)</p> <pre class="highlight-yaml notranslate" data-language="yaml">- forward: nat
- nat:
    address:
      start: 1.2.3.4
      end: 1.2.3.10
    port:
      start: 500
      end: 1000</pre> <div class="versionadded"> <p><span class="versionmodified added">New in version 3003.</span></p> </div> </li> <li>
<p><strong>interfaces</strong> -- </p>
<p>whitespace separated list of network interfaces devices that can be used for this network. (default <code class="docutils literal notranslate"><span class="pre">None</span></code>)</p> <pre class="highlight-yaml notranslate" data-language="yaml">- forward: passthrough
- interfaces: "eth10 eth11 eth12"</pre> <div class="versionadded"> <p><span class="versionmodified added">New in version 3003.</span></p> </div> </li> <li>
<p><strong>addresses</strong> -- </p>
<p>whitespace separated list of addreses of PCI devices that can be used for this network in <cite>hostdev</cite> forward mode. (default <code class="docutils literal notranslate"><span class="pre">None</span></code>)</p> <pre class="highlight-yaml notranslate" data-language="yaml">- forward: hostdev
- interfaces: "0000:04:00.1 0000:e3:01.2"</pre> <div class="versionadded"> <p><span class="versionmodified added">New in version 3003.</span></p> </div> </li> <li>
<p><strong>physical_function</strong> -- </p>
<p>device name of the physical interface to use in <code class="docutils literal notranslate"><span class="pre">hostdev</span></code> forward mode. (default <code class="docutils literal notranslate"><span class="pre">None</span></code>)</p> <pre class="highlight-yaml notranslate" data-language="yaml">- forward: hostdev
- physical_function: "eth0"</pre> <div class="versionadded"> <p><span class="versionmodified added">New in version 3003.</span></p> </div> </li> <li>
<p><strong>dns</strong> -- </p>
<p>virtual network DNS configuration The value is a dictionary described in <a class="reference internal" href="../../modules/all/salt.modules.virt.html#net-define-dns"><span class="std std-ref">DNS configuration definition</span></a>. (default <code class="docutils literal notranslate"><span class="pre">None</span></code>)</p> <pre class="highlight-yaml notranslate" data-language="yaml">- dns:
    forwarders:
      - domain: example.com
        addr: 192.168.1.1
      - addr: 8.8.8.8
      - domain: www.example.com
    txt:
      example.com: "v=spf1 a -all"
      _http.tcp.example.com: "name=value,paper=A4"
    hosts:
      192.168.1.2:
        - mirror.acme.lab
        - test.acme.lab
    srvs:
      - name: ldap
        protocol: tcp
        domain: ldapserver.example.com
        target: .
        port: 389
        priority: 1
        weight: 10</pre> <div class="versionadded"> <p><span class="versionmodified added">New in version 3003.</span></p> </div> </li> </ul> </dd> </dl> <div class="versionadded"> <p><span class="versionmodified added">New in version 3001.</span></p> </div> <pre class="highlight-yaml notranslate" data-language="yaml">network_name:
  virt.network_defined</pre> <pre class="highlight-yaml notranslate" data-language="yaml">network_name:
  virt.network_defined:
    - bridge: main
    - forward: bridge
    - vport: openvswitch
    - tag: 180
    - autostart: True</pre> <pre class="highlight-yaml notranslate" data-language="yaml">network_name:
  virt.network_defined:
    - bridge: natted
    - forward: nat
    - ipv4_config:
        cidr: 192.168.42.0/24
        dhcp_ranges:
          - start: 192.168.42.10
            end: 192.168.42.25
          - start: 192.168.42.100
            end: 192.168.42.150
    - autostart: True</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.virt.network_running"> salt.states.virt.network_running(name, bridge, forward, vport=None, tag=None, ipv4_config=None, ipv6_config=None, autostart=True, connection=None, username=None, password=None, mtu=None, domain=None, nat=None, interfaces=None, addresses=None, physical_function=None, dns=None)</h3> <dd>
<p>Defines and starts a new network with specified arguments.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li><p><strong>name</strong> -- Network name</p></li> <li><p><strong>bridge</strong> -- Bridge name</p></li> <li>
<p><strong>forward</strong> -- </p>
<p>Forward mode(bridge, router, nat)</p> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 3003: </span>a <code class="docutils literal notranslate"><span class="pre">None</span></code> value creates an isolated network with no forwarding at all</p> </div> </li> <li>
<p><strong>vport</strong> -- </p>
<p>Virtualport type (Default: <code class="docutils literal notranslate"><span class="pre">'None'</span></code>) The value can also be a dictionary with <code class="docutils literal notranslate"><span class="pre">type</span></code> and <code class="docutils literal notranslate"><span class="pre">parameters</span></code> keys. The <code class="docutils literal notranslate"><span class="pre">parameters</span></code> value is a dictionary of virtual port parameters.</p> <pre class="highlight-yaml notranslate" data-language="yaml">- vport:
    type: openvswitch
    parameters:
      interfaceid: 09b11c53-8b5c-4eeb-8f00-d84eaa0aaa4f</pre> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 3003: </span>possible dictionary value</p> </div> </li> <li>
<p><strong>tag</strong> -- </p>
<p>Vlan tag (Default: <code class="docutils literal notranslate"><span class="pre">'None'</span></code>) The value can also be a dictionary with the <code class="docutils literal notranslate"><span class="pre">tags</span></code> and optional <code class="docutils literal notranslate"><span class="pre">trunk</span></code> keys. <code class="docutils literal notranslate"><span class="pre">trunk</span></code> is a boolean value indicating whether to use VLAN trunking. <code class="docutils literal notranslate"><span class="pre">tags</span></code> is a list of dictionaries with keys <code class="docutils literal notranslate"><span class="pre">id</span></code> and <code class="docutils literal notranslate"><span class="pre">nativeMode</span></code>. The <code class="docutils literal notranslate"><span class="pre">nativeMode</span></code> value can be one of <code class="docutils literal notranslate"><span class="pre">tagged</span></code> or <code class="docutils literal notranslate"><span class="pre">untagged</span></code>.</p> <pre class="highlight-yaml notranslate" data-language="yaml">- tag:
    trunk: True
    tags:
      - id: 42
        nativeMode: untagged
      - id: 47</pre> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 3003: </span>possible dictionary value</p> </div> </li> <li>
<p><strong>ipv4_config</strong> -- </p>
<p>IPv4 network configuration. See the :py:func`virt.network_define &lt;salt.modules.virt.network_define&gt;` function corresponding parameter documentation for more details on this dictionary. (Default: None).</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 3000.</span></p> </div> </li> <li>
<p><strong>ipv6_config</strong> -- </p>
<p>IPv6 network configuration. See the :py:func`virt.network_define &lt;salt.modules.virt.network_define&gt;` function corresponding parameter documentation for more details on this dictionary. (Default: None).</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 3000.</span></p> </div> </li> <li><p><strong>autostart</strong> -- Network autostart (default <code class="docutils literal notranslate"><span class="pre">'True'</span></code>)</p></li> <li>
<p><strong>connection</strong> -- </p>
<p>libvirt connection URI, overriding defaults</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </li> <li>
<p><strong>username</strong> -- </p>
<p>username to connect with, overriding defaults</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </li> <li>
<p><strong>password</strong> -- </p>
<p>password to connect with, overriding defaults</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </li> <li>
<p><strong>mtu</strong> -- </p>
<p>size of the Maximum Transmission Unit (MTU) of the network. (default <code class="docutils literal notranslate"><span class="pre">None</span></code>)</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 3003.</span></p> </div> </li> <li>
<p><strong>domain</strong> -- </p>
<p>DNS domain name of the DHCP server. The value is a dictionary with a mandatory <code class="docutils literal notranslate"><span class="pre">name</span></code> property and an optional <code class="docutils literal notranslate"><span class="pre">localOnly</span></code> boolean one. (default <code class="docutils literal notranslate"><span class="pre">None</span></code>)</p> <pre class="highlight-yaml notranslate" data-language="yaml">- domain:
    name: lab.acme.org
    localOnly: True</pre> <div class="versionadded"> <p><span class="versionmodified added">New in version 3003.</span></p> </div> </li> <li>
<p><strong>nat</strong> -- </p>
<p>addresses and ports to route in NAT forward mode. The value is a dictionary with optional keys <code class="docutils literal notranslate"><span class="pre">address</span></code> and <code class="docutils literal notranslate"><span class="pre">port</span></code>. Both values are a dictionary with <code class="docutils literal notranslate"><span class="pre">start</span></code> and <code class="docutils literal notranslate"><span class="pre">end</span></code> values. (default <code class="docutils literal notranslate"><span class="pre">None</span></code>)</p> <pre class="highlight-yaml notranslate" data-language="yaml">- forward: nat
- nat:
    address:
      start: 1.2.3.4
      end: 1.2.3.10
    port:
      start: 500
      end: 1000</pre> <div class="versionadded"> <p><span class="versionmodified added">New in version 3003.</span></p> </div> </li> <li>
<p><strong>interfaces</strong> -- </p>
<p>whitespace separated list of network interfaces devices that can be used for this network. (default <code class="docutils literal notranslate"><span class="pre">None</span></code>)</p> <pre class="highlight-yaml notranslate" data-language="yaml">- forward: passthrough
- interfaces: "eth10 eth11 eth12"</pre> <div class="versionadded"> <p><span class="versionmodified added">New in version 3003.</span></p> </div> </li> <li>
<p><strong>addresses</strong> -- </p>
<p>whitespace separated list of addreses of PCI devices that can be used for this network in <cite>hostdev</cite> forward mode. (default <code class="docutils literal notranslate"><span class="pre">None</span></code>)</p> <pre class="highlight-yaml notranslate" data-language="yaml">- forward: hostdev
- interfaces: "0000:04:00.1 0000:e3:01.2"</pre> <div class="versionadded"> <p><span class="versionmodified added">New in version 3003.</span></p> </div> </li> <li>
<p><strong>physical_function</strong> -- </p>
<p>device name of the physical interface to use in <code class="docutils literal notranslate"><span class="pre">hostdev</span></code> forward mode. (default <code class="docutils literal notranslate"><span class="pre">None</span></code>)</p> <pre class="highlight-yaml notranslate" data-language="yaml">- forward: hostdev
- physical_function: "eth0"</pre> <div class="versionadded"> <p><span class="versionmodified added">New in version 3003.</span></p> </div> </li> <li>
<p><strong>dns</strong> -- </p>
<p>virtual network DNS configuration The value is a dictionary described in <a class="reference internal" href="../../modules/all/salt.modules.virt.html#net-define-dns"><span class="std std-ref">DNS configuration definition</span></a>. (default <code class="docutils literal notranslate"><span class="pre">None</span></code>)</p> <pre class="highlight-yaml notranslate" data-language="yaml">- dns:
    forwarders:
      - domain: example.com
        addr: 192.168.1.1
      - addr: 8.8.8.8
      - domain: www.example.com
    txt:
      host.widgets.com.: "printer=lpr5"
      example.com.: "This domain name is reserved for use in documentation"
    hosts:
      192.168.1.2:
        - mirror.acme.lab
        - test.acme.lab
    srvs:
      - name: ldap
        protocol: tcp
        domain: ldapserver.example.com
        target: .
        port: 389
        priority: 1
        weight: 10</pre> <div class="versionadded"> <p><span class="versionmodified added">New in version 3003.</span></p> </div> </li> </ul> </dd> </dl> <pre class="highlight-yaml notranslate" data-language="yaml">network_name:
  virt.network_running</pre> <pre class="highlight-yaml notranslate" data-language="yaml">network_name:
  virt.network_running:
    - bridge: main
    - forward: bridge
    - vport: openvswitch
    - tag: 180
    - autostart: True</pre> <pre class="highlight-yaml notranslate" data-language="yaml">network_name:
  virt.network_running:
    - bridge: natted
    - forward: nat
    - ipv4_config:
        cidr: 192.168.42.0/24
        dhcp_ranges:
          - start: 192.168.42.10
            end: 192.168.42.25
          - start: 192.168.42.100
            end: 192.168.42.150
    - autostart: True</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.virt.pool_defined"> salt.states.virt.pool_defined(name, ptype=None, target=None, permissions=None, source=None, transient=False, autostart=True, connection=None, username=None, password=None)</h3> <dd>
<p>Defines a new pool with specified arguments.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 3001.</span></p> </div> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li><p><strong>ptype</strong> -- libvirt pool type</p></li> <li><p><strong>target</strong> -- full path to the target device or folder. (Default: <code class="docutils literal notranslate"><span class="pre">None</span></code>)</p></li> <li><p><strong>permissions</strong> -- target permissions. See <a class="reference internal" href="../../modules/all/salt.modules.virt.html#pool-define-permissions"><span class="std std-ref">Permissions definition</span></a> for more details on this structure.</p></li> <li><p><strong>source</strong> -- dictionary containing keys matching the <code class="docutils literal notranslate"><span class="pre">source_*</span></code> parameters in function <a class="reference internal" href="../../modules/all/salt.modules.virt.html#salt.modules.virt.pool_define" title="salt.modules.virt.pool_define"><code class="xref py py-func docutils literal notranslate"><span class="pre">salt.modules.virt.pool_define()</span></code></a>.</p></li> <li><p><strong>transient</strong> -- when set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, the pool will be automatically undefined after being stopped. (Default: <code class="docutils literal notranslate"><span class="pre">False</span></code>)</p></li> <li><p><strong>autostart</strong> -- Whether to start the pool when booting the host. (Default: <code class="docutils literal notranslate"><span class="pre">True</span></code>)</p></li> <li><p><strong>start</strong> -- When <code class="docutils literal notranslate"><span class="pre">True</span></code>, define and start the pool, otherwise the pool will be left stopped.</p></li> <li><p><strong>connection</strong> -- libvirt connection URI, overriding defaults</p></li> <li><p><strong>username</strong> -- username to connect with, overriding defaults</p></li> <li><p><strong>password</strong> -- password to connect with, overriding defaults</p></li> </ul> </dd> </dl> <pre class="highlight-yaml notranslate" data-language="yaml">pool_name:
  virt.pool_defined:
    - ptype: netfs
    - target: /mnt/cifs
    - permissions:
        - mode: 0770
        - owner: 1000
        - group: 100
    - source:
        dir: samba_share
        hosts:
          - one.example.com
          - two.example.com
        format: cifs
    - autostart: True</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.virt.pool_deleted"> salt.states.virt.pool_deleted(name, purge=False, connection=None, username=None, password=None)</h3> <dd>
<p>Deletes a virtual storage pool.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li><p><strong>name</strong> -- the name of the pool to delete.</p></li> <li><p><strong>purge</strong> -- if <code class="docutils literal notranslate"><span class="pre">True</span></code>, the volumes contained in the pool will be deleted as well as the pool itself. Note that these will be lost for ever. If <code class="docutils literal notranslate"><span class="pre">False</span></code> the pool will simply be undefined. (Default: <code class="docutils literal notranslate"><span class="pre">False</span></code>)</p></li> <li><p><strong>connection</strong> -- libvirt connection URI, overriding defaults</p></li> <li><p><strong>username</strong> -- username to connect with, overriding defaults</p></li> <li><p><strong>password</strong> -- password to connect with, overriding defaults</p></li> </ul> </dd> </dl> <p>In order to be purged a storage pool needs to be running to get the list of volumes to delete.</p> <p>Some libvirt storage drivers may not implement deleting, those actions are implemented on a best effort idea. In any case check the result's comment property to see if any of the action was unsupported.</p> <pre class="highlight-yaml notranslate" data-language="yaml">pool_name:
  uyuni_virt.pool_deleted:
    - purge: True</pre> <div class="versionadded"> <p><span class="versionmodified added">New in version 3000.</span></p> </div> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.virt.pool_running"> salt.states.virt.pool_running(name, ptype=None, target=None, permissions=None, source=None, transient=False, autostart=True, connection=None, username=None, password=None)</h3> <dd>
<p>Defines and starts a new pool with specified arguments.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li><p><strong>ptype</strong> -- libvirt pool type</p></li> <li><p><strong>target</strong> -- full path to the target device or folder. (Default: <code class="docutils literal notranslate"><span class="pre">None</span></code>)</p></li> <li><p><strong>permissions</strong> -- target permissions. See <a class="reference internal" href="../../modules/all/salt.modules.virt.html#pool-define-permissions"><span class="std std-ref">Permissions definition</span></a> for more details on this structure.</p></li> <li><p><strong>source</strong> -- dictionary containing keys matching the <code class="docutils literal notranslate"><span class="pre">source_*</span></code> parameters in function <a class="reference internal" href="../../modules/all/salt.modules.virt.html#salt.modules.virt.pool_define" title="salt.modules.virt.pool_define"><code class="xref py py-func docutils literal notranslate"><span class="pre">salt.modules.virt.pool_define()</span></code></a>.</p></li> <li><p><strong>transient</strong> -- when set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, the pool will be automatically undefined after being stopped. (Default: <code class="docutils literal notranslate"><span class="pre">False</span></code>)</p></li> <li><p><strong>autostart</strong> -- Whether to start the pool when booting the host. (Default: <code class="docutils literal notranslate"><span class="pre">True</span></code>)</p></li> <li><p><strong>connection</strong> -- libvirt connection URI, overriding defaults</p></li> <li><p><strong>username</strong> -- username to connect with, overriding defaults</p></li> <li><p><strong>password</strong> -- password to connect with, overriding defaults</p></li> </ul> </dd> </dl> <pre class="highlight-yaml notranslate" data-language="yaml">pool_name:
  virt.pool_running</pre> <pre class="highlight-yaml notranslate" data-language="yaml">pool_name:
  virt.pool_running:
    - ptype: netfs
    - target: /mnt/cifs
    - permissions:
        - mode: 0770
        - owner: 1000
        - group: 100
    - source:
        dir: samba_share
        hosts:
          - one.example.com
          - two.example.com
        format: cifs
    - autostart: True</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.virt.powered_off"> salt.states.virt.powered_off(name, connection=None, username=None, password=None)</h3> <dd>
<p>Stops a VM by power off.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2016.3.0.</span></p> </div> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li>
<p><strong>connection</strong> -- </p>
<p>libvirt connection URI, overriding defaults</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </li> <li>
<p><strong>username</strong> -- </p>
<p>username to connect with, overriding defaults</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </li> <li>
<p><strong>password</strong> -- </p>
<p>password to connect with, overriding defaults</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </li> </ul> </dd> </dl> <pre class="highlight-yaml notranslate" data-language="yaml">domain_name:
  virt.stopped</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.virt.rebooted"> salt.states.virt.rebooted(name, connection=None, username=None, password=None)</h3> <dd>
<p>Reboots VMs</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2016.3.0.</span></p> </div> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li><p><strong>name</strong> -- </p></li> <li>
<p><strong>connection</strong> -- </p>
<p>libvirt connection URI, overriding defaults</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </li> <li>
<p><strong>username</strong> -- </p>
<p>username to connect with, overriding defaults</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </li> <li>
<p><strong>password</strong> -- </p>
<p>password to connect with, overriding defaults</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </li> </ul> </dd> </dl> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.virt.reverted"> salt.states.virt.reverted(name, snapshot=None, cleanup=False)</h3> <dd>
<div class="deprecated"> <p><span class="versionmodified deprecated">Deprecated since version 2016.3.0.</span></p> </div> <p>Reverts to the particular snapshot.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2016.3.0.</span></p> </div> <pre class="highlight-yaml notranslate" data-language="yaml">domain_name:
  virt.reverted:
    - cleanup: True

domain_name_1:
  virt.reverted:
    - snapshot: snapshot_name
    - cleanup: False</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.virt.running"> salt.states.virt.running(name, cpu=None, mem=None, vm_type=None, disk_profile=None, disks=None, nic_profile=None, interfaces=None, graphics=None, seed=True, install=True, pub_key=None, priv_key=None, connection=None, username=None, password=None, os_type=None, arch=None, boot=None, boot_dev=None, numatune=None, hypervisor_features=None, clock=None, serials=None, consoles=None, stop_on_reboot=False, host_devices=None)</h3> <dd>
<p>Starts an existing guest, or defines and starts a new VM with specified arguments.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2016.3.0.</span></p> </div> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li><p><strong>name</strong> -- name of the virtual machine to run</p></li> <li>
<p><strong>cpu</strong> -- </p>
<p>Number of virtual CPUs to assign to the virtual machine or a dictionary with detailed information to configure cpu model and topology, numa node tuning, cpu tuning and iothreads allocation. The structure of the dictionary is documented in <a class="reference internal" href="../../modules/all/salt.modules.virt.html#init-cpu-def"><span class="std std-ref">cpu parameters definition</span></a>.</p> <p>To update any cpu parameters specify the new values to the corresponding tag. To remove any element or attribute, specify <code class="docutils literal notranslate"><span class="pre">None</span></code> object. Please note that <code class="docutils literal notranslate"><span class="pre">None</span></code> object is mapped to <code class="docutils literal notranslate"><span class="pre">null</span></code> in yaml, use <code class="docutils literal notranslate"><span class="pre">null</span></code> in sls file instead.</p> </li> <li>
<p><strong>mem</strong> -- </p>
<p>Amount of memory to allocate to the virtual machine in MiB. Since 3002, a dictionary can be used to contain detailed configuration which support memory allocation or tuning. Supported parameters are <code class="docutils literal notranslate"><span class="pre">boot</span></code>, <code class="docutils literal notranslate"><span class="pre">current</span></code>, <code class="docutils literal notranslate"><span class="pre">max</span></code>, <code class="docutils literal notranslate"><span class="pre">slots</span></code>, <code class="docutils literal notranslate"><span class="pre">hard_limit</span></code>, <code class="docutils literal notranslate"><span class="pre">soft_limit</span></code>, <code class="docutils literal notranslate"><span class="pre">swap_hard_limit</span></code>, <code class="docutils literal notranslate"><span class="pre">min_guarantee</span></code>, <code class="docutils literal notranslate"><span class="pre">hugepages</span></code> , <code class="docutils literal notranslate"><span class="pre">nosharepages</span></code>, <code class="docutils literal notranslate"><span class="pre">locked</span></code>, <code class="docutils literal notranslate"><span class="pre">source</span></code>, <code class="docutils literal notranslate"><span class="pre">access</span></code>, <code class="docutils literal notranslate"><span class="pre">allocation</span></code> and <code class="docutils literal notranslate"><span class="pre">discard</span></code>. The structure of the dictionary is documented in <a class="reference internal" href="../../modules/all/salt.modules.virt.html#init-mem-def"><span class="std std-ref">Memory parameter definition</span></a>. Both decimal and binary base are supported. Detail unit specification is documented in <a class="reference internal" href="../../modules/all/salt.modules.virt.html#virt-units"><span class="std std-ref">Units specification</span></a>. Please note that the value for <code class="docutils literal notranslate"><span class="pre">slots</span></code> must be an integer.</p> <p>To remove any parameters, pass a None object, for instance: 'soft_limit': <code class="docutils literal notranslate"><span class="pre">None</span></code>. Please note that <code class="docutils literal notranslate"><span class="pre">None</span></code> is mapped to <code class="docutils literal notranslate"><span class="pre">null</span></code> in sls file, pass <code class="docutils literal notranslate"><span class="pre">null</span></code> in sls file instead.</p> <pre class="highlight-yaml notranslate" data-language="yaml">- mem:
    hard_limit: null
    soft_limit: null</pre> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 3002.</span></p> </div> </li> <li>
<p><strong>vm_type</strong> -- </p>
<p>force virtual machine type for the new VM. The default value is taken from the host capabilities. This could be useful for example to use <code class="docutils literal notranslate"><span class="pre">'qemu'</span></code> type instead of the <code class="docutils literal notranslate"><span class="pre">'kvm'</span></code> one.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </li> <li>
<p><strong>disk_profile</strong> -- </p>
<p>Name of the disk profile to use for the new virtual machine</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </li> <li>
<p><strong>disks</strong> -- </p>
<p>List of disk to create for the new virtual machine. See <a class="reference internal" href="../../modules/all/salt.modules.virt.html#init-disk-def"><span class="std std-ref">Disks Definitions</span></a> for more details on the items on this list.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </li> <li>
<p><strong>nic_profile</strong> -- </p>
<p>Name of the network interfaces profile to use for the new virtual machine</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </li> <li>
<p><strong>interfaces</strong> -- </p>
<p>List of network interfaces to create for the new virtual machine. See <a class="reference internal" href="../../modules/all/salt.modules.virt.html#init-nic-def"><span class="std std-ref">Network Interfaces Definitions</span></a> for more details on the items on this list.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </li> <li>
<p><strong>graphics</strong> -- </p>
<p>Graphics device to create for the new virtual machine. See <a class="reference internal" href="../../modules/all/salt.modules.virt.html#init-graphics-def"><span class="std std-ref">Graphics Definition</span></a> for more details on this dictionary</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </li> <li>
<p><strong>saltenv</strong> -- </p>
<p>Fileserver environment (Default: <code class="docutils literal notranslate"><span class="pre">'base'</span></code>). See <a class="reference internal" href="../../modules/all/salt.modules.cp.html#module-salt.modules.cp" title="salt.modules.cp"><code class="xref py py-mod docutils literal notranslate"><span class="pre">cp</span> <span class="pre">module</span> <span class="pre">for</span> <span class="pre">more</span> <span class="pre">details</span></code></a></p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </li> <li>
<p><strong>seed</strong> -- </p>
<dl class="simple"> <dt>
<code class="docutils literal notranslate"><span class="pre">True</span></code> to seed the disk image. Only used when the <code class="docutils literal notranslate"><span class="pre">image</span></code> parameter is provided.</dt>
<dd>
<p>(Default: <code class="docutils literal notranslate"><span class="pre">True</span></code>)</p> </dd> </dl> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </li> <li>
<p><strong>install</strong> -- </p>
<p>install salt minion if absent (Default: <code class="docutils literal notranslate"><span class="pre">True</span></code>)</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </li> <li>
<p><strong>pub_key</strong> -- </p>
<p>public key to seed with (Default: <code class="docutils literal notranslate"><span class="pre">None</span></code>)</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </li> <li>
<p><strong>priv_key</strong> -- </p>
<p>public key to seed with (Default: <code class="docutils literal notranslate"><span class="pre">None</span></code>)</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </li> <li>
<p><strong>seed_cmd</strong> -- </p>
<p>Salt command to execute to seed the image. (Default: <code class="docutils literal notranslate"><span class="pre">'seed.apply'</span></code>)</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </li> <li>
<p><strong>connection</strong> -- </p>
<p>libvirt connection URI, overriding defaults</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </li> <li>
<p><strong>username</strong> -- </p>
<p>username to connect with, overriding defaults</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </li> <li>
<p><strong>password</strong> -- </p>
<p>password to connect with, overriding defaults</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </li> <li>
<p><strong>os_type</strong> -- </p>
<p>type of virtualization as found in the <code class="docutils literal notranslate"><span class="pre">//os/type</span></code> element of the libvirt definition. The default value is taken from the host capabilities, with a preference for <code class="docutils literal notranslate"><span class="pre">hvm</span></code>. Only used when creating a new virtual machine.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 3000.</span></p> </div> </li> <li>
<p><strong>arch</strong> -- </p>
<p>architecture of the virtual machine. The default value is taken from the host capabilities, but <code class="docutils literal notranslate"><span class="pre">x86_64</span></code> is prefed over <code class="docutils literal notranslate"><span class="pre">i686</span></code>. Only used when creating a new virtual machine.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 3000.</span></p> </div> </li> <li>
<p><strong>boot</strong> -- </p>
<p>Specifies kernel, initial ramdisk and kernel command line parameters for the virtual machine. This is an optional parameter, all of the keys are optional within the dictionary.</p> <p>Refer to <a class="reference internal" href="../../modules/all/salt.modules.virt.html#init-boot-def"><span class="std std-ref">Boot parameters definition</span></a> for the complete boot parameters description.</p> <p>To update any boot parameters, specify the new path for each. To remove any boot parameters, pass a None object, for instance: 'kernel': <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 3000.</span></p> </div> </li> <li>
<p><strong>serials</strong> -- </p>
<p>Dictionary providing details on the serials connection to create. (Default: <code class="docutils literal notranslate"><span class="pre">None</span></code>) See <a class="reference internal" href="../../modules/all/salt.modules.virt.html#init-chardevs-def"><span class="std std-ref">Serials and Consoles Definitions</span></a> for more details on the possible values.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 3003.</span></p> </div> </li> <li>
<p><strong>consoles</strong> -- </p>
<p>Dictionary providing details on the consoles device to create. (Default: <code class="docutils literal notranslate"><span class="pre">None</span></code>) See <a class="reference internal" href="../../modules/all/salt.modules.virt.html#init-chardevs-def"><span class="std std-ref">Serials and Consoles Definitions</span></a> for more details on the possible values.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 3003.</span></p> </div> </li> <li>
<p><strong>boot_dev</strong> -- </p>
<p>Space separated list of devices to boot from sorted by decreasing priority. Values can be <code class="docutils literal notranslate"><span class="pre">hd</span></code>, <code class="docutils literal notranslate"><span class="pre">fd</span></code>, <code class="docutils literal notranslate"><span class="pre">cdrom</span></code> or <code class="docutils literal notranslate"><span class="pre">network</span></code>.</p> <p>By default, the value will <code class="docutils literal notranslate"><span class="pre">"hd"</span></code>.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 3002.</span></p> </div> </li> <li>
<p><strong>numatune</strong> -- </p>
<p>The optional numatune element provides details of how to tune the performance of a NUMA host via controlling NUMA policy for domain process. The optional <code class="docutils literal notranslate"><span class="pre">memory</span></code> element specifies how to allocate memory for the domain process on a NUMA host. <code class="docutils literal notranslate"><span class="pre">memnode</span></code> elements can specify memory allocation policies per each guest NUMA node. The definition used in the dictionary can be found at <a class="reference internal" href="../../modules/all/salt.modules.virt.html#init-cpu-def"><span class="std std-ref">cpu parameters definition</span></a>.</p> <p>To update any numatune parameters, specify the new value. To remove any <code class="docutils literal notranslate"><span class="pre">numatune</span></code> parameters, pass a None object, for instance: 'numatune': <code class="docutils literal notranslate"><span class="pre">None</span></code>. Please note that <code class="docutils literal notranslate"><span class="pre">None</span></code> is mapped to <code class="docutils literal notranslate"><span class="pre">null</span></code> in sls file, pass <code class="docutils literal notranslate"><span class="pre">null</span></code> in sls file instead.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 3003.</span></p> </div> </li> <li>
<p><strong>stop_on_reboot</strong> -- </p>
<p>If set to <code class="docutils literal notranslate"><span class="pre">True</span></code> the guest will stop instead of rebooting. This is specially useful when creating a virtual machine with an installation cdrom or an autoinstallation needing a special first boot configuration. Defaults to <code class="docutils literal notranslate"><span class="pre">False</span></code></p> <div class="versionadded"> <p><span class="versionmodified added">New in version 3003.</span></p> </div> </li> <li>
<p><strong>hypervisor_features</strong> -- </p>
<p>Enable or disable hypervisor-specific features on the virtual machine.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 3003.</span></p> </div> <pre class="highlight-yaml notranslate" data-language="yaml">hypervisor_features:
  kvm-hint-dedicated: True</pre> </li> <li>
<p><strong>clock</strong> -- </p>
<p>Configure the guest clock. The value is a dictionary with the following keys:</p> <dl class="simple"> <dt>adjustment</dt>
<dd>
<p>time adjustment in seconds or <code class="docutils literal notranslate"><span class="pre">reset</span></code></p> </dd> <dt>utc</dt>
<dd>
<p>set to <code class="docutils literal notranslate"><span class="pre">False</span></code> to use the host local time as the guest clock. Defaults to <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p> </dd> <dt>timezone</dt>
<dd>
<p>synchronize the guest to the correspding timezone</p> </dd> <dt>timers</dt>
<dd>
<p>a dictionary associating the timer name with its configuration. This configuration is a dictionary with the properties <code class="docutils literal notranslate"><span class="pre">track</span></code>, <code class="docutils literal notranslate"><span class="pre">tickpolicy</span></code>, <code class="docutils literal notranslate"><span class="pre">catchup</span></code>, <code class="docutils literal notranslate"><span class="pre">frequency</span></code>, <code class="docutils literal notranslate"><span class="pre">mode</span></code>, <code class="docutils literal notranslate"><span class="pre">present</span></code>, <code class="docutils literal notranslate"><span class="pre">slew</span></code>, <code class="docutils literal notranslate"><span class="pre">threshold</span></code> and <code class="docutils literal notranslate"><span class="pre">limit</span></code>. See <a class="reference external" href="https://libvirt.org/formatdomain.html#time-keeping">libvirt time keeping documentation</a> for the possible values.</p> </dd> </dl> <div class="versionadded"> <p><span class="versionmodified added">New in version 3003.</span></p> </div> <p>Set the clock to local time using an offset in seconds .. code-block:: yaml</p> <blockquote> <div>
<dl class="simple"> <dt>clock:</dt>
<dd>
<p>adjustment: 3600 utc: False</p> </dd> </dl> </div>
</blockquote> <p>Set the clock to a specific time zone:</p> <pre class="highlight-yaml notranslate" data-language="yaml">clock:
  timezone: CEST</pre> </li> <li>
<p><strong>host_devices</strong> -- </p>
<p>List of host devices to passthrough to the guest. The value is a list of device names as provided by the <a class="reference internal" href="../../modules/all/salt.modules.virt.html#salt.modules.virt.node_devices" title="salt.modules.virt.node_devices"><code class="xref py py-func docutils literal notranslate"><span class="pre">node_devices()</span></code></a> function. (Default: <code class="docutils literal notranslate"><span class="pre">None</span></code>)</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 3003.</span></p> </div> </li> </ul> </dd> </dl> <p class="rubric">Example States</p> <p>Make sure an already-defined virtual machine called <code class="docutils literal notranslate"><span class="pre">domain_name</span></code> is running:</p> <pre class="highlight-yaml notranslate" data-language="yaml">domain_name:
  virt.running</pre> <p>Do the same, but define the virtual machine if needed:</p> <pre class="highlight-yaml notranslate" data-language="yaml">domain_name:
  virt.running:
    - cpu: 2
    - mem: 2048
    - disk_profile: prod
    - boot_dev: network hd
    - disks:
      - name: system
        size: 8192
        overlay_image: True
        pool: default
        image: /path/to/image.qcow2
      - name: data
        size: 16834
    - nic_profile: prod
    - interfaces:
      - name: eth0
        mac: 01:23:45:67:89:AB
      - name: eth1
        type: network
        source: admin
    - graphics:
        type: spice
        listen:
            type: address
            address: 192.168.0.125</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.virt.saved"> salt.states.virt.saved(name, suffix=None)</h3> <dd>
<div class="deprecated"> <p><span class="versionmodified deprecated">Deprecated since version 2016.3.0: </span>Use <a class="reference internal" href="../../modules/all/salt.modules.virt.html#salt.modules.virt.snapshot" title="salt.modules.virt.snapshot"><code class="xref py py-func docutils literal notranslate"><span class="pre">snapshot()</span></code></a> instead.</p> </div> <p>Takes a snapshot of a particular VM or by a UNIX-style wildcard.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2016.3.0.</span></p> </div> <pre class="highlight-yaml notranslate" data-language="yaml">domain_name:
  virt.saved:
    - suffix: periodic

domain*:
  virt.saved:
    - suffix: periodic</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.virt.snapshot"> salt.states.virt.snapshot(name, suffix=None, connection=None, username=None, password=None)</h3> <dd>
<p>Takes a snapshot of a particular VM or by a UNIX-style wildcard.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2016.3.0.</span></p> </div> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li>
<p><strong>connection</strong> -- </p>
<p>libvirt connection URI, overriding defaults</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </li> <li>
<p><strong>username</strong> -- </p>
<p>username to connect with, overriding defaults</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </li> <li>
<p><strong>password</strong> -- </p>
<p>password to connect with, overriding defaults</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </li> </ul> </dd> </dl> <pre class="highlight-yaml notranslate" data-language="yaml">domain_name:
  virt.snapshot:
    - suffix: periodic

domain*:
  virt.snapshot:
    - suffix: periodic</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.virt.stopped"> salt.states.virt.stopped(name, connection=None, username=None, password=None)</h3> <dd>
<p>Stops a VM by shutting it down nicely.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2016.3.0.</span></p> </div> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li>
<p><strong>connection</strong> -- </p>
<p>libvirt connection URI, overriding defaults</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </li> <li>
<p><strong>username</strong> -- </p>
<p>username to connect with, overriding defaults</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </li> <li>
<p><strong>password</strong> -- </p>
<p>password to connect with, overriding defaults</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </li> </ul> </dd> </dl> <pre class="highlight-yaml notranslate" data-language="yaml">domain_name:
  virt.stopped</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.virt.unpowered"> salt.states.virt.unpowered(name)</h3> <dd>
<div class="deprecated"> <p><span class="versionmodified deprecated">Deprecated since version 2016.3.0: </span>Use <code class="xref py py-func docutils literal notranslate"><span class="pre">powered_off()</span></code> instead.</p> </div> <p>Stops a VM by power off.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2016.3.0.</span></p> </div> <pre class="highlight-yaml notranslate" data-language="yaml">domain_name:
  virt.stopped</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.virt.volume_defined"> salt.states.virt.volume_defined(pool, name, size, allocation=0, format=None, type=None, permissions=None, backing_store=None, nocow=False, connection=None, username=None, password=None)</h3> <dd>
<p>Ensure a disk volume is existing.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li><p><strong>pool</strong> -- name of the pool containing the volume</p></li> <li><p><strong>name</strong> -- name of the volume</p></li> <li><p><strong>size</strong> -- capacity of the volume to define in MiB</p></li> <li><p><strong>allocation</strong> -- allocated size of the volume in MiB. Defaults to 0.</p></li> <li><p><strong>format</strong> -- volume format. The allowed values are depending on the pool type. Check the virt.pool_capabilities output for the possible values and the default.</p></li> <li><p><strong>type</strong> -- type of the volume. One of file, block, dir, network, netdiri, ploop or None. By default, the type is guessed by libvirt from the pool type.</p></li> <li><p><strong>permissions</strong> -- Permissions to set on the target folder. This is mostly used for filesystem-based pool types. See <a class="reference internal" href="../../modules/all/salt.modules.virt.html#pool-define-permissions"><span class="std std-ref">Permissions definition</span></a> for more details on this structure.</p></li> <li>
<p><strong>backing_store</strong> -- </p>
<p>dictionary describing a backing file for the volume. It must contain a <code class="docutils literal notranslate"><span class="pre">path</span></code> property pointing to the base volume and a <code class="docutils literal notranslate"><span class="pre">format</span></code> property defining the format of the base volume.</p> <p>The base volume format will not be guessed for security reasons and is thus mandatory.</p> </li> <li><p><strong>nocow</strong> -- disable COW for the volume.</p></li> <li><p><strong>connection</strong> -- libvirt connection URI, overriding defaults</p></li> <li><p><strong>username</strong> -- username to connect with, overriding defaults</p></li> <li><p><strong>password</strong> -- password to connect with, overriding defaults</p></li> </ul> </dd> </dl> <p class="rubric">CLI Example:</p> <p>Volume on ESX:</p> <pre class="highlight-yaml notranslate" data-language="yaml">esx_volume:
  virt.volume_defined:
    - pool: "[local-storage]"
    - name: myvm/myvm.vmdk
    - size: 8192</pre> <p>QCow2 volume with backing file:</p> <pre class="highlight-bash notranslate" data-language="bash">myvolume:
  virt.volume_defined:
    - pool: default
    - name: myvm.qcow2
    - format: qcow2
    - size: 8192
    - permissions:
        mode: '0775'
        owner: '123'
        group: '345'
    - backing_store:
        path: /path/to/base.img
        format: raw
    - nocow: True</pre> <div class="versionadded"> <p><span class="versionmodified added">New in version 3001.</span></p> </div> </dd>
</dl> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2021 SaltStack.<br>Licensed under the Apache License, Version 2.0.<br>
    <a href="https://docs.saltproject.io/en/latest/ref/states/all/salt.states.virt.html" class="_attribution-link">https://docs.saltproject.io/en/latest/ref/states/all/salt.states.virt.html</a>
  </p>
</div>
