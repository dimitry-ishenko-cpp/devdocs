<h1>salt.states.file</h1> <div class="section" id="operations-on-regular-files-special-files-directories-and-symlinks"> <h2>Operations on regular files, special files, directories, and symlinks</h2> <p>Salt States can aggressively manipulate files on a system. There are a number of ways in which files can be managed.</p> <p>Regular files can be enforced with the <a class="reference internal" href="#salt.states.file.managed" title="salt.states.file.managed"><code class="xref py py-mod docutils literal notranslate"><span class="pre">file.managed</span></code></a> state. This state downloads files from the salt master and places them on the target system. Managed files can be rendered as a jinja, mako, or wempy template, adding a dynamic component to file management. An example of <a class="reference internal" href="#salt.states.file.managed" title="salt.states.file.managed"><code class="xref py py-mod docutils literal notranslate"><span class="pre">file.managed</span></code></a> which makes use of the jinja templating system would look like this:</p> <pre class="highlight-jinja notranslate" data-language="jinja">/etc/http/conf/http.conf:
  file.managed:
    - source: salt://apache/http.conf
    - user: root
    - group: root
    - mode: 644
    - attrs: ai
    - template: jinja
    - defaults:
        custom_var: "default value"
        other_var: 123
{% if grains['os'] == 'Ubuntu' %}
    - context:
        custom_var: "override"
{% endif %}</pre> <p>It is also possible to use the <a class="reference internal" href="../../renderers/all/salt.renderers.py.html#module-salt.renderers.py" title="salt.renderers.py"><code class="xref py py-mod docutils literal notranslate"><span class="pre">py</span> <span class="pre">renderer</span></code></a> as a templating option. The template would be a Python script which would need to contain a function called <code class="docutils literal notranslate"><span class="pre">run()</span></code>, which returns a string. All arguments to the state will be made available to the Python script as globals. The returned string will be the contents of the managed file. For example:</p> <pre class="highlight-python notranslate" data-language="python">def run():
    lines = ['foo', 'bar', 'baz']
    lines.extend([source, name, user, context])  # Arguments as globals
    return '\n\n'.join(lines)</pre> <div class="admonition note"> <p class="admonition-title">Note</p> <p>The <code class="docutils literal notranslate"><span class="pre">defaults</span></code> and <code class="docutils literal notranslate"><span class="pre">context</span></code> arguments require extra indentation (four spaces instead of the normal two) in order to create a nested dictionary. <a class="reference internal" href="https://docs.saltproject.io/en/latest/topics/troubleshooting/yaml_idiosyncrasies.html#nested-dict-indentation"><span class="std std-ref">More information</span></a>.</p> </div> <p>If using a template, any user-defined template variables in the file defined in <code class="docutils literal notranslate"><span class="pre">source</span></code> must be passed in using the <code class="docutils literal notranslate"><span class="pre">defaults</span></code> and/or <code class="docutils literal notranslate"><span class="pre">context</span></code> arguments. The general best practice is to place default values in <code class="docutils literal notranslate"><span class="pre">defaults</span></code>, with conditional overrides going into <code class="docutils literal notranslate"><span class="pre">context</span></code>, as seen above.</p> <p>The template will receive a variable <code class="docutils literal notranslate"><span class="pre">custom_var</span></code>, which would be accessed in the template using <code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">custom_var</span> <span class="pre">}}</span></code>. If the operating system is Ubuntu, the value of the variable <code class="docutils literal notranslate"><span class="pre">custom_var</span></code> would be <em>override</em>, otherwise it is the default <em>default value</em></p> <p>The <code class="docutils literal notranslate"><span class="pre">source</span></code> parameter can be specified as a list. If this is done, then the first file to be matched will be the one that is used. This allows you to have a default file on which to fall back if the desired file does not exist on the salt fileserver. Here's an example:</p> <pre class="highlight-jinja notranslate" data-language="jinja">/etc/foo.conf:
  file.managed:
    - source:
      - salt://foo.conf.{{ grains['fqdn'] }}
      - salt://foo.conf.fallback
    - user: foo
    - group: users
    - mode: 644
    - attrs: i
    - backup: minion</pre> <div class="admonition note"> <p class="admonition-title">Note</p> <p>Salt supports backing up managed files via the backup option. For more details on this functionality please review the <a class="reference internal" href="https://docs.saltproject.io/en/latest/ref/states/backup_mode.html#file-state-backups"><span class="std std-ref">backup_mode documentation</span></a>.</p> </div> <p>The <code class="docutils literal notranslate"><span class="pre">source</span></code> parameter can also specify a file in another Salt environment. In this example <code class="docutils literal notranslate"><span class="pre">foo.conf</span></code> in the <code class="docutils literal notranslate"><span class="pre">dev</span></code> environment will be used instead.</p> <pre class="highlight-yaml notranslate" data-language="yaml">/etc/foo.conf:
  file.managed:
    - source:
      - 'salt://foo.conf?saltenv=dev'
    - user: foo
    - group: users
    - mode: '0644'
    - attrs: i</pre> <div class="admonition warning"> <p class="admonition-title">Warning</p> <p>When using a mode that includes a leading zero you must wrap the value in single quotes. If the value is not wrapped in quotes it will be read by YAML as an integer and evaluated as an octal.</p> </div> <p>The <code class="docutils literal notranslate"><span class="pre">names</span></code> parameter, which is part of the state compiler, can be used to expand the contents of a single state declaration into multiple, single state declarations. Each item in the <code class="docutils literal notranslate"><span class="pre">names</span></code> list receives its own individual state <code class="docutils literal notranslate"><span class="pre">name</span></code> and is converted into its own low-data structure. This is a convenient way to manage several files with similar attributes.</p> <pre class="highlight-yaml notranslate" data-language="yaml">salt_master_conf:
  file.managed:
    - user: root
    - group: root
    - mode: '0644'
    - names:
      - /etc/salt/master.d/master.conf:
        - source: salt://saltmaster/master.conf
      - /etc/salt/minion.d/minion-99.conf:
        - source: salt://saltmaster/minion.conf</pre> <div class="admonition note"> <p class="admonition-title">Note</p> <p>There is more documentation about this feature in the <a class="reference internal" href="https://docs.saltproject.io/en/latest/ref/states/highstate.html#names-declaration"><span class="std std-ref">Names declaration</span></a> section of the <a class="reference internal" href="https://docs.saltproject.io/en/latest/ref/states/highstate.html#states-highstate"><span class="std std-ref">Highstate docs</span></a>.</p> </div> <p>Special files can be managed via the <code class="docutils literal notranslate"><span class="pre">mknod</span></code> function. This function will create and enforce the permissions on a special file. The function supports the creation of character devices, block devices, and FIFO pipes. The function will create the directory structure up to the special file if it is needed on the minion. The function will not overwrite or operate on (change major/minor numbers) existing special files with the exception of user, group, and permissions. In most cases the creation of some special files require root permissions on the minion. This would require that the minion to be run as the root user. Here is an example of a character device:</p> <pre class="highlight-yaml notranslate" data-language="yaml">/var/named/chroot/dev/random:
  file.mknod:
    - ntype: c
    - major: 1
    - minor: 8
    - user: named
    - group: named
    - mode: 660</pre> <p>Here is an example of a block device:</p> <pre class="highlight-yaml notranslate" data-language="yaml">/var/named/chroot/dev/loop0:
  file.mknod:
    - ntype: b
    - major: 7
    - minor: 0
    - user: named
    - group: named
    - mode: 660</pre> <p>Here is an example of a fifo pipe:</p> <pre class="highlight-yaml notranslate" data-language="yaml">/var/named/chroot/var/log/logfifo:
  file.mknod:
    - ntype: p
    - user: named
    - group: named
    - mode: 660</pre> <p>Directories can be managed via the <code class="docutils literal notranslate"><span class="pre">directory</span></code> function. This function can create and enforce the permissions on a directory. A directory statement will look like this:</p> <pre class="highlight-yaml notranslate" data-language="yaml">/srv/stuff/substuf:
  file.directory:
    - user: fred
    - group: users
    - mode: 755
    - makedirs: True</pre> <p>If you need to enforce user and/or group ownership or permissions recursively on the directory's contents, you can do so by adding a <code class="docutils literal notranslate"><span class="pre">recurse</span></code> directive:</p> <pre class="highlight-yaml notranslate" data-language="yaml">/srv/stuff/substuf:
  file.directory:
    - user: fred
    - group: users
    - mode: 755
    - makedirs: True
    - recurse:
      - user
      - group
      - mode</pre> <p>As a default, <code class="docutils literal notranslate"><span class="pre">mode</span></code> will resolve to <code class="docutils literal notranslate"><span class="pre">dir_mode</span></code> and <code class="docutils literal notranslate"><span class="pre">file_mode</span></code>, to specify both directory and file permissions, use this form:</p> <pre class="highlight-yaml notranslate" data-language="yaml">/srv/stuff/substuf:
  file.directory:
    - user: fred
    - group: users
    - file_mode: 744
    - dir_mode: 755
    - makedirs: True
    - recurse:
      - user
      - group
      - mode</pre> <p>Symlinks can be easily created; the symlink function is very simple and only takes a few arguments:</p> <pre class="highlight-yaml notranslate" data-language="yaml">/etc/grub.conf:
  file.symlink:
    - target: /boot/grub/grub.conf</pre> <p>Recursive directory management can also be set via the <code class="docutils literal notranslate"><span class="pre">recurse</span></code> function. Recursive directory management allows for a directory on the salt master to be recursively copied down to the minion. This is a great tool for deploying large code and configuration systems. A state using <code class="docutils literal notranslate"><span class="pre">recurse</span></code> would look something like this:</p> <pre class="highlight-yaml notranslate" data-language="yaml">/opt/code/flask:
  file.recurse:
    - source: salt://code/flask
    - include_empty: True</pre> <p>A more complex <code class="docutils literal notranslate"><span class="pre">recurse</span></code> example:</p> <pre class="highlight-jinja notranslate" data-language="jinja">{% set site_user = 'testuser' %}
{% set site_name = 'test_site' %}
{% set project_name = 'test_proj' %}
{% set sites_dir = 'test_dir' %}

django-project:
  file.recurse:
    - name: {{ sites_dir }}/{{ site_name }}/{{ project_name }}
    - user: {{ site_user }}
    - dir_mode: 2775
    - file_mode: '0644'
    - template: jinja
    - source: salt://project/templates_dir
    - include_empty: True</pre> <p>Retention scheduling can be applied to manage contents of backup directories. For example:</p> <pre class="highlight-yaml notranslate" data-language="yaml">/var/backups/example_directory:
  file.retention_schedule:
    - strptime_format: example_name_%Y%m%dT%H%M%S.tar.bz2
    - retain:
        most_recent: 5
        first_of_hour: 4
        first_of_day: 14
        first_of_week: 6
        first_of_month: 6
        first_of_year: all</pre> <dl class="py function"> <h3 id="salt.states.file.absent"> salt.states.file.absent(name, **kwargs)</h3> <dd>
<p>Make sure that the named file or directory is absent. If it exists, it will be deleted. This will work to reverse any of the functions in the file state module. If a directory is supplied, it will be recursively deleted.</p> <dl class="simple"> <dt>name</dt>
<dd>
<p>The path which should be deleted</p> </dd> </dl> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.file.accumulated"> salt.states.file.accumulated(name, filename, text, **kwargs)</h3> <dd>
<p>Prepare accumulator which can be used in template in file.managed state. Accumulator dictionary becomes available in template. It can also be used in file.blockreplace.</p> <dl class="simple"> <dt>name</dt>
<dd>
<p>Accumulator name</p> </dd> <dt>filename</dt>
<dd>
<p>Filename which would receive this accumulator (see file.managed state documentation about <code class="docutils literal notranslate"><span class="pre">name</span></code>)</p> </dd> <dt>text</dt>
<dd>
<p>String or list for adding in accumulator</p> </dd> <dt>require_in / watch_in</dt>
<dd>
<p>One of them required for sure we fill up accumulator before we manage the file. Probably the same as filename</p> </dd> </dl> <p>Example:</p> <p>Given the following:</p> <pre class="highlight-yaml notranslate" data-language="yaml">animals_doing_things:
  file.accumulated:
    - filename: /tmp/animal_file.txt
    - text: ' jumps over the lazy dog.'
    - require_in:
      - file: animal_file

animal_file:
  file.managed:
    - name: /tmp/animal_file.txt
    - source: salt://animal_file.txt
    - template: jinja</pre> <p>One might write a template for <code class="docutils literal notranslate"><span class="pre">animal_file.txt</span></code> like the following:</p> <pre class="highlight-jinja notranslate" data-language="jinja">The quick brown fox{% for animal in accumulator['animals_doing_things'] %}{{ animal }}{% endfor %}</pre> <p>Collectively, the above states and template file will produce:</p> <pre class="highlight-text notranslate" data-language="text">The quick brown fox jumps over the lazy dog.</pre> <p>Multiple accumulators can be "chained" together.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>The 'accumulator' data structure is a Python dictionary. Do not expect any loop over the keys in a deterministic order!</p> </div> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.file.append"> salt.states.file.append(name, text=None, makedirs=False, source=None, source_hash=None, template='jinja', sources=None, source_hashes=None, defaults=None, context=None, ignore_whitespace=True)</h3> <dd>
<p>Ensure that some text appears at the end of a file.</p> <p>The text will not be appended if it already exists in the file. A single string of text or a list of strings may be appended.</p> <dl> <dt>name</dt>
<dd>
<p>The location of the file to append to.</p> </dd> <dt>text</dt>
<dd>
<p>The text to be appended, which can be a single string or a list of strings.</p> </dd> <dt>makedirs</dt>
<dd>
<p>If the file is located in a path without a parent directory, then the state will fail. If makedirs is set to True, then the parent directories will be created to facilitate the creation of the named file. Defaults to False.</p> </dd> <dt>source</dt>
<dd>
<p>A single source file to append. This source file can be hosted on either the salt master server, or on an HTTP or FTP server. Both HTTPS and HTTP are supported as well as downloading directly from Amazon S3 compatible URLs with both pre-configured and automatic IAM credentials (see s3.get state documentation). File retrieval from Openstack Swift object storage is supported via swift://container/object_path URLs (see swift.get documentation).</p> <p>For files hosted on the salt file server, if the file is located on the master in the directory named spam, and is called eggs, the source string is salt://spam/eggs.</p> <p>If the file is hosted on an HTTP or FTP server, the source_hash argument is also required.</p> </dd> <dt>source_hash</dt>
<dd>
<dl class="simple"> <dt>This can be one of the following:</dt>
<dd>
<ol class="arabic simple"> <li><p>a source hash string</p></li> <li><p>the URI of a file that contains source hash strings</p></li> </ol> </dd> </dl> <p>The function accepts the first encountered long unbroken alphanumeric string of correct length as a valid hash, in order from most secure to least secure:</p> <pre class="highlight-text notranslate" data-language="text">Type    Length
======  ======
sha512     128
sha384      96
sha256      64
sha224      56
sha1        40
md5         32</pre> <p>See the <code class="docutils literal notranslate"><span class="pre">source_hash</span></code> parameter description for <a class="reference internal" href="#salt.states.file.managed" title="salt.states.file.managed"><code class="xref py py-mod docutils literal notranslate"><span class="pre">file.managed</span></code></a> function for more details and examples.</p> </dd> <dt>template</dt>
<dd>
<p>The named templating engine will be used to render the appended-to file. Defaults to <code class="docutils literal notranslate"><span class="pre">jinja</span></code>. The following templates are supported:</p> <ul class="simple"> <li><p><a class="reference internal" href="../../renderers/all/salt.renderers.cheetah.html#module-salt.renderers.cheetah" title="salt.renderers.cheetah"><code class="xref py py-mod docutils literal notranslate"><span class="pre">cheetah</span></code></a></p></li> <li><p><a class="reference internal" href="../../renderers/all/salt.renderers.genshi.html#module-salt.renderers.genshi" title="salt.renderers.genshi"><code class="xref py py-mod docutils literal notranslate"><span class="pre">genshi</span></code></a></p></li> <li><p><a class="reference internal" href="../../renderers/all/salt.renderers.jinja.html#module-salt.renderers.jinja" title="salt.renderers.jinja"><code class="xref py py-mod docutils literal notranslate"><span class="pre">jinja</span></code></a></p></li> <li><p><a class="reference internal" href="../../renderers/all/salt.renderers.mako.html#module-salt.renderers.mako" title="salt.renderers.mako"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mako</span></code></a></p></li> <li><p><a class="reference internal" href="../../renderers/all/salt.renderers.py.html#module-salt.renderers.py" title="salt.renderers.py"><code class="xref py py-mod docutils literal notranslate"><span class="pre">py</span></code></a></p></li> <li><p><a class="reference internal" href="../../renderers/all/salt.renderers.wempy.html#module-salt.renderers.wempy" title="salt.renderers.wempy"><code class="xref py py-mod docutils literal notranslate"><span class="pre">wempy</span></code></a></p></li> </ul> </dd> <dt>sources</dt>
<dd>
<p>A list of source files to append. If the files are hosted on an HTTP or FTP server, the source_hashes argument is also required.</p> </dd> <dt>source_hashes</dt>
<dd>
<p>A list of source_hashes corresponding to the sources list specified in the sources argument.</p> </dd> <dt>defaults</dt>
<dd>
<p>Default context passed to the template.</p> </dd> <dt>context</dt>
<dd>
<p>Overrides default context variables passed to the template.</p> </dd> <dt>ignore_whitespace</dt>
<dd>
<div class="versionadded"> <p><span class="versionmodified added">New in version 2015.8.4.</span></p> </div> <p>Spaces and Tabs in text are ignored by default, when searching for the appending content, one space or multiple tabs are the same for salt. Set this option to <code class="docutils literal notranslate"><span class="pre">False</span></code> if you want to change this behavior.</p> </dd> </dl> <p>Multi-line example:</p> <pre class="highlight-yaml notranslate" data-language="yaml">/etc/motd:
  file.append:
    - text: |
        Thou hadst better eat salt with the Philosophers of Greece,
        than sugar with the Courtiers of Italy.
        - Benjamin Franklin</pre> <p>Multiple lines of text:</p> <pre class="highlight-yaml notranslate" data-language="yaml">/etc/motd:
  file.append:
    - text:
      - Trust no one unless you have eaten much salt with him.
      - "Salt is born of the purest of parents: the sun and the sea."</pre> <p>Gather text from multiple template files:</p> <pre class="highlight-yaml notranslate" data-language="yaml">/etc/motd:
  file:
    - append
    - template: jinja
    - sources:
      - salt://motd/devops-messages.tmpl
      - salt://motd/hr-messages.tmpl
      - salt://motd/general-messages.tmpl</pre> <div class="versionadded"> <p><span class="versionmodified added">New in version 0.9.5.</span></p> </div> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.file.blockreplace"> salt.states.file.blockreplace(name, marker_start='#-- start managed zone --', marker_end='#-- end managed zone --', source=None, source_hash=None, template='jinja', sources=None, source_hashes=None, defaults=None, context=None, content='', append_if_not_found=False, prepend_if_not_found=False, backup='.bak', show_changes=True, append_newline=None, insert_before_match=None, insert_after_match=None)</h3> <dd>
<p>Maintain an edit in a file in a zone delimited by two line markers</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2014.1.0.</span></p> </div> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 2017.7.5,2018.3.1: </span><code class="docutils literal notranslate"><span class="pre">append_newline</span></code> argument added. Additionally, to improve idempotence, if the string represented by <code class="docutils literal notranslate"><span class="pre">marker_end</span></code> is found in the middle of the line, the content preceding the marker will be removed when the block is replaced. This allows one to remove <code class="docutils literal notranslate"><span class="pre">append_newline:</span> <span class="pre">False</span></code> from the SLS and have the block properly replaced if the end of the content block is immediately followed by the <code class="docutils literal notranslate"><span class="pre">marker_end</span></code> (i.e. no newline before the marker).</p> </div> <p>A block of content delimited by comments can help you manage several lines entries without worrying about old entries removal. This can help you maintaining an un-managed file containing manual edits.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This function will store two copies of the file in-memory (the original version and the edited version) in order to detect changes and only edit the targeted file if necessary.</p> <p>Additionally, you can use <a class="reference internal" href="#salt.states.file.accumulated" title="salt.states.file.accumulated"><code class="xref py py-func docutils literal notranslate"><span class="pre">file.accumulated</span></code></a> and target this state. All accumulated data dictionaries' content will be added in the content block.</p> </div> <dl> <dt>name</dt>
<dd>
<p>Filesystem path to the file to be edited</p> </dd> <dt>marker_start</dt>
<dd>
<p>The line content identifying a line as the start of the content block. Note that the whole line containing this marker will be considered, so whitespace or extra content before or after the marker is included in final output</p> </dd> <dt>marker_end</dt>
<dd>
<p>The line content identifying the end of the content block. As of versions 2017.7.5 and 2018.3.1, everything up to the text matching the marker will be replaced, so it's important to ensure that your marker includes the beginning of the text you wish to replace.</p> </dd> <dt>content</dt>
<dd>
<p>The content to be used between the two lines identified by <code class="docutils literal notranslate"><span class="pre">marker_start</span></code> and <code class="docutils literal notranslate"><span class="pre">marker_end</span></code></p> </dd> <dt>source</dt>
<dd>
<p>The source file to download to the minion, this source file can be hosted on either the salt master server, or on an HTTP or FTP server. Both HTTPS and HTTP are supported as well as downloading directly from Amazon S3 compatible URLs with both pre-configured and automatic IAM credentials. (see s3.get state documentation) File retrieval from Openstack Swift object storage is supported via swift://container/object_path URLs, see swift.get documentation. For files hosted on the salt file server, if the file is located on the master in the directory named spam, and is called eggs, the source string is salt://spam/eggs. If source is left blank or None (use ~ in YAML), the file will be created as an empty file and the content will not be managed. This is also the case when a file already exists and the source is undefined; the contents of the file will not be changed or managed.</p> <p>If the file is hosted on a HTTP or FTP server then the source_hash argument is also required.</p> <p>A list of sources can also be passed in to provide a default source and a set of fallbacks. The first source in the list that is found to exist will be used and subsequent entries in the list will be ignored.</p> <pre class="highlight-yaml notranslate" data-language="yaml">file_override_example:
  file.blockreplace:
    - name: /etc/example.conf
    - source:
      - salt://file_that_does_not_exist
      - salt://file_that_exists</pre> </dd> <dt>source_hash</dt>
<dd>
<dl class="simple"> <dt>This can be one of the following:</dt>
<dd>
<ol class="arabic simple"> <li><p>a source hash string</p></li> <li><p>the URI of a file that contains source hash strings</p></li> </ol> </dd> </dl> <p>The function accepts the first encountered long unbroken alphanumeric string of correct length as a valid hash, in order from most secure to least secure:</p> <pre class="highlight-text notranslate" data-language="text">Type    Length
======  ======
sha512     128
sha384      96
sha256      64
sha224      56
sha1        40
md5         32</pre> <p>See the <code class="docutils literal notranslate"><span class="pre">source_hash</span></code> parameter description for <a class="reference internal" href="#salt.states.file.managed" title="salt.states.file.managed"><code class="xref py py-mod docutils literal notranslate"><span class="pre">file.managed</span></code></a> function for more details and examples.</p> </dd> <dt>template<span class="classifier">jinja</span>
</dt>
<dd>
<p>Templating engine to be used to render the downloaded file. The following engines are supported:</p> <ul class="simple"> <li><p><a class="reference internal" href="../../renderers/all/salt.renderers.cheetah.html#module-salt.renderers.cheetah" title="salt.renderers.cheetah"><code class="xref py py-mod docutils literal notranslate"><span class="pre">cheetah</span></code></a></p></li> <li><p><a class="reference internal" href="../../renderers/all/salt.renderers.genshi.html#module-salt.renderers.genshi" title="salt.renderers.genshi"><code class="xref py py-mod docutils literal notranslate"><span class="pre">genshi</span></code></a></p></li> <li><p><a class="reference internal" href="../../renderers/all/salt.renderers.jinja.html#module-salt.renderers.jinja" title="salt.renderers.jinja"><code class="xref py py-mod docutils literal notranslate"><span class="pre">jinja</span></code></a></p></li> <li><p><a class="reference internal" href="../../renderers/all/salt.renderers.mako.html#module-salt.renderers.mako" title="salt.renderers.mako"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mako</span></code></a></p></li> <li><p><a class="reference internal" href="../../renderers/all/salt.renderers.py.html#module-salt.renderers.py" title="salt.renderers.py"><code class="xref py py-mod docutils literal notranslate"><span class="pre">py</span></code></a></p></li> <li><p><a class="reference internal" href="../../renderers/all/salt.renderers.wempy.html#module-salt.renderers.wempy" title="salt.renderers.wempy"><code class="xref py py-mod docutils literal notranslate"><span class="pre">wempy</span></code></a></p></li> </ul> </dd> <dt>context</dt>
<dd>
<p>Overrides default context variables passed to the template</p> </dd> <dt>defaults</dt>
<dd>
<p>Default context passed to the template</p> </dd> <dt>append_if_not_found<span class="classifier">False</span>
</dt>
<dd>
<p>If markers are not found and this option is set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, the content block will be appended to the file.</p> </dd> <dt>prepend_if_not_found<span class="classifier">False</span>
</dt>
<dd>
<p>If markers are not found and this option is set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, the content block will be prepended to the file.</p> </dd> <dt>insert_before_match</dt>
<dd>
<p>If markers are not found, this parameter can be set to a regex which will insert the block before the first found occurrence in the file.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 3001.</span></p> </div> </dd> <dt>insert_after_match</dt>
<dd>
<p>If markers are not found, this parameter can be set to a regex which will insert the block after the first found occurrence in the file.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 3001.</span></p> </div> </dd> <dt>backup</dt>
<dd>
<p>The file extension to use for a backup of the file if any edit is made. Set this to <code class="docutils literal notranslate"><span class="pre">False</span></code> to skip making a backup.</p> </dd> <dt>dry_run<span class="classifier">False</span>
</dt>
<dd>
<p>If <code class="docutils literal notranslate"><span class="pre">True</span></code>, do not make any edits to the file and simply return the changes that <em>would</em> be made.</p> </dd> <dt>show_changes<span class="classifier">True</span>
</dt>
<dd>
<p>Controls how changes are presented. If <code class="docutils literal notranslate"><span class="pre">True</span></code>, the <code class="docutils literal notranslate"><span class="pre">Changes</span></code> section of the state return will contain a unified diff of the changes made. If False, then it will contain a boolean (<code class="docutils literal notranslate"><span class="pre">True</span></code> if any changes were made, otherwise <code class="docutils literal notranslate"><span class="pre">False</span></code>).</p> </dd> <dt>append_newline</dt>
<dd>
<p>Controls whether or not a newline is appended to the content block. If the value of this argument is <code class="docutils literal notranslate"><span class="pre">True</span></code> then a newline will be added to the content block. If it is <code class="docutils literal notranslate"><span class="pre">False</span></code>, then a newline will <em>not</em> be added to the content block. If it is unspecified, then a newline will only be added to the content block if it does not already end in a newline.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2017.7.5,2018.3.1.</span></p> </div> </dd> </dl> <p>Example of usage with an accumulator and with a variable:</p> <pre class="highlight-jinja notranslate" data-language="jinja">{% set myvar = 42 %}
hosts-config-block-{{ myvar }}:
  file.blockreplace:
    - name: /etc/hosts
    - marker_start: "# START managed zone {{ myvar }} -DO-NOT-EDIT-"
    - marker_end: "# END managed zone {{ myvar }} --"
    - content: 'First line of content'
    - append_if_not_found: True
    - backup: '.bak'
    - show_changes: True

hosts-config-block-{{ myvar }}-accumulated1:
  file.accumulated:
    - filename: /etc/hosts
    - name: my-accumulator-{{ myvar }}
    - text: "text 2"
    - require_in:
      - file: hosts-config-block-{{ myvar }}

hosts-config-block-{{ myvar }}-accumulated2:
  file.accumulated:
    - filename: /etc/hosts
    - name: my-accumulator-{{ myvar }}
    - text: |
         text 3
         text 4
    - require_in:
      - file: hosts-config-block-{{ myvar }}</pre> <p>will generate and maintain a block of content in <code class="docutils literal notranslate"><span class="pre">/etc/hosts</span></code>:</p> <pre class="highlight-text notranslate" data-language="text"># START managed zone 42 -DO-NOT-EDIT-
First line of content
text 2
text 3
text 4
# END managed zone 42 --</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.file.cached"> salt.states.file.cached(name, source_hash='', source_hash_name=None, skip_verify=False, saltenv='base')</h3> <dd>
<div class="versionadded"> <p><span class="versionmodified added">New in version 2017.7.3.</span></p> </div> <p>Ensures that a file is saved to the minion's cache. This state is primarily invoked by other states to ensure that we do not re-download a source file if we do not need to.</p> <dl> <dt>name</dt>
<dd>
<p>The URL of the file to be cached. To cache a file from an environment other than <code class="docutils literal notranslate"><span class="pre">base</span></code>, either use the <code class="docutils literal notranslate"><span class="pre">saltenv</span></code> argument or include the saltenv in the URL (e.g. <code class="docutils literal notranslate"><span class="pre">salt://path/to/file.conf?saltenv=dev</span></code>).</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>A list of URLs is not supported, this must be a single URL. If a local file is passed here, then the state will obviously not try to download anything, but it will compare a hash if one is specified.</p> </div> </dd> <dt>source_hash</dt>
<dd>
<p>See the documentation for this same argument in the <a class="reference internal" href="#salt.states.file.managed" title="salt.states.file.managed"><code class="xref py py-func docutils literal notranslate"><span class="pre">file.managed</span></code></a> state.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>For remote files not originating from the <code class="docutils literal notranslate"><span class="pre">salt://</span></code> fileserver, such as http(s) or ftp servers, this state will not re-download the file if the locally-cached copy matches this hash. This is done to prevent unnecessary downloading on repeated runs of this state. To update the cached copy of a file, it is necessary to update this hash.</p> </div> </dd> <dt>source_hash_name</dt>
<dd>
<p>See the documentation for this same argument in the <a class="reference internal" href="#salt.states.file.managed" title="salt.states.file.managed"><code class="xref py py-func docutils literal notranslate"><span class="pre">file.managed</span></code></a> state.</p> </dd> <dt>skip_verify</dt>
<dd>
<p>See the documentation for this same argument in the <a class="reference internal" href="#salt.states.file.managed" title="salt.states.file.managed"><code class="xref py py-func docutils literal notranslate"><span class="pre">file.managed</span></code></a> state.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>Setting this to <code class="docutils literal notranslate"><span class="pre">True</span></code> will result in a copy of the file being downloaded from a remote (http(s), ftp, etc.) source each time the state is run.</p> </div> </dd> <dt>saltenv</dt>
<dd>
<p>Used to specify the environment from which to download a file from the Salt fileserver (i.e. those with <code class="docutils literal notranslate"><span class="pre">salt://</span></code> URL).</p> </dd> </dl> <p>This state will in most cases not be useful in SLS files, but it is useful when writing a state or remote-execution module that needs to make sure that a file at a given URL has been downloaded to the cachedir. One example of this is in the <code class="xref py py-func docutils literal notranslate"><span class="pre">archive.extracted</span></code> state:</p> <pre class="highlight-python notranslate" data-language="python">result = __states__['file.cached'](source_match,
                                   source_hash=source_hash,
                                   source_hash_name=source_hash_name,
                                   skip_verify=skip_verify,
                                   saltenv=__env__)</pre> <p>This will return a dictionary containing the state's return data, including a <code class="docutils literal notranslate"><span class="pre">result</span></code> key which will state whether or not the state was successful. Note that this will not catch exceptions, so it is best used within a try/except.</p> <p>Once this state has been run from within another state or remote-execution module, the actual location of the cached file can be obtained using <a class="reference internal" href="../../modules/all/salt.modules.cp.html#salt.modules.cp.is_cached" title="salt.modules.cp.is_cached"><code class="xref py py-func docutils literal notranslate"><span class="pre">cp.is_cached</span></code></a>:</p> <pre class="highlight-python notranslate" data-language="python">cached = __salt__['cp.is_cached'](source_match, saltenv=__env__)</pre> <p>This function will return the cached path of the file, or an empty string if the file is not present in the minion cache.</p> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.file.comment"> salt.states.file.comment(name, regex, char='#', backup='.bak')</h3> <dd>
<p>Comment out specified lines in a file.</p> <dl> <dt>name</dt>
<dd>
<p>The full path to the file to be edited</p> </dd> <dt>regex</dt>
<dd>
<p>A regular expression used to find the lines that are to be commented; this pattern will be wrapped in parenthesis and will move any preceding/trailing <code class="docutils literal notranslate"><span class="pre">^</span></code> or <code class="docutils literal notranslate"><span class="pre">$</span></code> characters outside the parenthesis (e.g., the pattern <code class="docutils literal notranslate"><span class="pre">^foo$</span></code> will be rewritten as <code class="docutils literal notranslate"><span class="pre">^(foo)$</span></code>) Note that you _need_ the leading ^, otherwise each time you run highstate, another comment char will be inserted.</p> </dd> <dt>char<span class="classifier"><code class="docutils literal notranslate"><span class="pre">#</span></code></span>
</dt>
<dd>
<p>The character to be inserted at the beginning of a line in order to comment it out</p> </dd> <dt>backup<span class="classifier"><code class="docutils literal notranslate"><span class="pre">.bak</span></code></span>
</dt>
<dd>
<p>The file will be backed up before edit with this file extension</p> <div class="admonition warning"> <p class="admonition-title">Warning</p> <p>This backup will be overwritten each time <code class="docutils literal notranslate"><span class="pre">sed</span></code> / <code class="docutils literal notranslate"><span class="pre">comment</span></code> / <code class="docutils literal notranslate"><span class="pre">uncomment</span></code> is called. Meaning the backup will only be useful after the first invocation.</p> </div> <p>Set to False/None to not keep a backup.</p> </dd> </dl> <p>Usage:</p> <pre class="highlight-yaml notranslate" data-language="yaml">/etc/fstab:
  file.comment:
    - regex: ^bind 127.0.0.1</pre> <div class="versionadded"> <p><span class="versionmodified added">New in version 0.9.5.</span></p> </div> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.file.copy_"> salt.states.file.copy_(name, source, force=False, makedirs=False, preserve=False, user=None, group=None, mode=None, subdir=False, **kwargs)</h3> <dd>
<p>If the file defined by the <code class="docutils literal notranslate"><span class="pre">source</span></code> option exists on the minion, copy it to the named path. The file will not be overwritten if it already exists, unless the <code class="docutils literal notranslate"><span class="pre">force</span></code> option is set to <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This state only copies files from one location on a minion to another location on the same minion. For copying files from the master, use a <a class="reference internal" href="#salt.states.file.managed" title="salt.states.file.managed"><code class="xref py py-func docutils literal notranslate"><span class="pre">file.managed</span></code></a> state.</p> </div> <dl> <dt>name</dt>
<dd>
<p>The location of the file to copy to</p> </dd> <dt>source</dt>
<dd>
<p>The location of the file to copy to the location specified with name</p> </dd> <dt>force</dt>
<dd>
<p>If the target location is present then the file will not be moved, specify "force: True" to overwrite the target file</p> </dd> <dt>makedirs</dt>
<dd>
<p>If the target subdirectories don't exist create them</p> </dd> <dt>preserve</dt>
<dd>
<div class="versionadded"> <p><span class="versionmodified added">New in version 2015.5.0.</span></p> </div> <p>Set <code class="docutils literal notranslate"><span class="pre">preserve:</span> <span class="pre">True</span></code> to preserve user/group ownership and mode after copying. Default is <code class="docutils literal notranslate"><span class="pre">False</span></code>. If <code class="docutils literal notranslate"><span class="pre">preserve</span></code> is set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, then user/group/mode attributes will be ignored.</p> </dd> <dt>user</dt>
<dd>
<div class="versionadded"> <p><span class="versionmodified added">New in version 2015.5.0.</span></p> </div> <p>The user to own the copied file, this defaults to the user salt is running as on the minion. If <code class="docutils literal notranslate"><span class="pre">preserve</span></code> is set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, then this will be ignored</p> </dd> <dt>group</dt>
<dd>
<div class="versionadded"> <p><span class="versionmodified added">New in version 2015.5.0.</span></p> </div> <p>The group to own the copied file, this defaults to the group salt is running as on the minion. If <code class="docutils literal notranslate"><span class="pre">preserve</span></code> is set to <code class="docutils literal notranslate"><span class="pre">True</span></code> or on Windows this will be ignored</p> </dd> <dt>mode</dt>
<dd>
<div class="versionadded"> <p><span class="versionmodified added">New in version 2015.5.0.</span></p> </div> <p>The permissions to set on the copied file, aka 644, '0775', '4664'. If <code class="docutils literal notranslate"><span class="pre">preserve</span></code> is set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, then this will be ignored. Not supported on Windows.</p> <p>The default mode for new files and directories corresponds umask of salt process. For existing files and directories it's not enforced.</p> </dd> <dt>subdir</dt>
<dd>
<div class="versionadded"> <p><span class="versionmodified added">New in version 2015.5.0.</span></p> </div> <p>If the name is a directory then place the file inside the named directory</p> </dd> </dl> <div class="admonition note"> <p class="admonition-title">Note</p> <p>The copy function accepts paths that are local to the Salt minion. This function does not support salt://, http://, or the other additional file paths that are supported by <a class="reference internal" href="#salt.states.file.managed" title="salt.states.file.managed"><code class="xref py py-mod docutils literal notranslate"><span class="pre">states.file.managed</span></code></a> and <a class="reference internal" href="#salt.states.file.recurse" title="salt.states.file.recurse"><code class="xref py py-mod docutils literal notranslate"><span class="pre">states.file.recurse</span></code></a>.</p> </div> <p>Usage:</p> <pre class="highlight-yaml notranslate" data-language="yaml"># Use 'copy', not 'copy_'
/etc/example.conf:
  file.copy:
    - source: /tmp/example.conf</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.file.decode"> salt.states.file.decode(name, encoded_data=None, contents_pillar=None, encoding_type='base64', checksum='md5')</h3> <dd>
<p>Decode an encoded file and write it to disk</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2016.3.0.</span></p> </div> <dl> <dt>name</dt>
<dd>
<p>Path of the file to be written.</p> </dd> <dt>encoded_data</dt>
<dd>
<p>The encoded file. Either this option or <code class="docutils literal notranslate"><span class="pre">contents_pillar</span></code> must be specified.</p> </dd> <dt>contents_pillar</dt>
<dd>
<p>A Pillar path to the encoded file. Uses the same path syntax as <a class="reference internal" href="../../modules/all/salt.modules.pillar.html#salt.modules.pillar.get" title="salt.modules.pillar.get"><code class="xref py py-func docutils literal notranslate"><span class="pre">pillar.get</span></code></a>. The <a class="reference internal" href="../../modules/all/salt.modules.hashutil.html#salt.modules.hashutil.base64_encodefile" title="salt.modules.hashutil.base64_encodefile"><code class="xref py py-func docutils literal notranslate"><span class="pre">hashutil.base64_encodefile</span></code></a> function can load encoded content into Pillar. Either this option or <code class="docutils literal notranslate"><span class="pre">encoded_data</span></code> must be specified.</p> </dd> <dt>encoding_type<span class="classifier"><code class="docutils literal notranslate"><span class="pre">base64</span></code></span>
</dt>
<dd>
<p>The type of encoding.</p> </dd> <dt>checksum<span class="classifier"><code class="docutils literal notranslate"><span class="pre">md5</span></code></span>
</dt>
<dd>
<p>The hashing algorithm to use to generate checksums. Wraps the <a class="reference internal" href="../../modules/all/salt.modules.hashutil.html#salt.modules.hashutil.digest" title="salt.modules.hashutil.digest"><code class="xref py py-func docutils literal notranslate"><span class="pre">hashutil.digest</span></code></a> execution function.</p> </dd> </dl> <p>Usage:</p> <pre class="highlight-yaml notranslate" data-language="yaml">write_base64_encoded_string_to_a_file:
  file.decode:
    - name: /tmp/new_file
    - encoding_type: base64
    - contents_pillar: mypillar:thefile

# or

write_base64_encoded_string_to_a_file:
  file.decode:
    - name: /tmp/new_file
    - encoding_type: base64
    - encoded_data: |
        Z2V0IHNhbHRlZAo=</pre> <p>Be careful with multi-line strings that the YAML indentation is correct. E.g.,</p> <pre class="highlight-jinja notranslate" data-language="jinja">write_base64_encoded_string_to_a_file:
  file.decode:
    - name: /tmp/new_file
    - encoding_type: base64
    - encoded_data: |
        {{ salt.pillar.get('path:to:data') | indent(8) }}</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.file.directory"> salt.states.file.directory(name, user=None, group=None, recurse=None, max_depth=None, dir_mode=None, file_mode=None, makedirs=False, clean=False, require=None, exclude_pat=None, follow_symlinks=False, force=False, backupname=None, allow_symlink=True, children_only=False, win_owner=None, win_perms=None, win_deny_perms=None, win_inheritance=True, win_perms_reset=False, **kwargs)</h3> <dd>
<p>Ensure that a named directory is present and has the right perms</p> <dl> <dt>name</dt>
<dd>
<p>The location to create or manage a directory, as an absolute path</p> </dd> <dt>user</dt>
<dd>
<p>The user to own the directory; this defaults to the user salt is running as on the minion</p> </dd> <dt>group</dt>
<dd>
<p>The group ownership set for the directory; this defaults to the group salt is running as on the minion. On Windows, this is ignored</p> </dd> <dt>recurse</dt>
<dd>
<p>Enforce user/group ownership and mode of directory recursively. Accepts a list of strings representing what you would like to recurse. If <code class="docutils literal notranslate"><span class="pre">mode</span></code> is defined, will recurse on both <code class="docutils literal notranslate"><span class="pre">file_mode</span></code> and <code class="docutils literal notranslate"><span class="pre">dir_mode</span></code> if they are defined. If <code class="docutils literal notranslate"><span class="pre">ignore_files</span></code> or <code class="docutils literal notranslate"><span class="pre">ignore_dirs</span></code> is included, files or directories will be left unchanged respectively. directories will be left unchanged respectively. If <code class="docutils literal notranslate"><span class="pre">silent</span></code> is defined, individual file/directory change notifications will be suppressed.</p> <p>Example:</p> <pre class="highlight-yaml notranslate" data-language="yaml">/var/log/httpd:
  file.directory:
    - user: root
    - group: root
    - dir_mode: 755
    - file_mode: 644
    - recurse:
      - user
      - group
      - mode</pre> <p>Leave files or directories unchanged:</p> <pre class="highlight-yaml notranslate" data-language="yaml">/var/log/httpd:
  file.directory:
    - user: root
    - group: root
    - dir_mode: 755
    - file_mode: 644
    - recurse:
      - user
      - group
      - mode
      - ignore_dirs</pre> <div class="versionadded"> <p><span class="versionmodified added">New in version 2015.5.0.</span></p> </div> </dd> <dt>max_depth</dt>
<dd>
<p>Limit the recursion depth. The default is no limit=None. 'max_depth' and 'clean' are mutually exclusive.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2016.11.0.</span></p> </div> </dd> <dt>dir_mode / mode</dt>
<dd>
<p>The permissions mode to set any directories created. Not supported on Windows.</p> <p>The default mode for new files and directories corresponds umask of salt process. For existing files and directories it's not enforced.</p> </dd> <dt>file_mode</dt>
<dd>
<p>The permissions mode to set any files created if 'mode' is run in 'recurse'. This defaults to dir_mode. Not supported on Windows.</p> <p>The default mode for new files and directories corresponds umask of salt process. For existing files and directories it's not enforced.</p> </dd> <dt>makedirs</dt>
<dd>
<p>If the directory is located in a path without a parent directory, then the state will fail. If makedirs is set to True, then the parent directories will be created to facilitate the creation of the named file.</p> </dd> <dt>clean</dt>
<dd>
<p>Make sure that only files that are set up by salt and required by this function are kept. If this option is set then everything in this directory will be deleted unless it is required. 'clean' and 'max_depth' are mutually exclusive.</p> </dd> <dt>require</dt>
<dd>
<p>Require other resources such as packages or files</p> </dd> <dt>exclude_pat</dt>
<dd>
<p>When 'clean' is set to True, exclude this pattern from removal list and preserve in the destination.</p> </dd> <dt>follow_symlinks<span class="classifier">False</span>
</dt>
<dd>
<p>If the desired path is a symlink (or <code class="docutils literal notranslate"><span class="pre">recurse</span></code> is defined and a symlink is encountered while recursing), follow it and check the permissions of the directory/file to which the symlink points.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2014.1.4.</span></p> </div> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 3001.1: </span>If set to False symlinks permissions are ignored on Linux systems because it does not support permissions modification. Symlinks permissions are always 0o777 on Linux.</p> </div> </dd> <dt>force</dt>
<dd>
<p>If the name of the directory exists and is not a directory and force is set to False, the state will fail. If force is set to True, the file in the way of the directory will be deleted to make room for the directory, unless backupname is set, then it will be renamed.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2014.7.0.</span></p> </div> </dd> <dt>backupname</dt>
<dd>
<p>If the name of the directory exists and is not a directory, it will be renamed to the backupname. If the backupname already exists and force is False, the state will fail. Otherwise, the backupname will be removed first.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2014.7.0.</span></p> </div> </dd> <dt>allow_symlink<span class="classifier">True</span>
</dt>
<dd>
<p>If allow_symlink is True and the specified path is a symlink, it will be allowed to remain if it points to a directory. If allow_symlink is False then the state will fail, unless force is also set to True, in which case it will be removed or renamed, depending on the value of the backupname argument.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2014.7.0.</span></p> </div> </dd> <dt>children_only<span class="classifier">False</span>
</dt>
<dd>
<p>If children_only is True the base of a path is excluded when performing a recursive operation. In case of /path/to/base, base will be ignored while all of /path/to/base/* are still operated on.</p> </dd> <dt>win_owner<span class="classifier">None</span>
</dt>
<dd>
<p>The owner of the directory. If this is not passed, user will be used. If user is not passed, the account under which Salt is running will be used.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2017.7.0.</span></p> </div> </dd> <dt>win_perms<span class="classifier">None</span>
</dt>
<dd>
<p>A dictionary containing permissions to grant and their propagation. For example: <code class="docutils literal notranslate"><span class="pre">{'Administrators':</span> <span class="pre">{'perms':</span> <span class="pre">'full_control',</span> <span class="pre">'applies_to':</span>
<span class="pre">'this_folder_only'}}</span></code> Can be a single basic perm or a list of advanced perms. <code class="docutils literal notranslate"><span class="pre">perms</span></code> must be specified. <code class="docutils literal notranslate"><span class="pre">applies_to</span></code> is optional and defaults to <code class="docutils literal notranslate"><span class="pre">this_folder_subfolder_files</span></code>.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2017.7.0.</span></p> </div> </dd> <dt>win_deny_perms<span class="classifier">None</span>
</dt>
<dd>
<p>A dictionary containing permissions to deny and their propagation. For example: <code class="docutils literal notranslate"><span class="pre">{'Administrators':</span> <span class="pre">{'perms':</span> <span class="pre">'full_control',</span> <span class="pre">'applies_to':</span>
<span class="pre">'this_folder_only'}}</span></code> Can be a single basic perm or a list of advanced perms.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2017.7.0.</span></p> </div> </dd> <dt>win_inheritance<span class="classifier">True</span>
</dt>
<dd>
<p>True to inherit permissions from the parent directory, False not to inherit permission.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2017.7.0.</span></p> </div> </dd> <dt>win_perms_reset<span class="classifier">False</span>
</dt>
<dd>
<p>If <code class="docutils literal notranslate"><span class="pre">True</span></code> the existing DACL will be cleared and replaced with the settings defined in this function. If <code class="docutils literal notranslate"><span class="pre">False</span></code>, new entries will be appended to the existing DACL. Default is <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2018.3.0.</span></p> </div> </dd> </dl> <p>Here's an example using the above <code class="docutils literal notranslate"><span class="pre">win_*</span></code> parameters:</p> <pre class="highlight-yaml notranslate" data-language="yaml">create_config_dir:
  file.directory:
    - name: 'C:\config\'
    - win_owner: Administrators
    - win_perms:
        # Basic Permissions
        dev_ops:
          perms: full_control
        # List of advanced permissions
        appuser:
          perms:
            - read_attributes
            - read_ea
            - create_folders
            - read_permissions
          applies_to: this_folder_only
        joe_snuffy:
          perms: read
          applies_to: this_folder_files
    - win_deny_perms:
        fred_snuffy:
          perms: full_control
    - win_inheritance: False</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.file.exists"> salt.states.file.exists(name, **kwargs)</h3> <dd>
<p>Verify that the named file or directory is present or exists. Ensures pre-requisites outside of Salt's purview (e.g., keytabs, private keys, etc.) have been previously satisfied before deployment.</p> <p>This function does not create the file if it doesn't exist, it will return an error.</p> <dl class="simple"> <dt>name</dt>
<dd>
<p>Absolute path which must exist</p> </dd> </dl> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.file.hardlink"> salt.states.file.hardlink(name, target, force=False, makedirs=False, user=None, group=None, dir_mode=None, **kwargs)</h3> <dd>
<p>Create a hard link If the file already exists and is a hard link pointing to any location other than the specified target, the hard link will be replaced. If the hard link is a regular file or directory then the state will return False. If the regular file is desired to be replaced with a hard link pass force: True</p> <dl class="simple"> <dt>name</dt>
<dd>
<p>The location of the hard link to create</p> </dd> <dt>target</dt>
<dd>
<p>The location that the hard link points to</p> </dd> <dt>force</dt>
<dd>
<p>If the name of the hard link exists and force is set to False, the state will fail. If force is set to True, the file or directory in the way of the hard link file will be deleted to make room for the hard link, unless backupname is set, when it will be renamed</p> </dd> <dt>makedirs</dt>
<dd>
<p>If the location of the hard link does not already have a parent directory then the state will fail, setting makedirs to True will allow Salt to create the parent directory</p> </dd> <dt>user</dt>
<dd>
<p>The user to own any directories made if makedirs is set to true. This defaults to the user salt is running as on the minion</p> </dd> <dt>group</dt>
<dd>
<p>The group ownership set on any directories made if makedirs is set to true. This defaults to the group salt is running as on the minion. On Windows, this is ignored</p> </dd> <dt>dir_mode</dt>
<dd>
<p>If directories are to be created, passing this option specifies the permissions for those directories.</p> </dd> </dl> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.file.keyvalue"> salt.states.file.keyvalue(name, key=None, value=None, key_values=None, separator='=', append_if_not_found=False, prepend_if_not_found=False, search_only=False, show_changes=True, ignore_if_missing=False, count=1, uncomment=None, key_ignore_case=False, value_ignore_case=False)</h3> <dd>
<p>Key/Value based editing of a file.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 3001.</span></p> </div> <p>This function differs from <code class="docutils literal notranslate"><span class="pre">file.replace</span></code> in that it is able to search for keys, followed by a customizable separator, and replace the value with the given value. Should the value be the same as the one already in the file, no changes will be made.</p> <p>Either supply both <code class="docutils literal notranslate"><span class="pre">key</span></code> and <code class="docutils literal notranslate"><span class="pre">value</span></code> parameters, or supply a dictionary with key / value pairs. It is an error to supply both.</p> <dl class="simple"> <dt>name</dt>
<dd>
<p>Name of the file to search/replace in.</p> </dd> <dt>key</dt>
<dd>
<p>Key to search for when ensuring a value. Use in combination with a <code class="docutils literal notranslate"><span class="pre">value</span></code> parameter.</p> </dd> <dt>value</dt>
<dd>
<p>Value to set for a given key. Use in combination with a <code class="docutils literal notranslate"><span class="pre">key</span></code> parameter.</p> </dd> <dt>key_values</dt>
<dd>
<p>Dictionary of key / value pairs to search for and ensure values for. Used to specify multiple key / values at once.</p> </dd> <dt>separator<span class="classifier">"="</span>
</dt>
<dd>
<p>Separator which separates key from value.</p> </dd> <dt>append_if_not_found<span class="classifier">False</span>
</dt>
<dd>
<p>Append the key/value to the end of the file if not found. Note that this takes precedence over <code class="docutils literal notranslate"><span class="pre">prepend_if_not_found</span></code>.</p> </dd> <dt>prepend_if_not_found<span class="classifier">False</span>
</dt>
<dd>
<p>Prepend the key/value to the beginning of the file if not found. Note that <code class="docutils literal notranslate"><span class="pre">append_if_not_found</span></code> takes precedence.</p> </dd> <dt>show_changes<span class="classifier">True</span>
</dt>
<dd>
<p>Show a diff of the resulting removals and inserts.</p> </dd> <dt>ignore_if_missing<span class="classifier">False</span>
</dt>
<dd>
<p>Return with success even if the file is not found (or not readable).</p> </dd> <dt>count<span class="classifier">1</span>
</dt>
<dd>
<p>Number of occurrences to allow (and correct), default is 1. Set to -1 to replace all, or set to 0 to remove all lines with this key regardsless of its value.</p> </dd> </dl> <div class="admonition note"> <p class="admonition-title">Note</p> <p>Any additional occurrences after <code class="docutils literal notranslate"><span class="pre">count</span></code> are removed. A count of -1 will only replace all occurrences that are currently uncommented already. Lines commented out will be left alone.</p> </div> <dl class="simple"> <dt>uncomment<span class="classifier">None</span>
</dt>
<dd>
<p>Disregard and remove supplied leading characters when finding keys. When set to None, lines that are commented out are left for what they are.</p> </dd> </dl> <div class="admonition note"> <p class="admonition-title">Note</p> <p>The argument to <code class="docutils literal notranslate"><span class="pre">uncomment</span></code> is not a prefix string. Rather; it is a set of characters, each of which are stripped.</p> </div> <dl class="simple"> <dt>key_ignore_case<span class="classifier">False</span>
</dt>
<dd>
<p>Keys are matched case insensitively. When a value is changed the matched key is kept as-is.</p> </dd> <dt>value_ignore_case<span class="classifier">False</span>
</dt>
<dd>
<p>Values are checked case insensitively, trying to set e.g. 'Yes' while the current value is 'yes', will not result in changes when <code class="docutils literal notranslate"><span class="pre">value_ignore_case</span></code> is set to True.</p> </dd> </dl> <p>An example of using <code class="docutils literal notranslate"><span class="pre">file.keyvalue</span></code> to ensure sshd does not allow for root to login with a password and at the same time setting the login-gracetime to 1 minute and disabling all forwarding:</p> <pre class="highlight-yaml notranslate" data-language="yaml">sshd_config_harden:
    file.keyvalue:
      - name: /etc/ssh/sshd_config
      - key_values:
          permitrootlogin: 'without-password'
          LoginGraceTime: '1m'
          DisableForwarding: 'yes'
      - separator: ' '
      - uncomment: '# '
      - key_ignore_case: True
      - append_if_not_found: True</pre> <p>The same example, except for only ensuring PermitRootLogin is set correctly. Thus being able to use the shorthand <code class="docutils literal notranslate"><span class="pre">key</span></code> and <code class="docutils literal notranslate"><span class="pre">value</span></code> parameters instead of <code class="docutils literal notranslate"><span class="pre">key_values</span></code>.</p> <pre class="highlight-yaml notranslate" data-language="yaml">sshd_config_harden:
    file.keyvalue:
      - name: /etc/ssh/sshd_config
      - key: PermitRootLogin
      - value: without-password
      - separator: ' '
      - uncomment: '# '
      - key_ignore_case: True
      - append_if_not_found: True</pre> <div class="admonition note"> <p class="admonition-title">Note</p> <p>Notice how the key is not matched case-sensitively, this way it will correctly identify both 'PermitRootLogin' as well as 'permitrootlogin'.</p> </div> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.file.line"> salt.states.file.line(name, content=None, match=None, mode=None, location=None, before=None, after=None, show_changes=True, backup=False, quiet=False, indent=True, create=False, user=None, group=None, file_mode=None)</h3> <dd>
<p>Line-focused editing of a file.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2015.8.0.</span></p> </div> <div class="admonition note"> <p class="admonition-title">Note</p> <p><code class="docutils literal notranslate"><span class="pre">file.line</span></code> exists for historic reasons, and is not generally recommended. It has a lot of quirks. You may find <code class="docutils literal notranslate"><span class="pre">file.replace</span></code> to be more suitable.</p> </div> <p><code class="docutils literal notranslate"><span class="pre">file.line</span></code> is most useful if you have single lines in a file, potentially a config file, that you would like to manage. It can remove, add, and replace lines.</p> <dl> <dt>name</dt>
<dd>
<p>Filesystem path to the file to be edited.</p> </dd> <dt>content</dt>
<dd>
<p>Content of the line. Allowed to be empty if mode=delete.</p> </dd> <dt>match</dt>
<dd>
<p>Match the target line for an action by a fragment of a string or regular expression.</p> <p>If neither <code class="docutils literal notranslate"><span class="pre">before</span></code> nor <code class="docutils literal notranslate"><span class="pre">after</span></code> are provided, and <code class="docutils literal notranslate"><span class="pre">match</span></code> is also <code class="docutils literal notranslate"><span class="pre">None</span></code>, match falls back to the <code class="docutils literal notranslate"><span class="pre">content</span></code> value.</p> </dd> <dt>mode</dt>
<dd>
<p>Defines how to edit a line. One of the following options is required:</p> <ul> <li>
<dl class="simple"> <dt>ensure</dt>
<dd>
<p>If line does not exist, it will be added. If <code class="docutils literal notranslate"><span class="pre">before</span></code> and <code class="docutils literal notranslate"><span class="pre">after</span></code> are specified either zero lines, or lines that contain the <code class="docutils literal notranslate"><span class="pre">content</span></code> line are allowed to be in between <code class="docutils literal notranslate"><span class="pre">before</span></code> and <code class="docutils literal notranslate"><span class="pre">after</span></code>. If there are lines, and none of them match then it will produce an error.</p> </dd> </dl> </li> <li>
<dl class="simple"> <dt>replace</dt>
<dd>
<p>If line already exists, it will be replaced.</p> </dd> </dl> </li> <li>
<dl class="simple"> <dt>delete</dt>
<dd>
<p>Delete the line, if found.</p> </dd> </dl> </li> <li>
<dl> <dt>insert</dt>
<dd>
<p>Nearly identical to <code class="docutils literal notranslate"><span class="pre">ensure</span></code>. If a line does not exist, it will be added.</p> <p>The differences are that multiple (and non-matching) lines are alloweed between <code class="docutils literal notranslate"><span class="pre">before</span></code> and <code class="docutils literal notranslate"><span class="pre">after</span></code>, if they are specified. The line will always be inserted right before <code class="docutils literal notranslate"><span class="pre">before</span></code>. <code class="docutils literal notranslate"><span class="pre">insert</span></code> also allows the use of <code class="docutils literal notranslate"><span class="pre">location</span></code> to specify that the line should be added at the beginning or end of the file.</p> </dd> </dl> </li> </ul> <div class="admonition note"> <p class="admonition-title">Note</p> <p>If <code class="docutils literal notranslate"><span class="pre">mode=insert</span></code> is used, at least one of the following options must also be defined: <code class="docutils literal notranslate"><span class="pre">location</span></code>, <code class="docutils literal notranslate"><span class="pre">before</span></code>, or <code class="docutils literal notranslate"><span class="pre">after</span></code>. If <code class="docutils literal notranslate"><span class="pre">location</span></code> is used, it takes precedence over the other two options.</p> </div> </dd> <dt>location</dt>
<dd>
<p>In <code class="docutils literal notranslate"><span class="pre">mode=insert</span></code> only, whether to place the <code class="docutils literal notranslate"><span class="pre">content</span></code> at the beginning or end of a the file. If <code class="docutils literal notranslate"><span class="pre">location</span></code> is provided, <code class="docutils literal notranslate"><span class="pre">before</span></code> and <code class="docutils literal notranslate"><span class="pre">after</span></code> are ignored. Valid locations:</p> <ul class="simple"> <li>
<dl class="simple"> <dt>start</dt>
<dd>
<p>Place the content at the beginning of the file.</p> </dd> </dl> </li> <li>
<dl class="simple"> <dt>end</dt>
<dd>
<p>Place the content at the end of the file.</p> </dd> </dl> </li> </ul> </dd> <dt>before</dt>
<dd>
<p>Regular expression or an exact case-sensitive fragment of the string. Will be tried as <strong>both</strong> a regex <strong>and</strong> a part of the line. Must match <strong>exactly</strong> one line in the file. This value is only used in <code class="docutils literal notranslate"><span class="pre">ensure</span></code> and <code class="docutils literal notranslate"><span class="pre">insert</span></code> modes. The <code class="docutils literal notranslate"><span class="pre">content</span></code> will be inserted just before this line, matching its <code class="docutils literal notranslate"><span class="pre">indent</span></code> unless <code class="docutils literal notranslate"><span class="pre">indent=False</span></code>.</p> </dd> <dt>after</dt>
<dd>
<p>Regular expression or an exact case-sensitive fragment of the string. Will be tried as <strong>both</strong> a regex <strong>and</strong> a part of the line. Must match <strong>exactly</strong> one line in the file. This value is only used in <code class="docutils literal notranslate"><span class="pre">ensure</span></code> and <code class="docutils literal notranslate"><span class="pre">insert</span></code> modes. The <code class="docutils literal notranslate"><span class="pre">content</span></code> will be inserted directly after this line, unless <code class="docutils literal notranslate"><span class="pre">before</span></code> is also provided. If <code class="docutils literal notranslate"><span class="pre">before</span></code> is not matched, indentation will match this line, unless <code class="docutils literal notranslate"><span class="pre">indent=False</span></code>.</p> </dd> <dt>show_changes</dt>
<dd>
<p>Output a unified diff of the old file and the new file. If <code class="docutils literal notranslate"><span class="pre">False</span></code> return a boolean if any changes were made. Default is <code class="docutils literal notranslate"><span class="pre">True</span></code></p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>Using this option will store two copies of the file in-memory (the original version and the edited version) in order to generate the diff.</p> </div> </dd> <dt>backup</dt>
<dd>
<p>Create a backup of the original file with the extension: "Year-Month-Day-Hour-Minutes-Seconds".</p> </dd> <dt>quiet</dt>
<dd>
<p>Do not raise any exceptions. E.g. ignore the fact that the file that is tried to be edited does not exist and nothing really happened.</p> </dd> <dt>indent</dt>
<dd>
<p>Keep indentation with the previous line. This option is not considered when the <code class="docutils literal notranslate"><span class="pre">delete</span></code> mode is specified. Default is <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p> </dd> <dt>create</dt>
<dd>
<p>Create an empty file if doesn't exist.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2016.11.0.</span></p> </div> </dd> <dt>user</dt>
<dd>
<p>The user to own the file, this defaults to the user salt is running as on the minion.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2016.11.0.</span></p> </div> </dd> <dt>group</dt>
<dd>
<p>The group ownership set for the file, this defaults to the group salt is running as on the minion On Windows, this is ignored.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2016.11.0.</span></p> </div> </dd> <dt>file_mode</dt>
<dd>
<p>The permissions to set on this file, aka 644, 0775, 4664. Not supported on Windows.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2016.11.0.</span></p> </div> </dd> </dl> <p>If an equal sign (<code class="docutils literal notranslate"><span class="pre">=</span></code>) appears in an argument to a Salt command, it is interpreted as a keyword argument in the format of <code class="docutils literal notranslate"><span class="pre">key=val</span></code>. That processing can be bypassed in order to pass an equal sign through to the remote shell command by manually specifying the kwarg:</p> <pre class="highlight-yaml notranslate" data-language="yaml">update_config:
  file.line:
    - name: /etc/myconfig.conf
    - mode: ensure
    - content: my key = my value
    - before: somekey.*?</pre> <p><strong>Examples:</strong></p> <p>Here's a simple config file.</p> <pre class="highlight-ini notranslate" data-language="ini">[some_config]
# Some config file
# this line will go away

here=False
away=True
goodybe=away</pre> <p>And an sls file:</p> <pre class="highlight-yaml notranslate" data-language="yaml">remove_lines:
  file.line:
    - name: /some/file.conf
    - mode: delete
    - match: away</pre> <p>This will produce:</p> <pre class="highlight-ini notranslate" data-language="ini">[some_config]
# Some config file

here=False
away=True
goodbye=away</pre> <p>If that state is executed 2 more times, this will be the result:</p> <pre class="highlight-ini notranslate" data-language="ini">[some_config]
# Some config file

here=False</pre> <p>Given that original file with this state:</p> <pre class="highlight-yaml notranslate" data-language="yaml">replace_things:
  file.line:
    - name: /some/file.conf
    - mode: replace
    - match: away
    - content: here</pre> <p>Three passes will this state will result in this file:</p> <pre class="highlight-ini notranslate" data-language="ini">[some_config]
# Some config file
here

here=False
here
here</pre> <p>Each pass replacing the first line found.</p> <p>Given this file:</p> <pre class="highlight-text notranslate" data-language="text">insert after me
something
insert before me</pre> <p>The following state:</p> <pre class="highlight-yaml notranslate" data-language="yaml">insert_a_line:
  file.line:
    - name: /some/file.txt
    - mode: insert
    - after: insert after me
    - before: insert before me
    - content: thrice</pre> <p>If this state is executed 3 times, the result will be:</p> <pre class="highlight-text notranslate" data-language="text">insert after me
something
thrice
thrice
thrice
insert before me</pre> <p>If the mode is ensure instead, it will fail each time. To succeed, we need to remove the incorrect line between before and after:</p> <pre class="highlight-text notranslate" data-language="text">insert after me
insert before me</pre> <p>With an ensure mode, this will insert <code class="docutils literal notranslate"><span class="pre">thrice</span></code> the first time and make no changes for subsequent calls. For something simple this is fine, but if you have instead blocks like this:</p> <pre class="highlight-text notranslate" data-language="text">Begin SomeBlock
    foo = bar
End

Begin AnotherBlock
    another = value
End</pre> <p>And given this state:</p> <pre class="highlight-yaml notranslate" data-language="yaml">ensure_someblock:
  file.line:
    - name: /some/file.conf
    - mode: ensure
    - after: Begin SomeBlock
    - content: this = should be my content
    - before: End</pre> <p>This will fail because there are multiple <code class="docutils literal notranslate"><span class="pre">End</span></code> lines. Without that problem, it still would fail because there is a non-matching line, <code class="docutils literal notranslate"><span class="pre">foo</span> <span class="pre">=</span> <span class="pre">bar</span></code>. Ensure <strong>only</strong> allows either zero, or the matching line present to be present in between <code class="docutils literal notranslate"><span class="pre">before</span></code> and <code class="docutils literal notranslate"><span class="pre">after</span></code>.</p> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.file.managed"> salt.states.file.managed(name, source=None, source_hash='', source_hash_name=None, keep_source=True, user=None, group=None, mode=None, attrs=None, template=None, makedirs=False, dir_mode=None, context=None, replace=True, defaults=None, backup='', show_changes=True, create=True, contents=None, tmp_dir='', tmp_ext='', contents_pillar=None, contents_grains=None, contents_newline=True, contents_delimiter=':', encoding=None, encoding_errors='strict', allow_empty=True, follow_symlinks=True, check_cmd=None, skip_verify=False, selinux=None, win_owner=None, win_perms=None, win_deny_perms=None, win_inheritance=True, win_perms_reset=False, verify_ssl=True, **kwargs)</h3> <dd>
<p>Manage a given file, this function allows for a file to be downloaded from the salt master and potentially run through a templating system.</p> <dl> <dt>name</dt>
<dd>
<p>The location of the file to manage, as an absolute path.</p> </dd> <dt>source</dt>
<dd>
<p>The source file to download to the minion, this source file can be hosted on either the salt master server (<code class="docutils literal notranslate"><span class="pre">salt://</span></code>), the salt minion local file system (<code class="docutils literal notranslate"><span class="pre">/</span></code>), or on an HTTP or FTP server (<code class="docutils literal notranslate"><span class="pre">http(s)://</span></code>, <code class="docutils literal notranslate"><span class="pre">ftp://</span></code>).</p> <p>Both HTTPS and HTTP are supported as well as downloading directly from Amazon S3 compatible URLs with both pre-configured and automatic IAM credentials. (see s3.get state documentation) File retrieval from Openstack Swift object storage is supported via swift://container/object_path URLs, see swift.get documentation. For files hosted on the salt file server, if the file is located on the master in the directory named spam, and is called eggs, the source string is salt://spam/eggs. If source is left blank or None (use ~ in YAML), the file will be created as an empty file and the content will not be managed. This is also the case when a file already exists and the source is undefined; the contents of the file will not be changed or managed. If source is left blank or None, please also set replaced to False to make your intention explicit.</p> <p>If the file is hosted on a HTTP or FTP server then the source_hash argument is also required.</p> <p>A list of sources can also be passed in to provide a default source and a set of fallbacks. The first source in the list that is found to exist will be used and subsequent entries in the list will be ignored. Source list functionality only supports local files and remote files hosted on the salt master server or retrievable via HTTP, HTTPS, or FTP.</p> <pre class="highlight-yaml notranslate" data-language="yaml">file_override_example:
  file.managed:
    - source:
      - salt://file_that_does_not_exist
      - salt://file_that_exists</pre> </dd> <dt>source_hash</dt>
<dd>
<dl class="simple"> <dt>This can be one of the following:</dt>
<dd>
<ol class="arabic simple"> <li><p>a source hash string</p></li> <li><p>the URI of a file that contains source hash strings</p></li> </ol> </dd> </dl> <p>The function accepts the first encountered long unbroken alphanumeric string of correct length as a valid hash, in order from most secure to least secure:</p> <pre class="highlight-text notranslate" data-language="text">Type    Length
======  ======
sha512     128
sha384      96
sha256      64
sha224      56
sha1        40
md5         32</pre> <dl> <dt><strong>Using a Source Hash File</strong></dt>
<dd>
<p>The file can contain several checksums for several files. Each line must contain both the file name and the hash. If no file name is matched, the first hash encountered will be used, otherwise the most secure hash with the correct source file name will be used.</p> <p>When using a source hash file the source_hash argument needs to be a url, the standard download urls are supported, ftp, http, salt etc:</p> <p>Example:</p> <pre class="highlight-yaml notranslate" data-language="yaml">tomdroid-src-0.7.3.tar.gz:
  file.managed:
    - name: /tmp/tomdroid-src-0.7.3.tar.gz
    - source: https://launchpad.net/tomdroid/beta/0.7.3/+download/tomdroid-src-0.7.3.tar.gz
    - source_hash: https://launchpad.net/tomdroid/beta/0.7.3/+download/tomdroid-src-0.7.3.hash</pre> <p>The following lines are all supported formats:</p> <pre class="highlight-text notranslate" data-language="text">/etc/rc.conf ef6e82e4006dee563d98ada2a2a80a27
sha254c8525aee419eb649f0233be91c151178b30f0dff8ebbdcc8de71b1d5c8bcc06a  /etc/resolv.conf
ead48423703509d37c4a90e6a0d53e143b6fc268</pre> <p>Debian file type <code class="docutils literal notranslate"><span class="pre">*.dsc</span></code> files are also supported.</p> </dd> </dl> <p><strong>Inserting the Source Hash in the SLS Data</strong></p> <p>The source_hash can be specified as a simple checksum, like so:</p> <pre class="highlight-yaml notranslate" data-language="yaml">tomdroid-src-0.7.3.tar.gz:
  file.managed:
    - name: /tmp/tomdroid-src-0.7.3.tar.gz
    - source: https://launchpad.net/tomdroid/beta/0.7.3/+download/tomdroid-src-0.7.3.tar.gz
    - source_hash: 79eef25f9b0b2c642c62b7f737d4f53f</pre> <div class="admonition note"> <p class="admonition-title">Note</p> <p>Releases prior to 2016.11.0 must also include the hash type, like in the below example:</p> <pre class="highlight-yaml notranslate" data-language="yaml">tomdroid-src-0.7.3.tar.gz:
  file.managed:
    - name: /tmp/tomdroid-src-0.7.3.tar.gz
    - source: https://launchpad.net/tomdroid/beta/0.7.3/+download/tomdroid-src-0.7.3.tar.gz
    - source_hash: md5=79eef25f9b0b2c642c62b7f737d4f53f</pre> </div> <dl> <dt>Known issues:</dt>
<dd>
<p>If the remote server URL has the hash file as an apparent sub-directory of the source file, the module will discover that it has already cached a directory where a file should be cached. For example:</p> <pre class="highlight-yaml notranslate" data-language="yaml">tomdroid-src-0.7.3.tar.gz:
  file.managed:
    - name: /tmp/tomdroid-src-0.7.3.tar.gz
    - source: https://launchpad.net/tomdroid/beta/0.7.3/+download/tomdroid-src-0.7.3.tar.gz
    - source_hash: https://launchpad.net/tomdroid/beta/0.7.3/+download/tomdroid-src-0.7.3.tar.gz/+md5</pre> </dd> </dl> </dd> <dt>source_hash_name</dt>
<dd>
<p>When <code class="docutils literal notranslate"><span class="pre">source_hash</span></code> refers to a hash file, Salt will try to find the correct hash by matching the filename/URI associated with that hash. By default, Salt will look for the filename being managed. When managing a file at path <code class="docutils literal notranslate"><span class="pre">/tmp/foo.txt</span></code>, then the following line in a hash file would match:</p> <pre class="highlight-text notranslate" data-language="text">acbd18db4cc2f85cedef654fccc4a4d8    foo.txt</pre> <p>However, sometimes a hash file will include multiple similar paths:</p> <pre class="highlight-text notranslate" data-language="text">37b51d194a7513e45b56f6524f2d51f2    ./dir1/foo.txt
acbd18db4cc2f85cedef654fccc4a4d8    ./dir2/foo.txt
73feffa4b7f6bb68e44cf984c85f6e88    ./dir3/foo.txt</pre> <p>In cases like this, Salt may match the incorrect hash. This argument can be used to tell Salt which filename to match, to ensure that the correct hash is identified. For example:</p> <pre class="highlight-yaml notranslate" data-language="yaml">/tmp/foo.txt:
  file.managed:
    - source: https://mydomain.tld/dir2/foo.txt
    - source_hash: https://mydomain.tld/hashes
    - source_hash_name: ./dir2/foo.txt</pre> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This argument must contain the full filename entry from the checksum file, as this argument is meant to disambiguate matches for multiple files that have the same basename. So, in the example above, simply using <code class="docutils literal notranslate"><span class="pre">foo.txt</span></code> would not match.</p> </div> <div class="versionadded"> <p><span class="versionmodified added">New in version 2016.3.5.</span></p> </div> </dd> <dt>keep_source<span class="classifier">True</span>
</dt>
<dd>
<p>Set to <code class="docutils literal notranslate"><span class="pre">False</span></code> to discard the cached copy of the source file once the state completes. This can be useful for larger files to keep them from taking up space in minion cache. However, keep in mind that discarding the source file will result in the state needing to re-download the source file if the state is run again.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2017.7.3.</span></p> </div> </dd> <dt>user</dt>
<dd>
<p>The user to own the file, this defaults to the user salt is running as on the minion</p> </dd> <dt>group</dt>
<dd>
<p>The group ownership set for the file, this defaults to the group salt is running as on the minion. On Windows, this is ignored</p> </dd> <dt>mode</dt>
<dd>
<p>The permissions to set on this file, e.g. <code class="docutils literal notranslate"><span class="pre">644</span></code>, <code class="docutils literal notranslate"><span class="pre">0775</span></code>, or <code class="docutils literal notranslate"><span class="pre">4664</span></code>.</p> <p>The default mode for new files and directories corresponds to the umask of the salt process. The mode of existing files and directories will only be changed if <code class="docutils literal notranslate"><span class="pre">mode</span></code> is specified.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This option is <strong>not</strong> supported on Windows.</p> </div> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 2016.11.0: </span>This option can be set to <code class="docutils literal notranslate"><span class="pre">keep</span></code>, and Salt will keep the mode from the Salt fileserver. This is only supported when the <code class="docutils literal notranslate"><span class="pre">source</span></code> URL begins with <code class="docutils literal notranslate"><span class="pre">salt://</span></code>, or for files local to the minion. Because the <code class="docutils literal notranslate"><span class="pre">source</span></code> option cannot be used with any of the <code class="docutils literal notranslate"><span class="pre">contents</span></code> options, setting the <code class="docutils literal notranslate"><span class="pre">mode</span></code> to <code class="docutils literal notranslate"><span class="pre">keep</span></code> is also incompatible with the <code class="docutils literal notranslate"><span class="pre">contents</span></code> options.</p> </div> <div class="admonition note"> <p class="admonition-title">Note</p> <p>keep does not work with salt-ssh.</p> <p>As a consequence of how the files are transferred to the minion, and the inability to connect back to the master with salt-ssh, salt is unable to stat the file as it exists on the fileserver and thus cannot mirror the mode on the salt-ssh minion</p> </div> </dd> <dt>attrs</dt>
<dd>
<p>The attributes to have on this file, e.g. <code class="docutils literal notranslate"><span class="pre">a</span></code>, <code class="docutils literal notranslate"><span class="pre">i</span></code>. The attributes can be any or a combination of the following characters: <code class="docutils literal notranslate"><span class="pre">aAcCdDeijPsStTu</span></code>.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This option is <strong>not</strong> supported on Windows.</p> </div> <div class="versionadded"> <p><span class="versionmodified added">New in version 2018.3.0.</span></p> </div> </dd> <dt>template</dt>
<dd>
<p>If this setting is applied, the named templating engine will be used to render the downloaded file. The following templates are supported:</p> <ul class="simple"> <li><p><a class="reference internal" href="../../renderers/all/salt.renderers.cheetah.html#module-salt.renderers.cheetah" title="salt.renderers.cheetah"><code class="xref py py-mod docutils literal notranslate"><span class="pre">cheetah</span></code></a></p></li> <li><p><a class="reference internal" href="../../renderers/all/salt.renderers.genshi.html#module-salt.renderers.genshi" title="salt.renderers.genshi"><code class="xref py py-mod docutils literal notranslate"><span class="pre">genshi</span></code></a></p></li> <li><p><a class="reference internal" href="../../renderers/all/salt.renderers.jinja.html#module-salt.renderers.jinja" title="salt.renderers.jinja"><code class="xref py py-mod docutils literal notranslate"><span class="pre">jinja</span></code></a></p></li> <li><p><a class="reference internal" href="../../renderers/all/salt.renderers.mako.html#module-salt.renderers.mako" title="salt.renderers.mako"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mako</span></code></a></p></li> <li><p><a class="reference internal" href="../../renderers/all/salt.renderers.py.html#module-salt.renderers.py" title="salt.renderers.py"><code class="xref py py-mod docutils literal notranslate"><span class="pre">py</span></code></a></p></li> <li><p><a class="reference internal" href="../../renderers/all/salt.renderers.wempy.html#module-salt.renderers.wempy" title="salt.renderers.wempy"><code class="xref py py-mod docutils literal notranslate"><span class="pre">wempy</span></code></a></p></li> </ul> </dd> <dt>makedirs<span class="classifier">False</span>
</dt>
<dd>
<p>If set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, then the parent directories will be created to facilitate the creation of the named file. If <code class="docutils literal notranslate"><span class="pre">False</span></code>, and the parent directory of the destination file doesn't exist, the state will fail.</p> </dd> <dt>dir_mode</dt>
<dd>
<p>If directories are to be created, passing this option specifies the permissions for those directories. If this is not set, directories will be assigned permissions by adding the execute bit to the mode of the files.</p> <p>The default mode for new files and directories corresponds umask of salt process. For existing files and directories it's not enforced.</p> </dd> <dt>replace<span class="classifier">True</span>
</dt>
<dd>
<p>If set to <code class="docutils literal notranslate"><span class="pre">False</span></code> and the file already exists, the file will not be modified even if changes would otherwise be made. Permissions and ownership will still be enforced, however.</p> </dd> <dt>context</dt>
<dd>
<p>Overrides default context variables passed to the template.</p> </dd> <dt>defaults</dt>
<dd>
<p>Default context passed to the template.</p> </dd> <dt>backup</dt>
<dd>
<p>Overrides the default backup mode for this specific file. See <a class="reference internal" href="https://docs.saltproject.io/en/latest/ref/states/backup_mode.html#file-state-backups"><span class="std std-ref">backup_mode documentation</span></a> for more details.</p> </dd> <dt>show_changes</dt>
<dd>
<p>Output a unified diff of the old file and the new file. If <code class="docutils literal notranslate"><span class="pre">False</span></code> return a boolean if any changes were made.</p> </dd> <dt>create<span class="classifier">True</span>
</dt>
<dd>
<p>If set to <code class="docutils literal notranslate"><span class="pre">False</span></code>, then the file will only be managed if the file already exists on the system.</p> </dd> <dt>contents</dt>
<dd>
<p>Specify the contents of the file. Cannot be used in combination with <code class="docutils literal notranslate"><span class="pre">source</span></code>. Ignores hashes and does not use a templating engine.</p> <p>This value can be either a single string, a multiline YAML string or a list of strings. If a list of strings, then the strings will be joined together with newlines in the resulting file. For example, the below two example states would result in identical file contents:</p> <pre class="highlight-yaml notranslate" data-language="yaml">/path/to/file1:
  file.managed:
    - contents:
      - This is line 1
      - This is line 2

/path/to/file2:
  file.managed:
    - contents: |
        This is line 1
        This is line 2</pre> </dd> <dt>contents_pillar</dt>
<dd>
<div class="versionadded"> <p><span class="versionmodified added">New in version 0.17.0.</span></p> </div> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 2016.11.0: </span>contents_pillar can also be a list, and the pillars will be concatenated together to form one file.</p> </div> <p>Operates like <code class="docutils literal notranslate"><span class="pre">contents</span></code>, but draws from a value stored in pillar, using the pillar path syntax used in <a class="reference internal" href="../../modules/all/salt.modules.pillar.html#salt.modules.pillar.get" title="salt.modules.pillar.get"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pillar.get</span></code></a>. This is useful when the pillar value contains newlines, as referencing a pillar variable using a jinja/mako template can result in YAML formatting issues due to the newlines causing indentation mismatches.</p> <p>For example, the following could be used to deploy an SSH private key:</p> <pre class="highlight-yaml notranslate" data-language="yaml">/home/deployer/.ssh/id_rsa:
  file.managed:
    - user: deployer
    - group: deployer
    - mode: 600
    - attrs: a
    - contents_pillar: userdata:deployer:id_rsa</pre> <p>This would populate <code class="docutils literal notranslate"><span class="pre">/home/deployer/.ssh/id_rsa</span></code> with the contents of <code class="docutils literal notranslate"><span class="pre">pillar['userdata']['deployer']['id_rsa']</span></code>. An example of this pillar setup would be like so:</p> <pre class="highlight-yaml notranslate" data-language="yaml">userdata:
  deployer:
    id_rsa: |
        -----BEGIN RSA PRIVATE KEY-----
        MIIEowIBAAKCAQEAoQiwO3JhBquPAalQF9qP1lLZNXVjYMIswrMe2HcWUVBgh+vY
        U7sCwx/dH6+VvNwmCoqmNnP+8gTPKGl1vgAObJAnMT623dMXjVKwnEagZPRJIxDy
        B/HaAre9euNiY3LvIzBTWRSeMfT+rWvIKVBpvwlgGrfgz70m0pqxu+UyFbAGLin+
        GpxzZAMaFpZw4sSbIlRuissXZj/sHpQb8p9M5IeO4Z3rjkCP1cxI
        -----END RSA PRIVATE KEY-----</pre> <div class="admonition note"> <p class="admonition-title">Note</p> <p>The private key above is shortened to keep the example brief, but shows how to do multiline string in YAML. The key is followed by a pipe character, and the multiline string is indented two more spaces.</p> <p>To avoid the hassle of creating an indented multiline YAML string, the <a class="reference internal" href="../../pillar/all/salt.pillar.file_tree.html#module-salt.pillar.file_tree" title="salt.pillar.file_tree"><code class="xref py py-mod docutils literal notranslate"><span class="pre">file_tree</span> <span class="pre">external</span> <span class="pre">pillar</span></code></a> can be used instead. However, this will not work for binary files in Salt releases before 2015.8.4.</p> </div> </dd> <dt>contents_grains</dt>
<dd>
<div class="versionadded"> <p><span class="versionmodified added">New in version 2014.7.0.</span></p> </div> <p>Operates like <code class="docutils literal notranslate"><span class="pre">contents</span></code>, but draws from a value stored in grains, using the grains path syntax used in <a class="reference internal" href="../../modules/all/salt.modules.grains.html#salt.modules.grains.get" title="salt.modules.grains.get"><code class="xref py py-mod docutils literal notranslate"><span class="pre">grains.get</span></code></a>. This functionality works similarly to <code class="docutils literal notranslate"><span class="pre">contents_pillar</span></code>, but with grains.</p> <p>For example, the following could be used to deploy a "message of the day" file:</p> <pre class="highlight-yaml notranslate" data-language="yaml">write_motd:
  file.managed:
    - name: /etc/motd
    - contents_grains: motd</pre> <p>This would populate <code class="docutils literal notranslate"><span class="pre">/etc/motd</span></code> file with the contents of the <code class="docutils literal notranslate"><span class="pre">motd</span></code> grain. The <code class="docutils literal notranslate"><span class="pre">motd</span></code> grain is not a default grain, and would need to be set prior to running the state:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' grains.set motd 'Welcome! This system is managed by Salt.'</pre> </dd> <dt>contents_newline<span class="classifier">True</span>
</dt>
<dd>
<div class="versionadded"> <p><span class="versionmodified added">New in version 2014.7.0.</span></p> </div> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 2015.8.4: </span>This option is now ignored if the contents being deployed contain binary data.</p> </div> <p>If <code class="docutils literal notranslate"><span class="pre">True</span></code>, files managed using <code class="docutils literal notranslate"><span class="pre">contents</span></code>, <code class="docutils literal notranslate"><span class="pre">contents_pillar</span></code>, or <code class="docutils literal notranslate"><span class="pre">contents_grains</span></code> will have a newline added to the end of the file if one is not present. Setting this option to <code class="docutils literal notranslate"><span class="pre">False</span></code> will ensure the final line, or entry, does not contain a new line. If the last line, or entry in the file does contain a new line already, this option will not remove it.</p> </dd> <dt>contents_delimiter</dt>
<dd>
<div class="versionadded"> <p><span class="versionmodified added">New in version 2015.8.4.</span></p> </div> <p>Can be used to specify an alternate delimiter for <code class="docutils literal notranslate"><span class="pre">contents_pillar</span></code> or <code class="docutils literal notranslate"><span class="pre">contents_grains</span></code>. This delimiter will be passed through to <a class="reference internal" href="../../modules/all/salt.modules.pillar.html#salt.modules.pillar.get" title="salt.modules.pillar.get"><code class="xref py py-func docutils literal notranslate"><span class="pre">pillar.get</span></code></a> or <a class="reference internal" href="../../modules/all/salt.modules.grains.html#salt.modules.grains.get" title="salt.modules.grains.get"><code class="xref py py-func docutils literal notranslate"><span class="pre">grains.get</span></code></a> when retrieving the contents.</p> </dd> <dt>encoding</dt>
<dd>
<p>If specified, then the specified encoding will be used. Otherwise, the file will be encoded using the system locale (usually UTF-8). See <a class="reference external" href="https://docs.python.org/3/library/codecs.html#standard-encodings">https://docs.python.org/3/library/codecs.html#standard-encodings</a> for the list of available encodings.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2017.7.0.</span></p> </div> </dd> <dt>encoding_errors<span class="classifier">'strict'</span>
</dt>
<dd>
<p>Error encoding scheme. Default is <code class="docutils literal notranslate"><span class="pre">`'strict'`</span></code>. See <a class="reference external" href="https://docs.python.org/2/library/codecs.html#codec-base-classes">https://docs.python.org/2/library/codecs.html#codec-base-classes</a> for the list of available schemes.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2017.7.0.</span></p> </div> </dd> <dt>allow_empty<span class="classifier">True</span>
</dt>
<dd>
<div class="versionadded"> <p><span class="versionmodified added">New in version 2015.8.4.</span></p> </div> <p>If set to <code class="docutils literal notranslate"><span class="pre">False</span></code>, then the state will fail if the contents specified by <code class="docutils literal notranslate"><span class="pre">contents_pillar</span></code> or <code class="docutils literal notranslate"><span class="pre">contents_grains</span></code> are empty.</p> </dd> <dt>follow_symlinks<span class="classifier">True</span>
</dt>
<dd>
<div class="versionadded"> <p><span class="versionmodified added">New in version 2014.7.0.</span></p> </div> <p>If the desired path is a symlink follow it and make changes to the file to which the symlink points.</p> </dd> <dt>check_cmd</dt>
<dd>
<div class="versionadded"> <p><span class="versionmodified added">New in version 2014.7.0.</span></p> </div> <p>The specified command will be run with an appended argument of a <em>temporary</em> file containing the new managed contents. If the command exits with a zero status the new managed contents will be written to the managed destination. If the command exits with a nonzero exit code, the state will fail and no changes will be made to the file.</p> <p>For example, the following could be used to verify sudoers before making changes:</p> <pre class="highlight-yaml notranslate" data-language="yaml">/etc/sudoers:
  file.managed:
    - user: root
    - group: root
    - mode: 0440
    - attrs: i
    - source: salt://sudoers/files/sudoers.jinja
    - template: jinja
    - check_cmd: /usr/sbin/visudo -c -f</pre> <p><strong>NOTE</strong>: This <code class="docutils literal notranslate"><span class="pre">check_cmd</span></code> functions differently than the requisite <code class="docutils literal notranslate"><span class="pre">check_cmd</span></code>.</p> </dd> <dt>tmp_dir</dt>
<dd>
<p>Directory for temp file created by <code class="docutils literal notranslate"><span class="pre">check_cmd</span></code>. Useful for checkers dependent on config file location (e.g. daemons restricted to their own config directories by an apparmor profile).</p> <pre class="highlight-yaml notranslate" data-language="yaml">/etc/dhcp/dhcpd.conf:
  file.managed:
    - user: root
    - group: root
    - mode: 0755
    - tmp_dir: '/etc/dhcp'
    - contents: "# Managed by Salt"
    - check_cmd: dhcpd -t -cf</pre> </dd> <dt>tmp_ext</dt>
<dd>
<p>Suffix for temp file created by <code class="docutils literal notranslate"><span class="pre">check_cmd</span></code>. Useful for checkers dependent on config file extension (e.g. the init-checkconf upstart config checker).</p> <pre class="highlight-yaml notranslate" data-language="yaml">/etc/init/test.conf:
  file.managed:
    - user: root
    - group: root
    - mode: 0440
    - tmp_ext: '.conf'
    - contents:
      - 'description "Salt Minion"'
      - 'start on started mountall'
      - 'stop on shutdown'
      - 'respawn'
      - 'exec salt-minion'
    - check_cmd: init-checkconf -f</pre> </dd> <dt>skip_verify<span class="classifier">False</span>
</dt>
<dd>
<p>If <code class="docutils literal notranslate"><span class="pre">True</span></code>, hash verification of remote file sources (<code class="docutils literal notranslate"><span class="pre">http://</span></code>, <code class="docutils literal notranslate"><span class="pre">https://</span></code>, <code class="docutils literal notranslate"><span class="pre">ftp://</span></code>) will be skipped, and the <code class="docutils literal notranslate"><span class="pre">source_hash</span></code> argument will be ignored.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2016.3.0.</span></p> </div> </dd> <dt>selinux<span class="classifier">None</span>
</dt>
<dd>
<p>Allows setting the selinux user, role, type, and range of a managed file</p> <pre class="highlight-yaml notranslate" data-language="yaml">/tmp/selinux.test
  file.managed:
    - user: root
    - selinux:
        seuser: system_u
        serole: object_r
        setype: system_conf_t
        seranage: s0</pre> <div class="versionadded"> <p><span class="versionmodified added">New in version 3000.</span></p> </div> </dd> <dt>win_owner<span class="classifier">None</span>
</dt>
<dd>
<p>The owner of the directory. If this is not passed, user will be used. If user is not passed, the account under which Salt is running will be used.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2017.7.0.</span></p> </div> </dd> <dt>win_perms<span class="classifier">None</span>
</dt>
<dd>
<p>A dictionary containing permissions to grant and their propagation. For example: <code class="docutils literal notranslate"><span class="pre">{'Administrators':</span> <span class="pre">{'perms':</span> <span class="pre">'full_control'}}</span></code> Can be a single basic perm or a list of advanced perms. <code class="docutils literal notranslate"><span class="pre">perms</span></code> must be specified. <code class="docutils literal notranslate"><span class="pre">applies_to</span></code> does not apply to file objects.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2017.7.0.</span></p> </div> </dd> <dt>win_deny_perms<span class="classifier">None</span>
</dt>
<dd>
<p>A dictionary containing permissions to deny and their propagation. For example: <code class="docutils literal notranslate"><span class="pre">{'Administrators':</span> <span class="pre">{'perms':</span> <span class="pre">'full_control'}}</span></code> Can be a single basic perm or a list of advanced perms. <code class="docutils literal notranslate"><span class="pre">perms</span></code> must be specified. <code class="docutils literal notranslate"><span class="pre">applies_to</span></code> does not apply to file objects.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2017.7.0.</span></p> </div> </dd> <dt>win_inheritance<span class="classifier">True</span>
</dt>
<dd>
<p>True to inherit permissions from the parent directory, False not to inherit permission.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2017.7.0.</span></p> </div> </dd> <dt>win_perms_reset<span class="classifier">False</span>
</dt>
<dd>
<p>If <code class="docutils literal notranslate"><span class="pre">True</span></code> the existing DACL will be cleared and replaced with the settings defined in this function. If <code class="docutils literal notranslate"><span class="pre">False</span></code>, new entries will be appended to the existing DACL. Default is <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2018.3.0.</span></p> </div> </dd> </dl> <p>Here's an example using the above <code class="docutils literal notranslate"><span class="pre">win_*</span></code> parameters:</p> <pre class="highlight-yaml notranslate" data-language="yaml">create_config_file:
  file.managed:
    - name: C:\config\settings.cfg
    - source: salt://settings.cfg
    - win_owner: Administrators
    - win_perms:
        # Basic Permissions
        dev_ops:
          perms: full_control
        # List of advanced permissions
        appuser:
          perms:
            - read_attributes
            - read_ea
            - create_folders
            - read_permissions
        joe_snuffy:
          perms: read
    - win_deny_perms:
        fred_snuffy:
          perms: full_control
    - win_inheritance: False</pre> <dl> <dt>verify_ssl</dt>
<dd>
<p>If <code class="docutils literal notranslate"><span class="pre">False</span></code>, remote https file sources (<code class="docutils literal notranslate"><span class="pre">https://</span></code>) and source_hash will not attempt to validate the servers certificate. Default is True.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 3002.</span></p> </div> </dd> </dl> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.file.missing"> salt.states.file.missing(name, **kwargs)</h3> <dd>
<p>Verify that the named file or directory is missing, this returns True only if the named file is missing but does not remove the file if it is present.</p> <dl class="simple"> <dt>name</dt>
<dd>
<p>Absolute path which must NOT exist</p> </dd> </dl> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.file.mknod"> salt.states.file.mknod(name, ntype, major=0, minor=0, user=None, group=None, mode='0600')</h3> <dd>
<p>Create a special file similar to the 'nix mknod command. The supported device types are <code class="docutils literal notranslate"><span class="pre">p</span></code> (fifo pipe), <code class="docutils literal notranslate"><span class="pre">c</span></code> (character device), and <code class="docutils literal notranslate"><span class="pre">b</span></code> (block device). Provide the major and minor numbers when specifying a character device or block device. A fifo pipe does not require this information. The command will create the necessary dirs if needed. If a file of the same name not of the same type/major/minor exists, it will not be overwritten or unlinked (deleted). This is logically in place as a safety measure because you can really shoot yourself in the foot here and it is the behavior of 'nix <code class="docutils literal notranslate"><span class="pre">mknod</span></code>. It is also important to note that not just anyone can create special devices. Usually this is only done as root. If the state is executed as none other than root on a minion, you may receive a permission error.</p> <dl class="simple"> <dt>name</dt>
<dd>
<p>name of the file</p> </dd> <dt>ntype</dt>
<dd>
<p>node type 'p' (fifo pipe), 'c' (character device), or 'b' (block device)</p> </dd> <dt>major</dt>
<dd>
<p>major number of the device does not apply to a fifo pipe</p> </dd> <dt>minor</dt>
<dd>
<p>minor number of the device does not apply to a fifo pipe</p> </dd> <dt>user</dt>
<dd>
<p>owning user of the device/pipe</p> </dd> <dt>group</dt>
<dd>
<p>owning group of the device/pipe</p> </dd> <dt>mode</dt>
<dd>
<p>permissions on the device/pipe</p> </dd> </dl> <p>Usage:</p> <pre class="highlight-yaml notranslate" data-language="yaml">/dev/chr:
  file.mknod:
    - ntype: c
    - major: 180
    - minor: 31
    - user: root
    - group: root
    - mode: 660

/dev/blk:
  file.mknod:
    - ntype: b
    - major: 8
    - minor: 999
    - user: root
    - group: root
    - mode: 660

/dev/fifo:
  file.mknod:
    - ntype: p
    - user: root
    - group: root
    - mode: 660</pre> <div class="versionadded"> <p><span class="versionmodified added">New in version 0.17.0.</span></p> </div> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.file.mod_beacon"> salt.states.file.mod_beacon(name, **kwargs)</h3> <dd>
<p>Create a beacon to monitor a file based on a beacon state argument.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This state exists to support special handling of the <code class="docutils literal notranslate"><span class="pre">beacon</span></code> state argument for supported state functions. It should not be called directly.</p> </div> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.file.mod_run_check_cmd"> salt.states.file.mod_run_check_cmd(cmd, filename, **check_cmd_opts)</h3> <dd>
<p>Execute the check_cmd logic.</p> <p>Return a result dict if <code class="docutils literal notranslate"><span class="pre">check_cmd</span></code> succeeds (check_cmd == 0) otherwise return True</p> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.file.not_cached"> salt.states.file.not_cached(name, saltenv='base')</h3> <dd>
<div class="versionadded"> <p><span class="versionmodified added">New in version 2017.7.3.</span></p> </div> <p>Ensures that a file is not present in the minion's cache, deleting it if found. This state is primarily invoked by other states to ensure that a fresh copy is fetched.</p> <dl> <dt>name</dt>
<dd>
<p>The URL of the file to be removed from cache. To remove a file from cache in an environment other than <code class="docutils literal notranslate"><span class="pre">base</span></code>, either use the <code class="docutils literal notranslate"><span class="pre">saltenv</span></code> argument or include the saltenv in the URL (e.g. <code class="docutils literal notranslate"><span class="pre">salt://path/to/file.conf?saltenv=dev</span></code>).</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>A list of URLs is not supported, this must be a single URL. If a local file is passed here, the state will take no action.</p> </div> </dd> <dt>saltenv</dt>
<dd>
<p>Used to specify the environment from which to download a file from the Salt fileserver (i.e. those with <code class="docutils literal notranslate"><span class="pre">salt://</span></code> URL).</p> </dd> </dl> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.file.patch"> salt.states.file.patch(name, source=None, source_hash=None, source_hash_name=None, skip_verify=False, template=None, context=None, defaults=None, options='', reject_file=None, strip=None, saltenv=None, **kwargs)</h3> <dd>
<p>Ensure that a patch has been applied to the specified file or directory</p> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 2019.2.0: </span>The <code class="docutils literal notranslate"><span class="pre">hash</span></code> and <code class="docutils literal notranslate"><span class="pre">dry_run_first</span></code> options are now ignored, as the logic which determines whether or not the patch has already been applied no longer requires them. Additionally, this state now supports patch files that modify more than one file. To use these sort of patches, specify a directory (and, if necessary, the <code class="docutils literal notranslate"><span class="pre">strip</span></code> option) instead of a file.</p> </div> <div class="admonition note"> <p class="admonition-title">Note</p> <p>A suitable <code class="docutils literal notranslate"><span class="pre">patch</span></code> executable must be available on the minion. Also, keep in mind that the pre-check this state does to determine whether or not changes need to be made will create a temp file and send all patch output to that file. This means that, in the event that the patch would not have applied cleanly, the comment included in the state results will reference a temp file that will no longer exist once the state finishes running.</p> </div> <dl> <dt>name</dt>
<dd>
<p>The file or directory to which the patch should be applied</p> </dd> <dt>source</dt>
<dd>
<p>The patch file to apply</p> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 2019.2.0: </span>The source can now be from any file source supported by Salt (<code class="docutils literal notranslate"><span class="pre">salt://</span></code>, <code class="docutils literal notranslate"><span class="pre">http://</span></code>, <code class="docutils literal notranslate"><span class="pre">https://</span></code>, <code class="docutils literal notranslate"><span class="pre">ftp://</span></code>, etc.). Templating is also now supported.</p> </div> </dd> <dt>source_hash</dt>
<dd>
<p>Works the same way as in <a class="reference internal" href="#salt.states.file.managed" title="salt.states.file.managed"><code class="xref py py-func docutils literal notranslate"><span class="pre">file.managed</span></code></a>.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </dd> <dt>source_hash_name</dt>
<dd>
<p>Works the same way as in <a class="reference internal" href="#salt.states.file.managed" title="salt.states.file.managed"><code class="xref py py-func docutils literal notranslate"><span class="pre">file.managed</span></code></a></p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </dd> <dt>skip_verify</dt>
<dd>
<p>Works the same way as in <a class="reference internal" href="#salt.states.file.managed" title="salt.states.file.managed"><code class="xref py py-func docutils literal notranslate"><span class="pre">file.managed</span></code></a></p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </dd> <dt>template</dt>
<dd>
<p>Works the same way as in <a class="reference internal" href="#salt.states.file.managed" title="salt.states.file.managed"><code class="xref py py-func docutils literal notranslate"><span class="pre">file.managed</span></code></a></p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </dd> <dt>context</dt>
<dd>
<p>Works the same way as in <a class="reference internal" href="#salt.states.file.managed" title="salt.states.file.managed"><code class="xref py py-func docutils literal notranslate"><span class="pre">file.managed</span></code></a></p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </dd> <dt>defaults</dt>
<dd>
<p>Works the same way as in <a class="reference internal" href="#salt.states.file.managed" title="salt.states.file.managed"><code class="xref py py-func docutils literal notranslate"><span class="pre">file.managed</span></code></a></p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </dd> <dt>options</dt>
<dd>
<p>Extra options to pass to patch. This should not be necessary in most cases.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>For best results, short opts should be separate from one another. The <code class="docutils literal notranslate"><span class="pre">-N</span></code> and <code class="docutils literal notranslate"><span class="pre">-r</span></code>, and <code class="docutils literal notranslate"><span class="pre">-o</span></code> options are used internally by this state and cannot be used here. Additionally, instead of using <code class="docutils literal notranslate"><span class="pre">-pN</span></code> or <code class="docutils literal notranslate"><span class="pre">--strip=N</span></code>, use the <code class="docutils literal notranslate"><span class="pre">strip</span></code> option documented below.</p> </div> </dd> <dt>reject_file</dt>
<dd>
<p>If specified, any rejected hunks will be written to this file. If not specified, then they will be written to a temp file which will be deleted when the state finishes running.</p> <div class="admonition important"> <p class="admonition-title">Important</p> <p>The parent directory must exist. Also, this will overwrite the file if it is already present.</p> </div> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </dd> <dt>strip</dt>
<dd>
<p>Number of directories to strip from paths in the patch file. For example, using the below SLS would instruct Salt to use <code class="docutils literal notranslate"><span class="pre">-p1</span></code> when applying the patch:</p> <pre class="highlight-yaml notranslate" data-language="yaml">/etc/myfile.conf:
  file.patch:
    - source: salt://myfile.patch
    - strip: 1</pre> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0: </span>In previous versions, <code class="docutils literal notranslate"><span class="pre">-p1</span></code> would need to be passed as part of the <code class="docutils literal notranslate"><span class="pre">options</span></code> value.</p> </div> </dd> <dt>saltenv</dt>
<dd>
<p>Specify the environment from which to retrieve the patch file indicated by the <code class="docutils literal notranslate"><span class="pre">source</span></code> parameter. If not provided, this defaults to the environment from which the state is being executed.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>Ignored when the patch file is from a non-<code class="docutils literal notranslate"><span class="pre">salt://</span></code> source.</p> </div> </dd> </dl> <p><strong>Usage:</strong></p> <pre class="highlight-yaml notranslate" data-language="yaml"># Equivalent to ``patch --forward /opt/myfile.txt myfile.patch``
/opt/myfile.txt:
  file.patch:
    - source: salt://myfile.patch</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.file.prepend"> salt.states.file.prepend(name, text=None, makedirs=False, source=None, source_hash=None, template='jinja', sources=None, source_hashes=None, defaults=None, context=None, header=None)</h3> <dd>
<p>Ensure that some text appears at the beginning of a file</p> <p>The text will not be prepended again if it already exists in the file. You may specify a single line of text or a list of lines to append.</p> <dl> <dt>name</dt>
<dd>
<p>The location of the file to append to.</p> </dd> <dt>text</dt>
<dd>
<p>The text to be appended, which can be a single string or a list of strings.</p> </dd> <dt>makedirs</dt>
<dd>
<p>If the file is located in a path without a parent directory, then the state will fail. If makedirs is set to True, then the parent directories will be created to facilitate the creation of the named file. Defaults to False.</p> </dd> <dt>source</dt>
<dd>
<p>A single source file to append. This source file can be hosted on either the salt master server, or on an HTTP or FTP server. Both HTTPS and HTTP are supported as well as downloading directly from Amazon S3 compatible URLs with both pre-configured and automatic IAM credentials (see s3.get state documentation). File retrieval from Openstack Swift object storage is supported via swift://container/object_path URLs (see swift.get documentation).</p> <p>For files hosted on the salt file server, if the file is located on the master in the directory named spam, and is called eggs, the source string is salt://spam/eggs.</p> <p>If the file is hosted on an HTTP or FTP server, the source_hash argument is also required.</p> </dd> <dt>source_hash</dt>
<dd>
<dl class="simple"> <dt>This can be one of the following:</dt>
<dd>
<ol class="arabic simple"> <li><p>a source hash string</p></li> <li><p>the URI of a file that contains source hash strings</p></li> </ol> </dd> </dl> <p>The function accepts the first encountered long unbroken alphanumeric string of correct length as a valid hash, in order from most secure to least secure:</p> <pre class="highlight-text notranslate" data-language="text">Type    Length
======  ======
sha512     128
sha384      96
sha256      64
sha224      56
sha1        40
md5         32</pre> <p>See the <code class="docutils literal notranslate"><span class="pre">source_hash</span></code> parameter description for <a class="reference internal" href="#salt.states.file.managed" title="salt.states.file.managed"><code class="xref py py-mod docutils literal notranslate"><span class="pre">file.managed</span></code></a> function for more details and examples.</p> </dd> <dt>template</dt>
<dd>
<p>The named templating engine will be used to render the appended-to file. Defaults to <code class="docutils literal notranslate"><span class="pre">jinja</span></code>. The following templates are supported:</p> <ul class="simple"> <li><p><a class="reference internal" href="../../renderers/all/salt.renderers.cheetah.html#module-salt.renderers.cheetah" title="salt.renderers.cheetah"><code class="xref py py-mod docutils literal notranslate"><span class="pre">cheetah</span></code></a></p></li> <li><p><a class="reference internal" href="../../renderers/all/salt.renderers.genshi.html#module-salt.renderers.genshi" title="salt.renderers.genshi"><code class="xref py py-mod docutils literal notranslate"><span class="pre">genshi</span></code></a></p></li> <li><p><a class="reference internal" href="../../renderers/all/salt.renderers.jinja.html#module-salt.renderers.jinja" title="salt.renderers.jinja"><code class="xref py py-mod docutils literal notranslate"><span class="pre">jinja</span></code></a></p></li> <li><p><a class="reference internal" href="../../renderers/all/salt.renderers.mako.html#module-salt.renderers.mako" title="salt.renderers.mako"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mako</span></code></a></p></li> <li><p><a class="reference internal" href="../../renderers/all/salt.renderers.py.html#module-salt.renderers.py" title="salt.renderers.py"><code class="xref py py-mod docutils literal notranslate"><span class="pre">py</span></code></a></p></li> <li><p><a class="reference internal" href="../../renderers/all/salt.renderers.wempy.html#module-salt.renderers.wempy" title="salt.renderers.wempy"><code class="xref py py-mod docutils literal notranslate"><span class="pre">wempy</span></code></a></p></li> </ul> </dd> <dt>sources</dt>
<dd>
<p>A list of source files to append. If the files are hosted on an HTTP or FTP server, the source_hashes argument is also required.</p> </dd> <dt>source_hashes</dt>
<dd>
<p>A list of source_hashes corresponding to the sources list specified in the sources argument.</p> </dd> <dt>defaults</dt>
<dd>
<p>Default context passed to the template.</p> </dd> <dt>context</dt>
<dd>
<p>Overrides default context variables passed to the template.</p> </dd> <dt>ignore_whitespace</dt>
<dd>
<div class="versionadded"> <p><span class="versionmodified added">New in version 2015.8.4.</span></p> </div> <p>Spaces and Tabs in text are ignored by default, when searching for the appending content, one space or multiple tabs are the same for salt. Set this option to <code class="docutils literal notranslate"><span class="pre">False</span></code> if you want to change this behavior.</p> </dd> </dl> <p>Multi-line example:</p> <pre class="highlight-yaml notranslate" data-language="yaml">/etc/motd:
  file.prepend:
    - text: |
        Thou hadst better eat salt with the Philosophers of Greece,
        than sugar with the Courtiers of Italy.
        - Benjamin Franklin</pre> <p>Multiple lines of text:</p> <pre class="highlight-yaml notranslate" data-language="yaml">/etc/motd:
  file.prepend:
    - text:
      - Trust no one unless you have eaten much salt with him.
      - "Salt is born of the purest of parents: the sun and the sea."</pre> <p>Optionally, require the text to appear exactly as specified (order and position). Combine with multi-line or multiple lines of input.</p> <pre class="highlight-yaml notranslate" data-language="yaml">/etc/motd:
  file.prepend:
    - header: True
    - text:
      - This will be the very first line in the file.
      - The 2nd line, regardless of duplicates elsewhere in the file.
      - These will be written anew if they do not appear verbatim.</pre> <p>Gather text from multiple template files:</p> <pre class="highlight-yaml notranslate" data-language="yaml">/etc/motd:
  file:
    - prepend
    - template: jinja
    - sources:
      - salt://motd/devops-messages.tmpl
      - salt://motd/hr-messages.tmpl
      - salt://motd/general-messages.tmpl</pre> <div class="versionadded"> <p><span class="versionmodified added">New in version 2014.7.0.</span></p> </div> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.file.recurse"> salt.states.file.recurse(name, source, keep_source=True, clean=False, require=None, user=None, group=None, dir_mode=None, file_mode=None, sym_mode=None, template=None, context=None, replace=True, defaults=None, include_empty=False, backup='', include_pat=None, exclude_pat=None, maxdepth=None, keep_symlinks=False, force_symlinks=False, win_owner=None, win_perms=None, win_deny_perms=None, win_inheritance=True, **kwargs)</h3> <dd>
<p>Recurse through a subdirectory on the master and copy said subdirectory over to the specified path.</p> <dl> <dt>name</dt>
<dd>
<p>The directory to set the recursion in</p> </dd> <dt>source</dt>
<dd>
<p>The source directory, this directory is located on the salt master file server and is specified with the salt:// protocol. If the directory is located on the master in the directory named spam, and is called eggs, the source string is salt://spam/eggs</p> </dd> <dt>keep_source<span class="classifier">True</span>
</dt>
<dd>
<p>Set to <code class="docutils literal notranslate"><span class="pre">False</span></code> to discard the cached copy of the source file once the state completes. This can be useful for larger files to keep them from taking up space in minion cache. However, keep in mind that discarding the source file will result in the state needing to re-download the source file if the state is run again.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2017.7.3.</span></p> </div> </dd> <dt>clean</dt>
<dd>
<p>Make sure that only files that are set up by salt and required by this function are kept. If this option is set then everything in this directory will be deleted unless it is required.</p> </dd> <dt>require</dt>
<dd>
<p>Require other resources such as packages or files</p> </dd> <dt>user</dt>
<dd>
<p>The user to own the directory. This defaults to the user salt is running as on the minion</p> </dd> <dt>group</dt>
<dd>
<p>The group ownership set for the directory. This defaults to the group salt is running as on the minion. On Windows, this is ignored</p> </dd> <dt>dir_mode</dt>
<dd>
<p>The permissions mode to set on any directories created.</p> <p>The default mode for new files and directories corresponds umask of salt process. For existing files and directories it's not enforced.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This option is <strong>not</strong> supported on Windows.</p> </div> </dd> <dt>file_mode</dt>
<dd>
<p>The permissions mode to set on any files created.</p> <p>The default mode for new files and directories corresponds umask of salt process. For existing files and directories it's not enforced.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This option is <strong>not</strong> supported on Windows.</p> </div> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 2016.11.0: </span>This option can be set to <code class="docutils literal notranslate"><span class="pre">keep</span></code>, and Salt will keep the mode from the Salt fileserver. This is only supported when the <code class="docutils literal notranslate"><span class="pre">source</span></code> URL begins with <code class="docutils literal notranslate"><span class="pre">salt://</span></code>, or for files local to the minion. Because the <code class="docutils literal notranslate"><span class="pre">source</span></code> option cannot be used with any of the <code class="docutils literal notranslate"><span class="pre">contents</span></code> options, setting the <code class="docutils literal notranslate"><span class="pre">mode</span></code> to <code class="docutils literal notranslate"><span class="pre">keep</span></code> is also incompatible with the <code class="docutils literal notranslate"><span class="pre">contents</span></code> options.</p> </div> </dd> <dt>sym_mode</dt>
<dd>
<p>The permissions mode to set on any symlink created.</p> <p>The default mode for new files and directories corresponds umask of salt process. For existing files and directories it's not enforced.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This option is <strong>not</strong> supported on Windows.</p> </div> </dd> <dt>template</dt>
<dd>
<p>If this setting is applied, the named templating engine will be used to render the downloaded file. The following templates are supported:</p> <ul class="simple"> <li><p><a class="reference internal" href="../../renderers/all/salt.renderers.cheetah.html#module-salt.renderers.cheetah" title="salt.renderers.cheetah"><code class="xref py py-mod docutils literal notranslate"><span class="pre">cheetah</span></code></a></p></li> <li><p><a class="reference internal" href="../../renderers/all/salt.renderers.genshi.html#module-salt.renderers.genshi" title="salt.renderers.genshi"><code class="xref py py-mod docutils literal notranslate"><span class="pre">genshi</span></code></a></p></li> <li><p><a class="reference internal" href="../../renderers/all/salt.renderers.jinja.html#module-salt.renderers.jinja" title="salt.renderers.jinja"><code class="xref py py-mod docutils literal notranslate"><span class="pre">jinja</span></code></a></p></li> <li><p><a class="reference internal" href="../../renderers/all/salt.renderers.mako.html#module-salt.renderers.mako" title="salt.renderers.mako"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mako</span></code></a></p></li> <li><p><a class="reference internal" href="../../renderers/all/salt.renderers.py.html#module-salt.renderers.py" title="salt.renderers.py"><code class="xref py py-mod docutils literal notranslate"><span class="pre">py</span></code></a></p></li> <li><p><a class="reference internal" href="../../renderers/all/salt.renderers.wempy.html#module-salt.renderers.wempy" title="salt.renderers.wempy"><code class="xref py py-mod docutils literal notranslate"><span class="pre">wempy</span></code></a></p></li> </ul> <div class="admonition note"> <p class="admonition-title">Note</p> <p>The template option is required when recursively applying templates.</p> </div> </dd> <dt>replace<span class="classifier">True</span>
</dt>
<dd>
<p>If set to <code class="docutils literal notranslate"><span class="pre">False</span></code> and the file already exists, the file will not be modified even if changes would otherwise be made. Permissions and ownership will still be enforced, however.</p> </dd> <dt>context</dt>
<dd>
<p>Overrides default context variables passed to the template.</p> </dd> <dt>defaults</dt>
<dd>
<p>Default context passed to the template.</p> </dd> <dt>include_empty</dt>
<dd>
<p>Set this to True if empty directories should also be created (default is False)</p> </dd> <dt>backup</dt>
<dd>
<p>Overrides the default backup mode for all replaced files. See <a class="reference internal" href="https://docs.saltproject.io/en/latest/ref/states/backup_mode.html#file-state-backups"><span class="std std-ref">backup_mode documentation</span></a> for more details.</p> </dd> <dt>include_pat</dt>
<dd>
<p>When copying, include only this pattern, or list of patterns, from the source. Default is glob match; if prefixed with 'E@', then regexp match. Example:</p> <pre class="highlight-text notranslate" data-language="text">- include_pat: hello*       :: glob matches 'hello01', 'hello02'
                               ... but not 'otherhello'
- include_pat: E@hello      :: regexp matches 'otherhello',
                               'hello01' ...</pre> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 3001: </span>List patterns are now supported</p> </div> <pre class="highlight-text notranslate" data-language="text">- include_pat:
    - hello01
    - hello02</pre> </dd> <dt>exclude_pat</dt>
<dd>
<p>Exclude this pattern, or list of patterns, from the source when copying. If both <cite>include_pat</cite> and <cite>exclude_pat</cite> are supplied, then it will apply conditions cumulatively. i.e. first select based on include_pat, and then within that result apply exclude_pat.</p> <p>Also, when 'clean=True', exclude this pattern from the removal list and preserve in the destination. Example:</p> <pre class="highlight-text notranslate" data-language="text">- exclude_pat: APPDATA*               :: glob matches APPDATA.01,
                                         APPDATA.02,.. for exclusion
- exclude_pat: E@(APPDATA)|(TEMPDATA) :: regexp matches APPDATA
                                         or TEMPDATA for exclusion</pre> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 3001: </span>List patterns are now supported</p> </div> <pre class="highlight-text notranslate" data-language="text">- exclude_pat:
    - APPDATA.01
    - APPDATA.02</pre> </dd> <dt>maxdepth</dt>
<dd>
<p>When copying, only copy paths which are of depth <cite>maxdepth</cite> from the source path. Example:</p> <pre class="highlight-text notranslate" data-language="text">- maxdepth: 0      :: Only include files located in the source
                      directory
- maxdepth: 1      :: Only include files located in the source
                      or immediate subdirectories</pre> </dd> <dt>keep_symlinks</dt>
<dd>
<p>Keep symlinks when copying from the source. This option will cause the copy operation to terminate at the symlink. If desire behavior similar to rsync, then set this to True.</p> </dd> <dt>force_symlinks</dt>
<dd>
<p>Force symlink creation. This option will force the symlink creation. If a file or directory is obstructing symlink creation it will be recursively removed so that symlink creation can proceed. This option is usually not needed except in special circumstances.</p> </dd> <dt>win_owner<span class="classifier">None</span>
</dt>
<dd>
<p>The owner of the symlink and directories if <code class="docutils literal notranslate"><span class="pre">makedirs</span></code> is True. If this is not passed, <code class="docutils literal notranslate"><span class="pre">user</span></code> will be used. If <code class="docutils literal notranslate"><span class="pre">user</span></code> is not passed, the account under which Salt is running will be used.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2017.7.7.</span></p> </div> </dd> <dt>win_perms<span class="classifier">None</span>
</dt>
<dd>
<p>A dictionary containing permissions to grant</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2017.7.7.</span></p> </div> </dd> <dt>win_deny_perms<span class="classifier">None</span>
</dt>
<dd>
<p>A dictionary containing permissions to deny</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2017.7.7.</span></p> </div> </dd> <dt>win_inheritance<span class="classifier">None</span>
</dt>
<dd>
<p>True to inherit permissions from parent, otherwise False</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2017.7.7.</span></p> </div> </dd> </dl> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.file.rename"> salt.states.file.rename(name, source, force=False, makedirs=False, **kwargs)</h3> <dd>
<p>If the source file exists on the system, rename it to the named file. The named file will not be overwritten if it already exists unless the force option is set to True.</p> <dl class="simple"> <dt>name</dt>
<dd>
<p>The location of the file to rename to</p> </dd> <dt>source</dt>
<dd>
<p>The location of the file to move to the location specified with name</p> </dd> <dt>force</dt>
<dd>
<p>If the target location is present then the file will not be moved, specify "force: True" to overwrite the target file</p> </dd> <dt>makedirs</dt>
<dd>
<p>If the target subdirectories don't exist create them</p> </dd> </dl> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.file.replace"> salt.states.file.replace(name, pattern, repl, count=0, flags=8, bufsize=1, append_if_not_found=False, prepend_if_not_found=False, not_found_content=None, backup='.bak', show_changes=True, ignore_if_missing=False, backslash_literal=False)</h3> <dd>
<p>Maintain an edit in a file.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 0.17.0.</span></p> </div> <dl> <dt>name</dt>
<dd>
<p>Filesystem path to the file to be edited. If a symlink is specified, it will be resolved to its target.</p> </dd> <dt>pattern</dt>
<dd>
<p>A regular expression, to be matched using Python's <a class="reference external" href="https://docs.python.org/3/library/re.html#re.search" title="(in Python v3.9)"><code class="xref py py-func docutils literal notranslate"><span class="pre">re.search()</span></code></a>.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>If you need to match a literal string that contains regex special characters, you may want to use salt's custom Jinja filter, <code class="docutils literal notranslate"><span class="pre">regex_escape</span></code>.</p> <pre class="highlight-jinja notranslate" data-language="jinja">{{ 'http://example.com?foo=bar%20baz' | regex_escape }}</pre> </div> </dd> <dt>repl</dt>
<dd>
<p>The replacement text</p> </dd> <dt>count</dt>
<dd>
<p>Maximum number of pattern occurrences to be replaced. Defaults to 0. If count is a positive integer n, no more than n occurrences will be replaced, otherwise all occurrences will be replaced.</p> </dd> <dt>flags</dt>
<dd>
<p>A list of flags defined in the <code class="docutils literal notranslate"><span class="pre">re</span></code> module documentation from the Python standard library. Each list item should be a string that will correlate to the human-friendly flag name. E.g., <code class="docutils literal notranslate"><span class="pre">['IGNORECASE',</span>
<span class="pre">'MULTILINE']</span></code>. Optionally, <code class="docutils literal notranslate"><span class="pre">flags</span></code> may be an int, with a value corresponding to the XOR (<code class="docutils literal notranslate"><span class="pre">|</span></code>) of all the desired flags. Defaults to <code class="docutils literal notranslate"><span class="pre">8</span></code> (which equates to <code class="docutils literal notranslate"><span class="pre">['MULTILINE']</span></code>).</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p><code class="docutils literal notranslate"><span class="pre">file.replace</span></code> reads the entire file as a string to support multiline regex patterns. Therefore, when using anchors such as <code class="docutils literal notranslate"><span class="pre">^</span></code> or <code class="docutils literal notranslate"><span class="pre">$</span></code> in the pattern, those anchors may be relative to the line OR relative to the file. The default for <code class="docutils literal notranslate"><span class="pre">file.replace</span></code> is to treat anchors as relative to the line, which is implemented by setting the default value of <code class="docutils literal notranslate"><span class="pre">flags</span></code> to <code class="docutils literal notranslate"><span class="pre">['MULTILINE']</span></code>. When overriding the default value for <code class="docutils literal notranslate"><span class="pre">flags</span></code>, if <code class="docutils literal notranslate"><span class="pre">'MULTILINE'</span></code> is not present then anchors will be relative to the file. If the desired behavior is for anchors to be relative to the line, then simply add <code class="docutils literal notranslate"><span class="pre">'MULTILINE'</span></code> to the list of flags.</p> </div> </dd> <dt>bufsize</dt>
<dd>
<p>How much of the file to buffer into memory at once. The default value <code class="docutils literal notranslate"><span class="pre">1</span></code> processes one line at a time. The special value <code class="docutils literal notranslate"><span class="pre">file</span></code> may be specified which will read the entire file into memory before processing.</p> </dd> <dt>append_if_not_found<span class="classifier">False</span>
</dt>
<dd>
<p>If set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, and pattern is not found, then the content will be appended to the file.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2014.7.0.</span></p> </div> </dd> <dt>prepend_if_not_found<span class="classifier">False</span>
</dt>
<dd>
<p>If set to <code class="docutils literal notranslate"><span class="pre">True</span></code> and pattern is not found, then the content will be prepended to the file.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2014.7.0.</span></p> </div> </dd> <dt>not_found_content</dt>
<dd>
<p>Content to use for append/prepend if not found. If <code class="docutils literal notranslate"><span class="pre">None</span></code> (default), uses <code class="docutils literal notranslate"><span class="pre">repl</span></code>. Useful when <code class="docutils literal notranslate"><span class="pre">repl</span></code> uses references to group in pattern.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2014.7.0.</span></p> </div> </dd> <dt>backup</dt>
<dd>
<p>The file extension to use for a backup of the file before editing. Set to <code class="docutils literal notranslate"><span class="pre">False</span></code> to skip making a backup.</p> </dd> <dt>show_changes<span class="classifier">True</span>
</dt>
<dd>
<p>Output a unified diff of the old file and the new file. If <code class="docutils literal notranslate"><span class="pre">False</span></code> return a boolean if any changes were made. Returns a boolean or a string.</p> </dd> <dt>ignore_if_missing<span class="classifier">False</span>
</dt>
<dd>
<div class="versionadded"> <p><span class="versionmodified added">New in version 2016.3.4.</span></p> </div> <p>Controls what to do if the file is missing. If set to <code class="docutils literal notranslate"><span class="pre">False</span></code>, the state will display an error raised by the execution module. If set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, the state will simply report no changes.</p> </dd> <dt>backslash_literal<span class="classifier">False</span>
</dt>
<dd>
<div class="versionadded"> <p><span class="versionmodified added">New in version 2016.11.7.</span></p> </div> <p>Interpret backslashes as literal backslashes for the repl and not escape characters. This will help when using append/prepend so that the backslashes are not interpreted for the repl on the second run of the state.</p> </dd> </dl> <p>For complex regex patterns, it can be useful to avoid the need for complex quoting and escape sequences by making use of YAML's multiline string syntax.</p> <pre class="highlight-yaml notranslate" data-language="yaml">complex_search_and_replace:
  file.replace:
    # &lt;...snip...&gt;
    - pattern: |
        CentOS \(2.6.32[^\\n]+\\n\s+root[^\\n]+\\n\)+</pre> <div class="admonition note"> <p class="admonition-title">Note</p> <p>When using YAML multiline string syntax in <code class="docutils literal notranslate"><span class="pre">pattern:</span></code>, make sure to also use that syntax in the <code class="docutils literal notranslate"><span class="pre">repl:</span></code> part, or you might loose line feeds.</p> </div> <p>When regex capture groups are used in <code class="docutils literal notranslate"><span class="pre">pattern:</span></code>, their captured value is available for reuse in the <code class="docutils literal notranslate"><span class="pre">repl:</span></code> part as a backreference (ex. <code class="docutils literal notranslate"><span class="pre">\1</span></code>).</p> <pre class="highlight-yaml notranslate" data-language="yaml">add_login_group_to_winbind_ssh_access_list:
  file.replace:
    - name: '/etc/security/pam_winbind.conf'
    - pattern: '^(require_membership_of = )(.*)$'
    - repl: '\1\2,append-new-group-to-line'</pre> <div class="admonition note"> <p class="admonition-title">Note</p> <p>The <code class="docutils literal notranslate"><span class="pre">file.replace</span></code> state uses Python's <code class="docutils literal notranslate"><span class="pre">re</span></code> module. For more advanced options, see <a class="reference external" href="https://docs.python.org/2/library/re.html">https://docs.python.org/2/library/re.html</a></p> </div> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.file.retention_schedule"> salt.states.file.retention_schedule(name, retain, strptime_format=None, timezone=None)</h3> <dd>
<p>Apply retention scheduling to backup storage directory.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2016.11.0.</span></p> </div> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li><p><strong>name</strong> -- The filesystem path to the directory containing backups to be managed.</p></li> <li>
<p><strong>retain</strong> -- </p>
<p>Delete the backups, except for the ones we want to keep. The N below should be an integer but may also be the special value of <code class="docutils literal notranslate"><span class="pre">all</span></code>, which keeps all files matching the criteria. All of the retain options default to None, which means to not keep files based on this criteria.</p> <dl class="field-list simple"> <dt class="field-odd">most_recent N</dt> <dd class="field-odd">
<p>Keep the most recent N files.</p> </dd> <dt class="field-even">first_of_hour N</dt> <dd class="field-even">
<p>For the last N hours from now, keep the first file after the hour.</p> </dd> <dt class="field-odd">first_of_day N</dt> <dd class="field-odd">
<p>For the last N days from now, keep the first file after midnight. See also <code class="docutils literal notranslate"><span class="pre">timezone</span></code>.</p> </dd> <dt class="field-even">first_of_week N</dt> <dd class="field-even">
<p>For the last N weeks from now, keep the first file after Sunday midnight.</p> </dd> <dt class="field-odd">first_of_month N</dt> <dd class="field-odd">
<p>For the last N months from now, keep the first file after the start of the month.</p> </dd> <dt class="field-even">first_of_year N</dt> <dd class="field-even">
<p>For the last N years from now, keep the first file after the start of the year.</p> </dd> </dl> </li> <li><p><strong>strptime_format</strong> -- A python strptime format string used to first match the filenames of backups and then parse the filename to determine the datetime of the file. <a class="reference external" href="https://docs.python.org/2/library/datetime.html#datetime.datetime.strptime">https://docs.python.org/2/library/datetime.html#datetime.datetime.strptime</a> Defaults to None, which considers all files in the directory to be backups eligible for deletion and uses <code class="docutils literal notranslate"><span class="pre">os.path.getmtime()</span></code> to determine the datetime.</p></li> <li><p><strong>timezone</strong> -- The timezone to use when determining midnight. This is only used when datetime is pulled from <code class="docutils literal notranslate"><span class="pre">os.path.getmtime()</span></code>. Defaults to <code class="docutils literal notranslate"><span class="pre">None</span></code> which uses the timezone from the locale.</p></li> </ul> </dd> </dl> <p>Usage example:</p> <pre class="highlight-yaml notranslate" data-language="yaml">/var/backups/example_directory:
  file.retention_schedule:
    - retain:
        most_recent: 5
        first_of_hour: 4
        first_of_day: 7
        first_of_week: 6    # NotImplemented yet.
        first_of_month: 6
        first_of_year: all
    - strptime_format: example_name_%Y%m%dT%H%M%S.tar.bz2
    - timezone: None</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.file.serialize"> salt.states.file.serialize(name, dataset=None, dataset_pillar=None, user=None, group=None, mode=None, backup='', makedirs=False, show_changes=True, create=True, merge_if_exists=False, encoding=None, encoding_errors='strict', serializer=None, serializer_opts=None, deserializer_opts=None, **kwargs)</h3> <dd>
<p>Serializes dataset and store it into managed file. Useful for sharing simple configuration files.</p> <dl> <dt>name</dt>
<dd>
<p>The location of the file to create</p> </dd> <dt>dataset</dt>
<dd>
<p>The dataset that will be serialized</p> </dd> <dt>dataset_pillar</dt>
<dd>
<p>Operates like <code class="docutils literal notranslate"><span class="pre">dataset</span></code>, but draws from a value stored in pillar, using the pillar path syntax used in <a class="reference internal" href="../../modules/all/salt.modules.pillar.html#salt.modules.pillar.get" title="salt.modules.pillar.get"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pillar.get</span></code></a>. This is useful when the pillar value contains newlines, as referencing a pillar variable using a jinja/mako template can result in YAML formatting issues due to the newlines causing indentation mismatches.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2015.8.0.</span></p> </div> </dd> <dt>serializer (or formatter)</dt>
<dd>
<p>Write the data as this format. See the list of <a class="reference internal" href="../../serializers/all/index.html#all-salt-serializers"><span class="std std-ref">serializer modules</span></a> for supported output formats.</p> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 3002: </span><code class="docutils literal notranslate"><span class="pre">serializer</span></code> argument added as an alternative to <code class="docutils literal notranslate"><span class="pre">formatter</span></code>. Both are accepted, but using both will result in an error.</p> </div> </dd> <dt>encoding</dt>
<dd>
<p>If specified, then the specified encoding will be used. Otherwise, the file will be encoded using the system locale (usually UTF-8). See <a class="reference external" href="https://docs.python.org/3/library/codecs.html#standard-encodings">https://docs.python.org/3/library/codecs.html#standard-encodings</a> for the list of available encodings.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2017.7.0.</span></p> </div> </dd> <dt>encoding_errors<span class="classifier">'strict'</span>
</dt>
<dd>
<p>Error encoding scheme. Default is <code class="docutils literal notranslate"><span class="pre">`'strict'`</span></code>. See <a class="reference external" href="https://docs.python.org/2/library/codecs.html#codec-base-classes">https://docs.python.org/2/library/codecs.html#codec-base-classes</a> for the list of available schemes.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2017.7.0.</span></p> </div> </dd> <dt>user</dt>
<dd>
<p>The user to own the directory, this defaults to the user salt is running as on the minion</p> </dd> <dt>group</dt>
<dd>
<p>The group ownership set for the directory, this defaults to the group salt is running as on the minion</p> </dd> <dt>mode</dt>
<dd>
<p>The permissions to set on this file, e.g. <code class="docutils literal notranslate"><span class="pre">644</span></code>, <code class="docutils literal notranslate"><span class="pre">0775</span></code>, or <code class="docutils literal notranslate"><span class="pre">4664</span></code>.</p> <p>The default mode for new files and directories corresponds umask of salt process. For existing files and directories it's not enforced.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This option is <strong>not</strong> supported on Windows.</p> </div> </dd> <dt>backup</dt>
<dd>
<p>Overrides the default backup mode for this specific file.</p> </dd> <dt>makedirs</dt>
<dd>
<p>Create parent directories for destination file.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2014.1.3.</span></p> </div> </dd> <dt>show_changes</dt>
<dd>
<p>Output a unified diff of the old file and the new file. If <code class="docutils literal notranslate"><span class="pre">False</span></code> return a boolean if any changes were made.</p> </dd> <dt>create</dt>
<dd>
<p>Default is True, if create is set to False then the file will only be managed if the file already exists on the system.</p> </dd> <dt>merge_if_exists</dt>
<dd>
<p>Default is False, if merge_if_exists is True then the existing file will be parsed and the dataset passed in will be merged with the existing content</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2014.7.0.</span></p> </div> </dd> <dt>serializer_opts</dt>
<dd>
<p>Pass through options to serializer. For example:</p> <pre class="highlight-yaml notranslate" data-language="yaml">/etc/dummy/package.yaml
  file.serialize:
    - serializer: yaml
    - serializer_opts:
      - explicit_start: True
      - default_flow_style: True
      - indent: 4</pre> <p>The valid opts are the additional opts (i.e. not the data being serialized) for the function used to serialize the data. Documentation for the these functions can be found in the list below:</p> <ul class="simple"> <li><p>For <strong>yaml</strong>: <a class="reference external" href="https://pyyaml.org/wiki/PyYAMLDocumentation">yaml.dump()</a></p></li> <li><p>For <strong>json</strong>: <a class="reference external" href="https://docs.python.org/2/library/json.html#json.dumps">json.dumps()</a></p></li> <li><p>For <strong>python</strong>: <a class="reference external" href="https://docs.python.org/2/library/pprint.html#pprint.pformat">pprint.pformat()</a></p></li> <li><p>For <strong>msgpack</strong>: Run <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">-c</span> <span class="pre">'import</span> <span class="pre">msgpack;</span> <span class="pre">help(msgpack.Packer)'</span></code> to see the available options (<code class="docutils literal notranslate"><span class="pre">encoding</span></code>, <code class="docutils literal notranslate"><span class="pre">unicode_errors</span></code>, etc.)</p></li> </ul> </dd> <dt>deserializer_opts</dt>
<dd>
<p>Like <code class="docutils literal notranslate"><span class="pre">serializer_opts</span></code> above, but only used when merging with an existing file (i.e. when <code class="docutils literal notranslate"><span class="pre">merge_if_exists</span></code> is set to <code class="docutils literal notranslate"><span class="pre">True</span></code>).</p> <p>The options specified here will be passed to the deserializer to load the existing data, before merging with the specified data and re-serializing.</p> <pre class="highlight-yaml notranslate" data-language="yaml">/etc/dummy/package.yaml
  file.serialize:
    - serializer: yaml
    - serializer_opts:
      - explicit_start: True
      - default_flow_style: True
      - indent: 4
    - deserializer_opts:
      - encoding: latin-1
    - merge_if_exists: True</pre> <p>The valid opts are the additional opts (i.e. not the data being deserialized) for the function used to deserialize the data. Documentation for the these functions can be found in the list below:</p> <ul class="simple"> <li><p>For <strong>yaml</strong>: <a class="reference external" href="https://pyyaml.org/wiki/PyYAMLDocumentation">yaml.load()</a></p></li> <li><p>For <strong>json</strong>: <a class="reference external" href="https://docs.python.org/2/library/json.html#json.loads">json.loads()</a></p></li> </ul> <p>However, note that not all arguments are supported. For example, when deserializing JSON, arguments like <code class="docutils literal notranslate"><span class="pre">parse_float</span></code> and <code class="docutils literal notranslate"><span class="pre">parse_int</span></code> which accept a callable object cannot be handled in an SLS file.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </dd> </dl> <p>For example, this state:</p> <pre class="highlight-yaml notranslate" data-language="yaml">/etc/dummy/package.json:
  file.serialize:
    - dataset:
        name: naive
        description: A package using naive versioning
        author: A confused individual &lt;iam@confused.com&gt;
        dependencies:
          express: '&gt;= 1.2.0'
          optimist: '&gt;= 0.1.0'
        engine: node 0.4.1
    - serializer: json</pre> <p>will manage the file <code class="docutils literal notranslate"><span class="pre">/etc/dummy/package.json</span></code>:</p> <pre class="highlight-json notranslate" data-language="json">{
  "author": "A confused individual &lt;iam@confused.com&gt;",
  "dependencies": {
    "express": "&gt;= 1.2.0",
    "optimist": "&gt;= 0.1.0"
  },
  "description": "A package using naive versioning",
  "engine": "node 0.4.1",
  "name": "naive"
}</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.file.shortcut"> salt.states.file.shortcut(name, target, arguments=None, working_dir=None, description=None, icon_location=None, force=False, backupname=None, makedirs=False, user=None, **kwargs)</h3> <dd>
<p>Create a Windows shortcut</p> <p>If the file already exists and is a shortcut pointing to any location other than the specified target, the shortcut will be replaced. If it is a regular file or directory then the state will return False. If the regular file or directory is desired to be replaced with a shortcut pass force: True, if it is to be renamed, pass a backupname.</p> <dl> <dt>name</dt>
<dd>
<p>The location of the shortcut to create. Must end with either ".lnk" or ".url"</p> </dd> <dt>target</dt>
<dd>
<p>The location that the shortcut points to</p> </dd> <dt>arguments</dt>
<dd>
<p>Any arguments to pass in the shortcut</p> </dd> <dt>working_dir</dt>
<dd>
<p>Working directory in which to execute target</p> </dd> <dt>description</dt>
<dd>
<p>Description to set on shortcut</p> </dd> <dt>icon_location</dt>
<dd>
<p>Location of shortcut's icon</p> </dd> <dt>force</dt>
<dd>
<p>If the name of the shortcut exists and is not a file and force is set to False, the state will fail. If force is set to True, the link or directory in the way of the shortcut file will be deleted to make room for the shortcut, unless backupname is set, when it will be renamed</p> </dd> <dt>backupname</dt>
<dd>
<p>If the name of the shortcut exists and is not a file, it will be renamed to the backupname. If the backupname already exists and force is False, the state will fail. Otherwise, the backupname will be removed first.</p> </dd> <dt>makedirs</dt>
<dd>
<p>If the location of the shortcut does not already have a parent directory then the state will fail, setting makedirs to True will allow Salt to create the parent directory. Setting this to True will also create the parent for backupname if necessary.</p> </dd> <dt>user</dt>
<dd>
<p>The user to own the file, this defaults to the user salt is running as on the minion</p> <p>The default mode for new files and directories corresponds umask of salt process. For existing files and directories it's not enforced.</p> </dd> </dl> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.file.symlink"> salt.states.file.symlink(name, target, force=False, backupname=None, makedirs=False, user=None, group=None, mode=None, win_owner=None, win_perms=None, win_deny_perms=None, win_inheritance=None, **kwargs)</h3> <dd>
<p>Create a symbolic link (symlink, soft link)</p> <p>If the file already exists and is a symlink pointing to any location other than the specified target, the symlink will be replaced. If an entry with the same name exists then the state will return False. If the existing entry is desired to be replaced with a symlink pass force: True, if it is to be renamed, pass a backupname.</p> <dl> <dt>name</dt>
<dd>
<p>The location of the symlink to create</p> </dd> <dt>target</dt>
<dd>
<p>The location that the symlink points to</p> </dd> <dt>force</dt>
<dd>
<p>If the name of the symlink exists and is not a symlink and force is set to False, the state will fail. If force is set to True, the existing entry in the way of the symlink file will be deleted to make room for the symlink, unless backupname is set, when it will be renamed</p> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 3000: </span>Force will now remove all types of existing file system entries, not just files, directories and symlinks.</p> </div> </dd> <dt>backupname</dt>
<dd>
<p>If the name of the symlink exists and is not a symlink, it will be renamed to the backupname. If the backupname already exists and force is False, the state will fail. Otherwise, the backupname will be removed first. An absolute path OR a basename file/directory name must be provided. The latter will be placed relative to the symlink destination's parent directory.</p> </dd> <dt>makedirs</dt>
<dd>
<p>If the location of the symlink does not already have a parent directory then the state will fail, setting makedirs to True will allow Salt to create the parent directory</p> </dd> <dt>user</dt>
<dd>
<p>The user to own the file, this defaults to the user salt is running as on the minion</p> </dd> <dt>group</dt>
<dd>
<p>The group ownership set for the file, this defaults to the group salt is running as on the minion. On Windows, this is ignored</p> </dd> <dt>mode</dt>
<dd>
<p>The permissions to set on this file, aka 644, 0775, 4664. Not supported on Windows.</p> <p>The default mode for new files and directories corresponds umask of salt process. For existing files and directories it's not enforced.</p> </dd> <dt>win_owner<span class="classifier">None</span>
</dt>
<dd>
<p>The owner of the symlink and directories if <code class="docutils literal notranslate"><span class="pre">makedirs</span></code> is True. If this is not passed, <code class="docutils literal notranslate"><span class="pre">user</span></code> will be used. If <code class="docutils literal notranslate"><span class="pre">user</span></code> is not passed, the account under which Salt is running will be used.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2017.7.7.</span></p> </div> </dd> <dt>win_perms<span class="classifier">None</span>
</dt>
<dd>
<p>A dictionary containing permissions to grant</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2017.7.7.</span></p> </div> </dd> <dt>win_deny_perms<span class="classifier">None</span>
</dt>
<dd>
<p>A dictionary containing permissions to deny</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2017.7.7.</span></p> </div> </dd> <dt>win_inheritance<span class="classifier">None</span>
</dt>
<dd>
<p>True to inherit permissions from parent, otherwise False</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2017.7.7.</span></p> </div> </dd> </dl> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.file.tidied"> salt.states.file.tidied(name, age=0, matches=None, rmdirs=False, size=0, **kwargs)</h3> <dd>
<p>Remove unwanted files based on specific criteria. Multiple criteria are ORd together, so a file that is too large but is not old enough will still get tidied.</p> <p>If neither age nor size is given all files which match a pattern in matches will be removed.</p> <dl class="simple"> <dt>name</dt>
<dd>
<p>The directory tree that should be tidied</p> </dd> <dt>age</dt>
<dd>
<p>Maximum age in days after which files are considered for removal</p> </dd> <dt>matches</dt>
<dd>
<p>List of regular expressions to restrict what gets removed. Default: ['.*']</p> </dd> <dt>rmdirs</dt>
<dd>
<p>Whether or not it's allowed to remove directories</p> </dd> <dt>size</dt>
<dd>
<p>Maximum allowed file size. Files greater or equal to this size are removed. Doesn't apply to directories or symbolic links</p> </dd> </dl> <pre class="highlight-yaml notranslate" data-language="yaml">cleanup:
  file.tidied:
    - name: /tmp/salt_test
    - rmdirs: True
    - matches:
      - foo
      - b.*r</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.file.touch"> salt.states.file.touch(name, atime=None, mtime=None, makedirs=False)</h3> <dd>
<p>Replicate the 'nix "touch" command to create a new empty file or update the atime and mtime of an existing file.</p> <p>Note that if you just want to create a file and don't care about atime or mtime, you should use <code class="docutils literal notranslate"><span class="pre">file.managed</span></code> instead, as it is more feature-complete. (Just leave out the <code class="docutils literal notranslate"><span class="pre">source</span></code>/<code class="docutils literal notranslate"><span class="pre">template</span></code>/<code class="docutils literal notranslate"><span class="pre">contents</span></code> arguments, and it will just create the file and/or check its permissions, without messing with contents)</p> <dl class="simple"> <dt>name</dt>
<dd>
<p>name of the file</p> </dd> <dt>atime</dt>
<dd>
<p>atime of the file</p> </dd> <dt>mtime</dt>
<dd>
<p>mtime of the file</p> </dd> <dt>makedirs</dt>
<dd>
<p>whether we should create the parent directory/directories in order to touch the file</p> </dd> </dl> <p>Usage:</p> <pre class="highlight-yaml notranslate" data-language="yaml">/var/log/httpd/logrotate.empty:
  file.touch</pre> <div class="versionadded"> <p><span class="versionmodified added">New in version 0.9.5.</span></p> </div> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.file.uncomment"> salt.states.file.uncomment(name, regex, char='#', backup='.bak')</h3> <dd>
<p>Uncomment specified commented lines in a file</p> <dl> <dt>name</dt>
<dd>
<p>The full path to the file to be edited</p> </dd> <dt>regex</dt>
<dd>
<p>A regular expression used to find the lines that are to be uncommented. This regex should not include the comment character. A leading <code class="docutils literal notranslate"><span class="pre">^</span></code> character will be stripped for convenience (for easily switching between comment() and uncomment()). The regex will be searched for from the beginning of the line, ignoring leading spaces (we prepend '^[ t]*')</p> </dd> <dt>char<span class="classifier"><code class="docutils literal notranslate"><span class="pre">#</span></code></span>
</dt>
<dd>
<p>The character to remove in order to uncomment a line</p> </dd> <dt>backup<span class="classifier"><code class="docutils literal notranslate"><span class="pre">.bak</span></code></span>
</dt>
<dd>
<p>The file will be backed up before edit with this file extension;</p> <div class="admonition warning"> <p class="admonition-title">Warning</p> <p>This backup will be overwritten each time <code class="docutils literal notranslate"><span class="pre">sed</span></code> / <code class="docutils literal notranslate"><span class="pre">comment</span></code> / <code class="docutils literal notranslate"><span class="pre">uncomment</span></code> is called. Meaning the backup will only be useful after the first invocation.</p> </div> <p>Set to False/None to not keep a backup.</p> </dd> </dl> <p>Usage:</p> <pre class="highlight-yaml notranslate" data-language="yaml">/etc/adduser.conf:
  file.uncomment:
    - regex: EXTRA_GROUPS</pre> <div class="versionadded"> <p><span class="versionmodified added">New in version 0.9.5.</span></p> </div> </dd>
</dl> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2021 SaltStack.<br>Licensed under the Apache License, Version 2.0.<br>
    <a href="https://docs.saltproject.io/en/latest/ref/states/all/salt.states.file.html" class="_attribution-link">https://docs.saltproject.io/en/latest/ref/states/all/salt.states.file.html</a>
  </p>
</div>
