<h1>salt.states.pkg</h1> <div class="section" id="installation-of-packages-using-os-package-managers-such-as-yum-or-apt-get"> <h2>Installation of packages using OS package managers such as yum or apt-get</h2> <div class="admonition note"> <p class="admonition-title">Note</p> <p>On minions running systemd&gt;=205, as of version 2015.8.12, 2016.3.3, and 2016.11.0, <a class="reference external" href="https://www.freedesktop.org/software/systemd/man/systemd-run.html">systemd-run(1)</a> is now used to isolate commands which modify installed packages from the <code class="docutils literal notranslate"><span class="pre">salt-minion</span></code> daemon's control group. This is done to keep systemd from killing the package manager commands spawned by Salt, when Salt updates itself (see <code class="docutils literal notranslate"><span class="pre">KillMode</span></code> in the <a class="reference external" href="https://www.freedesktop.org/software/systemd/man/systemd.kill.html">systemd.kill(5)</a> manpage for more information). If desired, usage of <a class="reference external" href="https://www.freedesktop.org/software/systemd/man/systemd-run.html">systemd-run(1)</a> can be suppressed by setting a <a class="reference internal" href="../../modules/all/salt.modules.config.html#salt.modules.config.get" title="salt.modules.config.get"><code class="xref py py-mod docutils literal notranslate"><span class="pre">config</span> <span class="pre">option</span></code></a> called <code class="docutils literal notranslate"><span class="pre">systemd.use_scope</span></code>, with a value of <code class="docutils literal notranslate"><span class="pre">False</span></code> (no quotes).</p> </div> <p>Salt can manage software packages via the pkg state module, packages can be set up to be installed, latest, removed and purged. Package management declarations are typically rather simple:</p> <pre class="highlight-yaml notranslate" data-language="yaml">vim:
  pkg.installed</pre> <p>A more involved example involves pulling from a custom repository.</p> <pre class="highlight-yaml notranslate" data-language="yaml">base:
  pkgrepo.managed:
    - name: ppa:wolfnet/logstash
    - dist: precise
    - file: /etc/apt/sources.list.d/logstash.list
    - keyid: 28B04E4A
    - keyserver: keyserver.ubuntu.com

logstash:
  pkg.installed:
    - fromrepo: ppa:wolfnet/logstash</pre> <p>Multiple packages can also be installed with the use of the pkgs state module</p> <pre class="highlight-yaml notranslate" data-language="yaml">dotdeb.repo:
  pkgrepo.managed:
    - name: deb http://packages.dotdeb.org wheezy-php55 all
    - dist: wheezy-php55
    - file: /etc/apt/sources.list.d/dotbeb.list
    - keyid: 89DF5277
    - keyserver: keys.gnupg.net
    - refresh_db: true

php.packages:
  pkg.installed:
    - fromrepo: wheezy-php55
    - pkgs:
      - php5-fpm
      - php5-cli
      - php5-curl</pre> <div class="admonition warning"> <p class="admonition-title">Warning</p> <p>Package names are currently case-sensitive. If the minion is using a package manager which is not case-sensitive (such as <a class="reference internal" href="../../modules/all/salt.modules.pkgng.html#module-salt.modules.pkgng" title="salt.modules.pkgng"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pkgng</span></code></a>), then this state will fail if the proper case is not used. This will be addressed in a future release of Salt.</p> </div> <dl class="py function"> <h3 id="salt.states.pkg.downloaded"> salt.states.pkg.downloaded(name, version=None, pkgs=None, fromrepo=None, ignore_epoch=None, **kwargs)</h3> <dd>
<div class="versionadded"> <p><span class="versionmodified added">New in version 2017.7.0.</span></p> </div> <p>Ensure that the package is downloaded, and that it is the correct version (if specified).</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>Any argument which is either a) not explicitly defined for this state, or b) not a global state argument like <code class="docutils literal notranslate"><span class="pre">saltenv</span></code>, or <code class="docutils literal notranslate"><span class="pre">reload_modules</span></code>, will be passed through to the call to <code class="docutils literal notranslate"><span class="pre">pkg.install</span></code> to download the package(s). For example, you can include a <code class="docutils literal notranslate"><span class="pre">disablerepo</span></code> argument on platforms that use yum/dnf to disable that repo:</p> <pre class="highlight-yaml notranslate" data-language="yaml">mypkg:
  pkg.downloaded:
    - disablerepo: base,updates</pre> <p>To see what is supported, check <a class="reference internal" href="../../modules/all/salt.modules.pkg.html#virtual-pkg"><span class="std std-ref">this page</span></a> to find the documentation for your platform's <code class="docutils literal notranslate"><span class="pre">pkg</span></code> module, then look at the documentation for the <code class="docutils literal notranslate"><span class="pre">install</span></code> function.</p> <p>Any argument that is passed through to the <code class="docutils literal notranslate"><span class="pre">install</span></code> function, which is not defined for that function, will be silently ignored.</p> </div> <p>Currently supported for the following pkg providers: <a class="reference internal" href="../../modules/all/salt.modules.yumpkg.html#module-salt.modules.yumpkg" title="salt.modules.yumpkg"><code class="xref py py-mod docutils literal notranslate"><span class="pre">yumpkg</span></code></a>, <code class="xref py py-mod docutils literal notranslate"><span class="pre">zypper</span></code> and <a class="reference internal" href="../../modules/all/salt.modules.aptpkg.html#module-salt.modules.aptpkg" title="salt.modules.aptpkg"><code class="xref py py-mod docutils literal notranslate"><span class="pre">zypper</span></code></a></p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li><p><strong>name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The name of the package to be downloaded. This parameter is ignored if either "pkgs" is used. Additionally, please note that this option can only be used to download packages from a software repository.</p></li> <li>
<p><strong>version</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- </p>
<p>Download a specific version of a package.</p> <div class="admonition important"> <p class="admonition-title">Important</p> <p>As of version 2015.8.7, for distros which use yum/dnf, packages which have a version with a nonzero epoch (that is, versions which start with a number followed by a colon must have the epoch included when specifying the version number. For example:</p> <pre class="highlight-yaml notranslate" data-language="yaml">vim-enhanced:
  pkg.downloaded:
    - version: 2:7.4.160-1.el7</pre> <p>An <strong>ignore_epoch</strong> argument has been added to which causes the epoch to be disregarded when the state checks to see if the desired version was installed.</p> <p>You can install a specific version when using the <code class="docutils literal notranslate"><span class="pre">pkgs</span></code> argument by including the version after the package:</p> <pre class="highlight-yaml notranslate" data-language="yaml">common_packages:
  pkg.downloaded:
    - pkgs:
      - unzip
      - dos2unix
      - salt-minion: 2015.8.5-1.el6</pre> </div> </li> <li>
<p><strong>resolve_capabilities</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- </p>
<p>Turn on resolving capabilities. This allow one to name "provides" or alias names for packages.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2018.3.0.</span></p> </div> </li> </ul> </dd> </dl> <p>CLI Example:</p> <pre class="highlight-yaml notranslate" data-language="yaml">zsh:
  pkg.downloaded:
    - version: 5.0.5-4.63
    - fromrepo: "myrepository"</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.pkg.group_installed"> salt.states.pkg.group_installed(name, skip=None, include=None, **kwargs)</h3> <dd>
<div class="versionadded"> <p><span class="versionmodified added">New in version 2015.8.0.</span></p> </div> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 2016.11.0: </span>Added support in <code class="xref py py-mod docutils literal notranslate"><span class="pre">pacman</span></code></p> </div> <p>Ensure that an entire package group is installed. This state is currently only supported for the <a class="reference internal" href="../../modules/all/salt.modules.yumpkg.html#module-salt.modules.yumpkg" title="salt.modules.yumpkg"><code class="xref py py-mod docutils literal notranslate"><span class="pre">yum</span></code></a> and <code class="xref py py-mod docutils literal notranslate"><span class="pre">pacman</span></code> package managers.</p> <dl> <dt>skip</dt>
<dd>
<p>Packages that would normally be installed by the package group ("default" packages), which should not be installed.</p> <pre class="highlight-yaml notranslate" data-language="yaml">Load Balancer:
  pkg.group_installed:
    - skip:
      - piranha</pre> </dd> <dt>include</dt>
<dd>
<p>Packages which are included in a group, which would not normally be installed by a <code class="docutils literal notranslate"><span class="pre">yum</span> <span class="pre">groupinstall</span></code> ("optional" packages). Note that this will not enforce group membership; if you include packages which are not members of the specified groups, they will still be installed.</p> <pre class="highlight-yaml notranslate" data-language="yaml">Load Balancer:
  pkg.group_installed:
    - include:
      - haproxy</pre> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 2016.3.0: </span>This option can no longer be passed as a comma-separated list, it must now be passed as a list (as shown in the above example).</p> </div> </dd> </dl> <div class="admonition note"> <p class="admonition-title">Note</p> <p>Because this is essentially a wrapper around <a class="reference internal" href="../../modules/all/salt.modules.yumpkg.html#salt.modules.yumpkg.install" title="salt.modules.yumpkg.install"><code class="xref py py-func docutils literal notranslate"><span class="pre">pkg.install</span></code></a>, any argument which can be passed to pkg.install may also be included here, and it will be passed on to the call to <a class="reference internal" href="../../modules/all/salt.modules.yumpkg.html#salt.modules.yumpkg.install" title="salt.modules.yumpkg.install"><code class="xref py py-func docutils literal notranslate"><span class="pre">pkg.install</span></code></a>.</p> </div> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.pkg.installed"> salt.states.pkg.installed(name, version=None, refresh=None, fromrepo=None, skip_verify=False, skip_suggestions=False, pkgs=None, sources=None, allow_updates=False, pkg_verify=False, normalize=True, ignore_epoch=None, reinstall=False, update_holds=False, **kwargs)</h3> <dd>
<p>Ensure that the package is installed, and that it is the correct version (if specified).</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>Any argument which is either a) not explicitly defined for this state, or b) not a global state argument like <code class="docutils literal notranslate"><span class="pre">saltenv</span></code>, or <code class="docutils literal notranslate"><span class="pre">reload_modules</span></code>, will be passed through to the call to <code class="docutils literal notranslate"><span class="pre">pkg.install</span></code> to install the package(s). For example, you can include a <code class="docutils literal notranslate"><span class="pre">disablerepo</span></code> argument on platforms that use yum/dnf to disable that repo:</p> <pre class="highlight-yaml notranslate" data-language="yaml">mypkg:
  pkg.installed:
    - disablerepo: base,updates</pre> <p>To see what is supported, check <a class="reference internal" href="../../modules/all/salt.modules.pkg.html#virtual-pkg"><span class="std std-ref">this page</span></a> to find the documentation for your platform's <code class="docutils literal notranslate"><span class="pre">pkg</span></code> module, then look at the documentation for the <code class="docutils literal notranslate"><span class="pre">install</span></code> function.</p> <p>Any argument that is passed through to the <code class="docutils literal notranslate"><span class="pre">install</span></code> function, which is not defined for that function, will be silently ignored.</p> </div> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li><p><strong>name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The name of the package to be installed. This parameter is ignored if either "pkgs" or "sources" is used. Additionally, please note that this option can only be used to install packages from a software repository. To install a package file manually, use the "sources" option detailed below.</p></li> <li>
<p><strong>version</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- </p>
<p>Install a specific version of a package. This option is ignored if "sources" is used. Currently, this option is supported for the following pkg providers: <a class="reference internal" href="../../modules/all/salt.modules.aptpkg.html#module-salt.modules.aptpkg" title="salt.modules.aptpkg"><code class="xref py py-mod docutils literal notranslate"><span class="pre">apt</span></code></a>, <code class="xref py py-mod docutils literal notranslate"><span class="pre">ebuild</span></code>, <code class="xref py py-mod docutils literal notranslate"><span class="pre">pacman</span></code>, <a class="reference internal" href="../../modules/all/salt.modules.pkgin.html#module-salt.modules.pkgin" title="salt.modules.pkgin"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pkgin</span></code></a>, <a class="reference internal" href="../../modules/all/salt.modules.win_pkg.html#module-salt.modules.win_pkg" title="salt.modules.win_pkg"><code class="xref py py-mod docutils literal notranslate"><span class="pre">win_pkg</span></code></a>, <a class="reference internal" href="../../modules/all/salt.modules.yumpkg.html#module-salt.modules.yumpkg" title="salt.modules.yumpkg"><code class="xref py py-mod docutils literal notranslate"><span class="pre">yumpkg</span></code></a>, and <code class="xref py py-mod docutils literal notranslate"><span class="pre">zypper</span></code>. The version number includes the release designation where applicable, to allow Salt to target a specific release of a given version. When in doubt, using the <code class="docutils literal notranslate"><span class="pre">pkg.latest_version</span></code> function for an uninstalled package will tell you the version available.</p> <pre class="highlight-bash notranslate" data-language="bash"># salt myminion pkg.latest_version vim-enhanced
myminion:
    2:7.4.160-1.el7</pre> <div class="admonition important"> <p class="admonition-title">Important</p> <p>As of version 2015.8.7, for distros which use yum/dnf, packages which have a version with a nonzero epoch (that is, versions which start with a number followed by a colon like in the <code class="docutils literal notranslate"><span class="pre">pkg.latest_version</span></code> output above) must have the epoch included when specifying the version number. For example:</p> <pre class="highlight-yaml notranslate" data-language="yaml">vim-enhanced:
  pkg.installed:
    - version: 2:7.4.160-1.el7</pre> <p>In version 2015.8.9, an <strong>ignore_epoch</strong> argument has been added to <a class="reference internal" href="#salt.states.pkg.installed" title="salt.states.pkg.installed"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pkg.installed</span></code></a>, <a class="reference internal" href="#salt.states.pkg.removed" title="salt.states.pkg.removed"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pkg.removed</span></code></a>, and <a class="reference internal" href="#salt.states.pkg.purged" title="salt.states.pkg.purged"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pkg.purged</span></code></a> states, which causes the epoch to be disregarded when the state checks to see if the desired version was installed.</p> </div> <p>Also, while this function is not yet implemented for all pkg frontends, <a class="reference internal" href="../../modules/all/salt.modules.yumpkg.html#salt.modules.yumpkg.list_repo_pkgs" title="salt.modules.yumpkg.list_repo_pkgs"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pkg.list_repo_pkgs</span></code></a> will show all versions available in the various repositories for a given package, irrespective of whether or not it is installed.</p> <pre class="highlight-bash notranslate" data-language="bash"># salt myminion pkg.list_repo_pkgs bash
myminion:
----------
    bash:
        - 4.2.46-21.el7_3
        - 4.2.46-20.el7_2</pre> <p>This function was first added for <a class="reference internal" href="../../modules/all/salt.modules.yumpkg.html#salt.modules.yumpkg.list_repo_pkgs" title="salt.modules.yumpkg.list_repo_pkgs"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pkg.list_repo_pkgs</span></code></a> in 2014.1.0, and was expanded to <a class="reference internal" href="../../modules/all/salt.modules.aptpkg.html#salt.modules.aptpkg.list_repo_pkgs" title="salt.modules.aptpkg.list_repo_pkgs"><code class="xref py py-func docutils literal notranslate"><span class="pre">Debian/Ubuntu</span></code></a> and <code class="xref py py-func docutils literal notranslate"><span class="pre">Arch</span> <span class="pre">Linux</span></code>-based distros in the 2017.7.0 release.</p> <p>The version strings returned by either of these functions can be used as version specifiers in pkg states.</p> <p>You can install a specific version when using the <code class="docutils literal notranslate"><span class="pre">pkgs</span></code> argument by including the version after the package:</p> <pre class="highlight-yaml notranslate" data-language="yaml">common_packages:
  pkg.installed:
    - pkgs:
      - unzip
      - dos2unix
      - salt-minion: 2015.8.5-1.el6</pre> <p>If the version given is the string <code class="docutils literal notranslate"><span class="pre">latest</span></code>, the latest available package version will be installed à la <code class="docutils literal notranslate"><span class="pre">pkg.latest</span></code>.</p> <p><strong>WILDCARD VERSIONS</strong></p> <p>As of the 2017.7.0 release, this state now supports wildcards in package versions for SUSE SLES/Leap/Tumbleweed, Debian/Ubuntu, RHEL/CentOS, Arch Linux, and their derivatives. Using wildcards can be useful for packages where the release name is built into the version in some way, such as for RHEL/CentOS which typically has version numbers like <code class="docutils literal notranslate"><span class="pre">1.2.34-5.el7</span></code>. An example of the usage for this would be:</p> <pre class="highlight-yaml notranslate" data-language="yaml">mypkg:
  pkg.installed:
    - version: '1.2.34*'</pre> <p>Keep in mind that using wildcard versions will result in a slower state run since Salt must gather the available versions of the specified packages and figure out which of them match the specified wildcard expression.</p> </li> <li>
<p><strong>refresh</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- </p>
<p>This parameter controls whether or not the package repo database is updated prior to installing the requested package(s).</p> <p>If <code class="docutils literal notranslate"><span class="pre">True</span></code>, the package database will be refreshed (<code class="docutils literal notranslate"><span class="pre">apt-get</span>
<span class="pre">update</span></code> or equivalent, depending on platform) before installing.</p> <p>If <code class="docutils literal notranslate"><span class="pre">False</span></code>, the package database will <em>not</em> be refreshed before installing.</p> <p>If unset, then Salt treats package database refreshes differently depending on whether or not a <code class="docutils literal notranslate"><span class="pre">pkg</span></code> state has been executed already during the current Salt run. Once a refresh has been performed in a <code class="docutils literal notranslate"><span class="pre">pkg</span></code> state, for the remainder of that Salt run no other refreshes will be performed for <code class="docutils literal notranslate"><span class="pre">pkg</span></code> states which do not explicitly set <code class="docutils literal notranslate"><span class="pre">refresh</span></code> to <code class="docutils literal notranslate"><span class="pre">True</span></code>. This prevents needless additional refreshes from slowing down the Salt run.</p> </li> <li>
<p><strong>cache_valid_time</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- </p>
<div class="versionadded"> <p><span class="versionmodified added">New in version 2016.11.0.</span></p> </div> <p>This parameter sets the value in seconds after which the cache is marked as invalid, and a cache update is necessary. This overwrites the <code class="docutils literal notranslate"><span class="pre">refresh</span></code> parameter's default behavior.</p> <p>Example:</p> <pre class="highlight-yaml notranslate" data-language="yaml">httpd:
  pkg.installed:
    - fromrepo: mycustomrepo
    - skip_verify: True
    - skip_suggestions: True
    - version: 2.0.6~ubuntu3
    - refresh: True
    - cache_valid_time: 300
    - allow_updates: True
    - hold: False</pre> <p>In this case, a refresh will not take place for 5 minutes since the last <code class="docutils literal notranslate"><span class="pre">apt-get</span> <span class="pre">update</span></code> was executed on the system.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This parameter is available only on Debian based distributions and has no effect on the rest.</p> </div> </li> <li>
<p><strong>fromrepo</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- </p>
<p>Specify a repository from which to install</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>Distros which use APT (Debian, Ubuntu, etc.) do not have a concept of repositories, in the same way as YUM-based distros do. When a source is added, it is assigned to a given release. Consider the following source configuration:</p> <pre class="highlight-text notranslate" data-language="text">deb http://ppa.launchpad.net/saltstack/salt/ubuntu precise main</pre> <p>The packages provided by this source would be made available via the <code class="docutils literal notranslate"><span class="pre">precise</span></code> release, therefore <code class="docutils literal notranslate"><span class="pre">fromrepo</span></code> would need to be set to <code class="docutils literal notranslate"><span class="pre">precise</span></code> for Salt to install the package from this source.</p> <p>Having multiple sources in the same release may result in the default install candidate being newer than what is desired. If this is the case, the desired version must be specified using the <code class="docutils literal notranslate"><span class="pre">version</span></code> parameter.</p> <p>If the <code class="docutils literal notranslate"><span class="pre">pkgs</span></code> parameter is being used to install multiple packages in the same state, then instead of using <code class="docutils literal notranslate"><span class="pre">version</span></code>, use the method of version specification described in the <strong>Multiple Package Installation Options</strong> section below.</p> <p>Running the shell command <code class="docutils literal notranslate"><span class="pre">apt-cache</span> <span class="pre">policy</span> <span class="pre">pkgname</span></code> on a minion can help elucidate the APT configuration and aid in properly configuring states:</p> <pre class="highlight-bash notranslate" data-language="bash">root@saltmaster:~# salt ubuntu01 cmd.run 'apt-cache policy ffmpeg'
ubuntu01:
    ffmpeg:
    Installed: (none)
    Candidate: 7:0.10.11-1~precise1
    Version table:
        7:0.10.11-1~precise1 0
            500 http://ppa.launchpad.net/jon-severinsson/ffmpeg/ubuntu/ precise/main amd64 Packages
        4:0.8.10-0ubuntu0.12.04.1 0
            500 http://us.archive.ubuntu.com/ubuntu/ precise-updates/main amd64 Packages
            500 http://security.ubuntu.com/ubuntu/ precise-security/main amd64 Packages
        4:0.8.1-0ubuntu1 0
            500 http://us.archive.ubuntu.com/ubuntu/ precise/main amd64 Packages</pre> <p>The release is located directly after the source's URL. The actual release name is the part before the slash, so to install version <strong>4:0.8.10-0ubuntu0.12.04.1</strong> either <code class="docutils literal notranslate"><span class="pre">precise-updates</span></code> or <code class="docutils literal notranslate"><span class="pre">precise-security</span></code> could be used for the <code class="docutils literal notranslate"><span class="pre">fromrepo</span></code> value.</p> </div> </li> <li><p><strong>skip_verify</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- Skip the GPG verification check for the package to be installed</p></li> <li>
<p><strong>skip_suggestions</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- </p>
<p>Force strict package naming. Disables lookup of package alternatives.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2014.1.1.</span></p> </div> </li> <li>
<p><strong>resolve_capabilities</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- </p>
<p>Turn on resolving capabilities. This allow one to name "provides" or alias names for packages.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2018.3.0.</span></p> </div> </li> <li>
<p><strong>allow_updates</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- </p>
<p>Allow the package to be updated outside Salt's control (e.g. auto updates on Windows). This means a package on the Minion can have a newer version than the latest available in the repository without enforcing a re-installation of the package.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2014.7.0.</span></p> </div> <p>Example:</p> <pre class="highlight-yaml notranslate" data-language="yaml">httpd:
  pkg.installed:
    - fromrepo: mycustomrepo
    - skip_verify: True
    - skip_suggestions: True
    - version: 2.0.6~ubuntu3
    - refresh: True
    - allow_updates: True
    - hold: False</pre> </li> <li>
<p><strong>pkg_verify</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- </p>
<div class="versionadded"> <p><span class="versionmodified added">New in version 2014.7.0.</span></p> </div> <p>For requested packages that are already installed and would not be targeted for upgrade or downgrade, use pkg.verify to determine if any of the files installed by the package have been altered. If files have been altered, the reinstall option of pkg.install is used to force a reinstall. Types to ignore can be passed to pkg.verify. Additionally, <code class="docutils literal notranslate"><span class="pre">verify_options</span></code> can be used to modify further the behavior of pkg.verify. See examples below. Currently, this option is supported for the following pkg providers: <a class="reference internal" href="../../modules/all/salt.modules.yumpkg.html#module-salt.modules.yumpkg" title="salt.modules.yumpkg"><code class="xref py py-mod docutils literal notranslate"><span class="pre">yumpkg</span></code></a>.</p> <p>Examples:</p> <pre class="highlight-yaml notranslate" data-language="yaml">httpd:
  pkg.installed:
    - version: 2.2.15-30.el6.centos
    - pkg_verify: True</pre> <pre class="highlight-yaml notranslate" data-language="yaml">mypkgs:
  pkg.installed:
    - pkgs:
      - foo
      - bar: 1.2.3-4
      - baz
    - pkg_verify:
      - ignore_types:
        - config
        - doc</pre> <pre class="highlight-yaml notranslate" data-language="yaml">mypkgs:
  pkg.installed:
    - pkgs:
      - foo
      - bar: 1.2.3-4
      - baz
    - pkg_verify:
      - ignore_types:
        - config
        - doc
      - verify_options:
        - nodeps
        - nofiledigest</pre> </li> <li>
<p><strong>ignore_types</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><em>list</em></a>) -- </p>
<p>List of types to ignore when verifying the package</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2014.7.0.</span></p> </div> </li> <li>
<p><strong>verify_options</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><em>list</em></a>) -- </p>
<p>List of additional options to pass when verifying the package. These options will be added to the <code class="docutils literal notranslate"><span class="pre">rpm</span> <span class="pre">-V</span></code> command, prepended with <code class="docutils literal notranslate"><span class="pre">--</span></code> (for example, when <code class="docutils literal notranslate"><span class="pre">nodeps</span></code> is passed in this option, <code class="docutils literal notranslate"><span class="pre">rpm</span> <span class="pre">-V</span></code> will be run with <code class="docutils literal notranslate"><span class="pre">--nodeps</span></code>).</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2016.11.0.</span></p> </div> </li> <li>
<p><strong>normalize</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- </p>
<p>Normalize the package name by removing the architecture, if the architecture of the package is different from the architecture of the operating system. The ability to disable this behavior is useful for poorly-created packages which include the architecture as an actual part of the name, such as kernel modules which match a specific kernel version.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2014.7.0.</span></p> </div> <p>Example:</p> <pre class="highlight-yaml notranslate" data-language="yaml">gpfs.gplbin-2.6.32-279.31.1.el6.x86_64:
  pkg.installed:
    - normalize: False</pre> </li> <li>
<p><strong>ignore_epoch</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- </p>
<p>If this option is not explicitly set, and there is no epoch in the desired package version, the epoch will be implicitly ignored. Set this argument to <code class="docutils literal notranslate"><span class="pre">True</span></code> to explicitly ignore the epoch, and <code class="docutils literal notranslate"><span class="pre">False</span></code> to strictly enforce it.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2015.8.9.</span></p> </div> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 3001: </span>In prior releases, the default behavior was to strictly enforce epochs unless this argument was set to <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p> </div> </li> </ul> </dd> </dl> <div class="line-block"> <div class="line"><br></div> </div> <p><strong>MULTIPLE PACKAGE INSTALLATION OPTIONS: (not supported in pkgng)</strong></p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li>
<p><strong>pkgs</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><em>list</em></a>) -- </p>
<p>A list of packages to install from a software repository. All packages listed under <code class="docutils literal notranslate"><span class="pre">pkgs</span></code> will be installed via a single command.</p> <pre class="highlight-yaml notranslate" data-language="yaml">mypkgs:
  pkg.installed:
    - pkgs:
      - foo
      - bar
      - baz
    - hold: True</pre> <p><code class="docutils literal notranslate"><span class="pre">NOTE:</span></code> For <a class="reference internal" href="../../modules/all/salt.modules.aptpkg.html#module-salt.modules.aptpkg" title="salt.modules.aptpkg"><code class="xref py py-mod docutils literal notranslate"><span class="pre">apt</span></code></a>, <code class="xref py py-mod docutils literal notranslate"><span class="pre">ebuild</span></code>, <code class="xref py py-mod docutils literal notranslate"><span class="pre">pacman</span></code>, <a class="reference internal" href="../../modules/all/salt.modules.win_pkg.html#module-salt.modules.win_pkg" title="salt.modules.win_pkg"><code class="xref py py-mod docutils literal notranslate"><span class="pre">winrepo</span></code></a>, <a class="reference internal" href="../../modules/all/salt.modules.yumpkg.html#module-salt.modules.yumpkg" title="salt.modules.yumpkg"><code class="xref py py-mod docutils literal notranslate"><span class="pre">yumpkg</span></code></a>, and <code class="xref py py-mod docutils literal notranslate"><span class="pre">zypper</span></code>, version numbers can be specified in the <code class="docutils literal notranslate"><span class="pre">pkgs</span></code> argument. For example:</p> <pre class="highlight-yaml notranslate" data-language="yaml">mypkgs:
  pkg.installed:
    - pkgs:
      - foo
      - bar: 1.2.3-4
      - baz</pre> <p>Additionally, <code class="xref py py-mod docutils literal notranslate"><span class="pre">ebuild</span></code>, <code class="xref py py-mod docutils literal notranslate"><span class="pre">pacman</span></code>, <code class="xref py py-mod docutils literal notranslate"><span class="pre">zypper</span></code>, <a class="reference internal" href="../../modules/all/salt.modules.yumpkg.html#module-salt.modules.yumpkg" title="salt.modules.yumpkg"><code class="xref py py-mod docutils literal notranslate"><span class="pre">yum/dnf</span></code></a>, and <a class="reference internal" href="../../modules/all/salt.modules.aptpkg.html#module-salt.modules.aptpkg" title="salt.modules.aptpkg"><code class="xref py py-mod docutils literal notranslate"><span class="pre">apt</span></code></a> support the <code class="docutils literal notranslate"><span class="pre">&lt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;=</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;=</span></code>, and <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> operators for more control over what versions will be installed. For example:</p> <pre class="highlight-yaml notranslate" data-language="yaml">mypkgs:
  pkg.installed:
    - pkgs:
      - foo
      - bar: '&gt;=1.2.3-4'
      - baz</pre> <p><code class="docutils literal notranslate"><span class="pre">NOTE:</span></code> When using comparison operators, the expression must be enclosed in quotes to avoid a YAML render error.</p> <p>With <code class="xref py py-mod docutils literal notranslate"><span class="pre">ebuild</span></code> is also possible to specify a use flag list and/or if the given packages should be in package.accept_keywords file and/or the overlay from which you want the package to be installed. For example:</p> <pre class="highlight-yaml notranslate" data-language="yaml">mypkgs:
  pkg.installed:
    - pkgs:
      - foo: '~'
      - bar: '~&gt;=1.2:slot::overlay[use,-otheruse]'
      - baz</pre> </li> <li>
<p><strong>sources</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><em>list</em></a>) -- </p>
<p>A list of packages to install, along with the source URI or local path from which to install each package. In the example below, <code class="docutils literal notranslate"><span class="pre">foo</span></code>, <code class="docutils literal notranslate"><span class="pre">bar</span></code>, <code class="docutils literal notranslate"><span class="pre">baz</span></code>, etc. refer to the name of the package, as it would appear in the output of the <code class="docutils literal notranslate"><span class="pre">pkg.version</span></code> or <code class="docutils literal notranslate"><span class="pre">pkg.list_pkgs</span></code> salt CLI commands.</p> <pre class="highlight-yaml notranslate" data-language="yaml">mypkgs:
  pkg.installed:
    - sources:
      - foo: salt://rpms/foo.rpm
      - bar: http://somesite.org/bar.rpm
      - baz: ftp://someothersite.org/baz.rpm
      - qux: /minion/path/to/qux.rpm</pre> </li> </ul> </dd> </dl> <p><strong>PLATFORM-SPECIFIC ARGUMENTS</strong></p> <p>These are specific to each OS. If it does not apply to the execution module for your OS, it is ignored.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li>
<p><strong>hold</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- </p>
<p>Force the package to be held at the current installed version.</p> <p>Supported on YUM/DNF &amp; APT based systems.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2014.7.0.</span></p> </div> <p>Supported on Zypper-based systems.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 3003.</span></p> </div> </li> <li>
<p><strong>update_holds</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- </p>
<p>If <code class="docutils literal notranslate"><span class="pre">True</span></code>, and this function would update the package version, any packages which are being held will be temporarily unheld so that they can be updated. Otherwise, if this function attempts to update a held package, the held package(s) will be skipped and the state will fail. By default, this parameter is set to <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p> <p>Supported on YUM/DNF &amp; APT based systems.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2016.11.0.</span></p> </div> <p>Supported on Zypper-based systems.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 3003.</span></p> </div> </li> <li>
<p><strong>names</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><em>list</em></a>) -- </p>
<p>A list of packages to install from a software repository. Each package will be installed individually by the package manager.</p> <div class="admonition warning"> <p class="admonition-title">Warning</p> <p>Unlike <code class="docutils literal notranslate"><span class="pre">pkgs</span></code>, the <code class="docutils literal notranslate"><span class="pre">names</span></code> parameter cannot specify a version. In addition, it makes a separate call to the package management frontend to install each package, whereas <code class="docutils literal notranslate"><span class="pre">pkgs</span></code> makes just a single call. It is therefore recommended to use <code class="docutils literal notranslate"><span class="pre">pkgs</span></code> instead of <code class="docutils literal notranslate"><span class="pre">names</span></code> to install multiple packages, both for the additional features and the performance improvement that it brings.</p> </div> </li> <li>
<p><strong>install_recommends</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- </p>
<p>Whether to install the packages marked as recommended. Default is <code class="docutils literal notranslate"><span class="pre">True</span></code>. Currently only works with APT-based systems.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2015.5.0.</span></p> </div> <pre class="highlight-yaml notranslate" data-language="yaml">httpd:
  pkg.installed:
    - install_recommends: False</pre> </li> <li>
<p><strong>only_upgrade</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- </p>
<p>Only upgrade the packages, if they are already installed. Default is <code class="docutils literal notranslate"><span class="pre">False</span></code>. Currently only works with APT-based systems.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2015.5.0.</span></p> </div> <pre class="highlight-yaml notranslate" data-language="yaml">httpd:
  pkg.installed:
    - only_upgrade: True</pre> <div class="admonition note"> <p class="admonition-title">Note</p> <p>If this parameter is set to True and the package is not already installed, the state will fail.</p> </div> </li> <li>
<p><strong>report_reboot_exit_codes</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- </p>
<p>If the installer exits with a recognized exit code indicating that a reboot is required, the module function</p> <blockquote> <div>
<p><em>win_system.set_reboot_required_witnessed</em></p> </div>
</blockquote> <p>will be called, preserving the knowledge of this event for the remainder of the current boot session. For the time being, <code class="docutils literal notranslate"><span class="pre">3010</span></code> is the only recognized exit code, but this is subject to future refinement. The value of this param defaults to <code class="docutils literal notranslate"><span class="pre">True</span></code>. This parameter has no effect on non-Windows systems.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2016.11.0.</span></p> </div> <pre class="highlight-yaml notranslate" data-language="yaml">ms vcpp installed:
  pkg.installed:
    - name: ms-vcpp
    - version: 10.0.40219
    - report_reboot_exit_codes: False</pre> </li> </ul> </dd> <dt class="field-even">Returns</dt> <dd class="field-even">
<p>A dictionary containing the state of the software installation</p> </dd> <dt class="field-odd">Rtype dict</dt>  </dl> <div class="admonition note"> <p class="admonition-title">Note</p> <p>The <code class="docutils literal notranslate"><span class="pre">pkg.installed</span></code> state supports the usage of <code class="docutils literal notranslate"><span class="pre">reload_modules</span></code>. This functionality allows you to force Salt to reload all modules. In many cases, Salt is clever enough to transparently reload the modules. For example, if you install a package, Salt reloads modules because some other module or state might require the package which was installed. However, there are some edge cases where this may not be the case, which is what <code class="docutils literal notranslate"><span class="pre">reload_modules</span></code> is meant to resolve.</p> <p>You should only use <code class="docutils literal notranslate"><span class="pre">reload_modules</span></code> if your <code class="docutils literal notranslate"><span class="pre">pkg.installed</span></code> does some sort of installation where if you do not reload the modules future items in your state which rely on the software being installed will fail. Please see the <a class="reference internal" href="https://docs.saltproject.io/en/latest/ref/states/index.html#reloading-modules"><span class="std std-ref">Reloading Modules</span></a> documentation for more information.</p> </div> <div class="admonition seealso"> <p class="admonition-title">See also</p> <p>unless and onlyif</p> <p>If running pkg commands together with <a class="reference internal" href="https://docs.saltproject.io/en/latest/ref/states/aggregate.html#mod-aggregate-state"><span class="std std-ref">aggregate</span></a> isn't an option, you can use the <a class="reference internal" href="https://docs.saltproject.io/en/latest/ref/states/requisites.html#creates-requisite"><span class="std std-ref">creates</span></a>, <a class="reference internal" href="https://docs.saltproject.io/en/latest/ref/states/requisites.html#unless-requisite"><span class="std std-ref">unless</span></a>, or <a class="reference internal" href="https://docs.saltproject.io/en/latest/ref/states/requisites.html#onlyif-requisite"><span class="std std-ref">onlyif</span></a> syntax to skip a full package run. This can be helpful in large environments with multiple states that include requisites for packages to be installed.</p> <pre class="highlight-yaml notranslate" data-language="yaml"># Using creates for a simple single-factor check
install_nginx:
  pkg.installed:
    - name: nginx
    - creates:
      - /etc/nginx/nginx.conf</pre> <pre class="highlight-yaml notranslate" data-language="yaml"># Using file.file_exists for a single-factor check
install_nginx:
  pkg.installed:
    - name: nginx
    - unless:
      - fun: file.file_exists
        args:
          - /etc/nginx/nginx.conf

# Using unless with a shell test
install_nginx:
  pkg.installed:
    - name: nginx
    - unless: test -f /etc/nginx/nginx.conf</pre> <pre class="highlight-yaml notranslate" data-language="yaml"># Using file.search for a two-factor check
install_nginx:
  pkg.installed:
    - name: nginx
    - unless:
      - fun: file.search
        args:
          - /etc/nginx/nginx.conf
          - 'user www-data;'</pre> <p>The above examples use different methods to reasonably ensure that a package has already been installed. First, with checking for a file that would be created with the package. Second, by checking for specific text within a file that would be created or managed by salt. With these requisists satisfied, creates/unless will return <code class="docutils literal notranslate"><span class="pre">True</span></code> and the <code class="docutils literal notranslate"><span class="pre">pkg.installed</span></code> state will be skipped.</p> <pre class="highlight-bash notranslate" data-language="bash"># Example of state run without unless used
salt 'saltdev' state.apply nginx
saltdev:
----------
          ID: install_nginx
          Function: pkg.installed
          Name: nginx
          Result: True
          Comment: All specified packages are already installed
          Started: 20:11:56.388331
          Duration: 4290.0 ms
          Changes:

# Example of state run using unless requisite
salt 'saltdev' state.apply nginx
saltdev:
----------
          ID: install_nginx
          Function: pkg.installed
          Name: nginx
          Result: True
          Comment: unless condition is true
          Started: 20:10:50.659215
          Duration: 1530.0 ms
          Changes:</pre> <p>The result is a reduction of almost 3 seconds. In larger environments, small reductions in waiting time can add up.</p> <p><a class="reference internal" href="https://docs.saltproject.io/en/latest/ref/states/requisites.html#unless-requisite"><span class="std std-ref">Unless Requisite</span></a></p> </div> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.pkg.latest"> salt.states.pkg.latest(name, refresh=None, fromrepo=None, skip_verify=False, pkgs=None, watch_flags=True, **kwargs)</h3> <dd>
<blockquote> <div>
<p>Ensure that the named package is installed and the latest available package. If the package can be updated, this state function will update the package. Generally it is better for the <a class="reference internal" href="#salt.states.pkg.installed" title="salt.states.pkg.installed"><code class="xref py py-mod docutils literal notranslate"><span class="pre">installed</span></code></a> function to be used, as <a class="reference internal" href="#salt.states.pkg.latest" title="salt.states.pkg.latest"><code class="xref py py-mod docutils literal notranslate"><span class="pre">latest</span></code></a> will update the package whenever a new package is available.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>Any argument which is either a) not explicitly defined for this state, or b) not a global state argument like <code class="docutils literal notranslate"><span class="pre">saltenv</span></code>, or <code class="docutils literal notranslate"><span class="pre">reload_modules</span></code>, will be passed through to the call to <code class="docutils literal notranslate"><span class="pre">pkg.install</span></code> to install the package(s). For example, you can include a <code class="docutils literal notranslate"><span class="pre">disablerepo</span></code> argument on platforms that use yum/dnf to disable that repo:</p> <pre class="highlight-yaml notranslate" data-language="yaml">mypkg:
  pkg.latest:
    - disablerepo: base,updates</pre> <p>To see what is supported, check <a class="reference internal" href="../../modules/all/salt.modules.pkg.html#virtual-pkg"><span class="std std-ref">this page</span></a> to find the documentation for your platform's <code class="docutils literal notranslate"><span class="pre">pkg</span></code> module, then look at the documentation for the <code class="docutils literal notranslate"><span class="pre">install</span></code> function.</p> <p>Any argument that is passed through to the <code class="docutils literal notranslate"><span class="pre">install</span></code> function, which is not defined for that function, will be silently ignored.</p> </div> <dl> <dt>name</dt>
<dd>
<p>The name of the package to maintain at the latest available version. This parameter is ignored if "pkgs" is used.</p> </dd> <dt>fromrepo</dt>
<dd>
<p>Specify a repository from which to install</p> </dd> <dt>skip_verify</dt>
<dd>
<p>Skip the GPG verification check for the package to be installed</p> </dd> <dt>refresh</dt>
<dd>
<p>This parameter controls whether or not the package repo database is updated prior to checking for the latest available version of the requested packages.</p> <p>If <code class="docutils literal notranslate"><span class="pre">True</span></code>, the package database will be refreshed (<code class="docutils literal notranslate"><span class="pre">apt-get</span> <span class="pre">update</span></code> or equivalent, depending on platform) before checking for the latest available version of the requested packages.</p> <p>If <code class="docutils literal notranslate"><span class="pre">False</span></code>, the package database will <em>not</em> be refreshed before checking.</p> <p>If unset, then Salt treats package database refreshes differently depending on whether or not a <code class="docutils literal notranslate"><span class="pre">pkg</span></code> state has been executed already during the current Salt run. Once a refresh has been performed in a <code class="docutils literal notranslate"><span class="pre">pkg</span></code> state, for the remainder of that Salt run no other refreshes will be performed for <code class="docutils literal notranslate"><span class="pre">pkg</span></code> states which do not explicitly set <code class="docutils literal notranslate"><span class="pre">refresh</span></code> to <code class="docutils literal notranslate"><span class="pre">True</span></code>. This prevents needless additional refreshes from slowing down the Salt run.</p> </dd> </dl> <dl class="field-list"> <dt class="field-odd">param str cache_valid_time</dt> <dd class="field-odd">
<div class="versionadded"> <p><span class="versionmodified added">New in version 2016.11.0.</span></p> </div> <p>This parameter sets the value in seconds after which the cache is marked as invalid, and a cache update is necessary. This overwrites the <code class="docutils literal notranslate"><span class="pre">refresh</span></code> parameter's default behavior.</p> <p>Example:</p> <pre class="highlight-yaml notranslate" data-language="yaml">httpd:
  pkg.latest:
    - refresh: True
    - cache_valid_time: 300</pre> <p>In this case, a refresh will not take place for 5 minutes since the last <code class="docutils literal notranslate"><span class="pre">apt-get</span> <span class="pre">update</span></code> was executed on the system.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This parameter is available only on Debian based distributions and has no effect on the rest.</p> </div> </dd> <dt class="field-even">param bool resolve_capabilities</dt> <dd class="field-even">
<p>Turn on resolving capabilities. This allow one to name "provides" or alias names for packages.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2018.3.0.</span></p> </div> </dd> </dl> <p>Multiple Package Installation Options:</p> <p>(Not yet supported for: FreeBSD, OpenBSD, MacOS, and Solaris pkgutil)</p> <dl class="simple"> <dt>pkgs</dt>
<dd>
<p>A list of packages to maintain at the latest available version.</p> </dd> </dl> <pre class="highlight-yaml notranslate" data-language="yaml">mypkgs:
  pkg.latest:
    - pkgs:
      - foo
      - bar
      - baz</pre> <dl> <dt>install_recommends</dt>
<dd>
<p>Whether to install the packages marked as recommended. Default is <code class="docutils literal notranslate"><span class="pre">True</span></code>. Currently only works with APT-based systems.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2015.5.0.</span></p> </div> </dd> </dl> <pre class="highlight-yaml notranslate" data-language="yaml">httpd:
  pkg.latest:
    - install_recommends: False</pre> <dl> <dt>only_upgrade</dt>
<dd>
<p>Only upgrade the packages, if they are already installed. Default is <code class="docutils literal notranslate"><span class="pre">False</span></code>. Currently only works with APT-based systems.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2015.5.0.</span></p> </div> </dd> </dl> <pre class="highlight-yaml notranslate" data-language="yaml">httpd:
  pkg.latest:
    - only_upgrade: True</pre> <div class="admonition note"> <p class="admonition-title">Note</p> <p>If this parameter is set to True and the package is not already installed, the state will fail.</p> </div> </div>
</blockquote> <dl> <dt>report_reboot_exit_codes</dt>
<dd>
<p>If the installer exits with a recognized exit code indicating that a reboot is required, the module function</p> <blockquote> <div>
<p><em>win_system.set_reboot_required_witnessed</em></p> </div>
</blockquote> <p>will be called, preserving the knowledge of this event for the remainder of the current boot session. For the time being, <code class="docutils literal notranslate"><span class="pre">3010</span></code> is the only recognized exit code, but this is subject to future refinement. The value of this param defaults to <code class="docutils literal notranslate"><span class="pre">True</span></code>. This parameter has no effect on non-Windows systems.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2016.11.0.</span></p> </div> <pre class="highlight-yaml notranslate" data-language="yaml">ms vcpp installed:
  pkg.latest:
    - name: ms-vcpp
    - report_reboot_exit_codes: False</pre> </dd> </dl> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.pkg.mod_aggregate"> salt.states.pkg.mod_aggregate(low, chunks, running)</h3> <dd>
<p>The mod_aggregate function which looks up all packages in the available low chunks and merges them into a single pkgs ref in the present low data</p> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.pkg.mod_beacon"> salt.states.pkg.mod_beacon(name, **kwargs)</h3> <dd>
<p>Create a beacon to monitor a package or packages based on a beacon state argument.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This state exists to support special handling of the <code class="docutils literal notranslate"><span class="pre">beacon</span></code> state argument for supported state functions. It should not be called directly.</p> </div> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.pkg.mod_watch"> salt.states.pkg.mod_watch(name, **kwargs)</h3> <dd>
<p>Install/reinstall a package based on a watch requisite</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This state exists to support special handling of the <code class="docutils literal notranslate"><span class="pre">watch</span></code> <a class="reference internal" href="https://docs.saltproject.io/en/latest/ref/states/requisites.html#requisites"><span class="std std-ref">requisite</span></a>. It should not be called directly.</p> <p>Parameters for this function should be set by the state being triggered.</p> </div> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.pkg.patch_downloaded"> salt.states.pkg.patch_downloaded(name, advisory_ids=None, **kwargs)</h3> <dd>
<div class="versionadded"> <p><span class="versionmodified added">New in version 2017.7.0.</span></p> </div> <p>Ensure that packages related to certain advisory ids are downloaded.</p> <p>Currently supported for the following pkg providers: <a class="reference internal" href="../../modules/all/salt.modules.yumpkg.html#module-salt.modules.yumpkg" title="salt.modules.yumpkg"><code class="xref py py-mod docutils literal notranslate"><span class="pre">yumpkg</span></code></a> and <code class="xref py py-mod docutils literal notranslate"><span class="pre">zypper</span></code></p> <p>CLI Example:</p> <pre class="highlight-yaml notranslate" data-language="yaml">preparing-to-fix-issues:
  pkg.patch_downloaded:
    - advisory_ids:
      - SUSE-SLE-SERVER-12-SP2-2017-185
      - SUSE-SLE-SERVER-12-SP2-2017-150
      - SUSE-SLE-SERVER-12-SP2-2017-120</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.pkg.patch_installed"> salt.states.pkg.patch_installed(name, advisory_ids=None, downloadonly=None, **kwargs)</h3> <dd>
<div class="versionadded"> <p><span class="versionmodified added">New in version 2017.7.0.</span></p> </div> <p>Ensure that packages related to certain advisory ids are installed.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>Any argument which is either a) not explicitly defined for this state, or b) not a global state argument like <code class="docutils literal notranslate"><span class="pre">saltenv</span></code>, or <code class="docutils literal notranslate"><span class="pre">reload_modules</span></code>, will be passed through to the call to <code class="docutils literal notranslate"><span class="pre">pkg.install</span></code> to install the patch(es).</p> <p>To see what is supported, check <a class="reference internal" href="../../modules/all/salt.modules.pkg.html#virtual-pkg"><span class="std std-ref">this page</span></a> to find the documentation for your platform's <code class="docutils literal notranslate"><span class="pre">pkg</span></code> module, then look at the documentation for the <code class="docutils literal notranslate"><span class="pre">install</span></code> function.</p> <p>Any argument that is passed through to the <code class="docutils literal notranslate"><span class="pre">install</span></code> function, which is not defined for that function, will be silently ignored.</p> </div> <p>Currently supported for the following pkg providers: <a class="reference internal" href="../../modules/all/salt.modules.yumpkg.html#module-salt.modules.yumpkg" title="salt.modules.yumpkg"><code class="xref py py-mod docutils literal notranslate"><span class="pre">yumpkg</span></code></a> and <code class="xref py py-mod docutils literal notranslate"><span class="pre">zypper</span></code></p> <p>CLI Example:</p> <pre class="highlight-yaml notranslate" data-language="yaml">issue-foo-fixed:
  pkg.patch_installed:
    - advisory_ids:
      - SUSE-SLE-SERVER-12-SP2-2017-185
      - SUSE-SLE-SERVER-12-SP2-2017-150
      - SUSE-SLE-SERVER-12-SP2-2017-120</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.pkg.purged"> salt.states.pkg.purged(name, version=None, pkgs=None, normalize=True, ignore_epoch=None, **kwargs)</h3> <dd>
<p>Verify that a package is not installed, calling <code class="docutils literal notranslate"><span class="pre">pkg.purge</span></code> if necessary to purge the package. All configuration files are also removed.</p> <dl> <dt>name</dt>
<dd>
<p>The name of the package to be purged.</p> </dd> <dt>version</dt>
<dd>
<p>The version of the package that should be removed. Don't do anything if the package is installed with an unmatching version.</p> <div class="admonition important"> <p class="admonition-title">Important</p> <p>As of version 2015.8.7, for distros which use yum/dnf, packages which have a version with a nonzero epoch (that is, versions which start with a number followed by a colon like in the example above) must have the epoch included when specifying the version number. For example:</p> <pre class="highlight-yaml notranslate" data-language="yaml">vim-enhanced:
  pkg.purged:
    - version: 2:7.4.160-1.el7</pre> <p>In version 2015.8.9, an <strong>ignore_epoch</strong> argument has been added to <a class="reference internal" href="#salt.states.pkg.installed" title="salt.states.pkg.installed"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pkg.installed</span></code></a>, <a class="reference internal" href="#salt.states.pkg.removed" title="salt.states.pkg.removed"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pkg.removed</span></code></a>, and <a class="reference internal" href="#salt.states.pkg.purged" title="salt.states.pkg.purged"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pkg.purged</span></code></a> states, which causes the epoch to be disregarded when the state checks to see if the desired version was installed. If <strong>ignore_epoch</strong> was not set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, and instead of <code class="docutils literal notranslate"><span class="pre">2:7.4.160-1.el7</span></code> a version of <code class="docutils literal notranslate"><span class="pre">7.4.160-1.el7</span></code> were used, this state would report success since the actual installed version includes the epoch, and the specified version would not match.</p> </div> </dd> <dt>normalize<span class="classifier">True</span>
</dt>
<dd>
<p>Normalize the package name by removing the architecture, if the architecture of the package is different from the architecture of the operating system. The ability to disable this behavior is useful for poorly-created packages which include the architecture as an actual part of the name, such as kernel modules which match a specific kernel version.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2015.8.0.</span></p> </div> </dd> <dt>ignore_epoch<span class="classifier">None</span>
</dt>
<dd>
<p>If this option is not explicitly set, and there is no epoch in the desired package version, the epoch will be implicitly ignored. Set this argument to <code class="docutils literal notranslate"><span class="pre">True</span></code> to explicitly ignore the epoch, and <code class="docutils literal notranslate"><span class="pre">False</span></code> to strictly enforce it.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2015.8.9.</span></p> </div> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 3001: </span>In prior releases, the default behavior was to strictly enforce epochs unless this argument was set to <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p> </div> </dd> </dl> <p>Multiple Package Options:</p> <dl> <dt>pkgs</dt>
<dd>
<p>A list of packages to purge. Must be passed as a python list. The <code class="docutils literal notranslate"><span class="pre">name</span></code> parameter will be ignored if this option is passed. It accepts version numbers as well.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 0.16.0.</span></p> </div> </dd> </dl> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.pkg.removed"> salt.states.pkg.removed(name, version=None, pkgs=None, normalize=True, ignore_epoch=None, **kwargs)</h3> <dd>
<p>Verify that a package is not installed, calling <code class="docutils literal notranslate"><span class="pre">pkg.remove</span></code> if necessary to remove the package.</p> <dl> <dt>name</dt>
<dd>
<p>The name of the package to be removed.</p> </dd> <dt>version</dt>
<dd>
<p>The version of the package that should be removed. Don't do anything if the package is installed with an unmatching version.</p> <div class="admonition important"> <p class="admonition-title">Important</p> <p>As of version 2015.8.7, for distros which use yum/dnf, packages which have a version with a nonzero epoch (that is, versions which start with a number followed by a colon like in the example above) must have the epoch included when specifying the version number. For example:</p> <pre class="highlight-yaml notranslate" data-language="yaml">vim-enhanced:
  pkg.removed:
    - version: 2:7.4.160-1.el7</pre> <p>In version 2015.8.9, an <strong>ignore_epoch</strong> argument has been added to <a class="reference internal" href="#salt.states.pkg.installed" title="salt.states.pkg.installed"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pkg.installed</span></code></a>, <a class="reference internal" href="#salt.states.pkg.removed" title="salt.states.pkg.removed"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pkg.removed</span></code></a>, and <a class="reference internal" href="#salt.states.pkg.purged" title="salt.states.pkg.purged"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pkg.purged</span></code></a> states, which causes the epoch to be disregarded when the state checks to see if the desired version was installed. If <strong>ignore_epoch</strong> was not set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, and instead of <code class="docutils literal notranslate"><span class="pre">2:7.4.160-1.el7</span></code> a version of <code class="docutils literal notranslate"><span class="pre">7.4.160-1.el7</span></code> were used, this state would report success since the actual installed version includes the epoch, and the specified version would not match.</p> </div> </dd> <dt>normalize<span class="classifier">True</span>
</dt>
<dd>
<p>Normalize the package name by removing the architecture, if the architecture of the package is different from the architecture of the operating system. The ability to disable this behavior is useful for poorly-created packages which include the architecture as an actual part of the name, such as kernel modules which match a specific kernel version.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2015.8.0.</span></p> </div> </dd> <dt>ignore_epoch<span class="classifier">None</span>
</dt>
<dd>
<p>If this option is not explicitly set, and there is no epoch in the desired package version, the epoch will be implicitly ignored. Set this argument to <code class="docutils literal notranslate"><span class="pre">True</span></code> to explicitly ignore the epoch, and <code class="docutils literal notranslate"><span class="pre">False</span></code> to strictly enforce it.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2015.8.9.</span></p> </div> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 3001: </span>In prior releases, the default behavior was to strictly enforce epochs unless this argument was set to <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p> </div> </dd> </dl> <p>Multiple Package Options:</p> <dl> <dt>pkgs</dt>
<dd>
<p>A list of packages to remove. Must be passed as a python list. The <code class="docutils literal notranslate"><span class="pre">name</span></code> parameter will be ignored if this option is passed. It accepts version numbers as well.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 0.16.0.</span></p> </div> </dd> </dl> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.pkg.uptodate"> salt.states.pkg.uptodate(name, refresh=False, pkgs=None, **kwargs)</h3> <dd>
<div class="versionadded"> <p><span class="versionmodified added">New in version 2014.7.0.</span></p> </div> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 2018.3.0: </span>Added support for the <code class="docutils literal notranslate"><span class="pre">pkgin</span></code> provider.</p> </div> <p>Verify that the system is completely up to date.</p> <dl class="simple"> <dt>name</dt>
<dd>
<p>The name has no functional value and is only used as a tracking reference</p> </dd> <dt>refresh</dt>
<dd>
<p>refresh the package database before checking for new upgrades</p> </dd> <dt>pkgs</dt>
<dd>
<p>list of packages to upgrade</p> </dd> </dl> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li>
<p><strong>cache_valid_time</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- </p>
<p>This parameter sets the value in seconds after which cache marked as invalid, and cache update is necessary. This overwrite <code class="docutils literal notranslate"><span class="pre">refresh</span></code> parameter default behavior.</p> <p>In this case cache_valid_time is set, refresh will not take place for amount in seconds since last <code class="docutils literal notranslate"><span class="pre">apt-get</span> <span class="pre">update</span></code> executed on the system.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This parameter available only on Debian based distributions, and have no effect on the rest.</p> </div> </li> <li>
<p><strong>resolve_capabilities</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- </p>
<p>Turn on resolving capabilities. This allow one to name "provides" or alias names for packages.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2018.3.0.</span></p> </div> </li> </ul> </dd> </dl> <dl> <dt>kwargs</dt>
<dd>
<p>Any keyword arguments to pass through to <code class="docutils literal notranslate"><span class="pre">pkg.upgrade</span></code>.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2015.5.0.</span></p> </div> </dd> </dl> </dd>
</dl> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2021 SaltStack.<br>Licensed under the Apache License, Version 2.0.<br>
    <a href="https://docs.saltproject.io/en/latest/ref/states/all/salt.states.pkg.html" class="_attribution-link">https://docs.saltproject.io/en/latest/ref/states/all/salt.states.pkg.html</a>
  </p>
</div>
