<h1>salt.states.loop</h1> <p>Loop state</p> <p>Allows for looping over execution modules.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2017.7.0.</span></p> </div> <p>In both examples below, the execution module function <code class="docutils literal notranslate"><span class="pre">boto_elb.get_instance_health</span></code> returns a list of dicts. The condition checks the <code class="docutils literal notranslate"><span class="pre">state</span></code>-key of the first dict in the returned list and compares its value to the string <cite>InService</cite>.</p> <pre class="highlight-yaml notranslate" data-language="yaml">wait_for_service_to_be_healthy:
  loop.until:
    - name: boto_elb.get_instance_health
    - condition: m_ret[0]['state'] == 'InService'
    - period: 5
    - timeout: 20
    - m_args:
      - {{ elb }}
    - m_kwargs:
        keyid: {{ access_key }}
        key: {{ secret_key }}
        instances: "{{ instance }}"</pre> <div class="admonition warning"> <p class="admonition-title">Warning</p> <p>This state allows arbitrary python code to be executed through the condition parameter which is literally evaluated within the state. Please use caution.</p> </div> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 3000.</span></p> </div> <p>A version that does not use eval is now available. It uses either the python <code class="docutils literal notranslate"><span class="pre">operator</span></code> to compare the result of the function called in <code class="docutils literal notranslate"><span class="pre">name</span></code>, which can be one of the following: lt, le, eq (default), ne, ge, gt. Alternatively, <cite>compare_operator</cite> can be filled with a function from an execution module in <code class="docutils literal notranslate"><span class="pre">__salt__</span></code> or <code class="docutils literal notranslate"><span class="pre">__utils__</span></code> like the example below. The function <code class="xref py py-func docutils literal notranslate"><span class="pre">data.subdict_match</span></code> checks if the <code class="docutils literal notranslate"><span class="pre">expected</span></code> expression matches the data returned by calling the <code class="docutils literal notranslate"><span class="pre">name</span></code> function (with passed <code class="docutils literal notranslate"><span class="pre">args</span></code> and <code class="docutils literal notranslate"><span class="pre">kwargs</span></code>).</p> <pre class="highlight-yaml notranslate" data-language="yaml">Wait for service to be healthy:
  loop.until_no_eval:
    - name: boto_elb.get_instance_health
    - expected: '0:state:InService'
    - compare_operator: data.subdict_match
    - period: 5
    - timeout: 20
    - args:
      - {{ elb }}
    - kwargs:
        keyid: {{ access_key }}
        key: {{ secret_key }}
        instances: "{{ instance }}"</pre> <dl class="py function"> <h3 id="salt.states.loop.until"> salt.states.loop.until(name, m_args=None, m_kwargs=None, condition=None, period=1, timeout=60)</h3> <dd>
<p>Loop over an execution module until a condition is met.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li><p><strong>name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The name of the execution module</p></li> <li><p><strong>m_args</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><em>list</em></a>) -- The execution module's positional arguments</p></li> <li><p><strong>m_kwargs</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><em>dict</em></a>) -- The execution module's keyword arguments</p></li> <li><p><strong>condition</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The condition which must be met for the loop to break. This should contain <code class="docutils literal notranslate"><span class="pre">m_ret</span></code> which is the return from the execution module.</p></li> <li><p><strong>period</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a><em> or </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a>) -- The number of seconds to wait between executions</p></li> <li><p><strong>timeout</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a><em> or </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a>) -- The timeout in seconds</p></li> </ul> </dd> </dl> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.loop.until_no_eval"> salt.states.loop.until_no_eval(name, expected, compare_operator='eq', timeout=60, period=1, init_wait=0, args=None, kwargs=None)</h3> <dd>
<p>Generic waiter state that waits for a specific salt function to produce an expected result. The state fails if the function does not exist or raises an exception, or does not produce the expected result within the allotted retries.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li><p><strong>name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- Name of the module.function to call</p></li> <li><p><strong>expected</strong> -- Expected return value. This can be almost anything.</p></li> <li><p><strong>compare_operator</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- Operator to use to compare the result of the module.function call with the expected value. This can be anything present in __salt__ or __utils__. Will be called with 2 args: result, expected.</p></li> <li><p><strong>timeout</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a><em> or </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a>) -- Abort after this amount of seconds (excluding init_wait).</p></li> <li><p><strong>period</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a><em> or </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a>) -- Time (in seconds) to wait between attempts.</p></li> <li><p><strong>init_wait</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a><em> or </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a>) -- Time (in seconds) to wait before trying anything.</p></li> <li><p><strong>args</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><em>list</em></a>) -- args to pass to the salt module.function.</p></li> <li><p><strong>kwargs</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><em>dict</em></a>) -- kwargs to pass to the salt module.function.</p></li> </ul> </dd> </dl> <div class="versionadded"> <p><span class="versionmodified added">New in version 3000.</span></p> </div> </dd>
</dl><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2021 SaltStack.<br>Licensed under the Apache License, Version 2.0.<br>
    <a href="https://docs.saltproject.io/en/latest/ref/states/all/salt.states.loop.html" class="_attribution-link">https://docs.saltproject.io/en/latest/ref/states/all/salt.states.loop.html</a>
  </p>
</div>
