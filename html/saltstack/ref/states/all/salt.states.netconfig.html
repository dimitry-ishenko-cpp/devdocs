<h1>salt.states.netconfig</h1> <div class="section" id="network-config"> <h2>Network Config</h2> <p>Manage the configuration on a network device given a specific static config or template.</p> <dl class="field-list simple"> <dt class="field-odd">codeauthor</dt> <dd class="field-odd">
<p>Mircea Ulinic &lt;<a class="reference external" href="mailto:ping%40mirceaulinic.net.html">ping<span>@</span>mirceaulinic<span>.</span>net</a>&gt; &amp; Jerome Fleury &lt;<a class="reference external" href="mailto:jf%40cloudflare.com.html">jf<span>@</span>cloudflare<span>.</span>com</a>&gt;</p> </dd> <dt class="field-even">maturity</dt> <dd class="field-even">
<p>new</p> </dd> <dt class="field-odd">depends</dt> <dd class="field-odd">
<p>napalm</p> </dd> <dt class="field-even">platform</dt> <dd class="field-even">
<p>unix</p> </dd> </dl> <div class="section" id="dependencies"> <h3>Dependencies</h3> <ul class="simple"> <li><p><a class="reference internal" href="../../proxy/all/salt.proxy.napalm.html#module-salt.proxy.napalm" title="salt.proxy.napalm"><code class="xref py py-mod docutils literal notranslate"><span class="pre">NAPALM</span> <span class="pre">proxy</span> <span class="pre">minion</span></code></a></p></li> <li><p><a class="reference internal" href="../../modules/all/salt.modules.napalm_network.html#module-salt.modules.napalm_network" title="salt.modules.napalm_network"><code class="xref py py-mod docutils literal notranslate"><span class="pre">Network-related</span> <span class="pre">basic</span> <span class="pre">features</span> <span class="pre">execution</span> <span class="pre">module</span></code></a></p></li> </ul> <div class="versionadded"> <p><span class="versionmodified added">New in version 2017.7.0.</span></p> </div> <dl class="py function"> <h3 id="salt.states.netconfig.commit_cancelled"> salt.states.netconfig.commit_cancelled(name)</h3> <dd>
<div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> <p>Cancel a commit scheduled to be executed via the <code class="docutils literal notranslate"><span class="pre">commit_in</span></code> and <code class="docutils literal notranslate"><span class="pre">commit_at</span></code> arguments from the <a class="reference internal" href="../../modules/all/salt.modules.napalm_network.html#salt.modules.napalm_network.load_template" title="salt.modules.napalm_network.load_template"><code class="xref py py-func docutils literal notranslate"><span class="pre">net.load_template</span></code></a> or <a class="reference internal" href="../../modules/all/salt.modules.napalm_network.html#salt.modules.napalm_network.load_config" title="salt.modules.napalm_network.load_config"><code class="xref py py-func docutils literal notranslate"><span class="pre">net.load_config</span></code></a> execution functions. The commit ID is displayed when the commit is scheduled via the functions named above.</p> <p>State SLS Example:</p> <pre class="highlight-yaml notranslate" data-language="yaml">'20180726083540640360':
  netconfig.commit_cancelled</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.netconfig.commit_confirmed"> salt.states.netconfig.commit_confirmed(name)</h3> <dd>
<div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> <p>Confirm a commit scheduled to be reverted via the <code class="docutils literal notranslate"><span class="pre">revert_in</span></code> and <code class="docutils literal notranslate"><span class="pre">revert_at</span></code> arguments from the <a class="reference internal" href="../../modules/all/salt.modules.napalm_network.html#salt.modules.napalm_network.load_template" title="salt.modules.napalm_network.load_template"><code class="xref py py-mod docutils literal notranslate"><span class="pre">net.load_template</span></code></a> or <a class="reference internal" href="../../modules/all/salt.modules.napalm_network.html#salt.modules.napalm_network.load_config" title="salt.modules.napalm_network.load_config"><code class="xref py py-mod docutils literal notranslate"><span class="pre">net.load_config</span></code></a> execution functions. The commit ID is displayed when the commit confirmed is scheduled via the functions named above.</p> <p>State SLS Example:</p> <pre class="highlight-yaml notranslate" data-language="yaml">'20180726083540640360':
  netconfig.commit_confirmed</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.netconfig.managed"> salt.states.netconfig.managed(name, template_name=None, template_source=None, template_hash=None, template_hash_name=None, saltenv='base', template_engine='jinja', skip_verify=False, context=None, defaults=None, test=False, commit=True, debug=False, replace=False, commit_in=None, commit_at=None, revert_in=None, revert_at=None, **template_vars)</h3> <dd>
<p>Manages the configuration on network devices.</p> <p>By default this state will commit the changes on the device. If there are no changes required, it does not commit and the field <code class="docutils literal notranslate"><span class="pre">already_configured</span></code> from the output dictionary will be set as <code class="docutils literal notranslate"><span class="pre">True</span></code> to notify that.</p> <p>To avoid committing the configuration, set the argument <code class="docutils literal notranslate"><span class="pre">test</span></code> to <code class="docutils literal notranslate"><span class="pre">True</span></code> (or via the CLI argument <code class="docutils literal notranslate"><span class="pre">test=True</span></code>) and will discard (dry run).</p> <p>To preserve the changes, set <code class="docutils literal notranslate"><span class="pre">commit</span></code> to <code class="docutils literal notranslate"><span class="pre">False</span></code> (either as CLI argument, either as state parameter). However, this is recommended to be used only in exceptional cases when there are applied few consecutive states and/or configuration changes. Otherwise the user might forget that the config DB is locked and the candidate config buffer is not cleared/merged in the running config.</p> <p>To replace the config, set <code class="docutils literal notranslate"><span class="pre">replace</span></code> to <code class="docutils literal notranslate"><span class="pre">True</span></code>. This option is recommended to be used with caution!</p> <dl> <dt>template_name</dt>
<dd>
<p>Identifies path to the template source. The template can be either stored on the local machine, either remotely. The recommended location is under the <code class="docutils literal notranslate"><span class="pre">file_roots</span></code> as specified in the master config file. For example, let's suppose the <code class="docutils literal notranslate"><span class="pre">file_roots</span></code> is configured as:</p> <pre class="highlight-yaml notranslate" data-language="yaml">file_roots:
  base:
     - /etc/salt/states</pre> <p>Placing the template under <code class="docutils literal notranslate"><span class="pre">/etc/salt/states/templates/example.jinja</span></code>, it can be used as <code class="docutils literal notranslate"><span class="pre">salt://templates/example.jinja</span></code>. Alternatively, for local files, the user can specify the absolute path. If remotely, the source can be retrieved via <code class="docutils literal notranslate"><span class="pre">http</span></code>, <code class="docutils literal notranslate"><span class="pre">https</span></code> or <code class="docutils literal notranslate"><span class="pre">ftp</span></code>.</p> <p>Examples:</p> <ul class="simple"> <li><p><code class="docutils literal notranslate"><span class="pre">salt://my_template.jinja</span></code></p></li> <li><p><code class="docutils literal notranslate"><span class="pre">/absolute/path/to/my_template.jinja</span></code></p></li> <li><p><code class="docutils literal notranslate"><span class="pre">http://example.com/template.cheetah</span></code></p></li> <li><p><code class="docutils literal notranslate"><span class="pre">https:/example.com/template.mako</span></code></p></li> <li><p><code class="docutils literal notranslate"><span class="pre">ftp://example.com/template.py</span></code></p></li> </ul> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 2019.2.0: </span>This argument can now support a list of templates to be rendered. The resulting configuration text is loaded at once, as a single configuration chunk.</p> </div> </dd> <dt>template_source: None</dt>
<dd>
<p>Inline config template to be rendered and loaded on the device.</p> </dd> <dt>template_hash: None</dt>
<dd>
<p>Hash of the template file. Format: <code class="docutils literal notranslate"><span class="pre">{hash_type:</span> <span class="pre">'md5',</span> <span class="pre">'hsum':</span> <span class="pre">&lt;md5sum&gt;}</span></code></p> </dd> <dt>template_hash_name: None</dt>
<dd>
<p>When <code class="docutils literal notranslate"><span class="pre">template_hash</span></code> refers to a remote file, this specifies the filename to look for in that file.</p> </dd> <dt>saltenv: base</dt>
<dd>
<p>Specifies the template environment. This will influence the relative imports inside the templates.</p> </dd> <dt>template_engine: jinja</dt>
<dd>
<p>The following templates engines are supported:</p> <ul class="simple"> <li><p><a class="reference internal" href="../../renderers/all/salt.renderers.cheetah.html#module-salt.renderers.cheetah" title="salt.renderers.cheetah"><code class="xref py py-mod docutils literal notranslate"><span class="pre">cheetah</span></code></a></p></li> <li><p><a class="reference internal" href="../../renderers/all/salt.renderers.genshi.html#module-salt.renderers.genshi" title="salt.renderers.genshi"><code class="xref py py-mod docutils literal notranslate"><span class="pre">genshi</span></code></a></p></li> <li><p><a class="reference internal" href="../../renderers/all/salt.renderers.jinja.html#module-salt.renderers.jinja" title="salt.renderers.jinja"><code class="xref py py-mod docutils literal notranslate"><span class="pre">jinja</span></code></a></p></li> <li><p><a class="reference internal" href="../../renderers/all/salt.renderers.mako.html#module-salt.renderers.mako" title="salt.renderers.mako"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mako</span></code></a></p></li> <li><p><a class="reference internal" href="../../renderers/all/salt.renderers.py.html#module-salt.renderers.py" title="salt.renderers.py"><code class="xref py py-mod docutils literal notranslate"><span class="pre">py</span></code></a></p></li> <li><p><a class="reference internal" href="../../renderers/all/salt.renderers.wempy.html#module-salt.renderers.wempy" title="salt.renderers.wempy"><code class="xref py py-mod docutils literal notranslate"><span class="pre">wempy</span></code></a></p></li> </ul> </dd> <dt>skip_verify: False</dt>
<dd>
<p>If <code class="docutils literal notranslate"><span class="pre">True</span></code>, hash verification of remote file sources (<code class="docutils literal notranslate"><span class="pre">http://</span></code>, <code class="docutils literal notranslate"><span class="pre">https://</span></code>, <code class="docutils literal notranslate"><span class="pre">ftp://</span></code>) will be skipped, and the <code class="docutils literal notranslate"><span class="pre">source_hash</span></code> argument will be ignored.</p> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 2017.7.1.</span></p> </div> </dd> <dt>test: False</dt>
<dd>
<p>Dry run? If set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, will apply the config, discard and return the changes. Default: <code class="docutils literal notranslate"><span class="pre">False</span></code> (will commit the changes on the device).</p> </dd> <dt>commit: True</dt>
<dd>
<p>Commit? Default: <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p> </dd> <dt>debug: False</dt>
<dd>
<p>Debug mode. Will insert a new key under the output dictionary, as <code class="docutils literal notranslate"><span class="pre">loaded_config</span></code> containing the raw result after the template was rendered.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This argument cannot be used directly on the command line. Instead, it can be passed through the <code class="docutils literal notranslate"><span class="pre">pillar</span></code> variable when executing either of the <a class="reference internal" href="../../modules/all/salt.modules.state.html#salt.modules.state.sls" title="salt.modules.state.sls"><code class="xref py py-func docutils literal notranslate"><span class="pre">state.sls</span></code></a> or <code class="xref py py-func docutils literal notranslate"><span class="pre">state.apply</span></code> (see below for an example).</p> </div> </dd> <dt>commit_in: <code class="docutils literal notranslate"><span class="pre">None</span></code>
</dt>
<dd>
<p>Commit the changes in a specific number of minutes / hours. Example of accepted formats: <code class="docutils literal notranslate"><span class="pre">5</span></code> (commit in 5 minutes), <code class="docutils literal notranslate"><span class="pre">2m</span></code> (commit in 2 minutes), <code class="docutils literal notranslate"><span class="pre">1h</span></code> (commit the changes in 1 hour)`, <code class="docutils literal notranslate"><span class="pre">5h30m</span></code> (commit the changes in 5 hours and 30 minutes).</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This feature works on any platforms, as it does not rely on the native features of the network operating system.</p> </div> <div class="admonition note"> <p class="admonition-title">Note</p> <p>After the command is executed and the <code class="docutils literal notranslate"><span class="pre">diff</span></code> is not satisfactory, or for any other reasons you have to discard the commit, you are able to do so using the <a class="reference internal" href="../../modules/all/salt.modules.napalm_network.html#salt.modules.napalm_network.cancel_commit" title="salt.modules.napalm_network.cancel_commit"><code class="xref py py-func docutils literal notranslate"><span class="pre">net.cancel_commit</span></code></a> execution function, using the commit ID returned by this function.</p> </div> <div class="admonition warning"> <p class="admonition-title">Warning</p> <p>Using this feature, Salt will load the exact configuration you expect, however the diff may change in time (i.e., if an user applies a manual configuration change, or a different process or command changes the configuration in the meanwhile).</p> </div> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </dd> <dt>commit_at: <code class="docutils literal notranslate"><span class="pre">None</span></code>
</dt>
<dd>
<p>Commit the changes at a specific time. Example of accepted formats: <code class="docutils literal notranslate"><span class="pre">1am</span></code> (will commit the changes at the next 1AM), <code class="docutils literal notranslate"><span class="pre">13:20</span></code> (will commit at 13:20), <code class="docutils literal notranslate"><span class="pre">1:20am</span></code>, etc.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This feature works on any platforms, as it does not rely on the native features of the network operating system.</p> </div> <div class="admonition note"> <p class="admonition-title">Note</p> <p>After the command is executed and the <code class="docutils literal notranslate"><span class="pre">diff</span></code> is not satisfactory, or for any other reasons you have to discard the commit, you are able to do so using the <a class="reference internal" href="../../modules/all/salt.modules.napalm_network.html#salt.modules.napalm_network.cancel_commit" title="salt.modules.napalm_network.cancel_commit"><code class="xref py py-func docutils literal notranslate"><span class="pre">net.cancel_commit</span></code></a> execution function, using the commit ID returned by this function.</p> </div> <div class="admonition warning"> <p class="admonition-title">Warning</p> <p>Using this feature, Salt will load the exact configuration you expect, however the diff may change in time (i.e., if an user applies a manual configuration change, or a different process or command changes the configuration in the meanwhile).</p> </div> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </dd> <dt>revert_in: <code class="docutils literal notranslate"><span class="pre">None</span></code>
</dt>
<dd>
<p>Commit and revert the changes in a specific number of minutes / hours. Example of accepted formats: <code class="docutils literal notranslate"><span class="pre">5</span></code> (revert in 5 minutes), <code class="docutils literal notranslate"><span class="pre">2m</span></code> (revert in 2 minutes), <code class="docutils literal notranslate"><span class="pre">1h</span></code> (revert the changes in 1 hour)`, <code class="docutils literal notranslate"><span class="pre">5h30m</span></code> (revert the changes in 5 hours and 30 minutes).</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>To confirm the commit, and prevent reverting the changes, you will have to execute the <a class="reference internal" href="../../modules/all/salt.modules.napalm_network.html#salt.modules.napalm_network.confirm_commit" title="salt.modules.napalm_network.confirm_commit"><code class="xref py py-mod docutils literal notranslate"><span class="pre">net.confirm_commit</span></code></a> function, using the commit ID returned by this function.</p> </div> <div class="admonition warning"> <p class="admonition-title">Warning</p> <p>This works on any platform, regardless if they have or don't have native capabilities to confirming a commit. However, please be <em>very</em> cautious when using this feature: on Junos (as it is the only NAPALM core platform supporting this natively) it executes a commit confirmed as you would do from the command line. All the other platforms don't have this capability natively, therefore the revert is done via Salt. That means, your device needs to be reachable at the moment when Salt will attempt to revert your changes. Be cautious when pushing configuration changes that would prevent you reach the device.</p> <p>Similarly, if an user or a different process apply other configuration changes in the meanwhile (between the moment you commit and till the changes are reverted), these changes would be equally reverted, as Salt cannot be aware of them.</p> </div> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </dd> <dt>revert_at: <code class="docutils literal notranslate"><span class="pre">None</span></code>
</dt>
<dd>
<p>Commit and revert the changes at a specific time. Example of accepted formats: <code class="docutils literal notranslate"><span class="pre">1am</span></code> (will commit and revert the changes at the next 1AM), <code class="docutils literal notranslate"><span class="pre">13:20</span></code> (will commit and revert at 13:20), <code class="docutils literal notranslate"><span class="pre">1:20am</span></code>, etc.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>To confirm the commit, and prevent reverting the changes, you will have to execute the <a class="reference internal" href="../../modules/all/salt.modules.napalm_network.html#salt.modules.napalm_network.confirm_commit" title="salt.modules.napalm_network.confirm_commit"><code class="xref py py-mod docutils literal notranslate"><span class="pre">net.confirm_commit</span></code></a> function, using the commit ID returned by this function.</p> </div> <div class="admonition warning"> <p class="admonition-title">Warning</p> <p>This works on any platform, regardless if they have or don't have native capabilities to confirming a commit. However, please be <em>very</em> cautious when using this feature: on Junos (as it is the only NAPALM core platform supporting this natively) it executes a commit confirmed as you would do from the command line. All the other platforms don't have this capability natively, therefore the revert is done via Salt. That means, your device needs to be reachable at the moment when Salt will attempt to revert your changes. Be cautious when pushing configuration changes that would prevent you reach the device.</p> <p>Similarly, if an user or a different process apply other configuration changes in the meanwhile (between the moment you commit and till the changes are reverted), these changes would be equally reverted, as Salt cannot be aware of them.</p> </div> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </dd> <dt>replace: False</dt>
<dd>
<p>Load and replace the configuration. Default: <code class="docutils literal notranslate"><span class="pre">False</span></code> (will apply load merge).</p> </dd> <dt>context: None</dt>
<dd>
<p>Overrides default context variables passed to the template.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </dd> <dt>defaults: None</dt>
<dd>
<p>Default variables/context passed to the template.</p> </dd> <dt>template_vars</dt>
<dd>
<p>Dictionary with the arguments/context to be used when the template is rendered. Do not explicitly specify this argument. This represents any other variable that will be sent to the template rendering system. Please see an example below! In both <code class="docutils literal notranslate"><span class="pre">ntp_peers_example_using_pillar</span></code> and <code class="docutils literal notranslate"><span class="pre">ntp_peers_example</span></code>, <code class="docutils literal notranslate"><span class="pre">peers</span></code> is sent as template variable.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>It is more recommended to use the <code class="docutils literal notranslate"><span class="pre">context</span></code> argument instead, to avoid any conflicts with other arguments.</p> </div> </dd> </dl> <p>SLS Example (e.g.: under salt://router/config.sls) :</p> <pre class="highlight-yaml notranslate" data-language="yaml">whole_config_example:
    netconfig.managed:
        - template_name: salt://path/to/complete_config.jinja
        - debug: True
        - replace: True
bgp_config_example:
    netconfig.managed:
        - template_name: /absolute/path/to/bgp_neighbors.mako
        - template_engine: mako
prefix_lists_example:
    netconfig.managed:
        - template_name: prefix_lists.cheetah
        - debug: True
        - template_engine: cheetah
ntp_peers_example:
    netconfig.managed:
        - template_name: http://bit.ly/2gKOj20
        - skip_verify: False
        - debug: True
        - peers:
            - 192.168.0.1
            - 192.168.0.1
ntp_peers_example_using_pillar:
    netconfig.managed:
        - template_name: http://bit.ly/2gKOj20
        - peers: {{ pillar.get('ntp.peers', []) }}</pre> <p>Multi template example:</p> <pre class="highlight-yaml notranslate" data-language="yaml">hostname_and_ntp:
  netconfig.managed:
    - template_name:
        - https://bit.ly/2OhSgqP
        - https://bit.ly/2M6C4Lx
        - https://bit.ly/2OIWVTs
    - debug: true
    - context:
        hostname: {{ opts.id }}
        servers:
          - 172.17.17.1
          - 172.17.17.2
        peers:
          - 192.168.0.1
          - 192.168.0.2</pre> <p>Usage examples:</p> <pre class="highlight-bash notranslate" data-language="bash">$ sudo salt 'juniper.device' state.sls router.config test=True

$ sudo salt -N all-routers state.sls router.config pillar="{'debug': True}"</pre> <p><code class="docutils literal notranslate"><span class="pre">router.config</span></code> depends on the location of the SLS file (see above). Running this command, will be executed all five steps from above. These examples above are not meant to be used in a production environment, their sole purpose is to provide usage examples.</p> <p>Output example:</p> <pre class="highlight-bash notranslate" data-language="bash">$ sudo salt 'juniper.device' state.sls router.config test=True
juniper.device:
----------
          ID: ntp_peers_example_using_pillar
    Function: netconfig.managed
      Result: None
     Comment: Testing mode: Configuration discarded.
     Started: 12:01:40.744535
    Duration: 8755.788 ms
     Changes:
              ----------
              diff:
                  [edit system ntp]
                       peer 192.168.0.1 { ... }
                  +    peer 172.17.17.1;
                  +    peer 172.17.17.3;

Summary for juniper.device
------------
Succeeded: 1 (unchanged=1, changed=1)
Failed:    0
------------
Total states run:     1
Total run time:   8.756 s</pre> <p>Raw output example (useful when the output is reused in other states/execution modules):</p> <pre class="highlight-bash notranslate" data-language="bash">$ sudo salt --out=pprint 'juniper.device' state.sls router.config test=True debug=True</pre> <pre class="highlight-python notranslate" data-language="python">{
    'juniper.device': {
        'netconfig_|-ntp_peers_example_using_pillar_|-ntp_peers_example_using_pillar_|-managed': {
            '__id__': 'ntp_peers_example_using_pillar',
            '__run_num__': 0,
            'already_configured': False,
            'changes': {
                'diff': '[edit system ntp]   peer 192.168.0.1 { ... }+   peer 172.17.17.1;+   peer 172.17.17.3;'
            },
            'comment': 'Testing mode: Configuration discarded.',
            'duration': 7400.759,
            'loaded_config': 'system {  ntp {  peer 172.17.17.1;  peer 172.17.17.3; } }',
            'name': 'ntp_peers_example_using_pillar',
            'result': None,
            'start_time': '12:09:09.811445'
        }
    }
}</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.netconfig.replace_pattern"> salt.states.netconfig.replace_pattern(name, pattern, repl, count=0, flags=8, bufsize=1, append_if_not_found=False, prepend_if_not_found=False, not_found_content=None, search_only=False, show_changes=True, backslash_literal=False, source='running', path=None, test=False, replace=True, debug=False, commit=True)</h3> <dd>
<div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> <p>Replace occurrences of a pattern in the configuration source. If <code class="docutils literal notranslate"><span class="pre">show_changes</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code>, then a diff of what changed will be returned, otherwise a <code class="docutils literal notranslate"><span class="pre">True</span></code> will be returned when changes are made, and <code class="docutils literal notranslate"><span class="pre">False</span></code> when no changes are made. This is a pure Python implementation that wraps Python's <a class="reference external" href="https://docs.python.org/3/library/re.html#re.sub" title="(in Python v3.9)"><code class="xref py py-func docutils literal notranslate"><span class="pre">sub()</span></code></a>.</p> <dl class="simple"> <dt>pattern</dt>
<dd>
<p>A regular expression, to be matched using Python's <a class="reference external" href="https://docs.python.org/3/library/re.html#re.search" title="(in Python v3.9)"><code class="xref py py-func docutils literal notranslate"><span class="pre">search()</span></code></a>.</p> </dd> <dt>repl</dt>
<dd>
<p>The replacement text.</p> </dd> <dt>count: <code class="docutils literal notranslate"><span class="pre">0</span></code>
</dt>
<dd>
<p>Maximum number of pattern occurrences to be replaced. If count is a positive integer <code class="docutils literal notranslate"><span class="pre">n</span></code>, only <code class="docutils literal notranslate"><span class="pre">n</span></code> occurrences will be replaced, otherwise all occurrences will be replaced.</p> </dd> <dt>flags (list or int): <code class="docutils literal notranslate"><span class="pre">8</span></code>
</dt>
<dd>
<p>A list of flags defined in the <code class="docutils literal notranslate"><span class="pre">re</span></code> module documentation from the Python standard library. Each list item should be a string that will correlate to the human-friendly flag name. E.g., <code class="docutils literal notranslate"><span class="pre">['IGNORECASE',</span>
<span class="pre">'MULTILINE']</span></code>. Optionally, <code class="docutils literal notranslate"><span class="pre">flags</span></code> may be an int, with a value corresponding to the XOR (<code class="docutils literal notranslate"><span class="pre">|</span></code>) of all the desired flags. Defaults to 8 (which supports 'MULTILINE').</p> </dd> <dt>bufsize (int or str): <code class="docutils literal notranslate"><span class="pre">1</span></code>
</dt>
<dd>
<p>How much of the configuration to buffer into memory at once. The default value <code class="docutils literal notranslate"><span class="pre">1</span></code> processes one line at a time. The special value <code class="docutils literal notranslate"><span class="pre">file</span></code> may be specified which will read the entire file into memory before processing.</p> </dd> <dt>append_if_not_found: <code class="docutils literal notranslate"><span class="pre">False</span></code>
</dt>
<dd>
<p>If set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, and pattern is not found, then the content will be appended to the file.</p> </dd> <dt>prepend_if_not_found: <code class="docutils literal notranslate"><span class="pre">False</span></code>
</dt>
<dd>
<p>If set to <code class="docutils literal notranslate"><span class="pre">True</span></code> and pattern is not found, then the content will be prepended to the file.</p> </dd> <dt>not_found_content</dt>
<dd>
<p>Content to use for append/prepend if not found. If None (default), uses <code class="docutils literal notranslate"><span class="pre">repl</span></code>. Useful when <code class="docutils literal notranslate"><span class="pre">repl</span></code> uses references to group in pattern.</p> </dd> <dt>search_only: <code class="docutils literal notranslate"><span class="pre">False</span></code>
</dt>
<dd>
<p>If set to true, this no changes will be performed on the file, and this function will simply return <code class="docutils literal notranslate"><span class="pre">True</span></code> if the pattern was matched, and <code class="docutils literal notranslate"><span class="pre">False</span></code> if not.</p> </dd> <dt>show_changes: <code class="docutils literal notranslate"><span class="pre">True</span></code>
</dt>
<dd>
<p>If <code class="docutils literal notranslate"><span class="pre">True</span></code>, return a diff of changes made. Otherwise, return <code class="docutils literal notranslate"><span class="pre">True</span></code> if changes were made, and <code class="docutils literal notranslate"><span class="pre">False</span></code> if not.</p> </dd> <dt>backslash_literal: <code class="docutils literal notranslate"><span class="pre">False</span></code>
</dt>
<dd>
<p>Interpret backslashes as literal backslashes for the repl and not escape characters. This will help when using append/prepend so that the backslashes are not interpreted for the repl on the second run of the state.</p> </dd> <dt>source: <code class="docutils literal notranslate"><span class="pre">running</span></code>
</dt>
<dd>
<p>The configuration source. Choose from: <code class="docutils literal notranslate"><span class="pre">running</span></code>, <code class="docutils literal notranslate"><span class="pre">candidate</span></code>, or <code class="docutils literal notranslate"><span class="pre">startup</span></code>. Default: <code class="docutils literal notranslate"><span class="pre">running</span></code>.</p> </dd> <dt>path</dt>
<dd>
<p>Save the temporary configuration to a specific path, then read from there.</p> </dd> <dt>test: <code class="docutils literal notranslate"><span class="pre">False</span></code>
</dt>
<dd>
<p>Dry run? If set as <code class="docutils literal notranslate"><span class="pre">True</span></code>, will apply the config, discard and return the changes. Default: <code class="docutils literal notranslate"><span class="pre">False</span></code> and will commit the changes on the device.</p> </dd> <dt>commit: <code class="docutils literal notranslate"><span class="pre">True</span></code>
</dt>
<dd>
<p>Commit the configuration changes? Default: <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p> </dd> <dt>debug: <code class="docutils literal notranslate"><span class="pre">False</span></code>
</dt>
<dd>
<p>Debug mode. Will insert a new key in the output dictionary, as <code class="docutils literal notranslate"><span class="pre">loaded_config</span></code> containing the raw configuration loaded on the device.</p> </dd> <dt>replace: <code class="docutils literal notranslate"><span class="pre">True</span></code>
</dt>
<dd>
<p>Load and replace the configuration. Default: <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p> </dd> </dl> <p>If an equal sign (<code class="docutils literal notranslate"><span class="pre">=</span></code>) appears in an argument to a Salt command it is interpreted as a keyword argument in the format <code class="docutils literal notranslate"><span class="pre">key=val</span></code>. That processing can be bypassed in order to pass an equal sign through to the remote shell command by manually specifying the kwarg:</p> <p>State SLS Example:</p> <pre class="highlight-yaml notranslate" data-language="yaml">update_policy_name:
  netconfig.replace_pattern:
    - pattern: OLD-POLICY-NAME
    - repl: new-policy-name
    - debug: true</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.netconfig.saved"> salt.states.netconfig.saved(name, source='running', user=None, group=None, mode=None, attrs=None, makedirs=False, dir_mode=None, replace=True, backup='', show_changes=True, create=True, tmp_dir='', tmp_ext='', encoding=None, encoding_errors='strict', allow_empty=False, follow_symlinks=True, check_cmd=None, win_owner=None, win_perms=None, win_deny_perms=None, win_inheritance=True, win_perms_reset=False, **kwargs)</h3> <dd>
<div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> <p>Save the configuration to a file on the local file system.</p> <dl> <dt>name</dt>
<dd>
<p>Absolute path to file where to save the configuration. To push the files to the Master, use <a class="reference internal" href="../../modules/all/salt.modules.cp.html#salt.modules.cp.push" title="salt.modules.cp.push"><code class="xref py py-mod docutils literal notranslate"><span class="pre">cp.push</span></code></a> Execution function.</p> </dd> <dt>source: <code class="docutils literal notranslate"><span class="pre">running</span></code>
</dt>
<dd>
<p>The configuration source. Choose from: <code class="docutils literal notranslate"><span class="pre">running</span></code>, <code class="docutils literal notranslate"><span class="pre">candidate</span></code>, <code class="docutils literal notranslate"><span class="pre">startup</span></code>. Default: <code class="docutils literal notranslate"><span class="pre">running</span></code>.</p> </dd> <dt>user</dt>
<dd>
<p>The user to own the file, this defaults to the user salt is running as on the minion</p> </dd> <dt>group</dt>
<dd>
<p>The group ownership set for the file, this defaults to the group salt is running as on the minion. On Windows, this is ignored</p> </dd> <dt>mode</dt>
<dd>
<p>The permissions to set on this file, e.g. <code class="docutils literal notranslate"><span class="pre">644</span></code>, <code class="docutils literal notranslate"><span class="pre">0775</span></code>, or <code class="docutils literal notranslate"><span class="pre">4664</span></code>. The default mode for new files and directories corresponds to the umask of the salt process. The mode of existing files and directories will only be changed if <code class="docutils literal notranslate"><span class="pre">mode</span></code> is specified.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This option is <strong>not</strong> supported on Windows.</p> </div> </dd> <dt>attrs</dt>
<dd>
<p>The attributes to have on this file, e.g. <code class="docutils literal notranslate"><span class="pre">a</span></code>, <code class="docutils literal notranslate"><span class="pre">i</span></code>. The attributes can be any or a combination of the following characters: <code class="docutils literal notranslate"><span class="pre">aAcCdDeijPsStTu</span></code>.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This option is <strong>not</strong> supported on Windows.</p> </div> </dd> <dt>makedirs: <code class="docutils literal notranslate"><span class="pre">False</span></code>
</dt>
<dd>
<p>If set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, then the parent directories will be created to facilitate the creation of the named file. If <code class="docutils literal notranslate"><span class="pre">False</span></code>, and the parent directory of the destination file doesn't exist, the state will fail.</p> </dd> <dt>dir_mode</dt>
<dd>
<p>If directories are to be created, passing this option specifies the permissions for those directories. If this is not set, directories will be assigned permissions by adding the execute bit to the mode of the files.</p> <p>The default mode for new files and directories corresponds umask of salt process. For existing files and directories it's not enforced.</p> </dd> <dt>replace: <code class="docutils literal notranslate"><span class="pre">True</span></code>
</dt>
<dd>
<p>If set to <code class="docutils literal notranslate"><span class="pre">False</span></code> and the file already exists, the file will not be modified even if changes would otherwise be made. Permissions and ownership will still be enforced, however.</p> </dd> <dt>backup</dt>
<dd>
<p>Overrides the default backup mode for this specific file. See <a class="reference internal" href="https://docs.saltproject.io/en/latest/ref/states/backup_mode.html#file-state-backups"><span class="std std-ref">backup_mode documentation</span></a> for more details.</p> </dd> <dt>show_changes: <code class="docutils literal notranslate"><span class="pre">True</span></code>
</dt>
<dd>
<p>Output a unified diff of the old file and the new file. If <code class="docutils literal notranslate"><span class="pre">False</span></code> return a boolean if any changes were made.</p> </dd> <dt>create: <code class="docutils literal notranslate"><span class="pre">True</span></code>
</dt>
<dd>
<p>If set to <code class="docutils literal notranslate"><span class="pre">False</span></code>, then the file will only be managed if the file already exists on the system.</p> </dd> <dt>encoding</dt>
<dd>
<p>If specified, then the specified encoding will be used. Otherwise, the file will be encoded using the system locale (usually UTF-8). See <a class="reference external" href="https://docs.python.org/3/library/codecs.html#standard-encodings">https://docs.python.org/3/library/codecs.html#standard-encodings</a> for the list of available encodings.</p> </dd> <dt>encoding_errors: <code class="docutils literal notranslate"><span class="pre">'strict'</span></code>
</dt>
<dd>
<p>Error encoding scheme. Default is <code class="docutils literal notranslate"><span class="pre">`'strict'`</span></code>. See <a class="reference external" href="https://docs.python.org/2/library/codecs.html#codec-base-classes">https://docs.python.org/2/library/codecs.html#codec-base-classes</a> for the list of available schemes.</p> </dd> <dt>allow_empty: <code class="docutils literal notranslate"><span class="pre">True</span></code>
</dt>
<dd>
<p>If set to <code class="docutils literal notranslate"><span class="pre">False</span></code>, then the state will fail if the contents specified by <code class="docutils literal notranslate"><span class="pre">contents_pillar</span></code> or <code class="docutils literal notranslate"><span class="pre">contents_grains</span></code> are empty.</p> </dd> <dt>follow_symlinks: <code class="docutils literal notranslate"><span class="pre">True</span></code>
</dt>
<dd>
<p>If the desired path is a symlink follow it and make changes to the file to which the symlink points.</p> </dd> <dt>check_cmd</dt>
<dd>
<p>The specified command will be run with an appended argument of a <em>temporary</em> file containing the new managed contents. If the command exits with a zero status the new managed contents will be written to the managed destination. If the command exits with a nonzero exit code, the state will fail and no changes will be made to the file.</p> </dd> <dt>tmp_dir</dt>
<dd>
<p>Directory for temp file created by <code class="docutils literal notranslate"><span class="pre">check_cmd</span></code>. Useful for checkers dependent on config file location (e.g. daemons restricted to their own config directories by an apparmor profile).</p> </dd> <dt>tmp_ext</dt>
<dd>
<p>Suffix for temp file created by <code class="docutils literal notranslate"><span class="pre">check_cmd</span></code>. Useful for checkers dependent on config file extension (e.g. the init-checkconf upstart config checker).</p> </dd> <dt>win_owner: <code class="docutils literal notranslate"><span class="pre">None</span></code>
</dt>
<dd>
<p>The owner of the directory. If this is not passed, user will be used. If user is not passed, the account under which Salt is running will be used.</p> </dd> <dt>win_perms: <code class="docutils literal notranslate"><span class="pre">None</span></code>
</dt>
<dd>
<p>A dictionary containing permissions to grant and their propagation. For example: <code class="docutils literal notranslate"><span class="pre">{'Administrators':</span> <span class="pre">{'perms':</span> <span class="pre">'full_control'}}</span></code> Can be a single basic perm or a list of advanced perms. <code class="docutils literal notranslate"><span class="pre">perms</span></code> must be specified. <code class="docutils literal notranslate"><span class="pre">applies_to</span></code> does not apply to file objects.</p> </dd> <dt>win_deny_perms: <code class="docutils literal notranslate"><span class="pre">None</span></code>
</dt>
<dd>
<p>A dictionary containing permissions to deny and their propagation. For example: <code class="docutils literal notranslate"><span class="pre">{'Administrators':</span> <span class="pre">{'perms':</span> <span class="pre">'full_control'}}</span></code> Can be a single basic perm or a list of advanced perms. <code class="docutils literal notranslate"><span class="pre">perms</span></code> must be specified. <code class="docutils literal notranslate"><span class="pre">applies_to</span></code> does not apply to file objects.</p> </dd> <dt>win_inheritance: <code class="docutils literal notranslate"><span class="pre">True</span></code>
</dt>
<dd>
<p>True to inherit permissions from the parent directory, False not to inherit permission.</p> </dd> <dt>win_perms_reset: <code class="docutils literal notranslate"><span class="pre">False</span></code>
</dt>
<dd>
<p>If <code class="docutils literal notranslate"><span class="pre">True</span></code> the existing DACL will be cleared and replaced with the settings defined in this function. If <code class="docutils literal notranslate"><span class="pre">False</span></code>, new entries will be appended to the existing DACL. Default is <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p> </dd> </dl> <p>State SLS Example:</p> <pre class="highlight-yaml notranslate" data-language="yaml">/var/backups/{{ opts.id }}/{{ salt.status.time('%s') }}.cfg:
  netconfig.saved:
    - source: running
    - makedirs: true</pre> <p>The state SLS above would create a backup config grouping the files by the Minion ID, in chronological files. For example, if the state is executed at on the 3rd of August 2018, at 5:15PM, on the Minion <code class="docutils literal notranslate"><span class="pre">core1.lon01</span></code>, the configuration would saved in the file: <code class="docutils literal notranslate"><span class="pre">/var/backups/core01.lon01/1533316558.cfg</span></code></p> </dd>
</dl> </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2021 SaltStack.<br>Licensed under the Apache License, Version 2.0.<br>
    <a href="https://docs.saltproject.io/en/latest/ref/states/all/salt.states.netconfig.html" class="_attribution-link">https://docs.saltproject.io/en/latest/ref/states/all/salt.states.netconfig.html</a>
  </p>
</div>
