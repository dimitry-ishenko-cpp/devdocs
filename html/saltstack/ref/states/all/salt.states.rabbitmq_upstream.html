<h1>salt.states.rabbitmq_upstream</h1> <div class="section" id="manage-rabbitmq-upstreams"> <h2>Manage RabbitMQ Upstreams</h2> <p>Example:</p> <pre class="highlight-yaml notranslate" data-language="yaml">rabbit_upstream:
  rabbitmq_upstream.present:
  - name: upstream_1
  - uri: amqp://my_user:my_password@rabbitmq_host
  - trust_user_id: True
  - ack_mode: on-confirm
  - max_hops: 1</pre> <div class="versionadded"> <p><span class="versionmodified added">New in version 3000.</span></p> </div> <dl class="py function"> <h3 id="salt.states.rabbitmq_upstream.absent"> salt.states.rabbitmq_upstream.absent(name, runas=None)</h3> <dd>
<p>Ensure the named upstream is absent.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li><p><strong>name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The name of the upstream to remove</p></li> <li><p><strong>runas</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- User to run the command</p></li> </ul> </dd> </dl> <div class="versionadded"> <p><span class="versionmodified added">New in version 3000.</span></p> </div> </dd>
</dl> <dl class="py function"> <h3 id="salt.states.rabbitmq_upstream.present"> salt.states.rabbitmq_upstream.present(name, uri, prefetch_count=None, reconnect_delay=None, ack_mode=None, trust_user_id=None, exchange=None, max_hops=None, expires=None, message_ttl=None, ha_policy=None, queue=None, runas=None)</h3> <dd>
<p>Ensure the RabbitMQ upstream exists.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li><p><strong>name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The name of the upstream connection</p></li> <li><p><strong>uri</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The URI to connect to. If upstream is a cluster and can have several URIs, you can enter them here separated by spaces. Examples: - amqp://user:password@server_name - amqp://user:password@server_name/vhost When connecting with SSL, several URI-parameters need also be specified: - cacertfile = /path/to/cacert.pem - certfile = /path/to/cert.pem - keyfile = /part/to/key.pem - verity = verify_peer - fail_if_no_peer_cert = true | false - auth_mechanism = external Example: - amqp://user:password@server_name?cacertfile=/path/to/cacert.pem&amp; certfile=/path/to/cert.pem&amp;keyfile=/path/to/key.pem&amp;verify=verify_peer - amqp://server-name?cacertfile=/path/to/cacert.pem&amp;certfile=/path/to/cert.pem&amp; keyfile=/path/to/key.pem&amp;verify=verify_peer&amp;fail_if_no_peer_cert=true&amp;auth_mechanism=external</p></li> <li><p><strong>prefetch_count</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) -- Maximum number of unacknowledged messages that may be in flight over a federation link at one time. Default: 1000</p></li> <li><p><strong>reconnect_delay</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) -- Time in seconds to wait after a network link goes down before attempting reconnection. Default: 5</p></li> <li><p><strong>ack_mode</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The following values are allowed: on-confirm: Messages are acknowledged to the upstream broker after they have been confirmed downstream. Handles network errors and broker failures without losing messages. The slowest option, and the default. on-publish: Messages are acknowledged to the upstream broker after they have been published downstream. Handles network errors without losing messages, but may lose messages in the event of broker failures. no-ack: Message acknowledgements are not used. The fastest option, but you may lose messages in the event of network or broker failures.</p></li> <li><p><strong>trust_user_id</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- Set <code class="docutils literal notranslate"><span class="pre">True</span></code> to preserve the "user-id" field across a federation link, even if the user-id does not match that used to republish the message. Set to <code class="docutils literal notranslate"><span class="pre">False</span></code> to clear the "user-id" field when messages are federated. Only set this to <code class="docutils literal notranslate"><span class="pre">True</span></code> if you trust the upstream broker not to forge user-ids.</p></li> <li><p><strong>exchange</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The name of the upstream exchange. Default is to use the same name as the federated exchange.</p></li> <li><p><strong>max_hops</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) -- Maximum number of federation links that messages can traverse before being dropped. Defaults to 1 if not set.</p></li> <li><p><strong>expires</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) -- Time in milliseconds that the upstream should remember about this node for. After this time all upstream state will be removed. Set to <code class="docutils literal notranslate"><span class="pre">None</span></code> (Default) to mean "forever".</p></li> <li><p><strong>message_ttl</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) -- Time in milliseconds that undelivered messages should be held upstream when there is a network outage or backlog. Set to <code class="docutils literal notranslate"><span class="pre">None</span></code> (default) to mean "forever".</p></li> <li><p><strong>ha_policy</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- Determines the "x-ha-policy"-argument for the upstream queue for a federated exchange. Default is "none" meaning the queue is not HA.</p></li> <li><p><strong>queue</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The name of the upstream queue. Default is to use the same name as the federated queue.</p></li> </ul> </dd> </dl> <div class="versionadded"> <p><span class="versionmodified added">New in version 3000.</span></p> </div> </dd>
</dl> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2021 SaltStack.<br>Licensed under the Apache License, Version 2.0.<br>
    <a href="https://docs.saltproject.io/en/latest/ref/states/all/salt.states.rabbitmq_upstream.html" class="_attribution-link">https://docs.saltproject.io/en/latest/ref/states/all/salt.states.rabbitmq_upstream.html</a>
  </p>
</div>
