<h1>salt.returners.couchdb_return</h1> <p>Simple returner for CouchDB. Optional configuration settings are listed below, along with sane defaults:</p> <pre class="highlight-yaml notranslate" data-language="yaml">couchdb.db: 'salt'
couchdb.url: 'http://salt:5984/'</pre> <p>Alternative configuration values can be used by prefacing the configuration. Any values not found in the alternative configuration will be pulled from the default location:</p> <pre class="highlight-yaml notranslate" data-language="yaml">alternative.couchdb.db: 'salt'
alternative.couchdb.url: 'http://salt:5984/'</pre> <p>To use the couchdb returner, append <code class="docutils literal notranslate"><span class="pre">--return</span> <span class="pre">couchdb</span></code> to the salt command. Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' test.ping --return couchdb</pre> <p>To use the alternative configuration, append <code class="docutils literal notranslate"><span class="pre">--return_config</span> <span class="pre">alternative</span></code> to the salt command.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2015.5.0.</span></p> </div> <pre class="highlight-bash notranslate" data-language="bash">salt '*' test.ping --return couchdb --return_config alternative</pre> <p>To override individual configuration items, append --return_kwargs '{"key:": "value"}' to the salt command.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2016.3.0.</span></p> </div> <pre class="highlight-bash notranslate" data-language="bash">salt '*' test.ping --return couchdb --return_kwargs '{"db": "another-salt"}'</pre> <div class="section" id="on-concurrent-database-access"> <h2>On concurrent database access</h2> <p>As this returner creates a couchdb document with the salt job id as document id and as only one document with a given id can exist in a given couchdb database, it is advised for most setups that every minion be configured to write to it own database (the value of <code class="docutils literal notranslate"><span class="pre">couchdb.db</span></code> may be suffixed with the minion id), otherwise multi-minion targeting can lead to losing output:</p> <ul class="simple"> <li><p>the first returning minion is able to create a document in the database</p></li> <li><p>other minions fail with <code class="docutils literal notranslate"><span class="pre">{'error':</span> <span class="pre">'HTTP</span> <span class="pre">Error</span> <span class="pre">409:</span> <span class="pre">Conflict'}</span></code></p></li> </ul> <dl class="py function"> <h3 id="salt.returners.couchdb_return.ensure_views"> salt.returners.couchdb_return.ensure_views()</h3> <dd>
<p>This function makes sure that all the views that should exist in the design document do exist.</p> </dd>
</dl> <dl class="py function"> <h3 id="salt.returners.couchdb_return.get_fun"> salt.returners.couchdb_return.get_fun(fun)</h3> <dd>
<p>Return a dict with key being minion and value being the job details of the last run of function 'fun'.</p> </dd>
</dl> <dl class="py function"> <h3 id="salt.returners.couchdb_return.get_jid"> salt.returners.couchdb_return.get_jid(jid)</h3> <dd>
<p>Get the document with a given JID.</p> </dd>
</dl> <dl class="py function"> <h3 id="salt.returners.couchdb_return.get_jids"> salt.returners.couchdb_return.get_jids()</h3> <dd>
<p>List all the jobs that we have..</p> </dd>
</dl> <dl class="py function"> <h3 id="salt.returners.couchdb_return.get_minions"> salt.returners.couchdb_return.get_minions()</h3> <dd>
<p>Return a list of minion identifiers from a request of the view.</p> </dd>
</dl> <dl class="py function"> <h3 id="salt.returners.couchdb_return.get_valid_salt_views"> salt.returners.couchdb_return.get_valid_salt_views()</h3> <dd>
<p>Returns a dict object of views that should be part of the salt design document.</p> </dd>
</dl> <dl class="py function"> <h3 id="salt.returners.couchdb_return.prep_jid"> salt.returners.couchdb_return.prep_jid(nocache=False, passed_jid=None)</h3> <dd>
<p>Do any work necessary to prepare a JID, including sending a custom id</p> </dd>
</dl> <dl class="py function"> <h3 id="salt.returners.couchdb_return.returner"> salt.returners.couchdb_return.returner(ret)</h3> <dd>
<p>Take in the return and shove it into the couchdb database.</p> </dd>
</dl> <dl class="py function"> <h3 id="salt.returners.couchdb_return.set_salt_view"> salt.returners.couchdb_return.set_salt_view()</h3> <dd>
<p>Helper function that sets the salt design document. Uses get_valid_salt_views and some hardcoded values.</p> </dd>
</dl> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2021 SaltStack.<br>Licensed under the Apache License, Version 2.0.<br>
    <a href="https://docs.saltproject.io/en/latest/ref/returners/all/salt.returners.couchdb_return.html" class="_attribution-link">https://docs.saltproject.io/en/latest/ref/returners/all/salt.returners.couchdb_return.html</a>
  </p>
</div>
