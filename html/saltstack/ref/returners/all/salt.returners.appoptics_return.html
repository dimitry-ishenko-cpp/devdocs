<h1>salt.returners.appoptics_return</h1> <p>Salt returner to return highstate stats to AppOptics Metrics</p> <p>To enable this returner the minion will need the AppOptics Metrics client importable on the Python path and the following values configured in the minion or master config.</p> <p>The AppOptics python client can be found at:</p> <p><a class="reference external" href="https://github.com/appoptics/python-appoptics-metrics">https://github.com/appoptics/python-appoptics-metrics</a></p> <pre class="highlight-yaml notranslate" data-language="yaml">appoptics.api_token: abc12345def</pre> <p>An example configuration that returns the total number of successes and failures for your salt highstate runs (the default) would look like this:</p> <pre class="highlight-yaml notranslate" data-language="yaml">return: appoptics
appoptics.api_token: &lt;token string here&gt;</pre> <p>The returner publishes the following metrics to AppOptics:</p> <ul class="simple"> <li><p>saltstack.failed</p></li> <li><p>saltstack.passed</p></li> <li><p>saltstack.retcode</p></li> <li><p>saltstack.runtime</p></li> <li><p>saltstack.total</p></li> </ul> <p>You can add a tags section to specify which tags should be attached to all metrics created by the returner.</p> <pre class="highlight-yaml notranslate" data-language="yaml">appoptics.tags:
  host_hostname_alias: &lt;the minion ID - matches @host&gt;
  tier: &lt;the tier/etc. of this node&gt;
  cluster: &lt;the cluster name, etc.&gt;</pre> <p>If no tags are explicitly configured, then the tag key <code class="docutils literal notranslate"><span class="pre">host_hostname_alias</span></code> will be set, with the minion's <code class="docutils literal notranslate"><span class="pre">id</span></code> grain being the value.</p> <p>In addition to the requested tags, for a highstate run each of these will be tagged with the <code class="docutils literal notranslate"><span class="pre">key:value</span></code> of <code class="docutils literal notranslate"><span class="pre">state_type:</span> <span class="pre">highstate</span></code>.</p> <p>In order to return metrics for <code class="docutils literal notranslate"><span class="pre">state.sls</span></code> runs (distinct from highstates), you can specify a list of state names to the key <code class="docutils literal notranslate"><span class="pre">appoptics.sls_states</span></code> like so:</p> <pre class="highlight-yaml notranslate" data-language="yaml">appoptics.sls_states:
  - role_salt_master.netapi
  - role_redis.config
  - role_smarty.dummy</pre> <p>This will report success and failure counts on runs of the <code class="docutils literal notranslate"><span class="pre">role_salt_master.netapi</span></code>, <code class="docutils literal notranslate"><span class="pre">role_redis.config</span></code>, and <code class="docutils literal notranslate"><span class="pre">role_smarty.dummy</span></code> states in addition to highstates.</p> <p>This will report the same metrics as above, but for these runs the metrics will be tagged with <code class="docutils literal notranslate"><span class="pre">state_type:</span> <span class="pre">sls</span></code> and <code class="docutils literal notranslate"><span class="pre">state_name</span></code> set to the name of the state that was invoked, e.g. <code class="docutils literal notranslate"><span class="pre">role_salt_master.netapi</span></code>.</p> <dl class="py function"> <h3 id="salt.returners.appoptics_return.returner"> salt.returners.appoptics_return.returner(ret)</h3> <dd>
<p>Parse the return data and return metrics to AppOptics.</p> <p>For each state that's provided in the configuration, return tagged metrics for the result of that state if it's present.</p> </dd>
</dl><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2021 SaltStack.<br>Licensed under the Apache License, Version 2.0.<br>
    <a href="https://docs.saltproject.io/en/latest/ref/returners/all/salt.returners.appoptics_return.html" class="_attribution-link">https://docs.saltproject.io/en/latest/ref/returners/all/salt.returners.appoptics_return.html</a>
  </p>
</div>
