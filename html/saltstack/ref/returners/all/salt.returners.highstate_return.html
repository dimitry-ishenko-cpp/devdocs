<h1>salt.returners.highstate_return</h1> <p>Return the results of a highstate (or any other state function that returns data in a compatible format) via an HTML email or HTML file.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2017.7.0.</span></p> </div> <p>Similar results can be achieved by using the smtp returner with a custom template, except an attempt at writing such a template for the complex data structure returned by highstate function had proven to be a challenge, not to mention that the smtp module doesn't support sending HTML mail at the moment.</p> <p>The main goal of this returner was to produce an easy to read email similar to the output of highstate outputter used by the CLI.</p> <p>This returner could be very useful during scheduled executions, but could also be useful for communicating the results of a manual execution.</p> <p>Returner configuration is controlled in a standard fashion either via highstate group or an alternatively named group.</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' state.highstate --return highstate</pre> <p>To use the alternative configuration, append '--return_config config-name'</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' state.highstate --return highstate --return_config simple</pre> <p>Here is an example of what the configuration might look like:</p> <pre class="highlight-yaml notranslate" data-language="yaml">simple.highstate:
  report_failures: True
  report_changes: True
  report_everything: False
  failure_function: pillar.items
  success_function: pillar.items
  report_format: html
  report_delivery: smtp
  smtp_success_subject: 'success minion {id} on host {host}'
  smtp_failure_subject: 'failure minion {id} on host {host}'
  smtp_server: smtp.example.com
  smtp_recipients: saltusers@example.com, devops@example.com
  smtp_sender: salt@example.com</pre> <p>The <em>report_failures</em>, <em>report_changes</em>, and <em>report_everything</em> flags provide filtering of the results. If you want an email to be sent every time, then <em>report_everything</em> is your choice. If you want to be notified only when changes were successfully made use <em>report_changes</em>. And <em>report_failures</em> will generate an email if there were failures.</p> <p>The configuration allows you to run a salt module function in case of success (<em>success_function</em>) or failure (<em>failure_function</em>).</p> <p>Any salt function, including ones defined in the _module folder of your salt repo, could be used here and its output will be displayed under the 'extra' heading of the email.</p> <p>Supported values for <em>report_format</em> are html, json, and yaml. The latter two are typically used for debugging purposes, but could be used for applying a template at some later stage.</p> <p>The values for <em>report_delivery</em> are smtp or file. In case of file delivery the only other applicable option is <em>file_output</em>.</p> <p>In case of smtp delivery, smtp_* options demonstrated by the example above could be used to customize the email.</p> <p>As you might have noticed, the success and failure subjects contain {id} and {host} values. Any other grain name could be used. As opposed to using {{grains['id']}}, which will be rendered by the master and contain master's values at the time of pillar generation, these will contain minion values at the time of execution.</p> <dl class="py function"> <h3 id="salt.returners.highstate_return.returner"> salt.returners.highstate_return.returner(ret)</h3> <dd>
<p>Check highstate return information and possibly fire off an email or save a file.</p> </dd>
</dl><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2021 SaltStack.<br>Licensed under the Apache License, Version 2.0.<br>
    <a href="https://docs.saltproject.io/en/latest/ref/returners/all/salt.returners.highstate_return.html" class="_attribution-link">https://docs.saltproject.io/en/latest/ref/returners/all/salt.returners.highstate_return.html</a>
  </p>
</div>
