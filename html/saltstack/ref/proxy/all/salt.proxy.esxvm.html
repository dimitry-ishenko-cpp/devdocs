<h1>salt.proxy.esxvm</h1> <p>Proxy Minion interface module for managing VMWare ESXi virtual machines.</p> <div class="section" id="dependencies"> <h2>Dependencies</h2> <ul class="simple"> <li><p>pyVmomi</p></li> <li><p>jsonschema</p></li> </ul> </div> <div class="section" id="configuration"> <h2>Configuration</h2> <p>To use this integration proxy module, please configure the following:</p> <div class="section" id="pillar"> <h3>Pillar</h3> <p>Proxy minions get their configuration from Salt's Pillar. This can now happen from the proxy's configuration file.</p> <p>Example pillars:</p> <p><code class="docutils literal notranslate"><span class="pre">userpass</span></code> mechanism:</p> <pre class="highlight-yaml notranslate" data-language="yaml">proxy:
  proxytype: esxvm
  datacenter: &lt;datacenter name&gt;
  vcenter: &lt;ip or dns name of parent vcenter&gt;
  mechanism: userpass
  username: &lt;vCenter username&gt;
  passwords: (required if userpass is used)
    - first_password
    - second_password
    - third_password</pre> <p><code class="docutils literal notranslate"><span class="pre">sspi</span></code> mechanism:</p> <pre class="highlight-yaml notranslate" data-language="yaml">proxy:
  proxytype: esxvm
  datacenter: &lt;datacenter name&gt;
  vcenter: &lt;ip or dns name of parent vcenter&gt;
  mechanism: sspi
  domain: &lt;user domain&gt;
  principal: &lt;host kerberos principal&gt;</pre> <div class="section" id="proxytype"> <h4>proxytype</h4> <p>To use this Proxy Module, set this to <code class="docutils literal notranslate"><span class="pre">esxvm</span></code>.</p> </div> <div class="section" id="datacenter"> <h4>datacenter</h4> <p>Name of the datacenter where the virtual machine should be deployed. Required.</p> </div> <div class="section" id="vcenter"> <h4>vcenter</h4> <p>The location of the VMware vCenter server (host of ip) where the virtual machine should be managed. Required.</p> </div> <div class="section" id="mechanism"> <h4>mechanism</h4> <p>The mechanism used to connect to the vCenter server. Supported values are <code class="docutils literal notranslate"><span class="pre">userpass</span></code> and <code class="docutils literal notranslate"><span class="pre">sspi</span></code>. Required.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>Connections are attempted using all (<code class="docutils literal notranslate"><span class="pre">username</span></code>, <code class="docutils literal notranslate"><span class="pre">password</span></code>) combinations on proxy startup.</p> </div> </div> <div class="section" id="username"> <h4>username</h4> <p>The username used to login to the host, such as <code class="docutils literal notranslate"><span class="pre">root</span></code>. Required if mechanism is <code class="docutils literal notranslate"><span class="pre">userpass</span></code>.</p> </div> <div class="section" id="passwords"> <h4>passwords</h4> <p>A list of passwords to be used to try and login to the vCenter server. At least one password in this list is required if mechanism is <code class="docutils literal notranslate"><span class="pre">userpass</span></code>. When the proxy comes up, it will try the passwords listed in order.</p> </div> <div class="section" id="domain"> <h4>domain</h4> <p>User realm domain. Required if mechanism is <code class="docutils literal notranslate"><span class="pre">sspi</span></code>.</p> </div> <div class="section" id="principal"> <h4>principal</h4> <p>Kerberos principal. Rquired if mechanism is <code class="docutils literal notranslate"><span class="pre">sspi</span></code>.</p> </div> <div class="section" id="protocol"> <h4>protocol</h4> <p>If the ESXi host is not using the default protocol, set this value to an alternate protocol. Default is <code class="docutils literal notranslate"><span class="pre">https</span></code>.</p> </div> <div class="section" id="port"> <h4>port</h4> <p>If the ESXi host is not using the default port, set this value to an alternate port. Default is <code class="docutils literal notranslate"><span class="pre">443</span></code>.</p> </div> </div> <div class="section" id="salt-proxy"> <h3>Salt Proxy</h3> <p>After your pillar is in place, you can test the proxy. The proxy can run on any machine that has network connectivity to your Salt Master and to the vCenter server in the pillar. SaltStack recommends that the machine running the salt-proxy process also run a regular minion, though it is not strictly necessary.</p> <p>To start a proxy minion one needs to establish its identity &lt;id&gt;:</p> <pre class="highlight-bash notranslate" data-language="bash">salt-proxy --proxyid &lt;proxy_id&gt;</pre> <p>On the machine that will run the proxy, make sure there is a configuration file present. By default this is <code class="docutils literal notranslate"><span class="pre">/etc/salt/proxy</span></code>. If in a different location, the <code class="docutils literal notranslate"><span class="pre">&lt;configuration_folder&gt;</span></code> has to be specified when running the proxy: file with at least the following in it:</p> <pre class="highlight-bash notranslate" data-language="bash">salt-proxy --proxyid &lt;proxy_id&gt; -c &lt;configuration_folder&gt;</pre> </div> <div class="section" id="commands"> <h3>Commands</h3> <p>Once the proxy is running it will connect back to the specified master and individual commands can be runs against it:</p> <pre class="highlight-bash notranslate" data-language="bash"># Master - minion communication
salt &lt;proxy_id&gt; test.ping

# Test vcenter connection
salt &lt;proxy_id&gt; vsphere.test_vcenter_connection</pre> </div> <div class="section" id="states"> <h3>States</h3> <p>Associated states are documented in <code class="xref py py-mod docutils literal notranslate"><span class="pre">salt.states.esxvm</span></code>. Look there to find an example structure for Pillar as well as an example <code class="docutils literal notranslate"><span class="pre">.sls</span></code> file for configuring an ESX virtual machine from scratch.</p> <dl class="py function"> <h3 id="salt.proxy.esxvm.find_credentials"> salt.proxy.esxvm.find_credentials()</h3> <dd>
<p>Cycle through all the possible credentials and return the first one that works.</p> </dd>
</dl> <dl class="py function"> <h3 id="salt.proxy.esxvm.get_details"> salt.proxy.esxvm.get_details()</h3> <dd>
<p>Function that returns the cached details</p> </dd>
</dl> <dl class="py function"> <h3 id="salt.proxy.esxvm.init"> salt.proxy.esxvm.init(opts)</h3> <dd>
<p>This function gets called when the proxy starts up. For login the protocol and port are cached.</p> </dd>
</dl> <dl class="py function"> <h3 id="salt.proxy.esxvm.ping"> salt.proxy.esxvm.ping()</h3> <dd>
<p>Returns True.</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt esx-vm test.ping</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.proxy.esxvm.shutdown"> salt.proxy.esxvm.shutdown()</h3> <dd>
<p>Shutdown the connection to the proxy device. For this proxy, shutdown is a no-op.</p> </dd>
</dl> </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2021 SaltStack.<br>Licensed under the Apache License, Version 2.0.<br>
    <a href="https://docs.saltproject.io/en/latest/ref/proxy/all/salt.proxy.esxvm.html" class="_attribution-link">https://docs.saltproject.io/en/latest/ref/proxy/all/salt.proxy.esxvm.html</a>
  </p>
</div>
