<h1>salt.pillar.s3</h1> <p>Copy pillar data from a bucket in Amazon S3</p> <p>The S3 pillar can be configured in the master config file with the following options</p> <pre class="highlight-yaml notranslate" data-language="yaml">ext_pillar:
  - s3:
      bucket: my.fancy.pillar.bucket
      keyid: KASKFJWAKJASJKDAJKSD
      key: ksladfDLKDALSFKSD93q032sdDasdfasdflsadkf
      multiple_env: False
      environment: base
      prefix: somewhere/overthere
      verify_ssl: True
      service_url: s3.amazonaws.com
      kms_keyid: 01234567-89ab-cdef-0123-4567890abcde
      s3_cache_expire: 30
      s3_sync_on_update: True
      path_style: False
      https_enable: True</pre> <p>The <code class="docutils literal notranslate"><span class="pre">bucket</span></code> parameter specifies the target S3 bucket. It is required.</p> <p>The <code class="docutils literal notranslate"><span class="pre">keyid</span></code> parameter specifies the key id to use when access the S3 bucket. If it is not provided, an attempt to fetch it from EC2 instance meta-data will be made.</p> <p>The <code class="docutils literal notranslate"><span class="pre">key</span></code> parameter specifies the key to use when access the S3 bucket. If it is not provided, an attempt to fetch it from EC2 instance meta-data will be made.</p> <p>The <code class="docutils literal notranslate"><span class="pre">multiple_env</span></code> defaults to False. It specifies whether the pillar should interpret top level folders as pillar environments (see mode section below).</p> <p>The <code class="docutils literal notranslate"><span class="pre">environment</span></code> defaults to 'base'. It specifies which environment the bucket represents when in single environments mode (see mode section below). It is ignored if multiple_env is True.</p> <p>The <code class="docutils literal notranslate"><span class="pre">prefix</span></code> defaults to ''. It specifies a key prefix to use when searching for data in the bucket for the pillar. It works when multiple_env is True or False. Essentially it tells ext_pillar to look for your pillar data in a 'subdirectory' of your S3 bucket</p> <p>The <code class="docutils literal notranslate"><span class="pre">verify_ssl</span></code> parameter defaults to True. It specifies whether to check for valid S3 SSL certificates. <em>NOTE</em> If you use bucket names with periods, this must be set to False else an invalid certificate error will be thrown (issue #12200).</p> <p>The <code class="docutils literal notranslate"><span class="pre">service_url</span></code> parameter defaults to 's3.amazonaws.com'. It specifies the base url to use for accessing S3.</p> <p>The <code class="docutils literal notranslate"><span class="pre">kms_keyid</span></code> parameter is optional. It specifies the ID of the Key Management Service (KMS) master key that was used to encrypt the object.</p> <p>The <code class="docutils literal notranslate"><span class="pre">s3_cache_expire</span></code> parameter defaults to 30s. It specifies expiration time of S3 metadata cache file.</p> <p>The <code class="docutils literal notranslate"><span class="pre">s3_sync_on_update</span></code> parameter defaults to True. It specifies if cache is synced on update rather than jit.</p> <p>The <code class="docutils literal notranslate"><span class="pre">path_style</span></code> parameter defaults to False. It specifies whether to use path style requests or dns style requests</p> <p>The <code class="docutils literal notranslate"><span class="pre">https_enable</span></code> parameter defaults to True. It specifies whether to use https protocol or http protocol</p> <p>This pillar can operate in two modes, single environment per bucket or multiple environments per bucket.</p> <p>Single environment mode must have this bucket structure:</p> <pre class="highlight-text notranslate" data-language="text">s3://&lt;bucket name&gt;/&lt;prefix&gt;/&lt;files&gt;</pre> <p>Multiple environment mode must have this bucket structure:</p> <pre class="highlight-text notranslate" data-language="text">s3://&lt;bucket name&gt;/&lt;prefix&gt;/&lt;environment&gt;/&lt;files&gt;</pre> <p>If you wish to define your pillar data entirely within S3 it's recommended that you use the <cite>prefix=</cite> parameter and specify one entry in ext_pillar for each environment rather than specifying multiple_env. This is due to issue #22471 (<a class="reference external" href="https://github.com/saltstack/salt/issues/22471">https://github.com/saltstack/salt/issues/22471</a>)</p> <dl class="py class"> <dt id="salt.pillar.s3.S3Credentials"> <em class="property">class </em><code class="sig-prename descclassname">salt.pillar.s3.</code><code class="sig-name descname">S3Credentials</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">key</span></em>, <em class="sig-param"><span class="n">keyid</span></em>, <em class="sig-param"><span class="n">bucket</span></em>, <em class="sig-param"><span class="n">service_url</span></em>, <em class="sig-param"><span class="n">verify_ssl</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">kms_keyid</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">location</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">path_style</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">https_enable</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span>
</dt> 
</dl> <dl class="py function"> <h3 id="salt.pillar.s3.ext_pillar"> salt.pillar.s3.ext_pillar(minion_id, pillar, bucket, key=None, keyid=None, verify_ssl=True, location=None, multiple_env=False, environment='base', prefix='', service_url=None, kms_keyid=None, s3_cache_expire=30, s3_sync_on_update=True, path_style=False, https_enable=True)</h3> <dd>
<p>Execute a command and read the output as YAML</p> </dd>
</dl><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2021 SaltStack.<br>Licensed under the Apache License, Version 2.0.<br>
    <a href="https://docs.saltproject.io/en/latest/ref/pillar/all/salt.pillar.s3.html" class="_attribution-link">https://docs.saltproject.io/en/latest/ref/pillar/all/salt.pillar.s3.html</a>
  </p>
</div>
