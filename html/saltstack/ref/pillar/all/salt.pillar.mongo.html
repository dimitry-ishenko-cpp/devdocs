<h1>salt.pillar.mongo</h1> <p>Read Pillar data from a mongodb collection</p> <dl class="field-list simple"> <dt class="field-odd">depends</dt> <dd class="field-odd">
<p>pymongo (for salt-master)</p> </dd> </dl> <p>This module will load a node-specific pillar dictionary from a mongo collection. It uses the node's id for lookups and can load either the whole document, or just a specific field from that document as the pillar dictionary.</p> <div class="section" id="salt-master-mongo-configuration"> <h2>Salt Master Mongo Configuration</h2> <p>The module shares the same base mongo connection variables as <a class="reference internal" href="../../returners/all/salt.returners.mongo_return.html#module-salt.returners.mongo_return" title="salt.returners.mongo_return"><code class="xref py py-mod docutils literal notranslate"><span class="pre">salt.returners.mongo_return</span></code></a>. These variables go in your master config file.</p> <blockquote> <div>
<ul class="simple"> <li><p><code class="docutils literal notranslate"><span class="pre">mongo.db</span></code> - The mongo database to connect to. Defaults to <code class="docutils literal notranslate"><span class="pre">'salt'</span></code>.</p></li> <li><p><code class="docutils literal notranslate"><span class="pre">mongo.host</span></code> - The mongo host to connect to. Supports replica sets by specifying all hosts in the set, comma-delimited. Defaults to <code class="docutils literal notranslate"><span class="pre">'salt'</span></code>.</p></li> <li><p><code class="docutils literal notranslate"><span class="pre">mongo.port</span></code> - The port that the mongo database is running on. Defaults to <code class="docutils literal notranslate"><span class="pre">27017</span></code>.</p></li> <li><p><code class="docutils literal notranslate"><span class="pre">mongo.user</span></code> - The username for connecting to mongo. Only required if you are using mongo authentication. Defaults to <code class="docutils literal notranslate"><span class="pre">''</span></code>.</p></li> <li><p><code class="docutils literal notranslate"><span class="pre">mongo.password</span></code> - The password for connecting to mongo. Only required if you are using mongo authentication. Defaults to <code class="docutils literal notranslate"><span class="pre">''</span></code>.</p></li> </ul> </div>
</blockquote> </div> <div class="section" id="configuring-the-mongo-ext-pillar"> <h2>Configuring the Mongo ext_pillar</h2> <p>The Mongo ext_pillar takes advantage of the fact that the Salt Master configuration file is yaml. It uses a sub-dictionary of values to adjust specific features of the pillar. This is the explicit single-line dictionary notation for yaml. One may be able to get the easier-to-read multi-line dict to work correctly with some experimentation.</p> <pre class="highlight-yaml notranslate" data-language="yaml">ext_pillar:
  - mongo: {collection: vm, id_field: name, re_pattern: \.example\.com, fields: [customer_id, software, apache_vhosts]}</pre> <p>In the example above, we've decided to use the <code class="docutils literal notranslate"><span class="pre">vm</span></code> collection in the database to store the data. Minion ids are stored in the <code class="docutils literal notranslate"><span class="pre">name</span></code> field on documents in that collection. And, since minion ids are FQDNs in most cases, we'll need to trim the domain name in order to find the minion by hostname in the collection. When we find a minion, return only the <code class="docutils literal notranslate"><span class="pre">customer_id</span></code>, <code class="docutils literal notranslate"><span class="pre">software</span></code>, and <code class="docutils literal notranslate"><span class="pre">apache_vhosts</span></code> fields, as that will contain the data we want for a given node. They will be available directly inside the <code class="docutils literal notranslate"><span class="pre">pillar</span></code> dict in your SLS templates.</p> </div> <div class="section" id="module-documentation"> <h2>Module Documentation</h2> <dl class="py function"> <h3 id="salt.pillar.mongo.ext_pillar"> salt.pillar.mongo.ext_pillar(minion_id, pillar, collection='pillar', id_field='_id', re_pattern=None, re_replace='', fields=None)</h3> <dd>
<p>Connect to a mongo database and read per-node pillar information.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li><p><strong>collection</strong> (<em>*</em>) -- The mongodb collection to read data from. Defaults to <code class="docutils literal notranslate"><span class="pre">'pillar'</span></code>.</p></li> <li><p><strong>id_field</strong> (<em>*</em>) -- The field in the collection that represents an individual minion id. Defaults to <code class="docutils literal notranslate"><span class="pre">'_id'</span></code>.</p></li> <li><p><strong>re_pattern</strong> (<em>*</em>) -- If your naming convention in the collection is shorter than the minion id, you can use this to trim the name. <cite>re_pattern</cite> will be used to match the name, and <cite>re_replace</cite> will be used to replace it. Backrefs are supported as they are in the Python standard library. If <code class="docutils literal notranslate"><span class="pre">None</span></code>, no mangling of the name will be performed - the collection will be searched with the entire minion id. Defaults to <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p></li> <li><p><strong>re_replace</strong> (<em>*</em>) -- Use as the replacement value in node ids matched with <cite>re_pattern</cite>. Defaults to ''. Feel free to use backreferences here.</p></li> <li><p><strong>fields</strong> (<em>*</em>) -- The specific fields in the document to use for the pillar data. If <code class="docutils literal notranslate"><span class="pre">None</span></code>, will use the entire document. If using the entire document, the <code class="docutils literal notranslate"><span class="pre">_id</span></code> field will be converted to string. Be careful with other fields in the document as they must be string serializable. Defaults to <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p></li> </ul> </dd> </dl> </dd>
</dl> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2021 SaltStack.<br>Licensed under the Apache License, Version 2.0.<br>
    <a href="https://docs.saltproject.io/en/latest/ref/pillar/all/salt.pillar.mongo.html" class="_attribution-link">https://docs.saltproject.io/en/latest/ref/pillar/all/salt.pillar.mongo.html</a>
  </p>
</div>
