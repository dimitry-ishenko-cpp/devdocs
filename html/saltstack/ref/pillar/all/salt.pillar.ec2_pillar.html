<h1>salt.pillar.ec2_pillar</h1> <p>Retrieve EC2 instance data for minions for ec2_tags and ec2_tags_list</p> <p>The minion id must be the AWS instance-id or value in <code class="docutils literal notranslate"><span class="pre">tag_match_key</span></code>. For example set <code class="docutils literal notranslate"><span class="pre">tag_match_key</span></code> to <code class="docutils literal notranslate"><span class="pre">Name</span></code> to have the minion-id matched against the tag 'Name'. The tag contents must be unique. The value of <code class="docutils literal notranslate"><span class="pre">tag_match_value</span></code> can be 'uqdn' or 'asis'. if 'uqdn', then the domain will be stripped before comparison.</p> <p>Additionally, the <code class="docutils literal notranslate"><span class="pre">use_grain</span></code> option can be set to <code class="docutils literal notranslate"><span class="pre">True</span></code>. This allows the use of an instance-id grain instead of the minion-id. Since this is a potential security risk, the configuration can be further expanded to include a list of minions that are trusted to only allow the alternate id of the instances to specific hosts. There is no glob matching at this time.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>If you are using <code class="docutils literal notranslate"><span class="pre">use_grain:</span> <span class="pre">True</span></code> in the configuration for this external pillar module, the minion must have <a class="reference internal" href="https://docs.saltproject.io/en/latest/ref/configuration/minion.html#std-conf_minion-metadata_server_grains"><code class="xref std std-conf_minion docutils literal notranslate"><span class="pre">metadata_server_grains</span></code></a> enabled in the minion config file (see also <a class="reference internal" href="../../grains/all/salt.grains.metadata.html#module-salt.grains.metadata" title="salt.grains.metadata"><code class="xref py py-mod docutils literal notranslate"><span class="pre">here</span></code></a>).</p> <p>It is important to also note that enabling the <code class="docutils literal notranslate"><span class="pre">use_grain</span></code> option allows the minion to manipulate the pillar data returned, as described above.</p> </div> <p>The optional <code class="docutils literal notranslate"><span class="pre">tag_list_key</span></code> indicates which keys should be added to <code class="docutils literal notranslate"><span class="pre">ec2_tags_list</span></code> and be split by <code class="docutils literal notranslate"><span class="pre">tag_list_sep</span></code> (by default <code class="docutils literal notranslate"><span class="pre">;</span></code>). If a tag key is included in <code class="docutils literal notranslate"><span class="pre">tag_list_key</span></code> it is removed from ec2_tags. If a tag does not exist it is still included as an empty list.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>As with any master configuration change, restart the salt-master daemon for changes to take effect.</p> </div> <pre class="highlight-yaml notranslate" data-language="yaml">ext_pillar:
  - ec2_pillar:
      tag_match_key: 'Name'
      tag_match_value: 'asis'
      tag_list_key:
        - Role
      tag_list_sep: ';'
      use_grain: True
      minion_ids:
        - trusted-minion-1
        - trusted-minion-2
        - trusted-minion-3</pre> <p>This is a very simple pillar configuration that simply retrieves the instance data from AWS. Currently the only portion implemented are EC2 tags, which returns a list of key/value pairs for all of the EC2 tags assigned to the instance.</p> <dl class="py function"> <h3 id="salt.pillar.ec2_pillar.ext_pillar"> salt.pillar.ec2_pillar.ext_pillar(minion_id, pillar, use_grain=False, minion_ids=None, tag_match_key=None, tag_match_value='asis', tag_list_key=None, tag_list_sep=';')</h3> <dd>
<p>Execute a command and read the output as YAML</p> </dd>
</dl><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2021 SaltStack.<br>Licensed under the Apache License, Version 2.0.<br>
    <a href="https://docs.saltproject.io/en/latest/ref/pillar/all/salt.pillar.ec2_pillar.html" class="_attribution-link">https://docs.saltproject.io/en/latest/ref/pillar/all/salt.pillar.ec2_pillar.html</a>
  </p>
</div>
