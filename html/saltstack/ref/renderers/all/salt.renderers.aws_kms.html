<h1>salt.renderers.aws_kms</h1> <p>Renderer that will decrypt ciphers encrypted using <a class="reference external" href="https://docs.aws.amazon.com/kms/latest/developerguide/workflow.html">AWS KMS Envelope Encryption</a>.</p> <p>Any key in the data to be rendered can be a urlsafe_b64encoded string, and this renderer will attempt to decrypt it before passing it off to Salt. This allows you to safely store secrets in source control, in such a way that only your Salt master can decrypt them and distribute them only to the minions that need them.</p> <p>The typical use-case would be to use ciphers in your pillar data, and keep the encrypted data key on your master. This way developers with appropriate AWS IAM privileges can add new secrets quickly and easily.</p> <p>This renderer requires the <a class="reference external" href="https://boto3.readthedocs.io/">boto3</a> Python library.</p> <div class="section" id="setup"> <h2>Setup</h2> <p>First, set up your AWS client. For complete instructions on configuration the AWS client, please read the <a class="reference external" href="https://boto3.readthedocs.io/en/latest/guide/configuration.html">boto3 configuration documentation</a>. By default, this renderer will use the default AWS profile. You can override the profile name in salt configuration. For example, if you have a profile in your aws client configuration named "salt", you can add the following salt configuration:</p> <pre class="highlight-yaml notranslate" data-language="yaml">aws_kms:
  profile_name: salt</pre> <p>The rest of these instructions assume that you will use the default profile for key generation and setup. If not, export AWS_PROFILE and set it to the desired value.</p> <p>Once the aws client is configured, generate a KMS customer master key and use that to generate a local data key.</p> <pre class="highlight-bash notranslate" data-language="bash"># data_key=$(aws kms generate-data-key --key-id your-key-id --key-spec AES_256
             --query 'CiphertextBlob' --output text)
# echo 'aws_kms:'
# echo '  data_key: !!binary "%s"\n' "$data_key" &gt;&gt; config/master</pre> <p>To apply the renderer on a file-by-file basis add the following line to the top of any pillar with gpg data in it:</p> <pre class="highlight-yaml notranslate" data-language="yaml">#!yaml|aws_kms</pre> <p>Now with your renderer configured, you can include your ciphers in your pillar data like so:</p> <pre class="highlight-yaml notranslate" data-language="yaml">#!yaml|aws_kms

a-secret: gAAAAABaj5uzShPI3PEz6nL5Vhk2eEHxGXSZj8g71B84CZsVjAAtDFY1mfjNRl-1Su9YVvkUzNjI4lHCJJfXqdcTvwczBYtKy0Pa7Ri02s10Wn1tF0tbRwk=</pre> <dl class="py function"> <h3 id="salt.renderers.aws_kms.render"> salt.renderers.aws_kms.render(data, saltenv='base', sls='', argline='', **kwargs)</h3> <dd>
<p>Decrypt the data to be rendered that was encrypted using AWS KMS envelope encryption.</p> </dd>
</dl> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2021 SaltStack.<br>Licensed under the Apache License, Version 2.0.<br>
    <a href="https://docs.saltproject.io/en/latest/ref/renderers/all/salt.renderers.aws_kms.html" class="_attribution-link">https://docs.saltproject.io/en/latest/ref/renderers/all/salt.renderers.aws_kms.html</a>
  </p>
</div>
