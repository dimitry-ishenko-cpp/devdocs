<h1>salt.modules.cmdmod</h1> <p>A module for shelling out.</p> <p>Keep in mind that this module is insecure, in that it can give whomever has access to the master root execution access to all salt minions.</p> <dl class="py function"> <h3 id="salt.modules.cmdmod.exec_code"> salt.modules.cmdmod.exec_code(lang, code, cwd=None, args=None, **kwargs)</h3> <dd>
<p>Pass in two strings, the first naming the executable language, aka - python2, python3, ruby, perl, lua, etc. the second string containing the code you wish to execute. The stdout will be returned.</p> <p>All parameters from <a class="reference internal" href="#salt.modules.cmdmod.run_all" title="salt.modules.cmdmod.run_all"><code class="xref py py-mod docutils literal notranslate"><span class="pre">cmd.run_all</span></code></a> except python_shell can be used.</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cmd.exec_code ruby 'puts "cheese"'
salt '*' cmd.exec_code ruby 'puts "cheese"' args='["arg1", "arg2"]' env='{"FOO": "bar"}'</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.cmdmod.exec_code_all"> salt.modules.cmdmod.exec_code_all(lang, code, cwd=None, args=None, **kwargs)</h3> <dd>
<p>Pass in two strings, the first naming the executable language, aka - python2, python3, ruby, perl, lua, etc. the second string containing the code you wish to execute. All cmd artifacts (stdout, stderr, retcode, pid) will be returned.</p> <p>All parameters from <a class="reference internal" href="#salt.modules.cmdmod.run_all" title="salt.modules.cmdmod.run_all"><code class="xref py py-mod docutils literal notranslate"><span class="pre">cmd.run_all</span></code></a> except python_shell can be used.</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cmd.exec_code_all ruby 'puts "cheese"'
salt '*' cmd.exec_code_all ruby 'puts "cheese"' args='["arg1", "arg2"]' env='{"FOO": "bar"}'</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.cmdmod.has_exec"> salt.modules.cmdmod.has_exec(cmd)</h3> <dd>
<p>Returns true if the executable is available on the minion, false otherwise</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cmd.has_exec cat</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.cmdmod.powershell"> salt.modules.cmdmod.powershell(cmd, cwd=None, stdin=None, runas=None, shell='powershell', env=None, clean_env=False, template=None, rstrip=True, umask=None, output_encoding=None, output_loglevel='debug', hide_output=False, timeout=None, reset_system_locale=True, ignore_retcode=False, saltenv='base', use_vt=False, password=None, depth=None, encode_cmd=False, success_retcodes=None, **kwargs)</h3> <dd>
<p>Execute the passed PowerShell command and return the output as a dictionary.</p> <p>Other <code class="docutils literal notranslate"><span class="pre">cmd.*</span></code> functions (besides <code class="docutils literal notranslate"><span class="pre">cmd.powershell_all</span></code>) return the raw text output of the command. This function appends <code class="docutils literal notranslate"><span class="pre">|</span> <span class="pre">ConvertTo-JSON</span></code> to the command and then parses the JSON into a Python dictionary. If you want the raw textual result of your PowerShell command you should use <code class="docutils literal notranslate"><span class="pre">cmd.run</span></code> with the <code class="docutils literal notranslate"><span class="pre">shell=powershell</span></code> option.</p> <p>For example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cmd.run '$PSVersionTable.CLRVersion' shell=powershell
salt '*' cmd.run 'Get-NetTCPConnection' shell=powershell</pre> <div class="versionadded"> <p><span class="versionmodified added">New in version 2016.3.0.</span></p> </div> <div class="admonition warning"> <p class="admonition-title">Warning</p> <p>This passes the cmd argument directly to PowerShell without any further processing! Be absolutely sure that you have properly sanitized the command passed to this function and do not use untrusted inputs.</p> </div> <p>In addition to the normal <code class="docutils literal notranslate"><span class="pre">cmd.run</span></code> parameters, this command offers the <code class="docutils literal notranslate"><span class="pre">depth</span></code> parameter to change the Windows default depth for the <code class="docutils literal notranslate"><span class="pre">ConvertTo-JSON</span></code> powershell command. The Windows default is 2. If you need more depth, set that here.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>For some commands, setting the depth to a value greater than 4 greatly increases the time it takes for the command to return and in many cases returns useless data.</p> </div> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li><p><strong>cmd</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The powershell command to run.</p></li> <li><p><strong>cwd</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The directory from which to execute the command. Defaults to the home directory of the user specified by <code class="docutils literal notranslate"><span class="pre">runas</span></code> (or the user under which Salt is running if <code class="docutils literal notranslate"><span class="pre">runas</span></code> is not specified).</p></li> <li><p><strong>stdin</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- A string of standard input can be specified for the command to be run using the <code class="docutils literal notranslate"><span class="pre">stdin</span></code> parameter. This can be useful in cases where sensitive information must be read from standard input.</p></li> <li><p><strong>runas</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- Specify an alternate user to run the command. The default behavior is to run as the user under which Salt is running. If running on a Windows minion you must also use the <code class="docutils literal notranslate"><span class="pre">password</span></code> argument, and the target user account must be in the Administrators group.</p></li> <li>
<p><strong>password</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- </p>
<p>Windows only. Required when specifying <code class="docutils literal notranslate"><span class="pre">runas</span></code>. This parameter will be ignored on non-Windows platforms.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2016.3.0.</span></p> </div> </li> <li><p><strong>shell</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- Specify an alternate shell. Defaults to "powershell". Can also use "pwsh" for powershell core if present on the system</p></li> <li><p><strong>python_shell</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- If False, let python handle the positional arguments. Set to True to use shell features, such as pipes or redirection.</p></li> <li>
<p><strong>env</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><em>dict</em></a>) -- </p>
<p>Environment variables to be set prior to execution.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>When passing environment variables on the CLI, they should be passed as the string representation of a dictionary.</p> <pre class="highlight-bash notranslate" data-language="bash">salt myminion cmd.powershell 'some command' env='{"FOO": "bar"}'</pre> </div> <div class="admonition note"> <p class="admonition-title">Note</p> <p>When using environment variables on Window's, case-sensitivity matters, i.e. Window's uses <cite>Path</cite> as opposed to <cite>PATH</cite> for other systems.</p> </div> </li> <li><p><strong>clean_env</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- Attempt to clean out all other shell environment variables and set only those provided in the 'env' argument to this function.</p></li> <li><p><strong>template</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- If this setting is applied then the named templating engine will be used to render the downloaded file. Currently jinja, mako, and wempy are supported.</p></li> <li><p><strong>rstrip</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- Strip all whitespace off the end of output before it is returned.</p></li> <li><p><strong>umask</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The umask (in octal) to use when running the command.</p></li> <li>
<p><strong>output_encoding</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- </p>
<p>Control the encoding used to decode the command's output.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This should not need to be used in most cases. By default, Salt will try to use the encoding detected from the system locale, and will fall back to UTF-8 if this fails. This should only need to be used in cases where the output of the command is encoded in something other than the system locale or UTF-8.</p> <p>To see the encoding Salt has detected from the system locale, check the <cite>locale</cite> line in the output of <a class="reference internal" href="salt.modules.test.html#salt.modules.test.versions_report" title="salt.modules.test.versions_report"><code class="xref py py-func docutils literal notranslate"><span class="pre">test.versions_report</span></code></a>.</p> </div> <div class="versionadded"> <p><span class="versionmodified added">New in version 2018.3.0.</span></p> </div> </li> <li>
<p><strong>output_loglevel</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- </p>
<p>Control the loglevel at which the output from the command is logged to the minion log.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>The command being run will still be logged at the <code class="docutils literal notranslate"><span class="pre">debug</span></code> loglevel regardless, unless <code class="docutils literal notranslate"><span class="pre">quiet</span></code> is used for this value.</p> </div> </li> <li><p><strong>ignore_retcode</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- If the exit code of the command is nonzero, this is treated as an error condition, and the output from the command will be logged to the minion log. However, there are some cases where programs use the return code for signaling and a nonzero exit code doesn't necessarily mean failure. Pass this argument as <code class="docutils literal notranslate"><span class="pre">True</span></code> to skip logging the output if the command has a nonzero exit code.</p></li> <li>
<p><strong>hide_output</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- </p>
<p>If <code class="docutils literal notranslate"><span class="pre">True</span></code>, suppress stdout and stderr in the return data.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This is separate from <code class="docutils literal notranslate"><span class="pre">output_loglevel</span></code>, which only handles how Salt logs to the minion log.</p> </div> <div class="versionadded"> <p><span class="versionmodified added">New in version 2018.3.0.</span></p> </div> </li> <li><p><strong>timeout</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) -- A timeout in seconds for the executed process to return.</p></li> <li><p><strong>use_vt</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- Use VT utils (saltstack) to stream the command output more interactively to the console and the logs. This is experimental.</p></li> <li><p><strong>reset_system_locale</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- Resets the system locale</p></li> <li><p><strong>saltenv</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The salt environment to use. Default is 'base'</p></li> <li>
<p><strong>depth</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) -- </p>
<p>The number of levels of contained objects to be included. Default is 2. Values greater than 4 seem to greatly increase the time it takes for the command to complete for some commands. eg: <code class="docutils literal notranslate"><span class="pre">dir</span></code></p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2016.3.4.</span></p> </div> </li> <li><p><strong>encode_cmd</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- Encode the command before executing. Use in cases where characters may be dropped or incorrectly converted when executed. Default is False.</p></li> <li>
<p><strong>success_retcodes</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><em>list</em></a>) -- </p>
<dl class="simple"> <dt>This parameter will be allow a list of</dt>
<dd>
<p>non-zero return codes that should be considered a success. If the return code returned from the run matches any in the provided list, the return code will be overridden with zero.</p> </dd> </dl> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </li> <li>
<p><strong>stdin_raw_newlines</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- </p>
<dl class="simple"> <dt>False</dt>
<dd>
<p>If <code class="docutils literal notranslate"><span class="pre">True</span></code>, Salt will not automatically convert the characters <code class="docutils literal notranslate"><span class="pre">\n</span></code> present in the <code class="docutils literal notranslate"><span class="pre">stdin</span></code> value to newlines.</p> </dd> </dl> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </li> </ul> </dd> <dt class="field-even">Returns</dt> <dd class="field-even">

<dl class="field-list simple"> <dt class="field-odd">dict</dt> <dd class="field-odd">
<p>A dictionary of data returned by the powershell command.</p> </dd> </dl> </dd> </dl> <p>CLI Example:</p> <pre class="highlight-powershell notranslate" data-language="powershell">salt '*' cmd.powershell "$PSVersionTable.CLRVersion"</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.cmdmod.powershell_all"> salt.modules.cmdmod.powershell_all(cmd, cwd=None, stdin=None, runas=None, shell='powershell', env=None, clean_env=False, template=None, rstrip=True, umask=None, output_encoding=None, output_loglevel='debug', quiet=False, timeout=None, reset_system_locale=True, ignore_retcode=False, saltenv='base', use_vt=False, password=None, depth=None, encode_cmd=False, force_list=False, success_retcodes=None, **kwargs)</h3> <dd>
<p>Execute the passed PowerShell command and return a dictionary with a result field representing the output of the command, as well as other fields showing us what the PowerShell invocation wrote to <code class="docutils literal notranslate"><span class="pre">stderr</span></code>, the process id, and the exit code of the invocation.</p> <p>This function appends <code class="docutils literal notranslate"><span class="pre">|</span> <span class="pre">ConvertTo-JSON</span></code> to the command before actually invoking powershell.</p> <p>An unquoted empty string is not valid JSON, but it's very normal for the Powershell output to be exactly that. Therefore, we do not attempt to parse empty Powershell output (which would result in an exception). Instead we treat this as a special case and one of two things will happen:</p> <ul class="simple"> <li><p>If the value of the <code class="docutils literal notranslate"><span class="pre">force_list</span></code> parameter is <code class="docutils literal notranslate"><span class="pre">True</span></code>, then the <code class="docutils literal notranslate"><span class="pre">result</span></code> field of the return dictionary will be an empty list.</p></li> <li><p>If the value of the <code class="docutils literal notranslate"><span class="pre">force_list</span></code> parameter is <code class="docutils literal notranslate"><span class="pre">False</span></code>, then the return dictionary <strong>will not have a result key added to it</strong>. We aren't setting <code class="docutils literal notranslate"><span class="pre">result</span></code> to <code class="docutils literal notranslate"><span class="pre">None</span></code> in this case, because <code class="docutils literal notranslate"><span class="pre">None</span></code> is the Python representation of "null" in JSON. (We likewise can't use <code class="docutils literal notranslate"><span class="pre">False</span></code> for the equivalent reason.)</p></li> </ul> <p>If Powershell's output is not an empty string and Python cannot parse its content, then a <code class="docutils literal notranslate"><span class="pre">CommandExecutionError</span></code> exception will be raised.</p> <p>If Powershell's output is not an empty string, Python is able to parse its content, and the type of the resulting Python object is other than <code class="docutils literal notranslate"><span class="pre">list</span></code> then one of two things will happen:</p> <ul class="simple"> <li><p>If the value of the <code class="docutils literal notranslate"><span class="pre">force_list</span></code> parameter is <code class="docutils literal notranslate"><span class="pre">True</span></code>, then the <code class="docutils literal notranslate"><span class="pre">result</span></code> field will be a singleton list with the Python object as its sole member.</p></li> <li><p>If the value of the <code class="docutils literal notranslate"><span class="pre">force_list</span></code> parameter is <code class="docutils literal notranslate"><span class="pre">False</span></code>, then the value of <code class="docutils literal notranslate"><span class="pre">result</span></code> will be the unmodified Python object.</p></li> </ul> <p>If Powershell's output is not an empty string, Python is able to parse its content, and the type of the resulting Python object is <code class="docutils literal notranslate"><span class="pre">list</span></code>, then the value of <code class="docutils literal notranslate"><span class="pre">result</span></code> will be the unmodified Python object. The <code class="docutils literal notranslate"><span class="pre">force_list</span></code> parameter has no effect in this case.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>An example of why the <code class="docutils literal notranslate"><span class="pre">force_list</span></code> parameter is useful is as follows: The Powershell command <code class="docutils literal notranslate"><span class="pre">dir</span> <span class="pre">x</span> <span class="pre">|</span> <span class="pre">Convert-ToJson</span></code> results in</p> <ul class="simple"> <li><p>no output when x is an empty directory.</p></li> <li><p>a dictionary object when x contains just one item.</p></li> <li><p>a list of dictionary objects when x contains multiple items.</p></li> </ul> <p>By setting <code class="docutils literal notranslate"><span class="pre">force_list</span></code> to <code class="docutils literal notranslate"><span class="pre">True</span></code> we will always end up with a list of dictionary items, representing files, no matter how many files x contains. Conversely, if <code class="docutils literal notranslate"><span class="pre">force_list</span></code> is <code class="docutils literal notranslate"><span class="pre">False</span></code>, we will end up with no <code class="docutils literal notranslate"><span class="pre">result</span></code> key in our return dictionary when x is an empty directory, and a dictionary object when x contains just one file.</p> </div> <p>If you want a similar function but with a raw textual result instead of a Python dictionary, you should use <code class="docutils literal notranslate"><span class="pre">cmd.run_all</span></code> in combination with <code class="docutils literal notranslate"><span class="pre">shell=powershell</span></code>.</p> <p>The remaining fields in the return dictionary are described in more detail in the <code class="docutils literal notranslate"><span class="pre">Returns</span></code> section.</p> <p>Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cmd.run_all '$PSVersionTable.CLRVersion' shell=powershell
salt '*' cmd.run_all 'Get-NetTCPConnection' shell=powershell</pre> <div class="versionadded"> <p><span class="versionmodified added">New in version 2018.3.0.</span></p> </div> <div class="admonition warning"> <p class="admonition-title">Warning</p> <p>This passes the cmd argument directly to PowerShell without any further processing! Be absolutely sure that you have properly sanitized the command passed to this function and do not use untrusted inputs.</p> </div> <p>In addition to the normal <code class="docutils literal notranslate"><span class="pre">cmd.run</span></code> parameters, this command offers the <code class="docutils literal notranslate"><span class="pre">depth</span></code> parameter to change the Windows default depth for the <code class="docutils literal notranslate"><span class="pre">ConvertTo-JSON</span></code> powershell command. The Windows default is 2. If you need more depth, set that here.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>For some commands, setting the depth to a value greater than 4 greatly increases the time it takes for the command to return and in many cases returns useless data.</p> </div> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li><p><strong>cmd</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The powershell command to run.</p></li> <li><p><strong>cwd</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The directory from which to execute the command. Defaults to the home directory of the user specified by <code class="docutils literal notranslate"><span class="pre">runas</span></code> (or the user under which Salt is running if <code class="docutils literal notranslate"><span class="pre">runas</span></code> is not specified).</p></li> <li><p><strong>stdin</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- A string of standard input can be specified for the command to be run using the <code class="docutils literal notranslate"><span class="pre">stdin</span></code> parameter. This can be useful in cases where sensitive information must be read from standard input.</p></li> <li><p><strong>runas</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- Specify an alternate user to run the command. The default behavior is to run as the user under which Salt is running. If running on a Windows minion you must also use the <code class="docutils literal notranslate"><span class="pre">password</span></code> argument, and the target user account must be in the Administrators group.</p></li> <li><p><strong>password</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- Windows only. Required when specifying <code class="docutils literal notranslate"><span class="pre">runas</span></code>. This parameter will be ignored on non-Windows platforms.</p></li> <li><p><strong>shell</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- Specify an alternate shell. Defaults to "powershell". Can also use "pwsh" for powershell core if present on the system</p></li> <li><p><strong>python_shell</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- If False, let python handle the positional arguments. Set to True to use shell features, such as pipes or redirection.</p></li> <li>
<p><strong>env</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><em>dict</em></a>) -- </p>
<p>Environment variables to be set prior to execution.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>When passing environment variables on the CLI, they should be passed as the string representation of a dictionary.</p> <pre class="highlight-bash notranslate" data-language="bash">salt myminion cmd.powershell_all 'some command' env='{"FOO": "bar"}'</pre> </div> <div class="admonition note"> <p class="admonition-title">Note</p> <p>When using environment variables on Window's, case-sensitivity matters, i.e. Window's uses <cite>Path</cite> as opposed to <cite>PATH</cite> for other systems.</p> </div> </li> <li><p><strong>clean_env</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- Attempt to clean out all other shell environment variables and set only those provided in the 'env' argument to this function.</p></li> <li><p><strong>template</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- If this setting is applied then the named templating engine will be used to render the downloaded file. Currently jinja, mako, and wempy are supported.</p></li> <li><p><strong>rstrip</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- Strip all whitespace off the end of output before it is returned.</p></li> <li><p><strong>umask</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The umask (in octal) to use when running the command.</p></li> <li>
<p><strong>output_encoding</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- </p>
<p>Control the encoding used to decode the command's output.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This should not need to be used in most cases. By default, Salt will try to use the encoding detected from the system locale, and will fall back to UTF-8 if this fails. This should only need to be used in cases where the output of the command is encoded in something other than the system locale or UTF-8.</p> <p>To see the encoding Salt has detected from the system locale, check the <cite>locale</cite> line in the output of <a class="reference internal" href="salt.modules.test.html#salt.modules.test.versions_report" title="salt.modules.test.versions_report"><code class="xref py py-func docutils literal notranslate"><span class="pre">test.versions_report</span></code></a>.</p> </div> <div class="versionadded"> <p><span class="versionmodified added">New in version 2018.3.0.</span></p> </div> </li> <li>
<p><strong>output_loglevel</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- </p>
<p>Control the loglevel at which the output from the command is logged to the minion log.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>The command being run will still be logged at the <code class="docutils literal notranslate"><span class="pre">debug</span></code> loglevel regardless, unless <code class="docutils literal notranslate"><span class="pre">quiet</span></code> is used for this value.</p> </div> </li> <li><p><strong>ignore_retcode</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- If the exit code of the command is nonzero, this is treated as an error condition, and the output from the command will be logged to the minion log. However, there are some cases where programs use the return code for signaling and a nonzero exit code doesn't necessarily mean failure. Pass this argument as <code class="docutils literal notranslate"><span class="pre">True</span></code> to skip logging the output if the command has a nonzero exit code.</p></li> <li><p><strong>timeout</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) -- A timeout in seconds for the executed process to return.</p></li> <li><p><strong>use_vt</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- Use VT utils (saltstack) to stream the command output more interactively to the console and the logs. This is experimental.</p></li> <li><p><strong>reset_system_locale</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- Resets the system locale</p></li> <li><p><strong>ignore_retcode</strong> -- If the exit code of the command is nonzero, this is treated as an error condition, and the output from the command will be logged to the minion log. However, there are some cases where programs use the return code for signaling and a nonzero exit code doesn't necessarily mean failure. Pass this argument as <code class="docutils literal notranslate"><span class="pre">True</span></code> to skip logging the output if the command has a nonzero exit code.</p></li> <li><p><strong>saltenv</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The salt environment to use. Default is 'base'</p></li> <li><p><strong>depth</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) -- The number of levels of contained objects to be included. Default is 2. Values greater than 4 seem to greatly increase the time it takes for the command to complete for some commands. eg: <code class="docutils literal notranslate"><span class="pre">dir</span></code></p></li> <li><p><strong>encode_cmd</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- Encode the command before executing. Use in cases where characters may be dropped or incorrectly converted when executed. Default is False.</p></li> <li><p><strong>force_list</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- The purpose of this parameter is described in the preamble of this function's documentation. Default value is False.</p></li> <li>
<p><strong>success_retcodes</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><em>list</em></a>) -- </p>
<dl class="simple"> <dt>This parameter will be allow a list of</dt>
<dd>
<p>non-zero return codes that should be considered a success. If the return code returned from the run matches any in the provided list, the return code will be overridden with zero.</p> </dd> </dl> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </li> <li>
<p><strong>stdin_raw_newlines</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- </p>
<dl class="simple"> <dt>False</dt>
<dd>
<p>If <code class="docutils literal notranslate"><span class="pre">True</span></code>, Salt will not automatically convert the characters <code class="docutils literal notranslate"><span class="pre">\n</span></code> present in the <code class="docutils literal notranslate"><span class="pre">stdin</span></code> value to newlines.</p> </dd> </dl> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </li> </ul> </dd> <dt class="field-even">Returns</dt> <dd class="field-even">

<p>A dictionary with the following entries:</p> <dl class="simple"> <dt>result</dt>
<dd>
<p>For a complete description of this field, please refer to this function's preamble. <strong>This key will not be added to the dictionary when force_list is False and Powershell's output is the empty string.</strong></p> </dd> <dt>stderr</dt>
<dd>
<p>What the PowerShell invocation wrote to <code class="docutils literal notranslate"><span class="pre">stderr</span></code>.</p> </dd> <dt>pid</dt>
<dd>
<p>The process id of the PowerShell invocation</p> </dd> <dt>retcode</dt>
<dd>
<p>This is the exit code of the invocation of PowerShell. If the final execution status (in PowerShell) of our command (with <code class="docutils literal notranslate"><span class="pre">|</span> <span class="pre">ConvertTo-JSON</span></code> appended) is <code class="docutils literal notranslate"><span class="pre">False</span></code> this should be non-0. Likewise if PowerShell exited with <code class="docutils literal notranslate"><span class="pre">$LASTEXITCODE</span></code> set to some non-0 value, then <code class="docutils literal notranslate"><span class="pre">retcode</span></code> will end up with this value.</p> </dd> </dl> </dd> <dt class="field-odd">Return type</dt> <dd class="field-odd">
<p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)">dict</a></p> </dd> </dl> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cmd.powershell_all "$PSVersionTable.CLRVersion"</pre> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cmd.powershell_all "dir mydirectory" force_list=True</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.cmdmod.retcode"> salt.modules.cmdmod.retcode(cmd, cwd=None, stdin=None, runas=None, group=None, shell='/bin/sh', python_shell=None, env=None, clean_env=False, template=None, umask=None, output_encoding=None, output_loglevel='debug', log_callback=None, timeout=None, reset_system_locale=True, ignore_retcode=False, saltenv='base', use_vt=False, password=None, success_retcodes=None, **kwargs)</h3> <dd>
<p>Execute a shell command and return the command's return code.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li><p><strong>cmd</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The command to run. ex: <code class="docutils literal notranslate"><span class="pre">ls</span> <span class="pre">-lart</span> <span class="pre">/home</span></code></p></li> <li><p><strong>cwd</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The directory from which to execute the command. Defaults to the home directory of the user specified by <code class="docutils literal notranslate"><span class="pre">runas</span></code> (or the user under which Salt is running if <code class="docutils literal notranslate"><span class="pre">runas</span></code> is not specified).</p></li> <li><p><strong>stdin</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- A string of standard input can be specified for the command to be run using the <code class="docutils literal notranslate"><span class="pre">stdin</span></code> parameter. This can be useful in cases where sensitive information must be read from standard input.</p></li> <li>
<p><strong>runas</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- </p>
<p>Specify an alternate user to run the command. The default behavior is to run as the user under which Salt is running. If running on a Windows minion you must also use the <code class="docutils literal notranslate"><span class="pre">password</span></code> argument, and the target user account must be in the Administrators group.</p> <div class="admonition warning"> <p class="admonition-title">Warning</p> <p>For versions 2018.3.3 and above on macosx while using runas, to pass special characters to the command you need to escape the characters on the shell.</p> <p>Example:</p> <pre class="highlight-bash notranslate" data-language="bash">cmd.retcode 'echo '\''h=\"baz\"'\''' runas=macuser</pre> </div> </li> <li>
<p><strong>password</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- </p>
<p>Windows only. Required when specifying <code class="docutils literal notranslate"><span class="pre">runas</span></code>. This parameter will be ignored on non-Windows platforms.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2016.3.0.</span></p> </div> </li> <li><p><strong>group</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- Group to run command as. Not currently supported on Windows.</p></li> <li><p><strong>shell</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- Specify an alternate shell. Defaults to the system's default shell.</p></li> <li><p><strong>python_shell</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- If False, let python handle the positional arguments. Set to True to use shell features, such as pipes or redirection.</p></li> <li>
<p><strong>env</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><em>dict</em></a>) -- </p>
<p>Environment variables to be set prior to execution.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>When passing environment variables on the CLI, they should be passed as the string representation of a dictionary.</p> <pre class="highlight-bash notranslate" data-language="bash">salt myminion cmd.retcode 'some command' env='{"FOO": "bar"}'</pre> </div> <div class="admonition note"> <p class="admonition-title">Note</p> <p>When using environment variables on Window's, case-sensitivity matters, i.e. Window's uses <cite>Path</cite> as opposed to <cite>PATH</cite> for other systems.</p> </div> </li> <li><p><strong>clean_env</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- Attempt to clean out all other shell environment variables and set only those provided in the 'env' argument to this function.</p></li> <li><p><strong>template</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- If this setting is applied then the named templating engine will be used to render the downloaded file. Currently jinja, mako, and wempy are supported.</p></li> <li><p><strong>rstrip</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- Strip all whitespace off the end of output before it is returned.</p></li> <li><p><strong>umask</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The umask (in octal) to use when running the command.</p></li> <li>
<p><strong>output_encoding</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- </p>
<p>Control the encoding used to decode the command's output.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This should not need to be used in most cases. By default, Salt will try to use the encoding detected from the system locale, and will fall back to UTF-8 if this fails. This should only need to be used in cases where the output of the command is encoded in something other than the system locale or UTF-8.</p> <p>To see the encoding Salt has detected from the system locale, check the <cite>locale</cite> line in the output of <a class="reference internal" href="salt.modules.test.html#salt.modules.test.versions_report" title="salt.modules.test.versions_report"><code class="xref py py-func docutils literal notranslate"><span class="pre">test.versions_report</span></code></a>.</p> </div> <div class="versionadded"> <p><span class="versionmodified added">New in version 2018.3.0.</span></p> </div> </li> <li>
<p><strong>output_loglevel</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- </p>
<p>Control the loglevel at which the output from the command is logged to the minion log.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>The command being run will still be logged at the <code class="docutils literal notranslate"><span class="pre">debug</span></code> loglevel regardless, unless <code class="docutils literal notranslate"><span class="pre">quiet</span></code> is used for this value.</p> </div> </li> <li><p><strong>ignore_retcode</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- If the exit code of the command is nonzero, this is treated as an error condition, and the output from the command will be logged to the minion log. However, there are some cases where programs use the return code for signaling and a nonzero exit code doesn't necessarily mean failure. Pass this argument as <code class="docutils literal notranslate"><span class="pre">True</span></code> to skip logging the output if the command has a nonzero exit code.</p></li> <li><p><strong>timeout</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) -- A timeout in seconds for the executed process to return.</p></li> <li><p><strong>use_vt</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- Use VT utils (saltstack) to stream the command output more interactively to the console and the logs. This is experimental.</p></li> <li>
<p><strong>success_retcodes</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><em>list</em></a>) -- </p>
<dl class="simple"> <dt>This parameter will be allow a list of</dt>
<dd>
<p>non-zero return codes that should be considered a success. If the return code returned from the run matches any in the provided list, the return code will be overridden with zero.</p> </dd> </dl> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </li> <li>
<p><strong>stdin_raw_newlines</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- </p>
<dl class="simple"> <dt>False</dt>
<dd>
<p>If <code class="docutils literal notranslate"><span class="pre">True</span></code>, Salt will not automatically convert the characters <code class="docutils literal notranslate"><span class="pre">\n</span></code> present in the <code class="docutils literal notranslate"><span class="pre">stdin</span></code> value to newlines.</p> </dd> </dl> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </li> </ul> </dd> <dt class="field-even">Return type</dt> <dd class="field-even">
<p><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)">int</a></p> </dd> <dt class="field-odd">Return type</dt> <dd class="field-odd">
<p><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.9)">None</a></p> </dd> <dt class="field-even">Returns</dt> <dd class="field-even">
<p>Return Code as an int or None if there was an exception.</p> </dd> </dl> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cmd.retcode "file /bin/bash"</pre> <p>The template arg can be set to 'jinja' or another supported template engine to render the command arguments before execution. For example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cmd.retcode template=jinja "file {{grains.pythonpath[0]}}/python"</pre> <p>A string of standard input can be specified for the command to be run using the <code class="docutils literal notranslate"><span class="pre">stdin</span></code> parameter. This can be useful in cases where sensitive information must be read from standard input.</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cmd.retcode "grep f" stdin='one\ntwo\nthree\nfour\nfive\n'</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.cmdmod.run"> salt.modules.cmdmod.run(cmd, cwd=None, stdin=None, runas=None, group=None, shell='/bin/sh', python_shell=None, env=None, clean_env=False, template=None, rstrip=True, umask=None, output_encoding=None, output_loglevel='debug', log_callback=None, hide_output=False, timeout=None, reset_system_locale=True, ignore_retcode=False, saltenv='base', use_vt=False, bg=False, password=None, encoded_cmd=False, raise_err=False, prepend_path=None, success_retcodes=None, **kwargs)</h3> <dd>
<p>Execute the passed command and return the output as a string</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li><p><strong>cmd</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The command to run. ex: <code class="docutils literal notranslate"><span class="pre">ls</span> <span class="pre">-lart</span> <span class="pre">/home</span></code></p></li> <li><p><strong>cwd</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The directory from which to execute the command. Defaults to the home directory of the user specified by <code class="docutils literal notranslate"><span class="pre">runas</span></code> (or the user under which Salt is running if <code class="docutils literal notranslate"><span class="pre">runas</span></code> is not specified).</p></li> <li><p><strong>stdin</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- A string of standard input can be specified for the command to be run using the <code class="docutils literal notranslate"><span class="pre">stdin</span></code> parameter. This can be useful in cases where sensitive information must be read from standard input.</p></li> <li>
<p><strong>runas</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- </p>
<p>Specify an alternate user to run the command. The default behavior is to run as the user under which Salt is running.</p> <div class="admonition warning"> <p class="admonition-title">Warning</p> <p>For versions 2018.3.3 and above on macosx while using runas, on linux while using run, to pass special characters to the command you need to escape the characters on the shell.</p> <p>Example:</p> <pre class="highlight-bash notranslate" data-language="bash">cmd.run 'echo '\''h=\"baz\"'\''' runas=macuser</pre> </div> </li> <li><p><strong>group</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- Group to run command as. Not currently supported on Windows.</p></li> <li>
<p><strong>password</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- </p>
<p>Windows only. Required when specifying <code class="docutils literal notranslate"><span class="pre">runas</span></code>. This parameter will be ignored on non-Windows platforms.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2016.3.0.</span></p> </div> </li> <li><p><strong>shell</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- Specify an alternate shell. Defaults to the system's default shell.</p></li> <li><p><strong>python_shell</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- If <code class="docutils literal notranslate"><span class="pre">False</span></code>, let python handle the positional arguments. Set to <code class="docutils literal notranslate"><span class="pre">True</span></code> to use shell features, such as pipes or redirection.</p></li> <li>
<p><strong>bg</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- </p>
<p>If <code class="docutils literal notranslate"><span class="pre">True</span></code>, run command in background and do not await or deliver its results</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2016.3.0.</span></p> </div> </li> <li>
<p><strong>env</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><em>dict</em></a>) -- </p>
<p>Environment variables to be set prior to execution.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>When passing environment variables on the CLI, they should be passed as the string representation of a dictionary.</p> <pre class="highlight-bash notranslate" data-language="bash">salt myminion cmd.run 'some command' env='{"FOO": "bar"}'</pre> </div> <div class="admonition note"> <p class="admonition-title">Note</p> <p>When using environment variables on Window's, case-sensitivity matters, i.e. Window's uses <cite>Path</cite> as opposed to <cite>PATH</cite> for other systems.</p> </div> </li> <li><p><strong>clean_env</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- Attempt to clean out all other shell environment variables and set only those provided in the 'env' argument to this function.</p></li> <li>
<p><strong>prepend_path</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- </p>
<p>$PATH segment to prepend (trailing ':' not necessary) to $PATH</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2018.3.0.</span></p> </div> </li> <li><p><strong>template</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- If this setting is applied then the named templating engine will be used to render the downloaded file. Currently jinja, mako, and wempy are supported.</p></li> <li><p><strong>rstrip</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- Strip all whitespace off the end of output before it is returned.</p></li> <li><p><strong>umask</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The umask (in octal) to use when running the command.</p></li> <li>
<p><strong>output_encoding</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- </p>
<p>Control the encoding used to decode the command's output.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This should not need to be used in most cases. By default, Salt will try to use the encoding detected from the system locale, and will fall back to UTF-8 if this fails. This should only need to be used in cases where the output of the command is encoded in something other than the system locale or UTF-8.</p> <p>To see the encoding Salt has detected from the system locale, check the <cite>locale</cite> line in the output of <a class="reference internal" href="salt.modules.test.html#salt.modules.test.versions_report" title="salt.modules.test.versions_report"><code class="xref py py-func docutils literal notranslate"><span class="pre">test.versions_report</span></code></a>.</p> </div> <div class="versionadded"> <p><span class="versionmodified added">New in version 2018.3.0.</span></p> </div> </li> <li>
<p><strong>output_loglevel</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- </p>
<p>Control the loglevel at which the output from the command is logged to the minion log.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>The command being run will still be logged at the <code class="docutils literal notranslate"><span class="pre">debug</span></code> loglevel regardless, unless <code class="docutils literal notranslate"><span class="pre">quiet</span></code> is used for this value.</p> </div> </li> <li><p><strong>ignore_retcode</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- If the exit code of the command is nonzero, this is treated as an error condition, and the output from the command will be logged to the minion log. However, there are some cases where programs use the return code for signaling and a nonzero exit code doesn't necessarily mean failure. Pass this argument as <code class="docutils literal notranslate"><span class="pre">True</span></code> to skip logging the output if the command has a nonzero exit code.</p></li> <li>
<p><strong>hide_output</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- </p>
<p>If <code class="docutils literal notranslate"><span class="pre">True</span></code>, suppress stdout and stderr in the return data.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This is separate from <code class="docutils literal notranslate"><span class="pre">output_loglevel</span></code>, which only handles how Salt logs to the minion log.</p> </div> <div class="versionadded"> <p><span class="versionmodified added">New in version 2018.3.0.</span></p> </div> </li> <li><p><strong>timeout</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) -- A timeout in seconds for the executed process to return.</p></li> <li><p><strong>use_vt</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- Use VT utils (saltstack) to stream the command output more interactively to the console and the logs. This is experimental.</p></li> <li>
<p><strong>encoded_cmd</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- </p>
<p>Specify if the supplied command is encoded. Only applies to shell 'powershell' and 'pwsh'.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2018.3.0.</span></p> </div> <p>Older versions of powershell seem to return raw xml data in the return. To avoid raw xml data in the return, prepend your command with the following before encoding:</p> <p><cite>$ProgressPreference='SilentlyContinue'; &lt;your command&gt;</cite></p> <p>The following powershell code block will encode the <cite>Write-Output</cite> command so that it will not have the raw xml data in the return:</p> <pre class="highlight-powershell notranslate" data-language="powershell"># target string
$Command = '$ProgressPreference="SilentlyContinue"; Write-Output "hello"'

# Convert to Base64 encoded string
$Encoded = [convert]::ToBase64String([System.Text.encoding]::Unicode.GetBytes($command))

Write-Output $Encoded</pre> </li> <li><p><strong>raise_err</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- If <code class="docutils literal notranslate"><span class="pre">True</span></code> and the command has a nonzero exit code, a CommandExecutionError exception will be raised.</p></li> </ul> </dd> </dl> <div class="admonition warning"> <p class="admonition-title">Warning</p> <p>This function does not process commands through a shell unless the python_shell flag is set to True. This means that any shell-specific functionality such as 'echo' or the use of pipes, redirection or &amp;&amp;, should either be migrated to cmd.shell or have the python_shell=True flag set here.</p> <p>The use of python_shell=True means that the shell will accept _any_ input including potentially malicious commands such as 'good_command;rm -rf /'. Be absolutely certain that you have sanitized your input prior to using python_shell=True</p> </div> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li>
<p><strong>success_retcodes</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><em>list</em></a>) -- </p>
<dl class="simple"> <dt>This parameter will be allow a list of</dt>
<dd>
<p>non-zero return codes that should be considered a success. If the return code returned from the run matches any in the provided list, the return code will be overridden with zero.</p> </dd> </dl> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </li> <li>
<p><strong>stdin_raw_newlines</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- </p>
<dl class="simple"> <dt>False</dt>
<dd>
<p>If <code class="docutils literal notranslate"><span class="pre">True</span></code>, Salt will not automatically convert the characters <code class="docutils literal notranslate"><span class="pre">\\n</span></code> present in the <code class="docutils literal notranslate"><span class="pre">stdin</span></code> value to newlines.</p> </dd> </dl> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </li> <li>
<p><strong>windows_codepage</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) -- </p>
<dl class="simple"> <dt>65001</dt>
<dd>
<p>Only applies to Windows: the minion uses <cite>C:WindowsSystem32chcp.com</cite> to verify or set the code page before the command <cite>cmd</cite> is executed. Code page 65001 corresponds with UTF-8 and allows international localization of Windows.</p> </dd> </dl> <div class="versionadded"> <p><span class="versionmodified added">New in version 3002.</span></p> </div> </li> </ul> </dd> </dl> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cmd.run "ls -l | awk '/foo/{print \\$2}'"</pre> <p>The template arg can be set to 'jinja' or another supported template engine to render the command arguments before execution. For example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cmd.run template=jinja "ls -l /tmp/{{grains.id}} | awk '/foo/{print \\$2}'"</pre> <p>Specify an alternate shell with the shell parameter:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cmd.run "Get-ChildItem C:\\ " shell='powershell'</pre> <p>A string of standard input can be specified for the command to be run using the <code class="docutils literal notranslate"><span class="pre">stdin</span></code> parameter. This can be useful in cases where sensitive information must be read from standard input.</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cmd.run "grep f" stdin='one\\ntwo\\nthree\\nfour\\nfive\\n'</pre> <p>If an equal sign (<code class="docutils literal notranslate"><span class="pre">=</span></code>) appears in an argument to a Salt command it is interpreted as a keyword argument in the format <code class="docutils literal notranslate"><span class="pre">key=val</span></code>. That processing can be bypassed in order to pass an equal sign through to the remote shell command by manually specifying the kwarg:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cmd.run cmd='sed -e s/=/:/g'</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.cmdmod.run_all"> salt.modules.cmdmod.run_all(cmd, cwd=None, stdin=None, runas=None, group=None, shell='/bin/sh', python_shell=None, env=None, clean_env=False, template=None, rstrip=True, umask=None, output_encoding=None, output_loglevel='debug', log_callback=None, hide_output=False, timeout=None, reset_system_locale=True, ignore_retcode=False, saltenv='base', use_vt=False, redirect_stderr=False, password=None, encoded_cmd=False, prepend_path=None, success_retcodes=None, **kwargs)</h3> <dd>
<p>Execute the passed command and return a dict of return data</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li><p><strong>cmd</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The command to run. ex: <code class="docutils literal notranslate"><span class="pre">ls</span> <span class="pre">-lart</span> <span class="pre">/home</span></code></p></li> <li><p><strong>cwd</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The directory from which to execute the command. Defaults to the home directory of the user specified by <code class="docutils literal notranslate"><span class="pre">runas</span></code> (or the user under which Salt is running if <code class="docutils literal notranslate"><span class="pre">runas</span></code> is not specified).</p></li> <li><p><strong>stdin</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- A string of standard input can be specified for the command to be run using the <code class="docutils literal notranslate"><span class="pre">stdin</span></code> parameter. This can be useful in cases where sensitive information must be read from standard input.</p></li> <li>
<p><strong>runas</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- </p>
<p>Specify an alternate user to run the command. The default behavior is to run as the user under which Salt is running. If running on a Windows minion you must also use the <code class="docutils literal notranslate"><span class="pre">password</span></code> argument, and the target user account must be in the Administrators group.</p> <div class="admonition warning"> <p class="admonition-title">Warning</p> <p>For versions 2018.3.3 and above on macosx while using runas, to pass special characters to the command you need to escape the characters on the shell.</p> <p>Example:</p> <pre class="highlight-bash notranslate" data-language="bash">cmd.run_all 'echo '\''h=\"baz\"'\''' runas=macuser</pre> </div> </li> <li>
<p><strong>password</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- </p>
<p>Windows only. Required when specifying <code class="docutils literal notranslate"><span class="pre">runas</span></code>. This parameter will be ignored on non-Windows platforms.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2016.3.0.</span></p> </div> </li> <li><p><strong>group</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- Group to run command as. Not currently supported on Windows.</p></li> <li><p><strong>shell</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- Specify an alternate shell. Defaults to the system's default shell.</p></li> <li><p><strong>python_shell</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- If False, let python handle the positional arguments. Set to True to use shell features, such as pipes or redirection.</p></li> <li>
<p><strong>env</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><em>dict</em></a>) -- </p>
<p>Environment variables to be set prior to execution.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>When passing environment variables on the CLI, they should be passed as the string representation of a dictionary.</p> <pre class="highlight-bash notranslate" data-language="bash">salt myminion cmd.run_all 'some command' env='{"FOO": "bar"}'</pre> </div> <div class="admonition note"> <p class="admonition-title">Note</p> <p>When using environment variables on Window's, case-sensitivity matters, i.e. Window's uses <cite>Path</cite> as opposed to <cite>PATH</cite> for other systems.</p> </div> </li> <li><p><strong>clean_env</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- Attempt to clean out all other shell environment variables and set only those provided in the 'env' argument to this function.</p></li> <li>
<p><strong>prepend_path</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- </p>
<p>$PATH segment to prepend (trailing ':' not necessary) to $PATH</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2018.3.0.</span></p> </div> </li> <li><p><strong>template</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- If this setting is applied then the named templating engine will be used to render the downloaded file. Currently jinja, mako, and wempy are supported.</p></li> <li><p><strong>rstrip</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- Strip all whitespace off the end of output before it is returned.</p></li> <li><p><strong>umask</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The umask (in octal) to use when running the command.</p></li> <li>
<p><strong>output_encoding</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- </p>
<p>Control the encoding used to decode the command's output.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This should not need to be used in most cases. By default, Salt will try to use the encoding detected from the system locale, and will fall back to UTF-8 if this fails. This should only need to be used in cases where the output of the command is encoded in something other than the system locale or UTF-8.</p> <p>To see the encoding Salt has detected from the system locale, check the <cite>locale</cite> line in the output of <a class="reference internal" href="salt.modules.test.html#salt.modules.test.versions_report" title="salt.modules.test.versions_report"><code class="xref py py-func docutils literal notranslate"><span class="pre">test.versions_report</span></code></a>.</p> </div> <div class="versionadded"> <p><span class="versionmodified added">New in version 2018.3.0.</span></p> </div> </li> <li>
<p><strong>output_loglevel</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- </p>
<p>Control the loglevel at which the output from the command is logged to the minion log.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>The command being run will still be logged at the <code class="docutils literal notranslate"><span class="pre">debug</span></code> loglevel regardless, unless <code class="docutils literal notranslate"><span class="pre">quiet</span></code> is used for this value.</p> </div> </li> <li><p><strong>ignore_retcode</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- If the exit code of the command is nonzero, this is treated as an error condition, and the output from the command will be logged to the minion log. However, there are some cases where programs use the return code for signaling and a nonzero exit code doesn't necessarily mean failure. Pass this argument as <code class="docutils literal notranslate"><span class="pre">True</span></code> to skip logging the output if the command has a nonzero exit code.</p></li> <li>
<p><strong>hide_output</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- </p>
<p>If <code class="docutils literal notranslate"><span class="pre">True</span></code>, suppress stdout and stderr in the return data.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This is separate from <code class="docutils literal notranslate"><span class="pre">output_loglevel</span></code>, which only handles how Salt logs to the minion log.</p> </div> <div class="versionadded"> <p><span class="versionmodified added">New in version 2018.3.0.</span></p> </div> </li> <li><p><strong>timeout</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) -- A timeout in seconds for the executed process to return.</p></li> <li><p><strong>use_vt</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- Use VT utils (saltstack) to stream the command output more interactively to the console and the logs. This is experimental.</p></li> <li>
<p><strong>encoded_cmd</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- </p>
<p>Specify if the supplied command is encoded. Only applies to shell 'powershell' and 'pwsh'.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2018.3.0.</span></p> </div> <p>Older versions of powershell seem to return raw xml data in the return. To avoid raw xml data in the return, prepend your command with the following before encoding:</p> <p><cite>$ProgressPreference='SilentlyContinue'; &lt;your command&gt;</cite></p> <p>The following powershell code block will encode the <cite>Write-Output</cite> command so that it will not have the raw xml data in the return:</p> <pre class="highlight-powershell notranslate" data-language="powershell"># target string
$Command = '$ProgressPreference="SilentlyContinue"; Write-Output "hello"'

# Convert to Base64 encoded string
$Encoded = [convert]::ToBase64String([System.Text.encoding]::Unicode.GetBytes($command))

Write-Output $Encoded</pre> </li> <li>
<p><strong>redirect_stderr</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- </p>
<p>If set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, then stderr will be redirected to stdout. This is helpful for cases where obtaining both the retcode and output is desired, but it is not desired to have the output separated into both stdout and stderr.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2015.8.2.</span></p> </div> </li> <li>
<p><strong>password</strong> -- </p>
<p>Windows only. Required when specifying <code class="docutils literal notranslate"><span class="pre">runas</span></code>. This parameter will be ignored on non-Windows platforms.</p> <blockquote> <div>
<div class="versionadded"> <p><span class="versionmodified added">New in version 2016.3.0.</span></p> </div> </div>
</blockquote> </li> <li>
<p><strong>bg</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- </p>
<p>If <code class="docutils literal notranslate"><span class="pre">True</span></code>, run command in background and do not await or deliver its results</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2016.3.6.</span></p> </div> </li> <li>
<p><strong>success_retcodes</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><em>list</em></a>) -- </p>
<dl class="simple"> <dt>This parameter will be allow a list of</dt>
<dd>
<p>non-zero return codes that should be considered a success. If the return code returned from the run matches any in the provided list, the return code will be overridden with zero.</p> </dd> </dl> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </li> <li>
<p><strong>stdin_raw_newlines</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- </p>
<dl class="simple"> <dt>False</dt>
<dd>
<p>If <code class="docutils literal notranslate"><span class="pre">True</span></code>, Salt will not automatically convert the characters <code class="docutils literal notranslate"><span class="pre">\n</span></code> present in the <code class="docutils literal notranslate"><span class="pre">stdin</span></code> value to newlines.</p> </dd> </dl> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </li> </ul> </dd> </dl> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cmd.run_all "ls -l | awk '/foo/{print \$2}'"</pre> <p>The template arg can be set to 'jinja' or another supported template engine to render the command arguments before execution. For example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cmd.run_all template=jinja "ls -l /tmp/{{grains.id}} | awk '/foo/{print \$2}'"</pre> <p>A string of standard input can be specified for the command to be run using the <code class="docutils literal notranslate"><span class="pre">stdin</span></code> parameter. This can be useful in cases where sensitive information must be read from standard input.</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cmd.run_all "grep f" stdin='one\ntwo\nthree\nfour\nfive\n'</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.cmdmod.run_bg"> salt.modules.cmdmod.run_bg(cmd, cwd=None, runas=None, group=None, shell='/bin/sh', python_shell=None, env=None, clean_env=False, template=None, umask=None, timeout=None, output_encoding=None, output_loglevel='debug', log_callback=None, reset_system_locale=True, ignore_retcode=False, saltenv='base', password=None, prepend_path=None, success_retcodes=None, **kwargs)</h3> <dd>
<div class="versionadded"> <p><span class="versionmodified added">New in version 2016.3.0.</span></p> </div> <p>Execute the passed command in the background and return its PID</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>If the init system is systemd and the backgrounded task should run even if the salt-minion process is restarted, prepend <code class="docutils literal notranslate"><span class="pre">systemd-run</span>
<span class="pre">--scope</span></code> to the command. This will reparent the process in its own scope separate from salt-minion, and will not be affected by restarting the minion service.</p> </div> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li><p><strong>cmd</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The command to run. ex: <code class="docutils literal notranslate"><span class="pre">ls</span> <span class="pre">-lart</span> <span class="pre">/home</span></code></p></li> <li><p><strong>cwd</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The directory from which to execute the command. Defaults to the home directory of the user specified by <code class="docutils literal notranslate"><span class="pre">runas</span></code> (or the user under which Salt is running if <code class="docutils literal notranslate"><span class="pre">runas</span></code> is not specified).</p></li> <li><p><strong>group</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- Group to run command as. Not currently supported on Windows.</p></li> <li><p><strong>shell</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- Shell to execute under. Defaults to the system default shell.</p></li> <li>
<p><strong>output_encoding</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- </p>
<p>Control the encoding used to decode the command's output.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This should not need to be used in most cases. By default, Salt will try to use the encoding detected from the system locale, and will fall back to UTF-8 if this fails. This should only need to be used in cases where the output of the command is encoded in something other than the system locale or UTF-8.</p> <p>To see the encoding Salt has detected from the system locale, check the <cite>locale</cite> line in the output of <a class="reference internal" href="salt.modules.test.html#salt.modules.test.versions_report" title="salt.modules.test.versions_report"><code class="xref py py-func docutils literal notranslate"><span class="pre">test.versions_report</span></code></a>.</p> </div> <div class="versionadded"> <p><span class="versionmodified added">New in version 2018.3.0.</span></p> </div> </li> <li>
<p><strong>output_loglevel</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- </p>
<p>Control the loglevel at which the output from the command is logged to the minion log.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>The command being run will still be logged at the <code class="docutils literal notranslate"><span class="pre">debug</span></code> loglevel regardless, unless <code class="docutils literal notranslate"><span class="pre">quiet</span></code> is used for this value.</p> </div> </li> <li><p><strong>ignore_retcode</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- If the exit code of the command is nonzero, this is treated as an error condition, and the output from the command will be logged to the minion log. However, there are some cases where programs use the return code for signaling and a nonzero exit code doesn't necessarily mean failure. Pass this argument as <code class="docutils literal notranslate"><span class="pre">True</span></code> to skip logging the output if the command has a nonzero exit code.</p></li> <li>
<p><strong>runas</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- </p>
<p>Specify an alternate user to run the command. The default behavior is to run as the user under which Salt is running. If running on a Windows minion you must also use the <code class="docutils literal notranslate"><span class="pre">password</span></code> argument, and the target user account must be in the Administrators group.</p> <div class="admonition warning"> <p class="admonition-title">Warning</p> <p>For versions 2018.3.3 and above on macosx while using runas, to pass special characters to the command you need to escape the characters on the shell.</p> <p>Example:</p> <pre class="highlight-bash notranslate" data-language="bash">cmd.run_bg 'echo '\''h=\"baz\"'\''' runas=macuser</pre> </div> </li> <li>
<p><strong>password</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- </p>
<p>Windows only. Required when specifying <code class="docutils literal notranslate"><span class="pre">runas</span></code>. This parameter will be ignored on non-Windows platforms.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2016.3.0.</span></p> </div> </li> <li><p><strong>shell</strong> -- Specify an alternate shell. Defaults to the system's default shell.</p></li> <li><p><strong>python_shell</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- If False, let python handle the positional arguments. Set to True to use shell features, such as pipes or redirection.</p></li> <li>
<p><strong>env</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><em>dict</em></a>) -- </p>
<p>Environment variables to be set prior to execution.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>When passing environment variables on the CLI, they should be passed as the string representation of a dictionary.</p> <pre class="highlight-bash notranslate" data-language="bash">salt myminion cmd.run_bg 'some command' env='{"FOO": "bar"}'</pre> </div> <div class="admonition note"> <p class="admonition-title">Note</p> <p>When using environment variables on Window's, case-sensitivity matters, i.e. Window's uses <cite>Path</cite> as opposed to <cite>PATH</cite> for other systems.</p> </div> </li> <li><p><strong>clean_env</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- Attempt to clean out all other shell environment variables and set only those provided in the 'env' argument to this function.</p></li> <li>
<p><strong>prepend_path</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- </p>
<p>$PATH segment to prepend (trailing ':' not necessary) to $PATH</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2018.3.0.</span></p> </div> </li> <li><p><strong>template</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- If this setting is applied then the named templating engine will be used to render the downloaded file. Currently jinja, mako, and wempy are supported.</p></li> <li><p><strong>umask</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The umask (in octal) to use when running the command.</p></li> <li><p><strong>timeout</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) -- A timeout in seconds for the executed process to return.</p></li> </ul> </dd> </dl> <div class="admonition warning"> <p class="admonition-title">Warning</p> <p>This function does not process commands through a shell unless the <code class="docutils literal notranslate"><span class="pre">python_shell</span></code> argument is set to <code class="docutils literal notranslate"><span class="pre">True</span></code>. This means that any shell-specific functionality such as 'echo' or the use of pipes, redirection or &amp;&amp;, should either be migrated to cmd.shell or have the python_shell=True flag set here.</p> <p>The use of <code class="docutils literal notranslate"><span class="pre">python_shell=True</span></code> means that the shell will accept _any_ input including potentially malicious commands such as 'good_command;rm -rf /'. Be absolutely certain that you have sanitized your input prior to using <code class="docutils literal notranslate"><span class="pre">python_shell=True</span></code>.</p> </div> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li>
<p><strong>success_retcodes</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><em>list</em></a>) -- </p>
<dl class="simple"> <dt>This parameter will be allow a list of</dt>
<dd>
<p>non-zero return codes that should be considered a success. If the return code returned from the run matches any in the provided list, the return code will be overridden with zero.</p> </dd> </dl> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </li> <li>
<p><strong>stdin_raw_newlines</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- </p>
<dl class="simple"> <dt>False</dt>
<dd>
<p>If <code class="docutils literal notranslate"><span class="pre">True</span></code>, Salt will not automatically convert the characters <code class="docutils literal notranslate"><span class="pre">\\n</span></code> present in the <code class="docutils literal notranslate"><span class="pre">stdin</span></code> value to newlines.</p> </dd> </dl> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </li> </ul> </dd> </dl> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cmd.run_bg "fstrim-all"</pre> <p>The template arg can be set to 'jinja' or another supported template engine to render the command arguments before execution. For example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cmd.run_bg template=jinja "ls -l /tmp/{{grains.id}} | awk '/foo/{print \\$2}'"</pre> <p>Specify an alternate shell with the shell parameter:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cmd.run_bg "Get-ChildItem C:\\ " shell='powershell'</pre> <p>If an equal sign (<code class="docutils literal notranslate"><span class="pre">=</span></code>) appears in an argument to a Salt command it is interpreted as a keyword argument in the format <code class="docutils literal notranslate"><span class="pre">key=val</span></code>. That processing can be bypassed in order to pass an equal sign through to the remote shell command by manually specifying the kwarg:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cmd.run_bg cmd='ls -lR / | sed -e s/=/:/g &gt; /tmp/dontwait'</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.cmdmod.run_chroot"> salt.modules.cmdmod.run_chroot(root, cmd, cwd=None, stdin=None, runas=None, group=None, shell='/bin/sh', python_shell=True, binds=None, env=None, clean_env=False, template=None, rstrip=True, umask=None, output_encoding=None, output_loglevel='quiet', log_callback=None, hide_output=False, timeout=None, reset_system_locale=True, ignore_retcode=False, saltenv='base', use_vt=False, bg=False, success_retcodes=None, **kwargs)</h3> <dd>
<div class="versionadded"> <p><span class="versionmodified added">New in version 2014.7.0.</span></p> </div> <p>This function runs <a class="reference internal" href="#salt.modules.cmdmod.run_all" title="salt.modules.cmdmod.run_all"><code class="xref py py-mod docutils literal notranslate"><span class="pre">cmd.run_all</span></code></a> wrapped within a chroot, with dev and proc mounted in the chroot</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li><p><strong>root</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- Path to the root of the jail to use.</p></li> <li><p><strong>stdin</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- A string of standard input can be specified for the command to be run using the <code class="docutils literal notranslate"><span class="pre">stdin</span></code> parameter. This can be useful in cases where sensitive information must be read from standard input.:</p></li> <li><p><strong>runas</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- User to run script as.</p></li> <li><p><strong>group</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- Group to run script as.</p></li> <li><p><strong>shell</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- Shell to execute under. Defaults to the system default shell.</p></li> <li><p><strong>cmd</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The command to run. ex: <code class="docutils literal notranslate"><span class="pre">ls</span> <span class="pre">-lart</span> <span class="pre">/home</span></code></p></li> <li><p><strong>cwd</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The directory from which to execute the command. Defaults to the home directory of the user specified by <code class="docutils literal notranslate"><span class="pre">runas</span></code> (or the user under which Salt is running if <code class="docutils literal notranslate"><span class="pre">runas</span></code> is not specified).</p></li> <li><p><strong>runas</strong> -- Specify an alternate user to run the command. The default behavior is to run as the user under which Salt is running. If running on a Windows minion you must also use the <code class="docutils literal notranslate"><span class="pre">password</span></code> argument, and the target user account must be in the Administrators group.</p></li> <li><p><strong>shell</strong> -- Specify an alternate shell. Defaults to the system's default shell.</p></li> <li><p><strong>python_shell</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- If False, let python handle the positional arguments. Set to True to use shell features, such as pipes or redirection.</p></li> <li>
<p><strong>binds</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><em>list</em></a>) -- </p>
<p>List of directories that will be exported inside the chroot with the bind option.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 3000.</span></p> </div> </li> <li>
<p><strong>env</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><em>dict</em></a>) -- </p>
<p>Environment variables to be set prior to execution.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>When passing environment variables on the CLI, they should be passed as the string representation of a dictionary.</p> <pre class="highlight-bash notranslate" data-language="bash">salt myminion cmd.run_chroot 'some command' env='{"FOO": "bar"}'</pre> </div> <div class="admonition note"> <p class="admonition-title">Note</p> <p>When using environment variables on Window's, case-sensitivity matters, i.e. Window's uses <cite>Path</cite> as opposed to <cite>PATH</cite> for other systems.</p> </div> </li> <li><p><strong>clean_env</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><em>dict</em></a>) -- Attempt to clean out all other shell environment variables and set only those provided in the 'env' argument to this function.</p></li> <li><p><strong>template</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- If this setting is applied then the named templating engine will be used to render the downloaded file. Currently jinja, mako, and wempy are supported.</p></li> <li><p><strong>rstrip</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- Strip all whitespace off the end of output before it is returned.</p></li> <li><p><strong>umask</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The umask (in octal) to use when running the command.</p></li> <li>
<p><strong>output_encoding</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- </p>
<p>Control the encoding used to decode the command's output.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This should not need to be used in most cases. By default, Salt will try to use the encoding detected from the system locale, and will fall back to UTF-8 if this fails. This should only need to be used in cases where the output of the command is encoded in something other than the system locale or UTF-8.</p> <p>To see the encoding Salt has detected from the system locale, check the <cite>locale</cite> line in the output of <a class="reference internal" href="salt.modules.test.html#salt.modules.test.versions_report" title="salt.modules.test.versions_report"><code class="xref py py-func docutils literal notranslate"><span class="pre">test.versions_report</span></code></a>.</p> </div> <div class="versionadded"> <p><span class="versionmodified added">New in version 2018.3.0.</span></p> </div> </li> <li>
<p><strong>output_loglevel</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- </p>
<p>Control the loglevel at which the output from the command is logged to the minion log.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>The command being run will still be logged at the <code class="docutils literal notranslate"><span class="pre">debug</span></code> loglevel regardless, unless <code class="docutils literal notranslate"><span class="pre">quiet</span></code> is used for this value.</p> </div> </li> <li><p><strong>ignore_retcode</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- If the exit code of the command is nonzero, this is treated as an error condition, and the output from the command will be logged to the minion log. However, there are some cases where programs use the return code for signaling and a nonzero exit code doesn't necessarily mean failure. Pass this argument as <code class="docutils literal notranslate"><span class="pre">True</span></code> to skip logging the output if the command has a nonzero exit code.</p></li> <li>
<p><strong>hide_output</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- </p>
<p>If <code class="docutils literal notranslate"><span class="pre">True</span></code>, suppress stdout and stderr in the return data.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This is separate from <code class="docutils literal notranslate"><span class="pre">output_loglevel</span></code>, which only handles how Salt logs to the minion log.</p> </div> <div class="versionadded"> <p><span class="versionmodified added">New in version 2018.3.0.</span></p> </div> </li> <li><p><strong>timeout</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) -- A timeout in seconds for the executed process to return.</p></li> <li><p><strong>use_vt</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- Use VT utils (saltstack) to stream the command output more interactively to the console and the logs. This is experimental.</p></li> </ul> </dd> <dt class="field-even">Parar str stdin</dt> <dd class="field-even">
<p>A string of standard input can be specified for the command to be run using the <code class="docutils literal notranslate"><span class="pre">stdin</span></code> parameter. This can be useful in cases where sensitive information must be read from standard input.</p> </dd> </dl> <dl> <dt>success_retcodes: This parameter will be allow a list of</dt>
<dd>
<blockquote> <div>
<p>non-zero return codes that should be considered a success. If the return code returned from the run matches any in the provided list, the return code will be overridden with zero.</p> </div>
</blockquote> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </dd> </dl> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cmd.run_chroot /var/lib/lxc/container_name/rootfs 'sh /tmp/bootstrap.sh'</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.cmdmod.run_stderr"> salt.modules.cmdmod.run_stderr(cmd, cwd=None, stdin=None, runas=None, group=None, shell='/bin/sh', python_shell=None, env=None, clean_env=False, template=None, rstrip=True, umask=None, output_encoding=None, output_loglevel='debug', log_callback=None, hide_output=False, timeout=None, reset_system_locale=True, ignore_retcode=False, saltenv='base', use_vt=False, password=None, prepend_path=None, success_retcodes=None, **kwargs)</h3> <dd>
<p>Execute a command and only return the standard error</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li><p><strong>cmd</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The command to run. ex: <code class="docutils literal notranslate"><span class="pre">ls</span> <span class="pre">-lart</span> <span class="pre">/home</span></code></p></li> <li><p><strong>cwd</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The directory from which to execute the command. Defaults to the home directory of the user specified by <code class="docutils literal notranslate"><span class="pre">runas</span></code> (or the user under which Salt is running if <code class="docutils literal notranslate"><span class="pre">runas</span></code> is not specified).</p></li> <li><p><strong>stdin</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- A string of standard input can be specified for the command to be run using the <code class="docutils literal notranslate"><span class="pre">stdin</span></code> parameter. This can be useful in cases where sensitive information must be read from standard input.</p></li> <li>
<p><strong>runas</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- </p>
<p>Specify an alternate user to run the command. The default behavior is to run as the user under which Salt is running. If running on a Windows minion you must also use the <code class="docutils literal notranslate"><span class="pre">password</span></code> argument, and the target user account must be in the Administrators group.</p> <div class="admonition warning"> <p class="admonition-title">Warning</p> <p>For versions 2018.3.3 and above on macosx while using runas, to pass special characters to the command you need to escape the characters on the shell.</p> <p>Example:</p> <pre class="highlight-bash notranslate" data-language="bash">cmd.run_stderr 'echo '\''h=\"baz\"'\''' runas=macuser</pre> </div> </li> <li>
<p><strong>password</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- </p>
<p>Windows only. Required when specifying <code class="docutils literal notranslate"><span class="pre">runas</span></code>. This parameter will be ignored on non-Windows platforms.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2016.3.0.</span></p> </div> </li> <li><p><strong>group</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- Group to run command as. Not currently supported on Windows.</p></li> <li><p><strong>shell</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- Specify an alternate shell. Defaults to the system's default shell.</p></li> <li><p><strong>python_shell</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- If False, let python handle the positional arguments. Set to True to use shell features, such as pipes or redirection.</p></li> <li>
<p><strong>env</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><em>dict</em></a>) -- </p>
<p>Environment variables to be set prior to execution.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>When passing environment variables on the CLI, they should be passed as the string representation of a dictionary.</p> <pre class="highlight-bash notranslate" data-language="bash">salt myminion cmd.run_stderr 'some command' env='{"FOO": "bar"}'</pre> </div> <div class="admonition note"> <p class="admonition-title">Note</p> <p>When using environment variables on Window's, case-sensitivity matters, i.e. Window's uses <cite>Path</cite> as opposed to <cite>PATH</cite> for other systems.</p> </div> </li> <li><p><strong>clean_env</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- Attempt to clean out all other shell environment variables and set only those provided in the 'env' argument to this function.</p></li> <li>
<p><strong>prepend_path</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- </p>
<p>$PATH segment to prepend (trailing ':' not necessary) to $PATH</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2018.3.0.</span></p> </div> </li> <li><p><strong>template</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- If this setting is applied then the named templating engine will be used to render the downloaded file. Currently jinja, mako, and wempy are supported.</p></li> <li><p><strong>rstrip</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- Strip all whitespace off the end of output before it is returned.</p></li> <li><p><strong>umask</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The umask (in octal) to use when running the command.</p></li> <li>
<p><strong>output_encoding</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- </p>
<p>Control the encoding used to decode the command's output.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This should not need to be used in most cases. By default, Salt will try to use the encoding detected from the system locale, and will fall back to UTF-8 if this fails. This should only need to be used in cases where the output of the command is encoded in something other than the system locale or UTF-8.</p> <p>To see the encoding Salt has detected from the system locale, check the <cite>locale</cite> line in the output of <a class="reference internal" href="salt.modules.test.html#salt.modules.test.versions_report" title="salt.modules.test.versions_report"><code class="xref py py-func docutils literal notranslate"><span class="pre">test.versions_report</span></code></a>.</p> </div> <div class="versionadded"> <p><span class="versionmodified added">New in version 2018.3.0.</span></p> </div> </li> <li>
<p><strong>output_loglevel</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- </p>
<p>Control the loglevel at which the output from the command is logged to the minion log.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>The command being run will still be logged at the <code class="docutils literal notranslate"><span class="pre">debug</span></code> loglevel regardless, unless <code class="docutils literal notranslate"><span class="pre">quiet</span></code> is used for this value.</p> </div> </li> <li><p><strong>ignore_retcode</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- If the exit code of the command is nonzero, this is treated as an error condition, and the output from the command will be logged to the minion log. However, there are some cases where programs use the return code for signaling and a nonzero exit code doesn't necessarily mean failure. Pass this argument as <code class="docutils literal notranslate"><span class="pre">True</span></code> to skip logging the output if the command has a nonzero exit code.</p></li> <li>
<p><strong>hide_output</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- </p>
<p>If <code class="docutils literal notranslate"><span class="pre">True</span></code>, suppress stdout and stderr in the return data.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This is separate from <code class="docutils literal notranslate"><span class="pre">output_loglevel</span></code>, which only handles how Salt logs to the minion log.</p> </div> <div class="versionadded"> <p><span class="versionmodified added">New in version 2018.3.0.</span></p> </div> </li> <li><p><strong>timeout</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) -- A timeout in seconds for the executed process to return.</p></li> <li><p><strong>use_vt</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- Use VT utils (saltstack) to stream the command output more interactively to the console and the logs. This is experimental.</p></li> <li>
<p><strong>success_retcodes</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><em>list</em></a>) -- </p>
<dl class="simple"> <dt>This parameter will be allow a list of</dt>
<dd>
<p>non-zero return codes that should be considered a success. If the return code returned from the run matches any in the provided list, the return code will be overridden with zero.</p> </dd> </dl> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </li> <li>
<p><strong>stdin_raw_newlines</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- </p>
<dl class="simple"> <dt>False</dt>
<dd>
<p>If <code class="docutils literal notranslate"><span class="pre">True</span></code>, Salt will not automatically convert the characters <code class="docutils literal notranslate"><span class="pre">\n</span></code> present in the <code class="docutils literal notranslate"><span class="pre">stdin</span></code> value to newlines.</p> </dd> </dl> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </li> </ul> </dd> </dl> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cmd.run_stderr "ls -l | awk '/foo/{print \$2}'"</pre> <p>The template arg can be set to 'jinja' or another supported template engine to render the command arguments before execution. For example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cmd.run_stderr template=jinja "ls -l /tmp/{{grains.id}} | awk '/foo/{print \$2}'"</pre> <p>A string of standard input can be specified for the command to be run using the <code class="docutils literal notranslate"><span class="pre">stdin</span></code> parameter. This can be useful in cases where sensitive information must be read from standard input.</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cmd.run_stderr "grep f" stdin='one\ntwo\nthree\nfour\nfive\n'</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.cmdmod.run_stdout"> salt.modules.cmdmod.run_stdout(cmd, cwd=None, stdin=None, runas=None, group=None, shell='/bin/sh', python_shell=None, env=None, clean_env=False, template=None, rstrip=True, umask=None, output_encoding=None, output_loglevel='debug', log_callback=None, hide_output=False, timeout=None, reset_system_locale=True, ignore_retcode=False, saltenv='base', use_vt=False, password=None, prepend_path=None, success_retcodes=None, **kwargs)</h3> <dd>
<p>Execute a command, and only return the standard out</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li><p><strong>cmd</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The command to run. ex: <code class="docutils literal notranslate"><span class="pre">ls</span> <span class="pre">-lart</span> <span class="pre">/home</span></code></p></li> <li><p><strong>cwd</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The directory from which to execute the command. Defaults to the home directory of the user specified by <code class="docutils literal notranslate"><span class="pre">runas</span></code> (or the user under which Salt is running if <code class="docutils literal notranslate"><span class="pre">runas</span></code> is not specified).</p></li> <li><p><strong>stdin</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- A string of standard input can be specified for the command to be run using the <code class="docutils literal notranslate"><span class="pre">stdin</span></code> parameter. This can be useful in cases where sensitive information must be read from standard input.</p></li> <li>
<p><strong>runas</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- </p>
<p>Specify an alternate user to run the command. The default behavior is to run as the user under which Salt is running. If running on a Windows minion you must also use the <code class="docutils literal notranslate"><span class="pre">password</span></code> argument, and the target user account must be in the Administrators group.</p> <div class="admonition warning"> <p class="admonition-title">Warning</p> <p>For versions 2018.3.3 and above on macosx while using runas, to pass special characters to the command you need to escape the characters on the shell.</p> <p>Example:</p> <pre class="highlight-bash notranslate" data-language="bash">cmd.run_stdout 'echo '\''h=\"baz\"'\''' runas=macuser</pre> </div> </li> <li>
<p><strong>password</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- </p>
<p>Windows only. Required when specifying <code class="docutils literal notranslate"><span class="pre">runas</span></code>. This parameter will be ignored on non-Windows platforms.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2016.3.0.</span></p> </div> </li> <li><p><strong>group</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- Group to run command as. Not currently supported on Windows.</p></li> <li><p><strong>shell</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- Specify an alternate shell. Defaults to the system's default shell.</p></li> <li><p><strong>python_shell</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- If False, let python handle the positional arguments. Set to True to use shell features, such as pipes or redirection.</p></li> <li>
<p><strong>env</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><em>dict</em></a>) -- </p>
<p>Environment variables to be set prior to execution.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>When passing environment variables on the CLI, they should be passed as the string representation of a dictionary.</p> <pre class="highlight-bash notranslate" data-language="bash">salt myminion cmd.run_stdout 'some command' env='{"FOO": "bar"}'</pre> </div> <div class="admonition note"> <p class="admonition-title">Note</p> <p>When using environment variables on Window's, case-sensitivity matters, i.e. Window's uses <cite>Path</cite> as opposed to <cite>PATH</cite> for other systems.</p> </div> </li> <li><p><strong>clean_env</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- Attempt to clean out all other shell environment variables and set only those provided in the 'env' argument to this function.</p></li> <li>
<p><strong>prepend_path</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- </p>
<p>$PATH segment to prepend (trailing ':' not necessary) to $PATH</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2018.3.0.</span></p> </div> </li> <li><p><strong>template</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- If this setting is applied then the named templating engine will be used to render the downloaded file. Currently jinja, mako, and wempy are supported.</p></li> <li><p><strong>rstrip</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- Strip all whitespace off the end of output before it is returned.</p></li> <li><p><strong>umask</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The umask (in octal) to use when running the command.</p></li> <li>
<p><strong>output_encoding</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- </p>
<p>Control the encoding used to decode the command's output.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This should not need to be used in most cases. By default, Salt will try to use the encoding detected from the system locale, and will fall back to UTF-8 if this fails. This should only need to be used in cases where the output of the command is encoded in something other than the system locale or UTF-8.</p> <p>To see the encoding Salt has detected from the system locale, check the <cite>locale</cite> line in the output of <a class="reference internal" href="salt.modules.test.html#salt.modules.test.versions_report" title="salt.modules.test.versions_report"><code class="xref py py-func docutils literal notranslate"><span class="pre">test.versions_report</span></code></a>.</p> </div> <div class="versionadded"> <p><span class="versionmodified added">New in version 2018.3.0.</span></p> </div> </li> <li>
<p><strong>output_loglevel</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- </p>
<p>Control the loglevel at which the output from the command is logged to the minion log.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>The command being run will still be logged at the <code class="docutils literal notranslate"><span class="pre">debug</span></code> loglevel regardless, unless <code class="docutils literal notranslate"><span class="pre">quiet</span></code> is used for this value.</p> </div> </li> <li><p><strong>ignore_retcode</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- If the exit code of the command is nonzero, this is treated as an error condition, and the output from the command will be logged to the minion log. However, there are some cases where programs use the return code for signaling and a nonzero exit code doesn't necessarily mean failure. Pass this argument as <code class="docutils literal notranslate"><span class="pre">True</span></code> to skip logging the output if the command has a nonzero exit code.</p></li> <li>
<p><strong>hide_output</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- </p>
<p>If <code class="docutils literal notranslate"><span class="pre">True</span></code>, suppress stdout and stderr in the return data.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This is separate from <code class="docutils literal notranslate"><span class="pre">output_loglevel</span></code>, which only handles how Salt logs to the minion log.</p> </div> <div class="versionadded"> <p><span class="versionmodified added">New in version 2018.3.0.</span></p> </div> </li> <li><p><strong>timeout</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) -- A timeout in seconds for the executed process to return.</p></li> <li><p><strong>use_vt</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- Use VT utils (saltstack) to stream the command output more interactively to the console and the logs. This is experimental.</p></li> <li>
<p><strong>success_retcodes</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><em>list</em></a>) -- </p>
<dl class="simple"> <dt>This parameter will be allow a list of</dt>
<dd>
<p>non-zero return codes that should be considered a success. If the return code returned from the run matches any in the provided list, the return code will be overridden with zero.</p> </dd> </dl> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </li> <li>
<p><strong>stdin_raw_newlines</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- </p>
<dl class="simple"> <dt>False</dt>
<dd>
<p>If <code class="docutils literal notranslate"><span class="pre">True</span></code>, Salt will not automatically convert the characters <code class="docutils literal notranslate"><span class="pre">\n</span></code> present in the <code class="docutils literal notranslate"><span class="pre">stdin</span></code> value to newlines.</p> </dd> </dl> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </li> </ul> </dd> </dl> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cmd.run_stdout "ls -l | awk '/foo/{print \$2}'"</pre> <p>The template arg can be set to 'jinja' or another supported template engine to render the command arguments before execution. For example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cmd.run_stdout template=jinja "ls -l /tmp/{{grains.id}} | awk '/foo/{print \$2}'"</pre> <p>A string of standard input can be specified for the command to be run using the <code class="docutils literal notranslate"><span class="pre">stdin</span></code> parameter. This can be useful in cases where sensitive information must be read from standard input.</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cmd.run_stdout "grep f" stdin='one\ntwo\nthree\nfour\nfive\n'</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.cmdmod.script"> salt.modules.cmdmod.script(source, args=None, cwd=None, stdin=None, runas=None, group=None, shell='/bin/sh', python_shell=None, env=None, template=None, umask=None, output_encoding=None, output_loglevel='debug', log_callback=None, hide_output=False, timeout=None, reset_system_locale=True, saltenv='base', use_vt=False, bg=False, password=None, success_retcodes=None, **kwargs)</h3> <dd>
<p>Download a script from a remote location and execute the script locally. The script can be located on the salt master file server or on an HTTP/FTP server.</p> <p>The script will be executed directly, so it can be written in any available programming language.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li><p><strong>source</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The location of the script to download. If the file is located on the master in the directory named spam, and is called eggs, the source string is salt://spam/eggs</p></li> <li>
<p><strong>args</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- </p>
<p>String of command line args to pass to the script. Only used if no args are specified as part of the <cite>name</cite> argument. To pass a string containing spaces in YAML, you will need to doubly-quote it:</p> <pre class="highlight-bash notranslate" data-language="bash">salt myminion cmd.script salt://foo.sh "arg1 'arg two' arg3"</pre> </li> <li><p><strong>cwd</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The directory from which to execute the command. Defaults to the home directory of the user specified by <code class="docutils literal notranslate"><span class="pre">runas</span></code> (or the user under which Salt is running if <code class="docutils literal notranslate"><span class="pre">runas</span></code> is not specified).</p></li> <li><p><strong>stdin</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- A string of standard input can be specified for the command to be run using the <code class="docutils literal notranslate"><span class="pre">stdin</span></code> parameter. This can be useful in cases where sensitive information must be read from standard input.</p></li> <li>
<p><strong>runas</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- </p>
<p>Specify an alternate user to run the command. The default behavior is to run as the user under which Salt is running. If running on a Windows minion you must also use the <code class="docutils literal notranslate"><span class="pre">password</span></code> argument, and the target user account must be in the Administrators group.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>For Window's users, specifically Server users, it may be necessary to specify your runas user using the User Logon Name instead of the legacy logon name. Traditionally, logons would be in the following format.</p> <blockquote> <div>
<p><code class="docutils literal notranslate"><span class="pre">Domain/user</span></code></p> </div>
</blockquote> <p>In the event this causes issues when executing scripts, use the UPN format which looks like the following.</p> <blockquote> <div>
<p><code class="docutils literal notranslate"><span class="pre">user@domain.local</span></code></p> </div>
</blockquote> <p>More information &lt;<a class="reference external" href="https://github.com/saltstack/salt/issues/55080">https://github.com/saltstack/salt/issues/55080</a>&gt;</p> </div> </li> <li>
<p><strong>password</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- </p>
<p>Windows only. Required when specifying <code class="docutils literal notranslate"><span class="pre">runas</span></code>. This parameter will be ignored on non-Windows platforms.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2016.3.0.</span></p> </div> </li> <li><p><strong>group</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- Group to run script as. Not currently supported on Windows.</p></li> <li><p><strong>shell</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- Specify an alternate shell. Defaults to the system's default shell.</p></li> <li><p><strong>python_shell</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- If False, let python handle the positional arguments. Set to True to use shell features, such as pipes or redirection.</p></li> <li><p><strong>bg</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- If True, run script in background and do not await or deliver its results</p></li> <li>
<p><strong>env</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><em>dict</em></a>) -- </p>
<p>Environment variables to be set prior to execution.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>When passing environment variables on the CLI, they should be passed as the string representation of a dictionary.</p> <pre class="highlight-bash notranslate" data-language="bash">salt myminion cmd.script 'some command' env='{"FOO": "bar"}'</pre> </div> <div class="admonition note"> <p class="admonition-title">Note</p> <p>When using environment variables on Window's, case-sensitivity matters, i.e. Window's uses <cite>Path</cite> as opposed to <cite>PATH</cite> for other systems.</p> </div> </li> <li><p><strong>template</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- If this setting is applied then the named templating engine will be used to render the downloaded file. Currently jinja, mako, and wempy are supported.</p></li> <li><p><strong>umask</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The umask (in octal) to use when running the command.</p></li> <li>
<p><strong>output_encoding</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- </p>
<p>Control the encoding used to decode the command's output.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This should not need to be used in most cases. By default, Salt will try to use the encoding detected from the system locale, and will fall back to UTF-8 if this fails. This should only need to be used in cases where the output of the command is encoded in something other than the system locale or UTF-8.</p> <p>To see the encoding Salt has detected from the system locale, check the <cite>locale</cite> line in the output of <a class="reference internal" href="salt.modules.test.html#salt.modules.test.versions_report" title="salt.modules.test.versions_report"><code class="xref py py-func docutils literal notranslate"><span class="pre">test.versions_report</span></code></a>.</p> </div> <div class="versionadded"> <p><span class="versionmodified added">New in version 2018.3.0.</span></p> </div> </li> <li>
<p><strong>output_loglevel</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- </p>
<p>Control the loglevel at which the output from the command is logged to the minion log.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>The command being run will still be logged at the <code class="docutils literal notranslate"><span class="pre">debug</span></code> loglevel regardless, unless <code class="docutils literal notranslate"><span class="pre">quiet</span></code> is used for this value.</p> </div> </li> <li><p><strong>ignore_retcode</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- If the exit code of the command is nonzero, this is treated as an error condition, and the output from the command will be logged to the minion log. However, there are some cases where programs use the return code for signaling and a nonzero exit code doesn't necessarily mean failure. Pass this argument as <code class="docutils literal notranslate"><span class="pre">True</span></code> to skip logging the output if the command has a nonzero exit code.</p></li> <li>
<p><strong>hide_output</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- </p>
<p>If <code class="docutils literal notranslate"><span class="pre">True</span></code>, suppress stdout and stderr in the return data.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This is separate from <code class="docutils literal notranslate"><span class="pre">output_loglevel</span></code>, which only handles how Salt logs to the minion log.</p> </div> <div class="versionadded"> <p><span class="versionmodified added">New in version 2018.3.0.</span></p> </div> </li> <li><p><strong>timeout</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) -- If the command has not terminated after timeout seconds, send the subprocess sigterm, and if sigterm is ignored, follow up with sigkill</p></li> <li><p><strong>use_vt</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- Use VT utils (saltstack) to stream the command output more interactively to the console and the logs. This is experimental.</p></li> <li>
<p><strong>success_retcodes</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><em>list</em></a>) -- </p>
<dl class="simple"> <dt>This parameter will be allow a list of</dt>
<dd>
<p>non-zero return codes that should be considered a success. If the return code returned from the run matches any in the provided list, the return code will be overridden with zero.</p> </dd> </dl> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </li> <li>
<p><strong>stdin_raw_newlines</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- </p>
<dl class="simple"> <dt>False</dt>
<dd>
<p>If <code class="docutils literal notranslate"><span class="pre">True</span></code>, Salt will not automatically convert the characters <code class="docutils literal notranslate"><span class="pre">\n</span></code> present in the <code class="docutils literal notranslate"><span class="pre">stdin</span></code> value to newlines.</p> </dd> </dl> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </li> </ul> </dd> </dl> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cmd.script salt://scripts/runme.sh
salt '*' cmd.script salt://scripts/runme.sh 'arg1 arg2 "arg 3"'
salt '*' cmd.script salt://scripts/windows_task.ps1 args=' -Input c:\tmp\infile.txt' shell='powershell'</pre> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cmd.script salt://scripts/runme.sh stdin='one\ntwo\nthree\nfour\nfive\n'</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.cmdmod.script_retcode"> salt.modules.cmdmod.script_retcode(source, args=None, cwd=None, stdin=None, runas=None, group=None, shell='/bin/sh', python_shell=None, env=None, template='jinja', umask=None, timeout=None, reset_system_locale=True, saltenv='base', output_encoding=None, output_loglevel='debug', log_callback=None, use_vt=False, password=None, success_retcodes=None, **kwargs)</h3> <dd>
<p>Download a script from a remote location and execute the script locally. The script can be located on the salt master file server or on an HTTP/FTP server.</p> <p>The script will be executed directly, so it can be written in any available programming language.</p> <p>The script can also be formatted as a template, the default is jinja.</p> <p>Only evaluate the script return code and do not block for terminal output</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li><p><strong>source</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The location of the script to download. If the file is located on the master in the directory named spam, and is called eggs, the source string is salt://spam/eggs</p></li> <li><p><strong>args</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- String of command line args to pass to the script. Only used if no args are specified as part of the <cite>name</cite> argument. To pass a string containing spaces in YAML, you will need to doubly-quote it: "arg1 'arg two' arg3"</p></li> <li><p><strong>cwd</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The directory from which to execute the command. Defaults to the home directory of the user specified by <code class="docutils literal notranslate"><span class="pre">runas</span></code> (or the user under which Salt is running if <code class="docutils literal notranslate"><span class="pre">runas</span></code> is not specified).</p></li> <li><p><strong>stdin</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- A string of standard input can be specified for the command to be run using the <code class="docutils literal notranslate"><span class="pre">stdin</span></code> parameter. This can be useful in cases where sensitive information must be read from standard input.</p></li> <li><p><strong>runas</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- Specify an alternate user to run the command. The default behavior is to run as the user under which Salt is running. If running on a Windows minion you must also use the <code class="docutils literal notranslate"><span class="pre">password</span></code> argument, and the target user account must be in the Administrators group.</p></li> <li>
<p><strong>password</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- </p>
<p>Windows only. Required when specifying <code class="docutils literal notranslate"><span class="pre">runas</span></code>. This parameter will be ignored on non-Windows platforms.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2016.3.0.</span></p> </div> </li> <li><p><strong>group</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- Group to run script as. Not currently supported on Windows.</p></li> <li><p><strong>shell</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- Specify an alternate shell. Defaults to the system's default shell.</p></li> <li><p><strong>python_shell</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- If False, let python handle the positional arguments. Set to True to use shell features, such as pipes or redirection.</p></li> <li>
<p><strong>env</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><em>dict</em></a>) -- </p>
<p>Environment variables to be set prior to execution.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>When passing environment variables on the CLI, they should be passed as the string representation of a dictionary.</p> <pre class="highlight-bash notranslate" data-language="bash">salt myminion cmd.script_retcode 'some command' env='{"FOO": "bar"}'</pre> </div> <div class="admonition note"> <p class="admonition-title">Note</p> <p>When using environment variables on Window's, case-sensitivity matters, i.e. Window's uses <cite>Path</cite> as opposed to <cite>PATH</cite> for other systems.</p> </div> </li> <li><p><strong>template</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- If this setting is applied then the named templating engine will be used to render the downloaded file. Currently jinja, mako, and wempy are supported.</p></li> <li><p><strong>umask</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The umask (in octal) to use when running the command.</p></li> <li>
<p><strong>output_encoding</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- </p>
<p>Control the encoding used to decode the command's output.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This should not need to be used in most cases. By default, Salt will try to use the encoding detected from the system locale, and will fall back to UTF-8 if this fails. This should only need to be used in cases where the output of the command is encoded in something other than the system locale or UTF-8.</p> <p>To see the encoding Salt has detected from the system locale, check the <cite>locale</cite> line in the output of <a class="reference internal" href="salt.modules.test.html#salt.modules.test.versions_report" title="salt.modules.test.versions_report"><code class="xref py py-func docutils literal notranslate"><span class="pre">test.versions_report</span></code></a>.</p> </div> <div class="versionadded"> <p><span class="versionmodified added">New in version 2018.3.0.</span></p> </div> </li> <li>
<p><strong>output_loglevel</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- </p>
<p>Control the loglevel at which the output from the command is logged to the minion log.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>The command being run will still be logged at the <code class="docutils literal notranslate"><span class="pre">debug</span></code> loglevel regardless, unless <code class="docutils literal notranslate"><span class="pre">quiet</span></code> is used for this value.</p> </div> </li> <li><p><strong>ignore_retcode</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- If the exit code of the command is nonzero, this is treated as an error condition, and the output from the command will be logged to the minion log. However, there are some cases where programs use the return code for signaling and a nonzero exit code doesn't necessarily mean failure. Pass this argument as <code class="docutils literal notranslate"><span class="pre">True</span></code> to skip logging the output if the command has a nonzero exit code.</p></li> <li><p><strong>timeout</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) -- If the command has not terminated after timeout seconds, send the subprocess sigterm, and if sigterm is ignored, follow up with sigkill</p></li> <li><p><strong>use_vt</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- Use VT utils (saltstack) to stream the command output more interactively to the console and the logs. This is experimental.</p></li> <li>
<p><strong>success_retcodes</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><em>list</em></a>) -- </p>
<dl class="simple"> <dt>This parameter will be allow a list of</dt>
<dd>
<p>non-zero return codes that should be considered a success. If the return code returned from the run matches any in the provided list, the return code will be overridden with zero.</p> </dd> </dl> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </li> <li>
<p><strong>stdin_raw_newlines</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- </p>
<dl class="simple"> <dt>False</dt>
<dd>
<p>If <code class="docutils literal notranslate"><span class="pre">True</span></code>, Salt will not automatically convert the characters <code class="docutils literal notranslate"><span class="pre">\n</span></code> present in the <code class="docutils literal notranslate"><span class="pre">stdin</span></code> value to newlines.</p> </dd> </dl> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </li> </ul> </dd> </dl> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cmd.script_retcode salt://scripts/runme.sh
salt '*' cmd.script_retcode salt://scripts/runme.sh 'arg1 arg2 "arg 3"'
salt '*' cmd.script_retcode salt://scripts/windows_task.ps1 args=' -Input c:\tmp\infile.txt' shell='powershell'</pre> <p>A string of standard input can be specified for the command to be run using the <code class="docutils literal notranslate"><span class="pre">stdin</span></code> parameter. This can be useful in cases where sensitive information must be read from standard input.</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cmd.script_retcode salt://scripts/runme.sh stdin='one\ntwo\nthree\nfour\nfive\n'</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.cmdmod.shell"> salt.modules.cmdmod.shell(cmd, cwd=None, stdin=None, runas=None, group=None, shell='/bin/sh', env=None, clean_env=False, template=None, rstrip=True, umask=None, output_encoding=None, output_loglevel='debug', log_callback=None, hide_output=False, timeout=None, reset_system_locale=True, ignore_retcode=False, saltenv='base', use_vt=False, bg=False, password=None, prepend_path=None, success_retcodes=None, **kwargs)</h3> <dd>
<p>Execute the passed command and return the output as a string.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2015.5.0.</span></p> </div> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li><p><strong>cmd</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The command to run. ex: <code class="docutils literal notranslate"><span class="pre">ls</span> <span class="pre">-lart</span> <span class="pre">/home</span></code></p></li> <li><p><strong>cwd</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The directory from which to execute the command. Defaults to the home directory of the user specified by <code class="docutils literal notranslate"><span class="pre">runas</span></code> (or the user under which Salt is running if <code class="docutils literal notranslate"><span class="pre">runas</span></code> is not specified).</p></li> <li><p><strong>stdin</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- A string of standard input can be specified for the command to be run using the <code class="docutils literal notranslate"><span class="pre">stdin</span></code> parameter. This can be useful in cases where sensitive information must be read from standard input.</p></li> <li>
<p><strong>runas</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- </p>
<p>Specify an alternate user to run the command. The default behavior is to run as the user under which Salt is running. If running on a Windows minion you must also use the <code class="docutils literal notranslate"><span class="pre">password</span></code> argument, and the target user account must be in the Administrators group.</p> <div class="admonition warning"> <p class="admonition-title">Warning</p> <p>For versions 2018.3.3 and above on macosx while using runas, to pass special characters to the command you need to escape the characters on the shell.</p> <p>Example:</p> <pre class="highlight-bash notranslate" data-language="bash">cmd.shell 'echo '\''h=\"baz\"'\''' runas=macuser</pre> </div> </li> <li><p><strong>group</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- Group to run command as. Not currently supported on Windows.</p></li> <li>
<p><strong>password</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- </p>
<p>Windows only. Required when specifying <code class="docutils literal notranslate"><span class="pre">runas</span></code>. This parameter will be ignored on non-Windows platforms.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2016.3.0.</span></p> </div> </li> <li><p><strong>shell</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) -- Shell to execute under. Defaults to the system default shell.</p></li> <li><p><strong>bg</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- If True, run command in background and do not await or deliver its results</p></li> <li>
<p><strong>env</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><em>dict</em></a>) -- </p>
<p>Environment variables to be set prior to execution.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>When passing environment variables on the CLI, they should be passed as the string representation of a dictionary.</p> <pre class="highlight-bash notranslate" data-language="bash">salt myminion cmd.shell 'some command' env='{"FOO": "bar"}'</pre> </div> <div class="admonition note"> <p class="admonition-title">Note</p> <p>When using environment variables on Window's, case-sensitivity matters, i.e. Window's uses <cite>Path</cite> as opposed to <cite>PATH</cite> for other systems.</p> </div> </li> <li><p><strong>clean_env</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- Attempt to clean out all other shell environment variables and set only those provided in the 'env' argument to this function.</p></li> <li>
<p><strong>prepend_path</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- </p>
<p>$PATH segment to prepend (trailing ':' not necessary) to $PATH</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2018.3.0.</span></p> </div> </li> <li><p><strong>template</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- If this setting is applied then the named templating engine will be used to render the downloaded file. Currently jinja, mako, and wempy are supported.</p></li> <li><p><strong>rstrip</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- Strip all whitespace off the end of output before it is returned.</p></li> <li><p><strong>umask</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The umask (in octal) to use when running the command.</p></li> <li>
<p><strong>output_encoding</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- </p>
<p>Control the encoding used to decode the command's output.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This should not need to be used in most cases. By default, Salt will try to use the encoding detected from the system locale, and will fall back to UTF-8 if this fails. This should only need to be used in cases where the output of the command is encoded in something other than the system locale or UTF-8.</p> <p>To see the encoding Salt has detected from the system locale, check the <cite>locale</cite> line in the output of <a class="reference internal" href="salt.modules.test.html#salt.modules.test.versions_report" title="salt.modules.test.versions_report"><code class="xref py py-func docutils literal notranslate"><span class="pre">test.versions_report</span></code></a>.</p> </div> <div class="versionadded"> <p><span class="versionmodified added">New in version 2018.3.0.</span></p> </div> </li> <li>
<p><strong>output_loglevel</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- </p>
<p>Control the loglevel at which the output from the command is logged to the minion log.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>The command being run will still be logged at the <code class="docutils literal notranslate"><span class="pre">debug</span></code> loglevel regardless, unless <code class="docutils literal notranslate"><span class="pre">quiet</span></code> is used for this value.</p> </div> </li> <li><p><strong>ignore_retcode</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- If the exit code of the command is nonzero, this is treated as an error condition, and the output from the command will be logged to the minion log. However, there are some cases where programs use the return code for signaling and a nonzero exit code doesn't necessarily mean failure. Pass this argument as <code class="docutils literal notranslate"><span class="pre">True</span></code> to skip logging the output if the command has a nonzero exit code.</p></li> <li>
<p><strong>hide_output</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- </p>
<p>If <code class="docutils literal notranslate"><span class="pre">True</span></code>, suppress stdout and stderr in the return data.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This is separate from <code class="docutils literal notranslate"><span class="pre">output_loglevel</span></code>, which only handles how Salt logs to the minion log.</p> </div> <div class="versionadded"> <p><span class="versionmodified added">New in version 2018.3.0.</span></p> </div> </li> <li><p><strong>timeout</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) -- A timeout in seconds for the executed process to return.</p></li> <li><p><strong>use_vt</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- Use VT utils (saltstack) to stream the command output more interactively to the console and the logs. This is experimental.</p></li> </ul> </dd> </dl> <div class="admonition warning"> <p class="admonition-title">Warning</p> <p>This passes the cmd argument directly to the shell without any further processing! Be absolutely sure that you have properly sanitized the command passed to this function and do not use untrusted inputs.</p> </div> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li>
<p><strong>success_retcodes</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><em>list</em></a>) -- </p>
<dl class="simple"> <dt>This parameter will be allow a list of</dt>
<dd>
<p>non-zero return codes that should be considered a success. If the return code returned from the run matches any in the provided list, the return code will be overridden with zero.</p> </dd> </dl> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </li> <li>
<p><strong>stdin_raw_newlines</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- </p>
<dl class="simple"> <dt>False</dt>
<dd>
<p>If <code class="docutils literal notranslate"><span class="pre">True</span></code>, Salt will not automatically convert the characters <code class="docutils literal notranslate"><span class="pre">\n</span></code> present in the <code class="docutils literal notranslate"><span class="pre">stdin</span></code> value to newlines.</p> </dd> </dl> <div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> </li> </ul> </dd> </dl> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cmd.shell "ls -l | awk '/foo/{print \$2}'"</pre> <p>The template arg can be set to 'jinja' or another supported template engine to render the command arguments before execution. For example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cmd.shell template=jinja "ls -l /tmp/{{grains.id}} | awk '/foo/{print \$2}'"</pre> <p>Specify an alternate shell with the shell parameter:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cmd.shell "Get-ChildItem C:\ " shell='powershell'</pre> <p>A string of standard input can be specified for the command to be run using the <code class="docutils literal notranslate"><span class="pre">stdin</span></code> parameter. This can be useful in cases where sensitive information must be read from standard input.</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cmd.shell "grep f" stdin='one\ntwo\nthree\nfour\nfive\n'</pre> <p>If an equal sign (<code class="docutils literal notranslate"><span class="pre">=</span></code>) appears in an argument to a Salt command it is interpreted as a keyword argument in the format <code class="docutils literal notranslate"><span class="pre">key=val</span></code>. That processing can be bypassed in order to pass an equal sign through to the remote shell command by manually specifying the kwarg:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cmd.shell cmd='sed -e s/=/:/g'</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.cmdmod.shell_info"> salt.modules.cmdmod.shell_info(shell, list_modules=False)</h3> <dd>
<div class="versionadded"> <p><span class="versionmodified added">New in version 2016.11.0.</span></p> </div> <p>Provides information about a shell or script languages which often use <code class="docutils literal notranslate"><span class="pre">#!</span></code>. The values returned are dependent on the shell or scripting languages all return the <code class="docutils literal notranslate"><span class="pre">installed</span></code>, <code class="docutils literal notranslate"><span class="pre">path</span></code>, <code class="docutils literal notranslate"><span class="pre">version</span></code>, <code class="docutils literal notranslate"><span class="pre">version_raw</span></code></p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li><p><strong>shell</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- Name of the shell. Support shells/script languages include</p></li> <li><p><strong>cmd</strong><strong>, </strong><strong>perl</strong><strong>, </strong><strong>php</strong><strong>, </strong><strong>powershell</strong><strong>, </strong><strong>python</strong><strong>, </strong><strong>ruby and zsh</strong> (<em>bash</em><em>,</em>) -- </p></li> <li><p><strong>list_modules</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- True to list modules available to the shell.</p></li> <li><p><strong>only lists powershell modules.</strong> (<em>Currently</em>) -- </p></li> </ul> </dd> <dt class="field-even">Returns</dt> <dd class="field-even">
<p>A dictionary of information about the shell</p> </dd> <dt class="field-odd">Return type</dt> <dd class="field-odd">
<p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)">dict</a></p> </dd> </dl> <pre class="highlight-python notranslate" data-language="python">{'version': '&lt;2 or 3 numeric components dot-separated&gt;',
 'version_raw': '&lt;full version string&gt;',
 'path': '&lt;full path to binary&gt;',
 'installed': &lt;True, False or None&gt;,
 '&lt;attribute&gt;': '&lt;attribute value&gt;'}</pre> <div class="admonition note"> <p class="admonition-title">Note</p> <ul class="simple"> <li><p><code class="docutils literal notranslate"><span class="pre">installed</span></code> is always returned, if <code class="docutils literal notranslate"><span class="pre">None</span></code> or <code class="docutils literal notranslate"><span class="pre">False</span></code> also returns error and may also return <code class="docutils literal notranslate"><span class="pre">stdout</span></code> for diagnostics.</p></li> <li><p><code class="docutils literal notranslate"><span class="pre">version</span></code> is for use in determine if a shell/script language has a particular feature set, not for package management.</p></li> <li><p>The shell must be within the executable search path.</p></li> </ul> </div> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cmd.shell_info bash
salt '*' cmd.shell_info powershell</pre> <dl class="field-list simple"> <dt class="field-odd">Codeauthor</dt> <dd class="field-odd">
<p>Damon Atkins &lt;<a class="reference external" href="https://github.com/damon-atkins">https://github.com/damon-atkins</a>&gt;</p> </dd> </dl> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.cmdmod.shells"> salt.modules.cmdmod.shells()</h3> <dd>
<p>Lists the valid shells on this system via the /etc/shells file</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2015.5.0.</span></p> </div> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cmd.shells</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.cmdmod.tty"> salt.modules.cmdmod.tty(device, echo='')</h3> <dd>
<p>Echo a string to a specific tty</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cmd.tty tty0 'This is a test'
salt '*' cmd.tty pts3 'This is a test'</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.cmdmod.which"> salt.modules.cmdmod.which(cmd)</h3> <dd>
<p>Returns the path of an executable available on the minion, None otherwise</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cmd.which cat</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.cmdmod.which_bin"> salt.modules.cmdmod.which_bin(cmds)</h3> <dd>
<p>Returns the first command found in a list of commands</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cmd.which_bin '[pip2, pip, pip-python]'</pre> </dd>
</dl><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2021 SaltStack.<br>Licensed under the Apache License, Version 2.0.<br>
    <a href="https://docs.saltproject.io/en/latest/ref/modules/all/salt.modules.cmdmod.html" class="_attribution-link">https://docs.saltproject.io/en/latest/ref/modules/all/salt.modules.cmdmod.html</a>
  </p>
</div>
