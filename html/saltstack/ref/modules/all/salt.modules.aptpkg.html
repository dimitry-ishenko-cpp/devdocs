<h1>salt.modules.aptpkg</h1> <p>Support for APT (Advanced Packaging Tool)</p> <div class="admonition important"> <p class="admonition-title">Important</p> <p>If you feel that Salt should be using this module to manage packages on a minion, and it is using a different module (or gives an error similar to <em>'pkg.install' is not available</em>), see <a class="reference internal" href="https://docs.saltproject.io/en/latest/ref/modules/index.html#module-provider-override"><span class="std std-ref">here</span></a>.</p> <p>For repository management, the <code class="docutils literal notranslate"><span class="pre">python-apt</span></code> package must be installed.</p> </div> <dl class="py function"> <h3 id="salt.modules.aptpkg.add_repo_key"> salt.modules.aptpkg.add_repo_key(path=None, text=None, keyserver=None, keyid=None, saltenv='base')</h3> <dd>
<div class="versionadded"> <p><span class="versionmodified added">New in version 2017.7.0.</span></p> </div> <p>Add a repo key using <code class="docutils literal notranslate"><span class="pre">apt-key</span> <span class="pre">add</span></code>.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li><p><strong>path</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The path of the key file to import.</p></li> <li><p><strong>text</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The key data to import, in string form.</p></li> <li><p><strong>keyserver</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The server to download the repo key specified by the keyid.</p></li> <li><p><strong>keyid</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The key id of the repo key to add.</p></li> <li><p><strong>saltenv</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The environment the key file resides in.</p></li> </ul> </dd> <dt class="field-even">Returns</dt> <dd class="field-even">
<p>A boolean representing whether the repo key was added.</p> </dd> <dt class="field-odd">Return type</dt> <dd class="field-odd">
<p><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)">bool</a></p> </dd> </dl> <p>CLI Examples:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' pkg.add_repo_key 'salt://apt/sources/test.key'

salt '*' pkg.add_repo_key text="'$KEY1'"

salt '*' pkg.add_repo_key keyserver='keyserver.example' keyid='0000AAAA'</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.aptpkg.autoremove"> salt.modules.aptpkg.autoremove(list_only=False, purge=False)</h3> <dd>
<div class="versionadded"> <p><span class="versionmodified added">New in version 2015.5.0.</span></p> </div> <p>Remove packages not required by another package using <code class="docutils literal notranslate"><span class="pre">apt-get</span>
<span class="pre">autoremove</span></code>.</p> <dl> <dt>list_only<span class="classifier">False</span>
</dt>
<dd>
<p>Only retrieve the list of packages to be auto-removed, do not actually perform the auto-removal.</p> </dd> <dt>purge<span class="classifier">False</span>
</dt>
<dd>
<p>Also remove package config data when autoremoving packages.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2015.8.0.</span></p> </div> </dd> </dl> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' pkg.autoremove
salt '*' pkg.autoremove list_only=True
salt '*' pkg.autoremove purge=True</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.aptpkg.del_repo"> salt.modules.aptpkg.del_repo(repo, **kwargs)</h3> <dd>
<p>Delete a repo from the sources.list / sources.list.d</p> <p>If the .list file is in the sources.list.d directory and the file that the repo exists in does not contain any other repo configuration, the file itself will be deleted.</p> <p>The repo passed in must be a fully formed repository definition string.</p> <p>CLI Examples:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' pkg.del_repo "myrepo definition"</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.aptpkg.del_repo_key"> salt.modules.aptpkg.del_repo_key(name=None, **kwargs)</h3> <dd>
<div class="versionadded"> <p><span class="versionmodified added">New in version 2015.8.0.</span></p> </div> <p>Remove a repo key using <code class="docutils literal notranslate"><span class="pre">apt-key</span> <span class="pre">del</span></code></p> <dl> <dt>name</dt>
<dd>
<p>Repo from which to remove the key. Unnecessary if <code class="docutils literal notranslate"><span class="pre">keyid</span></code> is passed.</p> </dd> <dt>keyid</dt>
<dd>
<p>The KeyID of the GPG key to remove</p> </dd> <dt>keyid_ppa<span class="classifier">False</span>
</dt>
<dd>
<p>If set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, the repo's GPG key ID will be looked up from ppa.launchpad.net and removed.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>Setting this option to <code class="docutils literal notranslate"><span class="pre">True</span></code> requires that the <code class="docutils literal notranslate"><span class="pre">name</span></code> param also be passed.</p> </div> </dd> </dl> <p>CLI Examples:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' pkg.del_repo_key keyid=0123ABCD
salt '*' pkg.del_repo_key name='ppa:foo/bar' keyid_ppa=True</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.aptpkg.expand_repo_def"> salt.modules.aptpkg.expand_repo_def(**kwargs)</h3> <dd>
<p>Take a repository definition and expand it to the full pkg repository dict that can be used for comparison. This is a helper function to make the Debian/Ubuntu apt sources sane for comparison in the pkgrepo states.</p> <p>This is designed to be called from pkgrepo states and will have little use being called on the CLI.</p> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.aptpkg.file_dict"> salt.modules.aptpkg.file_dict(*packages, **kwargs)</h3> <dd>
<p>List the files that belong to a package, grouped by package. Not specifying any packages will return a list of _every_ file on the system's package database (not generally recommended).</p> <p>CLI Examples:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' pkg.file_dict httpd
salt '*' pkg.file_dict httpd postfix
salt '*' pkg.file_dict</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.aptpkg.file_list"> salt.modules.aptpkg.file_list(*packages, **kwargs)</h3> <dd>
<p>List the files that belong to a package. Not specifying any packages will return a list of _every_ file on the system's package database (not generally recommended).</p> <p>CLI Examples:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' pkg.file_list httpd
salt '*' pkg.file_list httpd postfix
salt '*' pkg.file_list</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.aptpkg.get_repo"> salt.modules.aptpkg.get_repo(repo, **kwargs)</h3> <dd>
<p>Display a repo from the sources.list / sources.list.d</p> <p>The repo passed in needs to be a complete repo entry.</p> <p>CLI Examples:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' pkg.get_repo "myrepo definition"</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.aptpkg.get_repo_keys"> salt.modules.aptpkg.get_repo_keys()</h3> <dd>
<div class="versionadded"> <p><span class="versionmodified added">New in version 2017.7.0.</span></p> </div> <p>List known repo key details.</p> <dl class="field-list simple"> <dt class="field-odd">Returns</dt> <dd class="field-odd">
<p>A dictionary containing the repo keys.</p> </dd> <dt class="field-even">Return type</dt> <dd class="field-even">
<p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)">dict</a></p> </dd> </dl> <p>CLI Examples:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' pkg.get_repo_keys</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.aptpkg.get_selections"> salt.modules.aptpkg.get_selections(pattern=None, state=None)</h3> <dd>
<p>View package state from the dpkg database.</p> <p>Returns a dict of dicts containing the state, and package names:</p> <pre class="highlight-python notranslate" data-language="python">{'&lt;host&gt;':
    {'&lt;state&gt;': ['pkg1',
                 ...
                ]
    },
    ...
}</pre> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' pkg.get_selections
salt '*' pkg.get_selections 'python-*'
salt '*' pkg.get_selections state=hold
salt '*' pkg.get_selections 'openssh*' state=hold</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.aptpkg.hold"> salt.modules.aptpkg.hold(name=None, pkgs=None, sources=None, **kwargs)</h3> <dd>
<div class="versionadded"> <p><span class="versionmodified added">New in version 2014.7.0.</span></p> </div> <p>Set package in 'hold' state, meaning it will not be upgraded.</p> <dl> <dt>name</dt>
<dd>
<p>The name of the package, e.g., 'tmux'</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' pkg.hold &lt;package name&gt;</pre> </dd> <dt>pkgs</dt>
<dd>
<p>A list of packages to hold. Must be passed as a python list.</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' pkg.hold pkgs='["foo", "bar"]'</pre> </dd> </dl> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.aptpkg.info_installed"> salt.modules.aptpkg.info_installed(*names, **kwargs)</h3> <dd>
<p>Return the information of the named package(s) installed on the system.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2015.8.1.</span></p> </div> <dl> <dt>names</dt>
<dd>
<p>The names of the packages for which to return information.</p> </dd> <dt>failhard</dt>
<dd>
<p>Whether to throw an exception if none of the packages are installed. Defaults to True.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2016.11.3.</span></p> </div> </dd> </dl> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' pkg.info_installed &lt;package1&gt;
salt '*' pkg.info_installed &lt;package1&gt; &lt;package2&gt; &lt;package3&gt; ...
salt '*' pkg.info_installed &lt;package1&gt; failhard=false</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.aptpkg.install"> salt.modules.aptpkg.install(name=None, refresh=False, fromrepo=None, skip_verify=False, debconf=None, pkgs=None, sources=None, reinstall=False, downloadonly=False, ignore_epoch=False, **kwargs)</h3> <dd>
<div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 2015.8.12,2016.3.3,2016.11.0: </span>On minions running systemd&gt;=205, <a class="reference external" href="https://www.freedesktop.org/software/systemd/man/systemd-run.html">systemd-run(1)</a> is now used to isolate commands which modify installed packages from the <code class="docutils literal notranslate"><span class="pre">salt-minion</span></code> daemon's control group. This is done to keep systemd from killing any apt-get/dpkg commands spawned by Salt when the <code class="docutils literal notranslate"><span class="pre">salt-minion</span></code> service is restarted. (see <code class="docutils literal notranslate"><span class="pre">KillMode</span></code> in the <a class="reference external" href="https://www.freedesktop.org/software/systemd/man/systemd.kill.html">systemd.kill(5)</a> manpage for more information). If desired, usage of <a class="reference external" href="https://www.freedesktop.org/software/systemd/man/systemd-run.html">systemd-run(1)</a> can be suppressed by setting a <a class="reference internal" href="salt.modules.config.html#salt.modules.config.get" title="salt.modules.config.get"><code class="xref py py-mod docutils literal notranslate"><span class="pre">config</span> <span class="pre">option</span></code></a> called <code class="docutils literal notranslate"><span class="pre">systemd.scope</span></code>, with a value of <code class="docutils literal notranslate"><span class="pre">False</span></code> (no quotes).</p> </div> <p>Install the passed package, add refresh=True to update the dpkg database.</p> <dl> <dt>name</dt>
<dd>
<p>The name of the package to be installed. Note that this parameter is ignored if either "pkgs" or "sources" is passed. Additionally, please note that this option can only be used to install packages from a software repository. To install a package file manually, use the "sources" option.</p> <p>32-bit packages can be installed on 64-bit systems by appending the architecture designation (<code class="docutils literal notranslate"><span class="pre">:i386</span></code>, etc.) to the end of the package name.</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' pkg.install &lt;package name&gt;</pre> </dd> <dt>refresh</dt>
<dd>
<p>Whether or not to refresh the package database before installing.</p> </dd> </dl> <p>cache_valid_time</p> <blockquote> <div>
<div class="versionadded"> <p><span class="versionmodified added">New in version 2016.11.0.</span></p> </div> <p>Skip refreshing the package database if refresh has already occurred within &lt;value&gt; seconds</p> </div>
</blockquote> <dl> <dt>fromrepo</dt>
<dd>
<p>Specify a package repository to install from (e.g., <code class="docutils literal notranslate"><span class="pre">apt-get</span> <span class="pre">-t</span> <span class="pre">unstable</span> <span class="pre">install</span> <span class="pre">somepackage</span></code>)</p> </dd> <dt>skip_verify</dt>
<dd>
<p>Skip the GPG verification check (e.g., <code class="docutils literal notranslate"><span class="pre">--allow-unauthenticated</span></code>, or <code class="docutils literal notranslate"><span class="pre">--force-bad-verify</span></code> for install from package file).</p> </dd> <dt>debconf</dt>
<dd>
<p>Provide the path to a debconf answers file, processed before installation.</p> </dd> <dt>version</dt>
<dd>
<p>Install a specific version of the package, e.g. 1.2.3~0ubuntu0. Ignored if "pkgs" or "sources" is passed.</p> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 2018.3.0: </span>version can now contain comparison operators (e.g. <code class="docutils literal notranslate"><span class="pre">&gt;1.2.3</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;=2.0</span></code>, etc.)</p> </div> </dd> <dt>reinstall<span class="classifier">False</span>
</dt>
<dd>
<p>Specifying reinstall=True will use <code class="docutils literal notranslate"><span class="pre">apt-get</span> <span class="pre">install</span> <span class="pre">--reinstall</span></code> rather than simply <code class="docutils literal notranslate"><span class="pre">apt-get</span> <span class="pre">install</span></code> for requested packages that are already installed.</p> <p>If a version is specified with the requested package, then <code class="docutils literal notranslate"><span class="pre">apt-get</span>
<span class="pre">install</span> <span class="pre">--reinstall</span></code> will only be used if the installed version matches the requested version.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2015.8.0.</span></p> </div> </dd> <dt>ignore_epoch<span class="classifier">False</span>
</dt>
<dd>
<p>Only used when the version of a package is specified using a comparison operator (e.g. <code class="docutils literal notranslate"><span class="pre">&gt;4.1</span></code>). If set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, then the epoch will be ignored when comparing the currently-installed version to the desired version.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2018.3.0.</span></p> </div> </dd> </dl> <p>Multiple Package Installation Options:</p> <dl> <dt>pkgs</dt>
<dd>
<p>A list of packages to install from a software repository. Must be passed as a python list.</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' pkg.install pkgs='["foo", "bar"]'
salt '*' pkg.install pkgs='["foo", {"bar": "1.2.3-0ubuntu0"}]'</pre> </dd> <dt>sources</dt>
<dd>
<p>A list of DEB packages to install. Must be passed as a list of dicts, with the keys being package names, and the values being the source URI or local path to the package. Dependencies are automatically resolved and marked as auto-installed.</p> <p>32-bit packages can be installed on 64-bit systems by appending the architecture designation (<code class="docutils literal notranslate"><span class="pre">:i386</span></code>, etc.) to the end of the package name.</p> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 2014.7.0.</span></p> </div> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' pkg.install sources='[{"foo": "salt://foo.deb"},{"bar": "salt://bar.deb"}]'</pre> </dd> <dt>force_yes</dt>
<dd>
<p>Passes <code class="docutils literal notranslate"><span class="pre">--force-yes</span></code> to the apt-get command. Don't use this unless you know what you're doing.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 0.17.4.</span></p> </div> </dd> <dt>install_recommends</dt>
<dd>
<p>Whether to install the packages marked as recommended. Default is True.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2015.5.0.</span></p> </div> </dd> <dt>only_upgrade</dt>
<dd>
<p>Only upgrade the packages, if they are already installed. Default is False.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2015.5.0.</span></p> </div> </dd> <dt>force_conf_new</dt>
<dd>
<p>Always install the new version of any configuration files.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2015.8.0.</span></p> </div> </dd> </dl> <p>Returns a dict containing the new package names and versions:</p> <pre class="highlight-default notranslate" data-language="default">{'&lt;package&gt;': {'old': '&lt;old-version&gt;',
               'new': '&lt;new-version&gt;'}}</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.aptpkg.latest_version"> salt.modules.aptpkg.latest_version(*names, **kwargs)</h3> <dd>
<p>Return the latest version of the named package available for upgrade or installation. If more than one package name is specified, a dict of name/version pairs is returned.</p> <p>If the latest version of a given package is already installed, an empty string will be returned for that package.</p> <p>A specific repo can be requested using the <code class="docutils literal notranslate"><span class="pre">fromrepo</span></code> keyword argument.</p> <p>cache_valid_time</p> <blockquote> <div>
<div class="versionadded"> <p><span class="versionmodified added">New in version 2016.11.0.</span></p> </div> <p>Skip refreshing the package database if refresh has already occurred within &lt;value&gt; seconds</p> </div>
</blockquote> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' pkg.latest_version &lt;package name&gt;
salt '*' pkg.latest_version &lt;package name&gt; fromrepo=unstable
salt '*' pkg.latest_version &lt;package1&gt; &lt;package2&gt; &lt;package3&gt; ...</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.aptpkg.list_downloaded"> salt.modules.aptpkg.list_downloaded(root=None, **kwargs)</h3> <dd>
<div class="versionadded"> <p><span class="versionmodified added">New in version 3000?.</span></p> </div> <p>List prefetched packages downloaded by apt in the local disk.</p> <dl class="simple"> <dt>root</dt>
<dd>
<p>operate on a different root directory.</p> </dd> </dl> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' pkg.list_downloaded</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.aptpkg.list_pkgs"> salt.modules.aptpkg.list_pkgs(versions_as_list=False, removed=False, purge_desired=False, **kwargs)</h3> <dd>
<p>List the packages currently installed in a dict:</p> <pre class="highlight-default notranslate" data-language="default">{'&lt;package_name&gt;': '&lt;version&gt;'}</pre> <dl> <dt>removed</dt>
<dd>
<p>If <code class="docutils literal notranslate"><span class="pre">True</span></code>, then only packages which have been removed (but not purged) will be returned.</p> </dd> <dt>purge_desired</dt>
<dd>
<p>If <code class="docutils literal notranslate"><span class="pre">True</span></code>, then only packages which have been marked to be purged, but can't be purged due to their status as dependencies for other installed packages, will be returned. Note that these packages will appear in installed</p> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 2014.1.1: </span>Packages in this state now correctly show up in the output of this function.</p> </div> </dd> </dl> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' pkg.list_pkgs
salt '*' pkg.list_pkgs versions_as_list=True</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.aptpkg.list_repo_pkgs"> salt.modules.aptpkg.list_repo_pkgs(*args, **kwargs)</h3> <dd>
<div class="versionadded"> <p><span class="versionmodified added">New in version 2017.7.0.</span></p> </div> <p>Returns all available packages. Optionally, package names (and name globs) can be passed and the results will be filtered to packages matching those names.</p> <p>This function can be helpful in discovering the version or repo to specify in a <a class="reference internal" href="../../states/all/salt.states.pkg.html#salt.states.pkg.installed" title="salt.states.pkg.installed"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pkg.installed</span></code></a> state.</p> <p>The return data will be a dictionary mapping package names to a list of version numbers, ordered from newest to oldest. For example:</p> <pre class="highlight-python notranslate" data-language="python">{
    'bash': ['4.3-14ubuntu1.1',
             '4.3-14ubuntu1'],
    'nginx': ['1.10.0-0ubuntu0.16.04.4',
              '1.9.15-0ubuntu1']
}</pre> <p>CLI Examples:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' pkg.list_repo_pkgs
salt '*' pkg.list_repo_pkgs foo bar baz</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.aptpkg.list_repos"> salt.modules.aptpkg.list_repos(**kwargs)</h3> <dd>
<p>Lists all repos in the sources.list (and sources.lists.d) files</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' pkg.list_repos
salt '*' pkg.list_repos disabled=True</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.aptpkg.list_upgrades"> salt.modules.aptpkg.list_upgrades(refresh=True, dist_upgrade=True, **kwargs)</h3> <dd>
<p>List all available package upgrades.</p> <dl class="simple"> <dt>refresh</dt>
<dd>
<p>Whether to refresh the package database before listing upgrades. Default: True.</p> </dd> </dl> <p>cache_valid_time</p> <blockquote> <div>
<div class="versionadded"> <p><span class="versionmodified added">New in version 2016.11.0.</span></p> </div> <p>Skip refreshing the package database if refresh has already occurred within &lt;value&gt; seconds</p> </div>
</blockquote> <dl class="simple"> <dt>dist_upgrade</dt>
<dd>
<p>Whether to list the upgrades using dist-upgrade vs upgrade. Default is to use dist-upgrade.</p> </dd> </dl> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' pkg.list_upgrades</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.aptpkg.mod_repo"> salt.modules.aptpkg.mod_repo(repo, saltenv='base', **kwargs)</h3> <dd>
<p>Modify one or more values for a repo. If the repo does not exist, it will be created, so long as the definition is well formed. For Ubuntu the <code class="docutils literal notranslate"><span class="pre">ppa:&lt;project&gt;/repo</span></code> format is acceptable. <code class="docutils literal notranslate"><span class="pre">ppa:</span></code> format can only be used to create a new repository.</p> <p>The following options are available to modify a repo definition:</p> <dl> <dt>architectures</dt>
<dd>
<p>A comma-separated list of supported architectures, e.g. <code class="docutils literal notranslate"><span class="pre">amd64</span></code> If this option is not set, all architectures (configured in the system) will be used.</p> </dd> <dt>comps</dt>
<dd>
<p>A comma separated list of components for the repo, e.g. <code class="docutils literal notranslate"><span class="pre">main</span></code></p> </dd> <dt>file</dt>
<dd>
<p>A file name to be used</p> </dd> <dt>keyserver</dt>
<dd>
<p>Keyserver to get gpg key from</p> </dd> <dt>keyid</dt>
<dd>
<p>Key ID or a list of key IDs to load with the <code class="docutils literal notranslate"><span class="pre">keyserver</span></code> argument</p> </dd> <dt>key_url</dt>
<dd>
<p>URL to a GPG key to add to the APT GPG keyring</p> </dd> <dt>key_text</dt>
<dd>
<p>GPG key in string form to add to the APT GPG keyring</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2018.3.0.</span></p> </div> </dd> <dt>consolidate<span class="classifier">False</span>
</dt>
<dd>
<p>If <code class="docutils literal notranslate"><span class="pre">True</span></code>, will attempt to de-duplicate and consolidate sources</p> </dd> <dt>comments</dt>
<dd>
<p>Sometimes you want to supply additional information, but not as enabled configuration. All comments provided here will be joined into a single string and appended to the repo configuration with a comment marker (#) before it.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2015.8.9.</span></p> </div> </dd> <dt>refresh<span class="classifier">True</span>
</dt>
<dd>
<p>Enable or disable (True or False) refreshing of the apt package database. The previous <code class="docutils literal notranslate"><span class="pre">refresh_db</span></code> argument was deprecated in favor of <code class="docutils literal notranslate"><span class="pre">refresh`</span></code>. The <code class="docutils literal notranslate"><span class="pre">refresh_db</span></code> argument will still continue to work to ensure backwards compatibility, but please change to using the preferred <code class="docutils literal notranslate"><span class="pre">refresh</span></code>.</p> </dd> </dl> <div class="admonition note"> <p class="admonition-title">Note</p> <p>Due to the way keys are stored for APT, there is a known issue where the key won't be updated unless another change is made at the same time. Keys should be properly added on initial configuration.</p> </div> <p>CLI Examples:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' pkg.mod_repo 'myrepo definition' uri=http://new/uri
salt '*' pkg.mod_repo 'myrepo definition' comps=main,universe</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.aptpkg.normalize_name"> salt.modules.aptpkg.normalize_name(name)</h3> <dd>
<p>Strips the architecture from the specified package name, if necessary.</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' pkg.normalize_name zsh:amd64</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.aptpkg.owner"> salt.modules.aptpkg.owner(*paths, **kwargs)</h3> <dd>
<div class="versionadded"> <p><span class="versionmodified added">New in version 2014.7.0.</span></p> </div> <p>Return the name of the package that owns the file. Multiple file paths can be passed. Like <a class="reference internal" href="#salt.modules.aptpkg.version" title="salt.modules.aptpkg.version"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pkg.version</span></code></a>, if a single path is passed, a string will be returned, and if multiple paths are passed, a dictionary of file/package name pairs will be returned.</p> <p>If the file is not owned by a package, or is not present on the minion, then an empty string will be returned for that path.</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' pkg.owner /usr/bin/apachectl
salt '*' pkg.owner /usr/bin/apachectl /usr/bin/basename</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.aptpkg.parse_arch"> salt.modules.aptpkg.parse_arch(name)</h3> <dd>
<p>Parse name and architecture from the specified package name.</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' pkg.parse_arch zsh:amd64</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.aptpkg.purge"> salt.modules.aptpkg.purge(name=None, pkgs=None, **kwargs)</h3> <dd>
<div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 2015.8.12,2016.3.3,2016.11.0: </span>On minions running systemd&gt;=205, <a class="reference external" href="https://www.freedesktop.org/software/systemd/man/systemd-run.html">systemd-run(1)</a> is now used to isolate commands which modify installed packages from the <code class="docutils literal notranslate"><span class="pre">salt-minion</span></code> daemon's control group. This is done to keep systemd from killing any apt-get/dpkg commands spawned by Salt when the <code class="docutils literal notranslate"><span class="pre">salt-minion</span></code> service is restarted. (see <code class="docutils literal notranslate"><span class="pre">KillMode</span></code> in the <a class="reference external" href="https://www.freedesktop.org/software/systemd/man/systemd.kill.html">systemd.kill(5)</a> manpage for more information). If desired, usage of <a class="reference external" href="https://www.freedesktop.org/software/systemd/man/systemd-run.html">systemd-run(1)</a> can be suppressed by setting a <a class="reference internal" href="salt.modules.config.html#salt.modules.config.get" title="salt.modules.config.get"><code class="xref py py-mod docutils literal notranslate"><span class="pre">config</span> <span class="pre">option</span></code></a> called <code class="docutils literal notranslate"><span class="pre">systemd.scope</span></code>, with a value of <code class="docutils literal notranslate"><span class="pre">False</span></code> (no quotes).</p> </div> <p>Remove packages via <code class="docutils literal notranslate"><span class="pre">apt-get</span> <span class="pre">purge</span></code> along with all configuration files.</p> <dl class="simple"> <dt>name</dt>
<dd>
<p>The name of the package to be deleted.</p> </dd> </dl> <p>Multiple Package Options:</p> <dl class="simple"> <dt>pkgs</dt>
<dd>
<p>A list of packages to delete. Must be passed as a python list. The <code class="docutils literal notranslate"><span class="pre">name</span></code> parameter will be ignored if this option is passed.</p> </dd> </dl> <div class="versionadded"> <p><span class="versionmodified added">New in version 0.16.0.</span></p> </div> <p>Returns a dict containing the changes.</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' pkg.purge &lt;package name&gt;
salt '*' pkg.purge &lt;package1&gt;,&lt;package2&gt;,&lt;package3&gt;
salt '*' pkg.purge pkgs='["foo", "bar"]'</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.aptpkg.refresh_db"> salt.modules.aptpkg.refresh_db(cache_valid_time=0, failhard=False, **kwargs)</h3> <dd>
<p>Updates the APT database to latest packages based upon repositories</p> <p>Returns a dict, with the keys being package databases and the values being the result of the update attempt. Values can be one of the following:</p> <ul class="simple"> <li><p><code class="docutils literal notranslate"><span class="pre">True</span></code>: Database updated successfully</p></li> <li><p><code class="docutils literal notranslate"><span class="pre">False</span></code>: Problem updating database</p></li> <li><p><code class="docutils literal notranslate"><span class="pre">None</span></code>: Database already up-to-date</p></li> </ul> <p>cache_valid_time</p> <blockquote> <div>
<div class="versionadded"> <p><span class="versionmodified added">New in version 2016.11.0.</span></p> </div> <p>Skip refreshing the package database if refresh has already occurred within &lt;value&gt; seconds</p> </div>
</blockquote> <p>failhard</p> <blockquote> <div>
<p>If False, return results of Err lines as <code class="docutils literal notranslate"><span class="pre">False</span></code> for the package database that encountered the error. If True, raise an error with a list of the package databases that encountered errors.</p> </div>
</blockquote> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' pkg.refresh_db</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.aptpkg.remove"> salt.modules.aptpkg.remove(name=None, pkgs=None, **kwargs)</h3> <dd>
<div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 2015.8.12,2016.3.3,2016.11.0: </span>On minions running systemd&gt;=205, <a class="reference external" href="https://www.freedesktop.org/software/systemd/man/systemd-run.html">systemd-run(1)</a> is now used to isolate commands which modify installed packages from the <code class="docutils literal notranslate"><span class="pre">salt-minion</span></code> daemon's control group. This is done to keep systemd from killing any apt-get/dpkg commands spawned by Salt when the <code class="docutils literal notranslate"><span class="pre">salt-minion</span></code> service is restarted. (see <code class="docutils literal notranslate"><span class="pre">KillMode</span></code> in the <a class="reference external" href="https://www.freedesktop.org/software/systemd/man/systemd.kill.html">systemd.kill(5)</a> manpage for more information). If desired, usage of <a class="reference external" href="https://www.freedesktop.org/software/systemd/man/systemd-run.html">systemd-run(1)</a> can be suppressed by setting a <a class="reference internal" href="salt.modules.config.html#salt.modules.config.get" title="salt.modules.config.get"><code class="xref py py-mod docutils literal notranslate"><span class="pre">config</span> <span class="pre">option</span></code></a> called <code class="docutils literal notranslate"><span class="pre">systemd.scope</span></code>, with a value of <code class="docutils literal notranslate"><span class="pre">False</span></code> (no quotes).</p> </div> <p>Remove packages using <code class="docutils literal notranslate"><span class="pre">apt-get</span> <span class="pre">remove</span></code>.</p> <dl class="simple"> <dt>name</dt>
<dd>
<p>The name of the package to be deleted.</p> </dd> </dl> <p>Multiple Package Options:</p> <dl class="simple"> <dt>pkgs</dt>
<dd>
<p>A list of packages to delete. Must be passed as a python list. The <code class="docutils literal notranslate"><span class="pre">name</span></code> parameter will be ignored if this option is passed.</p> </dd> </dl> <div class="versionadded"> <p><span class="versionmodified added">New in version 0.16.0.</span></p> </div> <p>Returns a dict containing the changes.</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' pkg.remove &lt;package name&gt;
salt '*' pkg.remove &lt;package1&gt;,&lt;package2&gt;,&lt;package3&gt;
salt '*' pkg.remove pkgs='["foo", "bar"]'</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.aptpkg.services_need_restart"> salt.modules.aptpkg.services_need_restart(**kwargs)</h3> <dd>
<div class="versionadded"> <p><span class="versionmodified added">New in version 3003.</span></p> </div> <p>List services that use files which have been changed by the package manager. It might be needed to restart them.</p> <p>Requires checkrestart from the debian-goodies package.</p> <p>CLI Examples:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' pkg.services_need_restart</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.aptpkg.set_selections"> salt.modules.aptpkg.set_selections(path=None, selection=None, clear=False, saltenv='base')</h3> <dd>
<p>Change package state in the dpkg database.</p> <p>The state can be any one of, documented in <code class="docutils literal notranslate"><span class="pre">dpkg(1)</span></code>:</p> <ul class="simple"> <li><p>install</p></li> <li><p>hold</p></li> <li><p>deinstall</p></li> <li><p>purge</p></li> </ul> <p>This command is commonly used to mark specific packages to be held from being upgraded, that is, to be kept at a certain version. When a state is changed to anything but being held, then it is typically followed by <code class="docutils literal notranslate"><span class="pre">apt-get</span> <span class="pre">-u</span> <span class="pre">dselect-upgrade</span></code>.</p> <p>Note: Be careful with the <code class="docutils literal notranslate"><span class="pre">clear</span></code> argument, since it will start with setting all packages to deinstall state.</p> <p>Returns a dict of dicts containing the package names, and the new and old versions:</p> <pre class="highlight-python notranslate" data-language="python">{'&lt;host&gt;':
    {'&lt;package&gt;': {'new': '&lt;new-state&gt;',
                   'old': '&lt;old-state&gt;'}
    },
    ...
}</pre> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' pkg.set_selections selection='{"install": ["netcat"]}'
salt '*' pkg.set_selections selection='{"hold": ["openssh-server", "openssh-client"]}'
salt '*' pkg.set_selections salt://path/to/file
salt '*' pkg.set_selections salt://path/to/file clear=True</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.aptpkg.show"> salt.modules.aptpkg.show(*names, **kwargs)</h3> <dd>
<div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> <p>Runs an <code class="docutils literal notranslate"><span class="pre">apt-cache</span> <span class="pre">show</span></code> on the passed package names, and returns the results in a nested dictionary. The top level of the return data will be the package name, with each package name mapping to a dictionary of version numbers to any additional information returned by <code class="docutils literal notranslate"><span class="pre">apt-cache</span> <span class="pre">show</span></code>.</p> <dl class="simple"> <dt>filter</dt>
<dd>
<p>An optional comma-separated list (or quoted Python list) of case-insensitive keys on which to filter. This allows one to restrict the information returned for each package to a smaller selection of pertinent items.</p> </dd> <dt>refresh<span class="classifier">False</span>
</dt>
<dd>
<p>If <code class="docutils literal notranslate"><span class="pre">True</span></code>, the apt cache will be refreshed first. By default, no refresh is performed.</p> </dd> </dl> <p>CLI Examples:</p> <pre class="highlight-bash notranslate" data-language="bash">salt myminion pkg.show gawk
salt myminion pkg.show 'nginx-*'
salt myminion pkg.show 'nginx-*' filter=description,provides</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.aptpkg.unhold"> salt.modules.aptpkg.unhold(name=None, pkgs=None, sources=None, **kwargs)</h3> <dd>
<div class="versionadded"> <p><span class="versionmodified added">New in version 2014.7.0.</span></p> </div> <p>Set package current in 'hold' state to install state, meaning it will be upgraded.</p> <dl> <dt>name</dt>
<dd>
<p>The name of the package, e.g., 'tmux'</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' pkg.unhold &lt;package name&gt;</pre> </dd> <dt>pkgs</dt>
<dd>
<p>A list of packages to unhold. Must be passed as a python list.</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' pkg.unhold pkgs='["foo", "bar"]'</pre> </dd> </dl> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.aptpkg.upgrade"> salt.modules.aptpkg.upgrade(refresh=True, dist_upgrade=False, **kwargs)</h3> <dd>
<div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 2015.8.12,2016.3.3,2016.11.0: </span>On minions running systemd&gt;=205, <a class="reference external" href="https://www.freedesktop.org/software/systemd/man/systemd-run.html">systemd-run(1)</a> is now used to isolate commands which modify installed packages from the <code class="docutils literal notranslate"><span class="pre">salt-minion</span></code> daemon's control group. This is done to keep systemd from killing any apt-get/dpkg commands spawned by Salt when the <code class="docutils literal notranslate"><span class="pre">salt-minion</span></code> service is restarted. (see <code class="docutils literal notranslate"><span class="pre">KillMode</span></code> in the <a class="reference external" href="https://www.freedesktop.org/software/systemd/man/systemd.kill.html">systemd.kill(5)</a> manpage for more information). If desired, usage of <a class="reference external" href="https://www.freedesktop.org/software/systemd/man/systemd-run.html">systemd-run(1)</a> can be suppressed by setting a <a class="reference internal" href="salt.modules.config.html#salt.modules.config.get" title="salt.modules.config.get"><code class="xref py py-mod docutils literal notranslate"><span class="pre">config</span> <span class="pre">option</span></code></a> called <code class="docutils literal notranslate"><span class="pre">systemd.scope</span></code>, with a value of <code class="docutils literal notranslate"><span class="pre">False</span></code> (no quotes).</p> </div> <p>Upgrades all packages via <code class="docutils literal notranslate"><span class="pre">apt-get</span> <span class="pre">upgrade</span></code> or <code class="docutils literal notranslate"><span class="pre">apt-get</span> <span class="pre">dist-upgrade</span></code> if <code class="docutils literal notranslate"><span class="pre">dist_upgrade</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p> <p>Returns a dictionary containing the changes:</p> <pre class="highlight-python notranslate" data-language="python">{'&lt;package&gt;':  {'old': '&lt;old-version&gt;',
                'new': '&lt;new-version&gt;'}}</pre> <dl> <dt>dist_upgrade</dt>
<dd>
<p>Whether to perform the upgrade using dist-upgrade vs upgrade. Default is to use upgrade.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2014.7.0.</span></p> </div> </dd> <dt>refresh<span class="classifier">True</span>
</dt>
<dd>
<p>If <code class="docutils literal notranslate"><span class="pre">True</span></code>, the apt cache will be refreshed first. By default, this is <code class="docutils literal notranslate"><span class="pre">True</span></code> and a refresh is performed.</p> </dd> </dl> <p>cache_valid_time</p> <blockquote> <div>
<div class="versionadded"> <p><span class="versionmodified added">New in version 2016.11.0.</span></p> </div> <p>Skip refreshing the package database if refresh has already occurred within &lt;value&gt; seconds</p> </div>
</blockquote> <dl> <dt>download_only (or downloadonly)</dt>
<dd>
<p>Only download the packages, don't unpack or install them. Use downloadonly to be in line with yum and zypper module.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2018.3.0.</span></p> </div> </dd> <dt>force_conf_new</dt>
<dd>
<p>Always install the new version of any configuration files.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2015.8.0.</span></p> </div> </dd> </dl> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' pkg.upgrade</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.aptpkg.upgrade_available"> salt.modules.aptpkg.upgrade_available(name, **kwargs)</h3> <dd>
<p>Check whether or not an upgrade is available for a given package</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' pkg.upgrade_available &lt;package name&gt;</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.aptpkg.version"> salt.modules.aptpkg.version(*names, **kwargs)</h3> <dd>
<p>Returns a string representing the package version or an empty string if not installed. If more than one package name is specified, a dict of name/version pairs is returned.</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' pkg.version &lt;package name&gt;
salt '*' pkg.version &lt;package1&gt; &lt;package2&gt; &lt;package3&gt; ...</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.aptpkg.version_cmp"> salt.modules.aptpkg.version_cmp(pkg1, pkg2, ignore_epoch=False, **kwargs)</h3> <dd>
<p>Do a cmp-style comparison on two packages. Return -1 if pkg1 &lt; pkg2, 0 if pkg1 == pkg2, and 1 if pkg1 &gt; pkg2. Return None if there was a problem making the comparison.</p> <dl> <dt>ignore_epoch<span class="classifier">False</span>
</dt>
<dd>
<p>Set to <code class="docutils literal notranslate"><span class="pre">True</span></code> to ignore the epoch when comparing versions</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2015.8.10,2016.3.2.</span></p> </div> </dd> </dl> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' pkg.version_cmp '0.2.4-0ubuntu1' '0.2.4.1-0ubuntu1'</pre> </dd>
</dl><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2021 SaltStack.<br>Licensed under the Apache License, Version 2.0.<br>
    <a href="https://docs.saltproject.io/en/latest/ref/modules/all/salt.modules.aptpkg.html" class="_attribution-link">https://docs.saltproject.io/en/latest/ref/modules/all/salt.modules.aptpkg.html</a>
  </p>
</div>
