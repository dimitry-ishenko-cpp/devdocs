<h1>salt.modules.zk_concurrency</h1> <div class="section" id="concurrency-controls-in-zookeeper"> <h2>Concurrency controls in zookeeper</h2> <dl class="field-list simple"> <dt class="field-odd">depends</dt> <dd class="field-odd">
<p>kazoo</p> </dd> <dt class="field-even">configuration</dt> <dd class="field-even">
<p>See <a class="reference internal" href="salt.modules.zookeeper.html#module-salt.modules.zookeeper" title="salt.modules.zookeeper"><code class="xref py py-mod docutils literal notranslate"><span class="pre">salt.modules.zookeeper</span></code></a> for setup instructions.</p> </dd> </dl> <p>This module allows you to acquire and release a slot. This is primarily useful for ensureing that no more than N hosts take a specific action at once. This can also be used to coordinate between masters.</p> <dl class="py function"> <h3 id="salt.modules.zk_concurrency.lock"> salt.modules.zk_concurrency.lock(path, zk_hosts=None, identifier=None, max_concurrency=1, timeout=None, ephemeral_lease=False, force=False, profile=None, scheme=None, username=None, password=None, default_acl=None)</h3> <dd>
<p>Get lock (with optional timeout)</p> <dl class="simple"> <dt>path</dt>
<dd>
<p>The path in zookeeper where the lock is</p> </dd> <dt>zk_hosts</dt>
<dd>
<p>zookeeper connect string</p> </dd> <dt>identifier</dt>
<dd>
<p>Name to identify this minion, if unspecified defaults to the hostname</p> </dd> <dt>max_concurrency</dt>
<dd>
<p>Maximum number of lock holders</p> </dd> <dt>timeout</dt>
<dd>
<p>timeout to wait for the lock. A None timeout will block forever</p> </dd> <dt>ephemeral_lease</dt>
<dd>
<p>Whether the locks in zookeper should be ephemeral</p> </dd> <dt>force</dt>
<dd>
<p>Forcibly acquire the lock regardless of available slots</p> </dd> </dl> <p>Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt minion zk_concurrency.lock /lock/path host1:1234,host2:1234</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.zk_concurrency.lock_holders"> salt.modules.zk_concurrency.lock_holders(path, zk_hosts=None, identifier=None, max_concurrency=1, timeout=None, ephemeral_lease=False, profile=None, scheme=None, username=None, password=None, default_acl=None)</h3> <dd>
<p>Return an un-ordered list of lock holders</p> <dl class="simple"> <dt>path</dt>
<dd>
<p>The path in zookeeper where the lock is</p> </dd> <dt>zk_hosts</dt>
<dd>
<p>zookeeper connect string</p> </dd> <dt>identifier</dt>
<dd>
<p>Name to identify this minion, if unspecified defaults to hostname</p> </dd> <dt>max_concurrency</dt>
<dd>
<p>Maximum number of lock holders</p> </dd> <dt>timeout</dt>
<dd>
<p>timeout to wait for the lock. A None timeout will block forever</p> </dd> <dt>ephemeral_lease</dt>
<dd>
<p>Whether the locks in zookeper should be ephemeral</p> </dd> </dl> <p>Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt minion zk_concurrency.lock_holders /lock/path host1:1234,host2:1234</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.zk_concurrency.party_members"> salt.modules.zk_concurrency.party_members(path, zk_hosts=None, min_nodes=1, blocking=False, profile=None, scheme=None, username=None, password=None, default_acl=None)</h3> <dd>
<p>Get the List of identifiers in a particular party, optionally waiting for the specified minimum number of nodes (min_nodes) to appear</p> <dl class="simple"> <dt>path</dt>
<dd>
<p>The path in zookeeper where the lock is</p> </dd> <dt>zk_hosts</dt>
<dd>
<p>zookeeper connect string</p> </dd> <dt>min_nodes</dt>
<dd>
<p>The minimum number of nodes expected to be present in the party</p> </dd> <dt>blocking</dt>
<dd>
<p>The boolean indicating if we need to block until min_nodes are available</p> </dd> </dl> <p>Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt minion zk_concurrency.party_members /lock/path host1:1234,host2:1234
salt minion zk_concurrency.party_members /lock/path host1:1234,host2:1234 min_nodes=3 blocking=True</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.zk_concurrency.unlock"> salt.modules.zk_concurrency.unlock(path, zk_hosts=None, identifier=None, max_concurrency=1, ephemeral_lease=False, scheme=None, profile=None, username=None, password=None, default_acl=None)</h3> <dd>
<p>Remove lease from semaphore</p> <dl class="simple"> <dt>path</dt>
<dd>
<p>The path in zookeeper where the lock is</p> </dd> <dt>zk_hosts</dt>
<dd>
<p>zookeeper connect string</p> </dd> <dt>identifier</dt>
<dd>
<p>Name to identify this minion, if unspecified defaults to hostname</p> </dd> <dt>max_concurrency</dt>
<dd>
<p>Maximum number of lock holders</p> </dd> <dt>timeout</dt>
<dd>
<p>timeout to wait for the lock. A None timeout will block forever</p> </dd> <dt>ephemeral_lease</dt>
<dd>
<p>Whether the locks in zookeper should be ephemeral</p> </dd> </dl> <p>Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt minion zk_concurrency.unlock /lock/path host1:1234,host2:1234</pre> </dd>
</dl> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2021 SaltStack.<br>Licensed under the Apache License, Version 2.0.<br>
    <a href="https://docs.saltproject.io/en/latest/ref/modules/all/salt.modules.zk_concurrency.html" class="_attribution-link">https://docs.saltproject.io/en/latest/ref/modules/all/salt.modules.zk_concurrency.html</a>
  </p>
</div>
