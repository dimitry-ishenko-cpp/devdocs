<h1>salt.modules.cp</h1> <p>Minion side functions for salt-cp</p> <dl class="py function"> <h3 id="salt.modules.cp.cache_dest"> salt.modules.cp.cache_dest(url, saltenv='base')</h3> <dd>
<div class="versionadded"> <p><span class="versionmodified added">New in version 3000.</span></p> </div> <p>Returns the expected cache path for the file, if cached using <a class="reference internal" href="#salt.modules.cp.cache_file" title="salt.modules.cp.cache_file"><code class="xref py py-func docutils literal notranslate"><span class="pre">cp.cache_file</span></code></a>.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This only returns the _expected_ path, it does not tell you if the URL is really cached. To check if the URL is cached, use <a class="reference internal" href="#salt.modules.cp.is_cached" title="salt.modules.cp.is_cached"><code class="xref py py-func docutils literal notranslate"><span class="pre">cp.is_cached</span></code></a> instead.</p> </div> <p>CLI Examples:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cp.cache_dest https://foo.com/bar.rpm
salt '*' cp.cache_dest salt://my/file
salt '*' cp.cache_dest salt://my/file saltenv=dev</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.cp.cache_dir"> salt.modules.cp.cache_dir(path, saltenv='base', include_empty=False, include_pat=None, exclude_pat=None)</h3> <dd>
<p>Download and cache everything under a directory from the master</p> <dl> <dt>include_pat<span class="classifier">None</span>
</dt>
<dd>
<p>Glob or regex to narrow down the files cached from the given path. If matching with a regex, the regex must be prefixed with <code class="docutils literal notranslate"><span class="pre">E@</span></code>, otherwise the expression will be interpreted as a glob.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2014.7.0.</span></p> </div> </dd> <dt>exclude_pat<span class="classifier">None</span>
</dt>
<dd>
<p>Glob or regex to exclude certain files from being cached from the given path. If matching with a regex, the regex must be prefixed with <code class="docutils literal notranslate"><span class="pre">E@</span></code>, otherwise the expression will be interpreted as a glob.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>If used with <code class="docutils literal notranslate"><span class="pre">include_pat</span></code>, files matching this pattern will be excluded from the subset of files defined by <code class="docutils literal notranslate"><span class="pre">include_pat</span></code>.</p> </div> <div class="versionadded"> <p><span class="versionmodified added">New in version 2014.7.0.</span></p> </div> </dd> </dl> <p>CLI Examples:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cp.cache_dir salt://path/to/dir
salt '*' cp.cache_dir salt://path/to/dir include_pat='E@*.py$'</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.cp.cache_file"> salt.modules.cp.cache_file(path, saltenv='base', source_hash=None, verify_ssl=True)</h3> <dd>
<p>Used to cache a single file on the Minion</p> <p>Returns the location of the new cached file on the Minion</p> <dl> <dt>source_hash</dt>
<dd>
<p>If <code class="docutils literal notranslate"><span class="pre">name</span></code> is an http(s) or ftp URL and the file exists in the minion's file cache, this option can be passed to keep the minion from re-downloading the file if the cached copy matches the specified hash.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2018.3.0.</span></p> </div> </dd> <dt>verify_ssl</dt>
<dd>
<p>If <code class="docutils literal notranslate"><span class="pre">False</span></code>, remote https file sources (<code class="docutils literal notranslate"><span class="pre">https://</span></code>) and source_hash will not attempt to validate the servers certificate. Default is True.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 3002.</span></p> </div> </dd> </dl> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cp.cache_file salt://path/to/file</pre> <p>There are two ways of defining the fileserver environment (a.k.a. <code class="docutils literal notranslate"><span class="pre">saltenv</span></code>) from which to cache the file. One is to use the <code class="docutils literal notranslate"><span class="pre">saltenv</span></code> parameter, and the other is to use a querystring syntax in the <code class="docutils literal notranslate"><span class="pre">salt://</span></code> URL. The below two examples are equivalent:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cp.cache_file salt://foo/bar.conf saltenv=config
salt '*' cp.cache_file salt://foo/bar.conf?saltenv=config</pre> <p>If the path being cached is a <code class="docutils literal notranslate"><span class="pre">salt://</span></code> URI, and the path does not exist, then <code class="docutils literal notranslate"><span class="pre">False</span></code> will be returned.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>It may be necessary to quote the URL when using the querystring method, depending on the shell being used to run the command.</p> </div> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.cp.cache_files"> salt.modules.cp.cache_files(paths, saltenv='base')</h3> <dd>
<p>Used to gather many files from the Master, the gathered files will be saved in the minion cachedir reflective to the paths retrieved from the Master</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cp.cache_files salt://pathto/file1,salt://pathto/file1</pre> <p>There are two ways of defining the fileserver environment (a.k.a. <code class="docutils literal notranslate"><span class="pre">saltenv</span></code>) from which to cache the files. One is to use the <code class="docutils literal notranslate"><span class="pre">saltenv</span></code> parameter, and the other is to use a querystring syntax in the <code class="docutils literal notranslate"><span class="pre">salt://</span></code> URL. The below two examples are equivalent:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cp.cache_files salt://foo/bar.conf,salt://foo/baz.conf saltenv=config
salt '*' cp.cache_files salt://foo/bar.conf?saltenv=config,salt://foo/baz.conf?saltenv=config</pre> <p>The querystring method is less useful when all files are being cached from the same environment, but is a good way of caching files from multiple different environments in the same command. For example, the below command will cache the first file from the <code class="docutils literal notranslate"><span class="pre">config1</span></code> environment, and the second one from the <code class="docutils literal notranslate"><span class="pre">config2</span></code> environment.</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cp.cache_files salt://foo/bar.conf?saltenv=config1,salt://foo/bar.conf?saltenv=config2</pre> <div class="admonition note"> <p class="admonition-title">Note</p> <p>It may be necessary to quote the URL when using the querystring method, depending on the shell being used to run the command.</p> </div> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.cp.cache_local_file"> salt.modules.cp.cache_local_file(path)</h3> <dd>
<p>Cache a local file on the minion in the localfiles cache</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cp.cache_local_file /etc/hosts</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.cp.cache_master"> salt.modules.cp.cache_master(saltenv='base')</h3> <dd>
<p>Retrieve all of the files on the master and cache them locally</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cp.cache_master</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.cp.envs"> salt.modules.cp.envs()</h3> <dd>
<p>List available environments for fileserver</p> <p>CLI Example</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cp.envs</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.cp.get_dir"> salt.modules.cp.get_dir(path, dest, saltenv='base', template=None, gzip=None, **kwargs)</h3> <dd>
<p>Used to recursively copy a directory from the salt master</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cp.get_dir salt://path/to/dir/ /minion/dest</pre> <p>get_dir supports the same template and gzip arguments as get_file.</p> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.cp.get_file"> salt.modules.cp.get_file(path, dest, saltenv='base', makedirs=False, template=None, gzip=None, **kwargs)</h3> <dd>
<div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 2018.3.0: </span><code class="docutils literal notranslate"><span class="pre">dest</span></code> can now be a directory</p> </div> <p>Used to get a single file from the salt master</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cp.get_file salt://path/to/file /minion/dest</pre> <p>Template rendering can be enabled on both the source and destination file names like so:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cp.get_file "salt://{{grains.os}}/vimrc" /etc/vimrc template=jinja</pre> <p>This example would instruct all Salt minions to download the vimrc from a directory with the same name as their os grain and copy it to /etc/vimrc</p> <p>For larger files, the cp.get_file module also supports gzip compression. Because gzip is CPU-intensive, this should only be used in scenarios where the compression ratio is very high (e.g. pretty-printed JSON or YAML files).</p> <p>Use the <em>gzip</em> named argument to enable it. Valid values are 1..9, where 1 is the lightest compression and 9 the heaviest. 1 uses the least CPU on the master (and minion), 9 uses the most.</p> <p>There are two ways of defining the fileserver environment (a.k.a. <code class="docutils literal notranslate"><span class="pre">saltenv</span></code>) from which to retrieve the file. One is to use the <code class="docutils literal notranslate"><span class="pre">saltenv</span></code> parameter, and the other is to use a querystring syntax in the <code class="docutils literal notranslate"><span class="pre">salt://</span></code> URL. The below two examples are equivalent:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cp.get_file salt://foo/bar.conf /etc/foo/bar.conf saltenv=config
salt '*' cp.get_file salt://foo/bar.conf?saltenv=config /etc/foo/bar.conf</pre> <div class="admonition note"> <p class="admonition-title">Note</p> <p>It may be necessary to quote the URL when using the querystring method, depending on the shell being used to run the command.</p> </div> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.cp.get_file_str"> salt.modules.cp.get_file_str(path, saltenv='base')</h3> <dd>
<p>Download a file from a URL to the Minion cache directory and return the contents of that file</p> <p>Returns <code class="docutils literal notranslate"><span class="pre">False</span></code> if Salt was unable to cache a file from a URL.</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cp.get_file_str salt://my/file</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.cp.get_template"> salt.modules.cp.get_template(path, dest, template='jinja', saltenv='base', makedirs=False, **kwargs)</h3> <dd>
<p>Render a file as a template before setting it down. Warning, order is not the same as in fileclient.cp for non breaking old API.</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cp.get_template salt://path/to/template /minion/dest</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.cp.get_url"> salt.modules.cp.get_url(path, dest='', saltenv='base', makedirs=False, source_hash=None)</h3> <dd>
<div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 2018.3.0: </span><code class="docutils literal notranslate"><span class="pre">dest</span></code> can now be a directory</p> </div> <p>Used to get a single file from a URL.</p> <dl> <dt>path</dt>
<dd>
<p>A URL to download a file from. Supported URL schemes are: <code class="docutils literal notranslate"><span class="pre">salt://</span></code>, <code class="docutils literal notranslate"><span class="pre">http://</span></code>, <code class="docutils literal notranslate"><span class="pre">https://</span></code>, <code class="docutils literal notranslate"><span class="pre">ftp://</span></code>, <code class="docutils literal notranslate"><span class="pre">s3://</span></code>, <code class="docutils literal notranslate"><span class="pre">swift://</span></code> and <code class="docutils literal notranslate"><span class="pre">file://</span></code> (local filesystem). If no scheme was specified, this is equivalent of using <code class="docutils literal notranslate"><span class="pre">file://</span></code>. If a <code class="docutils literal notranslate"><span class="pre">file://</span></code> URL is given, the function just returns absolute path to that file on a local filesystem. The function returns <code class="docutils literal notranslate"><span class="pre">False</span></code> if Salt was unable to fetch a file from a <code class="docutils literal notranslate"><span class="pre">salt://</span></code> URL.</p> </dd> <dt>dest</dt>
<dd>
<p>The default behaviour is to write the fetched file to the given destination path. If this parameter is omitted or set as empty string (<code class="docutils literal notranslate"><span class="pre">''</span></code>), the function places the remote file on the local filesystem inside the Minion cache directory and returns the path to that file.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>To simply return the file contents instead, set destination to <code class="docutils literal notranslate"><span class="pre">None</span></code>. This works with <code class="docutils literal notranslate"><span class="pre">salt://</span></code>, <code class="docutils literal notranslate"><span class="pre">http://</span></code>, <code class="docutils literal notranslate"><span class="pre">https://</span></code> and <code class="docutils literal notranslate"><span class="pre">file://</span></code> URLs. The files fetched by <code class="docutils literal notranslate"><span class="pre">http://</span></code> and <code class="docutils literal notranslate"><span class="pre">https://</span></code> will not be cached.</p> </div> </dd> <dt>saltenv<span class="classifier">base</span>
</dt>
<dd>
<p>Salt fileserver environment from which to retrieve the file. Ignored if <code class="docutils literal notranslate"><span class="pre">path</span></code> is not a <code class="docutils literal notranslate"><span class="pre">salt://</span></code> URL.</p> </dd> <dt>source_hash</dt>
<dd>
<p>If <code class="docutils literal notranslate"><span class="pre">path</span></code> is an http(s) or ftp URL and the file exists in the minion's file cache, this option can be passed to keep the minion from re-downloading the file if the cached copy matches the specified hash.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2018.3.0.</span></p> </div> </dd> </dl> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cp.get_url salt://my/file /tmp/this_file_is_mine
salt '*' cp.get_url http://www.slashdot.org /tmp/index.html</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.cp.hash_file"> salt.modules.cp.hash_file(path, saltenv='base')</h3> <dd>
<p>Return the hash of a file, to get the hash of a file on the salt master file server prepend the path with salt://&lt;file on server&gt; otherwise, prepend the file with / for a local file.</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cp.hash_file salt://path/to/file</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.cp.is_cached"> salt.modules.cp.is_cached(path, saltenv='base')</h3> <dd>
<p>Returns the full path to a file if it is cached locally on the minion otherwise returns a blank string</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cp.is_cached salt://path/to/file</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.cp.list_master"> salt.modules.cp.list_master(saltenv='base', prefix='')</h3> <dd>
<p>List all of the files stored on the master</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cp.list_master</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.cp.list_master_dirs"> salt.modules.cp.list_master_dirs(saltenv='base', prefix='')</h3> <dd>
<p>List all of the directories stored on the master</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cp.list_master_dirs</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.cp.list_master_symlinks"> salt.modules.cp.list_master_symlinks(saltenv='base', prefix='')</h3> <dd>
<p>List all of the symlinks stored on the master</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cp.list_master_symlinks</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.cp.list_minion"> salt.modules.cp.list_minion(saltenv='base')</h3> <dd>
<p>List all of the files cached on the minion</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cp.list_minion</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.cp.list_states"> salt.modules.cp.list_states(saltenv='base')</h3> <dd>
<p>List all of the available state modules in an environment</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cp.list_states</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.cp.push"> salt.modules.cp.push(path, keep_symlinks=False, upload_path=None, remove_source=False)</h3> <dd>
<p>WARNING Files pushed to the master will have global read permissions..</p> <p>Push a file from the minion up to the master, the file will be saved to the salt master in the master's minion files cachedir (defaults to <code class="docutils literal notranslate"><span class="pre">/var/cache/salt/master/minions/minion-id/files</span></code>)</p> <p>Since this feature allows a minion to push a file up to the master server it is disabled by default for security purposes. To enable, set <code class="docutils literal notranslate"><span class="pre">file_recv</span></code> to <code class="docutils literal notranslate"><span class="pre">True</span></code> in the master configuration file, and restart the master.</p> <dl> <dt>keep_symlinks</dt>
<dd>
<p>Keep the path value without resolving its canonical form</p> </dd> <dt>upload_path</dt>
<dd>
<p>Provide a different path inside the master's minion files cachedir</p> </dd> <dt>remove_source</dt>
<dd>
<p>Remove the source file on the minion</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2016.3.0.</span></p> </div> </dd> </dl> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cp.push /etc/fstab
salt '*' cp.push /etc/system-release keep_symlinks=True
salt '*' cp.push /etc/fstab upload_path='/new/path/fstab'
salt '*' cp.push /tmp/filename remove_source=True</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.cp.push_dir"> salt.modules.cp.push_dir(path, glob=None, upload_path=None)</h3> <dd>
<p>Push a directory from the minion up to the master, the files will be saved to the salt master in the master's minion files cachedir (defaults to <code class="docutils literal notranslate"><span class="pre">/var/cache/salt/master/minions/minion-id/files</span></code>). It also has a glob for matching specific files using globbing.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2014.7.0.</span></p> </div> <p>Since this feature allows a minion to push files up to the master server it is disabled by default for security purposes. To enable, set <code class="docutils literal notranslate"><span class="pre">file_recv</span></code> to <code class="docutils literal notranslate"><span class="pre">True</span></code> in the master configuration file, and restart the master.</p> <dl class="simple"> <dt>upload_path</dt>
<dd>
<p>Provide a different path and directory name inside the master's minion files cachedir</p> </dd> </dl> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cp.push /usr/lib/mysql
salt '*' cp.push /usr/lib/mysql upload_path='/newmysql/path'
salt '*' cp.push_dir /etc/modprobe.d/ glob='*.conf'</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.cp.recv"> salt.modules.cp.recv(files, dest)</h3> <dd>
<p>Used with salt-cp, pass the files dict, and the destination.</p> <p>This function receives small fast copy files from the master via salt-cp. It does not work via the CLI.</p> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.cp.recv_chunked"> salt.modules.cp.recv_chunked(dest, chunk, append=False, compressed=True, mode=None)</h3> <dd>
<p>This function receives files copied to the minion using <code class="docutils literal notranslate"><span class="pre">salt-cp</span></code> and is not intended to be used directly on the CLI.</p> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.cp.stat_file"> salt.modules.cp.stat_file(path, saltenv='base', octal=True)</h3> <dd>
<p>Return the permissions of a file, to get the permissions of a file on the salt master file server prepend the path with salt://&lt;file on server&gt; otherwise, prepend the file with / for a local file.</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' cp.stat_file salt://path/to/file</pre> </dd>
</dl><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2021 SaltStack.<br>Licensed under the Apache License, Version 2.0.<br>
    <a href="https://docs.saltproject.io/en/latest/ref/modules/all/salt.modules.cp.html" class="_attribution-link">https://docs.saltproject.io/en/latest/ref/modules/all/salt.modules.cp.html</a>
  </p>
</div>
