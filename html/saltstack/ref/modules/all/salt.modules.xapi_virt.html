<h1>salt.modules.xapi_virt</h1> <p>This module (mostly) uses the XenAPI to manage Xen virtual machines.</p> <p>Big fat warning: the XenAPI used in this file is the one bundled with Xen Source, NOT XenServer nor Xen Cloud Platform. As a matter of fact it <em>will</em> fail under those platforms. From what I've read, little work is needed to adapt this code to XS/XCP, mostly playing with XenAPI version, but as XCP is not taking precedence on Xen Source on many platforms, please keep compatibility in mind.</p> <p>Useful documentation:</p> <p>. <a class="reference external" href="http://downloads.xen.org/Wiki/XenAPI/xenapi-1.0.6.pdf">http://downloads.xen.org/Wiki/XenAPI/xenapi-1.0.6.pdf</a> . <a class="reference external" href="http://docs.vmd.citrix.com/XenServer/6.0.0/1.0/en_gb/api/">http://docs.vmd.citrix.com/XenServer/6.0.0/1.0/en_gb/api/</a> . <a class="reference external" href="https://github.com/xapi-project/xen-api/tree/master/scripts/examples/python">https://github.com/xapi-project/xen-api/tree/master/scripts/examples/python</a> . <a class="reference external" href="http://xenbits.xen.org/gitweb/?p=xen.git;a=tree;f=tools/python/xen/xm;hb=HEAD">http://xenbits.xen.org/gitweb/?p=xen.git;a=tree;f=tools/python/xen/xm;hb=HEAD</a></p> <dl class="py function"> <h3 id="salt.modules.xapi_virt.freecpu"> salt.modules.xapi_virt.freecpu()</h3> <dd>
<p>Return an int representing the number of unallocated cpus on this hypervisor</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' virt.freecpu</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.xapi_virt.freemem"> salt.modules.xapi_virt.freemem()</h3> <dd>
<p>Return an int representing the amount of memory that has not been given to virtual machines on this node</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' virt.freemem</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.xapi_virt.full_info"> salt.modules.xapi_virt.full_info()</h3> <dd>
<p>Return the node_info, vm_info and freemem</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' virt.full_info</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.xapi_virt.get_disks"> salt.modules.xapi_virt.get_disks(vm_)</h3> <dd>
<p>Return the disks of a named vm</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' virt.get_disks &lt;vm name&gt;</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.xapi_virt.get_macs"> salt.modules.xapi_virt.get_macs(vm_)</h3> <dd>
<p>Return a list off MAC addresses from the named vm</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' virt.get_macs &lt;vm name&gt;</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.xapi_virt.get_nics"> salt.modules.xapi_virt.get_nics(vm_)</h3> <dd>
<p>Return info about the network interfaces of a named vm</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' virt.get_nics &lt;vm name&gt;</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.xapi_virt.is_hyper"> salt.modules.xapi_virt.is_hyper()</h3> <dd>
<p>Returns a bool whether or not this node is a hypervisor of any kind</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' virt.is_hyper</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.xapi_virt.list_domains"> salt.modules.xapi_virt.list_domains()</h3> <dd>
<p>Return a list of virtual machine names on the minion</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' virt.list_domains</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.xapi_virt.migrate"> salt.modules.xapi_virt.migrate(vm_, target, live=1, port=0, node=- 1, ssl=None, change_home_server=0)</h3> <dd>
<p>Migrates the virtual machine to another hypervisor</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' virt.migrate &lt;vm name&gt; &lt;target hypervisor&gt; [live] [port] [node] [ssl] [change_home_server]</pre> <p>Optional values:</p> <dl class="simple"> <dt>live</dt>
<dd>
<p>Use live migration</p> </dd> <dt>port</dt>
<dd>
<p>Use a specified port</p> </dd> <dt>node</dt>
<dd>
<p>Use specified NUMA node on target</p> </dd> <dt>ssl</dt>
<dd>
<p>use ssl connection for migration</p> </dd> <dt>change_home_server</dt>
<dd>
<p>change home server for managed domains</p> </dd> </dl> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.xapi_virt.node_info"> salt.modules.xapi_virt.node_info()</h3> <dd>
<p>Return a dict with information about this node</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' virt.node_info</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.xapi_virt.pause"> salt.modules.xapi_virt.pause(vm_)</h3> <dd>
<p>Pause the named vm</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' virt.pause &lt;vm name&gt;</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.xapi_virt.reboot"> salt.modules.xapi_virt.reboot(vm_)</h3> <dd>
<p>Reboot a domain via ACPI request</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' virt.reboot &lt;vm name&gt;</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.xapi_virt.reset"> salt.modules.xapi_virt.reset(vm_)</h3> <dd>
<p>Reset a VM by emulating the reset button on a physical machine</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' virt.reset &lt;vm name&gt;</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.xapi_virt.resume"> salt.modules.xapi_virt.resume(vm_)</h3> <dd>
<p>Resume the named vm</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' virt.resume &lt;vm name&gt;</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.xapi_virt.setmem"> salt.modules.xapi_virt.setmem(vm_, memory)</h3> <dd>
<p>Changes the amount of memory allocated to VM.</p> <p>Memory is to be specified in MB</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' virt.setmem myvm 768</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.xapi_virt.setvcpus"> salt.modules.xapi_virt.setvcpus(vm_, vcpus)</h3> <dd>
<p>Changes the amount of vcpus allocated to VM.</p> <p>vcpus is an int representing the number to be assigned</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' virt.setvcpus myvm 2</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.xapi_virt.shutdown"> salt.modules.xapi_virt.shutdown(vm_)</h3> <dd>
<p>Send a soft shutdown signal to the named vm</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' virt.shutdown &lt;vm name&gt;</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.xapi_virt.start"> salt.modules.xapi_virt.start(config_)</h3> <dd>
<p>Start a defined domain</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' virt.start &lt;path to Xen cfg file&gt;</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.xapi_virt.stop"> salt.modules.xapi_virt.stop(vm_)</h3> <dd>
<p>Hard power down the virtual machine, this is equivalent to pulling the power</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' virt.stop &lt;vm name&gt;</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.xapi_virt.vcpu_pin"> salt.modules.xapi_virt.vcpu_pin(vm_, vcpu, cpus)</h3> <dd>
<p>Set which CPUs a VCPU can use.</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt 'foo' virt.vcpu_pin domU-id 2 1
salt 'foo' virt.vcpu_pin domU-id 2 2-6</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.xapi_virt.vm_cputime"> salt.modules.xapi_virt.vm_cputime(vm_=None)</h3> <dd>
<p>Return cputime used by the vms on this hyper in a list of dicts:</p> <pre class="highlight-python notranslate" data-language="python">[
    'your-vm': {
        'cputime' &lt;int&gt;
        'cputime_percent' &lt;int&gt;
        },
    ...
    ]</pre> <p>If you pass a VM name in as an argument then it will return info for just the named VM, otherwise it will return all VMs.</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' virt.vm_cputime</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.xapi_virt.vm_diskstats"> salt.modules.xapi_virt.vm_diskstats(vm_=None)</h3> <dd>
<p>Return disk usage counters used by the vms on this hyper in a list of dicts:</p> <pre class="highlight-python notranslate" data-language="python">[
    'your-vm': {
        'io_read_kbs'   : 0,
        'io_write_kbs'  : 0
        },
    ...
    ]</pre> <p>If you pass a VM name in as an argument then it will return info for just the named VM, otherwise it will return all VMs.</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' virt.vm_diskstats</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.xapi_virt.vm_info"> salt.modules.xapi_virt.vm_info(vm_=None)</h3> <dd>
<p>Return detailed information about the vms.</p> <p>If you pass a VM name in as an argument then it will return info for just the named VM, otherwise it will return all VMs.</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' virt.vm_info</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.xapi_virt.vm_netstats"> salt.modules.xapi_virt.vm_netstats(vm_=None)</h3> <dd>
<p>Return combined network counters used by the vms on this hyper in a list of dicts:</p> <pre class="highlight-python notranslate" data-language="python">[
    'your-vm': {
        'io_read_kbs'           : 0,
        'io_total_read_kbs'     : 0,
        'io_total_write_kbs'    : 0,
        'io_write_kbs'          : 0
        },
    ...
    ]</pre> <p>If you pass a VM name in as an argument then it will return info for just the named VM, otherwise it will return all VMs.</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' virt.vm_netstats</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.xapi_virt.vm_state"> salt.modules.xapi_virt.vm_state(vm_=None)</h3> <dd>
<p>Return list of all the vms and their state.</p> <p>If you pass a VM name in as an argument then it will return info for just the named VM, otherwise it will return all VMs.</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' virt.vm_state &lt;vm name&gt;</pre> </dd>
</dl><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2021 SaltStack.<br>Licensed under the Apache License, Version 2.0.<br>
    <a href="https://docs.saltproject.io/en/latest/ref/modules/all/salt.modules.xapi_virt.html" class="_attribution-link">https://docs.saltproject.io/en/latest/ref/modules/all/salt.modules.xapi_virt.html</a>
  </p>
</div>
