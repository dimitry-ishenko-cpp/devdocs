<h1>salt.modules.win_lgpo</h1> <p>Manage Local Policy on Windows</p> <p>This module allows configuring local group policy (i.e. <code class="docutils literal notranslate"><span class="pre">gpedit.msc</span></code>) on a Windows server.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2016.11.0.</span></p> </div> <div class="section" id="administrative-templates"> <h2>Administrative Templates</h2> <p>Administrative template policies are dynamically read from ADMX/ADML files on the server.</p> </div> <div class="section" id="windows-settings"> <h2>Windows Settings</h2> <p>Policies contained in the "Windows Settings" section of the <code class="docutils literal notranslate"><span class="pre">gpedit.msc</span></code> GUI are statically defined in this module. Each policy is configured for the section (Machine/User) in the module's _policy_info class. The <code class="docutils literal notranslate"><span class="pre">_policy_info</span></code> class contains a "policies" dict on how the module will configure the policy, where the policy resides in the GUI (for display purposes), data validation data, data transformation data, etc.</p> </div> <div class="section" id="current-known-limitations"> <h2>Current known limitations</h2> <ul class="simple"> <li><p>At this time, start/shutdown scripts policies are displayed, but are not configurable.</p></li> <li><p>Not all "Security Settings" policies exist in the _policy_info class</p></li> </ul> <dl class="field-list simple"> <dt class="field-odd">depends</dt> <dd class="field-odd">
<ul class="simple"> <li><p>pywin32 Python module</p></li> <li><p>lxml</p></li> <li><p>uuid</p></li> <li><p>struct</p></li> <li><p>salt.utils.win_reg</p></li> </ul> </dd> </dl> <dl class="py function"> <h3 id="salt.modules.win_lgpo.get"> salt.modules.win_lgpo.get(policy_class=None, return_full_policy_names=True, hierarchical_return=False, adml_language='en-US', return_not_configured=False)</h3> <dd>
<p>Get a policy value</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li><p><strong>policy_class</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- Some policies are both user and computer, by default all policies will be pulled, but this can be used to retrieve only a specific policy class User/USER/user = retrieve user policies Machine/MACHINE/machine/Computer/COMPUTER/computer = retrieve machine/computer policies</p></li> <li><p><strong>return_full_policy_names</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- True/False to return the policy name as it is seen in the <code class="docutils literal notranslate"><span class="pre">gpedit.msc</span></code> GUI or to only return the policy key/id.</p></li> <li><p><strong>hierarchical_return</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- True/False to return the policy data in the hierarchy as seen in the <code class="docutils literal notranslate"><span class="pre">gpedit.msc</span></code> GUI. The default of False will return data split only into User/Computer configuration sections</p></li> <li><p><strong>adml_language</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The ADML language to use for processing display/descriptive names and enumeration values of ADMX template data, defaults to en-US</p></li> <li><p><strong>return_not_configured</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- Include Administrative Template policies that are 'Not Configured' in the return data</p></li> </ul> </dd> <dt class="field-even">Returns</dt> <dd class="field-even">
<p>A dictionary containing the policy values for the specified class</p> </dd> <dt class="field-odd">Return type</dt> <dd class="field-odd">
<p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)">dict</a></p> </dd> </dl> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' lgpo.get machine return_full_policy_names=True</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.win_lgpo.get_policy"> salt.modules.win_lgpo.get_policy(policy_name, policy_class, adml_language='en-US', return_value_only=True, return_full_policy_names=True, hierarchical_return=False)</h3> <dd>
<p>Get the current settings for a single policy on the machine</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li><p><strong>policy_name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The name of the policy to retrieve. Can be the any of the names or alieses returned by <code class="docutils literal notranslate"><span class="pre">lgpo.get_policy_info</span></code></p></li> <li><p><strong>policy_class</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The policy class. Must be one of <code class="docutils literal notranslate"><span class="pre">machine</span></code> or <code class="docutils literal notranslate"><span class="pre">user</span></code></p></li> <li><p><strong>adml_language</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The language code for the adml file to use for localization. The default is <code class="docutils literal notranslate"><span class="pre">en-US</span></code></p></li> <li><p><strong>return_value_only</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- <code class="docutils literal notranslate"><span class="pre">True</span></code> will return only the value for the policy, without the name of the policy. <code class="docutils literal notranslate"><span class="pre">return_full_policy_names</span></code> and <code class="docutils literal notranslate"><span class="pre">hierarchical_return</span></code> will be ignored. Default is <code class="docutils literal notranslate"><span class="pre">True</span></code></p></li> <li>
<p><strong>return_full_policy_names</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- </p>
<p>Returns the full policy name regardless of what was passed in <code class="docutils literal notranslate"><span class="pre">policy_name</span></code></p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This setting applies to sub-elements of the policy if they exist. The value passed in <code class="docutils literal notranslate"><span class="pre">policy_name</span></code> will always be used as the policy name when this setting is <code class="docutils literal notranslate"><span class="pre">False</span></code></p> </div> </li> <li><p><strong>hierarchical_return</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- Returns a hierarchical view of the policy showing its parents</p></li> </ul> </dd> <dt class="field-even">Returns</dt> <dd class="field-even">
<p>A dictionary containing the policy settings</p> </dd> <dt class="field-odd">Return type</dt> <dd class="field-odd">
<p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)">dict</a></p> </dd> </dl> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash"># Using the policy id
salt * lgpo.get_policy LockoutDuration machine
salt * lgpo.get_policy AutoUpdateCfg machine

# Using the full name
salt * lgpo.get_policy "Account lockout duration" machine
salt * lgpo.get_policy "Configure Automatic Updates" machine

# Using full path and name
salt * lgpo.get_policy "Windows Components\Windows Update\Configure Automatic Updates" machine</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.win_lgpo.get_policy_info"> salt.modules.win_lgpo.get_policy_info(policy_name, policy_class, adml_language='en-US')</h3> <dd>
<p>Returns information about a specified policy</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li><p><strong>policy_name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The name of the policy to lookup</p></li> <li><p><strong>policy_class</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The class of policy, i.e. machine, user, both</p></li> <li><p><strong>adml_language</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The ADML language to use for Administrative Template data lookup</p></li> </ul> </dd> <dt class="field-even">Returns</dt> <dd class="field-even">
<p>Information about the specified policy</p> </dd> <dt class="field-odd">Return type</dt> <dd class="field-odd">
<p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)">dict</a></p> </dd> </dl> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' lgpo.get_policy_info 'Maximum password age' machine</pre> <p>You can use <code class="docutils literal notranslate"><span class="pre">lgpo.get_policy_info</span></code> to get all the possible names that could be used in a state file or from the command line (along with elements that need to be set/etc). The key is to match the text you see in the <code class="docutils literal notranslate"><span class="pre">gpedit.msc</span></code> gui exactly, including quotes around words or phrases. The "full path" style is really only needed when there are multiple policies that use the same base name. For example, <code class="docutils literal notranslate"><span class="pre">Access</span> <span class="pre">data</span> <span class="pre">sources</span> <span class="pre">across</span>
<span class="pre">domains</span></code> exists in ~10 different paths. If you put that through <code class="docutils literal notranslate"><span class="pre">get_policy_info</span></code> you'll get back a message that it is used for multiple policies and you need to be more specific.</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt-call --local lgpo.get_policy_info ShellRemoveOrderPrints_2 machine

local:
    ----------
    message:
    policy_aliases:
        - Turn off the "Order Prints" picture task
        - ShellRemoveOrderPrints_2
        - System\Internet Communication Management\Internet Communication settings\Turn off the "Order Prints" picture task
    policy_class:
        machine
    policy_elements:
    policy_found:
        True
    policy_name:
        ShellRemoveOrderPrints_2
    rights_assignment:
        False</pre> <p>Escaping can get tricky in cmd/Powershell. The following is an example of escaping in Powershell using backquotes:</p> <pre class="highlight-bash notranslate" data-language="bash">PS&gt;salt-call --local lgpo.get_policy_info "Turn off the `\`"Order Prints`\`" picture task" machine

local:
    ----------
    message:
    policy_aliases:
        - Turn off the "Order Prints" picture task
        - ShellRemoveOrderPrints_2
        - System\Internet Communication Management\Internet Communication settings\Turn off the "Order Prints" picture task
    policy_class:
        machine
    policy_elements:
    policy_found:
        True
    policy_name:
        Turn off the "Order Prints" picture task
    rights_assignment:
        False</pre> <p>This function can then be used to get the options available for specifying Group Policy Objects to be used in state files. Based on the above any of these <em>should</em> be usable:</p> <pre class="highlight-bash notranslate" data-language="bash">internet_communications_settings:
  lgpo.set:
    - computer_policy:
        Turn off the "Order Prints" picture task: Enabled</pre> <pre class="highlight-bash notranslate" data-language="bash">internet_communications_settings:
  lgpo.set:
    - computer_policy:
        ShellRemoveOrderPrints_2: Enabled</pre> <p>When using the full path, it might be a good idea to use single quotes around the path:</p> <pre class="highlight-bash notranslate" data-language="bash">internet_communications_settings:
  lgpo.set:
    - computer_policy:
        'System\Internet Communication Management\Internet Communication settings\Turn off the "Order Prints" picture task': 'Enabled'</pre> <p>If you struggle to find the policy from <code class="docutils literal notranslate"><span class="pre">get_policy_info</span></code> using the name as you see in <code class="docutils literal notranslate"><span class="pre">gpedit.msc</span></code>, the names such as "ShellRemoveOrderPrints_2" come from the <code class="docutils literal notranslate"><span class="pre">.admx</span></code> files. If you know nothing about <code class="docutils literal notranslate"><span class="pre">.admx/.adml</span></code> relationships (ADML holds what you see in the GUI, ADMX holds the more technical details), then this may be a little bit too much info, but here is an example with the above policy using Powershell:</p> <pre class="highlight-bash notranslate" data-language="bash">PS&gt;Get-ChildItem -Path C:\Windows\PolicyDefinitions -Recurse -Filter *.adml | Select-String "Order Prints"

C:\windows\PolicyDefinitions\en-US\ICM.adml:152:      &lt;string id="ShellRemoveOrderPrints"&gt;Turn off the "Order Prints" picture task&lt;/string&gt;
C:\windows\PolicyDefinitions\en-US\ICM.adml:153:      &lt;string id="ShellRemoveOrderPrints_Help"&gt;This policy setting specifies whether the "Order Prints Online" task is available from Picture Tasks in Windows folders.
C:\windows\PolicyDefinitions\en-US\ICM.adml:155:The Order Prints Online Wizard is used to download a list of providers and allow users to order prints online.
C:\windows\PolicyDefinitions\en-US\ICM.adml:157:If you enable this policy setting, the task "Order Prints Online" is removed from Picture Tasks in File Explorer folders.</pre> <p>From this grep, we can see id "ShellRemoveOrderPrints" is the ID of the string used to describe this policy, then we search for it in the ADMX:</p> <pre class="highlight-bash notranslate" data-language="bash">PS&gt;Get-ChildItem -Path C:\Windows\PolicyDefinitions -Recurse -Filter *.admx | Select-String "ShellRemoveOrderPrints"

C:\windows\PolicyDefinitions\ICM.admx:661:    &lt;policy name="ShellRemoveOrderPrints_1" class="User" displayName="$(string.ShellRemoveOrderPrints)" explainText="$(string.ShellRemoveOrderPrints_Help)" key="Software\Microsoft\Windows\CurrentVersion\Policies\Explorer" valueName="NoOnlinePrintsWizard"&gt;
C:\windows\PolicyDefinitions\ICM.admx:671:    &lt;policy name="ShellRemoveOrderPrints_2" class="Machine" displayName="$(string.ShellRemoveOrderPrints)" explainText="$(string.ShellRemoveOrderPrints_Help)" key="Software\Microsoft\Windows\CurrentVersion\Policies\Explorer" valueName="NoOnlinePrintsWizard"&gt;</pre> <p>Now we have two to pick from. And if you notice the <code class="docutils literal notranslate"><span class="pre">class="Machine"</span></code> and <code class="docutils literal notranslate"><span class="pre">class="User"</span></code> (which details if it is a computer policy or user policy respectively) the <code class="docutils literal notranslate"><span class="pre">ShellRemoveOrderPrints_2</span></code> is the "short name" we could use to pass through <code class="docutils literal notranslate"><span class="pre">get_policy_info</span></code> to see what the module itself is expecting.</p> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.win_lgpo.set_"> salt.modules.win_lgpo.set_(computer_policy=None, user_policy=None, cumulative_rights_assignments=True, adml_language='en-US')</h3> <dd>
<p>Set a local server policy.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li>
<p><strong>computer_policy</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><em>dict</em></a>) -- </p>
<p>A dictionary of "policyname: value" pairs of computer policies to set. 'value' should be how it is displayed in the gpedit GUI, i.e. if a setting can be 'Enabled'/'Disabled', then that should be passed</p> <p>Administrative Template data may require dicts within dicts, to specify each element of the Administrative Template policy. Administrative Templates policies are always cumulative.</p> <p>Policy names can be specified in a number of ways based on the type of policy:</p> <blockquote> <div>
<p>Windows Settings Policies:</p> <blockquote> <div>
<p>These policies can be specified using the GUI display name or the key name from the _policy_info class in this module. The GUI display name is also contained in the _policy_info class in this module.</p> </div>
</blockquote> <p>Administrative Template Policies:</p> <blockquote> <div>
<p>These can be specified using the policy name as displayed in the GUI (case sensitive). Some policies have the same name, but a different location (for example, "Access data sources across domains"). These can be differentiated by the "path" in the GUI (for example, "Windows ComponentsInternet ExplorerInternet Control PanelSecurity PageInternet ZoneAccess data sources across domains").</p> <p>Additionally, policies can be specified using the "name" and "id" attributes from the ADMX files.</p> <p>For Administrative Templates that have policy elements, each element can be specified using the text string as seen in the GUI or using the ID attribute from the ADMX file. Due to the way some of the GUI text is laid out, some policy element names could include descriptive text that appears lbefore the policy element in the GUI.</p> <p>Use the get_policy_info function for the policy name to view the element ID/names that the module will accept.</p> </div>
</blockquote> </div>
</blockquote> </li> <li><p><strong>user_policy</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><em>dict</em></a>) -- The same setup as the computer_policy, except with data to configure the local user policy.</p></li> <li>
<p><strong>cumulative_rights_assignments</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- </p>
<p>Determine how user rights assignment policies are configured.</p> <p>If True, user right assignment specifications are simply added to the existing policy</p> <p>If False, only the users specified will get the right (any existing will have the right revoked)</p> </li> <li><p><strong>adml_language</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The language files to use for looking up Administrative Template policy data (i.e. how the policy is displayed in the GUI). Defaults to 'en-US' (U.S. English).</p></li> </ul> </dd> <dt class="field-even">Returns</dt> <dd class="field-even">
<p>True is successful, otherwise False</p> </dd> <dt class="field-odd">Return type</dt> <dd class="field-odd">
<p><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)">bool</a></p> </dd> </dl> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' lgpo.set computer_policy="{'LockoutDuration': 2, 'RestrictAnonymous': 'Enabled', 'AuditProcessTracking': 'Succes, Failure'}"</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.win_lgpo.set_computer_policy"> salt.modules.win_lgpo.set_computer_policy(name, setting, cumulative_rights_assignments=True, adml_language='en-US')</h3> <dd>
<p>Set a single computer policy</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li><p><strong>name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The name of the policy to configure</p></li> <li><p><strong>setting</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The setting to configure the named policy with</p></li> <li><p><strong>cumulative_rights_assignments</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- Determine how user rights assignment policies are configured. If True, user right assignment specifications are simply added to the existing policy. If False, only the users specified will get the right (any existing will have the right revoked)</p></li> <li><p><strong>adml_language</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The language files to use for looking up Administrative Template policy data (i.e. how the policy is displayed in the GUI). Defaults to 'en-US' (U.S. English).</p></li> </ul> </dd> <dt class="field-even">Returns</dt> <dd class="field-even">
<p>True if successful, otherwise False</p> </dd> <dt class="field-odd">Return type</dt> <dd class="field-odd">
<p><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)">bool</a></p> </dd> </dl> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' lgpo.set_computer_policy LockoutDuration 1440</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.win_lgpo.set_user_policy"> salt.modules.win_lgpo.set_user_policy(name, setting, adml_language='en-US')</h3> <dd>
<p>Set a single user policy</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li><p><strong>name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The name of the policy to configure</p></li> <li><p><strong>setting</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The setting to configure the named policy with</p></li> <li><p><strong>adml_language</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The language files to use for looking up Administrative Template policy data (i.e. how the policy is displayed in the GUI). Defaults to 'en-US' (U.S. English).</p></li> </ul> </dd> <dt class="field-even">Returns</dt> <dd class="field-even">
<p>True if successful, Otherwise False</p> </dd> <dt class="field-odd">Return type</dt> <dd class="field-odd">
<p><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)">bool</a></p> </dd> </dl> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' lgpo.set_user_policy "Control Panel\Display\Disable the Display Control Panel" Enabled</pre> </dd>
</dl> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2021 SaltStack.<br>Licensed under the Apache License, Version 2.0.<br>
    <a href="https://docs.saltproject.io/en/latest/ref/modules/all/salt.modules.win_lgpo.html" class="_attribution-link">https://docs.saltproject.io/en/latest/ref/modules/all/salt.modules.win_lgpo.html</a>
  </p>
</div>
