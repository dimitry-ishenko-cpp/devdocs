<h1>salt.modules.slsutil</h1> <p>Utility functions for use with or in SLS files</p> <dl class="py function"> <h3 id="salt.modules.slsutil.banner"> salt.modules.slsutil.banner(width=72, commentchar='#', borderchar='#', blockstart=None, blockend=None, title=None, text=None, newline=False)</h3> <dd>
<p>Create a standardized comment block to include in a templated file.</p> <p>A common technique in configuration management is to include a comment block in managed files, warning users not to modify the file. This function simplifies and standardizes those comment blocks.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li><p><strong>width</strong> -- The width, in characters, of the banner. Default is 72.</p></li> <li><p><strong>commentchar</strong> -- The character to be used in the starting position of each line. This value should be set to a valid line comment character for the syntax of the file in which the banner is being inserted. Multiple character sequences, like '//' are supported. If the file's syntax does not support line comments (such as XML), use the <code class="docutils literal notranslate"><span class="pre">blockstart</span></code> and <code class="docutils literal notranslate"><span class="pre">blockend</span></code> options.</p></li> <li><p><strong>borderchar</strong> -- The character to use in the top and bottom border of the comment box. Must be a single character.</p></li> <li><p><strong>blockstart</strong> -- The character sequence to use at the beginning of a block comment. Should be used in conjunction with <code class="docutils literal notranslate"><span class="pre">blockend</span></code></p></li> <li><p><strong>blockend</strong> -- The character sequence to use at the end of a block comment. Should be used in conjunction with <code class="docutils literal notranslate"><span class="pre">blockstart</span></code></p></li> <li><p><strong>title</strong> -- The first field of the comment block. This field appears centered at the top of the box.</p></li> <li><p><strong>text</strong> -- The second filed of the comment block. This field appears left-justifed at the bottom of the box.</p></li> <li><p><strong>newline</strong> -- Boolean value to indicate whether the comment block should end with a newline. Default is <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p></li> </ul> </dd> </dl> <p><strong>Example 1 - the default banner:</strong></p> <pre class="highlight-jinja notranslate" data-language="jinja">{{ salt['slsutil.banner']() }}</pre> <pre class="highlight-none notranslate" data-language="none">########################################################################
#                                                                      #
#              THIS FILE IS MANAGED BY SALT - DO NOT EDIT              #
#                                                                      #
# The contents of this file are managed by Salt. Any changes to this   #
# file may be overwritten automatically and without warning.           #
########################################################################</pre> <p><strong>Example 2 - a Javadoc-style banner:</strong></p> <pre class="highlight-jinja notranslate" data-language="jinja">{{ salt['slsutil.banner'](commentchar=' *', borderchar='*', blockstart='/**', blockend=' */') }}</pre> <pre class="highlight-none notranslate" data-language="none">/**
 ***********************************************************************
 *                                                                     *
 *              THIS FILE IS MANAGED BY SALT - DO NOT EDIT             *
 *                                                                     *
 * The contents of this file are managed by Salt. Any changes to this  *
 * file may be overwritten automatically and without warning.          *
 ***********************************************************************
 */</pre> <p><strong>Example 3 - custom text:</strong></p> <pre class="highlight-jinja notranslate" data-language="jinja">{{ set copyright='This file may not be copied or distributed without permission of SaltStack, Inc.' }}
{{ salt['slsutil.banner'](title='Copyright 2019 SaltStack, Inc.', text=copyright, width=60) }}</pre> <pre class="highlight-none notranslate" data-language="none">############################################################
#                                                          #
#              Copyright 2019 SaltStack, Inc.              #
#                                                          #
# This file may not be copied or distributed without       #
# permission of SaltStack, Inc.                            #
############################################################</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.slsutil.boolstr"> salt.modules.slsutil.boolstr(value, true='true', false='false')</h3> <dd>
<p>Convert a boolean value into a string. This function is intended to be used from within file templates to provide an easy way to take boolean values stored in Pillars or Grains, and write them out in the apprpriate syntax for a particular file template.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li><p><strong>value</strong> -- The boolean value to be converted</p></li> <li><p><strong>true</strong> -- The value to return if <code class="docutils literal notranslate"><span class="pre">value</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code></p></li> <li><p><strong>false</strong> -- The value to return if <code class="docutils literal notranslate"><span class="pre">value</span></code> is <code class="docutils literal notranslate"><span class="pre">False</span></code></p></li> </ul> </dd> </dl> <p>In this example, a pillar named <code class="docutils literal notranslate"><span class="pre">smtp:encrypted</span></code> stores a boolean value, but the template that uses that value needs <code class="docutils literal notranslate"><span class="pre">yes</span></code> or <code class="docutils literal notranslate"><span class="pre">no</span></code> to be written, based on the boolean value.</p> <p><em>Note: this is written on two lines for clarity. The same result could be achieved in one line.</em></p> <pre class="highlight-jinja notranslate" data-language="jinja">{% set encrypted = salt[pillar.get]('smtp:encrypted', false) %}
use_tls: {{ salt['slsutil.boolstr'](encrypted, 'yes', 'no') }}</pre> <p>Result (assuming the value is <code class="docutils literal notranslate"><span class="pre">True</span></code>):</p> <pre class="highlight-none notranslate" data-language="none">use_tls: yes</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.slsutil.deserialize"> salt.modules.slsutil.deserialize(serializer, stream_or_string, **mod_kwargs)</h3> <dd>
<p>Deserialize a Python object using one of the available <a class="reference internal" href="../../serializers/all/index.html#all-salt-serializers"><span class="std std-ref">serializer modules</span></a>.</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' slsutil.deserialize 'json' '{"foo": "Foo!"}'
salt '*' --no-parse=stream_or_string slsutil.deserialize 'json' \
    stream_or_string='{"foo": "Foo!"}'</pre> <p>Jinja Example:</p> <pre class="highlight-jinja notranslate" data-language="jinja">{% set python_object = salt.slsutil.deserialize('json',
    '{"foo": "Foo!"}') %}</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.slsutil.merge"> salt.modules.slsutil.merge(obj_a, obj_b, strategy='smart', renderer='yaml', merge_lists=False)</h3> <dd>
<p>Merge a data structure into another by choosing a merge strategy</p> <p>Strategies:</p> <ul class="simple"> <li><p>aggregate</p></li> <li><p>list</p></li> <li><p>overwrite</p></li> <li><p>recurse</p></li> <li><p>smart</p></li> </ul> <p>CLI Example:</p> <pre class="highlight-shell notranslate" data-language="shell">salt '*' slsutil.merge '{foo: Foo}' '{bar: Bar}'</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.slsutil.merge_all"> salt.modules.slsutil.merge_all(lst, strategy='smart', renderer='yaml', merge_lists=False)</h3> <dd>
<div class="versionadded"> <p><span class="versionmodified added">New in version 2019.2.0.</span></p> </div> <p>Merge a list of objects into each other in order</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li><p><strong>lst</strong> (<em>Iterable</em>) -- List of objects to be merged.</p></li> <li><p><strong>strategy</strong> (<em>String</em>) -- Merge strategy. See utils.dictupdate.</p></li> <li><p><strong>renderer</strong> (<em>String</em>) -- Renderer type. Used to determine strategy when strategy is 'smart'.</p></li> <li><p><strong>merge_lists</strong> (<em>Bool</em>) -- Defines whether to merge embedded object lists.</p></li> </ul> </dd> </dl> <p>CLI Example:</p> <pre class="highlight-shell notranslate" data-language="shell">$ salt-call --output=txt slsutil.merge_all '[{foo: Foo}, {foo: Bar}]'
local: {u'foo': u'Bar'}</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.slsutil.renderer"> salt.modules.slsutil.renderer(path=None, string=None, default_renderer='jinja|yaml', **kwargs)</h3> <dd>
<p>Parse a string or file through Salt's renderer system</p> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 2018.3.0: </span>Add support for Salt fileserver URIs.</p> </div> <p>This is an open-ended function and can be used for a variety of tasks. It makes use of Salt's "renderer pipes" system to run a string or file through a pipe of any of the loaded renderer modules.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li><p><strong>path</strong> -- The path to a file on Salt's fileserver (any URIs supported by <a class="reference internal" href="salt.modules.cp.html#salt.modules.cp.get_url" title="salt.modules.cp.get_url"><code class="xref py py-func docutils literal notranslate"><span class="pre">cp.get_url</span></code></a>) or on the local file system.</p></li> <li><p><strong>string</strong> -- An inline string to be used as the file to send through the renderer system. Note, not all renderer modules can work with strings; the 'py' renderer requires a file, for example.</p></li> <li><p><strong>default_renderer</strong> -- The renderer pipe to send the file through; this is overridden by a "she-bang" at the top of the file.</p></li> <li><p><strong>kwargs</strong> -- Keyword args to pass to Salt's compile_template() function.</p></li> </ul> </dd> </dl> <p>Keep in mind the goal of each renderer when choosing a render-pipe; for example, the Jinja renderer processes a text file and produces a string, however the YAML renderer processes a text file and produces a data structure.</p> <p>One possible use is to allow writing "map files", as are commonly seen in Salt formulas, but without tying the renderer of the map file to the renderer used in the other sls files. In other words, a map file could use the Python renderer and still be included and used by an sls file that uses the default 'jinja|yaml' renderer.</p> <p>For example, the two following map files produce identical results but one is written using the normal 'jinja|yaml' and the other is using 'py':</p> <pre class="highlight-jinja notranslate" data-language="jinja">#!jinja|yaml
{% set apache = salt.grains.filter_by({
    ...normal jinja map file here...
}, merge=salt.pillar.get('apache:lookup')) %}
{{ apache | yaml() }}</pre> <pre class="highlight-python notranslate" data-language="python">#!py
def run():
    apache = __salt__.grains.filter_by({
        ...normal map here but as a python dict...
    }, merge=__salt__.pillar.get('apache:lookup'))
    return apache</pre> <p>Regardless of which of the above map files is used, it can be accessed from any other sls file by calling this function. The following is a usage example in Jinja:</p> <pre class="highlight-jinja notranslate" data-language="jinja">{% set apache = salt.slsutil.renderer('map.sls') %}</pre> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' slsutil.renderer salt://path/to/file
salt '*' slsutil.renderer /path/to/file
salt '*' slsutil.renderer /path/to/file.jinja default_renderer='jinja'
salt '*' slsutil.renderer /path/to/file.sls default_renderer='jinja|yaml'
salt '*' slsutil.renderer string='Inline template! {{ saltenv }}'
salt '*' slsutil.renderer string='Hello, {{ name }}.' name='world'</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.slsutil.serialize"> salt.modules.slsutil.serialize(serializer, obj, **mod_kwargs)</h3> <dd>
<p>Serialize a Python object using one of the available <a class="reference internal" href="../../serializers/all/index.html#all-salt-serializers"><span class="std std-ref">serializer modules</span></a>.</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' --no-parse=obj slsutil.serialize 'json' obj="{'foo': 'Foo!'}</pre> <p>Jinja Example:</p> <pre class="highlight-jinja notranslate" data-language="jinja">{% set json_string = salt.slsutil.serialize('json',
    {'foo': 'Foo!'}) %}</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.slsutil.update"> salt.modules.slsutil.update(dest, upd, recursive_update=True, merge_lists=False)</h3> <dd>
<p>Merge <code class="docutils literal notranslate"><span class="pre">upd</span></code> recursively into <code class="docutils literal notranslate"><span class="pre">dest</span></code></p> <p>If <code class="docutils literal notranslate"><span class="pre">merge_lists=True</span></code>, will aggregate list object types instead of replacing. This behavior is only activated when <code class="docutils literal notranslate"><span class="pre">recursive_update=True</span></code>.</p> <p>CLI Example:</p> <pre class="highlight-shell notranslate" data-language="shell">salt '*' slsutil.update '{foo: Foo}' '{bar: Bar}'</pre> </dd>
</dl><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2021 SaltStack.<br>Licensed under the Apache License, Version 2.0.<br>
    <a href="https://docs.saltproject.io/en/latest/ref/modules/all/salt.modules.slsutil.html" class="_attribution-link">https://docs.saltproject.io/en/latest/ref/modules/all/salt.modules.slsutil.html</a>
  </p>
</div>
