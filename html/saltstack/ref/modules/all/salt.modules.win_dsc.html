<h1>salt.modules.win_dsc</h1> <p>Module for working with Windows PowerShell DSC (Desired State Configuration)</p> <p>This module is Alpha</p> <p>This module applies DSC Configurations in the form of PowerShell scripts or MOF (Managed Object Format) schema files.</p> <p>Use the <code class="docutils literal notranslate"><span class="pre">psget</span></code> module to manage PowerShell resources.</p> <p>The idea is to leverage Salt to push DSC configuration scripts or MOF files to the Minion.</p> <dl class="field-list simple"> <dt class="field-odd">depends</dt> <dd class="field-odd">
<ul class="simple"> <li><p>PowerShell 5.0</p></li> </ul> </dd> </dl> <dl class="py function"> <h3 id="salt.modules.win_dsc.apply_config"> salt.modules.win_dsc.apply_config(path, source=None, salt_env='base')</h3> <dd>
<p>Run an compiled DSC configuration (a folder containing a .mof file). The folder can be cached from the salt master using the <code class="docutils literal notranslate"><span class="pre">source</span></code> option.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li><p><strong>path</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- Local path to the directory that contains the .mof configuration file to apply. Required.</p></li> <li><p><strong>source</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- Path to the directory that contains the .mof file on the <code class="docutils literal notranslate"><span class="pre">file_roots</span></code>. The source directory will be copied to the path directory and then executed. If the path and source directories differ, the source directory will be applied. If source is not passed, the config located at <code class="docutils literal notranslate"><span class="pre">path</span></code> will be applied. Optional.</p></li> <li><p><strong>salt_env</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The salt environment to use when copying your source. Default is 'base'</p></li> </ul> </dd> <dt class="field-even">Returns</dt> <dd class="field-even">
<p>True if successful, otherwise False</p> </dd> <dt class="field-odd">Return type</dt> <dd class="field-odd">
<p><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)">bool</a></p> </dd> </dl> <p>CLI Example:</p> <p>To apply a config that already exists on the system</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' dsc.apply_config C:\\DSC\\WebSiteConfiguration</pre> <p>To cache a configuration from the master and apply it:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' dsc.apply_config C:\\DSC\\WebSiteConfiguration salt://dsc/configs/WebSiteConfiguration</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.win_dsc.compile_config"> salt.modules.win_dsc.compile_config(path, source=None, config_name=None, config_data=None, config_data_source=None, script_parameters=None, salt_env='base')</h3> <dd>
<p>Compile a config from a PowerShell script (<code class="docutils literal notranslate"><span class="pre">.ps1</span></code>)</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li><p><strong>path</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- Path (local) to the script that will create the <code class="docutils literal notranslate"><span class="pre">.mof</span></code> configuration file. If no source is passed, the file must exist locally. Required.</p></li> <li><p><strong>source</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- Path to the script on <code class="docutils literal notranslate"><span class="pre">file_roots</span></code> to cache at the location specified by <code class="docutils literal notranslate"><span class="pre">path</span></code>. The source file will be cached locally and then executed. If source is not passed, the config script located at <code class="docutils literal notranslate"><span class="pre">path</span></code> will be compiled. Optional.</p></li> <li><p><strong>config_name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The name of the Configuration within the script to apply. If the script contains multiple configurations within the file a <code class="docutils literal notranslate"><span class="pre">config_name</span></code> must be specified. If the <code class="docutils literal notranslate"><span class="pre">config_name</span></code> is not specified, the name of the file will be used as the <code class="docutils literal notranslate"><span class="pre">config_name</span></code> to run. Optional.</p></li> <li>
<p><strong>config_data</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- </p>
<p>Configuration data in the form of a hash table that will be passed to the <code class="docutils literal notranslate"><span class="pre">ConfigurationData</span></code> parameter when the <code class="docutils literal notranslate"><span class="pre">config_name</span></code> is compiled. This can be the path to a <code class="docutils literal notranslate"><span class="pre">.psd1</span></code> file containing the proper hash table or the PowerShell code to create the hash table.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2017.7.0.</span></p> </div> </li> <li>
<p><strong>config_data_source</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- </p>
<p>The path to the <code class="docutils literal notranslate"><span class="pre">.psd1</span></code> file on <code class="docutils literal notranslate"><span class="pre">file_roots</span></code> to cache at the location specified by <code class="docutils literal notranslate"><span class="pre">config_data</span></code>. If this is specified, <code class="docutils literal notranslate"><span class="pre">config_data</span></code> must be a local path instead of a hash table.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2017.7.0.</span></p> </div> </li> <li>
<p><strong>script_parameters</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- </p>
<p>Any additional parameters expected by the configuration script. These must be defined in the script itself.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2017.7.0.</span></p> </div> </li> <li><p><strong>salt_env</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The salt environment to use when copying the source. Default is 'base'</p></li> </ul> </dd> <dt class="field-even">Returns</dt> <dd class="field-even">
<p>A dictionary containing the results of the compilation</p> </dd> <dt class="field-odd">Return type</dt> <dd class="field-odd">
<p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)">dict</a></p> </dd> </dl> <p>CLI Example:</p> <p>To compile a config from a script that already exists on the system:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' dsc.compile_config C:\\DSC\\WebsiteConfig.ps1</pre> <p>To cache a config script to the system from the master and compile it:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' dsc.compile_config C:\\DSC\\WebsiteConfig.ps1 salt://dsc/configs/WebsiteConfig.ps1</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.win_dsc.get_config"> salt.modules.win_dsc.get_config()</h3> <dd>
<p>Get the current DSC Configuration</p> <dl class="field-list simple"> <dt class="field-odd">Returns</dt> <dd class="field-odd">
<p>A dictionary representing the DSC Configuration on the machine</p> </dd> <dt class="field-even">Return type</dt> <dd class="field-even">
<p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)">dict</a></p> </dd> <dt class="field-odd">Raises</dt> <dd class="field-odd">
<p><a class="reference internal" href="https://docs.saltproject.io/en/latest/ref/internals/salt.exceptions.html#salt.exceptions.CommandExecutionError" title="salt.exceptions.CommandExecutionError"><strong>CommandExecutionError</strong></a> -- On failure</p> </dd> </dl> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' dsc.get_config</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.win_dsc.get_config_status"> salt.modules.win_dsc.get_config_status()</h3> <dd>
<p>Get the status of the current DSC Configuration</p> <dl class="field-list simple"> <dt class="field-odd">Returns</dt> <dd class="field-odd">

<dl class="simple"> <dt>A dictionary representing the status of the current DSC</dt>
<dd>
<p>Configuration on the machine</p> </dd> </dl> </dd> <dt class="field-even">Return type</dt> <dd class="field-even">
<p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)">dict</a></p> </dd> </dl> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' dsc.get_config_status</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.win_dsc.get_lcm_config"> salt.modules.win_dsc.get_lcm_config()</h3> <dd>
<p>Get the current Local Configuration Manager settings</p> <dl class="field-list simple"> <dt class="field-odd">Returns</dt> <dd class="field-odd">

<dl class="simple"> <dt>A dictionary representing the Local Configuration Manager settings</dt>
<dd>
<p>on the machine</p> </dd> </dl> </dd> <dt class="field-even">Return type</dt> <dd class="field-even">
<p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)">dict</a></p> </dd> </dl> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' dsc.get_lcm_config</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.win_dsc.remove_config"> salt.modules.win_dsc.remove_config(reset=False)</h3> <dd>
<p>Remove the current DSC Configuration. Removes current, pending, and previous dsc configurations.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2017.7.5.</span></p> </div> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<p><strong>reset</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- </p>
<p>Attempts to reset the DSC configuration by removing the following from <code class="docutils literal notranslate"><span class="pre">C:\Windows\System32\Configuration</span></code>:</p> <ul class="simple"> <li><p>File: DSCStatusHistory.mof</p></li> <li><p>File: DSCEngineCache.mof</p></li> <li><p>Dir: ConfigurationStatus</p></li> </ul> <p>Default is False</p> <div class="admonition warning"> <p class="admonition-title">Warning</p> <p><code class="docutils literal notranslate"><span class="pre">remove_config</span></code> may fail to reset the DSC environment if any of the files in the <code class="docutils literal notranslate"><span class="pre">ConfigurationStatus</span></code> directory. If you wait a few minutes and run again, it may complete successfully.</p> </div> </dd> <dt class="field-even">Returns</dt> <dd class="field-even">
<p>True if successful</p> </dd> <dt class="field-odd">Return type</dt> <dd class="field-odd">
<p><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)">bool</a></p> </dd> <dt class="field-even">Raises</dt> <dd class="field-even">
<p><a class="reference internal" href="https://docs.saltproject.io/en/latest/ref/internals/salt.exceptions.html#salt.exceptions.CommandExecutionError" title="salt.exceptions.CommandExecutionError"><strong>CommandExecutionError</strong></a> -- On failure</p> </dd> </dl> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' dsc.remove_config True</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.win_dsc.restore_config"> salt.modules.win_dsc.restore_config()</h3> <dd>
<p>Reapplies the previous configuration.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2017.7.5.</span></p> </div> <div class="admonition note"> <p class="admonition-title">Note</p> <p>The current configuration will be come the previous configuration. If run a second time back-to-back it is like toggling between two configs.</p> </div> <dl class="field-list simple"> <dt class="field-odd">Returns</dt> <dd class="field-odd">
<p>True if successfully restored</p> </dd> <dt class="field-even">Return type</dt> <dd class="field-even">
<p><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)">bool</a></p> </dd> <dt class="field-odd">Raises</dt> <dd class="field-odd">
<p><a class="reference internal" href="https://docs.saltproject.io/en/latest/ref/internals/salt.exceptions.html#salt.exceptions.CommandExecutionError" title="salt.exceptions.CommandExecutionError"><strong>CommandExecutionError</strong></a> -- On failure</p> </dd> </dl> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' dsc.restore_config</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.win_dsc.run_config"> salt.modules.win_dsc.run_config(path, source=None, config_name=None, config_data=None, config_data_source=None, script_parameters=None, salt_env='base')</h3> <dd>
<p>Compile a DSC Configuration in the form of a PowerShell script (.ps1) and apply it. The PowerShell script can be cached from the master using the <code class="docutils literal notranslate"><span class="pre">source</span></code> option. If there is more than one config within the PowerShell script, the desired configuration can be applied by passing the name in the <code class="docutils literal notranslate"><span class="pre">config</span></code> option.</p> <p>This command would be the equivalent of running <code class="docutils literal notranslate"><span class="pre">dsc.compile_config</span></code> followed by <code class="docutils literal notranslate"><span class="pre">dsc.apply_config</span></code>.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li><p><strong>path</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The local path to the PowerShell script that contains the DSC Configuration. Required.</p></li> <li><p><strong>source</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The path to the script on <code class="docutils literal notranslate"><span class="pre">file_roots</span></code> to cache at the location specified by <code class="docutils literal notranslate"><span class="pre">path</span></code>. The source file will be cached locally and then executed. If source is not passed, the config script located at <code class="docutils literal notranslate"><span class="pre">path</span></code> will be compiled. Optional.</p></li> <li><p><strong>config_name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The name of the Configuration within the script to apply. If the script contains multiple configurations within the file a <code class="docutils literal notranslate"><span class="pre">config_name</span></code> must be specified. If the <code class="docutils literal notranslate"><span class="pre">config_name</span></code> is not specified, the name of the file will be used as the <code class="docutils literal notranslate"><span class="pre">config_name</span></code> to run. Optional.</p></li> <li>
<p><strong>config_data</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- </p>
<p>Configuration data in the form of a hash table that will be passed to the <code class="docutils literal notranslate"><span class="pre">ConfigurationData</span></code> parameter when the <code class="docutils literal notranslate"><span class="pre">config_name</span></code> is compiled. This can be the path to a <code class="docutils literal notranslate"><span class="pre">.psd1</span></code> file containing the proper hash table or the PowerShell code to create the hash table.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2017.7.0.</span></p> </div> </li> <li>
<p><strong>config_data_source</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- </p>
<p>The path to the <code class="docutils literal notranslate"><span class="pre">.psd1</span></code> file on <code class="docutils literal notranslate"><span class="pre">file_roots</span></code> to cache at the location specified by <code class="docutils literal notranslate"><span class="pre">config_data</span></code>. If this is specified, <code class="docutils literal notranslate"><span class="pre">config_data</span></code> must be a local path instead of a hash table.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2017.7.0.</span></p> </div> </li> <li>
<p><strong>script_parameters</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- </p>
<p>Any additional parameters expected by the configuration script. These must be defined in the script itself.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2017.7.0.</span></p> </div> </li> <li><p><strong>salt_env</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The salt environment to use when copying the source. Default is 'base'</p></li> </ul> </dd> <dt class="field-even">Returns</dt> <dd class="field-even">
<p>True if successfully compiled and applied, otherwise False</p> </dd> <dt class="field-odd">Return type</dt> <dd class="field-odd">
<p><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)">bool</a></p> </dd> </dl> <p>CLI Example:</p> <p>To compile a config from a script that already exists on the system:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' dsc.run_config C:\\DSC\\WebsiteConfig.ps1</pre> <p>To cache a config script to the system from the master and compile it:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' dsc.run_config C:\\DSC\\WebsiteConfig.ps1 salt://dsc/configs/WebsiteConfig.ps1</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.win_dsc.set_lcm_config"> salt.modules.win_dsc.set_lcm_config(config_mode=None, config_mode_freq=None, refresh_freq=None, reboot_if_needed=None, action_after_reboot=None, refresh_mode=None, certificate_id=None, configuration_id=None, allow_module_overwrite=None, debug_mode=False, status_retention_days=None)</h3> <dd>
<p>For detailed descriptions of the parameters see: <a class="reference external" href="https://msdn.microsoft.com/en-us/PowerShell/DSC/metaConfig">https://msdn.microsoft.com/en-us/PowerShell/DSC/metaConfig</a></p> <dl class="simple"> <dt>config_mode (str): How the LCM applies the configuration. Valid values</dt>
<dd>
<p>are:</p> <ul class="simple"> <li><p>ApplyOnly</p></li> <li><p>ApplyAndMonitor</p></li> <li><p>ApplyAndAutoCorrect</p></li> </ul> </dd> <dt>config_mode_freq (int): How often, in minutes, the current configuration</dt>
<dd>
<p>is checked and applied. Ignored if config_mode is set to ApplyOnly. Default is 15.</p> </dd> </dl> <p>refresh_mode (str): How the LCM gets configurations. Valid values are:</p> <blockquote> <div>
<ul class="simple"> <li><p>Disabled</p></li> <li><p>Push</p></li> <li><p>Pull</p></li> </ul> </div>
</blockquote> <dl class="simple"> <dt>refresh_freq (int): How often, in minutes, the LCM checks for updated</dt>
<dd>
<p>configurations. (pull mode only) Default is 30.</p> </dd> <dt>reboot_if_needed (bool): Reboot the machine if needed after a</dt>
<dd>
<p>configuration is applied. Default is False.</p> </dd> <dt>action_after_reboot (str): Action to take after reboot. Valid values</dt>
<dd>
<p>are:</p> <ul class="simple"> <li><p>ContinueConfiguration</p></li> <li><p>StopConfiguration</p></li> </ul> </dd> <dt>certificate_id (guid): A GUID that specifies a certificate used to</dt>
<dd>
<p>access the configuration: (pull mode)</p> </dd> <dt>configuration_id (guid): A GUID that identifies the config file to get</dt>
<dd>
<p>from a pull server. (pull mode)</p> </dd> <dt>allow_module_overwrite (bool): New configs are allowed to overwrite old</dt>
<dd>
<p>ones on the target node.</p> </dd> </dl> <p>debug_mode (str): Sets the debug level. Valid values are:</p> <blockquote> <div>
<ul class="simple"> <li><p>None</p></li> <li><p>ForceModuleImport</p></li> <li><p>All</p></li> </ul> </div>
</blockquote> <dl class="simple"> <dt>status_retention_days (int): Number of days to keep status of the</dt>
<dd>
<p>current config.</p> </dd> </dl> <div class="admonition note"> <p class="admonition-title">Note</p> <p>Either <code class="docutils literal notranslate"><span class="pre">config_mode_freq</span></code> or <code class="docutils literal notranslate"><span class="pre">refresh_freq</span></code> needs to be a multiple of the other. See documentation on MSDN for more details.</p> </div> <dl class="field-list simple"> <dt class="field-odd">Returns</dt> <dd class="field-odd">
<p>True if successful, otherwise False</p> </dd> <dt class="field-even">Return type</dt> <dd class="field-even">
<p><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)">bool</a></p> </dd> </dl> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' dsc.set_lcm_config ApplyOnly</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.win_dsc.test_config"> salt.modules.win_dsc.test_config()</h3> <dd>
<p>Tests the current applied DSC Configuration</p> <dl class="field-list simple"> <dt class="field-odd">Returns</dt> <dd class="field-odd">
<p>True if successfully applied, otherwise False</p> </dd> <dt class="field-even">Return type</dt> <dd class="field-even">
<p><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)">bool</a></p> </dd> </dl> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' dsc.test_config</pre> </dd>
</dl><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2021 SaltStack.<br>Licensed under the Apache License, Version 2.0.<br>
    <a href="https://docs.saltproject.io/en/latest/ref/modules/all/salt.modules.win_dsc.html" class="_attribution-link">https://docs.saltproject.io/en/latest/ref/modules/all/salt.modules.win_dsc.html</a>
  </p>
</div>
