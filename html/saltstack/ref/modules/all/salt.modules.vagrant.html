<h1>salt.modules.vagrant</h1> <p>Work with virtual machines managed by Vagrant.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2018.3.0.</span></p> </div> <p>Mapping between a Salt node id and the Vagrant machine name (and the path to the Vagrantfile where it is defined) is stored in a Salt sdb database on the Vagrant host (minion) machine. In order to use this module, sdb must be configured. An SQLite database is the recommended storage method. The URI used for the sdb lookup is "sdb://vagrant_sdb_data".</p> <dl> <dt>requirements:</dt>
<dd>
<ul class="simple"> <li><p>the VM host machine must have salt-minion, Vagrant and a vm provider installed.</p></li> <li><p>the VM host must have a valid definition for <cite>sdb://vagrant_sdb_data</cite></p></li> </ul> <blockquote> <div>
<p>Configuration example:</p> <pre class="highlight-yaml notranslate" data-language="yaml"># file /etc/salt/minion.d/vagrant_sdb.conf
vagrant_sdb_data:
  driver: sqlite3
  database: /var/cache/salt/vagrant.sqlite
  table: sdb
  create_table: True</pre> </div>
</blockquote> </dd> </dl> <dl class="py function"> <h3 id="salt.modules.vagrant.destroy"> salt.modules.vagrant.destroy(name)</h3> <dd>
<p>Destroy and delete a virtual machine. (vagrant destroy -f)</p> <p>This also removes the salt_id name defined by vagrant.init.</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt &lt;host&gt; vagrant.destroy &lt;salt_id&gt;</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.vagrant.get_machine_id"> salt.modules.vagrant.get_machine_id(machine, cwd)</h3> <dd>
<p>returns the salt_id name of the Vagrant VM</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li><p><strong>machine</strong> -- the Vagrant machine name</p></li> <li><p><strong>cwd</strong> -- the path to Vagrantfile</p></li> </ul> </dd> <dt class="field-even">Returns</dt> <dd class="field-even">
<p>salt_id name</p> </dd> </dl> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.vagrant.get_ssh_config"> salt.modules.vagrant.get_ssh_config(name, network_mask='', get_private_key=False)</h3> <dd>
<p>Retrieve hints of how you might connect to a Vagrant VM.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li><p><strong>name</strong> -- the salt_id of the machine</p></li> <li><p><strong>network_mask</strong> -- a CIDR mask to search for the VM's address</p></li> <li><p><strong>get_private_key</strong> -- (default: False) return the key used for ssh login</p></li> </ul> </dd> <dt class="field-even">Returns</dt> <dd class="field-even">
<p>a dict of ssh login information for the VM</p> </dd> </dl> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt &lt;host&gt; vagrant.get_ssh_config &lt;salt_id&gt;
salt my_laptop vagrant.get_ssh_config quail1 network_mask=10.0.0.0/8 get_private_key=True</pre> <p>The returned dictionary contains:</p> <ul class="simple"> <li><p>key_filename: the name of the private key file on the VM host computer</p></li> <li><p>ssh_username: the username to be used to log in to the VM</p></li> <li><p>ssh_host: the IP address used to log in to the VM. (This will usually be <cite>127.0.0.1</cite>)</p></li> <li><p>ssh_port: the TCP port used to log in to the VM. (This will often be <cite>2222</cite>)</p></li> <li><p>[ip_address:] (if <cite>network_mask</cite> is defined. see below)</p></li> <li><p>[private_key:] (if <cite>get_private_key</cite> is True) the private key for ssh_username</p></li> </ul> <p>About <cite>network_mask</cite>:</p> <p>Vagrant usually uses a redirected TCP port on its host computer to log in to a VM using ssh. This redirected port and its IP address are "ssh_port" and "ssh_host". The ssh_host is usually the localhost (127.0.0.1). This makes it impossible for a third machine (such as a salt-cloud master) to contact the VM unless the VM has another network interface defined. You will usually want a bridged network defined by having a <cite>config.vm.network "public_network"</cite> statement in your <cite>Vagrantfile</cite>.</p> <p>The IP address of the bridged adapter will typically be assigned by DHCP and unknown to you, but you should be able to determine what IP network the address will be chosen from. If you enter a CIDR network mask, Salt will attempt to find the VM's address for you. The host machine will send an "ifconfig" command to the VM (using ssh to <cite>ssh_host</cite>:<cite>ssh_port</cite>) and return the IP address of the first interface it can find which matches your mask.</p> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.vagrant.get_vm_info"> salt.modules.vagrant.get_vm_info(name)</h3> <dd>
<p>get the information for a VM.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<p><strong>name</strong> -- salt_id name</p> </dd> <dt class="field-even">Returns</dt> <dd class="field-even">
<p>dictionary of {'machine': x, 'cwd': y, ...}.</p> </dd> </dl> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.vagrant.init"> salt.modules.vagrant.init(name, cwd=None, machine='', runas=None, start=False, vagrant_provider='', vm=None)</h3> <dd>
<p>Initialize a new Vagrant VM.</p> <p>This inputs all the information needed to start a Vagrant VM. These settings are stored in a Salt sdb database on the Vagrant host minion and used to start, control, and query the guest VMs. The salt_id assigned here is the key field for that database and must be unique.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li><p><strong>name</strong> -- The salt_id name you will use to control this VM</p></li> <li><p><strong>cwd</strong> -- The path to the directory where the Vagrantfile is located</p></li> <li><p><strong>machine</strong> -- The machine name in the Vagrantfile. If blank, the primary machine will be used.</p></li> <li><p><strong>runas</strong> -- The username on the host who owns the Vagrant work files.</p></li> <li><p><strong>start</strong> -- (default: False) Start the virtual machine now.</p></li> <li><p><strong>vagrant_provider</strong> -- The name of a Vagrant VM provider (if not the default).</p></li> <li><p><strong>vm</strong> -- Optionally, all the above information may be supplied in this dictionary.</p></li> </ul> </dd> <dt class="field-even">Returns</dt> <dd class="field-even">
<p>A string indicating success, or False.</p> </dd> </dl> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt &lt;host&gt; vagrant.init &lt;salt_id&gt; /path/to/Vagrantfile
salt my_laptop vagrant.init x1 /projects/bevy_master machine=quail1</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.vagrant.list_active_vms"> salt.modules.vagrant.list_active_vms(cwd=None)</h3> <dd>
<p>Return a list of machine names for active virtual machine on the host, which are defined in the Vagrantfile at the indicated path.</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' vagrant.list_active_vms  cwd=/projects/project_1</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.vagrant.list_domains"> salt.modules.vagrant.list_domains()</h3> <dd>
<p>Return a list of the salt_id names of all available Vagrant VMs on this host without regard to the path where they are defined.</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' vagrant.list_domains --log-level=info</pre> <p>The log shows information about all known Vagrant environments on this machine. This data is cached and may not be completely up-to-date.</p> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.vagrant.list_inactive_vms"> salt.modules.vagrant.list_inactive_vms(cwd=None)</h3> <dd>
<p>Return a list of machine names for inactive virtual machine on the host, which are defined in the Vagrantfile at the indicated path.</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' virt.list_inactive_vms cwd=/projects/project_1</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.vagrant.pause"> salt.modules.vagrant.pause(name)</h3> <dd>
<p>Pause (vagrant suspend) the named VM.</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt &lt;host&gt; vagrant.pause &lt;salt_id&gt;</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.vagrant.reboot"> salt.modules.vagrant.reboot(name, provision=False)</h3> <dd>
<p>Reboot a VM. (vagrant reload)</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt &lt;host&gt; vagrant.reboot &lt;salt_id&gt; provision=True</pre> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li><p><strong>name</strong> -- The salt_id name you will use to control this VM</p></li> <li><p><strong>provision</strong> -- (False) also re-run the Vagrant provisioning scripts.</p></li> </ul> </dd> </dl> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.vagrant.shutdown"> salt.modules.vagrant.shutdown(name)</h3> <dd>
<p>Send a soft shutdown (vagrant halt) signal to the named vm.</p> <p>This does the same thing as vagrant.stop. Other-VM control modules use "stop" and "shutdown" to differentiate between hard and soft shutdowns.</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt &lt;host&gt; vagrant.shutdown &lt;salt_id&gt;</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.vagrant.start"> salt.modules.vagrant.start(name)</h3> <dd>
<p>Start (vagrant up) a virtual machine defined by salt_id name. The machine must have been previously defined using "vagrant.init".</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt &lt;host&gt; vagrant.start &lt;salt_id&gt;</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.vagrant.stop"> salt.modules.vagrant.stop(name)</h3> <dd>
<p>Hard shutdown the virtual machine. (vagrant halt)</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt &lt;host&gt; vagrant.stop &lt;salt_id&gt;</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.vagrant.version"> salt.modules.vagrant.version()</h3> <dd>
<p>Return the version of Vagrant on the minion</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' vagrant.version</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.vagrant.vm_state"> salt.modules.vagrant.vm_state(name='', cwd=None)</h3> <dd>
<p>Return list of information for all the vms indicating their state.</p> <p>If you pass a VM name in as an argument then it will return info for just the named VM, otherwise it will return all VMs defined by the Vagrantfile in the <cite>cwd</cite> directory.</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' vagrant.vm_state &lt;name&gt;  cwd=/projects/project_1</pre> <p>returns a list of dictionaries with machine name, state, provider, and salt_id name.</p> <pre class="highlight-python notranslate" data-language="python">datum = {'machine': _, # Vagrant machine name,
         'state': _, # string indicating machine state, like 'running'
         'provider': _, # the Vagrant VM provider
         'name': _} # salt_id name</pre> <p>Known bug: if there are multiple machines in your Vagrantfile, and you request the status of the <code class="docutils literal notranslate"><span class="pre">primary</span></code> machine, which you defined by leaving the <code class="docutils literal notranslate"><span class="pre">machine</span></code> parameter blank, then you may receive the status of all of them. Please specify the actual machine name for each VM if there are more than one.</p> </dd>
</dl><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2021 SaltStack.<br>Licensed under the Apache License, Version 2.0.<br>
    <a href="https://docs.saltproject.io/en/latest/ref/modules/all/salt.modules.vagrant.html" class="_attribution-link">https://docs.saltproject.io/en/latest/ref/modules/all/salt.modules.vagrant.html</a>
  </p>
</div>
