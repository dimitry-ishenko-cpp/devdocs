<h1>salt.modules.mine</h1> <p>The function cache system allows for data to be stored on the master so it can be easily read by other minions</p> <dl class="py function"> <h3 id="salt.modules.mine.delete"> salt.modules.mine.delete(fun)</h3> <dd>
<p>Remove specific function contents of minion.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<p><strong>fun</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The name of the function.</p> </dd> <dt class="field-even">Return type</dt> <dd class="field-even">
<p><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)">bool</a></p> </dd> <dt class="field-odd">Returns</dt> <dd class="field-odd">
<p>True on success.</p> </dd> </dl> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' mine.delete 'network.interfaces'</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.mine.flush"> salt.modules.mine.flush()</h3> <dd>
<p>Remove all mine contents of minion.</p> <dl class="field-list simple"> <dt class="field-odd">Return type</dt> <dd class="field-odd">
<p><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)">bool</a></p> </dd> <dt class="field-even">Returns</dt> <dd class="field-even">
<p>True on success</p> </dd> </dl> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' mine.flush</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.mine.get"> salt.modules.mine.get(tgt, fun, tgt_type='glob', exclude_minion=False)</h3> <dd>
<p>Get data from the mine.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li><p><strong>tgt</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- Target whose mine data to get.</p></li> <li><p><strong>fun</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a><em> or </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><em>list</em></a>) -- Function to get the mine data of. You can specify multiple functions to retrieve using either a list or a comma-separated string of functions.</p></li> <li><p><strong>tgt_type</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- Default <code class="docutils literal notranslate"><span class="pre">glob</span></code>. Target type to use with <code class="docutils literal notranslate"><span class="pre">tgt</span></code>. See <a class="reference internal" href="https://docs.saltproject.io/en/latest/topics/targeting/index.html#targeting"><span class="std std-ref">Targeting Minions</span></a> for more information. Note that all pillar matches, whether using the compound matching system or the pillar matching system, will be exact matches, with globbing disabled.</p></li> <li><p><strong>exclude_minion</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- Excludes the current minion from the result set.</p></li> </ul> </dd> </dl> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' mine.get '*' network.interfaces
salt '*' mine.get 'os:Fedora' network.interfaces grain
salt '*' mine.get 'G@os:Fedora and S@192.168.5.0/24' network.ipaddrs compound</pre> <div class="admonition seealso"> <p class="admonition-title">See also</p> <p>Retrieving Mine data from Pillar and Orchestrate</p> <p>This execution module is intended to be executed on minions. Master-side operations such as Pillar or Orchestrate that require Mine data should use the <a class="reference internal" href="../../runners/all/salt.runners.mine.html#module-salt.runners.mine" title="salt.runners.mine"><code class="xref py py-mod docutils literal notranslate"><span class="pre">Mine</span> <span class="pre">Runner</span> <span class="pre">module</span></code></a> instead; it can be invoked from a Pillar SLS file using the <a class="reference internal" href="salt.modules.saltutil.html#salt.modules.saltutil.runner" title="salt.modules.saltutil.runner"><code class="xref py py-func docutils literal notranslate"><span class="pre">saltutil.runner</span></code></a> module. For example:</p> <pre class="highlight-jinja notranslate" data-language="jinja">{% set minion_ips = salt.saltutil.runner('mine.get',
    tgt='*',
    fun='network.ip_addrs',
    tgt_type='glob') %}</pre> </div> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.mine.get_docker"> salt.modules.mine.get_docker(interfaces=None, cidrs=None, with_container_id=False)</h3> <dd>
<div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 2017.7.8,2018.3.3: </span>When <a class="reference internal" href="https://docs.saltproject.io/en/latest/ref/configuration/minion.html#std-conf_minion-docker.update_mine"><code class="xref std std-conf_minion docutils literal notranslate"><span class="pre">docker.update_mine</span></code></a> is set to <code class="docutils literal notranslate"><span class="pre">False</span></code> for a given minion, no mine data will be populated for that minion, and thus none will be returned for it.</p> </div> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 2019.2.0: </span><a class="reference internal" href="https://docs.saltproject.io/en/latest/ref/configuration/minion.html#std-conf_minion-docker.update_mine"><code class="xref std std-conf_minion docutils literal notranslate"><span class="pre">docker.update_mine</span></code></a> now defaults to <code class="docutils literal notranslate"><span class="pre">False</span></code></p> </div> <p>Get all mine data for <a class="reference internal" href="salt.modules.dockermod.html#salt.modules.dockermod.ps_" title="salt.modules.dockermod.ps_"><code class="xref py py-func docutils literal notranslate"><span class="pre">docker.ps</span></code></a> and run an aggregation routine. The <code class="docutils literal notranslate"><span class="pre">interfaces</span></code> parameter allows for specifying the network interfaces from which to select IP addresses. The <code class="docutils literal notranslate"><span class="pre">cidrs</span></code> parameter allows for specifying a list of subnets which the IP address must match.</p> <dl> <dt>with_container_id</dt>
<dd>
<p>Boolean, to expose container_id in the list of results</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 2015.8.2.</span></p> </div> </dd> </dl> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' mine.get_docker
salt '*' mine.get_docker interfaces='eth0'
salt '*' mine.get_docker interfaces='["eth0", "eth1"]'
salt '*' mine.get_docker cidrs='107.170.147.0/24'
salt '*' mine.get_docker cidrs='["107.170.147.0/24", "172.17.42.0/24"]'
salt '*' mine.get_docker interfaces='["eth0", "eth1"]' cidrs='["107.170.147.0/24", "172.17.42.0/24"]'</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.mine.send"> salt.modules.mine.send(name, *args, **kwargs)</h3> <dd>
<p>Send a specific function and its result to the salt mine. This gets stored in either the local cache, or the salt master's cache.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<p><strong>name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- Name of the function to add to the mine.</p> </dd> </dl> <p>The following pameters are extracted from kwargs if present:</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li><p><strong>mine_function</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- The name of the execution_module.function to run and whose value will be stored in the salt mine. Defaults to <code class="docutils literal notranslate"><span class="pre">name</span></code>.</p></li> <li><p><strong>allow_tgt</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- Targeting specification for ACL. Specifies which minions are allowed to access this function. Please note both your master and minion need to be on, at least, version 3000 for this to work properly.</p></li> <li><p><strong>allow_tgt_type</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) -- Type of the targeting specification. This value will be ignored if <code class="docutils literal notranslate"><span class="pre">allow_tgt</span></code> is not specified. Please note both your master and minion need to be on, at least, version 3000 for this to work properly.</p></li> </ul> </dd> </dl> <p>Remaining args and kwargs will be passed on to the function to run.</p> <dl class="field-list simple"> <dt class="field-odd">Return type</dt> <dd class="field-odd">
<p><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)">bool</a></p> </dd> <dt class="field-even">Returns</dt> <dd class="field-even">
<p>Whether executing the function and storing the information was successful.</p> </dd> </dl> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 3000: </span>Added <code class="docutils literal notranslate"><span class="pre">allow_tgt</span></code>- and <code class="docutils literal notranslate"><span class="pre">allow_tgt_type</span></code>-parameters to specify which minions are allowed to access this function. See <a class="reference internal" href="https://docs.saltproject.io/en/latest/topics/targeting/index.html#targeting"><span class="std std-ref">Targeting Minions</span></a> for more information about targeting.</p> </div> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' mine.send network.ip_addrs eth0
salt '*' mine.send eth0_ip_addrs mine_function=network.ip_addrs eth0
salt '*' mine.send eth0_ip_addrs mine_function=network.ip_addrs eth0 allow_tgt='G@grain:value' allow_tgt_type=compound</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.mine.update"> salt.modules.mine.update(clear=False, mine_functions=None)</h3> <dd>
<p>Call the configured functions and send the data back up to the master. The functions to be called are merged from the master config, pillar and minion config under the option <cite>mine_functions</cite>:</p> <pre class="highlight-yaml notranslate" data-language="yaml">mine_functions:
  network.ip_addrs:
    - eth0
  disk.usage: []</pre> <p>This function accepts the following arguments:</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li><p><strong>clear</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) -- Default: <code class="docutils literal notranslate"><span class="pre">False</span></code> Specifies whether updating will clear the existing values (<code class="docutils literal notranslate"><span class="pre">True</span></code>), or whether it will update them (<code class="docutils literal notranslate"><span class="pre">False</span></code>).</p></li> <li>
<p><strong>mine_functions</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><em>dict</em></a>) -- </p>
<p>Update (or clear, see <code class="docutils literal notranslate"><span class="pre">clear</span></code>) the mine data on these functions only. This will need to have the structure as defined on <a class="reference external" href="https://docs.saltstack.com/en/latest/topics/mine/index.html#mine-functions">https://docs.saltstack.com/en/latest/topics/mine/index.html#mine-functions</a></p> <p>This feature can be used when updating the mine for functions that require a refresh at different intervals than the rest of the functions specified under <cite>mine_functions</cite> in the minion/master config or pillar. A potential use would be together with the <cite>scheduler</cite>, for example:</p> <pre class="highlight-yaml notranslate" data-language="yaml">schedule:
  lldp_mine_update:
    function: mine.update
    kwargs:
        mine_functions:
          net.lldp: []
    hours: 12</pre> <p>In the example above, the mine for <cite>net.lldp</cite> would be refreshed every 12 hours, while <cite>network.ip_addrs</cite> would continue to be updated as specified in <cite>mine_interval</cite>.</p> </li> </ul> </dd> </dl> <p>The function cache will be populated with information from executing these functions</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' mine.update</pre> </dd>
</dl> <dl class="py function"> <h3 id="salt.modules.mine.valid"> salt.modules.mine.valid()</h3> <dd>
<p>List valid entries in mine configuration.</p> <p>CLI Example:</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' mine.valid</pre> </dd>
</dl><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2021 SaltStack.<br>Licensed under the Apache License, Version 2.0.<br>
    <a href="https://docs.saltproject.io/en/latest/ref/modules/all/salt.modules.mine.html" class="_attribution-link">https://docs.saltproject.io/en/latest/ref/modules/all/salt.modules.mine.html</a>
  </p>
</div>
