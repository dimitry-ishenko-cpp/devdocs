<h1>Action View Form Helpers</h1>
<div class="_simple"> <p>Forms are a common interface for user input in web applications. However, form markup can be tedious to write and maintain because of the need to handle form controls, naming, and attributes. Rails simplifies this by providing view helpers, which are methods that output HTML form markup. This guide will help you understand the different helper methods and when to use each.</p>
<p>After reading this guide, you will know:</p> <ul> <li>How to create basic forms, such as a search form.</li> <li>How to work with model-based forms for creating and editing specific database records.</li> <li>How to generate select boxes from multiple types of data.</li> <li>What date and time helpers Rails provides.</li> <li>What makes a file upload form different.</li> <li>How to post forms to external resources and specify setting an <code>authenticity_token</code>.</li> <li>How to build complex forms.</li> </ul>  <h2 class="chapter">  Chapters </h2> <ol class="chapters"> <li>
<a href="#working-with-basic-forms">Working with Basic Forms</a> <ul> <li><a href="#a-generic-search-form">A Generic Search Form</a></li> <li><a href="#helpers-for-generating-form-elements">Helpers for Generating Form Elements</a></li> <li><a href="#other-helpers-of-interest">Other Helpers of Interest</a></li> </ul>
</li> <li>
<a href="#creating-forms-with-model-objects">Creating Forms with Model Objects</a> <ul> <li><a href="#binding-a-form-to-an-object">Binding a Form to an Object</a></li> <li><a href="#relying-on-record-identification">Relying on Record Identification</a></li> <li><a href="#working-with-namespaces">Working with Namespaces</a></li> <li><a href="#forms-with-patch-put-or-delete-methods">Forms with PATCH, PUT, or DELETE Methods</a></li> </ul>
</li> <li>
<a href="#making-select-boxes-with-ease">Making Select Boxes with Ease</a> <ul> <li><a href="#option-groups-for-select-boxes">Option Groups for Select Boxes</a></li> <li><a href="#binding-select-boxes-to-model-objects">Binding Select Boxes to Model Objects</a></li> </ul>
</li> <li>
<a href="#using-date-and-time-form-helpers">Using Date and Time Form Helpers</a> <ul> <li><a href="#select-boxes-for-time-or-date-components">Select Boxes for Time or Date Components</a></li> <li><a href="#selecting-time-zone">Selecting Time Zone</a></li> </ul>
</li> <li>
<a href="#collection-related-helpers">Collection Related Helpers</a> <ul> <li><a href="#the-collection-select-helper">The <code>collection_select</code> Helper</a></li> <li><a href="#the-collection-radio-buttons-helper">The <code>collection_radio_buttons</code> Helper</a></li> <li><a href="#the-collection-check-boxes-helper">The <code>collection_check_boxes</code> Helper</a></li> </ul>
</li> <li>
<a href="#uploading-files">Uploading Files</a> <ul> <li><a href="#csv-file-upload-example">CSV File Upload Example</a></li> </ul>
</li> <li><a href="#customizing-form-builders">Customizing Form Builders</a></li> <li>
<a href="#form-input-naming-conventions-and-params-hash">Form Input Naming Conventions and <code>params</code> Hash</a> <ul> <li><a href="#basic-structure">Basic Structure</a></li> <li><a href="#combining-arrays-and-hashes">Combining Arrays and Hashes</a></li> <li><a href="#hashes-with-an-index">Hashes with an Index</a></li> </ul>
</li> <li>
<a href="#building-complex-forms">Building Complex Forms</a> <ul> <li><a href="#configuring-the-model-for-nested-attributes">Configuring the Model for Nested Attributes</a></li> <li><a href="#nested-forms-in-the-view">Nested Forms in the View</a></li> <li><a href="#permitting-parameters-in-the-controller">Permitting Parameters in the Controller</a></li> <li><a href="#removing-associated-objects">Removing Associated Objects</a></li> <li><a href="#preventing-empty-records">Preventing Empty Records</a></li> </ul>
</li> <li><a href="#forms-to-external-resources">Forms to External Resources</a></li> <li><a href="#using-tag-helpers-without-a-form-builder">Using Tag Helpers without a Form Builder</a></li> <li><a href="#using-form-tag-and-form-for">Using <code>form_tag</code> and <code>form_for</code></a></li> </ol>  <hr>  <p>This guide is not intended to be a complete list of all available form helpers. Please refer to <a href="https://edgeapi.rubyonrails.org/classes/ActionView/Helpers.html">the Rails API documentation</a> for an exhaustive list of form helpers and their arguments.</p>
<h1 id="working-with-basic-forms"><a class="anchorlink" href="#working-with-basic-forms"><span>1</span> Working with Basic Forms</a></h1>
<p>The main form helper is <a href="https://edgeapi.rubyonrails.org/classes/ActionView/Helpers/FormHelper.html#method-i-form_with"><code>form_with</code></a>.</p>
<div class="interstitial code"> <pre data-language="erb">&lt;%= form_with do |form| %&gt;
  Form contents
&lt;% end %&gt;</pre> <button class="clipboard-button" data-clipboard-text="&lt;%= form_with do |form| %&gt;
  Form contents
&lt;% end %&gt;
">Copy</button> </div> <p>When called without arguments, it creates an HTML <code>&lt;form&gt;</code> tag with the value of the <code>method</code> attribute set to <code>post</code> and the value of the <code>action</code> attribute set to the current page. For example, assuming the current page is a home page at <code>/home</code>, the generated HTML will look like this:</p>
<div class="interstitial code"> <pre data-language="html">&lt;form action="/home" accept-charset="UTF-8" method="post"&gt;
  &lt;input type="hidden" name="authenticity_token" value="Lz6ILqUEs2CGdDa-oz38TqcqQORavGnbGkG0CQA8zc8peOps-K7sHgFSTPSkBx89pQxh3p5zPIkjoOTiA_UWbQ" autocomplete="off"&gt;
  Form contents
&lt;/form&gt;</pre> <button class="clipboard-button" data-clipboard-text='&lt;form action="/home" accept-charset="UTF-8" method="post"&gt;
  &lt;input type="hidden" name="authenticity_token" value="Lz6ILqUEs2CGdDa-oz38TqcqQORavGnbGkG0CQA8zc8peOps-K7sHgFSTPSkBx89pQxh3p5zPIkjoOTiA_UWbQ" autocomplete="off"&gt;
  Form contents
&lt;/form&gt;
'>Copy</button> </div> <p>Notice that the form contains an <code>input</code> element with type <code>hidden</code>. This <code>authenticity_token</code> hidden input is required for non-GET form submissions. This token is a security feature in Rails used to prevent cross-site request forgery (CSRF) attacks, and form helpers automatically generate it for every non-GET form (assuming the security feature is enabled). You can read more about it in the <a href="security.html#cross-site-request-forgery-csrf">Securing Rails Applications</a> guide.</p>
<h2 id="a-generic-search-form"><a class="anchorlink" href="#a-generic-search-form"><span>1.1</span> A Generic Search Form</a></h2>
<p>One of the most basic forms on the web is a search form. This form contains:</p> <ul> <li>a form element with "GET" method,</li> <li>a label for the input,</li> <li>a text input element, and</li> <li>a submit element.</li> </ul> <p>Here is how to create a search form with <code>form_with</code>:</p>
<div class="interstitial code"> <pre data-language="erb">&lt;%= form_with url: "/search", method: :get do |form| %&gt;
  &lt;%= form.label :query, "Search for:" %&gt;
  &lt;%= form.text_field :query %&gt;
  &lt;%= form.submit "Search" %&gt;
&lt;% end %&gt;</pre> <button class="clipboard-button" data-clipboard-text='&lt;%= form_with url: "/search", method: :get do |form| %&gt;
  &lt;%= form.label :query, "Search for:" %&gt;
  &lt;%= form.text_field :query %&gt;
  &lt;%= form.submit "Search" %&gt;
&lt;% end %&gt;
'>Copy</button> </div> <p>This will generate the following HTML:</p>
<div class="interstitial code"> <pre data-language="html">&lt;form action="/search" accept-charset="UTF-8" method="get"&gt;
  &lt;label for="query"&gt;Search for:&lt;/label&gt;
  &lt;input type="text" name="query" id="query"&gt;
  &lt;input type="submit" name="commit" value="Search" data-disable-with="Search"&gt;
&lt;/form&gt;</pre> <button class="clipboard-button" data-clipboard-text='&lt;form action="/search" accept-charset="UTF-8" method="get"&gt;
  &lt;label for="query"&gt;Search for:&lt;/label&gt;
  &lt;input type="text" name="query" id="query"&gt;
  &lt;input type="submit" name="commit" value="Search" data-disable-with="Search"&gt;
&lt;/form&gt;
'>Copy</button> </div> <p>Notice that for the search form we are using the <code>url</code> option of <code>form_with</code>. Setting <code>url: "/search"</code> changes the form action value from the default current page path to <code>action="/search"</code>.</p>
<p>In general, passing <code>url: my_path</code> to <code>form_with</code> tells the form where to make the request. The other option is to pass Active Model objects to the form, as you will learn <a href="#creating-forms-with-model-objects">below</a>. You can also use <a href="routing.html#path-and-url-helpers">URL helpers</a>.</p>
<p>The search form example above also shows the <a href="https://edgeapi.rubyonrails.org/classes/ActionView/Helpers/FormBuilder.html">form builder</a> object. You will learn about the many helpers provided by the form builder object (like<code>form.label</code> and <code>form.text_field</code>) in the next section.</p>
<div class="interstitial info"><p>For every form <code>input</code> element, an <code>id</code> attribute is generated from its name (<code>"query"</code> in above example). These IDs can be very useful for CSS styling or manipulation of form controls with JavaScript.</p></div>
<div class="interstitial warning"><p>Use "GET" as the method for search forms. In general, Rails conventions encourage using the right HTTP verb for controller actions. Using "GET" for search allows users to bookmark a specific search.</p></div>
<h2 id="helpers-for-generating-form-elements"><a class="anchorlink" href="#helpers-for-generating-form-elements"><span>1.2</span> Helpers for Generating Form Elements</a></h2>
<p>The form builder object yielded by <code>form_with</code> provides many helper methods for generating common form elements such as text fields, checkboxes, and radio buttons.</p>
<p>The first argument to these methods is always the name of the input. This is useful to remember because when the form is submitted, that name will be passed to the controller along with the form data in the <code>params</code> hash. The name will be the key in the <code>params</code> for the value entered by the user for that field.</p>
<p>For example, if the form contains <code>&lt;%= form.text_field :query %&gt;</code>, then you would be able to get the value of this field in the controller with <code>params[:query]</code>.</p>
<p>When naming inputs, Rails uses certain conventions that make it possible to submit parameters with non-scalar values such as arrays or hashes, which will also be accessible in <code>params</code>. You can read more about them in the <a href="#form-input-naming-conventions-and-params-hash">Form Input Naming Conventions and Params Hash</a> section of this guide. For details on the precise usage of these helpers, please refer to the <a href="https://edgeapi.rubyonrails.org/classes/ActionView/Helpers/FormTagHelper.html">API documentation</a>.</p>
<h3 id="checkboxes"><a class="anchorlink" href="#checkboxes"><span>1.2.1</span> Checkboxes</a></h3>
<p>A Checkbox is a form control that allows for a single value to be selected or deselected. A group of Checkboxes is generally used to allow a user to choose one or more options from the group.</p>
<p>Here's an example with three checkboxes in a form:</p>
<div class="interstitial code"> <pre data-language="erb">&lt;%= form.check_box :biography %&gt;
&lt;%= form.label :biography, "Biography" %&gt;
&lt;%= form.check_box :romance %&gt;
&lt;%= form.label :romance, "Romance" %&gt;
&lt;%= form.check_box :mystery %&gt;
&lt;%= form.label :mystery, "Mystery" %&gt;</pre> <button class="clipboard-button" data-clipboard-text='&lt;%= form.check_box :biography %&gt;
&lt;%= form.label :biography, "Biography" %&gt;
&lt;%= form.check_box :romance %&gt;
&lt;%= form.label :romance, "Romance" %&gt;
&lt;%= form.check_box :mystery %&gt;
&lt;%= form.label :mystery, "Mystery" %&gt;
'>Copy</button> </div> <p>The above will generate the following:</p>
<div class="interstitial code"> <pre data-language="html">&lt;input name="biography" type="hidden" value="0" autocomplete="off"&gt;&lt;input type="checkbox" value="1" name="biography" id="biography"&gt;
&lt;label for="biography"&gt;Biography&lt;/label&gt;
&lt;input name="romance" type="hidden" value="0" autocomplete="off"&gt;&lt;input type="checkbox" value="1" name="romance" id="romance"&gt;
&lt;label for="romance"&gt;Romance&lt;/label&gt;
&lt;input name="mystery" type="hidden" value="0" autocomplete="off"&gt;&lt;input type="checkbox" value="1" name="mystery" id="mystery"&gt;
&lt;label for="mystery"&gt;Mystery&lt;/label&gt;</pre> <button class="clipboard-button" data-clipboard-text='&lt;input name="biography" type="hidden" value="0" autocomplete="off"&gt;&lt;input type="checkbox" value="1" name="biography" id="biography"&gt;
&lt;label for="biography"&gt;Biography&lt;/label&gt;
&lt;input name="romance" type="hidden" value="0" autocomplete="off"&gt;&lt;input type="checkbox" value="1" name="romance" id="romance"&gt;
&lt;label for="romance"&gt;Romance&lt;/label&gt;
&lt;input name="mystery" type="hidden" value="0" autocomplete="off"&gt;&lt;input type="checkbox" value="1" name="mystery" id="mystery"&gt;
&lt;label for="mystery"&gt;Mystery&lt;/label&gt;
'>Copy</button> </div> <p>The first parameter to <a href="https://edgeapi.rubyonrails.org/classes/ActionView/Helpers/FormBuilder.html#method-i-check_box"><code>check_box</code></a> is the name of the input which can be found in the <code>params</code> hash. If the user has checked the "Biography" checkbox only, the <code>params</code> hash would contain:</p>
<div class="interstitial code"> <pre data-language="ruby">{
  "biography" =&gt; "1",
  "romance" =&gt; "0",
  "mystery" =&gt; "0"
}</pre> <button class="clipboard-button" data-clipboard-text='{
  "biography" =&gt; "1",
  "romance" =&gt; "0",
  "mystery" =&gt; "0"
}
'>Copy</button> </div> <p>You can use <code>params[:biography]</code> to check if that checkbox is selected by the user.</p>
<p>The checkbox's values (the values that will appear in <code>params</code>) can optionally be specified using the <code>checked_value</code> and <code>unchecked_value</code> parameters. See the <a href="https://edgeapi.rubyonrails.org/classes/ActionView/Helpers/FormHelper.html#method-i-check_box">API documentation</a> for more details.</p>
<p>There is also a <code>collection_check_boxes</code>, which you can learn about in the <a href="#collection-related-helpers">Collection Related Helpers section</a>.</p>
<h3 id="radio-buttons"><a class="anchorlink" href="#radio-buttons"><span>1.2.2</span> Radio Buttons</a></h3>
<p>Radio buttons are form controls that only allow the user to select one option at a time from the list of choices.</p>
<p>For example, radio buttons for choosing your favorite ice cream flavor:</p>
<div class="interstitial code"> <pre data-language="erb">&lt;%= form.radio_button :flavor, "chocolate_chip" %&gt;
&lt;%= form.label :flavor_chocolate_chip, "Chocolate Chip" %&gt;
&lt;%= form.radio_button :flavor, "vanilla" %&gt;
&lt;%= form.label :flavor_vanilla, "Vanilla" %&gt;
&lt;%= form.radio_button :flavor, "hazelnut" %&gt;
&lt;%= form.label :flavor_hazelnut, "Hazelnut" %&gt;</pre> <button class="clipboard-button" data-clipboard-text='&lt;%= form.radio_button :flavor, "chocolate_chip" %&gt;
&lt;%= form.label :flavor_chocolate_chip, "Chocolate Chip" %&gt;
&lt;%= form.radio_button :flavor, "vanilla" %&gt;
&lt;%= form.label :flavor_vanilla, "Vanilla" %&gt;
&lt;%= form.radio_button :flavor, "hazelnut" %&gt;
&lt;%= form.label :flavor_hazelnut, "Hazelnut" %&gt;
'>Copy</button> </div> <p>The above will generate the following HTML:</p>
<div class="interstitial code"> <pre data-language="html">&lt;input type="radio" value="chocolate_chip" name="flavor" id="flavor_chocolate_chip"&gt;
&lt;label for="flavor_chocolate_chip"&gt;Chocolate Chip&lt;/label&gt;
&lt;input type="radio" value="vanilla" name="flavor" id="flavor_vanilla"&gt;
&lt;label for="flavor_vanilla"&gt;Vanilla&lt;/label&gt;
&lt;input type="radio" value="hazelnut" name="flavor" id="flavor_hazelnut"&gt;
&lt;label for="flavor_hazelnut"&gt;Hazelnut&lt;/label&gt;</pre> <button class="clipboard-button" data-clipboard-text='&lt;input type="radio" value="chocolate_chip" name="flavor" id="flavor_chocolate_chip"&gt;
&lt;label for="flavor_chocolate_chip"&gt;Chocolate Chip&lt;/label&gt;
&lt;input type="radio" value="vanilla" name="flavor" id="flavor_vanilla"&gt;
&lt;label for="flavor_vanilla"&gt;Vanilla&lt;/label&gt;
&lt;input type="radio" value="hazelnut" name="flavor" id="flavor_hazelnut"&gt;
&lt;label for="flavor_hazelnut"&gt;Hazelnut&lt;/label&gt;
'>Copy</button> </div> <p>The second argument to <a href="https://edgeapi.rubyonrails.org/classes/ActionView/Helpers/FormBuilder.html#method-i-radio_button"><code>radio_button</code></a> is the value of the input. Because these radio buttons share the same name (<code>flavor</code>), the user will only be able to select one of them, and <code>params[:flavor]</code> will contain either <code>"chocolate_chip"</code>, <code>"vanilla"</code>, or <code>hazelnut</code>.</p>
<div class="interstitial note"><p>Always use labels for checkbox and radio buttons. They associate text with a specific option using the <code>for</code> attribute and, by expanding the clickable region, make it easier for users to click the inputs.</p></div>
<h2 id="other-helpers-of-interest"><a class="anchorlink" href="#other-helpers-of-interest"><span>1.3</span> Other Helpers of Interest</a></h2>
<p>There are many other form controls including text, email, password, date, and time. The below examples show some more helpers and their generated HTML.</p>
<p>Date and time related helpers:</p>
<div class="interstitial code"> <pre data-language="erb">&lt;%= form.date_field :born_on %&gt;
&lt;%= form.time_field :started_at %&gt;
&lt;%= form.datetime_local_field :graduation_day %&gt;
&lt;%= form.month_field :birthday_month %&gt;
&lt;%= form.week_field :birthday_week %&gt;</pre> <button class="clipboard-button" data-clipboard-text="&lt;%= form.date_field :born_on %&gt;
&lt;%= form.time_field :started_at %&gt;
&lt;%= form.datetime_local_field :graduation_day %&gt;
&lt;%= form.month_field :birthday_month %&gt;
&lt;%= form.week_field :birthday_week %&gt;
">Copy</button> </div> <p>Output:</p>
<div class="interstitial code"> <pre data-language="html">&lt;input type="date" name="born_on" id="born_on"&gt;
&lt;input type="time" name="started_at" id="started_at"&gt;
&lt;input type="datetime-local" name="graduation_day" id="graduation_day"&gt;
&lt;input type="month" name="birthday_month" id="birthday_month"&gt;
&lt;input type="week" name="birthday_week" id="birthday_week"&gt;</pre> <button class="clipboard-button" data-clipboard-text='&lt;input type="date" name="born_on" id="born_on"&gt;
&lt;input type="time" name="started_at" id="started_at"&gt;
&lt;input type="datetime-local" name="graduation_day" id="graduation_day"&gt;
&lt;input type="month" name="birthday_month" id="birthday_month"&gt;
&lt;input type="week" name="birthday_week" id="birthday_week"&gt;
'>Copy</button> </div> <p>Helpers with special formatting:</p>
<div class="interstitial code"> <pre data-language="erb">&lt;%= form.password_field :password %&gt;
&lt;%= form.email_field :address %&gt;
&lt;%= form.telephone_field :phone %&gt;
&lt;%= form.url_field :homepage %&gt;</pre> <button class="clipboard-button" data-clipboard-text="&lt;%= form.password_field :password %&gt;
&lt;%= form.email_field :address %&gt;
&lt;%= form.telephone_field :phone %&gt;
&lt;%= form.url_field :homepage %&gt;
">Copy</button> </div> <p>Output:</p>
<div class="interstitial code"> <pre data-language="html">&lt;input type="password" name="password" id="password"&gt;
&lt;input type="email" name="address" id="address"&gt;
&lt;input type="tel" name="phone" id="phone"&gt;
&lt;input type="url" name="homepage" id="homepage"&gt;</pre> <button class="clipboard-button" data-clipboard-text='&lt;input type="password" name="password" id="password"&gt;
&lt;input type="email" name="address" id="address"&gt;
&lt;input type="tel" name="phone" id="phone"&gt;
&lt;input type="url" name="homepage" id="homepage"&gt;
'>Copy</button> </div> <p>Other common helpers:</p>
<div class="interstitial code"> <pre data-language="erb">&lt;%= form.text_area :message, size: "70x5" %&gt;
&lt;%= form.hidden_field :parent_id, value: "foo" %&gt;
&lt;%= form.number_field :price, in: 1.0..20.0, step: 0.5 %&gt;
&lt;%= form.range_field :discount, in: 1..100 %&gt;
&lt;%= form.search_field :name %&gt;
&lt;%= form.color_field :favorite_color %&gt;</pre> <button class="clipboard-button" data-clipboard-text='&lt;%= form.text_area :message, size: "70x5" %&gt;
&lt;%= form.hidden_field :parent_id, value: "foo" %&gt;
&lt;%= form.number_field :price, in: 1.0..20.0, step: 0.5 %&gt;
&lt;%= form.range_field :discount, in: 1..100 %&gt;
&lt;%= form.search_field :name %&gt;
&lt;%= form.color_field :favorite_color %&gt;
'>Copy</button> </div> <p>Output:</p>
<div class="interstitial code"> <pre data-language="html">&lt;textarea name="message" id="message" cols="70" rows="5"&gt;&lt;/textarea&gt;
&lt;input value="foo" autocomplete="off" type="hidden" name="parent_id" id="parent_id"&gt;
&lt;input step="0.5" min="1.0" max="20.0" type="number" name="price" id="price"&gt;
&lt;input min="1" max="100" type="range" name="discount" id="discount"&gt;
&lt;input type="search" name="name" id="name"&gt;
&lt;input value="#000000" type="color" name="favorite_color" id="favorite_color"&gt;</pre> <button class="clipboard-button" data-clipboard-text='&lt;textarea name="message" id="message" cols="70" rows="5"&gt;&lt;/textarea&gt;
&lt;input value="foo" autocomplete="off" type="hidden" name="parent_id" id="parent_id"&gt;
&lt;input step="0.5" min="1.0" max="20.0" type="number" name="price" id="price"&gt;
&lt;input min="1" max="100" type="range" name="discount" id="discount"&gt;
&lt;input type="search" name="name" id="name"&gt;
&lt;input value="#000000" type="color" name="favorite_color" id="favorite_color"&gt;
'>Copy</button> </div> <p>Hidden inputs are not shown to the user but instead hold data like any textual input. Values inside them can be changed with JavaScript.</p>
<div class="interstitial info"><p>If you're using password input fields, you might want to configure your application to prevent those parameters from being logged. You can learn about how in the <a href="security.html#logging">Securing Rails Applications</a> guide.</p></div>
<h1 id="creating-forms-with-model-objects"><a class="anchorlink" href="#creating-forms-with-model-objects"><span>2</span> Creating Forms with Model Objects</a></h1>
<h2 id="binding-a-form-to-an-object"><a class="anchorlink" href="#binding-a-form-to-an-object"><span>2.1</span> Binding a Form to an Object</a></h2>
<p>The <code>form_with</code> helper has a <code>:model</code> option that allows you to bind the form builder object to a model object. This means that the form will be scoped to that model object, and the form's fields will be populated with values from that model object.</p>
<p>For example, if we have a <code>@book</code> model object:</p>
<div class="interstitial code"> <pre data-language="ruby">@book = Book.find(42)
# =&gt; #&lt;Book id: 42, title: "Walden", author: "Henry David Thoreau"&gt;</pre> <button class="clipboard-button" data-clipboard-text='@book = Book.find(42)
# =&gt; #&lt;Book id: 42, title: "Walden", author: "Henry David Thoreau"&gt;
'>Copy</button> </div> <p>And the following form to create a new book:</p>
<div class="interstitial code"> <pre data-language="erb">&lt;%= form_with model: @book do |form| %&gt;
  &lt;div&gt;
    &lt;%= form.label :title %&gt;
    &lt;%= form.text_field :title %&gt;
  &lt;/div&gt;
  &lt;div&gt;
    &lt;%= form.label :author %&gt;
    &lt;%= form.text_field :author %&gt;
  &lt;/div&gt;
  &lt;%= form.submit %&gt;
&lt;% end %&gt;</pre> <button class="clipboard-button" data-clipboard-text="&lt;%= form_with model: @book do |form| %&gt;
  &lt;div&gt;
    &lt;%= form.label :title %&gt;
    &lt;%= form.text_field :title %&gt;
  &lt;/div&gt;
  &lt;div&gt;
    &lt;%= form.label :author %&gt;
    &lt;%= form.text_field :author %&gt;
  &lt;/div&gt;
  &lt;%= form.submit %&gt;
&lt;% end %&gt;
">Copy</button> </div> <p>It will generate this HTML:</p>
<div class="interstitial code"> <pre data-language="html">&lt;form action="/books" accept-charset="UTF-8" method="post"&gt;
  &lt;input type="hidden" name="authenticity_token" value="ChwHeyegcpAFDdBvXvDuvbfW7yCA3e8gvhyieai7DhG28C3akh-dyuv-IBittsjPrIjETlQQvQJ91T77QQ8xWA" autocomplete="off"&gt;
  &lt;div&gt;
    &lt;label for="book_title"&gt;Title&lt;/label&gt;
    &lt;input type="text" name="book[title]" id="book_title"&gt;
  &lt;/div&gt;
  &lt;div&gt;
    &lt;label for="book_author"&gt;Author&lt;/label&gt;
    &lt;input type="text" name="book[author]" id="book_author"&gt;
  &lt;/div&gt;
  &lt;input type="submit" name="commit" value="Create Book" data-disable-with="Create Book"&gt;
&lt;/form&gt;</pre> <button class="clipboard-button" data-clipboard-text='&lt;form action="/books" accept-charset="UTF-8" method="post"&gt;
  &lt;input type="hidden" name="authenticity_token" value="ChwHeyegcpAFDdBvXvDuvbfW7yCA3e8gvhyieai7DhG28C3akh-dyuv-IBittsjPrIjETlQQvQJ91T77QQ8xWA" autocomplete="off"&gt;
  &lt;div&gt;
    &lt;label for="book_title"&gt;Title&lt;/label&gt;
    &lt;input type="text" name="book[title]" id="book_title"&gt;
  &lt;/div&gt;
  &lt;div&gt;
    &lt;label for="book_author"&gt;Author&lt;/label&gt;
    &lt;input type="text" name="book[author]" id="book_author"&gt;
  &lt;/div&gt;
  &lt;input type="submit" name="commit" value="Create Book" data-disable-with="Create Book"&gt;
&lt;/form&gt;
'>Copy</button> </div> <p>Some important things to notice when using <code>form_with</code> with a model object:</p> <ul> <li>The form <code>action</code> is automatically filled with an appropriate value, <code>action="/books"</code>. If you were updating a book, it would be <code>action="/books/42"</code>.</li> <li>The form field names are scoped with <code>book[...]</code>. This means that <code>params[:book]</code> will be a hash containing all these field's values. You can read more about the significance of input names in chapter <a href="#form-input-naming-conventions-and-params-hash">Form Input Naming Conventions and Params Hash</a> of this guide.</li> <li>The submit button is automatically given an appropriate text value, "Create Book" in this case.</li> </ul> <div class="interstitial info"><p>Typically your form inputs will mirror model attributes. However, they don't have to. If there is other information you need you can include a field in your form and access it via <code>params[:book][:my_non_attribute_input]</code>.</p></div>
<h3 id="composite-primary-key-forms"><a class="anchorlink" href="#composite-primary-key-forms"><span>2.1.1</span> Composite Primary Key Forms</a></h3>
<p>If you have a model with a <a href="active_record_composite_primary_keys.html">composite primary key</a>, the form building syntax is the same with slightly different output.</p>
<p>For example, to update a <code>@book</code> model object with a composite key <code>[:author_id, :id]</code> like this:</p>
<div class="interstitial code"> <pre data-language="ruby">@book = Book.find([2, 25])
# =&gt; #&lt;Book id: 25, title: "Some book", author_id: 2&gt;</pre> <button class="clipboard-button" data-clipboard-text='@book = Book.find([2, 25])
# =&gt; #&lt;Book id: 25, title: "Some book", author_id: 2&gt;
'>Copy</button> </div> <p>The following form:</p>
<div class="interstitial code"> <pre data-language="erb">&lt;%= form_with model: @book do |form| %&gt;
  &lt;%= form.text_field :title %&gt;
  &lt;%= form.submit %&gt;
&lt;% end %&gt;</pre> <button class="clipboard-button" data-clipboard-text="&lt;%= form_with model: @book do |form| %&gt;
  &lt;%= form.text_field :title %&gt;
  &lt;%= form.submit %&gt;
&lt;% end %&gt;
">Copy</button> </div> <p>Will generate this HTML output:</p>
<div class="interstitial code"> <pre data-language="html">&lt;form action="/books/2_25" method="post" accept-charset="UTF-8" &gt;
  &lt;input name="authenticity_token" type="hidden" value="ChwHeyegcpAFDdBvXvDuvbfW7yCA3e8gvhyieai7DhG28C3akh-dyuv-IBittsjPrIjETlQQvQJ91T77QQ8xWA" /&gt;
  &lt;input type="text" name="book[title]" id="book_title" value="Some book" /&gt;
  &lt;input type="submit" name="commit" value="Update Book" data-disable-with="Update Book"&gt;
&lt;/form&gt;</pre> <button class="clipboard-button" data-clipboard-text='&lt;form action="/books/2_25" method="post" accept-charset="UTF-8" &gt;
  &lt;input name="authenticity_token" type="hidden" value="ChwHeyegcpAFDdBvXvDuvbfW7yCA3e8gvhyieai7DhG28C3akh-dyuv-IBittsjPrIjETlQQvQJ91T77QQ8xWA" /&gt;
  &lt;input type="text" name="book[title]" id="book_title" value="Some book" /&gt;
  &lt;input type="submit" name="commit" value="Update Book" data-disable-with="Update Book"&gt;
&lt;/form&gt;
'>Copy</button> </div> <p>Note the generated URL contains the <code>author_id</code> and <code>id</code> delimited by an underscore. Once submitted, the controller can <a href="action_controller_overview.html#composite-key-parameters">extract each primary key value</a> from the parameters and update the record as it would with a singular primary key.</p>
<h3 id="the-fields-for-helper"><a class="anchorlink" href="#the-fields-for-helper"><span>2.1.2</span> The <code>fields_for</code> Helper</a></h3>
<p>The <code>fields_for</code> helper is used to render fields for related model objects within the same form. The associated "inner" model is usually related to the "main" form model via an Active Record association. For example, if you had a <code>Person</code> model with an associated <code>ContactDetail</code> model, you could create a single form with inputs for both models like so:</p>
<div class="interstitial code"> <pre data-language="erb">&lt;%= form_with model: @person do |person_form| %&gt;
  &lt;%= person_form.text_field :name %&gt;
  &lt;%= fields_for :contact_detail, @person.contact_detail do |contact_detail_form| %&gt;
    &lt;%= contact_detail_form.text_field :phone_number %&gt;
  &lt;% end %&gt;
&lt;% end %&gt;</pre> <button class="clipboard-button" data-clipboard-text="&lt;%= form_with model: @person do |person_form| %&gt;
  &lt;%= person_form.text_field :name %&gt;
  &lt;%= fields_for :contact_detail, @person.contact_detail do |contact_detail_form| %&gt;
    &lt;%= contact_detail_form.text_field :phone_number %&gt;
  &lt;% end %&gt;
&lt;% end %&gt;
">Copy</button> </div> <p>The above will produce the following output:</p>
<div class="interstitial code"> <pre data-language="html">&lt;form action="/people" accept-charset="UTF-8" method="post"&gt;
  &lt;input type="hidden" name="authenticity_token" value="..." autocomplete="off" /&gt;
  &lt;input type="text" name="person[name]" id="person_name" /&gt;
  &lt;input type="text" name="contact_detail[phone_number]" id="contact_detail_phone_number" /&gt;
&lt;/form&gt;</pre> <button class="clipboard-button" data-clipboard-text='&lt;form action="/people" accept-charset="UTF-8" method="post"&gt;
  &lt;input type="hidden" name="authenticity_token" value="..." autocomplete="off" /&gt;
  &lt;input type="text" name="person[name]" id="person_name" /&gt;
  &lt;input type="text" name="contact_detail[phone_number]" id="contact_detail_phone_number" /&gt;
&lt;/form&gt;
'>Copy</button> </div> <p>The object yielded by <code>fields_for</code> is a form builder like the one yielded by <code>form_with</code>. The <code>fields_for</code> helper creates a similar binding but without rendering a <code>&lt;form&gt;</code> tag. You can learn more about <code>field_for</code> in the <a href="https://edgeapi.rubyonrails.org/classes/ActionView/Helpers/FormBuilder.html#method-i-fields_for">API docs</a>.</p>
<h2 id="relying-on-record-identification"><a class="anchorlink" href="#relying-on-record-identification"><span>2.2</span> Relying on Record Identification</a></h2>
<p>When dealing with RESTful resources, calls to <code>form_with</code> can be simplified by relying on <strong>record identification</strong>. This means you pass the model instance and have Rails figure out the model name, method, and other things. In the example below for creating a new record, both calls to <code>form_with</code> generate the same HTML:</p>
<div class="interstitial code"> <pre data-language="ruby"># longer way:
form_with(model: @article, url: articles_path)
# short-hand:
form_with(model: @article)</pre> <button class="clipboard-button" data-clipboard-text="# longer way:
form_with(model: @article, url: articles_path)
# short-hand:
form_with(model: @article)
">Copy</button> </div> <p>Similarly, for editing an existing article like below, both the calls to <code>form_with</code> will also generate the same HTML:</p>
<div class="interstitial code"> <pre data-language="ruby"># longer way:
form_with(model: @article, url: article_path(@article), method: "patch")
# short-hand:
form_with(model: @article)</pre> <button class="clipboard-button" data-clipboard-text='# longer way:
form_with(model: @article, url: article_path(@article), method: "patch")
# short-hand:
form_with(model: @article)
'>Copy</button> </div> <p>Notice how the short-hand <code>form_with</code> invocation is conveniently the same, regardless of the record being new or existing. Record identification is smart enough to figure out if the record is new by asking <a href="https://edgeapi.rubyonrails.org/classes/ActiveRecord/Persistence.html#method-i-persisted-3F"><code>record.persisted?</code></a>. It also selects the correct path to submit to, and the name based on the class of the object.</p>
<p>This is assuming that the <code>Article</code> model is declared with <code>resources :articles</code> in the routes file.</p>
<p>If you have a <a href="routing.html#singular-resources">singular resource</a>, you will need to call <code>resource</code> and <code>resolve</code> for it to work with <code>form_with</code>:</p>
<div class="interstitial code"> <pre data-language="ruby">resource :article
resolve('Article') { [:article] }</pre> <button class="clipboard-button" data-clipboard-text="resource :article
resolve('Article') { [:article] }
">Copy</button> </div> <div class="interstitial info"><p>Declaring a resource has a number of side effects. See the <a href="routing.html#resource-routing-the-rails-default">Rails Routing from the Outside In</a> guide for more information on setting up and using resources.</p></div>
<div class="interstitial warning"><p>When you're using <a href="association_basics.html#single-table-inheritance-sti">single-table inheritance</a> with your models, you can't rely on record identification on a subclass if only their parent class is declared a resource. You will have to specify <code>:url</code>, and <code>:scope</code> (the model name) explicitly.</p></div>
<h2 id="working-with-namespaces"><a class="anchorlink" href="#working-with-namespaces"><span>2.3</span> Working with Namespaces</a></h2>
<p>If you have namespaced routes, <code>form_with</code> has a shorthand for that. For example, if your application has an <code>admin</code> namespace:</p>
<div class="interstitial code"> <pre data-language="ruby">form_with model: [:admin, @article]</pre> <button class="clipboard-button" data-clipboard-text="form_with model: [:admin, @article]
">Copy</button> </div> <p>The above will create a form that submits to the <code>Admin::ArticlesController</code> inside the admin namespace, therefore submitting to <code>admin_article_path(@article)</code> in the case of an update.</p>
<p>If you have several levels of namespacing then the syntax is similar:</p>
<div class="interstitial code"> <pre data-language="ruby">form_with model: [:admin, :management, @article]</pre> <button class="clipboard-button" data-clipboard-text="form_with model: [:admin, :management, @article]
">Copy</button> </div> <p>For more information on Rails' routing system and the associated conventions, please see the <a href="routing.html">Rails Routing from the Outside In</a> guide.</p>
<h2 id="forms-with-patch-put-or-delete-methods"><a class="anchorlink" href="#forms-with-patch-put-or-delete-methods"><span>2.4</span> Forms with PATCH, PUT, or DELETE Methods</a></h2>
<p>The Rails framework encourages RESTful design, which means forms in your application will make requests where the <code>method</code> is <code>PATCH</code>, <code>PUT</code>, or <code>DELETE</code> in addition to <code>GET</code> and <code>POST</code>. However, HTML forms <em>don't support</em> methods other than <code>GET</code> and <code>POST</code> when it comes to submitting forms.</p>
<p>Rails works around this limitation by emulating other methods over POST with a hidden input named <code>"_method"</code>. For example:</p>
<div class="interstitial code"> <pre data-language="ruby">form_with(url: search_path, method: "patch")</pre> <button class="clipboard-button" data-clipboard-text='form_with(url: search_path, method: "patch")
'>Copy</button> </div> <p>The above form Will generate this HTML output:</p>
<div class="interstitial code"> <pre data-language="html">&lt;form action="/search" accept-charset="UTF-8" method="post"&gt;
  &lt;input type="hidden" name="_method" value="patch" autocomplete="off"&gt;
  &lt;input type="hidden" name="authenticity_token" value="R4quRuXQAq75TyWpSf8AwRyLt-R1uMtPP1dHTTWJE5zbukiaY8poSTXxq3Z7uAjXfPHiKQDsWE1i2_-h0HSktQ" autocomplete="off"&gt;
&lt;!-- ... --&gt;
&lt;/form&gt;</pre> <button class="clipboard-button" data-clipboard-text='&lt;form action="/search" accept-charset="UTF-8" method="post"&gt;
  &lt;input type="hidden" name="_method" value="patch" autocomplete="off"&gt;
  &lt;input type="hidden" name="authenticity_token" value="R4quRuXQAq75TyWpSf8AwRyLt-R1uMtPP1dHTTWJE5zbukiaY8poSTXxq3Z7uAjXfPHiKQDsWE1i2_-h0HSktQ" autocomplete="off"&gt;
&lt;!-- ... --&gt;
&lt;/form&gt;
'>Copy</button> </div> <p>When parsing POSTed data, Rails will take into account the special <code>_method</code> parameter and proceed as if the request's HTTP method was the one set as the value of <code>_method</code> (<code>PATCH</code> in this example).</p>
<p>When rendering a form, submission buttons can override the declared <code>method</code> attribute through the <code>formmethod:</code> keyword:</p>
<div class="interstitial code"> <pre data-language="erb">&lt;%= form_with url: "/posts/1", method: :patch do |form| %&gt;
  &lt;%= form.button "Delete", formmethod: :delete, data: { confirm: "Are you sure?" } %&gt;
  &lt;%= form.button "Update" %&gt;
&lt;% end %&gt;</pre> <button class="clipboard-button" data-clipboard-text='&lt;%= form_with url: "/posts/1", method: :patch do |form| %&gt;
  &lt;%= form.button "Delete", formmethod: :delete, data: { confirm: "Are you sure?" } %&gt;
  &lt;%= form.button "Update" %&gt;
&lt;% end %&gt;
'>Copy</button> </div> <p>Similar to <code>&lt;form&gt;</code> elements, most browsers <em>don't support</em> overriding form methods declared through <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/button#attr-formmethod">formmethod</a> other than <code>GET</code> and <code>POST</code>.</p>
<p>Rails works around this issue by emulating other methods over POST through a combination of <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/button#attr-formmethod">formmethod</a>, <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/button#attr-value">value</a>, and <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/button#attr-name">name</a> attributes:</p>
<div class="interstitial code"> <pre data-language="html">&lt;form accept-charset="UTF-8" action="/posts/1" method="post"&gt;
  &lt;input name="_method" type="hidden" value="patch" /&gt;
  &lt;input name="authenticity_token" type="hidden" value="f755bb0ed134b76c432144748a6d4b7a7ddf2b71" /&gt;
  &lt;!-- ... --&gt;

  &lt;button type="submit" formmethod="post" name="_method" value="delete" data-confirm="Are you sure?"&gt;Delete&lt;/button&gt;
  &lt;button type="submit" name="button"&gt;Update&lt;/button&gt;
&lt;/form&gt;</pre> <button class="clipboard-button" data-clipboard-text='&lt;form accept-charset="UTF-8" action="/posts/1" method="post"&gt;
  &lt;input name="_method" type="hidden" value="patch" /&gt;
  &lt;input name="authenticity_token" type="hidden" value="f755bb0ed134b76c432144748a6d4b7a7ddf2b71" /&gt;
  &lt;!-- ... --&gt;

  &lt;button type="submit" formmethod="post" name="_method" value="delete" data-confirm="Are you sure?"&gt;Delete&lt;/button&gt;
  &lt;button type="submit" name="button"&gt;Update&lt;/button&gt;
&lt;/form&gt;
'>Copy</button> </div> <p>In this case, the "Update" button will be treated as <code>PATCH</code> and the "Delete" button will be treated as <code>DELETE</code>.</p>
<h1 id="making-select-boxes-with-ease"><a class="anchorlink" href="#making-select-boxes-with-ease"><span>3</span> Making Select Boxes with Ease</a></h1>
<p>Select boxes, also known as drop-down list, allow users to select from a list of options. The HTML for select boxes requires a decent amount of markup - one <code>&lt;option&gt;</code> element for each option to choose from. Rails provides helper methods to help generate that markup.</p>
<p>For example, let's say we have a list of cities for the user to choose from. We can use the <a href="https://edgeapi.rubyonrails.org/classes/ActionView/Helpers/FormBuilder.html#method-i-select"><code>select</code></a> helper:</p>
<div class="interstitial code"> <pre data-language="erb">&lt;%= form.select :city, ["Berlin", "Chicago", "Madrid"] %&gt;</pre> <button class="clipboard-button" data-clipboard-text='&lt;%= form.select :city, ["Berlin", "Chicago", "Madrid"] %&gt;
'>Copy</button> </div> <p>The above will generate this HTML output:</p>
<div class="interstitial code"> <pre data-language="html">&lt;select name="city" id="city"&gt;
  &lt;option value="Berlin"&gt;Berlin&lt;/option&gt;
  &lt;option value="Chicago"&gt;Chicago&lt;/option&gt;
  &lt;option value="Madrid"&gt;Madrid&lt;/option&gt;
&lt;/select&gt;</pre> <button class="clipboard-button" data-clipboard-text='&lt;select name="city" id="city"&gt;
  &lt;option value="Berlin"&gt;Berlin&lt;/option&gt;
  &lt;option value="Chicago"&gt;Chicago&lt;/option&gt;
  &lt;option value="Madrid"&gt;Madrid&lt;/option&gt;
&lt;/select&gt;
'>Copy</button> </div> <p>And the selection will be available in <code>params[:city]</code> as usual.</p>
<p>We can also specify <code>&lt;option&gt;</code> values that differ from their labels:</p>
<div class="interstitial code"> <pre data-language="erb">&lt;%= form.select :city, [["Berlin", "BE"], ["Chicago", "CHI"], ["Madrid", "MD"]] %&gt;</pre> <button class="clipboard-button" data-clipboard-text='&lt;%= form.select :city, [["Berlin", "BE"], ["Chicago", "CHI"], ["Madrid", "MD"]] %&gt;
'>Copy</button> </div> <p>Output:</p>
<div class="interstitial code"> <pre data-language="html">&lt;select name="city" id="city"&gt;
  &lt;option value="BE"&gt;Berlin&lt;/option&gt;
  &lt;option value="CHI"&gt;Chicago&lt;/option&gt;
  &lt;option value="MD"&gt;Madrid&lt;/option&gt;
&lt;/select&gt;</pre> <button class="clipboard-button" data-clipboard-text='&lt;select name="city" id="city"&gt;
  &lt;option value="BE"&gt;Berlin&lt;/option&gt;
  &lt;option value="CHI"&gt;Chicago&lt;/option&gt;
  &lt;option value="MD"&gt;Madrid&lt;/option&gt;
&lt;/select&gt;
'>Copy</button> </div> <p>This way, the user will see the full city name, but <code>params[:city]</code> will be one of <code>"BE"</code>, <code>"CHI"</code>, or <code>"MD"</code>.</p>
<p>Lastly, we can specify a default choice for the select box with the <code>:selected</code> argument:</p>
<div class="interstitial code"> <pre data-language="erb">&lt;%= form.select :city, [["Berlin", "BE"], ["Chicago", "CHI"], ["Madrid", "MD"]], selected: "CHI" %&gt;</pre> <button class="clipboard-button" data-clipboard-text='&lt;%= form.select :city, [["Berlin", "BE"], ["Chicago", "CHI"], ["Madrid", "MD"]], selected: "CHI" %&gt;
'>Copy</button> </div> <p>Output:</p>
<div class="interstitial code"> <pre data-language="html">&lt;select name="city" id="city"&gt;
  &lt;option value="BE"&gt;Berlin&lt;/option&gt;
  &lt;option value="CHI" selected="selected"&gt;Chicago&lt;/option&gt;
  &lt;option value="MD"&gt;Madrid&lt;/option&gt;
&lt;/select&gt;</pre> <button class="clipboard-button" data-clipboard-text='&lt;select name="city" id="city"&gt;
  &lt;option value="BE"&gt;Berlin&lt;/option&gt;
  &lt;option value="CHI" selected="selected"&gt;Chicago&lt;/option&gt;
  &lt;option value="MD"&gt;Madrid&lt;/option&gt;
&lt;/select&gt;
'>Copy</button> </div> <h2 id="option-groups-for-select-boxes"><a class="anchorlink" href="#option-groups-for-select-boxes"><span>3.1</span> Option Groups for Select Boxes</a></h2>
<p>In some cases we may want to improve the user experience by grouping related options together. We can do so by passing a <code>Hash</code> (or comparable <code>Array</code>) to <code>select</code>:</p>
<div class="interstitial code"> <pre data-language="erb">&lt;%= form.select :city,
      {
        "Europe" =&gt; [ ["Berlin", "BE"], ["Madrid", "MD"] ],
        "North America" =&gt; [ ["Chicago", "CHI"] ],
      },
      selected: "CHI" %&gt;</pre> <button class="clipboard-button" data-clipboard-text='&lt;%= form.select :city,
      {
        "Europe" =&gt; [ ["Berlin", "BE"], ["Madrid", "MD"] ],
        "North America" =&gt; [ ["Chicago", "CHI"] ],
      },
      selected: "CHI" %&gt;
'>Copy</button> </div> <p>Output:</p>
<div class="interstitial code"> <pre data-language="html">&lt;select name="city" id="city"&gt;
  &lt;optgroup label="Europe"&gt;
    &lt;option value="BE"&gt;Berlin&lt;/option&gt;
    &lt;option value="MD"&gt;Madrid&lt;/option&gt;
  &lt;/optgroup&gt;
  &lt;optgroup label="North America"&gt;
    &lt;option value="CHI" selected="selected"&gt;Chicago&lt;/option&gt;
  &lt;/optgroup&gt;
&lt;/select&gt;</pre> <button class="clipboard-button" data-clipboard-text='&lt;select name="city" id="city"&gt;
  &lt;optgroup label="Europe"&gt;
    &lt;option value="BE"&gt;Berlin&lt;/option&gt;
    &lt;option value="MD"&gt;Madrid&lt;/option&gt;
  &lt;/optgroup&gt;
  &lt;optgroup label="North America"&gt;
    &lt;option value="CHI" selected="selected"&gt;Chicago&lt;/option&gt;
  &lt;/optgroup&gt;
&lt;/select&gt;
'>Copy</button> </div> <h2 id="binding-select-boxes-to-model-objects"><a class="anchorlink" href="#binding-select-boxes-to-model-objects"><span>3.2</span> Binding Select Boxes to Model Objects</a></h2>
<p>Like other form controls, a select box can be bound to a model attribute. For example, if we have a <code>@person</code> model object like:</p>
<div class="interstitial code"> <pre data-language="ruby">@person = Person.new(city: "MD")</pre> <button class="clipboard-button" data-clipboard-text='@person = Person.new(city: "MD")
'>Copy</button> </div> <p>The following form:</p>
<div class="interstitial code"> <pre data-language="erb">&lt;%= form_with model: @person do |form| %&gt;
  &lt;%= form.select :city, [["Berlin", "BE"], ["Chicago", "CHI"], ["Madrid", "MD"]] %&gt;
&lt;% end %&gt;</pre> <button class="clipboard-button" data-clipboard-text='&lt;%= form_with model: @person do |form| %&gt;
  &lt;%= form.select :city, [["Berlin", "BE"], ["Chicago", "CHI"], ["Madrid", "MD"]] %&gt;
&lt;% end %&gt;
'>Copy</button> </div> <p>Will output this select box:</p>
<div class="interstitial code"> <pre data-language="html">&lt;select name="person[city]" id="person_city"&gt;
  &lt;option value="BE"&gt;Berlin&lt;/option&gt;
  &lt;option value="CHI"&gt;Chicago&lt;/option&gt;
  &lt;option value="MD" selected="selected"&gt;Madrid&lt;/option&gt;
&lt;/select&gt;</pre> <button class="clipboard-button" data-clipboard-text='&lt;select name="person[city]" id="person_city"&gt;
  &lt;option value="BE"&gt;Berlin&lt;/option&gt;
  &lt;option value="CHI"&gt;Chicago&lt;/option&gt;
  &lt;option value="MD" selected="selected"&gt;Madrid&lt;/option&gt;
&lt;/select&gt;
'>Copy</button> </div> <p>The only difference is that the selected option will be found in <code>params[:person][:city]</code> instead of <code>params[:city]</code>.</p>
<p>Notice that the appropriate option was automatically marked <code>selected="selected"</code>. Since this select box was bound to an existing <code>@person</code> record, we didn't need to specify a <code>:selected</code> argument.</p>
<h1 id="using-date-and-time-form-helpers"><a class="anchorlink" href="#using-date-and-time-form-helpers"><span>4</span> Using Date and Time Form Helpers</a></h1>
<p>In addition to the <code>date_field</code> and <code>time_field</code> helpers mentioned <a href="#other-helpers-of-interest">earlier</a>, Rails provides alternative date and time form helpers that render plain select boxes. The <code>date_select</code> helper renders a separate select box for year, month, and day.</p>
<p>For example, if we have a <code>@person</code> model object like:</p>
<div class="interstitial code"> <pre data-language="ruby">@person = Person.new(birth_date: Date.new(1995, 12, 21))</pre> <button class="clipboard-button" data-clipboard-text="@person = Person.new(birth_date: Date.new(1995, 12, 21))
">Copy</button> </div> <p>The following form:</p>
<div class="interstitial code"> <pre data-language="erb">&lt;%= form_with model: @person do |form| %&gt;
  &lt;%= form.date_select :birth_date %&gt;
&lt;% end %&gt;</pre> <button class="clipboard-button" data-clipboard-text="&lt;%= form_with model: @person do |form| %&gt;
  &lt;%= form.date_select :birth_date %&gt;
&lt;% end %&gt;
">Copy</button> </div> <p>Will output select boxes like:</p>
<div class="interstitial code"> <pre data-language="html">&lt;select name="person[birth_date(1i)]" id="person_birth_date_1i"&gt;
  &lt;option value="1990"&gt;1990&lt;/option&gt;
  &lt;option value="1991"&gt;1991&lt;/option&gt;
  &lt;option value="1992"&gt;1992&lt;/option&gt;
  &lt;option value="1993"&gt;1993&lt;/option&gt;
  &lt;option value="1994"&gt;1994&lt;/option&gt;
  &lt;option value="1995" selected="selected"&gt;1995&lt;/option&gt;
  &lt;option value="1996"&gt;1996&lt;/option&gt;
  &lt;option value="1997"&gt;1997&lt;/option&gt;
  &lt;option value="1998"&gt;1998&lt;/option&gt;
  &lt;option value="1999"&gt;1999&lt;/option&gt;
  &lt;option value="2000"&gt;2000&lt;/option&gt;
&lt;/select&gt;
&lt;select name="person[birth_date(2i)]" id="person_birth_date_2i"&gt;
  &lt;option value="1"&gt;January&lt;/option&gt;
  &lt;option value="2"&gt;February&lt;/option&gt;
  &lt;option value="3"&gt;March&lt;/option&gt;
  &lt;option value="4"&gt;April&lt;/option&gt;
  &lt;option value="5"&gt;May&lt;/option&gt;
  &lt;option value="6"&gt;June&lt;/option&gt;
  &lt;option value="7"&gt;July&lt;/option&gt;
  &lt;option value="8"&gt;August&lt;/option&gt;
  &lt;option value="9"&gt;September&lt;/option&gt;
  &lt;option value="10"&gt;October&lt;/option&gt;
  &lt;option value="11"&gt;November&lt;/option&gt;
  &lt;option value="12" selected="selected"&gt;December&lt;/option&gt;
&lt;/select&gt;
&lt;select name="person[birth_date(3i)]" id="person_birth_date_3i"&gt;
  &lt;option value="1"&gt;1&lt;/option&gt;
  ...
  &lt;option value="21" selected="selected"&gt;21&lt;/option&gt;
  ...
  &lt;option value="31"&gt;31&lt;/option&gt;
&lt;/select&gt;</pre> <button class="clipboard-button" data-clipboard-text='&lt;select name="person[birth_date(1i)]" id="person_birth_date_1i"&gt;
  &lt;option value="1990"&gt;1990&lt;/option&gt;
  &lt;option value="1991"&gt;1991&lt;/option&gt;
  &lt;option value="1992"&gt;1992&lt;/option&gt;
  &lt;option value="1993"&gt;1993&lt;/option&gt;
  &lt;option value="1994"&gt;1994&lt;/option&gt;
  &lt;option value="1995" selected="selected"&gt;1995&lt;/option&gt;
  &lt;option value="1996"&gt;1996&lt;/option&gt;
  &lt;option value="1997"&gt;1997&lt;/option&gt;
  &lt;option value="1998"&gt;1998&lt;/option&gt;
  &lt;option value="1999"&gt;1999&lt;/option&gt;
  &lt;option value="2000"&gt;2000&lt;/option&gt;
&lt;/select&gt;
&lt;select name="person[birth_date(2i)]" id="person_birth_date_2i"&gt;
  &lt;option value="1"&gt;January&lt;/option&gt;
  &lt;option value="2"&gt;February&lt;/option&gt;
  &lt;option value="3"&gt;March&lt;/option&gt;
  &lt;option value="4"&gt;April&lt;/option&gt;
  &lt;option value="5"&gt;May&lt;/option&gt;
  &lt;option value="6"&gt;June&lt;/option&gt;
  &lt;option value="7"&gt;July&lt;/option&gt;
  &lt;option value="8"&gt;August&lt;/option&gt;
  &lt;option value="9"&gt;September&lt;/option&gt;
  &lt;option value="10"&gt;October&lt;/option&gt;
  &lt;option value="11"&gt;November&lt;/option&gt;
  &lt;option value="12" selected="selected"&gt;December&lt;/option&gt;
&lt;/select&gt;
&lt;select name="person[birth_date(3i)]" id="person_birth_date_3i"&gt;
  &lt;option value="1"&gt;1&lt;/option&gt;
  ...
  &lt;option value="21" selected="selected"&gt;21&lt;/option&gt;
  ...
  &lt;option value="31"&gt;31&lt;/option&gt;
&lt;/select&gt;
'>Copy</button> </div> <p>Notice that, when the form is submitted, there will be no single value in the <code>params</code> hash that contains the full date. Instead, there will be several values with special names like <code>"birth_date(1i)"</code>. However, Active Model knows how to assemble these values into a full date, based on the declared type of the model attribute. So we can pass <code>params[:person]</code> to <code>Person.new</code> or <code>Person#update</code> just like we would if the form used a single field to represent the full date.</p>
<p>In addition to the <a href="https://edgeapi.rubyonrails.org/classes/ActionView/Helpers/FormBuilder.html#method-i-date_select"><code>date_select</code></a> helper, Rails provides <a href="https://edgeapi.rubyonrails.org/classes/ActionView/Helpers/FormBuilder.html#method-i-time_select"><code>time_select</code></a> which outputs select boxes for the hour and minute. There is <a href="https://edgeapi.rubyonrails.org/classes/ActionView/Helpers/FormBuilder.html#method-i-datetime_select"><code>datetime_select</code></a> as well which combines both date and time select boxes.</p>
<h2 id="select-boxes-for-time-or-date-components"><a class="anchorlink" href="#select-boxes-for-time-or-date-components"><span>4.1</span> Select Boxes for Time or Date Components</a></h2>
<p>Rails also provides helpers to render select boxes for individual date and time components: <a href="https://edgeapi.rubyonrails.org/classes/ActionView/Helpers/DateHelper.html#method-i-select_year"><code>select_year</code></a>, <a href="https://edgeapi.rubyonrails.org/classes/ActionView/Helpers/DateHelper.html#method-i-select_month"><code>select_month</code></a>, <a href="https://edgeapi.rubyonrails.org/classes/ActionView/Helpers/DateHelper.html#method-i-select_day"><code>select_day</code></a>, <a href="https://edgeapi.rubyonrails.org/classes/ActionView/Helpers/DateHelper.html#method-i-select_hour"><code>select_hour</code></a>, <a href="https://edgeapi.rubyonrails.org/classes/ActionView/Helpers/DateHelper.html#method-i-select_minute"><code>select_minute</code></a>, and <a href="https://edgeapi.rubyonrails.org/classes/ActionView/Helpers/DateHelper.html#method-i-select_second"><code>select_second</code></a>. These helpers are "bare" methods, meaning they are not called on a form builder instance. For example:</p>
<div class="interstitial code"> <pre data-language="erb">&lt;%= select_year 2024, prefix: "party" %&gt;</pre> <button class="clipboard-button" data-clipboard-text='&lt;%= select_year 2024, prefix: "party" %&gt;
'>Copy</button> </div> <p>The above outputs a select box like:</p>
<div class="interstitial code"> <pre data-language="html">&lt;select id="party_year" name="party[year]"&gt;
  &lt;option value="2019"&gt;2019&lt;/option&gt;
  &lt;option value="2020"&gt;2020&lt;/option&gt;
  &lt;option value="2021"&gt;2021&lt;/option&gt;
  &lt;option value="2022"&gt;2022&lt;/option&gt;
  &lt;option value="2023"&gt;2023&lt;/option&gt;
  &lt;option value="2024" selected="selected"&gt;2024&lt;/option&gt;
  &lt;option value="2025"&gt;2025&lt;/option&gt;
  &lt;option value="2026"&gt;2026&lt;/option&gt;
  &lt;option value="2027"&gt;2027&lt;/option&gt;
  &lt;option value="2028"&gt;2028&lt;/option&gt;
  &lt;option value="2029"&gt;2029&lt;/option&gt;
&lt;/select&gt;</pre> <button class="clipboard-button" data-clipboard-text='&lt;select id="party_year" name="party[year]"&gt;
  &lt;option value="2019"&gt;2019&lt;/option&gt;
  &lt;option value="2020"&gt;2020&lt;/option&gt;
  &lt;option value="2021"&gt;2021&lt;/option&gt;
  &lt;option value="2022"&gt;2022&lt;/option&gt;
  &lt;option value="2023"&gt;2023&lt;/option&gt;
  &lt;option value="2024" selected="selected"&gt;2024&lt;/option&gt;
  &lt;option value="2025"&gt;2025&lt;/option&gt;
  &lt;option value="2026"&gt;2026&lt;/option&gt;
  &lt;option value="2027"&gt;2027&lt;/option&gt;
  &lt;option value="2028"&gt;2028&lt;/option&gt;
  &lt;option value="2029"&gt;2029&lt;/option&gt;
&lt;/select&gt;
'>Copy</button> </div> <p>For each of these helpers, you may specify a <code>Date</code> or <code>Time</code> object instead of a number as the default value (for example <code>&lt;%= select_year Date.today, prefix: "party" %&gt;</code> instead of the above), and the appropriate date and time parts will be extracted and used.</p>
<h2 id="selecting-time-zone"><a class="anchorlink" href="#selecting-time-zone"><span>4.2</span> Selecting Time Zone</a></h2>
<p>When you need to ask users what time zone they are in, there is a very convenient <a href="https://edgeapi.rubyonrails.org/classes/ActionView/Helpers/FormBuilder.html#method-i-time_zone_select"><code>time_zone_select</code></a> helper to use.</p>
<p>Typically, you would have to provide a list of time zone options for users to select from. This can get tedious if not for the list of pre-defined <a href="https://edgeapi.rubyonrails.org/classes/ActiveSupport/TimeZone.html"><code>ActiveSupport::TimeZone</code></a> objects. The <code>time_with_zone</code> helper wraps this and can be used as follows:</p>
<div class="interstitial code"> <pre data-language="erb">&lt;%= form.time_zone_select :time_zone %&gt;</pre> <button class="clipboard-button" data-clipboard-text="&lt;%= form.time_zone_select :time_zone %&gt;
">Copy</button> </div> <p>Output:</p>
<div class="interstitial code"> <pre data-language="html">&lt;select name="time_zone" id="time_zone"&gt;
  &lt;option value="International Date Line West"&gt;(GMT-12:00) International Date Line West&lt;/option&gt;
  &lt;option value="American Samoa"&gt;(GMT-11:00) American Samoa&lt;/option&gt;
  &lt;option value="Midway Island"&gt;(GMT-11:00) Midway Island&lt;/option&gt;
  &lt;option value="Hawaii"&gt;(GMT-10:00) Hawaii&lt;/option&gt;
  &lt;option value="Alaska"&gt;(GMT-09:00) Alaska&lt;/option&gt;
  ...
  &lt;option value="Samoa"&gt;(GMT+13:00) Samoa&lt;/option&gt;
  &lt;option value="Tokelau Is."&gt;(GMT+13:00) Tokelau Is.&lt;/option&gt;
&lt;/select&gt;</pre> <button class="clipboard-button" data-clipboard-text='&lt;select name="time_zone" id="time_zone"&gt;
  &lt;option value="International Date Line West"&gt;(GMT-12:00) International Date Line West&lt;/option&gt;
  &lt;option value="American Samoa"&gt;(GMT-11:00) American Samoa&lt;/option&gt;
  &lt;option value="Midway Island"&gt;(GMT-11:00) Midway Island&lt;/option&gt;
  &lt;option value="Hawaii"&gt;(GMT-10:00) Hawaii&lt;/option&gt;
  &lt;option value="Alaska"&gt;(GMT-09:00) Alaska&lt;/option&gt;
  ...
  &lt;option value="Samoa"&gt;(GMT+13:00) Samoa&lt;/option&gt;
  &lt;option value="Tokelau Is."&gt;(GMT+13:00) Tokelau Is.&lt;/option&gt;
&lt;/select&gt;
'>Copy</button> </div> <h1 id="collection-related-helpers"><a class="anchorlink" href="#collection-related-helpers"><span>5</span> Collection Related Helpers</a></h1>
<p>If you need to generate a set of choices from a collection of arbitrary objects, Rails has <code>collection_select</code>, <code>collection_radio_button</code>, and <code>collection_check_boxes</code> helpers.</p>
<p>To see when these helpers are useful, suppose you have a <code>City</code> model and corresponding <code>belongs_to :city</code> association with <code>Person</code>:</p>
<div class="interstitial code"> <pre data-language="ruby">class City &lt; ApplicationRecord
end

class Person &lt; ApplicationRecord
  belongs_to :city
end</pre> <button class="clipboard-button" data-clipboard-text="class City &lt; ApplicationRecord
end

class Person &lt; ApplicationRecord
  belongs_to :city
end
">Copy</button> </div> <p>Assuming we have the following cities stored in the database:</p>
<div class="interstitial code"> <pre data-language="ruby">City.order(:name).map { |city| [city.name, city.id] }
# =&gt; [["Berlin", 1], ["Chicago", 3], ["Madrid", 2]]</pre> <button class="clipboard-button" data-clipboard-text='City.order(:name).map { |city| [city.name, city.id] }
# =&gt; [["Berlin", 1], ["Chicago", 3], ["Madrid", 2]]
'>Copy</button> </div> <p>We can allow the user to choose from the cities with the following form:</p>
<div class="interstitial code"> <pre data-language="erb">&lt;%= form_with model: @person do |form| %&gt;
  &lt;%= form.select :city_id, City.order(:name).map { |city| [city.name, city.id] } %&gt;
&lt;% end %&gt;</pre> <button class="clipboard-button" data-clipboard-text="&lt;%= form_with model: @person do |form| %&gt;
  &lt;%= form.select :city_id, City.order(:name).map { |city| [city.name, city.id] } %&gt;
&lt;% end %&gt;
">Copy</button> </div> <p>The above will generate this HTML:</p>
<div class="interstitial code"> <pre data-language="html">&lt;select name="person[city_id]" id="person_city_id"&gt;
  &lt;option value="1"&gt;Berlin&lt;/option&gt;
  &lt;option value="3"&gt;Chicago&lt;/option&gt;
  &lt;option value="2"&gt;Madrid&lt;/option&gt;
&lt;/select&gt;</pre> <button class="clipboard-button" data-clipboard-text='&lt;select name="person[city_id]" id="person_city_id"&gt;
  &lt;option value="1"&gt;Berlin&lt;/option&gt;
  &lt;option value="3"&gt;Chicago&lt;/option&gt;
  &lt;option value="2"&gt;Madrid&lt;/option&gt;
&lt;/select&gt;
'>Copy</button> </div> <p>The above example shows how you'd generate the choices manually. However, Rails has helpers that generate choices from a collection without having to explicitly iterate over it. These helpers determine the value and text label of each choice by calling specified methods on each object in the collection.</p>
<div class="interstitial note"><p>When rendering a field for a <code>belongs_to</code> association, you must specify the name of the foreign key (<code>city_id</code> in the above example), rather than the name of the association itself.</p></div>
<h2 id="the-collection-select-helper"><a class="anchorlink" href="#the-collection-select-helper"><span>5.1</span> The <code>collection_select</code> Helper</a></h2>
<p>To generate a select box, we can use <a href="https://edgeapi.rubyonrails.org/classes/ActionView/Helpers/FormBuilder.html#method-i-collection_select"><code>collection_select</code></a>:</p>
<div class="interstitial code"> <pre data-language="erb">&lt;%= form.collection_select :city_id, City.order(:name), :id, :name %&gt;</pre> <button class="clipboard-button" data-clipboard-text="&lt;%= form.collection_select :city_id, City.order(:name), :id, :name %&gt;
">Copy</button> </div> <p>The above outputs the same HTML as the manual iteration above:</p>
<div class="interstitial code"> <pre data-language="html">&lt;select name="person[city_id]" id="person_city_id"&gt;
  &lt;option value="1"&gt;Berlin&lt;/option&gt;
  &lt;option value="3"&gt;Chicago&lt;/option&gt;
  &lt;option value="2"&gt;Madrid&lt;/option&gt;
&lt;/select&gt;</pre> <button class="clipboard-button" data-clipboard-text='&lt;select name="person[city_id]" id="person_city_id"&gt;
  &lt;option value="1"&gt;Berlin&lt;/option&gt;
  &lt;option value="3"&gt;Chicago&lt;/option&gt;
  &lt;option value="2"&gt;Madrid&lt;/option&gt;
&lt;/select&gt;
'>Copy</button> </div> <div class="interstitial note"><p>The order of arguments for <code>collection_select</code> is different from the order for <code>select</code>. With <code>collection_select</code> we specify the value method first (<code>:id</code> in the example above), and the text label method second (<code>:name</code> in the example above). This is opposite of the order used when specifying choices for the <code>select</code> helper, where the text label comes first and the value second (<code>["Berlin", 1]</code> in the previous example).</p></div>
<h2 id="the-collection-radio-buttons-helper"><a class="anchorlink" href="#the-collection-radio-buttons-helper"><span>5.2</span> The <code>collection_radio_buttons</code> Helper</a></h2>
<p>To generate a set of radio buttons, we can use <a href="https://edgeapi.rubyonrails.org/classes/ActionView/Helpers/FormBuilder.html#method-i-collection_radio_buttons"><code>collection_radio_buttons</code></a>:</p>
<div class="interstitial code"> <pre data-language="erb">&lt;%= form.collection_radio_buttons :city_id, City.order(:name), :id, :name %&gt;</pre> <button class="clipboard-button" data-clipboard-text="&lt;%= form.collection_radio_buttons :city_id, City.order(:name), :id, :name %&gt;
">Copy</button> </div> <p>Output:</p>
<div class="interstitial code"> <pre data-language="html">&lt;input type="radio" value="1" name="person[city_id]" id="person_city_id_1"&gt;
&lt;label for="person_city_id_1"&gt;Berlin&lt;/label&gt;

&lt;input type="radio" value="3" name="person[city_id]" id="person_city_id_3"&gt;
&lt;label for="person_city_id_3"&gt;Chicago&lt;/label&gt;

&lt;input type="radio" value="2" name="person[city_id]" id="person_city_id_2"&gt;
&lt;label for="person_city_id_2"&gt;Madrid&lt;/label&gt;</pre> <button class="clipboard-button" data-clipboard-text='&lt;input type="radio" value="1" name="person[city_id]" id="person_city_id_1"&gt;
&lt;label for="person_city_id_1"&gt;Berlin&lt;/label&gt;

&lt;input type="radio" value="3" name="person[city_id]" id="person_city_id_3"&gt;
&lt;label for="person_city_id_3"&gt;Chicago&lt;/label&gt;

&lt;input type="radio" value="2" name="person[city_id]" id="person_city_id_2"&gt;
&lt;label for="person_city_id_2"&gt;Madrid&lt;/label&gt;
'>Copy</button> </div> <h2 id="the-collection-check-boxes-helper"><a class="anchorlink" href="#the-collection-check-boxes-helper"><span>5.3</span> The <code>collection_check_boxes</code> Helper</a></h2>
<p>To generate a set of check boxes  for example, to support a <code>has_and_belongs_to_many</code> association  we can use <a href="https://edgeapi.rubyonrails.org/classes/ActionView/Helpers/FormBuilder.html#method-i-collection_check_boxes"><code>collection_check_boxes</code></a>:</p>
<div class="interstitial code"> <pre data-language="erb">&lt;%= form.collection_check_boxes :interest_ids, Interest.order(:name), :id, :name %&gt;</pre> <button class="clipboard-button" data-clipboard-text="&lt;%= form.collection_check_boxes :interest_ids, Interest.order(:name), :id, :name %&gt;
">Copy</button> </div> <p>Output:</p>
<div class="interstitial code"> <pre data-language="html">&lt;input type="checkbox" name="person[interest_id][]" value="3" id="person_interest_id_3"&gt;
&lt;label for="person_interest_id_3"&gt;Engineering&lt;/label&gt;

&lt;input type="checkbox" name="person[interest_id][]" value="4" id="person_interest_id_4"&gt;
&lt;label for="person_interest_id_4"&gt;Math&lt;/label&gt;

&lt;input type="checkbox" name="person[interest_id][]" value="1" id="person_interest_id_1"&gt;
&lt;label for="person_interest_id_1"&gt;Science&lt;/label&gt;

&lt;input type="checkbox" name="person[interest_id][]" value="2" id="person_interest_id_2"&gt;
&lt;label for="person_interest_id_2"&gt;Technology&lt;/label&gt;</pre> <button class="clipboard-button" data-clipboard-text='&lt;input type="checkbox" name="person[interest_id][]" value="3" id="person_interest_id_3"&gt;
&lt;label for="person_interest_id_3"&gt;Engineering&lt;/label&gt;

&lt;input type="checkbox" name="person[interest_id][]" value="4" id="person_interest_id_4"&gt;
&lt;label for="person_interest_id_4"&gt;Math&lt;/label&gt;

&lt;input type="checkbox" name="person[interest_id][]" value="1" id="person_interest_id_1"&gt;
&lt;label for="person_interest_id_1"&gt;Science&lt;/label&gt;

&lt;input type="checkbox" name="person[interest_id][]" value="2" id="person_interest_id_2"&gt;
&lt;label for="person_interest_id_2"&gt;Technology&lt;/label&gt;
'>Copy</button> </div> <h1 id="uploading-files"><a class="anchorlink" href="#uploading-files"><span>6</span> Uploading Files</a></h1>
<p>A common task with forms is allowing users to upload a file. It could be an avatar image or a CSV file with data to process. File upload fields can be rendered with the <a href="https://edgeapi.rubyonrails.org/classes/ActionView/Helpers/FormBuilder.html#method-i-file_field"><code>file_field</code></a> helper.</p>
<div class="interstitial code"> <pre data-language="erb">&lt;%= form_with model: @person do |form| %&gt;
  &lt;%= form.file_field :csv_file %&gt;
&lt;% end %&gt;</pre> <button class="clipboard-button" data-clipboard-text="&lt;%= form_with model: @person do |form| %&gt;
  &lt;%= form.file_field :csv_file %&gt;
&lt;% end %&gt;
">Copy</button> </div> <p>The most important thing to remember with file uploads is that the rendered form's <code>enctype</code> attribute <strong>must</strong> be set to <code>multipart/form-data</code>. This is done automatically if you use a <code>file_field</code> inside a <code>form_with</code>. You can also set the attribute manually:</p>
<div class="interstitial code"> <pre data-language="erb">&lt;%= form_with url: "/uploads", multipart: true do |form| %&gt;
  &lt;%= file_field_tag :csv_file %&gt;
&lt;% end %&gt;</pre> <button class="clipboard-button" data-clipboard-text='&lt;%= form_with url: "/uploads", multipart: true do |form| %&gt;
  &lt;%= file_field_tag :csv_file %&gt;
&lt;% end %&gt;
'>Copy</button> </div> <p>Both of which, output the following HTML form:</p>
<div class="interstitial code"> <pre data-language="html">&lt;form enctype="multipart/form-data" action="/people" accept-charset="UTF-8" method="post"&gt;
&lt;!-- ... --&gt;
&lt;/form&gt;</pre> <button class="clipboard-button" data-clipboard-text='&lt;form enctype="multipart/form-data" action="/people" accept-charset="UTF-8" method="post"&gt;
&lt;!-- ... --&gt;
&lt;/form&gt;
'>Copy</button> </div> <p>Note that, per <code>form_with</code> conventions, the field names in the two forms above will be different. In the first form, it will be <code>person[csv_file]</code> (accessible via <code>params[:person][:csv_file]</code>), and in the second form it will be just <code>csv_file</code> (accessible via <code>params[:csv_file]</code>).</p>
<h2 id="csv-file-upload-example"><a class="anchorlink" href="#csv-file-upload-example"><span>6.1</span> CSV File Upload Example</a></h2>
<p>When using <code>file_field</code>, the object in the <code>params</code> hash is an instance of <a href="https://edgeapi.rubyonrails.org/classes/ActionDispatch/Http/UploadedFile.html"><code>ActionDispatch::Http::UploadedFile</code></a>. Here is an example of how to save data in an uploaded CSV file to records in your application:</p>
<div class="interstitial code"> <pre data-language="ruby">require 'csv'

  def upload
    uploaded_file = params[:csv_file]
    if uploaded_file.present?
      csv_data = CSV.parse(uploaded_file.read, headers: true)
      csv_data.each do |row|
        # Process each row of the CSV file
        # SomeInvoiceModel.create(amount: row['Amount'], status: row['Status'])
        Rails.logger.info row.inspect
        #&lt;CSV::Row "id":"po_1KE3FRDSYPMwkcNz9SFKuaYd" "Amount":"96.22" "Created (UTC)":"2022-01-04 02:59" "Arrival Date (UTC)":"2022-01-05 00:00" "Status":"paid"&gt;
      end
    end
    # ...
  end</pre> <button class="clipboard-button" data-clipboard-text="  require 'csv'

  def upload
    uploaded_file = params[:csv_file]
    if uploaded_file.present?
      csv_data = CSV.parse(uploaded_file.read, headers: true)
      csv_data.each do |row|
        # Process each row of the CSV file
        # SomeInvoiceModel.create(amount: row['Amount'], status: row['Status'])
        Rails.logger.info row.inspect
        #&lt;CSV::Row &quot;id&quot;:&quot;po_1KE3FRDSYPMwkcNz9SFKuaYd&quot; &quot;Amount&quot;:&quot;96.22&quot; &quot;Created (UTC)&quot;:&quot;2022-01-04 02:59&quot; &quot;Arrival Date (UTC)&quot;:&quot;2022-01-05 00:00&quot; &quot;Status&quot;:&quot;paid&quot;&gt;
      end
    end
    # ...
  end
">Copy</button> </div> <p>If the file is an image that needs to be stored with a model (e.g. user's profile picture), there are a number of tasks to consider, like where to store the file (on Disk, Amazon S3, etc), resizing image files, and generating thumbnails, etc. <a href="active_storage_overview.html">Active Storage</a> is designed to assist with these tasks.</p>
<h1 id="customizing-form-builders"><a class="anchorlink" href="#customizing-form-builders"><span>7</span> Customizing Form Builders</a></h1>
<p>We call the objects yielded by <code>form_with</code> or <code>fields_for</code> Form Builders. Form builders allow you to generate form elements associated with a model object and are an instance of <a href="https://edgeapi.rubyonrails.org/classes/ActionView/Helpers/FormBuilder.html"><code>ActionView::Helpers::FormBuilder</code></a>. This class can be extended to add custom helpers for your application.</p>
<p>For example, if you want to display a <code>text_field</code> along with a <code>label</code> across your application, you could add the following helper method to <code>application_helper.rb</code>:</p>
<div class="interstitial code"> <pre data-language="ruby">module ApplicationHelper
  def text_field_with_label(form, attribute)
    form.label(attribute) + form.text_field(attribute)
  end
end</pre> <button class="clipboard-button" data-clipboard-text="module ApplicationHelper
  def text_field_with_label(form, attribute)
    form.label(attribute) + form.text_field(attribute)
  end
end
">Copy</button> </div> <p>And use it in a form as usual:</p>
<div class="interstitial code"> <pre data-language="erb">&lt;%= form_with model: @person do |form| %&gt;
  &lt;%= text_field_with_label form, :first_name %&gt;
&lt;% end %&gt;</pre> <button class="clipboard-button" data-clipboard-text="&lt;%= form_with model: @person do |form| %&gt;
  &lt;%= text_field_with_label form, :first_name %&gt;
&lt;% end %&gt;
">Copy</button> </div> <p>But you can also create a subclass of <code>ActionView::Helpers::FormBuilder</code>, and add the helpers there. After defining this <code>LabellingFormBuilder</code> subclass:</p>
<div class="interstitial code"> <pre data-language="ruby">class LabellingFormBuilder &lt; ActionView::Helpers::FormBuilder
  def text_field(attribute, options = {})
    # super will call the original text_field method
    label(attribute) + super
  end
end</pre> <button class="clipboard-button" data-clipboard-text="class LabellingFormBuilder &lt; ActionView::Helpers::FormBuilder
  def text_field(attribute, options = {})
    # super will call the original text_field method
    label(attribute) + super
  end
end
">Copy</button> </div> <p>The above form can be replaced with:</p>
<div class="interstitial code"> <pre data-language="erb">&lt;%= form_with model: @person, builder: LabellingFormBuilder do |form| %&gt;
  &lt;%= form.text_field :first_name %&gt;
&lt;% end %&gt;</pre> <button class="clipboard-button" data-clipboard-text="&lt;%= form_with model: @person, builder: LabellingFormBuilder do |form| %&gt;
  &lt;%= form.text_field :first_name %&gt;
&lt;% end %&gt;
">Copy</button> </div> <p>If you reuse this frequently you could define a <code>labeled_form_with</code> helper that automatically applies the <code>builder: LabellingFormBuilder</code> option:</p>
<div class="interstitial code"> <pre data-language="ruby">module ApplicationHelper
  def labeled_form_with(**options, &amp;block)
    options[:builder] = LabellingFormBuilder
    form_with(**options, &amp;block)
  end
end</pre> <button class="clipboard-button" data-clipboard-text="module ApplicationHelper
  def labeled_form_with(**options, &amp;block)
    options[:builder] = LabellingFormBuilder
    form_with(**options, &amp;block)
  end
end
">Copy</button> </div> <p>The above can be used instead of <code>form_with</code>:</p>
<div class="interstitial code"> <pre data-language="erb">&lt;%= labeled_form_with model: @person do |form| %&gt;
  &lt;%= form.text_field :first_name %&gt;
&lt;% end %&gt;</pre> <button class="clipboard-button" data-clipboard-text="&lt;%= labeled_form_with model: @person do |form| %&gt;
  &lt;%= form.text_field :first_name %&gt;
&lt;% end %&gt;
">Copy</button> </div> <p>All three cases above (the <code>text_field_with_label</code> helper, the <code>LabellingFormBuilder</code> subclass, and the <code>labeled_form_with</code> helper) will generate the same HTML output:</p>
<div class="interstitial code"> <pre data-language="html">&lt;form action="/people" accept-charset="UTF-8" method="post"&gt;
  &lt;!-- ... --&gt;
  &lt;label for="person_first_name"&gt;First name&lt;/label&gt;
  &lt;input type="text" name="person[first_name]" id="person_first_name"&gt;
&lt;/form&gt;</pre> <button class="clipboard-button" data-clipboard-text='&lt;form action="/people" accept-charset="UTF-8" method="post"&gt;
  &lt;!-- ... --&gt;
  &lt;label for="person_first_name"&gt;First name&lt;/label&gt;
  &lt;input type="text" name="person[first_name]" id="person_first_name"&gt;
&lt;/form&gt;
'>Copy</button> </div> <p>The form builder used also determines what happens when you do:</p>
<div class="interstitial code"> <pre data-language="erb">&lt;%= render partial: f %&gt;</pre> <button class="clipboard-button" data-clipboard-text="&lt;%= render partial: f %&gt;
">Copy</button> </div> <p>If <code>f</code> is an instance of <code>ActionView::Helpers::FormBuilder</code>, then this will render the <code>form</code> partial, setting the partial's object to the form builder. If the form builder is of class <code>LabellingFormBuilder</code>, then the <code>labelling_form</code> partial would be rendered instead.</p>
<p>Form builder customizations, such as <code>LabellingFormBuilder</code>, do hide the implementation details (and may seem like an overkill for the simple example above). Choose between different customizations, extending <code>FormBuilder</code> class or creating helpers, based on how frequently your forms use the custom elements.</p>
<h1 id="form-input-naming-conventions-and-params-hash"><a class="anchorlink" href="#form-input-naming-conventions-and-params-hash"><span>8</span> Form Input Naming Conventions and <code>params</code> Hash</a></h1>
<p>All of the form helpers described above help with generating the HTML for form elements so that the user can enter various types of input. How do you access the user input values in the Controller? The <code>params</code> hash is the answer. You've already seen the <code>params</code> hash in the above example. This section will more explicitly go over naming conventions around how form input is structured in the <code>params</code> hash.</p>
<p>The <code>params</code> hash can contain arrays and arrays of hashes. Values can be at the top level of the <code>params</code> hash or nested in another hash. For example, in a standard <code>create</code> action for a Person model, <code>params[:person]</code> will be a hash of all the attributes for the <code>Person</code> object.</p>
<p>Note that HTML forms don't have an inherent structure to the user input data, all they generate is name-value string pairs. The arrays and hashes you see in your application are the result of parameter naming conventions that Rails uses.</p>
<div class="interstitial note"><p>The fields in the <code>params</code> hash need to be <a href="#permitting-parameters-in-the-controller">permitted in the controller</a>.</p></div>
<h2 id="basic-structure"><a class="anchorlink" href="#basic-structure"><span>8.1</span> Basic Structure</a></h2>
<p>The two basic structures for user input form data are arrays and hashes.</p>
<p>Hashes mirror the syntax used for accessing the value in <code>params</code>. For example, if a form contains:</p>
<div class="interstitial code"> <pre data-language="html">&lt;input id="person_name" name="person[name]" type="text" value="Henry"/&gt;</pre> <button class="clipboard-button" data-clipboard-text='&lt;input id="person_name" name="person[name]" type="text" value="Henry"/&gt;
'>Copy</button> </div> <p>the <code>params</code> hash will contain</p>
<div class="interstitial code"> <pre data-language="ruby">{ 'person' =&gt; { 'name' =&gt; 'Henry' } }</pre> <button class="clipboard-button" data-clipboard-text="{ 'person' =&gt; { 'name' =&gt; 'Henry' } }
">Copy</button> </div> <p>and <code>params[:person][:name]</code> will retrieve the submitted value in the controller.</p>
<p>Hashes can be nested as many levels as required, for example:</p>
<div class="interstitial code"> <pre data-language="html">&lt;input id="person_address_city" name="person[address][city]" type="text" value="New York"/&gt;</pre> <button class="clipboard-button" data-clipboard-text='&lt;input id="person_address_city" name="person[address][city]" type="text" value="New York"/&gt;
'>Copy</button> </div> <p>The above will result in the <code>params</code> hash being</p>
<div class="interstitial code"> <pre data-language="ruby">{ 'person' =&gt; { 'address' =&gt; { 'city' =&gt; 'New York' } } }</pre> <button class="clipboard-button" data-clipboard-text="{ 'person' =&gt; { 'address' =&gt; { 'city' =&gt; 'New York' } } }
">Copy</button> </div> <p>The other structure is an Array. Normally Rails ignores duplicate parameter names, but if the parameter name ends with an empty set of square brackets <code>[]</code> then the parameters will be accumulated in an Array.</p>
<p>For example, if you want users to be able to input multiple phone numbers, you could place this in the form:</p>
<div class="interstitial code"> <pre data-language="html">&lt;input name="person[phone_number][]" type="text"/&gt;
&lt;input name="person[phone_number][]" type="text"/&gt;
&lt;input name="person[phone_number][]" type="text"/&gt;</pre> <button class="clipboard-button" data-clipboard-text='&lt;input name="person[phone_number][]" type="text"/&gt;
&lt;input name="person[phone_number][]" type="text"/&gt;
&lt;input name="person[phone_number][]" type="text"/&gt;
'>Copy</button> </div> <p>This would result in <code>params[:person][:phone_number]</code> being an array containing the submitted phone numbers:</p>
<div class="interstitial code"> <pre data-language="ruby">{ 'person' =&gt; { 'phone_number' =&gt; ['555-0123', '555-0124', '555-0125'] } }</pre> <button class="clipboard-button" data-clipboard-text="{ 'person' =&gt; { 'phone_number' =&gt; ['555-0123', '555-0124', '555-0125'] } }
">Copy</button> </div> <h2 id="combining-arrays-and-hashes"><a class="anchorlink" href="#combining-arrays-and-hashes"><span>8.2</span> Combining Arrays and Hashes</a></h2>
<p>You can mix and match these two concepts. One element of a hash might be an array as in the previous example <code>params[:person]</code> hash has a key called <code>[:phone_number]</code> whose value is an array.</p>
<p>You also can have an array of hashes. For example, you can create any number of addresses by repeating the following form fragment:</p>
<div class="interstitial code"> <pre data-language="html">&lt;input name="person[addresses][][line1]" type="text"/&gt;
&lt;input name="person[addresses][][line2]" type="text"/&gt;
&lt;input name="person[addresses][][city]" type="text"/&gt;
&lt;input name="person[addresses][][line1]" type="text"/&gt;
&lt;input name="person[addresses][][line2]" type="text"/&gt;
&lt;input name="person[addresses][][city]" type="text"/&gt;</pre> <button class="clipboard-button" data-clipboard-text='&lt;input name="person[addresses][][line1]" type="text"/&gt;
&lt;input name="person[addresses][][line2]" type="text"/&gt;
&lt;input name="person[addresses][][city]" type="text"/&gt;
&lt;input name="person[addresses][][line1]" type="text"/&gt;
&lt;input name="person[addresses][][line2]" type="text"/&gt;
&lt;input name="person[addresses][][city]" type="text"/&gt;
'>Copy</button> </div> <p>This would result in <code>params[:person][:addresses]</code> being an array of hashes. Each hash in the array will have the keys <code>line1</code>, <code>line2</code>, and <code>city</code>, something like this:</p>
<div class="interstitial code"> <pre data-language="ruby">{ 'person' =&gt;
  { 'addresses' =&gt; [
    { 'line1' =&gt; '1000 Fifth Avenue',
      'line2' =&gt; '',
      'city' =&gt; 'New York'
    },
    { 'line1' =&gt; 'Calle de Ruiz de Alarcn',
      'line2' =&gt; '',
      'city' =&gt; 'Madrid'
    }
    ]
  }
}</pre> <button class="clipboard-button" data-clipboard-text="{ 'person' =&gt;
  { 'addresses' =&gt; [
    { 'line1' =&gt; '1000 Fifth Avenue',
      'line2' =&gt; '',
      'city' =&gt; 'New York'
    },
    { 'line1' =&gt; 'Calle de Ruiz de Alarcn',
      'line2' =&gt; '',
      'city' =&gt; 'Madrid'
    }
    ]
  }
}
">Copy</button> </div> <p>It's important to note that while hashes can be nested arbitrarily, only one level of "arrayness" is allowed. Arrays can usually be replaced by hashes. For example, instead of an array of model objects, you can have a hash of model objects keyed by their id or similar.</p>
<div class="interstitial warning"><p>Array parameters do not play well with the <code>check_box</code> helper. According to the HTML specification unchecked checkboxes submit no value. However it is often convenient for a checkbox to always submit a value. The <code>check_box</code> helper fakes this by creating an auxiliary hidden input with the same name. If the checkbox is unchecked only the hidden input is submitted. If it is checked then both are submitted but the value submitted by the checkbox takes precedence. There is a <code>include_hidden</code> option that can be set to <code>false</code> if you want to omit this hidden field. By default, this option is <code>true</code>.</p></div>
<h2 id="hashes-with-an-index"><a class="anchorlink" href="#hashes-with-an-index"><span>8.3</span> Hashes with an Index</a></h2>
<p>Let's say you want to render a form with a set of fields for each of a person's addresses. The [<code>fields_for</code>][] helper with its <code>:index</code> option can assist:</p>
<div class="interstitial code"> <pre data-language="erb">&lt;%= form_with model: @person do |person_form| %&gt;
  &lt;%= person_form.text_field :name %&gt;
  &lt;% @person.addresses.each do |address| %&gt;
    &lt;%= person_form.fields_for address, index: address.id do |address_form| %&gt;
      &lt;%= address_form.text_field :city %&gt;
    &lt;% end %&gt;
  &lt;% end %&gt;
&lt;% end %&gt;</pre> <button class="clipboard-button" data-clipboard-text="&lt;%= form_with model: @person do |person_form| %&gt;
  &lt;%= person_form.text_field :name %&gt;
  &lt;% @person.addresses.each do |address| %&gt;
    &lt;%= person_form.fields_for address, index: address.id do |address_form| %&gt;
      &lt;%= address_form.text_field :city %&gt;
    &lt;% end %&gt;
  &lt;% end %&gt;
&lt;% end %&gt;
">Copy</button> </div> <p>Assuming the person has two addresses with IDs 23 and 45, the above form would render this output:</p>
<div class="interstitial code"> <pre data-language="html">&lt;form accept-charset="UTF-8" action="/people/1" method="post"&gt;
  &lt;input name="_method" type="hidden" value="patch" /&gt;
  &lt;input id="person_name" name="person[name]" type="text" /&gt;
  &lt;input id="person_address_23_city" name="person[address][23][city]" type="text" /&gt;
  &lt;input id="person_address_45_city" name="person[address][45][city]" type="text" /&gt;
&lt;/form&gt;</pre> <button class="clipboard-button" data-clipboard-text='&lt;form accept-charset="UTF-8" action="/people/1" method="post"&gt;
  &lt;input name="_method" type="hidden" value="patch" /&gt;
  &lt;input id="person_name" name="person[name]" type="text" /&gt;
  &lt;input id="person_address_23_city" name="person[address][23][city]" type="text" /&gt;
  &lt;input id="person_address_45_city" name="person[address][45][city]" type="text" /&gt;
&lt;/form&gt;
'>Copy</button> </div> <p>Which will result in a <code>params</code> hash that looks like:</p>
<div class="interstitial code"> <pre data-language="ruby">{
  "person" =&gt; {
    "name" =&gt; "Bob",
    "address" =&gt; {
      "23" =&gt; {
        "city" =&gt; "Paris"
      },
      "45" =&gt; {
        "city" =&gt; "London"
      }
    }
  }
}</pre> <button class="clipboard-button" data-clipboard-text='{
  "person" =&gt; {
    "name" =&gt; "Bob",
    "address" =&gt; {
      "23" =&gt; {
        "city" =&gt; "Paris"
      },
      "45" =&gt; {
        "city" =&gt; "London"
      }
    }
  }
}
'>Copy</button> </div> <p>All of the form inputs map to the <code>"person"</code> hash because we called <code>fields_for</code> on the <code>person_form</code> form builder. Also, by specifying <code>index: address.id</code>, we rendered the <code>name</code> attribute of each city input as <code>person[address][#{address.id}][city]</code> instead of <code>person[address][city]</code>. This way you can tell which <code>Address</code> records should be modified when processing the <code>params</code> hash.</p>
<p>You can find more details about <code>fields_for</code> index option in the <a href="https://api.rubyonrails.org/v7.1.3.4/classes/ActionView/Helpers/FormHelper.html#method-i-fields_for">API docs</a>.</p>
<h1 id="building-complex-forms"><a class="anchorlink" href="#building-complex-forms"><span>9</span> Building Complex Forms</a></h1>
<p>As your application grows, you may need to create more complex forms, beyond editing a single object. For example, when creating a <code>Person</code> you can allow the user to create multiple <code>Address</code> records (home, work, etc.) within the same form. When editing a <code>Person</code> record later, the user should be able to add, remove, or update addresses as well.</p>
<h2 id="configuring-the-model-for-nested-attributes"><a class="anchorlink" href="#configuring-the-model-for-nested-attributes"><span>9.1</span> Configuring the Model for Nested Attributes</a></h2>
<p>For editing an associated record for a given model (<code>Person</code> in this case), Active Record provides model level support via the <a href="https://edgeapi.rubyonrails.org/classes/ActiveRecord/NestedAttributes/ClassMethods.html#method-i-accepts_nested_attributes_for"><code>accepts_nested_attributes_for</code></a> method:</p>
<div class="interstitial code"> <pre data-language="ruby">class Person &lt; ApplicationRecord
  has_many :addresses, inverse_of: :person
  accepts_nested_attributes_for :addresses
end

class Address &lt; ApplicationRecord
  belongs_to :person
end</pre> <button class="clipboard-button" data-clipboard-text="class Person &lt; ApplicationRecord
  has_many :addresses, inverse_of: :person
  accepts_nested_attributes_for :addresses
end

class Address &lt; ApplicationRecord
  belongs_to :person
end
">Copy</button> </div> <p>This creates an <code>addresses_attributes=</code> method on <code>Person</code> that allows you to create, update, and destroy addresses.</p>
<h2 id="nested-forms-in-the-view"><a class="anchorlink" href="#nested-forms-in-the-view"><span>9.2</span> Nested Forms in the View</a></h2>
<p>The following form allows a user to create a <code>Person</code> and its associated addresses.</p>
<div class="interstitial code"> <pre data-language="erb">&lt;%= form_with model: @person do |form| %&gt;
  Addresses:
  &lt;ul&gt;
    &lt;%= form.fields_for :addresses do |addresses_form| %&gt;
      &lt;li&gt;
        &lt;%= addresses_form.label :kind %&gt;
        &lt;%= addresses_form.text_field :kind %&gt;

        &lt;%= addresses_form.label :street %&gt;
        &lt;%= addresses_form.text_field :street %&gt;
        ...
      &lt;/li&gt;
    &lt;% end %&gt;
  &lt;/ul&gt;
&lt;% end %&gt;</pre> <button class="clipboard-button" data-clipboard-text="&lt;%= form_with model: @person do |form| %&gt;
  Addresses:
  &lt;ul&gt;
    &lt;%= form.fields_for :addresses do |addresses_form| %&gt;
      &lt;li&gt;
        &lt;%= addresses_form.label :kind %&gt;
        &lt;%= addresses_form.text_field :kind %&gt;

        &lt;%= addresses_form.label :street %&gt;
        &lt;%= addresses_form.text_field :street %&gt;
        ...
      &lt;/li&gt;
    &lt;% end %&gt;
  &lt;/ul&gt;
&lt;% end %&gt;
">Copy</button> </div> <p>When an association accepts nested attributes, <code>fields_for</code> renders its block once for every element of the association. In particular, if a person has no addresses, it renders nothing.</p>
<p>A common pattern is for the controller to build one or more empty children so that at least one set of fields is shown to the user. The example below would result in 2 sets of address fields being rendered on the new person form.</p>
<p>For example, the above <code>form_with</code> with this change:</p>
<div class="interstitial code"> <pre data-language="ruby">def new
  @person = Person.new
  2.times { @person.addresses.build }
end</pre> <button class="clipboard-button" data-clipboard-text="def new
  @person = Person.new
  2.times { @person.addresses.build }
end
">Copy</button> </div> <p>Will output the following HTML:</p>
<div class="interstitial code"> <pre data-language="html">&lt;form action="/people" accept-charset="UTF-8" method="post"&gt;&lt;input type="hidden" name="authenticity_token" value="lWTbg-4_5i4rNe6ygRFowjDfTj7uf-6UPFQnsL7H9U9Fe2GGUho5PuOxfcohgm2Z-By3veuXwcwDIl-MLdwFRg" autocomplete="off"&gt;
  Addresses:
  &lt;ul&gt;
      &lt;li&gt;
        &lt;label for="person_addresses_attributes_0_kind"&gt;Kind&lt;/label&gt;
        &lt;input type="text" name="person[addresses_attributes][0][kind]" id="person_addresses_attributes_0_kind"&gt;

        &lt;label for="person_addresses_attributes_0_street"&gt;Street&lt;/label&gt;
        &lt;input type="text" name="person[addresses_attributes][0][street]" id="person_addresses_attributes_0_street"&gt;
        ...
      &lt;/li&gt;

      &lt;li&gt;
        &lt;label for="person_addresses_attributes_1_kind"&gt;Kind&lt;/label&gt;
        &lt;input type="text" name="person[addresses_attributes][1][kind]" id="person_addresses_attributes_1_kind"&gt;

        &lt;label for="person_addresses_attributes_1_street"&gt;Street&lt;/label&gt;
        &lt;input type="text" name="person[addresses_attributes][1][street]" id="person_addresses_attributes_1_street"&gt;
        ...
      &lt;/li&gt;
  &lt;/ul&gt;
&lt;/form&gt;</pre> <button class="clipboard-button" data-clipboard-text='&lt;form action="/people" accept-charset="UTF-8" method="post"&gt;&lt;input type="hidden" name="authenticity_token" value="lWTbg-4_5i4rNe6ygRFowjDfTj7uf-6UPFQnsL7H9U9Fe2GGUho5PuOxfcohgm2Z-By3veuXwcwDIl-MLdwFRg" autocomplete="off"&gt;
  Addresses:
  &lt;ul&gt;
      &lt;li&gt;
        &lt;label for="person_addresses_attributes_0_kind"&gt;Kind&lt;/label&gt;
        &lt;input type="text" name="person[addresses_attributes][0][kind]" id="person_addresses_attributes_0_kind"&gt;

        &lt;label for="person_addresses_attributes_0_street"&gt;Street&lt;/label&gt;
        &lt;input type="text" name="person[addresses_attributes][0][street]" id="person_addresses_attributes_0_street"&gt;
        ...
      &lt;/li&gt;

      &lt;li&gt;
        &lt;label for="person_addresses_attributes_1_kind"&gt;Kind&lt;/label&gt;
        &lt;input type="text" name="person[addresses_attributes][1][kind]" id="person_addresses_attributes_1_kind"&gt;

        &lt;label for="person_addresses_attributes_1_street"&gt;Street&lt;/label&gt;
        &lt;input type="text" name="person[addresses_attributes][1][street]" id="person_addresses_attributes_1_street"&gt;
        ...
      &lt;/li&gt;
  &lt;/ul&gt;
&lt;/form&gt;
'>Copy</button> </div> <p>The <code>fields_for</code> yields a form builder. The parameter names will be what <code>accepts_nested_attributes_for</code> expects. For example, when creating a person with 2 addresses, the submitted parameters in <code>params</code> would look like this:</p>
<div class="interstitial code"> <pre data-language="ruby">{
  'person' =&gt; {
    'name' =&gt; 'John Doe',
    'addresses_attributes' =&gt; {
      '0' =&gt; {
        'kind' =&gt; 'Home',
        'street' =&gt; '221b Baker Street'
      },
      '1' =&gt; {
        'kind' =&gt; 'Office',
        'street' =&gt; '31 Spooner Street'
      }
    }
  }
}</pre> <button class="clipboard-button" data-clipboard-text="{
  'person' =&gt; {
    'name' =&gt; 'John Doe',
    'addresses_attributes' =&gt; {
      '0' =&gt; {
        'kind' =&gt; 'Home',
        'street' =&gt; '221b Baker Street'
      },
      '1' =&gt; {
        'kind' =&gt; 'Office',
        'street' =&gt; '31 Spooner Street'
      }
    }
  }
}
">Copy</button> </div> <p>The actual value of the keys in the <code>:addresses_attributes</code> hash is not important. But they need to be strings of integers and different for each address.</p>
<p>If the associated object is already saved, <code>fields_for</code> autogenerates a hidden input with the <code>id</code> of the saved record. You can disable this by passing <code>include_id: false</code> to <code>fields_for</code>.</p>
<div class="interstitial code"> <pre data-language="ruby">{
  'person' =&gt; {
    'name' =&gt; 'John Doe',
    'addresses_attributes' =&gt; {
      '0' =&gt; {
        'id' =&gt; 1,
        'kind' =&gt; 'Home',
        'street' =&gt; '221b Baker Street'
      },
      '1' =&gt; {
        'id' =&gt; '2',
        'kind' =&gt; 'Office',
        'street' =&gt; '31 Spooner Street'
      }
    }
  }
}</pre> <button class="clipboard-button" data-clipboard-text="{
  'person' =&gt; {
    'name' =&gt; 'John Doe',
    'addresses_attributes' =&gt; {
      '0' =&gt; {
        'id' =&gt; 1,
        'kind' =&gt; 'Home',
        'street' =&gt; '221b Baker Street'
      },
      '1' =&gt; {
        'id' =&gt; '2',
        'kind' =&gt; 'Office',
        'street' =&gt; '31 Spooner Street'
      }
    }
  }
}
">Copy</button> </div> <h2 id="permitting-parameters-in-the-controller"><a class="anchorlink" href="#permitting-parameters-in-the-controller"><span>9.3</span> Permitting Parameters in the Controller</a></h2>
<p>As usual you need to <a href="action_controller_overview.html#strong-parameters">declare the permitted parameters</a> in the controller before you pass them to the model:</p>
<div class="interstitial code"> <pre data-language="ruby">def create
  @person = Person.new(person_params)
  # ...
end

private
  def person_params
    params.require(:person).permit(:name, addresses_attributes: [:id, :kind, :street])
  end</pre> <button class="clipboard-button" data-clipboard-text="def create
  @person = Person.new(person_params)
  # ...
end

private
  def person_params
    params.require(:person).permit(:name, addresses_attributes: [:id, :kind, :street])
  end
">Copy</button> </div> <h2 id="removing-associated-objects"><a class="anchorlink" href="#removing-associated-objects"><span>9.4</span> Removing Associated Objects</a></h2>
<p>You can allow users to delete associated objects by passing <code>allow_destroy: true</code> to <code>accepts_nested_attributes_for</code></p>
<div class="interstitial code"> <pre data-language="ruby">class Person &lt; ApplicationRecord
  has_many :addresses
  accepts_nested_attributes_for :addresses, allow_destroy: true
end</pre> <button class="clipboard-button" data-clipboard-text="class Person &lt; ApplicationRecord
  has_many :addresses
  accepts_nested_attributes_for :addresses, allow_destroy: true
end
">Copy</button> </div> <p>If the hash of attributes for an object contains the key <code>_destroy</code> with a value that evaluates to <code>true</code> (e.g. <code>1</code>, <code>'1'</code>, <code>true</code>, or <code>'true'</code>) then the object will be destroyed. This form allows users to remove addresses:</p>
<div class="interstitial code"> <pre data-language="erb">&lt;%= form_with model: @person do |form| %&gt;
  Addresses:
  &lt;ul&gt;
    &lt;%= form.fields_for :addresses do |addresses_form| %&gt;
      &lt;li&gt;
        &lt;%= addresses_form.check_box :_destroy %&gt;
        &lt;%= addresses_form.label :kind %&gt;
        &lt;%= addresses_form.text_field :kind %&gt;
        ...
      &lt;/li&gt;
    &lt;% end %&gt;
  &lt;/ul&gt;
&lt;% end %&gt;</pre> <button class="clipboard-button" data-clipboard-text="&lt;%= form_with model: @person do |form| %&gt;
  Addresses:
  &lt;ul&gt;
    &lt;%= form.fields_for :addresses do |addresses_form| %&gt;
      &lt;li&gt;
        &lt;%= addresses_form.check_box :_destroy %&gt;
        &lt;%= addresses_form.label :kind %&gt;
        &lt;%= addresses_form.text_field :kind %&gt;
        ...
      &lt;/li&gt;
    &lt;% end %&gt;
  &lt;/ul&gt;
&lt;% end %&gt;
">Copy</button> </div> <p>The HTML for the <code>_destroy</code> field:</p>
<div class="interstitial code"> <pre data-language="html">&lt;input type="checkbox" value="1" name="person[addresses_attributes][0][_destroy]" id="person_addresses_attributes_0__destroy"&gt;</pre> <button class="clipboard-button" data-clipboard-text='&lt;input type="checkbox" value="1" name="person[addresses_attributes][0][_destroy]" id="person_addresses_attributes_0__destroy"&gt;
'>Copy</button> </div> <p>You also need to update the permitted params in your controller to include the <code>_destroy</code> field:</p>
<div class="interstitial code"> <pre data-language="ruby">def person_params
  params.require(:person).
    permit(:name, addresses_attributes: [:id, :kind, :street, :_destroy])
end</pre> <button class="clipboard-button" data-clipboard-text="def person_params
  params.require(:person).
    permit(:name, addresses_attributes: [:id, :kind, :street, :_destroy])
end
">Copy</button> </div> <h2 id="preventing-empty-records"><a class="anchorlink" href="#preventing-empty-records"><span>9.5</span> Preventing Empty Records</a></h2>
<p>It is often useful to ignore sets of fields that the user has not filled in. You can control this by passing a <code>:reject_if</code> proc to <code>accepts_nested_attributes_for</code>. This proc will be called with each hash of attributes submitted by the form. If the proc returns <code>true</code> then Active Record will not build an associated object for that hash. The example below only tries to build an address if the <code>kind</code> attribute is set.</p>
<div class="interstitial code"> <pre data-language="ruby">class Person &lt; ApplicationRecord
  has_many :addresses
  accepts_nested_attributes_for :addresses, reject_if: lambda { |attributes| attributes['kind'].blank? }
end</pre> <button class="clipboard-button" data-clipboard-text="class Person &lt; ApplicationRecord
  has_many :addresses
  accepts_nested_attributes_for :addresses, reject_if: lambda { |attributes| attributes['kind'].blank? }
end
">Copy</button> </div> <p>As a convenience you can instead pass the symbol <code>:all_blank</code> which will create a proc that will reject records where all the attributes are blank excluding any value for <code>_destroy</code>.</p>
<h1 id="forms-to-external-resources"><a class="anchorlink" href="#forms-to-external-resources"><span>10</span> Forms to External Resources</a></h1>
<p>Rails form helpers can be used to build a form for posting data to an external resource. If the external API expects an <code>authenticity_token</code> for the resource, this can be passed as an <code>authenticity_token: 'your_external_token'</code> parameter to <code>form_with</code>:</p>
<div class="interstitial code"> <pre data-language="erb">&lt;%= form_with url: 'http://farfar.away/form', authenticity_token: 'external_token' do %&gt;
  Form contents
&lt;% end %&gt;</pre> <button class="clipboard-button" data-clipboard-text="&lt;%= form_with url: 'http://farfar.away/form', authenticity_token: 'external_token' do %&gt;
  Form contents
&lt;% end %&gt;
">Copy</button> </div> <p>At other times, the fields that can be used in the form are limited by an external API and it may be undesirable to generate an <code>authenticity_token</code>. To <em>not</em> send a token, you can pass <code>false</code> to the <code>:authenticity_token</code> option:</p>
<div class="interstitial code"> <pre data-language="erb">&lt;%= form_with url: 'http://farfar.away/form', authenticity_token: false do %&gt;
  Form contents
&lt;% end %&gt;</pre> <button class="clipboard-button" data-clipboard-text="&lt;%= form_with url: 'http://farfar.away/form', authenticity_token: false do %&gt;
  Form contents
&lt;% end %&gt;
">Copy</button> </div> <h1 id="using-tag-helpers-without-a-form-builder"><a class="anchorlink" href="#using-tag-helpers-without-a-form-builder"><span>11</span> Using Tag Helpers without a Form Builder</a></h1>
<p>In case you need to render form fields outside of the context of a form builder, Rails provides tag helpers for common form elements. For example, <a href="https://edgeapi.rubyonrails.org/classes/ActionView/Helpers/FormTagHelper.html#method-i-check_box_tag"><code>check_box_tag</code></a>:</p>
<div class="interstitial code"> <pre data-language="erb">&lt;%= check_box_tag "accept" %&gt;</pre> <button class="clipboard-button" data-clipboard-text='&lt;%= check_box_tag "accept" %&gt;
'>Copy</button> </div> <p>Output:</p>
<div class="interstitial code"> <pre data-language="html">&lt;input type="checkbox" name="accept" id="accept" value="1" /&gt;</pre> <button class="clipboard-button" data-clipboard-text='&lt;input type="checkbox" name="accept" id="accept" value="1" /&gt;
'>Copy</button> </div> <p>Generally, these helpers have the same name as their form builder counterparts plus a <code>_tag</code> suffix. For a complete list, see the <a href="https://edgeapi.rubyonrails.org/classes/ActionView/Helpers/FormTagHelper.html"><code>FormTagHelper</code> API documentation</a>.</p>
<h1 id="using-form-tag-and-form-for"><a class="anchorlink" href="#using-form-tag-and-form-for"><span>12</span> Using <code>form_tag</code> and <code>form_for</code></a></h1>
<p>Before <code>form_with</code> was introduced in Rails 5.1 its functionality was split between <a href="https://api.rubyonrails.org/v5.2/classes/ActionView/Helpers/FormTagHelper.html#method-i-form_tag"><code>form_tag</code></a> and <a href="https://api.rubyonrails.org/v5.2/classes/ActionView/Helpers/FormHelper.html#method-i-form_for"><code>form_for</code></a>. Both are now soft-deprecated in favor of <code>form_with</code>.</p> <hr> <h2>Feedback</h2> <p> You're encouraged to help improve the quality of this guide. </p> <p> Please contribute if you see any typos or factual errors. To get started, you can read our <a href="https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation">documentation contributions</a> section. </p> <p> You may also find incomplete content or stuff that is not up to date. Please do add any missing documentation for main. Make sure to check <a href="https://edgeguides.rubyonrails.org">Edge Guides</a> first to verify if the issues are already fixed or not on the main branch. Check the <span>Ruby on Rails Guides Guidelines</span> for style and conventions. </p> <p> If for whatever reason you spot something to fix but cannot patch it yourself, please <a href="https://github.com/rails/rails/issues">open an issue</a>. </p> <p>And last but not least, any kind of discussion regarding Ruby on Rails documentation is very welcome on the <a href="https://discuss.rubyonrails.org/c/rubyonrails-docs">official Ruby on Rails Forum</a>. </p> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2004&ndash;2021 David Heinemeier Hansson<br>Licensed under the Creative Commons Attribution-ShareAlike 4.0 International License.<br>
    
  </p>
</div>
