<h1 id="class-ActionController::Parameters" class="class"> class ActionController::Parameters </h1>
<dl class="meta">
<dt>Parent:</dt>
<dd class="meta-parent"><a href="../object.html">Object</a></dd>
</dl> <section class="description"> <h1 id="class-ActionController::Parameters-label-Action+Controller+Parameters">Action Controller <a href="parameters.html"><code>Parameters</code></a>
</h1> <p>Allows you to choose which attributes should be permitted for mass updating and thus prevent accidentally exposing that which shouldn’t be exposed.</p> <p>Provides methods for filtering and requiring params:</p> <ul>
<li> <p><code>expect</code> to safely permit and require parameters in one step.</p> </li>
<li> <p><code>permit</code> to filter params for mass assignment.</p> </li>
<li> <p><code>require</code> to require a parameter or raise an error.</p> </li>
</ul> <p>Examples:</p> <pre class="ruby" data-language="ruby">params = ActionController::Parameters.new({
  person: {
    name: "Francesco",
    age:  22,
    role: "admin"
  }
})

permitted = params.expect(person: [:name, :age])
permitted # =&gt; #&lt;ActionController::Parameters {"name"=&gt;"Francesco", "age"=&gt;22} permitted: true&gt;

Person.first.update!(permitted)
# =&gt; #&lt;Person id: 1, name: "Francesco", age: 22, role: "user"&gt;
</pre> <p><a href="parameters.html"><code>Parameters</code></a> provides two options that control the top-level behavior of new instances:</p> <ul>
<li> <p><code>permit_all_parameters</code> - If it’s <code>true</code>, all the parameters will be permitted by default. The default is <code>false</code>.</p> </li>
<li> <p><code>action_on_unpermitted_parameters</code> - Controls behavior when parameters that are not explicitly permitted are found. The default value is <code>:log</code> in test and development environments, <code>false</code> otherwise. The values can be:</p> <ul>
<li> <p><code>false</code> to take no action.</p> </li>
<li> <p><code>:log</code> to emit an <code>ActiveSupport::Notifications.instrument</code> event on the <code>unpermitted_parameters.action_controller</code> topic and log at the DEBUG level.</p> </li>
<li> <p><code>:raise</code> to raise an <a href="unpermittedparameters.html"><code>ActionController::UnpermittedParameters</code></a> exception.</p> </li>
</ul> </li>
</ul> <p>Examples:</p> <pre class="ruby" data-language="ruby">params = ActionController::Parameters.new
params.permitted? # =&gt; false

ActionController::Parameters.permit_all_parameters = true

params = ActionController::Parameters.new
params.permitted? # =&gt; true

params = ActionController::Parameters.new(a: "123", b: "456")
params.permit(:c)
# =&gt; #&lt;ActionController::Parameters {} permitted: true&gt;

ActionController::Parameters.action_on_unpermitted_parameters = :raise

params = ActionController::Parameters.new(a: "123", b: "456")
params.permit(:c)
# =&gt; ActionController::UnpermittedParameters: found unpermitted keys: a, b
</pre> <p>Please note that these options <em>are not thread-safe</em>. In a multi-threaded environment they should only be set once at boot-time and never mutated at runtime.</p> <p>You can fetch values of <code>ActionController::Parameters</code> using either <code>:key</code> or <code>"key"</code>.</p> <pre class="ruby" data-language="ruby">params = ActionController::Parameters.new(key: "value")
params[:key]  # =&gt; "value"
params["key"] # =&gt; "value"
</pre> </section> <section id="5Buntitled-5D" class="documentation-section"> <section class="constants-list"> <header> <h3>Constants</h3> </header> <dl> <dt id="PERMITTED_SCALAR_TYPES">PERMITTED_SCALAR_TYPES </dt>
<dd>
<p>— Filtering ———————————————————-</p> <p>This is a list of permitted scalar types that includes the ones supported in XML and JSON requests.</p> <p>This list is in particular used to filter ordinary requests, <a href="../string.html"><code>String</code></a> goes as first element to quickly short-circuit the common case.</p> <p>If you modify this collection please update the one in the <a href="parameters.html#method-i-permit"><code>permit</code></a> doc as well.</p> </dd>
</dl> </section> <section class="attribute-method-details"> <header> <h3>Attributes</h3> </header> <div class="method-detail"> <div class="method-heading attribute-method-heading" id="attribute-i-parameters"> <span class="method-name">parameters</span><span class="attribute-access-type">[R]</span> </div>  </div> <div class="method-detail"> <div class="method-heading attribute-method-heading" id="attribute-i-permitted"> <span class="method-name">permitted</span><span class="attribute-access-type">[W]</span> </div>  </div> </section> <section id="public-class-5Buntitled-5D-method-details" class="method-section"> <header> <h3>Public Class Methods</h3> </header> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-c-new"> <span class="method-name">new</span><span class="method-args">(parameters = {}, logging_context = {})</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="new-source"> <pre class="ruby" data-language="ruby"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 287
def initialize(parameters = {}, logging_context = {})
  parameters.each_key do |key|
    unless key.is_a?(String) || key.is_a?(Symbol)
      raise InvalidParameterKey, "all keys must be Strings or Symbols, got: #{key.class}"
    end
  end

  @parameters = parameters.with_indifferent_access
  @logging_context = logging_context
  @permitted = self.class.permit_all_parameters
end</pre> </div> <p>Returns a new <code>ActionController::Parameters</code> instance. Also, sets the <code>permitted</code> attribute to the default value of <code>ActionController::Parameters.permit_all_parameters</code>.</p> <pre class="ruby" data-language="ruby">class Person &lt; ActiveRecord::Base
end

params = ActionController::Parameters.new(name: "Francesco")
params.permitted?  # =&gt; false
Person.new(params) # =&gt; ActiveModel::ForbiddenAttributesError

ActionController::Parameters.permit_all_parameters = true

params = ActionController::Parameters.new(name: "Francesco")
params.permitted?  # =&gt; true
Person.new(params) # =&gt; #&lt;Person id: nil, name: "Francesco"&gt;
</pre>  </div> </div> </section> <section id="public-instance-5Buntitled-5D-method-details" class="method-section"> <header> <h3>Public Instance Methods</h3> </header> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-3D-3D"> <span class="method-name">==</span><span class="method-args">(other)</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="3D-3D-source"> <pre class="ruby" data-language="ruby"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 301
def ==(other)
  if other.respond_to?(:permitted?)
    permitted? == other.permitted? &amp;&amp; parameters == other.parameters
  else
    super
  end
end</pre> </div> <p>Returns true if another <code>Parameters</code> object contains the same content and permitted flag.</p> <div class="method-calls-super"> Calls superclass method </div>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-5B-5D"> <span class="method-name">[]</span><span class="method-args">(key)</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="5B-5D-source"> <pre class="ruby" data-language="ruby"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 797
def [](key)
  convert_hashes_to_parameters(key, @parameters[key])
end</pre> </div> <p>Returns a parameter for the given <code>key</code>. If not found, returns <code>nil</code>.</p> <pre class="ruby" data-language="ruby">params = ActionController::Parameters.new(person: { name: "Francesco" })
params[:person] # =&gt; #&lt;ActionController::Parameters {"name"=&gt;"Francesco"} permitted: false&gt;
params[:none]   # =&gt; nil
</pre>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-5B-5D-3D"> <span class="method-name">[]=</span><span class="method-args">(key, value)</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="5B-5D-3D-source"> <pre class="ruby" data-language="ruby"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 803
def []=(key, value)
  @parameters[key] = value
end</pre> </div> <p>Assigns a value to a given <code>key</code>. The given key may still get filtered out when <a href="parameters.html#method-i-permit"><code>permit</code></a> is called.</p>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-as_json"> <span class="method-callseq"> as_json(options=nil) </span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="as_json-source"> <pre class="c" data-language="c"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 194
    </pre> </div> <p>Returns a hash that can be used as the JSON representation for the parameters.</p>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-compact"> <span class="method-name">compact</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="compact-source"> <pre class="ruby" data-language="ruby"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 974
def compact
  new_instance_with_inherited_permitted_status(@parameters.compact)
end</pre> </div> <p>Returns a new <code>ActionController::Parameters</code> instance with <code>nil</code> values removed.</p>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-compact-21"> <span class="method-name">compact!</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="compact-21-source"> <pre class="ruby" data-language="ruby"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 980
def compact!
  self if @parameters.compact!
end</pre> </div> <p>Removes all <code>nil</code> values in place and returns <code>self</code>, or <code>nil</code> if no changes were made.</p>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-compact_blank"> <span class="method-name">compact_blank</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="compact_blank-source"> <pre class="ruby" data-language="ruby"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 986
def compact_blank
  reject { |_k, v| v.blank? }
end</pre> </div> <p>Returns a new <code>ActionController::Parameters</code> instance without the blank values. Uses <a href="../object.html#method-i-blank-3F"><code>Object#blank?</code></a> for determining if a value is blank.</p>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-compact_blank-21"> <span class="method-name">compact_blank!</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="compact_blank-21-source"> <pre class="ruby" data-language="ruby"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 992
def compact_blank!
  reject! { |_k, v| v.blank? }
end</pre> </div> <p>Removes all blank values in place and returns self. Uses <a href="../object.html#method-i-blank-3F"><code>Object#blank?</code></a> for determining if a value is blank.</p>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-converted_arrays"> <span class="method-name">converted_arrays</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="converted_arrays-source"> <pre class="ruby" data-language="ruby"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 435
def converted_arrays
  @converted_arrays ||= Set.new
end</pre> </div> <p>Attribute that keeps track of converted arrays, if any, to avoid double looping in the common use case permit + mass-assignment. Defined in a method to instantiate it only if needed.</p> <p><span><code>Testing</code></span> membership still loops, but it’s going to be faster than our own loop that converts values. Also, we are not going to build a new array object per fetch.</p>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-deep_dup"> <span class="method-name">deep_dup</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="deep_dup-source"> <pre class="ruby" data-language="ruby"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 1092
def deep_dup
  self.class.new(@parameters.deep_dup, @logging_context).tap do |duplicate|
    duplicate.permitted = @permitted
  end
end</pre> </div> <p>Returns a duplicate <code>ActionController::Parameters</code> instance with the same permitted parameters.</p>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-deep_merge"> <span class="method-callseq"> deep_merge(other_hash, &amp;block) </span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="deep_merge-source"> <pre class="c" data-language="c"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 168
    </pre> </div> <p>Returns a new <code>ActionController::Parameters</code> instance with <code>self</code> and <code>other_hash</code> merged recursively.</p> <p>Like with <code>Hash#merge</code> in the standard library, a block can be provided to merge values.</p>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-deep_merge-21"> <span class="method-callseq"> deep_merge!(other_hash, &amp;block) </span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="deep_merge-21-source"> <pre class="c" data-language="c"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 183
    </pre> </div> <p>Same as <code>#deep_merge</code>, but modifies <code>self</code>.</p>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-deep_transform_keys"> <span class="method-name">deep_transform_keys</span><span class="method-args">(&amp;block)</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="deep_transform_keys-source"> <pre class="ruby" data-language="ruby"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 924
def deep_transform_keys(&amp;block)
  new_instance_with_inherited_permitted_status(
    _deep_transform_keys_in_object(@parameters, &amp;block).to_unsafe_h
  )
end</pre> </div> <p>Returns a new <code>ActionController::Parameters</code> instance with the results of running <code>block</code> once for every key. This includes the keys from the root hash and from all nested hashes and arrays. The values are unchanged.</p>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-deep_transform_keys-21"> <span class="method-name">deep_transform_keys!</span><span class="method-args">(&amp;block)</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="deep_transform_keys-21-source"> <pre class="ruby" data-language="ruby"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 933
def deep_transform_keys!(&amp;block)
  @parameters = _deep_transform_keys_in_object(@parameters, &amp;block).to_unsafe_h
  self
end</pre> </div> <p>Returns the same <code>ActionController::Parameters</code> instance with changed keys. This includes the keys from the root hash and from all nested hashes and arrays. The values are unchanged.</p>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-delete"> <span class="method-name">delete</span><span class="method-args">(key, &amp;block)</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="delete-source"> <pre class="ruby" data-language="ruby"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 942
def delete(key, &amp;block)
  convert_value_to_parameters(@parameters.delete(key, &amp;block))
end</pre> </div> <p>Deletes a key-value pair from <code>Parameters</code> and returns the value. If <code>key</code> is not found, returns <code>nil</code> (or, with optional code block, yields <code>key</code> and returns the result). This method is similar to <a href="parameters.html#method-i-extract-21"><code>extract!</code></a>, which returns the corresponding <code>ActionController::Parameters</code> object.</p>  </div> </div> <div class="method-detail method-alias"> <div class="method-header"> <div class="method-heading" id="method-i-delete_if"> <span class="method-name">delete_if</span><span class="method-args">(&amp;block)</span> </div> </div>  <div class="aliases"> Alias for: <a href="parameters.html#method-i-reject-21">reject!</a> </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-dig"> <span class="method-name">dig</span><span class="method-args">(*keys)</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="dig-source"> <pre class="ruby" data-language="ruby"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 841
def dig(*keys)
  convert_hashes_to_parameters(keys.first, @parameters[keys.first])
  @parameters.dig(*keys)
end</pre> </div> <p>Extracts the nested parameter from the given <code>keys</code> by calling <code>dig</code> at each step. Returns <code>nil</code> if any intermediate step is <code>nil</code>.</p> <pre class="ruby" data-language="ruby">params = ActionController::Parameters.new(foo: { bar: { baz: 1 } })
params.dig(:foo, :bar, :baz) # =&gt; 1
params.dig(:foo, :zot, :xyz) # =&gt; nil

params2 = ActionController::Parameters.new(foo: [10, 11, 12])
params2.dig(:foo, 1) # =&gt; 11
</pre>  </div> </div> <div class="method-detail method-alias"> <div class="method-header"> <div class="method-heading" id="method-i-each"> <span class="method-name">each</span><span class="method-args">(&amp;block)</span> </div> </div>  <div class="aliases"> Alias for: <a href="parameters.html#method-i-each_pair">each_pair</a> </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-each_key"> <span class="method-callseq"> each_key(&amp;block) </span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="each_key-source"> <pre class="c" data-language="c"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 202
    </pre> </div> <p>Calls block once for each key in the parameters, passing the key. If no block is given, an enumerator is returned instead.</p>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-each_pair"> <span class="method-name">each_pair</span><span class="method-args">() { |key, convert_hashes_to_parameters(key, value)| ... }</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="each_pair-source"> <pre class="ruby" data-language="ruby"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 402
def each_pair(&amp;block)
  return to_enum(__callee__) unless block_given?
  @parameters.each_pair do |key, value|
    yield [key, convert_hashes_to_parameters(key, value)]
  end

  self
end</pre> </div> <p>Convert all hashes in values into parameters, then yield each pair in the same way as <code>Hash#each_pair</code>.</p>  </div> <div class="aliases"> Also aliased as: <a href="parameters.html#method-i-each">each</a> </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-each_value"> <span class="method-name">each_value</span><span class="method-args">() { |convert_hashes_to_parameters(key, value)| ... }</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="each_value-source"> <pre class="ruby" data-language="ruby"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 414
def each_value(&amp;block)
  return to_enum(:each_value) unless block_given?
  @parameters.each_pair do |key, value|
    yield convert_hashes_to_parameters(key, value)
  end

  self
end</pre> </div> <p>Convert all hashes in values into parameters, then yield each value in the same way as <code>Hash#each_value</code>.</p>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-empty-3F"> <span class="method-callseq"> empty?() </span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="empty-3F-source"> <pre class="c" data-language="c"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 211
    </pre> </div> <p>Returns true if the parameters have no key/value pairs.</p>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-eql-3F"> <span class="method-name">eql?</span><span class="method-args">(other)</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="eql-3F-source"> <pre class="ruby" data-language="ruby"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 309
def eql?(other)
  self.class == other.class &amp;&amp;
    permitted? == other.permitted? &amp;&amp;
    parameters.eql?(other.parameters)
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-except"> <span class="method-name">except</span><span class="method-args">(*keys)</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="except-source"> <pre class="ruby" data-language="ruby"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 869
def except(*keys)
  new_instance_with_inherited_permitted_status(@parameters.except(*keys))
end</pre> </div> <p>Returns a new <code>ActionController::Parameters</code> instance that filters out the given <code>keys</code>.</p> <pre class="ruby" data-language="ruby">params = ActionController::Parameters.new(a: 1, b: 2, c: 3)
params.except(:a, :b) # =&gt; #&lt;ActionController::Parameters {"c"=&gt;3} permitted: false&gt;
params.except(:d)     # =&gt; #&lt;ActionController::Parameters {"a"=&gt;1, "b"=&gt;2, "c"=&gt;3} permitted: false&gt;
</pre>  </div> <div class="aliases"> Also aliased as: <a href="parameters.html#method-i-without">without</a> </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-exclude-3F"> <span class="method-callseq"> exclude?(key) </span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="exclude-3F-source"> <pre class="c" data-language="c"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 219
    </pre> </div> <p>Returns true if the given key is not present in the parameters.</p>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-expect"> <span class="method-name">expect</span><span class="method-args">(*filters)</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="expect-source"> <pre class="ruby" data-language="ruby"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 772
def expect(*filters)
  params = permit_filters(filters)
  keys = filters.flatten.flat_map { |f| f.is_a?(Hash) ? f.keys : f }
  values = params.require(keys)
  values.size == 1 ? values.first : values
end</pre> </div> <p><code>expect</code> is the preferred way to require and permit parameters. It is safer than the previous recommendation to call <code>permit</code> and <code>require</code> in sequence, which could allow user triggered 500 errors.</p> <p><code>expect</code> is more strict with types to avoid a number of potential pitfalls that may be encountered with the <code>.require.permit</code> pattern.</p> <p>For example:</p> <pre class="ruby" data-language="ruby">params = ActionController::Parameters.new(comment: { text: "hello" })
params.expect(comment: [:text])
# =&gt; #&lt;ActionController::Parameters { text: "hello" } permitted: true&gt;

params = ActionController::Parameters.new(comment: [{ text: "hello" }, { text: "world" }])
params.expect(comment: [:text])
# =&gt; ActionController::ParameterMissing: param is missing or the value is empty or invalid: comment
</pre> <p>In order to permit an array of parameters, the array must be defined explicitly. Use double array brackets, an array inside an array, to declare that an array of parameters is expected.</p> <pre class="ruby" data-language="ruby">params = ActionController::Parameters.new(comments: [{ text: "hello" }, { text: "world" }])
params.expect(comments: [[:text]])
# =&gt; [#&lt;ActionController::Parameters { "text" =&gt; "hello" } permitted: true&gt;,
#     #&lt;ActionController::Parameters { "text" =&gt; "world" } permitted: true&gt;]

params = ActionController::Parameters.new(comments: { text: "hello" })
params.expect(comments: [[:text]])
# =&gt; ActionController::ParameterMissing: param is missing or the value is empty or invalid: comments
</pre> <p><code>expect</code> is intended to protect against array tampering.</p> <pre class="ruby" data-language="ruby">params = ActionController::Parameters.new(user: "hack")
# The previous way of requiring and permitting parameters will error
params.require(:user).permit(:name, pets: [:name]) # wrong
# =&gt; NoMethodError: undefined method `permit' for an instance of String

# similarly with nested parameters
params = ActionController::Parameters.new(user: { name: "Martin", pets: { name: "hack" } })
user_params = params.require(:user).permit(:name, pets: [:name]) # wrong
# user_params[:pets] is expected to be an array but is a hash
</pre> <p><code>expect</code> solves this by being more strict with types.</p> <pre class="ruby" data-language="ruby">params = ActionController::Parameters.new(user: "hack")
params.expect(user: [ :name, pets: [[:name]] ])
# =&gt; ActionController::ParameterMissing: param is missing or the value is empty or invalid: user

# with nested parameters
params = ActionController::Parameters.new(user: { name: "Martin", pets: { name: "hack" } })
user_params = params.expect(user: [:name, pets: [[:name]] ])
user_params[:pets] # =&gt; nil
</pre> <p>As the examples show, <code>expect</code> requires the <code>:user</code> key, and any root keys similar to the <code>.require.permit</code> pattern. If multiple root keys are expected, they will all be required.</p> <pre class="ruby" data-language="ruby">params = ActionController::Parameters.new(name: "Martin", pies: [{ type: "dessert", flavor: "pumpkin"}])
name, pies = params.expect(:name, pies: [[:type, :flavor]])
name # =&gt; "Martin"
pies # =&gt; [#&lt;ActionController::Parameters {"type"=&gt;"dessert", "flavor"=&gt;"pumpkin"} permitted: true&gt;]
</pre> <p>When called with a hash with multiple keys, <code>expect</code> will permit the parameters and require the keys in the order they are given in the hash, returning an array of the permitted parameters.</p> <pre class="ruby" data-language="ruby">params = ActionController::Parameters.new(subject: { name: "Martin" }, object: { pie: "pumpkin" })
subject, object = params.expect(subject: [:name], object: [:pie])
subject # =&gt; #&lt;ActionController::Parameters {"name"=&gt;"Martin"} permitted: true&gt;
object  # =&gt; #&lt;ActionController::Parameters {"pie"=&gt;"pumpkin"} permitted: true&gt;
</pre> <p>Besides being more strict about array vs hash params, <code>expect</code> uses permit internally, so it will behave similarly.</p> <pre class="ruby" data-language="ruby">params = ActionController::Parameters.new({
  person: {
    name: "Francesco",
    age:  22,
    pets: [{
      name: "Purplish",
      category: "dogs"
    }]
  }
})

permitted = params.expect(person: [ :name, { pets: [[:name]] } ])
permitted.permitted?           # =&gt; true
permitted[:name]               # =&gt; "Francesco"
permitted[:age]                # =&gt; nil
permitted[:pets][0][:name]     # =&gt; "Purplish"
permitted[:pets][0][:category] # =&gt; nil
</pre> <p>An array of permitted scalars may be expected with the following:</p> <pre class="ruby" data-language="ruby">params = ActionController::Parameters.new(tags: ["rails", "parameters"])
permitted = params.expect(tags: [])
permitted.permitted?      # =&gt; true
permitted.is_a?(Array)    # =&gt; true
permitted.size            # =&gt; 2
</pre>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-expect-21"> <span class="method-name">expect!</span><span class="method-args">(*filters)</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="expect-21-source"> <pre class="ruby" data-language="ruby"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 786
def expect!(*filters)
  expect(*filters)
rescue ParameterMissing =&gt; e
  raise ExpectedParameterMissing.new(e.param, e.keys)
end</pre> </div> <p>Same as <code>expect</code>, but raises an <code>ActionController::ExpectedParameterMissing</code> instead of <code>ActionController::ParameterMissing</code>. Unlike <code>expect</code> which will render a 400 response, <code>expect!</code> will raise an exception that is not handled. This is intended for debugging invalid params for an internal <a href="api.html"><code>API</code></a> where incorrectly formatted params would indicate a bug in a client library that should be fixed.</p>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-extract-21"> <span class="method-name">extract!</span><span class="method-args">(*keys)</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="extract-21-source"> <pre class="ruby" data-language="ruby"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 879
def extract!(*keys)
  new_instance_with_inherited_permitted_status(@parameters.extract!(*keys))
end</pre> </div> <p>Removes and returns the key/value pairs matching the given keys.</p> <pre class="ruby" data-language="ruby">params = ActionController::Parameters.new(a: 1, b: 2, c: 3)
params.extract!(:a, :b) # =&gt; #&lt;ActionController::Parameters {"a"=&gt;1, "b"=&gt;2} permitted: false&gt;
params                  # =&gt; #&lt;ActionController::Parameters {"c"=&gt;3} permitted: false&gt;
</pre>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-extract_value"> <span class="method-name">extract_value</span><span class="method-args">(key, delimiter: "_")</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="extract_value-source"> <pre class="ruby" data-language="ruby"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 1110
def extract_value(key, delimiter: "_")
  @parameters[key]&amp;.split(delimiter, -1)
end</pre> </div> <p>Returns parameter value for the given <code>key</code> separated by <code>delimiter</code>.</p> <pre class="ruby" data-language="ruby">params = ActionController::Parameters.new(id: "1_123", tags: "ruby,rails")
params.extract_value(:id) # =&gt; ["1", "123"]
params.extract_value(:tags, delimiter: ",") # =&gt; ["ruby", "rails"]
params.extract_value(:non_existent_key) # =&gt; nil
</pre> <p>Note that if the given <code>key</code>‘s value contains blank elements, then the returned array will include empty strings.</p> <pre class="ruby" data-language="ruby">params = ActionController::Parameters.new(tags: "ruby,rails,,web")
params.extract_value(:tags, delimiter: ",") # =&gt; ["ruby", "rails", "", "web"]
</pre>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-fetch"> <span class="method-name">fetch</span><span class="method-args">(key, *args) { || ... }</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="fetch-source"> <pre class="ruby" data-language="ruby"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 820
def fetch(key, *args)
  convert_value_to_parameters(
    @parameters.fetch(key) {
      if block_given?
        yield
      else
        args.fetch(0) { raise ActionController::ParameterMissing.new(key, @parameters.keys) }
      end
    }
  )
end</pre> </div> <p>Returns a parameter for the given <code>key</code>. If the <code>key</code> can’t be found, there are several options: With no other arguments, it will raise an <a href="parametermissing.html"><code>ActionController::ParameterMissing</code></a> error; if a second argument is given, then that is returned (converted to an instance of <code>ActionController::Parameters</code> if possible); if a block is given, then that will be run and its result returned.</p> <pre class="ruby" data-language="ruby">params = ActionController::Parameters.new(person: { name: "Francesco" })
params.fetch(:person)               # =&gt; #&lt;ActionController::Parameters {"name"=&gt;"Francesco"} permitted: false&gt;
params.fetch(:none)                 # =&gt; ActionController::ParameterMissing: param is missing or the value is empty or invalid: none
params.fetch(:none, {})             # =&gt; #&lt;ActionController::Parameters {} permitted: false&gt;
params.fetch(:none, "Francesco")    # =&gt; "Francesco"
params.fetch(:none) { "Francesco" } # =&gt; "Francesco"
</pre>  </div> </div> <div class="method-detail method-alias"> <div class="method-header"> <div class="method-heading" id="method-i-has_key-3F"> <span class="method-name">has_key?</span> </div> </div> <div class="aliases"> Alias for: <a href="parameters.html#method-i-include-3F">include?</a> </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-has_value-3F"> <span class="method-name">has_value?</span><span class="method-args">(value)</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="has_value-3F-source"> <pre class="ruby" data-language="ruby"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 997
def has_value?(value)
  each_value.include?(convert_value_to_parameters(value))
end</pre> </div> <p>Returns true if the given value is present for some key in the parameters.</p>  </div> <div class="aliases"> Also aliased as: <a href="parameters.html#method-i-value-3F">value?</a> </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-hash"> <span class="method-name">hash</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="hash-source"> <pre class="ruby" data-language="ruby"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 315
def hash
  [self.class, @parameters, @permitted].hash
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-include-3F"> <span class="method-callseq"> include?(key) </span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="include-3F-source"> <pre class="c" data-language="c"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 227
    </pre> </div> <p>Returns true if the given key is present in the parameters.</p>  </div> <div class="aliases"> Also aliased as: <a href="parameters.html#method-i-has_key-3F">has_key?</a>, <a href="parameters.html#method-i-key-3F">key?</a>, <a href="parameters.html#method-i-member-3F">member?</a> </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-inspect"> <span class="method-name">inspect</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="inspect-source"> <pre class="ruby" data-language="ruby"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 1055
def inspect
  "#&lt;#{self.class} #{@parameters} permitted: #{@permitted}&gt;"
end</pre> </div>  </div> </div> <div class="method-detail method-alias"> <div class="method-header"> <div class="method-heading" id="method-i-keep_if"> <span class="method-name">keep_if</span><span class="method-args">(&amp;block)</span> </div> </div>  <div class="aliases"> Alias for: <a href="parameters.html#method-i-select-21">select!</a> </div> </div> <div class="method-detail method-alias"> <div class="method-header"> <div class="method-heading" id="method-i-key-3F"> <span class="method-name">key?</span> </div> </div> <div class="aliases"> Alias for: <a href="parameters.html#method-i-include-3F">include?</a> </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-keys"> <span class="method-callseq"> keys() </span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="keys-source"> <pre class="c" data-language="c"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 235
    </pre> </div> <p>Returns a new array of the keys of the parameters.</p>  </div> </div> <div class="method-detail method-alias"> <div class="method-header"> <div class="method-heading" id="method-i-member-3F"> <span class="method-name">member?</span> </div> </div> <div class="aliases"> Alias for: <a href="parameters.html#method-i-include-3F">include?</a> </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-merge"> <span class="method-name">merge</span><span class="method-args">(other_hash)</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="merge-source"> <pre class="ruby" data-language="ruby"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 1011
def merge(other_hash)
  new_instance_with_inherited_permitted_status(
    @parameters.merge(other_hash.to_h)
  )
end</pre> </div> <p>Returns a new <code>ActionController::Parameters</code> instance with all keys from <code>other_hash</code> merged into current hash.</p>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-merge-21"> <span class="method-callseq"> merge!(other_hash) </span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="merge-21-source"> <pre class="ruby" data-language="ruby"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 1022
def merge!(other_hash, &amp;block)
  @parameters.merge!(other_hash.to_h, &amp;block)
  self
end</pre> </div> <p>Returns the current <code>ActionController::Parameters</code> instance with <code>other_hash</code> merged into current hash.</p>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-permit"> <span class="method-name">permit</span><span class="method-args">(*filters)</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="permit-source"> <pre class="ruby" data-language="ruby"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 668
def permit(*filters)
  permit_filters(filters, on_unpermitted: self.class.action_on_unpermitted_parameters, explicit_arrays: false)
end</pre> </div> <p>Returns a new <code>ActionController::Parameters</code> instance that includes only the given <code>filters</code> and sets the <code>permitted</code> attribute for the object to <code>true</code>. This is useful for limiting which attributes should be allowed for mass updating.</p> <pre class="ruby" data-language="ruby">params = ActionController::Parameters.new(name: "Francesco", age: 22, role: "admin")
permitted = params.permit(:name, :age)
permitted.permitted?      # =&gt; true
permitted.has_key?(:name) # =&gt; true
permitted.has_key?(:age)  # =&gt; true
permitted.has_key?(:role) # =&gt; false
</pre> <p>Only permitted scalars pass the filter. For example, given</p> <pre class="ruby" data-language="ruby">params.permit(:name)
</pre> <p><code>:name</code> passes if it is a key of <code>params</code> whose associated value is of type <code>String</code>, <code>Symbol</code>, <code>NilClass</code>, <code>Numeric</code>, <code>TrueClass</code>, <code>FalseClass</code>, <code>Date</code>, <code>Time</code>, <code>DateTime</code>, <code>StringIO</code>, <code>IO</code>, <a href="../actiondispatch/http/uploadedfile.html"><code>ActionDispatch::Http::UploadedFile</code></a> or <code>Rack::Test::UploadedFile</code>. Otherwise, the key <code>:name</code> is filtered out.</p> <p>You may declare that the parameter should be an array of permitted scalars by mapping it to an empty array:</p> <pre class="ruby" data-language="ruby">params = ActionController::Parameters.new(tags: ["rails", "parameters"])
params.permit(tags: [])
</pre> <p>Sometimes it is not possible or convenient to declare the valid keys of a hash parameter or its internal structure. Just map to an empty hash:</p> <pre class="ruby" data-language="ruby">params.permit(preferences: {})
</pre> <p>Be careful because this opens the door to arbitrary input. In this case, <code>permit</code> ensures values in the returned structure are permitted scalars and filters out anything else.</p> <p>You can also use <code>permit</code> on nested parameters:</p> <pre class="ruby" data-language="ruby">params = ActionController::Parameters.new({
  person: {
    name: "Francesco",
    age:  22,
    pets: [{
      name: "Purplish",
      category: "dogs"
    }]
  }
})

permitted = params.permit(person: [ :name, { pets: :name } ])
permitted.permitted?                    # =&gt; true
permitted[:person][:name]               # =&gt; "Francesco"
permitted[:person][:age]                # =&gt; nil
permitted[:person][:pets][0][:name]     # =&gt; "Purplish"
permitted[:person][:pets][0][:category] # =&gt; nil
</pre> <p>This has the added benefit of rejecting user-modified inputs that send a string when a hash is expected.</p> <p>When followed by <code>require</code>, you can both filter and require parameters following the typical pattern of a <a href="../rails.html"><code>Rails</code></a> form. The <code>expect</code> method was made specifically for this use case and is the recommended way to require and permit parameters.</p> <pre class="ruby" data-language="ruby"> permitted = params.expect(person: [:name, :age])
</pre> <p>When using <code>permit</code> and <code>require</code> separately, pay careful attention to the order of the method calls.</p> <pre class="ruby" data-language="ruby"> params = ActionController::Parameters.new(person: { name: "Martin", age: 40, role: "admin" })
 permitted = params.permit(person: [:name, :age]).require(:person) # correct
</pre> <p>When require is used first, it is possible for users of your application to trigger a NoMethodError when the user, for example, sends a string for :person.</p> <pre class="ruby" data-language="ruby"> params = ActionController::Parameters.new(person: "tampered")
 permitted = params.require(:person).permit(:name, :age) # not recommended
 # =&gt; NoMethodError: undefined method `permit' for an instance of String
</pre> <p>Note that if you use <code>permit</code> in a key that points to a hash, it won’t allow all the hash. You also need to specify which attributes inside the hash should be permitted.</p> <pre class="ruby" data-language="ruby">params = ActionController::Parameters.new({
  person: {
    contact: {
      email: "none@test.com",
      phone: "555-1234"
    }
  }
})

params.permit(person: :contact).require(:person)
# =&gt; ActionController::ParameterMissing: param is missing or the value is empty or invalid: person

params.permit(person: { contact: :phone }).require(:person)
# =&gt; #&lt;ActionController::Parameters {"contact"=&gt;#&lt;ActionController::Parameters {"phone"=&gt;"555-1234"} permitted: true&gt;} permitted: true&gt;

params.permit(person: { contact: [ :email, :phone ] }).require(:person)
# =&gt; #&lt;ActionController::Parameters {"contact"=&gt;#&lt;ActionController::Parameters {"email"=&gt;"none@test.com", "phone"=&gt;"555-1234"} permitted: true&gt;} permitted: true&gt;
</pre> <p>If your parameters specify multiple parameters indexed by a number, you can permit each set of parameters under the numeric key to be the same using the same syntax as permitting a single item.</p> <pre class="ruby" data-language="ruby">params = ActionController::Parameters.new({
  person: {
    '0': {
      email: "none@test.com",
      phone: "555-1234"
    },
    '1': {
      email: "nothing@test.com",
      phone: "555-6789"
    },
  }
})
params.permit(person: [:email]).to_h
# =&gt; {"person"=&gt;{"0"=&gt;{"email"=&gt;"none@test.com"}, "1"=&gt;{"email"=&gt;"nothing@test.com"}}}
</pre> <p>If you want to specify what keys you want from each numeric key, you can instead specify each one individually</p> <pre class="ruby" data-language="ruby">params = ActionController::Parameters.new({
  person: {
    '0': {
      email: "none@test.com",
      phone: "555-1234"
    },
    '1': {
      email: "nothing@test.com",
      phone: "555-6789"
    },
  }
})
params.permit(person: { '0': [:email], '1': [:phone]}).to_h
# =&gt; {"person"=&gt;{"0"=&gt;{"email"=&gt;"none@test.com"}, "1"=&gt;{"phone"=&gt;"555-6789"}}}
</pre>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-permit-21"> <span class="method-name">permit!</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="permit-21-source"> <pre class="ruby" data-language="ruby"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 461
def permit!
  each_pair do |key, value|
    Array.wrap(value).flatten.each do |v|
      v.permit! if v.respond_to? :permit!
    end
  end

  @permitted = true
  self
end</pre> </div> <p>Sets the <code>permitted</code> attribute to <code>true</code>. This can be used to pass mass assignment. Returns <code>self</code>.</p> <pre class="ruby" data-language="ruby">class Person &lt; ActiveRecord::Base
end

params = ActionController::Parameters.new(name: "Francesco")
params.permitted?  # =&gt; false
Person.new(params) # =&gt; ActiveModel::ForbiddenAttributesError
params.permit!
params.permitted?  # =&gt; true
Person.new(params) # =&gt; #&lt;Person id: nil, name: "Francesco"&gt;
</pre>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-permitted-3F"> <span class="method-name">permitted?</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="permitted-3F-source"> <pre class="ruby" data-language="ruby"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 445
def permitted?
  @permitted
end</pre> </div> <p>Returns <code>true</code> if the parameter is permitted, <code>false</code> otherwise.</p> <pre class="ruby" data-language="ruby">params = ActionController::Parameters.new
params.permitted? # =&gt; false
params.permit!
params.permitted? # =&gt; true
</pre>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-reject"> <span class="method-name">reject</span><span class="method-args">(&amp;block)</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="reject-source"> <pre class="ruby" data-language="ruby"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 961
def reject(&amp;block)
  new_instance_with_inherited_permitted_status(@parameters.reject(&amp;block))
end</pre> </div> <p>Returns a new <code>ActionController::Parameters</code> instance with items that the block evaluates to true removed.</p>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-reject-21"> <span class="method-name">reject!</span><span class="method-args">(&amp;block)</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="reject-21-source"> <pre class="ruby" data-language="ruby"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 966
def reject!(&amp;block)
  @parameters.reject!(&amp;block)
  self
end</pre> </div> <p>Removes items that the block evaluates to true and returns self.</p>  </div> <div class="aliases"> Also aliased as: <a href="parameters.html#method-i-delete_if">delete_if</a> </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-require"> <span class="method-name">require</span><span class="method-args">(key)</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="require-source"> <pre class="ruby" data-language="ruby"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 519
def require(key)
  return key.map { |k| require(k) } if key.is_a?(Array)
  value = self[key]
  if value.present? || value == false
    value
  else
    raise ParameterMissing.new(key, @parameters.keys)
  end
end</pre> </div> <p>This method accepts both a single key and an array of keys.</p> <p>When passed a single key, if it exists and its associated value is either present or the singleton <code>false</code>, returns said value:</p> <pre class="ruby" data-language="ruby">ActionController::Parameters.new(person: { name: "Francesco" }).require(:person)
# =&gt; #&lt;ActionController::Parameters {"name"=&gt;"Francesco"} permitted: false&gt;
</pre> <p>Otherwise raises <a href="parametermissing.html"><code>ActionController::ParameterMissing</code></a>:</p> <pre class="ruby" data-language="ruby">ActionController::Parameters.new.require(:person)
# ActionController::ParameterMissing: param is missing or the value is empty or invalid: person

ActionController::Parameters.new(person: nil).require(:person)
# ActionController::ParameterMissing: param is missing or the value is empty or invalid: person

ActionController::Parameters.new(person: "\t").require(:person)
# ActionController::ParameterMissing: param is missing or the value is empty or invalid: person

ActionController::Parameters.new(person: {}).require(:person)
# ActionController::ParameterMissing: param is missing or the value is empty or invalid: person
</pre> <p>When given an array of keys, the method tries to require each one of them in order. If it succeeds, an array with the respective return values is returned:</p> <pre>params = ActionController::Parameters.new(user: { ... }, profile: { ... })
user_params, profile_params = params.require([:user, :profile])</pre> <p>Otherwise, the method re-raises the first exception found:</p> <pre class="ruby" data-language="ruby">params = ActionController::Parameters.new(user: {}, profile: {})
user_params, profile_params = params.require([:user, :profile])
# ActionController::ParameterMissing: param is missing or the value is empty or invalid: user
</pre> <p>This method is not recommended for fetching terminal values because it does not permit the values. For example, this can cause problems:</p> <pre class="ruby" data-language="ruby"># CAREFUL
params = ActionController::Parameters.new(person: { name: "Finn" })
name = params.require(:person).require(:name) # CAREFUL
</pre> <p>It is recommended to use <code>expect</code> instead:</p> <pre class="ruby" data-language="ruby">def person_params
  params.expect(person: :name).require(:name)
end
</pre>  </div> <div class="aliases"> Also aliased as: <a href="parameters.html#method-i-required">required</a> </div> </div> <div class="method-detail method-alias"> <div class="method-header"> <div class="method-heading" id="method-i-required"> <span class="method-name">required</span><span class="method-args">(key)</span> </div> </div>  <div class="aliases"> Alias for: <a href="parameters.html#method-i-require">require</a> </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-reverse_merge"> <span class="method-name">reverse_merge</span><span class="method-args">(other_hash)</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="reverse_merge-source"> <pre class="ruby" data-language="ruby"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 1033
def reverse_merge(other_hash)
  new_instance_with_inherited_permitted_status(
    other_hash.to_h.merge(@parameters)
  )
end</pre> </div> <p>Returns a new <code>ActionController::Parameters</code> instance with all keys from current hash merged into <code>other_hash</code>.</p>  </div> <div class="aliases"> Also aliased as: <a href="parameters.html#method-i-with_defaults">with_defaults</a> </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-reverse_merge-21"> <span class="method-name">reverse_merge!</span><span class="method-args">(other_hash)</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="reverse_merge-21-source"> <pre class="ruby" data-language="ruby"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 1042
def reverse_merge!(other_hash)
  @parameters.merge!(other_hash.to_h) { |key, left, right| left }
  self
end</pre> </div> <p>Returns the current <code>ActionController::Parameters</code> instance with current hash merged into <code>other_hash</code>.</p>  </div> <div class="aliases"> Also aliased as: <a href="parameters.html#method-i-with_defaults-21">with_defaults!</a> </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-select"> <span class="method-name">select</span><span class="method-args">(&amp;block)</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="select-source"> <pre class="ruby" data-language="ruby"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 948
def select(&amp;block)
  new_instance_with_inherited_permitted_status(@parameters.select(&amp;block))
end</pre> </div> <p>Returns a new <code>ActionController::Parameters</code> instance with only items that the block evaluates to true.</p>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-select-21"> <span class="method-name">select!</span><span class="method-args">(&amp;block)</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="select-21-source"> <pre class="ruby" data-language="ruby"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 953
def select!(&amp;block)
  @parameters.select!(&amp;block)
  self
end</pre> </div> <p>Equivalent to Hash#keep_if, but returns <code>nil</code> if no changes were made.</p>  </div> <div class="aliases"> Also aliased as: <a href="parameters.html#method-i-keep_if">keep_if</a> </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-slice"> <span class="method-name">slice</span><span class="method-args">(*keys)</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="slice-source"> <pre class="ruby" data-language="ruby"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 852
def slice(*keys)
  new_instance_with_inherited_permitted_status(@parameters.slice(*keys))
end</pre> </div> <p>Returns a new <code>ActionController::Parameters</code> instance that includes only the given <code>keys</code>. If the given <code>keys</code> don’t exist, returns an empty hash.</p> <pre class="ruby" data-language="ruby">params = ActionController::Parameters.new(a: 1, b: 2, c: 3)
params.slice(:a, :b) # =&gt; #&lt;ActionController::Parameters {"a"=&gt;1, "b"=&gt;2} permitted: false&gt;
params.slice(:d)     # =&gt; #&lt;ActionController::Parameters {} permitted: false&gt;
</pre>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-slice-21"> <span class="method-name">slice!</span><span class="method-args">(*keys)</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="slice-21-source"> <pre class="ruby" data-language="ruby"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 858
def slice!(*keys)
  @parameters.slice!(*keys)
  self
end</pre> </div> <p>Returns the current <code>ActionController::Parameters</code> instance which contains only the given <code>keys</code>.</p>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-to_h"> <span class="method-name">to_h</span><span class="method-args">(&amp;block)</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="to_h-source"> <pre class="ruby" data-language="ruby"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 331
def to_h(&amp;block)
  if permitted?
    convert_parameters_to_hashes(@parameters, :to_h, &amp;block)
  else
    raise UnfilteredParameters
  end
end</pre> </div> <p>Returns a safe <a href="../activesupport/hashwithindifferentaccess.html"><code>ActiveSupport::HashWithIndifferentAccess</code></a> representation of the parameters with all unpermitted keys removed.</p> <pre class="ruby" data-language="ruby">params = ActionController::Parameters.new({
  name: "Senjougahara Hitagi",
  oddity: "Heavy stone crab"
})
params.to_h
# =&gt; ActionController::UnfilteredParameters: unable to convert unpermitted parameters to hash

safe_params = params.permit(:name)
safe_params.to_h # =&gt; {"name"=&gt;"Senjougahara Hitagi"}
</pre>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-to_hash"> <span class="method-name">to_hash</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="to_hash-source"> <pre class="ruby" data-language="ruby"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 351
def to_hash
  to_h.to_hash
end</pre> </div> <p>Returns a safe <code>Hash</code> representation of the parameters with all unpermitted keys removed.</p> <pre class="ruby" data-language="ruby">params = ActionController::Parameters.new({
  name: "Senjougahara Hitagi",
  oddity: "Heavy stone crab"
})
params.to_hash
# =&gt; ActionController::UnfilteredParameters: unable to convert unpermitted parameters to hash

safe_params = params.permit(:name)
safe_params.to_hash # =&gt; {"name"=&gt;"Senjougahara Hitagi"}
</pre>  </div> </div> <div class="method-detail method-alias"> <div class="method-header"> <div class="method-heading" id="method-i-to_param"> <span class="method-name">to_param</span><span class="method-args">(*args)</span> </div> </div>  <div class="aliases"> Alias for: <a href="parameters.html#method-i-to_query">to_query</a> </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-to_query"> <span class="method-name">to_query</span><span class="method-args">(*args)</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="to_query-source"> <pre class="ruby" data-language="ruby"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 381
def to_query(*args)
  to_h.to_query(*args)
end</pre> </div> <p>Returns a string representation of the receiver suitable for use as a URL query string:</p> <pre class="ruby" data-language="ruby">params = ActionController::Parameters.new({
  name: "David",
  nationality: "Danish"
})
params.to_query
# =&gt; ActionController::UnfilteredParameters: unable to convert unpermitted parameters to hash

safe_params = params.permit(:name, :nationality)
safe_params.to_query
# =&gt; "name=David&amp;nationality=Danish"
</pre> <p>An optional namespace can be passed to enclose key names:</p> <pre class="ruby" data-language="ruby">params = ActionController::Parameters.new({
  name: "David",
  nationality: "Danish"
})
safe_params = params.permit(:name, :nationality)
safe_params.to_query("user")
# =&gt; "user%5Bname%5D=David&amp;user%5Bnationality%5D=Danish"
</pre> <p>The string pairs <code>"key=value"</code> that conform the query string are sorted lexicographically in ascending order.</p>  </div> <div class="aliases"> Also aliased as: <a href="parameters.html#method-i-to_param">to_param</a> </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-to_s"> <span class="method-callseq"> to_s() </span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="to_s-source"> <pre class="c" data-language="c"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 250
delegate :keys, :empty?, :exclude?, :include?,
  :as_json, :to_s, :each_key, to: :@parameters
</pre> </div> <p>Returns the content of the parameters as a string.</p>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-to_unsafe_h"> <span class="method-name">to_unsafe_h</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="to_unsafe_h-source"> <pre class="ruby" data-language="ruby"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 395
def to_unsafe_h
  convert_parameters_to_hashes(@parameters, :to_unsafe_h)
end</pre> </div> <p>Returns an unsafe, unfiltered <a href="../activesupport/hashwithindifferentaccess.html"><code>ActiveSupport::HashWithIndifferentAccess</code></a> representation of the parameters.</p> <pre class="ruby" data-language="ruby">params = ActionController::Parameters.new({
  name: "Senjougahara Hitagi",
  oddity: "Heavy stone crab"
})
params.to_unsafe_h
# =&gt; {"name"=&gt;"Senjougahara Hitagi", "oddity" =&gt; "Heavy stone crab"}
</pre>  </div> <div class="aliases"> Also aliased as: <a href="parameters.html#method-i-to_unsafe_hash">to_unsafe_hash</a> </div> </div> <div class="method-detail method-alias"> <div class="method-header"> <div class="method-heading" id="method-i-to_unsafe_hash"> <span class="method-name">to_unsafe_hash</span><span class="method-args">()</span> </div> </div>  <div class="aliases"> Alias for: <a href="parameters.html#method-i-to_unsafe_h">to_unsafe_h</a> </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-transform_keys"> <span class="method-name">transform_keys</span><span class="method-args">(&amp;block)</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="transform_keys-source"> <pre class="ruby" data-language="ruby"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 906
def transform_keys(&amp;block)
  return to_enum(:transform_keys) unless block_given?
  new_instance_with_inherited_permitted_status(
    @parameters.transform_keys(&amp;block)
  )
end</pre> </div> <p>Returns a new <code>ActionController::Parameters</code> instance with the results of running <code>block</code> once for every key. The values are unchanged.</p>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-transform_keys-21"> <span class="method-name">transform_keys!</span><span class="method-args">(&amp;block)</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="transform_keys-21-source"> <pre class="ruby" data-language="ruby"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 915
def transform_keys!(&amp;block)
  return to_enum(:transform_keys!) unless block_given?
  @parameters.transform_keys!(&amp;block)
  self
end</pre> </div> <p>Performs keys transformation and returns the altered <code>ActionController::Parameters</code> instance.</p>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-transform_values"> <span class="method-name">transform_values</span><span class="method-args">() { |convert_value_to_parameters(v)| ... }</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="transform_values-source"> <pre class="ruby" data-language="ruby"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 889
def transform_values
  return to_enum(:transform_values) unless block_given?
  new_instance_with_inherited_permitted_status(
    @parameters.transform_values { |v| yield convert_value_to_parameters(v) }
  )
end</pre> </div> <p>Returns a new <code>ActionController::Parameters</code> instance with the results of running <code>block</code> once for every value. The keys are unchanged.</p> <pre class="ruby" data-language="ruby">params = ActionController::Parameters.new(a: 1, b: 2, c: 3)
params.transform_values { |x| x * 2 }
# =&gt; #&lt;ActionController::Parameters {"a"=&gt;2, "b"=&gt;4, "c"=&gt;6} permitted: false&gt;
</pre>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-transform_values-21"> <span class="method-name">transform_values!</span><span class="method-args">() { |convert_value_to_parameters(v)| ... }</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="transform_values-21-source"> <pre class="ruby" data-language="ruby"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 898
def transform_values!
  return to_enum(:transform_values!) unless block_given?
  @parameters.transform_values! { |v| yield convert_value_to_parameters(v) }
  self
end</pre> </div> <p>Performs values transformation and returns the altered <code>ActionController::Parameters</code> instance.</p>  </div> </div> <div class="method-detail method-alias"> <div class="method-header"> <div class="method-heading" id="method-i-value-3F"> <span class="method-name">value?</span><span class="method-args">(value)</span> </div> </div>  <div class="aliases"> Alias for: <a href="parameters.html#method-i-has_value-3F">has_value?</a> </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-values"> <span class="method-name">values</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="values-source"> <pre class="ruby" data-language="ruby"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 424
def values
  to_enum(:each_value).to_a
end</pre> </div> <p>Returns a new array of the values of the parameters.</p>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-values_at"> <span class="method-name">values_at</span><span class="method-args">(*keys)</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="values_at-source"> <pre class="ruby" data-language="ruby"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 1005
def values_at(*keys)
  convert_value_to_parameters(@parameters.values_at(*keys))
end</pre> </div> <p>Returns values that were assigned to the given <code>keys</code>. Note that all the <code>Hash</code> objects will be converted to <code>ActionController::Parameters</code>.</p>  </div> </div> <div class="method-detail method-alias"> <div class="method-header"> <div class="method-heading" id="method-i-with_defaults"> <span class="method-name">with_defaults</span><span class="method-args">(other_hash)</span> </div> </div>  <div class="aliases"> Alias for: <a href="parameters.html#method-i-reverse_merge">reverse_merge</a> </div> </div> <div class="method-detail method-alias"> <div class="method-header"> <div class="method-heading" id="method-i-with_defaults-21"> <span class="method-name">with_defaults!</span><span class="method-args">(other_hash)</span> </div> </div>  <div class="aliases"> Alias for: <a href="parameters.html#method-i-reverse_merge-21">reverse_merge!</a> </div> </div> <div class="method-detail method-alias"> <div class="method-header"> <div class="method-heading" id="method-i-without"> <span class="method-name">without</span><span class="method-args">(*keys)</span> </div> </div>  <div class="aliases"> Alias for: <a href="parameters.html#method-i-except">except</a> </div> </div> </section> <section id="protected-instance-5Buntitled-5D-method-details" class="method-section"> <header> <h3>Protected Instance Methods</h3> </header> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-each_nested_attribute"> <span class="method-name">each_nested_attribute</span><span class="method-args">() { |v| ... }</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="each_nested_attribute-source"> <pre class="ruby" data-language="ruby"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 1123
def each_nested_attribute
  hash = self.class.new
  self.each { |k, v| hash[k] = yield v if Parameters.nested_attribute?(k, v) }
  hash
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-nested_attributes-3F"> <span class="method-name">nested_attributes?</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="nested_attributes-3F-source"> <pre class="ruby" data-language="ruby"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 1119
def nested_attributes?
  @parameters.any? { |k, v| Parameters.nested_attribute?(k, v) }
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-header"> <div class="method-heading" id="method-i-permit_filters"> <span class="method-name">permit_filters</span><span class="method-args">(filters, on_unpermitted: nil, explicit_arrays: true)</span> <a class="method-click-advice">Show source</a> </div> </div> <div class="method-description">
<div class="method-source-code" id="permit_filters-source"> <pre class="ruby" data-language="ruby"># File actionpack/lib/action_controller/metal/strong_parameters.rb, line 1130
def permit_filters(filters, on_unpermitted: nil, explicit_arrays: true)
  params = self.class.new

  filters.flatten.each do |filter|
    case filter
    when Symbol, String
      # Declaration [:name, "age"]
      permitted_scalar_filter(params, filter)
    when Hash
      # Declaration [{ person: ... }]
      hash_filter(params, filter, on_unpermitted:, explicit_arrays:)
    end
  end

  unpermitted_parameters!(params, on_unpermitted:)

  params.permit!
end</pre> </div> <p>Filters self and optionally checks for unpermitted keys</p>  </div> </div> </section> </section><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2004&ndash;2021 David Heinemeier Hansson<br>Licensed under the MIT License.<br>
    
  </p>
</div>
