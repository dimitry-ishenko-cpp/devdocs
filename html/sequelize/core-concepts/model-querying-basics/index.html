<h1>Model Querying - Basics</h1>
<p>Sequelize provides various methods to assist querying your database for data.</p> <p><em>Important notice: to perform production-ready queries with Sequelize, make sure you have read the <a href="../../other-topics/transactions/index.html">Transactions guide</a> as well. Transactions are important to ensure data integrity and to provide other benefits.</em></p> <p>This guide will show how to make the standard <a href="https://en.wikipedia.org/wiki/Create,_read,_update_and_delete" target="_blank" rel="noopener noreferrer">CRUD</a> queries.</p> <h2 class="anchor anchorWithStickyNavbar_LWe7" id="simple-insert-queries">Simple INSERT queries<a href="#simple-insert-queries" class="hash-link" aria-label="Direct link to Simple INSERT queries" title="Direct link to Simple INSERT queries">​</a>
</h2> <p>First, a simple example:</p> <div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex">
<pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa" data-language="js">// Create a new user
const jane = await User.create({ firstName: 'Jane', lastName: 'Doe' });
console.log("Jane's auto-generated ID:", jane.id);</pre>

</div></div> <p>The <a href="https://sequelize.org/api/v6/class/src/model.js~model#static-method-create" rel="noopener noreferrer" target="_blank"><code>Model.create()</code></a> method is a shorthand for building an unsaved instance with <a href="https://sequelize.org/api/v6/class/src/model.js~model#static-method-build" rel="noopener noreferrer" target="_blank"><code>Model.build()</code></a> and saving the instance with <a href="https://sequelize.org/api/v6/class/src/model.js~model#instance-method-save" rel="noopener noreferrer" target="_blank"><code>instance.save()</code></a>.</p> <p>It is also possible to define which attributes can be set in the <code>create</code> method. This can be especially useful if you create database entries based on a form which can be filled by a user. Using that would, for example, allow you to restrict the <code>User</code> model to set only a username but not an admin flag (i.e., <code>isAdmin</code>):</p> <div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex">
<pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa" data-language="js">const user = await User.create(
  {
    username: 'alice123',
    isAdmin: true,
  },
  { fields: ['username'] },
);
// let's assume the default of isAdmin is false
console.log(user.username); // 'alice123'
console.log(user.isAdmin); // false</pre>

</div></div> <h2 class="anchor anchorWithStickyNavbar_LWe7" id="simple-select-queries">Simple SELECT queries<a href="#simple-select-queries" class="hash-link" aria-label="Direct link to Simple SELECT queries" title="Direct link to Simple SELECT queries">​</a>
</h2> <p>You can read the whole table from the database with the <a href="https://sequelize.org/api/v6/class/src/model.js~model#static-method-findAll" rel="noopener noreferrer" target="_blank"><code>findAll</code></a> method:</p> <div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex">
<pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa" data-language="js">// Find all users
const users = await User.findAll();
console.log(users.every(user =&gt; user instanceof User)); // true
console.log('All users:', JSON.stringify(users, null, 2));</pre>

</div></div> <div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex">
<pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa" data-language="sql">SELECT * FROM ...</pre>

</div></div> <h2 class="anchor anchorWithStickyNavbar_LWe7" id="specifying-attributes-for-select-queries">Specifying attributes for SELECT queries<a href="#specifying-attributes-for-select-queries" class="hash-link" aria-label="Direct link to Specifying attributes for SELECT queries" title="Direct link to Specifying attributes for SELECT queries">​</a>
</h2> <p>To select only some attributes, you can use the <code>attributes</code> option:</p> <div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex">
<pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa" data-language="js">Model.findAll({
  attributes: ['foo', 'bar'],
});</pre>

</div></div> <div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex">
<pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa" data-language="sql">SELECT foo, bar FROM ...</pre>

</div></div> <p>Attributes can be renamed using a nested array:</p> <div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex">
<pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa" data-language="js">Model.findAll({
  attributes: ['foo', ['bar', 'baz'], 'qux'],
});</pre>

</div></div> <div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex">
<pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa" data-language="sql">SELECT foo, bar AS baz, qux FROM ...</pre>

</div></div> <p>You can use <a href="https://sequelize.org/api/v6/class/src/sequelize.js~sequelize#static-method-fn" rel="noopener noreferrer" target="_blank"><code>sequelize.fn</code></a> to do aggregations:</p> <div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex">
<pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa" data-language="js">Model.findAll({
  attributes: ['foo', [sequelize.fn('COUNT', sequelize.col('hats')), 'n_hats'], 'bar'],
});</pre>

</div></div> <div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex">
<pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa" data-language="sql">SELECT foo, COUNT(hats) AS n_hats, bar FROM ...</pre>

</div></div> <p>When using aggregation function, you must give it an alias to be able to access it from the model. In the example above you can get the number of hats with <code>instance.n_hats</code>.</p> <p>Sometimes it may be tiresome to list all the attributes of the model if you only want to add an aggregation:</p> <div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex">
<pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa" data-language="js">// This is a tiresome way of getting the number of hats (along with every column)
Model.findAll({
  attributes: [
    'id',
    'foo',
    'bar',
    'baz',
    'qux',
    'hats', // We had to list all attributes...
    [sequelize.fn('COUNT', sequelize.col('hats')), 'n_hats'], // To add the aggregation...
  ],
});

// This is shorter, and less error prone because it still works if you add / remove attributes from your model later
Model.findAll({
  attributes: {
    include: [[sequelize.fn('COUNT', sequelize.col('hats')), 'n_hats']],
  },
});</pre>

</div></div> <div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex">
<pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa" data-language="sql">SELECT id, foo, bar, baz, qux, hats, COUNT(hats) AS n_hats FROM ...</pre>

</div></div> <p>Similarly, it's also possible to remove a selected few attributes:</p> <div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex">
<pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa" data-language="js">Model.findAll({
  attributes: { exclude: ['baz'] },
});</pre>

</div></div> <div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex">
<pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa" data-language="sql">-- Assuming all columns are 'id', 'foo', 'bar', 'baz' and 'qux'
SELECT id, foo, bar, qux FROM ...</pre>

</div></div> <h2 class="anchor anchorWithStickyNavbar_LWe7" id="applying-where-clauses">Applying WHERE clauses<a href="#applying-where-clauses" class="hash-link" aria-label="Direct link to Applying WHERE clauses" title="Direct link to Applying WHERE clauses">​</a>
</h2> <p>The <code>where</code> option is used to filter the query. There are lots of operators to use for the <code>where</code> clause, available as Symbols from <a href="https://sequelize.org/api/v6/variable/#static-variable-Op" rel="noopener noreferrer" target="_blank"><code>Op</code></a>.</p> <h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-basics">The basics<a href="#the-basics" class="hash-link" aria-label="Direct link to The basics" title="Direct link to The basics">​</a>
</h3> <div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex">
<pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa" data-language="js">Post.findAll({
  where: {
    authorId: 2,
  },
});
// SELECT * FROM post WHERE authorId = 2;</pre>

</div></div> <p>Observe that no operator (from <code>Op</code>) was explicitly passed, so Sequelize assumed an equality comparison by default. The above code is equivalent to:</p> <div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex">
<pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa" data-language="js">const { Op } = require('sequelize');
Post.findAll({
  where: {
    authorId: {
      [Op.eq]: 2,
    },
  },
});
// SELECT * FROM post WHERE authorId = 2;</pre>

</div></div> <p>Multiple checks can be passed:</p> <div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex">
<pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa" data-language="js">Post.findAll({
  where: {
    authorId: 12,
    status: 'active',
  },
});
// SELECT * FROM post WHERE authorId = 12 AND status = 'active';</pre>

</div></div> <p>Just like Sequelize inferred the <code>Op.eq</code> operator in the first example, here Sequelize inferred that the caller wanted an <code>AND</code> for the two checks. The code above is equivalent to:</p> <div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex">
<pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa" data-language="js">const { Op } = require('sequelize');
Post.findAll({
  where: {
    [Op.and]: [{ authorId: 12 }, { status: 'active' }],
  },
});
// SELECT * FROM post WHERE authorId = 12 AND status = 'active';</pre>

</div></div> <p>An <code>OR</code> can be easily performed in a similar way:</p> <div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex">
<pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa" data-language="js">const { Op } = require('sequelize');
Post.findAll({
  where: {
    [Op.or]: [{ authorId: 12 }, { authorId: 13 }],
  },
});
// SELECT * FROM post WHERE authorId = 12 OR authorId = 13;</pre>

</div></div> <p>Since the above was an <code>OR</code> involving the same field, Sequelize allows you to use a slightly different structure which is more readable and generates the same behavior:</p> <div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex">
<pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa" data-language="js">const { Op } = require('sequelize');
Post.destroy({
  where: {
    authorId: {
      [Op.or]: [12, 13],
    },
  },
});
// DELETE FROM post WHERE authorId = 12 OR authorId = 13;</pre>

</div></div> <h3 class="anchor anchorWithStickyNavbar_LWe7" id="operators">Operators<a href="#operators" class="hash-link" aria-label="Direct link to Operators" title="Direct link to Operators">​</a>
</h3> <p>Sequelize provides several operators.</p> <div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex">
<pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa" data-language="js">const { Op } = require("sequelize");
Post.findAll({
  where: {
    [Op.and]: [{ a: 5 }, { b: 6 }],            // (a = 5) AND (b = 6)
    [Op.or]: [{ a: 5 }, { b: 6 }],             // (a = 5) OR (b = 6)
    someAttribute: {
      // Basics
      [Op.eq]: 3,                              // = 3
      [Op.ne]: 20,                             // != 20
      [Op.is]: null,                           // IS NULL
      [Op.not]: true,                          // IS NOT TRUE
      [Op.or]: [5, 6],                         // (someAttribute = 5) OR (someAttribute = 6)

      // Using dialect specific column identifiers (PG in the following example):
      [Op.col]: 'user.organization_id',        // = "user"."organization_id"

      // Number comparisons
      [Op.gt]: 6,                              // &gt; 6
      [Op.gte]: 6,                             // &gt;= 6
      [Op.lt]: 10,                             // &lt; 10
      [Op.lte]: 10,                            // &lt;= 10
      [Op.between]: [6, 10],                   // BETWEEN 6 AND 10
      [Op.notBetween]: [11, 15],               // NOT BETWEEN 11 AND 15

      // Other operators

      [Op.all]: sequelize.literal('SELECT 1'), // &gt; ALL (SELECT 1)

      [Op.in]: [1, 2],                         // IN [1, 2]
      [Op.notIn]: [1, 2],                      // NOT IN [1, 2]

      [Op.like]: '%hat',                       // LIKE '%hat'
      [Op.notLike]: '%hat',                    // NOT LIKE '%hat'
      [Op.startsWith]: 'hat',                  // LIKE 'hat%'
      [Op.endsWith]: 'hat',                    // LIKE '%hat'
      [Op.substring]: 'hat',                   // LIKE '%hat%'
      [Op.iLike]: '%hat',                      // ILIKE '%hat' (case insensitive) (PG only)
      [Op.notILike]: '%hat',                   // NOT ILIKE '%hat'  (PG only)
      [Op.regexp]: '^[h|a|t]',                 // REGEXP/~ '^[h|a|t]' (MySQL/PG only)
      [Op.notRegexp]: '^[h|a|t]',              // NOT REGEXP/!~ '^[h|a|t]' (MySQL/PG only)
      [Op.iRegexp]: '^[h|a|t]',                // ~* '^[h|a|t]' (PG only)
      [Op.notIRegexp]: '^[h|a|t]',             // !~* '^[h|a|t]' (PG only)

      [Op.any]: [2, 3],                        // ANY (ARRAY[2, 3]::INTEGER[]) (PG only)
      [Op.match]: Sequelize.fn('to_tsquery', 'fat &amp; rat') // match text search for strings 'fat' and 'rat' (PG only)

      // In Postgres, Op.like/Op.iLike/Op.notLike can be combined to Op.any:
      [Op.like]: { [Op.any]: ['cat', 'hat'] }  // LIKE ANY (ARRAY['cat', 'hat'])

      // There are more postgres-only range operators, see below
    }
  }
});</pre>

</div></div> <h4 class="anchor anchorWithStickyNavbar_LWe7" id="shorthand-syntax-for-opin">Shorthand syntax for <code>Op.in</code><a href="#shorthand-syntax-for-opin" class="hash-link" aria-label="Direct link to shorthand-syntax-for-opin" title="Direct link to shorthand-syntax-for-opin">​</a>
</h4> <p>Passing an array directly to the <code>where</code> option will implicitly use the <code>IN</code> operator:</p> <div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex">
<pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa" data-language="js">Post.findAll({
  where: {
    id: [1, 2, 3], // Same as using `id: { [Op.in]: [1,2,3] }`
  },
});
// SELECT ... FROM "posts" AS "post" WHERE "post"."id" IN (1, 2, 3);</pre>

</div></div> <h3 class="anchor anchorWithStickyNavbar_LWe7" id="logical-combinations-with-operators">Logical combinations with operators<a href="#logical-combinations-with-operators" class="hash-link" aria-label="Direct link to Logical combinations with operators" title="Direct link to Logical combinations with operators">​</a>
</h3> <p>The operators <code>Op.and</code>, <code>Op.or</code> and <code>Op.not</code> can be used to create arbitrarily complex nested logical comparisons.</p> <h4 class="anchor anchorWithStickyNavbar_LWe7" id="examples-with-opand-and-opor">Examples with <code>Op.and</code> and <code>Op.or</code><a href="#examples-with-opand-and-opor" class="hash-link" aria-label="Direct link to examples-with-opand-and-opor" title="Direct link to examples-with-opand-and-opor">​</a>
</h4> <div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex">
<pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa" data-language="js">const { Op } = require("sequelize");

Foo.findAll({
  where: {
    rank: {
      [Op.or]: {
        [Op.lt]: 1000,
        [Op.eq]: null
      }
    },
    // rank &lt; 1000 OR rank IS NULL

    {
      createdAt: {
        [Op.lt]: new Date(),
        [Op.gt]: new Date(new Date() - 24 * 60 * 60 * 1000)
      }
    },
    // createdAt &lt; [timestamp] AND createdAt &gt; [timestamp]

    {
      [Op.or]: [
        {
          title: {
            [Op.like]: 'Boat%'
          }
        },
        {
          description: {
            [Op.like]: '%boat%'
          }
        }
      ]
    }
    // title LIKE 'Boat%' OR description LIKE '%boat%'
  }
});</pre>

</div></div> <h4 class="anchor anchorWithStickyNavbar_LWe7" id="examples-with-opnot">Examples with <code>Op.not</code><a href="#examples-with-opnot" class="hash-link" aria-label="Direct link to examples-with-opnot" title="Direct link to examples-with-opnot">​</a>
</h4> <div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex">
<pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa" data-language="js">Project.findAll({
  where: {
    name: 'Some Project',
    [Op.not]: [
      { id: [1, 2, 3] },
      {
        description: {
          [Op.like]: 'Hello%',
        },
      },
    ],
  },
});</pre>

</div></div> <p>The above will generate:</p> <div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex">
<pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa" data-language="sql">SELECT *
FROM `Projects`
WHERE (
  `Projects`.`name` = 'Some Project'
  AND NOT (
    `Projects`.`id` IN (1,2,3)
    AND
    `Projects`.`description` LIKE 'Hello%'
  )
)</pre>

</div></div> <h3 class="anchor anchorWithStickyNavbar_LWe7" id="advanced-queries-with-functions-not-just-columns">Advanced queries with functions (not just columns)<a href="#advanced-queries-with-functions-not-just-columns" class="hash-link" aria-label="Direct link to Advanced queries with functions (not just columns)" title="Direct link to Advanced queries with functions (not just columns)">​</a>
</h3> <p>What if you wanted to obtain something like <code>WHERE char_length("content") = 7</code>?</p> <div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex">
<pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa" data-language="js">Post.findAll({
  where: sequelize.where(sequelize.fn('char_length', sequelize.col('content')), 7),
});
// SELECT ... FROM "posts" AS "post" WHERE char_length("content") = 7</pre>

</div></div> <p>Note the usage of the <a href="https://sequelize.org/api/v6/class/src/sequelize.js~sequelize#static-method-fn" rel="noopener noreferrer" target="_blank"><code>sequelize.fn</code></a> and <a href="https://sequelize.org/api/v6/class/src/sequelize.js~sequelize#static-method-col" rel="noopener noreferrer" target="_blank"><code>sequelize.col</code></a> methods, which should be used to specify an SQL function call and a table column, respectively. These methods should be used instead of passing a plain string (such as <code>char_length(content)</code>) because Sequelize needs to treat this situation differently (for example, using other symbol escaping approaches).</p> <p>What if you need something even more complex?</p> <div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex">
<pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa" data-language="js">Post.findAll({
  where: {
    [Op.or]: [
      sequelize.where(sequelize.fn('char_length', sequelize.col('content')), 7),
      {
        content: {
          [Op.like]: 'Hello%',
        },
      },
      {
        [Op.and]: [
          { status: 'draft' },
          sequelize.where(sequelize.fn('char_length', sequelize.col('content')), {
            [Op.gt]: 10,
          }),
        ],
      },
    ],
  },
});</pre>

</div></div> <p>The above generates the following SQL:</p> <div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex">
<pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa" data-language="sql">SELECT
  ...
FROM "posts" AS "post"
WHERE (
  char_length("content") = 7
  OR
  "post"."content" LIKE 'Hello%'
  OR (
    "post"."status" = 'draft'
    AND
    char_length("content") &gt; 10
  )
)</pre>

</div></div> <h3 class="anchor anchorWithStickyNavbar_LWe7" id="postgres-only-range-operators">Postgres-only Range Operators<a href="#postgres-only-range-operators" class="hash-link" aria-label="Direct link to Postgres-only Range Operators" title="Direct link to Postgres-only Range Operators">​</a>
</h3> <p>Range types can be queried with all supported operators.</p> <p>Keep in mind, the provided range value can <a href="../../other-topics/other-data-types/index.html#ranges-postgresql-only">define the bound inclusion/exclusion</a> as well.</p> <div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex">
<pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa" data-language="js">[Op.contains]: 2,            // @&gt; '2'::integer  (PG range contains element operator)
[Op.contains]: [1, 2],       // @&gt; [1, 2)        (PG range contains range operator)
[Op.contained]: [1, 2],      // &lt;@ [1, 2)        (PG range is contained by operator)
[Op.overlap]: [1, 2],        // &amp;&amp; [1, 2)        (PG range overlap (have points in common) operator)
[Op.adjacent]: [1, 2],       // -|- [1, 2)       (PG range is adjacent to operator)
[Op.strictLeft]: [1, 2],     // &lt;&lt; [1, 2)        (PG range strictly left of operator)
[Op.strictRight]: [1, 2],    // &gt;&gt; [1, 2)        (PG range strictly right of operator)
[Op.noExtendRight]: [1, 2],  // &amp;&lt; [1, 2)        (PG range does not extend to the right of operator)
[Op.noExtendLeft]: [1, 2],   // &amp;&gt; [1, 2)        (PG range does not extend to the left of operator)</pre>

</div></div> <h3 class="anchor anchorWithStickyNavbar_LWe7" id="deprecated-operator-aliases">Deprecated: Operator Aliases<a href="#deprecated-operator-aliases" class="hash-link" aria-label="Direct link to Deprecated: Operator Aliases" title="Direct link to Deprecated: Operator Aliases">​</a>
</h3> <p>In Sequelize v4, it was possible to specify strings to refer to operators, instead of using Symbols. This is now deprecated and heavily discouraged, and will probably be removed in the next major version. If you really need it, you can pass the <code>operatorAliases</code> option in the Sequelize constructor.</p> <p>For example:</p> <div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex">
<pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa" data-language="js">const { Sequelize, Op } = require('sequelize');
const sequelize = new Sequelize('sqlite::memory:', {
  operatorsAliases: {
    $gt: Op.gt,
  },
});

// Now we can use `$gt` instead of `[Op.gt]` in where clauses:
Foo.findAll({
  where: {
    $gt: 6, // Works like using [Op.gt]
  },
});</pre>

</div></div> <h2 class="anchor anchorWithStickyNavbar_LWe7" id="simple-update-queries">Simple UPDATE queries<a href="#simple-update-queries" class="hash-link" aria-label="Direct link to Simple UPDATE queries" title="Direct link to Simple UPDATE queries">​</a>
</h2> <p>Update queries also accept the <code>where</code> option, just like the read queries shown above.</p> <div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex">
<pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa" data-language="js">// Change everyone without a last name to "Doe"
await User.update(
  { lastName: 'Doe' },
  {
    where: {
      lastName: null,
    },
  },
);</pre>

</div></div> <h2 class="anchor anchorWithStickyNavbar_LWe7" id="simple-delete-queries">Simple DELETE queries<a href="#simple-delete-queries" class="hash-link" aria-label="Direct link to Simple DELETE queries" title="Direct link to Simple DELETE queries">​</a>
</h2> <p>Delete queries also accept the <code>where</code> option, just like the read queries shown above.</p> <div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex">
<pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa" data-language="js">// Delete everyone named "Jane"
await User.destroy({
  where: {
    firstName: 'Jane',
  },
});</pre>

</div></div> <p>To destroy everything the <code>TRUNCATE</code> SQL can be used:</p> <div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex">
<pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa" data-language="js">// Truncate the table
await User.destroy({
  truncate: true,
});</pre>

</div></div> <h2 class="anchor anchorWithStickyNavbar_LWe7" id="creating-in-bulk">Creating in bulk<a href="#creating-in-bulk" class="hash-link" aria-label="Direct link to Creating in bulk" title="Direct link to Creating in bulk">​</a>
</h2> <p>Sequelize provides the <code>Model.bulkCreate</code> method to allow creating multiple records at once, with only one query.</p> <p>The usage of <code>Model.bulkCreate</code> is very similar to <code>Model.create</code>, by receiving an array of objects instead of a single object.</p> <div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex">
<pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa" data-language="js">const captains = await Captain.bulkCreate([{ name: 'Jack Sparrow' }, { name: 'Davy Jones' }]);
console.log(captains.length); // 2
console.log(captains[0] instanceof Captain); // true
console.log(captains[0].name); // 'Jack Sparrow'
console.log(captains[0].id); // 1 // (or another auto-generated value)</pre>

</div></div> <p>However, by default, <code>bulkCreate</code> does not run validations on each object that is going to be created (which <code>create</code> does). To make <code>bulkCreate</code> run these validations as well, you must pass the <code>validate: true</code> option. This will decrease performance. Usage example:</p> <div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex">
<pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa" data-language="js">const Foo = sequelize.define('foo', {
  name: {
    type: DataTypes.TEXT,
    validate: {
      len: [4, 6],
    },
  },
});

// This will not throw an error, both instances will be created
await Foo.bulkCreate([{ name: 'abc123' }, { name: 'name too long' }]);

// This will throw an error, nothing will be created
await Foo.bulkCreate([{ name: 'abc123' }, { name: 'name too long' }], {
  validate: true,
});</pre>

</div></div> <p>If you are accepting values directly from the user, it might be beneficial to limit the columns that you want to actually insert. To support this, <code>bulkCreate()</code> accepts a <code>fields</code> option, an array defining which fields must be considered (the rest will be ignored).</p> <div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex">
<pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa" data-language="js">await User.bulkCreate([{ username: 'foo' }, { username: 'bar', admin: true }], {
  fields: ['username'],
});
// Neither foo nor bar are admins.</pre>

</div></div> <h2 class="anchor anchorWithStickyNavbar_LWe7" id="ordering-and-grouping">Ordering and Grouping<a href="#ordering-and-grouping" class="hash-link" aria-label="Direct link to Ordering and Grouping" title="Direct link to Ordering and Grouping">​</a>
</h2> <p>Sequelize provides the <code>order</code> and <code>group</code> options to work with <code>ORDER BY</code> and <code>GROUP BY</code>.</p> <h3 class="anchor anchorWithStickyNavbar_LWe7" id="ordering">Ordering<a href="#ordering" class="hash-link" aria-label="Direct link to Ordering" title="Direct link to Ordering">​</a>
</h3> <p>The <code>order</code> option takes an array of items to order the query by or a sequelize method. These <em>items</em> are themselves arrays in the form <code>[column, direction]</code>. The column will be escaped correctly and the direction will be checked in a whitelist of valid directions (such as <code>ASC</code>, <code>DESC</code>, <code>NULLS FIRST</code>, etc).</p> <div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex">
<pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa" data-language="js">Subtask.findAll({
  order: [
    // Will escape title and validate DESC against a list of valid direction parameters
    ['title', 'DESC'],

    // Will order by max(age)
    sequelize.fn('max', sequelize.col('age')),

    // Will order by max(age) DESC
    [sequelize.fn('max', sequelize.col('age')), 'DESC'],

    // Will order by  otherfunction(`col1`, 12, 'lalala') DESC
    [sequelize.fn('otherfunction', sequelize.col('col1'), 12, 'lalala'), 'DESC'],

    // Will order an associated model's createdAt using the model name as the association's name.
    [Task, 'createdAt', 'DESC'],

    // Will order through an associated model's createdAt using the model names as the associations' names.
    [Task, Project, 'createdAt', 'DESC'],

    // Will order by an associated model's createdAt using the name of the association.
    ['Task', 'createdAt', 'DESC'],

    // Will order by a nested associated model's createdAt using the names of the associations.
    ['Task', 'Project', 'createdAt', 'DESC'],

    // Will order by an associated model's createdAt using an association object. (preferred method)
    [Subtask.associations.Task, 'createdAt', 'DESC'],

    // Will order by a nested associated model's createdAt using association objects. (preferred method)
    [Subtask.associations.Task, Task.associations.Project, 'createdAt', 'DESC'],

    // Will order by an associated model's createdAt using a simple association object.
    [{ model: Task, as: 'Task' }, 'createdAt', 'DESC'],

    // Will order by a nested associated model's createdAt simple association objects.
    [{ model: Task, as: 'Task' }, { model: Project, as: 'Project' }, 'createdAt', 'DESC'],
  ],

  // Will order by max age descending
  order: sequelize.literal('max(age) DESC'),

  // Will order by max age ascending assuming ascending is the default order when direction is omitted
  order: sequelize.fn('max', sequelize.col('age')),

  // Will order by age ascending assuming ascending is the default order when direction is omitted
  order: sequelize.col('age'),

  // Will order randomly based on the dialect (instead of fn('RAND') or fn('RANDOM'))
  order: sequelize.random(),
});

Foo.findOne({
  order: [
    // will return `name`
    ['name'],
    // will return `username` DESC
    ['username', 'DESC'],
    // will return max(`age`)
    sequelize.fn('max', sequelize.col('age')),
    // will return max(`age`) DESC
    [sequelize.fn('max', sequelize.col('age')), 'DESC'],
    // will return otherfunction(`col1`, 12, 'lalala') DESC
    [sequelize.fn('otherfunction', sequelize.col('col1'), 12, 'lalala'), 'DESC'],
    // will return otherfunction(awesomefunction(`col`)) DESC, This nesting is potentially infinite!
    [sequelize.fn('otherfunction', sequelize.fn('awesomefunction', sequelize.col('col'))), 'DESC'],
  ],
});</pre>

</div></div> <p>To recap, the elements of the order array can be the following:</p> <ul> <li>A string (which will be automatically quoted)</li> <li>An array, whose first element will be quoted, second will be appended verbatim</li> <li>An object with a <code>raw</code> field: <ul> <li>The content of <code>raw</code> will be added verbatim without quoting</li> <li>Everything else is ignored, and if raw is not set, the query will fail</li> </ul> </li> <li>A call to <code>Sequelize.fn</code> (which will generate a function call in SQL)</li> <li>A call to <code>Sequelize.col</code> (which will quote the column name)</li> </ul> <h3 class="anchor anchorWithStickyNavbar_LWe7" id="grouping">Grouping<a href="#grouping" class="hash-link" aria-label="Direct link to Grouping" title="Direct link to Grouping">​</a>
</h3> <p>The syntax for grouping and ordering are equal, except that grouping does not accept a direction as last argument of the array (there is no <code>ASC</code>, <code>DESC</code>, <code>NULLS FIRST</code>, etc).</p> <p>You can also pass a string directly to <code>group</code>, which will be included directly (verbatim) into the generated SQL. Use with caution and don't use with user generated content.</p> <div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex">
<pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa" data-language="js">Project.findAll({ group: 'name' });
// yields 'GROUP BY name'</pre>

</div></div> <h2 class="anchor anchorWithStickyNavbar_LWe7" id="limits-and-pagination">Limits and Pagination<a href="#limits-and-pagination" class="hash-link" aria-label="Direct link to Limits and Pagination" title="Direct link to Limits and Pagination">​</a>
</h2> <p>The <code>limit</code> and <code>offset</code> options allow you to work with limiting / pagination:</p> <div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex">
<pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa" data-language="js">// Fetch 10 instances/rows
Project.findAll({ limit: 10 });

// Skip 8 instances/rows
Project.findAll({ offset: 8 });

// Skip 5 instances and fetch the 5 after that
Project.findAll({ offset: 5, limit: 5 });</pre>

</div></div> <p>Usually these are used alongside the <code>order</code> option.</p> <h2 class="anchor anchorWithStickyNavbar_LWe7" id="utility-methods">Utility methods<a href="#utility-methods" class="hash-link" aria-label="Direct link to Utility methods" title="Direct link to Utility methods">​</a>
</h2> <p>Sequelize also provides a few utility methods.</p> <h3 class="anchor anchorWithStickyNavbar_LWe7" id="count">
<code>count</code><a href="#count" class="hash-link" aria-label="Direct link to count" title="Direct link to count">​</a>
</h3> <p>The <code>count</code> method simply counts the occurrences of elements in the database.</p> <div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex">
<pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa" data-language="js">console.log(`There are ${await Project.count()} projects`);

const amount = await Project.count({
  where: {
    id: {
      [Op.gt]: 25,
    },
  },
});
console.log(`There are ${amount} projects with an id greater than 25`);</pre>

</div></div> <h3 class="anchor anchorWithStickyNavbar_LWe7" id="max-min-and-sum">
<code>max</code>, <code>min</code> and <code>sum</code><a href="#max-min-and-sum" class="hash-link" aria-label="Direct link to max-min-and-sum" title="Direct link to max-min-and-sum">​</a>
</h3> <p>Sequelize also provides the <code>max</code>, <code>min</code> and <code>sum</code> convenience methods.</p> <p>Let's assume we have three users, whose ages are 10, 5, and 40.</p> <div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex">
<pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa" data-language="js">await User.max('age'); // 40
await User.max('age', { where: { age: { [Op.lt]: 20 } } }); // 10
await User.min('age'); // 5
await User.min('age', { where: { age: { [Op.gt]: 5 } } }); // 10
await User.sum('age'); // 55
await User.sum('age', { where: { age: { [Op.gt]: 5 } } }); // 50</pre>

</div></div> <h3 class="anchor anchorWithStickyNavbar_LWe7" id="increment-decrement">
<code>increment</code>, <code>decrement</code><a href="#increment-decrement" class="hash-link" aria-label="Direct link to increment-decrement" title="Direct link to increment-decrement">​</a>
</h3> <p>Sequelize also provides the <code>increment</code> convenience method.</p> <p>Let's assume we have a user, whose age is 10.</p> <div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex">
<pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa" data-language="js">await User.increment({ age: 5 }, { where: { id: 1 } }); // Will increase age to 15
await User.increment({ age: -5 }, { where: { id: 1 } }); // Will decrease age to 5</pre>

</div></div><div class="_attribution">
  <p class="_attribution-p">
    Copyright &copy; 2014&ndash;present Sequelize contributors<br>Licensed under the MIT License.<br>
    <a href="https://sequelize.org/docs/v6/core-concepts/model-querying-basics/" class="_attribution-link">https://sequelize.org/docs/v6/core-concepts/model-querying-basics/</a>
  </p>
</div>
