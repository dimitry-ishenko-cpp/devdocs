<h1 id="doc-your-first-2d-game-coding-the-player">Coding the player</h1> <p>In this lesson, we'll add player movement, animation, and set it up to detect collisions.</p> <p>To do so, we need to add some functionality that we can't get from a built-in node, so we'll add a script. Click the <code>Player</code> node and click the "Attach Script" button:</p> <img alt="../../_images/add_script_button.png" src="https://docs.godotengine.org/en/3.5/_images/add_script_button.png"> <p>In the script settings window, you can leave the default settings alone. Just click "Create":</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>If you're creating a C# script or other languages, select the language from the <code>language</code> drop down menu before hitting create.</p> </div> <img alt="../../_images/attach_node_window.png" src="https://docs.godotengine.org/en/3.5/_images/attach_node_window.png"> <div class="admonition note"> <p class="admonition-title">Note</p> <p>If this is your first time encountering GDScript, please read <a href="../step_by_step/scripting_languages.html#doc-scripting"><span class="std std-ref">Scripting languages</span></a> before continuing.</p> </div> <p>Start by declaring the member variables this object will need:</p> <div class="sphinx-tabs docutils container"> <div aria-label="Tabbed content" class="closeable" role="tablist">
<button aria-controls="panel-0-R0RTY3JpcHQ=" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-0-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tab" tabindex="0">GDScript</button><button aria-controls="panel-0-QyM=" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-0-QyM=" name="QyM=" role="tab" tabindex="-1">C#</button><button aria-controls="panel-0-Qysr" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-0-Qysr" name="Qysr" role="tab" tabindex="-1">C++</button>
</div>
<div aria-labelledby="tab-0-R0RTY3JpcHQ=" class="sphinx-tabs-panel code-tab group-tab" id="panel-0-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tabpanel" tabindex="0">
<pre data-language="gdscript">extends Area2D

export var speed = 400 # How fast the player will move (pixels/sec).
var screen_size # Size of the game window.
</pre> </div>
<div aria-labelledby="tab-0-QyM=" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-0-QyM=" name="QyM=" role="tabpanel" tabindex="0">
<pre data-language="csharp">using Godot;
using System;

public class Player : Area2D
{
    [Export]
    public int Speed = 400; // How fast the player will move (pixels/sec).

    public Vector2 ScreenSize; // Size of the game window.
}
</pre> </div>
<div aria-labelledby="tab-0-Qysr" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-0-Qysr" name="Qysr" role="tabpanel" tabindex="0">
<pre data-language="cpp">// A `player.gdns` file has already been created for you. Attach it to the Player node.

// Create two files `player.cpp` and `player.hpp` next to `entry.cpp` in `src`.
// This code goes in `player.hpp`. We also define the methods we'll be using here.
#ifndef PLAYER_H
#define PLAYER_H

#include &lt;AnimatedSprite.hpp&gt;
#include &lt;Area2D.hpp&gt;
#include &lt;CollisionShape2D.hpp&gt;
#include &lt;Godot.hpp&gt;
#include &lt;Input.hpp&gt;

class Player : public godot::Area2D {
    GODOT_CLASS(Player, godot::Area2D)

    godot::AnimatedSprite *_animated_sprite;
    godot::CollisionShape2D *_collision_shape;
    godot::Input *_input;
    godot::Vector2 _screen_size; // Size of the game window.

public:
    real_t speed = 400; // How fast the player will move (pixels/sec).

    void _init() {}
    void _ready();
    void _process(const double p_delta);
    void start(const godot::Vector2 p_position);
    void _on_Player_body_entered(godot::Node2D *_body);

    static void _register_methods();
};

#endif // PLAYER_H
</pre> </div>
</div> <p>Using the <code>export</code> keyword on the first variable <code>speed</code> allows us to set its value in the Inspector. This can be handy for values that you want to be able to adjust just like a node's built-in properties. Click on the <code>Player</code> node and you'll see the property now appears in the "Script Variables" section of the Inspector. Remember, if you change the value here, it will override the value written in the script.</p> <div class="admonition warning"> <p class="admonition-title">Warning</p> <p>If you're using C#, you need to (re)build the project assemblies whenever you want to see new export variables or signals. This build can be manually triggered by clicking the word "Mono" at the bottom of the editor window to reveal the Mono Panel, then clicking the "Build Project" button.</p> </div> <img alt="../../_images/export_variable.png" src="https://docs.godotengine.org/en/3.5/_images/export_variable.png"> <p>The <code>_ready()</code> function is called when a node enters the scene tree, which is a good time to find the size of the game window:</p> <div class="sphinx-tabs docutils container"> <div aria-label="Tabbed content" class="closeable" role="tablist">
<button aria-controls="panel-1-R0RTY3JpcHQ=" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-1-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tab" tabindex="0">GDScript</button><button aria-controls="panel-1-QyM=" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-1-QyM=" name="QyM=" role="tab" tabindex="-1">C#</button><button aria-controls="panel-1-Qysr" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-1-Qysr" name="Qysr" role="tab" tabindex="-1">C++</button>
</div>
<div aria-labelledby="tab-1-R0RTY3JpcHQ=" class="sphinx-tabs-panel code-tab group-tab" id="panel-1-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tabpanel" tabindex="0">
<pre data-language="gdscript">func _ready():
    screen_size = get_viewport_rect().size
</pre> </div>
<div aria-labelledby="tab-1-QyM=" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-1-QyM=" name="QyM=" role="tabpanel" tabindex="0">
<pre data-language="csharp">public override void _Ready()
{
    ScreenSize = GetViewportRect().Size;
}
</pre> </div>
<div aria-labelledby="tab-1-Qysr" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-1-Qysr" name="Qysr" role="tabpanel" tabindex="0">
<pre data-language="cpp">// This code goes in `player.cpp`.
#include "player.hpp"

void Player::_ready() {
    _animated_sprite = get_node&lt;godot::AnimatedSprite&gt;("AnimatedSprite");
    _collision_shape = get_node&lt;godot::CollisionShape2D&gt;("CollisionShape2D");
    _input = godot::Input::get_singleton();
    _screen_size = get_viewport_rect().size;
}
</pre> </div>
</div> <p>Now we can use the <code>_process()</code> function to define what the player will do. <code>_process()</code> is called every frame, so we'll use it to update elements of our game, which we expect will change often. For the player, we need to do the following:</p> <ul class="simple"> <li>Check for input.</li> <li>Move in the given direction.</li> <li>Play the appropriate animation.</li> </ul> <p>First, we need to check for input - is the player pressing a key? For this game, we have 4 direction inputs to check. Input actions are defined in the Project Settings under "Input Map". Here, you can define custom events and assign different keys, mouse events, or other inputs to them. For this game, we will map the arrow keys to the four directions.</p> <p>Click on <em>Project -&gt; Project Settings</em> to open the project settings window and click on the <em>Input Map</em> tab at the top. Type "move_right" in the top bar and click the "Add" button to add the <code>move_right</code> action.</p> <img alt="../../_images/input-mapping-add-action.png" src="https://docs.godotengine.org/en/3.5/_images/input-mapping-add-action.png"> <p>We need to assign a key to this action. Click the "+" icon on the right, then click the "Key" option in the drop-down menu. A dialog asks you to type in the desired key. Press the right arrow on your keyboard and click "Ok".</p> <img alt="../../_images/input-mapping-add-key.png" src="https://docs.godotengine.org/en/3.5/_images/input-mapping-add-key.png"> <p>Repeat these steps to add three more mappings:</p> <ol class="arabic simple"> <li>
<code>move_left</code> mapped to the left arrow key.</li> <li>
<code>move_up</code> mapped to the up arrow key.</li> <li>And <code>move_down</code> mapped to the down arrow key.</li> </ol> <p>Your input map tab should look like this:</p> <img alt="../../_images/input-mapping-completed.png" src="https://docs.godotengine.org/en/3.5/_images/input-mapping-completed.png"> <p>Click the "Close" button to close the project settings.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>We only mapped one key to each input action, but you can map multiple keys, joystick buttons, or mouse buttons to the same input action.</p> </div> <p>You can detect whether a key is pressed using <code>Input.is_action_pressed()</code>, which returns <code>true</code> if it's pressed or <code>false</code> if it isn't.</p> <div class="sphinx-tabs docutils container"> <div aria-label="Tabbed content" class="closeable" role="tablist">
<button aria-controls="panel-2-R0RTY3JpcHQ=" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-2-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tab" tabindex="0">GDScript</button><button aria-controls="panel-2-QyM=" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-2-QyM=" name="QyM=" role="tab" tabindex="-1">C#</button><button aria-controls="panel-2-Qysr" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-2-Qysr" name="Qysr" role="tab" tabindex="-1">C++</button>
</div>
<div aria-labelledby="tab-2-R0RTY3JpcHQ=" class="sphinx-tabs-panel code-tab group-tab" id="panel-2-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tabpanel" tabindex="0">
<pre data-language="gdscript">func _process(delta):
    var velocity = Vector2.ZERO # The player's movement vector.
    if Input.is_action_pressed("move_right"):
        velocity.x += 1
    if Input.is_action_pressed("move_left"):
        velocity.x -= 1
    if Input.is_action_pressed("move_down"):
        velocity.y += 1
    if Input.is_action_pressed("move_up"):
        velocity.y -= 1

    if velocity.length() &gt; 0:
        velocity = velocity.normalized() * speed
        $AnimatedSprite.play()
    else:
        $AnimatedSprite.stop()
</pre> </div>
<div aria-labelledby="tab-2-QyM=" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-2-QyM=" name="QyM=" role="tabpanel" tabindex="0">
<pre data-language="csharp">public override void _Process(float delta)
{
    var velocity = Vector2.Zero; // The player's movement vector.

    if (Input.IsActionPressed("move_right"))
    {
        velocity.x += 1;
    }

    if (Input.IsActionPressed("move_left"))
    {
        velocity.x -= 1;
    }

    if (Input.IsActionPressed("move_down"))
    {
        velocity.y += 1;
    }

    if (Input.IsActionPressed("move_up"))
    {
        velocity.y -= 1;
    }

    var animatedSprite = GetNode&lt;AnimatedSprite&gt;("AnimatedSprite");

    if (velocity.Length() &gt; 0)
    {
        velocity = velocity.Normalized() * Speed;
        animatedSprite.Play();
    }
    else
    {
        animatedSprite.Stop();
    }
}
</pre> </div>
<div aria-labelledby="tab-2-Qysr" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-2-Qysr" name="Qysr" role="tabpanel" tabindex="0">
<pre data-language="cpp">// This code goes in `player.cpp`.
void Player::_process(const double p_delta) {
    godot::Vector2 velocity(0, 0);

    velocity.x = _input-&gt;get_action_strength("move_right") - _input-&gt;get_action_strength("move_left");
    velocity.y = _input-&gt;get_action_strength("move_down") - _input-&gt;get_action_strength("move_up");

    if (velocity.length() &gt; 0) {
        velocity = velocity.normalized() * speed;
        _animated_sprite-&gt;play();
    } else {
        _animated_sprite-&gt;stop();
    }
}
</pre> </div>
</div> <p>We start by setting the <code>velocity</code> to <code>(0, 0)</code> - by default, the player should not be moving. Then we check each input and add/subtract from the <code>velocity</code> to obtain a total direction. For example, if you hold <code>right</code> and <code>down</code> at the same time, the resulting <code>velocity</code> vector will be <code>(1, 1)</code>. In this case, since we're adding a horizontal and a vertical movement, the player would move <em>faster</em> diagonally than if it just moved horizontally.</p> <p>We can prevent that if we <em>normalize</em> the velocity, which means we set its <em>length</em> to <code>1</code>, then multiply by the desired speed. This means no more fast diagonal movement.</p> <div class="admonition tip"> <p class="admonition-title">Tip</p> <p>If you've never used vector math before, or need a refresher, you can see an explanation of vector usage in Godot at <a href="https://docs.godotengine.org/en/3.5/tutorials/math/vector_math.html#doc-vector-math"><span class="std std-ref">Vector math</span></a>. It's good to know but won't be necessary for the rest of this tutorial.</p> </div> <p>We also check whether the player is moving so we can call <code>play()</code> or <code>stop()</code> on the AnimatedSprite.</p> <div class="admonition tip"> <p class="admonition-title">Tip</p> <p><code>$</code> is shorthand for <code>get_node()</code>. So in the code above, <code>$AnimatedSprite.play()</code> is the same as <code>get_node("AnimatedSprite").play()</code>.</p> <p>In GDScript, <code>$</code> returns the node at the relative path from the current node, or returns <code>null</code> if the node is not found. Since AnimatedSprite is a child of the current node, we can use <code>$AnimatedSprite</code>.</p> </div> <p>Now that we have a movement direction, we can update the player's position. We can also use <code>clamp()</code> to prevent it from leaving the screen. <em>Clamping</em> a value means restricting it to a given range. Add the following to the bottom of the <code>_process</code> function (make sure it's not indented under the <code>else</code>):</p> <div class="sphinx-tabs docutils container"> <div aria-label="Tabbed content" class="closeable" role="tablist">
<button aria-controls="panel-3-R0RTY3JpcHQ=" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-3-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tab" tabindex="0">GDScript</button><button aria-controls="panel-3-QyM=" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-3-QyM=" name="QyM=" role="tab" tabindex="-1">C#</button><button aria-controls="panel-3-Qysr" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-3-Qysr" name="Qysr" role="tab" tabindex="-1">C++</button>
</div>
<div aria-labelledby="tab-3-R0RTY3JpcHQ=" class="sphinx-tabs-panel code-tab group-tab" id="panel-3-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tabpanel" tabindex="0">
<pre data-language="gdscript">position += velocity * delta
position.x = clamp(position.x, 0, screen_size.x)
position.y = clamp(position.y, 0, screen_size.y)
</pre> </div>
<div aria-labelledby="tab-3-QyM=" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-3-QyM=" name="QyM=" role="tabpanel" tabindex="0">
<pre data-language="csharp">Position += velocity * delta;
Position = new Vector2(
    x: Mathf.Clamp(Position.x, 0, ScreenSize.x),
    y: Mathf.Clamp(Position.y, 0, ScreenSize.y)
);
</pre> </div>
<div aria-labelledby="tab-3-Qysr" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-3-Qysr" name="Qysr" role="tabpanel" tabindex="0">
<pre data-language="cpp">godot::Vector2 position = get_position();
position += velocity * (real_t)p_delta;
position.x = godot::Math::clamp(position.x, (real_t)0.0, _screen_size.x);
position.y = godot::Math::clamp(position.y, (real_t)0.0, _screen_size.y);
set_position(position);
</pre> </div>
</div> <div class="admonition tip"> <p class="admonition-title">Tip</p> <p>The <code>delta</code> parameter in the <code>_process()</code> function refers to the <em>frame length</em> - the amount of time that the previous frame took to complete. Using this value ensures that your movement will remain consistent even if the frame rate changes.</p> </div> <p>Click "Play Scene" (<kbd class="kbd docutils literal notranslate">F6</kbd>, <kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">Cmd</kbd> + <kbd class="kbd docutils literal notranslate">R</kbd></kbd> on macOS) and confirm you can move the player around the screen in all directions.</p> <div class="admonition warning"> <p class="admonition-title">Warning</p> <p>If you get an error in the "Debugger" panel that says</p> <p><code>Attempt to call function 'play' in base 'null instance' on a null
instance</code></p> <p>this likely means you spelled the name of the AnimatedSprite node wrong. Node names are case-sensitive and <code>$NodeName</code> must match the name you see in the scene tree.</p> </div> <section id="choosing-animations"> <h2>Choosing animations</h2> <p>Now that the player can move, we need to change which animation the AnimatedSprite is playing based on its direction. We have the "walk" animation, which shows the player walking to the right. This animation should be flipped horizontally using the <code>flip_h</code> property for left movement. We also have the "up" animation, which should be flipped vertically with <code>flip_v</code> for downward movement. Let's place this code at the end of the <code>_process()</code> function:</p> <div class="sphinx-tabs docutils container"> <div aria-label="Tabbed content" class="closeable" role="tablist">
<button aria-controls="panel-4-R0RTY3JpcHQ=" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-4-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tab" tabindex="0">GDScript</button><button aria-controls="panel-4-QyM=" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-4-QyM=" name="QyM=" role="tab" tabindex="-1">C#</button><button aria-controls="panel-4-Qysr" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-4-Qysr" name="Qysr" role="tab" tabindex="-1">C++</button>
</div>
<div aria-labelledby="tab-4-R0RTY3JpcHQ=" class="sphinx-tabs-panel code-tab group-tab" id="panel-4-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tabpanel" tabindex="0">
<pre data-language="gdscript">if velocity.x != 0:
    $AnimatedSprite.animation = "walk"
    $AnimatedSprite.flip_v = false
    # See the note below about boolean assignment.
    $AnimatedSprite.flip_h = velocity.x &lt; 0
elif velocity.y != 0:
    $AnimatedSprite.animation = "up"
    $AnimatedSprite.flip_v = velocity.y &gt; 0
</pre> </div>
<div aria-labelledby="tab-4-QyM=" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-4-QyM=" name="QyM=" role="tabpanel" tabindex="0">
<pre data-language="csharp">if (velocity.x != 0)
{
    animatedSprite.Animation = "walk";
    animatedSprite.FlipV = false;
    // See the note below about boolean assignment.
    animatedSprite.FlipH = velocity.x &lt; 0;
}
else if (velocity.y != 0)
{
    animatedSprite.Animation = "up";
    animatedSprite.FlipV = velocity.y &gt; 0;
}
</pre> </div>
<div aria-labelledby="tab-4-Qysr" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-4-Qysr" name="Qysr" role="tabpanel" tabindex="0">
<pre data-language="cpp">if (velocity.x != 0) {
    _animated_sprite-&gt;set_animation("walk");
    _animated_sprite-&gt;set_flip_v(false);
    // See the note below about boolean assignment.
    _animated_sprite-&gt;set_flip_h(velocity.x &lt; 0);
} else if (velocity.y != 0) {
    _animated_sprite-&gt;set_animation("up");
    _animated_sprite-&gt;set_flip_v(velocity.y &gt; 0);
}
</pre> </div>
</div> <div class="admonition note"> <p class="admonition-title">Note</p> <p>The boolean assignments in the code above are a common shorthand for programmers. Since we're doing a comparison test (boolean) and also <em>assigning</em> a boolean value, we can do both at the same time. Consider this code versus the one-line boolean assignment above:</p> <div class="sphinx-tabs docutils container"> <div aria-label="Tabbed content" class="closeable" role="tablist">
<button aria-controls="panel-5-R0RTY3JpcHQ=" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-5-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tab" tabindex="0">GDScript</button><button aria-controls="panel-5-QyM=" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-5-QyM=" name="QyM=" role="tab" tabindex="-1">C#</button>
</div>
<div aria-labelledby="tab-5-R0RTY3JpcHQ=" class="sphinx-tabs-panel code-tab group-tab" id="panel-5-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tabpanel" tabindex="0">
<pre data-language="gdscript">if velocity.x &lt; 0:
    $AnimatedSprite.flip_h = true
else:
    $AnimatedSprite.flip_h = false
</pre> </div>
<div aria-labelledby="tab-5-QyM=" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-5-QyM=" name="QyM=" role="tabpanel" tabindex="0">
<pre data-language="csharp">if (velocity.x &lt; 0)
{
    animatedSprite.FlipH = true;
}
else
{
    animatedSprite.FlipH = false;
}
</pre> </div>
</div> </div> <p>Play the scene again and check that the animations are correct in each of the directions.</p> <div class="admonition tip"> <p class="admonition-title">Tip</p> <p>A common mistake here is to type the names of the animations wrong. The animation names in the SpriteFrames panel must match what you type in the code. If you named the animation <code>"Walk"</code>, you must also use a capital "W" in the code.</p> </div> <p>When you're sure the movement is working correctly, add this line to <code>_ready()</code>, so the player will be hidden when the game starts:</p> <div class="sphinx-tabs docutils container"> <div aria-label="Tabbed content" class="closeable" role="tablist">
<button aria-controls="panel-6-R0RTY3JpcHQ=" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-6-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tab" tabindex="0">GDScript</button><button aria-controls="panel-6-QyM=" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-6-QyM=" name="QyM=" role="tab" tabindex="-1">C#</button><button aria-controls="panel-6-Qysr" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-6-Qysr" name="Qysr" role="tab" tabindex="-1">C++</button>
</div>
<div aria-labelledby="tab-6-R0RTY3JpcHQ=" class="sphinx-tabs-panel code-tab group-tab" id="panel-6-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tabpanel" tabindex="0">
<pre data-language="gdscript">hide()
</pre> </div>
<div aria-labelledby="tab-6-QyM=" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-6-QyM=" name="QyM=" role="tabpanel" tabindex="0">
<pre data-language="csharp">Hide();
</pre> </div>
<div aria-labelledby="tab-6-Qysr" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-6-Qysr" name="Qysr" role="tabpanel" tabindex="0">
<pre data-language="cpp">hide();
</pre> </div>
</div> </section> <section id="preparing-for-collisions"> <h2>Preparing for collisions</h2> <p>We want <code>Player</code> to detect when it's hit by an enemy, but we haven't made any enemies yet! That's OK, because we're going to use Godot's <em>signal</em> functionality to make it work.</p> <p>Add the following at the top of the script, after <code>extends Area2D</code>:</p> <div class="sphinx-tabs docutils container"> <div aria-label="Tabbed content" class="closeable" role="tablist">
<button aria-controls="panel-7-R0RTY3JpcHQ=" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-7-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tab" tabindex="0">GDScript</button><button aria-controls="panel-7-QyM=" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-7-QyM=" name="QyM=" role="tab" tabindex="-1">C#</button><button aria-controls="panel-7-Qysr" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-7-Qysr" name="Qysr" role="tab" tabindex="-1">C++</button>
</div>
<div aria-labelledby="tab-7-R0RTY3JpcHQ=" class="sphinx-tabs-panel code-tab group-tab" id="panel-7-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tabpanel" tabindex="0">
<pre data-language="gdscript">signal hit
</pre> </div>
<div aria-labelledby="tab-7-QyM=" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-7-QyM=" name="QyM=" role="tabpanel" tabindex="0">
<pre data-language="csharp">// Don't forget to rebuild the project so the editor knows about the new signal.

[Signal]
public delegate void Hit();
</pre> </div>
<div aria-labelledby="tab-7-Qysr" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-7-Qysr" name="Qysr" role="tabpanel" tabindex="0">
<pre data-language="cpp">// This code goes in `player.cpp`.
// We need to register the signal here, and while we're here, we can also
// register the other methods and register the speed property.
void Player::_register_methods() {
    godot::register_method("_ready", &amp;Player::_ready);
    godot::register_method("_process", &amp;Player::_process);
    godot::register_method("start", &amp;Player::start);
    godot::register_method("_on_Player_body_entered", &amp;Player::_on_Player_body_entered);
    godot::register_property("speed", &amp;Player::speed, (real_t)400.0);
    // This below line is the signal.
    godot::register_signal&lt;Player&gt;("hit", godot::Dictionary());
}
</pre> </div>
</div> <p>This defines a custom signal called "hit" that we will have our player emit (send out) when it collides with an enemy. We will use <code>Area2D</code> to detect the collision. Select the <code>Player</code> node and click the "Node" tab next to the Inspector tab to see the list of signals the player can emit:</p> <img alt="../../_images/player_signals.png" src="https://docs.godotengine.org/en/3.5/_images/player_signals.png"> <p>Notice our custom "hit" signal is there as well! Since our enemies are going to be <code>RigidBody2D</code> nodes, we want the <code>body_entered(body: Node)</code> signal. This signal will be emitted when a body contacts the player. Click "Connect.." and the "Connect a Signal" window appears. We don't need to change any of these settings so click "Connect" again. Godot will automatically create a function in your player's script.</p> <img alt="../../_images/player_signal_connection.png" src="https://docs.godotengine.org/en/3.5/_images/player_signal_connection.png"> <p>Note the green icon indicating that a signal is connected to this function. Add this code to the function:</p> <div class="sphinx-tabs docutils container"> <div aria-label="Tabbed content" class="closeable" role="tablist">
<button aria-controls="panel-8-R0RTY3JpcHQ=" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-8-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tab" tabindex="0">GDScript</button><button aria-controls="panel-8-QyM=" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-8-QyM=" name="QyM=" role="tab" tabindex="-1">C#</button><button aria-controls="panel-8-Qysr" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-8-Qysr" name="Qysr" role="tab" tabindex="-1">C++</button>
</div>
<div aria-labelledby="tab-8-R0RTY3JpcHQ=" class="sphinx-tabs-panel code-tab group-tab" id="panel-8-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tabpanel" tabindex="0">
<pre data-language="gdscript">func _on_Player_body_entered(body):
    hide() # Player disappears after being hit.
    emit_signal("hit")
    # Must be deferred as we can't change physics properties on a physics callback.
    $CollisionShape2D.set_deferred("disabled", true)
</pre> </div>
<div aria-labelledby="tab-8-QyM=" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-8-QyM=" name="QyM=" role="tabpanel" tabindex="0">
<pre data-language="csharp">public void OnPlayerBodyEntered(PhysicsBody2D body)
{
    Hide(); // Player disappears after being hit.
    EmitSignal(nameof(Hit));
    // Must be deferred as we can't change physics properties on a physics callback.
    GetNode&lt;CollisionShape2D&gt;("CollisionShape2D").SetDeferred("disabled", true);
}
</pre> </div>
<div aria-labelledby="tab-8-Qysr" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-8-Qysr" name="Qysr" role="tabpanel" tabindex="0">
<pre data-language="cpp">// This code goes in `player.cpp`.
void Player::_on_Player_body_entered(godot::Node2D *_body) {
    hide(); // Player disappears after being hit.
    emit_signal("hit");
    // Must be deferred as we can't change physics properties on a physics callback.
    _collision_shape-&gt;set_deferred("disabled", true);
}
</pre> </div>
</div> <p>Each time an enemy hits the player, the signal is going to be emitted. We need to disable the player's collision so that we don't trigger the <code>hit</code> signal more than once.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>Disabling the area's collision shape can cause an error if it happens in the middle of the engine's collision processing. Using <code>set_deferred()</code> tells Godot to wait to disable the shape until it's safe to do so.</p> </div> <p>The last piece is to add a function we can call to reset the player when starting a new game.</p> <div class="sphinx-tabs docutils container"> <div aria-label="Tabbed content" class="closeable" role="tablist">
<button aria-controls="panel-9-R0RTY3JpcHQ=" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-9-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tab" tabindex="0">GDScript</button><button aria-controls="panel-9-QyM=" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-9-QyM=" name="QyM=" role="tab" tabindex="-1">C#</button><button aria-controls="panel-9-Qysr" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-9-Qysr" name="Qysr" role="tab" tabindex="-1">C++</button>
</div>
<div aria-labelledby="tab-9-R0RTY3JpcHQ=" class="sphinx-tabs-panel code-tab group-tab" id="panel-9-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tabpanel" tabindex="0">
<pre data-language="gdscript">func start(pos):
    position = pos
    show()
    $CollisionShape2D.disabled = false
</pre> </div>
<div aria-labelledby="tab-9-QyM=" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-9-QyM=" name="QyM=" role="tabpanel" tabindex="0">
<pre data-language="csharp">public void Start(Vector2 pos)
{
    Position = pos;
    Show();
    GetNode&lt;CollisionShape2D&gt;("CollisionShape2D").Disabled = false;
}
</pre> </div>
<div aria-labelledby="tab-9-Qysr" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-9-Qysr" name="Qysr" role="tabpanel" tabindex="0">
<pre data-language="cpp">// This code goes in `player.cpp`.
void Player::start(const godot::Vector2 p_position) {
    set_position(p_position);
    show();
    _collision_shape-&gt;set_disabled(false);
}
</pre> </div>
</div> <p>With the player working, we'll work on the enemy in the next lesson.</p> </section><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2014&ndash;2022 Juan Linietsky, Ariel Manzur and the Godot community<br>Licensed under the Creative Commons Attribution Unported License v3.0.<br>
    <a href="https://docs.godotengine.org/en/3.5/getting_started/first_2d_game/03.coding_the_player.html" class="_attribution-link">https://docs.godotengine.org/en/3.5/getting_started/first_2d_game/03.coding_the_player.html</a>
  </p>
</div>
