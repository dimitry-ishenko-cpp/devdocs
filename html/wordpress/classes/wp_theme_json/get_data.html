<h1>WP_Theme_JSON::get_data(): array</h1>  <section> <p>Returns a valid theme.json as provided by a theme.</p> </section>   <section> <header class="toc-header"><h2 id="description">Description</h2></header> <p>Unlike get_raw_data() this returns the presets flattened, as provided by a theme.<br>This also uses appearanceTools instead of their opt-ins if all of them are true.</p> </section>  <section> <header class="toc-header"><h2 id="return">Return</h2></header> <p><span class="return-type">array</span> </p> </section>  <section> <header class="toc-header"><h2 id="source">Source</h2></header> <p> File: <code>wp-includes/class-wp-theme-json.php</code>. <a href="https://developer.wordpress.org/reference/files/wp-includes/class-wp-theme-json.php/">View all references</a> </p> <pre class="wp-block-code" data-start="2805" aria-label="Function source code" data-language="php"><code lang="php" class="language-php line-numbers">public function get_data() {
	$output = $this-&gt;theme_json;
	$nodes  = static::get_setting_nodes( $output );

	/**
	 * Flatten the theme &amp; custom origins into a single one.
	 *
	 * For example, the following:
	 *
	 * {
	 *   "settings": {
	 *     "color": {
	 *       "palette": {
	 *         "theme": [ {} ],
	 *         "custom": [ {} ]
	 *       }
	 *     }
	 *   }
	 * }
	 *
	 * will be converted to:
	 *
	 * {
	 *   "settings": {
	 *     "color": {
	 *       "palette": [ {} ]
	 *     }
	 *   }
	 * }
	 */
	foreach ( $nodes as $node ) {
		foreach ( static::PRESETS_METADATA as $preset_metadata ) {
			$path   = array_merge( $node['path'], $preset_metadata['path'] );
			$preset = _wp_array_get( $output, $path, null );
			if ( null === $preset ) {
				continue;
			}

			$items = array();
			if ( isset( $preset['theme'] ) ) {
				foreach ( $preset['theme'] as $item ) {
					$slug = $item['slug'];
					unset( $item['slug'] );
					$items[ $slug ] = $item;
				}
			}
			if ( isset( $preset['custom'] ) ) {
				foreach ( $preset['custom'] as $item ) {
					$slug = $item['slug'];
					unset( $item['slug'] );
					$items[ $slug ] = $item;
				}
			}
			$flattened_preset = array();
			foreach ( $items as $slug =&gt; $value ) {
				$flattened_preset[] = array_merge( array( 'slug' =&gt; (string) $slug ), $value );
			}
			_wp_array_set( $output, $path, $flattened_preset );
		}
	}

	// If all of the static::APPEARANCE_TOOLS_OPT_INS are true,
	// this code unsets them and sets 'appearanceTools' instead.
	foreach ( $nodes as $node ) {
		$all_opt_ins_are_set = true;
		foreach ( static::APPEARANCE_TOOLS_OPT_INS as $opt_in_path ) {
			$full_path = array_merge( $node['path'], $opt_in_path );
			// Use "unset prop" as a marker instead of "null" because
			// "null" can be a valid value for some props (e.g. blockGap).
			$opt_in_value = _wp_array_get( $output, $full_path, 'unset prop' );
			if ( 'unset prop' === $opt_in_value ) {
				$all_opt_ins_are_set = false;
				break;
			}
		}

		if ( $all_opt_ins_are_set ) {
			_wp_array_set( $output, array_merge( $node['path'], array( 'appearanceTools' ) ), true );
			foreach ( static::APPEARANCE_TOOLS_OPT_INS as $opt_in_path ) {
				$full_path = array_merge( $node['path'], $opt_in_path );
				// Use "unset prop" as a marker instead of "null" because
				// "null" can be a valid value for some props (e.g. blockGap).
				$opt_in_value = _wp_array_get( $output, $full_path, 'unset prop' );
				if ( true !== $opt_in_value ) {
					continue;
				}

				// The following could be improved to be path independent.
				// At the moment it relies on a couple of assumptions:
				//
				// - all opt-ins having a path of size 2.
				// - there's two sources of settings: the top-level and the block-level.
				if (
					( 1 === count( $node['path'] ) ) &amp;&amp;
					( 'settings' === $node['path'][0] )
				) {
					// Top-level settings.
					unset( $output['settings'][ $opt_in_path[0] ][ $opt_in_path[1] ] );
					if ( empty( $output['settings'][ $opt_in_path[0] ] ) ) {
						unset( $output['settings'][ $opt_in_path[0] ] );
					}
				} elseif (
					( 3 === count( $node['path'] ) ) &amp;&amp;
					( 'settings' === $node['path'][0] ) &amp;&amp;
					( 'blocks' === $node['path'][1] )
				) {
					// Block-level settings.
					$block_name = $node['path'][2];
					unset( $output['settings']['blocks'][ $block_name ][ $opt_in_path[0] ][ $opt_in_path[1] ] );
					if ( empty( $output['settings']['blocks'][ $block_name ][ $opt_in_path[0] ] ) ) {
						unset( $output['settings']['blocks'][ $block_name ][ $opt_in_path[0] ] );
					}
				}
			}
		}
	}

	wp_recursive_ksort( $output );

	return $output;
}
</code></pre>  </section>  <section> <header class="toc-header"><h2 id="related">Related</h2></header> <article class="uses"> <header class="toc-header"><h3 id="uses">Uses</h3></header> <table id="uses-table" data-show="3">  <thead> <tr> <th>Uses</th> <th class="related-desc">Description</th> </tr> </thead> <tbody> <tr> <td class="related-title"> <a href="../../functions/wp_recursive_ksort.html">wp_recursive_ksort()</a> <span>wp-includes/functions.php</span> </td> <td class="related-desc"> <p>Sorts the keys of an array alphabetically.</p> </td> </tr> <tr> <td class="related-title"> <a href="../../functions/_wp_array_set.html">_wp_array_set()</a> <span>wp-includes/functions.php</span> </td> <td class="related-desc"> <p>Sets an array in depth based on a path of keys.</p> </td> </tr> <tr> <td class="related-title"> <a href="../../functions/_wp_array_get.html">_wp_array_get()</a> <span>wp-includes/functions.php</span> </td> <td class="related-desc"> <p>Accesses an array in depth based on a path of keys.</p> </td> </tr> </tbody>

</table> </article> </section>  <section> <header class="toc-header"><h2 id="changelog">Changelog</h2></header> <table>  <thead> <tr> <th class="changelog-version">Version</th> <th class="changelog-desc">Description</th> </tr> </thead> <tbody> <tr> <td><a href="https://developer.wordpress.org/reference/since/6.0.0/" alt="WordPress 6.0.0">6.0.0</a></td> <td>Introduced.</td> </tr> </tbody> </table> </section><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2003&ndash;2022 WordPress Foundation<br>Licensed under the GNU GPLv2+ License.<br>
    <a href="https://developer.wordpress.org/reference/classes/wp_theme_json/get_data" class="_attribution-link">https://developer.wordpress.org/reference/classes/wp_theme_json/get_data</a>
  </p>
</div>
