<h1>class WP_REST_Users_Controller {}</h1>  <section> <p>Core class used to manage users via the REST API.</p> </section>   <section> <header class="toc-header"><h2 id="description">Description</h2></header> <header class="toc-header"><h3 id="see-also">See also</h3></header> <ul> <li><a href="wp_rest_controller.html">WP_REST_Controller</a></li> </ul> </section>  <section> <header class="toc-header"><h2 id="methods">Methods</h2></header> <ul> <li>
<a href="wp_rest_users_controller/__construct.html"> __construct</a> — Constructor. </li> <li>
<a href="wp_rest_users_controller/check_reassign.html"> check_reassign</a> — Checks for a valid value for the reassign parameter when deleting users. </li> <li>
<a href="wp_rest_users_controller/check_role_update.html"> check_role_update</a> — Determines if the current user is allowed to make the desired roles change. </li> <li>
<a href="wp_rest_users_controller/check_user_password.html"> check_user_password</a> — Check a user password for the REST API. </li> <li>
<a href="wp_rest_users_controller/check_username.html"> check_username</a> — Check a username for the REST API. </li> <li>
<a href="wp_rest_users_controller/create_item.html"> create_item</a> — Creates a single user. </li> <li>
<a href="wp_rest_users_controller/create_item_permissions_check.html"> create_item_permissions_check</a> — Checks if a given request has access create users. </li> <li>
<a href="wp_rest_users_controller/delete_current_item.html"> delete_current_item</a> — Deletes the current user. </li> <li>
<a href="wp_rest_users_controller/delete_current_item_permissions_check.html"> delete_current_item_permissions_check</a> — Checks if a given request has access to delete the current user. </li> <li>
<a href="wp_rest_users_controller/delete_item.html"> delete_item</a> — Deletes a single user. </li> <li>
<a href="wp_rest_users_controller/delete_item_permissions_check.html"> delete_item_permissions_check</a> — Checks if a given request has access delete a user. </li> <li>
<a href="wp_rest_users_controller/get_collection_params.html"> get_collection_params</a> — Retrieves the query params for collections. </li> <li>
<a href="wp_rest_users_controller/get_current_item.html"> get_current_item</a> — Retrieves the current user. </li> <li>
<a href="wp_rest_users_controller/get_item.html"> get_item</a> — Retrieves a single user. </li> <li>
<a href="wp_rest_users_controller/get_item_permissions_check.html"> get_item_permissions_check</a> — Checks if a given request has access to read a user. </li> <li>
<a href="wp_rest_users_controller/get_item_schema.html"> get_item_schema</a> — Retrieves the user's schema, conforming to JSON Schema. </li> <li>
<a href="wp_rest_users_controller/get_items.html"> get_items</a> — Retrieves all users. </li> <li>
<a href="wp_rest_users_controller/get_items_permissions_check.html"> get_items_permissions_check</a> — Permissions check for getting all users. </li> <li>
<a href="wp_rest_users_controller/get_user.html"> get_user</a> — Get the user, if the ID is valid. </li> <li>
<a href="wp_rest_users_controller/prepare_item_for_database.html"> prepare_item_for_database</a> — Prepares a single user for creation or update. </li> <li>
<a href="wp_rest_users_controller/prepare_item_for_response.html"> prepare_item_for_response</a> — Prepares a single user output for response. </li> <li>
<a href="wp_rest_users_controller/prepare_links.html"> prepare_links</a> — Prepares links for the user request. </li> <li>
<a href="wp_rest_users_controller/register_routes.html"> register_routes</a> — Registers the routes for users. </li> <li>
<a href="wp_rest_users_controller/update_current_item.html"> update_current_item</a> — Updates the current user. </li> <li>
<a href="wp_rest_users_controller/update_current_item_permissions_check.html"> update_current_item_permissions_check</a> — Checks if a given request has access to update the current user. </li> <li>
<a href="wp_rest_users_controller/update_item.html"> update_item</a> — Updates a single user. </li> <li>
<a href="wp_rest_users_controller/update_item_permissions_check.html"> update_item_permissions_check</a> — Checks if a given request has access to update a user. </li> </ul> </section>  <section> <header class="toc-header"><h2 id="source">Source</h2></header> <p> File: <code>wp-includes/rest-api/endpoints/class-wp-rest-users-controller.php</code>. <a href="https://developer.wordpress.org/reference/files/wp-includes/rest-api/endpoints/class-wp-rest-users-controller.php/">View all references</a> </p> <pre class="wp-block-code" data-start="17" aria-label="Function source code" data-language="php"><code lang="php" class="language-php line-numbers">class WP_REST_Users_Controller extends WP_REST_Controller {

	/**
	 * Instance of a user meta fields object.
	 *
	 * @since 4.7.0
	 * @var WP_REST_User_Meta_Fields
	 */
	protected $meta;

	/**
	 * Constructor.
	 *
	 * @since 4.7.0
	 */
	public function __construct() {
		$this-&gt;namespace = 'wp/v2';
		$this-&gt;rest_base = 'users';

		$this-&gt;meta = new WP_REST_User_Meta_Fields();
	}

	/**
	 * Registers the routes for users.
	 *
	 * @since 4.7.0
	 *
	 * @see register_rest_route()
	 */
	public function register_routes() {

		register_rest_route(
			$this-&gt;namespace,
			'/' . $this-&gt;rest_base,
			array(
				array(
					'methods'             =&gt; WP_REST_Server::READABLE,
					'callback'            =&gt; array( $this, 'get_items' ),
					'permission_callback' =&gt; array( $this, 'get_items_permissions_check' ),
					'args'                =&gt; $this-&gt;get_collection_params(),
				),
				array(
					'methods'             =&gt; WP_REST_Server::CREATABLE,
					'callback'            =&gt; array( $this, 'create_item' ),
					'permission_callback' =&gt; array( $this, 'create_item_permissions_check' ),
					'args'                =&gt; $this-&gt;get_endpoint_args_for_item_schema( WP_REST_Server::CREATABLE ),
				),
				'schema' =&gt; array( $this, 'get_public_item_schema' ),
			)
		);

		register_rest_route(
			$this-&gt;namespace,
			'/' . $this-&gt;rest_base . '/(?P&lt;id&gt;[\d]+)',
			array(
				'args'   =&gt; array(
					'id' =&gt; array(
						'description' =&gt; __( 'Unique identifier for the user.' ),
						'type'        =&gt; 'integer',
					),
				),
				array(
					'methods'             =&gt; WP_REST_Server::READABLE,
					'callback'            =&gt; array( $this, 'get_item' ),
					'permission_callback' =&gt; array( $this, 'get_item_permissions_check' ),
					'args'                =&gt; array(
						'context' =&gt; $this-&gt;get_context_param( array( 'default' =&gt; 'view' ) ),
					),
				),
				array(
					'methods'             =&gt; WP_REST_Server::EDITABLE,
					'callback'            =&gt; array( $this, 'update_item' ),
					'permission_callback' =&gt; array( $this, 'update_item_permissions_check' ),
					'args'                =&gt; $this-&gt;get_endpoint_args_for_item_schema( WP_REST_Server::EDITABLE ),
				),
				array(
					'methods'             =&gt; WP_REST_Server::DELETABLE,
					'callback'            =&gt; array( $this, 'delete_item' ),
					'permission_callback' =&gt; array( $this, 'delete_item_permissions_check' ),
					'args'                =&gt; array(
						'force'    =&gt; array(
							'type'        =&gt; 'boolean',
							'default'     =&gt; false,
							'description' =&gt; __( 'Required to be true, as users do not support trashing.' ),
						),
						'reassign' =&gt; array(
							'type'              =&gt; 'integer',
							'description'       =&gt; __( 'Reassign the deleted user\'s posts and links to this user ID.' ),
							'required'          =&gt; true,
							'sanitize_callback' =&gt; array( $this, 'check_reassign' ),
						),
					),
				),
				'schema' =&gt; array( $this, 'get_public_item_schema' ),
			)
		);

		register_rest_route(
			$this-&gt;namespace,
			'/' . $this-&gt;rest_base . '/me',
			array(
				array(
					'methods'             =&gt; WP_REST_Server::READABLE,
					'permission_callback' =&gt; '__return_true',
					'callback'            =&gt; array( $this, 'get_current_item' ),
					'args'                =&gt; array(
						'context' =&gt; $this-&gt;get_context_param( array( 'default' =&gt; 'view' ) ),
					),
				),
				array(
					'methods'             =&gt; WP_REST_Server::EDITABLE,
					'callback'            =&gt; array( $this, 'update_current_item' ),
					'permission_callback' =&gt; array( $this, 'update_current_item_permissions_check' ),
					'args'                =&gt; $this-&gt;get_endpoint_args_for_item_schema( WP_REST_Server::EDITABLE ),
				),
				array(
					'methods'             =&gt; WP_REST_Server::DELETABLE,
					'callback'            =&gt; array( $this, 'delete_current_item' ),
					'permission_callback' =&gt; array( $this, 'delete_current_item_permissions_check' ),
					'args'                =&gt; array(
						'force'    =&gt; array(
							'type'        =&gt; 'boolean',
							'default'     =&gt; false,
							'description' =&gt; __( 'Required to be true, as users do not support trashing.' ),
						),
						'reassign' =&gt; array(
							'type'              =&gt; 'integer',
							'description'       =&gt; __( 'Reassign the deleted user\'s posts and links to this user ID.' ),
							'required'          =&gt; true,
							'sanitize_callback' =&gt; array( $this, 'check_reassign' ),
						),
					),
				),
				'schema' =&gt; array( $this, 'get_public_item_schema' ),
			)
		);
	}

	/**
	 * Checks for a valid value for the reassign parameter when deleting users.
	 *
	 * The value can be an integer, 'false', false, or ''.
	 *
	 * @since 4.7.0
	 *
	 * @param int|bool        $value   The value passed to the reassign parameter.
	 * @param WP_REST_Request $request Full details about the request.
	 * @param string          $param   The parameter that is being sanitized.
	 * @return int|bool|WP_Error
	 */
	public function check_reassign( $value, $request, $param ) {
		if ( is_numeric( $value ) ) {
			return $value;
		}

		if ( empty( $value ) || false === $value || 'false' === $value ) {
			return false;
		}

		return new WP_Error(
			'rest_invalid_param',
			__( 'Invalid user parameter(s).' ),
			array( 'status' =&gt; 400 )
		);
	}

	/**
	 * Permissions check for getting all users.
	 *
	 * @since 4.7.0
	 *
	 * @param WP_REST_Request $request Full details about the request.
	 * @return true|WP_Error True if the request has read access, otherwise WP_Error object.
	 */
	public function get_items_permissions_check( $request ) {
		// Check if roles is specified in GET request and if user can list users.
		if ( ! empty( $request['roles'] ) &amp;&amp; ! current_user_can( 'list_users' ) ) {
			return new WP_Error(
				'rest_user_cannot_view',
				__( 'Sorry, you are not allowed to filter users by role.' ),
				array( 'status' =&gt; rest_authorization_required_code() )
			);
		}

		// Check if capabilities is specified in GET request and if user can list users.
		if ( ! empty( $request['capabilities'] ) &amp;&amp; ! current_user_can( 'list_users' ) ) {
			return new WP_Error(
				'rest_user_cannot_view',
				__( 'Sorry, you are not allowed to filter users by capability.' ),
				array( 'status' =&gt; rest_authorization_required_code() )
			);
		}

		if ( 'edit' === $request['context'] &amp;&amp; ! current_user_can( 'list_users' ) ) {
			return new WP_Error(
				'rest_forbidden_context',
				__( 'Sorry, you are not allowed to list users.' ),
				array( 'status' =&gt; rest_authorization_required_code() )
			);
		}

		if ( in_array( $request['orderby'], array( 'email', 'registered_date' ), true ) &amp;&amp; ! current_user_can( 'list_users' ) ) {
			return new WP_Error(
				'rest_forbidden_orderby',
				__( 'Sorry, you are not allowed to order users by this parameter.' ),
				array( 'status' =&gt; rest_authorization_required_code() )
			);
		}

		if ( 'authors' === $request['who'] ) {
			$types = get_post_types( array( 'show_in_rest' =&gt; true ), 'objects' );

			foreach ( $types as $type ) {
				if ( post_type_supports( $type-&gt;name, 'author' )
					&amp;&amp; current_user_can( $type-&gt;cap-&gt;edit_posts ) ) {
					return true;
				}
			}

			return new WP_Error(
				'rest_forbidden_who',
				__( 'Sorry, you are not allowed to query users by this parameter.' ),
				array( 'status' =&gt; rest_authorization_required_code() )
			);
		}

		return true;
	}

	/**
	 * Retrieves all users.
	 *
	 * @since 4.7.0
	 *
	 * @param WP_REST_Request $request Full details about the request.
	 * @return WP_REST_Response|WP_Error Response object on success, or WP_Error object on failure.
	 */
	public function get_items( $request ) {

		// Retrieve the list of registered collection query parameters.
		$registered = $this-&gt;get_collection_params();

		/*
		 * This array defines mappings between public API query parameters whose
		 * values are accepted as-passed, and their internal WP_Query parameter
		 * name equivalents (some are the same). Only values which are also
		 * present in $registered will be set.
		 */
		$parameter_mappings = array(
			'exclude'      =&gt; 'exclude',
			'include'      =&gt; 'include',
			'order'        =&gt; 'order',
			'per_page'     =&gt; 'number',
			'search'       =&gt; 'search',
			'roles'        =&gt; 'role__in',
			'capabilities' =&gt; 'capability__in',
			'slug'         =&gt; 'nicename__in',
		);

		$prepared_args = array();

		/*
		 * For each known parameter which is both registered and present in the request,
		 * set the parameter's value on the query $prepared_args.
		 */
		foreach ( $parameter_mappings as $api_param =&gt; $wp_param ) {
			if ( isset( $registered[ $api_param ], $request[ $api_param ] ) ) {
				$prepared_args[ $wp_param ] = $request[ $api_param ];
			}
		}

		if ( isset( $registered['offset'] ) &amp;&amp; ! empty( $request['offset'] ) ) {
			$prepared_args['offset'] = $request['offset'];
		} else {
			$prepared_args['offset'] = ( $request['page'] - 1 ) * $prepared_args['number'];
		}

		if ( isset( $registered['orderby'] ) ) {
			$orderby_possibles        = array(
				'id'              =&gt; 'ID',
				'include'         =&gt; 'include',
				'name'            =&gt; 'display_name',
				'registered_date' =&gt; 'registered',
				'slug'            =&gt; 'user_nicename',
				'include_slugs'   =&gt; 'nicename__in',
				'email'           =&gt; 'user_email',
				'url'             =&gt; 'user_url',
			);
			$prepared_args['orderby'] = $orderby_possibles[ $request['orderby'] ];
		}

		if ( isset( $registered['who'] ) &amp;&amp; ! empty( $request['who'] ) &amp;&amp; 'authors' === $request['who'] ) {
			$prepared_args['who'] = 'authors';
		} elseif ( ! current_user_can( 'list_users' ) ) {
			$prepared_args['has_published_posts'] = get_post_types( array( 'show_in_rest' =&gt; true ), 'names' );
		}

		if ( ! empty( $request['has_published_posts'] ) ) {
			$prepared_args['has_published_posts'] = ( true === $request['has_published_posts'] )
				? get_post_types( array( 'show_in_rest' =&gt; true ), 'names' )
				: (array) $request['has_published_posts'];
		}

		if ( ! empty( $prepared_args['search'] ) ) {
			$prepared_args['search'] = '*' . $prepared_args['search'] . '*';
		}
		/**
		 * Filters WP_User_Query arguments when querying users via the REST API.
		 *
		 * @link https://developer.wordpress.org/reference/classes/wp_user_query/
		 *
		 * @since 4.7.0
		 *
		 * @param array           $prepared_args Array of arguments for WP_User_Query.
		 * @param WP_REST_Request $request       The REST API request.
		 */
		$prepared_args = apply_filters( 'rest_user_query', $prepared_args, $request );

		$query = new WP_User_Query( $prepared_args );

		$users = array();

		foreach ( $query-&gt;results as $user ) {
			$data    = $this-&gt;prepare_item_for_response( $user, $request );
			$users[] = $this-&gt;prepare_response_for_collection( $data );
		}

		$response = rest_ensure_response( $users );

		// Store pagination values for headers then unset for count query.
		$per_page = (int) $prepared_args['number'];
		$page     = ceil( ( ( (int) $prepared_args['offset'] ) / $per_page ) + 1 );

		$prepared_args['fields'] = 'ID';

		$total_users = $query-&gt;get_total();

		if ( $total_users &lt; 1 ) {
			// Out-of-bounds, run the query again without LIMIT for total count.
			unset( $prepared_args['number'], $prepared_args['offset'] );
			$count_query = new WP_User_Query( $prepared_args );
			$total_users = $count_query-&gt;get_total();
		}

		$response-&gt;header( 'X-WP-Total', (int) $total_users );

		$max_pages = ceil( $total_users / $per_page );

		$response-&gt;header( 'X-WP-TotalPages', (int) $max_pages );

		$base = add_query_arg( urlencode_deep( $request-&gt;get_query_params() ), rest_url( sprintf( '%s/%s', $this-&gt;namespace, $this-&gt;rest_base ) ) );
		if ( $page &gt; 1 ) {
			$prev_page = $page - 1;

			if ( $prev_page &gt; $max_pages ) {
				$prev_page = $max_pages;
			}

			$prev_link = add_query_arg( 'page', $prev_page, $base );
			$response-&gt;link_header( 'prev', $prev_link );
		}
		if ( $max_pages &gt; $page ) {
			$next_page = $page + 1;
			$next_link = add_query_arg( 'page', $next_page, $base );

			$response-&gt;link_header( 'next', $next_link );
		}

		return $response;
	}

	/**
	 * Get the user, if the ID is valid.
	 *
	 * @since 4.7.2
	 *
	 * @param int $id Supplied ID.
	 * @return WP_User|WP_Error True if ID is valid, WP_Error otherwise.
	 */
	protected function get_user( $id ) {
		$error = new WP_Error(
			'rest_user_invalid_id',
			__( 'Invalid user ID.' ),
			array( 'status' =&gt; 404 )
		);

		if ( (int) $id &lt;= 0 ) {
			return $error;
		}

		$user = get_userdata( (int) $id );
		if ( empty( $user ) || ! $user-&gt;exists() ) {
			return $error;
		}

		if ( is_multisite() &amp;&amp; ! is_user_member_of_blog( $user-&gt;ID ) ) {
			return $error;
		}

		return $user;
	}

	/**
	 * Checks if a given request has access to read a user.
	 *
	 * @since 4.7.0
	 *
	 * @param WP_REST_Request $request Full details about the request.
	 * @return true|WP_Error True if the request has read access for the item, otherwise WP_Error object.
	 */
	public function get_item_permissions_check( $request ) {
		$user = $this-&gt;get_user( $request['id'] );
		if ( is_wp_error( $user ) ) {
			return $user;
		}

		$types = get_post_types( array( 'show_in_rest' =&gt; true ), 'names' );

		if ( get_current_user_id() === $user-&gt;ID ) {
			return true;
		}

		if ( 'edit' === $request['context'] &amp;&amp; ! current_user_can( 'list_users' ) ) {
			return new WP_Error(
				'rest_user_cannot_view',
				__( 'Sorry, you are not allowed to list users.' ),
				array( 'status' =&gt; rest_authorization_required_code() )
			);
		} elseif ( ! count_user_posts( $user-&gt;ID, $types ) &amp;&amp; ! current_user_can( 'edit_user', $user-&gt;ID ) &amp;&amp; ! current_user_can( 'list_users' ) ) {
			return new WP_Error(
				'rest_user_cannot_view',
				__( 'Sorry, you are not allowed to list users.' ),
				array( 'status' =&gt; rest_authorization_required_code() )
			);
		}

		return true;
	}

	/**
	 * Retrieves a single user.
	 *
	 * @since 4.7.0
	 *
	 * @param WP_REST_Request $request Full details about the request.
	 * @return WP_REST_Response|WP_Error Response object on success, or WP_Error object on failure.
	 */
	public function get_item( $request ) {
		$user = $this-&gt;get_user( $request['id'] );
		if ( is_wp_error( $user ) ) {
			return $user;
		}

		$user     = $this-&gt;prepare_item_for_response( $user, $request );
		$response = rest_ensure_response( $user );

		return $response;
	}

	/**
	 * Retrieves the current user.
	 *
	 * @since 4.7.0
	 *
	 * @param WP_REST_Request $request Full details about the request.
	 * @return WP_REST_Response|WP_Error Response object on success, or WP_Error object on failure.
	 */
	public function get_current_item( $request ) {
		$current_user_id = get_current_user_id();

		if ( empty( $current_user_id ) ) {
			return new WP_Error(
				'rest_not_logged_in',
				__( 'You are not currently logged in.' ),
				array( 'status' =&gt; 401 )
			);
		}

		$user     = wp_get_current_user();
		$response = $this-&gt;prepare_item_for_response( $user, $request );
		$response = rest_ensure_response( $response );

		return $response;
	}

	/**
	 * Checks if a given request has access create users.
	 *
	 * @since 4.7.0
	 *
	 * @param WP_REST_Request $request Full details about the request.
	 * @return true|WP_Error True if the request has access to create items, WP_Error object otherwise.
	 */
	public function create_item_permissions_check( $request ) {

		if ( ! current_user_can( 'create_users' ) ) {
			return new WP_Error(
				'rest_cannot_create_user',
				__( 'Sorry, you are not allowed to create new users.' ),
				array( 'status' =&gt; rest_authorization_required_code() )
			);
		}

		return true;
	}

	/**
	 * Creates a single user.
	 *
	 * @since 4.7.0
	 *
	 * @param WP_REST_Request $request Full details about the request.
	 * @return WP_REST_Response|WP_Error Response object on success, or WP_Error object on failure.
	 */
	public function create_item( $request ) {
		if ( ! empty( $request['id'] ) ) {
			return new WP_Error(
				'rest_user_exists',
				__( 'Cannot create existing user.' ),
				array( 'status' =&gt; 400 )
			);
		}

		$schema = $this-&gt;get_item_schema();

		if ( ! empty( $request['roles'] ) &amp;&amp; ! empty( $schema['properties']['roles'] ) ) {
			$check_permission = $this-&gt;check_role_update( $request['id'], $request['roles'] );

			if ( is_wp_error( $check_permission ) ) {
				return $check_permission;
			}
		}

		$user = $this-&gt;prepare_item_for_database( $request );

		if ( is_multisite() ) {
			$ret = wpmu_validate_user_signup( $user-&gt;user_login, $user-&gt;user_email );

			if ( is_wp_error( $ret['errors'] ) &amp;&amp; $ret['errors']-&gt;has_errors() ) {
				$error = new WP_Error(
					'rest_invalid_param',
					__( 'Invalid user parameter(s).' ),
					array( 'status' =&gt; 400 )
				);

				foreach ( $ret['errors']-&gt;errors as $code =&gt; $messages ) {
					foreach ( $messages as $message ) {
						$error-&gt;add( $code, $message );
					}

					$error_data = $error-&gt;get_error_data( $code );

					if ( $error_data ) {
						$error-&gt;add_data( $error_data, $code );
					}
				}
				return $error;
			}
		}

		if ( is_multisite() ) {
			$user_id = wpmu_create_user( $user-&gt;user_login, $user-&gt;user_pass, $user-&gt;user_email );

			if ( ! $user_id ) {
				return new WP_Error(
					'rest_user_create',
					__( 'Error creating new user.' ),
					array( 'status' =&gt; 500 )
				);
			}

			$user-&gt;ID = $user_id;
			$user_id  = wp_update_user( wp_slash( (array) $user ) );

			if ( is_wp_error( $user_id ) ) {
				return $user_id;
			}

			$result = add_user_to_blog( get_site()-&gt;id, $user_id, '' );
			if ( is_wp_error( $result ) ) {
				return $result;
			}
		} else {
			$user_id = wp_insert_user( wp_slash( (array) $user ) );

			if ( is_wp_error( $user_id ) ) {
				return $user_id;
			}
		}

		$user = get_user_by( 'id', $user_id );

		/**
		 * Fires immediately after a user is created or updated via the REST API.
		 *
		 * @since 4.7.0
		 *
		 * @param WP_User         $user     Inserted or updated user object.
		 * @param WP_REST_Request $request  Request object.
		 * @param bool            $creating True when creating a user, false when updating.
		 */
		do_action( 'rest_insert_user', $user, $request, true );

		if ( ! empty( $request['roles'] ) &amp;&amp; ! empty( $schema['properties']['roles'] ) ) {
			array_map( array( $user, 'add_role' ), $request['roles'] );
		}

		if ( ! empty( $schema['properties']['meta'] ) &amp;&amp; isset( $request['meta'] ) ) {
			$meta_update = $this-&gt;meta-&gt;update_value( $request['meta'], $user_id );

			if ( is_wp_error( $meta_update ) ) {
				return $meta_update;
			}
		}

		$user          = get_user_by( 'id', $user_id );
		$fields_update = $this-&gt;update_additional_fields_for_object( $user, $request );

		if ( is_wp_error( $fields_update ) ) {
			return $fields_update;
		}

		$request-&gt;set_param( 'context', 'edit' );

		/**
		 * Fires after a user is completely created or updated via the REST API.
		 *
		 * @since 5.0.0
		 *
		 * @param WP_User         $user     Inserted or updated user object.
		 * @param WP_REST_Request $request  Request object.
		 * @param bool            $creating True when creating a user, false when updating.
		 */
		do_action( 'rest_after_insert_user', $user, $request, true );

		$response = $this-&gt;prepare_item_for_response( $user, $request );
		$response = rest_ensure_response( $response );

		$response-&gt;set_status( 201 );
		$response-&gt;header( 'Location', rest_url( sprintf( '%s/%s/%d', $this-&gt;namespace, $this-&gt;rest_base, $user_id ) ) );

		return $response;
	}

	/**
	 * Checks if a given request has access to update a user.
	 *
	 * @since 4.7.0
	 *
	 * @param WP_REST_Request $request Full details about the request.
	 * @return true|WP_Error True if the request has access to update the item, WP_Error object otherwise.
	 */
	public function update_item_permissions_check( $request ) {
		$user = $this-&gt;get_user( $request['id'] );
		if ( is_wp_error( $user ) ) {
			return $user;
		}

		if ( ! empty( $request['roles'] ) ) {
			if ( ! current_user_can( 'promote_user', $user-&gt;ID ) ) {
				return new WP_Error(
					'rest_cannot_edit_roles',
					__( 'Sorry, you are not allowed to edit roles of this user.' ),
					array( 'status' =&gt; rest_authorization_required_code() )
				);
			}

			$request_params = array_keys( $request-&gt;get_params() );
			sort( $request_params );
			// If only 'id' and 'roles' are specified (we are only trying to
			// edit roles), then only the 'promote_user' cap is required.
			if ( array( 'id', 'roles' ) === $request_params ) {
				return true;
			}
		}

		if ( ! current_user_can( 'edit_user', $user-&gt;ID ) ) {
			return new WP_Error(
				'rest_cannot_edit',
				__( 'Sorry, you are not allowed to edit this user.' ),
				array( 'status' =&gt; rest_authorization_required_code() )
			);
		}

		return true;
	}

	/**
	 * Updates a single user.
	 *
	 * @since 4.7.0
	 *
	 * @param WP_REST_Request $request Full details about the request.
	 * @return WP_REST_Response|WP_Error Response object on success, or WP_Error object on failure.
	 */
	public function update_item( $request ) {
		$user = $this-&gt;get_user( $request['id'] );
		if ( is_wp_error( $user ) ) {
			return $user;
		}

		$id = $user-&gt;ID;

		if ( ! $user ) {
			return new WP_Error(
				'rest_user_invalid_id',
				__( 'Invalid user ID.' ),
				array( 'status' =&gt; 404 )
			);
		}

		$owner_id = false;
		if ( is_string( $request['email'] ) ) {
			$owner_id = email_exists( $request['email'] );
		}

		if ( $owner_id &amp;&amp; $owner_id !== $id ) {
			return new WP_Error(
				'rest_user_invalid_email',
				__( 'Invalid email address.' ),
				array( 'status' =&gt; 400 )
			);
		}

		if ( ! empty( $request['username'] ) &amp;&amp; $request['username'] !== $user-&gt;user_login ) {
			return new WP_Error(
				'rest_user_invalid_argument',
				__( 'Username is not editable.' ),
				array( 'status' =&gt; 400 )
			);
		}

		if ( ! empty( $request['slug'] ) &amp;&amp; $request['slug'] !== $user-&gt;user_nicename &amp;&amp; get_user_by( 'slug', $request['slug'] ) ) {
			return new WP_Error(
				'rest_user_invalid_slug',
				__( 'Invalid slug.' ),
				array( 'status' =&gt; 400 )
			);
		}

		if ( ! empty( $request['roles'] ) ) {
			$check_permission = $this-&gt;check_role_update( $id, $request['roles'] );

			if ( is_wp_error( $check_permission ) ) {
				return $check_permission;
			}
		}

		$user = $this-&gt;prepare_item_for_database( $request );

		// Ensure we're operating on the same user we already checked.
		$user-&gt;ID = $id;

		$user_id = wp_update_user( wp_slash( (array) $user ) );

		if ( is_wp_error( $user_id ) ) {
			return $user_id;
		}

		$user = get_user_by( 'id', $user_id );

		/** This action is documented in wp-includes/rest-api/endpoints/class-wp-rest-users-controller.php */
		do_action( 'rest_insert_user', $user, $request, false );

		if ( ! empty( $request['roles'] ) ) {
			array_map( array( $user, 'add_role' ), $request['roles'] );
		}

		$schema = $this-&gt;get_item_schema();

		if ( ! empty( $schema['properties']['meta'] ) &amp;&amp; isset( $request['meta'] ) ) {
			$meta_update = $this-&gt;meta-&gt;update_value( $request['meta'], $id );

			if ( is_wp_error( $meta_update ) ) {
				return $meta_update;
			}
		}

		$user          = get_user_by( 'id', $user_id );
		$fields_update = $this-&gt;update_additional_fields_for_object( $user, $request );

		if ( is_wp_error( $fields_update ) ) {
			return $fields_update;
		}

		$request-&gt;set_param( 'context', 'edit' );

		/** This action is documented in wp-includes/rest-api/endpoints/class-wp-rest-users-controller.php */
		do_action( 'rest_after_insert_user', $user, $request, false );

		$response = $this-&gt;prepare_item_for_response( $user, $request );
		$response = rest_ensure_response( $response );

		return $response;
	}

	/**
	 * Checks if a given request has access to update the current user.
	 *
	 * @since 4.7.0
	 *
	 * @param WP_REST_Request $request Full details about the request.
	 * @return true|WP_Error True if the request has access to update the item, WP_Error object otherwise.
	 */
	public function update_current_item_permissions_check( $request ) {
		$request['id'] = get_current_user_id();

		return $this-&gt;update_item_permissions_check( $request );
	}

	/**
	 * Updates the current user.
	 *
	 * @since 4.7.0
	 *
	 * @param WP_REST_Request $request Full details about the request.
	 * @return WP_REST_Response|WP_Error Response object on success, or WP_Error object on failure.
	 */
	public function update_current_item( $request ) {
		$request['id'] = get_current_user_id();

		return $this-&gt;update_item( $request );
	}

	/**
	 * Checks if a given request has access delete a user.
	 *
	 * @since 4.7.0
	 *
	 * @param WP_REST_Request $request Full details about the request.
	 * @return true|WP_Error True if the request has access to delete the item, WP_Error object otherwise.
	 */
	public function delete_item_permissions_check( $request ) {
		$user = $this-&gt;get_user( $request['id'] );
		if ( is_wp_error( $user ) ) {
			return $user;
		}

		if ( ! current_user_can( 'delete_user', $user-&gt;ID ) ) {
			return new WP_Error(
				'rest_user_cannot_delete',
				__( 'Sorry, you are not allowed to delete this user.' ),
				array( 'status' =&gt; rest_authorization_required_code() )
			);
		}

		return true;
	}

	/**
	 * Deletes a single user.
	 *
	 * @since 4.7.0
	 *
	 * @param WP_REST_Request $request Full details about the request.
	 * @return WP_REST_Response|WP_Error Response object on success, or WP_Error object on failure.
	 */
	public function delete_item( $request ) {
		// We don't support delete requests in multisite.
		if ( is_multisite() ) {
			return new WP_Error(
				'rest_cannot_delete',
				__( 'The user cannot be deleted.' ),
				array( 'status' =&gt; 501 )
			);
		}

		$user = $this-&gt;get_user( $request['id'] );

		if ( is_wp_error( $user ) ) {
			return $user;
		}

		$id       = $user-&gt;ID;
		$reassign = false === $request['reassign'] ? null : absint( $request['reassign'] );
		$force    = isset( $request['force'] ) ? (bool) $request['force'] : false;

		// We don't support trashing for users.
		if ( ! $force ) {
			return new WP_Error(
				'rest_trash_not_supported',
				/* translators: %s: force=true */
				sprintf( __( "Users do not support trashing. Set '%s' to delete." ), 'force=true' ),
				array( 'status' =&gt; 501 )
			);
		}

		if ( ! empty( $reassign ) ) {
			if ( $reassign === $id || ! get_userdata( $reassign ) ) {
				return new WP_Error(
					'rest_user_invalid_reassign',
					__( 'Invalid user ID for reassignment.' ),
					array( 'status' =&gt; 400 )
				);
			}
		}

		$request-&gt;set_param( 'context', 'edit' );

		$previous = $this-&gt;prepare_item_for_response( $user, $request );

		// Include user admin functions to get access to wp_delete_user().
		require_once ABSPATH . 'wp-admin/includes/user.php';

		$result = wp_delete_user( $id, $reassign );

		if ( ! $result ) {
			return new WP_Error(
				'rest_cannot_delete',
				__( 'The user cannot be deleted.' ),
				array( 'status' =&gt; 500 )
			);
		}

		$response = new WP_REST_Response();
		$response-&gt;set_data(
			array(
				'deleted'  =&gt; true,
				'previous' =&gt; $previous-&gt;get_data(),
			)
		);

		/**
		 * Fires immediately after a user is deleted via the REST API.
		 *
		 * @since 4.7.0
		 *
		 * @param WP_User          $user     The user data.
		 * @param WP_REST_Response $response The response returned from the API.
		 * @param WP_REST_Request  $request  The request sent to the API.
		 */
		do_action( 'rest_delete_user', $user, $response, $request );

		return $response;
	}

	/**
	 * Checks if a given request has access to delete the current user.
	 *
	 * @since 4.7.0
	 *
	 * @param WP_REST_Request $request Full details about the request.
	 * @return true|WP_Error True if the request has access to delete the item, WP_Error object otherwise.
	 */
	public function delete_current_item_permissions_check( $request ) {
		$request['id'] = get_current_user_id();

		return $this-&gt;delete_item_permissions_check( $request );
	}

	/**
	 * Deletes the current user.
	 *
	 * @since 4.7.0
	 *
	 * @param WP_REST_Request $request Full details about the request.
	 * @return WP_REST_Response|WP_Error Response object on success, or WP_Error object on failure.
	 */
	public function delete_current_item( $request ) {
		$request['id'] = get_current_user_id();

		return $this-&gt;delete_item( $request );
	}

	/**
	 * Prepares a single user output for response.
	 *
	 * @since 4.7.0
	 * @since 5.9.0 Renamed `$user` to `$item` to match parent class for PHP 8 named parameter support.
	 *
	 * @param WP_User         $item    User object.
	 * @param WP_REST_Request $request Request object.
	 * @return WP_REST_Response Response object.
	 */
	public function prepare_item_for_response( $item, $request ) {
		// Restores the more descriptive, specific name for use within this method.
		$user   = $item;
		$data   = array();
		$fields = $this-&gt;get_fields_for_response( $request );

		if ( in_array( 'id', $fields, true ) ) {
			$data['id'] = $user-&gt;ID;
		}

		if ( in_array( 'username', $fields, true ) ) {
			$data['username'] = $user-&gt;user_login;
		}

		if ( in_array( 'name', $fields, true ) ) {
			$data['name'] = $user-&gt;display_name;
		}

		if ( in_array( 'first_name', $fields, true ) ) {
			$data['first_name'] = $user-&gt;first_name;
		}

		if ( in_array( 'last_name', $fields, true ) ) {
			$data['last_name'] = $user-&gt;last_name;
		}

		if ( in_array( 'email', $fields, true ) ) {
			$data['email'] = $user-&gt;user_email;
		}

		if ( in_array( 'url', $fields, true ) ) {
			$data['url'] = $user-&gt;user_url;
		}

		if ( in_array( 'description', $fields, true ) ) {
			$data['description'] = $user-&gt;description;
		}

		if ( in_array( 'link', $fields, true ) ) {
			$data['link'] = get_author_posts_url( $user-&gt;ID, $user-&gt;user_nicename );
		}

		if ( in_array( 'locale', $fields, true ) ) {
			$data['locale'] = get_user_locale( $user );
		}

		if ( in_array( 'nickname', $fields, true ) ) {
			$data['nickname'] = $user-&gt;nickname;
		}

		if ( in_array( 'slug', $fields, true ) ) {
			$data['slug'] = $user-&gt;user_nicename;
		}

		if ( in_array( 'roles', $fields, true ) ) {
			// Defensively call array_values() to ensure an array is returned.
			$data['roles'] = array_values( $user-&gt;roles );
		}

		if ( in_array( 'registered_date', $fields, true ) ) {
			$data['registered_date'] = gmdate( 'c', strtotime( $user-&gt;user_registered ) );
		}

		if ( in_array( 'capabilities', $fields, true ) ) {
			$data['capabilities'] = (object) $user-&gt;allcaps;
		}

		if ( in_array( 'extra_capabilities', $fields, true ) ) {
			$data['extra_capabilities'] = (object) $user-&gt;caps;
		}

		if ( in_array( 'avatar_urls', $fields, true ) ) {
			$data['avatar_urls'] = rest_get_avatar_urls( $user );
		}

		if ( in_array( 'meta', $fields, true ) ) {
			$data['meta'] = $this-&gt;meta-&gt;get_value( $user-&gt;ID, $request );
		}

		$context = ! empty( $request['context'] ) ? $request['context'] : 'embed';

		$data = $this-&gt;add_additional_fields_to_object( $data, $request );
		$data = $this-&gt;filter_response_by_context( $data, $context );

		// Wrap the data in a response object.
		$response = rest_ensure_response( $data );

		if ( rest_is_field_included( '_links', $fields ) || rest_is_field_included( '_embedded', $fields ) ) {
			$response-&gt;add_links( $this-&gt;prepare_links( $user ) );
		}

		/**
		 * Filters user data returned from the REST API.
		 *
		 * @since 4.7.0
		 *
		 * @param WP_REST_Response $response The response object.
		 * @param WP_User          $user     User object used to create response.
		 * @param WP_REST_Request  $request  Request object.
		 */
		return apply_filters( 'rest_prepare_user', $response, $user, $request );
	}

	/**
	 * Prepares links for the user request.
	 *
	 * @since 4.7.0
	 *
	 * @param WP_User $user User object.
	 * @return array Links for the given user.
	 */
	protected function prepare_links( $user ) {
		$links = array(
			'self'       =&gt; array(
				'href' =&gt; rest_url( sprintf( '%s/%s/%d', $this-&gt;namespace, $this-&gt;rest_base, $user-&gt;ID ) ),
			),
			'collection' =&gt; array(
				'href' =&gt; rest_url( sprintf( '%s/%s', $this-&gt;namespace, $this-&gt;rest_base ) ),
			),
		);

		return $links;
	}

	/**
	 * Prepares a single user for creation or update.
	 *
	 * @since 4.7.0
	 *
	 * @param WP_REST_Request $request Request object.
	 * @return object User object.
	 */
	protected function prepare_item_for_database( $request ) {
		$prepared_user = new stdClass;

		$schema = $this-&gt;get_item_schema();

		// Required arguments.
		if ( isset( $request['email'] ) &amp;&amp; ! empty( $schema['properties']['email'] ) ) {
			$prepared_user-&gt;user_email = $request['email'];
		}

		if ( isset( $request['username'] ) &amp;&amp; ! empty( $schema['properties']['username'] ) ) {
			$prepared_user-&gt;user_login = $request['username'];
		}

		if ( isset( $request['password'] ) &amp;&amp; ! empty( $schema['properties']['password'] ) ) {
			$prepared_user-&gt;user_pass = $request['password'];
		}

		// Optional arguments.
		if ( isset( $request['id'] ) ) {
			$prepared_user-&gt;ID = absint( $request['id'] );
		}

		if ( isset( $request['name'] ) &amp;&amp; ! empty( $schema['properties']['name'] ) ) {
			$prepared_user-&gt;display_name = $request['name'];
		}

		if ( isset( $request['first_name'] ) &amp;&amp; ! empty( $schema['properties']['first_name'] ) ) {
			$prepared_user-&gt;first_name = $request['first_name'];
		}

		if ( isset( $request['last_name'] ) &amp;&amp; ! empty( $schema['properties']['last_name'] ) ) {
			$prepared_user-&gt;last_name = $request['last_name'];
		}

		if ( isset( $request['nickname'] ) &amp;&amp; ! empty( $schema['properties']['nickname'] ) ) {
			$prepared_user-&gt;nickname = $request['nickname'];
		}

		if ( isset( $request['slug'] ) &amp;&amp; ! empty( $schema['properties']['slug'] ) ) {
			$prepared_user-&gt;user_nicename = $request['slug'];
		}

		if ( isset( $request['description'] ) &amp;&amp; ! empty( $schema['properties']['description'] ) ) {
			$prepared_user-&gt;description = $request['description'];
		}

		if ( isset( $request['url'] ) &amp;&amp; ! empty( $schema['properties']['url'] ) ) {
			$prepared_user-&gt;user_url = $request['url'];
		}

		if ( isset( $request['locale'] ) &amp;&amp; ! empty( $schema['properties']['locale'] ) ) {
			$prepared_user-&gt;locale = $request['locale'];
		}

		// Setting roles will be handled outside of this function.
		if ( isset( $request['roles'] ) ) {
			$prepared_user-&gt;role = false;
		}

		/**
		 * Filters user data before insertion via the REST API.
		 *
		 * @since 4.7.0
		 *
		 * @param object          $prepared_user User object.
		 * @param WP_REST_Request $request       Request object.
		 */
		return apply_filters( 'rest_pre_insert_user', $prepared_user, $request );
	}

	/**
	 * Determines if the current user is allowed to make the desired roles change.
	 *
	 * @since 4.7.0
	 *
	 * @global WP_Roles $wp_roles WordPress role management object.
	 *
	 * @param int   $user_id User ID.
	 * @param array $roles   New user roles.
	 * @return true|WP_Error True if the current user is allowed to make the role change,
	 *                       otherwise a WP_Error object.
	 */
	protected function check_role_update( $user_id, $roles ) {
		global $wp_roles;

		foreach ( $roles as $role ) {

			if ( ! isset( $wp_roles-&gt;role_objects[ $role ] ) ) {
				return new WP_Error(
					'rest_user_invalid_role',
					/* translators: %s: Role key. */
					sprintf( __( 'The role %s does not exist.' ), $role ),
					array( 'status' =&gt; 400 )
				);
			}

			$potential_role = $wp_roles-&gt;role_objects[ $role ];

			/*
			 * Don't let anyone with 'edit_users' (admins) edit their own role to something without it.
			 * Multisite super admins can freely edit their blog roles -- they possess all caps.
			 */
			if ( ! ( is_multisite()
				&amp;&amp; current_user_can( 'manage_sites' ) )
				&amp;&amp; get_current_user_id() === $user_id
				&amp;&amp; ! $potential_role-&gt;has_cap( 'edit_users' )
			) {
				return new WP_Error(
					'rest_user_invalid_role',
					__( 'Sorry, you are not allowed to give users that role.' ),
					array( 'status' =&gt; rest_authorization_required_code() )
				);
			}

			// Include user admin functions to get access to get_editable_roles().
			require_once ABSPATH . 'wp-admin/includes/user.php';

			// The new role must be editable by the logged-in user.
			$editable_roles = get_editable_roles();

			if ( empty( $editable_roles[ $role ] ) ) {
				return new WP_Error(
					'rest_user_invalid_role',
					__( 'Sorry, you are not allowed to give users that role.' ),
					array( 'status' =&gt; 403 )
				);
			}
		}

		return true;
	}

	/**
	 * Check a username for the REST API.
	 *
	 * Performs a couple of checks like edit_user() in wp-admin/includes/user.php.
	 *
	 * @since 4.7.0
	 *
	 * @param string          $value   The username submitted in the request.
	 * @param WP_REST_Request $request Full details about the request.
	 * @param string          $param   The parameter name.
	 * @return string|WP_Error The sanitized username, if valid, otherwise an error.
	 */
	public function check_username( $value, $request, $param ) {
		$username = (string) $value;

		if ( ! validate_username( $username ) ) {
			return new WP_Error(
				'rest_user_invalid_username',
				__( 'This username is invalid because it uses illegal characters. Please enter a valid username.' ),
				array( 'status' =&gt; 400 )
			);
		}

		/** This filter is documented in wp-includes/user.php */
		$illegal_logins = (array) apply_filters( 'illegal_user_logins', array() );

		if ( in_array( strtolower( $username ), array_map( 'strtolower', $illegal_logins ), true ) ) {
			return new WP_Error(
				'rest_user_invalid_username',
				__( 'Sorry, that username is not allowed.' ),
				array( 'status' =&gt; 400 )
			);
		}

		return $username;
	}

	/**
	 * Check a user password for the REST API.
	 *
	 * Performs a couple of checks like edit_user() in wp-admin/includes/user.php.
	 *
	 * @since 4.7.0
	 *
	 * @param string          $value   The password submitted in the request.
	 * @param WP_REST_Request $request Full details about the request.
	 * @param string          $param   The parameter name.
	 * @return string|WP_Error The sanitized password, if valid, otherwise an error.
	 */
	public function check_user_password( $value, $request, $param ) {
		$password = (string) $value;

		if ( empty( $password ) ) {
			return new WP_Error(
				'rest_user_invalid_password',
				__( 'Passwords cannot be empty.' ),
				array( 'status' =&gt; 400 )
			);
		}

		if ( false !== strpos( $password, '\\' ) ) {
			return new WP_Error(
				'rest_user_invalid_password',
				sprintf(
					/* translators: %s: The '\' character. */
					__( 'Passwords cannot contain the "%s" character.' ),
					'\\'
				),
				array( 'status' =&gt; 400 )
			);
		}

		return $password;
	}

	/**
	 * Retrieves the user's schema, conforming to JSON Schema.
	 *
	 * @since 4.7.0
	 *
	 * @return array Item schema data.
	 */
	public function get_item_schema() {
		if ( $this-&gt;schema ) {
			return $this-&gt;add_additional_fields_schema( $this-&gt;schema );
		}

		$schema = array(
			'$schema'    =&gt; 'http://json-schema.org/draft-04/schema#',
			'title'      =&gt; 'user',
			'type'       =&gt; 'object',
			'properties' =&gt; array(
				'id'                 =&gt; array(
					'description' =&gt; __( 'Unique identifier for the user.' ),
					'type'        =&gt; 'integer',
					'context'     =&gt; array( 'embed', 'view', 'edit' ),
					'readonly'    =&gt; true,
				),
				'username'           =&gt; array(
					'description' =&gt; __( 'Login name for the user.' ),
					'type'        =&gt; 'string',
					'context'     =&gt; array( 'edit' ),
					'required'    =&gt; true,
					'arg_options' =&gt; array(
						'sanitize_callback' =&gt; array( $this, 'check_username' ),
					),
				),
				'name'               =&gt; array(
					'description' =&gt; __( 'Display name for the user.' ),
					'type'        =&gt; 'string',
					'context'     =&gt; array( 'embed', 'view', 'edit' ),
					'arg_options' =&gt; array(
						'sanitize_callback' =&gt; 'sanitize_text_field',
					),
				),
				'first_name'         =&gt; array(
					'description' =&gt; __( 'First name for the user.' ),
					'type'        =&gt; 'string',
					'context'     =&gt; array( 'edit' ),
					'arg_options' =&gt; array(
						'sanitize_callback' =&gt; 'sanitize_text_field',
					),
				),
				'last_name'          =&gt; array(
					'description' =&gt; __( 'Last name for the user.' ),
					'type'        =&gt; 'string',
					'context'     =&gt; array( 'edit' ),
					'arg_options' =&gt; array(
						'sanitize_callback' =&gt; 'sanitize_text_field',
					),
				),
				'email'              =&gt; array(
					'description' =&gt; __( 'The email address for the user.' ),
					'type'        =&gt; 'string',
					'format'      =&gt; 'email',
					'context'     =&gt; array( 'edit' ),
					'required'    =&gt; true,
				),
				'url'                =&gt; array(
					'description' =&gt; __( 'URL of the user.' ),
					'type'        =&gt; 'string',
					'format'      =&gt; 'uri',
					'context'     =&gt; array( 'embed', 'view', 'edit' ),
				),
				'description'        =&gt; array(
					'description' =&gt; __( 'Description of the user.' ),
					'type'        =&gt; 'string',
					'context'     =&gt; array( 'embed', 'view', 'edit' ),
				),
				'link'               =&gt; array(
					'description' =&gt; __( 'Author URL of the user.' ),
					'type'        =&gt; 'string',
					'format'      =&gt; 'uri',
					'context'     =&gt; array( 'embed', 'view', 'edit' ),
					'readonly'    =&gt; true,
				),
				'locale'             =&gt; array(
					'description' =&gt; __( 'Locale for the user.' ),
					'type'        =&gt; 'string',
					'enum'        =&gt; array_merge( array( '', 'en_US' ), get_available_languages() ),
					'context'     =&gt; array( 'edit' ),
				),
				'nickname'           =&gt; array(
					'description' =&gt; __( 'The nickname for the user.' ),
					'type'        =&gt; 'string',
					'context'     =&gt; array( 'edit' ),
					'arg_options' =&gt; array(
						'sanitize_callback' =&gt; 'sanitize_text_field',
					),
				),
				'slug'               =&gt; array(
					'description' =&gt; __( 'An alphanumeric identifier for the user.' ),
					'type'        =&gt; 'string',
					'context'     =&gt; array( 'embed', 'view', 'edit' ),
					'arg_options' =&gt; array(
						'sanitize_callback' =&gt; array( $this, 'sanitize_slug' ),
					),
				),
				'registered_date'    =&gt; array(
					'description' =&gt; __( 'Registration date for the user.' ),
					'type'        =&gt; 'string',
					'format'      =&gt; 'date-time',
					'context'     =&gt; array( 'edit' ),
					'readonly'    =&gt; true,
				),
				'roles'              =&gt; array(
					'description' =&gt; __( 'Roles assigned to the user.' ),
					'type'        =&gt; 'array',
					'items'       =&gt; array(
						'type' =&gt; 'string',
					),
					'context'     =&gt; array( 'edit' ),
				),
				'password'           =&gt; array(
					'description' =&gt; __( 'Password for the user (never included).' ),
					'type'        =&gt; 'string',
					'context'     =&gt; array(), // Password is never displayed.
					'required'    =&gt; true,
					'arg_options' =&gt; array(
						'sanitize_callback' =&gt; array( $this, 'check_user_password' ),
					),
				),
				'capabilities'       =&gt; array(
					'description' =&gt; __( 'All capabilities assigned to the user.' ),
					'type'        =&gt; 'object',
					'context'     =&gt; array( 'edit' ),
					'readonly'    =&gt; true,
				),
				'extra_capabilities' =&gt; array(
					'description' =&gt; __( 'Any extra capabilities assigned to the user.' ),
					'type'        =&gt; 'object',
					'context'     =&gt; array( 'edit' ),
					'readonly'    =&gt; true,
				),
			),
		);

		if ( get_option( 'show_avatars' ) ) {
			$avatar_properties = array();

			$avatar_sizes = rest_get_avatar_sizes();

			foreach ( $avatar_sizes as $size ) {
				$avatar_properties[ $size ] = array(
					/* translators: %d: Avatar image size in pixels. */
					'description' =&gt; sprintf( __( 'Avatar URL with image size of %d pixels.' ), $size ),
					'type'        =&gt; 'string',
					'format'      =&gt; 'uri',
					'context'     =&gt; array( 'embed', 'view', 'edit' ),
				);
			}

			$schema['properties']['avatar_urls'] = array(
				'description' =&gt; __( 'Avatar URLs for the user.' ),
				'type'        =&gt; 'object',
				'context'     =&gt; array( 'embed', 'view', 'edit' ),
				'readonly'    =&gt; true,
				'properties'  =&gt; $avatar_properties,
			);
		}

		$schema['properties']['meta'] = $this-&gt;meta-&gt;get_field_schema();

		$this-&gt;schema = $schema;

		return $this-&gt;add_additional_fields_schema( $this-&gt;schema );
	}

	/**
	 * Retrieves the query params for collections.
	 *
	 * @since 4.7.0
	 *
	 * @return array Collection parameters.
	 */
	public function get_collection_params() {
		$query_params = parent::get_collection_params();

		$query_params['context']['default'] = 'view';

		$query_params['exclude'] = array(
			'description' =&gt; __( 'Ensure result set excludes specific IDs.' ),
			'type'        =&gt; 'array',
			'items'       =&gt; array(
				'type' =&gt; 'integer',
			),
			'default'     =&gt; array(),
		);

		$query_params['include'] = array(
			'description' =&gt; __( 'Limit result set to specific IDs.' ),
			'type'        =&gt; 'array',
			'items'       =&gt; array(
				'type' =&gt; 'integer',
			),
			'default'     =&gt; array(),
		);

		$query_params['offset'] = array(
			'description' =&gt; __( 'Offset the result set by a specific number of items.' ),
			'type'        =&gt; 'integer',
		);

		$query_params['order'] = array(
			'default'     =&gt; 'asc',
			'description' =&gt; __( 'Order sort attribute ascending or descending.' ),
			'enum'        =&gt; array( 'asc', 'desc' ),
			'type'        =&gt; 'string',
		);

		$query_params['orderby'] = array(
			'default'     =&gt; 'name',
			'description' =&gt; __( 'Sort collection by user attribute.' ),
			'enum'        =&gt; array(
				'id',
				'include',
				'name',
				'registered_date',
				'slug',
				'include_slugs',
				'email',
				'url',
			),
			'type'        =&gt; 'string',
		);

		$query_params['slug'] = array(
			'description' =&gt; __( 'Limit result set to users with one or more specific slugs.' ),
			'type'        =&gt; 'array',
			'items'       =&gt; array(
				'type' =&gt; 'string',
			),
		);

		$query_params['roles'] = array(
			'description' =&gt; __( 'Limit result set to users matching at least one specific role provided. Accepts csv list or single role.' ),
			'type'        =&gt; 'array',
			'items'       =&gt; array(
				'type' =&gt; 'string',
			),
		);

		$query_params['capabilities'] = array(
			'description' =&gt; __( 'Limit result set to users matching at least one specific capability provided. Accepts csv list or single capability.' ),
			'type'        =&gt; 'array',
			'items'       =&gt; array(
				'type' =&gt; 'string',
			),
		);

		$query_params['who'] = array(
			'description' =&gt; __( 'Limit result set to users who are considered authors.' ),
			'type'        =&gt; 'string',
			'enum'        =&gt; array(
				'authors',
			),
		);

		$query_params['has_published_posts'] = array(
			'description' =&gt; __( 'Limit result set to users who have published posts.' ),
			'type'        =&gt; array( 'boolean', 'array' ),
			'items'       =&gt; array(
				'type' =&gt; 'string',
				'enum' =&gt; get_post_types( array( 'show_in_rest' =&gt; true ), 'names' ),
			),
		);

		/**
		 * Filters REST API collection parameters for the users controller.
		 *
		 * This filter registers the collection parameter, but does not map the
		 * collection parameter to an internal WP_User_Query parameter.  Use the
		 * `rest_user_query` filter to set WP_User_Query arguments.
		 *
		 * @since 4.7.0
		 *
		 * @param array $query_params JSON Schema-formatted collection parameters.
		 */
		return apply_filters( 'rest_user_collection_params', $query_params );
	}
}
</code></pre>  </section>  <section> <header class="toc-header"><h2 id="related">Related</h2></header> <article class="uses"> <header class="toc-header"><h3 id="uses">Uses</h3></header> <table id="uses-table" data-show="2">  <thead> <tr> <th>Uses</th> <th class="related-desc">Description</th> </tr> </thead> <tbody> <tr> <td class="related-title"> <a href="wp_rest_controller.html">WP_REST_Controller</a> <span>wp-includes/rest-api/endpoints/class-wp-rest-controller.php</span> </td> <td class="related-desc"> <p>Core base controller for managing and interacting with REST API items.</p> </td> </tr> </tbody>

</table> </article> </section>  <section> <header class="toc-header"><h2 id="changelog">Changelog</h2></header> <table>  <thead> <tr> <th class="changelog-version">Version</th> <th class="changelog-desc">Description</th> </tr> </thead> <tbody> <tr> <td><a href="https://developer.wordpress.org/reference/since/4.7.0/" alt="WordPress 4.7.0">4.7.0</a></td> <td>Introduced.</td> </tr> </tbody> </table> </section><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2003&ndash;2022 WordPress Foundation<br>Licensed under the GNU GPLv2+ License.<br>
    <a href="https://developer.wordpress.org/reference/classes/wp_rest_users_controller" class="_attribution-link">https://developer.wordpress.org/reference/classes/wp_rest_users_controller</a>
  </p>
</div>
