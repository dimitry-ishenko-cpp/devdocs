<h1 class="wp-block-wporg-code-reference-title">WP_Query::get_posts(): <span class="return-type"><a href="../wp_post.html" rel="class">WP_Post</a>[]|int[]</span>
</h1> <section><p>Retrieves an array of posts based on query variables.</p> </section> <section><h2 id="description">Description</h2> <p>There are a few filters and actions that can be used to modify the post database query.</p> </section> <section><h2 id="return">Return</h2> <span class="return-type"><a href="../wp_post.html" rel="class">WP_Post</a>[]|int[]</span> Array of post objects or post IDs.</section> <section><h2 id="source">Source</h2> <pre class="wp-block-code" data-start="1865" aria-label="Function source code" data-language="php"><code id="wporg-source-code" lang="php" class="language-php line-numbers">public function get_posts() {
	global $wpdb;

	$this-&gt;parse_query();

	/**
	 * Fires after the query variable object is created, but before the actual query is run.
	 *
	 * Note: If using conditional tags, use the method versions within the passed instance
	 * (e.g. $this-&gt;is_main_query() instead of is_main_query()). This is because the functions
	 * like is_main_query() test against the global $wp_query instance, not the passed one.
	 *
	 * @since 2.0.0
	 *
	 * @param WP_Query $query The WP_Query instance (passed by reference).
	 */
	do_action_ref_array( 'pre_get_posts', array( &amp;$this ) );

	// Shorthand.
	$q = &amp;$this-&gt;query_vars;

	// Fill again in case 'pre_get_posts' unset some vars.
	$q = $this-&gt;fill_query_vars( $q );

	/**
	 * Filters whether an attachment query should include filenames or not.
	 *
	 * @since 6.0.3
	 *
	 * @param bool $allow_query_attachment_by_filename Whether or not to include filenames.
	 */
	$this-&gt;allow_query_attachment_by_filename = apply_filters( 'wp_allow_query_attachment_by_filename', false );
	remove_all_filters( 'wp_allow_query_attachment_by_filename' );

	// Parse meta query.
	$this-&gt;meta_query = new WP_Meta_Query();
	$this-&gt;meta_query-&gt;parse_query_vars( $q );

	// Set a flag if a 'pre_get_posts' hook changed the query vars.
	$hash = md5( serialize( $this-&gt;query_vars ) );
	if ( $hash != $this-&gt;query_vars_hash ) {
		$this-&gt;query_vars_changed = true;
		$this-&gt;query_vars_hash    = $hash;
	}
	unset( $hash );

	// First let's clear some variables.
	$distinct         = '';
	$whichauthor      = '';
	$whichmimetype    = '';
	$where            = '';
	$limits           = '';
	$join             = '';
	$search           = '';
	$groupby          = '';
	$post_status_join = false;
	$page             = 1;

	if ( isset( $q['caller_get_posts'] ) ) {
		_deprecated_argument(
			'WP_Query',
			'3.1.0',
			sprintf(
				/* translators: 1: caller_get_posts, 2: ignore_sticky_posts */
				__( '%1$s is deprecated. Use %2$s instead.' ),
				'&lt;code&gt;caller_get_posts&lt;/code&gt;',
				'&lt;code&gt;ignore_sticky_posts&lt;/code&gt;'
			)
		);

		if ( ! isset( $q['ignore_sticky_posts'] ) ) {
			$q['ignore_sticky_posts'] = $q['caller_get_posts'];
		}
	}

	if ( ! isset( $q['ignore_sticky_posts'] ) ) {
		$q['ignore_sticky_posts'] = false;
	}

	if ( ! isset( $q['suppress_filters'] ) ) {
		$q['suppress_filters'] = false;
	}

	if ( ! isset( $q['cache_results'] ) ) {
		$q['cache_results'] = true;
	}

	if ( ! isset( $q['update_post_term_cache'] ) ) {
		$q['update_post_term_cache'] = true;
	}

	if ( ! isset( $q['update_menu_item_cache'] ) ) {
		$q['update_menu_item_cache'] = false;
	}

	if ( ! isset( $q['lazy_load_term_meta'] ) ) {
		$q['lazy_load_term_meta'] = $q['update_post_term_cache'];
	} elseif ( $q['lazy_load_term_meta'] ) { // Lazy loading term meta only works if term caches are primed.
		$q['update_post_term_cache'] = true;
	}

	if ( ! isset( $q['update_post_meta_cache'] ) ) {
		$q['update_post_meta_cache'] = true;
	}

	if ( ! isset( $q['post_type'] ) ) {
		if ( $this-&gt;is_search ) {
			$q['post_type'] = 'any';
		} else {
			$q['post_type'] = '';
		}
	}
	$post_type = $q['post_type'];
	if ( empty( $q['posts_per_page'] ) ) {
		$q['posts_per_page'] = get_option( 'posts_per_page' );
	}
	if ( isset( $q['showposts'] ) &amp;&amp; $q['showposts'] ) {
		$q['showposts']      = (int) $q['showposts'];
		$q['posts_per_page'] = $q['showposts'];
	}
	if ( ( isset( $q['posts_per_archive_page'] ) &amp;&amp; 0 != $q['posts_per_archive_page'] ) &amp;&amp; ( $this-&gt;is_archive || $this-&gt;is_search ) ) {
		$q['posts_per_page'] = $q['posts_per_archive_page'];
	}
	if ( ! isset( $q['nopaging'] ) ) {
		if ( -1 == $q['posts_per_page'] ) {
			$q['nopaging'] = true;
		} else {
			$q['nopaging'] = false;
		}
	}

	if ( $this-&gt;is_feed ) {
		// This overrides 'posts_per_page'.
		if ( ! empty( $q['posts_per_rss'] ) ) {
			$q['posts_per_page'] = $q['posts_per_rss'];
		} else {
			$q['posts_per_page'] = get_option( 'posts_per_rss' );
		}
		$q['nopaging'] = false;
	}
	$q['posts_per_page'] = (int) $q['posts_per_page'];
	if ( $q['posts_per_page'] &lt; -1 ) {
		$q['posts_per_page'] = abs( $q['posts_per_page'] );
	} elseif ( 0 == $q['posts_per_page'] ) {
		$q['posts_per_page'] = 1;
	}

	if ( ! isset( $q['comments_per_page'] ) || 0 == $q['comments_per_page'] ) {
		$q['comments_per_page'] = get_option( 'comments_per_page' );
	}

	if ( $this-&gt;is_home &amp;&amp; ( empty( $this-&gt;query ) || 'true' === $q['preview'] ) &amp;&amp; ( 'page' === get_option( 'show_on_front' ) ) &amp;&amp; get_option( 'page_on_front' ) ) {
		$this-&gt;is_page = true;
		$this-&gt;is_home = false;
		$q['page_id']  = get_option( 'page_on_front' );
	}

	if ( isset( $q['page'] ) ) {
		$q['page'] = is_scalar( $q['page'] ) ? absint( trim( $q['page'], '/' ) ) : 0;
	}

	// If true, forcibly turns off SQL_CALC_FOUND_ROWS even when limits are present.
	if ( isset( $q['no_found_rows'] ) ) {
		$q['no_found_rows'] = (bool) $q['no_found_rows'];
	} else {
		$q['no_found_rows'] = false;
	}

	switch ( $q['fields'] ) {
		case 'ids':
			$fields = "{$wpdb-&gt;posts}.ID";
			break;
		case 'id=&gt;parent':
			$fields = "{$wpdb-&gt;posts}.ID, {$wpdb-&gt;posts}.post_parent";
			break;
		default:
			$fields = "{$wpdb-&gt;posts}.*";
	}

	if ( '' !== $q['menu_order'] ) {
		$where .= " AND {$wpdb-&gt;posts}.menu_order = " . $q['menu_order'];
	}
	// The "m" parameter is meant for months but accepts datetimes of varying specificity.
	if ( $q['m'] ) {
		$where .= " AND YEAR({$wpdb-&gt;posts}.post_date)=" . substr( $q['m'], 0, 4 );
		if ( strlen( $q['m'] ) &gt; 5 ) {
			$where .= " AND MONTH({$wpdb-&gt;posts}.post_date)=" . substr( $q['m'], 4, 2 );
		}
		if ( strlen( $q['m'] ) &gt; 7 ) {
			$where .= " AND DAYOFMONTH({$wpdb-&gt;posts}.post_date)=" . substr( $q['m'], 6, 2 );
		}
		if ( strlen( $q['m'] ) &gt; 9 ) {
			$where .= " AND HOUR({$wpdb-&gt;posts}.post_date)=" . substr( $q['m'], 8, 2 );
		}
		if ( strlen( $q['m'] ) &gt; 11 ) {
			$where .= " AND MINUTE({$wpdb-&gt;posts}.post_date)=" . substr( $q['m'], 10, 2 );
		}
		if ( strlen( $q['m'] ) &gt; 13 ) {
			$where .= " AND SECOND({$wpdb-&gt;posts}.post_date)=" . substr( $q['m'], 12, 2 );
		}
	}

	// Handle the other individual date parameters.
	$date_parameters = array();

	if ( '' !== $q['hour'] ) {
		$date_parameters['hour'] = $q['hour'];
	}

	if ( '' !== $q['minute'] ) {
		$date_parameters['minute'] = $q['minute'];
	}

	if ( '' !== $q['second'] ) {
		$date_parameters['second'] = $q['second'];
	}

	if ( $q['year'] ) {
		$date_parameters['year'] = $q['year'];
	}

	if ( $q['monthnum'] ) {
		$date_parameters['monthnum'] = $q['monthnum'];
	}

	if ( $q['w'] ) {
		$date_parameters['week'] = $q['w'];
	}

	if ( $q['day'] ) {
		$date_parameters['day'] = $q['day'];
	}

	if ( $date_parameters ) {
		$date_query = new WP_Date_Query( array( $date_parameters ) );
		$where     .= $date_query-&gt;get_sql();
	}
	unset( $date_parameters, $date_query );

	// Handle complex date queries.
	if ( ! empty( $q['date_query'] ) ) {
		$this-&gt;date_query = new WP_Date_Query( $q['date_query'] );
		$where           .= $this-&gt;date_query-&gt;get_sql();
	}

	// If we've got a post_type AND it's not "any" post_type.
	if ( ! empty( $q['post_type'] ) &amp;&amp; 'any' !== $q['post_type'] ) {
		foreach ( (array) $q['post_type'] as $_post_type ) {
			$ptype_obj = get_post_type_object( $_post_type );
			if ( ! $ptype_obj || ! $ptype_obj-&gt;query_var || empty( $q[ $ptype_obj-&gt;query_var ] ) ) {
				continue;
			}

			if ( ! $ptype_obj-&gt;hierarchical ) {
				// Non-hierarchical post types can directly use 'name'.
				$q['name'] = $q[ $ptype_obj-&gt;query_var ];
			} else {
				// Hierarchical post types will operate through 'pagename'.
				$q['pagename'] = $q[ $ptype_obj-&gt;query_var ];
				$q['name']     = '';
			}

			// Only one request for a slug is possible, this is why name &amp; pagename are overwritten above.
			break;
		} // End foreach.
		unset( $ptype_obj );
	}

	if ( '' !== $q['title'] ) {
		$where .= $wpdb-&gt;prepare( " AND {$wpdb-&gt;posts}.post_title = %s", stripslashes( $q['title'] ) );
	}

	// Parameters related to 'post_name'.
	if ( '' !== $q['name'] ) {
		$q['name'] = sanitize_title_for_query( $q['name'] );
		$where    .= " AND {$wpdb-&gt;posts}.post_name = '" . $q['name'] . "'";
	} elseif ( '' !== $q['pagename'] ) {
		if ( isset( $this-&gt;queried_object_id ) ) {
			$reqpage = $this-&gt;queried_object_id;
		} else {
			if ( 'page' !== $q['post_type'] ) {
				foreach ( (array) $q['post_type'] as $_post_type ) {
					$ptype_obj = get_post_type_object( $_post_type );
					if ( ! $ptype_obj || ! $ptype_obj-&gt;hierarchical ) {
						continue;
					}

					$reqpage = get_page_by_path( $q['pagename'], OBJECT, $_post_type );
					if ( $reqpage ) {
						break;
					}
				}
				unset( $ptype_obj );
			} else {
				$reqpage = get_page_by_path( $q['pagename'] );
			}
			if ( ! empty( $reqpage ) ) {
				$reqpage = $reqpage-&gt;ID;
			} else {
				$reqpage = 0;
			}
		}

		$page_for_posts = get_option( 'page_for_posts' );
		if ( ( 'page' !== get_option( 'show_on_front' ) ) || empty( $page_for_posts ) || ( $reqpage != $page_for_posts ) ) {
			$q['pagename'] = sanitize_title_for_query( wp_basename( $q['pagename'] ) );
			$q['name']     = $q['pagename'];
			$where        .= " AND ({$wpdb-&gt;posts}.ID = '$reqpage')";
			$reqpage_obj   = get_post( $reqpage );
			if ( is_object( $reqpage_obj ) &amp;&amp; 'attachment' === $reqpage_obj-&gt;post_type ) {
				$this-&gt;is_attachment = true;
				$post_type           = 'attachment';
				$q['post_type']      = 'attachment';
				$this-&gt;is_page       = true;
				$q['attachment_id']  = $reqpage;
			}
		}
	} elseif ( '' !== $q['attachment'] ) {
		$q['attachment'] = sanitize_title_for_query( wp_basename( $q['attachment'] ) );
		$q['name']       = $q['attachment'];
		$where          .= " AND {$wpdb-&gt;posts}.post_name = '" . $q['attachment'] . "'";
	} elseif ( is_array( $q['post_name__in'] ) &amp;&amp; ! empty( $q['post_name__in'] ) ) {
		$q['post_name__in'] = array_map( 'sanitize_title_for_query', $q['post_name__in'] );
		$post_name__in      = "'" . implode( "','", $q['post_name__in'] ) . "'";
		$where             .= " AND {$wpdb-&gt;posts}.post_name IN ($post_name__in)";
	}

	// If an attachment is requested by number, let it supersede any post number.
	if ( $q['attachment_id'] ) {
		$q['p'] = absint( $q['attachment_id'] );
	}

	// If a post number is specified, load that post.
	if ( $q['p'] ) {
		$where .= " AND {$wpdb-&gt;posts}.ID = " . $q['p'];
	} elseif ( $q['post__in'] ) {
		$post__in = implode( ',', array_map( 'absint', $q['post__in'] ) );
		$where   .= " AND {$wpdb-&gt;posts}.ID IN ($post__in)";
	} elseif ( $q['post__not_in'] ) {
		$post__not_in = implode( ',', array_map( 'absint', $q['post__not_in'] ) );
		$where       .= " AND {$wpdb-&gt;posts}.ID NOT IN ($post__not_in)";
	}

	if ( is_numeric( $q['post_parent'] ) ) {
		$where .= $wpdb-&gt;prepare( " AND {$wpdb-&gt;posts}.post_parent = %d ", $q['post_parent'] );
	} elseif ( $q['post_parent__in'] ) {
		$post_parent__in = implode( ',', array_map( 'absint', $q['post_parent__in'] ) );
		$where          .= " AND {$wpdb-&gt;posts}.post_parent IN ($post_parent__in)";
	} elseif ( $q['post_parent__not_in'] ) {
		$post_parent__not_in = implode( ',', array_map( 'absint', $q['post_parent__not_in'] ) );
		$where              .= " AND {$wpdb-&gt;posts}.post_parent NOT IN ($post_parent__not_in)";
	}

	if ( $q['page_id'] ) {
		if ( ( 'page' !== get_option( 'show_on_front' ) ) || ( get_option( 'page_for_posts' ) != $q['page_id'] ) ) {
			$q['p'] = $q['page_id'];
			$where  = " AND {$wpdb-&gt;posts}.ID = " . $q['page_id'];
		}
	}

	// If a search pattern is specified, load the posts that match.
	if ( strlen( $q['s'] ) ) {
		$search = $this-&gt;parse_search( $q );
	}

	if ( ! $q['suppress_filters'] ) {
		/**
		 * Filters the search SQL that is used in the WHERE clause of WP_Query.
		 *
		 * @since 3.0.0
		 *
		 * @param string   $search Search SQL for WHERE clause.
		 * @param WP_Query $query  The current WP_Query object.
		 */
		$search = apply_filters_ref_array( 'posts_search', array( $search, &amp;$this ) );
	}

	// Taxonomies.
	if ( ! $this-&gt;is_singular ) {
		$this-&gt;parse_tax_query( $q );

		$clauses = $this-&gt;tax_query-&gt;get_sql( $wpdb-&gt;posts, 'ID' );

		$join  .= $clauses['join'];
		$where .= $clauses['where'];
	}

	if ( $this-&gt;is_tax ) {
		if ( empty( $post_type ) ) {
			// Do a fully inclusive search for currently registered post types of queried taxonomies.
			$post_type  = array();
			$taxonomies = array_keys( $this-&gt;tax_query-&gt;queried_terms );
			foreach ( get_post_types( array( 'exclude_from_search' =&gt; false ) ) as $pt ) {
				$object_taxonomies = 'attachment' === $pt ? get_taxonomies_for_attachments() : get_object_taxonomies( $pt );
				if ( array_intersect( $taxonomies, $object_taxonomies ) ) {
					$post_type[] = $pt;
				}
			}
			if ( ! $post_type ) {
				$post_type = 'any';
			} elseif ( count( $post_type ) === 1 ) {
				$post_type = $post_type[0];
			} else {
				// Sort post types to ensure same cache key generation.
				sort( $post_type );
			}

			$post_status_join = true;
		} elseif ( in_array( 'attachment', (array) $post_type, true ) ) {
			$post_status_join = true;
		}
	}

	/*
	 * Ensure that 'taxonomy', 'term', 'term_id', 'cat', and
	 * 'category_name' vars are set for backward compatibility.
	 */
	if ( ! empty( $this-&gt;tax_query-&gt;queried_terms ) ) {

		/*
		 * Set 'taxonomy', 'term', and 'term_id' to the
		 * first taxonomy other than 'post_tag' or 'category'.
		 */
		if ( ! isset( $q['taxonomy'] ) ) {
			foreach ( $this-&gt;tax_query-&gt;queried_terms as $queried_taxonomy =&gt; $queried_items ) {
				if ( empty( $queried_items['terms'][0] ) ) {
					continue;
				}

				if ( ! in_array( $queried_taxonomy, array( 'category', 'post_tag' ), true ) ) {
					$q['taxonomy'] = $queried_taxonomy;

					if ( 'slug' === $queried_items['field'] ) {
						$q['term'] = $queried_items['terms'][0];
					} else {
						$q['term_id'] = $queried_items['terms'][0];
					}

					// Take the first one we find.
					break;
				}
			}
		}

		// 'cat', 'category_name', 'tag_id'.
		foreach ( $this-&gt;tax_query-&gt;queried_terms as $queried_taxonomy =&gt; $queried_items ) {
			if ( empty( $queried_items['terms'][0] ) ) {
				continue;
			}

			if ( 'category' === $queried_taxonomy ) {
				$the_cat = get_term_by( $queried_items['field'], $queried_items['terms'][0], 'category' );
				if ( $the_cat ) {
					$this-&gt;set( 'cat', $the_cat-&gt;term_id );
					$this-&gt;set( 'category_name', $the_cat-&gt;slug );
				}
				unset( $the_cat );
			}

			if ( 'post_tag' === $queried_taxonomy ) {
				$the_tag = get_term_by( $queried_items['field'], $queried_items['terms'][0], 'post_tag' );
				if ( $the_tag ) {
					$this-&gt;set( 'tag_id', $the_tag-&gt;term_id );
				}
				unset( $the_tag );
			}
		}
	}

	if ( ! empty( $this-&gt;tax_query-&gt;queries ) || ! empty( $this-&gt;meta_query-&gt;queries ) || ! empty( $this-&gt;allow_query_attachment_by_filename ) ) {
		$groupby = "{$wpdb-&gt;posts}.ID";
	}

	// Author/user stuff.

	if ( ! empty( $q['author'] ) &amp;&amp; '0' != $q['author'] ) {
		$q['author'] = addslashes_gpc( '' . urldecode( $q['author'] ) );
		$authors     = array_unique( array_map( 'intval', preg_split( '/[,\s]+/', $q['author'] ) ) );
		foreach ( $authors as $author ) {
			$key         = $author &gt; 0 ? 'author__in' : 'author__not_in';
			$q[ $key ][] = abs( $author );
		}
		$q['author'] = implode( ',', $authors );
	}

	if ( ! empty( $q['author__not_in'] ) ) {
		$author__not_in = implode( ',', array_map( 'absint', array_unique( (array) $q['author__not_in'] ) ) );
		$where         .= " AND {$wpdb-&gt;posts}.post_author NOT IN ($author__not_in) ";
	} elseif ( ! empty( $q['author__in'] ) ) {
		$author__in = implode( ',', array_map( 'absint', array_unique( (array) $q['author__in'] ) ) );
		$where     .= " AND {$wpdb-&gt;posts}.post_author IN ($author__in) ";
	}

	// Author stuff for nice URLs.

	if ( '' !== $q['author_name'] ) {
		if ( str_contains( $q['author_name'], '/' ) ) {
			$q['author_name'] = explode( '/', $q['author_name'] );
			if ( $q['author_name'][ count( $q['author_name'] ) - 1 ] ) {
				$q['author_name'] = $q['author_name'][ count( $q['author_name'] ) - 1 ]; // No trailing slash.
			} else {
				$q['author_name'] = $q['author_name'][ count( $q['author_name'] ) - 2 ]; // There was a trailing slash.
			}
		}
		$q['author_name'] = sanitize_title_for_query( $q['author_name'] );
		$q['author']      = get_user_by( 'slug', $q['author_name'] );
		if ( $q['author'] ) {
			$q['author'] = $q['author']-&gt;ID;
		}
		$whichauthor .= " AND ({$wpdb-&gt;posts}.post_author = " . absint( $q['author'] ) . ')';
	}

	// Matching by comment count.
	if ( isset( $q['comment_count'] ) ) {
		// Numeric comment count is converted to array format.
		if ( is_numeric( $q['comment_count'] ) ) {
			$q['comment_count'] = array(
				'value' =&gt; (int) $q['comment_count'],
			);
		}

		if ( isset( $q['comment_count']['value'] ) ) {
			$q['comment_count'] = array_merge(
				array(
					'compare' =&gt; '=',
				),
				$q['comment_count']
			);

			// Fallback for invalid compare operators is '='.
			$compare_operators = array( '=', '!=', '&gt;', '&gt;=', '&lt;', '&lt;=' );
			if ( ! in_array( $q['comment_count']['compare'], $compare_operators, true ) ) {
				$q['comment_count']['compare'] = '=';
			}

			$where .= $wpdb-&gt;prepare( " AND {$wpdb-&gt;posts}.comment_count {$q['comment_count']['compare']} %d", $q['comment_count']['value'] );
		}
	}

	// MIME-Type stuff for attachment browsing.

	if ( isset( $q['post_mime_type'] ) &amp;&amp; '' !== $q['post_mime_type'] ) {
		$whichmimetype = wp_post_mime_type_where( $q['post_mime_type'], $wpdb-&gt;posts );
	}
	$where .= $search . $whichauthor . $whichmimetype;

	if ( ! empty( $this-&gt;allow_query_attachment_by_filename ) ) {
		$join .= " LEFT JOIN {$wpdb-&gt;postmeta} AS sq1 ON ( {$wpdb-&gt;posts}.ID = sq1.post_id AND sq1.meta_key = '_wp_attached_file' )";
	}

	if ( ! empty( $this-&gt;meta_query-&gt;queries ) ) {
		$clauses = $this-&gt;meta_query-&gt;get_sql( 'post', $wpdb-&gt;posts, 'ID', $this );
		$join   .= $clauses['join'];
		$where  .= $clauses['where'];
	}

	$rand = ( isset( $q['orderby'] ) &amp;&amp; 'rand' === $q['orderby'] );
	if ( ! isset( $q['order'] ) ) {
		$q['order'] = $rand ? '' : 'DESC';
	} else {
		$q['order'] = $rand ? '' : $this-&gt;parse_order( $q['order'] );
	}

	// These values of orderby should ignore the 'order' parameter.
	$force_asc = array( 'post__in', 'post_name__in', 'post_parent__in' );
	if ( isset( $q['orderby'] ) &amp;&amp; in_array( $q['orderby'], $force_asc, true ) ) {
		$q['order'] = '';
	}

	// Order by.
	if ( empty( $q['orderby'] ) ) {
		/*
		 * Boolean false or empty array blanks out ORDER BY,
		 * while leaving the value unset or otherwise empty sets the default.
		 */
		if ( isset( $q['orderby'] ) &amp;&amp; ( is_array( $q['orderby'] ) || false === $q['orderby'] ) ) {
			$orderby = '';
		} else {
			$orderby = "{$wpdb-&gt;posts}.post_date " . $q['order'];
		}
	} elseif ( 'none' === $q['orderby'] ) {
		$orderby = '';
	} else {
		$orderby_array = array();
		if ( is_array( $q['orderby'] ) ) {
			foreach ( $q['orderby'] as $_orderby =&gt; $order ) {
				$orderby = addslashes_gpc( urldecode( $_orderby ) );
				$parsed  = $this-&gt;parse_orderby( $orderby );

				if ( ! $parsed ) {
					continue;
				}

				$orderby_array[] = $parsed . ' ' . $this-&gt;parse_order( $order );
			}
			$orderby = implode( ', ', $orderby_array );

		} else {
			$q['orderby'] = urldecode( $q['orderby'] );
			$q['orderby'] = addslashes_gpc( $q['orderby'] );

			foreach ( explode( ' ', $q['orderby'] ) as $i =&gt; $orderby ) {
				$parsed = $this-&gt;parse_orderby( $orderby );
				// Only allow certain values for safety.
				if ( ! $parsed ) {
					continue;
				}

				$orderby_array[] = $parsed;
			}
			$orderby = implode( ' ' . $q['order'] . ', ', $orderby_array );

			if ( empty( $orderby ) ) {
				$orderby = "{$wpdb-&gt;posts}.post_date " . $q['order'];
			} elseif ( ! empty( $q['order'] ) ) {
				$orderby .= " {$q['order']}";
			}
		}
	}

	// Order search results by relevance only when another "orderby" is not specified in the query.
	if ( ! empty( $q['s'] ) ) {
		$search_orderby = '';
		if ( ! empty( $q['search_orderby_title'] ) &amp;&amp; ( empty( $q['orderby'] ) &amp;&amp; ! $this-&gt;is_feed ) || ( isset( $q['orderby'] ) &amp;&amp; 'relevance' === $q['orderby'] ) ) {
			$search_orderby = $this-&gt;parse_search_order( $q );
		}

		if ( ! $q['suppress_filters'] ) {
			/**
			 * Filters the ORDER BY used when ordering search results.
			 *
			 * @since 3.7.0
			 *
			 * @param string   $search_orderby The ORDER BY clause.
			 * @param WP_Query $query          The current WP_Query instance.
			 */
			$search_orderby = apply_filters( 'posts_search_orderby', $search_orderby, $this );
		}

		if ( $search_orderby ) {
			$orderby = $orderby ? $search_orderby . ', ' . $orderby : $search_orderby;
		}
	}

	if ( is_array( $post_type ) &amp;&amp; count( $post_type ) &gt; 1 ) {
		$post_type_cap = 'multiple_post_type';
	} else {
		if ( is_array( $post_type ) ) {
			$post_type = reset( $post_type );
		}
		$post_type_object = get_post_type_object( $post_type );
		if ( empty( $post_type_object ) ) {
			$post_type_cap = $post_type;
		}
	}

	if ( isset( $q['post_password'] ) ) {
		$where .= $wpdb-&gt;prepare( " AND {$wpdb-&gt;posts}.post_password = %s", $q['post_password'] );
		if ( empty( $q['perm'] ) ) {
			$q['perm'] = 'readable';
		}
	} elseif ( isset( $q['has_password'] ) ) {
		$where .= sprintf( " AND {$wpdb-&gt;posts}.post_password %s ''", $q['has_password'] ? '!=' : '=' );
	}

	if ( ! empty( $q['comment_status'] ) ) {
		$where .= $wpdb-&gt;prepare( " AND {$wpdb-&gt;posts}.comment_status = %s ", $q['comment_status'] );
	}

	if ( ! empty( $q['ping_status'] ) ) {
		$where .= $wpdb-&gt;prepare( " AND {$wpdb-&gt;posts}.ping_status = %s ", $q['ping_status'] );
	}

	$skip_post_status = false;
	if ( 'any' === $post_type ) {
		$in_search_post_types = get_post_types( array( 'exclude_from_search' =&gt; false ) );
		if ( empty( $in_search_post_types ) ) {
			$post_type_where  = ' AND 1=0 ';
			$skip_post_status = true;
		} else {
			$post_type_where = " AND {$wpdb-&gt;posts}.post_type IN ('" . implode( "', '", array_map( 'esc_sql', $in_search_post_types ) ) . "')";
		}
	} elseif ( ! empty( $post_type ) &amp;&amp; is_array( $post_type ) ) {
		// Sort post types to ensure same cache key generation.
		sort( $post_type );
		$post_type_where = " AND {$wpdb-&gt;posts}.post_type IN ('" . implode( "', '", esc_sql( $post_type ) ) . "')";
	} elseif ( ! empty( $post_type ) ) {
		$post_type_where  = $wpdb-&gt;prepare( " AND {$wpdb-&gt;posts}.post_type = %s", $post_type );
		$post_type_object = get_post_type_object( $post_type );
	} elseif ( $this-&gt;is_attachment ) {
		$post_type_where  = " AND {$wpdb-&gt;posts}.post_type = 'attachment'";
		$post_type_object = get_post_type_object( 'attachment' );
	} elseif ( $this-&gt;is_page ) {
		$post_type_where  = " AND {$wpdb-&gt;posts}.post_type = 'page'";
		$post_type_object = get_post_type_object( 'page' );
	} else {
		$post_type_where  = " AND {$wpdb-&gt;posts}.post_type = 'post'";
		$post_type_object = get_post_type_object( 'post' );
	}

	$edit_cap = 'edit_post';
	$read_cap = 'read_post';

	if ( ! empty( $post_type_object ) ) {
		$edit_others_cap  = $post_type_object-&gt;cap-&gt;edit_others_posts;
		$read_private_cap = $post_type_object-&gt;cap-&gt;read_private_posts;
	} else {
		$edit_others_cap  = 'edit_others_' . $post_type_cap . 's';
		$read_private_cap = 'read_private_' . $post_type_cap . 's';
	}

	$user_id = get_current_user_id();

	$q_status = array();
	if ( $skip_post_status ) {
		$where .= $post_type_where;
	} elseif ( ! empty( $q['post_status'] ) ) {

		$where .= $post_type_where;

		$statuswheres = array();
		$q_status     = $q['post_status'];
		if ( ! is_array( $q_status ) ) {
			$q_status = explode( ',', $q_status );
		}
		$r_status = array();
		$p_status = array();
		$e_status = array();
		if ( in_array( 'any', $q_status, true ) ) {
			foreach ( get_post_stati( array( 'exclude_from_search' =&gt; true ) ) as $status ) {
				if ( ! in_array( $status, $q_status, true ) ) {
					$e_status[] = "{$wpdb-&gt;posts}.post_status &lt;&gt; '$status'";
				}
			}
		} else {
			foreach ( get_post_stati() as $status ) {
				if ( in_array( $status, $q_status, true ) ) {
					if ( 'private' === $status ) {
						$p_status[] = "{$wpdb-&gt;posts}.post_status = '$status'";
					} else {
						$r_status[] = "{$wpdb-&gt;posts}.post_status = '$status'";
					}
				}
			}
		}

		if ( empty( $q['perm'] ) || 'readable' !== $q['perm'] ) {
			$r_status = array_merge( $r_status, $p_status );
			unset( $p_status );
		}

		if ( ! empty( $e_status ) ) {
			$statuswheres[] = '(' . implode( ' AND ', $e_status ) . ')';
		}
		if ( ! empty( $r_status ) ) {
			if ( ! empty( $q['perm'] ) &amp;&amp; 'editable' === $q['perm'] &amp;&amp; ! current_user_can( $edit_others_cap ) ) {
				$statuswheres[] = "({$wpdb-&gt;posts}.post_author = $user_id " . 'AND (' . implode( ' OR ', $r_status ) . '))';
			} else {
				$statuswheres[] = '(' . implode( ' OR ', $r_status ) . ')';
			}
		}
		if ( ! empty( $p_status ) ) {
			if ( ! empty( $q['perm'] ) &amp;&amp; 'readable' === $q['perm'] &amp;&amp; ! current_user_can( $read_private_cap ) ) {
				$statuswheres[] = "({$wpdb-&gt;posts}.post_author = $user_id " . 'AND (' . implode( ' OR ', $p_status ) . '))';
			} else {
				$statuswheres[] = '(' . implode( ' OR ', $p_status ) . ')';
			}
		}
		if ( $post_status_join ) {
			$join .= " LEFT JOIN {$wpdb-&gt;posts} AS p2 ON ({$wpdb-&gt;posts}.post_parent = p2.ID) ";
			foreach ( $statuswheres as $index =&gt; $statuswhere ) {
				$statuswheres[ $index ] = "($statuswhere OR ({$wpdb-&gt;posts}.post_status = 'inherit' AND " . str_replace( $wpdb-&gt;posts, 'p2', $statuswhere ) . '))';
			}
		}
		$where_status = implode( ' OR ', $statuswheres );
		if ( ! empty( $where_status ) ) {
			$where .= " AND ($where_status)";
		}
	} elseif ( ! $this-&gt;is_singular ) {
		if ( 'any' === $post_type ) {
			$queried_post_types = get_post_types( array( 'exclude_from_search' =&gt; false ) );
		} elseif ( is_array( $post_type ) ) {
			$queried_post_types = $post_type;
		} elseif ( ! empty( $post_type ) ) {
			$queried_post_types = array( $post_type );
		} else {
			$queried_post_types = array( 'post' );
		}

		if ( ! empty( $queried_post_types ) ) {
			sort( $queried_post_types );
			$status_type_clauses = array();

			foreach ( $queried_post_types as $queried_post_type ) {

				$queried_post_type_object = get_post_type_object( $queried_post_type );

				$type_where = '(' . $wpdb-&gt;prepare( "{$wpdb-&gt;posts}.post_type = %s AND (", $queried_post_type );

				// Public statuses.
				$public_statuses = get_post_stati( array( 'public' =&gt; true ) );
				$status_clauses  = array();
				foreach ( $public_statuses as $public_status ) {
					$status_clauses[] = "{$wpdb-&gt;posts}.post_status = '$public_status'";
				}
				$type_where .= implode( ' OR ', $status_clauses );

				// Add protected states that should show in the admin all list.
				if ( $this-&gt;is_admin ) {
					$admin_all_statuses = get_post_stati(
						array(
							'protected'              =&gt; true,
							'show_in_admin_all_list' =&gt; true,
						)
					);
					foreach ( $admin_all_statuses as $admin_all_status ) {
						$type_where .= " OR {$wpdb-&gt;posts}.post_status = '$admin_all_status'";
					}
				}

				// Add private states that are visible to current user.
				if ( is_user_logged_in() &amp;&amp; $queried_post_type_object instanceof WP_Post_Type ) {
					$read_private_cap = $queried_post_type_object-&gt;cap-&gt;read_private_posts;
					$private_statuses = get_post_stati( array( 'private' =&gt; true ) );
					foreach ( $private_statuses as $private_status ) {
						$type_where .= current_user_can( $read_private_cap ) ? " \nOR {$wpdb-&gt;posts}.post_status = '$private_status'" : " \nOR ({$wpdb-&gt;posts}.post_author = $user_id AND {$wpdb-&gt;posts}.post_status = '$private_status')";
					}
				}

				$type_where .= '))';

				$status_type_clauses[] = $type_where;
			}

			if ( ! empty( $status_type_clauses ) ) {
				$where .= ' AND (' . implode( ' OR ', $status_type_clauses ) . ')';
			}
		} else {
			$where .= ' AND 1=0 ';
		}
	} else {
		$where .= $post_type_where;
	}

	/*
	 * Apply filters on where and join prior to paging so that any
	 * manipulations to them are reflected in the paging by day queries.
	 */
	if ( ! $q['suppress_filters'] ) {
		/**
		 * Filters the WHERE clause of the query.
		 *
		 * @since 1.5.0
		 *
		 * @param string   $where The WHERE clause of the query.
		 * @param WP_Query $query The WP_Query instance (passed by reference).
		 */
		$where = apply_filters_ref_array( 'posts_where', array( $where, &amp;$this ) );

		/**
		 * Filters the JOIN clause of the query.
		 *
		 * @since 1.5.0
		 *
		 * @param string   $join  The JOIN clause of the query.
		 * @param WP_Query $query The WP_Query instance (passed by reference).
		 */
		$join = apply_filters_ref_array( 'posts_join', array( $join, &amp;$this ) );
	}

	// Paging.
	if ( empty( $q['nopaging'] ) &amp;&amp; ! $this-&gt;is_singular ) {
		$page = absint( $q['paged'] );
		if ( ! $page ) {
			$page = 1;
		}

		// If 'offset' is provided, it takes precedence over 'paged'.
		if ( isset( $q['offset'] ) &amp;&amp; is_numeric( $q['offset'] ) ) {
			$q['offset'] = absint( $q['offset'] );
			$pgstrt      = $q['offset'] . ', ';
		} else {
			$pgstrt = absint( ( $page - 1 ) * $q['posts_per_page'] ) . ', ';
		}
		$limits = 'LIMIT ' . $pgstrt . $q['posts_per_page'];
	}

	// Comments feeds.
	if ( $this-&gt;is_comment_feed &amp;&amp; ! $this-&gt;is_singular ) {
		if ( $this-&gt;is_archive || $this-&gt;is_search ) {
			$cjoin    = "JOIN {$wpdb-&gt;posts} ON ( {$wpdb-&gt;comments}.comment_post_ID = {$wpdb-&gt;posts}.ID ) $join ";
			$cwhere   = "WHERE comment_approved = '1' $where";
			$cgroupby = "{$wpdb-&gt;comments}.comment_id";
		} else { // Other non-singular, e.g. front.
			$cjoin    = "JOIN {$wpdb-&gt;posts} ON ( {$wpdb-&gt;comments}.comment_post_ID = {$wpdb-&gt;posts}.ID )";
			$cwhere   = "WHERE ( post_status = 'publish' OR ( post_status = 'inherit' AND post_type = 'attachment' ) ) AND comment_approved = '1'";
			$cgroupby = '';
		}

		if ( ! $q['suppress_filters'] ) {
			/**
			 * Filters the JOIN clause of the comments feed query before sending.
			 *
			 * @since 2.2.0
			 *
			 * @param string   $cjoin The JOIN clause of the query.
			 * @param WP_Query $query The WP_Query instance (passed by reference).
			 */
			$cjoin = apply_filters_ref_array( 'comment_feed_join', array( $cjoin, &amp;$this ) );

			/**
			 * Filters the WHERE clause of the comments feed query before sending.
			 *
			 * @since 2.2.0
			 *
			 * @param string   $cwhere The WHERE clause of the query.
			 * @param WP_Query $query  The WP_Query instance (passed by reference).
			 */
			$cwhere = apply_filters_ref_array( 'comment_feed_where', array( $cwhere, &amp;$this ) );

			/**
			 * Filters the GROUP BY clause of the comments feed query before sending.
			 *
			 * @since 2.2.0
			 *
			 * @param string   $cgroupby The GROUP BY clause of the query.
			 * @param WP_Query $query    The WP_Query instance (passed by reference).
			 */
			$cgroupby = apply_filters_ref_array( 'comment_feed_groupby', array( $cgroupby, &amp;$this ) );

			/**
			 * Filters the ORDER BY clause of the comments feed query before sending.
			 *
			 * @since 2.8.0
			 *
			 * @param string   $corderby The ORDER BY clause of the query.
			 * @param WP_Query $query    The WP_Query instance (passed by reference).
			 */
			$corderby = apply_filters_ref_array( 'comment_feed_orderby', array( 'comment_date_gmt DESC', &amp;$this ) );

			/**
			 * Filters the LIMIT clause of the comments feed query before sending.
			 *
			 * @since 2.8.0
			 *
			 * @param string   $climits The JOIN clause of the query.
			 * @param WP_Query $query   The WP_Query instance (passed by reference).
			 */
			$climits = apply_filters_ref_array( 'comment_feed_limits', array( 'LIMIT ' . get_option( 'posts_per_rss' ), &amp;$this ) );
		}

		$cgroupby = ( ! empty( $cgroupby ) ) ? 'GROUP BY ' . $cgroupby : '';
		$corderby = ( ! empty( $corderby ) ) ? 'ORDER BY ' . $corderby : '';
		$climits  = ( ! empty( $climits ) ) ? $climits : '';

		$comments_request = "SELECT $distinct {$wpdb-&gt;comments}.comment_ID FROM {$wpdb-&gt;comments} $cjoin $cwhere $cgroupby $corderby $climits";

		$key          = md5( $comments_request );
		$last_changed = wp_cache_get_last_changed( 'comment' ) . ':' . wp_cache_get_last_changed( 'posts' );

		$cache_key   = "comment_feed:$key:$last_changed";
		$comment_ids = wp_cache_get( $cache_key, 'comment-queries' );
		if ( false === $comment_ids ) {
			$comment_ids = $wpdb-&gt;get_col( $comments_request );
			wp_cache_add( $cache_key, $comment_ids, 'comment-queries' );
		}
		_prime_comment_caches( $comment_ids );

		// Convert to WP_Comment.
		/** @var WP_Comment[] */
		$this-&gt;comments      = array_map( 'get_comment', $comment_ids );
		$this-&gt;comment_count = count( $this-&gt;comments );

		$post_ids = array();

		foreach ( $this-&gt;comments as $comment ) {
			$post_ids[] = (int) $comment-&gt;comment_post_ID;
		}

		$post_ids = implode( ',', $post_ids );
		$join     = '';
		if ( $post_ids ) {
			$where = "AND {$wpdb-&gt;posts}.ID IN ($post_ids) ";
		} else {
			$where = 'AND 0';
		}
	}

	$pieces = array( 'where', 'groupby', 'join', 'orderby', 'distinct', 'fields', 'limits' );

	/*
	 * Apply post-paging filters on where and join. Only plugins that
	 * manipulate paging queries should use these hooks.
	 */
	if ( ! $q['suppress_filters'] ) {
		/**
		 * Filters the WHERE clause of the query.
		 *
		 * Specifically for manipulating paging queries.
		 *
		 * @since 1.5.0
		 *
		 * @param string   $where The WHERE clause of the query.
		 * @param WP_Query $query The WP_Query instance (passed by reference).
		 */
		$where = apply_filters_ref_array( 'posts_where_paged', array( $where, &amp;$this ) );

		/**
		 * Filters the GROUP BY clause of the query.
		 *
		 * @since 2.0.0
		 *
		 * @param string   $groupby The GROUP BY clause of the query.
		 * @param WP_Query $query   The WP_Query instance (passed by reference).
		 */
		$groupby = apply_filters_ref_array( 'posts_groupby', array( $groupby, &amp;$this ) );

		/**
		 * Filters the JOIN clause of the query.
		 *
		 * Specifically for manipulating paging queries.
		 *
		 * @since 1.5.0
		 *
		 * @param string   $join  The JOIN clause of the query.
		 * @param WP_Query $query The WP_Query instance (passed by reference).
		 */
		$join = apply_filters_ref_array( 'posts_join_paged', array( $join, &amp;$this ) );

		/**
		 * Filters the ORDER BY clause of the query.
		 *
		 * @since 1.5.1
		 *
		 * @param string   $orderby The ORDER BY clause of the query.
		 * @param WP_Query $query   The WP_Query instance (passed by reference).
		 */
		$orderby = apply_filters_ref_array( 'posts_orderby', array( $orderby, &amp;$this ) );

		/**
		 * Filters the DISTINCT clause of the query.
		 *
		 * @since 2.1.0
		 *
		 * @param string   $distinct The DISTINCT clause of the query.
		 * @param WP_Query $query    The WP_Query instance (passed by reference).
		 */
		$distinct = apply_filters_ref_array( 'posts_distinct', array( $distinct, &amp;$this ) );

		/**
		 * Filters the LIMIT clause of the query.
		 *
		 * @since 2.1.0
		 *
		 * @param string   $limits The LIMIT clause of the query.
		 * @param WP_Query $query  The WP_Query instance (passed by reference).
		 */
		$limits = apply_filters_ref_array( 'post_limits', array( $limits, &amp;$this ) );

		/**
		 * Filters the SELECT clause of the query.
		 *
		 * @since 2.1.0
		 *
		 * @param string   $fields The SELECT clause of the query.
		 * @param WP_Query $query  The WP_Query instance (passed by reference).
		 */
		$fields = apply_filters_ref_array( 'posts_fields', array( $fields, &amp;$this ) );

		/**
		 * Filters all query clauses at once, for convenience.
		 *
		 * Covers the WHERE, GROUP BY, JOIN, ORDER BY, DISTINCT,
		 * fields (SELECT), and LIMIT clauses.
		 *
		 * @since 3.1.0
		 *
		 * @param string[] $clauses {
		 *     Associative array of the clauses for the query.
		 *
		 *     @type string $where    The WHERE clause of the query.
		 *     @type string $groupby  The GROUP BY clause of the query.
		 *     @type string $join     The JOIN clause of the query.
		 *     @type string $orderby  The ORDER BY clause of the query.
		 *     @type string $distinct The DISTINCT clause of the query.
		 *     @type string $fields   The SELECT clause of the query.
		 *     @type string $limits   The LIMIT clause of the query.
		 * }
		 * @param WP_Query $query   The WP_Query instance (passed by reference).
		 */
		$clauses = (array) apply_filters_ref_array( 'posts_clauses', array( compact( $pieces ), &amp;$this ) );

		$where    = isset( $clauses['where'] ) ? $clauses['where'] : '';
		$groupby  = isset( $clauses['groupby'] ) ? $clauses['groupby'] : '';
		$join     = isset( $clauses['join'] ) ? $clauses['join'] : '';
		$orderby  = isset( $clauses['orderby'] ) ? $clauses['orderby'] : '';
		$distinct = isset( $clauses['distinct'] ) ? $clauses['distinct'] : '';
		$fields   = isset( $clauses['fields'] ) ? $clauses['fields'] : '';
		$limits   = isset( $clauses['limits'] ) ? $clauses['limits'] : '';
	}

	/**
	 * Fires to announce the query's current selection parameters.
	 *
	 * For use by caching plugins.
	 *
	 * @since 2.3.0
	 *
	 * @param string $selection The assembled selection query.
	 */
	do_action( 'posts_selection', $where . $groupby . $orderby . $limits . $join );

	/*
	 * Filters again for the benefit of caching plugins.
	 * Regular plugins should use the hooks above.
	 */
	if ( ! $q['suppress_filters'] ) {
		/**
		 * Filters the WHERE clause of the query.
		 *
		 * For use by caching plugins.
		 *
		 * @since 2.5.0
		 *
		 * @param string   $where The WHERE clause of the query.
		 * @param WP_Query $query The WP_Query instance (passed by reference).
		 */
		$where = apply_filters_ref_array( 'posts_where_request', array( $where, &amp;$this ) );

		/**
		 * Filters the GROUP BY clause of the query.
		 *
		 * For use by caching plugins.
		 *
		 * @since 2.5.0
		 *
		 * @param string   $groupby The GROUP BY clause of the query.
		 * @param WP_Query $query   The WP_Query instance (passed by reference).
		 */
		$groupby = apply_filters_ref_array( 'posts_groupby_request', array( $groupby, &amp;$this ) );

		/**
		 * Filters the JOIN clause of the query.
		 *
		 * For use by caching plugins.
		 *
		 * @since 2.5.0
		 *
		 * @param string   $join  The JOIN clause of the query.
		 * @param WP_Query $query The WP_Query instance (passed by reference).
		 */
		$join = apply_filters_ref_array( 'posts_join_request', array( $join, &amp;$this ) );

		/**
		 * Filters the ORDER BY clause of the query.
		 *
		 * For use by caching plugins.
		 *
		 * @since 2.5.0
		 *
		 * @param string   $orderby The ORDER BY clause of the query.
		 * @param WP_Query $query   The WP_Query instance (passed by reference).
		 */
		$orderby = apply_filters_ref_array( 'posts_orderby_request', array( $orderby, &amp;$this ) );

		/**
		 * Filters the DISTINCT clause of the query.
		 *
		 * For use by caching plugins.
		 *
		 * @since 2.5.0
		 *
		 * @param string   $distinct The DISTINCT clause of the query.
		 * @param WP_Query $query    The WP_Query instance (passed by reference).
		 */
		$distinct = apply_filters_ref_array( 'posts_distinct_request', array( $distinct, &amp;$this ) );

		/**
		 * Filters the SELECT clause of the query.
		 *
		 * For use by caching plugins.
		 *
		 * @since 2.5.0
		 *
		 * @param string   $fields The SELECT clause of the query.
		 * @param WP_Query $query  The WP_Query instance (passed by reference).
		 */
		$fields = apply_filters_ref_array( 'posts_fields_request', array( $fields, &amp;$this ) );

		/**
		 * Filters the LIMIT clause of the query.
		 *
		 * For use by caching plugins.
		 *
		 * @since 2.5.0
		 *
		 * @param string   $limits The LIMIT clause of the query.
		 * @param WP_Query $query  The WP_Query instance (passed by reference).
		 */
		$limits = apply_filters_ref_array( 'post_limits_request', array( $limits, &amp;$this ) );

		/**
		 * Filters all query clauses at once, for convenience.
		 *
		 * For use by caching plugins.
		 *
		 * Covers the WHERE, GROUP BY, JOIN, ORDER BY, DISTINCT,
		 * fields (SELECT), and LIMIT clauses.
		 *
		 * @since 3.1.0
		 *
		 * @param string[] $clauses {
		 *     Associative array of the clauses for the query.
		 *
		 *     @type string $where    The WHERE clause of the query.
		 *     @type string $groupby  The GROUP BY clause of the query.
		 *     @type string $join     The JOIN clause of the query.
		 *     @type string $orderby  The ORDER BY clause of the query.
		 *     @type string $distinct The DISTINCT clause of the query.
		 *     @type string $fields   The SELECT clause of the query.
		 *     @type string $limits   The LIMIT clause of the query.
		 * }
		 * @param WP_Query $query  The WP_Query instance (passed by reference).
		 */
		$clauses = (array) apply_filters_ref_array( 'posts_clauses_request', array( compact( $pieces ), &amp;$this ) );

		$where    = isset( $clauses['where'] ) ? $clauses['where'] : '';
		$groupby  = isset( $clauses['groupby'] ) ? $clauses['groupby'] : '';
		$join     = isset( $clauses['join'] ) ? $clauses['join'] : '';
		$orderby  = isset( $clauses['orderby'] ) ? $clauses['orderby'] : '';
		$distinct = isset( $clauses['distinct'] ) ? $clauses['distinct'] : '';
		$fields   = isset( $clauses['fields'] ) ? $clauses['fields'] : '';
		$limits   = isset( $clauses['limits'] ) ? $clauses['limits'] : '';
	}

	if ( ! empty( $groupby ) ) {
		$groupby = 'GROUP BY ' . $groupby;
	}
	if ( ! empty( $orderby ) ) {
		$orderby = 'ORDER BY ' . $orderby;
	}

	$found_rows = '';
	if ( ! $q['no_found_rows'] &amp;&amp; ! empty( $limits ) ) {
		$found_rows = 'SQL_CALC_FOUND_ROWS';
	}

	/*
	 * Beginning of the string is on a new line to prevent leading whitespace.
	 *
	 * The additional indentation of subsequent lines is to ensure the SQL
	 * queries are identical to those generated when splitting queries. This
	 * improves caching of the query by ensuring the same cache key is
	 * generated for the same database queries functionally.
	 *
	 * See https://core.trac.wordpress.org/ticket/56841.
	 * See https://github.com/WordPress/wordpress-develop/pull/6393#issuecomment-2088217429
	 */
	$old_request =
		"SELECT $found_rows $distinct $fields
				 FROM {$wpdb-&gt;posts} $join
				 WHERE 1=1 $where
				 $groupby
				 $orderby
				 $limits";

	$this-&gt;request = $old_request;

	if ( ! $q['suppress_filters'] ) {
		/**
		 * Filters the completed SQL query before sending.
		 *
		 * @since 2.0.0
		 *
		 * @param string   $request The complete SQL query.
		 * @param WP_Query $query   The WP_Query instance (passed by reference).
		 */
		$this-&gt;request = apply_filters_ref_array( 'posts_request', array( $this-&gt;request, &amp;$this ) );
	}

	/**
	 * Filters the posts array before the query takes place.
	 *
	 * Return a non-null value to bypass WordPress' default post queries.
	 *
	 * Filtering functions that require pagination information are encouraged to set
	 * the `found_posts` and `max_num_pages` properties of the WP_Query object,
	 * passed to the filter by reference. If WP_Query does not perform a database
	 * query, it will not have enough information to generate these values itself.
	 *
	 * @since 4.6.0
	 *
	 * @param WP_Post[]|int[]|null $posts Return an array of post data to short-circuit WP's query,
	 *                                    or null to allow WP to run its normal queries.
	 * @param WP_Query             $query The WP_Query instance (passed by reference).
	 */
	$this-&gt;posts = apply_filters_ref_array( 'posts_pre_query', array( null, &amp;$this ) );

	/*
	 * Ensure the ID database query is able to be cached.
	 *
	 * Random queries are expected to have unpredictable results and
	 * cannot be cached. Note the space before `RAND` in the string
	 * search, that to ensure against a collision with another
	 * function.
	 *
	 * If `$fields` has been modified by the `posts_fields`,
	 * `posts_fields_request`, `post_clauses` or `posts_clauses_request`
	 * filters, then caching is disabled to prevent caching collisions.
	 */
	$id_query_is_cacheable = ! str_contains( strtoupper( $orderby ), ' RAND(' );

	$cacheable_field_values = array(
		"{$wpdb-&gt;posts}.*",
		"{$wpdb-&gt;posts}.ID, {$wpdb-&gt;posts}.post_parent",
		"{$wpdb-&gt;posts}.ID",
	);

	if ( ! in_array( $fields, $cacheable_field_values, true ) ) {
		$id_query_is_cacheable = false;
	}

	if ( $q['cache_results'] &amp;&amp; $id_query_is_cacheable ) {
		$new_request = str_replace( $fields, "{$wpdb-&gt;posts}.*", $this-&gt;request );
		$cache_key   = $this-&gt;generate_cache_key( $q, $new_request );

		$cache_found = false;
		if ( null === $this-&gt;posts ) {
			$cached_results = wp_cache_get( $cache_key, 'post-queries', false, $cache_found );

			if ( $cached_results ) {
				/** @var int[] */
				$post_ids = array_map( 'intval', $cached_results['posts'] );

				$this-&gt;post_count    = count( $post_ids );
				$this-&gt;found_posts   = $cached_results['found_posts'];
				$this-&gt;max_num_pages = $cached_results['max_num_pages'];

				if ( 'ids' === $q['fields'] ) {
					$this-&gt;posts = $post_ids;

					return $this-&gt;posts;
				} elseif ( 'id=&gt;parent' === $q['fields'] ) {
					_prime_post_parent_id_caches( $post_ids );

					$post_parent_cache_keys = array();
					foreach ( $post_ids as $post_id ) {
						$post_parent_cache_keys[] = 'post_parent:' . (string) $post_id;
					}

					/** @var int[] */
					$post_parents = wp_cache_get_multiple( $post_parent_cache_keys, 'posts' );

					foreach ( $post_parents as $cache_key =&gt; $post_parent ) {
						$obj              = new stdClass();
						$obj-&gt;ID          = (int) str_replace( 'post_parent:', '', $cache_key );
						$obj-&gt;post_parent = (int) $post_parent;

						$this-&gt;posts[] = $obj;
					}

					return $post_parents;
				} else {
					_prime_post_caches( $post_ids, $q['update_post_term_cache'], $q['update_post_meta_cache'] );
					/** @var WP_Post[] */
					$this-&gt;posts = array_map( 'get_post', $post_ids );
				}
			}
		}
	}

	if ( 'ids' === $q['fields'] ) {
		if ( null === $this-&gt;posts ) {
			$this-&gt;posts = $wpdb-&gt;get_col( $this-&gt;request );
		}

		/** @var int[] */
		$this-&gt;posts      = array_map( 'intval', $this-&gt;posts );
		$this-&gt;post_count = count( $this-&gt;posts );
		$this-&gt;set_found_posts( $q, $limits );

		if ( $q['cache_results'] &amp;&amp; $id_query_is_cacheable ) {
			$cache_value = array(
				'posts'         =&gt; $this-&gt;posts,
				'found_posts'   =&gt; $this-&gt;found_posts,
				'max_num_pages' =&gt; $this-&gt;max_num_pages,
			);

			wp_cache_set( $cache_key, $cache_value, 'post-queries' );
		}

		return $this-&gt;posts;
	}

	if ( 'id=&gt;parent' === $q['fields'] ) {
		if ( null === $this-&gt;posts ) {
			$this-&gt;posts = $wpdb-&gt;get_results( $this-&gt;request );
		}

		$this-&gt;post_count = count( $this-&gt;posts );
		$this-&gt;set_found_posts( $q, $limits );

		/** @var int[] */
		$post_parents       = array();
		$post_ids           = array();
		$post_parents_cache = array();

		foreach ( $this-&gt;posts as $key =&gt; $post ) {
			$this-&gt;posts[ $key ]-&gt;ID          = (int) $post-&gt;ID;
			$this-&gt;posts[ $key ]-&gt;post_parent = (int) $post-&gt;post_parent;

			$post_parents[ (int) $post-&gt;ID ] = (int) $post-&gt;post_parent;
			$post_ids[]                      = (int) $post-&gt;ID;

			$post_parents_cache[ 'post_parent:' . (string) $post-&gt;ID ] = (int) $post-&gt;post_parent;
		}
		// Prime post parent caches, so that on second run, there is not another database query.
		wp_cache_add_multiple( $post_parents_cache, 'posts' );

		if ( $q['cache_results'] &amp;&amp; $id_query_is_cacheable ) {
			$cache_value = array(
				'posts'         =&gt; $post_ids,
				'found_posts'   =&gt; $this-&gt;found_posts,
				'max_num_pages' =&gt; $this-&gt;max_num_pages,
			);

			wp_cache_set( $cache_key, $cache_value, 'post-queries' );
		}

		return $post_parents;
	}

	$is_unfiltered_query = $old_request == $this-&gt;request &amp;&amp; "{$wpdb-&gt;posts}.*" === $fields;

	if ( null === $this-&gt;posts ) {
		$split_the_query = (
			$is_unfiltered_query
			&amp;&amp; (
				wp_using_ext_object_cache()
				|| ( ! empty( $limits ) &amp;&amp; $q['posts_per_page'] &lt; 500 )
			)
		);

		/**
		 * Filters whether to split the query.
		 *
		 * Splitting the query will cause it to fetch just the IDs of the found posts
		 * (and then individually fetch each post by ID), rather than fetching every
		 * complete row at once. One massive result vs. many small results.
		 *
		 * @since 3.4.0
		 * @since 6.6.0 Added the `$old_request` and `$clauses` parameters.
		 *
		 * @param bool     $split_the_query Whether or not to split the query.
		 * @param WP_Query $query           The WP_Query instance.
		 * @param string   $old_request     The complete SQL query before filtering.
		 * @param string[] $clauses {
		 *     Associative array of the clauses for the query.
		 *
		 *     @type string $where    The WHERE clause of the query.
		 *     @type string $groupby  The GROUP BY clause of the query.
		 *     @type string $join     The JOIN clause of the query.
		 *     @type string $orderby  The ORDER BY clause of the query.
		 *     @type string $distinct The DISTINCT clause of the query.
		 *     @type string $fields   The SELECT clause of the query.
		 *     @type string $limits   The LIMIT clause of the query.
		 * }
		 */
		$split_the_query = apply_filters( 'split_the_query', $split_the_query, $this, $old_request, compact( $pieces ) );

		if ( $split_the_query ) {
			// First get the IDs and then fill in the objects.

			// Beginning of the string is on a new line to prevent leading whitespace. See https://core.trac.wordpress.org/ticket/56841.
			$this-&gt;request =
				"SELECT $found_rows $distinct {$wpdb-&gt;posts}.ID
				 FROM {$wpdb-&gt;posts} $join
				 WHERE 1=1 $where
				 $groupby
				 $orderby
				 $limits";

			/**
			 * Filters the Post IDs SQL request before sending.
			 *
			 * @since 3.4.0
			 *
			 * @param string   $request The post ID request.
			 * @param WP_Query $query   The WP_Query instance.
			 */
			$this-&gt;request = apply_filters( 'posts_request_ids', $this-&gt;request, $this );

			$post_ids = $wpdb-&gt;get_col( $this-&gt;request );

			if ( $post_ids ) {
				$this-&gt;posts = $post_ids;
				$this-&gt;set_found_posts( $q, $limits );
				_prime_post_caches( $post_ids, $q['update_post_term_cache'], $q['update_post_meta_cache'] );
			} else {
				$this-&gt;posts = array();
			}
		} else {
			$this-&gt;posts = $wpdb-&gt;get_results( $this-&gt;request );
			$this-&gt;set_found_posts( $q, $limits );
		}
	}

	// Convert to WP_Post objects.
	if ( $this-&gt;posts ) {
		/** @var WP_Post[] */
		$this-&gt;posts = array_map( 'get_post', $this-&gt;posts );
	}

	$unfiltered_posts = $this-&gt;posts;

	if ( $q['cache_results'] &amp;&amp; $id_query_is_cacheable &amp;&amp; ! $cache_found ) {
		$post_ids = wp_list_pluck( $this-&gt;posts, 'ID' );

		$cache_value = array(
			'posts'         =&gt; $post_ids,
			'found_posts'   =&gt; $this-&gt;found_posts,
			'max_num_pages' =&gt; $this-&gt;max_num_pages,
		);

		wp_cache_set( $cache_key, $cache_value, 'post-queries' );
	}

	if ( ! $q['suppress_filters'] ) {
		/**
		 * Filters the raw post results array, prior to status checks.
		 *
		 * @since 2.3.0
		 *
		 * @param WP_Post[] $posts Array of post objects.
		 * @param WP_Query  $query The WP_Query instance (passed by reference).
		 */
		$this-&gt;posts = apply_filters_ref_array( 'posts_results', array( $this-&gt;posts, &amp;$this ) );
	}

	if ( ! empty( $this-&gt;posts ) &amp;&amp; $this-&gt;is_comment_feed &amp;&amp; $this-&gt;is_singular ) {
		/** This filter is documented in wp-includes/query.php */
		$cjoin = apply_filters_ref_array( 'comment_feed_join', array( '', &amp;$this ) );

		/** This filter is documented in wp-includes/query.php */
		$cwhere = apply_filters_ref_array( 'comment_feed_where', array( "WHERE comment_post_ID = '{$this-&gt;posts[0]-&gt;ID}' AND comment_approved = '1'", &amp;$this ) );

		/** This filter is documented in wp-includes/query.php */
		$cgroupby = apply_filters_ref_array( 'comment_feed_groupby', array( '', &amp;$this ) );
		$cgroupby = ( ! empty( $cgroupby ) ) ? 'GROUP BY ' . $cgroupby : '';

		/** This filter is documented in wp-includes/query.php */
		$corderby = apply_filters_ref_array( 'comment_feed_orderby', array( 'comment_date_gmt DESC', &amp;$this ) );
		$corderby = ( ! empty( $corderby ) ) ? 'ORDER BY ' . $corderby : '';

		/** This filter is documented in wp-includes/query.php */
		$climits = apply_filters_ref_array( 'comment_feed_limits', array( 'LIMIT ' . get_option( 'posts_per_rss' ), &amp;$this ) );

		$comments_request = "SELECT {$wpdb-&gt;comments}.comment_ID FROM {$wpdb-&gt;comments} $cjoin $cwhere $cgroupby $corderby $climits";

		$comment_key          = md5( $comments_request );
		$comment_last_changed = wp_cache_get_last_changed( 'comment' );

		$comment_cache_key = "comment_feed:$comment_key:$comment_last_changed";
		$comment_ids       = wp_cache_get( $comment_cache_key, 'comment-queries' );
		if ( false === $comment_ids ) {
			$comment_ids = $wpdb-&gt;get_col( $comments_request );
			wp_cache_add( $comment_cache_key, $comment_ids, 'comment-queries' );
		}
		_prime_comment_caches( $comment_ids );

		// Convert to WP_Comment.
		/** @var WP_Comment[] */
		$this-&gt;comments      = array_map( 'get_comment', $comment_ids );
		$this-&gt;comment_count = count( $this-&gt;comments );
	}

	// Check post status to determine if post should be displayed.
	if ( ! empty( $this-&gt;posts ) &amp;&amp; ( $this-&gt;is_single || $this-&gt;is_page ) ) {
		$status = get_post_status( $this-&gt;posts[0] );

		if ( 'attachment' === $this-&gt;posts[0]-&gt;post_type &amp;&amp; 0 === (int) $this-&gt;posts[0]-&gt;post_parent ) {
			$this-&gt;is_page       = false;
			$this-&gt;is_single     = true;
			$this-&gt;is_attachment = true;
		}

		// If the post_status was specifically requested, let it pass through.
		if ( ! in_array( $status, $q_status, true ) ) {
			$post_status_obj = get_post_status_object( $status );

			if ( $post_status_obj &amp;&amp; ! $post_status_obj-&gt;public ) {
				if ( ! is_user_logged_in() ) {
					// User must be logged in to view unpublished posts.
					$this-&gt;posts = array();
				} else {
					if ( $post_status_obj-&gt;protected ) {
						// User must have edit permissions on the draft to preview.
						if ( ! current_user_can( $edit_cap, $this-&gt;posts[0]-&gt;ID ) ) {
							$this-&gt;posts = array();
						} else {
							$this-&gt;is_preview = true;
							if ( 'future' !== $status ) {
								$this-&gt;posts[0]-&gt;post_date = current_time( 'mysql' );
							}
						}
					} elseif ( $post_status_obj-&gt;private ) {
						if ( ! current_user_can( $read_cap, $this-&gt;posts[0]-&gt;ID ) ) {
							$this-&gt;posts = array();
						}
					} else {
						$this-&gt;posts = array();
					}
				}
			} elseif ( ! $post_status_obj ) {
				// Post status is not registered, assume it's not public.
				if ( ! current_user_can( $edit_cap, $this-&gt;posts[0]-&gt;ID ) ) {
					$this-&gt;posts = array();
				}
			}
		}

		if ( $this-&gt;is_preview &amp;&amp; $this-&gt;posts &amp;&amp; current_user_can( $edit_cap, $this-&gt;posts[0]-&gt;ID ) ) {
			/**
			 * Filters the single post for preview mode.
			 *
			 * @since 2.7.0
			 *
			 * @param WP_Post  $post_preview  The Post object.
			 * @param WP_Query $query         The WP_Query instance (passed by reference).
			 */
			$this-&gt;posts[0] = get_post( apply_filters_ref_array( 'the_preview', array( $this-&gt;posts[0], &amp;$this ) ) );
		}
	}

	// Put sticky posts at the top of the posts array.
	$sticky_posts = get_option( 'sticky_posts' );
	if ( $this-&gt;is_home &amp;&amp; $page &lt;= 1 &amp;&amp; is_array( $sticky_posts ) &amp;&amp; ! empty( $sticky_posts ) &amp;&amp; ! $q['ignore_sticky_posts'] ) {
		$num_posts     = count( $this-&gt;posts );
		$sticky_offset = 0;
		// Loop over posts and relocate stickies to the front.
		for ( $i = 0; $i &lt; $num_posts; $i++ ) {
			if ( in_array( $this-&gt;posts[ $i ]-&gt;ID, $sticky_posts, true ) ) {
				$sticky_post = $this-&gt;posts[ $i ];
				// Remove sticky from current position.
				array_splice( $this-&gt;posts, $i, 1 );
				// Move to front, after other stickies.
				array_splice( $this-&gt;posts, $sticky_offset, 0, array( $sticky_post ) );
				// Increment the sticky offset. The next sticky will be placed at this offset.
				++$sticky_offset;
				// Remove post from sticky posts array.
				$offset = array_search( $sticky_post-&gt;ID, $sticky_posts, true );
				unset( $sticky_posts[ $offset ] );
			}
		}

		// If any posts have been excluded specifically, Ignore those that are sticky.
		if ( ! empty( $sticky_posts ) &amp;&amp; ! empty( $q['post__not_in'] ) ) {
			$sticky_posts = array_diff( $sticky_posts, $q['post__not_in'] );
		}

		// Fetch sticky posts that weren't in the query results.
		if ( ! empty( $sticky_posts ) ) {
			$stickies = get_posts(
				array(
					'post__in'               =&gt; $sticky_posts,
					'post_type'              =&gt; $post_type,
					'post_status'            =&gt; 'publish',
					'posts_per_page'         =&gt; count( $sticky_posts ),
					'suppress_filters'       =&gt; $q['suppress_filters'],
					'cache_results'          =&gt; $q['cache_results'],
					'update_post_meta_cache' =&gt; $q['update_post_meta_cache'],
					'update_post_term_cache' =&gt; $q['update_post_term_cache'],
					'lazy_load_term_meta'    =&gt; $q['lazy_load_term_meta'],
				)
			);

			foreach ( $stickies as $sticky_post ) {
				array_splice( $this-&gt;posts, $sticky_offset, 0, array( $sticky_post ) );
				++$sticky_offset;
			}
		}
	}

	if ( ! $q['suppress_filters'] ) {
		/**
		 * Filters the array of retrieved posts after they've been fetched and
		 * internally processed.
		 *
		 * @since 1.5.0
		 *
		 * @param WP_Post[] $posts Array of post objects.
		 * @param WP_Query  $query The WP_Query instance (passed by reference).
		 */
		$this-&gt;posts = apply_filters_ref_array( 'the_posts', array( $this-&gt;posts, &amp;$this ) );
	}

	/*
	 * Ensure that any posts added/modified via one of the filters above are
	 * of the type WP_Post and are filtered.
	 */
	if ( $this-&gt;posts ) {
		$this-&gt;post_count = count( $this-&gt;posts );

		/** @var WP_Post[] */
		$this-&gt;posts = array_map( 'get_post', $this-&gt;posts );

		if ( $q['cache_results'] ) {
			if ( $is_unfiltered_query &amp;&amp; $unfiltered_posts === $this-&gt;posts ) {
				update_post_caches( $this-&gt;posts, $post_type, $q['update_post_term_cache'], $q['update_post_meta_cache'] );
			} else {
				$post_ids = wp_list_pluck( $this-&gt;posts, 'ID' );
				_prime_post_caches( $post_ids, $q['update_post_term_cache'], $q['update_post_meta_cache'] );
			}
		}

		/** @var WP_Post */
		$this-&gt;post = reset( $this-&gt;posts );
	} else {
		$this-&gt;post_count = 0;
		$this-&gt;posts      = array();
	}

	if ( ! empty( $this-&gt;posts ) &amp;&amp; $q['update_menu_item_cache'] ) {
		update_menu_item_cache( $this-&gt;posts );
	}

	if ( $q['lazy_load_term_meta'] ) {
		wp_queue_posts_for_term_meta_lazyload( $this-&gt;posts );
	}

	return $this-&gt;posts;
}
</code></pre>
<p class="wporg-dot-link-list"><a href="https://developer.wordpress.org/reference/files/wp-includes/class-wp-query.php/">View all references</a> <a href="https://core.trac.wordpress.org/browser/tags/6.7/src/wp-includes/class-wp-query.php#L1865">View on Trac</a> <a href="https://github.com/WordPress/wordpress-develop/blob/6.7/src/wp-includes/class-wp-query.php#L1865-L3596">View on GitHub</a></p></section> <section><h2 id="hooks">Hooks</h2> <dl>
<dt class="wp-block-wporg-code-reference-title has-normal-font-size"><a href="../../hooks/comment_feed_groupby.html"><span class="hook-func">apply_filters_ref_array</span>( ‘comment_feed_groupby’, <nobr><span class="arg-type">string</span> <span class="arg-name">$cgroupby</span></nobr>, <nobr><span class="arg-type">WP_Query</span> <span class="arg-name">$query</span></nobr> )</a></dt>
<dd>
<p>Filters the GROUP BY clause of the comments feed query before sending.</p> </dd>
<dt class="wp-block-wporg-code-reference-title has-normal-font-size"><a href="../../hooks/comment_feed_join.html"><span class="hook-func">apply_filters_ref_array</span>( ‘comment_feed_join’, <nobr><span class="arg-type">string</span> <span class="arg-name">$cjoin</span></nobr>, <nobr><span class="arg-type">WP_Query</span> <span class="arg-name">$query</span></nobr> )</a></dt>
<dd>
<p>Filters the JOIN clause of the comments feed query before sending.</p> </dd>
<dt class="wp-block-wporg-code-reference-title has-normal-font-size"><a href="../../hooks/comment_feed_limits.html"><span class="hook-func">apply_filters_ref_array</span>( ‘comment_feed_limits’, <nobr><span class="arg-type">string</span> <span class="arg-name">$climits</span></nobr>, <nobr><span class="arg-type">WP_Query</span> <span class="arg-name">$query</span></nobr> )</a></dt>
<dd>
<p>Filters the LIMIT clause of the comments feed query before sending.</p> </dd>
<dt class="wp-block-wporg-code-reference-title has-normal-font-size"><a href="../../hooks/comment_feed_orderby.html"><span class="hook-func">apply_filters_ref_array</span>( ‘comment_feed_orderby’, <nobr><span class="arg-type">string</span> <span class="arg-name">$corderby</span></nobr>, <nobr><span class="arg-type">WP_Query</span> <span class="arg-name">$query</span></nobr> )</a></dt>
<dd>
<p>Filters the ORDER BY clause of the comments feed query before sending.</p> </dd>
<dt class="wp-block-wporg-code-reference-title has-normal-font-size"><a href="../../hooks/comment_feed_where.html"><span class="hook-func">apply_filters_ref_array</span>( ‘comment_feed_where’, <nobr><span class="arg-type">string</span> <span class="arg-name">$cwhere</span></nobr>, <nobr><span class="arg-type">WP_Query</span> <span class="arg-name">$query</span></nobr> )</a></dt>
<dd>
<p>Filters the WHERE clause of the comments feed query before sending.</p> </dd>
<dt class="wp-block-wporg-code-reference-title has-normal-font-size"><a href="../../hooks/posts_clauses.html"><span class="hook-func">apply_filters_ref_array</span>( ‘posts_clauses’, <nobr><span class="arg-type">string[]</span> <span class="arg-name">$clauses</span></nobr>, <nobr><span class="arg-type">WP_Query</span> <span class="arg-name">$query</span></nobr> )</a></dt>
<dd>
<p>Filters all query clauses at once, for convenience.</p> </dd>
<dt class="wp-block-wporg-code-reference-title has-normal-font-size"><a href="../../hooks/posts_clauses_request.html"><span class="hook-func">apply_filters_ref_array</span>( ‘posts_clauses_request’, <nobr><span class="arg-type">string[]</span> <span class="arg-name">$clauses</span></nobr>, <nobr><span class="arg-type">WP_Query</span> <span class="arg-name">$query</span></nobr> )</a></dt>
<dd>
<p>Filters all query clauses at once, for convenience.</p> </dd>
<dt class="wp-block-wporg-code-reference-title has-normal-font-size"><a href="../../hooks/posts_distinct.html"><span class="hook-func">apply_filters_ref_array</span>( ‘posts_distinct’, <nobr><span class="arg-type">string</span> <span class="arg-name">$distinct</span></nobr>, <nobr><span class="arg-type">WP_Query</span> <span class="arg-name">$query</span></nobr> )</a></dt>
<dd>
<p>Filters the DISTINCT clause of the query.</p> </dd>
<dt class="wp-block-wporg-code-reference-title has-normal-font-size"><a href="../../hooks/posts_distinct_request.html"><span class="hook-func">apply_filters_ref_array</span>( ‘posts_distinct_request’, <nobr><span class="arg-type">string</span> <span class="arg-name">$distinct</span></nobr>, <nobr><span class="arg-type">WP_Query</span> <span class="arg-name">$query</span></nobr> )</a></dt>
<dd>
<p>Filters the DISTINCT clause of the query.</p> </dd>
<dt class="wp-block-wporg-code-reference-title has-normal-font-size"><a href="../../hooks/posts_fields.html"><span class="hook-func">apply_filters_ref_array</span>( ‘posts_fields’, <nobr><span class="arg-type">string</span> <span class="arg-name">$fields</span></nobr>, <nobr><span class="arg-type">WP_Query</span> <span class="arg-name">$query</span></nobr> )</a></dt>
<dd>
<p>Filters the SELECT clause of the query.</p> </dd>
<dt class="wp-block-wporg-code-reference-title has-normal-font-size"><a href="../../hooks/posts_fields_request.html"><span class="hook-func">apply_filters_ref_array</span>( ‘posts_fields_request’, <nobr><span class="arg-type">string</span> <span class="arg-name">$fields</span></nobr>, <nobr><span class="arg-type">WP_Query</span> <span class="arg-name">$query</span></nobr> )</a></dt>
<dd>
<p>Filters the SELECT clause of the query.</p> </dd>
<dt class="wp-block-wporg-code-reference-title has-normal-font-size"><a href="../../hooks/posts_groupby.html"><span class="hook-func">apply_filters_ref_array</span>( ‘posts_groupby’, <nobr><span class="arg-type">string</span> <span class="arg-name">$groupby</span></nobr>, <nobr><span class="arg-type">WP_Query</span> <span class="arg-name">$query</span></nobr> )</a></dt>
<dd>
<p>Filters the GROUP BY clause of the query.</p> </dd>
<dt class="wp-block-wporg-code-reference-title has-normal-font-size"><a href="../../hooks/posts_groupby_request.html"><span class="hook-func">apply_filters_ref_array</span>( ‘posts_groupby_request’, <nobr><span class="arg-type">string</span> <span class="arg-name">$groupby</span></nobr>, <nobr><span class="arg-type">WP_Query</span> <span class="arg-name">$query</span></nobr> )</a></dt>
<dd>
<p>Filters the GROUP BY clause of the query.</p> </dd>
<dt class="wp-block-wporg-code-reference-title has-normal-font-size"><a href="../../hooks/posts_join.html"><span class="hook-func">apply_filters_ref_array</span>( ‘posts_join’, <nobr><span class="arg-type">string</span> <span class="arg-name">$join</span></nobr>, <nobr><span class="arg-type">WP_Query</span> <span class="arg-name">$query</span></nobr> )</a></dt>
<dd>
<p>Filters the JOIN clause of the query.</p> </dd>
<dt class="wp-block-wporg-code-reference-title has-normal-font-size"><a href="../../hooks/posts_join_paged.html"><span class="hook-func">apply_filters_ref_array</span>( ‘posts_join_paged’, <nobr><span class="arg-type">string</span> <span class="arg-name">$join</span></nobr>, <nobr><span class="arg-type">WP_Query</span> <span class="arg-name">$query</span></nobr> )</a></dt>
<dd>
<p>Filters the JOIN clause of the query.</p> </dd>
<dt class="wp-block-wporg-code-reference-title has-normal-font-size"><a href="../../hooks/posts_join_request.html"><span class="hook-func">apply_filters_ref_array</span>( ‘posts_join_request’, <nobr><span class="arg-type">string</span> <span class="arg-name">$join</span></nobr>, <nobr><span class="arg-type">WP_Query</span> <span class="arg-name">$query</span></nobr> )</a></dt>
<dd>
<p>Filters the JOIN clause of the query.</p> </dd>
<dt class="wp-block-wporg-code-reference-title has-normal-font-size"><a href="../../hooks/posts_orderby.html"><span class="hook-func">apply_filters_ref_array</span>( ‘posts_orderby’, <nobr><span class="arg-type">string</span> <span class="arg-name">$orderby</span></nobr>, <nobr><span class="arg-type">WP_Query</span> <span class="arg-name">$query</span></nobr> )</a></dt>
<dd>
<p>Filters the ORDER BY clause of the query.</p> </dd>
<dt class="wp-block-wporg-code-reference-title has-normal-font-size"><a href="../../hooks/posts_orderby_request.html"><span class="hook-func">apply_filters_ref_array</span>( ‘posts_orderby_request’, <nobr><span class="arg-type">string</span> <span class="arg-name">$orderby</span></nobr>, <nobr><span class="arg-type">WP_Query</span> <span class="arg-name">$query</span></nobr> )</a></dt>
<dd>
<p>Filters the ORDER BY clause of the query.</p> </dd>
<dt class="wp-block-wporg-code-reference-title has-normal-font-size"><a href="../../hooks/posts_pre_query.html"><span class="hook-func">apply_filters_ref_array</span>( ‘posts_pre_query’, <nobr><span class="arg-type">WP_Post[]|int[]|null</span> <span class="arg-name">$posts</span></nobr>, <nobr><span class="arg-type">WP_Query</span> <span class="arg-name">$query</span></nobr> )</a></dt>
<dd>
<p>Filters the posts array before the query takes place.</p> </dd>
<dt class="wp-block-wporg-code-reference-title has-normal-font-size"><a href="../../hooks/posts_request.html"><span class="hook-func">apply_filters_ref_array</span>( ‘posts_request’, <nobr><span class="arg-type">string</span> <span class="arg-name">$request</span></nobr>, <nobr><span class="arg-type">WP_Query</span> <span class="arg-name">$query</span></nobr> )</a></dt>
<dd>
<p>Filters the completed SQL query before sending.</p> </dd>
<dt class="wp-block-wporg-code-reference-title has-normal-font-size"><a href="../../hooks/posts_request_ids.html"><span class="hook-func">apply_filters</span>( ‘posts_request_ids’, <nobr><span class="arg-type">string</span> <span class="arg-name">$request</span></nobr>, <nobr><span class="arg-type">WP_Query</span> <span class="arg-name">$query</span></nobr> )</a></dt>
<dd>
<p>Filters the Post IDs SQL request before sending.</p> </dd>
<dt class="wp-block-wporg-code-reference-title has-normal-font-size"><a href="../../hooks/posts_results.html"><span class="hook-func">apply_filters_ref_array</span>( ‘posts_results’, <nobr><span class="arg-type">WP_Post[]</span> <span class="arg-name">$posts</span></nobr>, <nobr><span class="arg-type">WP_Query</span> <span class="arg-name">$query</span></nobr> )</a></dt>
<dd>
<p>Filters the raw post results array, prior to status checks.</p> </dd>
<dt class="wp-block-wporg-code-reference-title has-normal-font-size"><a href="../../hooks/posts_search.html"><span class="hook-func">apply_filters_ref_array</span>( ‘posts_search’, <nobr><span class="arg-type">string</span> <span class="arg-name">$search</span></nobr>, <nobr><span class="arg-type">WP_Query</span> <span class="arg-name">$query</span></nobr> )</a></dt>
<dd>
<p>Filters the search SQL that is used in the WHERE clause of <a href="../wp_query.html" rel="class">WP_Query</a>.</p> </dd>
<dt class="wp-block-wporg-code-reference-title has-normal-font-size"><a href="../../hooks/posts_search_orderby.html"><span class="hook-func">apply_filters</span>( ‘posts_search_orderby’, <nobr><span class="arg-type">string</span> <span class="arg-name">$search_orderby</span></nobr>, <nobr><span class="arg-type">WP_Query</span> <span class="arg-name">$query</span></nobr> )</a></dt>
<dd>
<p>Filters the ORDER BY used when ordering search results.</p> </dd>
<dt class="wp-block-wporg-code-reference-title has-normal-font-size"><a href="../../hooks/posts_selection.html"><span class="hook-func">do_action</span>( ‘posts_selection’, <nobr><span class="arg-type">string</span> <span class="arg-name">$selection</span></nobr> )</a></dt>
<dd>
<p>Fires to announce the query’s current selection parameters.</p> </dd>
<dt class="wp-block-wporg-code-reference-title has-normal-font-size"><a href="../../hooks/posts_where.html"><span class="hook-func">apply_filters_ref_array</span>( ‘posts_where’, <nobr><span class="arg-type">string</span> <span class="arg-name">$where</span></nobr>, <nobr><span class="arg-type">WP_Query</span> <span class="arg-name">$query</span></nobr> )</a></dt>
<dd>
<p>Filters the WHERE clause of the query.</p> </dd>
<dt class="wp-block-wporg-code-reference-title has-normal-font-size"><a href="../../hooks/posts_where_paged.html"><span class="hook-func">apply_filters_ref_array</span>( ‘posts_where_paged’, <nobr><span class="arg-type">string</span> <span class="arg-name">$where</span></nobr>, <nobr><span class="arg-type">WP_Query</span> <span class="arg-name">$query</span></nobr> )</a></dt>
<dd>
<p>Filters the WHERE clause of the query.</p> </dd>
<dt class="wp-block-wporg-code-reference-title has-normal-font-size"><a href="../../hooks/posts_where_request.html"><span class="hook-func">apply_filters_ref_array</span>( ‘posts_where_request’, <nobr><span class="arg-type">string</span> <span class="arg-name">$where</span></nobr>, <nobr><span class="arg-type">WP_Query</span> <span class="arg-name">$query</span></nobr> )</a></dt>
<dd>
<p>Filters the WHERE clause of the query.</p> </dd>
<dt class="wp-block-wporg-code-reference-title has-normal-font-size"><a href="../../hooks/post_limits.html"><span class="hook-func">apply_filters_ref_array</span>( ‘post_limits’, <nobr><span class="arg-type">string</span> <span class="arg-name">$limits</span></nobr>, <nobr><span class="arg-type">WP_Query</span> <span class="arg-name">$query</span></nobr> )</a></dt>
<dd>
<p>Filters the LIMIT clause of the query.</p> </dd>
<dt class="wp-block-wporg-code-reference-title has-normal-font-size"><a href="../../hooks/post_limits_request.html"><span class="hook-func">apply_filters_ref_array</span>( ‘post_limits_request’, <nobr><span class="arg-type">string</span> <span class="arg-name">$limits</span></nobr>, <nobr><span class="arg-type">WP_Query</span> <span class="arg-name">$query</span></nobr> )</a></dt>
<dd>
<p>Filters the LIMIT clause of the query.</p> </dd>
<dt class="wp-block-wporg-code-reference-title has-normal-font-size"><a href="../../hooks/pre_get_posts.html"><span class="hook-func">do_action_ref_array</span>( ‘pre_get_posts’, <nobr><span class="arg-type">WP_Query</span> <span class="arg-name">$query</span></nobr> )</a></dt>
<dd>
<p>Fires after the query variable object is created, but before the actual query is run.</p> </dd>
<dt class="wp-block-wporg-code-reference-title has-normal-font-size"><a href="../../hooks/split_the_query.html"><span class="hook-func">apply_filters</span>( ‘split_the_query’, <nobr><span class="arg-type">bool</span> <span class="arg-name">$split_the_query</span></nobr>, <nobr><span class="arg-type">WP_Query</span> <span class="arg-name">$query</span></nobr>, <nobr><span class="arg-type">string</span> <span class="arg-name">$old_request</span></nobr>, <nobr><span class="arg-type">string[]</span> <span class="arg-name">$clauses</span></nobr> )</a></dt>
<dd>
<p>Filters whether to split the query.</p> </dd>
<dt class="wp-block-wporg-code-reference-title has-normal-font-size"><a href="../../hooks/the_posts.html"><span class="hook-func">apply_filters_ref_array</span>( ‘the_posts’, <nobr><span class="arg-type">WP_Post[]</span> <span class="arg-name">$posts</span></nobr>, <nobr><span class="arg-type">WP_Query</span> <span class="arg-name">$query</span></nobr> )</a></dt>
<dd>
<p>Filters the array of retrieved posts after they’ve been fetched and internally processed.</p> </dd>
<dt class="wp-block-wporg-code-reference-title has-normal-font-size"><a href="../../hooks/the_preview.html"><span class="hook-func">apply_filters_ref_array</span>( ‘the_preview’, <nobr><span class="arg-type">WP_Post</span> <span class="arg-name">$post_preview</span></nobr>, <nobr><span class="arg-type">WP_Query</span> <span class="arg-name">$query</span></nobr> )</a></dt>
<dd>
<p>Filters the single post for preview mode.</p> </dd>
<dt class="wp-block-wporg-code-reference-title has-normal-font-size"><a href="../../hooks/wp_allow_query_attachment_by_filename.html"><span class="hook-func">apply_filters</span>( ‘wp_allow_query_attachment_by_filename’, <nobr><span class="arg-type">bool</span> <span class="arg-name">$allow_query_attachment_by_filename</span></nobr> )</a></dt>
<dd>
<p>Filters whether an attachment query should include filenames or not.</p> </dd>
</dl></section>  <section><h2 id="changelog">Changelog</h2> <section style="margin-top:var(--wp--preset--spacing--20);"><figure class="wp-block-table "><table>
<thead><tr>
<th scope="col">Version</th>
<th scope="col">Description</th>
</tr></thead>
<tbody><tr class="">
<td><a href="https://developer.wordpress.org/reference/since/1.5.0/">1.5.0</a></td>
<td>Introduced.</td>
</tr></tbody>
</table></figure></section> </section><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2003&ndash;2024 WordPress Foundation<br>Licensed under the GNU GPLv2+ License.<br>
    <a href="https://developer.wordpress.org/reference/classes/wp_query/get_posts" class="_attribution-link">https://developer.wordpress.org/reference/classes/wp_query/get_posts</a>
  </p>
</div>
