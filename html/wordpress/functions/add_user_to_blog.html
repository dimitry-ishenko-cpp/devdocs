<h1>add_user_to_blog( int $blog_id, int $user_id, string $role ): true|WP_Error</h1>  <section> <p>Adds a user to a blog, along with specifying the user’s role.</p> </section>   <section> <header class="toc-header"><h2 id="description">Description</h2></header> <p>Use the <a href="../hooks/add_user_to_blog.html">‘add_user_to_blog’</a> action to fire an event when users are added to a blog.</p> </section>  <section> <header class="toc-header"><h2 id="parameters">Parameters</h2></header> <dl> <dt> <code>$blog_id</code> <span class="type"><span class="int">int</span></span> <span class="required">Required</span> </dt> <dd> <div class="desc"> <span class="description">ID of the blog the user is being added to.</span> </div> </dd> <dt> <code>$user_id</code> <span class="type"><span class="int">int</span></span> <span class="required">Required</span> </dt> <dd> <div class="desc"> <span class="description">ID of the user being added.</span> </div> </dd> <dt> <code>$role</code> <span class="type"><span class="string">string</span></span> <span class="required">Required</span> </dt> <dd> <div class="desc"> <span class="description">The role you want the user to have.</span> </div> </dd> </dl> </section>  <section> <header class="toc-header"><h2 id="return">Return</h2></header> <p><span class="return-type">true|<a href="../classes/wp_error.html" rel="class">WP_Error</a></span> True on success or a <a href="../classes/wp_error.html" rel="class">WP_Error</a> object if the user doesn't exist or could not be added.</p> </section>  <section> <header class="toc-header"><h2 id="more-information">More Information</h2></header> <ul> <li>It does not check if the user is already a member of the blog before setting their role. If you don’t want to overwrite the role of a user if they are already a member of the blog, use <a href="is_user_member_of_blog.html" rel="function">is_user_member_of_blog()</a> to check that first.</li> <li>You <em>do not</em> need to call <a href="switch_to_blog.html" rel="function">switch_to_blog()</a> to switch to the blog you want to add the user to before calling this function. The function will switch to the blog itself, and restore the current blog before returning as well.</li> </ul> </section>  <section> <header class="toc-header"><h2 id="source">Source</h2></header> <p> File: <code>wp-includes/ms-functions.php</code>. <a href="https://developer.wordpress.org/reference/files/wp-includes/ms-functions.php/">View all references</a> </p> <pre class="wp-block-code" data-start="152" aria-label="Function source code" data-language="php"><code lang="php" class="language-php line-numbers">function add_user_to_blog( $blog_id, $user_id, $role ) {
	switch_to_blog( $blog_id );

	$user = get_userdata( $user_id );

	if ( ! $user ) {
		restore_current_blog();
		return new WP_Error( 'user_does_not_exist', __( 'The requested user does not exist.' ) );
	}

	/**
	 * Filters whether a user should be added to a site.
	 *
	 * @since 4.9.0
	 *
	 * @param true|WP_Error $retval  True if the user should be added to the site, error
	 *                               object otherwise.
	 * @param int           $user_id User ID.
	 * @param string        $role    User role.
	 * @param int           $blog_id Site ID.
	 */
	$can_add_user = apply_filters( 'can_add_user_to_blog', true, $user_id, $role, $blog_id );

	if ( true !== $can_add_user ) {
		restore_current_blog();

		if ( is_wp_error( $can_add_user ) ) {
			return $can_add_user;
		}

		return new WP_Error( 'user_cannot_be_added', __( 'User cannot be added to this site.' ) );
	}

	if ( ! get_user_meta( $user_id, 'primary_blog', true ) ) {
		update_user_meta( $user_id, 'primary_blog', $blog_id );
		$site = get_site( $blog_id );
		update_user_meta( $user_id, 'source_domain', $site-&gt;domain );
	}

	$user-&gt;set_role( $role );

	/**
	 * Fires immediately after a user is added to a site.
	 *
	 * @since MU (3.0.0)
	 *
	 * @param int    $user_id User ID.
	 * @param string $role    User role.
	 * @param int    $blog_id Blog ID.
	 */
	do_action( 'add_user_to_blog', $user_id, $role, $blog_id );

	clean_user_cache( $user_id );
	wp_cache_delete( $blog_id . '_user_count', 'blog-details' );

	restore_current_blog();

	return true;
}
</code></pre>  </section>  <section> <header class="toc-header"><h2 id="hooks">Hooks</h2></header> <article class="hooks"> <dl> <dt class="signature-highlight"> <a href="../hooks/add_user_to_blog.html" style="text-decoration: none"> <span class="hook-func">do_action</span>( 'add_user_to_blog', <nobr><span class="arg-type">int</span> <span class="arg-name">$user_id</span></nobr>, <nobr><span class="arg-type">string</span> <span class="arg-name">$role</span></nobr>, <nobr><span class="arg-type">int</span> <span class="arg-name">$blog_id</span></nobr> ) </a> </dt> <dd class="hook-desc"> 
<p>Fires immediately after a user is added to a site.</p> </dd> </dl> <dl> <dt class="signature-highlight"> <a href="../hooks/can_add_user_to_blog.html" style="text-decoration: none"> <span class="hook-func">apply_filters</span>( 'can_add_user_to_blog', <nobr><span class="arg-type">true|WP_Error</span> <span class="arg-name">$retval</span></nobr>, <nobr><span class="arg-type">int</span> <span class="arg-name">$user_id</span></nobr>, <nobr><span class="arg-type">string</span> <span class="arg-name">$role</span></nobr>, <nobr><span class="arg-type">int</span> <span class="arg-name">$blog_id</span></nobr> ) </a> </dt> <dd class="hook-desc"> 
<p>Filters whether a user should be added to a site.</p> </dd> </dl> </article> </section>  <section> <header class="toc-header"><h2 id="related">Related</h2></header> <article class="uses"> <header class="toc-header"><h3 id="uses">Uses</h3></header> <table id="uses-table" data-show="5">  <thead> <tr> <th>Uses</th> <th class="related-desc">Description</th> </tr> </thead> <tbody> <tr> <td class="related-title"> <a href="get_site.html">get_site()</a> <span>wp-includes/ms-site.php</span> </td> <td class="related-desc"> <p>Retrieves site data given a site ID or site object.</p> </td> </tr> <tr> <td class="related-title"> <a href="wp_cache_delete.html">wp_cache_delete()</a> <span>wp-includes/cache.php</span> </td> <td class="related-desc"> <p>Removes the cache contents matching key and group.</p> </td> </tr> <tr> <td class="related-title"> <a href="clean_user_cache.html">clean_user_cache()</a> <span>wp-includes/user.php</span> </td> <td class="related-desc"> <p>Cleans all user caches.</p> </td> </tr> <tr> <td class="related-title"> <a href="get_user_meta.html">get_user_meta()</a> <span>wp-includes/user.php</span> </td> <td class="related-desc"> <p>Retrieves user meta field for a user.</p> </td> </tr> <tr> <td class="related-title"> <a href="update_user_meta.html">update_user_meta()</a> <span>wp-includes/user.php</span> </td> <td class="related-desc"> <p>Updates user meta field based on user ID.</p> </td> </tr> <tr> <td class="related-title"> <a href="switch_to_blog.html">switch_to_blog()</a> <span>wp-includes/ms-blogs.php</span> </td> <td class="related-desc"> <p>Switch the current blog.</p> </td> </tr> <tr> <td class="related-title"> <a href="restore_current_blog.html">restore_current_blog()</a> <span>wp-includes/ms-blogs.php</span> </td> <td class="related-desc"> <p>Restore the current blog, after calling <a href="switch_to_blog.html" rel="function">switch_to_blog()</a> .</p> </td> </tr> <tr> <td class="related-title"> <a href="__.html">__()</a> <span>wp-includes/l10n.php</span> </td> <td class="related-desc"> <p>Retrieves the translation of $text.</p> </td> </tr> <tr> <td class="related-title"> <a href="get_userdata.html">get_userdata()</a> <span>wp-includes/pluggable.php</span> </td> <td class="related-desc"> <p>Retrieves user info by user ID.</p> </td> </tr> <tr> <td class="related-title"> <a href="apply_filters.html">apply_filters()</a> <span>wp-includes/plugin.php</span> </td> <td class="related-desc"> <p>Calls the callback functions that have been added to a filter hook.</p> </td> </tr> <tr> <td class="related-title"> <a href="do_action.html">do_action()</a> <span>wp-includes/plugin.php</span> </td> <td class="related-desc"> <p>Calls the callback functions that have been added to an action hook.</p> </td> </tr> <tr> <td class="related-title"> <a href="is_wp_error.html">is_wp_error()</a> <span>wp-includes/load.php</span> </td> <td class="related-desc"> <p>Checks whether the given variable is a WordPress Error.</p> </td> </tr> <tr> <td class="related-title"> <a href="../classes/wp_error/__construct.html">WP_Error::__construct()</a> <span>wp-includes/class-wp-error.php</span> </td> <td class="related-desc"> <p>Initializes the error.</p> </td> </tr> </tbody>

</table>   </article>  <article class="used-by"> <header class="toc-header"><h3 id="used-by">Used By</h3></header> <table id="used-by-table" data-show="5">  <thead> <tr> <th>Used By</th> <th class="related-desc">Description</th> </tr> </thead> <tbody> <tr> <td class="related-title"> <a href="wp_initialize_site.html">wp_initialize_site()</a> <span>wp-includes/ms-site.php</span> </td> <td class="related-desc"> <p>Runs the initialization routine for a given site.</p> </td> </tr> <tr> <td class="related-title"> <a href="../classes/wp_rest_users_controller/create_item.html">WP_REST_Users_Controller::create_item()</a> <span>wp-includes/rest-api/endpoints/class-wp-rest-users-controller.php</span> </td> <td class="related-desc"> <p>Creates a single user.</p> </td> </tr> <tr> <td class="related-title"> <a href="add_existing_user_to_blog.html">add_existing_user_to_blog()</a> <span>wp-includes/ms-functions.php</span> </td> <td class="related-desc"> <p>Adds a user to a blog based on details from <a href="maybe_add_existing_user_to_blog.html" rel="function">maybe_add_existing_user_to_blog()</a> .</p> </td> </tr> <tr> <td class="related-title"> <a href="add_new_user_to_blog.html">add_new_user_to_blog()</a> <span>wp-includes/ms-functions.php</span> </td> <td class="related-desc"> <p>Adds a newly created user to the appropriate blog</p> </td> </tr> <tr> <td class="related-title"> <a href="get_active_blog_for_user.html">get_active_blog_for_user()</a> <span>wp-includes/ms-functions.php</span> </td> <td class="related-desc"> <p>Gets one of a user’s active blogs.</p> </td> </tr> </tbody>

</table> </article> </section>  <section> <header class="toc-header"><h2 id="changelog">Changelog</h2></header> <table>  <thead> <tr> <th class="changelog-version">Version</th> <th class="changelog-desc">Description</th> </tr> </thead> <tbody> <tr> <td><a href="https://developer.wordpress.org/reference/since/mu.3.0.0/" alt="WordPress MU (3.0.0)">MU (3.0.0)</a></td> <td>Introduced.</td> </tr> </tbody> </table> </section><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2003&ndash;2022 WordPress Foundation<br>Licensed under the GNU GPLv2+ License.<br>
    <a href="https://developer.wordpress.org/reference/functions/add_user_to_blog" class="_attribution-link">https://developer.wordpress.org/reference/functions/add_user_to_blog</a>
  </p>
</div>
