<h1>compression_test()</h1>  <section> <p>Tests support for compressing JavaScript from PHP.</p> </section>   <section> <header class="toc-header"><h2 id="description">Description</h2></header> <p>Outputs JavaScript that tests if compression from PHP works as expected and sets an option with the result. Has no effect when the current user is not an administrator. To run the test again the option ‘can_compress_scripts’ has to be deleted.</p> </section>  <section> <header class="toc-header"><h2 id="source">Source</h2></header> <p> File: <code>wp-admin/includes/template.php</code>. <a href="https://developer.wordpress.org/reference/files/wp-admin/includes/template.php/">View all references</a> </p> <pre class="wp-block-code" data-start="2417" aria-label="Function source code" data-language="php"><code lang="php" class="language-php line-numbers">function compression_test() {
	?&gt;
	&lt;script type="text/javascript"&gt;
	var compressionNonce = &lt;?php echo wp_json_encode( wp_create_nonce( 'update_can_compress_scripts' ) ); ?&gt;;
	var testCompression = {
		get : function(test) {
			var x;
			if ( window.XMLHttpRequest ) {
				x = new XMLHttpRequest();
			} else {
				try{x=new ActiveXObject('Msxml2.XMLHTTP');}catch(e){try{x=new ActiveXObject('Microsoft.XMLHTTP');}catch(e){};}
			}

			if (x) {
				x.onreadystatechange = function() {
					var r, h;
					if ( x.readyState == 4 ) {
						r = x.responseText.substr(0, 18);
						h = x.getResponseHeader('Content-Encoding');
						testCompression.check(r, h, test);
					}
				};

				x.open('GET', ajaxurl + '?action=wp-compression-test&amp;test='+test+'&amp;_ajax_nonce='+compressionNonce+'&amp;'+(new Date()).getTime(), true);
				x.send('');
			}
		},

		check : function(r, h, test) {
			if ( ! r &amp;&amp; ! test )
				this.get(1);

			if ( 1 == test ) {
				if ( h &amp;&amp; ( h.match(/deflate/i) || h.match(/gzip/i) ) )
					this.get('no');
				else
					this.get(2);

				return;
			}

			if ( 2 == test ) {
				if ( '"wpCompressionTest' === r )
					this.get('yes');
				else
					this.get('no');
			}
		}
	};
	testCompression.check();
	&lt;/script&gt;
	&lt;?php
}
</code></pre>  </section>  <section> <header class="toc-header"><h2 id="related">Related</h2></header> <article class="uses"> <header class="toc-header"><h3 id="uses">Uses</h3></header> <table id="uses-table" data-show="2">  <thead> <tr> <th>Uses</th> <th class="related-desc">Description</th> </tr> </thead> <tbody> <tr> <td class="related-title"> <a href="wp_create_nonce.html">wp_create_nonce()</a> <span>wp-includes/pluggable.php</span> </td> <td class="related-desc"> <p>Creates a cryptographic token tied to a specific action, user, user session, and window of time.</p> </td> </tr> <tr> <td class="related-title"> <a href="wp_json_encode.html">wp_json_encode()</a> <span>wp-includes/functions.php</span> </td> <td class="related-desc"> <p>Encodes a variable into JSON, with some sanity checks.</p> </td> </tr> </tbody>

</table> </article> </section>  <section> <header class="toc-header"><h2 id="changelog">Changelog</h2></header> <table>  <thead> <tr> <th class="changelog-version">Version</th> <th class="changelog-desc">Description</th> </tr> </thead> <tbody> <tr> <td><a href="https://developer.wordpress.org/reference/since/2.8.0/" alt="WordPress 2.8.0">2.8.0</a></td> <td>Introduced.</td> </tr> </tbody> </table> </section><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2003&ndash;2022 WordPress Foundation<br>Licensed under the GNU GPLv2+ License.<br>
    <a href="https://developer.wordpress.org/reference/functions/compression_test" class="_attribution-link">https://developer.wordpress.org/reference/functions/compression_test</a>
  </p>
</div>
