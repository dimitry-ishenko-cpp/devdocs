<h1 id="backend-configuration">  Backend Configuration </h1> <p>Backends are configured directly in Terraform files in the <code>terraform</code> section. After configuring a backend, it has to be <a href="init.html">initialized</a>.</p> <p>Below, we show a complete example configuring the "consul" backend:</p> <pre data-language="ruby">terraform {
  backend "consul" {
    address = "demo.consul.io"
    scheme  = "https"
    path    = "example_app/terraform_state"
  }
}
</pre>
<p>You specify the backend type as a key to the <code>backend</code> stanza. Within the stanza are backend-specific configuration keys. The list of supported backends and their configuration is in the sidebar to the left.</p> <p>Only one backend may be specified and the configuration <strong>may not contain interpolations</strong>. Terraform will validate this.</p> <h2 id="first-time-configuration">  First Time Configuration </h2> <p>When configuring a backend for the first time (moving from no defined backend to explicitly configuring one), Terraform will give you the option to migrate your state to the new backend. This lets you adopt backends without losing any existing state.</p> <p>To be extra careful, we always recommend manually backing up your state as well. You can do this by simply copying your <code>terraform.tfstate</code> file to another location. The initialization process should create a backup as well, but it never hurts to be safe!</p> <p>Configuring a backend for the first time is no different than changing a configuration in the future: create the new configuration and run <code>terraform init</code>. Terraform will guide you the rest of the way.</p> <h2 id="partial-configuration">  Partial Configuration </h2> <p>You do not need to specify every required argument in the backend configuration. Omitting certain arguments may be desirable to avoid storing secrets, such as access keys, within the main configuration. When some or all of the arguments are omitted, we call this a <em>partial configuration</em>.</p> <p>With a partial configuration, the remaining configuration arguments must be provided as part of <a href="init.html#backend-initialization">the initialization process</a>. There are several ways to supply the remaining arguments:</p> <ul> <li>
<p><strong>Interactively</strong>: Terraform will interactively ask you for the required values, unless interactive input is disabled. Terraform will not prompt for optional values.</p> </li> <li>
<p><strong>File</strong>: A configuration file may be specified via the <code>init</code> command line. To specify a file, use the <code>-backend-config=PATH</code> option when running <code>terraform init</code>. If the file contains secrets it may be kept in a secure data store, such as <a href="https://www.vaultproject.io/">Vault</a>, in which case it must be downloaded to the local disk before running Terraform.</p> </li> <li>
<p><strong>Command-line key/value pairs</strong>: Key/value pairs can be specified via the <code>init</code> command line. Note that many shells retain command-line flags in a history file, so this isn't recommended for secrets. To specify a single key/value pair, use the <code>-backend-config="KEY=VALUE"</code> option when running <code>terraform init</code>.</p> </li> </ul> <p>If backend settings are provided in multiple locations, the top-level settings are merged such that any command-line options override the settings in the main configuration and then the command-line options are processed in order, with later options overriding values set by earlier options.</p> <p>The final, merged configuration is stored on disk in the <code>.terraform</code> directory, which should be ignored from version control. This means that sensitive information can be omitted from version control, but it will be present in plain text on local disk when running Terraform.</p> <p>When using partial configuration, Terraform requires at a minimum that an empty backend configuration is specified in one of the root Terraform configuration files, to specify the backend type. For example:</p> <pre data-language="ruby">terraform {
  backend "consul" {}
}
</pre>
<p>A backend configuration file has the contents of the <code>backend</code> block as top-level attributes, without the need to wrap it in another <code>terraform</code> or <code>backend</code> block:</p> <pre data-language="ruby">address = "demo.consul.io"
path    = "example_app/terraform_state"
scheme  = "https"
</pre>
<p>The same settings can alternatively be specified on the command line as follows:</p> <pre>$ terraform init \
    -backend-config="address=demo.consul.io" \
    -backend-config="path=example_app/terraform_state" \
    -backend-config="scheme=https"
</pre>
<h2 id="changing-configuration">  Changing Configuration </h2> <p>You can change your backend configuration at any time. You can change both the configuration itself as well as the type of backend (for example from "consul" to "s3").</p> <p>Terraform will automatically detect any changes in your configuration and request a <a href="init.html">reinitialization</a>. As part of the reinitialization process, Terraform will ask if you'd like to migrate your existing state to the new configuration. This allows you to easily switch from one backend to another.</p> <p>If you're using multiple <a href="../state/workspaces.html">workspaces</a>, Terraform can copy all workspaces to the destination. If Terraform detects you have multiple workspaces, it will ask if this is what you want to do.</p> <p>If you're just reconfiguring the same backend, Terraform will still ask if you want to migrate your state. You can respond "no" in this scenario.</p> <h2 id="unconfiguring-a-backend">  Unconfiguring a Backend </h2> <p>If you no longer want to use any backend, you can simply remove the configuration from the file. Terraform will detect this like any other change and prompt you to <a href="init.html">reinitialize</a>.</p> <p>As part of the reinitialization, Terraform will ask if you'd like to migrate your state back down to normal local state. Once this is complete then Terraform is back to behaving as it does by default.</p><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2018 HashiCorp</br>Licensed under the MPL 2.0 License.<br>
    <a href="https://www.terraform.io/docs/backends/config.html" class="_attribution-link">https://www.terraform.io/docs/backends/config.html</a>
  </p>
</div>
