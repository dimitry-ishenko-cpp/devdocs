<h1 id="aws_rds_cluster">  aws_rds_cluster </h1> <p>Provides an RDS Cluster Resource. A Cluster Resource defines attributes that are applied to the entire cluster of <a href="rds_cluster_instance.html">RDS Cluster Instances</a>. Use the RDS Cluster resource and RDS Cluster Instances to create and use Amazon Aurora, a MySQL-compatible database engine.</p> <p>For more information on Amazon Aurora, see <a href="https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/CHAP_Aurora.html">Aurora on Amazon RDS</a> in the Amazon RDS User Guide.</p> <p>For information on the difference between the available Aurora MySQL engines see <a href="https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/AuroraMySQL.Updates.20180206.html">Comparison between Aurora MySQL 1 and Aurora MySQL 2</a> in the Amazon RDS User Guide.</p> <p>Changes to a RDS Cluster can occur when you manually change a parameter, such as <code>port</code>, and are reflected in the next maintenance window. Because of this, Terraform may report a difference in its planning phase because a modification has not yet taken place. You can use the <code>apply_immediately</code> flag to instruct the service to apply the change immediately (see documentation below).</p> <blockquote class="alert alert-warning" role="alert"> <p><strong>Note:</strong> using <code>apply_immediately</code> can result in a brief downtime as the server reboots. See the AWS Docs on <a href="https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_UpgradeDBInstance.Maintenance.html">RDS Maintenance</a> for more information.</p> </blockquote> <blockquote class="alert alert-warning" role="alert"> <p><strong>Note:</strong> All arguments including the username and password will be stored in the raw state as plain-text. <a href="../../../state/sensitive-data.html">Read more about sensitive data in state</a>.</p> </blockquote> <h2 id="example-usage">  Example Usage </h2> <h3 id="aurora-mysql-2-x-mysql-5-7-">  Aurora MySQL 2.x (MySQL 5.7) </h3> <pre data-language="ruby">resource "aws_rds_cluster" "default" {
  cluster_identifier      = "aurora-cluster-demo"
  engine                  = "aurora-mysql"
  availability_zones      = ["us-west-2a", "us-west-2b", "us-west-2c"]
  database_name           = "mydb"
  master_username         = "foo"
  master_password         = "bar"
  backup_retention_period = 5
  preferred_backup_window = "07:00-09:00"
}
</pre>
<h3 id="aurora-mysql-1-x-mysql-5-6-">  Aurora MySQL 1.x (MySQL 5.6) </h3> <pre data-language="ruby">resource "aws_rds_cluster" "default" {
  cluster_identifier      = "aurora-cluster-demo"
  availability_zones      = ["us-west-2a", "us-west-2b", "us-west-2c"]
  database_name           = "mydb"
  master_username         = "foo"
  master_password         = "bar"
  backup_retention_period = 5
  preferred_backup_window = "07:00-09:00"
}
</pre>
<h3 id="aurora-with-postgresql-engine">  Aurora with PostgreSQL engine </h3> <pre data-language="ruby">resource "aws_rds_cluster" "postgresql" {
  cluster_identifier      = "aurora-cluster-demo"
  engine                  = "aurora-postgresql"
  availability_zones      = ["us-west-2a", "us-west-2b", "us-west-2c"]
  database_name           = "mydb"
  master_username         = "foo"
  master_password         = "bar"
  backup_retention_period = 5
  preferred_backup_window = "07:00-09:00"
}
</pre>
<h2 id="argument-reference">  Argument Reference </h2> <p>For more detailed documentation about each argument, refer to the <a href="https://docs.aws.amazon.com/cli/latest/reference/rds/create-db-cluster.html">AWS official documentation</a>.</p> <p>The following arguments are supported:</p> <ul> <li>
<a href="#cluster_identifier"><code>cluster_identifier</code></a> - (Optional, Forces new resources) The cluster identifier. If omitted, Terraform will assign a random, unique identifier. </li> <li>
<a href="#cluster_identifier_prefix"><code>cluster_identifier_prefix</code></a> - (Optional, Forces new resource) Creates a unique cluster identifier beginning with the specified prefix. Conflicts with <code>cluster_identifer</code>. </li> <li>
<a href="#database_name"><code>database_name</code></a> - (Optional) Name for an automatically created database on cluster creation. There are different naming restrictions per database engine: <a href="http://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/CHAP_Limits.html#RDS_Limits.Constraints">RDS Naming Constraints</a> </li> <li>
<a href="#master_password"><code>master_password</code></a> - (Required unless a <code>snapshot_identifier</code> is provided) Password for the master DB user. Note that this may show up in logs, and it will be stored in the state file. Please refer to the <a href="http://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/CHAP_Limits.html#RDS_Limits.Constraints">RDS Naming Constraints</a> </li> <li>
<a href="#master_username"><code>master_username</code></a> - (Required unless a <code>snapshot_identifier</code> is provided) Username for the master DB user. Please refer to the <a href="http://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/CHAP_Limits.html#RDS_Limits.Constraints">RDS Naming Constraints</a> </li> <li>
<a href="#final_snapshot_identifier"><code>final_snapshot_identifier</code></a> - (Optional) The name of your final DB snapshot when this DB cluster is deleted. If omitted, no final snapshot will be made. </li> <li>
<a href="#skip_final_snapshot"><code>skip_final_snapshot</code></a> - (Optional) Determines whether a final DB snapshot is created before the DB cluster is deleted. If true is specified, no DB snapshot is created. If false is specified, a DB snapshot is created before the DB cluster is deleted, using the value from <code>final_snapshot_identifier</code>. Default is <code>false</code>. </li> <li>
<a href="#availability_zones"><code>availability_zones</code></a> - (Optional) A list of EC2 Availability Zones that instances in the DB cluster can be created in </li> <li>
<a href="#backtrack_window"><code>backtrack_window</code></a> - (Optional) The target backtrack window, in seconds. Only available for <code>aurora</code> engine currently. To disable backtracking, set this value to <code>0</code>. Defaults to <code>0</code>. Must be between <code>0</code> and <code>259200</code> (72 hours) </li> <li>
<a href="#backup_retention_period"><code>backup_retention_period</code></a> - (Optional) The days to retain backups for. Default <code>1</code> </li> <li>
<a href="#preferred_backup_window"><code>preferred_backup_window</code></a> - (Optional) The daily time range during which automated backups are created if automated backups are enabled using the BackupRetentionPeriod parameter.Time in UTC Default: A 30-minute window selected at random from an 8-hour block of time per region. e.g. 04:00-09:00 </li> <li>
<a href="#preferred_maintenance_window"><code>preferred_maintenance_window</code></a> - (Optional) The weekly time range during which system maintenance can occur, in (UTC) e.g. wed:04:00-wed:04:30 </li> <li>
<a href="#port"><code>port</code></a> - (Optional) The port on which the DB accepts connections </li> <li>
<a href="#vpc_security_group_ids"><code>vpc_security_group_ids</code></a> - (Optional) List of VPC security groups to associate with the Cluster </li> <li>
<a href="#snapshot_identifier"><code>snapshot_identifier</code></a> - (Optional) Specifies whether or not to create this cluster from a snapshot. You can use either the name or ARN when specifying a DB cluster snapshot, or the ARN when specifying a DB snapshot. </li> <li>
<a href="#storage_encrypted"><code>storage_encrypted</code></a> - (Optional) Specifies whether the DB cluster is encrypted. The default is <code>false</code> if not specified. </li> <li>
<a href="#replication_source_identifier"><code>replication_source_identifier</code></a> - (Optional) ARN of a source DB cluster or DB instance if this DB cluster is to be created as a Read Replica. </li> <li>
<a href="#apply_immediately"><code>apply_immediately</code></a> - (Optional) Specifies whether any cluster modifications are applied immediately, or during the next maintenance window. Default is <code>false</code>. See <a href="https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Overview.DBInstance.Modifying.html">Amazon RDS Documentation for more information.</a> </li> <li>
<a href="#db_subnet_group_name"><code>db_subnet_group_name</code></a> - (Optional) A DB subnet group to associate with this DB instance. <strong>NOTE:</strong> This must match the <code>db_subnet_group_name</code> specified on every <a href="rds_cluster_instance.html"><code>aws_rds_cluster_instance</code></a> in the cluster. </li> <li>
<a href="#db_cluster_parameter_group_name"><code>db_cluster_parameter_group_name</code></a> - (Optional) A cluster parameter group to associate with the cluster. </li> <li>
<a href="#kms_key_id"><code>kms_key_id</code></a> - (Optional) The ARN for the KMS encryption key. When specifying <code>kms_key_id</code>, <code>storage_encrypted</code> needs to be set to true. </li> <li>
<a href="#iam_roles"><code>iam_roles</code></a> - (Optional) A List of ARNs for the IAM roles to associate to the RDS Cluster. </li> <li>
<a href="#iam_database_authentication_enabled"><code>iam_database_authentication_enabled</code></a> - (Optional) Specifies whether or mappings of AWS Identity and Access Management (IAM) accounts to database accounts is enabled. </li> <li>
<a href="#engine"><code>engine</code></a> - (Optional) The name of the database engine to be used for this DB cluster. Defaults to <code>aurora</code>. Valid Values: <code>aurora</code>, <code>aurora-mysql</code>, <code>aurora-postgresql</code> </li> <li>
<a href="#engine_version"><code>engine_version</code></a> - (Optional) The database engine version. </li> <li>
<a href="#source_region"><code>source_region</code></a> - (Optional) The source region for an encrypted replica DB cluster. </li> <li>
<a href="#enabled_cloudwatch_logs_exports"><code>enabled_cloudwatch_logs_exports</code></a> - (Optional) List of log types to export to cloudwatch. If omitted, no logs will be exported. The following log types are supported: <code>audit</code>, <code>error</code>, <code>general</code>, <code>slowquery</code>. </li> <li>
<a href="#tags"><code>tags</code></a> - (Optional) A mapping of tags to assign to the DB cluster. </li> </ul> <h3 id="s3-import-options">  S3 Import Options </h3> <p>Full details on the core parameters and impacts are in the API Docs: <a href="https://docs.aws.amazon.com/AmazonRDS/latest/APIReference/API_RestoreDBClusterFromS3.html">RestoreDBClusterFromS3</a>. Requires that the S3 bucket be in the same region as the RDS cluster you're trying to create. Sample:</p> <pre data-language="ruby">resource "aws_rds_cluster" "db" {
  engine = "aurora"

  s3_import {
    source_engine = "mysql"
    source_engine_version = "5.6"
    bucket_name = "mybucket"
    bucket_prefix = "backups"
    ingestion_role = "arn:aws:iam::1234567890:role/role-xtrabackup-rds-restore"
  }
}
</pre> <ul> <li>
<a href="#bucket_name"><code>bucket_name</code></a> - (Required) The bucket name where your backup is stored </li> <li>
<a href="#bucket_prefix"><code>bucket_prefix</code></a> - (Optional) Can be blank, but is the path to your backup </li> <li>
<a href="#ingestion_role"><code>ingestion_role</code></a> - (Required) Role applied to load the data. </li> <li>
<a href="#source_engine"><code>source_engine</code></a> - (Required) Source engine for the backup </li> <li>
<a href="#source_engine_version"><code>source_engine_version</code></a> - (Required) Version of the source engine used to make the backup </li> </ul> <p>This will not recreate the resource if the S3 object changes in some way. It's only used to initialize the database. This only works currently with the aurora engine. See AWS for currently supported engines and options. See <a href="https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/AuroraMySQL.Migrating.ExtMySQL.html#AuroraMySQL.Migrating.ExtMySQL.S3">Aurora S3 Migration Docs</a>.</p> <h2 id="attributes-reference">  Attributes Reference </h2> <p>In addition to all arguments above, the following attributes are exported:</p> <ul> <li>
<a href="#id"><code>id</code></a> - The RDS Cluster Identifier </li> <li>
<a href="#cluster_identifier-1"><code>cluster_identifier</code></a> - The RDS Cluster Identifier </li> <li>
<a href="#cluster_resource_id"><code>cluster_resource_id</code></a> - The RDS Cluster Resource ID </li> <li>
<a href="#cluster_members"><code>cluster_members</code></a> – List of RDS Instances that are a part of this cluster </li> <li>
<a href="#allocated_storage"><code>allocated_storage</code></a> - The amount of allocated storage </li> <li>
<a href="#availability_zones-1"><code>availability_zones</code></a> - The availability zone of the instance </li> <li>
<a href="#backup_retention_period-1"><code>backup_retention_period</code></a> - The backup retention period </li> <li>
<a href="#preferred_backup_window-1"><code>preferred_backup_window</code></a> - The daily time range during which the backups happen </li> <li>
<a href="#preferred_maintenance_window-1"><code>preferred_maintenance_window</code></a> - The maintenance window </li> <li>
<a href="#endpoint"><code>endpoint</code></a> - The DNS address of the RDS instance </li> <li>
<a href="#reader_endpoint"><code>reader_endpoint</code></a> - A read-only endpoint for the Aurora cluster, automatically load-balanced across replicas </li> <li>
<a href="#engine-1"><code>engine</code></a> - The database engine </li> <li>
<a href="#engine_version-1"><code>engine_version</code></a> - The database engine version </li> <li>
<a href="#maintenance_window"><code>maintenance_window</code></a> - The instance maintenance window </li> <li>
<a href="#database_name-1"><code>database_name</code></a> - The database name </li> <li>
<a href="#port-1"><code>port</code></a> - The database port </li> <li>
<a href="#status"><code>status</code></a> - The RDS instance status </li> <li>
<a href="#master_username-1"><code>master_username</code></a> - The master username for the database </li> <li>
<a href="#storage_encrypted-1"><code>storage_encrypted</code></a> - Specifies whether the DB cluster is encrypted </li> <li>
<a href="#replication_source_identifier-1"><code>replication_source_identifier</code></a> - ARN of the source DB cluster or DB instance if this DB cluster is created as a Read Replica. </li> <li>
<a href="#hosted_zone_id"><code>hosted_zone_id</code></a> - The Route53 Hosted Zone ID of the endpoint </li> </ul> <h2 id="timeouts">  Timeouts </h2> <p><code>aws_rds_cluster</code> provides the following <a href="../../../configuration/resources.html#timeouts">Timeouts</a> configuration options:</p> <ul> <li>
<a href="#create"><code>create</code></a> - (Default <code>120 minutes</code>) Used for Cluster creation </li> <li>
<a href="#update"><code>update</code></a> - (Default <code>120 minutes</code>) Used for Cluster modifications </li> <li>
<a href="#delete"><code>delete</code></a> - (Default <code>120 minutes</code>) Used for destroying cluster. This includes any cleanup task during the destroying process. </li> </ul> <h2 id="import">  Import </h2> <p>RDS Clusters can be imported using the <code>cluster_identifier</code>, e.g.</p> <pre>$ terraform import aws_rds_cluster.aurora_cluster aurora-prod-cluster
</pre><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2018 HashiCorp</br>Licensed under the MPL 2.0 License.<br>
    <a href="https://www.terraform.io/docs/providers/aws/r/rds_cluster.html" class="_attribution-link">https://www.terraform.io/docs/providers/aws/r/rds_cluster.html</a>
  </p>
</div>
