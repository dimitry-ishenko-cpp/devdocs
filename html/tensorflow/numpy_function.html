<h1 class="devsite-page-title" tabindex="-1"> tf.numpy_function </h1> <devsite-feature-tooltip ack-key="AckCollectionsBookmarkTooltipDismiss" analytics-category="Site-Wide Custom Events" analytics-action-show="Callout Profile displayed" analytics-action-close="Callout Profile dismissed" analytics-label="Create Collection Callout" class="devsite-page-bookmark-tooltip nocontent" dismiss-button="true" id="devsite-collections-dropdown" dismiss-button-text="Dismiss" close-button-text="Got it">    </devsite-feature-tooltip> <div class="devsite-page-title-meta"><devsite-view-release-notes></devsite-view-release-notes></div>     <div itemscope itemtype="http://developers.google.com/ReferenceObject"> <meta itemprop="name" content="tf.numpy_function"> <meta itemprop="path" content="Stable"> </div>   <p>Wraps a python function and uses it as a TensorFlow op.</p> <section class="expandable"> <h4 class="showalways" id="view-aliases" data-text="View aliases" tabindex="-1">View aliases</h4> <p> <b>Compat aliases for migration</b> </p>
<p>See <a href="https://www.tensorflow.org/guide/migrate">Migration guide</a> for more details.</p> <p><a href="numpy_function.html"><code translate="no" dir="ltr">tf.compat.v1.numpy_function</code></a></p> </section> 
<devsite-code><pre class="devsite-click-to-copy tfo-signature-link" translate="no" dir="ltr" is-upgraded syntax="Python" data-language="cpp">tf.numpy_function(
    func=None, inp=None, Tout=None, stateful=True, name=None
)
</pre></devsite-code> <h3 id="used-in-the-notebooks" data-text="Used in the notebooks" tabindex="-1">Used in the notebooks</h3> <table class="vertical-rules"> <thead> <tr> <th>Used in the tutorials</th> </tr> </thead> <tbody> <tr> <td> <ul> <li><a href="https://www.tensorflow.org/tutorials/reinforcement_learning/actor_critic">Playing CartPole with the Actor-Critic method</a></li> </ul> </td> </tr> </tbody> </table> <p>Given a python function <code translate="no" dir="ltr">func</code> wrap this function as an operation in a <a href="function.html"><code translate="no" dir="ltr">tf.function</code></a>. <code translate="no" dir="ltr">func</code> must take numpy arrays as its arguments and return numpy arrays as its outputs.</p> <p>There are two ways to use <a href="numpy_function.html"><code translate="no" dir="ltr">tf.numpy_function</code></a>.</p> <h3 id="as_a_decorator" data-text="As a decorator" tabindex="-1">As a decorator</h3> <p>When using <a href="numpy_function.html"><code translate="no" dir="ltr">tf.numpy_function</code></a> as a decorator:</p> <ul> <li>you must set <code translate="no" dir="ltr">Tout</code>
</li> <li>you may set <code translate="no" dir="ltr">name</code>
</li> <li>you must not set <code translate="no" dir="ltr">func</code> or <code translate="no" dir="ltr">inp</code>
</li> </ul> 
<devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python" data-language="cpp">@tf.numpy_function(Tout=tf.float32)
def my_numpy_func(x):
  # x will be a numpy array with the contents of the input to the
  # tf.function
  print(f'executing eagerly, {x=}')
  return np.sinh(x)</pre></devsite-code> <p>The function runs eagerly:</p> 
<devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python" data-language="cpp">my_numpy_func(1.0).numpy()
executing eagerly, x=1.0
1.17520</pre></devsite-code> <p>The behavior doesn't change inside a <a href="function.html"><code translate="no" dir="ltr">tf.function</code></a>:</p> 
<devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python" data-language="cpp">@tf.function(input_signature=[tf.TensorSpec(None, tf.float32)])
def tf_function(input):
  y = tf.numpy_function(my_numpy_func, [input], tf.float32)
  return y
tf_function(tf.constant(1.)).numpy()
executing eagerly, x=array(1.)
1.17520</pre></devsite-code> <h3 id="inplace" data-text="Inplace" tabindex="-1">Inplace</h3> <p>This form can be useful if you don't control the function's source, but it is harder to read.</p> <p>Here is the same function with no decorator:</p> 
<devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python" data-language="cpp">def my_func(x):
  # x will be a numpy array with the contents of the input to the
  # tf.function
  print(f'executing eagerly, {x=}')
  return np.sinh(x)</pre></devsite-code> <p>To run <a href="numpy_function.html"><code translate="no" dir="ltr">tf.numpy_function</code></a> in-place, pass the function, its inputs, and the output type in a single call to <a href="numpy_function.html"><code translate="no" dir="ltr">tf.numpy_function</code></a>:</p> 
<devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python" data-language="cpp">tf.numpy_function(my_func, [tf.constant(1.0)], tf.float32)
executing eagerly, x=array(1.)
1.17520</pre></devsite-code> <h3 id="more_info" data-text="More info" tabindex="-1">More info</h3> <p>Comparison to <a href="py_function.html"><code translate="no" dir="ltr">tf.py_function</code></a>: <a href="py_function.html"><code translate="no" dir="ltr">tf.py_function</code></a> and <a href="numpy_function.html"><code translate="no" dir="ltr">tf.numpy_function</code></a> are very similar, except that <a href="numpy_function.html"><code translate="no" dir="ltr">tf.numpy_function</code></a> takes numpy arrays, and not <a href="tensor.html"><code translate="no" dir="ltr">tf.Tensor</code></a>s. If you want the function to contain <code translate="no" dir="ltr">tf.Tensors</code>, and have any TensorFlow operations executed in the function be differentiable, please use <a href="py_function.html"><code translate="no" dir="ltr">tf.py_function</code></a>.</p> <blockquote class="note">
<strong>Note:</strong><span> We recommend to avoid using <a href="numpy_function.html"><code translate="no" dir="ltr">tf.numpy_function</code></a> outside of prototyping and experimentation due to the following known limitations:</span>
</blockquote> <ul> <li><p>Calling <a href="numpy_function.html"><code translate="no" dir="ltr">tf.numpy_function</code></a> will acquire the Python Global Interpreter Lock (GIL) that allows only one thread to run at any point in time. This will preclude efficient parallelization and distribution of the execution of the program. Therefore, you are discouraged to use <a href="numpy_function.html"><code translate="no" dir="ltr">tf.numpy_function</code></a> outside of prototyping and experimentation.</p></li> <li><p>The body of the function (i.e. <code translate="no" dir="ltr">func</code>) will not be serialized in a <code translate="no" dir="ltr">tf.SavedModel</code>. Therefore, you should not use this function if you need to serialize your model and restore it in a different environment.</p></li> <li><p>The operation must run in the same address space as the Python program that calls <a href="numpy_function.html"><code translate="no" dir="ltr">tf.numpy_function()</code></a>. If you are using distributed TensorFlow, you must run a <a href="distribute/server.html"><code translate="no" dir="ltr">tf.distribute.Server</code></a> in the same process as the program that calls <a href="numpy_function.html"><code translate="no" dir="ltr">tf.numpy_function</code></a> you must pin the created operation to a device in that server (e.g. using <code translate="no" dir="ltr">with tf.device():</code>).</p></li> <li><p>Currently <a href="numpy_function.html"><code translate="no" dir="ltr">tf.numpy_function</code></a> is not compatible with XLA. Calling <a href="numpy_function.html"><code translate="no" dir="ltr">tf.numpy_function</code></a> inside <a href="function.html"><code translate="no" dir="ltr">tf.function(jit_compile=True)</code></a> will raise an error.</p></li> <li><p>Since the function takes numpy arrays, you cannot take gradients through a numpy_function. If you require something that is differentiable, please consider using tf.py_function.</p></li> </ul>  
<table class="responsive fixed orange"> <colgroup>
<col width="214px">
<col>
</colgroup> <tr><th colspan="2">Args</th></tr> 
<tr> <td> <code translate="no" dir="ltr">func</code> </td> <td> A Python function, which accepts <code translate="no" dir="ltr">numpy.ndarray</code> objects as arguments and returns a list of <code translate="no" dir="ltr">numpy.ndarray</code> objects (or a single <code translate="no" dir="ltr">numpy.ndarray</code>). This function must accept as many arguments as there are tensors in <code translate="no" dir="ltr">inp</code>, and these argument types will match the corresponding <a href="tensor.html"><code translate="no" dir="ltr">tf.Tensor</code></a> objects in <code translate="no" dir="ltr">inp</code>. The returns <code translate="no" dir="ltr">numpy.ndarray</code>s must match the number and types defined <code translate="no" dir="ltr">Tout</code>. Important Note: Input and output <code translate="no" dir="ltr">numpy.ndarray</code>s of <code translate="no" dir="ltr">func</code> are not guaranteed to be copies. In some cases their underlying memory will be shared with the corresponding TensorFlow tensors. In-place modification or storing <code translate="no" dir="ltr">func</code> input or return values in python datastructures without explicit (np.)copy can have non-deterministic consequences. </td> </tr>
<tr> <td> <code translate="no" dir="ltr">inp</code> </td> <td> A list of <a href="tensor.html"><code translate="no" dir="ltr">tf.Tensor</code></a> objects. </td> </tr>
<tr> <td> <code translate="no" dir="ltr">Tout</code> </td> <td> A list or tuple of tensorflow data types or a single tensorflow data type if there is only one, indicating what <code translate="no" dir="ltr">func</code> returns. </td> </tr>
<tr> <td> <code translate="no" dir="ltr">stateful</code> </td> <td> (Boolean.) Setting this argument to False tells the runtime to treat the function as stateless, which enables certain optimizations. A function is stateless when given the same input it will return the same output and have no side effects; its only purpose is to have a return value. The behavior for a stateful function with the <code translate="no" dir="ltr">stateful</code> argument False is undefined. In particular, caution should be taken when mutating the input arguments as this is a stateful operation. </td> </tr>
<tr> <td> <code translate="no" dir="ltr">name</code> </td> <td> (Optional) A name for the operation. </td> </tr> </table>  
<table class="responsive fixed orange"> <colgroup>
<col width="214px">
<col>
</colgroup> <tr><th colspan="2">Returns</th></tr> <tr class="alt"> <td colspan="2"> <ul> <li>If <code translate="no" dir="ltr">func</code> is <code translate="no" dir="ltr">None</code> this returns a decorator that will ensure the decorated function will always run with eager execution even if called from a <a href="function.html"><code translate="no" dir="ltr">tf.function</code></a>/<a href="graph.html"><code translate="no" dir="ltr">tf.Graph</code></a>.</li> <li>If used <code translate="no" dir="ltr">func</code> is not <code translate="no" dir="ltr">None</code> this executes <code translate="no" dir="ltr">func</code> with eager execution and returns the result: A single or list of <a href="tensor.html"><code translate="no" dir="ltr">tf.Tensor</code></a> which <code translate="no" dir="ltr">func</code> computes. </li>
</ul>
</td> </tr> 
</table>  <devsite-thumb-rating position="footer"> </devsite-thumb-rating> <div class="_attribution">
  <p class="_attribution-p">
    &copy; 2022 The TensorFlow Authors. All rights reserved.<br>Licensed under the Creative Commons Attribution License 4.0.<br>Code samples licensed under the Apache 2.0 License.<br>
    <a href="https://www.tensorflow.org/api_docs/python/tf/numpy_function" class="_attribution-link">https://www.tensorflow.org/api_docs/python/tf/numpy_function</a>
  </p>
</div>
