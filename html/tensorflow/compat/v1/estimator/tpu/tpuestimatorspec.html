<h1 class="devsite-page-title">tf.compat.v1.estimator.tpu.TPUEstimatorSpec</h1> <devsite-bookmark></devsite-bookmark>       <p>Ops and objects returned from a <code translate="no" dir="ltr">model_fn</code> and passed to <code translate="no" dir="ltr">TPUEstimator</code>.</p> <pre class="devsite-click-to-copy prettyprint lang-py tfo-signature-link" translate="no" dir="ltr" data-language="cpp">
tf.compat.v1.estimator.tpu.TPUEstimatorSpec(
    mode,
    predictions=None,
    loss=None,
    train_op=None,
    eval_metrics=None,
    export_outputs=None,
    scaffold_fn=None,
    host_call=None,
    training_hooks=None,
    evaluation_hooks=None,
    prediction_hooks=None
)
</pre> <p><section><devsite-expandable expanded> <h2 class="showalways" id="migrate-to-tf2" data-text="Migrate to TF2">Migrate to TF2</h2></devsite-expandable></section></p> <aside class="caution"><strong>Caution:</strong><span> This API was designed for TensorFlow v1. Continue reading for details on how to migrate from this API to a native TensorFlow v2 equivalent. See the <a href="https://www.tensorflow.org/guide/migrate">TensorFlow v1 to TensorFlow v2 migration guide</a> for instructions on how to migrate the rest of your code.</span></aside> <p>TPU Estimator manages its own TensorFlow graph and session, so it is not compatible with TF2 behaviors. We recommend that you migrate to the newer <a href="../../../../distribute/tpustrategy.html"><code translate="no" dir="ltr">tf.distribute.TPUStrategy</code></a>. See the <a href="https://www.tensorflow.org/guide/tpu">TPU guide</a> for details.</p>  <h2 id="description" data-text="Description">Description</h2>  <p>See <code translate="no" dir="ltr">EstimatorSpec</code> for <code translate="no" dir="ltr">mode</code>, <code translate="no" dir="ltr">predictions</code>, <code translate="no" dir="ltr">loss</code>, <code translate="no" dir="ltr">train_op</code>, and <code translate="no" dir="ltr">export_outputs</code>.</p> <p>For evaluation, <code translate="no" dir="ltr">eval_metrics</code>is a tuple of <code translate="no" dir="ltr">metric_fn</code> and <code translate="no" dir="ltr">tensors</code>, where <code translate="no" dir="ltr">metric_fn</code> runs on CPU to generate metrics and <code translate="no" dir="ltr">tensors</code> represents the <code translate="no" dir="ltr">Tensor</code>s transferred from TPU system to CPU host and passed to <code translate="no" dir="ltr">metric_fn</code>. To be precise, TPU evaluation expects a slightly different signature from the <a href="../../../../estimator/estimator.html"><code translate="no" dir="ltr">tf.estimator.Estimator</code></a>. While <a href="https://www.tensorflow.org/api_docs/python/tf/estimator/EstimatorSpec#eval_metric_ops"><code translate="no" dir="ltr">EstimatorSpec.eval_metric_ops</code></a> expects a dict, <code translate="no" dir="ltr">TPUEstimatorSpec.eval_metrics</code> is a tuple of <code translate="no" dir="ltr">metric_fn</code> and <code translate="no" dir="ltr">tensors</code>. The <code translate="no" dir="ltr">tensors</code> could be a list of <code translate="no" dir="ltr">Tensor</code>s or dict of names to <code translate="no" dir="ltr">Tensor</code>s. The <code translate="no" dir="ltr">tensors</code> usually specify the model logits, which are transferred back from TPU system to CPU host. All tensors must have be batch-major, i.e., the batch size is the first dimension. Once all tensors are available at CPU host from all shards, they are concatenated (on CPU) and passed as positional arguments to the <code translate="no" dir="ltr">metric_fn</code> if <code translate="no" dir="ltr">tensors</code> is list or keyword arguments if <code translate="no" dir="ltr">tensors</code> is a dict. <code translate="no" dir="ltr">metric_fn</code> takes the <code translate="no" dir="ltr">tensors</code> and returns a dict from metric string name to the result of calling a metric function, namely a <code translate="no" dir="ltr">(metric_tensor, update_op)</code> tuple. See <code translate="no" dir="ltr">TPUEstimator</code> for MNIST example how to specify the <code translate="no" dir="ltr">eval_metrics</code>.</p> <p><code translate="no" dir="ltr">scaffold_fn</code> is a function running on CPU to generate the <code translate="no" dir="ltr">Scaffold</code>. This function should not capture any Tensors in <code translate="no" dir="ltr">model_fn</code>.</p> <p><code translate="no" dir="ltr">host_call</code> is a tuple of a <code translate="no" dir="ltr">function</code> and a list or dictionary of <code translate="no" dir="ltr">tensors</code> to pass to that function and returns a list of Tensors. <code translate="no" dir="ltr">host_call</code> currently works for train() and evaluate(). The Tensors returned by the function is executed on the CPU on every step, so there is communication overhead when sending tensors from TPU to CPU. To reduce the overhead, try reducing the size of the tensors. The <code translate="no" dir="ltr">tensors</code> are concatenated along their major (batch) dimension, and so must be &gt;= rank 1. The <code translate="no" dir="ltr">host_call</code> is useful for writing summaries with <code translate="no" dir="ltr">tf.contrib.summary.create_file_writer</code>.</p>  
<table class="responsive fixed orange"> <colgroup>
<col width="214px">
<col>
</colgroup> <tr><th colspan="2">Attributes</th></tr> 
<tr> <td> <code translate="no" dir="ltr">mode</code> </td> <td> A <code translate="no" dir="ltr">namedtuple</code> alias for field number 0 </td> </tr>
<tr> <td> <code translate="no" dir="ltr">predictions</code> </td> <td> A <code translate="no" dir="ltr">namedtuple</code> alias for field number 1 </td> </tr>
<tr> <td> <code translate="no" dir="ltr">loss</code> </td> <td> A <code translate="no" dir="ltr">namedtuple</code> alias for field number 2 </td> </tr>
<tr> <td> <code translate="no" dir="ltr">train_op</code> </td> <td> A <code translate="no" dir="ltr">namedtuple</code> alias for field number 3 </td> </tr>
<tr> <td> <code translate="no" dir="ltr">eval_metrics</code> </td> <td> A <code translate="no" dir="ltr">namedtuple</code> alias for field number 4 </td> </tr>
<tr> <td> <code translate="no" dir="ltr">export_outputs</code> </td> <td> A <code translate="no" dir="ltr">namedtuple</code> alias for field number 5 </td> </tr>
<tr> <td> <code translate="no" dir="ltr">scaffold_fn</code> </td> <td> A <code translate="no" dir="ltr">namedtuple</code> alias for field number 6 </td> </tr>
<tr> <td> <code translate="no" dir="ltr">host_call</code> </td> <td> A <code translate="no" dir="ltr">namedtuple</code> alias for field number 7 </td> </tr>
<tr> <td> <code translate="no" dir="ltr">training_hooks</code> </td> <td> A <code translate="no" dir="ltr">namedtuple</code> alias for field number 8 </td> </tr>
<tr> <td> <code translate="no" dir="ltr">evaluation_hooks</code> </td> <td> A <code translate="no" dir="ltr">namedtuple</code> alias for field number 9 </td> </tr>
<tr> <td> <code translate="no" dir="ltr">prediction_hooks</code> </td> <td> A <code translate="no" dir="ltr">namedtuple</code> alias for field number 10 </td> </tr> </table> <h2 id="methods" data-text="Methods">Methods</h2> <h3 id="as_estimator_spec" data-text="as_estimator_spec"><code translate="no" dir="ltr">as_estimator_spec</code></h3> <p><a target="_blank" class="external" href="https://github.com/tensorflow/estimator/tree/master/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py#L368-L395">View source</a></p> <pre class="devsite-click-to-copy prettyprint lang-py tfo-signature-link" translate="no" dir="ltr" data-language="cpp">
as_estimator_spec()
</pre> <p>Creates an equivalent <code translate="no" dir="ltr">EstimatorSpec</code> used by CPU train/eval.</p>  <devsite-thumb-rating position="footer"> </devsite-thumb-rating><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2022 The TensorFlow Authors. All rights reserved.<br>Licensed under the Creative Commons Attribution License 4.0.<br>Code samples licensed under the Apache 2.0 License.<br>
    <a href="https://www.tensorflow.org/versions/r2.9/api_docs/python/tf/compat/v1/estimator/tpu/TPUEstimatorSpec" class="_attribution-link">https://www.tensorflow.org/versions/r2.9/api_docs/python/tf/compat/v1/estimator/tpu/TPUEstimatorSpec</a>
  </p>
</div>
