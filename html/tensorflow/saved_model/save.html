<h1 class="devsite-page-title">tf.saved_model.save</h1> <devsite-bookmark></devsite-bookmark>      <table class="tfo-notebook-buttons tfo-api nocontent" align="left">  <td> <a target="_blank" href="https://github.com/tensorflow/tensorflow/blob/v2.9.0/tensorflow/python/saved_model/save.py#L1106-L1291">  View source on GitHub </a> </td> </table> <p>Exports a <a href="https://www.tensorflow.org/api_docs/python/tf/Module">tf.Module</a> (and subclasses) <code translate="no" dir="ltr">obj</code> to <a href="https://www.tensorflow.org/guide/saved_model#the_savedmodel_format_on_disk">SavedModel format</a>.</p> <section class="expandable"> <h4 class="showalways" id="view-aliases" data-text="View aliases">View aliases</h4> <p> <b>Compat aliases for migration</b> </p>
<p>See <a href="https://www.tensorflow.org/guide/migrate">Migration guide</a> for more details.</p> <p><a href="https://www.tensorflow.org/api_docs/python/tf/saved_model/save"><code translate="no" dir="ltr">tf.compat.v1.saved_model.experimental.save</code></a>, <a href="https://www.tensorflow.org/api_docs/python/tf/saved_model/save"><code translate="no" dir="ltr">tf.compat.v1.saved_model.save</code></a></p> </section> <pre class="devsite-click-to-copy prettyprint lang-py tfo-signature-link" translate="no" dir="ltr" data-language="cpp">
tf.saved_model.save(
    obj, export_dir, signatures=None, options=None
)
</pre>  <p>The <code translate="no" dir="ltr">obj</code> must inherit from the <a href="https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/training/tracking/base.py#L591"><code translate="no" dir="ltr">Trackable</code> class</a>.</p> <h4 id="example_usage" data-text="Example usage:">Example usage:</h4> <pre class="devsite-click-to-copy prettyprint lang-py" translate="no" dir="ltr" data-language="cpp">
class Adder(tf.Module):
  @tf.function(input_signature=[tf.TensorSpec(shape=[], dtype=tf.float32)])
  def add(self, x):
    return x + x
</pre> <pre class="devsite-click-to-copy prettyprint lang-py" translate="no" dir="ltr" data-language="cpp">
model = Adder()
tf.saved_model.save(model, '/tmp/adder')
</pre> <p>The resulting SavedModel is then servable with an input named "x", a scalar with dtype float32.</p> <p><em>Signatures</em></p> <p>Signatures define the input and output types for a computation. The optional save <code translate="no" dir="ltr">signatures</code> argument controls which methods in <code translate="no" dir="ltr">obj</code> will be available to programs which consume <code translate="no" dir="ltr">SavedModel</code>s, for example, serving APIs. Python functions may be decorated with <a href="../function.html"><code translate="no" dir="ltr">@tf.function(input_signature=...)</code></a> and passed as signatures directly, or lazily with a call to <code translate="no" dir="ltr">get_concrete_function</code> on the method decorated with <a href="../function.html"><code translate="no" dir="ltr">@tf.function</code></a>.</p> <h4 id="example" data-text="Example:">Example:</h4> <pre class="devsite-click-to-copy prettyprint lang-py" translate="no" dir="ltr" data-language="cpp">
class Adder(tf.Module):
  @tf.function
  def add(self, x):
    return x + x
</pre> <pre class="devsite-click-to-copy prettyprint lang-py" translate="no" dir="ltr" data-language="cpp">
model = Adder()
tf.saved_model.save(
  model, '/tmp/adder',signatures=model.add.get_concrete_function(
    tf.TensorSpec([], tf.float32)))
</pre> <p>If a <a href="../function.html"><code translate="no" dir="ltr">@tf.function</code></a> does not have an input signature and <code translate="no" dir="ltr">get_concrete_function</code> is not called on that method, the function will not be directly callable in the restored SavedModel.</p> <h4 id="example_2" data-text="Example:">Example:</h4> <pre class="devsite-click-to-copy prettyprint lang-py" translate="no" dir="ltr" data-language="cpp">
class Adder(tf.Module):
  @tf.function
  def add(self, x):
    return x + x
</pre> <pre class="devsite-click-to-copy prettyprint lang-py" translate="no" dir="ltr" data-language="cpp">
model = Adder()
tf.saved_model.save(model, '/tmp/adder')
restored = tf.saved_model.load('/tmp/adder')
restored.add(1.)
Traceback (most recent call last):

ValueError: Found zero restored functions for caller function.
</pre> <p>If the <code translate="no" dir="ltr">signatures</code> argument is omitted, <code translate="no" dir="ltr">obj</code> will be searched for <a href="../function.html"><code translate="no" dir="ltr">@tf.function</code></a>-decorated methods. If exactly one traced <a href="../function.html"><code translate="no" dir="ltr">@tf.function</code></a> is found, that method will be used as the default signature for the SavedModel. Else, any <a href="../function.html"><code translate="no" dir="ltr">@tf.function</code></a> attached to <code translate="no" dir="ltr">obj</code> or its dependencies will be exported for use with <a href="load.html"><code translate="no" dir="ltr">tf.saved_model.load</code></a>.</p> <p>When invoking a signature in an exported SavedModel, <code translate="no" dir="ltr">Tensor</code> arguments are identified by name. These names will come from the Python function's argument names by default. They may be overridden by specifying a <code translate="no" dir="ltr">name=...</code> argument in the corresponding <a href="../tensorspec.html"><code translate="no" dir="ltr">tf.TensorSpec</code></a> object. Explicit naming is required if multiple <code translate="no" dir="ltr">Tensor</code>s are passed through a single argument to the Python function.</p> <p>The outputs of functions used as <code translate="no" dir="ltr">signatures</code> must either be flat lists, in which case outputs will be numbered, or a dictionary mapping string keys to <code translate="no" dir="ltr">Tensor</code>, in which case the keys will be used to name outputs.</p> <p>Signatures are available in objects returned by <a href="load.html"><code translate="no" dir="ltr">tf.saved_model.load</code></a> as a <code translate="no" dir="ltr">.signatures</code> attribute. This is a reserved attribute: <a href="save.html"><code translate="no" dir="ltr">tf.saved_model.save</code></a> on an object with a custom <code translate="no" dir="ltr">.signatures</code> attribute will raise an exception.</p> <p>_Using <a href="save.html"><code translate="no" dir="ltr">tf.saved<em>model.save</em></code></a> with Keras models</p> <p>While Keras has its own <a href="https://www.tensorflow.org/guide/keras/save_and_serialize">saving and loading API</a>, this function can be used to export Keras models. For example, exporting with a signature specified:</p> <pre class="devsite-click-to-copy prettyprint lang-py" translate="no" dir="ltr" data-language="cpp">
class Adder(tf.keras.Model):
  @tf.function(input_signature=[tf.TensorSpec(shape=[], dtype=tf.string)])
  def concat(self, x):
     return x + x
</pre> <pre class="devsite-click-to-copy prettyprint lang-py" translate="no" dir="ltr" data-language="cpp">
model = Adder()
tf.saved_model.save(model, '/tmp/adder')
</pre> <p>Exporting from a function without a fixed signature:</p> <pre class="devsite-click-to-copy prettyprint lang-py" translate="no" dir="ltr" data-language="cpp">
class Adder(tf.keras.Model):
  @tf.function
  def concat(self, x):
     return x + x
</pre> <pre class="devsite-click-to-copy prettyprint lang-py" translate="no" dir="ltr" data-language="cpp">
model = Adder()
tf.saved_model.save(
  model, '/tmp/adder',
  signatures=model.concat.get_concrete_function(
    tf.TensorSpec(shape=[], dtype=tf.string, name="string_input")))
</pre> <p><a href="../keras/model.html"><code translate="no" dir="ltr">tf.keras.Model</code></a> instances constructed from inputs and outputs already have a signature and so do not require a <a href="../function.html"><code translate="no" dir="ltr">@tf.function</code></a> decorator or a <code translate="no" dir="ltr">signatures</code> argument. If neither are specified, the model's forward pass is exported.</p> <pre class="devsite-click-to-copy prettyprint lang-py" translate="no" dir="ltr" data-language="cpp">
x = tf.keras.layers.Input((4,), name="x")
y = tf.keras.layers.Dense(5, name="out")(x)
model = tf.keras.Model(x, y)
tf.saved_model.save(model, '/tmp/saved_model/')
</pre> <p>The exported SavedModel takes "x" with shape [None, 4] and returns "out" with shape [None, 5]</p> <p><em>Variables and Checkpoints</em></p> <p>Variables must be tracked by assigning them to an attribute of a tracked object or to an attribute of <code translate="no" dir="ltr">obj</code> directly. TensorFlow objects (e.g. layers from <a href="../keras/layers.html"><code translate="no" dir="ltr">tf.keras.layers</code></a>, optimizers from <a href="../train.html"><code translate="no" dir="ltr">tf.train</code></a>) track their variables automatically. This is the same tracking scheme that <a href="../train/checkpoint.html"><code translate="no" dir="ltr">tf.train.Checkpoint</code></a> uses, and an exported <code translate="no" dir="ltr">Checkpoint</code> object may be restored as a training checkpoint by pointing <a href="../train/checkpoint.html#restore"><code translate="no" dir="ltr">tf.train.Checkpoint.restore</code></a> to the SavedModel's "variables/" subdirectory.</p> <p><a href="../function.html"><code translate="no" dir="ltr">tf.function</code></a> does not hard-code device annotations from outside the function body, instead of using the calling context's device. This means for example that exporting a model that runs on a GPU and serving it on a CPU will generally work, with some exceptions:</p> <ul> <li>
<a href="../device.html"><code translate="no" dir="ltr">tf.device</code></a> annotations inside the body of the function will be hard-coded in the exported model; this type of annotation is discouraged.</li> <li>Device-specific operations, e.g. with "cuDNN" in the name or with device-specific layouts, may cause issues.</li> <li>For <code translate="no" dir="ltr">ConcreteFunctions</code>, active distribution strategies will cause device placements to be hard-coded in the function.</li> </ul> <p>SavedModels exported with <a href="save.html"><code translate="no" dir="ltr">tf.saved_model.save</code></a> <a href="https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/saved_model/README.md#stripping-default-valued-attributes">strip default-valued attributes</a> automatically, which removes one source of incompatibilities when the consumer of a SavedModel is running an older TensorFlow version than the producer. There are however other sources of incompatibilities which are not handled automatically, such as when the exported model contains operations which the consumer does not have definitions for.</p>  
<table class="responsive fixed orange"> <colgroup>
<col width="214px">
<col>
</colgroup> <tr><th colspan="2">Args</th></tr> 
<tr> <td> <code translate="no" dir="ltr">obj</code> </td> <td> A trackable object (e.g. tf.Module or tf.train.Checkpoint) to export. </td> </tr>
<tr> <td> <code translate="no" dir="ltr">export_dir</code> </td> <td> A directory in which to write the SavedModel. </td> </tr>
<tr> <td> <code translate="no" dir="ltr">signatures</code> </td> <td> Optional, one of three types: <ul> <li>a <a href="../function.html"><code translate="no" dir="ltr">tf.function</code></a> with an input signature specified, which will use the default serving signature key,</li> <li>the result of <code translate="no" dir="ltr">f.get_concrete_function</code> on a <a href="../function.html"><code translate="no" dir="ltr">@tf.function</code></a>-decorated function <code translate="no" dir="ltr">f</code>, in which case <code translate="no" dir="ltr">f</code> will be used to generate a signature for the SavedModel under the default serving signature key,</li> <li>a dictionary, which maps signature keys to either <a href="../function.html"><code translate="no" dir="ltr">tf.function</code></a> instances with input signatures or concrete functions. Keys of such a dictionary may be arbitrary strings, but will typically be from the <code translate="no" dir="ltr">tf.saved_model.signature_constants</code> module. </li>
</ul>
</td> </tr>
<tr> <td> <code translate="no" dir="ltr">options</code> </td> <td> <a href="saveoptions.html"><code translate="no" dir="ltr">tf.saved_model.SaveOptions</code></a> object for configuring save options. </td> </tr> </table>  
<table class="responsive fixed orange"> <colgroup>
<col width="214px">
<col>
</colgroup> <tr><th colspan="2">Raises</th></tr> 
<tr> <td> <code translate="no" dir="ltr">ValueError</code> </td> <td> If <code translate="no" dir="ltr">obj</code> is not trackable. </td> </tr> </table> <p><section><devsite-expandable expanded> <h2 class="showalways" id="eager-compatibility" data-text="eager compatibility">eager compatibility</h2></devsite-expandable></section></p> <p>Not well supported when graph building. From TensorFlow 1.x, <a href="../compat/v1/enable_eager_execution.html"><code translate="no" dir="ltr">tf.compat.v1.enable_eager_execution()</code></a> should run first. Calling tf.saved_model.save in a loop when graph building from TensorFlow 1.x will add new save operations to the default graph each iteration.</p> <p>May not be called from within a function body.</p>   <devsite-thumb-rating position="footer"> </devsite-thumb-rating><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2022 The TensorFlow Authors. All rights reserved.<br>Licensed under the Creative Commons Attribution License 4.0.<br>Code samples licensed under the Apache 2.0 License.<br>
    <a href="https://www.tensorflow.org/versions/r2.9/api_docs/python/tf/saved_model/save" class="_attribution-link">https://www.tensorflow.org/versions/r2.9/api_docs/python/tf/saved_model/save</a>
  </p>
</div>
