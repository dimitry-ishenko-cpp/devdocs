<h1 class="devsite-page-title">tf.keras.metrics.IoU</h1> <devsite-bookmark></devsite-bookmark>       <p>Computes the Intersection-Over-Union metric for specific target classes.</p> <p>Inherits From: <a href="metric.html"><code translate="no" dir="ltr">Metric</code></a>, <a href="../layers/layer.html"><code translate="no" dir="ltr">Layer</code></a>, <a href="../../module.html"><code translate="no" dir="ltr">Module</code></a></p> <section class="expandable"> <h4 class="showalways" id="view-aliases" data-text="View aliases">View aliases</h4> <p> <b>Compat aliases for migration</b> </p>
<p>See <a href="https://www.tensorflow.org/guide/migrate">Migration guide</a> for more details.</p> <p><a href="https://www.tensorflow.org/api_docs/python/tf/keras/metrics/IoU"><code translate="no" dir="ltr">tf.compat.v1.keras.metrics.IoU</code></a></p> </section> <pre class="devsite-click-to-copy prettyprint lang-py tfo-signature-link" translate="no" dir="ltr" data-language="cpp">
tf.keras.metrics.IoU(
    num_classes: int,
    target_class_ids: Union[List[int], Tuple[int, ...]],
    name=None,
    dtype=None
)
</pre>  <p>General definition and computation:</p> <p>Intersection-Over-Union is a common evaluation metric for semantic image segmentation.</p> <p>For an individual class, the IoU metric is defined as follows:</p> <pre class="prettyprint" translate="no" dir="ltr" data-language="cpp">iou = true_positives / (true_positives + false_positives + false_negatives)
</pre> <p>To compute IoUs, the predictions are accumulated in a confusion matrix, weighted by <code translate="no" dir="ltr">sample_weight</code> and the metric is then calculated from it.</p> <p>If <code translate="no" dir="ltr">sample_weight</code> is <code translate="no" dir="ltr">None</code>, weights default to 1. Use <code translate="no" dir="ltr">sample_weight</code> of 0 to mask values.</p> <p>Note, this class first computes IoUs for all individual classes, then returns the mean of IoUs for the classes that are specified by <code translate="no" dir="ltr">target_class_ids</code>. If <code translate="no" dir="ltr">target_class_ids</code> has only one id value, the IoU of that specific class is returned.</p>  
<table class="responsive fixed orange"> <colgroup>
<col width="214px">
<col>
</colgroup> <tr><th colspan="2">Args</th></tr> 
<tr> <td> <code translate="no" dir="ltr">num_classes</code> </td> <td> The possible number of labels the prediction task can have. A confusion matrix of dimension = [num_classes, num_classes] will be allocated to accumulate predictions from which the metric is calculated. </td> </tr>
<tr> <td> <code translate="no" dir="ltr">target_class_ids</code> </td> <td> A tuple or list of target class ids for which the metric is returned. To compute IoU for a specific class, a list (or tuple) of a single id value should be provided. </td> </tr>
<tr> <td> <code translate="no" dir="ltr">name</code> </td> <td> (Optional) string name of the metric instance. </td> </tr>
<tr> <td> <code translate="no" dir="ltr">dtype</code> </td> <td> (Optional) data type of the metric result. </td> </tr> </table> <h4 id="standalone_usage" data-text="Standalone usage:">Standalone usage:</h4> <pre class="devsite-click-to-copy prettyprint lang-py" translate="no" dir="ltr" data-language="cpp">
# cm = [[1, 1],
#        [1, 1]]
# sum_row = [2, 2], sum_col = [2, 2], true_positives = [1, 1]
# iou = true_positives / (sum_row + sum_col - true_positives))
# iou = [0.33, 0.33]
m = tf.keras.metrics.IoU(num_classes=2, target_class_ids=[0])
m.update_state([0, 0, 1, 1], [0, 1, 0, 1])
m.result().numpy()
0.33333334
</pre> <pre class="devsite-click-to-copy prettyprint lang-py" translate="no" dir="ltr" data-language="cpp">
m.reset_state()
m.update_state([0, 0, 1, 1], [0, 1, 0, 1],
               sample_weight=[0.3, 0.3, 0.3, 0.1])
# cm = [[0.3, 0.3],
#        [0.3, 0.1]]
# sum_row = [0.6, 0.4], sum_col = [0.6, 0.4], true_positives = [0.3, 0.1]
# iou = [0.33, 0.14]
m.result().numpy()
0.33333334
</pre> <p>Usage with <code translate="no" dir="ltr">compile()</code> API:</p> <pre class="prettyprint lang-python" translate="no" dir="ltr" data-language="python">model.compile(
  optimizer='sgd',
  loss='mse',
  metrics=[tf.keras.metrics.IoU(num_classes=2, target_class_ids=[0])])
</pre> <h2 id="methods" data-text="Methods">Methods</h2> <h3 id="merge_state" data-text="merge_state"><code translate="no" dir="ltr">merge_state</code></h3> <p><a target="_blank" class="external" href="https://github.com/keras-team/keras/tree/v2.9.0/keras/metrics/base_metric.py#L275-L309">View source</a></p> <pre class="devsite-click-to-copy prettyprint lang-py tfo-signature-link" translate="no" dir="ltr" data-language="cpp">
merge_state(
    metrics
)
</pre> <p>Merges the state from one or more metrics.</p> <p>This method can be used by distributed systems to merge the state computed by different metric instances. Typically the state will be stored in the form of the metric's weights. For example, a tf.keras.metrics.Mean metric contains a list of two weight values: a total and a count. If there were two instances of a tf.keras.metrics.Accuracy that each independently aggregated partial state for an overall accuracy calculation, these two metric's states could be combined as follows:</p> <pre class="devsite-click-to-copy prettyprint lang-py" translate="no" dir="ltr" data-language="cpp">
m1 = tf.keras.metrics.Accuracy()
_ = m1.update_state([[1], [2]], [[0], [2]])
</pre> <pre class="devsite-click-to-copy prettyprint lang-py" translate="no" dir="ltr" data-language="cpp">
m2 = tf.keras.metrics.Accuracy()
_ = m2.update_state([[3], [4]], [[3], [4]])
</pre> <pre class="devsite-click-to-copy prettyprint lang-py" translate="no" dir="ltr" data-language="cpp">
m2.merge_state([m1])
m2.result().numpy()
0.75
</pre>  
<table class="responsive fixed orange"> <colgroup>
<col width="214px">
<col>
</colgroup> <tr><th colspan="2">Args</th></tr> 
<tr> <td> <code translate="no" dir="ltr">metrics</code> </td> <td> an iterable of metrics. The metrics must have compatible state. </td> </tr> </table>  
<table class="responsive fixed orange"> <colgroup>
<col width="214px">
<col>
</colgroup> <tr><th colspan="2">Raises</th></tr> 
<tr> <td> <code translate="no" dir="ltr">ValueError</code> </td> <td> If the provided iterable does not contain metrics matching the metric's required specifications. </td> </tr> </table> <h3 id="reset_state" data-text="reset_state"><code translate="no" dir="ltr">reset_state</code></h3> <p><a target="_blank" class="external" href="https://github.com/keras-team/keras/tree/v2.9.0/keras/metrics/metrics.py#L2502-L2504">View source</a></p> <pre class="devsite-click-to-copy prettyprint lang-py tfo-signature-link" translate="no" dir="ltr" data-language="cpp">
reset_state()
</pre> <p>Resets all of the metric state variables.</p> <p>This function is called between epochs/steps, when a metric is evaluated during training.</p> <h3 id="result" data-text="result"><code translate="no" dir="ltr">result</code></h3> <p><a target="_blank" class="external" href="https://github.com/keras-team/keras/tree/v2.9.0/keras/metrics/metrics.py#L2594-L2618">View source</a></p> <pre class="devsite-click-to-copy prettyprint lang-py tfo-signature-link" translate="no" dir="ltr" data-language="cpp">
result()
</pre> <p>Compute the intersection-over-union via the confusion matrix.</p> <h3 id="update_state" data-text="update_state"><code translate="no" dir="ltr">update_state</code></h3> <p><a target="_blank" class="external" href="https://github.com/keras-team/keras/tree/v2.9.0/keras/metrics/metrics.py#L2464-L2500">View source</a></p> <pre class="devsite-click-to-copy prettyprint lang-py tfo-signature-link" translate="no" dir="ltr" data-language="cpp">
update_state(
    y_true, y_pred, sample_weight=None
)
</pre> <p>Accumulates the confusion matrix statistics.</p>  
<table class="responsive fixed orange"> <colgroup>
<col width="214px">
<col>
</colgroup> <tr><th colspan="2">Args</th></tr> 
<tr> <td> <code translate="no" dir="ltr">y_true</code> </td> <td> The ground truth values. </td> </tr>
<tr> <td> <code translate="no" dir="ltr">y_pred</code> </td> <td> The predicted values. </td> </tr>
<tr> <td> <code translate="no" dir="ltr">sample_weight</code> </td> <td> Optional weighting of each example. Defaults to 1. Can be a <code translate="no" dir="ltr">Tensor</code> whose rank is either 0, or the same rank as <code translate="no" dir="ltr">y_true</code>, and must be broadcastable to <code translate="no" dir="ltr">y_true</code>. </td> </tr> </table>  
<table class="responsive fixed orange"> <colgroup>
<col width="214px">
<col>
</colgroup> <tr><th colspan="2">Returns</th></tr> <tr class="alt"> <td colspan="2"> Update op. </td> </tr> 
</table>  <devsite-thumb-rating position="footer"> </devsite-thumb-rating><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2022 The TensorFlow Authors. All rights reserved.<br>Licensed under the Creative Commons Attribution License 4.0.<br>Code samples licensed under the Apache 2.0 License.<br>
    <a href="https://www.tensorflow.org/versions/r2.9/api_docs/python/tf/keras/metrics/IoU" class="_attribution-link">https://www.tensorflow.org/versions/r2.9/api_docs/python/tf/keras/metrics/IoU</a>
  </p>
</div>
