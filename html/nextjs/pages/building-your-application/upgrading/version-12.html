<h1 class="break-words">Version 12</h1>
<p>To upgrade to version 12, run the following command:</p> <div class="code-block_wrapper__t6FCO code-block_hasFileName__ezlBD code-block_hideLineNumbers__52YKH not-prose"><pre class="code-block_pre___OLfy" data-language="typescript">npm i next@12 react@17 react-dom@17 eslint-config-next@12</pre></div> <div class="code-block_wrapper__t6FCO code-block_hasFileName__ezlBD code-block_hideLineNumbers__52YKH not-prose"><pre class="code-block_pre___OLfy" data-language="typescript">yarn add next@12 react@17 react-dom@17 eslint-config-next@12</pre></div> <div class="code-block_wrapper__t6FCO code-block_hasFileName__ezlBD code-block_hideLineNumbers__52YKH not-prose"><pre class="code-block_pre___OLfy" data-language="typescript">pnpm up next@12 react@17 react-dom@17 eslint-config-next@12</pre></div> <div class="code-block_wrapper__t6FCO code-block_hasFileName__ezlBD code-block_hideLineNumbers__52YKH not-prose"><pre class="code-block_pre___OLfy" data-language="typescript">bun add next@12 react@17 react-dom@17 eslint-config-next@12</pre></div> <blockquote class="p-3 text-sm"> <p><strong>Good to know:</strong> If you are using TypeScript, ensure you also upgrade <code>@types/react</code> and <code>@types/react-dom</code> to their corresponding versions.</p> </blockquote> <h3 id="upgrading-to-122" data-docs-heading="">Upgrading to 12.2     </h3> <p><a href="../../../messages/middleware-upgrade-guide.html">Middleware</a> - If you were using Middleware prior to <code>12.2</code>, please see the <a href="../../../messages/middleware-upgrade-guide.html">upgrade guide</a> for more information.</p> <h3 id="upgrading-to-120" data-docs-heading="">Upgrading to 12.0     </h3> <p><a href="https://nodejs.org/en/" rel="noopener noreferrer nofollow" target="_blank">Minimum Node.js Version</a> - The minimum Node.js version has been bumped from <code>12.0.0</code> to <code>12.22.0</code> which is the first version of Node.js with native ES Modules support.</p> <p><a href="https://react.dev/learn/add-react-to-an-existing-project" rel="noopener noreferrer nofollow" target="_blank">Minimum React Version</a> - The minimum required React version is <code>17.0.2</code>. To upgrade you can run the following command in the terminal:</p> <div class="code-block_wrapper__t6FCO code-block_hasFileName__ezlBD not-prose"><pre class="code-block_pre___OLfy" data-language="typescript">npm install react@latest react-dom@latest
 
yarn add react@latest react-dom@latest
 
pnpm update react@latest react-dom@latest
 
bun add react@latest react-dom@latest</pre></div> <h4 id="swc-replacing-babel" data-docs-heading="">SWC replacing Babel     </h4> <p>Next.js now uses the Rust-based compiler <a href="https://swc.rs/" rel="noopener noreferrer nofollow" target="_blank">SWC</a> to compile JavaScript/TypeScript. This new compiler is up to 17x faster than Babel when compiling individual files and up to 5x faster Fast Refresh.</p> <p>Next.js provides full backward compatibility with applications that have <a href="../configuring/babel.html">custom Babel configuration</a>. All transformations that Next.js handles by default like styled-jsx and tree-shaking of <code>getStaticProps</code> / <code>getStaticPaths</code> / <code>getServerSideProps</code> have been ported to Rust.</p> <p>When an application has a custom Babel configuration, Next.js will automatically opt-out of using SWC for compiling JavaScript/Typescript and will fall back to using Babel in the same way that it was used in Next.js 11.</p> <p>Many of the integrations with external libraries that currently require custom Babel transformations will be ported to Rust-based SWC transforms in the near future. These include but are not limited to:</p> <ul> <li>Styled Components</li> <li>Emotion</li> <li>Relay</li> </ul> <p>In order to prioritize transforms that will help you adopt SWC, please provide your <code>.babelrc</code> on <a href="https://github.com/vercel/next.js/discussions/30174" rel="noopener noreferrer" target="_blank">this feedback thread</a>.</p> <h4 id="swc-replacing-terser-for-minification" data-docs-heading="">SWC replacing Terser for minification     </h4> <p>You can opt-in to replacing Terser with SWC for minifying JavaScript up to 7x faster using a flag in <code>next.config.js</code>:</p> <div class="code-block_wrapper__t6FCO code-block_hasFileName__ezlBD not-prose"><pre class="code-block_pre___OLfy" data-language="typescript">module.exports = {
  swcMinify: true,
}</pre></div> <p>Minification using SWC is an opt-in flag to ensure it can be tested against more real-world Next.js applications before it becomes the default in Next.js 12.1. If you have feedback about minification, please leave it on <a href="https://github.com/vercel/next.js/discussions/30237" rel="noopener noreferrer" target="_blank">this feedback thread</a>.</p> <h4 id="improvements-to-styled-jsx-css-parsing" data-docs-heading="">Improvements to styled-jsx CSS parsing     </h4> <p>On top of the Rust-based compiler we've implemented a new CSS parser based on the one used for the styled-jsx Babel transform. This new parser has improved handling of CSS and now errors when invalid CSS is used that would previously slip through and cause unexpected behavior.</p> <p>Because of this change invalid CSS will throw an error during development and <code>next build</code>. This change only affects styled-jsx usage.</p> <h4 id="nextimage-changed-wrapping-element" data-docs-heading="">next/image changed wrapping element     </h4> <p><code>next/image</code> now renders the <code>&lt;img&gt;</code> inside a <code>&lt;span&gt;</code> instead of <code>&lt;div&gt;</code>.</p> <p>If your application has specific CSS targeting span such as <code>.container span</code>, upgrading to Next.js 12 might incorrectly match the wrapping element inside the <code>&lt;Image&gt;</code> component. You can avoid this by restricting the selector to a specific class such as <code>.container span.item</code> and updating the relevant component with that className, such as <code>&lt;span className="item" /&gt;</code>.</p> <p>If your application has specific CSS targeting the <code>next/image</code> <code>&lt;div&gt;</code> tag, for example <code>.container div</code>, it may not match anymore. You can update the selector <code>.container span</code>, or preferably, add a new <code>&lt;div className="wrapper"&gt;</code> wrapping the <code>&lt;Image&gt;</code> component and target that instead such as <code>.container .wrapper</code>.</p> <p>The <code>className</code> prop is unchanged and will still be passed to the underlying <code>&lt;img&gt;</code> element.</p> <p>See the <a href="../optimizing/images.html#styling">documentation</a> for more info.</p> <h4 id="hmr-connection-now-uses-a-websocket" data-docs-heading="">HMR connection now uses a WebSocket     </h4> <p>Previously, Next.js used a <a href="https://developer.mozilla.org/docs/Web/API/Server-sent_events" rel="noopener noreferrer nofollow" target="_blank">server-sent events</a> connection to receive HMR events. Next.js 12 now uses a WebSocket connection.</p> <p>In some cases when proxying requests to the Next.js dev server, you will need to ensure the upgrade request is handled correctly. For example, in <code>nginx</code> you would need to add the following configuration:</p> <div class="code-block_wrapper__t6FCO not-prose">
<pre class="code-block_pre___OLfy" data-language="typescript">location /_next/webpack-hmr {
    proxy_pass http://localhost:3000/_next/webpack-hmr;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
}</pre>
</div> <p>If you are using Apache (2.x), you can add the following configuration to enable web sockets to the server. Review the port, host name and server names.</p> <div class="code-block_wrapper__t6FCO code-block_hideLineNumbers__52YKH not-prose">
<pre class="code-block_pre___OLfy" data-language="typescript">&lt;VirtualHost *:443&gt;
 # ServerName yourwebsite.local
 ServerName "${WEBSITE_SERVER_NAME}"
 ProxyPass / http://localhost:3000/
 ProxyPassReverse / http://localhost:3000/
 # Next.js 12 uses websocket
 &lt;Location /_next/webpack-hmr&gt;
    RewriteEngine On
    RewriteCond %{QUERY_STRING} transport=websocket [NC]
    RewriteCond %{HTTP:Upgrade} websocket [NC]
    RewriteCond %{HTTP:Connection} upgrade [NC]
    RewriteRule /(.*) ws://localhost:3000/_next/webpack-hmr/$1 [P,L]
    ProxyPass ws://localhost:3000/_next/webpack-hmr retry=0 timeout=30
    ProxyPassReverse ws://localhost:3000/_next/webpack-hmr
 &lt;/Location&gt;
&lt;/VirtualHost&gt;
</pre>
</div> <p>For custom servers, such as <code>express</code>, you may need to use <code>app.all</code> to ensure the request is passed correctly, for example:</p> <div class="code-block_wrapper__t6FCO not-prose">
<pre class="code-block_pre___OLfy" data-language="typescript">app.all('/_next/webpack-hmr', (req, res) =&gt; {
  nextjsRequestHandler(req, res)
})</pre>
</div> <h4 id="webpack-4-support-has-been-removed" data-docs-heading="">Webpack 4 support has been removed     </h4> <p>If you are already using webpack 5 you can skip this section.</p> <p>Next.js has adopted webpack 5 as the default for compilation in Next.js 11. As communicated in the <a href="../../../messages/webpack5.html">webpack 5 upgrading documentation</a> Next.js 12 removes support for webpack 4.</p> <p>If your application is still using webpack 4 using the opt-out flag, you will now see an error linking to the <a href="../../../messages/webpack5.html">webpack 5 upgrading documentation</a>.</p> <h4 id="target-option-deprecated" data-docs-heading="">target option deprecated     </h4> <p>If you do not have <code>target</code> in <code>next.config.js</code> you can skip this section.</p> <p>The target option has been deprecated in favor of built-in support for tracing what dependencies are needed to run a page.</p> <p>During <code>next build</code>, Next.js will automatically trace each page and its dependencies to determine all of the files that are needed for deploying a production version of your application.</p> <p>If you are currently using the <code>target</code> option set to <code>serverless</code>, please read the <a href="../../api-reference/next-config-js/output.html">documentation on how to leverage the new output</a>.</p><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2024 Vercel, Inc.<br>Licensed under the MIT License.<br>
    <a href="https://nextjs.org/docs/pages/building-your-application/upgrading/version-12" class="_attribution-link">https://nextjs.org/docs/pages/building-your-application/upgrading/version-12</a>
  </p>
</div>
