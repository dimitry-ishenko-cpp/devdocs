<h1 class="title">Backing up your data</h1> <div class="alg-content">
<p>The RethinkDB command line utility allows you to easily take hot backups on a live cluster with the <code class="language-plaintext highlighter-rouge">dump</code> and <code class="language-plaintext highlighter-rouge">restore</code> subcommands. The utility runs under the <code class="language-plaintext highlighter-rouge">admin</code> user account (see <a href="../permissions-and-accounts/index.html">Permissions and user accounts</a>).</p> <h2 id="backup">Backup</h2> <p>Use the <code class="language-plaintext highlighter-rouge">dump</code> subcommand to create an archive of data from the cluster. This creates a <strong>tar.gz</strong> file consisting of JSON documents and additional table metadata.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight" data-language="">rethinkdb dump [options]
</pre></div></div> <p>Options to <code class="language-plaintext highlighter-rouge">dump</code> let you specify cluster information and limit the archive to specific databases or tables.</p> <ul> <li>
<code class="language-plaintext highlighter-rouge">-c</code>, <code class="language-plaintext highlighter-rouge">--connect</code>: host and client port of the node to connect to (default: <code class="language-plaintext highlighter-rouge">localhost:28015</code>)</li> <li>
<code class="language-plaintext highlighter-rouge">-f</code>, <code class="language-plaintext highlighter-rouge">--file</code>: specify a filename for the archive (default: <code class="language-plaintext highlighter-rouge">rethinkdb_dump_&lt;date&gt;_&lt;time&gt;.tar.gz</code>)</li> <li>
<code class="language-plaintext highlighter-rouge">-e</code>, <code class="language-plaintext highlighter-rouge">--export</code>: limit the dump to the given database or table (specified as <code class="language-plaintext highlighter-rouge">database.table</code>); may be specified multiple times for multiple databases/tables</li> <li>
<code class="language-plaintext highlighter-rouge">-p</code>, <code class="language-plaintext highlighter-rouge">--password</code>: prompt for the admin password, if one has been set</li> <li>
<code class="language-plaintext highlighter-rouge">--password-file</code>: read the admin password from a plain text file</li> <li>
<code class="language-plaintext highlighter-rouge">--tls-cert</code>: specify a path to a TLS certificate to allow encrypted connections to the server (see <a href="../security/index.html">Securing the cluster</a>)</li> <li>
<code class="language-plaintext highlighter-rouge">--clients</code>: number of tables to export simultaneously (default: <code class="language-plaintext highlighter-rouge">3</code>)</li> <li>
<code class="language-plaintext highlighter-rouge">--temp-dir</code>: directory to use for intermediary results</li> <li>
<code class="language-plaintext highlighter-rouge">-h</code>, <code class="language-plaintext highlighter-rouge">--help</code>: print help</li> </ul> <p>Since the backup process uses client drivers, it takes advantage of RethinkDB’s concurrency. While it will use some cluster resources, it won’t lock out any clients, and it can be safely run on a live cluster.</p> <h3 id="examples">Examples</h3> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight" data-language="">rethinkdb dump -c fortress:39500
</pre></div></div> <p>Connect to the cluster at host <code class="language-plaintext highlighter-rouge">fortress</code> with a client port at <code class="language-plaintext highlighter-rouge">39500</code>, saving to the default archive name.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight" data-language="">rethinkdb dump -e league.users -f backup.tar.gz --password-file pw.txt
</pre></div></div> <p>Connect to the default cluster (<code class="language-plaintext highlighter-rouge">localhost:28015</code>) and archive the <code class="language-plaintext highlighter-rouge">users</code> table from the <code class="language-plaintext highlighter-rouge">league</code> database in <code class="language-plaintext highlighter-rouge">backup.tar.gz</code>. Read the <code class="language-plaintext highlighter-rouge">admin</code> user password from the file <code class="language-plaintext highlighter-rouge">pw.txt</code>.</p> <blockquote class="infobox infobox-alert">
<p><strong>Note:</strong> The <code class="language-plaintext highlighter-rouge">dump</code> command saves database and table contents and metadata, but does <strong>not</strong> save cluster configuration data.</p> </blockquote> <h2 id="restore">Restore</h2> <p>The <code class="language-plaintext highlighter-rouge">restore</code> subcommand has most of the the same options and defaults as the <code class="language-plaintext highlighter-rouge">dump</code> command, although there are a few extra commands for controlling how data is imported.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight" data-language="">rethinkdb restore filename
</pre></div></div> <p>(You must specify the archive to restore from; there is no default.)</p> <ul> <li>
<code class="language-plaintext highlighter-rouge">-c</code>, <code class="language-plaintext highlighter-rouge">--connect</code>: host and client port of the node to connect to (default: <code class="language-plaintext highlighter-rouge">localhost:28015</code>)</li> <li>
<code class="language-plaintext highlighter-rouge">-p</code>, <code class="language-plaintext highlighter-rouge">--password</code>: prompt for the admin password, if one has been set</li> <li>
<code class="language-plaintext highlighter-rouge">--password-file</code>: read the admin password from a plain text file</li> <li>
<code class="language-plaintext highlighter-rouge">--tls-cert</code>: specify a path to a TLS certificate to allow encrypted connections to the server (see <a href="../security/index.html">Securing the cluster</a>)</li> <li>
<code class="language-plaintext highlighter-rouge">-i</code>, <code class="language-plaintext highlighter-rouge">--import</code>: limit the restore to the given database or table (specified as <code class="language-plaintext highlighter-rouge">database.table</code>); may be specified multiple times for multiple databases/tables</li> <li>
<code class="language-plaintext highlighter-rouge">--clients</code>: number of client connections to use (default: <code class="language-plaintext highlighter-rouge">8</code>)</li> <li>
<code class="language-plaintext highlighter-rouge">--temp-dir</code>: directory to use for intermediary results</li> <li>
<code class="language-plaintext highlighter-rouge">--hard-durability</code>: use hard durability writes (slower, but less memory consumption on the server)</li> <li>
<code class="language-plaintext highlighter-rouge">--force</code>: import data even if a table already exists</li> <li>
<code class="language-plaintext highlighter-rouge">--no-secondary-indexes</code>: do not create secondary indexes for the restored tables</li> <li>
<code class="language-plaintext highlighter-rouge">-h</code>, <code class="language-plaintext highlighter-rouge">--help</code>: print help</li> </ul> <blockquote class="infobox ">
<p><strong>Note:</strong> <code class="language-plaintext highlighter-rouge">rethinkdb restore</code> may not work for restoring backups made with later versions of RethinkDB to servers running <em>earlier</em> versions. For example, you cannot restore a backup made on RethinkDB 2.2 to a server running RethinkDB 2.1.</p> <p>If you need to do this, you can try passing the <code class="language-plaintext highlighter-rouge">--no-secondary-indexes</code> flag to <code class="language-plaintext highlighter-rouge">restore</code> as a workaround. This will usually allow restores to work on older versions, although this is not guaranteed.</p> </blockquote> <h3 id="examples-1">Examples</h3> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight" data-language="">rethinkdb restore rethinkdb_dump_2015-09-17T10:59:58.tar.gz
</pre></div></div> <p>Restore to the default cluster (<code class="language-plaintext highlighter-rouge">localhost:28015</code>).</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight" data-language="">rethinkdb restore backup.tar.gz -c fortress:39500
</pre></div></div> <p>Restore <code class="language-plaintext highlighter-rouge">backup.tar.gz</code> to the cluster running on <code class="language-plaintext highlighter-rouge">fortress</code> at port <code class="language-plaintext highlighter-rouge">39500</code>.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight" data-language="">rethinkdb restore backup.tar.gz -i league.users --password-file pw.txt
</pre></div></div> <p>Restore to the default cluster, only importing the table <code class="language-plaintext highlighter-rouge">users</code> to the database <code class="language-plaintext highlighter-rouge">league</code> from the archive <code class="language-plaintext highlighter-rouge">backup.tar.gz</code>. Read the <code class="language-plaintext highlighter-rouge">admin</code> user password from the file <code class="language-plaintext highlighter-rouge">pw.txt</code>. (This should be a plain text file with the password on the first and only line.)</p> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; RethinkDB contributors<br>Licensed under the Creative Commons Attribution-ShareAlike 3.0 Unported License.<br>
    <a href="https://rethinkdb.com/docs/backup/" class="_attribution-link">https://rethinkdb.com/docs/backup/</a>
  </p>
</div>
