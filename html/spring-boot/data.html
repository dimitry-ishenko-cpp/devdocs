<h1>Data</h1> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>Spring Boot integrates with a number of data technologies, both SQL and NoSQL.</p> </div> </div> </div> <div class="sect1"> <h2 id="data.sql">
1. SQL Databases</h2> <div class="sectionbody"> <div class="paragraph"> <p>The <a href="https://spring.io/projects/spring-framework">Spring Framework</a> provides extensive support for working with SQL databases, from direct JDBC access using <code>JdbcTemplate</code> to complete “object relational mapping” technologies such as Hibernate. <a href="https://spring.io/projects/spring-data">Spring Data</a> provides an additional level of functionality: creating <code>Repository</code> implementations directly from interfaces and using conventions to generate queries from your method names.</p> </div> <div class="sect2"> <h3 id="data.sql.datasource">
1.1. Configure a DataSource</h3> <div class="paragraph"> <p>Java’s <code>javax.sql.DataSource</code> interface provides a standard method of working with database connections. Traditionally, a <code>DataSource</code> uses a <code>URL</code> along with some credentials to establish a database connection.</p> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon">  </td> <td class="content"> See <a href="howto.html#howto.data-access.configure-custom-datasource">the “How-to” section</a> for more advanced examples, typically to take full control over the configuration of the DataSource. </td> </tr> </table> </div> <div class="sect3"> <h4 id="data.sql.datasource.embedded">
1.1.1. Embedded Database Support</h4> <div class="paragraph"> <p>It is often convenient to develop applications by using an in-memory embedded database. Obviously, in-memory databases do not provide persistent storage. You need to populate your database when your application starts and be prepared to throw away data when your application ends.</p> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon">  </td> <td class="content"> The “How-to” section includes a <a href="howto.html#howto.data-initialization">section on how to initialize a database</a>. </td> </tr> </table> </div> <div class="paragraph"> <p>Spring Boot can auto-configure embedded <a href="https://www.h2database.com">H2</a>, <a href="https://hsqldb.org/">HSQL</a>, and <a href="https://db.apache.org/derby/">Derby</a> databases. You need not provide any connection URLs. You need only include a build dependency to the embedded database that you want to use. If there are multiple embedded databases on the classpath, set the <code>spring.datasource.embedded-database-connection</code> configuration property to control which one is used. Setting the property to <code>none</code> disables auto-configuration of an embedded database.</p> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon">  </td> <td class="content"> <div class="paragraph"> <p>If you are using this feature in your tests, you may notice that the same database is reused by your whole test suite regardless of the number of application contexts that you use. If you want to make sure that each context has a separate embedded database, you should set <code>spring.datasource.generate-unique-name</code> to <code>true</code>.</p> </div> </td> </tr> </table> </div> <div class="paragraph"> <p>For example, the typical POM dependencies would be as follows:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight" data-language="xml"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.hsqldb&lt;/groupId&gt;
    &lt;artifactId&gt;hsqldb&lt;/artifactId&gt;
    &lt;scope&gt;runtime&lt;/scope&gt;
&lt;/dependency&gt;</code></pre> </div> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon">  </td> <td class="content"> You need a dependency on <code>spring-jdbc</code> for an embedded database to be auto-configured. In this example, it is pulled in transitively through <code>spring-boot-starter-data-jpa</code>. </td> </tr> </table> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon">  </td> <td class="content"> If, for whatever reason, you do configure the connection URL for an embedded database, take care to ensure that the database’s automatic shutdown is disabled. If you use H2, you should use <code>DB_CLOSE_ON_EXIT=FALSE</code> to do so. If you use HSQLDB, you should ensure that <code>shutdown=true</code> is not used. Disabling the database’s automatic shutdown lets Spring Boot control when the database is closed, thereby ensuring that it happens once access to the database is no longer needed. </td> </tr> </table> </div> </div> <div class="sect3"> <h4 id="data.sql.datasource.production">
1.1.2. Connection to a Production Database</h4> <div class="paragraph"> <p>Production database connections can also be auto-configured by using a pooling <code>DataSource</code>.</p> </div> </div> <div class="sect3"> <h4 id="data.sql.datasource.configuration">
1.1.3. DataSource Configuration</h4> <div class="paragraph"> <p>DataSource configuration is controlled by external configuration properties in <code>spring.datasource.*</code>. For example, you might declare the following section in <code>application.properties</code>:</p> </div> <div class="listingblock primary"> <div class="title">Properties</div> <div class="content"> <pre class="highlight" data-language="properties"><code class="language-properties" data-lang="properties">spring.datasource.url=jdbc:mysql://localhost/test
spring.datasource.username=dbuser
spring.datasource.password=dbpass</code></pre> </div> </div> <div class="listingblock secondary"> <div class="title">Yaml</div> <div class="content"> <pre class="highlight" data-language="yaml"><code class="language-yaml" data-lang="yaml">spring:
  datasource:
    url: "jdbc:mysql://localhost/test"
    username: "dbuser"
    password: "dbpass"</code></pre> </div> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon">  </td> <td class="content"> You should at least specify the URL by setting the <code>spring.datasource.url</code> property. Otherwise, Spring Boot tries to auto-configure an embedded database. </td> </tr> </table> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon">  </td> <td class="content"> Spring Boot can deduce the JDBC driver class for most databases from the URL. If you need to specify a specific class, you can use the <code>spring.datasource.driver-class-name</code> property. </td> </tr> </table> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon">  </td> <td class="content"> For a pooling <code>DataSource</code> to be created, we need to be able to verify that a valid <code>Driver</code> class is available, so we check for that before doing anything. In other words, if you set <code>spring.datasource.driver-class-name=com.mysql.jdbc.Driver</code>, then that class has to be loadable. </td> </tr> </table> </div> <div class="paragraph"> <p>See <a href="https://github.com/spring-projects/spring-boot/tree/v3.1.3/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/jdbc/DataSourceProperties.java"><code>DataSourceProperties</code></a> for more of the supported options. These are the standard options that work regardless of <a href="features.html#data.sql.datasource.connection-pool">the actual implementation</a>. It is also possible to fine-tune implementation-specific settings by using their respective prefix (<code>spring.datasource.hikari.*</code>, <code>spring.datasource.tomcat.*</code>, <code>spring.datasource.dbcp2.*</code>, and <code>spring.datasource.oracleucp.*</code>). See the documentation of the connection pool implementation you are using for more details.</p> </div> <div class="paragraph"> <p>For instance, if you use the <a href="https://tomcat.apache.org/tomcat-10.1-doc/jdbc-pool.html#Common_Attributes">Tomcat connection pool</a>, you could customize many additional settings, as shown in the following example:</p> </div> <div class="listingblock primary"> <div class="title">Properties</div> <div class="content"> <pre class="highlight" data-language="properties"><code class="language-properties" data-lang="properties">spring.datasource.tomcat.max-wait=10000
spring.datasource.tomcat.max-active=50
spring.datasource.tomcat.test-on-borrow=true</code></pre> </div> </div> <div class="listingblock secondary"> <div class="title">Yaml</div> <div class="content"> <pre class="highlight" data-language="yaml"><code class="language-yaml" data-lang="yaml">spring:
  datasource:
    tomcat:
      max-wait: 10000
      max-active: 50
      test-on-borrow: true</code></pre> </div> </div> <div class="paragraph"> <p>This will set the pool to wait 10000ms before throwing an exception if no connection is available, limit the maximum number of connections to 50 and validate the connection before borrowing it from the pool.</p> </div> </div> <div class="sect3"> <h4 id="data.sql.datasource.connection-pool">
1.1.4. Supported Connection Pools</h4> <div class="paragraph"> <p>Spring Boot uses the following algorithm for choosing a specific implementation:</p> </div> <div class="olist arabic"> <ol class="arabic"> <li> <p>We prefer <a href="https://github.com/brettwooldridge/HikariCP">HikariCP</a> for its performance and concurrency. If HikariCP is available, we always choose it.</p> </li> <li> <p>Otherwise, if the Tomcat pooling <code>DataSource</code> is available, we use it.</p> </li> <li> <p>Otherwise, if <a href="https://commons.apache.org/proper/commons-dbcp/">Commons DBCP2</a> is available, we use it.</p> </li> <li> <p>If none of HikariCP, Tomcat, and DBCP2 are available and if Oracle UCP is available, we use it.</p> </li> </ol> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon">  </td> <td class="content"> If you use the <code>spring-boot-starter-jdbc</code> or <code>spring-boot-starter-data-jpa</code> “starters”, you automatically get a dependency to <code>HikariCP</code>. </td> </tr> </table> </div> <div class="paragraph"> <p>You can bypass that algorithm completely and specify the connection pool to use by setting the <code>spring.datasource.type</code> property. This is especially important if you run your application in a Tomcat container, as <code>tomcat-jdbc</code> is provided by default.</p> </div> <div class="paragraph"> <p>Additional connection pools can always be configured manually, using <code>DataSourceBuilder</code>. If you define your own <code>DataSource</code> bean, auto-configuration does not occur. The following connection pools are supported by <code>DataSourceBuilder</code>:</p> </div> <div class="ulist"> <ul> <li> <p>HikariCP</p> </li> <li> <p>Tomcat pooling <code>Datasource</code></p> </li> <li> <p>Commons DBCP2</p> </li> <li> <p>Oracle UCP &amp; <code>OracleDataSource</code></p> </li> <li> <p>Spring Framework’s <code>SimpleDriverDataSource</code></p> </li> <li> <p>H2 <code>JdbcDataSource</code></p> </li> <li> <p>PostgreSQL <code>PGSimpleDataSource</code></p> </li> <li> <p>C3P0</p> </li> </ul> </div> </div> <div class="sect3"> <h4 id="data.sql.datasource.jndi">
1.1.5. Connection to a JNDI DataSource</h4> <div class="paragraph"> <p>If you deploy your Spring Boot application to an Application Server, you might want to configure and manage your DataSource by using your Application Server’s built-in features and access it by using JNDI.</p> </div> <div class="paragraph"> <p>The <code>spring.datasource.jndi-name</code> property can be used as an alternative to the <code>spring.datasource.url</code>, <code>spring.datasource.username</code>, and <code>spring.datasource.password</code> properties to access the <code>DataSource</code> from a specific JNDI location. For example, the following section in <code>application.properties</code> shows how you can access a JBoss AS defined <code>DataSource</code>:</p> </div> <div class="listingblock primary"> <div class="title">Properties</div> <div class="content"> <pre class="highlight" data-language="properties"><code class="language-properties" data-lang="properties">spring.datasource.jndi-name=java:jboss/datasources/customers</code></pre> </div> </div> <div class="listingblock secondary"> <div class="title">Yaml</div> <div class="content"> <pre class="highlight" data-language="yaml"><code class="language-yaml" data-lang="yaml">spring:
  datasource:
    jndi-name: "java:jboss/datasources/customers"</code></pre> </div> </div> </div> </div> <div class="sect2"> <h3 id="data.sql.jdbc-template">
1.2. Using JdbcTemplate</h3> <div class="paragraph"> <p>Spring’s <code>JdbcTemplate</code> and <code>NamedParameterJdbcTemplate</code> classes are auto-configured, and you can <code>@Autowire</code> them directly into your own beans, as shown in the following example:</p> </div> <div class="listingblock primary"> <div class="title">Java</div> <div class="content"> <pre class="highlight" data-language="java"><code class="language-java" data-lang="java"><span class="fold-block hide-when-folded">import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.stereotype.Component;

</span><span class="fold-block">@Component
public class MyBean {

    private final JdbcTemplate jdbcTemplate;

    public MyBean(JdbcTemplate jdbcTemplate) {
        this.jdbcTemplate = jdbcTemplate;
    }

    public void doSomething() {
        this.jdbcTemplate ...
    }

}
</span></code></pre> </div> </div> <div class="listingblock secondary"> <div class="title">Kotlin</div> <div class="content"> <pre class="highlight" data-language="kotlin"><code class="language-kotlin" data-lang="kotlin"><span class="fold-block hide-when-folded">import org.springframework.jdbc.core.JdbcTemplate
import org.springframework.stereotype.Component

</span><span class="fold-block">@Component
class MyBean(private val jdbcTemplate: JdbcTemplate) {

    fun doSomething() {
        jdbcTemplate.execute("delete from customer")
    }

}
</span></code></pre> </div> </div> <div class="paragraph"> <p>You can customize some properties of the template by using the <code>spring.jdbc.template.*</code> properties, as shown in the following example:</p> </div> <div class="listingblock primary"> <div class="title">Properties</div> <div class="content"> <pre class="highlight" data-language="properties"><code class="language-properties" data-lang="properties">spring.jdbc.template.max-rows=500</code></pre> </div> </div> <div class="listingblock secondary"> <div class="title">Yaml</div> <div class="content"> <pre class="highlight" data-language="yaml"><code class="language-yaml" data-lang="yaml">spring:
  jdbc:
    template:
      max-rows: 500</code></pre> </div> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon">  </td> <td class="content"> The <code>NamedParameterJdbcTemplate</code> reuses the same <code>JdbcTemplate</code> instance behind the scenes. If more than one <code>JdbcTemplate</code> is defined and no primary candidate exists, the <code>NamedParameterJdbcTemplate</code> is not auto-configured. </td> </tr> </table> </div> </div> <div class="sect2"> <h3 id="data.sql.jpa-and-spring-data">
1.3. JPA and Spring Data JPA</h3> <div class="paragraph"> <p>The Java Persistence API is a standard technology that lets you “map” objects to relational databases. The <code>spring-boot-starter-data-jpa</code> POM provides a quick way to get started. It provides the following key dependencies:</p> </div> <div class="ulist"> <ul> <li> <p>Hibernate: One of the most popular JPA implementations.</p> </li> <li> <p>Spring Data JPA: Helps you to implement JPA-based repositories.</p> </li> <li> <p>Spring ORM: Core ORM support from the Spring Framework.</p> </li> </ul> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon">  </td> <td class="content"> We do not go into too many details of JPA or <a href="https://spring.io/projects/spring-data">Spring Data</a> here. You can follow the <a href="https://spring.io/guides/gs/accessing-data-jpa/">“Accessing Data with JPA”</a> guide from <a href="https://spring.io" class="bare">spring.io</a> and read the <a href="https://spring.io/projects/spring-data-jpa">Spring Data JPA</a> and <a href="https://hibernate.org/orm/documentation/">Hibernate</a> reference documentation. </td> </tr> </table> </div> <div class="sect3"> <h4 id="data.sql.jpa-and-spring-data.entity-classes">
1.3.1. Entity Classes</h4> <div class="paragraph"> <p>Traditionally, JPA “Entity” classes are specified in a <code>persistence.xml</code> file. With Spring Boot, this file is not necessary and “Entity Scanning” is used instead. By default, all packages below your main configuration class (the one annotated with <code>@EnableAutoConfiguration</code> or <code>@SpringBootApplication</code>) are searched.</p> </div> <div class="paragraph"> <p>Any classes annotated with <code>@Entity</code>, <code>@Embeddable</code>, or <code>@MappedSuperclass</code> are considered. A typical entity class resembles the following example:</p> </div> <div class="listingblock primary"> <div class="title">Java</div> <div class="content"> <pre class="highlight" data-language="java"><code class="language-java" data-lang="java"><span class="fold-block hide-when-folded">import java.io.Serializable;

import jakarta.persistence.Column;
import jakarta.persistence.Entity;
import jakarta.persistence.GeneratedValue;
import jakarta.persistence.Id;

</span><span class="fold-block">@Entity
public class City implements Serializable {

    @Id
    @GeneratedValue
    private Long id;

    @Column(nullable = false)
    private String name;

    @Column(nullable = false)
    private String state;

    // ... additional members, often include @OneToMany mappings

    protected City() {
        // no-args constructor required by JPA spec
        // this one is protected since it should not be used directly
    }

    public City(String name, String state) {
        this.name = name;
        this.state = state;
    }

    public String getName() {
        return this.name;
    }

    public String getState() {
        return this.state;
    }

    // ... etc

}
</span></code></pre> </div> </div> <div class="listingblock secondary"> <div class="title">Kotlin</div> <div class="content"> <pre class="highlight" data-language="kotlin"><code class="language-kotlin" data-lang="kotlin"><span class="fold-block hide-when-folded">import jakarta.persistence.Column
import jakarta.persistence.Entity
import jakarta.persistence.GeneratedValue
import jakarta.persistence.Id
import java.io.Serializable

</span><span class="fold-block">@Entity
class City : Serializable {

    @Id
    @GeneratedValue
    private val id: Long? = null

    @Column(nullable = false)
    var name: String? = null
        private set

    // ... etc
    @Column(nullable = false)
    var state: String? = null
        private set

    // ... additional members, often include @OneToMany mappings

    protected constructor() {
        // no-args constructor required by JPA spec
        // this one is protected since it should not be used directly
    }

    constructor(name: String?, state: String?) {
        this.name = name
        this.state = state
    }

}
</span></code></pre> </div> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon">  </td> <td class="content"> You can customize entity scanning locations by using the <code>@EntityScan</code> annotation. See the “<a href="howto.html#howto.data-access.separate-entity-definitions-from-spring-configuration">howto.html</a>” how-to. </td> </tr> </table> </div> </div> <div class="sect3"> <h4 id="data.sql.jpa-and-spring-data.repositories">
1.3.2. Spring Data JPA Repositories</h4> <div class="paragraph"> <p><a href="https://spring.io/projects/spring-data-jpa">Spring Data JPA</a> repositories are interfaces that you can define to access data. JPA queries are created automatically from your method names. For example, a <code>CityRepository</code> interface might declare a <code>findAllByState(String state)</code> method to find all the cities in a given state.</p> </div> <div class="paragraph"> <p>For more complex queries, you can annotate your method with Spring Data’s <a href="https://docs.spring.io/spring-data/jpa/docs/3.1.3/api/org/springframework/data/jpa/repository/Query.html"><code>Query</code></a> annotation.</p> </div> <div class="paragraph"> <p>Spring Data repositories usually extend from the <a href="https://docs.spring.io/spring-data/commons/docs/3.1.3/api/org/springframework/data/repository/Repository.html"><code>Repository</code></a> or <a href="https://docs.spring.io/spring-data/commons/docs/3.1.3/api/org/springframework/data/repository/CrudRepository.html"><code>CrudRepository</code></a> interfaces. If you use auto-configuration, repositories are searched from the package containing your main configuration class (the one annotated with <code>@EnableAutoConfiguration</code> or <code>@SpringBootApplication</code>) down.</p> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon">  </td> <td class="content"> You can customize the locations to look for repositories using <code>@EnableJpaRepositories</code>. </td> </tr> </table> </div> <div class="paragraph"> <p>The following example shows a typical Spring Data repository interface definition:</p> </div> <div class="listingblock primary"> <div class="title">Java</div> <div class="content"> <pre class="highlight" data-language="java"><code class="language-java" data-lang="java"><span class="fold-block hide-when-folded">import org.springframework.boot.docs.data.sql.jpaandspringdata.entityclasses.City;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;
import org.springframework.data.repository.Repository;

</span><span class="fold-block">public interface CityRepository extends Repository&lt;City, Long&gt; {

    Page&lt;City&gt; findAll(Pageable pageable);

    City findByNameAndStateAllIgnoringCase(String name, String state);

}
</span></code></pre> </div> </div> <div class="listingblock secondary"> <div class="title">Kotlin</div> <div class="content"> <pre class="highlight" data-language="kotlin"><code class="language-kotlin" data-lang="kotlin"><span class="fold-block hide-when-folded">import org.springframework.boot.docs.data.sql.jpaandspringdata.entityclasses.City
import org.springframework.data.domain.Page
import org.springframework.data.domain.Pageable
import org.springframework.data.repository.Repository

</span><span class="fold-block">interface CityRepository : Repository&lt;City?, Long?&gt; {

    fun findAll(pageable: Pageable?): Page&lt;City?&gt;?

    fun findByNameAndStateAllIgnoringCase(name: String?, state: String?): City?

}
</span></code></pre> </div> </div> <div class="paragraph"> <p>Spring Data JPA repositories support three different modes of bootstrapping: default, deferred, and lazy. To enable deferred or lazy bootstrapping, set the <code>spring.data.jpa.repositories.bootstrap-mode</code> property to <code>deferred</code> or <code>lazy</code> respectively. When using deferred or lazy bootstrapping, the auto-configured <code>EntityManagerFactoryBuilder</code> will use the context’s <code>AsyncTaskExecutor</code>, if any, as the bootstrap executor. If more than one exists, the one named <code>applicationTaskExecutor</code> will be used.</p> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon">  </td> <td class="content"> <div class="paragraph"> <p>When using deferred or lazy bootstrapping, make sure to defer any access to the JPA infrastructure after the application context bootstrap phase. You can use <code>SmartInitializingSingleton</code> to invoke any initialization that requires the JPA infrastructure. For JPA components (such as converters) that are created as Spring beans, use <code>ObjectProvider</code> to delay the resolution of dependencies, if any.</p> </div> </td> </tr> </table> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon">  </td> <td class="content"> We have barely scratched the surface of Spring Data JPA. For complete details, see the <a href="https://docs.spring.io/spring-data/jpa/docs/3.1.3/reference/html">Spring Data JPA reference documentation</a>. </td> </tr> </table> </div> </div> <div class="sect3"> <h4 id="data.sql.jpa-and-spring-data.envers-repositories">
1.3.3. Spring Data Envers Repositories</h4> <div class="paragraph"> <p>If <a href="https://spring.io/projects/spring-data-envers">Spring Data Envers</a> is available, JPA repositories are auto-configured to support typical Envers queries.</p> </div> <div class="paragraph"> <p>To use Spring Data Envers, make sure your repository extends from <code>RevisionRepository</code> as shown in the following example:</p> </div> <div class="listingblock primary"> <div class="title">Java</div> <div class="content"> <pre class="highlight" data-language="java"><code class="language-java" data-lang="java"><span class="fold-block hide-when-folded">import org.springframework.boot.docs.data.sql.jpaandspringdata.entityclasses.Country;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;
import org.springframework.data.repository.Repository;
import org.springframework.data.repository.history.RevisionRepository;

</span><span class="fold-block">public interface CountryRepository extends RevisionRepository&lt;Country, Long, Integer&gt;, Repository&lt;Country, Long&gt; {

    Page&lt;Country&gt; findAll(Pageable pageable);

}
</span></code></pre> </div> </div> <div class="listingblock secondary"> <div class="title">Kotlin</div> <div class="content"> <pre class="highlight" data-language="kotlin"><code class="language-kotlin" data-lang="kotlin"><span class="fold-block hide-when-folded">import org.springframework.boot.docs.data.sql.jpaandspringdata.entityclasses.Country
import org.springframework.data.domain.Page
import org.springframework.data.domain.Pageable
import org.springframework.data.repository.Repository
import org.springframework.data.repository.history.RevisionRepository

</span><span class="fold-block">interface CountryRepository :
        RevisionRepository&lt;Country?, Long?, Int&gt;,
        Repository&lt;Country?, Long?&gt; {

    fun findAll(pageable: Pageable?): Page&lt;Country?&gt;?

}
</span></code></pre> </div> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon">  </td> <td class="content"> For more details, check the <a href="https://docs.spring.io/spring-data/envers/docs/3.1.3/reference/html/">Spring Data Envers reference documentation</a>. </td> </tr> </table> </div> </div> <div class="sect3"> <h4 id="data.sql.jpa-and-spring-data.creating-and-dropping">
1.3.4. Creating and Dropping JPA Databases</h4> <div class="paragraph"> <p>By default, JPA databases are automatically created <strong>only</strong> if you use an embedded database (H2, HSQL, or Derby). You can explicitly configure JPA settings by using <code>spring.jpa.*</code> properties. For example, to create and drop tables you can add the following line to your <code>application.properties</code>:</p> </div> <div class="listingblock primary"> <div class="title">Properties</div> <div class="content"> <pre class="highlight" data-language="properties"><code class="language-properties" data-lang="properties">spring.jpa.hibernate.ddl-auto=create-drop</code></pre> </div> </div> <div class="listingblock secondary"> <div class="title">Yaml</div> <div class="content"> <pre class="highlight" data-language="yaml"><code class="language-yaml" data-lang="yaml">spring:
  jpa:
    hibernate.ddl-auto: "create-drop"</code></pre> </div> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon">  </td> <td class="content"> Hibernate’s own internal property name for this (if you happen to remember it better) is <code>hibernate.hbm2ddl.auto</code>. You can set it, along with other Hibernate native properties, by using <code>spring.jpa.properties.*</code> (the prefix is stripped before adding them to the entity manager). The following line shows an example of setting JPA properties for Hibernate: </td> </tr> </table> </div> <div class="listingblock primary"> <div class="title">Properties</div> <div class="content"> <pre class="highlight" data-language="properties"><code class="language-properties" data-lang="properties">spring.jpa.properties.hibernate[globally_quoted_identifiers]=true</code></pre> </div> </div> <div class="listingblock secondary"> <div class="title">Yaml</div> <div class="content"> <pre class="highlight" data-language="yaml"><code class="language-yaml" data-lang="yaml">spring:
  jpa:
    properties:
      hibernate:
        "globally_quoted_identifiers": "true"</code></pre> </div> </div> <div class="paragraph"> <p>The line in the preceding example passes a value of <code>true</code> for the <code>hibernate.globally_quoted_identifiers</code> property to the Hibernate entity manager.</p> </div> <div class="paragraph"> <p>By default, the DDL execution (or validation) is deferred until the <code>ApplicationContext</code> has started. There is also a <code>spring.jpa.generate-ddl</code> flag, but it is not used if Hibernate auto-configuration is active, because the <code>ddl-auto</code> settings are more fine-grained.</p> </div> </div> <div class="sect3"> <h4 id="data.sql.jpa-and-spring-data.open-entity-manager-in-view">
1.3.5. Open EntityManager in View</h4> <div class="paragraph"> <p>If you are running a web application, Spring Boot by default registers <a href="https://docs.spring.io/spring-framework/docs/6.0.11/javadoc-api/org/springframework/orm/jpa/support/OpenEntityManagerInViewInterceptor.html"><code>OpenEntityManagerInViewInterceptor</code></a> to apply the “Open EntityManager in View” pattern, to allow for lazy loading in web views. If you do not want this behavior, you should set <code>spring.jpa.open-in-view</code> to <code>false</code> in your <code>application.properties</code>.</p> </div> </div> </div> <div class="sect2"> <h3 id="data.sql.jdbc">
1.4. Spring Data JDBC</h3> <div class="paragraph"> <p>Spring Data includes repository support for JDBC and will automatically generate SQL for the methods on <code>CrudRepository</code>. For more advanced queries, a <code>@Query</code> annotation is provided.</p> </div> <div class="paragraph"> <p>Spring Boot will auto-configure Spring Data’s JDBC repositories when the necessary dependencies are on the classpath. They can be added to your project with a single dependency on <code>spring-boot-starter-data-jdbc</code>. If necessary, you can take control of Spring Data JDBC’s configuration by adding the <code>@EnableJdbcRepositories</code> annotation or an <code>AbstractJdbcConfiguration</code> subclass to your application.</p> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon">  </td> <td class="content"> For complete details of Spring Data JDBC, see the <a href="https://docs.spring.io/spring-data/jdbc/docs/3.1.3/reference/html/">reference documentation</a>. </td> </tr> </table> </div> </div> <div class="sect2"> <h3 id="data.sql.h2-web-console">
1.5. Using H2’s Web Console</h3> <div class="paragraph"> <p>The <a href="https://www.h2database.com">H2 database</a> provides a <a href="https://www.h2database.com/html/quickstart.html#h2_console">browser-based console</a> that Spring Boot can auto-configure for you. The console is auto-configured when the following conditions are met:</p> </div> <div class="ulist"> <ul> <li> <p>You are developing a servlet-based web application.</p> </li> <li> <p><code>com.h2database:h2</code> is on the classpath.</p> </li> <li> <p>You are using <a href="using.html#using.devtools">Spring Boot’s developer tools</a>.</p> </li> </ul> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon">  </td> <td class="content"> If you are not using Spring Boot’s developer tools but would still like to make use of H2’s console, you can configure the <code>spring.h2.console.enabled</code> property with a value of <code>true</code>. </td> </tr> </table> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon">  </td> <td class="content"> The H2 console is only intended for use during development, so you should take care to ensure that <code>spring.h2.console.enabled</code> is not set to <code>true</code> in production. </td> </tr> </table> </div> <div class="sect3"> <h4 id="data.sql.h2-web-console.custom-path">
1.5.1. Changing the H2 Console’s Path</h4> <div class="paragraph"> <p>By default, the console is available at <code>/h2-console</code>. You can customize the console’s path by using the <code>spring.h2.console.path</code> property.</p> </div> </div> <div class="sect3"> <h4 id="data.sql.h2-web-console.spring-security">
1.5.2. Accessing the H2 Console in a Secured Application</h4> <div class="paragraph"> <p>H2 Console uses frames and, as it is intended for development only, does not implement CSRF protection measures. If your application uses Spring Security, you need to configure it to</p> </div> <div class="ulist"> <ul> <li> <p>disable CSRF protection for requests against the console,</p> </li> <li> <p>set the header <code>X-Frame-Options</code> to <code>SAMEORIGIN</code> on responses from the console.</p> </li> </ul> </div> <div class="paragraph"> <p>More information on <a href="https://docs.spring.io/spring-security/reference/6.1.3/features/exploits/csrf.html">CSRF</a> and the header <a href="https://docs.spring.io/spring-security/reference/6.1.3/features/exploits/headers.html#headers-frame-options">X-Frame-Options</a> can be found in the Spring Security Reference Guide.</p> </div> <div class="paragraph"> <p>In simple setups, a <code>SecurityFilterChain</code> like the following can be used:</p> </div> <div class="listingblock primary"> <div class="title">Java</div> <div class="content"> <pre class="highlight" data-language="java"><code class="language-java" data-lang="java"><span class="fold-block hide-when-folded">import org.springframework.boot.autoconfigure.security.servlet.PathRequest;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.Profile;
import org.springframework.core.Ordered;
import org.springframework.core.annotation.Order;
import org.springframework.security.config.Customizer;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.web.SecurityFilterChain;

</span><span class="fold-block">@Profile("dev")
@Configuration(proxyBeanMethods = false)
public class DevProfileSecurityConfiguration {

    @Bean
    @Order(Ordered.HIGHEST_PRECEDENCE)
    SecurityFilterChain h2ConsoleSecurityFilterChain(HttpSecurity http) throws Exception {
        http.securityMatcher(PathRequest.toH2Console());
        http.authorizeHttpRequests(yourCustomAuthorization());
        http.csrf((csrf) -&gt; csrf.disable());
        http.headers((headers) -&gt; headers.frameOptions((frame) -&gt; frame.sameOrigin()));
        return http.build();
    }


}
</span></code></pre> </div> </div> <div class="listingblock secondary"> <div class="title">Kotlin</div> <div class="content"> <pre class="highlight" data-language="kotlin"><code class="language-kotlin" data-lang="kotlin"><span class="fold-block hide-when-folded">import org.springframework.context.annotation.Bean
import org.springframework.context.annotation.Configuration
import org.springframework.context.annotation.Profile
import org.springframework.core.Ordered
import org.springframework.core.annotation.Order
import org.springframework.security.config.Customizer
import org.springframework.security.config.annotation.web.builders.HttpSecurity
import org.springframework.security.web.SecurityFilterChain

</span><span class="fold-block">@Profile("dev")
@Configuration(proxyBeanMethods = false)
class DevProfileSecurityConfiguration {

    @Bean
    @Order(Ordered.HIGHEST_PRECEDENCE)
    fun h2ConsoleSecurityFilterChain(http: HttpSecurity): SecurityFilterChain {
        return http.authorizeHttpRequests(yourCustomAuthorization())
            .csrf { csrf -&gt; csrf.disable() }
            .headers { headers -&gt; headers.frameOptions { frameOptions -&gt; frameOptions.sameOrigin() } }
            .build()
    }


}
</span></code></pre> </div> </div> <div class="admonitionblock warning"> <table> <tr> <td class="icon">  </td> <td class="content"> The H2 console is only intended for use during development. In production, disabling CSRF protection or allowing frames for a website may create severe security risks. </td> </tr> </table> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon">  </td> <td class="content"> <code>PathRequest.toH2Console()</code> returns the correct request matcher also when the console’s path has been customized. </td> </tr> </table> </div> </div> </div> <div class="sect2"> <h3 id="data.sql.jooq">
1.6. Using jOOQ</h3> <div class="paragraph"> <p>jOOQ Object Oriented Querying (<a href="https://www.jooq.org/">jOOQ</a>) is a popular product from <a href="https://www.datageekery.com/">Data Geekery</a> which generates Java code from your database and lets you build type-safe SQL queries through its fluent API. Both the commercial and open source editions can be used with Spring Boot.</p> </div> <div class="sect3"> <h4 id="data.sql.jooq.codegen">
1.6.1. Code Generation</h4> <div class="paragraph"> <p>In order to use jOOQ type-safe queries, you need to generate Java classes from your database schema. You can follow the instructions in the <a href="https://www.jooq.org/doc/3.18.6/manual-single-page/#jooq-in-7-steps-step3">jOOQ user manual</a>. If you use the <code>jooq-codegen-maven</code> plugin and you also use the <code>spring-boot-starter-parent</code> “parent POM”, you can safely omit the plugin’s <code>&lt;version&gt;</code> tag. You can also use Spring Boot-defined version variables (such as <code>h2.version</code>) to declare the plugin’s database dependency. The following listing shows an example:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight" data-language="xml"><code class="language-xml" data-lang="xml">&lt;plugin&gt;
    &lt;groupId&gt;org.jooq&lt;/groupId&gt;
    &lt;artifactId&gt;jooq-codegen-maven&lt;/artifactId&gt;
    &lt;executions&gt;
        ...
    &lt;/executions&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.h2database&lt;/groupId&gt;
            &lt;artifactId&gt;h2&lt;/artifactId&gt;
            &lt;version&gt;${h2.version}&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
    &lt;configuration&gt;
        &lt;jdbc&gt;
            &lt;driver&gt;org.h2.Driver&lt;/driver&gt;
            &lt;url&gt;jdbc:h2:~/yourdatabase&lt;/url&gt;
        &lt;/jdbc&gt;
        &lt;generator&gt;
            ...
        &lt;/generator&gt;
    &lt;/configuration&gt;
&lt;/plugin&gt;</code></pre> </div> </div> </div> <div class="sect3"> <h4 id="data.sql.jooq.dslcontext">
1.6.2. Using DSLContext</h4> <div class="paragraph"> <p>The fluent API offered by jOOQ is initiated through the <code>org.jooq.DSLContext</code> interface. Spring Boot auto-configures a <code>DSLContext</code> as a Spring Bean and connects it to your application <code>DataSource</code>. To use the <code>DSLContext</code>, you can inject it, as shown in the following example:</p> </div> <div class="listingblock primary"> <div class="title">Java</div> <div class="content"> <pre class="highlight" data-language="java"><code class="language-java" data-lang="java"><span class="fold-block hide-when-folded">import java.util.GregorianCalendar;
import java.util.List;

import org.jooq.DSLContext;

import org.springframework.stereotype.Component;

import static org.springframework.boot.docs.data.sql.jooq.dslcontext.Tables.AUTHOR;

</span><span class="fold-block">@Component
public class MyBean {

    private final DSLContext create;

    public MyBean(DSLContext dslContext) {
        this.create = dslContext;
    }


}
</span></code></pre> </div> </div> <div class="listingblock secondary"> <div class="title">Kotlin</div> <div class="content"> <pre class="highlight" data-language="kotlin"><code class="language-kotlin" data-lang="kotlin"><span class="fold-block hide-when-folded">import org.jooq.DSLContext
import org.springframework.stereotype.Component
import java.util.GregorianCalendar

</span><span class="fold-block">@Component
class MyBean(private val create: DSLContext) {


}
</span></code></pre> </div> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon">  </td> <td class="content"> The jOOQ manual tends to use a variable named <code>create</code> to hold the <code>DSLContext</code>. </td> </tr> </table> </div> <div class="paragraph"> <p>You can then use the <code>DSLContext</code> to construct your queries, as shown in the following example:</p> </div> <div class="listingblock primary"> <div class="title">Java</div> <div class="content"> <pre class="highlight" data-language="java"><code class="language-java" data-lang="java">public List&lt;GregorianCalendar&gt; authorsBornAfter1980() {
    return this.create.selectFrom(AUTHOR)
        .where(AUTHOR.DATE_OF_BIRTH.greaterThan(new GregorianCalendar(1980, 0, 1)))
        .fetch(AUTHOR.DATE_OF_BIRTH);
</code></pre> </div> </div> <div class="listingblock secondary"> <div class="title">Kotlin</div> <div class="content"> <pre class="highlight" data-language="kotlin"><code class="language-kotlin" data-lang="kotlin">fun authorsBornAfter1980(): List&lt;GregorianCalendar&gt; {
    return create.selectFrom&lt;Tables.TAuthorRecord&gt;(Tables.AUTHOR)
        .where(Tables.AUTHOR?.DATE_OF_BIRTH?.greaterThan(GregorianCalendar(1980, 0, 1)))
        .fetch(Tables.AUTHOR?.DATE_OF_BIRTH)
}
</code></pre> </div> </div> </div> <div class="sect3"> <h4 id="data.sql.jooq.sqldialect">
1.6.3. jOOQ SQL Dialect</h4> <div class="paragraph"> <p>Unless the <code>spring.jooq.sql-dialect</code> property has been configured, Spring Boot determines the SQL dialect to use for your datasource. If Spring Boot could not detect the dialect, it uses <code>DEFAULT</code>.</p> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon">  </td> <td class="content"> Spring Boot can only auto-configure dialects supported by the open source version of jOOQ. </td> </tr> </table> </div> </div> <div class="sect3"> <h4 id="data.sql.jooq.customizing">
1.6.4. Customizing jOOQ</h4> <div class="paragraph"> <p>More advanced customizations can be achieved by defining your own <code>DefaultConfigurationCustomizer</code> bean that will be invoked prior to creating the <code>org.jooq.Configuration</code> <code>@Bean</code>. This takes precedence to anything that is applied by the auto-configuration.</p> </div> <div class="paragraph"> <p>You can also create your own <code>org.jooq.Configuration</code> <code>@Bean</code> if you want to take complete control of the jOOQ configuration.</p> </div> </div> </div> <div class="sect2"> <h3 id="data.sql.r2dbc">
1.7. Using R2DBC</h3> <div class="paragraph"> <p>The Reactive Relational Database Connectivity (<a href="https://r2dbc.io">R2DBC</a>) project brings reactive programming APIs to relational databases. R2DBC’s <code>io.r2dbc.spi.Connection</code> provides a standard method of working with non-blocking database connections. Connections are provided by using a <code>ConnectionFactory</code>, similar to a <code>DataSource</code> with jdbc.</p> </div> <div class="paragraph"> <p><code>ConnectionFactory</code> configuration is controlled by external configuration properties in <code>spring.r2dbc.*</code>. For example, you might declare the following section in <code>application.properties</code>:</p> </div> <div class="listingblock primary"> <div class="title">Properties</div> <div class="content"> <pre class="highlight" data-language="properties"><code class="language-properties" data-lang="properties">spring.r2dbc.url=r2dbc:postgresql://localhost/test
spring.r2dbc.username=dbuser
spring.r2dbc.password=dbpass</code></pre> </div> </div> <div class="listingblock secondary"> <div class="title">Yaml</div> <div class="content"> <pre class="highlight" data-language="yaml"><code class="language-yaml" data-lang="yaml">spring:
  r2dbc:
    url: "r2dbc:postgresql://localhost/test"
    username: "dbuser"
    password: "dbpass"</code></pre> </div> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon">  </td> <td class="content"> You do not need to specify a driver class name, since Spring Boot obtains the driver from R2DBC’s Connection Factory discovery. </td> </tr> </table> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon">  </td> <td class="content"> At least the url should be provided. Information specified in the URL takes precedence over individual properties, that is <code>name</code>, <code>username</code>, <code>password</code> and pooling options. </td> </tr> </table> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon">  </td> <td class="content"> The “How-to” section includes a <a href="howto.html#howto.data-initialization.using-basic-sql-scripts">section on how to initialize a database</a>. </td> </tr> </table> </div> <div class="paragraph"> <p>To customize the connections created by a <code>ConnectionFactory</code>, that is, set specific parameters that you do not want (or cannot) configure in your central database configuration, you can use a <code>ConnectionFactoryOptionsBuilderCustomizer</code> <code>@Bean</code>. The following example shows how to manually override the database port while the rest of the options are taken from the application configuration:</p> </div> <div class="listingblock primary"> <div class="title">Java</div> <div class="content"> <pre class="highlight" data-language="java"><code class="language-java" data-lang="java"><span class="fold-block hide-when-folded">import io.r2dbc.spi.ConnectionFactoryOptions;

import org.springframework.boot.autoconfigure.r2dbc.ConnectionFactoryOptionsBuilderCustomizer;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

</span><span class="fold-block">@Configuration(proxyBeanMethods = false)
public class MyR2dbcConfiguration {

    @Bean
    public ConnectionFactoryOptionsBuilderCustomizer connectionFactoryPortCustomizer() {
        return (builder) -&gt; builder.option(ConnectionFactoryOptions.PORT, 5432);
    }

}
</span></code></pre> </div> </div> <div class="listingblock secondary"> <div class="title">Kotlin</div> <div class="content"> <pre class="highlight" data-language="kotlin"><code class="language-kotlin" data-lang="kotlin"><span class="fold-block hide-when-folded">import io.r2dbc.spi.ConnectionFactoryOptions
import org.springframework.boot.autoconfigure.r2dbc.ConnectionFactoryOptionsBuilderCustomizer
import org.springframework.context.annotation.Bean
import org.springframework.context.annotation.Configuration

</span><span class="fold-block">@Configuration(proxyBeanMethods = false)
class MyR2dbcConfiguration {

    @Bean
    fun connectionFactoryPortCustomizer(): ConnectionFactoryOptionsBuilderCustomizer {
        return ConnectionFactoryOptionsBuilderCustomizer { builder -&gt;
            builder.option(ConnectionFactoryOptions.PORT, 5432)
        }
    }

}
</span></code></pre> </div> </div> <div class="paragraph"> <p>The following examples show how to set some PostgreSQL connection options:</p> </div> <div class="listingblock primary"> <div class="title">Java</div> <div class="content"> <pre class="highlight" data-language="java"><code class="language-java" data-lang="java"><span class="fold-block hide-when-folded">import java.util.HashMap;
import java.util.Map;

import io.r2dbc.postgresql.PostgresqlConnectionFactoryProvider;

import org.springframework.boot.autoconfigure.r2dbc.ConnectionFactoryOptionsBuilderCustomizer;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

</span><span class="fold-block">@Configuration(proxyBeanMethods = false)
public class MyPostgresR2dbcConfiguration {

    @Bean
    public ConnectionFactoryOptionsBuilderCustomizer postgresCustomizer() {
        Map&lt;String, String&gt; options = new HashMap&lt;&gt;();
        options.put("lock_timeout", "30s");
        options.put("statement_timeout", "60s");
        return (builder) -&gt; builder.option(PostgresqlConnectionFactoryProvider.OPTIONS, options);
    }

}
</span></code></pre> </div> </div> <div class="listingblock secondary"> <div class="title">Kotlin</div> <div class="content"> <pre class="highlight" data-language="kotlin"><code class="language-kotlin" data-lang="kotlin"><span class="fold-block hide-when-folded">import io.r2dbc.postgresql.PostgresqlConnectionFactoryProvider
import org.springframework.boot.autoconfigure.r2dbc.ConnectionFactoryOptionsBuilderCustomizer
import org.springframework.context.annotation.Bean
import org.springframework.context.annotation.Configuration

</span><span class="fold-block">@Configuration(proxyBeanMethods = false)
class MyPostgresR2dbcConfiguration {

    @Bean
    fun postgresCustomizer(): ConnectionFactoryOptionsBuilderCustomizer {
        val options: MutableMap&lt;String, String&gt; = HashMap()
        options["lock_timeout"] = "30s"
        options["statement_timeout"] = "60s"
        return ConnectionFactoryOptionsBuilderCustomizer { builder -&gt;
            builder.option(PostgresqlConnectionFactoryProvider.OPTIONS, options)
        }
    }

}
</span></code></pre> </div> </div> <div class="paragraph"> <p>When a <code>ConnectionFactory</code> bean is available, the regular JDBC <code>DataSource</code> auto-configuration backs off. If you want to retain the JDBC <code>DataSource</code> auto-configuration, and are comfortable with the risk of using the blocking JDBC API in a reactive application, add <code>@Import(DataSourceAutoConfiguration.class)</code> on a <code>@Configuration</code> class in your application to re-enable it.</p> </div> <div class="sect3"> <h4 id="data.sql.r2dbc.embedded">
1.7.1. Embedded Database Support</h4> <div class="paragraph"> <p>Similarly to <a href="features.html#data.sql.datasource.embedded">the JDBC support</a>, Spring Boot can automatically configure an embedded database for reactive usage. You need not provide any connection URLs. You need only include a build dependency to the embedded database that you want to use, as shown in the following example:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight" data-language="xml"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.r2dbc&lt;/groupId&gt;
    &lt;artifactId&gt;r2dbc-h2&lt;/artifactId&gt;
    &lt;scope&gt;runtime&lt;/scope&gt;
&lt;/dependency&gt;</code></pre> </div> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon">  </td> <td class="content"> <div class="paragraph"> <p>If you are using this feature in your tests, you may notice that the same database is reused by your whole test suite regardless of the number of application contexts that you use. If you want to make sure that each context has a separate embedded database, you should set <code>spring.r2dbc.generate-unique-name</code> to <code>true</code>.</p> </div> </td> </tr> </table> </div> </div> <div class="sect3"> <h4 id="data.sql.r2dbc.using-database-client">
1.7.2. Using DatabaseClient</h4> <div class="paragraph"> <p>A <code>DatabaseClient</code> bean is auto-configured, and you can <code>@Autowire</code> it directly into your own beans, as shown in the following example:</p> </div> <div class="listingblock primary"> <div class="title">Java</div> <div class="content"> <pre class="highlight" data-language="java"><code class="language-java" data-lang="java"><span class="fold-block hide-when-folded">import java.util.Map;

import reactor.core.publisher.Flux;

import org.springframework.r2dbc.core.DatabaseClient;
import org.springframework.stereotype.Component;

</span><span class="fold-block">@Component
public class MyBean {

    private final DatabaseClient databaseClient;

    public MyBean(DatabaseClient databaseClient) {
        this.databaseClient = databaseClient;
    }

</span><span class="fold-block hide-when-unfolded">    // ...

</span><span class="fold-block hide-when-folded">    public Flux&lt;Map&lt;String, Object&gt;&gt; someMethod() {
        return this.databaseClient.sql("select * from user").fetch().all();
    }

</span><span class="fold-block">}
</span></code></pre> </div> </div> <div class="listingblock secondary"> <div class="title">Kotlin</div> <div class="content"> <pre class="highlight" data-language="kotlin"><code class="language-kotlin" data-lang="kotlin"><span class="fold-block hide-when-folded">import org.springframework.r2dbc.core.DatabaseClient
import org.springframework.stereotype.Component
import reactor.core.publisher.Flux

</span><span class="fold-block">@Component
class MyBean(private val databaseClient: DatabaseClient) {

</span><span class="fold-block hide-when-unfolded">    // ...

</span><span class="fold-block hide-when-folded">    fun someMethod(): Flux&lt;Map&lt;String, Any&gt;&gt; {
        return databaseClient.sql("select * from user").fetch().all()
    }

</span><span class="fold-block">}
</span></code></pre> </div> </div> </div> <div class="sect3"> <h4 id="data.sql.r2dbc.repositories">
1.7.3. Spring Data R2DBC Repositories</h4> <div class="paragraph"> <p><a href="https://spring.io/projects/spring-data-r2dbc">Spring Data R2DBC</a> repositories are interfaces that you can define to access data. Queries are created automatically from your method names. For example, a <code>CityRepository</code> interface might declare a <code>findAllByState(String state)</code> method to find all the cities in a given state.</p> </div> <div class="paragraph"> <p>For more complex queries, you can annotate your method with Spring Data’s <a href="https://docs.spring.io/spring-data/r2dbc/docs/3.1.3/api/org/springframework/data/r2dbc/repository/Query.html"><code>Query</code></a> annotation.</p> </div> <div class="paragraph"> <p>Spring Data repositories usually extend from the <a href="https://docs.spring.io/spring-data/commons/docs/3.1.3/api/org/springframework/data/repository/Repository.html"><code>Repository</code></a> or <a href="https://docs.spring.io/spring-data/commons/docs/3.1.3/api/org/springframework/data/repository/CrudRepository.html"><code>CrudRepository</code></a> interfaces. If you use auto-configuration, repositories are searched from the package containing your main configuration class (the one annotated with <code>@EnableAutoConfiguration</code> or <code>@SpringBootApplication</code>) down.</p> </div> <div class="paragraph"> <p>The following example shows a typical Spring Data repository interface definition:</p> </div> <div class="listingblock primary"> <div class="title">Java</div> <div class="content"> <pre class="highlight" data-language="java"><code class="language-java" data-lang="java"><span class="fold-block hide-when-folded">import reactor.core.publisher.Mono;

import org.springframework.data.repository.Repository;

</span><span class="fold-block">public interface CityRepository extends Repository&lt;City, Long&gt; {

    Mono&lt;City&gt; findByNameAndStateAllIgnoringCase(String name, String state);

}
</span></code></pre> </div> </div> <div class="listingblock secondary"> <div class="title">Kotlin</div> <div class="content"> <pre class="highlight" data-language="kotlin"><code class="language-kotlin" data-lang="kotlin"><span class="fold-block hide-when-folded">import org.springframework.data.repository.Repository
import reactor.core.publisher.Mono

</span><span class="fold-block">interface CityRepository : Repository&lt;City?, Long?&gt; {

    fun findByNameAndStateAllIgnoringCase(name: String?, state: String?): Mono&lt;City?&gt;?

}
</span></code></pre> </div> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon">  </td> <td class="content"> We have barely scratched the surface of Spring Data R2DBC. For complete details, see the <a href="https://docs.spring.io/spring-data/r2dbc/docs/3.1.3/reference/html/">Spring Data R2DBC reference documentation</a>. </td> </tr> </table> </div> </div> </div> </div> </div> <div class="sect1"> <h2 id="data.nosql">
2. Working with NoSQL Technologies</h2> <div class="sectionbody"> <div class="paragraph"> <p>Spring Data provides additional projects that help you access a variety of NoSQL technologies, including:</p> </div> <div class="ulist"> <ul> <li> <p><a href="https://spring.io/projects/spring-data-cassandra">Cassandra</a></p> </li> <li> <p><a href="https://spring.io/projects/spring-data-couchbase">Couchbase</a></p> </li> <li> <p><a href="https://spring.io/projects/spring-data-elasticsearch">Elasticsearch</a></p> </li> <li> <p><a href="https://spring.io/projects/spring-data-gemfire">GemFire</a> or <a href="https://spring.io/projects/spring-data-geode">Geode</a></p> </li> <li> <p><a href="https://spring.io/projects/spring-data-ldap">LDAP</a></p> </li> <li> <p><a href="https://spring.io/projects/spring-data-mongodb">MongoDB</a></p> </li> <li> <p><a href="https://spring.io/projects/spring-data-neo4j">Neo4J</a></p> </li> <li> <p><a href="https://spring.io/projects/spring-data-redis">Redis</a></p> </li> </ul> </div> <div class="paragraph"> <p>Of these, Spring Boot provides auto-configuration for Cassandra, Couchbase, Elasticsearch, LDAP, MongoDB, and Neo4J. Additionally, <a href="https://github.com/spring-projects/spring-boot-data-geode">Spring Boot for Apache Geode</a> provides <a href="https://docs.spring.io/spring-boot-data-geode-build/2.0.x/reference/html5/#geode-repositories">auto-configuration for Apache Geode</a>. You can make use of the other projects, but you must configure them yourself. See the appropriate reference documentation at <a href="https://spring.io/projects/spring-data" class="bare">spring.io/projects/spring-data</a>.</p> </div> <div class="paragraph"> <p>Spring Boot also provides auto-configuration for the InfluxDB client.</p> </div> <div class="sect2"> <h3 id="data.nosql.redis">
2.1. Redis</h3> <div class="paragraph"> <p><a href="https://redis.io/">Redis</a> is a cache, message broker, and richly-featured key-value store. Spring Boot offers basic auto-configuration for the <a href="https://github.com/lettuce-io/lettuce-core/">Lettuce</a> and <a href="https://github.com/xetorthio/jedis/">Jedis</a> client libraries and the abstractions on top of them provided by <a href="https://github.com/spring-projects/spring-data-redis">Spring Data Redis</a>.</p> </div> <div class="paragraph"> <p>There is a <code>spring-boot-starter-data-redis</code> “Starter” for collecting the dependencies in a convenient way. By default, it uses <a href="https://github.com/lettuce-io/lettuce-core/">Lettuce</a>. That starter handles both traditional and reactive applications.</p> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon">  </td> <td class="content"> We also provide a <code>spring-boot-starter-data-redis-reactive</code> “Starter” for consistency with the other stores with reactive support. </td> </tr> </table> </div> <div class="sect3"> <h4 id="data.nosql.redis.connecting">
2.1.1. Connecting to Redis</h4> <div class="paragraph"> <p>You can inject an auto-configured <code>RedisConnectionFactory</code>, <code>StringRedisTemplate</code>, or vanilla <code>RedisTemplate</code> instance as you would any other Spring Bean. The following listing shows an example of such a bean:</p> </div> <div class="listingblock primary"> <div class="title">Java</div> <div class="content"> <pre class="highlight" data-language="java"><code class="language-java" data-lang="java"><span class="fold-block hide-when-folded">import org.springframework.data.redis.core.StringRedisTemplate;
import org.springframework.stereotype.Component;

</span><span class="fold-block">@Component
public class MyBean {

    private final StringRedisTemplate template;

    public MyBean(StringRedisTemplate template) {
        this.template = template;
    }

</span><span class="fold-block hide-when-unfolded">    // ...

</span><span class="fold-block hide-when-folded">    public Boolean someMethod() {
        return this.template.hasKey("spring");
    }

</span><span class="fold-block">}
</span></code></pre> </div> </div> <div class="listingblock secondary"> <div class="title">Kotlin</div> <div class="content"> <pre class="highlight" data-language="kotlin"><code class="language-kotlin" data-lang="kotlin"><span class="fold-block hide-when-folded">import org.springframework.data.redis.core.StringRedisTemplate
import org.springframework.stereotype.Component

</span><span class="fold-block">@Component
class MyBean(private val template: StringRedisTemplate) {

</span><span class="fold-block hide-when-unfolded">    // ...

</span><span class="fold-block hide-when-folded">    fun someMethod(): Boolean {
        return template.hasKey("spring")
    }

</span><span class="fold-block">}
</span></code></pre> </div> </div> <div class="paragraph"> <p>By default, the instance tries to connect to a Redis server at <code>localhost:6379</code>. You can specify custom connection details using <code>spring.data.redis.*</code> properties, as shown in the following example:</p> </div> <div class="listingblock primary"> <div class="title">Properties</div> <div class="content"> <pre class="highlight" data-language="properties"><code class="language-properties" data-lang="properties">spring.data.redis.host=localhost
spring.data.redis.port=6379
spring.data.redis.database=0
spring.data.redis.username=user
spring.data.redis.password=secret</code></pre> </div> </div> <div class="listingblock secondary"> <div class="title">Yaml</div> <div class="content"> <pre class="highlight" data-language="yaml"><code class="language-yaml" data-lang="yaml">spring:
  data:
    redis:
      host: "localhost"
      port: 6379
      database: 0
      username: "user"
      password: "secret"</code></pre> </div> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon">  </td> <td class="content"> You can also register an arbitrary number of beans that implement <code>LettuceClientConfigurationBuilderCustomizer</code> for more advanced customizations. <code>ClientResources</code> can also be customized using <code>ClientResourcesBuilderCustomizer</code>. If you use Jedis, <code>JedisClientConfigurationBuilderCustomizer</code> is also available. Alternatively, you can register a bean of type <code>RedisStandaloneConfiguration</code>, <code>RedisSentinelConfiguration</code>, or <code>RedisClusterConfiguration</code> to take full control over the configuration. </td> </tr> </table> </div> <div class="paragraph"> <p>If you add your own <code>@Bean</code> of any of the auto-configured types, it replaces the default (except in the case of <code>RedisTemplate</code>, when the exclusion is based on the bean name, <code>redisTemplate</code>, not its type).</p> </div> <div class="paragraph"> <p>By default, a pooled connection factory is auto-configured if <code>commons-pool2</code> is on the classpath.</p> </div> <div class="paragraph"> <p>The auto-configured <code>RedisConnectionFactory</code> can be configured to use SSL for communication with the server by setting the properties as shown in this example:</p> </div> <div class="listingblock primary"> <div class="title">Properties</div> <div class="content"> <pre class="highlight" data-language="properties"><code class="language-properties" data-lang="properties">spring.data.redis.ssl.enabled=true</code></pre> </div> </div> <div class="listingblock secondary"> <div class="title">Yaml</div> <div class="content"> <pre class="highlight" data-language="yaml"><code class="language-yaml" data-lang="yaml">spring:
  data:
    redis:
      ssl:
        enabled: true</code></pre> </div> </div> <div class="paragraph"> <p>Custom SSL trust material can be configured in an <a href="features.html#features.ssl">SSL bundle</a> and applied to the <code>RedisConnectionFactory</code> as shown in this example:</p> </div> <div class="listingblock primary"> <div class="title">Properties</div> <div class="content"> <pre class="highlight" data-language="properties"><code class="language-properties" data-lang="properties">spring.data.redis.ssl.bundle=example</code></pre> </div> </div> <div class="listingblock secondary"> <div class="title">Yaml</div> <div class="content"> <pre class="highlight" data-language="yaml"><code class="language-yaml" data-lang="yaml">spring:
  data:
    redis:
      ssl:
        bundle: "example"</code></pre> </div> </div> </div> </div> <div class="sect2"> <h3 id="data.nosql.mongodb">
2.2. MongoDB</h3> <div class="paragraph"> <p><a href="https://www.mongodb.com/">MongoDB</a> is an open-source NoSQL document database that uses a JSON-like schema instead of traditional table-based relational data. Spring Boot offers several conveniences for working with MongoDB, including the <code>spring-boot-starter-data-mongodb</code> and <code>spring-boot-starter-data-mongodb-reactive</code> “Starters”.</p> </div> <div class="sect3"> <h4 id="data.nosql.mongodb.connecting">
2.2.1. Connecting to a MongoDB Database</h4> <div class="paragraph"> <p>To access MongoDB databases, you can inject an auto-configured <code>org.springframework.data.mongodb.MongoDatabaseFactory</code>. By default, the instance tries to connect to a MongoDB server at <code>mongodb://localhost/test</code>. The following example shows how to connect to a MongoDB database:</p> </div> <div class="listingblock primary"> <div class="title">Java</div> <div class="content"> <pre class="highlight" data-language="java"><code class="language-java" data-lang="java"><span class="fold-block hide-when-folded">import com.mongodb.client.MongoCollection;
import com.mongodb.client.MongoDatabase;
import org.bson.Document;

import org.springframework.data.mongodb.MongoDatabaseFactory;
import org.springframework.stereotype.Component;

</span><span class="fold-block">@Component
public class MyBean {

    private final MongoDatabaseFactory mongo;

    public MyBean(MongoDatabaseFactory mongo) {
        this.mongo = mongo;
    }

</span><span class="fold-block hide-when-unfolded">    // ...

</span><span class="fold-block hide-when-folded">    public MongoCollection&lt;Document&gt; someMethod() {
        MongoDatabase db = this.mongo.getMongoDatabase();
        return db.getCollection("users");
    }

</span><span class="fold-block">}
</span></code></pre> </div> </div> <div class="listingblock secondary"> <div class="title">Kotlin</div> <div class="content"> <pre class="highlight" data-language="kotlin"><code class="language-kotlin" data-lang="kotlin"><span class="fold-block hide-when-folded">import com.mongodb.client.MongoCollection
import org.bson.Document
import org.springframework.data.mongodb.MongoDatabaseFactory
import org.springframework.stereotype.Component

</span><span class="fold-block">@Component
class MyBean(private val mongo: MongoDatabaseFactory) {

</span><span class="fold-block hide-when-unfolded">    // ...

</span><span class="fold-block hide-when-folded">    fun someMethod(): MongoCollection&lt;Document&gt; {
        val db = mongo.mongoDatabase
        return db.getCollection("users")
    }

</span><span class="fold-block">}
</span></code></pre> </div> </div> <div class="paragraph"> <p>If you have defined your own <code>MongoClient</code>, it will be used to auto-configure a suitable <code>MongoDatabaseFactory</code>.</p> </div> <div class="paragraph"> <p>The auto-configured <code>MongoClient</code> is created using a <code>MongoClientSettings</code> bean. If you have defined your own <code>MongoClientSettings</code>, it will be used without modification and the <code>spring.data.mongodb</code> properties will be ignored. Otherwise a <code>MongoClientSettings</code> will be auto-configured and will have the <code>spring.data.mongodb</code> properties applied to it. In either case, you can declare one or more <code>MongoClientSettingsBuilderCustomizer</code> beans to fine-tune the <code>MongoClientSettings</code> configuration. Each will be called in order with the <code>MongoClientSettings.Builder</code> that is used to build the <code>MongoClientSettings</code>.</p> </div> <div class="paragraph"> <p>You can set the <code>spring.data.mongodb.uri</code> property to change the URL and configure additional settings such as the <em>replica set</em>, as shown in the following example:</p> </div> <div class="listingblock primary"> <div class="title">Properties</div> <div class="content"> <pre class="highlight" data-language="properties"><code class="language-properties" data-lang="properties">spring.data.mongodb.uri=mongodb://user:secret@mongoserver1.example.com:27017,mongoserver2.example.com:23456/test</code></pre> </div> </div> <div class="listingblock secondary"> <div class="title">Yaml</div> <div class="content"> <pre class="highlight" data-language="yaml"><code class="language-yaml" data-lang="yaml">spring:
  data:
    mongodb:
      uri: "mongodb://user:secret@mongoserver1.example.com:27017,mongoserver2.example.com:23456/test"</code></pre> </div> </div> <div class="paragraph"> <p>Alternatively, you can specify connection details using discrete properties. For example, you might declare the following settings in your <code>application.properties</code>:</p> </div> <div class="listingblock primary"> <div class="title">Properties</div> <div class="content"> <pre class="highlight" data-language="properties"><code class="language-properties" data-lang="properties">spring.data.mongodb.host=mongoserver1.example.com
spring.data.mongodb.port=27017
spring.data.mongodb.additional-hosts[0]=mongoserver2.example.com:23456
spring.data.mongodb.database=test
spring.data.mongodb.username=user
spring.data.mongodb.password=secret</code></pre> </div> </div> <div class="listingblock secondary"> <div class="title">Yaml</div> <div class="content"> <pre class="highlight" data-language="yaml"><code class="language-yaml" data-lang="yaml">spring:
  data:
    mongodb:
      host: "mongoserver1.example.com"
      port: 27017
      additional-hosts:
      - "mongoserver2.example.com:23456"
      database: "test"
      username: "user"
      password: "secret"</code></pre> </div> </div> <div class="paragraph"> <p>The auto-configured <code>MongoClient</code> can be configured to use SSL for communication with the server by setting the properties as shown in this example:</p> </div> <div class="listingblock primary"> <div class="title">Properties</div> <div class="content"> <pre class="highlight" data-language="properties"><code class="language-properties" data-lang="properties">spring.data.mongodb.uri=mongodb://user:secret@mongoserver1.example.com:27017,mongoserver2.example.com:23456/test
spring.data.mongodb.ssl.enabled=true</code></pre> </div> </div> <div class="listingblock secondary"> <div class="title">Yaml</div> <div class="content"> <pre class="highlight" data-language="yaml"><code class="language-yaml" data-lang="yaml">spring:
  data:
    mongodb:
      uri: "mongodb://user:secret@mongoserver1.example.com:27017,mongoserver2.example.com:23456/test"
      ssl:
        enabled: true</code></pre> </div> </div> <div class="paragraph"> <p>Custom SSL trust material can be configured in an <a href="features.html#features.ssl">SSL bundle</a> and applied to the <code>MongoClient</code> as shown in this example:</p> </div> <div class="listingblock primary"> <div class="title">Properties</div> <div class="content"> <pre class="highlight" data-language="properties"><code class="language-properties" data-lang="properties">spring.data.mongodb.uri=mongodb://user:secret@mongoserver1.example.com:27017,mongoserver2.example.com:23456/test
spring.data.mongodb.ssl.bundle=example</code></pre> </div> </div> <div class="listingblock secondary"> <div class="title">Yaml</div> <div class="content"> <pre class="highlight" data-language="yaml"><code class="language-yaml" data-lang="yaml">spring:
  data:
    mongodb:
      uri: "mongodb://user:secret@mongoserver1.example.com:27017,mongoserver2.example.com:23456/test"
      ssl:
        bundle: "example"</code></pre> </div> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon">  </td> <td class="content"> <div class="paragraph"> <p>If <code>spring.data.mongodb.port</code> is not specified, the default of <code>27017</code> is used. You could delete this line from the example shown earlier.</p> </div> <div class="paragraph"> <p>You can also specify the port as part of the host address by using the <code>host:port</code> syntax. This format should be used if you need to change the port of an <code>additional-hosts</code> entry.</p> </div> </td> </tr> </table> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon">  </td> <td class="content"> If you do not use Spring Data MongoDB, you can inject a <code>MongoClient</code> bean instead of using <code>MongoDatabaseFactory</code>. If you want to take complete control of establishing the MongoDB connection, you can also declare your own <code>MongoDatabaseFactory</code> or <code>MongoClient</code> bean. </td> </tr> </table> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon">  </td> <td class="content"> If you are using the reactive driver, Netty is required for SSL. The auto-configuration configures this factory automatically if Netty is available and the factory to use has not been customized already. </td> </tr> </table> </div> </div> <div class="sect3"> <h4 id="data.nosql.mongodb.template">
2.2.2. MongoTemplate</h4> <div class="paragraph"> <p><a href="https://spring.io/projects/spring-data-mongodb">Spring Data MongoDB</a> provides a <a href="https://docs.spring.io/spring-data/mongodb/docs/4.1.3/api/org/springframework/data/mongodb/core/MongoTemplate.html"><code>MongoTemplate</code></a> class that is very similar in its design to Spring’s <code>JdbcTemplate</code>. As with <code>JdbcTemplate</code>, Spring Boot auto-configures a bean for you to inject the template, as follows:</p> </div> <div class="listingblock primary"> <div class="title">Java</div> <div class="content"> <pre class="highlight" data-language="java"><code class="language-java" data-lang="java"><span class="fold-block hide-when-folded">import com.mongodb.client.MongoCollection;
import org.bson.Document;

import org.springframework.data.mongodb.core.MongoTemplate;
import org.springframework.stereotype.Component;

</span><span class="fold-block">@Component
public class MyBean {

    private final MongoTemplate mongoTemplate;

    public MyBean(MongoTemplate mongoTemplate) {
        this.mongoTemplate = mongoTemplate;
    }

</span><span class="fold-block hide-when-unfolded">    // ...

</span><span class="fold-block hide-when-folded">    public MongoCollection&lt;Document&gt; someMethod() {
        return this.mongoTemplate.getCollection("users");
    }

</span><span class="fold-block">}
</span></code></pre> </div> </div> <div class="listingblock secondary"> <div class="title">Kotlin</div> <div class="content"> <pre class="highlight" data-language="kotlin"><code class="language-kotlin" data-lang="kotlin"><span class="fold-block hide-when-folded">import com.mongodb.client.MongoCollection
import org.bson.Document
import org.springframework.data.mongodb.core.MongoTemplate
import org.springframework.stereotype.Component

</span><span class="fold-block">@Component
class MyBean(private val mongoTemplate: MongoTemplate) {

</span><span class="fold-block hide-when-unfolded">    // ...

</span><span class="fold-block hide-when-folded">    fun someMethod(): MongoCollection&lt;Document&gt; {
        return mongoTemplate.getCollection("users")
    }

</span><span class="fold-block">}
</span></code></pre> </div> </div> <div class="paragraph"> <p>See the <a href="https://docs.spring.io/spring-data/mongodb/docs/4.1.3/api/org/springframework/data/mongodb/core/MongoOperations.html"><code>MongoOperations</code> Javadoc</a> for complete details.</p> </div> </div> <div class="sect3"> <h4 id="data.nosql.mongodb.repositories">
2.2.3. Spring Data MongoDB Repositories</h4> <div class="paragraph"> <p>Spring Data includes repository support for MongoDB. As with the JPA repositories discussed earlier, the basic principle is that queries are constructed automatically, based on method names.</p> </div> <div class="paragraph"> <p>In fact, both Spring Data JPA and Spring Data MongoDB share the same common infrastructure. You could take the JPA example from earlier and, assuming that <code>City</code> is now a MongoDB data class rather than a JPA <code>@Entity</code>, it works in the same way, as shown in the following example:</p> </div> <div class="listingblock primary"> <div class="title">Java</div> <div class="content"> <pre class="highlight" data-language="java"><code class="language-java" data-lang="java"><span class="fold-block hide-when-folded">import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;
import org.springframework.data.repository.Repository;

</span><span class="fold-block">public interface CityRepository extends Repository&lt;City, Long&gt; {

    Page&lt;City&gt; findAll(Pageable pageable);

    City findByNameAndStateAllIgnoringCase(String name, String state);

}
</span></code></pre> </div> </div> <div class="listingblock secondary"> <div class="title">Kotlin</div> <div class="content"> <pre class="highlight" data-language="kotlin"><code class="language-kotlin" data-lang="kotlin"><span class="fold-block hide-when-folded">import org.springframework.data.domain.Page
import org.springframework.data.domain.Pageable
import org.springframework.data.repository.Repository

</span><span class="fold-block">interface CityRepository :
    Repository&lt;City?, Long?&gt; {
    fun findAll(pageable: Pageable?): Page&lt;City?&gt;?
    fun findByNameAndStateAllIgnoringCase(name: String?, state: String?): City?
}
</span></code></pre> </div> </div> <div class="paragraph"> <p>Repositories and documents are found through scanning. By default, the package containing your main configuration class (the one annotated with <code>@EnableAutoConfiguration</code> or <code>@SpringBootApplication</code>) and all those below it are searched. You can customize the locations to look for repositories and documents by using <code>@EnableMongoRepositories</code> and <code>@EntityScan</code> respectively.</p> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon">  </td> <td class="content"> For complete details of Spring Data MongoDB, including its rich object mapping technologies, see its <a href="https://spring.io/projects/spring-data-mongodb">reference documentation</a>. </td> </tr> </table> </div> </div> </div> <div class="sect2"> <h3 id="data.nosql.neo4j">
2.3. Neo4j</h3> <div class="paragraph"> <p><a href="https://neo4j.com/">Neo4j</a> is an open-source NoSQL graph database that uses a rich data model of nodes connected by first class relationships, which is better suited for connected big data than traditional RDBMS approaches. Spring Boot offers several conveniences for working with Neo4j, including the <code>spring-boot-starter-data-neo4j</code> “Starter”.</p> </div> <div class="sect3"> <h4 id="data.nosql.neo4j.connecting">
2.3.1. Connecting to a Neo4j Database</h4> <div class="paragraph"> <p>To access a Neo4j server, you can inject an auto-configured <code>org.neo4j.driver.Driver</code>. By default, the instance tries to connect to a Neo4j server at <code>localhost:7687</code> using the Bolt protocol. The following example shows how to inject a Neo4j <code>Driver</code> that gives you access, amongst other things, to a <code>Session</code>:</p> </div> <div class="listingblock primary"> <div class="title">Java</div> <div class="content"> <pre class="highlight" data-language="java"><code class="language-java" data-lang="java"><span class="fold-block hide-when-folded">import org.neo4j.driver.Driver;
import org.neo4j.driver.Session;
import org.neo4j.driver.Values;

import org.springframework.stereotype.Component;

</span><span class="fold-block">@Component
public class MyBean {

    private final Driver driver;

    public MyBean(Driver driver) {
        this.driver = driver;
    }

</span><span class="fold-block hide-when-unfolded">    // ...

</span><span class="fold-block hide-when-folded">    public String someMethod(String message) {
        try (Session session = this.driver.session()) {
            return session.executeWrite(
                    (transaction) -&gt; transaction
                        .run("CREATE (a:Greeting) SET a.message = $message RETURN a.message + ', from node ' + id(a)",
                                Values.parameters("message", message))
                        .single()
                        .get(0)
                        .asString());
        }
    }

</span><span class="fold-block">}
</span></code></pre> </div> </div> <div class="listingblock secondary"> <div class="title">Kotlin</div> <div class="content"> <pre class="highlight" data-language="kotlin"><code class="language-kotlin" data-lang="kotlin"><span class="fold-block hide-when-folded">import org.neo4j.driver.*
import org.springframework.stereotype.Component

</span><span class="fold-block">@Component
class MyBean(private val driver: Driver) {

</span><span class="fold-block hide-when-unfolded">    // ...

</span><span class="fold-block hide-when-folded">    fun someMethod(message: String?): String {
        driver.session().use { session -&gt;
            return@someMethod session.executeWrite { transaction: TransactionContext -&gt;
                transaction
                    .run(
                        "CREATE (a:Greeting) SET a.message = \$message RETURN a.message + ', from node ' + id(a)",
                        Values.parameters("message", message)
                    )
                    .single()[0].asString()
            }
        }
    }

</span><span class="fold-block">}
</span></code></pre> </div> </div> <div class="paragraph"> <p>You can configure various aspects of the driver using <code>spring.neo4j.*</code> properties. The following example shows how to configure the uri and credentials to use:</p> </div> <div class="listingblock primary"> <div class="title">Properties</div> <div class="content"> <pre class="highlight" data-language="properties"><code class="language-properties" data-lang="properties">spring.neo4j.uri=bolt://my-server:7687
spring.neo4j.authentication.username=neo4j
spring.neo4j.authentication.password=secret</code></pre> </div> </div> <div class="listingblock secondary"> <div class="title">Yaml</div> <div class="content"> <pre class="highlight" data-language="yaml"><code class="language-yaml" data-lang="yaml">spring:
  neo4j:
    uri: "bolt://my-server:7687"
    authentication:
      username: "neo4j"
      password: "secret"</code></pre> </div> </div> <div class="paragraph"> <p>The auto-configured <code>Driver</code> is created using <code>ConfigBuilder</code>. To fine-tune its configuration, declare one or more <code>ConfigBuilderCustomizer</code> beans. Each will be called in order with the <code>ConfigBuilder</code> that is used to build the <code>Driver</code>.</p> </div> </div> <div class="sect3"> <h4 id="data.nosql.neo4j.repositories">
2.3.2. Spring Data Neo4j Repositories</h4> <div class="paragraph"> <p>Spring Data includes repository support for Neo4j. For complete details of Spring Data Neo4j, see the <a href="https://docs.spring.io/spring-data/neo4j/docs/7.1.3/reference/html/">reference documentation</a>.</p> </div> <div class="paragraph"> <p>Spring Data Neo4j shares the common infrastructure with Spring Data JPA as many other Spring Data modules do. You could take the JPA example from earlier and define <code>City</code> as Spring Data Neo4j <code>@Node</code> rather than JPA <code>@Entity</code> and the repository abstraction works in the same way, as shown in the following example:</p> </div> <div class="listingblock primary"> <div class="title">Java</div> <div class="content"> <pre class="highlight" data-language="java"><code class="language-java" data-lang="java"><span class="fold-block hide-when-folded">import java.util.Optional;

import org.springframework.data.neo4j.repository.Neo4jRepository;

</span><span class="fold-block">public interface CityRepository extends Neo4jRepository&lt;City, Long&gt; {

    Optional&lt;City&gt; findOneByNameAndState(String name, String state);

}
</span></code></pre> </div> </div> <div class="listingblock secondary"> <div class="title">Kotlin</div> <div class="content"> <pre class="highlight" data-language="kotlin"><code class="language-kotlin" data-lang="kotlin"><span class="fold-block hide-when-folded">import org.springframework.data.neo4j.repository.Neo4jRepository
import java.util.Optional

</span><span class="fold-block">interface CityRepository : Neo4jRepository&lt;City?, Long?&gt; {

    fun findOneByNameAndState(name: String?, state: String?): Optional&lt;City?&gt;?

}
</span></code></pre> </div> </div> <div class="paragraph"> <p>The <code>spring-boot-starter-data-neo4j</code> “Starter” enables the repository support as well as transaction management. Spring Boot supports both classic and reactive Neo4j repositories, using the <code>Neo4jTemplate</code> or <code>ReactiveNeo4jTemplate</code> beans. When Project Reactor is available on the classpath, the reactive style is also auto-configured.</p> </div> <div class="paragraph"> <p>Repositories and entities are found through scanning. By default, the package containing your main configuration class (the one annotated with <code>@EnableAutoConfiguration</code> or <code>@SpringBootApplication</code>) and all those below it are searched. You can customize the locations to look for repositories and entities by using <code>@EnableNeo4jRepositories</code> and <code>@EntityScan</code> respectively.</p> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon">  </td> <td class="content"> <div class="paragraph"> <p>In an application using the reactive style, a <code>ReactiveTransactionManager</code> is not auto-configured. To enable transaction management, the following bean must be defined in your configuration:</p> </div> <div class="listingblock primary"> <div class="title">Java</div> <div class="content"> <pre class="highlight" data-language="java"><code class="language-java" data-lang="java"><span class="fold-block hide-when-folded">import org.neo4j.driver.Driver;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.data.neo4j.core.ReactiveDatabaseSelectionProvider;
import org.springframework.data.neo4j.core.transaction.ReactiveNeo4jTransactionManager;

</span><span class="fold-block">@Configuration(proxyBeanMethods = false)
public class MyNeo4jConfiguration {

    @Bean
    public ReactiveNeo4jTransactionManager reactiveTransactionManager(Driver driver,
            ReactiveDatabaseSelectionProvider databaseNameProvider) {
        return new ReactiveNeo4jTransactionManager(driver, databaseNameProvider);
    }

}
</span></code></pre> </div> </div> <div class="listingblock secondary"> <div class="title">Kotlin</div> <div class="content"> <pre class="highlight" data-language="kotlin"><code class="language-kotlin" data-lang="kotlin"><span class="fold-block hide-when-folded">import org.neo4j.driver.Driver
import org.springframework.context.annotation.Bean
import org.springframework.context.annotation.Configuration
import org.springframework.data.neo4j.core.ReactiveDatabaseSelectionProvider
import org.springframework.data.neo4j.core.transaction.ReactiveNeo4jTransactionManager

</span><span class="fold-block">@Configuration(proxyBeanMethods = false)
class MyNeo4jConfiguration {

    @Bean
    fun reactiveTransactionManager(driver: Driver,
            databaseNameProvider: ReactiveDatabaseSelectionProvider): ReactiveNeo4jTransactionManager {
        return ReactiveNeo4jTransactionManager(driver, databaseNameProvider)
    }
}
</span></code></pre> </div> </div> </td> </tr> </table> </div> </div> </div> <div class="sect2"> <h3 id="data.nosql.elasticsearch">
2.4. Elasticsearch</h3> <div class="paragraph"> <p><a href="https://www.elastic.co/products/elasticsearch">Elasticsearch</a> is an open source, distributed, RESTful search and analytics engine. Spring Boot offers basic auto-configuration for Elasticsearch clients.</p> </div> <div class="paragraph"> <p>Spring Boot supports several clients:</p> </div> <div class="ulist"> <ul> <li> <p>The official low-level REST client</p> </li> <li> <p>The official Java API client</p> </li> <li> <p>The <code>ReactiveElasticsearchClient</code> provided by Spring Data Elasticsearch</p> </li> </ul> </div> <div class="paragraph"> <p>Spring Boot provides a dedicated “Starter”, <code>spring-boot-starter-data-elasticsearch</code>.</p> </div> <div class="sect3"> <h4 id="data.nosql.elasticsearch.connecting-using-rest">
2.4.1. Connecting to Elasticsearch Using REST clients</h4> <div class="paragraph"> <p>Elasticsearch ships two different REST clients that you can use to query a cluster: the <a href="https://www.elastic.co/guide/en/elasticsearch/client/java-api-client/current/java-rest-low.html">low-level client</a> from the <code>org.elasticsearch.client:elasticsearch-rest-client</code> module and the <a href="https://www.elastic.co/guide/en/elasticsearch/client/java-api-client/current/index.html">Java API client</a> from the <code>co.elastic.clients:elasticsearch-java</code> module. Additionally, Spring Boot provides support for a reactive client from the <code>org.springframework.data:spring-data-elasticsearch</code> module. By default, the clients will target <code><a href="http://localhost:9200" class="bare">localhost:9200</a></code>. You can use <code>spring.elasticsearch.*</code> properties to further tune how the clients are configured, as shown in the following example:</p> </div> <div class="listingblock primary"> <div class="title">Properties</div> <div class="content"> <pre class="highlight" data-language="properties"><code class="language-properties" data-lang="properties">spring.elasticsearch.uris=https://search.example.com:9200
spring.elasticsearch.socket-timeout=10s
spring.elasticsearch.username=user
spring.elasticsearch.password=secret</code></pre> </div> </div> <div class="listingblock secondary"> <div class="title">Yaml</div> <div class="content"> <pre class="highlight" data-language="yaml"><code class="language-yaml" data-lang="yaml">spring:
  elasticsearch:
    uris: "https://search.example.com:9200"
    socket-timeout: "10s"
    username: "user"
    password: "secret"</code></pre> </div> </div> <div class="sect4"> <h5 id="data.nosql.elasticsearch.connecting-using-rest.restclient">
Connecting to Elasticsearch Using RestClient</h5> <div class="paragraph"> <p>If you have <code>elasticsearch-rest-client</code> on the classpath, Spring Boot will auto-configure and register a <code>RestClient</code> bean. In addition to the properties described previously, to fine-tune the <code>RestClient</code> you can register an arbitrary number of beans that implement <code>RestClientBuilderCustomizer</code> for more advanced customizations. To take full control over the clients' configuration, define a <code>RestClientBuilder</code> bean.</p> </div> <div class="paragraph"> <p>Additionally, if <code>elasticsearch-rest-client-sniffer</code> is on the classpath, a <code>Sniffer</code> is auto-configured to automatically discover nodes from a running Elasticsearch cluster and set them on the <code>RestClient</code> bean. You can further tune how <code>Sniffer</code> is configured, as shown in the following example:</p> </div> <div class="listingblock primary"> <div class="title">Properties</div> <div class="content"> <pre class="highlight" data-language="properties"><code class="language-properties" data-lang="properties">spring.elasticsearch.restclient.sniffer.interval=10m
spring.elasticsearch.restclient.sniffer.delay-after-failure=30s</code></pre> </div> </div> <div class="listingblock secondary"> <div class="title">Yaml</div> <div class="content"> <pre class="highlight" data-language="yaml"><code class="language-yaml" data-lang="yaml">spring:
  elasticsearch:
    restclient:
      sniffer:
        interval: "10m"
        delay-after-failure: "30s"</code></pre> </div> </div> </div> <div class="sect4"> <h5 id="data.nosql.elasticsearch.connecting-using-rest.javaapiclient">
Connecting to Elasticsearch Using ElasticsearchClient</h5> <div class="paragraph"> <p>If you have <code>co.elastic.clients:elasticsearch-java</code> on the classpath, Spring Boot will auto-configure and register an <code>ElasticsearchClient</code> bean.</p> </div> <div class="paragraph"> <p>The <code>ElasticsearchClient</code> uses a transport that depends upon the previously described <code>RestClient</code>. Therefore, the properties described previously can be used to configure the <code>ElasticsearchClient</code>. Furthermore, you can define a <code>TransportOptions</code> bean to take further control of the behavior of the transport.</p> </div> </div> <div class="sect4"> <h5 id="data.nosql.elasticsearch.connecting-using-rest.reactiveclient">
Connecting to Elasticsearch using ReactiveElasticsearchClient</h5> <div class="paragraph"> <p><a href="https://spring.io/projects/spring-data-elasticsearch">Spring Data Elasticsearch</a> ships <code>ReactiveElasticsearchClient</code> for querying Elasticsearch instances in a reactive fashion. If you have Spring Data Elasticsearch and Reactor on the classpath, Spring Boot will auto-configure and register a <code>ReactiveElasticsearchClient</code>.</p> </div> <div class="paragraph"> <p>The <code>ReactiveElasticsearchclient</code> uses a transport that depends upon the previously described <code>RestClient</code>. Therefore, the properties described previously can be used to configure the <code>ReactiveElasticsearchClient</code>. Furthermore, you can define a <code>TransportOptions</code> bean to take further control of the behavior of the transport.</p> </div> </div> </div> <div class="sect3"> <h4 id="data.nosql.elasticsearch.connecting-using-spring-data">
2.4.2. Connecting to Elasticsearch by Using Spring Data</h4> <div class="paragraph"> <p>To connect to Elasticsearch, an <code>ElasticsearchClient</code> bean must be defined, auto-configured by Spring Boot or manually provided by the application (see previous sections). With this configuration in place, an <code>ElasticsearchTemplate</code> can be injected like any other Spring bean, as shown in the following example:</p> </div> <div class="listingblock primary"> <div class="title">Java</div> <div class="content"> <pre class="highlight" data-language="java"><code class="language-java" data-lang="java"><span class="fold-block hide-when-folded">import org.springframework.data.elasticsearch.client.elc.ElasticsearchTemplate;
import org.springframework.stereotype.Component;

</span><span class="fold-block">@Component
public class MyBean {

    private final ElasticsearchTemplate template;

    public MyBean(ElasticsearchTemplate template) {
        this.template = template;
    }

</span><span class="fold-block hide-when-unfolded">    // ...

</span><span class="fold-block hide-when-folded">    public boolean someMethod(String id) {
        return this.template.exists(id, User.class);
    }

</span><span class="fold-block">}
</span></code></pre> </div> </div> <div class="listingblock secondary"> <div class="title">Kotlin</div> <div class="content"> <pre class="highlight" data-language="kotlin"><code class="language-kotlin" data-lang="kotlin"><span class="fold-block hide-when-folded">import org.springframework.stereotype.Component

</span><span class="fold-block">@Component
class MyBean(private val template: org.springframework.data.elasticsearch.client.erhlc.ElasticsearchRestTemplate ) {

</span><span class="fold-block hide-when-unfolded">    // ...

</span><span class="fold-block hide-when-folded">    fun someMethod(id: String): Boolean {
        return template.exists(id, User::class.java)
    }

</span><span class="fold-block">}
</span></code></pre> </div> </div> <div class="paragraph"> <p>In the presence of <code>spring-data-elasticsearch</code> and Reactor, Spring Boot can also auto-configure a <a href="features.html#data.nosql.elasticsearch.connecting-using-rest.reactiveclient">ReactiveElasticsearchClient</a> and a <code>ReactiveElasticsearchTemplate</code> as beans. They are the reactive equivalent of the other REST clients.</p> </div> </div> <div class="sect3"> <h4 id="data.nosql.elasticsearch.repositories">
2.4.3. Spring Data Elasticsearch Repositories</h4> <div class="paragraph"> <p>Spring Data includes repository support for Elasticsearch. As with the JPA repositories discussed earlier, the basic principle is that queries are constructed for you automatically based on method names.</p> </div> <div class="paragraph"> <p>In fact, both Spring Data JPA and Spring Data Elasticsearch share the same common infrastructure. You could take the JPA example from earlier and, assuming that <code>City</code> is now an Elasticsearch <code>@Document</code> class rather than a JPA <code>@Entity</code>, it works in the same way.</p> </div> <div class="paragraph"> <p>Repositories and documents are found through scanning. By default, the package containing your main configuration class (the one annotated with <code>@EnableAutoConfiguration</code> or <code>@SpringBootApplication</code>) and all those below it are searched. You can customize the locations to look for repositories and documents by using <code>@EnableElasticsearchRepositories</code> and <code>@EntityScan</code> respectively.</p> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon">  </td> <td class="content"> For complete details of Spring Data Elasticsearch, see the <a href="https://docs.spring.io/spring-data/elasticsearch/docs/current/reference/html/">reference documentation</a>. </td> </tr> </table> </div> <div class="paragraph"> <p>Spring Boot supports both classic and reactive Elasticsearch repositories, using the <code>ElasticsearchRestTemplate</code> or <code>ReactiveElasticsearchTemplate</code> beans. Most likely those beans are auto-configured by Spring Boot given the required dependencies are present.</p> </div> <div class="paragraph"> <p>If you wish to use your own template for backing the Elasticsearch repositories, you can add your own <code>ElasticsearchRestTemplate</code> or <code>ElasticsearchOperations</code> <code>@Bean</code>, as long as it is named <code>"elasticsearchTemplate"</code>. Same applies to <code>ReactiveElasticsearchTemplate</code> and <code>ReactiveElasticsearchOperations</code>, with the bean name <code>"reactiveElasticsearchTemplate"</code>.</p> </div> <div class="paragraph"> <p>You can choose to disable the repositories support with the following property:</p> </div> <div class="listingblock primary"> <div class="title">Properties</div> <div class="content"> <pre class="highlight" data-language="properties"><code class="language-properties" data-lang="properties">spring.data.elasticsearch.repositories.enabled=false</code></pre> </div> </div> <div class="listingblock secondary"> <div class="title">Yaml</div> <div class="content"> <pre class="highlight" data-language="yaml"><code class="language-yaml" data-lang="yaml">spring:
  data:
    elasticsearch:
      repositories:
        enabled: false</code></pre> </div> </div> </div> </div> <div class="sect2"> <h3 id="data.nosql.cassandra">
2.5. Cassandra</h3> <div class="paragraph"> <p><a href="https://cassandra.apache.org/">Cassandra</a> is an open source, distributed database management system designed to handle large amounts of data across many commodity servers. Spring Boot offers auto-configuration for Cassandra and the abstractions on top of it provided by <a href="https://github.com/spring-projects/spring-data-cassandra">Spring Data Cassandra</a>. There is a <code>spring-boot-starter-data-cassandra</code> “Starter” for collecting the dependencies in a convenient way.</p> </div> <div class="sect3"> <h4 id="data.nosql.cassandra.connecting">
2.5.1. Connecting to Cassandra</h4> <div class="paragraph"> <p>You can inject an auto-configured <code>CassandraTemplate</code> or a Cassandra <code>CqlSession</code> instance as you would with any other Spring Bean. The <code>spring.cassandra.*</code> properties can be used to customize the connection. Generally, you provide <code>keyspace-name</code> and <code>contact-points</code> as well the local datacenter name, as shown in the following example:</p> </div> <div class="listingblock primary"> <div class="title">Properties</div> <div class="content"> <pre class="highlight" data-language="properties"><code class="language-properties" data-lang="properties">spring.cassandra.keyspace-name=mykeyspace
spring.cassandra.contact-points=cassandrahost1:9042,cassandrahost2:9042
spring.cassandra.local-datacenter=datacenter1</code></pre> </div> </div> <div class="listingblock secondary"> <div class="title">Yaml</div> <div class="content"> <pre class="highlight" data-language="yaml"><code class="language-yaml" data-lang="yaml">spring:
  cassandra:
    keyspace-name: "mykeyspace"
    contact-points: "cassandrahost1:9042,cassandrahost2:9042"
    local-datacenter: "datacenter1"</code></pre> </div> </div> <div class="paragraph"> <p>If the port is the same for all your contact points you can use a shortcut and only specify the host names, as shown in the following example:</p> </div> <div class="listingblock primary"> <div class="title">Properties</div> <div class="content"> <pre class="highlight" data-language="properties"><code class="language-properties" data-lang="properties">spring.cassandra.keyspace-name=mykeyspace
spring.cassandra.contact-points=cassandrahost1,cassandrahost2
spring.cassandra.local-datacenter=datacenter1</code></pre> </div> </div> <div class="listingblock secondary"> <div class="title">Yaml</div> <div class="content"> <pre class="highlight" data-language="yaml"><code class="language-yaml" data-lang="yaml">spring:
  cassandra:
    keyspace-name: "mykeyspace"
    contact-points: "cassandrahost1,cassandrahost2"
    local-datacenter: "datacenter1"</code></pre> </div> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon">  </td> <td class="content"> Those two examples are identical as the port default to <code>9042</code>. If you need to configure the port, use <code>spring.cassandra.port</code>. </td> </tr> </table> </div> <div class="paragraph"> <p>The auto-configured <code>CqlSession</code> can be configured to use SSL for communication with the server by setting the properties as shown in this example:</p> </div> <div class="listingblock primary"> <div class="title">Properties</div> <div class="content"> <pre class="highlight" data-language="properties"><code class="language-properties" data-lang="properties">spring.cassandra.keyspace-name=mykeyspace
spring.cassandra.contact-points=cassandrahost1,cassandrahost2
spring.cassandra.local-datacenter=datacenter1
spring.cassandra.ssl.enabled=true</code></pre> </div> </div> <div class="listingblock secondary"> <div class="title">Yaml</div> <div class="content"> <pre class="highlight" data-language="yaml"><code class="language-yaml" data-lang="yaml">spring:
  cassandra:
    keyspace-name: "mykeyspace"
    contact-points: "cassandrahost1,cassandrahost2"
    local-datacenter: "datacenter1"
    ssl:
      enabled: true</code></pre> </div> </div> <div class="paragraph"> <p>Custom SSL trust material can be configured in an <a href="features.html#features.ssl">SSL bundle</a> and applied to the <code>CqlSession</code> as shown in this example:</p> </div> <div class="listingblock primary"> <div class="title">Properties</div> <div class="content"> <pre class="highlight" data-language="properties"><code class="language-properties" data-lang="properties">spring.cassandra.keyspace-name=mykeyspace
spring.cassandra.contact-points=cassandrahost1,cassandrahost2
spring.cassandra.local-datacenter=datacenter1
spring.cassandra.ssl.bundle=example</code></pre> </div> </div> <div class="listingblock secondary"> <div class="title">Yaml</div> <div class="content"> <pre class="highlight" data-language="yaml"><code class="language-yaml" data-lang="yaml">spring:
  cassandra:
    keyspace-name: "mykeyspace"
    contact-points: "cassandrahost1,cassandrahost2"
    local-datacenter: "datacenter1"
    ssl:
      bundle: "example"</code></pre> </div> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon">  </td> <td class="content"> <div class="paragraph"> <p>The Cassandra driver has its own configuration infrastructure that loads an <code>application.conf</code> at the root of the classpath.</p> </div> <div class="paragraph"> <p>Spring Boot does not look for such a file by default but can load one using <code>spring.cassandra.config</code>. If a property is both present in <code>spring.cassandra.*</code> and the configuration file, the value in <code>spring.cassandra.*</code> takes precedence.</p> </div> <div class="paragraph"> <p>For more advanced driver customizations, you can register an arbitrary number of beans that implement <code>DriverConfigLoaderBuilderCustomizer</code>. The <code>CqlSession</code> can be customized with a bean of type <code>CqlSessionBuilderCustomizer</code>.</p> </div> </td> </tr> </table> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon">  </td> <td class="content"> If you use <code>CqlSessionBuilder</code> to create multiple <code>CqlSession</code> beans, keep in mind the builder is mutable so make sure to inject a fresh copy for each session. </td> </tr> </table> </div> <div class="paragraph"> <p>The following code listing shows how to inject a Cassandra bean:</p> </div> <div class="listingblock primary"> <div class="title">Java</div> <div class="content"> <pre class="highlight" data-language="java"><code class="language-java" data-lang="java"><span class="fold-block hide-when-folded">import org.springframework.data.cassandra.core.CassandraTemplate;
import org.springframework.stereotype.Component;

</span><span class="fold-block">@Component
public class MyBean {

    private final CassandraTemplate template;

    public MyBean(CassandraTemplate template) {
        this.template = template;
    }

</span><span class="fold-block hide-when-unfolded">    // ...

</span><span class="fold-block hide-when-folded">    public long someMethod() {
        return this.template.count(User.class);
    }

</span><span class="fold-block">}
</span></code></pre> </div> </div> <div class="listingblock secondary"> <div class="title">Kotlin</div> <div class="content"> <pre class="highlight" data-language="kotlin"><code class="language-kotlin" data-lang="kotlin"><span class="fold-block hide-when-folded">import org.springframework.data.cassandra.core.CassandraTemplate
import org.springframework.stereotype.Component

</span><span class="fold-block">@Component
class MyBean(private val template: CassandraTemplate) {

</span><span class="fold-block hide-when-unfolded">    // ...

</span><span class="fold-block hide-when-folded">    fun someMethod(): Long {
        return template.count(User::class.java)
    }

</span><span class="fold-block">}
</span></code></pre> </div> </div> <div class="paragraph"> <p>If you add your own <code>@Bean</code> of type <code>CassandraTemplate</code>, it replaces the default.</p> </div> </div> <div class="sect3"> <h4 id="data.nosql.cassandra.repositories">
2.5.2. Spring Data Cassandra Repositories</h4> <div class="paragraph"> <p>Spring Data includes basic repository support for Cassandra. Currently, this is more limited than the JPA repositories discussed earlier and needs <code>@Query</code> annotated finder methods.</p> </div> <div class="paragraph"> <p>Repositories and entities are found through scanning. By default, the package containing your main configuration class (the one annotated with <code>@EnableAutoConfiguration</code> or <code>@SpringBootApplication</code>) and all those below it are searched. You can customize the locations to look for repositories and entities by using <code>@EnableCassandraRepositories</code> and <code>@EntityScan</code> respectively.</p> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon">  </td> <td class="content"> For complete details of Spring Data Cassandra, see the <a href="https://docs.spring.io/spring-data/cassandra/docs/">reference documentation</a>. </td> </tr> </table> </div> </div> </div> <div class="sect2"> <h3 id="data.nosql.couchbase">
2.6. Couchbase</h3> <div class="paragraph"> <p><a href="https://www.couchbase.com/">Couchbase</a> is an open-source, distributed, multi-model NoSQL document-oriented database that is optimized for interactive applications. Spring Boot offers auto-configuration for Couchbase and the abstractions on top of it provided by <a href="https://github.com/spring-projects/spring-data-couchbase">Spring Data Couchbase</a>. There are <code>spring-boot-starter-data-couchbase</code> and <code>spring-boot-starter-data-couchbase-reactive</code> “Starters” for collecting the dependencies in a convenient way.</p> </div> <div class="sect3"> <h4 id="data.nosql.couchbase.connecting">
2.6.1. Connecting to Couchbase</h4> <div class="paragraph"> <p>You can get a <code>Cluster</code> by adding the Couchbase SDK and some configuration. The <code>spring.couchbase.*</code> properties can be used to customize the connection. Generally, you provide the <a href="https://github.com/couchbaselabs/sdk-rfcs/blob/master/rfc/0011-connection-string.md">connection string</a>, username, and password, as shown in the following example:</p> </div> <div class="listingblock primary"> <div class="title">Properties</div> <div class="content"> <pre class="highlight" data-language="properties"><code class="language-properties" data-lang="properties">spring.couchbase.connection-string=couchbase://192.168.1.123
spring.couchbase.username=user
spring.couchbase.password=secret</code></pre> </div> </div> <div class="listingblock secondary"> <div class="title">Yaml</div> <div class="content"> <pre class="highlight" data-language="yaml"><code class="language-yaml" data-lang="yaml">spring:
  couchbase:
    connection-string: "couchbase://192.168.1.123"
    username: "user"
    password: "secret"</code></pre> </div> </div> <div class="paragraph"> <p>It is also possible to customize some of the <code>ClusterEnvironment</code> settings. For instance, the following configuration changes the timeout to open a new <code>Bucket</code> and enables SSL support with a reference to a configured <a href="features.html#features.ssl">SSL bundle</a>:</p> </div> <div class="listingblock primary"> <div class="title">Properties</div> <div class="content"> <pre class="highlight" data-language="properties"><code class="language-properties" data-lang="properties">spring.couchbase.env.timeouts.connect=3s
spring.couchbase.env.ssl.bundle=example</code></pre> </div> </div> <div class="listingblock secondary"> <div class="title">Yaml</div> <div class="content"> <pre class="highlight" data-language="yaml"><code class="language-yaml" data-lang="yaml">spring:
  couchbase:
    env:
      timeouts:
        connect: "3s"
      ssl:
        bundle: "example"</code></pre> </div> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon">  </td> <td class="content"> Check the <code>spring.couchbase.env.*</code> properties for more details. To take more control, one or more <code>ClusterEnvironmentBuilderCustomizer</code> beans can be used. </td> </tr> </table> </div> </div> <div class="sect3"> <h4 id="data.nosql.couchbase.repositories">
2.6.2. Spring Data Couchbase Repositories</h4> <div class="paragraph"> <p>Spring Data includes repository support for Couchbase.</p> </div> <div class="paragraph"> <p>Repositories and documents are found through scanning. By default, the package containing your main configuration class (the one annotated with <code>@EnableAutoConfiguration</code> or <code>@SpringBootApplication</code>) and all those below it are searched. You can customize the locations to look for repositories and documents by using <code>@EnableCouchbaseRepositories</code> and <code>@EntityScan</code> respectively.</p> </div> <div class="paragraph"> <p>For complete details of Spring Data Couchbase, see the <a href="https://docs.spring.io/spring-data/couchbase/docs/5.1.3/reference/html/">reference documentation</a>.</p> </div> <div class="paragraph"> <p>You can inject an auto-configured <code>CouchbaseTemplate</code> instance as you would with any other Spring Bean, provided a <code>CouchbaseClientFactory</code> bean is available. This happens when a <code>Cluster</code> is available, as described above, and a bucket name has been specified:</p> </div> <div class="listingblock primary"> <div class="title">Properties</div> <div class="content"> <pre class="highlight" data-language="properties"><code class="language-properties" data-lang="properties">spring.data.couchbase.bucket-name=my-bucket</code></pre> </div> </div> <div class="listingblock secondary"> <div class="title">Yaml</div> <div class="content"> <pre class="highlight" data-language="yaml"><code class="language-yaml" data-lang="yaml">spring:
  data:
    couchbase:
      bucket-name: "my-bucket"</code></pre> </div> </div> <div class="paragraph"> <p>The following examples shows how to inject a <code>CouchbaseTemplate</code> bean:</p> </div> <div class="listingblock primary"> <div class="title">Java</div> <div class="content"> <pre class="highlight" data-language="java"><code class="language-java" data-lang="java"><span class="fold-block hide-when-folded">import org.springframework.data.couchbase.core.CouchbaseTemplate;
import org.springframework.stereotype.Component;

</span><span class="fold-block">@Component
public class MyBean {

    private final CouchbaseTemplate template;

    public MyBean(CouchbaseTemplate template) {
        this.template = template;
    }

</span><span class="fold-block hide-when-unfolded">    // ...

</span><span class="fold-block hide-when-folded">    public String someMethod() {
        return this.template.getBucketName();
    }

</span><span class="fold-block">}
</span></code></pre> </div> </div> <div class="listingblock secondary"> <div class="title">Kotlin</div> <div class="content"> <pre class="highlight" data-language="kotlin"><code class="language-kotlin" data-lang="kotlin"><span class="fold-block hide-when-folded">import org.springframework.data.couchbase.core.CouchbaseTemplate
import org.springframework.stereotype.Component

</span><span class="fold-block">@Component
class MyBean(private val template: CouchbaseTemplate) {

</span><span class="fold-block hide-when-unfolded">    // ...

</span><span class="fold-block hide-when-folded">    fun someMethod(): String {
        return template.bucketName
    }

</span><span class="fold-block">}
</span></code></pre> </div> </div> <div class="paragraph"> <p>There are a few beans that you can define in your own configuration to override those provided by the auto-configuration:</p> </div> <div class="ulist"> <ul> <li> <p>A <code>CouchbaseMappingContext</code> <code>@Bean</code> with a name of <code>couchbaseMappingContext</code>.</p> </li> <li> <p>A <code>CustomConversions</code> <code>@Bean</code> with a name of <code>couchbaseCustomConversions</code>.</p> </li> <li> <p>A <code>CouchbaseTemplate</code> <code>@Bean</code> with a name of <code>couchbaseTemplate</code>.</p> </li> </ul> </div> <div class="paragraph"> <p>To avoid hard-coding those names in your own config, you can reuse <code>BeanNames</code> provided by Spring Data Couchbase. For instance, you can customize the converters to use, as follows:</p> </div> <div class="listingblock primary"> <div class="title">Java</div> <div class="content"> <pre class="highlight" data-language="java"><code class="language-java" data-lang="java"><span class="fold-block hide-when-folded">import org.assertj.core.util.Arrays;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.data.couchbase.config.BeanNames;
import org.springframework.data.couchbase.core.convert.CouchbaseCustomConversions;

</span><span class="fold-block">@Configuration(proxyBeanMethods = false)
public class MyCouchbaseConfiguration {

    @Bean(BeanNames.COUCHBASE_CUSTOM_CONVERSIONS)
    public CouchbaseCustomConversions myCustomConversions() {
        return new CouchbaseCustomConversions(Arrays.asList(new MyConverter()));
    }

}
</span></code></pre> </div> </div> <div class="listingblock secondary"> <div class="title">Kotlin</div> <div class="content"> <pre class="highlight" data-language="kotlin"><code class="language-kotlin" data-lang="kotlin"><span class="fold-block hide-when-folded">import org.assertj.core.util.Arrays
import org.springframework.context.annotation.Bean
import org.springframework.context.annotation.Configuration
import org.springframework.data.couchbase.config.BeanNames
import org.springframework.data.couchbase.core.convert.CouchbaseCustomConversions

</span><span class="fold-block">@Configuration(proxyBeanMethods = false)
class MyCouchbaseConfiguration {

    @Bean(BeanNames.COUCHBASE_CUSTOM_CONVERSIONS)
    fun myCustomConversions(): CouchbaseCustomConversions {
        return CouchbaseCustomConversions(Arrays.asList(MyConverter()))
    }

}
</span></code></pre> </div> </div> </div> </div> <div class="sect2"> <h3 id="data.nosql.ldap">
2.7. LDAP</h3> <div class="paragraph"> <p><a href="https://en.wikipedia.org/wiki/Lightweight_Directory_Access_Protocol">LDAP</a> (Lightweight Directory Access Protocol) is an open, vendor-neutral, industry standard application protocol for accessing and maintaining distributed directory information services over an IP network. Spring Boot offers auto-configuration for any compliant LDAP server as well as support for the embedded in-memory LDAP server from <a href="https://ldap.com/unboundid-ldap-sdk-for-java/">UnboundID</a>.</p> </div> <div class="paragraph"> <p>LDAP abstractions are provided by <a href="https://github.com/spring-projects/spring-data-ldap">Spring Data LDAP</a>. There is a <code>spring-boot-starter-data-ldap</code> “Starter” for collecting the dependencies in a convenient way.</p> </div> <div class="sect3"> <h4 id="data.nosql.ldap.connecting">
2.7.1. Connecting to an LDAP Server</h4> <div class="paragraph"> <p>To connect to an LDAP server, make sure you declare a dependency on the <code>spring-boot-starter-data-ldap</code> “Starter” or <code>spring-ldap-core</code> and then declare the URLs of your server in your application.properties, as shown in the following example:</p> </div> <div class="listingblock primary"> <div class="title">Properties</div> <div class="content"> <pre class="highlight" data-language="properties"><code class="language-properties" data-lang="properties">spring.ldap.urls=ldap://myserver:1235
spring.ldap.username=admin
spring.ldap.password=secret</code></pre> </div> </div> <div class="listingblock secondary"> <div class="title">Yaml</div> <div class="content"> <pre class="highlight" data-language="yaml"><code class="language-yaml" data-lang="yaml">spring:
  ldap:
    urls: "ldap://myserver:1235"
    username: "admin"
    password: "secret"</code></pre> </div> </div> <div class="paragraph"> <p>If you need to customize connection settings, you can use the <code>spring.ldap.base</code> and <code>spring.ldap.base-environment</code> properties.</p> </div> <div class="paragraph"> <p>An <code>LdapContextSource</code> is auto-configured based on these settings. If a <code>DirContextAuthenticationStrategy</code> bean is available, it is associated to the auto-configured <code>LdapContextSource</code>. If you need to customize it, for instance to use a <code>PooledContextSource</code>, you can still inject the auto-configured <code>LdapContextSource</code>. Make sure to flag your customized <code>ContextSource</code> as <code>@Primary</code> so that the auto-configured <code>LdapTemplate</code> uses it.</p> </div> </div> <div class="sect3"> <h4 id="data.nosql.ldap.repositories">
2.7.2. Spring Data LDAP Repositories</h4> <div class="paragraph"> <p>Spring Data includes repository support for LDAP.</p> </div> <div class="paragraph"> <p>Repositories and documents are found through scanning. By default, the package containing your main configuration class (the one annotated with <code>@EnableAutoConfiguration</code> or <code>@SpringBootApplication</code>) and all those below it are searched. You can customize the locations to look for repositories and documents by using <code>@EnableLdapRepositories</code> and <code>@EntityScan</code> respectively.</p> </div> <div class="paragraph"> <p>For complete details of Spring Data LDAP, see the <a href="https://docs.spring.io/spring-data/ldap/docs/1.0.x/reference/html/">reference documentation</a>.</p> </div> <div class="paragraph"> <p>You can also inject an auto-configured <code>LdapTemplate</code> instance as you would with any other Spring Bean, as shown in the following example:</p> </div> <div class="listingblock primary"> <div class="title">Java</div> <div class="content"> <pre class="highlight" data-language="java"><code class="language-java" data-lang="java"><span class="fold-block hide-when-folded">import java.util.List;

import org.springframework.ldap.core.LdapTemplate;
import org.springframework.stereotype.Component;

</span><span class="fold-block">@Component
public class MyBean {

    private final LdapTemplate template;

    public MyBean(LdapTemplate template) {
        this.template = template;
    }

</span><span class="fold-block hide-when-unfolded">    // ...

</span><span class="fold-block hide-when-folded">    public List&lt;User&gt; someMethod() {
        return this.template.findAll(User.class);
    }

</span><span class="fold-block">}
</span></code></pre> </div> </div> <div class="listingblock secondary"> <div class="title">Kotlin</div> <div class="content"> <pre class="highlight" data-language="kotlin"><code class="language-kotlin" data-lang="kotlin"><span class="fold-block hide-when-folded">import org.springframework.ldap.core.LdapTemplate
import org.springframework.stereotype.Component

</span><span class="fold-block">@Component
class MyBean(private val template: LdapTemplate) {

</span><span class="fold-block hide-when-unfolded">    // ...

</span><span class="fold-block hide-when-folded">    fun someMethod(): List&lt;User&gt; {
        return template.findAll(User::class.java)
    }

</span><span class="fold-block">}
</span></code></pre> </div> </div> </div> <div class="sect3"> <h4 id="data.nosql.ldap.embedded">
2.7.3. Embedded In-memory LDAP Server</h4> <div class="paragraph"> <p>For testing purposes, Spring Boot supports auto-configuration of an in-memory LDAP server from <a href="https://ldap.com/unboundid-ldap-sdk-for-java/">UnboundID</a>. To configure the server, add a dependency to <code>com.unboundid:unboundid-ldapsdk</code> and declare a <code>spring.ldap.embedded.base-dn</code> property, as follows:</p> </div> <div class="listingblock primary"> <div class="title">Properties</div> <div class="content"> <pre class="highlight" data-language="properties"><code class="language-properties" data-lang="properties">spring.ldap.embedded.base-dn=dc=spring,dc=io</code></pre> </div> </div> <div class="listingblock secondary"> <div class="title">Yaml</div> <div class="content"> <pre class="highlight" data-language="yaml"><code class="language-yaml" data-lang="yaml">spring:
  ldap:
    embedded:
      base-dn: "dc=spring,dc=io"</code></pre> </div> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon">  </td> <td class="content"> <div class="paragraph"> <p>It is possible to define multiple base-dn values, however, since distinguished names usually contain commas, they must be defined using the correct notation.</p> </div> <div class="paragraph"> <p>In yaml files, you can use the yaml list notation. In properties files, you must include the index as part of the property name:</p> </div> <div class="listingblock primary"> <div class="title">Properties</div> <div class="content"> <pre class="highlight" data-language="properties"><code class="language-properties" data-lang="properties">spring.ldap.embedded.base-dn[0]=dc=spring,dc=io
spring.ldap.embedded.base-dn[1]=dc=vmware,dc=com</code></pre> </div> </div> <div class="listingblock secondary"> <div class="title">Yaml</div> <div class="content"> <pre class="highlight" data-language="yaml"><code class="language-yaml" data-lang="yaml">spring.ldap.embedded.base-dn:
  - "dc=spring,dc=io"
  - "dc=vmware,dc=com"</code></pre> </div> </div> </td> </tr> </table> </div> <div class="paragraph"> <p>By default, the server starts on a random port and triggers the regular LDAP support. There is no need to specify a <code>spring.ldap.urls</code> property.</p> </div> <div class="paragraph"> <p>If there is a <code>schema.ldif</code> file on your classpath, it is used to initialize the server. If you want to load the initialization script from a different resource, you can also use the <code>spring.ldap.embedded.ldif</code> property.</p> </div> <div class="paragraph"> <p>By default, a standard schema is used to validate <code>LDIF</code> files. You can turn off validation altogether by setting the <code>spring.ldap.embedded.validation.enabled</code> property. If you have custom attributes, you can use <code>spring.ldap.embedded.validation.schema</code> to define your custom attribute types or object classes.</p> </div> </div> </div> <div class="sect2"> <h3 id="data.nosql.influxdb">
2.8. InfluxDB</h3> <div class="paragraph"> <p><a href="https://www.influxdata.com/">InfluxDB</a> is an open-source time series database optimized for fast, high-availability storage and retrieval of time series data in fields such as operations monitoring, application metrics, Internet-of-Things sensor data, and real-time analytics.</p> </div> <div class="sect3"> <h4 id="data.nosql.influxdb.connecting">
2.8.1. Connecting to InfluxDB</h4> <div class="paragraph"> <p>Spring Boot auto-configures an <code>InfluxDB</code> instance, provided the <code>influxdb-java</code> client is on the classpath and the URL of the database is set, as shown in the following example:</p> </div> <div class="listingblock primary"> <div class="title">Properties</div> <div class="content"> <pre class="highlight" data-language="properties"><code class="language-properties" data-lang="properties">spring.influx.url=https://172.0.0.1:8086</code></pre> </div> </div> <div class="listingblock secondary"> <div class="title">Yaml</div> <div class="content"> <pre class="highlight" data-language="yaml"><code class="language-yaml" data-lang="yaml">spring:
  influx:
    url: "https://172.0.0.1:8086"</code></pre> </div> </div> <div class="paragraph"> <p>If the connection to InfluxDB requires a user and password, you can set the <code>spring.influx.user</code> and <code>spring.influx.password</code> properties accordingly.</p> </div> <div class="paragraph"> <p>InfluxDB relies on OkHttp. If you need to tune the http client <code>InfluxDB</code> uses behind the scenes, you can register an <code>InfluxDbOkHttpClientBuilderProvider</code> bean.</p> </div> <div class="paragraph"> <p>If you need more control over the configuration, consider registering an <code>InfluxDbCustomizer</code> bean.</p> </div> </div> </div> </div> </div> <div class="sect1"> <h2 id="data.whats-next">
3. What to Read Next</h2> <div class="sectionbody"> <div class="paragraph"> <p>You should now have a feeling for how to use Spring Boot with various data technologies. From here, you can read about Spring Boot’s support for various <a href="messaging.html#messaging">messaging technologies</a> and how to enable them in your application.</p> </div> </div> </div><div class="_attribution">
  <p class="_attribution-p">
    Copyright &copy; 2012-2023 VMware, Inc.<br>Licensed under the Apache License, Version 2.0.<br>
    <a href="https://docs.spring.io/spring-boot/docs/3.1.3/reference/html/data.html" class="_attribution-link">https://docs.spring.io/spring-boot/docs/3.1.3/reference/html/data.html</a>
  </p>
</div>
