<h1>Mongoose</h1>

<div class="api-content">
<h3 id="Mongoose()">Mongoose()</h3>
<h5>Parameters:</h5>
<ul class="params"><li class="param">
<code>options</code> <span class="method-type">«Object»</span> see <a href="#Mongoose.prototype.set()"><code>Mongoose#set()</code> docs</a> </li></ul>
<div>
<p>Mongoose constructor.</p> <p>The exports object of the <code>mongoose</code> module is an instance of this class. Most apps will only use this one instance.</p> <h4 id="example"> <a href="#example"> Example: </a> </h4> <pre data-language="javascript"><span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);
mongoose <span class="hljs-keyword">instanceof</span> mongoose.<span class="hljs-property">Mongoose</span>; <span class="hljs-comment">// true</span>

<span class="hljs-comment">// Create a new Mongoose instance with its own `connect()`, `set()`, `model()`, etc.</span>
<span class="hljs-keyword">const</span> m = <span class="hljs-keyword">new</span> mongoose.<span class="hljs-title class_">Mongoose</span>();
</pre> </div>
<h3 id="Mongoose.prototype.Aggregate()">Mongoose.prototype.Aggregate()</h3>
<div>
<p>The Mongoose Aggregate constructor</p> </div>
<h3 id="Mongoose.prototype.CastError()">Mongoose.prototype.CastError()</h3>
<h5>Parameters:</h5>
<ul class="params">
<li class="param">
<code>type</code> <span class="method-type">«String»</span> The name of the type </li>
<li class="param">
<code>value</code> <span class="method-type">«Any»</span> The value that failed to cast </li>
<li class="param">
<code>path</code> <span class="method-type">«String»</span> The path <code>a.b.c</code> in the doc where this cast error occurred </li>
<li class="param">
<code>[reason]</code> <span class="method-type">«Error»</span> The original error that was thrown </li>
</ul>
<div>
<p>The Mongoose CastError constructor</p> </div>
<h3 id="Mongoose.prototype.Collection()">Mongoose.prototype.Collection()</h3>
<div>
<p>The Mongoose Collection constructor</p> </div>
<h3 id="Mongoose.prototype.Connection()">Mongoose.prototype.Connection()</h3>
<div>
<p>The Mongoose <a href="connection.html#Connection()">Connection</a> constructor</p> </div>
<h3 id="Mongoose.prototype.ConnectionStates">Mongoose.prototype.ConnectionStates</h3>
<h5>Type:</h5>
<ul><li><span class="method-type">«property»</span></li></ul>
<div>
<p>Expose connection states for user-land</p> </div>
<h3 id="Mongoose.prototype.Date">Mongoose.prototype.Date</h3>
<h5>Type:</h5>
<ul><li><span class="method-type">«property»</span></li></ul>
<div>
<p>The Mongoose Date <a href="../schematypes.html">SchemaType</a>.</p> <h4 id="example"> <a href="#example"> Example: </a> </h4> <pre data-language="javascript"><span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">test</span>: <span class="hljs-title class_">Date</span> });
schema.<span class="hljs-title function_">path</span>(<span class="hljs-string">'test'</span>) <span class="hljs-keyword">instanceof</span> mongoose.<span class="hljs-property">Date</span>; <span class="hljs-comment">// true</span>
</pre> </div>
<h3 id="Mongoose.prototype.Decimal128">Mongoose.prototype.Decimal128</h3>
<h5>Type:</h5>
<ul><li><span class="method-type">«property»</span></li></ul>
<div>
<p>The Mongoose Decimal128 <a href="../schematypes.html">SchemaType</a>. Used for declaring paths in your schema that should be <a href="https://thecodebarbarian.com/a-nodejs-perspective-on-mongodb-34-decimal.html">128-bit decimal floating points</a>. Do not use this to create a new Decimal128 instance, use <code>mongoose.Types.Decimal128</code> instead.</p> <h4 id="example"> <a href="#example"> Example: </a> </h4> <pre data-language="javascript"><span class="hljs-keyword">const</span> vehicleSchema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">fuelLevel</span>: mongoose.<span class="hljs-property">Decimal128</span> });
</pre> </div>
<h3 id="Mongoose.prototype.Document()">Mongoose.prototype.Document()</h3>
<div>
<p>The Mongoose <a href="document.html#Document()">Document</a> constructor.</p> </div>
<h3 id="Mongoose.prototype.DocumentProvider()">Mongoose.prototype.DocumentProvider()</h3>
<div>
<p>The Mongoose DocumentProvider constructor. Mongoose users should not have to use this directly</p> </div>
<h3 id="Mongoose.prototype.Error()">Mongoose.prototype.Error()</h3>
<div>
<p>The <a href="error.html#Error()">MongooseError</a> constructor.</p> </div>
<h3 id="Mongoose.prototype.Mixed">Mongoose.prototype.Mixed</h3>
<h5>Type:</h5>
<ul><li><span class="method-type">«property»</span></li></ul>
<div>
<p>The Mongoose Mixed <a href="../schematypes.html">SchemaType</a>. Used for declaring paths in your schema that Mongoose's change tracking, casting, and validation should ignore.</p> <h4 id="example"> <a href="#example"> Example: </a> </h4> <pre data-language="javascript"><span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">arbitrary</span>: mongoose.<span class="hljs-property">Mixed</span> });
</pre> </div>
<h3 id="Mongoose.prototype.Model()">Mongoose.prototype.Model()</h3>
<div>
<p>The Mongoose <a href="model.html#Model()">Model</a> constructor.</p> </div>
<h3 id="Mongoose.prototype.Mongoose()">Mongoose.prototype.Mongoose()</h3>
<div>
<p>The Mongoose constructor</p> <p>The exports of the mongoose module is an instance of this class.</p> <h4 id="example"> <a href="#example"> Example: </a> </h4> <pre data-language="javascript"><span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);
<span class="hljs-keyword">const</span> mongoose2 = <span class="hljs-keyword">new</span> mongoose.<span class="hljs-title class_">Mongoose</span>();
</pre> </div>
<h3 id="Mongoose.prototype.Number">Mongoose.prototype.Number</h3>
<h5>Type:</h5>
<ul><li><span class="method-type">«property»</span></li></ul>
<div>
<p>The Mongoose Number <a href="../schematypes.html">SchemaType</a>. Used for declaring paths in your schema that Mongoose should cast to numbers.</p> <h4 id="example"> <a href="#example"> Example: </a> </h4> <pre data-language="javascript"><span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">num</span>: mongoose.<span class="hljs-property">Number</span> });
<span class="hljs-comment">// Equivalent to:</span>
<span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">num</span>: <span class="hljs-string">'number'</span> });
</pre> </div>
<h3 id="Mongoose.prototype.ObjectId">Mongoose.prototype.ObjectId</h3>
<h5>Type:</h5>
<ul><li><span class="method-type">«property»</span></li></ul>
<div>
<p>The Mongoose ObjectId <a href="../schematypes.html">SchemaType</a>. Used for declaring paths in your schema that should be <a href="https://www.mongodb.com/docs/manual/reference/method/ObjectId/">MongoDB ObjectIds</a>. Do not use this to create a new ObjectId instance, use <code>mongoose.Types.ObjectId</code> instead.</p> <h4 id="example"> <a href="#example"> Example: </a> </h4> <pre data-language="javascript"><span class="hljs-keyword">const</span> childSchema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">parentId</span>: mongoose.<span class="hljs-property">ObjectId</span> });
</pre> </div>
<h3 id="Mongoose.prototype.Query()">Mongoose.prototype.Query()</h3>
<div>
<p>The Mongoose <a href="query.html#Query()">Query</a> constructor.</p> </div>
<h3 id="Mongoose.prototype.STATES">Mongoose.prototype.STATES</h3>
<h5>Type:</h5>
<ul><li><span class="method-type">«property»</span></li></ul>
<div>
<p>Expose connection states for user-land</p> </div>
<h3 id="Mongoose.prototype.Schema()">Mongoose.prototype.Schema()</h3>
<div>
<p>The Mongoose <a href="schema.html#Schema()">Schema</a> constructor</p> <h4 id="example"> <a href="#example"> Example: </a> </h4> <pre data-language="javascript"><span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Schema</span> = mongoose.<span class="hljs-property">Schema</span>;
<span class="hljs-keyword">const</span> <span class="hljs-title class_">CatSchema</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>(..);
</pre> </div>
<h3 id="Mongoose.prototype.SchemaType()">Mongoose.prototype.SchemaType()</h3>
<div>
<p>The Mongoose <a href="schematype.html#SchemaType()">SchemaType</a> constructor</p> </div>
<h3 id="Mongoose.prototype.SchemaTypeOptions()">Mongoose.prototype.SchemaTypeOptions()</h3>
<div>
<p>The constructor used for schematype options</p> </div>
<h3 id="Mongoose.prototype.SchemaTypes">Mongoose.prototype.SchemaTypes</h3>
<h5>Type:</h5>
<ul><li><span class="method-type">«property»</span></li></ul>
<h5>See:</h5>
<ul><li><span class="method-type"><a href="../schematypes.html">Schema.SchemaTypes</a></span></li></ul>
<div>
<p>The various Mongoose SchemaTypes.</p> <h4 id="note"> <a href="#note"> Note: </a> </h4> <p><em>Alias of mongoose.Schema.Types for backwards compatibility.</em></p> </div>
<h3 id="Mongoose.prototype.Types">Mongoose.prototype.Types</h3>
<h5>Type:</h5>
<ul><li><span class="method-type">«property»</span></li></ul>
<div>
<p>The various Mongoose Types.</p> <h4 id="example"> <a href="#example"> Example: </a> </h4> <pre data-language="javascript"><span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);
<span class="hljs-keyword">const</span> array = mongoose.<span class="hljs-property">Types</span>.<span class="hljs-property">Array</span>;
</pre> <h4 id="types"> <a href="#types"> Types: </a> </h4> <ul> <li><a href="../schematypes.html#arrays">Array</a></li> <li><a href="../schematypes.html#buffers">Buffer</a></li> <li><a href="../schematypes.html#schemas">Embedded</a></li> <li><a href="documentarraypath.html">DocumentArray</a></li> <li><a href="#Mongoose.prototype.Decimal128">Decimal128</a></li> <li><a href="../schematypes.html#objectids">ObjectId</a></li> <li><a href="../schematypes.html#maps">Map</a></li> <li><a href="../schematypes.html#schemas">Subdocument</a></li> </ul> <p>Using this exposed access to the <code>ObjectId</code> type, we can construct ids on demand.</p> <pre data-language="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">ObjectId</span> = mongoose.<span class="hljs-property">Types</span>.<span class="hljs-property">ObjectId</span>;
<span class="hljs-keyword">const</span> id1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectId</span>;
</pre> </div>
<h3 id="Mongoose.prototype.VirtualType()">Mongoose.prototype.VirtualType()</h3>
<div>
<p>The Mongoose <a href="virtualtype.html#VirtualType()">VirtualType</a> constructor</p> </div>
<h3 id="Mongoose.prototype.connect()">Mongoose.prototype.connect()</h3>
<h5>Parameters:</h5>
<ul class="params">
<li class="param">
<code>uri</code> <span class="method-type">«String»</span> mongodb URI to connect to </li>
<li class="param">
<code>[options]</code> <span class="method-type">«Object»</span> passed down to the <a href="https://mongodb.github.io/node-mongodb-native/4.9/interfaces/MongoClientOptions.html">MongoDB driver's <code>connect()</code> function</a>, except for 4 mongoose-specific options explained below. </li>
<ul style="margin-top: 0.5em"><li>
<code>[options.bufferCommands=true]</code> <span class="method-type">«Boolean»</span> Mongoose specific option. Set to false to <a href="https://mongoosejs.com/docs/faq.html#callback_never_executes">disable buffering</a> on all models associated with this connection. </li></ul>
<ul style="margin-top: 0.5em"><li>
<code>[options.bufferTimeoutMS=10000]</code> <span class="method-type">«Number»</span> Mongoose specific option. If <code>bufferCommands</code> is true, Mongoose will throw an error after <code>bufferTimeoutMS</code> if the operation is still buffered. </li></ul>
<ul style="margin-top: 0.5em"><li>
<code>[options.dbName]</code> <span class="method-type">«String»</span> The name of the database we want to use. If not provided, use database name from connection string. </li></ul>
<ul style="margin-top: 0.5em"><li>
<code>[options.user]</code> <span class="method-type">«String»</span> username for authentication, equivalent to <code>options.auth.user</code>. Maintained for backwards compatibility. </li></ul>
<ul style="margin-top: 0.5em"><li>
<code>[options.pass]</code> <span class="method-type">«String»</span> password for authentication, equivalent to <code>options.auth.password</code>. Maintained for backwards compatibility. </li></ul>
<ul style="margin-top: 0.5em"><li>
<code>[options.maxPoolSize=100]</code> <span class="method-type">«Number»</span> The maximum number of sockets the MongoDB driver will keep open for this connection. Keep in mind that MongoDB only allows one operation per socket at a time, so you may want to increase this if you find you have a few slow queries that are blocking faster queries from proceeding. See <a href="https://thecodebarbarian.com/slow-trains-in-mongodb-and-nodejs">Slow Trains in MongoDB and Node.js</a>. </li></ul>
<ul style="margin-top: 0.5em"><li>
<code>[options.minPoolSize=0]</code> <span class="method-type">«Number»</span> The minimum number of sockets the MongoDB driver will keep open for this connection. </li></ul>
<ul style="margin-top: 0.5em"><li>
<code>[options.serverSelectionTimeoutMS]</code> <span class="method-type">«Number»</span> If <code>useUnifiedTopology = true</code>, the MongoDB driver will try to find a server to send any given operation to, and keep retrying for <code>serverSelectionTimeoutMS</code> milliseconds before erroring out. If not set, the MongoDB driver defaults to using <code>30000</code> (30 seconds). </li></ul>
<ul style="margin-top: 0.5em"><li>
<code>[options.heartbeatFrequencyMS]</code> <span class="method-type">«Number»</span> If <code>useUnifiedTopology = true</code>, the MongoDB driver sends a heartbeat every <code>heartbeatFrequencyMS</code> to check on the status of the connection. A heartbeat is subject to <code>serverSelectionTimeoutMS</code>, so the MongoDB driver will retry failed heartbeats for up to 30 seconds by default. Mongoose only emits a <code>'disconnected'</code> event after a heartbeat has failed, so you may want to decrease this setting to reduce the time between when your server goes down and when Mongoose emits <code>'disconnected'</code>. We recommend you do <strong>not</strong> set this setting below 1000, too many heartbeats can lead to performance degradation. </li></ul>
<ul style="margin-top: 0.5em"><li>
<code>[options.autoIndex=true]</code> <span class="method-type">«Boolean»</span> Mongoose-specific option. Set to false to disable automatic index creation for all models associated with this connection. </li></ul>
<ul style="margin-top: 0.5em"><li>
<code>[options.promiseLibrary]</code> <span class="method-type">«Class»</span> Sets the <a href="https://mongodb.github.io/node-mongodb-native/4.9/interfaces/MongoClientOptions.html#promiseLibrary">underlying driver's promise library</a>. </li></ul>
<ul style="margin-top: 0.5em"><li>
<code>[options.socketTimeoutMS=0]</code> <span class="method-type">«Number»</span> How long the MongoDB driver will wait before killing a socket due to inactivity <em>after initial connection</em>. A socket may be inactive because of either no activity or a long-running operation. <code>socketTimeoutMS</code> defaults to 0, which means Node.js will not time out the socket due to inactivity. This option is passed to <a href="https://nodejs.org/api/net.html#net_socket_settimeout_timeout_callback">Node.js <code>socket#setTimeout()</code> function</a> after the MongoDB driver successfully completes. </li></ul>
<ul style="margin-top: 0.5em"><li>
<code>[options.family=0]</code> <span class="method-type">«Number»</span> Passed transparently to <a href="https://nodejs.org/api/dns.html#dns_dns_lookup_hostname_options_callback">Node.js' <code>dns.lookup()</code></a> function. May be either <code>0</code>, <code>4</code>, or <code>6</code>. <code>4</code> means use IPv4 only, <code>6</code> means use IPv6 only, <code>0</code> means try both. </li></ul>
<ul style="margin-top: 0.5em"><li>
<code>[options.autoCreate=false]</code> <span class="method-type">«Boolean»</span> Set to <code>true</code> to make Mongoose automatically call <code>createCollection()</code> on every model created on this connection. </li></ul>
<li class="param">
<code>[callback]</code> <span class="method-type">«Function»</span> </li>
</ul>
<h5>Returns:</h5>
<ul><li>
<span class="method-type">«Promise»</span> resolves to <code>this</code> if connection succeeded</li></ul>
<h5>See:</h5>
<ul><li><span class="method-type"><a href="#Mongoose.prototype.createConnection()">Mongoose#createConnection</a></span></li></ul>
<div>
<p>Opens the default mongoose connection.</p> <h4 id="example"> <a href="#example"> Example: </a> </h4> <pre data-language="javascript">mongoose.<span class="hljs-title function_">connect</span>(<span class="hljs-string">'mongodb://user:pass@127.0.0.1:port/database'</span>);

<span class="hljs-comment">// replica sets</span>
<span class="hljs-keyword">const</span> uri = <span class="hljs-string">'mongodb://user:pass@127.0.0.1:port,anotherhost:port,yetanother:port/mydatabase'</span>;
mongoose.<span class="hljs-title function_">connect</span>(uri);

<span class="hljs-comment">// with options</span>
mongoose.<span class="hljs-title function_">connect</span>(uri, options);

<span class="hljs-comment">// optional callback that gets fired when initial connection completed</span>
<span class="hljs-keyword">const</span> uri = <span class="hljs-string">'mongodb://nonexistent.domain:27000'</span>;
mongoose.<span class="hljs-title function_">connect</span>(uri, <span class="hljs-keyword">function</span>(<span class="hljs-params">error</span>) {
  <span class="hljs-comment">// if error is truthy, the initial connection failed.</span>
})
</pre> </div>
<h3 id="Mongoose.prototype.connection">Mongoose.prototype.connection</h3>
<h5>Type:</h5>
<ul><li><span class="method-type">«Connection»</span></li></ul>
<div>
<p>The Mongoose module's default connection. Equivalent to <code>mongoose.connections[0]</code>, see <a href="#Mongoose.prototype.connections"><code>connections</code></a>.</p> <h4 id="example"> <a href="#example"> Example: </a> </h4> <pre data-language="javascript"><span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);
mongoose.<span class="hljs-title function_">connect</span>(...);
mongoose.<span class="hljs-property">connection</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'error'</span>, cb);
</pre> <p>This is the connection used by default for every model created using <a href="#Mongoose.prototype.model()">mongoose.model</a>.</p> <p>To create a new connection, use <a href="#Mongoose.prototype.createConnection()"><code>createConnection()</code></a>.</p> </div>
<h3 id="Mongoose.prototype.connections">Mongoose.prototype.connections</h3>
<h5>Type:</h5>
<ul><li><span class="method-type">«Array»</span></li></ul>
<div>
<p>An array containing all <a href="connection.html">connections</a> associated with this Mongoose instance. By default, there is 1 connection. Calling <a href="#Mongoose.prototype.createConnection()"><code>createConnection()</code></a> adds a connection to this array.</p> <h4 id="example"> <a href="#example"> Example: </a> </h4> <pre data-language="javascript"><span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);
mongoose.<span class="hljs-property">connections</span>.<span class="hljs-property">length</span>; <span class="hljs-comment">// 1, just the default connection</span>
mongoose.<span class="hljs-property">connections</span>[<span class="hljs-number">0</span>] === mongoose.<span class="hljs-property">connection</span>; <span class="hljs-comment">// true</span>

mongoose.<span class="hljs-title function_">createConnection</span>(<span class="hljs-string">'mongodb://127.0.0.1:27017/test'</span>);
mongoose.<span class="hljs-property">connections</span>.<span class="hljs-property">length</span>; <span class="hljs-comment">// 2</span>
</pre> </div>
<h3 id="Mongoose.prototype.createConnection()">Mongoose.prototype.createConnection()</h3>
<h5>Parameters:</h5>
<ul class="params">
<li class="param">
<code>uri</code> <span class="method-type">«String»</span> mongodb URI to connect to </li>
<li class="param">
<code>[options]</code> <span class="method-type">«Object»</span> passed down to the <a href="https://mongodb.github.io/node-mongodb-native/4.9/interfaces/MongoClientOptions.html">MongoDB driver's <code>connect()</code> function</a>, except for 4 mongoose-specific options explained below. </li>
<ul style="margin-top: 0.5em"><li>
<code>[options.bufferCommands=true]</code> <span class="method-type">«Boolean»</span> Mongoose specific option. Set to false to <a href="https://mongoosejs.com/docs/faq.html#callback_never_executes">disable buffering</a> on all models associated with this connection. </li></ul>
<ul style="margin-top: 0.5em"><li>
<code>[options.dbName]</code> <span class="method-type">«String»</span> The name of the database you want to use. If not provided, Mongoose uses the database name from connection string. </li></ul>
<ul style="margin-top: 0.5em"><li>
<code>[options.user]</code> <span class="method-type">«String»</span> username for authentication, equivalent to <code>options.auth.user</code>. Maintained for backwards compatibility. </li></ul>
<ul style="margin-top: 0.5em"><li>
<code>[options.pass]</code> <span class="method-type">«String»</span> password for authentication, equivalent to <code>options.auth.password</code>. Maintained for backwards compatibility. </li></ul>
<ul style="margin-top: 0.5em"><li>
<code>[options.autoIndex=true]</code> <span class="method-type">«Boolean»</span> Mongoose-specific option. Set to false to disable automatic index creation for all models associated with this connection. </li></ul>
<ul style="margin-top: 0.5em"><li>
<code>[options.promiseLibrary]</code> <span class="method-type">«Class»</span> Sets the <a href="https://mongodb.github.io/node-mongodb-native/4.9/interfaces/MongoClientOptions.html#promiseLibrary">underlying driver's promise library</a>. </li></ul>
<ul style="margin-top: 0.5em"><li>
<code>[options.maxPoolSize=5]</code> <span class="method-type">«Number»</span> The maximum number of sockets the MongoDB driver will keep open for this connection. Keep in mind that MongoDB only allows one operation per socket at a time, so you may want to increase this if you find you have a few slow queries that are blocking faster queries from proceeding. See <a href="https://thecodebarbarian.com/slow-trains-in-mongodb-and-nodejs">Slow Trains in MongoDB and Node.js</a>. </li></ul>
<ul style="margin-top: 0.5em"><li>
<code>[options.minPoolSize=1]</code> <span class="method-type">«Number»</span> The minimum number of sockets the MongoDB driver will keep open for this connection. Keep in mind that MongoDB only allows one operation per socket at a time, so you may want to increase this if you find you have a few slow queries that are blocking faster queries from proceeding. See <a href="https://thecodebarbarian.com/slow-trains-in-mongodb-and-nodejs">Slow Trains in MongoDB and Node.js</a>. </li></ul>
<ul style="margin-top: 0.5em"><li>
<code>[options.socketTimeoutMS=0]</code> <span class="method-type">«Number»</span> How long the MongoDB driver will wait before killing a socket due to inactivity <em>after initial connection</em>. Defaults to 0, which means Node.js will not time out the socket due to inactivity. A socket may be inactive because of either no activity or a long-running operation. This option is passed to <a href="https://nodejs.org/api/net.html#net_socket_settimeout_timeout_callback">Node.js <code>socket#setTimeout()</code> function</a> after the MongoDB driver successfully completes. </li></ul>
<ul style="margin-top: 0.5em"><li>
<code>[options.family=0]</code> <span class="method-type">«Number»</span> Passed transparently to <a href="https://nodejs.org/api/dns.html#dns_dns_lookup_hostname_options_callback">Node.js' <code>dns.lookup()</code></a> function. May be either <code>0</code>, <code>4</code>, or <code>6</code>. <code>4</code> means use IPv4 only, <code>6</code> means use IPv6 only, <code>0</code> means try both. </li></ul>
</ul>
<h5>Returns:</h5>
<ul><li>
<span class="method-type">«Connection»</span> the created Connection object. Connections are not thenable, so you can't do <code>await mongoose.createConnection()</code>. To await use <code>mongoose.createConnection(uri).asPromise()</code> instead.</li></ul>
<div>
<p>Creates a Connection instance.</p> <p>Each <code>connection</code> instance maps to a single database. This method is helpful when managing multiple db connections.</p> <p><em>Options passed take precedence over options included in connection strings.</em></p> <h4 id="example"> <a href="#example"> Example: </a> </h4> <pre data-language="javascript"><span class="hljs-comment">// with mongodb:// URI</span>
db = mongoose.<span class="hljs-title function_">createConnection</span>(<span class="hljs-string">'mongodb://user:pass@127.0.0.1:port/database'</span>);

<span class="hljs-comment">// and options</span>
<span class="hljs-keyword">const</span> opts = { <span class="hljs-attr">db</span>: { <span class="hljs-attr">native_parser</span>: <span class="hljs-literal">true</span> }}
db = mongoose.<span class="hljs-title function_">createConnection</span>(<span class="hljs-string">'mongodb://user:pass@127.0.0.1:port/database'</span>, opts);

<span class="hljs-comment">// replica sets</span>
db = mongoose.<span class="hljs-title function_">createConnection</span>(<span class="hljs-string">'mongodb://user:pass@127.0.0.1:port,anotherhost:port,yetanother:port/database'</span>);

<span class="hljs-comment">// and options</span>
<span class="hljs-keyword">const</span> opts = { <span class="hljs-attr">replset</span>: { <span class="hljs-attr">strategy</span>: <span class="hljs-string">'ping'</span>, <span class="hljs-attr">rs_name</span>: <span class="hljs-string">'testSet'</span> }}
db = mongoose.<span class="hljs-title function_">createConnection</span>(<span class="hljs-string">'mongodb://user:pass@127.0.0.1:port,anotherhost:port,yetanother:port/database'</span>, opts);

<span class="hljs-comment">// initialize now, connect later</span>
db = mongoose.<span class="hljs-title function_">createConnection</span>();
db.<span class="hljs-title function_">openUri</span>(<span class="hljs-string">'127.0.0.1'</span>, <span class="hljs-string">'database'</span>, port, [opts]);
</pre> </div>
<h3 id="Mongoose.prototype.deleteModel()">Mongoose.prototype.deleteModel()</h3>
<h5>Parameters:</h5>
<ul class="params"><li class="param">
<code>name</code> <span class="method-type">«String|RegExp»</span> if string, the name of the model to remove. If regexp, removes all models whose name matches the regexp. </li></ul>
<h5>Returns:</h5>
<ul><li>
<span class="method-type">«Mongoose»</span> this</li></ul>
<div>
<p>Removes the model named <code>name</code> from the default connection, if it exists. You can use this function to clean up any models you created in your tests to prevent OverwriteModelErrors.</p> <p>Equivalent to <code>mongoose.connection.deleteModel(name)</code>.</p> <h4 id="example"> <a href="#example"> Example: </a> </h4> <pre data-language="javascript">mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">'User'</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span> }));
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">'User'</span>)); <span class="hljs-comment">// Model object</span>
mongoose.<span class="hljs-title function_">deleteModel</span>(<span class="hljs-string">'User'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">'User'</span>)); <span class="hljs-comment">// undefined</span>

<span class="hljs-comment">// Usually useful in a Mocha `afterEach()` hook</span>
<span class="hljs-title function_">afterEach</span>(<span class="hljs-keyword">function</span>() {
  mongoose.<span class="hljs-title function_">deleteModel</span>(<span class="hljs-regexp">/.+/</span>); <span class="hljs-comment">// Delete every model</span>
});
</pre> </div>
<h3 id="Mongoose.prototype.disconnect()">Mongoose.prototype.disconnect()</h3>
<h5>Returns:</h5>
<ul><li>
<span class="method-type">«Promise»</span> resolves when all connections are closed, or rejects with the first error that occurred.</li></ul>
<div>
<p>Runs <code>.close()</code> on all connections in parallel.</p> </div>
<h3 id="Mongoose.prototype.driver">Mongoose.prototype.driver</h3>
<span class="deprecated">~DEPRECATED~</span><h5>Type:</h5>
<ul><li><span class="method-type">«property»</span></li></ul>
<div>
<p>Object with <code>get()</code> and <code>set()</code> containing the underlying driver this Mongoose instance uses to communicate with the database. A driver is a Mongoose-specific interface that defines functions like <code>find()</code>.</p> </div>
<h3 id="Mongoose.prototype.get()">Mongoose.prototype.get()</h3>
<h5>Parameters:</h5>
<ul class="params"><li class="param">
<code>key</code> <span class="method-type">«String»</span> </li></ul>
<div>
<p>Gets mongoose options</p> <h4 id="example"> <a href="#example"> Example: </a> </h4> <pre data-language="javascript">mongoose.<span class="hljs-title function_">get</span>(<span class="hljs-string">'test'</span>) <span class="hljs-comment">// returns the 'test' value</span>
</pre> </div>
<h3 id="Mongoose.prototype.isObjectIdOrHexString()">Mongoose.prototype.isObjectIdOrHexString()</h3>
<h5>Parameters:</h5>
<ul class="params"><li class="param">
<code>v</code> <span class="method-type">«Any»</span> </li></ul>
<div>
<p>Returns true if the given value is a Mongoose ObjectId (using <code>instanceof</code>) or if the given value is a 24 character hex string, which is the most commonly used string representation of an ObjectId.</p> <p>This function is similar to <code>isValidObjectId()</code>, but considerably more strict, because <code>isValidObjectId()</code> will return <code>true</code> for <em>any</em> value that Mongoose can convert to an ObjectId. That includes Mongoose documents, any string of length 12, and any number. <code>isObjectIdOrHexString()</code> returns true only for <code>ObjectId</code> instances or 24 character hex strings, and will return false for numbers, documents, and strings of length 12.</p> <h4 id="example"> <a href="#example"> Example: </a> </h4> <pre data-language="javascript">mongoose.<span class="hljs-title function_">isObjectIdOrHexString</span>(<span class="hljs-keyword">new</span> mongoose.<span class="hljs-property">Types</span>.<span class="hljs-title class_">ObjectId</span>()); <span class="hljs-comment">// true</span>
mongoose.<span class="hljs-title function_">isObjectIdOrHexString</span>(<span class="hljs-string">'62261a65d66c6be0a63c051f'</span>); <span class="hljs-comment">// true</span>

mongoose.<span class="hljs-title function_">isObjectIdOrHexString</span>(<span class="hljs-string">'0123456789ab'</span>); <span class="hljs-comment">// false</span>
mongoose.<span class="hljs-title function_">isObjectIdOrHexString</span>(<span class="hljs-number">6</span>); <span class="hljs-comment">// false</span>
mongoose.<span class="hljs-title function_">isObjectIdOrHexString</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'test'</span> })); <span class="hljs-comment">// false</span>
mongoose.<span class="hljs-title function_">isObjectIdOrHexString</span>({ <span class="hljs-attr">test</span>: <span class="hljs-number">42</span> }); <span class="hljs-comment">// false</span>
</pre> </div>
<h3 id="Mongoose.prototype.isValidObjectId()">Mongoose.prototype.isValidObjectId()</h3>
<h5>Parameters:</h5>
<ul class="params"><li class="param">
<code>v</code> <span class="method-type">«Any»</span> </li></ul>
<div>
<p>Returns true if Mongoose can cast the given value to an ObjectId, or false otherwise.</p> <h4 id="example"> <a href="#example"> Example: </a> </h4> <pre data-language="javascript">mongoose.<span class="hljs-title function_">isValidObjectId</span>(<span class="hljs-keyword">new</span> mongoose.<span class="hljs-property">Types</span>.<span class="hljs-title class_">ObjectId</span>()); <span class="hljs-comment">// true</span>
mongoose.<span class="hljs-title function_">isValidObjectId</span>(<span class="hljs-string">'0123456789ab'</span>); <span class="hljs-comment">// true</span>
mongoose.<span class="hljs-title function_">isValidObjectId</span>(<span class="hljs-number">6</span>); <span class="hljs-comment">// true</span>
mongoose.<span class="hljs-title function_">isValidObjectId</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'test'</span> })); <span class="hljs-comment">// true</span>

mongoose.<span class="hljs-title function_">isValidObjectId</span>({ <span class="hljs-attr">test</span>: <span class="hljs-number">42</span> }); <span class="hljs-comment">// false</span>
</pre> </div>
<h3 id="Mongoose.prototype.model()">Mongoose.prototype.model()</h3>
<h5>Parameters:</h5>
<ul class="params">
<li class="param">
<code>name</code> <span class="method-type">«String|Function»</span> model name or class extending Model </li>
<li class="param">
<code>[schema]</code> <span class="method-type">«Schema»</span> the schema to use. </li>
<li class="param">
<code>[collection]</code> <span class="method-type">«String»</span> name (optional, inferred from model name) </li>
</ul>
<h5>Returns:</h5>
<ul><li>
<span class="method-type">«Model»</span> The model associated with <code>name</code>. Mongoose will create the model if it doesn't already exist.</li></ul>
<div>
<p>Defines a model or retrieves it.</p> <p>Models defined on the <code>mongoose</code> instance are available to all connection created by the same <code>mongoose</code> instance.</p> <p>If you call <code>mongoose.model()</code> with twice the same name but a different schema, you will get an <code>OverwriteModelError</code>. If you call <code>mongoose.model()</code> with the same name and same schema, you'll get the same schema back.</p> <h4 id="example"> <a href="#example"> Example: </a> </h4> <pre data-language="javascript"><span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);

<span class="hljs-comment">// define an Actor model with this mongoose instance</span>
<span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span> });
mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">'Actor'</span>, schema);

<span class="hljs-comment">// create a new connection</span>
<span class="hljs-keyword">const</span> conn = mongoose.<span class="hljs-title function_">createConnection</span>(..);

<span class="hljs-comment">// create Actor model</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Actor</span> = conn.<span class="hljs-title function_">model</span>(<span class="hljs-string">'Actor'</span>, schema);
conn.<span class="hljs-title function_">model</span>(<span class="hljs-string">'Actor'</span>) === <span class="hljs-title class_">Actor</span>; <span class="hljs-comment">// true</span>
conn.<span class="hljs-title function_">model</span>(<span class="hljs-string">'Actor'</span>, schema) === <span class="hljs-title class_">Actor</span>; <span class="hljs-comment">// true, same schema</span>
conn.<span class="hljs-title function_">model</span>(<span class="hljs-string">'Actor'</span>, schema, <span class="hljs-string">'actors'</span>) === <span class="hljs-title class_">Actor</span>; <span class="hljs-comment">// true, same schema and collection name</span>

<span class="hljs-comment">// This throws an `OverwriteModelError` because the schema is different.</span>
conn.<span class="hljs-title function_">model</span>(<span class="hljs-string">'Actor'</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span> }));
</pre> <p><em>When no <code>collection</code> argument is passed, Mongoose uses the model name. If you don't like this behavior, either pass a collection name, use <code>mongoose.pluralize()</code>, or set your schemas collection name option.</em></p> <h4 id="example-1"> <a href="#example-1"> Example: </a> </h4> <pre data-language="javascript"><span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span> }, { <span class="hljs-attr">collection</span>: <span class="hljs-string">'actor'</span> });

<span class="hljs-comment">// or</span>

schema.<span class="hljs-title function_">set</span>(<span class="hljs-string">'collection'</span>, <span class="hljs-string">'actor'</span>);

<span class="hljs-comment">// or</span>

<span class="hljs-keyword">const</span> collectionName = <span class="hljs-string">'actor'</span>
<span class="hljs-keyword">const</span> M = mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">'Actor'</span>, schema, collectionName)
</pre> </div>
<h3 id="Mongoose.prototype.modelNames()">Mongoose.prototype.modelNames()</h3>
<h5>Returns:</h5>
<ul><li>
<span class="method-type">«Array»</span> </li></ul>
<div>
<p>Returns an array of model names created on this instance of Mongoose.</p> <h4 id="note"> <a href="#note"> Note: </a> </h4> <p><em>Does not include names of models created using <code>connection.model()</code>.</em></p> </div>
<h3 id="Mongoose.prototype.mongo">Mongoose.prototype.mongo</h3>
<h5>Type:</h5>
<ul><li><span class="method-type">«property»</span></li></ul>
<div>
<p>The <a href="https://github.com/mongodb/node-mongodb-native">node-mongodb-native</a> driver Mongoose uses.</p> </div>
<h3 id="Mongoose.prototype.mquery">Mongoose.prototype.mquery</h3>
<h5>Type:</h5>
<ul><li><span class="method-type">«property»</span></li></ul>
<div>
<p>The <a href="https://github.com/aheckmann/mquery">mquery</a> query builder Mongoose uses.</p> </div>
<h3 id="Mongoose.prototype.now()">Mongoose.prototype.now()</h3>
<div>
<p>Mongoose uses this function to get the current time when setting <a href="../guide.html#timestamps">timestamps</a>. You may stub out this function using a tool like <a href="https://www.npmjs.com/package/sinon">Sinon</a> for testing.</p> </div>
<h3 id="Mongoose.prototype.overwriteMiddlewareResult()">Mongoose.prototype.overwriteMiddlewareResult()</h3>
<h5>Parameters:</h5>
<ul class="params"><li class="param">
<code>result</code> <span class="method-type">«any»</span> </li></ul>
<div>
<p>Use this function in <code>post()</code> middleware to replace the result</p> <h4 id="example"> <a href="#example"> Example: </a> </h4> <pre data-language="javascript">schema.<span class="hljs-title function_">post</span>(<span class="hljs-string">'find'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">res</span>) {
  <span class="hljs-comment">// Normally you have to modify `res` in place. But with</span>
  <span class="hljs-comment">// `overwriteMiddlewarResult()`, you can make `find()` return a</span>
  <span class="hljs-comment">// completely different value.</span>
  <span class="hljs-keyword">return</span> mongoose.<span class="hljs-title function_">overwriteMiddlewareResult</span>(res.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">doc</span> =&gt;</span> !doc.<span class="hljs-property">isDeleted</span>));
});
</pre> </div>
<h3 id="Mongoose.prototype.plugin()">Mongoose.prototype.plugin()</h3>
<h5>Parameters:</h5>
<ul class="params">
<li class="param">
<code>fn</code> <span class="method-type">«Function»</span> plugin callback </li>
<li class="param">
<code>[opts]</code> <span class="method-type">«Object»</span> optional options </li>
</ul>
<h5>Returns:</h5>
<ul><li>
<span class="method-type">«Mongoose»</span> this</li></ul>
<h5>See:</h5>
<ul><li><span class="method-type"><a href="../plugins.html">plugins</a></span></li></ul>
<div>
<p>Declares a global plugin executed on all Schemas.</p> <p>Equivalent to calling <code>.plugin(fn)</code> on each Schema you create.</p> </div>
<h3 id="Mongoose.prototype.pluralize()">Mongoose.prototype.pluralize()</h3>
<h5>Parameters:</h5>
<ul class="params"><li class="param">
<code>[fn]</code> <span class="method-type">«Function|null»</span> overwrites the function used to pluralize collection names </li></ul>
<h5>Returns:</h5>
<ul><li>
<span class="method-type">«Function,null»</span> the current function used to pluralize collection names, defaults to the legacy function from <code>mongoose-legacy-pluralize</code>.</li></ul>
<div>
<p>Getter/setter around function for pluralizing collection names.</p> </div>
<h3 id="Mongoose.prototype.sanitizeFilter()">Mongoose.prototype.sanitizeFilter()</h3>
<h5>Parameters:</h5>
<ul class="params"><li class="param">
<code>filter</code> <span class="method-type">«Object»</span> </li></ul>
<div>
<p>Sanitizes query filters against <a href="https://thecodebarbarian.com/2014/09/04/defending-against-query-selector-injection-attacks.html">query selector injection attacks</a> by wrapping any nested objects that have a property whose name starts with <code>$</code> in a <code>$eq</code>.</p> <pre data-language="javascript"><span class="hljs-keyword">const</span> obj = { <span class="hljs-attr">username</span>: <span class="hljs-string">'val'</span>, <span class="hljs-attr">pwd</span>: { <span class="hljs-attr">$ne</span>: <span class="hljs-literal">null</span> } };
<span class="hljs-title function_">sanitizeFilter</span>(obj);
obj; <span class="hljs-comment">// { username: 'val', pwd: { $eq: { $ne: null } } });</span>
</pre> </div>
<h3 id="Mongoose.prototype.set()">Mongoose.prototype.set()</h3>
<h5>Parameters:</h5>
<ul class="params">
<li class="param">
<code>key</code> <span class="method-type">«String|Object»</span> The name of the option or a object of multiple key-value pairs </li>
<li class="param">
<code>value</code> <span class="method-type">«String|Function|Boolean»</span> The value of the option, unused if "key" is a object </li>
</ul>
<div>
<p>Sets mongoose options</p> <p><code>key</code> can be used a object to set multiple options at once. If a error gets thrown for one option, other options will still be evaluated.</p> <h4 id="example"> <a href="#example"> Example: </a> </h4> <pre data-language="javascript">mongoose.<span class="hljs-title function_">set</span>(<span class="hljs-string">'test'</span>, value) <span class="hljs-comment">// sets the 'test' option to `value`</span>

mongoose.<span class="hljs-title function_">set</span>(<span class="hljs-string">'debug'</span>, <span class="hljs-literal">true</span>) <span class="hljs-comment">// enable logging collection methods + arguments to the console/file</span>

mongoose.<span class="hljs-title function_">set</span>(<span class="hljs-string">'debug'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">collectionName, methodName, ...methodArgs</span>) {}); <span class="hljs-comment">// use custom function to log collection methods + arguments</span>

mongoose.<span class="hljs-title function_">set</span>({ <span class="hljs-attr">debug</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">autoIndex</span>: <span class="hljs-literal">false</span> }); <span class="hljs-comment">// set multiple options at once</span>
</pre> <p>Currently supported options are:</p> <ul> <li>
<code>allowDiskUse</code>: Set to <code>true</code> to set <code>allowDiskUse</code> to true to all aggregation operations by default.</li> <li>
<code>applyPluginsToChildSchemas</code>: <code>true</code> by default. Set to false to skip applying global plugins to child schemas</li> <li>
<code>applyPluginsToDiscriminators</code>: <code>false</code> by default. Set to true to apply global plugins to discriminator schemas. This typically isn't necessary because plugins are applied to the base schema and discriminators copy all middleware, methods, statics, and properties from the base schema.</li> <li>
<code>autoCreate</code>: Set to <code>true</code> to make Mongoose call <a href="model.html#Model.createCollection()"><code>Model.createCollection()</code></a> automatically when you create a model with <code>mongoose.model()</code> or <code>conn.model()</code>. This is useful for testing transactions, change streams, and other features that require the collection to exist.</li> <li>
<code>autoIndex</code>: <code>true</code> by default. Set to false to disable automatic index creation for all models associated with this Mongoose instance.</li> <li>
<code>bufferCommands</code>: enable/disable mongoose's buffering mechanism for all connections and models</li> <li>
<code>bufferTimeoutMS</code>: If bufferCommands is on, this option sets the maximum amount of time Mongoose buffering will wait before throwing an error. If not specified, Mongoose will use 10000 (10 seconds).</li> <li>
<code>cloneSchemas</code>: <code>false</code> by default. Set to <code>true</code> to <code>clone()</code> all schemas before compiling into a model.</li> <li>
<code>debug</code>: If <code>true</code>, prints the operations mongoose sends to MongoDB to the console. If a writable stream is passed, it will log to that stream, without colorization. If a callback function is passed, it will receive the collection name, the method name, then all arguments passed to the method. For example, if you wanted to replicate the default logging, you could output from the callback <code>Mongoose: ${collectionName}.${methodName}(${methodArgs.join(', ')})</code>.</li> <li>
<code>id</code>: If <code>true</code>, adds a <code>id</code> virtual to all schemas unless overwritten on a per-schema basis.</li> <li>
<code>timestamps.createdAt.immutable</code>: <code>true</code> by default. If <code>false</code>, it will change the <code>createdAt</code> field to be <a href="schematype.html#SchemaType.prototype.immutable"><code>immutable: false</code></a> which means you can update the <code>createdAt</code>
</li> <li>
<code>maxTimeMS</code>: If set, attaches <a href="https://www.mongodb.com/docs/manual/reference/operator/meta/maxTimeMS/">maxTimeMS</a> to every query</li> <li>
<code>objectIdGetter</code>: <code>true</code> by default. Mongoose adds a getter to MongoDB ObjectId's called <code>_id</code> that returns <code>this</code> for convenience with populate. Set this to false to remove the getter.</li> <li>
<code>overwriteModels</code>: Set to <code>true</code> to default to overwriting models with the same name when calling <code>mongoose.model()</code>, as opposed to throwing an <code>OverwriteModelError</code>.</li> <li>
<code>returnOriginal</code>: If <code>false</code>, changes the default <code>returnOriginal</code> option to <code>findOneAndUpdate()</code>, <code>findByIdAndUpdate</code>, and <code>findOneAndReplace()</code> to false. This is equivalent to setting the <code>new</code> option to <code>true</code> for <code>findOneAndX()</code> calls by default. Read our <a href="../tutorials/findoneandupdate.html"><code>findOneAndUpdate()</code> tutorial</a> for more information.</li> <li>
<code>runValidators</code>: <code>false</code> by default. Set to true to enable <a href="../validation.html#update-validators">update validators</a> for all validators by default.</li> <li>
<code>sanitizeFilter</code>: <code>false</code> by default. Set to true to enable the <a href="#Mongoose.prototype.sanitizeFilter()">sanitization of the query filters</a> against query selector injection attacks by wrapping any nested objects that have a property whose name starts with <code>$</code> in a <code>$eq</code>.</li> <li>
<code>selectPopulatedPaths</code>: <code>true</code> by default. Set to false to opt out of Mongoose adding all fields that you <code>populate()</code> to your <code>select()</code>. The schema-level option <code>selectPopulatedPaths</code> overwrites this one.</li> <li>
<code>strict</code>: <code>true</code> by default, may be <code>false</code>, <code>true</code>, or <code>'throw'</code>. Sets the default strict mode for schemas.</li> <li>
<code>strictQuery</code>: <code>false</code> by default. May be <code>false</code>, <code>true</code>, or <code>'throw'</code>. Sets the default <a href="../guide.html#strictQuery">strictQuery</a> mode for schemas.</li> <li>
<code>toJSON</code>: <code>{ transform: true, flattenDecimals: true }</code> by default. Overwrites default objects to <a href="document.html#Document.prototype.toJSON()"><code>toJSON()</code></a>, for determining how Mongoose documents get serialized by <code>JSON.stringify()</code>
</li> <li>
<code>toObject</code>: <code>{ transform: true, flattenDecimals: true }</code> by default. Overwrites default objects to <a href="document.html#Document.prototype.toObject()"><code>toObject()</code></a>
</li> </ul> </div>
<h3 id="Mongoose.prototype.setDriver()">Mongoose.prototype.setDriver()</h3>
<div>
<p>Overwrites the current driver used by this Mongoose instance. A driver is a Mongoose-specific interface that defines functions like <code>find()</code>.</p> </div>
<h3 id="Mongoose.prototype.skipMiddlewareFunction()">Mongoose.prototype.skipMiddlewareFunction()</h3>
<h5>Parameters:</h5>
<ul class="params"><li class="param">
<code>result</code> <span class="method-type">«any»</span> </li></ul>
<div>
<p>Use this function in <code>pre()</code> middleware to skip calling the wrapped function.</p> <h4 id="example"> <a href="#example"> Example: </a> </h4> <pre data-language="javascript">schema.<span class="hljs-title function_">pre</span>(<span class="hljs-string">'save'</span>, <span class="hljs-keyword">function</span>() {
  <span class="hljs-comment">// Will skip executing `save()`, but will execute post hooks as if</span>
  <span class="hljs-comment">// `save()` had executed with the result `{ matchedCount: 0 }`</span>
  <span class="hljs-keyword">return</span> mongoose.<span class="hljs-title function_">skipMiddlewareFunction</span>({ <span class="hljs-attr">matchedCount</span>: <span class="hljs-number">0</span> });
});
</pre> </div>
<h3 id="Mongoose.prototype.startSession()">Mongoose.prototype.startSession()</h3>
<h5>Parameters:</h5>
<ul class="params">
<li class="param">
<code>[options]</code> <span class="method-type">«Object»</span> see the <a href="https://mongodb.github.io/node-mongodb-native/4.9/classes/MongoClient.html#startSession">mongodb driver options</a> </li>
<ul style="margin-top: 0.5em"><li>
<code>[options.causalConsistency=true]</code> <span class="method-type">«Boolean»</span> set to false to disable causal consistency </li></ul>
<li class="param">
<code>[callback]</code> <span class="method-type">«Function»</span> </li>
</ul>
<h5>Returns:</h5>
<ul><li>
<span class="method-type">«Promise&lt;ClientSession&gt;»</span> promise that resolves to a MongoDB driver <code>ClientSession</code>
</li></ul>
<div>
<p><em>Requires MongoDB &gt;= 3.6.0.</em> Starts a <a href="https://www.mongodb.com/docs/manual/release-notes/3.6/#client-sessions">MongoDB session</a> for benefits like causal consistency, <a href="https://www.mongodb.com/docs/manual/core/retryable-writes/">retryable writes</a>, and <a href="https://thecodebarbarian.com/a-node-js-perspective-on-mongodb-4-transactions.html">transactions</a>.</p> <p>Calling <code>mongoose.startSession()</code> is equivalent to calling <code>mongoose.connection.startSession()</code>. Sessions are scoped to a connection, so calling <code>mongoose.startSession()</code> starts a session on the <a href="#Mongoose.prototype.connection">default mongoose connection</a>.</p> </div>
<h3 id="Mongoose.prototype.syncIndexes()">Mongoose.prototype.syncIndexes()</h3>
<h5>Parameters:</h5>
<ul class="params">
<li class="param">
<code>options</code> <span class="method-type">«Object»</span> </li>
<li class="param">
<code>options.continueOnError</code> <span class="method-type">«Boolean»</span> <code>false</code> by default. If set to <code>true</code>, mongoose will not throw an error if one model syncing failed, and will return an object where the keys are the names of the models, and the values are the results/errors for each model. </li>
</ul>
<h5>Returns:</h5>
<ul><li>
<span class="method-type">«Promise»</span> Returns a Promise, when the Promise resolves the value is a list of the dropped indexes.</li></ul>
<div>
<p>Syncs all the indexes for the models registered with this connection.</p> </div>
<h3 id="Mongoose.prototype.trusted()">Mongoose.prototype.trusted()</h3>
<h5>Parameters:</h5>
<ul class="params"><li class="param">
<code>obj</code> <span class="method-type">«Object»</span> </li></ul>
<div>
<p>Tells <code>sanitizeFilter()</code> to skip the given object when filtering out potential <a href="https://thecodebarbarian.com/2014/09/04/defending-against-query-selector-injection-attacks.html">query selector injection attacks</a>. Use this method when you have a known query selector that you want to use.</p> <pre data-language="javascript"><span class="hljs-keyword">const</span> obj = { <span class="hljs-attr">username</span>: <span class="hljs-string">'val'</span>, <span class="hljs-attr">pwd</span>: <span class="hljs-title function_">trusted</span>({ <span class="hljs-attr">$type</span>: <span class="hljs-string">'string'</span>, <span class="hljs-attr">$eq</span>: <span class="hljs-string">'my secret'</span> }) };
<span class="hljs-title function_">sanitizeFilter</span>(obj);

<span class="hljs-comment">// Note that `sanitizeFilter()` did not add `$eq` around `$type`.</span>
obj; <span class="hljs-comment">// { username: 'val', pwd: { $type: 'string', $eq: 'my secret' } });</span>
</pre> </div>
<h3 id="Mongoose.prototype.version">Mongoose.prototype.version</h3>
<h5>Type:</h5>
<ul><li><span class="method-type">«property»</span></li></ul>
<div>
<p>The Mongoose version</p> <h4 id="example"> <a href="#example"> Example: </a> </h4> <pre data-language="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(mongoose.<span class="hljs-property">version</span>); <span class="hljs-comment">// '5.x.x'</span>
</pre> </div>
</div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2010 LearnBoost<br>Licensed under the MIT License.<br>
    <a href="https://mongoosejs.com/docs/api/mongoose.html" class="_attribution-link">https://mongoosejs.com/docs/api/mongoose.html</a>
  </p>
</div>
