<h1>Schematype</h1>

<div class="api-content">
<h3 id="SchemaType()">SchemaType()</h3>
<h5>Parameters:</h5>
<ul class="params">
<li class="param">
<code>path</code> <span class="method-type">«String»</span> </li>
<li class="param">
<code>[options]</code> <span class="method-type">«SchemaTypeOptions»</span> See <a href="schematypeoptions.html">SchemaTypeOptions docs</a> </li>
<li class="param">
<code>[instance]</code> <span class="method-type">«String»</span> </li>
</ul>
<div>
<p>SchemaType constructor. Do <strong>not</strong> instantiate <code>SchemaType</code> directly. Mongoose converts your schema paths into SchemaTypes automatically.</p> <h4 id="example"> <a href="#example"> Example: </a> </h4> <pre data-language="javascript"><span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span> });
schema.<span class="hljs-title function_">path</span>(<span class="hljs-string">'name'</span>) <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">SchemaType</span>; <span class="hljs-comment">// true</span>
</pre> </div>
<h3 id="SchemaType.cast()">SchemaType.cast()</h3>
<h5>Parameters:</h5>
<ul class="params"><li class="param">
<code>caster</code> <span class="method-type">«Function|false»</span> Function that casts arbitrary values to this type, or throws an error if casting failed </li></ul>
<h5>Returns:</h5>
<ul><li>
<span class="method-type">«Function»</span> </li></ul>
<div>
<p>Get/set the function used to cast arbitrary values to this type.</p> <h4 id="example"> <a href="#example"> Example: </a> </h4> <pre data-language="javascript"><span class="hljs-comment">// Disallow `null` for numbers, and don't try to cast any values to</span>
<span class="hljs-comment">// numbers, so even strings like '123' will cause a CastError.</span>
mongoose.<span class="hljs-property">Number</span>.<span class="hljs-title function_">cast</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">v</span>) {
  assert.<span class="hljs-title function_">ok</span>(v === <span class="hljs-literal">undefined</span> || <span class="hljs-keyword">typeof</span> v === <span class="hljs-string">'number'</span>);
  <span class="hljs-keyword">return</span> v;
});
</pre> </div>
<h3 id="SchemaType.checkRequired()">SchemaType.checkRequired()</h3>
<h5>Parameters:</h5>
<ul class="params"><li class="param">
<code>[fn]</code> <span class="method-type">«Function»</span> If set, will overwrite the current set function </li></ul>
<h5>Returns:</h5>
<ul><li>
<span class="method-type">«Function»</span> The input <code>fn</code> or the already set function</li></ul>
<div>
<p>Set &amp; Get the <code>checkRequired</code> function Override the function the required validator uses to check whether a value passes the <code>required</code> check. Override this on the individual SchemaType.</p> <h4 id="example"> <a href="#example"> Example: </a> </h4> <pre data-language="javascript"><span class="hljs-comment">// Use this to allow empty strings to pass the `required` validator</span>
mongoose.<span class="hljs-property">Schema</span>.<span class="hljs-property">Types</span>.<span class="hljs-property">String</span>.<span class="hljs-title function_">checkRequired</span>(<span class="hljs-function"><span class="hljs-params">v</span> =&gt;</span> <span class="hljs-keyword">typeof</span> v === <span class="hljs-string">'string'</span>);
</pre> </div>
<h3 id="SchemaType.get()">SchemaType.get()</h3>
<h5>Parameters:</h5>
<ul class="params"><li class="param">
<code>getter</code> <span class="method-type">«Function»</span> </li></ul>
<h5>Returns:</h5>
<ul><li>
<span class="method-type">«this»</span> </li></ul>
<div>
<p>Attaches a getter for all instances of this schema type.</p> <h4 id="example"> <a href="#example"> Example: </a> </h4> <pre data-language="javascript"><span class="hljs-comment">// Make all numbers round down</span>
mongoose.<span class="hljs-property">Number</span>.<span class="hljs-title function_">get</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">v</span>) { <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(v); });
</pre> </div>
<h3 id="SchemaType.prototype.cast()">SchemaType.prototype.cast()</h3>
<h5>Parameters:</h5>
<ul class="params">
<li class="param">
<code>value</code> <span class="method-type">«Object»</span> value to cast </li>
<li class="param">
<code>doc</code> <span class="method-type">«Document»</span> document that triggers the casting </li>
<li class="param">
<code>init</code> <span class="method-type">«Boolean»</span> </li>
</ul>
<div>
<p>The function that Mongoose calls to cast arbitrary values to this SchemaType.</p> </div>
<h3 id="SchemaType.prototype.castFunction()">SchemaType.prototype.castFunction()</h3>
<h5>Parameters:</h5>
<ul class="params"><li class="param">
<code>caster</code> <span class="method-type">«Function|false»</span> Function that casts arbitrary values to this type, or throws an error if casting failed </li></ul>
<h5>Returns:</h5>
<ul><li>
<span class="method-type">«Function»</span> </li></ul>
<div>
<p>Get/set the function used to cast arbitrary values to this particular schematype instance. Overrides <code>SchemaType.cast()</code>.</p> <h4 id="example"> <a href="#example"> Example: </a> </h4> <pre data-language="javascript"><span class="hljs-comment">// Disallow `null` for numbers, and don't try to cast any values to</span>
<span class="hljs-comment">// numbers, so even strings like '123' will cause a CastError.</span>
<span class="hljs-keyword">const</span> number = <span class="hljs-keyword">new</span> mongoose.<span class="hljs-title class_">Number</span>(<span class="hljs-string">'mypath'</span>, {});
number.<span class="hljs-title function_">cast</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">v</span>) {
  assert.<span class="hljs-title function_">ok</span>(v === <span class="hljs-literal">undefined</span> || <span class="hljs-keyword">typeof</span> v === <span class="hljs-string">'number'</span>);
  <span class="hljs-keyword">return</span> v;
});
</pre> </div>
<h3 id="SchemaType.prototype.default()">SchemaType.prototype.default()</h3>
<h5>Parameters:</h5>
<ul class="params"><li class="param">
<code>val</code> <span class="method-type">«Function|any»</span> The default value to set </li></ul>
<h5>Returns:</h5>
<ul><li>
<span class="method-type">«Any,undefined,void»</span> Returns the set default value.</li></ul>
<div>
<p>Sets a default value for this SchemaType.</p> <h4 id="example"> <a href="#example"> Example: </a> </h4> <pre data-language="javascript"><span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">n</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>, <span class="hljs-attr">default</span>: <span class="hljs-number">10</span> })
<span class="hljs-keyword">const</span> M = db.<span class="hljs-title function_">model</span>(<span class="hljs-string">'M'</span>, schema)
<span class="hljs-keyword">const</span> m = <span class="hljs-keyword">new</span> M;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(m.<span class="hljs-property">n</span>) <span class="hljs-comment">// 10</span>
</pre> <p>Defaults can be either <code>functions</code> which return the value to use as the default or the literal value itself. Either way, the value will be cast based on its schema type before being set during document creation.</p> <h4 id="example-1"> <a href="#example-1"> Example: </a> </h4> <pre data-language="javascript"><span class="hljs-comment">// values are cast:</span>
<span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">aNumber</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>, <span class="hljs-attr">default</span>: <span class="hljs-number">4.815162342</span> }})
<span class="hljs-keyword">const</span> M = db.<span class="hljs-title function_">model</span>(<span class="hljs-string">'M'</span>, schema)
<span class="hljs-keyword">const</span> m = <span class="hljs-keyword">new</span> M;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(m.<span class="hljs-property">aNumber</span>) <span class="hljs-comment">// 4.815162342</span>

<span class="hljs-comment">// default unique objects for Mixed types:</span>
<span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">mixed</span>: <span class="hljs-title class_">Schema</span>.<span class="hljs-property">Types</span>.<span class="hljs-property">Mixed</span> });
schema.<span class="hljs-title function_">path</span>(<span class="hljs-string">'mixed'</span>).<span class="hljs-title function_">default</span>(<span class="hljs-keyword">function</span> () {
  <span class="hljs-keyword">return</span> {};
});

<span class="hljs-comment">// if we don't use a function to return object literals for Mixed defaults,</span>
<span class="hljs-comment">// each document will receive a reference to the same object literal creating</span>
<span class="hljs-comment">// a "shared" object instance:</span>
<span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">mixed</span>: <span class="hljs-title class_">Schema</span>.<span class="hljs-property">Types</span>.<span class="hljs-property">Mixed</span> });
schema.<span class="hljs-title function_">path</span>(<span class="hljs-string">'mixed'</span>).<span class="hljs-title function_">default</span>({});
<span class="hljs-keyword">const</span> M = db.<span class="hljs-title function_">model</span>(<span class="hljs-string">'M'</span>, schema);
<span class="hljs-keyword">const</span> m1 = <span class="hljs-keyword">new</span> M;
m1.<span class="hljs-property">mixed</span>.<span class="hljs-property">added</span> = <span class="hljs-number">1</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(m1.<span class="hljs-property">mixed</span>); <span class="hljs-comment">// { added: 1 }</span>
<span class="hljs-keyword">const</span> m2 = <span class="hljs-keyword">new</span> M;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(m2.<span class="hljs-property">mixed</span>); <span class="hljs-comment">// { added: 1 }</span>
</pre> </div>
<h3 id="SchemaType.prototype.doValidate()">SchemaType.prototype.doValidate()</h3>
<h5>Parameters:</h5>
<ul class="params">
<li class="param">
<code>value</code> <span class="method-type">«Any»</span> </li>
<li class="param">
<code>callback</code> <span class="method-type">«Function»</span> </li>
<li class="param">
<code>scope</code> <span class="method-type">«Object»</span> </li>
<li class="param">
<code>[options]</code> <span class="method-type">«Object»</span> </li>
<ul style="margin-top: 0.5em"><li>
<code>[options.path]</code> <span class="method-type">«String»</span> </li></ul>
</ul>
<h5>Returns:</h5>
<ul><li>
<span class="method-type">«Any»</span> If no validators, returns the output from calling <code>fn</code>, otherwise no return</li></ul>
<div>
<p>Performs a validation of <code>value</code> using the validators declared for this SchemaType.</p> </div>
<h3 id="SchemaType.prototype.get()">SchemaType.prototype.get()</h3>
<h5>Parameters:</h5>
<ul class="params"><li class="param">
<code>fn</code> <span class="method-type">«Function»</span> </li></ul>
<h5>Returns:</h5>
<ul><li>
<span class="method-type">«SchemaType»</span> this</li></ul>
<div>
<p>Adds a getter to this schematype.</p> <h4 id="example"> <a href="#example"> Example: </a> </h4> <pre data-language="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">dob</span> (val) {
  <span class="hljs-keyword">if</span> (!val) <span class="hljs-keyword">return</span> val;
  <span class="hljs-keyword">return</span> (val.<span class="hljs-title function_">getMonth</span>() + <span class="hljs-number">1</span>) + <span class="hljs-string">"/"</span> + val.<span class="hljs-title function_">getDate</span>() + <span class="hljs-string">"/"</span> + val.<span class="hljs-title function_">getFullYear</span>();
}

<span class="hljs-comment">// defining within the schema</span>
<span class="hljs-keyword">const</span> s = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">born</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Date</span>, <span class="hljs-attr">get</span>: dob })

<span class="hljs-comment">// or by retreiving its SchemaType</span>
<span class="hljs-keyword">const</span> s = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">born</span>: <span class="hljs-title class_">Date</span> })
s.<span class="hljs-title function_">path</span>(<span class="hljs-string">'born'</span>).<span class="hljs-title function_">get</span>(dob)
</pre> <p>Getters allow you to transform the representation of the data as it travels from the raw mongodb document to the value that you see.</p> <p>Suppose you are storing credit card numbers and you want to hide everything except the last 4 digits to the mongoose user. You can do so by defining a getter in the following way:</p> <pre data-language="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">obfuscate</span> (cc) {
  <span class="hljs-keyword">return</span> <span class="hljs-string">'****-****-****-'</span> + cc.<span class="hljs-title function_">slice</span>(cc.<span class="hljs-property">length</span>-<span class="hljs-number">4</span>, cc.<span class="hljs-property">length</span>);
}

<span class="hljs-keyword">const</span> <span class="hljs-title class_">AccountSchema</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({
  <span class="hljs-attr">creditCardNumber</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">get</span>: obfuscate }
});

<span class="hljs-keyword">const</span> <span class="hljs-title class_">Account</span> = db.<span class="hljs-title function_">model</span>(<span class="hljs-string">'Account'</span>, <span class="hljs-title class_">AccountSchema</span>);

<span class="hljs-title class_">Account</span>.<span class="hljs-title function_">findById</span>(id, <span class="hljs-keyword">function</span> (<span class="hljs-params">err, found</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(found.<span class="hljs-property">creditCardNumber</span>); <span class="hljs-comment">// '****-****-****-1234'</span>
});
</pre> <p>Getters are also passed a second argument, the schematype on which the getter was defined. This allows for tailored behavior based on options passed in the schema.</p> <pre data-language="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">inspector</span> (val, priorValue, schematype) {
  <span class="hljs-keyword">if</span> (schematype.<span class="hljs-property">options</span>.<span class="hljs-property">required</span>) {
    <span class="hljs-keyword">return</span> schematype.<span class="hljs-property">path</span> + <span class="hljs-string">' is required'</span>;
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">return</span> schematype.<span class="hljs-property">path</span> + <span class="hljs-string">' is not'</span>;
  }
}

<span class="hljs-keyword">const</span> <span class="hljs-title class_">VirusSchema</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({
  <span class="hljs-attr">name</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">get</span>: inspector },
  <span class="hljs-attr">taxonomy</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">get</span>: inspector }
})

<span class="hljs-keyword">const</span> <span class="hljs-title class_">Virus</span> = db.<span class="hljs-title function_">model</span>(<span class="hljs-string">'Virus'</span>, <span class="hljs-title class_">VirusSchema</span>);

<span class="hljs-title class_">Virus</span>.<span class="hljs-title function_">findById</span>(id, <span class="hljs-keyword">function</span> (<span class="hljs-params">err, virus</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(virus.<span class="hljs-property">name</span>);     <span class="hljs-comment">// name is required</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(virus.<span class="hljs-property">taxonomy</span>); <span class="hljs-comment">// taxonomy is not</span>
})
</pre> </div>
<h3 id="SchemaType.prototype.immutable()">SchemaType.prototype.immutable()</h3>
<h5>Parameters:</h5>
<ul class="params"><li class="param">
<code>bool</code> <span class="method-type">«Boolean»</span> </li></ul>
<h5>Returns:</h5>
<ul><li>
<span class="method-type">«SchemaType»</span> this</li></ul>
<h5>See:</h5>
<ul><li><span class="method-type"><a href="document.html#Document.prototype.isNew()">isNew</a></span></li></ul>
<div>
<p>Defines this path as immutable. Mongoose prevents you from changing immutable paths unless the parent document has <a href="document.html#Document.prototype.isNew()"><code>isNew: true</code></a>.</p> <h4 id="example"> <a href="#example"> Example: </a> </h4> <pre data-language="javascript"><span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({
  <span class="hljs-attr">name</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">immutable</span>: <span class="hljs-literal">true</span> },
  <span class="hljs-attr">age</span>: <span class="hljs-title class_">Number</span>
});
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Model</span> = mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">'Test'</span>, schema);

<span class="hljs-keyword">await</span> <span class="hljs-title class_">Model</span>.<span class="hljs-title function_">create</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'test'</span> });
<span class="hljs-keyword">const</span> doc = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Model</span>.<span class="hljs-title function_">findOne</span>();

doc.<span class="hljs-property">isNew</span>; <span class="hljs-comment">// false</span>
doc.<span class="hljs-property">name</span> = <span class="hljs-string">'new name'</span>;
doc.<span class="hljs-property">name</span>; <span class="hljs-comment">// 'test', because `name` is immutable</span>
</pre> <p>Mongoose also prevents changing immutable properties using <code>updateOne()</code> and <code>updateMany()</code> based on <a href="../guide.html#strict">strict mode</a>.</p> <h4 id="example-1"> <a href="#example-1"> Example: </a> </h4> <pre data-language="javascript"><span class="hljs-comment">// Mongoose will strip out the `name` update, because `name` is immutable</span>
<span class="hljs-title class_">Model</span>.<span class="hljs-title function_">updateOne</span>({}, { <span class="hljs-attr">$set</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">'test2'</span> }, <span class="hljs-attr">$inc</span>: { <span class="hljs-attr">age</span>: <span class="hljs-number">1</span> } });

<span class="hljs-comment">// If `strict` is set to 'throw', Mongoose will throw an error if you</span>
<span class="hljs-comment">// update `name`</span>
<span class="hljs-keyword">const</span> err = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Model</span>.<span class="hljs-title function_">updateOne</span>({}, { <span class="hljs-attr">name</span>: <span class="hljs-string">'test2'</span> }, { <span class="hljs-attr">strict</span>: <span class="hljs-string">'throw'</span> }).
  <span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-literal">null</span>, <span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> err);
err.<span class="hljs-property">name</span>; <span class="hljs-comment">// StrictModeError</span>

<span class="hljs-comment">// If `strict` is `false`, Mongoose allows updating `name` even though</span>
<span class="hljs-comment">// the property is immutable.</span>
<span class="hljs-title class_">Model</span>.<span class="hljs-title function_">updateOne</span>({}, { <span class="hljs-attr">name</span>: <span class="hljs-string">'test2'</span> }, { <span class="hljs-attr">strict</span>: <span class="hljs-literal">false</span> });
</pre> </div>
<h3 id="SchemaType.prototype.index()">SchemaType.prototype.index()</h3>
<h5>Parameters:</h5>
<ul class="params"><li class="param">
<code>options</code> <span class="method-type">«Object|Boolean|String|Number»</span> </li></ul>
<h5>Returns:</h5>
<ul><li>
<span class="method-type">«SchemaType»</span> this</li></ul>
<div>
<p>Declares the index options for this schematype.</p> <h4 id="example"> <a href="#example"> Example: </a> </h4> <pre data-language="javascript"><span class="hljs-keyword">const</span> s = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">index</span>: <span class="hljs-literal">true</span> })
<span class="hljs-keyword">const</span> s = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">index</span>: -<span class="hljs-number">1</span> })
<span class="hljs-keyword">const</span> s = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">loc</span>: { <span class="hljs-attr">type</span>: [<span class="hljs-title class_">Number</span>], <span class="hljs-attr">index</span>: <span class="hljs-string">'hashed'</span> })
<span class="hljs-keyword">const</span> s = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">loc</span>: { <span class="hljs-attr">type</span>: [<span class="hljs-title class_">Number</span>], <span class="hljs-attr">index</span>: <span class="hljs-string">'2d'</span>, <span class="hljs-attr">sparse</span>: <span class="hljs-literal">true</span> })
<span class="hljs-keyword">const</span> s = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">loc</span>: { <span class="hljs-attr">type</span>: [<span class="hljs-title class_">Number</span>], <span class="hljs-attr">index</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">'2dsphere'</span>, <span class="hljs-attr">sparse</span>: <span class="hljs-literal">true</span> }})
<span class="hljs-keyword">const</span> s = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">date</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Date</span>, <span class="hljs-attr">index</span>: { <span class="hljs-attr">unique</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">expires</span>: <span class="hljs-string">'1d'</span> }})
s.<span class="hljs-title function_">path</span>(<span class="hljs-string">'my.path'</span>).<span class="hljs-title function_">index</span>(<span class="hljs-literal">true</span>);
s.<span class="hljs-title function_">path</span>(<span class="hljs-string">'my.date'</span>).<span class="hljs-title function_">index</span>({ <span class="hljs-attr">expires</span>: <span class="hljs-number">60</span> });
s.<span class="hljs-title function_">path</span>(<span class="hljs-string">'my.path'</span>).<span class="hljs-title function_">index</span>({ <span class="hljs-attr">unique</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">sparse</span>: <span class="hljs-literal">true</span> });
</pre> <h4 id="note"> <a href="#note"> Note: </a> </h4> <p><em>Indexes are created <a href="https://www.mongodb.com/docs/manual/core/index-creation/#index-creation-background">in the background</a> by default. If <code>background</code> is set to <code>false</code>, MongoDB will not execute any read/write operations you send until the index build. Specify <code>background: false</code> to override Mongoose's default.</em></p> </div>
<h3 id="SchemaType.prototype.isRequired">SchemaType.prototype.isRequired</h3>
<h5>Type:</h5>
<ul><li><span class="method-type">«property»</span></li></ul>
<div>
<p>True if this SchemaType has a required validator. False otherwise.</p> <h4 id="example"> <a href="#example"> Example: </a> </h4> <pre data-language="javascript"><span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span> } });
schema.<span class="hljs-title function_">path</span>(<span class="hljs-string">'name'</span>).<span class="hljs-property">isRequired</span>; <span class="hljs-comment">// true</span>

schema.<span class="hljs-title function_">path</span>(<span class="hljs-string">'name'</span>).required(<span class="hljs-literal">false</span>);
schema.<span class="hljs-title function_">path</span>(<span class="hljs-string">'name'</span>).<span class="hljs-property">isRequired</span>; <span class="hljs-comment">// false</span>
</pre> </div>
<h3 id="SchemaType.prototype.path">SchemaType.prototype.path</h3>
<h5>Type:</h5>
<ul><li><span class="method-type">«property»</span></li></ul>
<div>
<p>The path to this SchemaType in a Schema.</p> <h4 id="example"> <a href="#example"> Example: </a> </h4> <pre data-language="javascript"><span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span> });
schema.<span class="hljs-title function_">path</span>(<span class="hljs-string">'name'</span>).<span class="hljs-property">path</span>; <span class="hljs-comment">// 'name'</span>
</pre> </div>
<h3 id="SchemaType.prototype.ref()">SchemaType.prototype.ref()</h3>
<h5>Parameters:</h5>
<ul class="params"><li class="param">
<code>ref</code> <span class="method-type">«String|Model|Function»</span> either a model name, a <a href="../models.html">Model</a>, or a function that returns a model name or model. </li></ul>
<h5>Returns:</h5>
<ul><li>
<span class="method-type">«SchemaType»</span> this</li></ul>
<div>
<p>Set the model that this path refers to. This is the option that <a href="../populate.html">populate</a> looks at to determine the foreign collection it should query.</p> <h4 id="example"> <a href="#example"> Example: </a> </h4> <pre data-language="javascript"><span class="hljs-keyword">const</span> userSchema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span> });
<span class="hljs-keyword">const</span> <span class="hljs-title class_">User</span> = mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">'User'</span>, userSchema);

<span class="hljs-keyword">const</span> postSchema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">user</span>: mongoose.<span class="hljs-property">ObjectId</span> });
postSchema.<span class="hljs-title function_">path</span>(<span class="hljs-string">'user'</span>).<span class="hljs-title function_">ref</span>(<span class="hljs-string">'User'</span>); <span class="hljs-comment">// Can set ref to a model name</span>
postSchema.<span class="hljs-title function_">path</span>(<span class="hljs-string">'user'</span>).<span class="hljs-title function_">ref</span>(<span class="hljs-title class_">User</span>); <span class="hljs-comment">// Or a model class</span>
postSchema.<span class="hljs-title function_">path</span>(<span class="hljs-string">'user'</span>).<span class="hljs-title function_">ref</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-string">'User'</span>); <span class="hljs-comment">// Or a function that returns the model name</span>
postSchema.<span class="hljs-title function_">path</span>(<span class="hljs-string">'user'</span>).<span class="hljs-title function_">ref</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">User</span>); <span class="hljs-comment">// Or a function that returns the model class</span>

<span class="hljs-comment">// Or you can just declare the `ref` inline in your schema</span>
<span class="hljs-keyword">const</span> postSchema2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({
  <span class="hljs-attr">user</span>: { <span class="hljs-attr">type</span>: mongoose.<span class="hljs-property">ObjectId</span>, <span class="hljs-attr">ref</span>: <span class="hljs-title class_">User</span> }
});
</pre> </div>
<h3 id="SchemaType.prototype.required()">SchemaType.prototype.required()</h3>
<h5>Parameters:</h5>
<ul class="params">
<li class="param">
<code>required</code> <span class="method-type">«Boolean|Function|Object»</span> enable/disable the validator, or function that returns required boolean, or options object </li>
<ul style="margin-top: 0.5em"><li>
<code>[options.isRequired]</code> <span class="method-type">«Boolean|Function»</span> enable/disable the validator, or function that returns required boolean </li></ul>
<ul style="margin-top: 0.5em"><li>
<code>[options.ErrorConstructor]</code> <span class="method-type">«Function»</span> custom error constructor. The constructor receives 1 parameter, an object containing the validator properties. </li></ul>
<li class="param">
<code>[message]</code> <span class="method-type">«String»</span> optional custom error message </li>
</ul>
<h5>Returns:</h5>
<ul><li>
<span class="method-type">«SchemaType»</span> this</li></ul>
<h5>See:</h5>
<ul>
<li><span class="method-type"><a href="error.html#Error.messages">Customized Error Messages</a></span></li>
<li><span class="method-type"><a href="schemaarray.html#SchemaArray.prototype.checkRequired()">SchemaArray#checkRequired</a></span></li>
<li><span class="method-type"><a href="schemaboolean.html#SchemaBoolean.prototype.checkRequired()">SchemaBoolean#checkRequired</a></span></li>
<li><span class="method-type"><a href="schemabuffer.html#SchemaBuffer.prototype.checkRequired()">SchemaBuffer#checkRequired</a></span></li>
<li><span class="method-type"><a href="schemanumber.html#SchemaNumber.prototype.checkRequired()">SchemaNumber#checkRequired</a></span></li>
<li><span class="method-type"><a href="schemaobjectid.html#ObjectId.prototype.checkRequired()">SchemaObjectId#checkRequired</a></span></li>
<li><span class="method-type"><a href="schemastring.html#SchemaString.prototype.checkRequired()">SchemaString#checkRequired</a></span></li>
</ul>
<div>
<p>Adds a required validator to this SchemaType. The validator gets added to the front of this SchemaType's validators array using <code>unshift()</code>.</p> <h4 id="example"> <a href="#example"> Example: </a> </h4> <pre data-language="javascript"><span class="hljs-keyword">const</span> s = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">born</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Date</span>, <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span> })

<span class="hljs-comment">// or with custom error message</span>

<span class="hljs-keyword">const</span> s = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">born</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Date</span>, <span class="hljs-attr">required</span>: <span class="hljs-string">'{PATH} is required!'</span> })

<span class="hljs-comment">// or with a function</span>

<span class="hljs-keyword">const</span> s = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({
  <span class="hljs-attr">userId</span>: <span class="hljs-title class_">ObjectId</span>,
  <span class="hljs-attr">username</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>,
    <span class="hljs-attr">required</span>: <span class="hljs-keyword">function</span>() { <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">userId</span> != <span class="hljs-literal">null</span>; }
  }
})

<span class="hljs-comment">// or with a function and a custom message</span>
<span class="hljs-keyword">const</span> s = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({
  <span class="hljs-attr">userId</span>: <span class="hljs-title class_">ObjectId</span>,
  <span class="hljs-attr">username</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>,
    <span class="hljs-attr">required</span>: [
      <span class="hljs-keyword">function</span>() { <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">userId</span> != <span class="hljs-literal">null</span>; },
      <span class="hljs-string">'username is required if id is specified'</span>
    ]
  }
})

<span class="hljs-comment">// or through the path API</span>

s.<span class="hljs-title function_">path</span>(<span class="hljs-string">'name'</span>).required(<span class="hljs-literal">true</span>);

<span class="hljs-comment">// with custom error messaging</span>

s.<span class="hljs-title function_">path</span>(<span class="hljs-string">'name'</span>).required(<span class="hljs-literal">true</span>, <span class="hljs-string">'grrr :( '</span>);

<span class="hljs-comment">// or make a path conditionally required based on a function</span>
<span class="hljs-keyword">const</span> isOver18 = <span class="hljs-keyword">function</span>() { <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> &gt;= <span class="hljs-number">18</span>; };
s.<span class="hljs-title function_">path</span>(<span class="hljs-string">'voterRegistrationId'</span>).required(isOver18);
</pre> <p>The required validator uses the SchemaType's <code>checkRequired</code> function to determine whether a given value satisfies the required validator. By default, a value satisfies the required validator if <code>val != null</code> (that is, if the value is not null nor undefined). However, most built-in mongoose schema types override the default <code>checkRequired</code> function:</p> </div>
<h3 id="SchemaType.prototype.select()">SchemaType.prototype.select()</h3>
<h5>Parameters:</h5>
<ul class="params"><li class="param">
<code>val</code> <span class="method-type">«Boolean»</span> </li></ul>
<h5>Returns:</h5>
<ul><li>
<span class="method-type">«SchemaType»</span> this</li></ul>
<div>
<p>Sets default <code>select()</code> behavior for this path.</p> <p>Set to <code>true</code> if this path should always be included in the results, <code>false</code> if it should be excluded by default. This setting can be overridden at the query level.</p> <h4 id="example"> <a href="#example"> Example: </a> </h4> <pre data-language="javascript">T = db.<span class="hljs-title function_">model</span>(<span class="hljs-string">'T'</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">x</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">select</span>: <span class="hljs-literal">true</span> }}));
T.<span class="hljs-title function_">find</span>(..); <span class="hljs-comment">// field x will always be selected ..</span>
<span class="hljs-comment">// .. unless overridden;</span>
T.<span class="hljs-title function_">find</span>().<span class="hljs-title function_">select</span>(<span class="hljs-string">'-x'</span>).<span class="hljs-title function_">exec</span>(callback);
</pre> </div>
<h3 id="SchemaType.prototype.set()">SchemaType.prototype.set()</h3>
<h5>Parameters:</h5>
<ul class="params"><li class="param">
<code>fn</code> <span class="method-type">«Function»</span> </li></ul>
<h5>Returns:</h5>
<ul><li>
<span class="method-type">«SchemaType»</span> this</li></ul>
<div>
<p>Adds a setter to this schematype.</p> <h4 id="example"> <a href="#example"> Example: </a> </h4> <pre data-language="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">capitalize</span> (val) {
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> val !== <span class="hljs-string">'string'</span>) val = <span class="hljs-string">''</span>;
  <span class="hljs-keyword">return</span> val.<span class="hljs-title function_">charAt</span>(<span class="hljs-number">0</span>).<span class="hljs-title function_">toUpperCase</span>() + val.<span class="hljs-title function_">substring</span>(<span class="hljs-number">1</span>);
}

<span class="hljs-comment">// defining within the schema</span>
<span class="hljs-keyword">const</span> s = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">set</span>: capitalize }});

<span class="hljs-comment">// or with the SchemaType</span>
<span class="hljs-keyword">const</span> s = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span> })
s.<span class="hljs-title function_">path</span>(<span class="hljs-string">'name'</span>).<span class="hljs-title function_">set</span>(capitalize);
</pre> <p>Setters allow you to transform the data before it gets to the raw mongodb document or query.</p> <p>Suppose you are implementing user registration for a website. Users provide an email and password, which gets saved to mongodb. The email is a string that you will want to normalize to lower case, in order to avoid one email having more than one account -- e.g., otherwise, <a href="mailto:avenue@q.com.html">avenue@q.com</a> can be registered for 2 accounts via <a href="mailto:avenue@q.com.html">avenue@q.com</a> and <a href="mailto:AvEnUe@Q.CoM.html">AvEnUe@Q.CoM</a>.</p> <p>You can set up email lower case normalization easily via a Mongoose setter.</p> <pre data-language="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">toLower</span>(<span class="hljs-params">v</span>) {
  <span class="hljs-keyword">return</span> v.<span class="hljs-title function_">toLowerCase</span>();
}

<span class="hljs-keyword">const</span> <span class="hljs-title class_">UserSchema</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({
  <span class="hljs-attr">email</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">set</span>: toLower }
});

<span class="hljs-keyword">const</span> <span class="hljs-title class_">User</span> = db.<span class="hljs-title function_">model</span>(<span class="hljs-string">'User'</span>, <span class="hljs-title class_">UserSchema</span>);

<span class="hljs-keyword">const</span> user = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>({<span class="hljs-attr">email</span>: <span class="hljs-string">'AVENUE@Q.COM'</span>});
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(user.<span class="hljs-property">email</span>); <span class="hljs-comment">// 'avenue@q.com'</span>

<span class="hljs-comment">// or</span>
<span class="hljs-keyword">const</span> user = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();
user.<span class="hljs-property">email</span> = <span class="hljs-string">'Avenue@Q.com'</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(user.<span class="hljs-property">email</span>); <span class="hljs-comment">// 'avenue@q.com'</span>
<span class="hljs-title class_">User</span>.<span class="hljs-title function_">updateOne</span>({ <span class="hljs-attr">_id</span>: _id }, { <span class="hljs-attr">$set</span>: { <span class="hljs-attr">email</span>: <span class="hljs-string">'AVENUE@Q.COM'</span> } }); <span class="hljs-comment">// update to 'avenue@q.com'</span>
</pre> <p>As you can see above, setters allow you to transform the data before it stored in MongoDB, or before executing a query.</p> <p><em>NOTE: we could have also just used the built-in <code>lowercase: true</code> SchemaType option instead of defining our own function.</em></p> <pre data-language="javascript"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">email</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">lowercase</span>: <span class="hljs-literal">true</span> }})
</pre> <p>Setters are also passed a second argument, the schematype on which the setter was defined. This allows for tailored behavior based on options passed in the schema.</p> <pre data-language="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">inspector</span> (val, priorValue, schematype) {
  <span class="hljs-keyword">if</span> (schematype.<span class="hljs-property">options</span>.<span class="hljs-property">required</span>) {
    <span class="hljs-keyword">return</span> schematype.<span class="hljs-property">path</span> + <span class="hljs-string">' is required'</span>;
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">return</span> val;
  }
}

<span class="hljs-keyword">const</span> <span class="hljs-title class_">VirusSchema</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({
  <span class="hljs-attr">name</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">set</span>: inspector },
  <span class="hljs-attr">taxonomy</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">set</span>: inspector }
})

<span class="hljs-keyword">const</span> <span class="hljs-title class_">Virus</span> = db.<span class="hljs-title function_">model</span>(<span class="hljs-string">'Virus'</span>, <span class="hljs-title class_">VirusSchema</span>);
<span class="hljs-keyword">const</span> v = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Virus</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'Parvoviridae'</span>, <span class="hljs-attr">taxonomy</span>: <span class="hljs-string">'Parvovirinae'</span> });

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(v.<span class="hljs-property">name</span>);     <span class="hljs-comment">// name is required</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(v.<span class="hljs-property">taxonomy</span>); <span class="hljs-comment">// Parvovirinae</span>
</pre> <p>You can also use setters to modify other properties on the document. If you're setting a property <code>name</code> on a document, the setter will run with <code>this</code> as the document. Be careful, in mongoose 5 setters will also run when querying by <code>name</code> with <code>this</code> as the query.</p> <pre data-language="javascript"><span class="hljs-keyword">const</span> nameSchema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">keywords</span>: [<span class="hljs-title class_">String</span>] });
nameSchema.<span class="hljs-title function_">path</span>(<span class="hljs-string">'name'</span>).<span class="hljs-title function_">set</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">v</span>) {
  <span class="hljs-comment">// Need to check if `this` is a document, because in mongoose 5</span>
  <span class="hljs-comment">// setters will also run on queries, in which case `this` will be a</span>
  <span class="hljs-comment">// mongoose query object.</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Document</span> &amp;&amp; v != <span class="hljs-literal">null</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">keywords</span> = v.<span class="hljs-title function_">split</span>(<span class="hljs-string">' '</span>);
  }
  <span class="hljs-keyword">return</span> v;
});
</pre> </div>
<h3 id="SchemaType.prototype.sparse()">SchemaType.prototype.sparse()</h3>
<h5>Parameters:</h5>
<ul class="params"><li class="param">
<code>bool</code> <span class="method-type">«Boolean»</span> </li></ul>
<h5>Returns:</h5>
<ul><li>
<span class="method-type">«SchemaType»</span> this</li></ul>
<div>
<p>Declares a sparse index.</p> <h4 id="example"> <a href="#example"> Example: </a> </h4> <pre data-language="javascript"><span class="hljs-keyword">const</span> s = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">sparse</span>: <span class="hljs-literal">true</span> } });
s.<span class="hljs-title function_">path</span>(<span class="hljs-string">'name'</span>).<span class="hljs-title function_">index</span>({ <span class="hljs-attr">sparse</span>: <span class="hljs-literal">true</span> });
</pre> </div>
<h3 id="SchemaType.prototype.text()">SchemaType.prototype.text()</h3>
<h5>Parameters:</h5>
<ul class="params"><li class="param">
<code>bool</code> <span class="method-type">«Boolean»</span> </li></ul>
<h5>Returns:</h5>
<ul><li>
<span class="method-type">«SchemaType»</span> this</li></ul>
<div>
<p>Declares a full text index.</p> <h3 id="example">  Example:  </h3> <pre data-language="javascript"> <span class="hljs-keyword">const</span> s = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ name : { <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>, text : <span class="hljs-literal">true</span> } })
 s.<span class="hljs-title function_">path</span>(<span class="hljs-string">'name'</span>).<span class="hljs-title function_">index</span>({ text : <span class="hljs-literal">true</span> });
</pre> </div>
<h3 id="SchemaType.prototype.transform()">SchemaType.prototype.transform()</h3>
<h5>Parameters:</h5>
<ul class="params"><li class="param">
<code>fn</code> <span class="method-type">«Function»</span> </li></ul>
<h5>Returns:</h5>
<ul><li>
<span class="method-type">«SchemaType»</span> this</li></ul>
<div>
<p>Defines a custom function for transforming this path when converting a document to JSON.</p> <p>Mongoose calls this function with one parameter: the current <code>value</code> of the path. Mongoose then uses the return value in the JSON output.</p> <h4 id="example"> <a href="#example"> Example: </a> </h4> <pre data-language="javascript"><span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({
  <span class="hljs-attr">date</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Date</span>, <span class="hljs-attr">transform</span>: <span class="hljs-function"><span class="hljs-params">v</span> =&gt;</span> v.<span class="hljs-title function_">getFullYear</span>() }
});
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Model</span> = mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">'Test'</span>, schema);

<span class="hljs-keyword">await</span> <span class="hljs-title class_">Model</span>.<span class="hljs-title function_">create</span>({ <span class="hljs-attr">date</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'2016-06-01'</span>) });
<span class="hljs-keyword">const</span> doc = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Model</span>.<span class="hljs-title function_">findOne</span>();

doc.<span class="hljs-property">date</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Date</span>; <span class="hljs-comment">// true</span>

doc.<span class="hljs-title function_">toJSON</span>().<span class="hljs-property">date</span>; <span class="hljs-comment">// 2016 as a number</span>
<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(doc); <span class="hljs-comment">// '{"_id":...,"date":2016}'</span>
</pre> </div>
<h3 id="SchemaType.prototype.unique()">SchemaType.prototype.unique()</h3>
<h5>Parameters:</h5>
<ul class="params"><li class="param">
<code>bool</code> <span class="method-type">«Boolean»</span> </li></ul>
<h5>Returns:</h5>
<ul><li>
<span class="method-type">«SchemaType»</span> this</li></ul>
<div>
<p>Declares an unique index.</p> <h4 id="example"> <a href="#example"> Example: </a> </h4> <pre data-language="javascript"><span class="hljs-keyword">const</span> s = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">unique</span>: <span class="hljs-literal">true</span> } });
s.<span class="hljs-title function_">path</span>(<span class="hljs-string">'name'</span>).<span class="hljs-title function_">index</span>({ <span class="hljs-attr">unique</span>: <span class="hljs-literal">true</span> });
</pre> <p><em>NOTE: violating the constraint returns an <code>E11000</code> error from MongoDB when saving, not a Mongoose validation error.</em></p> </div>
<h3 id="SchemaType.prototype.validate()">SchemaType.prototype.validate()</h3>
<h5>Parameters:</h5>
<ul class="params">
<li class="param">
<code>obj</code> <span class="method-type">«RegExp|Function|Object»</span> validator function, or hash describing options </li>
<ul style="margin-top: 0.5em"><li>
<code>[obj.validator]</code> <span class="method-type">«Function»</span> validator function. If the validator function returns <code>undefined</code> or a truthy value, validation succeeds. If it returns <a href="https://masteringjs.io/tutorials/fundamentals/falsy">falsy</a> (except <code>undefined</code>) or throws an error, validation fails. </li></ul>
<ul style="margin-top: 0.5em"><li>
<code>[obj.message]</code> <span class="method-type">«String|Function»</span> optional error message. If function, should return the error message as a string </li></ul>
<ul style="margin-top: 0.5em"><li>
<code>[obj.propsParameter=false]</code> <span class="method-type">«Boolean»</span> If true, Mongoose will pass the validator properties object (with the <code>validator</code> function, <code>message</code>, etc.) as the 2nd arg to the validator function. This is disabled by default because many validators <a href="https://github.com/chriso/validator.js#validators">rely on positional args</a>, so turning this on may cause unpredictable behavior in external validators. </li></ul>
<li class="param">
<code>[errorMsg]</code> <span class="method-type">«String|Function»</span> optional error message. If function, should return the error message as a string </li>
<li class="param">
<code>[type]</code> <span class="method-type">«String»</span> optional validator type </li>
</ul>
<h5>Returns:</h5>
<ul><li>
<span class="method-type">«SchemaType»</span> this</li></ul>
<div>
<p>Adds validator(s) for this document path.</p> <p>Validators always receive the value to validate as their first argument and must return <code>Boolean</code>. Returning <code>false</code> or throwing an error means validation failed.</p> <p>The error message argument is optional. If not passed, the <a href="error.html#Error.messages">default generic error message template</a> will be used.</p> <h4 id="example"> <a href="#example"> Example: </a> </h4> <pre data-language="javascript"><span class="hljs-comment">// make sure every value is equal to "something"</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">validator</span> (val) {
  <span class="hljs-keyword">return</span> val === <span class="hljs-string">'something'</span>;
}
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">validate</span>: validator }});

<span class="hljs-comment">// with a custom error message</span>

<span class="hljs-keyword">const</span> custom = [validator, <span class="hljs-string">'Uh oh, {PATH} does not equal "something".'</span>]
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">validate</span>: custom }});

<span class="hljs-comment">// adding many validators at a time</span>

<span class="hljs-keyword">const</span> many = [
    { <span class="hljs-attr">validator</span>: validator, <span class="hljs-attr">message</span>: <span class="hljs-string">'uh oh'</span> }
  , { <span class="hljs-attr">validator</span>: anotherValidator, <span class="hljs-attr">message</span>: <span class="hljs-string">'failed'</span> }
]
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">validate</span>: many }});

<span class="hljs-comment">// or utilizing SchemaType methods directly:</span>

<span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'string'</span> });
schema.<span class="hljs-title function_">path</span>(<span class="hljs-string">'name'</span>).<span class="hljs-title function_">validate</span>(validator, <span class="hljs-string">'validation of `{PATH}` failed with value `{VALUE}`'</span>);
</pre> <h4 id="error-message-templates"> <a href="#error-message-templates"> Error message templates: </a> </h4> <p>Below is a list of supported template keywords:</p> <ul> <li>PATH: The schema path where the error is being triggered.</li> <li>VALUE: The value assigned to the PATH that is triggering the error.</li> <li>KIND: The validation property that triggered the error i.e. required.</li> <li>REASON: The error object that caused this error if there was one.</li> </ul> <p>If Mongoose's built-in error message templating isn't enough, Mongoose supports setting the <code>message</code> property to a function.</p> <pre data-language="javascript">schema.<span class="hljs-title function_">path</span>(<span class="hljs-string">'name'</span>).<span class="hljs-title function_">validate</span>({
  <span class="hljs-attr">validator</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">v</span>) { <span class="hljs-keyword">return</span> v.<span class="hljs-property">length</span> &gt; <span class="hljs-number">5</span>; },
  <span class="hljs-comment">// `errors['name']` will be "name must have length 5, got 'foo'"</span>
  <span class="hljs-attr">message</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">props</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${props.path}</span> must have length 5, got '<span class="hljs-subst">${props.value}</span>'`</span>;
  }
});
</pre> <p>To bypass Mongoose's error messages and just copy the error message that the validator throws, do this:</p> <pre data-language="javascript">schema.<span class="hljs-title function_">path</span>(<span class="hljs-string">'name'</span>).<span class="hljs-title function_">validate</span>({
  <span class="hljs-attr">validator</span>: <span class="hljs-keyword">function</span>() { <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Oops!'</span>); },
  <span class="hljs-comment">// `errors['name']` will be "Oops!"</span>
  <span class="hljs-attr">message</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">props</span>) { <span class="hljs-keyword">return</span> props.<span class="hljs-property">reason</span>.<span class="hljs-property">message</span>; }
});
</pre> <h4 id="asynchronous-validation"> <a href="#asynchronous-validation"> Asynchronous validation: </a> </h4> <p>Mongoose supports validators that return a promise. A validator that returns a promise is called an <em>async validator</em>. Async validators run in parallel, and <code>validate()</code> will wait until all async validators have settled.</p> <pre data-language="javascript">schema.<span class="hljs-title function_">path</span>(<span class="hljs-string">'name'</span>).<span class="hljs-title function_">validate</span>({
  <span class="hljs-attr">validator</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">value</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">resolve, reject</span>) {
      <span class="hljs-title function_">resolve</span>(<span class="hljs-literal">false</span>); <span class="hljs-comment">// validation failed</span>
    });
  }
});
</pre> <p>You might use asynchronous validators to retreive other documents from the database to validate against or to meet other I/O bound validation needs.</p> <p>Validation occurs <code>pre('save')</code> or whenever you manually execute <a href="document.html#Document.prototype.validate()">document#validate</a>.</p> <p>If validation fails during <code>pre('save')</code> and no callback was passed to receive the error, an <code>error</code> event will be emitted on your Models associated db <a href="connection.html#Connection()">connection</a>, passing the validation error object along.</p> <pre data-language="javascript"><span class="hljs-keyword">const</span> conn = mongoose.<span class="hljs-title function_">createConnection</span>(..);
conn.<span class="hljs-title function_">on</span>(<span class="hljs-string">'error'</span>, handleError);

<span class="hljs-keyword">const</span> <span class="hljs-title class_">Product</span> = conn.<span class="hljs-title function_">model</span>(<span class="hljs-string">'Product'</span>, yourSchema);
<span class="hljs-keyword">const</span> dvd = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Product</span>(..);
dvd.<span class="hljs-title function_">save</span>(); <span class="hljs-comment">// emits error on the `conn` above</span>
</pre> <p>If you want to handle these errors at the Model level, add an <code>error</code> listener to your Model as shown below.</p> <pre data-language="javascript"><span class="hljs-comment">// registering an error listener on the Model lets us handle errors more locally</span>
<span class="hljs-title class_">Product</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'error'</span>, handleError);
</pre> </div>
<h3 id="SchemaType.prototype.validators">SchemaType.prototype.validators</h3>
<h5>Type:</h5>
<ul><li><span class="method-type">«property»</span></li></ul>
<div>
<p>The validators that Mongoose should run to validate properties at this SchemaType's path.</p> <h4 id="example"> <a href="#example"> Example: </a> </h4> <pre data-language="javascript"><span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>({ <span class="hljs-attr">name</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span> } });
schema.<span class="hljs-title function_">path</span>(<span class="hljs-string">'name'</span>).<span class="hljs-property">validators</span>.<span class="hljs-property">length</span>; <span class="hljs-comment">// 1, the `required` validator</span>
</pre> </div>
<h3 id="SchemaType.set()">SchemaType.set()</h3>
<h5>Parameters:</h5>
<ul class="params">
<li class="param">
<code>option</code> <span class="method-type">«String»</span> The name of the option you'd like to set (e.g. trim, lowercase, etc...) </li>
<li class="param">
<code>value</code> <span class="method-type">«Any»</span> The value of the option you'd like to set. </li>
</ul>
<h5>Returns:</h5>
<ul><li>
<span class="method-type">«void,void»</span> </li></ul>
<div>
<p>Sets a default option for this schema type.</p> <h4 id="example"> <a href="#example"> Example: </a> </h4> <pre data-language="javascript"><span class="hljs-comment">// Make all strings be trimmed by default</span>
mongoose.<span class="hljs-property">SchemaTypes</span>.<span class="hljs-property">String</span>.<span class="hljs-title function_">set</span>(<span class="hljs-string">'trim'</span>, <span class="hljs-literal">true</span>);
</pre> </div>
</div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2010 LearnBoost<br>Licensed under the MIT License.<br>
    <a href="https://mongoosejs.com/docs/api/schematype.html" class="_attribution-link">https://mongoosejs.com/docs/api/schematype.html</a>
  </p>
</div>
