<header><h1>Insertable Streams for MediaStreamTrack API</h1></header><div class="section-content"><p>The <strong>Insertable Streams for MediaStreamTrack API</strong> provides a method of adding new components to a <a href="mediastreamtrack.html"><code>MediaStreamTrack</code></a>.</p></div>
<h2 id="concepts_and_usage">Concepts and Usage</h2>
<div class="section-content"><p>When processing video or audio, you sometimes want to insert additional elements or otherwise process the stream. For example, an application might include two tracks that need to be combined, such as a weather map and video of a presenter explaining the map. Or, you may want to do processing on a track to blur backgrounds, remove background noise, or introduce other elements (such as adding funny hats to people, and so on). This API provides a method to do this by giving direct access to the stream, thus allowing it to be manipulated.</p></div>
<h2 id="interfaces">Interfaces</h2>
<div class="section-content"><dl> <dt id="sect1"><a href="mediastreamtrackgenerator.html"><code>MediaStreamTrackGenerator</code></a></dt> <dd> <p>Creates a <a href="writablestream.html"><code>WritableStream</code></a> that acts as a <a href="mediastreamtrack.html"><code>MediaStreamTrack</code></a> source.</p> </dd> <dt id="sect2"><a href="mediastreamtrackprocessor.html"><code>MediaStreamTrackProcessor</code></a></dt> <dd> <p>Consumes a <a href="mediastreamtrack.html"><code>MediaStreamTrack</code></a> object's source and generates a stream of media frames.</p> </dd> </dl></div>
<h2 id="examples">Examples</h2>
<div class="section-content">
<p>The following example is from the article <a href="https://web.dev/mediastreamtrack-insertable-media-processing/" target="_blank">Insertable streams for MediaStreamTrack</a>, and demonstrates a barcode scanner application that highlights a barcode in a video stream. This transforms the stream accessed via <a href="mediastreamtrackprocessor/readable.html"><code>MediaStreamTrackProcessor.readable</code></a>.</p> <div class="code-example">
<p class="example-header"><span class="language-name">js</span></p>
<pre data-signature="fKOYXKcwIIU9P2d7wuqPIQ1IYa9YLR8vQjbRKxINwuY=" data-language="js"><span class="token keyword">const</span> stream <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getUserMedia</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">video</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> videoTrack <span class="token operator">=</span> stream<span class="token punctuation">.</span><span class="token function">getVideoTracks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> trackProcessor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MediaStreamTrackProcessor</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">track</span><span class="token operator">:</span> videoTrack <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> trackGenerator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MediaStreamTrackGenerator</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">kind</span><span class="token operator">:</span> <span class="token string">"video"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> transformer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TransformStream</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token keyword">async</span> <span class="token function">transform</span><span class="token punctuation">(</span><span class="token parameter">videoFrame<span class="token punctuation">,</span> controller</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> barcodes <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">detectBarcodes</span><span class="token punctuation">(</span>videoFrame<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> newFrame <span class="token operator">=</span> <span class="token function">highlightBarcodes</span><span class="token punctuation">(</span>videoFrame<span class="token punctuation">,</span> barcodes<span class="token punctuation">)</span><span class="token punctuation">;</span>
    videoFrame<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    controller<span class="token punctuation">.</span><span class="token function">enqueue</span><span class="token punctuation">(</span>newFrame<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

trackProcessor<span class="token punctuation">.</span>readable
  <span class="token punctuation">.</span><span class="token function">pipeThrough</span><span class="token punctuation">(</span>transformer<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">pipeTo</span><span class="token punctuation">(</span>trackGenerator<span class="token punctuation">.</span>writable<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre>
</div>
</div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2005&ndash;2023 MDN contributors.<br>Licensed under the Creative Commons Attribution-ShareAlike License v2.5 or later.<br>
    <a href="https://developer.mozilla.org/en-US/docs/Web/API/Insertable_Streams_for_MediaStreamTrack_API" class="_attribution-link">https://developer.mozilla.org/en-US/docs/Web/API/Insertable_Streams_for_MediaStreamTrack_API</a>
  </p>
</div>
