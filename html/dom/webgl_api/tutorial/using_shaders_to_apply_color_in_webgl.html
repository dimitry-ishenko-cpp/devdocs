<header><h1>Using shaders to apply color in WebGL</h1></header><div class="section-content">
<ul class="prev-next"> <li><a class="button secondary" href="adding_2d_content_to_a_webgl_context.html">« Previous</a></li> <li><a class="button secondary" href="animating_objects_with_webgl.html">Next »</a></li> </ul> <p>Having created a square plane in the <a href="adding_2d_content_to_a_webgl_context.html">previous demonstration</a>, the next obvious step is to add a splash of color to it. We can do this by revising the shaders.</p>
</div>
<h2 id="applying_color_to_the_vertices">Applying color to the vertices</h2>
<div class="section-content">
<p>In WebGL objects are built using sets of vertices, each of which has a position and a color. By default, all other pixels' colors (and all its other attributes, including position) are computed using interpolation, automatically creating smooth gradients. Previously, our vertex shader didn't apply any specific colors to the vertices. Between this and the fragment shader assigning the fixed color of white to each pixel, the entire square was rendered as solid white.</p> <p>Let's say we want to render a gradient in which each corner of the square is a different color: red, blue, green, and white. The first thing to do is to establish these colors for the four vertices. To do this, we first need to create an array of vertex colors, then store it into a WebGL buffer.</p> <div class="notecard note" id="sect1"> <p><strong>Note:</strong> Add the following function to your <code>init-buffers.js</code> module:</p> </div> <div class="code-example">
<p class="example-header"><span class="language-name">js</span></p>
<pre data-signature="AjH0/d86XXww6/rX756ADxujZ9f2Hc1cM80IlTyWq2w=" data-language="js"><span class="token keyword">function</span> <span class="token function">initColorBuffer</span><span class="token punctuation">(</span><span class="token parameter">gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> colors <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token number">1.0</span><span class="token punctuation">,</span>
    <span class="token number">1.0</span><span class="token punctuation">,</span>
    <span class="token number">1.0</span><span class="token punctuation">,</span>
    <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token comment">// white</span>
    <span class="token number">1.0</span><span class="token punctuation">,</span>
    <span class="token number">0.0</span><span class="token punctuation">,</span>
    <span class="token number">0.0</span><span class="token punctuation">,</span>
    <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token comment">// red</span>
    <span class="token number">0.0</span><span class="token punctuation">,</span>
    <span class="token number">1.0</span><span class="token punctuation">,</span>
    <span class="token number">0.0</span><span class="token punctuation">,</span>
    <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token comment">// green</span>
    <span class="token number">0.0</span><span class="token punctuation">,</span>
    <span class="token number">0.0</span><span class="token punctuation">,</span>
    <span class="token number">1.0</span><span class="token punctuation">,</span>
    <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token comment">// blue</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> colorBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> colorBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span>colors<span class="token punctuation">)</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> colorBuffer<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre>
</div> <p>This code starts by creating a JavaScript array containing four 4-value vectors, one for each vertex color. Then a new WebGL buffer is allocated to store these colors, and the array is converted into floats and stored into the buffer.</p> <p>Of course, we also need to call this new function from <code>initBuffers()</code>, and return the new buffer it creates.</p> <div class="notecard note" id="sect2"> <p><strong>Note:</strong> At the end of your <code>initBuffers()</code> function, add the following code, replacing the existing <code>return</code> statement:</p> </div> <div class="code-example">
<p class="example-header"><span class="language-name">js</span></p>
<pre data-signature="HZgHSW9FKUGGJlargLIU2UqeqF4IsO4hyGwIjDsHyBQ=" data-language="js"><span class="token keyword">const</span> colorBuffer <span class="token operator">=</span> <span class="token function">initColorBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">return</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">position</span><span class="token operator">:</span> positionBuffer<span class="token punctuation">,</span>
  <span class="token literal-property property">color</span><span class="token operator">:</span> colorBuffer<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre>
</div> <p>To use these colors, the vertex shader needs to be updated to pull the appropriate color from the color buffer.</p> <div class="notecard note" id="sect3"> <p><strong>Note:</strong> Update the <code>vsSource</code> declaration in your <code>main()</code> function like this:</p> </div> <div class="code-example">
<p class="example-header"><span class="language-name">js</span></p>
<pre data-signature="Z8AkTGpAACXT17mjIjuhR39lXQfVGzstGR3BDiRAAL0=" data-language="js"><span class="token comment">// Vertex shader program</span>

<span class="token keyword">const</span> vsSource <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
    attribute vec4 aVertexPosition;
    attribute vec4 aVertexColor;

    uniform mat4 uModelViewMatrix;
    uniform mat4 uProjectionMatrix;

    varying lowp vec4 vColor;

    void main(void) {
      gl_Position = uProjectionMatrix * uModelViewMatrix * aVertexPosition;
      vColor = aVertexColor;
    }
  </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
</pre>
</div> <p>The key difference here is that for each vertex, we pass its color using a <code>varying</code> to the fragment shader.</p>
</div>
<h2 id="coloring_the_fragments">Coloring the fragments</h2>
<div class="section-content">
<p>In order to pick up the interpolated color for each pixel, we need to change the fragment shader to fetch the value from the <code>vColor</code> varying.</p> <div class="notecard note" id="sect4"> <p><strong>Note:</strong> Update the <code>fsSource</code> declaration in your <code>main()</code> function like this:</p> </div> <div class="code-example">
<p class="example-header"><span class="language-name">js</span></p>
<pre data-signature="4g01dK2/SSkWGfWW4RRwr2pazh2JxS7YnDBH+i+hYQU=" data-language="js"><span class="token comment">// Fragment shader program</span>

<span class="token keyword">const</span> fsSource <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
    varying lowp vec4 vColor;

    void main(void) {
      gl_FragColor = vColor;
    }
  </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
</pre>
</div> <p>Each fragment receives the interpolated color based on its position relative to the vertex positions instead of a fixed value.</p>
</div>
<h2 id="drawing_using_the_colors">Drawing using the colors</h2>
<div class="section-content">
<p>Next, you need to add code to look up the attribute location for the colors and set up that attribute for the shader program.</p> <div class="notecard note" id="sect5"> <p><strong>Note:</strong> Update the <code>programInfo</code> declaration in your <code>main()</code> function like this:</p> </div> <div class="code-example">
<p class="example-header"><span class="language-name">js</span></p>
<pre data-signature="LAjR37kLxR6+5Ns0t8RxOV0FT7TuC5RhmbIQnOYx3Vg=" data-language="js"><span class="token comment">// Collect all the info needed to use the shader program.</span>
<span class="token comment">// Look up which attributes our shader program is using</span>
<span class="token comment">// for aVertexPosition, aVertexColor and also</span>
<span class="token comment">// look up uniform locations.</span>
<span class="token keyword">const</span> programInfo <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">program</span><span class="token operator">:</span> shaderProgram<span class="token punctuation">,</span>
  <span class="token literal-property property">attribLocations</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">vertexPosition</span><span class="token operator">:</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>shaderProgram<span class="token punctuation">,</span> <span class="token string">"aVertexPosition"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">vertexColor</span><span class="token operator">:</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>shaderProgram<span class="token punctuation">,</span> <span class="token string">"aVertexColor"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">uniformLocations</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">projectionMatrix</span><span class="token operator">:</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>shaderProgram<span class="token punctuation">,</span> <span class="token string">"uProjectionMatrix"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">modelViewMatrix</span><span class="token operator">:</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>shaderProgram<span class="token punctuation">,</span> <span class="token string">"uModelViewMatrix"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre>
</div> <p>Next, <code>drawScene()</code> needs to use these colors when drawing the square.</p> <div class="notecard note" id="sect6"> <p><strong>Note:</strong> Add the following function to your <code>draw-scene.js</code> module:</p> </div> <div class="code-example">
<p class="example-header"><span class="language-name">js</span></p>
<pre data-signature="obFi5XzM2SEfWjjafrQldTM0KAN3y7zRYB3MT3Tgn7o=" data-language="js"><span class="token comment">// Tell WebGL how to pull out the colors from the color buffer</span>
<span class="token comment">// into the vertexColor attribute.</span>
<span class="token keyword">function</span> <span class="token function">setColorAttribute</span><span class="token punctuation">(</span><span class="token parameter">gl<span class="token punctuation">,</span> buffers<span class="token punctuation">,</span> programInfo</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> numComponents <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> type <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> normalize <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> stride <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> buffers<span class="token punctuation">.</span>color<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>
    programInfo<span class="token punctuation">.</span>attribLocations<span class="token punctuation">.</span>vertexColor<span class="token punctuation">,</span>
    numComponents<span class="token punctuation">,</span>
    type<span class="token punctuation">,</span>
    normalize<span class="token punctuation">,</span>
    stride<span class="token punctuation">,</span>
    offset<span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>programInfo<span class="token punctuation">.</span>attribLocations<span class="token punctuation">.</span>vertexColor<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre>
</div> <div class="notecard note" id="sect7"> <p><strong>Note:</strong> Call the <code>setColorAttribute()</code> function from <code>drawScene()</code>, right before the <code>gl.useProgram()</code> call:</p> </div> <div class="code-example">
<p class="example-header"><span class="language-name">js</span></p>
<pre data-signature="nQN58uwMZLDLGGOqCG/ffvaNs2lwG9WwDcpP987ubCQ=" data-language="js"><span class="token function">setColorAttribute</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> buffers<span class="token punctuation">,</span> programInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre>
</div> <p>The result should now look like this:</p>
<iframe width="670" height="510" src="https://mdn.github.io/dom-examples/webgl-examples/tutorial/sample3/index.html" loading="lazy"></iframe> <p><a href="https://github.com/mdn/dom-examples/tree/main/webgl-examples/tutorial/sample3" target="_blank">View the complete code</a> | <a href="https://mdn.github.io/dom-examples/webgl-examples/tutorial/sample3/" target="_blank">Open this demo on a new page</a></p>
<ul class="prev-next"> <li><a class="button secondary" href="adding_2d_content_to_a_webgl_context.html">« Previous</a></li> <li><a class="button secondary" href="animating_objects_with_webgl.html">Next »</a></li> </ul>
</div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2005&ndash;2023 MDN contributors.<br>Licensed under the Creative Commons Attribution-ShareAlike License v2.5 or later.<br>
    <a href="https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/Tutorial/Using_shaders_to_apply_color_in_WebGL" class="_attribution-link">https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/Tutorial/Using_shaders_to_apply_color_in_WebGL</a>
  </p>
</div>
