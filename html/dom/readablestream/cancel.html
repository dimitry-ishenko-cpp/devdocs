<header><h1>ReadableStream: cancel() method</h1></header><div class="section-content">
<div class="notecard note" id="sect1"> <p><strong>Note:</strong> This feature is available in <a href="../web_workers_api.html">Web Workers</a>.</p> </div> <p>The <code>cancel()</code> method of the <a href="../readablestream.html"><code>ReadableStream</code></a> interface returns a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise"><code>Promise</code></a> that resolves when the stream is canceled.</p> <p> Cancel is used when you've completely finished with the stream and don't need any more data from it, even if there are chunks enqueued waiting to be read. That data is lost after cancel is called, and the stream is not readable any more. To read those chunks still and not completely get rid of the stream, you'd use <a href="../readablestreamdefaultcontroller/close.html"><code>ReadableStreamDefaultController.close()</code></a>. </p>
</div>
<h2 id="syntax">Syntax</h2>
<div class="section-content"><div class="code-example">
<div class="example-header"><span class="language-name">js</span></div>
<pre data-signature="ZFYJSp2SQV40F8EiFDD950i055bqsVyFGqL7/hdKZNk=" data-language="js"><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">cancel</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span>
</pre>
</div></div>
<h3 id="parameters">Parameters</h3>
<div class="section-content"><dl> <dt id="reason">
<a href="#reason"><code>reason</code></a> <span class="badge inline optional">Optional</span>
</dt> <dd> <p> A human-readable reason for the cancellation. This is passed to the underlying source, which may or may not use it. </p> </dd> </dl></div>
<h3 id="return_value">Return value</h3>
<div class="section-content"><p>A <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise"><code>Promise</code></a>, which fulfills with <code>undefined</code> value.</p></div>
<h3 id="exceptions">Exceptions</h3>
<div class="section-content"><dl> <dt id="typeerror"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/TypeError"><code>TypeError</code></a></dt> <dd> <p>The stream you are trying to cancel is not a <a href="../readablestream.html"><code>ReadableStream</code></a>, or it is locked.</p> </dd> </dl></div>
<h2 id="examples">Examples</h2>
<div class="section-content">
<p> In Jake Archibald's <a href="https://jsbin.com/gameboy/edit?js,console" target="_blank">cancelling a fetch</a> example, a stream is used to fetch the WHATWG HTML spec chunk by chunk; each chunk is searched for the string "service workers". When the search terms is found, <code>cancel()</code> is used to cancel the stream — the job is finished so it is no longer needed. </p> <div class="code-example">
<div class="example-header"><span class="language-name">js</span></div>
<pre data-signature="6t10U33hQQGEWdra11wmYe6AiAWt9ouLLYk6zqOyoTs=" data-language="js"><span class="token keyword">const</span> searchTerm <span class="token operator">=</span> <span class="token string">"service workers"</span><span class="token punctuation">;</span>
<span class="token comment">// Chars to show either side of the result in the match</span>
<span class="token keyword">const</span> contextBefore <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> contextAfter <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> caseInsensitive <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">"https://html.spec.whatwg.org/"</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Searching '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">' for '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>searchTerm<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">'</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Received headers"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> decoder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TextDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> reader <span class="token operator">=</span> response<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">getReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> toMatch <span class="token operator">=</span> caseInsensitive <span class="token operator">?</span> searchTerm<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> searchTerm<span class="token punctuation">;</span>
    <span class="token keyword">const</span> bufferSize <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>toMatch<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> contextBefore<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> bytesReceived <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> buffer <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> matchFoundAt <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> reader<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>done<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Failed to find match"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      bytesReceived <span class="token operator">+=</span> result<span class="token punctuation">.</span>value<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Received </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>bytesReceived<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> bytes of data so far</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      buffer <span class="token operator">+=</span> decoder<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>value<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">stream</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// already found match &amp; just context-gathering?</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>matchFoundAt <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        matchFoundAt <span class="token operator">=</span> <span class="token punctuation">(</span>
          caseInsensitive <span class="token operator">?</span> buffer<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> buffer
        <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>toMatch<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>matchFoundAt <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        buffer <span class="token operator">=</span> buffer<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token operator">-</span>bufferSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>
        buffer<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>matchFoundAt <span class="token operator">+</span> toMatch<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">&gt;=</span> contextAfter
      <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Here's the match:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
          buffer<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>
            Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> matchFoundAt <span class="token operator">-</span> contextBefore<span class="token punctuation">)</span><span class="token punctuation">,</span>
            matchFoundAt <span class="token operator">+</span> toMatch<span class="token punctuation">.</span>length <span class="token operator">+</span> contextAfter<span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Cancelling fetch"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        reader<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Found match, but need more context…"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// keep reading</span>
      <span class="token keyword">return</span> reader<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>process<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>
      <span class="token string">"Something went wrong. See devtools for details. Does the response lack CORS headers?"</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre>
</div>
</div>
<h2 id="specifications">Specifications</h2>
<div class="_table"><table class="standard-table">
<thead><tr><th scope="col">Specification</th></tr></thead>
<tbody><tr><td><a href="#">Streams Standard <br><small># ref-for-rs-cancel③</small></a></td></tr></tbody>
</table></div>
<h2 id="browser_compatibility">Browser compatibility</h2>
<div class="_table"><table>
<thead>
<tr id="bct-browser-type">
<th></th>
<th colspan="6">Desktop</th>
<th colspan="6">Mobile</th>
</tr>
<tr id="bct-browsers">
<th></th>
<th>Chrome</th>
<th>Edge</th>
<th>Firefox</th>
<th>Opera</th>
<th>Safari</th>
<th>Chrome Android</th>
<th>Firefox for Android</th>
<th>Opera Android</th>
<th>Safari on IOS</th>
<th>Samsung Internet</th>
<th>WebView Android</th>
</tr>
</thead>
<tbody><tr>
<th><code>cancel</code></th>
<td class="bc-supports-yes">43</td>
<td class="bc-supports-yes">14</td>
<td class="bc-supports-yes">65</td>
<td class="bc-supports-yes">30</td>
<td class="bc-supports-yes">10.1</td>
<td class="bc-supports-yes">43</td>
<td class="bc-supports-yes">65</td>
<td class="bc-supports-yes">30</td>
<td class="bc-supports-yes">10.3</td>
<td class="bc-supports-yes">4.0</td>
<td class="bc-supports-yes">43</td>
</tr></tbody>
</table></div>
<h2 id="see_also">See also</h2>
<div class="section-content"><ul> <li>
<a href="readablestream.html"><code>ReadableStream()</code></a> constructor</li> <li><a href="../streams_api/using_readable_streams.html">Using readable streams</a></li> </ul></div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2005&ndash;2023 MDN contributors.<br>Licensed under the Creative Commons Attribution-ShareAlike License v2.5 or later.<br>
    <a href="https://developer.mozilla.org/en-US/docs/Web/API/ReadableStream/cancel" class="_attribution-link">https://developer.mozilla.org/en-US/docs/Web/API/ReadableStream/cancel</a>
  </p>
</div>
