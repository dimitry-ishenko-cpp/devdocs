<h1 id="vendor-binaries-and-the-vendor-bin-directory">Vendor binaries and the <code>vendor/bin</code> directory</h1> <h2 id="what-is-a-vendor-binary-">What is a vendor binary?</h2> <p>Any command line script that a Composer package would like to pass along to a user who installs the package should be listed as a vendor binary.</p> <p>If a package contains other scripts that are not needed by the package users (like build or compile scripts) that code should not be listed as a vendor binary.</p> <h2 id="how-is-it-defined-">How is it defined?</h2> <p>It is defined by adding the <code>bin</code> key to a project's <code>composer.json</code>. It is specified as an array of files so multiple binaries can be added for any given project.</p> <pre data-language="javascript">{
    "bin": ["bin/my-script", "bin/my-other-script"]
}</pre> <h2 id="what-does-defining-a-vendor-binary-in-composer-json-do-">What does defining a vendor binary in composer.json do?</h2> <p>It instructs Composer to install the package's binaries to <code>vendor/bin</code> for any project that <strong>depends</strong> on that project.</p> <p>This is a convenient way to expose useful scripts that would otherwise be hidden deep in the <code>vendor/</code> directory.</p> <h2 id="what-happens-when-composer-is-run-on-a-composer-json-that-defines-vendor-binaries-">What happens when Composer is run on a composer.json that defines vendor binaries?</h2> <p>For the binaries that a package defines directly, nothing happens.</p> <h2 id="what-happens-when-composer-is-run-on-a-composer-json-that-has-dependencies-with-vendor-binaries-listed-">What happens when Composer is run on a composer.json that has dependencies with vendor binaries listed?</h2> <p>Composer looks for the binaries defined in all of the dependencies. A proxy file (or two on Windows/WSL) is created from each dependency's binaries to <code>vendor/bin</code>.</p> <p>Say package <code>my-vendor/project-a</code> has binaries setup like this:</p> <pre data-language="javascript">{
    "name": "my-vendor/project-a",
    "bin": ["bin/project-a-bin"]
}</pre> <p>Running <code>composer install</code> for this <code>composer.json</code> will not do anything with <code>bin/project-a-bin</code>.</p> <p>Say project <code>my-vendor/project-b</code> has requirements setup like this:</p> <pre data-language="javascript">{
    "name": "my-vendor/project-b",
    "require": {
        "my-vendor/project-a": "*"
    }
}</pre> <p>Running <code>composer install</code> for this <code>composer.json</code> will look at all of project-a's binaries and install them to <code>vendor/bin</code>.</p> <p>In this case, Composer will make <code>vendor/my-vendor/project-a/bin/project-a-bin</code> available as <code>vendor/bin/project-a-bin</code>.</p> <h2 id="finding-the-composer-autoloader-from-a-binary">Finding the Composer autoloader from a binary</h2> <p>As of Composer 2.2, a new <code>$_composer_autoload_path</code> global variable is defined by the bin proxy file, so that when your binary gets executed it can use it to easily locate the project's autoloader.</p> <p>This global will not be available however when running binaries defined by the root package itself, so you need to have a fallback in place.</p> <p>This can look like this for example:</p> <pre data-language="php">&lt;?php

include $_composer_autoload_path ?? __DIR__ . '/../vendor/autoload.php';</pre> <p>If you want to rely on this in your package you should however make sure to also require <code>"composer-runtime-api": "^2.2"</code> to ensure that the package gets installed with a Composer version supporting the feature.</p> <h2 id="finding-the-composer-bin-dir-from-a-binary">Finding the Composer bin-dir from a binary</h2> <p>As of Composer 2.2.2, a new <code>$_composer_bin_dir</code> global variable is defined by the bin proxy file, so that when your binary gets executed it can use it to easily locate the project's Composer bin directory.</p> <p>For non-PHP binaries, as of Composer 2.2.6, the bin proxy sets a <code>COMPOSER_RUNTIME_BIN_DIR</code> environment variable.</p> <p>This global variable will not be available however when running binaries defined by the root package itself, so you need to have a fallback in place.</p> <p>This can look like this for example:</p> <pre data-language="php">&lt;?php

$binDir = $_composer_bin_dir ?? __DIR__ . '/../vendor/bin';</pre> <pre data-language="php">#!/bin/bash

if [[ -z "$COMPOSER_RUNTIME_BIN_DIR" ]]; then
  BIN_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" &amp;&amp; pwd )"
else
  BIN_DIR="$COMPOSER_RUNTIME_BIN_DIR"
fi</pre> <p>If you want to rely on this in your package you should however make sure to also require <code>"composer-runtime-api": "^2.2.2"</code> to ensure that the package gets installed with a Composer version supporting the feature.</p> <h2 id="what-about-windows-and-bat-files-">What about Windows and .bat files?</h2> <p>Packages managed entirely by Composer do not <em>need</em> to contain any <code>.bat</code> files for Windows compatibility. Composer handles installation of binaries in a special way when run in a Windows environment:</p> <ul> <li>A <code>.bat</code> file is generated automatically to reference the binary</li> <li>A Unix-style proxy file with the same name as the binary is also generated, which is useful for WSL, Linux VMs, etc.</li> </ul> <p>Packages that need to support workflows that may not include Composer are welcome to maintain custom <code>.bat</code> files. In this case, the package should <strong>not</strong> list the <code>.bat</code> file as a binary as it is not needed.</p> <h2 id="can-vendor-binaries-be-installed-somewhere-other-than-vendor-bin-">Can vendor binaries be installed somewhere other than vendor/bin?</h2> <p>Yes, there are two ways an alternate vendor binary location can be specified:</p> <ol> <li>Setting the <code>bin-dir</code> configuration setting in <code>composer.json</code>
</li> <li>Setting the environment variable <code>COMPOSER_BIN_DIR</code>
</li> </ol> <p>An example of the former looks like this:</p> <pre data-language="javascript">{
    "config": {
        "bin-dir": "scripts"
    }
}</pre> <p>Running <code>composer install</code> for this <code>composer.json</code> will result in all of the vendor binaries being installed in <code>scripts/</code> instead of <code>vendor/bin/</code>.</p> <p>You can set <code>bin-dir</code> to <code>./</code> to put binaries in your project root.</p><div class="_attribution">
  <p class="_attribution-p">
    &copy; Nils Adermann, Jordi Boggiano<br>Licensed under the MIT License.<br>
    <a href="https://getcomposer.org/doc/articles/vendor-binaries.md" class="_attribution-link">https://getcomposer.org/doc/articles/vendor-binaries.md</a>
  </p>
</div>
