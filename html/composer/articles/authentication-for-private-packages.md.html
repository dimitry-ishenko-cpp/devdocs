<h1 id="authentication-for-privately-hosted-packages-and-repositories">Authentication for privately hosted packages and repositories</h1> <p>Your <a href="handling-private-packages.md.html">private package server</a> or version control system is probably secured with one or more authentication options. In order to allow your project to have access to these packages and repositories you will have to tell Composer how to authenticate with the server that hosts them.</p> <h1 id="authentication-principles">Authentication principles</h1> <p>Whenever Composer encounters a protected Composer repository it will try to authenticate using already defined credentials first. When none of those credentials apply it will prompt for credentials and save them (or a token if Composer is able to retrieve one).</p> <table> <thead> <tr> <th>type</th> <th>Generated by Prompt?</th> </tr> </thead> <tbody> <tr> <td><a href="#http-basic">http-basic</a></td> <td>yes</td> </tr> <tr> <td><a href="#inline-http-basic">Inline http-basic</a></td> <td>no</td> </tr> <tr> <td><a href="#http-bearer">HTTP Bearer</a></td> <td>no</td> </tr> <tr> <td><a href="#custom-token-authentication">Custom header</a></td> <td>no</td> </tr> <tr> <td><a href="#gitlab-oauth">gitlab-oauth</a></td> <td>yes</td> </tr> <tr> <td><a href="#gitlab-token">gitlab-token</a></td> <td>yes</td> </tr> <tr> <td><a href="#github-oauth">github-oauth</a></td> <td>yes</td> </tr> <tr> <td><a href="#bitbucket-oauth">bitbucket-oauth</a></td> <td>yes</td> </tr> </tbody> </table> <p>Sometimes automatic authentication is not possible, or you may want to predefine authentication credentials.</p> <p>Credentials can be stored on 3 different places; in an <code>auth.json</code> for the project, a global <code>auth.json</code> or in the <code>composer.json</code> itself.</p> <h2 id="authentication-in-auth-json-per-project">Authentication in auth.json per project</h2> <p>In this authentication storage method, an <code>auth.json</code> file will be present in the same folder as the projects' <code>composer.json</code> file. You can either create and edit this file using the command line or manually edit or create it.</p> <blockquote> <p><strong>Note: Make sure the <code>auth.json</code> file is in <code>.gitignore</code></strong> to avoid leaking credentials into your git history.</p> </blockquote> <h2 id="global-authentication-credentials">Global authentication credentials</h2> <p>If you don't want to supply credentials for every project you work on, storing your credentials globally might be a better idea. These credentials are stored in a global <code>auth.json</code> in your Composer home directory.</p> <h3 id="command-line-global-credential-editing">Command line global credential editing</h3> <p>For all authentication methods it is possible to edit them using the command line;</p> <ul> <li><a href="#command-line-http-basic">http-basic</a></li> <li><a href="#command-line-inline-http-basic">Inline http-basic</a></li> <li><a href="#http-bearer">HTTP Bearer</a></li> <li><a href="#command-line-gitlab-oauth">gitlab-oauth</a></li> <li><a href="#command-line-gitlab-token">gitlab-token</a></li> <li><a href="#command-line-github-oauth">github-oauth</a></li> <li><a href="#command-line-bitbucket-oauth">bitbucket-oauth</a></li> </ul> <h3 id="manually-editing-global-authentication-credentials">Manually editing global authentication credentials</h3> <blockquote> <p><strong>Note:</strong> It is not recommended to manually edit your authentication options as this might result in invalid json. Instead preferably use <a href="#command-line-global-credential-editing">the command line</a>.</p> </blockquote> <p>To manually edit it, run:</p> <pre>php composer.phar config --global --editor [--auth]</pre> <p>For specific authentication implementations, see their sections;</p> <ul> <li><a href="#manual-http-basic">http-basic</a></li> <li><a href="#manual-inline-http-basic">Inline http-basic</a></li> <li><a href="#http-bearer">HTTP Bearer</a></li> <li><a href="#manual-custom-token-authentication">custom header</a></li> <li><a href="#manual-gitlab-oauth">gitlab-oauth</a></li> <li><a href="#manual-gitlab-token">gitlab-token</a></li> <li><a href="#manual-github-oauth">github-oauth</a></li> <li><a href="#manual-bitbucket-oauth">bitbucket-oauth</a></li> </ul> <p>Manually editing this file instead of using the command line may result in invalid json errors. To fix this you need to open the file in an editor and fix the error. To find the location of your global <code>auth.json</code>, execute:</p> <pre>php composer.phar config --global home</pre> <p>The folder will contain your global <code>auth.json</code> if it exists.</p> <p>You can open this file in your favorite editor and fix the error.</p> <h2 id="authentication-in-composer-json-file-itself">Authentication in composer.json file itself</h2> <blockquote> <p><strong>Note:</strong> <strong>This is not recommended</strong> as these credentials are visible to anyone who has access to the composer.json, either when it is shared through a version control system like git or when an attacker gains (read) access to your production server files.</p> </blockquote> <p>It is also possible to add credentials to a <code>composer.json</code> on a per-project basis in the <code>config</code> section or directly in the repository definition.</p> <h2 id="authentication-using-the-composer-auth-environment-variable">Authentication using the COMPOSER_AUTH environment variable</h2> <blockquote> <p><strong>Note:</strong> Using the command line environment variable method also has security implications. These credentials will most likely be stored in memory, and may be persisted to a file like <code>~/.bash_history</code> (linux) or <code>ConsoleHost_history.txt</code> (PowerShell on Windows) when closing a session.</p> </blockquote> <p>The final option to supply Composer with credentials is to use the <code>COMPOSER_AUTH</code> environment variable. These variables can be either passed as command line variables or set in actual environment variables. Read more about the usage of this environment variable <a href="../03-cli.md.html#composer-auth">here</a>.</p> <h1 id="authentication-methods">Authentication methods</h1> <h2 id="http-basic">http-basic</h2> <h3 id="command-line-http-basic">Command line http-basic</h3> <pre>php composer.phar config [--global] http-basic.repo.example.org username password</pre> <p>In the above command, the config key <code>http-basic.repo.example.org</code> consists of two parts:</p> <ul> <li>
<code>http-basic</code> is the authentication method.</li> <li>
<code>repo.example.org</code> is the repository host name, you should replace it with the host name of your repository.</li> </ul> <h3 id="manual-http-basic">Manual http-basic</h3> <pre>php composer.phar config [--global] --editor --auth</pre> <pre data-language="javascript">{
    "http-basic": {
        "example.org": {
            "username": "username",
            "password": "password"
        }
    }
}</pre> <h2 id="inline-http-basic">Inline http-basic</h2> <p>For the inline http-basic authentication method the credentials are not stored in a separate <code>auth.json</code> in the project or globally, but in the <code>composer.json</code> or global configuration in the same place where the Composer repository definition is defined.</p> <p>Make sure that the username and password are encoded according to <a href="http://www.faqs.org/rfcs/rfc3986.html">RFC 3986</a> (2.1. Percent-Encoding). If the username e.g. is an email address it needs to be passed as <code>name%40example.com</code>.</p> <h3 id="command-line-inline-http-basic">Command line inline http-basic</h3> <pre>php composer.phar config [--global] repositories composer.unique-name https://username:password@repo.example.org</pre> <h3 id="manual-inline-http-basic">Manual inline http-basic</h3> <pre>php composer.phar config [--global] --editor</pre> <pre data-language="javascript">{
    "repositories": [
        {
            "type": "composer",
            "url": "https://username:password@example.org"
        }
    ]
}</pre> <h2 id="http-bearer">HTTP Bearer</h2> <h3 id="command-line-http-bearer-authentication">Command line HTTP Bearer authentication</h3> <pre>php composer.phar config [--global] bearer.repo.example.org token</pre> <p>In the above command, the config key <code>bearer.repo.example.org</code> consists of two parts:</p> <ul> <li>
<code>bearer</code> is the authentication method.</li> <li>
<code>repo.example.org</code> is the repository host name, you should replace it with the host name of your repository.</li> </ul> <h3 id="manual-http-bearer-authentication">Manual HTTP Bearer authentication</h3> <pre>php composer.phar config [--global] --editor --auth</pre> <pre data-language="javascript">{
    "bearer": {
        "example.org": "TOKEN"
    }
}</pre> <h2 id="custom-token-authentication">Custom token authentication</h2> <h3 id="manual-custom-token-authentication">Manual custom token authentication</h3> <pre>php composer.phar config [--global] --editor</pre> <pre data-language="javascript">{
    "repositories": [
        {
            "type": "composer",
            "url": "https://example.org",
            "options":  {
                "http": {
                    "header": [
                        "API-TOKEN: YOUR-API-TOKEN"
                    ]
                }
            }
        }
    ]
}</pre> <h2 id="gitlab-oauth">gitlab-oauth</h2> <blockquote> <p><strong>Note:</strong> For the gitlab authentication to work on private gitlab instances, the <a href="../06-config.md.html#gitlab-domains"><code>gitlab-domains</code></a> section should also contain the url.</p> </blockquote> <h3 id="command-line-gitlab-oauth">Command line gitlab-oauth</h3> <pre>php composer.phar config [--global] gitlab-oauth.gitlab.example.org token</pre> <p>In the above command, the config key <code>gitlab-oauth.gitlab.example.org</code> consists of two parts:</p> <ul> <li>
<code>gitlab-oauth</code> is the authentication method.</li> <li>
<code>gitlab.example.org</code> is the host name of your GitLab instance, you should replace it with the host name of your GitLab instance or use <code>gitlab.com</code> if you don't have a self-hosted GitLab instance.</li> </ul> <h3 id="manual-gitlab-oauth">Manual gitlab-oauth</h3> <pre>php composer.phar config [--global] --editor --auth</pre> <pre data-language="javascript">{
    "gitlab-oauth": {
        "example.org": "token"
    }
}</pre> <h2 id="gitlab-token">gitlab-token</h2> <blockquote> <p><strong>Note:</strong> For the gitlab authentication to work on private gitlab instances, the <a href="../06-config.md.html#gitlab-domains"><code>gitlab-domains</code></a> section should also contain the url.</p> </blockquote> <p>To create a new access token, go to your <a href="https://gitlab.com/-/profile/personal_access_tokens">access tokens section on GitLab</a> (or the equivalent URL on your private instance) and create a new token. See also <a href="https://docs.gitlab.com/ee/user/profile/personal_access_tokens.html#creating-a-personal-access-token">the GitLab access token documentation</a> for more information.</p> <p>When creating a gitlab token manually, make sure it has either the <code>read_api</code> or <code>api</code> scope.</p> <h3 id="command-line-gitlab-token">Command line gitlab-token</h3> <pre>php composer.phar config [--global] gitlab-token.gitlab.example.org token</pre> <p>In the above command, the config key <code>gitlab-token.gitlab.example.org</code> consists of two parts:</p> <ul> <li>
<code>gitlab-token</code> is the authentication method.</li> <li>
<code>gitlab.example.org</code> is the host name of your GitLab instance, you should replace it with the host name of your GitLab instance or use <code>gitlab.com</code> if you don't have a self-hosted GitLab instance.</li> </ul> <h3 id="manual-gitlab-token">Manual gitlab-token</h3> <pre>php composer.phar config [--global] --editor --auth</pre> <pre data-language="javascript">{
    "gitlab-token": {
        "example.org": "token"
    }
}</pre> <h2 id="github-oauth">github-oauth</h2> <p>To create a new access token, head to your <a href="https://github.com/settings/tokens">token settings section on Github</a> and <a href="https://github.com/settings/tokens/new">generate a new token</a>.</p> <p>For public repositories when rate limited, a token <em>without</em> any particular scope is sufficient (see <code>(no scope)</code> in the <a href="https://docs.github.com/en/developers/apps/building-oauth-apps/scopes-for-oauth-apps">scopes documentation</a>). Such tokens grant read-only access to public information.</p> <p>For private repositories, the <code>repo</code> scope is needed. Note that the token will be given broad read/write access to all of your private repositories and much more - see the <a href="https://docs.github.com/en/developers/apps/building-oauth-apps/scopes-for-oauth-apps">scopes documentation</a> for a complete list. As of writing (November 2021), it seems not to be possible to further limit permissions for such tokens.</p> <p>Read more about <a href="https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token">Personal Access Tokens</a>, or subscribe to the <a href="https://github.com/github/roadmap/issues/184">roadmap item for better scoped tokens in GitHub</a>.</p> <h3 id="command-line-github-oauth">Command line github-oauth</h3> <pre>php composer.phar config [--global] github-oauth.github.com token</pre> <p>In the above command, the config key <code>github-oauth.github.com</code> consists of two parts:</p> <ul> <li>
<code>github-oauth</code> is the authentication method.</li> <li>
<code>github.com</code> is the host name for which this token applies. For GitHub you most likely do not need to change this.</li> </ul> <h3 id="manual-github-oauth">Manual github-oauth</h3> <pre>php composer.phar config [--global] --editor --auth</pre> <pre data-language="javascript">{
    "github-oauth": {
        "github.com": "token"
    }
}</pre> <h2 id="bitbucket-oauth">bitbucket-oauth</h2> <p>The BitBucket driver uses OAuth to access your private repositories via the BitBucket REST APIs, and you will need to create an OAuth consumer to use the driver, please refer to <a href="https://support.atlassian.com/bitbucket-cloud/docs/use-oauth-on-bitbucket-cloud/">Atlassian's Documentation</a>. You will need to fill the callback url with something to satisfy BitBucket, but the address does not need to go anywhere and is not used by Composer.</p> <h3 id="command-line-bitbucket-oauth">Command line bitbucket-oauth</h3> <pre>php composer.phar config [--global] bitbucket-oauth.bitbucket.org consumer-key consumer-secret</pre> <p>In the above command, the config key <code>bitbucket-oauth.bitbucket.org</code> consists of two parts:</p> <ul> <li>
<code>bitbucket-oauth</code> is the authentication method.</li> <li>
<code>bitbucket.org</code> is the host name for which this token applies. Unless you have a private instance you don't need to change this.</li> </ul> <h3 id="manual-bitbucket-oauth">Manual bitbucket-oauth</h3> <pre>php composer.phar config [--global] --editor --auth</pre> <pre data-language="javascript">{
    "bitbucket-oauth": {
        "bitbucket.org": {
             "consumer-key": "key",
             "consumer-secret": "secret"
        }
    }
}</pre><div class="_attribution">
  <p class="_attribution-p">
    &copy; Nils Adermann, Jordi Boggiano<br>Licensed under the MIT License.<br>
    <a href="https://getcomposer.org/doc/articles/authentication-for-private-packages.md" class="_attribution-link">https://getcomposer.org/doc/articles/authentication-for-private-packages.md</a>
  </p>
</div>
