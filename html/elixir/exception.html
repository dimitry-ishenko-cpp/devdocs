<div id="top-content"> <h1> <a href="https://github.com/elixir-lang/elixir/blob/v1.17.2/lib/elixir/lib/exception.ex#L1" title="View Source" class="source" rel="help">Source</a> <span translate="no">Exception</span> <small>behaviour</small>  </h1> <section id="moduledoc"> <p>Functions for dealing with throw/catch/exit and exceptions.</p>
<p>This module also defines the behaviour required by custom exceptions. To define your own, see <a href="kernel.html#defexception/1"><code class="inline">defexception/1</code></a>.</p>
<h2 id="module-formatting-functions" class="section-heading">  <span class="text">Formatting functions</span> </h2> <p>Several functions in this module help format exceptions. Some of these functions expect the stacktrace as argument. The stacktrace is typically available inside catch and rescue by using the <a href="kernel.specialforms.html#__STACKTRACE__/0"><code class="inline">__STACKTRACE__/0</code></a> variable.</p>
<p>Do not rely on the particular format returned by the functions in this module. They may be changed in future releases in order to better suit Elixir's tool chain. In other words, by using the functions in this module it is guaranteed you will format exceptions as in the current Elixir version being used.</p> </section> </div> <section id="summary" class="details-list"> <h1 class="section-heading">  <span class="text">Summary</span> </h1> <h2> Types </h2>
<dl class="summary-types summary">  <div class="summary-row"> <dt class="summary-signature"> <a href="#t:arity_or_args/0" data-no-tooltip translate="no">arity_or_args()</a> </dt> </div> <div class="summary-row"> <dt class="summary-signature"> <a href="#t:kind/0" data-no-tooltip translate="no">kind()</a> </dt> <dd class="summary-synopsis"><p>The kind handled by formatting functions</p></dd> </div> <div class="summary-row"> <dt class="summary-signature"> <a href="#t:location/0" data-no-tooltip translate="no">location()</a> </dt> </div> <div class="summary-row"> <dt class="summary-signature"> <a href="#t:non_error_kind/0" data-no-tooltip translate="no">non_error_kind()</a> </dt> </div> <div class="summary-row"> <dt class="summary-signature"> <a href="#t:stacktrace/0" data-no-tooltip translate="no">stacktrace()</a> </dt> </div> <div class="summary-row"> <dt class="summary-signature"> <a href="#t:stacktrace_entry/0" data-no-tooltip translate="no">stacktrace_entry()</a> </dt> </div> <div class="summary-row"> <dt class="summary-signature"> <a href="#t:t/0" data-no-tooltip translate="no">t()</a> </dt> <dd class="summary-synopsis"><p>The exception type</p></dd> </div> </dl> <h2> Callbacks </h2>
<dl class="summary-callbacks summary">  <div class="summary-row"> <dt class="summary-signature"> <a href="#c:blame/2" data-no-tooltip translate="no">blame(t, stacktrace)</a> </dt> <dd class="summary-synopsis"><p>Called from <a href="#blame/3"><code class="inline">Exception.blame/3</code></a> to augment the exception struct.</p></dd> </div> <div class="summary-row"> <dt class="summary-signature"> <a href="#c:exception/1" data-no-tooltip translate="no">exception(term)</a> </dt> <dd class="summary-synopsis"><p>Receives the arguments given to <a href="kernel.html#raise/2"><code class="inline">raise/2</code></a> and returns the exception struct.</p></dd> </div> <div class="summary-row"> <dt class="summary-signature"> <a href="#c:message/1" data-no-tooltip translate="no">message(t)</a> </dt> <dd class="summary-synopsis"><p>Receives the exception struct and must return its message.</p></dd> </div> </dl> <h2> Functions </h2>
<dl class="summary-functions summary">  <div class="summary-row"> <dt class="summary-signature"> <a href="#blame/3" data-no-tooltip translate="no">blame(kind, error, stacktrace)</a> </dt> <dd class="summary-synopsis"><p>Attaches information to exceptions for extra debugging.</p></dd> </div> <div class="summary-row"> <dt class="summary-signature"> <a href="#blame_mfa/3" data-no-tooltip translate="no">blame_mfa(module, function, args)</a> </dt> <dd class="summary-synopsis"><p>Blames the invocation of the given module, function and arguments.</p></dd> </div> <div class="summary-row"> <dt class="summary-signature"> <a href="#format/3" data-no-tooltip translate="no">format(kind, payload, stacktrace \\ [])</a> </dt> <dd class="summary-synopsis"><p>Normalizes and formats throw/errors/exits and stacktraces.</p></dd> </div> <div class="summary-row"> <dt class="summary-signature"> <a href="#format_banner/3" data-no-tooltip translate="no">format_banner(kind, exception, stacktrace \\ [])</a> </dt> <dd class="summary-synopsis"><p>Normalizes and formats any throw/error/exit.</p></dd> </div> <div class="summary-row"> <dt class="summary-signature"> <a href="#format_exit/1" data-no-tooltip translate="no">format_exit(reason)</a> </dt> <dd class="summary-synopsis"><p>Formats an exit. It returns a string.</p></dd> </div> <div class="summary-row"> <dt class="summary-signature"> <a href="#format_fa/2" data-no-tooltip translate="no">format_fa(fun, arity)</a> </dt> <dd class="summary-synopsis"><p>Receives an anonymous function and arity and formats it as shown in stacktraces. The arity may also be a list of arguments.</p></dd> </div> <div class="summary-row"> <dt class="summary-signature"> <a href="#format_file_line/3" data-no-tooltip translate="no">format_file_line(file, line, suffix \\ "")</a> </dt> <dd class="summary-synopsis"><p>Formats the given <code class="inline">file</code> and <code class="inline">line</code> as shown in stacktraces.</p></dd> </div> <div class="summary-row"> <dt class="summary-signature"> <a href="#format_file_line_column/4" data-no-tooltip translate="no">format_file_line_column(file, line, column, suffix \\ "")</a> </dt> <dd class="summary-synopsis"><p>Formats the given <code class="inline">file</code>, <code class="inline">line</code>, and <code class="inline">column</code> as shown in stacktraces.</p></dd> </div> <div class="summary-row"> <dt class="summary-signature"> <a href="#format_mfa/3" data-no-tooltip translate="no">format_mfa(module, fun, arity)</a> </dt> <dd class="summary-synopsis"><p>Receives a module, fun and arity and formats it as shown in stacktraces. The arity may also be a list of arguments.</p></dd> </div> <div class="summary-row"> <dt class="summary-signature"> <a href="#format_stacktrace/1" data-no-tooltip translate="no">format_stacktrace(trace \\ nil)</a> </dt> <dd class="summary-synopsis"><p>Formats the stacktrace.</p></dd> </div> <div class="summary-row"> <dt class="summary-signature"> <a href="#format_stacktrace_entry/1" data-no-tooltip translate="no">format_stacktrace_entry(entry)</a> </dt> <dd class="summary-synopsis"><p>Receives a stacktrace entry and formats it into a string.</p></dd> </div> <div class="summary-row"> <dt class="summary-signature"> <a href="#message/1" data-no-tooltip translate="no">message(exception)</a> </dt> <dd class="summary-synopsis"><p>Gets the message for an <code class="inline">exception</code>.</p></dd> </div> <div class="summary-row"> <dt class="summary-signature"> <a href="#normalize/3" data-no-tooltip translate="no">normalize(kind, payload, stacktrace \\ [])</a> </dt> <dd class="summary-synopsis"><p>Normalizes an exception, converting Erlang exceptions to Elixir exceptions.</p></dd> </div> </dl> </section> <section id="types" class="details-list"> <h1 class="section-heading">  <span class="text">Types</span> </h1> <div class="types-list"> <section class="detail"> <h3 class="detail-header" id="t:arity_or_args/0">arity_or_args()<a href="https://github.com/elixir-lang/elixir/blob/v1.17.2/lib/elixir/lib/exception.ex#L38" class="source">Source</a>
</h3> <section class="docstring"> <div class="specs"> <pre translate="no" data-language="elixir">@type arity_or_args() :: non_neg_integer() | list()</pre> </div> </section> </section> <section class="detail"> <h3 class="detail-header" id="t:kind/0">kind()<a href="https://github.com/elixir-lang/elixir/blob/v1.17.2/lib/elixir/lib/exception.ex#L30" class="source">Source</a>
</h3> <section class="docstring"> <div class="specs"> <pre translate="no" data-language="elixir">@type kind() :: :error | non_error_kind()</pre> </div> <p>The kind handled by formatting functions</p> </section> </section> <section class="detail"> <h3 class="detail-header" id="t:location/0">location()<a href="https://github.com/elixir-lang/elixir/blob/v1.17.2/lib/elixir/lib/exception.ex#L39" class="source">Source</a>
</h3> <section class="docstring"> <div class="specs"> <pre translate="no" data-language="elixir">@type location() :: keyword()</pre> </div> </section> </section> <section class="detail"> <h3 class="detail-header" id="t:non_error_kind/0">non_error_kind()<a href="https://github.com/elixir-lang/elixir/blob/v1.17.2/lib/elixir/lib/exception.ex#L31" class="source">Source</a>
</h3> <section class="docstring"> <div class="specs"> <pre translate="no" data-language="elixir">@type non_error_kind() :: :exit | :throw | {:EXIT, pid()}</pre> </div> </section> </section> <section class="detail"> <h3 class="detail-header" id="t:stacktrace/0">stacktrace()<a href="https://github.com/elixir-lang/elixir/blob/v1.17.2/lib/elixir/lib/exception.ex#L33" class="source">Source</a>
</h3> <section class="docstring"> <div class="specs"> <pre translate="no" data-language="elixir">@type stacktrace() :: [stacktrace_entry()]</pre> </div> </section> </section> <section class="detail"> <h3 class="detail-header" id="t:stacktrace_entry/0">stacktrace_entry()<a href="https://github.com/elixir-lang/elixir/blob/v1.17.2/lib/elixir/lib/exception.ex#L34" class="source">Source</a>
</h3> <section class="docstring"> <div class="specs"> <pre translate="no" data-language="elixir">@type stacktrace_entry() ::
  {module(), atom(), arity_or_args(), location()}
  | {(... -&gt; any()), arity_or_args(), location()}</pre> </div> </section> </section> <section class="detail"> <h3 class="detail-header" id="t:t/0">t()<a href="https://github.com/elixir-lang/elixir/blob/v1.17.2/lib/elixir/lib/exception.ex#L23" class="source">Source</a>
</h3> <section class="docstring"> <div class="specs"> <pre translate="no" data-language="elixir">@type t() :: %{
  :__struct__ =&gt; module(),
  :__exception__ =&gt; true,
  optional(atom()) =&gt; any()
}</pre> </div> <p>The exception type</p> </section> </section> </div> </section> <section id="callbacks" class="details-list"> <h1 class="section-heading">  <span class="text">Callbacks</span> </h1> <div class="callbacks-list"> <section class="detail"> <h3 class="detail-header" id="c:blame/2">blame(t, stacktrace)<a href="https://github.com/elixir-lang/elixir/blob/v1.17.2/lib/elixir/lib/exception.ex#L64" class="source">Source</a>
</h3> <section class="docstring"> <div class="specs"> <pre translate="no" data-language="elixir">@callback blame(t(), stacktrace()) :: {t(), stacktrace()}</pre> </div> <p>Called from <a href="#blame/3"><code class="inline">Exception.blame/3</code></a> to augment the exception struct.</p>
<p>Can be used to collect additional information about the exception or do some additional expensive computation.</p> </section> </section> <section class="detail"> <h3 class="detail-header" id="c:exception/1">exception(term)<a href="https://github.com/elixir-lang/elixir/blob/v1.17.2/lib/elixir/lib/exception.ex#L47" class="source">Source</a>
</h3> <section class="docstring"> <div class="specs"> <pre translate="no" data-language="elixir">@callback exception(term()) :: t()</pre> </div> <p>Receives the arguments given to <a href="kernel.html#raise/2"><code class="inline">raise/2</code></a> and returns the exception struct.</p>
<p>The default implementation accepts either a set of keyword arguments that is merged into the struct or a string to be used as the exception's message.</p> </section> </section> <section class="detail"> <h3 class="detail-header" id="c:message/1">message(t)<a href="https://github.com/elixir-lang/elixir/blob/v1.17.2/lib/elixir/lib/exception.ex#L56" class="source">Source</a>
</h3> <section class="docstring"> <div class="specs"> <pre translate="no" data-language="elixir">@callback message(t()) :: String.t()</pre> </div> <p>Receives the exception struct and must return its message.</p>
<p>Most commonly exceptions have a message field which by default is accessed by this function. However, if an exception does not have a message field, this function must be explicitly implemented.</p> </section> </section> </div> </section> <section id="functions" class="details-list"> <h1 class="section-heading">  <span class="text">Functions</span> </h1> <div class="functions-list"> <section class="detail"> <h3 class="detail-header" id="blame/3">blame(kind, error, stacktrace)<a href="https://github.com/elixir-lang/elixir/blob/v1.17.2/lib/elixir/lib/exception.ex#L189" class="source">Source</a>
</h3> <section class="docstring"> <div class="specs"> <pre translate="no" data-language="elixir">@spec blame(:error, any(), stacktrace()) :: {t(), stacktrace()}</pre> <pre translate="no" data-language="elixir">@spec blame(non_error_kind(), payload, stacktrace()) :: {payload, stacktrace()}
when payload: var</pre> </div> <p>Attaches information to exceptions for extra debugging.</p>
<p>This operation is potentially expensive, as it reads data from the file system, parses beam files, evaluates code and so on.</p>
<p>If the exception module implements the optional <a href="#c:blame/2"><code class="inline">blame/2</code></a> callback, it will be invoked to perform the computation.</p> </section> </section> <section class="detail"> <h3 class="detail-header" id="blame_mfa/3">blame_mfa(module, function, args)<a href="https://github.com/elixir-lang/elixir/blob/v1.17.2/lib/elixir/lib/exception.ex#L221" class="source">Source</a>
</h3> <section class="docstring"> <div class="specs"> <pre translate="no" data-language="elixir">@spec blame_mfa(module(), function :: atom(), args :: [term()]) ::
  {:ok, :def | :defp | :defmacro | :defmacrop,
   [{args :: [term()], guards :: [term()]}]}
  | :error</pre> </div> <p>Blames the invocation of the given module, function and arguments.</p>
<p>This function will retrieve the available clauses from bytecode and evaluate them against the given arguments. The clauses are returned as a list of <code class="inline">{args, guards}</code> pairs where each argument and each top-level condition in a guard separated by <code class="inline">and</code>/<code class="inline">or</code> is wrapped in a tuple with blame metadata.</p>
<p>This function returns either <code class="inline">{:ok, definition, clauses}</code> or <code class="inline">:error</code>. Where <code class="inline">definition</code> is <code class="inline">:def</code>, <code class="inline">:defp</code>, <code class="inline">:defmacro</code> or <code class="inline">:defmacrop</code>.</p> </section> </section> <section class="detail">  <h3 class="detail-header" id="format/3">format(kind, payload, stacktrace \\ [])<a href="https://github.com/elixir-lang/elixir/blob/v1.17.2/lib/elixir/lib/exception.ex#L161" class="source">Source</a>
</h3> <section class="docstring"> <div class="specs"> <pre translate="no" data-language="elixir">@spec format(kind(), any(), stacktrace()) :: String.t()</pre> </div> <p>Normalizes and formats throw/errors/exits and stacktraces.</p>
<p>It relies on <a href="#format_banner/3"><code class="inline">format_banner/3</code></a> and <a href="#format_stacktrace/1"><code class="inline">format_stacktrace/1</code></a> to generate the final format.</p>
<p>If <code class="inline">kind</code> is <code class="inline">{:EXIT, pid}</code>, it does not generate a stacktrace, as such exits are retrieved as messages without stacktraces.</p> </section> </section> <section class="detail">  <h3 class="detail-header" id="format_banner/3">format_banner(kind, exception, stacktrace \\ [])<a href="https://github.com/elixir-lang/elixir/blob/v1.17.2/lib/elixir/lib/exception.ex#L132" class="source">Source</a>
</h3> <section class="docstring"> <div class="specs"> <pre translate="no" data-language="elixir">@spec format_banner(kind(), any(), stacktrace()) :: String.t()</pre> </div> <p>Normalizes and formats any throw/error/exit.</p>
<p>The message is formatted and displayed in the same format as used by Elixir's CLI.</p>
<p>The third argument is the stacktrace which is used to enrich a normalized error with more information. It is only used when the kind is an error.</p> </section> </section> <section class="detail"> <h3 class="detail-header" id="format_exit/1">format_exit(reason)<a href="https://github.com/elixir-lang/elixir/blob/v1.17.2/lib/elixir/lib/exception.ex#L426" class="source">Source</a>
</h3> <section class="docstring"> <div class="specs"> <pre translate="no" data-language="elixir">@spec format_exit(any()) :: String.t()</pre> </div> <p>Formats an exit. It returns a string.</p>
<p>Often there are errors/exceptions inside exits. Exits are often wrapped by the caller and provide stacktraces too. This function formats exits in a way to nicely show the exit reason, caller and stacktrace.</p> </section> </section> <section class="detail"> <h3 class="detail-header" id="format_fa/2">format_fa(fun, arity)<a href="https://github.com/elixir-lang/elixir/blob/v1.17.2/lib/elixir/lib/exception.ex#L700" class="source">Source</a>
</h3> <section class="docstring"> <div class="specs"> <pre translate="no" data-language="elixir">@spec format_fa((... -&gt; any()), arity()) :: String.t()</pre> </div> <p>Receives an anonymous function and arity and formats it as shown in stacktraces. The arity may also be a list of arguments.</p>
<h4 id="format_fa/2-examples" class="section-heading">  <span class="text">Examples</span> </h4> <pre data-language="elixir">Exception.format_fa(fn -&gt; nil end, 1)
#=&gt; "#Function&lt;...&gt;/1"</pre> </section> </section> <section class="detail">  <h3 class="detail-header" id="format_file_line/3">format_file_line(file, line, suffix \\ "")<a href="https://github.com/elixir-lang/elixir/blob/v1.17.2/lib/elixir/lib/exception.ex#L765" class="source">Source</a>
</h3> <section class="docstring"> <div class="specs"> <pre translate="no" data-language="elixir">@spec format_file_line(String.t() | nil, non_neg_integer() | nil, String.t()) ::
  String.t()</pre> </div> <p>Formats the given <code class="inline">file</code> and <code class="inline">line</code> as shown in stacktraces.</p>
<p>If any of the values are <code class="inline">nil</code>, they are omitted.</p>
<h4 id="format_file_line/3-examples" class="section-heading">  <span class="text">Examples</span> </h4> <pre data-language="elixir">iex&gt; Exception.format_file_line("foo", 1)
"foo:1:"

iex&gt; Exception.format_file_line("foo", nil)
"foo:"

iex&gt; Exception.format_file_line(nil, nil)
""</pre> </section> </section> <section class="detail">  <h3 class="detail-header" id="format_file_line_column/4">format_file_line_column(file, line, column, suffix \\ "")<a href="https://github.com/elixir-lang/elixir/blob/v1.17.2/lib/elixir/lib/exception.ex#L802" class="source">Source</a>
</h3> <section class="docstring"> <div class="specs"> <pre translate="no" data-language="elixir">@spec format_file_line_column(
  String.t() | nil,
  non_neg_integer() | nil,
  non_neg_integer() | nil,
  String.t()
) :: String.t()</pre> </div> <p>Formats the given <code class="inline">file</code>, <code class="inline">line</code>, and <code class="inline">column</code> as shown in stacktraces.</p>
<p>If any of the values are <code class="inline">nil</code>, they are omitted.</p>
<h4 id="format_file_line_column/4-examples" class="section-heading">  <span class="text">Examples</span> </h4> <pre data-language="elixir">iex&gt; Exception.format_file_line_column("foo", 1, 2)
"foo:1:2:"

iex&gt; Exception.format_file_line_column("foo", 1, nil)
"foo:1:"

iex&gt; Exception.format_file_line_column("foo", nil, nil)
"foo:"

iex&gt; Exception.format_file_line_column("foo", nil, 2)
"foo:"

iex&gt; Exception.format_file_line_column(nil, nil, nil)
""</pre> </section> </section> <section class="detail"> <h3 class="detail-header" id="format_mfa/3">format_mfa(module, fun, arity)<a href="https://github.com/elixir-lang/elixir/blob/v1.17.2/lib/elixir/lib/exception.ex#L725" class="source">Source</a>
</h3> <section class="docstring"> <div class="specs"> <pre translate="no" data-language="elixir">@spec format_mfa(module(), atom(), arity_or_args()) :: String.t()</pre> </div> <p>Receives a module, fun and arity and formats it as shown in stacktraces. The arity may also be a list of arguments.</p>
<h4 id="format_mfa/3-examples" class="section-heading">  <span class="text">Examples</span> </h4> <pre data-language="elixir">iex&gt; Exception.format_mfa(Foo, :bar, 1)
"Foo.bar/1"

iex&gt; Exception.format_mfa(Foo, :bar, [])
"Foo.bar()"

iex&gt; Exception.format_mfa(nil, :bar, [])
"nil.bar()"</pre>
<p>Anonymous functions are reported as -func/arity-anonfn-count-, where func is the name of the enclosing function. Convert to "anonymous fn in func/arity"</p> </section> </section> <section class="detail">  <h3 class="detail-header" id="format_stacktrace/1">format_stacktrace(trace \\ nil)<a href="https://github.com/elixir-lang/elixir/blob/v1.17.2/lib/elixir/lib/exception.ex#L673" class="source">Source</a>
</h3> <section class="docstring"> <div class="specs"> <pre translate="no" data-language="elixir">@spec format_stacktrace(stacktrace() | nil) :: String.t()</pre> </div> <p>Formats the stacktrace.</p>
<p>A stacktrace must be given as an argument. If not, the stacktrace is retrieved from <a href="process.html#info/2"><code class="inline">Process.info/2</code></a>.</p> </section> </section> <section class="detail"> <h3 class="detail-header" id="format_stacktrace_entry/1">format_stacktrace_entry(entry)<a href="https://github.com/elixir-lang/elixir/blob/v1.17.2/lib/elixir/lib/exception.ex#L624" class="source">Source</a>
</h3> <section class="docstring"> <div class="specs"> <pre translate="no" data-language="elixir">@spec format_stacktrace_entry(stacktrace_entry()) :: String.t()</pre> </div> <p>Receives a stacktrace entry and formats it into a string.</p> </section> </section> <section class="detail"> <h3 class="detail-header" id="message/1">message(exception)<a href="https://github.com/elixir-lang/elixir/blob/v1.17.2/lib/elixir/lib/exception.ex#L83" class="source">Source</a>
</h3> <section class="docstring"> <div class="specs"> <pre translate="no" data-language="elixir">@spec message(t()) :: String.t()</pre> </div> <p>Gets the message for an <code class="inline">exception</code>.</p> </section> </section> <section class="detail">  <h3 class="detail-header" id="normalize/3">normalize(kind, payload, stacktrace \\ [])<a href="https://github.com/elixir-lang/elixir/blob/v1.17.2/lib/elixir/lib/exception.ex#L116" class="source">Source</a>
</h3> <section class="docstring"> <div class="specs"> <pre translate="no" data-language="elixir">@spec normalize(:error, any(), stacktrace()) :: t()</pre> <pre translate="no" data-language="elixir">@spec normalize(non_error_kind(), payload, stacktrace()) :: payload when payload: var</pre> </div> <p>Normalizes an exception, converting Erlang exceptions to Elixir exceptions.</p>
<p>It takes the <code class="inline">kind</code> spilled by <code class="inline">catch</code> as an argument and normalizes only <code class="inline">:error</code>, returning the untouched payload for others.</p>
<p>The third argument is the stacktrace which is used to enrich a normalized error with more information. It is only used when the kind is an error.</p> </section> </section> </div> </section> <footer class="footer"> <p> <span class="line"> <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages"> Search HexDocs </button> <a href="elixir.epub.html" title="ePub version"> Download ePub version </a> </span> </p> <p class="built-using"> Built using <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.34.1) for the <a href="https://elixir-lang.org" title="Elixir" target="_blank" translate="no">Elixir programming language</a> </p> </footer><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2012-2024 The Elixir Team<br>Licensed under the Apache License, Version 2.0.<br>
    <a href="https://hexdocs.pm/elixir/1.17.2/Exception.html" class="_attribution-link">https://hexdocs.pm/elixir/1.17.2/Exception.html</a>
  </p>
</div>
