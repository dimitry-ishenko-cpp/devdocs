<h1 class="title">Iceberg Extension</h1>  <p>The <code class="language-plaintext highlighter-rouge">iceberg</code> extension is a loadable extension that implements support for the <a href="https://iceberg.apache.org/">Apache Iceberg format</a>.</p> <h2 id="installing-and-loading"> <a style="text-decoration: none;" href="#installing-and-loading">Installing and Loading</a> </h2> <p>To install and load the <code class="language-plaintext highlighter-rouge">iceberg</code> extension, run:</p> <pre class="language-sql highlighter-rouge" data-language="sql">INSTALL iceberg;
LOAD iceberg;</pre> <h2 id="usage"> <a style="text-decoration: none;" href="#usage">Usage</a> </h2> <p>To test the examples, download the <a href="http://localhost:8000/data/iceberg_data.zip"><code class="language-plaintext highlighter-rouge">iceberg_data.zip</code></a> file and unzip it.</p> <h3 id="querying-individual-tables"> <a style="text-decoration: none;" href="#querying-individual-tables">Querying Individual Tables</a> </h3> <pre class="language-sql highlighter-rouge" data-language="sql">SELECT count(*)
FROM iceberg_scan('data/iceberg/lineitem_iceberg', allow_moved_paths = true);</pre> <table> <thead> <tr> <th>count_star()</th> </tr> </thead> <tbody> <tr> <td>51793</td> </tr> </tbody> </table> <blockquote> <p>The <code class="language-plaintext highlighter-rouge">allow_moved_paths</code> option ensures that some path resolution is performed, which allows scanning Iceberg tables that are moved.</p> </blockquote> <p>You can also address specify the current manifest directly in the query, this may be resolved from the catalog prior to the query, in this example the manifest version is a UUID.</p> <pre class="language-sql highlighter-rouge" data-language="sql">SELECT count(*)
FROM iceberg_scan('data/iceberg/lineitem_iceberg/metadata/02701-1e474dc7-4723-4f8d-a8b3-b5f0454eb7ce.metadata.json');</pre> <p>This extension can be paired with the <a href="httpfs/overview"><code class="language-plaintext highlighter-rouge">httpfs</code> extension</a> to access Iceberg tables in object stores such as S3.</p> <pre class="language-sql highlighter-rouge" data-language="sql">SELECT count(*)
FROM iceberg_scan('s3://bucketname/lineitem_iceberg/metadata/02701-1e474dc7-4723-4f8d-a8b3-b5f0454eb7ce.metadata.json', allow_moved_paths = true);</pre> <h3 id="access-iceberg-metadata"> <a style="text-decoration: none;" href="#access-iceberg-metadata">Access Iceberg Metadata</a> </h3> <pre class="language-sql highlighter-rouge" data-language="sql">SELECT *
FROM iceberg_metadata('data/iceberg/lineitem_iceberg', allow_moved_paths = true);</pre>  <table> <thead> <tr> <th>manifest_path</th> <th>manifest_sequence_number</th> <th>manifest_content</th> <th>status</th> <th>content</th> <th>file_path</th> <th>file_format</th> <th>record_count</th> </tr> </thead> <tbody> <tr> <td>lineitem_iceberg/metadata/10eaca8a-1e1c-421e-ad6d-b232e5ee23d3-m1.avro</td> <td>2</td> <td>DATA</td> <td>ADDED</td> <td>EXISTING</td> <td>lineitem_iceberg/data/00041-414-f3c73457-bbd6-4b92-9c15-17b241171b16-00001.parquet</td> <td>PARQUET</td> <td>51793</td> </tr> <tr> <td>lineitem_iceberg/metadata/10eaca8a-1e1c-421e-ad6d-b232e5ee23d3-m0.avro</td> <td>2</td> <td>DATA</td> <td>DELETED</td> <td>EXISTING</td> <td>lineitem_iceberg/data/00000-411-0792dcfe-4e25-4ca3-8ada-175286069a47-00001.parquet</td> <td>PARQUET</td> <td>60175</td> </tr> </tbody> </table> <h3 id="visualizing-snapshots"> <a style="text-decoration: none;" href="#visualizing-snapshots">Visualizing Snapshots</a> </h3> <pre class="language-sql highlighter-rouge" data-language="sql">SELECT *
FROM iceberg_snapshots('data/iceberg/lineitem_iceberg');</pre>  <table> <thead> <tr> <th>sequence_number</th> <th>snapshot_id</th> <th>timestamp_ms</th> <th>manifest_list</th> </tr> </thead> <tbody> <tr> <td>1</td> <td>3776207205136740581</td> <td>2023-02-15 15:07:54.504</td> <td>lineitem_iceberg/metadata/snap-3776207205136740581-1-cf3d0be5-cf70-453d-ad8f-48fdc412e608.avro</td> </tr> <tr> <td>2</td> <td>7635660646343998149</td> <td>2023-02-15 15:08:14.73</td> <td>lineitem_iceberg/metadata/snap-7635660646343998149-1-10eaca8a-1e1c-421e-ad6d-b232e5ee23d3.avro</td> </tr> </tbody> </table> <h2 id="limitations"> <a style="text-decoration: none;" href="#limitations">Limitations</a> </h2> <p>Writing (i.e., exporting to) Iceberg files is currently not supported.</p><div class="_attribution">
  <p class="_attribution-p">
    &copy; Copyright 2018&ndash;2024 Stichting DuckDB Foundation<br>Licensed under the MIT License.<br>
    <a href="https://duckdb.org/docs/extensions/iceberg.html" class="_attribution-link">https://duckdb.org/docs/extensions/iceberg.html</a>
  </p>
</div>
