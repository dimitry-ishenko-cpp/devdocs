<h1 class="title">SQLite Extension</h1>  <p>The SQLite extension allows DuckDB to directly read and write data from a SQLite database file. The data can be queried directly from the underlying SQLite tables. Data can be loaded from SQLite tables into DuckDB tables, or vice versa.</p> <h2 id="installing-and-loading"> <a style="text-decoration: none;" href="#installing-and-loading">Installing and Loading</a> </h2> <p>The <code class="language-plaintext highlighter-rouge">sqlite</code> extension will be transparently <a href="overview.html#autoloading-extensions.html">autoloaded</a> on first use from the official extension repository. If you would like to install and load it manually, run:</p> <pre class="language-sql highlighter-rouge" data-language="sql">INSTALL sqlite;
LOAD sqlite;</pre> <h2 id="usage"> <a style="text-decoration: none;" href="#usage">Usage</a> </h2> <p>To make a SQLite file accessible to DuckDB, use the <code class="language-plaintext highlighter-rouge">ATTACH</code> statement with the <code class="language-plaintext highlighter-rouge">SQLITE</code> or <code class="language-plaintext highlighter-rouge">SQLITE_SCANNER</code> type. Attached SQLite databases support both read and write operations.</p> <p>For example, to attach to the <a href="https://github.com/duckdb/sqlite_scanner/raw/main/data/db/sakila.db"><code class="language-plaintext highlighter-rouge">sakila.db</code> file</a>, run:</p> <pre class="language-sql highlighter-rouge" data-language="sql">ATTACH 'sakila.db' (TYPE SQLITE);
USE sakila;</pre> <p>The tables in the file can be read as if they were normal DuckDB tables, but the underlying data is read directly from the SQLite tables in the file at query time.</p> <pre class="language-sql highlighter-rouge" data-language="sql">SHOW TABLES;</pre>  <table> <thead> <tr> <th>name</th> </tr> </thead> <tbody> <tr> <td>actor</td> </tr> <tr> <td>address</td> </tr> <tr> <td>category</td> </tr> <tr> <td>city</td> </tr> <tr> <td>country</td> </tr> <tr> <td>customer</td> </tr> <tr> <td>customer_list</td> </tr> <tr> <td>film</td> </tr> <tr> <td>film_actor</td> </tr> <tr> <td>film_category</td> </tr> <tr> <td>film_list</td> </tr> <tr> <td>film_text</td> </tr> <tr> <td>inventory</td> </tr> <tr> <td>language</td> </tr> <tr> <td>payment</td> </tr> <tr> <td>rental</td> </tr> <tr> <td>sales_by_film_category</td> </tr> <tr> <td>sales_by_store</td> </tr> <tr> <td>staff</td> </tr> <tr> <td>staff_list</td> </tr> <tr> <td>store</td> </tr> </tbody> </table> <p>You can query the tables using SQL, e.g., using the example queries from <a href="https://github.com/duckdb/sqlite_scanner/blob/main/data/sql/sakila-examples.sql"><code class="language-plaintext highlighter-rouge">sakila-examples.sql</code></a>:</p> <pre class="language-sql highlighter-rouge" data-language="sql">SELECT
    cat.name AS category_name,
    sum(ifnull(pay.amount, 0)) AS revenue
FROM category cat
LEFT JOIN film_category flm_cat
       ON cat.category_id = flm_cat.category_id
LEFT JOIN film fil
       ON flm_cat.film_id = fil.film_id
LEFT JOIN inventory inv
       ON fil.film_id = inv.film_id
LEFT JOIN rental ren
       ON inv.inventory_id = ren.inventory_id
LEFT JOIN payment pay
       ON ren.rental_id = pay.rental_id
GROUP BY cat.name
ORDER BY revenue DESC
LIMIT 5;</pre> <h2 id="data-types"> <a style="text-decoration: none;" href="#data-types">Data Types</a> </h2> <p>SQLite is a <a href="https://www.sqlite.org/datatype3.html">weakly typed database system</a>. As such, when storing data in a SQLite table, types are not enforced. The following is valid SQL in SQLite:</p> <pre class="language-sql highlighter-rouge" data-language="sql">CREATE TABLE numbers (i INTEGER);
INSERT INTO numbers VALUES ('hello');</pre> <p>DuckDB is a strongly typed database system, as such, it requires all columns to have defined types and the system rigorously checks data for correctness.</p> <p>When querying SQLite, DuckDB must deduce a specific column type mapping. DuckDB follows SQLite's <a href="https://www.sqlite.org/datatype3.html#type_affinity">type affinity rules</a> with a few extensions.</p> <ol> <li>If the declared type contains the string <code class="language-plaintext highlighter-rouge">INT</code> then it is translated into the type <code class="language-plaintext highlighter-rouge">BIGINT</code>
</li> <li>If the declared type of the column contains any of the strings <code class="language-plaintext highlighter-rouge">CHAR</code>, <code class="language-plaintext highlighter-rouge">CLOB</code>, or <code class="language-plaintext highlighter-rouge">TEXT</code> then it is translated into <code class="language-plaintext highlighter-rouge">VARCHAR</code>.</li> <li>If the declared type for a column contains the string <code class="language-plaintext highlighter-rouge">BLOB</code> or if no type is specified then it is translated into <code class="language-plaintext highlighter-rouge">BLOB</code>.</li> <li>If the declared type for a column contains any of the strings <code class="language-plaintext highlighter-rouge">REAL</code>, <code class="language-plaintext highlighter-rouge">FLOA</code>, <code class="language-plaintext highlighter-rouge">DOUB</code>, <code class="language-plaintext highlighter-rouge">DEC</code> or <code class="language-plaintext highlighter-rouge">NUM</code> then it is translated into <code class="language-plaintext highlighter-rouge">DOUBLE</code>.</li> <li>If the declared type is <code class="language-plaintext highlighter-rouge">DATE</code>, then it is translated into <code class="language-plaintext highlighter-rouge">DATE</code>.</li> <li>If the declared type contains the string <code class="language-plaintext highlighter-rouge">TIME</code>, then it is translated into <code class="language-plaintext highlighter-rouge">TIMESTAMP</code>.</li> <li>If none of the above apply, then it is translated into <code class="language-plaintext highlighter-rouge">VARCHAR</code>.</li> </ol> <p>As DuckDB enforces the corresponding columns to contain only correctly typed values, we cannot load the string “hello” into a column of type <code class="language-plaintext highlighter-rouge">BIGINT</code>. As such, an error is thrown when reading from the “numbers” table above:</p> <pre class="language-console highlighter-rouge" data-language="console">Error: Mismatch Type Error: Invalid type in column "i": column was declared as integer, found "hello" of type "text" instead.</pre> <p>This error can be avoided by setting the <code class="language-plaintext highlighter-rouge">sqlite_all_varchar</code> option:</p> <pre class="language-sql highlighter-rouge" data-language="sql">SET GLOBAL sqlite_all_varchar = true;</pre> <p>When set, this option overrides the type conversion rules described above, and instead always converts the SQLite columns into a <code class="language-plaintext highlighter-rouge">VARCHAR</code> column. Note that this setting must be set <em>before</em> <code class="language-plaintext highlighter-rouge">sqlite_attach</code> is called.</p> <h2 id="opening-sqlite-databases-directly"> <a style="text-decoration: none;" href="#opening-sqlite-databases-directly">Opening SQLite Databases Directly</a> </h2> <p>SQLite databases can also be opened directly and can be used transparently instead of a DuckDB database file. In any client, when connecting, a path to a SQLite database file can be provided and the SQLite database will be opened instead.</p> <p>For example, with the shell, a SQLite database can be opened as follows:</p> <pre class="language-bash highlighter-rouge" data-language="bash">duckdb sakila.db</pre> <pre class="language-sql highlighter-rouge" data-language="sql">SELECT first_name
FROM actor
LIMIT 3;</pre> <table> <thead> <tr> <th>first_name</th> </tr> </thead> <tbody> <tr> <td>PENELOPE</td> </tr> <tr> <td>NICK</td> </tr> <tr> <td>ED</td> </tr> </tbody> </table> <h2 id="writing-data-to-sqlite"> <a style="text-decoration: none;" href="#writing-data-to-sqlite">Writing Data to SQLite</a> </h2> <p>In addition to reading data from SQLite, the extension also allows you to create new SQLite database files, create tables, ingest data into SQLite and make other modifications to SQLite database files using standard SQL queries.</p> <p>This allows you to use DuckDB to, for example, export data that is stored in a SQLite database to Parquet, or read data from a Parquet file into SQLite.</p> <p>Below is a brief example of how to create a new SQLite database and load data into it.</p> <pre class="language-sql highlighter-rouge" data-language="sql">ATTACH 'new_sqlite_database.db' AS sqlite_db (TYPE SQLITE);
CREATE TABLE sqlite_db.tbl (id INTEGER, name VARCHAR);
INSERT INTO sqlite_db.tbl VALUES (42, 'DuckDB');</pre> <p>The resulting SQLite database can then be read into from SQLite.</p> <pre class="language-bash highlighter-rouge" data-language="bash">sqlite3 new_sqlite_database.db</pre> <pre class="language-sql highlighter-rouge" data-language="sql">SQLite version 3.39.5 2022-10-14 20:58:05
sqlite&gt; SELECT * FROM tbl;</pre> <pre class="language-text highlighter-rouge" data-language="text">id  name  
--  ------
42  DuckDB</pre> <p>Many operations on SQLite tables are supported. All these operations directly modify the SQLite database, and the result of subsequent operations can then be read using SQLite.</p> <h2 id="concurrency"> <a style="text-decoration: none;" href="#concurrency">Concurrency</a> </h2> <p>DuckDB can read or modify a SQLite database while DuckDB or SQLite reads or modifies the same database from a different thread or a separate process. More than one thread or process can read the SQLite database at the same time, but only a single thread or process can write to the database at one time. Database locking is handled by the SQLite library, not DuckDB. Within the same process, SQLite uses mutexes. When accessed from different processes, SQLite uses file system locks. The locking mechanisms also depend on SQLite configuration, like WAL mode. Refer to the <a href="https://www.sqlite.org/lockingv3.html">SQLite documentation on locking</a> for more information.</p> <blockquote> <p>Warning Linking multiple copies of the SQLite library into the same application can lead to application errors. See <a href="https://github.com/duckdb/sqlite_scanner/issues/82">sqlite_scanner Issue #82</a> for more information.</p> </blockquote> <h2 id="supported-operations"> <a style="text-decoration: none;" href="#supported-operations">Supported Operations</a> </h2> <p>Below is a list of supported operations.</p> <h3 id="create-table"> <a style="text-decoration: none;" href="#create-table"><code class="language-plaintext highlighter-rouge">CREATE TABLE</code></a> </h3> <pre class="language-sql highlighter-rouge" data-language="sql">CREATE TABLE sqlite_db.tbl (id INTEGER, name VARCHAR);</pre> <h3 id="insert-into"> <a style="text-decoration: none;" href="#insert-into"><code class="language-plaintext highlighter-rouge">INSERT INTO</code></a> </h3> <pre class="language-sql highlighter-rouge" data-language="sql">INSERT INTO sqlite_db.tbl VALUES (42, 'DuckDB');</pre> <h3 id="select"> <a style="text-decoration: none;" href="#select"><code class="language-plaintext highlighter-rouge">SELECT</code></a> </h3> <pre class="language-sql highlighter-rouge" data-language="sql">SELECT * FROM sqlite_db.tbl;</pre> <table> <thead> <tr> <th style="text-align: right">id</th> <th>name</th> </tr> </thead> <tbody> <tr> <td style="text-align: right">42</td> <td>DuckDB</td> </tr> </tbody> </table> <h3 id="copy"> <a style="text-decoration: none;" href="#copy"><code class="language-plaintext highlighter-rouge">COPY</code></a> </h3> <pre class="language-sql highlighter-rouge" data-language="sql">COPY sqlite_db.tbl TO 'data.parquet';
COPY sqlite_db.tbl FROM 'data.parquet';</pre> <h3 id="update"> <a style="text-decoration: none;" href="#update"><code class="language-plaintext highlighter-rouge">UPDATE</code></a> </h3> <pre class="language-sql highlighter-rouge" data-language="sql">UPDATE sqlite_db.tbl SET name = 'Woohoo' WHERE id = 42;</pre> <h3 id="delete"> <a style="text-decoration: none;" href="#delete"><code class="language-plaintext highlighter-rouge">DELETE</code></a> </h3> <pre class="language-sql highlighter-rouge" data-language="sql">DELETE FROM sqlite_db.tbl WHERE id = 42;</pre> <h3 id="alter-table"> <a style="text-decoration: none;" href="#alter-table"><code class="language-plaintext highlighter-rouge">ALTER TABLE</code></a> </h3> <pre class="language-sql highlighter-rouge" data-language="sql">ALTER TABLE sqlite_db.tbl ADD COLUMN k INTEGER;</pre> <h3 id="drop-table"> <a style="text-decoration: none;" href="#drop-table"><code class="language-plaintext highlighter-rouge">DROP TABLE</code></a> </h3> <pre class="language-sql highlighter-rouge" data-language="sql">DROP TABLE sqlite_db.tbl;</pre> <h3 id="create-view"> <a style="text-decoration: none;" href="#create-view"><code class="language-plaintext highlighter-rouge">CREATE VIEW</code></a> </h3> <pre class="language-sql highlighter-rouge" data-language="sql">CREATE VIEW sqlite_db.v1 AS SELECT 42;</pre> <h3 id="transactions"> <a style="text-decoration: none;" href="#transactions">Transactions</a> </h3> <pre class="language-sql highlighter-rouge" data-language="sql">CREATE TABLE sqlite_db.tmp (i INTEGER);</pre> <pre class="language-sql highlighter-rouge" data-language="sql">BEGIN;
INSERT INTO sqlite_db.tmp VALUES (42);
SELECT * FROM sqlite_db.tmp;</pre> <table> <thead> <tr> <th style="text-align: right">i</th> </tr> </thead> <tbody> <tr> <td style="text-align: right">42</td> </tr> </tbody> </table> <pre class="language-sql highlighter-rouge" data-language="sql">ROLLBACK;
SELECT * FROM sqlite_db.tmp;</pre> <table> <thead> <tr> <th style="text-align: right">i</th> </tr> </thead> <tbody> <tr> <td style="text-align: right"> </td> </tr> </tbody> </table> <blockquote> <p>Deprecated The old <code class="language-plaintext highlighter-rouge">sqlite_attach</code> function is deprecated. It is recommended to switch over to the new <a href="../sql/statements/attach.html"><code class="language-plaintext highlighter-rouge">ATTACH</code> syntax</a>.</p> </blockquote><div class="_attribution">
  <p class="_attribution-p">
    &copy; Copyright 2018&ndash;2024 Stichting DuckDB Foundation<br>Licensed under the MIT License.<br>
    <a href="https://duckdb.org/docs/extensions/sqlite.html" class="_attribution-link">https://duckdb.org/docs/extensions/sqlite.html</a>
  </p>
</div>
