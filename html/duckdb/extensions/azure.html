<h1 class="title">Azure Extension</h1>  <p>The <code class="language-plaintext highlighter-rouge">azure</code> extension is a loadable extension that adds a filesystem abstraction for the <a href="https://azure.microsoft.com/en-us/products/storage/blobs">Azure Blob storage</a> to DuckDB.</p> <h2 id="installing-and-loading"> <a style="text-decoration: none;" href="#installing-and-loading">Installing and Loading</a> </h2> <p>The <code class="language-plaintext highlighter-rouge">azure</code> extension will be transparently <a href="overview.html#autoloading-extensions.html">autoloaded</a> on first use from the official extension repository. If you would like to install and load it manually, run:</p> <pre class="language-sql highlighter-rouge" data-language="sql">INSTALL azure;
LOAD azure;</pre> <h2 id="usage"> <a style="text-decoration: none;" href="#usage">Usage</a> </h2> <p>Once the <a href="#authentication">authentication</a> is set up, you can query Azure storage as follows:</p> <h3 id="azure-blob-storage"> <a style="text-decoration: none;" href="#azure-blob-storage">Azure Blob Storage</a> </h3> <p>Allowed URI schemes: <code class="language-plaintext highlighter-rouge">az</code> or <code class="language-plaintext highlighter-rouge">azure</code></p> <pre class="language-sql highlighter-rouge" data-language="sql">SELECT count(*)
FROM 'az://⟨my_container⟩/⟨path⟩/⟨my_file⟩.⟨parquet_or_csv⟩';</pre> <p>Globs are also supported:</p> <pre class="language-sql highlighter-rouge" data-language="sql">SELECT *
FROM 'az://⟨my_container⟩/⟨path⟩/*.csv';</pre> <pre class="language-sql highlighter-rouge" data-language="sql">SELECT *
FROM 'az://⟨my_container⟩/⟨path⟩/**';</pre> <p>Or with a fully qualified path syntax:</p> <pre class="language-sql highlighter-rouge" data-language="sql">SELECT count(*)
FROM 'az://⟨my_storage_account⟩.blob.core.windows.net/⟨my_container⟩/⟨path⟩/⟨my_file⟩.⟨parquet_or_csv⟩';</pre> <pre class="language-sql highlighter-rouge" data-language="sql">SELECT *
FROM 'az://⟨my_storage_account⟩.blob.core.windows.net/⟨my_container⟩/⟨path⟩/*.csv';</pre> <h3 id="azure-data-lake-storage-adls"> <a style="text-decoration: none;" href="#azure-data-lake-storage-adls">Azure Data Lake Storage (ADLS)</a> </h3> <p>Allowed URI schemes: <code class="language-plaintext highlighter-rouge">abfss</code></p> <pre class="language-sql highlighter-rouge" data-language="sql">SELECT count(*)
FROM 'abfss://⟨my_filesystem⟩/⟨path⟩/⟨my_file⟩.⟨parquet_or_csv⟩';</pre> <p>Globs are also supported:</p> <pre class="language-sql highlighter-rouge" data-language="sql">SELECT *
FROM 'abfss://⟨my_filesystem⟩/⟨path⟩/*.csv';</pre> <pre class="language-sql highlighter-rouge" data-language="sql">SELECT *
FROM 'abfss://⟨my_filesystem⟩/⟨path⟩/**';</pre> <p>Or with a fully qualified path syntax:</p> <pre class="language-sql highlighter-rouge" data-language="sql">SELECT count(*)
FROM 'abfss://⟨my_storage_account⟩.dfs.core.windows.net/⟨my_filesystem⟩/⟨path⟩/⟨my_file⟩.⟨parquet_or_csv⟩';</pre> <pre class="language-sql highlighter-rouge" data-language="sql">SELECT *
FROM 'abfss://⟨my_storage_account⟩.dfs.core.windows.net/⟨my_filesystem⟩/⟨path⟩/*.csv';</pre> <h2 id="configuration"> <a style="text-decoration: none;" href="#configuration">Configuration</a> </h2> <p>Use the following <a href="../configuration/overview.html">configuration options</a> how the extension reads remote files:</p> <table> <thead> <tr> <th style="text-align: left">Name</th> <th style="text-align: left">Description</th> <th style="text-align: left">Type</th> <th style="text-align: left">Default</th> </tr> </thead> <tbody> <tr> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">azure_http_stats</code></td> <td style="text-align: left">Include http info from Azure Storage in the <a href="../dev/profiling.html"><code class="language-plaintext highlighter-rouge">EXPLAIN ANALYZE</code> statement</a>.</td> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">BOOLEAN</code></td> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">false</code></td> </tr> <tr> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">azure_read_transfer_concurrency</code></td> <td style="text-align: left">Maximum number of threads the Azure client can use for a single parallel read. If <code class="language-plaintext highlighter-rouge">azure_read_transfer_chunk_size</code> is less than <code class="language-plaintext highlighter-rouge">azure_read_buffer_size</code> then setting this &gt; 1 will allow the Azure client to do concurrent requests to fill the buffer.</td> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">BIGINT</code></td> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">5</code></td> </tr> <tr> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">azure_read_transfer_chunk_size</code></td> <td style="text-align: left">Maximum size in bytes that the Azure client will read in a single request. It is recommended that this is a factor of <code class="language-plaintext highlighter-rouge">azure_read_buffer_size</code>.</td> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">BIGINT</code></td> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">1024*1024</code></td> </tr> <tr> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">azure_read_buffer_size</code></td> <td style="text-align: left">Size of the read buffer. It is recommended that this is evenly divisible by <code class="language-plaintext highlighter-rouge">azure_read_transfer_chunk_size</code>.</td> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">UBIGINT</code></td> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">1024*1024</code></td> </tr> <tr> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">azure_transport_option_type</code></td> <td style="text-align: left">Underlying <a href="https://github.com/Azure/azure-sdk-for-cpp/blob/main/doc/HttpTransportAdapter.md">adapter</a> to use in the Azure SDK. Valid values are: <code class="language-plaintext highlighter-rouge">default</code> or <code class="language-plaintext highlighter-rouge">curl</code>.</td> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">VARCHAR</code></td> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">default</code></td> </tr> <tr> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">azure_context_caching</code></td> <td style="text-align: left">Enable/disable the caching of the underlying Azure SDK HTTP connection in the DuckDB connection context when performing queries. If you suspect that this is causing some side effect, you can try to disable it by setting it to false (not recommended).</td> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">BOOLEAN</code></td> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">true</code></td> </tr> </tbody> </table> <blockquote> <p>Setting <code class="language-plaintext highlighter-rouge">azure_transport_option_type</code> explicitly to <code class="language-plaintext highlighter-rouge">curl</code> with have the following effect:</p> <ul> <li>On Linux, this may solve certificates issue (<code class="language-plaintext highlighter-rouge">Error: Invalid Error: Fail to get a new connection for: https://⟨storage account name⟩.blob.core.windows.net/. Problem with the SSL CA cert (path? access rights?)</code>) because when specifying the extension will try to find the bundle certificate in various paths (that is not done by <em>curl</em> by default and might be wrong due to static linking).</li> <li>On Windows, this replaces the default adapter (<em>WinHTTP</em>) allowing you to use all <em>curl</em> capabilities (for example using a socks proxies).</li> <li>On all operating systems, it will honor the following environment variables: <ul> <li>
<code class="language-plaintext highlighter-rouge">CURL_CA_INFO</code>: Path to a PEM encoded file containing the certificate authorities sent to libcurl. Note that this option is known to only work on Linux and might throw if set on other platforms.</li> <li>
<code class="language-plaintext highlighter-rouge">CURL_CA_PATH</code>: Path to a directory which holds PEM encoded file, containing the certificate authorities sent to libcurl.</li> </ul> </li> </ul> </blockquote> <p>Example:</p> <pre class="language-sql highlighter-rouge" data-language="sql">SET azure_http_stats = false;
SET azure_read_transfer_concurrency = 5;
SET azure_read_transfer_chunk_size = 1_048_576;
SET azure_read_buffer_size = 1_048_576;</pre> <h2 id="authentication"> <a style="text-decoration: none;" href="#authentication">Authentication</a> </h2> <p>The Azure extension has two ways to configure the authentication. The preferred way is to use Secrets.</p> <h3 id="authentication-with-secret"> <a style="text-decoration: none;" href="#authentication-with-secret">Authentication with Secret</a> </h3> <p>Multiple <a href="../configuration/secrets_manager.html#secret-providers.html">Secret Providers</a> are available for the Azure extension:</p> <ul> <li>If you need to define different secrets for different storage accounts, use <a href="../configuration/secrets_manager.html#creating-multiple-secrets-for-the-same-service-type.html">the <code class="language-plaintext highlighter-rouge">SCOPE</code> configuration</a>. Note that the <code class="language-plaintext highlighter-rouge">SCOPE</code> requires a trailing slash (<code class="language-plaintext highlighter-rouge">SCOPE 'azure://some_container/'</code>).</li> <li>If you use fully qualified path then the <code class="language-plaintext highlighter-rouge">ACCOUNT_NAME</code> attribute is optional.</li> </ul> <h4 id="config-provider"> <a style="text-decoration: none;" href="#config-provider"><code class="language-plaintext highlighter-rouge">CONFIG</code> Provider</a> </h4> <p>The default provider, <code class="language-plaintext highlighter-rouge">CONFIG</code> (i.e., user-configured), allows access to the storage account using a connection string or anonymously. For example:</p> <pre class="language-sql highlighter-rouge" data-language="sql">CREATE SECRET secret1 (
    TYPE AZURE,
    CONNECTION_STRING '⟨value⟩'
);</pre> <p>If you do not use authentication, you still need to specify the storage account name. For example:</p> <pre class="language-sql highlighter-rouge" data-language="sql">CREATE SECRET secret2 (
    TYPE AZURE,
    PROVIDER CONFIG,
    ACCOUNT_NAME '⟨storage account name⟩'
);</pre> <p>The default <code class="language-plaintext highlighter-rouge">PROVIDER</code> is <code class="language-plaintext highlighter-rouge">CONFIG</code>.</p> <h4 id="credential_chain-provider"> <a style="text-decoration: none;" href="#credential_chain-provider"><code class="language-plaintext highlighter-rouge">CREDENTIAL_CHAIN</code> Provider</a> </h4> <p>The <code class="language-plaintext highlighter-rouge">CREDENTIAL_CHAIN</code> provider allows connecting using credentials automatically fetched by the Azure SDK via the Azure credential chain. By default, the <code class="language-plaintext highlighter-rouge">DefaultAzureCredential</code> chain used, which tries credentials according to the order specified by the <a href="https://learn.microsoft.com/en-us/javascript/api/@azure/identity/defaultazurecredential?view=azure-node-latest#@azure-identity-defaultazurecredential-constructor">Azure documentation</a>. For example:</p> <pre class="language-sql highlighter-rouge" data-language="sql">CREATE SECRET secret3 (
    TYPE AZURE,
    PROVIDER CREDENTIAL_CHAIN,
    ACCOUNT_NAME '⟨storage account name⟩'
);</pre> <p>DuckDB also allows specifying a specific chain using the <code class="language-plaintext highlighter-rouge">CHAIN</code> keyword. This takes a semicolon-separated list (<code class="language-plaintext highlighter-rouge">a;b;c</code>) of providers that will be tried in order. For example:</p> <pre class="language-sql highlighter-rouge" data-language="sql">CREATE SECRET secret4 (
    TYPE AZURE,
    PROVIDER CREDENTIAL_CHAIN,
    CHAIN 'cli;env',
    ACCOUNT_NAME '⟨storage account name⟩'
);</pre> <p>The possible values are the following: <a href="https://learn.microsoft.com/en-us/cli/azure/authenticate-azure-cli"><code class="language-plaintext highlighter-rouge">cli</code></a>; <a href="https://learn.microsoft.com/en-us/entra/identity/managed-identities-azure-resources/overview"><code class="language-plaintext highlighter-rouge">managed_identity</code></a>; <a href="https://github.com/Azure/azure-sdk-for-cpp/blob/azure-identity_1.6.0/sdk/identity/azure-identity/README.md#environment-variables"><code class="language-plaintext highlighter-rouge">env</code></a>; <a href="https://github.com/Azure/azure-sdk-for-cpp/blob/azure-identity_1.6.0/sdk/identity/azure-identity/README.md#defaultazurecredential"><code class="language-plaintext highlighter-rouge">default</code></a>;</p> <p>If no explicit <code class="language-plaintext highlighter-rouge">CHAIN</code> is provided, the default one will be <a href="https://github.com/Azure/azure-sdk-for-cpp/blob/azure-identity_1.6.0/sdk/identity/azure-identity/README.md#defaultazurecredential"><code class="language-plaintext highlighter-rouge">default</code></a></p> <h4 id="service_principal-provider"> <a style="text-decoration: none;" href="#service_principal-provider"><code class="language-plaintext highlighter-rouge">SERVICE_PRINCIPAL</code> Provider</a> </h4> <p>The <code class="language-plaintext highlighter-rouge">SERVICE_PRINCIPAL</code> provider allows connecting using a <a href="https://learn.microsoft.com/en-us/entra/architecture/service-accounts-principal">Azure Service Principal (SPN)</a>.</p> <p>Either with a secret:</p> <pre class="language-sql highlighter-rouge" data-language="sql">CREATE SECRET azure_spn (
    TYPE AZURE,
    PROVIDER SERVICE_PRINCIPAL,
    TENANT_ID '⟨tenant id⟩',
    CLIENT_ID '⟨client id⟩',
    CLIENT_SECRET '⟨client secret⟩',
    ACCOUNT_NAME '⟨storage account name⟩'
);</pre> <p>Or with a certificate:</p> <pre class="language-sql highlighter-rouge" data-language="sql">CREATE SECRET azure_spn_cert (
    TYPE AZURE,
    PROVIDER SERVICE_PRINCIPAL,
    TENANT_ID '⟨tenant id⟩',
    CLIENT_ID '⟨client id⟩',
    CLIENT_CERTIFICATE_PATH '⟨client cert path⟩',
    ACCOUNT_NAME '⟨storage account name⟩'
);</pre> <h4 id="configuring-a-proxy"> <a style="text-decoration: none;" href="#configuring-a-proxy">Configuring a Proxy</a> </h4> <p>To configure proxy information when using secrets, you can add <code class="language-plaintext highlighter-rouge">HTTP_PROXY</code>, <code class="language-plaintext highlighter-rouge">PROXY_USER_NAME</code>, and <code class="language-plaintext highlighter-rouge">PROXY_PASSWORD</code> in the secret definition. For example:</p> <pre class="language-sql highlighter-rouge" data-language="sql">CREATE SECRET secret5 (
    TYPE AZURE,
    CONNECTION_STRING '⟨value⟩',
    HTTP_PROXY 'http://localhost:3128',
    PROXY_USER_NAME 'john',
    PROXY_PASSWORD 'doe'
);</pre> <blockquote> <ul> <li>When using secrets, the <code class="language-plaintext highlighter-rouge">HTTP_PROXY</code> environment variable will still be honored except if you provide an explicit value for it.</li> <li>When using secrets, the <code class="language-plaintext highlighter-rouge">SET</code> variable of the <em>Authentication with variables</em> session will be ignored.</li> <li>The Azure <code class="language-plaintext highlighter-rouge">CREDENTIAL_CHAIN</code> provider, the actual token is fetched at query time, not at the time of creating the secret.</li> </ul> </blockquote> <h3 id="authentication-with-variables-deprecated"> <a style="text-decoration: none;" href="#authentication-with-variables-deprecated">Authentication with Variables (Deprecated)</a> </h3> <pre class="language-sql highlighter-rouge" data-language="sql">SET variable_name = variable_value;</pre> <p>Where <code class="language-plaintext highlighter-rouge">variable_name</code> can be one of the following:</p> <table> <thead> <tr> <th style="text-align: left">Name</th> <th style="text-align: left">Description</th> <th style="text-align: left">Type</th> <th style="text-align: left">Default</th> </tr> </thead> <tbody> <tr> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">azure_storage_connection_string</code></td> <td style="text-align: left">Azure connection string, used for authenticating and configuring Azure requests.</td> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">STRING</code></td> <td style="text-align: left">-</td> </tr> <tr> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">azure_account_name</code></td> <td style="text-align: left">Azure account name, when set, the extension will attempt to automatically detect credentials (not used if you pass the connection string).</td> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">STRING</code></td> <td style="text-align: left">-</td> </tr> <tr> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">azure_endpoint</code></td> <td style="text-align: left">Override the Azure endpoint for when the Azure credential providers are used.</td> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">STRING</code></td> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">blob.core.windows.net</code></td> </tr> <tr> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">azure_credential_chain</code></td> <td style="text-align: left">Ordered list of Azure credential providers, in string format separated by <code class="language-plaintext highlighter-rouge">;</code>. For example: <code class="language-plaintext highlighter-rouge">'cli;managed_identity;env'</code>. See the list of possible values in the <a href="#credential_chain-provider"><code class="language-plaintext highlighter-rouge">CREDENTIAL_CHAIN</code> provider section</a>. Not used if you pass the connection string.</td> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">STRING</code></td> <td style="text-align: left">-</td> </tr> <tr> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">azure_http_proxy</code></td> <td style="text-align: left">Proxy to use when login &amp; performing request to Azure.</td> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">STRING</code></td> <td style="text-align: left">
<code class="language-plaintext highlighter-rouge">HTTP_PROXY</code> environment variable (if set).</td> </tr> <tr> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">azure_proxy_user_name</code></td> <td style="text-align: left">Http proxy username if needed.</td> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">STRING</code></td> <td style="text-align: left">-</td> </tr> <tr> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">azure_proxy_password</code></td> <td style="text-align: left">Http proxy password if needed.</td> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">STRING</code></td> <td style="text-align: left">-</td> </tr> </tbody> </table> <h2 id="additional-information"> <a style="text-decoration: none;" href="#additional-information">Additional Information</a> </h2> <h3 id="logging"> <a style="text-decoration: none;" href="#logging">Logging</a> </h3> <p>The Azure extension relies on the Azure SDK to connect to Azure Blob storage and supports printing the SDK logs to the console. To control the log level, set the <a href="https://github.com/Azure/azure-sdk-for-cpp/blob/main/sdk/core/azure-core/README.md#sdk-log-messages"><code class="language-plaintext highlighter-rouge">AZURE_LOG_LEVEL</code></a> environment variable.</p> <p>For instance, verbose logs can be enabled as follows in Python:</p> <pre class="language-python highlighter-rouge" data-language="python">import os
import duckdb

os.environ["AZURE_LOG_LEVEL"] = "verbose"

duckdb.sql("CREATE SECRET myaccount (TYPE AZURE, PROVIDER CREDENTIAL_CHAIN, SCOPE 'az://myaccount.blob.core.windows.net/')")
duckdb.sql("SELECT count(*) FROM 'az://myaccount.blob.core.windows.net/path/to/blob.parquet'")</pre> <h3 id="difference-between-adls-and-blob-storage"> <a style="text-decoration: none;" href="#difference-between-adls-and-blob-storage">Difference between ADLS and Blob Storage</a> </h3> <p>Even though ADLS implements similar functionality as the Blob storage, there are some important performance benefits to using the ADLS endpoints for globbing, especially when using (complex) glob patterns.</p> <p>To demonstrate, lets look at an example of how the a glob is performed internally using respectively the Glob and ADLS endpoints.</p> <p>Using the following filesystem:</p> <pre class="language-text highlighter-rouge" data-language="text">root
├── l_receipmonth=1997-10
│   ├── l_shipmode=AIR
│   │   └── data_0.csv
│   ├── l_shipmode=SHIP
│   │   └── data_0.csv
│   └── l_shipmode=TRUCK
│       └── data_0.csv
├── l_receipmonth=1997-11
│   ├── l_shipmode=AIR
│   │   └── data_0.csv
│   ├── l_shipmode=SHIP
│   │   └── data_0.csv
│   └── l_shipmode=TRUCK
│       └── data_0.csv
└── l_receipmonth=1997-12
    ├── l_shipmode=AIR
    │   └── data_0.csv
    ├── l_shipmode=SHIP
    │   └── data_0.csv
    └── l_shipmode=TRUCK
        └── data_0.csv</pre> <p>The following query performed through the blob endpoint</p> <pre class="language-sql highlighter-rouge" data-language="sql">SELECT count(*)
FROM 'az://root/l_receipmonth=1997-*/l_shipmode=SHIP/*.csv';</pre> <p>will perform the following steps:</p> <ul> <li>List all the files with the prefix <code class="language-plaintext highlighter-rouge">root/l_receipmonth=1997-</code> <ul> <li><code class="language-plaintext highlighter-rouge">root/l_receipmonth=1997-10/l_shipmode=SHIP/data_0.csv</code></li> <li><code class="language-plaintext highlighter-rouge">root/l_receipmonth=1997-10/l_shipmode=AIR/data_0.csv</code></li> <li><code class="language-plaintext highlighter-rouge">root/l_receipmonth=1997-10/l_shipmode=TRUCK/data_0.csv</code></li> <li><code class="language-plaintext highlighter-rouge">root/l_receipmonth=1997-11/l_shipmode=SHIP/data_0.csv</code></li> <li><code class="language-plaintext highlighter-rouge">root/l_receipmonth=1997-11/l_shipmode=AIR/data_0.csv</code></li> <li><code class="language-plaintext highlighter-rouge">root/l_receipmonth=1997-11/l_shipmode=TRUCK/data_0.csv</code></li> <li><code class="language-plaintext highlighter-rouge">root/l_receipmonth=1997-12/l_shipmode=SHIP/data_0.csv</code></li> <li><code class="language-plaintext highlighter-rouge">root/l_receipmonth=1997-12/l_shipmode=AIR/data_0.csv</code></li> <li><code class="language-plaintext highlighter-rouge">root/l_receipmonth=1997-12/l_shipmode=TRUCK/data_0.csv</code></li> </ul> </li> <li>Filter the result with the requested pattern <code class="language-plaintext highlighter-rouge">root/l_receipmonth=1997-*/l_shipmode=SHIP/*.csv</code> <ul> <li><code class="language-plaintext highlighter-rouge">root/l_receipmonth=1997-10/l_shipmode=SHIP/data_0.csv</code></li> <li><code class="language-plaintext highlighter-rouge">root/l_receipmonth=1997-11/l_shipmode=SHIP/data_0.csv</code></li> <li><code class="language-plaintext highlighter-rouge">root/l_receipmonth=1997-12/l_shipmode=SHIP/data_0.csv</code></li> </ul> </li> </ul> <p>Meanwhile, the same query performed through the datalake endpoint,</p> <pre class="language-sql highlighter-rouge" data-language="sql">SELECT count(*)
FROM 'abfss://root/l_receipmonth=1997-*/l_shipmode=SHIP/*.csv';</pre> <p>will perform the following steps:</p> <ul> <li>List all directories in <code class="language-plaintext highlighter-rouge">root/</code> <ul> <li><code class="language-plaintext highlighter-rouge">root/l_receipmonth=1997-10</code></li> <li><code class="language-plaintext highlighter-rouge">root/l_receipmonth=1997-11</code></li> <li><code class="language-plaintext highlighter-rouge">root/l_receipmonth=1997-12</code></li> </ul> </li> <li>Filter and list subdirectories: <code class="language-plaintext highlighter-rouge">root/l_receipmonth=1997-10</code>, <code class="language-plaintext highlighter-rouge">root/l_receipmonth=1997-11</code>, <code class="language-plaintext highlighter-rouge">root/l_receipmonth=1997-12</code> <ul> <li><code class="language-plaintext highlighter-rouge">root/l_receipmonth=1997-10/l_shipmode=SHIP</code></li> <li><code class="language-plaintext highlighter-rouge">root/l_receipmonth=1997-10/l_shipmode=AIR</code></li> <li><code class="language-plaintext highlighter-rouge">root/l_receipmonth=1997-10/l_shipmode=TRUCK</code></li> <li><code class="language-plaintext highlighter-rouge">root/l_receipmonth=1997-11/l_shipmode=SHIP</code></li> <li><code class="language-plaintext highlighter-rouge">root/l_receipmonth=1997-11/l_shipmode=AIR</code></li> <li><code class="language-plaintext highlighter-rouge">root/l_receipmonth=1997-11/l_shipmode=TRUCK</code></li> <li><code class="language-plaintext highlighter-rouge">root/l_receipmonth=1997-12/l_shipmode=SHIP</code></li> <li><code class="language-plaintext highlighter-rouge">root/l_receipmonth=1997-12/l_shipmode=AIR</code></li> <li><code class="language-plaintext highlighter-rouge">root/l_receipmonth=1997-12/l_shipmode=TRUCK</code></li> </ul> </li> <li>Filter and list subdirectories: <code class="language-plaintext highlighter-rouge">root/l_receipmonth=1997-10/l_shipmode=SHIP</code>, <code class="language-plaintext highlighter-rouge">root/l_receipmonth=1997-11/l_shipmode=SHIP</code>, <code class="language-plaintext highlighter-rouge">root/l_receipmonth=1997-12/l_shipmode=SHIP</code> <ul> <li><code class="language-plaintext highlighter-rouge">root/l_receipmonth=1997-10/l_shipmode=SHIP/data_0.csv</code></li> <li><code class="language-plaintext highlighter-rouge">root/l_receipmonth=1997-11/l_shipmode=SHIP/data_0.csv</code></li> <li><code class="language-plaintext highlighter-rouge">root/l_receipmonth=1997-12/l_shipmode=SHIP/data_0.csv</code></li> </ul> </li> </ul> <p>As you can see because the Blob endpoint does not support the notion of directories, the filter can only be performed after the listing, whereas the ADLS endpoint will list files recursively. Especially with higher partition/directory counts, the performance difference can be very significant.</p><div class="_attribution">
  <p class="_attribution-p">
    &copy; Copyright 2018&ndash;2024 Stichting DuckDB Foundation<br>Licensed under the MIT License.<br>
    <a href="https://duckdb.org/docs/extensions/azure.html" class="_attribution-link">https://duckdb.org/docs/extensions/azure.html</a>
  </p>
</div>
