<h1 class="title">TPC-H Extension</h1>  <p>The <code class="language-plaintext highlighter-rouge">tpch</code> extension implements the data generator and queries for the <a href="https://www.tpc.org/tpch/">TPC-H benchmark</a>.</p> <h2 id="installing-and-loading"> <a style="text-decoration: none;" href="#installing-and-loading">Installing and Loading</a> </h2> <p>The <code class="language-plaintext highlighter-rouge">tpch</code> extension is shipped by default in some DuckDB builds, otherwise it will be transparently <a href="overview.html#autoloading-extensions.html">autoloaded</a> on first use. If you would like to install and load it manually, run:</p> <pre class="language-sql highlighter-rouge" data-language="sql">INSTALL tpch;
LOAD tpch;</pre> <h2 id="usage"> <a style="text-decoration: none;" href="#usage">Usage</a> </h2> <h3 id="generating-data"> <a style="text-decoration: none;" href="#generating-data">Generating Data</a> </h3> <p>To generate data for scale factor 1, use:</p> <pre class="language-sql highlighter-rouge" data-language="sql">CALL dbgen(sf = 1);</pre> <p>Calling <code class="language-plaintext highlighter-rouge">dbgen</code> does not clean up existing TPC-H tables. To clean up existing tables, use <code class="language-plaintext highlighter-rouge">DROP TABLE</code> before running <code class="language-plaintext highlighter-rouge">dbgen</code>:</p> <pre class="language-sql highlighter-rouge" data-language="sql">DROP TABLE IF EXISTS customer;
DROP TABLE IF EXISTS lineitem;
DROP TABLE IF EXISTS nation;
DROP TABLE IF EXISTS orders;
DROP TABLE IF EXISTS part;
DROP TABLE IF EXISTS partsupp;
DROP TABLE IF EXISTS region;
DROP TABLE IF EXISTS supplier;</pre> <h3 id="running-a-query"> <a style="text-decoration: none;" href="#running-a-query">Running a Query</a> </h3> <p>To run a query, e.g., query 4, use:</p> <pre class="language-sql highlighter-rouge" data-language="sql">PRAGMA tpch(4);</pre> <table> <thead> <tr> <th>o_orderpriority</th> <th style="text-align: right">order_count</th> </tr> </thead> <tbody> <tr> <td>1-URGENT</td> <td style="text-align: right">10594</td> </tr> <tr> <td>2-HIGH</td> <td style="text-align: right">10476</td> </tr> <tr> <td>3-MEDIUM</td> <td style="text-align: right">10410</td> </tr> <tr> <td>4-NOT SPECIFIED</td> <td style="text-align: right">10556</td> </tr> <tr> <td>5-LOW</td> <td style="text-align: right">10487</td> </tr> </tbody> </table> <h3 id="listing-queries"> <a style="text-decoration: none;" href="#listing-queries">Listing Queries</a> </h3> <p>To list all 22 queries, run:</p> <pre class="language-sql highlighter-rouge" data-language="sql">FROM tpch_queries();</pre> <p>This function returns a table with columns <code class="language-plaintext highlighter-rouge">query_nr</code> and <code class="language-plaintext highlighter-rouge">query</code>.</p> <h3 id="listing-expected-answers"> <a style="text-decoration: none;" href="#listing-expected-answers">Listing Expected Answers</a> </h3> <p>To produced the expected results for all queries on scale factors 0.01, 0.1, and 1, run:</p> <pre class="language-sql highlighter-rouge" data-language="sql">FROM tpch_answers();</pre> <p>This function returns a table with columns <code class="language-plaintext highlighter-rouge">query_nr</code>, <code class="language-plaintext highlighter-rouge">scale_factor</code>, and <code class="language-plaintext highlighter-rouge">answer</code>.</p> <h2 id="generating-the-schema"> <a style="text-decoration: none;" href="#generating-the-schema">Generating the Schema</a> </h2> <p>It's possible to generate the schema of TPC-H without any data by setting the scale factor to 0:</p> <pre class="language-sql highlighter-rouge" data-language="sql">CALL dbgen(sf = 0);</pre> <h2 id="data-generator-parameters"> <a style="text-decoration: none;" href="#data-generator-parameters">Data Generator Parameters</a> </h2> <p>The data generator function <code class="language-plaintext highlighter-rouge">dbgen</code> has the following parameters:</p>  <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code class="language-plaintext highlighter-rouge">catalog</code></td> <td><code class="language-plaintext highlighter-rouge">VARCHAR</code></td> <td>Target catalog</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">children</code></td> <td><code class="language-plaintext highlighter-rouge">UINTEGER</code></td> <td>Number of partitions</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">overwrite</code></td> <td><code class="language-plaintext highlighter-rouge">BOOLEAN</code></td> <td>(Not used)</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">sf</code></td> <td><code class="language-plaintext highlighter-rouge">DOUBLE</code></td> <td>Scale factor</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">step</code></td> <td><code class="language-plaintext highlighter-rouge">UINTEGER</code></td> <td>Defines the partition to be generated, indexed from 0 to <code class="language-plaintext highlighter-rouge">children</code> - 1. Must be defined when the <code class="language-plaintext highlighter-rouge">children</code> arguments is defined</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">suffix</code></td> <td><code class="language-plaintext highlighter-rouge">VARCHAR</code></td> <td>Append the <code class="language-plaintext highlighter-rouge">suffix</code> to table names</td> </tr> </tbody> </table> <h2 id="pre-generated-data-sets"> <a style="text-decoration: none;" href="#pre-generated-data-sets">Pre-Generated Data Sets</a> </h2> <p>Pre-generated DuckDB databases for TPC-H are available for download:</p> <ul> <li>
<a href="https://blobs.duckdb.org/data/tpch-sf1.db"><code class="language-plaintext highlighter-rouge">tpch-sf1.db</code></a> (250 MB)</li> <li>
<a href="https://blobs.duckdb.org/data/tpch-sf3.db"><code class="language-plaintext highlighter-rouge">tpch-sf3.db</code></a> (754 MB)</li> <li>
<a href="https://blobs.duckdb.org/data/tpch-sf10.db"><code class="language-plaintext highlighter-rouge">tpch-sf10.db</code></a> (2.5 GB)</li> <li>
<a href="https://blobs.duckdb.org/data/tpch-sf30.db"><code class="language-plaintext highlighter-rouge">tpch-sf30.db</code></a> (7.6 GB)</li> <li>
<a href="https://blobs.duckdb.org/data/tpch-sf100.db"><code class="language-plaintext highlighter-rouge">tpch-sf100.db</code></a> (26 GB)</li> <li>
<a href="https://blobs.duckdb.org/data/tpch-sf300.db"><code class="language-plaintext highlighter-rouge">tpch-sf300.db</code></a> (78 GB)</li> <li>
<a href="https://blobs.duckdb.org/data/tpch-sf1000.db"><code class="language-plaintext highlighter-rouge">tpch-sf1000.db</code></a> (265 GB)</li> <li>
<a href="https://blobs.duckdb.org/data/tpch-sf3000.db"><code class="language-plaintext highlighter-rouge">tpch-sf3000.db</code></a> (796 GB)</li> </ul> <h2 id="resource-usage-of-the-data-generator"> <a style="text-decoration: none;" href="#resource-usage-of-the-data-generator">Resource Usage of the Data Generator</a> </h2> <p>Generating TPC-H data sets for large scale factors takes a significant amount of time. Additionally, when the generation is done in a single step, it requires a large amount of memory. The following table gives an estimate on the resources required to produce DuckDB database files containing the generated TPC-H data set using 128 threads.</p> <table> <thead> <tr> <th style="text-align: right">Scale factor</th> <th style="text-align: right">Database size</th> <th style="text-align: right">Data generation time</th> <th style="text-align: right">Generator's memory usage</th> </tr> </thead> <tbody> <tr> <td style="text-align: right">100</td> <td style="text-align: right">26 GB</td> <td style="text-align: right">17 minutes</td> <td style="text-align: right">71 GB</td> </tr> <tr> <td style="text-align: right">300</td> <td style="text-align: right">78 GB</td> <td style="text-align: right">51 minutes</td> <td style="text-align: right">211 GB</td> </tr> <tr> <td style="text-align: right">1000</td> <td style="text-align: right">265 GB</td> <td style="text-align: right">2h 53 minutes</td> <td style="text-align: right">647 GB</td> </tr> <tr> <td style="text-align: right">3000</td> <td style="text-align: right">796 GB</td> <td style="text-align: right">8h 30 minutes</td> <td style="text-align: right">1799 GB</td> </tr> </tbody> </table> <p>The numbers shown above were achieved by running the <code class="language-plaintext highlighter-rouge">dbgen</code> function in a single step, for example:</p> <pre class="language-sql highlighter-rouge" data-language="sql">CALL dbgen(sf = 300);</pre> <p>If you have a limited amount of memory available, you can run the <code class="language-plaintext highlighter-rouge">dbgen</code> function in steps. For example, you may generate SF300 in 10 steps:</p> <pre class="language-sql highlighter-rouge" data-language="sql">CALL dbgen(sf = 300, children = 10, step = 0);
CALL dbgen(sf = 300, children = 10, step = 1);
...
CALL dbgen(sf = 300, children = 10, step = 9);</pre> <h2 id="limitation"> <a style="text-decoration: none;" href="#limitation">Limitation</a> </h2> <p>The <code class="language-plaintext highlighter-rouge">tpch(⟨query_id⟩)</code> function runs a fixed TPC-H query with pre-defined bind parameters (a.k.a. substitution parameters). It is not possible to change the query parameters using the <code class="language-plaintext highlighter-rouge">tpch</code> extension. To run the queries with the parameters prescribed by the TPC-H benchmark, use a TPC-H framework implementation.</p><div class="_attribution">
  <p class="_attribution-p">
    &copy; Copyright 2018&ndash;2024 Stichting DuckDB Foundation<br>Licensed under the MIT License.<br>
    <a href="https://duckdb.org/docs/extensions/tpch.html" class="_attribution-link">https://duckdb.org/docs/extensions/tpch.html</a>
  </p>
</div>
