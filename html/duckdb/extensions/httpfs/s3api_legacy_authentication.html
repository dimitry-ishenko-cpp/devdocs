<h1 class="title">Legacy Authentication Scheme for S3 API</h1>  <p>Prior to version 0.10.0, DuckDB did not have a <a href="../../sql/statements/create_secret.html">Secrets manager</a>. Hence, the configuration of and authentication to S3 endpoints was handled via variables. This page documents the legacy authentication scheme for the S3 API.</p> <blockquote> <p>The recommended way to configuration and authentication of S3 endpoints is to use <a href="s3api.html#configuration-and-authentication.html">secrets</a>.</p> </blockquote> <h2 id="legacy-authentication-scheme"> <a style="text-decoration: none;" href="#legacy-authentication-scheme">Legacy Authentication Scheme</a> </h2> <p>To be able to read or write from S3, the correct region should be set:</p> <pre class="language-sql highlighter-rouge" data-language="sql">SET s3_region = 'us-east-1';</pre> <p>Optionally, the endpoint can be configured in case a non-AWS object storage server is used:</p> <pre class="language-sql highlighter-rouge" data-language="sql">SET s3_endpoint = '⟨domain⟩.⟨tld⟩:⟨port⟩';</pre> <p>If the endpoint is not SSL-enabled then run:</p> <pre class="language-sql highlighter-rouge" data-language="sql">SET s3_use_ssl = false;</pre> <p>Switching between <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/VirtualHosting.html#path-style-access">path-style</a> and <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/VirtualHosting.html#virtual-hosted-style-access">vhost-style</a> URLs is possible using:</p> <pre class="language-sql highlighter-rouge" data-language="sql">SET s3_url_style = 'path';</pre> <p>However, note that this may also require updating the endpoint. For example for AWS S3 it is required to change the endpoint to <code class="language-plaintext highlighter-rouge">s3.⟨region⟩.amazonaws.com</code>.</p> <p>After configuring the correct endpoint and region, public files can be read. To also read private files, authentication credentials can be added:</p> <pre class="language-sql highlighter-rouge" data-language="sql">SET s3_access_key_id = '⟨AWS access key id⟩';
SET s3_secret_access_key = '⟨AWS secret access key⟩';</pre> <p>Alternatively, session tokens are also supported and can be used instead:</p> <pre class="language-sql highlighter-rouge" data-language="sql">SET s3_session_token = '⟨AWS session token⟩';</pre> <p>The <a href="../aws.html"><code class="language-plaintext highlighter-rouge">aws</code> extension</a> allows for loading AWS credentials.</p> <h2 id="per-request-configuration"> <a style="text-decoration: none;" href="#per-request-configuration">Per-Request Configuration</a> </h2> <p>Aside from the global S3 configuration described above, specific configuration values can be used on a per-request basis. This allows for use of multiple sets of credentials, regions, etc. These are used by including them on the S3 URI as query parameters. All the individual configuration values listed above can be set as query parameters. For instance:</p> <pre class="language-sql highlighter-rouge" data-language="sql">SELECT *
FROM 's3://bucket/file.parquet?s3_access_key_id=accessKey&amp;s3_secret_access_key=secretKey';</pre> <p>Multiple configurations per query are also allowed:</p> <pre class="language-sql highlighter-rouge" data-language="sql">SELECT *
FROM 's3://bucket/file.parquet?s3_region=region&amp;s3_session_token=session_token' t1
INNER JOIN 's3://bucket/file.csv?s3_access_key_id=accessKey&amp;s3_secret_access_key=secretKey' t2;</pre> <h2 id="configuration"> <a style="text-decoration: none;" href="#configuration">Configuration</a> </h2> <p>Some additional configuration options exist for the S3 upload, though the default values should suffice for most use cases.</p> <p>Additionally, most of the configuration options can be set via environment variables:</p>  <table> <thead> <tr> <th style="text-align: left">DuckDB setting</th> <th style="text-align: left">Environment variable</th> <th style="text-align: left">Note</th> </tr> </thead> <tbody> <tr> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">s3_region</code></td> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">AWS_REGION</code></td> <td style="text-align: left">Takes priority over <code class="language-plaintext highlighter-rouge">AWS_DEFAULT_REGION</code>
</td> </tr> <tr> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">s3_region</code></td> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">AWS_DEFAULT_REGION</code></td> <td style="text-align: left"> </td> </tr> <tr> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">s3_access_key_id</code></td> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">AWS_ACCESS_KEY_ID</code></td> <td style="text-align: left"> </td> </tr> <tr> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">s3_secret_access_key</code></td> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">AWS_SECRET_ACCESS_KEY</code></td> <td style="text-align: left"> </td> </tr> <tr> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">s3_session_token</code></td> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">AWS_SESSION_TOKEN</code></td> <td style="text-align: left"> </td> </tr> <tr> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">s3_endpoint</code></td> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">DUCKDB_S3_ENDPOINT</code></td> <td style="text-align: left"> </td> </tr> <tr> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">s3_use_ssl</code></td> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">DUCKDB_S3_USE_SSL</code></td> <td style="text-align: left"> </td> </tr> </tbody> </table><div class="_attribution">
  <p class="_attribution-p">
    &copy; Copyright 2018&ndash;2024 Stichting DuckDB Foundation<br>Licensed under the MIT License.<br>
    <a href="https://duckdb.org/docs/extensions/httpfs/s3api_legacy_authentication.html" class="_attribution-link">https://duckdb.org/docs/extensions/httpfs/s3api_legacy_authentication.html</a>
  </p>
</div>
