<h1 class="title">Full-Text Search Extension</h1>  <p>Full-Text Search is an extension to DuckDB that allows for search through strings, similar to <a href="https://www.sqlite.org/fts5.html">SQLite's FTS5 extension</a>.</p> <h2 id="installing-and-loading"> <a style="text-decoration: none;" href="#installing-and-loading">Installing and Loading</a> </h2> <p>The <code class="language-plaintext highlighter-rouge">fts</code> extension will be transparently <a href="overview.html#autoloading-extensions.html">autoloaded</a> on first use from the official extension repository. If you would like to install and load it manually, run:</p> <pre class="language-sql highlighter-rouge" data-language="sql">INSTALL fts;
LOAD fts;</pre> <h2 id="usage"> <a style="text-decoration: none;" href="#usage">Usage</a> </h2> <p>The extension adds two <code class="language-plaintext highlighter-rouge">PRAGMA</code> statements to DuckDB: one to create, and one to drop an index. Additionally, a scalar macro <code class="language-plaintext highlighter-rouge">stem</code> is added, which is used internally by the extension.</p> <h3 id="pragma-create_fts_index"> <a style="text-decoration: none;" href="#pragma-create_fts_index"><code class="language-plaintext highlighter-rouge">PRAGMA create_fts_index</code></a> </h3> <pre class="language-python highlighter-rouge" data-language="python">create_fts_index(input_table, input_id, *input_values, stemmer = 'porter',
                 stopwords = 'english', ignore = '(\\.|[^a-z])+',
                 strip_accents = 1, lower = 1, overwrite = 0)</pre> <p><code class="language-plaintext highlighter-rouge">PRAGMA</code> that creates a FTS index for the specified table.</p>  <table> <thead> <tr> <th style="text-align: left">Name</th> <th style="text-align: left">Type</th> <th style="text-align: left">Description</th> </tr> </thead> <tbody> <tr> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">input_table</code></td> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">VARCHAR</code></td> <td style="text-align: left">Qualified name of specified table, e.g., <code class="language-plaintext highlighter-rouge">'table_name'</code> or <code class="language-plaintext highlighter-rouge">'main.table_name'</code>
</td> </tr> <tr> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">input_id</code></td> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">VARCHAR</code></td> <td style="text-align: left">Column name of document identifier, e.g., <code class="language-plaintext highlighter-rouge">'document_identifier'</code>
</td> </tr> <tr> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">input_values…</code></td> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">VARCHAR</code></td> <td style="text-align: left">Column names of the text fields to be indexed (vararg), e.g., <code class="language-plaintext highlighter-rouge">'text_field_1'</code>, <code class="language-plaintext highlighter-rouge">'text_field_2'</code>, …, <code class="language-plaintext highlighter-rouge">'text_field_N'</code>, or <code class="language-plaintext highlighter-rouge">'\*'</code> for all columns in input_table of type <code class="language-plaintext highlighter-rouge">VARCHAR</code>
</td> </tr> <tr> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">stemmer</code></td> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">VARCHAR</code></td> <td style="text-align: left">The type of stemmer to be used. One of <code class="language-plaintext highlighter-rouge">'arabic'</code>, <code class="language-plaintext highlighter-rouge">'basque'</code>, <code class="language-plaintext highlighter-rouge">'catalan'</code>, <code class="language-plaintext highlighter-rouge">'danish'</code>, <code class="language-plaintext highlighter-rouge">'dutch'</code>, <code class="language-plaintext highlighter-rouge">'english'</code>, <code class="language-plaintext highlighter-rouge">'finnish'</code>, <code class="language-plaintext highlighter-rouge">'french'</code>, <code class="language-plaintext highlighter-rouge">'german'</code>, <code class="language-plaintext highlighter-rouge">'greek'</code>, <code class="language-plaintext highlighter-rouge">'hindi'</code>, <code class="language-plaintext highlighter-rouge">'hungarian'</code>, <code class="language-plaintext highlighter-rouge">'indonesian'</code>, <code class="language-plaintext highlighter-rouge">'irish'</code>, <code class="language-plaintext highlighter-rouge">'italian'</code>, <code class="language-plaintext highlighter-rouge">'lithuanian'</code>, <code class="language-plaintext highlighter-rouge">'nepali'</code>, <code class="language-plaintext highlighter-rouge">'norwegian'</code>, <code class="language-plaintext highlighter-rouge">'porter'</code>, <code class="language-plaintext highlighter-rouge">'portuguese'</code>, <code class="language-plaintext highlighter-rouge">'romanian'</code>, <code class="language-plaintext highlighter-rouge">'russian'</code>, <code class="language-plaintext highlighter-rouge">'serbian'</code>, <code class="language-plaintext highlighter-rouge">'spanish'</code>, <code class="language-plaintext highlighter-rouge">'swedish'</code>, <code class="language-plaintext highlighter-rouge">'tamil'</code>, <code class="language-plaintext highlighter-rouge">'turkish'</code>, or <code class="language-plaintext highlighter-rouge">'none'</code> if no stemming is to be used. Defaults to <code class="language-plaintext highlighter-rouge">'porter'</code>
</td> </tr> <tr> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">stopwords</code></td> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">VARCHAR</code></td> <td style="text-align: left">Qualified name of table containing a single <code class="language-plaintext highlighter-rouge">VARCHAR</code> column containing the desired stopwords, or <code class="language-plaintext highlighter-rouge">'none'</code> if no stopwords are to be used. Defaults to <code class="language-plaintext highlighter-rouge">'english'</code> for a pre-defined list of 571 English stopwords</td> </tr> <tr> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">ignore</code></td> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">VARCHAR</code></td> <td style="text-align: left">Regular expression of patterns to be ignored. Defaults to <code class="language-plaintext highlighter-rouge">'(\\.|[^a-z])+'</code>, ignoring all escaped and non-alphabetic lowercase characters</td> </tr> <tr> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">strip_accents</code></td> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">BOOLEAN</code></td> <td style="text-align: left">Whether to remove accents (e.g., convert <code class="language-plaintext highlighter-rouge">á</code> to <code class="language-plaintext highlighter-rouge">a</code>). Defaults to <code class="language-plaintext highlighter-rouge">1</code>
</td> </tr> <tr> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">lower</code></td> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">BOOLEAN</code></td> <td style="text-align: left">Whether to convert all text to lowercase. Defaults to <code class="language-plaintext highlighter-rouge">1</code>
</td> </tr> <tr> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">overwrite</code></td> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">BOOLEAN</code></td> <td style="text-align: left">Whether to overwrite an existing index on a table. Defaults to <code class="language-plaintext highlighter-rouge">0</code>
</td> </tr> </tbody> </table>  <p>This <code class="language-plaintext highlighter-rouge">PRAGMA</code> builds the index under a newly created schema. The schema will be named after the input table: if an index is created on table <code class="language-plaintext highlighter-rouge">'main.table_name'</code>, then the schema will be named <code class="language-plaintext highlighter-rouge">'fts_main_table_name'</code>.</p> <h3 id="pragma-drop_fts_index"> <a style="text-decoration: none;" href="#pragma-drop_fts_index"><code class="language-plaintext highlighter-rouge">PRAGMA drop_fts_index</code></a> </h3> <pre class="language-python highlighter-rouge" data-language="python">drop_fts_index(input_table)</pre> <p>Drops a FTS index for the specified table.</p>  <table> <thead> <tr> <th style="text-align: left">Name</th> <th style="text-align: left">Type</th> <th style="text-align: left">Description</th> </tr> </thead> <tbody> <tr> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">input_table</code></td> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">VARCHAR</code></td> <td style="text-align: left">Qualified name of input table, e.g., <code class="language-plaintext highlighter-rouge">'table_name'</code> or <code class="language-plaintext highlighter-rouge">'main.table_name'</code>
</td> </tr> </tbody> </table> <h3 id="match_bm25-function"> <a style="text-decoration: none;" href="#match_bm25-function"><code class="language-plaintext highlighter-rouge">match_bm25</code> Function</a> </h3> <pre class="language-python highlighter-rouge" data-language="python">match_bm25(input_id, query_string, fields := NULL, k := 1.2, b := 0.75, conjunctive := 0)</pre> <p>When an index is built, this retrieval macro is created that can be used to search the index.</p> <table> <thead> <tr> <th style="text-align: left">Name</th> <th style="text-align: left">Type</th> <th style="text-align: left">Description</th> </tr> </thead> <tbody> <tr> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">input_id</code></td> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">VARCHAR</code></td> <td style="text-align: left">Column name of document identifier, e.g., <code class="language-plaintext highlighter-rouge">'document_identifier'</code>
</td> </tr> <tr> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">query_string</code></td> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">VARCHAR</code></td> <td style="text-align: left">The string to search the index for</td> </tr> <tr> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">fields</code></td> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">VARCHAR</code></td> <td style="text-align: left">Comma-separarated list of fields to search in, e.g., <code class="language-plaintext highlighter-rouge">'text_field_2, text_field_N'</code>. Defaults to <code class="language-plaintext highlighter-rouge">NULL</code> to search all indexed fields</td> </tr> <tr> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">k</code></td> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">DOUBLE</code></td> <td style="text-align: left">Parameter <em>k<sub>1</sub></em> in the Okapi BM25 retrieval model. Defaults to <code class="language-plaintext highlighter-rouge">1.2</code>
</td> </tr> <tr> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">b</code></td> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">DOUBLE</code></td> <td style="text-align: left">Parameter <em>b</em> in the Okapi BM25 retrieval model. Defaults to <code class="language-plaintext highlighter-rouge">0.75</code>
</td> </tr> <tr> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">conjunctive</code></td> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">BOOLEAN</code></td> <td style="text-align: left">Whether to make the query conjunctive i.e., all terms in the query string must be present in order for a document to be retrieved</td> </tr> </tbody> </table> <h3 id="stem-function"> <a style="text-decoration: none;" href="#stem-function"><code class="language-plaintext highlighter-rouge">stem</code> Function</a> </h3> <pre class="language-python highlighter-rouge" data-language="python">stem(input_string, stemmer)</pre> <p>Reduces words to their base. Used internally by the extension.</p> <table> <thead> <tr> <th style="text-align: left">Name</th> <th style="text-align: left">Type</th> <th style="text-align: left">Description</th> </tr> </thead> <tbody> <tr> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">input_string</code></td> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">VARCHAR</code></td> <td style="text-align: left">The column or constant to be stemmed.</td> </tr> <tr> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">stemmer</code></td> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">VARCHAR</code></td> <td style="text-align: left">The type of stemmer to be used. One of <code class="language-plaintext highlighter-rouge">'arabic'</code>, <code class="language-plaintext highlighter-rouge">'basque'</code>, <code class="language-plaintext highlighter-rouge">'catalan'</code>, <code class="language-plaintext highlighter-rouge">'danish'</code>, <code class="language-plaintext highlighter-rouge">'dutch'</code>, <code class="language-plaintext highlighter-rouge">'english'</code>, <code class="language-plaintext highlighter-rouge">'finnish'</code>, <code class="language-plaintext highlighter-rouge">'french'</code>, <code class="language-plaintext highlighter-rouge">'german'</code>, <code class="language-plaintext highlighter-rouge">'greek'</code>, <code class="language-plaintext highlighter-rouge">'hindi'</code>, <code class="language-plaintext highlighter-rouge">'hungarian'</code>, <code class="language-plaintext highlighter-rouge">'indonesian'</code>, <code class="language-plaintext highlighter-rouge">'irish'</code>, <code class="language-plaintext highlighter-rouge">'italian'</code>, <code class="language-plaintext highlighter-rouge">'lithuanian'</code>, <code class="language-plaintext highlighter-rouge">'nepali'</code>, <code class="language-plaintext highlighter-rouge">'norwegian'</code>, <code class="language-plaintext highlighter-rouge">'porter'</code>, <code class="language-plaintext highlighter-rouge">'portuguese'</code>, <code class="language-plaintext highlighter-rouge">'romanian'</code>, <code class="language-plaintext highlighter-rouge">'russian'</code>, <code class="language-plaintext highlighter-rouge">'serbian'</code>, <code class="language-plaintext highlighter-rouge">'spanish'</code>, <code class="language-plaintext highlighter-rouge">'swedish'</code>, <code class="language-plaintext highlighter-rouge">'tamil'</code>, <code class="language-plaintext highlighter-rouge">'turkish'</code>, or <code class="language-plaintext highlighter-rouge">'none'</code> if no stemming is to be used.</td> </tr> </tbody> </table> <h2 id="example-usage"> <a style="text-decoration: none;" href="#example-usage">Example Usage</a> </h2> <p>Create a table and fill it with text data:</p> <pre class="language-sql highlighter-rouge" data-language="sql">CREATE TABLE documents (
    document_identifier VARCHAR,
    text_content VARCHAR,
    author VARCHAR,
    doc_version INTEGER
);
INSERT INTO documents
    VALUES ('doc1',
            'The mallard is a dabbling duck that breeds throughout the temperate.',
            'Hannes Mühleisen',
            3),
           ('doc2',
            'The cat is a domestic species of small carnivorous mammal.',
            'Laurens Kuiper',
            2
           );</pre> <p>Build the index, and make both the <code class="language-plaintext highlighter-rouge">text_content</code> and <code class="language-plaintext highlighter-rouge">author</code> columns searchable.</p> <pre class="language-sql highlighter-rouge" data-language="sql">PRAGMA create_fts_index(
    'documents', 'document_identifier', 'text_content', 'author'
);</pre> <p>Search the <code class="language-plaintext highlighter-rouge">author</code> field index for documents that are authored by <code class="language-plaintext highlighter-rouge">Muhleisen</code>. This retrieves <code class="language-plaintext highlighter-rouge">doc1</code>:</p> <pre class="language-sql highlighter-rouge" data-language="sql">SELECT document_identifier, text_content, score
FROM (
    SELECT *, fts_main_documents.match_bm25(
        document_identifier,
        'Muhleisen',
        fields := 'author'
    ) AS score
    FROM documents
) sq
WHERE score IS NOT NULL
  AND doc_version &gt; 2
ORDER BY score DESC;</pre> <table> <thead> <tr> <th>document_identifier</th> <th>text_content</th> <th style="text-align: right">score</th> </tr> </thead> <tbody> <tr> <td>doc1</td> <td>The mallard is a dabbling duck that breeds throughout the temperate.</td> <td style="text-align: right">0.0</td> </tr> </tbody> </table> <p>Search for documents about <code class="language-plaintext highlighter-rouge">small cats</code>. This retrieves <code class="language-plaintext highlighter-rouge">doc2</code>:</p> <pre class="language-sql highlighter-rouge" data-language="sql">SELECT document_identifier, text_content, score
FROM (
    SELECT *, fts_main_documents.match_bm25(
        document_identifier,
        'small cats'
    ) AS score
    FROM documents
) sq
WHERE score IS NOT NULL
ORDER BY score DESC;</pre> <table> <thead> <tr> <th>document_identifier</th> <th>text_content</th> <th style="text-align: right">score</th> </tr> </thead> <tbody> <tr> <td>doc2</td> <td>The cat is a domestic species of small carnivorous mammal.</td> <td style="text-align: right">0.0</td> </tr> </tbody> </table> <blockquote> <p>Warning The FTS index will not update automatically when input table changes. A workaround of this limitation can be recreating the index to refresh.</p> </blockquote><div class="_attribution">
  <p class="_attribution-p">
    &copy; Copyright 2018&ndash;2024 Stichting DuckDB Foundation<br>Licensed under the MIT License.<br>
    <a href="https://duckdb.org/docs/extensions/full_text_search.html" class="_attribution-link">https://duckdb.org/docs/extensions/full_text_search.html</a>
  </p>
</div>
