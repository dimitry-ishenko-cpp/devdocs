<h1 class="title">Securing Extensions</h1>  <p>DuckDB has a powerful extension mechanism, which have the same privileges as the user running DuckDB's (parent) process. This introduces security considerations. Therefore, we recommend reviewing the configuration options listed on this page and setting them according to your attack models.</p> <h2 id="duckdb-signature-checks"> <a style="text-decoration: none;" href="#duckdb-signature-checks">DuckDB Signature Checks</a> </h2> <p>DuckDB extensions are checked on every load using the signature of the binaries. There are currently three categories of extensions:</p> <ul> <li>Signed with a <code class="language-plaintext highlighter-rouge">core</code> key. Only extensions vetted by the core DuckDB team are signed with these keys.</li> <li>Signed with a <code class="language-plaintext highlighter-rouge">community</code> key. These are open-source extensions distributed via the <a href="http://localhost:8000/community_extensions/">DuckDB Community Extensions repository</a>.</li> <li>Unsigned.</li> </ul> <h2 id="overview-of-security-levels-for-extensions"> <a style="text-decoration: none;" href="#overview-of-security-levels-for-extensions">Overview of Security Levels for Extensions</a> </h2> <p>DuckDB offers the following security levels for extensions.</p> <table> <thead> <tr> <th>Usable extensions</th> <th>Description</th> <th>Configuration</th> </tr> </thead> <tbody> <tr> <td>core</td> <td>Extensions can only be installed from the <code class="language-plaintext highlighter-rouge">core</code> repository.</td> <td><code class="language-plaintext highlighter-rouge">SET allow_community_extensions = false</code></td> </tr> <tr> <td>core and community</td> <td>Extensions can only be installed from the <code class="language-plaintext highlighter-rouge">core</code> and <code class="language-plaintext highlighter-rouge">community</code> repositories.</td> <td>This is the default security level.</td> </tr> <tr> <td>any extension incl. unsigned</td> <td>Any extensions can be installed.</td> <td><code class="language-plaintext highlighter-rouge">SET allow_unsigned_extensions = true</code></td> </tr> </tbody> </table> <p>Security-related configuration settings <a href="overview.html#locking-configurations.html">lock themselves</a>, i.e., it is only possible to restrict capabilities in the current process.</p> <p>For example, attempting the following configuration changes will result in an error:</p> <pre class="language-sql highlighter-rouge" data-language="sql">SET allow_community_extensions = false;
SET allow_community_extensions = true;</pre> <pre class="language-console highlighter-rouge" data-language="console">Invalid Input Error: Cannot upgrade allow_community_extensions setting while database is running</pre> <h2 id="community-extensions"> <a style="text-decoration: none;" href="#community-extensions">Community Extensions</a> </h2> <p>DuckDB has a <a href="../../extensions/community_extensions.html">Community Extensions repository</a>, which allows convenient installation of third-party extensions. Community extension repositories like pip or npm are essentially enabling remote code execution by design. This is less dramatic than it sounds. For better or worse, we are quite used to piping random scripts from the web into our shells, and routinely install a staggering amount of transitive dependencies without thinking twice. Some repositories like CRAN enforce a human inspection at some point, but that’s no guarantee for anything either.</p> <p>We’ve studied several different approaches to community extension repositories and have picked what we think is a sensible approach: we do not attempt to review the submissions, but require that the <em>source code of extensions is available</em>. We do take over the complete build, sign and distribution process. Note that this is a step up from pip and npm that allow uploading arbitrary binaries but a step down from reviewing everything manually. We allow users to <a href="https://github.com/duckdb/community-extensions/security/advisories/new">report malicious extensions</a> and show adoption statistics like GitHub stars and download count. Because we manage the repository, we can remove problematic extensions from distribution quickly.</p> <p>Despite this, installing and loading DuckDB extensions from the community extension repository will execute code written by third party developers, and therefore <em>can</em> be dangerous. A malicious developer could create and register a harmless-looking DuckDB extension that steals your crypto coins. If you’re running a web service that executes untrusted SQL from users with DuckDB, it is probably a good idea to disable community extension installation and loading entirely. This can be done like so:</p> <pre class="language-sql highlighter-rouge" data-language="sql">SET allow_community_extensions = false;</pre> <h2 id="disabling-autoinstalling-and-autoloading-known-extensions"> <a style="text-decoration: none;" href="#disabling-autoinstalling-and-autoloading-known-extensions">Disabling Autoinstalling and Autoloading Known Extensions</a> </h2> <p>By default, DuckDB automatically installs and loads known extensions.</p> <p>To disable autoinstalling known extensions, run:</p> <pre class="language-sql highlighter-rouge" data-language="sql">SET autoinstall_known_extensions = false;</pre> <p>To disable autoloading known extensions, run:</p> <pre class="language-sql highlighter-rouge" data-language="sql">SET autoload_known_extensions = false;</pre> <p>To lock this configuration, use the <a href="overview.html#locking-configurations.html"><code class="language-plaintext highlighter-rouge">lock_configuration</code> option</a>:</p> <pre class="language-sql highlighter-rouge" data-language="sql">SET lock_configuration = true;</pre> <h2 id="always-require-signed-extensions"> <a style="text-decoration: none;" href="#always-require-signed-extensions">Always Require Signed Extensions</a> </h2> <p>By default, DuckDB requires extensions to be either signed as core extensions (created by the DuckDB developers) or community extensions (created by third-party developers but distributed by the DuckDB developers). The <code class="language-plaintext highlighter-rouge">allow_unsigned_extensions</code> setting can be enabled on start-up to allow running extensions that are not signed at all. While useful for extension development, enabling this setting will allow DuckDB to load any extensions, which means more care must be taken to ensure malicious extensions are not loaded.</p><div class="_attribution">
  <p class="_attribution-p">
    &copy; Copyright 2018&ndash;2024 Stichting DuckDB Foundation<br>Licensed under the MIT License.<br>
    <a href="https://duckdb.org/docs/operations_manual/securing_duckdb/securing_extensions.html" class="_attribution-link">https://duckdb.org/docs/operations_manual/securing_duckdb/securing_extensions.html</a>
  </p>
</div>
