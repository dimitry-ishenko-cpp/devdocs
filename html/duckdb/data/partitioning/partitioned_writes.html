<h1 class="title">Partitioned Writes</h1>  <h2 id="examples"> <a style="text-decoration: none;" href="#examples">Examples</a> </h2> <p>Write a table to a Hive partitioned data set of Parquet files:</p> <pre class="language-sql highlighter-rouge" data-language="sql">COPY orders TO 'orders' (FORMAT PARQUET, PARTITION_BY (year, month));</pre> <p>Write a table to a Hive partitioned data set of CSV files, allowing overwrites:</p> <pre class="language-sql highlighter-rouge" data-language="sql">COPY orders TO 'orders' (FORMAT CSV, PARTITION_BY (year, month), OVERWRITE_OR_IGNORE);</pre> <p>Write a table to a Hive partitioned data set of GZIP-compressed CSV files, setting explicit data files' extension:</p> <pre class="language-sql highlighter-rouge" data-language="sql">COPY orders TO 'orders' (FORMAT CSV, PARTITION_BY (year, month), COMPRESSION GZIP, FILE_EXTENSION 'csv.gz');</pre> <h2 id="partitioned-writes"> <a style="text-decoration: none;" href="#partitioned-writes">Partitioned Writes</a> </h2> <p>When the <code class="language-plaintext highlighter-rouge">PARTITION_BY</code> clause is specified for the <a href="../../sql/statements/copy.html"><code class="language-plaintext highlighter-rouge">COPY</code> statement</a>, the files are written in a <a href="hive_partitioning.html">Hive partitioned</a> folder hierarchy. The target is the name of the root directory (in the example above: <code class="language-plaintext highlighter-rouge">orders</code>). The files are written in-order in the file hierarchy. Currently, one file is written per thread to each directory.</p> <pre class="language-text highlighter-rouge" data-language="text">orders
├── year=2021
│    ├── month=1
│    │   ├── data_1.parquet
│    │   └── data_2.parquet
│    └── month=2
│        └── data_1.parquet
└── year=2022
     ├── month=11
     │   ├── data_1.parquet
     │   └── data_2.parquet
     └── month=12
         └── data_1.parquet</pre> <p>The values of the partitions are automatically extracted from the data. Note that it can be very expensive to write many partitions as many files will be created. The ideal partition count depends on how large your data set is.</p> <blockquote> <p>Bestpractice Writing data into many small partitions is expensive. It is generally recommended to have at least <code class="language-plaintext highlighter-rouge">100 MB</code> of data per partition.</p> </blockquote> <h3 id="overwriting"> <a style="text-decoration: none;" href="#overwriting">Overwriting</a> </h3> <p>By default the partitioned write will not allow overwriting existing directories. Use the <code class="language-plaintext highlighter-rouge">OVERWRITE_OR_IGNORE</code> option to allow overwriting an existing directory.</p> <h3 id="filename-pattern"> <a style="text-decoration: none;" href="#filename-pattern">Filename Pattern</a> </h3> <p>By default, files will be named <code class="language-plaintext highlighter-rouge">data_0.parquet</code> or <code class="language-plaintext highlighter-rouge">data_0.csv</code>. With the flag <code class="language-plaintext highlighter-rouge">FILENAME_PATTERN</code> a pattern with <code class="language-plaintext highlighter-rouge">{i}</code> or <code class="language-plaintext highlighter-rouge">{uuid}</code> can be defined to create specific filenames:</p> <ul> <li>
<code class="language-plaintext highlighter-rouge">{i}</code> will be replaced by an index</li> <li>
<code class="language-plaintext highlighter-rouge">{uuid}</code> will be replaced by a 128 bits long UUID</li> </ul> <p>Write a table to a Hive partitioned data set of .parquet files, with an index in the filename:</p> <pre class="language-sql highlighter-rouge" data-language="sql">COPY orders TO 'orders'
    (FORMAT PARQUET, PARTITION_BY (year, month), OVERWRITE_OR_IGNORE, FILENAME_PATTERN 'orders_{i}');</pre> <p>Write a table to a Hive partitioned data set of .parquet files, with unique filenames:</p> <pre class="language-sql highlighter-rouge" data-language="sql">COPY orders TO 'orders'
    (FORMAT PARQUET, PARTITION_BY (year, month), OVERWRITE_OR_IGNORE, FILENAME_PATTERN 'file_{uuid}');</pre><div class="_attribution">
  <p class="_attribution-p">
    &copy; Copyright 2018&ndash;2024 Stichting DuckDB Foundation<br>Licensed under the MIT License.<br>
    <a href="https://duckdb.org/docs/data/partitioning/partitioned_writes.html" class="_attribution-link">https://duckdb.org/docs/data/partitioning/partitioned_writes.html</a>
  </p>
</div>
