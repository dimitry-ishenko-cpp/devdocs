<h1 class="title">Parquet Encryption</h1>  <p>Starting with version 0.10.0, DuckDB supports reading and writing encrypted Parquet files. DuckDB broadly follows the <a href="https://github.com/apache/parquet-format/blob/master/Encryption.md">Parquet Modular Encryption specification</a> with some <a href="#limitations">limitations</a>.</p> <h2 id="reading-and-writing-encrypted-files"> <a style="text-decoration: none;" href="#reading-and-writing-encrypted-files">Reading and Writing Encrypted Files</a> </h2> <p>Using the <code class="language-plaintext highlighter-rouge">PRAGMA add_parquet_key</code> function, named encryption keys of 128, 192, or 256 bits can be added to a session. These keys are stored in-memory:</p> <pre class="language-sql highlighter-rouge" data-language="sql">PRAGMA add_parquet_key('key128', '0123456789112345');
PRAGMA add_parquet_key('key192', '012345678911234501234567');
PRAGMA add_parquet_key('key256', '01234567891123450123456789112345');</pre> <h3 id="writing-encrypted-parquet-files"> <a style="text-decoration: none;" href="#writing-encrypted-parquet-files">Writing Encrypted Parquet Files</a> </h3> <p>After specifying the key (e.g., <code class="language-plaintext highlighter-rouge">key256</code>), files can be encrypted as follows:</p> <pre class="language-sql highlighter-rouge" data-language="sql">COPY tbl TO 'tbl.parquet' (ENCRYPTION_CONFIG {footer_key: 'key256'});</pre> <h3 id="reading-encrypted-parquet-files"> <a style="text-decoration: none;" href="#reading-encrypted-parquet-files">Reading Encrypted Parquet Files</a> </h3> <p>An encrypted Parquet file using a specific key (e.g., <code class="language-plaintext highlighter-rouge">key256</code>), can then be read as follows:</p> <pre class="language-sql highlighter-rouge" data-language="sql">COPY tbl FROM 'tbl.parquet' (ENCRYPTION_CONFIG {footer_key: 'key256'});</pre> <p>Or:</p> <pre class="language-sql highlighter-rouge" data-language="sql">SELECT *
FROM read_parquet('tbl.parquet', encryption_config = {footer_key: 'key256'});</pre> <h2 id="limitations"> <a style="text-decoration: none;" href="#limitations">Limitations</a> </h2> <p>DuckDB's Parquet encryption currently has the following limitations.</p> <ol> <li> <p>It is not compatible with the encryption of, e.g., PyArrow, until the missing details are implemented.</p> </li> <li> <p>DuckDB encrypts the footer and all columns using the <code class="language-plaintext highlighter-rouge">footer_key</code>. The Parquet specification allows encryption of individual columns with different keys, e.g.:</p> <pre class="language-sql highlighter-rouge" data-language="sql">COPY tbl TO 'tbl.parquet'
    (ENCRYPTION_CONFIG {
        footer_key: 'key256',
        column_keys: {key256: ['col0', 'col1']}
    });</pre> <p>However, this is unsupported at the moment and will cause an error to be thrown (for now):</p> <pre class="language-console highlighter-rouge" data-language="console">Not implemented Error: Parquet encryption_config column_keys not yet implemented</pre> </li> </ol> <h2 id="performance-implications"> <a style="text-decoration: none;" href="#performance-implications">Performance Implications</a> </h2> <p>Note that encryption has some performance implications. Without encryption, reading/writing the <code class="language-plaintext highlighter-rouge">lineitem</code> table from <a href="../../extensions/tpch.html"><code class="language-plaintext highlighter-rouge">TPC-H</code></a> at SF1, which is 6M rows and 15 columns, from/to a Parquet file takes 0.26 and 0.99 seconds, respectively. With encryption, this takes 0.64 and 2.21 seconds, both approximately 2.5Ã— slower than the unencrypted version.</p><div class="_attribution">
  <p class="_attribution-p">
    &copy; Copyright 2018&ndash;2024 Stichting DuckDB Foundation<br>Licensed under the MIT License.<br>
    <a href="https://duckdb.org/docs/data/parquet/encryption.html" class="_attribution-link">https://duckdb.org/docs/data/parquet/encryption.html</a>
  </p>
</div>
