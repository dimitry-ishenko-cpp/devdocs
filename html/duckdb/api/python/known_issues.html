<h1 class="title">Known Python Issues</h1>  <p>Unfortunately there are some issues that are either beyond our control or are very elusive / hard to track down. Below is a list of these issues that you might have to be aware of, depending on your workflow.</p> <h2 id="numpy-import-multithreading"> <a style="text-decoration: none;" href="#numpy-import-multithreading">Numpy Import Multithreading</a> </h2> <p>When making use of multi threading and fetching results either directly as Numpy arrays or indirectly through a Pandas DataFrame, it might be necessary to ensure that <code class="language-plaintext highlighter-rouge">numpy.core.multiarray</code> is imported. If this module has not been imported from the main thread, and a different thread during execution attempts to import it this causes either a deadlock or a crash.</p> <p>To avoid this, it's recommended to <code class="language-plaintext highlighter-rouge">import numpy.core.multiarray</code> before starting up threads.</p> <h2 id="describe-and-summarize-return-empty-tables-in-jupyter"> <a style="text-decoration: none;" href="#describe-and-summarize-return-empty-tables-in-jupyter"><code class="language-plaintext highlighter-rouge">DESCRIBE</code> and <code class="language-plaintext highlighter-rouge">SUMMARIZE</code> Return Empty Tables in Jupyter</a> </h2> <p>The <code class="language-plaintext highlighter-rouge">DESCRIBE</code> and <code class="language-plaintext highlighter-rouge">SUMMARIZE</code> statements return an empty table:</p> <pre class="language-python highlighter-rouge" data-language="python">%sql
CREATE OR REPLACE TABLE tbl AS (SELECT 42 AS x);
DESCRIBE tbl;</pre> <p>To work around this, wrap them into a subquery:</p> <pre class="language-python highlighter-rouge" data-language="python">%sql
CREATE OR REPLACE TABLE tbl AS (SELECT 42 AS x);
FROM (DESCRIBE tbl);</pre> <h2 id="protobuf-error-for-jupysql-in-ipython"> <a style="text-decoration: none;" href="#protobuf-error-for-jupysql-in-ipython">Protobuf Error for JupySQL in IPython</a> </h2> <p>Loading the JupySQL extension in IPython fails:</p> <pre class="language-python highlighter-rouge" data-language="python">In [1]: %load_ext sql</pre> <pre class="language-console highlighter-rouge" data-language="console">ImportError: cannot import name 'builder' from 'google.protobuf.internal' (unknown location)</pre> <p>The solution is to fix the <code class="language-plaintext highlighter-rouge">protobuf</code> package. This may require uninstalling conflicting packages, e.g.:</p> <pre class="language-python highlighter-rouge" data-language="python">%pip uninstall tensorflow
%pip install protobuf</pre> <h2 id="running-explain-renders-newlines"> <a style="text-decoration: none;" href="#running-explain-renders-newlines">Running <code class="language-plaintext highlighter-rouge">EXPLAIN</code> Renders Newlines</a> </h2> <p>In Python, the output of the <a href="../../guides/meta/explain.html"><code class="language-plaintext highlighter-rouge">EXPLAIN</code> statement</a> contains hard line breaks (<code class="language-plaintext highlighter-rouge">\n</code>):</p> <pre class="language-python highlighter-rouge" data-language="python">In [1]: import duckdb
   ...: duckdb.sql("EXPLAIN SELECT 42 AS x")</pre> <pre class="language-text highlighter-rouge" data-language="text">Out[1]:
┌───────────────┬───────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│  explain_key  │                                                   explain_value                                                   │
│    varchar    │                                                      varchar                                                      │
├───────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ physical_plan │ ┌───────────────────────────┐\n│         PROJECTION        │\n│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │\n│             x   …  │
└───────────────┴───────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘</pre> <p>To work around this, <code class="language-plaintext highlighter-rouge">print</code> the output of the <code class="language-plaintext highlighter-rouge">explain()</code> function:</p> <pre class="language-python highlighter-rouge" data-language="python">In [2]: print(duckdb.sql("SELECT 42 AS x").explain())</pre> <pre class="language-text highlighter-rouge" data-language="text">Out[2]:
┌───────────────────────────┐
│         PROJECTION        │
│   ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─   │
│             x             │
└─────────────┬─────────────┘
┌─────────────┴─────────────┐
│         DUMMY_SCAN        │
└───────────────────────────┘</pre> <p>Please also check out the <a href="../../guides/python/jupyter.html">Jupyter guide</a> for tips on using Jupyter with JupySQL.</p> <h2 id="error-when-importing-the-duckdb-python-package-on-windows"> <a style="text-decoration: none;" href="#error-when-importing-the-duckdb-python-package-on-windows">Error When Importing the DuckDB Python Package on Windows</a> </h2> <p>When importing DuckDB on Windows, the Python runtime may return the following error:</p> <pre class="language-python highlighter-rouge" data-language="python">import duckdb</pre> <pre class="language-console highlighter-rouge" data-language="console">ImportError: DLL load failed while importing duckdb: The specified module could not be found.</pre> <p>The solution is to install the <a href="https://learn.microsoft.com/en-US/cpp/windows/latest-supported-vc-redist">Microsoft Visual C++ Redistributable package</a>.</p><div class="_attribution">
  <p class="_attribution-p">
    &copy; Copyright 2018&ndash;2024 Stichting DuckDB Foundation<br>Licensed under the MIT License.<br>
    <a href="https://duckdb.org/docs/api/python/known_issues.html" class="_attribution-link">https://duckdb.org/docs/api/python/known_issues.html</a>
  </p>
</div>
