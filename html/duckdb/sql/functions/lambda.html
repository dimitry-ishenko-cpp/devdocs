<h1 class="title">Lambda Functions</h1>  <p>Lambda functions enable the use of more complex and flexible expressions in queries. DuckDB supports several scalar functions that operate on <a href="../data_types/list.html"><code class="language-plaintext highlighter-rouge">LIST</code>s</a> and accept lambda functions as parameters in the form <code class="language-plaintext highlighter-rouge">(parameter1, parameter2, ...) -&gt; expression</code>. If the lambda function has only one parameter, then the parentheses can be omitted. The parameters can have any names. For example, the following are all valid lambda functions:</p> <ul> <li><code class="language-plaintext highlighter-rouge">param -&gt; param &gt; 1</code></li> <li><code class="language-plaintext highlighter-rouge">s -&gt; contains(concat(s, 'DB'), 'duck')</code></li> <li><code class="language-plaintext highlighter-rouge">(x, y) -&gt; x + y</code></li> </ul> <h2 id="scalar-functions-that-accept-lambda-functions"> <a style="text-decoration: none;" href="#scalar-functions-that-accept-lambda-functions">Scalar Functions That Accept Lambda Functions</a> </h2> <table> <thead> <tr> <th style="text-align: left">Name</th> <th style="text-align: left">Description</th> </tr> </thead> <tbody> <tr> <td style="text-align: left"><a href="#list_transformlist-lambda"><code class="language-plaintext highlighter-rouge">list_transform(list, lambda)</code></a></td> <td style="text-align: left">Returns a list that is the result of applying the lambda function to each element of the input list.</td> </tr> <tr> <td style="text-align: left"><a href="#list_filterlist-lambda"><code class="language-plaintext highlighter-rouge">list_filter(list, lambda)</code></a></td> <td style="text-align: left">Constructs a list from those elements of the input list for which the lambda function returns <code class="language-plaintext highlighter-rouge">true</code>.</td> </tr> <tr> <td style="text-align: left"><a href="#list_reducelist-lambda"><code class="language-plaintext highlighter-rouge">list_reduce(list, lambda)</code></a></td> <td style="text-align: left">Reduces all elements of the input list into a single value by executing the lambda function on a running result and the next list element. The list must have at least one element – the use of an initial accumulator value is currently not supported.</td> </tr> </tbody> </table> <h3 id="list_transformlist-lambda"> <a style="text-decoration: none;" href="#list_transformlist-lambda"><code class="language-plaintext highlighter-rouge">list_transform(list, lambda)</code></a> </h3>  <table> <tbody> <tr> <td><strong>Description</strong></td> <td>Returns a list that is the result of applying the lambda function to each element of the input list. For more information, see <a href="#transform">Transform</a>.</td> </tr> <tr> <td><strong>Example</strong></td> <td><code class="language-plaintext highlighter-rouge">list_transform([4, 5, 6], x -&gt; x + 1)</code></td> </tr> <tr> <td><strong>Result</strong></td> <td><code class="language-plaintext highlighter-rouge">[5, 6, 7]</code></td> </tr> <tr> <td><strong>Aliases</strong></td> <td>
<code class="language-plaintext highlighter-rouge">array_transform</code>, <code class="language-plaintext highlighter-rouge">apply</code>, <code class="language-plaintext highlighter-rouge">list_apply</code>, <code class="language-plaintext highlighter-rouge">array_apply</code>
</td> </tr> </tbody> </table> <h3 id="list_filterlist-lambda"> <a style="text-decoration: none;" href="#list_filterlist-lambda"><code class="language-plaintext highlighter-rouge">list_filter(list, lambda)</code></a> </h3>  <table> <tbody> <tr> <td><strong>Description</strong></td> <td>Constructs a list from those elements of the input list for which the lambda function returns <code class="language-plaintext highlighter-rouge">true</code>. For more information, see <a href="#filter">Filter</a>.</td> </tr> <tr> <td><strong>Example</strong></td> <td><code class="language-plaintext highlighter-rouge">list_filter([4, 5, 6], x -&gt; x &gt; 4)</code></td> </tr> <tr> <td><strong>Result</strong></td> <td><code class="language-plaintext highlighter-rouge">[5, 6]</code></td> </tr> <tr> <td><strong>Aliases</strong></td> <td>
<code class="language-plaintext highlighter-rouge">array_filter</code>, <code class="language-plaintext highlighter-rouge">filter</code>
</td> </tr> </tbody> </table> <h3 id="list_reducelist-lambda"> <a style="text-decoration: none;" href="#list_reducelist-lambda"><code class="language-plaintext highlighter-rouge">list_reduce(list, lambda)</code></a> </h3>  <table> <tbody> <tr> <td><strong>Description</strong></td> <td>Reduces all elements of the input list into a single value by executing the lambda function on a running result and the next list element. The list must have at least one element – the use of an initial accumulator value is currently not supported. For more information, see <a href="#reduce">Reduce</a>.</td> </tr> <tr> <td><strong>Example</strong></td> <td><code class="language-plaintext highlighter-rouge">list_reduce([4, 5, 6], (x, y) -&gt; x + y)</code></td> </tr> <tr> <td><strong>Result</strong></td> <td><code class="language-plaintext highlighter-rouge">15</code></td> </tr> <tr> <td><strong>Aliases</strong></td> <td>
<code class="language-plaintext highlighter-rouge">array_reduce</code>, <code class="language-plaintext highlighter-rouge">reduce</code>
</td> </tr> </tbody> </table> <h2 id="nesting"> <a style="text-decoration: none;" href="#nesting">Nesting</a> </h2> <p>All scalar functions can be arbitrarily nested.</p> <p><em>Nested lambda functions to get all squares of even list elements:</em></p> <pre class="language-sql highlighter-rouge" data-language="sql">SELECT list_transform(
        list_filter([0, 1, 2, 3, 4, 5], x -&gt; x % 2 = 0),
        y -&gt; y * y
    );</pre> <pre class="language-text highlighter-rouge" data-language="text">[0, 4, 16]</pre> <p><em>Nested lambda function to add each element of the first list to the sum of the second list:</em></p> <pre class="language-sql highlighter-rouge" data-language="sql">SELECT list_transform(
        [1, 2, 3],
        x -&gt; list_reduce([4, 5, 6], (a, b) -&gt; a + b) + x
    );</pre> <pre class="language-text highlighter-rouge" data-language="text">[16, 17, 18]</pre> <h2 id="scoping"> <a style="text-decoration: none;" href="#scoping">Scoping</a> </h2> <p>Lambda functions confirm to scoping rules in the following order:</p> <ul> <li>inner lambda parameters</li> <li>outer lambda parameters</li> <li>column names</li> <li>macro parameters</li> </ul> <pre class="language-sql highlighter-rouge" data-language="sql">CREATE TABLE tbl (x INTEGER);
INSERT INTO tbl VALUES (10);
SELECT apply([1, 2], x -&gt; apply([4], x -&gt; x + tbl.x)[1] + x) FROM tbl;</pre> <pre class="language-text highlighter-rouge" data-language="text">[15, 16]</pre> <h2 id="indexes-as-parameters"> <a style="text-decoration: none;" href="#indexes-as-parameters">Indexes as Parameters</a> </h2> <p>All lambda functions accept an optional extra parameter that represents the index of the current element. This is always the last parameter of the lambda function, and is 1-based (i.e., the first element has index 1).</p> <p><em>Get all elements that are larger than their index:</em></p> <pre class="language-sql highlighter-rouge" data-language="sql">SELECT list_filter([1, 3, 1, 5], (x, i) -&gt; x &gt; i);</pre> <pre class="language-text highlighter-rouge" data-language="text">[3, 5]</pre> <h2 id="transform"> <a style="text-decoration: none;" href="#transform">Transform</a> </h2> <p><strong>Signature:</strong> <code class="language-plaintext highlighter-rouge">list_transform(list, lambda)</code></p> <p><strong>Description:</strong> <code class="language-plaintext highlighter-rouge">list_transform</code> returns a list that is the result of applying the lambda function to each element of the input list.</p> <p><strong>Aliases:</strong></p> <ul> <li><code class="language-plaintext highlighter-rouge">array_transform</code></li> <li><code class="language-plaintext highlighter-rouge">apply</code></li> <li><code class="language-plaintext highlighter-rouge">list_apply</code></li> <li><code class="language-plaintext highlighter-rouge">array_apply</code></li> </ul> <p><strong>Number of parameters excluding indexes:</strong> 1</p> <p><strong>Return type:</strong> Defined by the return type of the lambda function</p> <h3 id="examples"> <a style="text-decoration: none;" href="#examples">Examples</a> </h3> <p>Incrementing each list element by one:</p> <pre class="language-sql highlighter-rouge" data-language="sql">SELECT list_transform([1, 2, NULL, 3], x -&gt; x + 1);</pre> <pre class="language-text highlighter-rouge" data-language="text">[2, 3, NULL, 4]</pre> <p>Transforming strings:</p> <pre class="language-sql highlighter-rouge" data-language="sql">SELECT list_transform(['Duck', 'Goose', 'Sparrow'], s -&gt; concat(s, 'DB'));</pre> <pre class="language-text highlighter-rouge" data-language="text">[DuckDB, GooseDB, SparrowDB]</pre> <p>Combining lambda functions with other functions:</p> <pre class="language-sql highlighter-rouge" data-language="sql">SELECT list_transform([5, NULL, 6], x -&gt; coalesce(x, 0) + 1);</pre> <pre class="language-text highlighter-rouge" data-language="text">[6, 1, 7]</pre> <h2 id="filter"> <a style="text-decoration: none;" href="#filter">Filter</a> </h2> <p><strong>Signature:</strong> <code class="language-plaintext highlighter-rouge">list_filter(list, lambda)</code></p> <p><strong>Description:</strong> Constructs a list from those elements of the input list for which the lambda function returns <code class="language-plaintext highlighter-rouge">true</code>. DuckDB must be able to cast the lambda function's return type to <code class="language-plaintext highlighter-rouge">BOOL</code>.</p> <p><strong>Aliases:</strong></p> <ul> <li><code class="language-plaintext highlighter-rouge">array_filter</code></li> <li><code class="language-plaintext highlighter-rouge">filter</code></li> </ul> <p><strong>Number of parameters excluding indexes:</strong> 1</p> <p><strong>Return type:</strong> The same type as the input list</p> <h3 id="examples-1"> <a style="text-decoration: none;" href="#examples-1">Examples</a> </h3> <p>Filter out negative values:</p> <pre class="language-sql highlighter-rouge" data-language="sql">SELECT list_filter([5, -6, NULL, 7], x -&gt; x &gt; 0);</pre> <pre class="language-text highlighter-rouge" data-language="text">[5, 7]</pre> <p>Divisible by 2 and 5:</p> <pre class="language-sql highlighter-rouge" data-language="sql">SELECT list_filter(
        list_filter([2, 4, 3, 1, 20, 10, 3, 30], x -&gt; x % 2 = 0),
        y -&gt; y % 5 = 0
    );</pre> <pre class="language-text highlighter-rouge" data-language="text">[20, 10, 30]</pre> <p>In combination with <code class="language-plaintext highlighter-rouge">range(...)</code> to construct lists:</p> <pre class="language-sql highlighter-rouge" data-language="sql">SELECT list_filter([1, 2, 3, 4], x -&gt; x &gt; #1) FROM range(4);</pre> <pre class="language-text highlighter-rouge" data-language="text">[1, 2, 3, 4]
[2, 3, 4]
[3, 4]
[4]
[]</pre> <h2 id="reduce"> <a style="text-decoration: none;" href="#reduce">Reduce</a> </h2> <p><strong>Signature:</strong> <code class="language-plaintext highlighter-rouge">list_reduce(list, lambda)</code></p> <p><strong>Description:</strong> The scalar function returns a single value that is the result of applying the lambda function to each element of the input list. Starting with the first element and then repeatedly applying the lambda function to the result of the previous application and the next element of the list. The list must have at least one element.</p> <p><strong>Aliases:</strong></p> <ul> <li><code class="language-plaintext highlighter-rouge">array_reduce</code></li> <li><code class="language-plaintext highlighter-rouge">reduce</code></li> </ul> <p><strong>Number of parameters excluding indexes:</strong> 2</p> <p><strong>Return type:</strong> The type of the input list's elements</p> <h3 id="examples-2"> <a style="text-decoration: none;" href="#examples-2">Examples</a> </h3> <p>Sum of all list elements:</p> <pre class="language-sql highlighter-rouge" data-language="sql">SELECT list_reduce([1, 2, 3, 4], (x, y) -&gt; x + y);</pre> <pre class="language-text highlighter-rouge" data-language="text">10</pre> <p>Only add up list elements if they are greater than 2:</p> <pre class="language-sql highlighter-rouge" data-language="sql">SELECT list_reduce(list_filter([1, 2, 3, 4], x -&gt; x &gt; 2), (x, y) -&gt; x + y);</pre> <pre class="language-text highlighter-rouge" data-language="text">7</pre> <p>Concat all list elements:</p> <pre class="language-sql highlighter-rouge" data-language="sql">SELECT list_reduce(['DuckDB', 'is', 'awesome'], (x, y) -&gt; concat(x, ' ', y));</pre> <pre class="language-text highlighter-rouge" data-language="text">DuckDB is awesome</pre><div class="_attribution">
  <p class="_attribution-p">
    &copy; Copyright 2018&ndash;2024 Stichting DuckDB Foundation<br>Licensed under the MIT License.<br>
    <a href="https://duckdb.org/docs/sql/functions/lambda.html" class="_attribution-link">https://duckdb.org/docs/sql/functions/lambda.html</a>
  </p>
</div>
