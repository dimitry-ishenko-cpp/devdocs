<h1 class="title">ATTACH and DETACH Statements</h1>  <p>DuckDB allows attaching to and detaching from database files.</p> <h2 id="examples"> <a style="text-decoration: none;" href="#examples">Examples</a> </h2> <p>Attach the database <code class="language-plaintext highlighter-rouge">file.db</code> with the alias inferred from the name (<code class="language-plaintext highlighter-rouge">file</code>):</p> <pre class="language-sql highlighter-rouge" data-language="sql">ATTACH 'file.db';</pre> <p>Attach the database <code class="language-plaintext highlighter-rouge">file.db</code> with an explicit alias (<code class="language-plaintext highlighter-rouge">file_db</code>):</p> <pre class="language-sql highlighter-rouge" data-language="sql">ATTACH 'file.db' AS file_db;</pre> <p>Attach the database <code class="language-plaintext highlighter-rouge">file.db</code> in read only mode:</p> <pre class="language-sql highlighter-rouge" data-language="sql">ATTACH 'file.db' (READ_ONLY);</pre> <p>Attach the database <code class="language-plaintext highlighter-rouge">file.db</code> with a block size of 16KB:</p> <pre class="language-sql highlighter-rouge" data-language="sql">ATTACH 'file.db' (BLOCK_SIZE 16384);</pre> <p>Attach a SQLite database for reading and writing (see the <a href="../../extensions/sqlite.html"><code class="language-plaintext highlighter-rouge">sqlite</code> extension</a> for more information):</p> <pre class="language-sql highlighter-rouge" data-language="sql">ATTACH 'sqlite_file.db' AS sqlite_db (TYPE SQLITE);</pre> <p>Attach the database <code class="language-plaintext highlighter-rouge">file.db</code> if inferred database alias <code class="language-plaintext highlighter-rouge">file</code> does not yet exist:</p> <pre class="language-sql highlighter-rouge" data-language="sql">ATTACH IF NOT EXISTS 'file.db';</pre> <p>Attach the database <code class="language-plaintext highlighter-rouge">file.db</code> if explicit database alias <code class="language-plaintext highlighter-rouge">file_db</code> does not yet exist:</p> <pre class="language-sql highlighter-rouge" data-language="sql">ATTACH IF NOT EXISTS 'file.db' AS file_db;</pre> <p>Create a table in the attached database with alias <code class="language-plaintext highlighter-rouge">file</code>:</p> <pre class="language-sql highlighter-rouge" data-language="sql">CREATE TABLE file.new_table (i INTEGER);</pre> <p>Detach the database with alias <code class="language-plaintext highlighter-rouge">file</code>:</p> <pre class="language-sql highlighter-rouge" data-language="sql">DETACH file;</pre> <p>Show a list of all attached databases:</p> <pre class="language-sql highlighter-rouge" data-language="sql">SHOW DATABASES;</pre> <p>Change the default database that is used to the database <code class="language-plaintext highlighter-rouge">file</code>:</p> <pre class="language-sql highlighter-rouge" data-language="sql">USE file;</pre> <h2 id="attach"> <a style="text-decoration: none;" href="#attach">Attach</a> </h2> <p>The <code class="language-plaintext highlighter-rouge">ATTACH</code> statement adds a new database file to the catalog that can be read from and written to. Note that attachment definitions are not persisted between sessions: when a new session is launched, you have to re-attach to all databases.</p> <h3 id="attach-syntax"> <a style="text-decoration: none;" href="#attach-syntax">Attach Syntax</a> </h3>  <p><code class="language-plaintext highlighter-rouge">ATTACH</code> allows DuckDB to operate on multiple database files, and allows for transfer of data between different database files.</p> <p><code class="language-plaintext highlighter-rouge">ATTACH</code> supports HTTP and S3 endpoints. For these, it creates a read-only connection by default. Therefore, the following two commands are equivalent:</p> <pre class="language-sql highlighter-rouge" data-language="sql">ATTACH 'https://blobs.duckdb.org/databases/stations.duckdb' AS stations_db;
ATTACH 'https://blobs.duckdb.org/databases/stations.duckdb' AS stations_db (READ_ONLY);</pre> <p>Similarly, the following two commands connecting to S3 are equivalent:</p> <pre class="language-sql highlighter-rouge" data-language="sql">ATTACH 's3://duckdb-blobs/databases/stations.duckdb' AS stations_db;
ATTACH 's3://duckdb-blobs/databases/stations.duckdb' AS stations_db (READ_ONLY);</pre> <blockquote> <p>Prior to DuckDB version 1.1.0, it was necessary to specify the <code class="language-plaintext highlighter-rouge">READ_ONLY</code> flag for HTTP and S3 endpoints.</p> </blockquote> <h2 id="detach"> <a style="text-decoration: none;" href="#detach">Detach</a> </h2> <p>The <code class="language-plaintext highlighter-rouge">DETACH</code> statement allows previously attached database files to be closed and detached, releasing any locks held on the database file.</p> <p>Note that it is not possible to detach from the default database: if you would like to do so, issue the <a href="use.html"><code class="language-plaintext highlighter-rouge">USE</code> statement</a> to change the default database to another one. For example, if you are connected to a persistent database, you may change to an in-memory database by issuing:</p> <pre class="language-sql highlighter-rouge" data-language="sql">ATTACH ':memory:' AS memory_db;
USE memory_db;</pre> <blockquote> <p>Warning Closing the connection, e.g., invoking the <a href="../../api/python/dbapi.html#connection.html"><code class="language-plaintext highlighter-rouge">close()</code> function in Python</a>, does not release the locks held on the database files as the file handles are held by the main DuckDB instance (in Python's case, the <code class="language-plaintext highlighter-rouge">duckdb</code> module).</p> </blockquote> <h3 id="detach-syntax"> <a style="text-decoration: none;" href="#detach-syntax">Detach Syntax</a> </h3>  <h2 id="options"> <a style="text-decoration: none;" href="#options">Options</a> </h2>  <table> <thead> <tr> <th>Name</th> <th>Description</th> <th>Type</th> <th>Default value</th> </tr> </thead> <tbody> <tr> <td><code class="language-plaintext highlighter-rouge">access_mode</code></td> <td>Access mode of the database (<strong>AUTOMATIC</strong>, <strong>READ_ONLY</strong>, or <strong>READ_WRITE</strong>)</td> <td><code class="language-plaintext highlighter-rouge">VARCHAR</code></td> <td><code class="language-plaintext highlighter-rouge">automatic</code></td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">type</code></td> <td>The file type (<strong>DUCKDB</strong> or <strong>SQLITE</strong>), or deduced from the input string literal (MySQL, PostgreSQL).</td> <td><code class="language-plaintext highlighter-rouge">VARCHAR</code></td> <td><code class="language-plaintext highlighter-rouge">DUCKDB</code></td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">block_size</code></td> <td>The block size of a new database file. Must be a power of two and within [16384, 262144]. Cannot be set for existing files.</td> <td><code class="language-plaintext highlighter-rouge">UBIGINT</code></td> <td><code class="language-plaintext highlighter-rouge">262144</code></td> </tr> </tbody> </table> <h2 id="name-qualification"> <a style="text-decoration: none;" href="#name-qualification">Name Qualification</a> </h2> <p>The fully qualified name of catalog objects contains the <em>catalog</em>, the <em>schema</em> and the <em>name</em> of the object. For example:</p> <p>Attach the database <code class="language-plaintext highlighter-rouge">new_db</code>:</p> <pre class="language-sql highlighter-rouge" data-language="sql">ATTACH 'new_db.db';</pre> <p>Create the schema <code class="language-plaintext highlighter-rouge">my_schema</code> in the database <code class="language-plaintext highlighter-rouge">new_db</code>:</p> <pre class="language-sql highlighter-rouge" data-language="sql">CREATE SCHEMA new_db.my_schema;</pre> <p>Create the table <code class="language-plaintext highlighter-rouge">my_table</code> in the schema <code class="language-plaintext highlighter-rouge">my_schema</code>:</p> <pre class="language-sql highlighter-rouge" data-language="sql">CREATE TABLE new_db.my_schema.my_table (col INTEGER);</pre> <p>Refer to the column <code class="language-plaintext highlighter-rouge">col</code> inside the table <code class="language-plaintext highlighter-rouge">my_table</code>:</p> <pre class="language-sql highlighter-rouge" data-language="sql">SELECT new_db.my_schema.my_table.col FROM new_db.my_schema.my_table;</pre> <p>Note that often the fully qualified name is not required. When a name is not fully qualified, the system looks for which entries to reference using the <em>catalog search path</em>. The default catalog search path includes the system catalog, the temporary catalog and the initially attached database together with the <code class="language-plaintext highlighter-rouge">main</code> schema.</p> <p>Also note the rules on <a href="../dialect/keywords_and_identifiers.html#database-names.html">identifiers and database names in particular</a>.</p> <h3 id="default-database-and-schema"> <a style="text-decoration: none;" href="#default-database-and-schema">Default Database and Schema</a> </h3> <p>When a table is created without any qualifications, the table is created in the default schema of the default database. The default database is the database that is launched when the system is created â€“ and the default schema is <code class="language-plaintext highlighter-rouge">main</code>.</p> <p>Create the table <code class="language-plaintext highlighter-rouge">my_table</code> in the default database:</p> <pre class="language-sql highlighter-rouge" data-language="sql">CREATE TABLE my_table (col INTEGER);</pre> <h3 id="changing-the-default-database-and-schema"> <a style="text-decoration: none;" href="#changing-the-default-database-and-schema">Changing the Default Database and Schema</a> </h3> <p>The default database and schema can be changed using the <code class="language-plaintext highlighter-rouge">USE</code> command.</p> <p>Set the default database schema to <code class="language-plaintext highlighter-rouge">new_db.main</code>:</p> <pre class="language-sql highlighter-rouge" data-language="sql">USE new_db;</pre> <p>Set the default database schema to <code class="language-plaintext highlighter-rouge">new_db.my_schema</code>:</p> <pre class="language-sql highlighter-rouge" data-language="sql">USE new_db.my_schema;</pre> <h3 id="resolving-conflicts"> <a style="text-decoration: none;" href="#resolving-conflicts">Resolving Conflicts</a> </h3> <p>When providing only a single qualification, the system can interpret this as <em>either</em> a catalog <em>or</em> a schema, as long as there are no conflicts. For example:</p> <pre class="language-sql highlighter-rouge" data-language="sql">ATTACH 'new_db.db';
CREATE SCHEMA my_schema;</pre> <p>Creates the table <code class="language-plaintext highlighter-rouge">new_db.main.tbl</code>:</p> <pre class="language-sql highlighter-rouge" data-language="sql">CREATE TABLE new_db.tbl (i INTEGER);</pre> <p>Creates the table <code class="language-plaintext highlighter-rouge">default_db.my_schema.tbl</code>:</p> <pre class="language-sql highlighter-rouge" data-language="sql">CREATE TABLE my_schema.tbl (i INTEGER);</pre> <p>If we create a conflict (i.e., we have both a schema and a catalog with the same name) the system requests that a fully qualified path is used instead:</p> <pre class="language-sql highlighter-rouge" data-language="sql">CREATE SCHEMA new_db;
CREATE TABLE new_db.tbl (i INTEGER);</pre> <pre class="language-console highlighter-rouge" data-language="console">Error: Binder Error: Ambiguous reference to catalog or schema "new_db" -
use a fully qualified path like "memory.new_db"</pre> <h3 id="changing-the-catalog-search-path"> <a style="text-decoration: none;" href="#changing-the-catalog-search-path">Changing the Catalog Search Path</a> </h3> <p>The catalog search path can be adjusted by setting the <code class="language-plaintext highlighter-rouge">search_path</code> configuration option, which uses a comma-separated list of values that will be on the search path. The following example demonstrates searching in two databases:</p> <pre class="language-sql highlighter-rouge" data-language="sql">ATTACH ':memory:' AS db1;
ATTACH ':memory:' AS db2;
CREATE table db1.tbl1 (i INTEGER);
CREATE table db2.tbl2 (j INTEGER);</pre> <p>Reference the tables using their fully qualified name:</p> <pre class="language-sql highlighter-rouge" data-language="sql">SELECT * FROM db1.tbl1;
SELECT * FROM db2.tbl2;</pre> <p>Or set the search path and reference the tables using their name:</p> <pre class="language-sql highlighter-rouge" data-language="sql">SET search_path = 'db1,db2';
SELECT * FROM tbl1;
SELECT * FROM tbl2;</pre> <h2 id="transactional-semantics"> <a style="text-decoration: none;" href="#transactional-semantics">Transactional Semantics</a> </h2> <p>When running queries on multiple databases, the system opens separate transactions per database. The transactions are started <em>lazily</em> by default â€“ when a given database is referenced for the first time in a query, a transaction for that database will be started. <code class="language-plaintext highlighter-rouge">SET immediate_transaction_mode = true</code> can be toggled to change this behavior to eagerly start transactions in all attached databases instead.</p> <p>While multiple transactions can be active at a time â€“ the system only supports <em>writing</em> to a single attached database in a single transaction. If you try to write to multiple attached databases in a single transaction the following error will be thrown:</p> <pre class="language-console highlighter-rouge" data-language="console">Attempting to write to database "db2" in a transaction that has already modified database "db1" -
a single transaction can only write to a single attached database.</pre> <p>The reason for this restriction is that the system does not maintain atomicity for transactions across attached databases. Transactions are only atomic <em>within</em> each database file. By restricting the global transaction to write to only a single database file the atomicity guarantees are maintained.</p><div class="_attribution">
  <p class="_attribution-p">
    &copy; Copyright 2018&ndash;2024 Stichting DuckDB Foundation<br>Licensed under the MIT License.<br>
    <a href="https://duckdb.org/docs/sql/statements/attach.html" class="_attribution-link">https://duckdb.org/docs/sql/statements/attach.html</a>
  </p>
</div>
