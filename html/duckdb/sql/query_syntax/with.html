<h1 class="title">WITH Clause</h1>  <p>The <code class="language-plaintext highlighter-rouge">WITH</code> clause allows you to specify common table expressions (CTEs). Regular (non-recursive) common-table-expressions are essentially views that are limited in scope to a particular query. CTEs can reference each-other and can be nested. <a href="#recursive-ctes">Recursive CTEs</a> can reference themselves.</p> <h2 id="basic-cte-examples"> <a style="text-decoration: none;" href="#basic-cte-examples">Basic CTE Examples</a> </h2> <p>Create a CTE called <code class="language-plaintext highlighter-rouge">cte</code> and use it in the main query:</p> <pre class="language-sql highlighter-rouge" data-language="sql">WITH cte AS (SELECT 42 AS x)
SELECT * FROM cte;</pre> <table> <thead> <tr> <th style="text-align: right">x</th> </tr> </thead> <tbody> <tr> <td style="text-align: right">42</td> </tr> </tbody> </table> <p>Create two CTEs <code class="language-plaintext highlighter-rouge">cte1</code> and <code class="language-plaintext highlighter-rouge">cte2</code>, where the second CTE references the first CTE:</p> <pre class="language-sql highlighter-rouge" data-language="sql">WITH
    cte1 AS (SELECT 42 AS i),
    cte2 AS (SELECT i * 100 AS x FROM cte1)
SELECT * FROM cte2;</pre> <table> <thead> <tr> <th style="text-align: right">x</th> </tr> </thead> <tbody> <tr> <td style="text-align: right">4200</td> </tr> </tbody> </table> <h2 id="cte-materialization"> <a style="text-decoration: none;" href="#cte-materialization">CTE Materialization</a> </h2> <p>DuckDB can employ CTE materialization, i.e., inlining CTEs into the main query. This is performed using heuristics: if the CTE performs a grouped aggregation and is queried more than once, it is materialized. Materialization can be explicitly activated by defining the CTE using <code class="language-plaintext highlighter-rouge">AS MATERIALIZED</code> and disabled by using <code class="language-plaintext highlighter-rouge">AS NOT MATERIALIZED</code>.</p> <p>Take the following query for example, which invokes the same CTE three times:</p> <pre class="language-sql highlighter-rouge" data-language="sql">WITH t(x) AS (⟨complex_query⟩)
SELECT *
FROM
    t AS t1,
    t AS t2,
    t AS t3;</pre> <p>Inlining duplicates the definition of <code class="language-plaintext highlighter-rouge">t</code> for each reference which results in the following query:</p> <pre class="language-sql highlighter-rouge" data-language="sql">SELECT *
FROM
    (⟨complex_query⟩) AS t1(x),
    (⟨complex_query⟩) AS t2(x),
    (⟨complex_query⟩) AS t3(x);</pre> <p>If <code class="language-plaintext highlighter-rouge">⟨complex_query⟩</code> is expensive, materializing it with the <code class="language-plaintext highlighter-rouge">MATERIALIZED</code> keyword can improve performance. In this case, <code class="language-plaintext highlighter-rouge">⟨complex_query⟩</code> is evaluated only once.</p> <pre class="language-sql highlighter-rouge" data-language="sql">WITH t(x) AS MATERIALIZED (⟨complex_query⟩)
SELECT *
FROM
    t AS t1,
    t AS t2,
    t AS t3;</pre> <p>If one wants to disable materialization, use <code class="language-plaintext highlighter-rouge">NOT MATERIALIZED</code>:</p> <pre class="language-sql highlighter-rouge" data-language="sql">WITH t(x) AS NOT MATERIALIZED (⟨complex_query⟩)
SELECT *
FROM
    t AS t1,
    t AS t2,
    t AS t3;</pre> <h2 id="recursive-ctes"> <a style="text-decoration: none;" href="#recursive-ctes">Recursive CTEs</a> </h2> <p><code class="language-plaintext highlighter-rouge">WITH RECURSIVE</code> allows the definition of CTEs which can refer to themselves. Note that the query must be formulated in a way that ensures termination, otherwise, it may run into an infinite loop.</p> <h3 id="example-fibonacci-sequence"> <a style="text-decoration: none;" href="#example-fibonacci-sequence">Example: Fibonacci Sequence</a> </h3> <p><code class="language-plaintext highlighter-rouge">WITH RECURSIVE</code> can be used to make recursive calculations. For example, here is how <code class="language-plaintext highlighter-rouge">WITH RECURSIVE</code> could be used to calculate the first ten Fibonacci numbers:</p> <pre class="language-sql highlighter-rouge" data-language="sql">WITH RECURSIVE FibonacciNumbers (RecursionDepth, FibonacciNumber, NextNumber) AS (
        -- Base case
        SELECT
            0 AS RecursionDepth,
            0 AS FibonacciNumber,
            1 AS NextNumber
        UNION ALL
        -- Recursive step
        SELECT
            fib.RecursionDepth + 1 AS RecursionDepth,
            fib.NextNumber AS FibonacciNumber,
            fib.FibonacciNumber + fib.NextNumber AS NextNumber
        FROM
            FibonacciNumbers fib
        WHERE
            fib.RecursionDepth + 1 &lt; 10
    )
SELECT
    fn.RecursionDepth AS FibonacciNumberIndex,
    fn.FibonacciNumber
FROM
    FibonacciNumbers fn;</pre> <table> <thead> <tr> <th style="text-align: right">FibonacciNumberIndex</th> <th style="text-align: right">FibonacciNumber</th> </tr> </thead> <tbody> <tr> <td style="text-align: right">0</td> <td style="text-align: right">0</td> </tr> <tr> <td style="text-align: right">1</td> <td style="text-align: right">1</td> </tr> <tr> <td style="text-align: right">2</td> <td style="text-align: right">1</td> </tr> <tr> <td style="text-align: right">3</td> <td style="text-align: right">2</td> </tr> <tr> <td style="text-align: right">4</td> <td style="text-align: right">3</td> </tr> <tr> <td style="text-align: right">5</td> <td style="text-align: right">5</td> </tr> <tr> <td style="text-align: right">6</td> <td style="text-align: right">8</td> </tr> <tr> <td style="text-align: right">7</td> <td style="text-align: right">13</td> </tr> <tr> <td style="text-align: right">8</td> <td style="text-align: right">21</td> </tr> <tr> <td style="text-align: right">9</td> <td style="text-align: right">34</td> </tr> </tbody> </table> <h3 id="example-tree-traversal"> <a style="text-decoration: none;" href="#example-tree-traversal">Example: Tree Traversal</a> </h3> <p><code class="language-plaintext highlighter-rouge">WITH RECURSIVE</code> can be used to traverse trees. For example, take a hierarchy of tags:</p> <p><img alt="Example tree" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMzIzIiBoZWlnaHQ9IjI2NyIgZmlsbD0iIzAwMCIgZmlsbC1vcGFjaXR5PSIxIiBzdHJva2U9IiMwMDAiIHN0cm9rZS1kYXNoYXJyYXk9Im5vbmUiIHN0cm9rZS1kYXNob2Zmc2V0PSIwIiBzdHJva2UtbGluZWNhcD0ic3F1YXJlIiBzdHJva2UtbGluZWpvaW49Im1pdGVyIiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIHN0cm9rZS1vcGFjaXR5PSIxIiBzdHJva2Utd2lkdGg9IjEiIGNvbG9yLWludGVycG9sYXRpb249ImF1dG8iIGNvbG9yLXJlbmRlcmluZz0iYXV0byIgZm9udC1mYW1pbHk9IidEaWFsb2cnIiBmb250LXNpemU9IjEyIiBmb250LXN0eWxlPSJub3JtYWwiIGZvbnQtd2VpZ2h0PSJub3JtYWwiIGltYWdlLXJlbmRlcmluZz0iYXV0byIgc2hhcGUtcmVuZGVyaW5nPSJhdXRvIiB0ZXh0LXJlbmRlcmluZz0iYXV0byI+PGc+PGRlZnMgaWQ9ImRlZnMxIj48Y2xpcFBhdGggaWQ9ImNsaXBQYXRoMSIgY2xpcFBhdGhVbml0cz0idXNlclNwYWNlT25Vc2UiPjxwYXRoIGQ9Ik0wIDAgTDMyMyAwIEwzMjMgMjY3IEwwIDI2NyBMMCAwIFoiLz48L2NsaXBQYXRoPjxjbGlwUGF0aCBpZD0iY2xpcFBhdGgyIiBjbGlwUGF0aFVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+PHBhdGggZD0iTS0xIC0xIEwzMjIgLTEgTDMyMiAyNjYgTC0xIDI2NiBMLTEgLTEgWiIvPjwvY2xpcFBhdGg+PC9kZWZzPjxnIHN0cm9rZS1saW5lY2FwPSJidXR0IiBzdHJva2UtbWl0ZXJsaW1pdD0iMS40NSIgc2hhcGUtcmVuZGVyaW5nPSJnZW9tZXRyaWNQcmVjaXNpb24iIHRleHQtcmVuZGVyaW5nPSJnZW9tZXRyaWNQcmVjaXNpb24iPjxwYXRoIGZpbGw9Im5vbmUiIGQ9Ik0yNDkuNjc0IDE1MC45MzE2IEwyMTMuMDEwNyAxMTguNzg4NCIgY2xpcC1wYXRoPSJ1cmwoI2NsaXBQYXRoMikiIHRyYW5zZm9ybT0ibWF0cml4KDEsMCwwLDEsMSwxKSIvPjwvZz48ZyBzdHJva2UtbGluZWNhcD0iYnV0dCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEuNDUiIHNoYXBlLXJlbmRlcmluZz0iZ2VvbWV0cmljUHJlY2lzaW9uIiB0ZXh0LXJlbmRlcmluZz0iZ2VvbWV0cmljUHJlY2lzaW9uIj48cGF0aCBzdHJva2U9Im5vbmUiIGQ9Ik0yMDYuOTk1MiAxMTMuNTE0NSBMMjEyLjcyMjMgMTI1LjE4NSBMMjEzLjc2MjYgMTE5LjQ0NzYgTDIxOS4zMTQ2IDExNy42NjU2IFoiIGNsaXAtcGF0aD0idXJsKCNjbGlwUGF0aDIpIiB0cmFuc2Zvcm09Im1hdHJpeCgxLDAsMCwxLDEsMSkiLz48cGF0aCBmaWxsPSJub25lIiBkPSJNMTI1Ljg4MzYgMTUwLjkzMTYgTDE2Mi41NDcgMTE4Ljc4ODQiIGNsaXAtcGF0aD0idXJsKCNjbGlwUGF0aDIpIiB0cmFuc2Zvcm09Im1hdHJpeCgxLDAsMCwxLDEsMSkiLz48cGF0aCBzdHJva2U9Im5vbmUiIGQ9Ik0xNjguNTYyNSAxMTMuNTE0NSBMMTU2LjI0MyAxMTcuNjY1NiBMMTYxLjc5NSAxMTkuNDQ3NiBMMTYyLjgzNTQgMTI1LjE4NSBaIiBjbGlwLXBhdGg9InVybCgjY2xpcFBhdGgyKSIgdHJhbnNmb3JtPSJtYXRyaXgoMSwwLDAsMSwxLDEpIi8+PHBhdGggZmlsbD0ibm9uZSIgZD0iTTIwMy4xOTAyIDc2LjI4MTMgTDIyMS4zMDIgNTIuMzIzMyIgY2xpcC1wYXRoPSJ1cmwoI2NsaXBQYXRoMikiIHRyYW5zZm9ybT0ibWF0cml4KDEsMCwwLDEsMSwxKSIvPjxwYXRoIHN0cm9rZT0ibm9uZSIgZD0iTTIyNi4xMjYzIDQ1Ljk0MTcgTDIxNC45MDEyIDUyLjQ5ODkgTDIyMC42OTg5IDUzLjEyMTEgTDIyMi44NzgzIDU4LjUyOTQgWiIgY2xpcC1wYXRoPSJ1cmwoI2NsaXBQYXRoMikiIHRyYW5zZm9ybT0ibWF0cml4KDEsMCwwLDEsMSwxKSIvPjxwYXRoIGZpbGw9Im5vbmUiIGQ9Ik0yNzkuODg1MiA3Ni4yODEzIEwyNjEuNzczNSA1Mi4zMjMzIiBjbGlwLXBhdGg9InVybCgjY2xpcFBhdGgyKSIgdHJhbnNmb3JtPSJtYXRyaXgoMSwwLDAsMSwxLDEpIi8+PHBhdGggc3Ryb2tlPSJub25lIiBkPSJNMjU2Ljk0OTEgNDUuOTQxNyBMMjYwLjE5NzEgNTguNTI5NCBMMjYyLjM3NjUgNTMuMTIxMSBMMjY4LjE3NDIgNTIuNDk4OSBaIiBjbGlwLXBhdGg9InVybCgjY2xpcFBhdGgyKSIgdHJhbnNmb3JtPSJtYXRyaXgoMSwwLDAsMSwxLDEpIi8+PHBhdGggZmlsbD0ibm9uZSIgZD0iTTI2OC44OTA0IDIxMy4zMzQ2IEwyNjguODkwNCAyMDEuMzM0NiIgY2xpcC1wYXRoPSJ1cmwoI2NsaXBQYXRoMikiIHRyYW5zZm9ybT0ibWF0cml4KDEsMCwwLDEsMSwxKSIvPjxwYXRoIHN0cm9rZT0ibm9uZSIgZD0iTTI2OC44OTA0IDE5My4zMzQ2IEwyNjMuODkwNCAyMDUuMzM0NiBMMjY4Ljg5MDQgMjAyLjMzNDYgTDI3My44OTA0IDIwNS4zMzQ2IFoiIGNsaXAtcGF0aD0idXJsKCNjbGlwUGF0aDIpIiB0cmFuc2Zvcm09Im1hdHJpeCgxLDAsMCwxLDEsMSkiLz48cGF0aCBmaWxsPSJub25lIiBkPSJNNDQuNzcyMSAyMjIuMDQzMSBMODEuNDM1NCAxODkuODk5OSIgY2xpcC1wYXRoPSJ1cmwoI2NsaXBQYXRoMikiIHRyYW5zZm9ybT0ibWF0cml4KDEsMCwwLDEsMSwxKSIvPjxwYXRoIHN0cm9rZT0ibm9uZSIgZD0iTTg3LjQ1MDkgMTg0LjYyNiBMNzUuMTMxNSAxODguNzc3MiBMODAuNjgzNSAxOTAuNTU5MSBMODEuNzIzOSAxOTYuMjk2NSBaIiBjbGlwLXBhdGg9InVybCgjY2xpcFBhdGgyKSIgdHJhbnNmb3JtPSJtYXRyaXgoMSwwLDAsMSwxLDEpIi8+PHBhdGggZmlsbD0ibm9uZSIgZD0iTTEwNi42NjczIDIxMy4zMzQ2IEwxMDYuNjY3MyAyMDEuMzM0NiIgY2xpcC1wYXRoPSJ1cmwoI2NsaXBQYXRoMikiIHRyYW5zZm9ybT0ibWF0cml4KDEsMCwwLDEsMSwxKSIvPjxwYXRoIHN0cm9rZT0ibm9uZSIgZD0iTTEwNi42NjczIDE5My4zMzQ2IEwxMDEuNjY3MyAyMDUuMzM0NiBMMTA2LjY2NzMgMjAyLjMzNDYgTDExMS42NjczIDIwNS4zMzQ2IFoiIGNsaXAtcGF0aD0idXJsKCNjbGlwUGF0aDIpIiB0cmFuc2Zvcm09Im1hdHJpeCgxLDAsMCwxLDEsMSkiLz48cGF0aCBmaWxsPSJub25lIiBkPSJNMTY4LjU2MjUgMjIyLjA0MzEgTDEzMS44OTkyIDE4OS44OTk5IiBjbGlwLXBhdGg9InVybCgjY2xpcFBhdGgyKSIgdHJhbnNmb3JtPSJtYXRyaXgoMSwwLDAsMSwxLDEpIi8+PHBhdGggc3Ryb2tlPSJub25lIiBkPSJNMTI1Ljg4MzcgMTg0LjYyNiBMMTMxLjYxMDcgMTk2LjI5NjUgTDEzMi42NTExIDE5MC41NTkxIEwxMzguMjAzMSAxODguNzc3MiBaIiBjbGlwLXBhdGg9InVybCgjY2xpcFBhdGgyKSIgdHJhbnNmb3JtPSJtYXRyaXgoMSwwLDAsMSwxLDEpIi8+PC9nPjxnIGZpbGw9IiNEREQiIHN0cm9rZT0iI0RERCIgc2hhcGUtcmVuZGVyaW5nPSJnZW9tZXRyaWNQcmVjaXNpb24iIHRleHQtcmVuZGVyaW5nPSJnZW9tZXRyaWNQcmVjaXNpb24iIHRyYW5zZm9ybT0ibWF0cml4KDEsMCwwLDEsMSwxKSI+PGNpcmNsZSBjeD0iMTg3Ljc3OSIgY3k9Ijk2LjY2NyIgcj0iMjUuNTU2IiBzdHJva2U9Im5vbmUiIGNsaXAtcGF0aD0idXJsKCNjbGlwUGF0aDIpIi8+PC9nPjxnIHN0cm9rZS1saW5lY2FwPSJidXR0IiBzdHJva2UtbWl0ZXJsaW1pdD0iMS40NSIgc2hhcGUtcmVuZGVyaW5nPSJnZW9tZXRyaWNQcmVjaXNpb24iIHRleHQtcmVuZGVyaW5nPSJnZW9tZXRyaWNQcmVjaXNpb24iIHRyYW5zZm9ybT0ibWF0cml4KDEsMCwwLDEsMSwxKSI+PGNpcmNsZSBjeD0iMTg3Ljc3OSIgY3k9Ijk2LjY2NyIgcj0iMjUuNTU2IiBmaWxsPSJub25lIiBjbGlwLXBhdGg9InVybCgjY2xpcFBhdGgyKSIvPjx0ZXh0IHg9IjE4NC43MDEiIHk9Ijk0LjMyNyIgc3Ryb2tlPSJub25lIiBjbGlwLXBhdGg9InVybCgjY2xpcFBhdGgyKSIgZm9udC1mYW1pbHk9IidTdWlzc2UgSW50bCciIHhtbDpzcGFjZT0icHJlc2VydmUiPjc8L3RleHQ+PHRleHQgeD0iMTcxLjE2NSIgeT0iMTA3Ljg4NyIgc3Ryb2tlPSJub25lIiBjbGlwLXBhdGg9InVybCgjY2xpcFBhdGgyKSIgZm9udC1mYW1pbHk9IidTdWlzc2UgSW50bCciIHhtbDpzcGFjZT0icHJlc2VydmUiPk11c2ljPC90ZXh0PjwvZz48ZyBmaWxsPSIjREREIiBzdHJva2U9IiNEREQiIHNoYXBlLXJlbmRlcmluZz0iZ2VvbWV0cmljUHJlY2lzaW9uIiB0ZXh0LXJlbmRlcmluZz0iZ2VvbWV0cmljUHJlY2lzaW9uIiB0cmFuc2Zvcm09Im1hdHJpeCgxLDAsMCwxLDEsMSkiPjxjaXJjbGUgY3g9IjI0MS41MzgiIGN5PSIyNS41NTYiIHI9IjI1LjU1NiIgc3Ryb2tlPSJub25lIiBjbGlwLXBhdGg9InVybCgjY2xpcFBhdGgyKSIvPjwvZz48ZyBzdHJva2UtbGluZWNhcD0iYnV0dCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEuNDUiIHNoYXBlLXJlbmRlcmluZz0iZ2VvbWV0cmljUHJlY2lzaW9uIiB0ZXh0LXJlbmRlcmluZz0iZ2VvbWV0cmljUHJlY2lzaW9uIiB0cmFuc2Zvcm09Im1hdHJpeCgxLDAsMCwxLDEsMSkiPjxjaXJjbGUgY3g9IjI0MS41MzgiIGN5PSIyNS41NTYiIHI9IjI1LjU1NiIgZmlsbD0ibm9uZSIgY2xpcC1wYXRoPSJ1cmwoI2NsaXBQYXRoMikiLz48dGV4dCB4PSIyMzcuODc4IiB5PSIyMy4yMTYiIHN0cm9rZT0ibm9uZSIgY2xpcC1wYXRoPSJ1cmwoI2NsaXBQYXRoMikiIGZvbnQtZmFtaWx5PSInU3Vpc3NlIEludGwnIiB4bWw6c3BhY2U9InByZXNlcnZlIj45PC90ZXh0Pjx0ZXh0IHg9IjIzMy40OTgiIHk9IjM2Ljc3NiIgc3Ryb2tlPSJub25lIiBjbGlwLXBhdGg9InVybCgjY2xpcFBhdGgyKSIgZm9udC1mYW1pbHk9IidTdWlzc2UgSW50bCciIHhtbDpzcGFjZT0icHJlc2VydmUiPkFydDwvdGV4dD48L2c+PGcgZmlsbD0iI0RERCIgc3Ryb2tlPSIjREREIiBzaGFwZS1yZW5kZXJpbmc9Imdlb21ldHJpY1ByZWNpc2lvbiIgdGV4dC1yZW5kZXJpbmc9Imdlb21ldHJpY1ByZWNpc2lvbiIgdHJhbnNmb3JtPSJtYXRyaXgoMSwwLDAsMSwxLDEpIj48Y2lyY2xlIGN4PSIyOTUuMjk3IiBjeT0iOTYuNjY3IiByPSIyNS41NTYiIHN0cm9rZT0ibm9uZSIgY2xpcC1wYXRoPSJ1cmwoI2NsaXBQYXRoMikiLz48L2c+PGcgc3Ryb2tlLWxpbmVjYXA9ImJ1dHQiIHN0cm9rZS1taXRlcmxpbWl0PSIxLjQ1IiBzaGFwZS1yZW5kZXJpbmc9Imdlb21ldHJpY1ByZWNpc2lvbiIgdGV4dC1yZW5kZXJpbmc9Imdlb21ldHJpY1ByZWNpc2lvbiIgdHJhbnNmb3JtPSJtYXRyaXgoMSwwLDAsMSwxLDEpIj48Y2lyY2xlIGN4PSIyOTUuMjk3IiBjeT0iOTYuNjY3IiByPSIyNS41NTYiIGZpbGw9Im5vbmUiIGNsaXAtcGF0aD0idXJsKCNjbGlwUGF0aDIpIi8+PHRleHQgeD0iMjkxLjU0MSIgeT0iOTQuMzI3IiBzdHJva2U9Im5vbmUiIGNsaXAtcGF0aD0idXJsKCNjbGlwUGF0aDIpIiBmb250LWZhbWlseT0iJ1N1aXNzZSBJbnRsJyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+ODwvdGV4dD48dGV4dCB4PSIyNzUuNDg1IiB5PSIxMDcuODg3IiBzdHJva2U9Im5vbmUiIGNsaXAtcGF0aD0idXJsKCNjbGlwUGF0aDIpIiBmb250LWZhbWlseT0iJ1N1aXNzZSBJbnRsJyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+TW92aWVzPC90ZXh0PjwvZz48ZyBmaWxsPSIjREREIiBzdHJva2U9IiNEREQiIHNoYXBlLXJlbmRlcmluZz0iZ2VvbWV0cmljUHJlY2lzaW9uIiB0ZXh0LXJlbmRlcmluZz0iZ2VvbWV0cmljUHJlY2lzaW9uIiB0cmFuc2Zvcm09Im1hdHJpeCgxLDAsMCwxLDEsMSkiPjxjaXJjbGUgY3g9IjI2OC44OSIgY3k9IjE2Ny43NzkiIHI9IjI1LjU1NiIgc3Ryb2tlPSJub25lIiBjbGlwLXBhdGg9InVybCgjY2xpcFBhdGgyKSIvPjwvZz48ZyBzdHJva2UtbGluZWNhcD0iYnV0dCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEuNDUiIHNoYXBlLXJlbmRlcmluZz0iZ2VvbWV0cmljUHJlY2lzaW9uIiB0ZXh0LXJlbmRlcmluZz0iZ2VvbWV0cmljUHJlY2lzaW9uIiB0cmFuc2Zvcm09Im1hdHJpeCgxLDAsMCwxLDEsMSkiPjxjaXJjbGUgY3g9IjI2OC44OSIgY3k9IjE2Ny43NzkiIHI9IjI1LjU1NiIgZmlsbD0ibm9uZSIgY2xpcC1wYXRoPSJ1cmwoI2NsaXBQYXRoMikiLz48dGV4dCB4PSIyNjUuMiIgeT0iMTY1LjQzOSIgc3Ryb2tlPSJub25lIiBjbGlwLXBhdGg9InVybCgjY2xpcFBhdGgyKSIgZm9udC1mYW1pbHk9IidTdWlzc2UgSW50bCciIHhtbDpzcGFjZT0icHJlc2VydmUiPjY8L3RleHQ+PHRleHQgeD0iMjU3LjgzOCIgeT0iMTc4Ljk5OSIgc3Ryb2tlPSJub25lIiBjbGlwLXBhdGg9InVybCgjY2xpcFBhdGgyKSIgZm9udC1mYW1pbHk9IidTdWlzc2UgSW50bCciIHhtbDpzcGFjZT0icHJlc2VydmUiPlJhcDwvdGV4dD48L2c+PGcgZmlsbD0iI0RERCIgc3Ryb2tlPSIjREREIiBzaGFwZS1yZW5kZXJpbmc9Imdlb21ldHJpY1ByZWNpc2lvbiIgdGV4dC1yZW5kZXJpbmc9Imdlb21ldHJpY1ByZWNpc2lvbiIgdHJhbnNmb3JtPSJtYXRyaXgoMSwwLDAsMSwxLDEpIj48Y2lyY2xlIGN4PSIxMDYuNjY3IiBjeT0iMTY3Ljc3OSIgcj0iMjUuNTU2IiBzdHJva2U9Im5vbmUiIGNsaXAtcGF0aD0idXJsKCNjbGlwUGF0aDIpIi8+PC9nPjxnIHN0cm9rZS1saW5lY2FwPSJidXR0IiBzdHJva2UtbWl0ZXJsaW1pdD0iMS40NSIgc2hhcGUtcmVuZGVyaW5nPSJnZW9tZXRyaWNQcmVjaXNpb24iIHRleHQtcmVuZGVyaW5nPSJnZW9tZXRyaWNQcmVjaXNpb24iIHRyYW5zZm9ybT0ibWF0cml4KDEsMCwwLDEsMSwxKSI+PGNpcmNsZSBjeD0iMTA2LjY2NyIgY3k9IjE2Ny43NzkiIHI9IjI1LjU1NiIgZmlsbD0ibm9uZSIgY2xpcC1wYXRoPSJ1cmwoI2NsaXBQYXRoMikiLz48dGV4dCB4PSIxMDMuMDI1IiB5PSIxNjUuNDM5IiBzdHJva2U9Im5vbmUiIGNsaXAtcGF0aD0idXJsKCNjbGlwUGF0aDIpIiBmb250LWZhbWlseT0iJ1N1aXNzZSBJbnRsJyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+NTwvdGV4dD48dGV4dCB4PSI5Mi42ODEiIHk9IjE3OC45OTkiIHN0cm9rZT0ibm9uZSIgY2xpcC1wYXRoPSJ1cmwoI2NsaXBQYXRoMikiIGZvbnQtZmFtaWx5PSInU3Vpc3NlIEludGwnIiB4bWw6c3BhY2U9InByZXNlcnZlIj5Sb2NrPC90ZXh0PjwvZz48ZyBmaWxsPSIjREREIiBzdHJva2U9IiNEREQiIHNoYXBlLXJlbmRlcmluZz0iZ2VvbWV0cmljUHJlY2lzaW9uIiB0ZXh0LXJlbmRlcmluZz0iZ2VvbWV0cmljUHJlY2lzaW9uIiB0cmFuc2Zvcm09Im1hdHJpeCgxLDAsMCwxLDEsMSkiPjxjaXJjbGUgY3g9IjE4Ny43NzkiIGN5PSIyMzguODkiIHI9IjI1LjU1NiIgc3Ryb2tlPSJub25lIiBjbGlwLXBhdGg9InVybCgjY2xpcFBhdGgyKSIvPjwvZz48ZyBzdHJva2UtbGluZWNhcD0iYnV0dCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEuNDUiIHNoYXBlLXJlbmRlcmluZz0iZ2VvbWV0cmljUHJlY2lzaW9uIiB0ZXh0LXJlbmRlcmluZz0iZ2VvbWV0cmljUHJlY2lzaW9uIiB0cmFuc2Zvcm09Im1hdHJpeCgxLDAsMCwxLDEsMSkiPjxjaXJjbGUgY3g9IjE4Ny43NzkiIGN5PSIyMzguODkiIHI9IjI1LjU1NiIgZmlsbD0ibm9uZSIgY2xpcC1wYXRoPSJ1cmwoI2NsaXBQYXRoMikiLz48dGV4dCB4PSIxODQuMjU3IiB5PSIyMzYuNTUiIHN0cm9rZT0ibm9uZSIgY2xpcC1wYXRoPSJ1cmwoI2NsaXBQYXRoMikiIGZvbnQtZmFtaWx5PSInU3Vpc3NlIEludGwnIiB4bWw6c3BhY2U9InByZXNlcnZlIj4zPC90ZXh0Pjx0ZXh0IHg9IjE3Mi4wMjMiIHk9IjI1MC4xMSIgc3Ryb2tlPSJub25lIiBjbGlwLXBhdGg9InVybCgjY2xpcFBhdGgyKSIgZm9udC1mYW1pbHk9IidTdWlzc2UgSW50bCciIHhtbDpzcGFjZT0icHJlc2VydmUiPk9hc2lzPC90ZXh0PjwvZz48ZyBmaWxsPSIjREREIiBzdHJva2U9IiNEREQiIHNoYXBlLXJlbmRlcmluZz0iZ2VvbWV0cmljUHJlY2lzaW9uIiB0ZXh0LXJlbmRlcmluZz0iZ2VvbWV0cmljUHJlY2lzaW9uIiB0cmFuc2Zvcm09Im1hdHJpeCgxLDAsMCwxLDEsMSkiPjxjaXJjbGUgY3g9IjEwNi42NjciIGN5PSIyMzguODkiIHI9IjI1LjU1NiIgc3Ryb2tlPSJub25lIiBjbGlwLXBhdGg9InVybCgjY2xpcFBhdGgyKSIvPjwvZz48ZyBzdHJva2UtbGluZWNhcD0iYnV0dCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEuNDUiIHNoYXBlLXJlbmRlcmluZz0iZ2VvbWV0cmljUHJlY2lzaW9uIiB0ZXh0LXJlbmRlcmluZz0iZ2VvbWV0cmljUHJlY2lzaW9uIiB0cmFuc2Zvcm09Im1hdHJpeCgxLDAsMCwxLDEsMSkiPjxjaXJjbGUgY3g9IjEwNi42NjciIGN5PSIyMzguODkiIHI9IjI1LjU1NiIgZmlsbD0ibm9uZSIgY2xpcC1wYXRoPSJ1cmwoI2NsaXBQYXRoMikiLz48dGV4dCB4PSIxMDMuMTI3IiB5PSIyMzYuNTUiIHN0cm9rZT0ibm9uZSIgY2xpcC1wYXRoPSJ1cmwoI2NsaXBQYXRoMikiIGZvbnQtZmFtaWx5PSInU3Vpc3NlIEludGwnIiB4bWw6c3BhY2U9InByZXNlcnZlIj4yPC90ZXh0Pjx0ZXh0IHg9Ijk1LjY4NyIgeT0iMjUwLjExIiBzdHJva2U9Im5vbmUiIGNsaXAtcGF0aD0idXJsKCNjbGlwUGF0aDIpIiBmb250LWZhbWlseT0iJ1N1aXNzZSBJbnRsJyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+Qmx1cjwvdGV4dD48L2c+PGcgZmlsbD0iI0RERCIgc3Ryb2tlPSIjREREIiBzaGFwZS1yZW5kZXJpbmc9Imdlb21ldHJpY1ByZWNpc2lvbiIgdGV4dC1yZW5kZXJpbmc9Imdlb21ldHJpY1ByZWNpc2lvbiIgdHJhbnNmb3JtPSJtYXRyaXgoMSwwLDAsMSwxLDEpIj48Y2lyY2xlIGN4PSIyNS41NTYiIGN5PSIyMzguODkiIHI9IjI1LjU1NiIgc3Ryb2tlPSJub25lIiBjbGlwLXBhdGg9InVybCgjY2xpcFBhdGgyKSIvPjwvZz48ZyBzdHJva2UtbGluZWNhcD0iYnV0dCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEuNDUiIHNoYXBlLXJlbmRlcmluZz0iZ2VvbWV0cmljUHJlY2lzaW9uIiB0ZXh0LXJlbmRlcmluZz0iZ2VvbWV0cmljUHJlY2lzaW9uIiB0cmFuc2Zvcm09Im1hdHJpeCgxLDAsMCwxLDEsMSkiPjxjaXJjbGUgY3g9IjI1LjU1NiIgY3k9IjIzOC44OSIgcj0iMjUuNTU2IiBmaWxsPSJub25lIiBjbGlwLXBhdGg9InVybCgjY2xpcFBhdGgyKSIvPjx0ZXh0IHg9IjIzLjM0OCIgeT0iMjM2LjU1IiBzdHJva2U9Im5vbmUiIGNsaXAtcGF0aD0idXJsKCNjbGlwUGF0aDIpIiBmb250LWZhbWlseT0iJ1N1aXNzZSBJbnRsJyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+MTwvdGV4dD48dGV4dCB4PSIxNy42MyIgeT0iMjUwLjExIiBzdHJva2U9Im5vbmUiIGNsaXAtcGF0aD0idXJsKCNjbGlwUGF0aDIpIiBmb250LWZhbWlseT0iJ1N1aXNzZSBJbnRsJyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+VTI8L3RleHQ+PC9nPjxnIGZpbGw9IiNEREQiIHN0cm9rZT0iI0RERCIgc2hhcGUtcmVuZGVyaW5nPSJnZW9tZXRyaWNQcmVjaXNpb24iIHRleHQtcmVuZGVyaW5nPSJnZW9tZXRyaWNQcmVjaXNpb24iIHRyYW5zZm9ybT0ibWF0cml4KDEsMCwwLDEsMSwxKSI+PGNpcmNsZSBjeD0iMjY4Ljg5IiBjeT0iMjM4Ljg5IiByPSIyNS41NTYiIHN0cm9rZT0ibm9uZSIgY2xpcC1wYXRoPSJ1cmwoI2NsaXBQYXRoMikiLz48L2c+PGcgc3Ryb2tlLWxpbmVjYXA9ImJ1dHQiIHN0cm9rZS1taXRlcmxpbWl0PSIxLjQ1IiBzaGFwZS1yZW5kZXJpbmc9Imdlb21ldHJpY1ByZWNpc2lvbiIgdGV4dC1yZW5kZXJpbmc9Imdlb21ldHJpY1ByZWNpc2lvbiIgdHJhbnNmb3JtPSJtYXRyaXgoMSwwLDAsMSwxLDEpIj48Y2lyY2xlIGN4PSIyNjguODkiIGN5PSIyMzguODkiIHI9IjI1LjU1NiIgZmlsbD0ibm9uZSIgY2xpcC1wYXRoPSJ1cmwoI2NsaXBQYXRoMikiLz48dGV4dCB4PSIyNjUuMTQ2IiB5PSIyMzYuNTUiIHN0cm9rZT0ibm9uZSIgY2xpcC1wYXRoPSJ1cmwoI2NsaXBQYXRoMikiIGZvbnQtZmFtaWx5PSInU3Vpc3NlIEludGwnIiB4bWw6c3BhY2U9InByZXNlcnZlIj40PC90ZXh0Pjx0ZXh0IHg9IjI1NC44MzgiIHk9IjI1MC4xMSIgc3Ryb2tlPSJub25lIiBjbGlwLXBhdGg9InVybCgjY2xpcFBhdGgyKSIgZm9udC1mYW1pbHk9IidTdWlzc2UgSW50bCciIHhtbDpzcGFjZT0icHJlc2VydmUiPjJQYWM8L3RleHQ+PC9nPjwvZz48L3N2Zz4=" style="width: 700px; text-align: center"></p> <pre class="language-sql highlighter-rouge" data-language="sql">CREATE TABLE tag (id INTEGER, name VARCHAR, subclassof INTEGER);
INSERT INTO tag VALUES
    (1, 'U2',     5),
    (2, 'Blur',   5),
    (3, 'Oasis',  5),
    (4, '2Pac',   6),
    (5, 'Rock',   7),
    (6, 'Rap',    7),
    (7, 'Music',  9),
    (8, 'Movies', 9),
    (9, 'Art', NULL);</pre> <p>The following query returns the path from the node <code class="language-plaintext highlighter-rouge">Oasis</code> to the root of the tree (<code class="language-plaintext highlighter-rouge">Art</code>).</p> <pre class="language-sql highlighter-rouge" data-language="sql">WITH RECURSIVE tag_hierarchy(id, source, path) AS (
        SELECT id, name, [name] AS path
        FROM tag
        WHERE subclassof IS NULL
    UNION ALL
        SELECT tag.id, tag.name, list_prepend(tag.name, tag_hierarchy.path)
        FROM tag, tag_hierarchy
        WHERE tag.subclassof = tag_hierarchy.id
    )
SELECT path
FROM tag_hierarchy
WHERE source = 'Oasis';</pre> <table> <thead> <tr> <th>path</th> </tr> </thead> <tbody> <tr> <td>[Oasis, Rock, Music, Art]</td> </tr> </tbody> </table> <h3 id="graph-traversal"> <a style="text-decoration: none;" href="#graph-traversal">Graph Traversal</a> </h3> <p>The <code class="language-plaintext highlighter-rouge">WITH RECURSIVE</code> clause can be used to express graph traversal on arbitrary graphs. However, if the graph has cycles, the query must perform cycle detection to prevent infinite loops. One way to achieve this is to store the path of a traversal in a <a href="../data_types/list.html">list</a> and, before extending the path with a new edge, check whether its endpoint has been visited before (see the example later).</p> <p>Take the following directed graph from the <a href="https://arxiv.org/pdf/2011.15028.pdf">LDBC Graphalytics benchmark</a>:</p> <p><img alt="Example graph" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjg5IiBoZWlnaHQ9IjIxMyIgZmlsbD0iIzAwMCIgZmlsbC1vcGFjaXR5PSIxIiBzdHJva2U9IiMwMDAiIHN0cm9rZS1kYXNoYXJyYXk9Im5vbmUiIHN0cm9rZS1kYXNob2Zmc2V0PSIwIiBzdHJva2UtbGluZWNhcD0ic3F1YXJlIiBzdHJva2UtbGluZWpvaW49Im1pdGVyIiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIHN0cm9rZS1vcGFjaXR5PSIxIiBzdHJva2Utd2lkdGg9IjEiIGNvbG9yLWludGVycG9sYXRpb249ImF1dG8iIGNvbG9yLXJlbmRlcmluZz0iYXV0byIgZm9udC1mYW1pbHk9IidEaWFsb2cnIiBmb250LXNpemU9IjEyIiBmb250LXN0eWxlPSJub3JtYWwiIGZvbnQtd2VpZ2h0PSJub3JtYWwiIGltYWdlLXJlbmRlcmluZz0iYXV0byIgc2hhcGUtcmVuZGVyaW5nPSJhdXRvIiB0ZXh0LXJlbmRlcmluZz0iYXV0byI+PGc+PGRlZnMgaWQ9ImRlZnMxIj48Y2xpcFBhdGggaWQ9ImNsaXBQYXRoMSIgY2xpcFBhdGhVbml0cz0idXNlclNwYWNlT25Vc2UiPjxwYXRoIGQ9Ik0wIDAgTDI4OSAwIEwyODkgMjEzIEwwIDIxMyBMMCAwIFoiLz48L2NsaXBQYXRoPjxjbGlwUGF0aCBpZD0iY2xpcFBhdGgyIiBjbGlwUGF0aFVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+PHBhdGggZD0iTS0xIC0xIEwyODggLTEgTDI4OCAyMTIgTC0xIDIxMiBMLTEgLTEgWiIvPjwvY2xpcFBhdGg+PC9kZWZzPjxnIHN0cm9rZS1saW5lY2FwPSJidXR0IiBzdHJva2UtbWl0ZXJsaW1pdD0iMS40NSIgc2hhcGUtcmVuZGVyaW5nPSJnZW9tZXRyaWNQcmVjaXNpb24iIHRleHQtcmVuZGVyaW5nPSJnZW9tZXRyaWNQcmVjaXNpb24iPjxwYXRoIGZpbGw9Im5vbmUiIGQ9Ik02OC45MjM1IDE4NS4wNDU1IEwxMDAuODc2NyAxOTEuNDAxNCIgY2xpcC1wYXRoPSJ1cmwoI2NsaXBQYXRoMikiIHRyYW5zZm9ybT0ibWF0cml4KDEsMCwwLDEsMSwxKSIvPjwvZz48ZyBzdHJva2UtbGluZWNhcD0iYnV0dCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEuNDUiIHNoYXBlLXJlbmRlcmluZz0iZ2VvbWV0cmljUHJlY2lzaW9uIiB0ZXh0LXJlbmRlcmluZz0iZ2VvbWV0cmljUHJlY2lzaW9uIj48cGF0aCBzdHJva2U9Im5vbmUiIGQ9Ik0xMDguNzIzIDE5Mi45NjIyIEw5Ny45MjkgMTg1LjcxNzIgTDk5Ljg5NTkgMTkxLjIwNjQgTDk1Ljk3ODEgMTk1LjUyNSBaIiBjbGlwLXBhdGg9InVybCgjY2xpcFBhdGgyKSIgdHJhbnNmb3JtPSJtYXRyaXgoMSwwLDAsMSwxLDEpIi8+PHBhdGggZmlsbD0ibm9uZSIgZD0iTTE2OS42NDcyIDE2NS4wMTA0IEwxNDIuNTU4NSAxODMuMTEwNCIgY2xpcC1wYXRoPSJ1cmwoI2NsaXBQYXRoMikiIHRyYW5zZm9ybT0ibWF0cml4KDEsMCwwLDEsMSwxKSIvPjxwYXRoIHN0cm9rZT0ibm9uZSIgZD0iTTEzNS45MDY4IDE4Ny41NTUgTDE0OC42NjIzIDE4NS4wNDU1IEwxNDMuMzkgMTgyLjU1NDggTDE0My4xMDY2IDE3Ni43MzA4IFoiIGNsaXAtcGF0aD0idXJsKCNjbGlwUGF0aDIpIiB0cmFuc2Zvcm09Im1hdHJpeCgxLDAsMCwxLDEsMSkiLz48cGF0aCBmaWxsPSJub25lIiBkPSJNOTQuNjUwOSAyOC4xMTYyIEwxMjMuNDg4NCAxNzMuMDkxOCIgY2xpcC1wYXRoPSJ1cmwoI2NsaXBQYXRoMikiIHRyYW5zZm9ybT0ibWF0cml4KDEsMCwwLDEsMSwxKSIvPjxwYXRoIHN0cm9rZT0ibm9uZSIgZD0iTTEyNS4wNDkxIDE4MC45MzgxIEwxMjcuNjExOSAxNjguMTkzMiBMMTIzLjI5MzMgMTcyLjExMSBMMTE3LjgwNDEgMTcwLjE0NDEgWiIgY2xpcC1wYXRoPSJ1cmwoI2NsaXBQYXRoMikiIHRyYW5zZm9ybT0ibWF0cml4KDEsMCwwLDEsMSwxKSIvPjxwYXRoIGZpbGw9Im5vbmUiIGQ9Ik04OS4wNzk3IDI5Ljg5MjIgTDYyLjk3MDEgMTYxLjE1MzciIGNsaXAtcGF0aD0idXJsKCNjbGlwUGF0aDIpIiB0cmFuc2Zvcm09Im1hdHJpeCgxLDAsMCwxLDEsMSkiLz48cGF0aCBzdHJva2U9Im5vbmUiIGQ9Ik02MS40MDk0IDE2OSBMNjguNjU0NCAxNTguMjA2MSBMNjMuMTY1MiAxNjAuMTczIEw1OC44NDY2IDE1Ni4yNTUyIFoiIGNsaXAtcGF0aD0idXJsKCNjbGlwUGF0aDIpIiB0cmFuc2Zvcm09Im1hdHJpeCgxLDAsMCwxLDEsMSkiLz48cGF0aCBmaWxsPSJub25lIiBkPSJNMjMuMzMzNiAxMzUuOTA2OCBMNDEuNDMzNiAxNjIuOTk1NCIgY2xpcC1wYXRoPSJ1cmwoI2NsaXBQYXRoMikiIHRyYW5zZm9ybT0ibWF0cml4KDEsMCwwLDEsMSwxKSIvPjxwYXRoIHN0cm9rZT0ibm9uZSIgZD0iTTQ1Ljg3ODEgMTY5LjY0NzIgTDQzLjM2ODcgMTU2Ljg5MTcgTDQwLjg3OCAxNjIuMTYzOSBMMzUuMDU0IDE2Mi40NDc0IFoiIGNsaXAtcGF0aD0idXJsKCNjbGlwUGF0aDIpIiB0cmFuc2Zvcm09Im1hdHJpeCgxLDAsMCwxLDEsMSkiLz48cGF0aCBmaWxsPSJub25lIiBkPSJNNTIuNTg1OCAxNjcuMjI3IEw3OC42OTUzIDM1Ljk2NTUiIGNsaXAtcGF0aD0idXJsKCNjbGlwUGF0aDIpIiB0cmFuc2Zvcm09Im1hdHJpeCgxLDAsMCwxLDEsMSkiLz48cGF0aCBzdHJva2U9Im5vbmUiIGQ9Ik04MC4yNTYxIDI4LjExOTIgTDczLjAxMSAzOC45MTMxIEw3OC41MDAyIDM2Ljk0NjIgTDgyLjgxODkgNDAuODY0IFoiIGNsaXAtcGF0aD0idXJsKCNjbGlwUGF0aDIpIiB0cmFuc2Zvcm09Im1hdHJpeCgxLDAsMCwxLDEsMSkiLz48cGF0aCBmaWxsPSJub25lIiBkPSJNMTE2LjIzNzYgMTgyLjc3MjMgTDg3LjQwMDIgMzcuNzk2NyIgY2xpcC1wYXRoPSJ1cmwoI2NsaXBQYXRoMikiIHRyYW5zZm9ybT0ibWF0cml4KDEsMCwwLDEsMSwxKSIvPjxwYXRoIHN0cm9rZT0ibm9uZSIgZD0iTTg1LjgzOTQgMjkuOTUwNCBMODMuMjc2NiA0Mi42OTUzIEw4Ny41OTUzIDM4Ljc3NzUgTDkzLjA4NDQgNDAuNzQ0NCBaIiBjbGlwLXBhdGg9InVybCgjY2xpcFBhdGgyKSIgdHJhbnNmb3JtPSJtYXRyaXgoMSwwLDAsMSwxLDEpIi8+PHBhdGggZmlsbD0ibm9uZSIgZD0iTTE0MS45NjUgMjUuODQzIEwxMTAuMDExOCAxOS40ODcxIiBjbGlwLXBhdGg9InVybCgjY2xpcFBhdGgyKSIgdHJhbnNmb3JtPSJtYXRyaXgoMSwwLDAsMSwxLDEpIi8+PHBhdGggc3Ryb2tlPSJub25lIiBkPSJNMTAyLjE2NTYgMTcuOTI2NCBMMTEyLjk1OTUgMjUuMTcxNCBMMTEwLjk5MjYgMTkuNjgyMiBMMTE0LjkxMDQgMTUuMzYzNSBaIiBjbGlwLXBhdGg9InVybCgjY2xpcFBhdGgyKSIgdHJhbnNmb3JtPSJtYXRyaXgoMSwwLDAsMSwxLDEpIi8+PHBhdGggZmlsbD0ibm9uZSIgZD0iTTc5LjEyMDIgMjcuNDcyIEwyNy43NzgxIDEwNC4zMTA5IiBjbGlwLXBhdGg9InVybCgjY2xpcFBhdGgyKSIgdHJhbnNmb3JtPSJtYXRyaXgoMSwwLDAsMSwxLDEpIi8+PHBhdGggc3Ryb2tlPSJub25lIiBkPSJNMjMuMzMzNiAxMTAuOTYyNyBMMzQuMTU3NyAxMDMuNzYyOSBMMjguMzMzNyAxMDMuNDc5NSBMMjUuODQzMSA5OC4yMDcyIFoiIGNsaXAtcGF0aD0idXJsKCNjbGlwUGF0aDIpIiB0cmFuc2Zvcm09Im1hdHJpeCgxLDAsMCwxLDEsMSkiLz48cGF0aCBmaWxsPSJub25lIiBkPSJNMTEwLjk2MjcgMTg3LjU1NSBMMzQuMTIzOCAxMzYuMjEyOSIgY2xpcC1wYXRoPSJ1cmwoI2NsaXBQYXRoMikiIHRyYW5zZm9ybT0ibWF0cml4KDEsMCwwLDEsMSwxKSIvPjxwYXRoIHN0cm9rZT0ibm9uZSIgZD0iTTI3LjQ3MiAxMzEuNzY4MyBMMzQuNjcxOCAxNDIuNTkyNSBMMzQuOTU1MyAxMzYuNzY4NCBMNDAuMjI3NSAxMzQuMjc3OCBaIiBjbGlwLXBhdGg9InVybCgjY2xpcFBhdGgyKSIgdHJhbnNmb3JtPSJtYXRyaXgoMSwwLDAsMSwxLDEpIi8+PHBhdGggZmlsbD0ibm9uZSIgZD0iTTE2OS42NDcyIDE0OC4zNDMzIEw0Ny44OTMxIDY2Ljk4OTgiIGNsaXAtcGF0aD0idXJsKCNjbGlwUGF0aDIpIiB0cmFuc2Zvcm09Im1hdHJpeCgxLDAsMCwxLDEsMSkiLz48cGF0aCBzdHJva2U9Im5vbmUiIGQ9Ik00MS4yNDE0IDYyLjU0NTMgTDQ4LjQ0MTEgNzMuMzY5NCBMNDguNzI0NiA2Ny41NDU0IEw1My45OTY4IDY1LjA1NDcgWiIgY2xpcC1wYXRoPSJ1cmwoI2NsaXBQYXRoMikiIHRyYW5zZm9ybT0ibWF0cml4KDEsMCwwLDEsMSwxKSIvPjxwYXRoIGZpbGw9Im5vbmUiIGQ9Ik03NC45ODE3IDIzLjMzMzYgTDQ3Ljg5MzEgNDEuNDMzNiIgY2xpcC1wYXRoPSJ1cmwoI2NsaXBQYXRoMikiIHRyYW5zZm9ybT0ibWF0cml4KDEsMCwwLDEsMSwxKSIvPjxwYXRoIHN0cm9rZT0ibm9uZSIgZD0iTTQxLjI0MTQgNDUuODc4MSBMNTMuOTk2OCA0My4zNjg3IEw0OC43MjQ2IDQwLjg3OCBMNDguNDQxMSAzNS4wNTQgWiIgY2xpcC1wYXRoPSJ1cmwoI2NsaXBQYXRoMikiIHRyYW5zZm9ybT0ibWF0cml4KDEsMCwwLDEsMSwxKSIvPjxwYXRoIGZpbGw9Im5vbmUiIGQ9Ik0xMzEuNzY4MyAxODMuNDE2NSBMMTgzLjExMDQgMTA2LjU3NzYiIGNsaXAtcGF0aD0idXJsKCNjbGlwUGF0aDIpIiB0cmFuc2Zvcm09Im1hdHJpeCgxLDAsMCwxLDEsMSkiLz48cGF0aCBzdHJva2U9Im5vbmUiIGQ9Ik0xODcuNTU1IDk5LjkyNTggTDE3Ni43MzA4IDEwNy4xMjU2IEwxODIuNTU0OCAxMDcuNDA5IEwxODUuMDQ1NSAxMTIuNjgxMyBaIiBjbGlwLXBhdGg9InVybCgjY2xpcFBhdGgyKSIgdHJhbnNmb3JtPSJtYXRyaXgoMSwwLDAsMSwxLDEpIi8+PHBhdGggZmlsbD0ibm9uZSIgZD0iTTE2NS4wMTA0IDQxLjI0MTQgTDE4My4xMTA0IDY4LjMzIiBjbGlwLXBhdGg9InVybCgjY2xpcFBhdGgyKSIgdHJhbnNmb3JtPSJtYXRyaXgoMSwwLDAsMSwxLDEpIi8+PHBhdGggc3Ryb2tlPSJub25lIiBkPSJNMTg3LjU1NSA3NC45ODE3IEwxODUuMDQ1NSA2Mi4yMjYyIEwxODIuNTU0OCA2Ny40OTg1IEwxNzYuNzMwOCA2Ny43ODE5IFoiIGNsaXAtcGF0aD0idXJsKCNjbGlwUGF0aDIpIiB0cmFuc2Zvcm09Im1hdHJpeCgxLDAsMCwxLDEsMSkiLz48cGF0aCBmaWxsPSJub25lIiBkPSJNMjU3LjQ1MjIgNjAuMjcwNiBMMjE2LjkyODcgNzguMTYzNSIgY2xpcC1wYXRoPSJ1cmwoI2NsaXBQYXRoMikiIHRyYW5zZm9ybT0ibWF0cml4KDEsMCwwLDEsMSwxKSIvPjxwYXRoIHN0cm9rZT0ibm9uZSIgZD0iTTIwOS42MTA0IDgxLjM5NDkgTDIyMi42MDc1IDgxLjEyMTggTDIxNy44NDM1IDc3Ljc1OTYgTDIxOC41NjgzIDcxLjk3MzkgWiIgY2xpcC1wYXRoPSJ1cmwoI2NsaXBQYXRoMikiIHRyYW5zZm9ybT0ibWF0cml4KDEsMCwwLDEsMSwxKSIvPjxwYXRoIGZpbGw9Im5vbmUiIGQ9Ik0yNTYuNDA3MSA5OC4yNDY2IEwyMTguNTMxMiA5MS40OTE5IiBjbGlwLXBhdGg9InVybCgjY2xpcFBhdGgyKSIgdHJhbnNmb3JtPSJtYXRyaXgoMSwwLDAsMSwxLDEpIi8+PHBhdGggc3Ryb2tlPSJub25lIiBkPSJNMjEwLjY1NTUgOTAuMDg3MyBMMjIxLjU5MTMgOTcuMTE2NSBMMjE5LjUxNTcgOTEuNjY3NCBMMjIzLjM0NyA4Ny4yNzE4IFoiIGNsaXAtcGF0aD0idXJsKCNjbGlwUGF0aDIpIiB0cmFuc2Zvcm09Im1hdHJpeCgxLDAsMCwxLDEsMSkiLz48cGF0aCBmaWxsPSJub25lIiBkPSJNMTg1LjA0NTUgMTQxLjk2NSBMMTkxLjQwMTQgMTEwLjAxMTgiIGNsaXAtcGF0aD0idXJsKCNjbGlwUGF0aDIpIiB0cmFuc2Zvcm09Im1hdHJpeCgxLDAsMCwxLDEsMSkiLz48cGF0aCBzdHJva2U9Im5vbmUiIGQ9Ik0xOTIuOTYyMiAxMDIuMTY1NiBMMTg1LjcxNzIgMTEyLjk1OTUgTDE5MS4yMDY0IDExMC45OTI2IEwxOTUuNTI1IDExNC45MTA0IFoiIGNsaXAtcGF0aD0idXJsKCNjbGlwUGF0aDIpIiB0cmFuc2Zvcm09Im1hdHJpeCgxLDAsMCwxLDEsMSkiLz48L2c+PGcgZmlsbD0iI0RERCIgc3Ryb2tlPSIjREREIiBzaGFwZS1yZW5kZXJpbmc9Imdlb21ldHJpY1ByZWNpc2lvbiIgdGV4dC1yZW5kZXJpbmc9Imdlb21ldHJpY1ByZWNpc2lvbiIgdHJhbnNmb3JtPSJtYXRyaXgoMSwwLDAsMSwxLDEpIj48Y2lyY2xlIGN4PSIxNTYuNjc3IiBjeT0iMjguNzY5IiByPSIxNSIgc3Ryb2tlPSJub25lIiBjbGlwLXBhdGg9InVybCgjY2xpcFBhdGgyKSIvPjwvZz48ZyBzdHJva2UtbGluZWNhcD0iYnV0dCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEuNDUiIHNoYXBlLXJlbmRlcmluZz0iZ2VvbWV0cmljUHJlY2lzaW9uIiB0ZXh0LXJlbmRlcmluZz0iZ2VvbWV0cmljUHJlY2lzaW9uIiB0cmFuc2Zvcm09Im1hdHJpeCgxLDAsMCwxLDEsMSkiPjxjaXJjbGUgY3g9IjE1Ni42NzciIGN5PSIyOC43NjkiIHI9IjE1IiBmaWxsPSJub25lIiBjbGlwLXBhdGg9InVybCgjY2xpcFBhdGgyKSIvPjx0ZXh0IHg9IjE1Mi45ODciIHk9IjMzLjIwOSIgc3Ryb2tlPSJub25lIiBjbGlwLXBhdGg9InVybCgjY2xpcFBhdGgyKSIgZm9udC1mYW1pbHk9IidTdWlzc2UgSW50bCciIHhtbDpzcGFjZT0icHJlc2VydmUiPjY8L3RleHQ+PC9nPjxnIGZpbGw9IiNEREQiIHN0cm9rZT0iI0RERCIgc2hhcGUtcmVuZGVyaW5nPSJnZW9tZXRyaWNQcmVjaXNpb24iIHRleHQtcmVuZGVyaW5nPSJnZW9tZXRyaWNQcmVjaXNpb24iIHRyYW5zZm9ybT0ibWF0cml4KDEsMCwwLDEsMSwxKSI+PGNpcmNsZSBjeD0iMTIzLjQzNSIgY3k9IjE5NS44ODgiIHI9IjE1IiBzdHJva2U9Im5vbmUiIGNsaXAtcGF0aD0idXJsKCNjbGlwUGF0aDIpIi8+PC9nPjxnIHN0cm9rZS1saW5lY2FwPSJidXR0IiBzdHJva2UtbWl0ZXJsaW1pdD0iMS40NSIgc2hhcGUtcmVuZGVyaW5nPSJnZW9tZXRyaWNQcmVjaXNpb24iIHRleHQtcmVuZGVyaW5nPSJnZW9tZXRyaWNQcmVjaXNpb24iIHRyYW5zZm9ybT0ibWF0cml4KDEsMCwwLDEsMSwxKSI+PGNpcmNsZSBjeD0iMTIzLjQzNSIgY3k9IjE5NS44ODgiIHI9IjE1IiBmaWxsPSJub25lIiBjbGlwLXBhdGg9InVybCgjY2xpcFBhdGgyKSIvPjx0ZXh0IHg9IjExOS43OTMiIHk9IjIwMC4zMjgiIHN0cm9rZT0ibm9uZSIgY2xpcC1wYXRoPSJ1cmwoI2NsaXBQYXRoMikiIGZvbnQtZmFtaWx5PSInU3Vpc3NlIEludGwnIiB4bWw6c3BhY2U9InByZXNlcnZlIj41PC90ZXh0PjwvZz48ZyBmaWxsPSIjREREIiBzdHJva2U9IiNEREQiIHNoYXBlLXJlbmRlcmluZz0iZ2VvbWV0cmljUHJlY2lzaW9uIiB0ZXh0LXJlbmRlcmluZz0iZ2VvbWV0cmljUHJlY2lzaW9uIiB0cmFuc2Zvcm09Im1hdHJpeCgxLDAsMCwxLDEsMSkiPjxjaXJjbGUgY3g9IjE4Mi4xMTkiIGN5PSIxNTYuNjc3IiByPSIxNSIgc3Ryb2tlPSJub25lIiBjbGlwLXBhdGg9InVybCgjY2xpcFBhdGgyKSIvPjwvZz48ZyBzdHJva2UtbGluZWNhcD0iYnV0dCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEuNDUiIHNoYXBlLXJlbmRlcmluZz0iZ2VvbWV0cmljUHJlY2lzaW9uIiB0ZXh0LXJlbmRlcmluZz0iZ2VvbWV0cmljUHJlY2lzaW9uIiB0cmFuc2Zvcm09Im1hdHJpeCgxLDAsMCwxLDEsMSkiPjxjaXJjbGUgY3g9IjE4Mi4xMTkiIGN5PSIxNTYuNjc3IiByPSIxNSIgZmlsbD0ibm9uZSIgY2xpcC1wYXRoPSJ1cmwoI2NsaXBQYXRoMikiLz48dGV4dCB4PSIxNzguNTc5IiB5PSIxNjEuMTE3IiBzdHJva2U9Im5vbmUiIGNsaXAtcGF0aD0idXJsKCNjbGlwUGF0aDIpIiBmb250LWZhbWlseT0iJ1N1aXNzZSBJbnRsJyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+MjwvdGV4dD48L2c+PGcgZmlsbD0iI0RERCIgc3Ryb2tlPSIjREREIiBzaGFwZS1yZW5kZXJpbmc9Imdlb21ldHJpY1ByZWNpc2lvbiIgdGV4dC1yZW5kZXJpbmc9Imdlb21ldHJpY1ByZWNpc2lvbiIgdHJhbnNmb3JtPSJtYXRyaXgoMSwwLDAsMSwxLDEpIj48Y2lyY2xlIGN4PSI1NC4yMTIiIGN5PSIxODIuMTE5IiByPSIxNSIgc3Ryb2tlPSJub25lIiBjbGlwLXBhdGg9InVybCgjY2xpcFBhdGgyKSIvPjwvZz48ZyBzdHJva2UtbGluZWNhcD0iYnV0dCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEuNDUiIHNoYXBlLXJlbmRlcmluZz0iZ2VvbWV0cmljUHJlY2lzaW9uIiB0ZXh0LXJlbmRlcmluZz0iZ2VvbWV0cmljUHJlY2lzaW9uIiB0cmFuc2Zvcm09Im1hdHJpeCgxLDAsMCwxLDEsMSkiPjxjaXJjbGUgY3g9IjU0LjIxMiIgY3k9IjE4Mi4xMTkiIHI9IjE1IiBmaWxsPSJub25lIiBjbGlwLXBhdGg9InVybCgjY2xpcFBhdGgyKSIvPjx0ZXh0IHg9IjUyLjAwNCIgeT0iMTg2LjU1OSIgc3Ryb2tlPSJub25lIiBjbGlwLXBhdGg9InVybCgjY2xpcFBhdGgyKSIgZm9udC1mYW1pbHk9IidTdWlzc2UgSW50bCciIHhtbDpzcGFjZT0icHJlc2VydmUiPjE8L3RleHQ+PC9nPjxnIGZpbGw9IiNEREQiIHN0cm9rZT0iI0RERCIgc2hhcGUtcmVuZGVyaW5nPSJnZW9tZXRyaWNQcmVjaXNpb24iIHRleHQtcmVuZGVyaW5nPSJnZW9tZXRyaWNQcmVjaXNpb24iIHRyYW5zZm9ybT0ibWF0cml4KDEsMCwwLDEsMSwxKSI+PGNpcmNsZSBjeD0iMjcxLjE3NCIgY3k9IjU0LjIxMiIgcj0iMTUiIHN0cm9rZT0ibm9uZSIgY2xpcC1wYXRoPSJ1cmwoI2NsaXBQYXRoMikiLz48L2c+PGcgc3Ryb2tlLWxpbmVjYXA9ImJ1dHQiIHN0cm9rZS1taXRlcmxpbWl0PSIxLjQ1IiBzaGFwZS1yZW5kZXJpbmc9Imdlb21ldHJpY1ByZWNpc2lvbiIgdGV4dC1yZW5kZXJpbmc9Imdlb21ldHJpY1ByZWNpc2lvbiIgdHJhbnNmb3JtPSJtYXRyaXgoMSwwLDAsMSwxLDEpIj48Y2lyY2xlIGN4PSIyNzEuMTc0IiBjeT0iNTQuMjEyIiByPSIxNSIgZmlsbD0ibm9uZSIgY2xpcC1wYXRoPSJ1cmwoI2NsaXBQYXRoMikiLz48dGV4dCB4PSIyNjguMDk2IiB5PSI1OC42NTIiIHN0cm9rZT0ibm9uZSIgY2xpcC1wYXRoPSJ1cmwoI2NsaXBQYXRoMikiIGZvbnQtZmFtaWx5PSInU3Vpc3NlIEludGwnIiB4bWw6c3BhY2U9InByZXNlcnZlIj43PC90ZXh0PjwvZz48ZyBmaWxsPSIjREREIiBzdHJva2U9IiNEREQiIHNoYXBlLXJlbmRlcmluZz0iZ2VvbWV0cmljUHJlY2lzaW9uIiB0ZXh0LXJlbmRlcmluZz0iZ2VvbWV0cmljUHJlY2lzaW9uIiB0cmFuc2Zvcm09Im1hdHJpeCgxLDAsMCwxLDEsMSkiPjxjaXJjbGUgY3g9Ijg3LjQ1NCIgY3k9IjE1IiByPSIxNSIgc3Ryb2tlPSJub25lIiBjbGlwLXBhdGg9InVybCgjY2xpcFBhdGgyKSIvPjwvZz48ZyBzdHJva2UtbGluZWNhcD0iYnV0dCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEuNDUiIHNoYXBlLXJlbmRlcmluZz0iZ2VvbWV0cmljUHJlY2lzaW9uIiB0ZXh0LXJlbmRlcmluZz0iZ2VvbWV0cmljUHJlY2lzaW9uIiB0cmFuc2Zvcm09Im1hdHJpeCgxLDAsMCwxLDEsMSkiPjxjaXJjbGUgY3g9Ijg3LjQ1NCIgY3k9IjE1IiByPSIxNSIgZmlsbD0ibm9uZSIgY2xpcC1wYXRoPSJ1cmwoI2NsaXBQYXRoMikiLz48dGV4dCB4PSI4My45MzIiIHk9IjE5LjQ0IiBzdHJva2U9Im5vbmUiIGNsaXAtcGF0aD0idXJsKCNjbGlwUGF0aDIpIiBmb250LWZhbWlseT0iJ1N1aXNzZSBJbnRsJyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+MzwvdGV4dD48L2c+PGcgZmlsbD0iI0RERCIgc3Ryb2tlPSIjREREIiBzaGFwZS1yZW5kZXJpbmc9Imdlb21ldHJpY1ByZWNpc2lvbiIgdGV4dC1yZW5kZXJpbmc9Imdlb21ldHJpY1ByZWNpc2lvbiIgdHJhbnNmb3JtPSJtYXRyaXgoMSwwLDAsMSwxLDEpIj48Y2lyY2xlIGN4PSIyNzEuMTc0IiBjeT0iMTAwLjg4IiByPSIxNSIgc3Ryb2tlPSJub25lIiBjbGlwLXBhdGg9InVybCgjY2xpcFBhdGgyKSIvPjwvZz48ZyBzdHJva2UtbGluZWNhcD0iYnV0dCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEuNDUiIHNoYXBlLXJlbmRlcmluZz0iZ2VvbWV0cmljUHJlY2lzaW9uIiB0ZXh0LXJlbmRlcmluZz0iZ2VvbWV0cmljUHJlY2lzaW9uIiB0cmFuc2Zvcm09Im1hdHJpeCgxLDAsMCwxLDEsMSkiPjxjaXJjbGUgY3g9IjI3MS4xNzQiIGN5PSIxMDAuODgiIHI9IjE1IiBmaWxsPSJub25lIiBjbGlwLXBhdGg9InVybCgjY2xpcFBhdGgyKSIvPjx0ZXh0IHg9IjI2Ny41MTQiIHk9IjEwNS4zMiIgc3Ryb2tlPSJub25lIiBjbGlwLXBhdGg9InVybCgjY2xpcFBhdGgyKSIgZm9udC1mYW1pbHk9IidTdWlzc2UgSW50bCciIHhtbDpzcGFjZT0icHJlc2VydmUiPjk8L3RleHQ+PC9nPjxnIGZpbGw9IiNEREQiIHN0cm9rZT0iI0RERCIgc2hhcGUtcmVuZGVyaW5nPSJnZW9tZXRyaWNQcmVjaXNpb24iIHRleHQtcmVuZGVyaW5nPSJnZW9tZXRyaWNQcmVjaXNpb24iIHRyYW5zZm9ybT0ibWF0cml4KDEsMCwwLDEsMSwxKSI+PGNpcmNsZSBjeD0iMTUiIGN5PSIxMjMuNDM1IiByPSIxNSIgc3Ryb2tlPSJub25lIiBjbGlwLXBhdGg9InVybCgjY2xpcFBhdGgyKSIvPjwvZz48ZyBzdHJva2UtbGluZWNhcD0iYnV0dCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEuNDUiIHNoYXBlLXJlbmRlcmluZz0iZ2VvbWV0cmljUHJlY2lzaW9uIiB0ZXh0LXJlbmRlcmluZz0iZ2VvbWV0cmljUHJlY2lzaW9uIiB0cmFuc2Zvcm09Im1hdHJpeCgxLDAsMCwxLDEsMSkiPjxjaXJjbGUgY3g9IjE1IiBjeT0iMTIzLjQzNSIgcj0iMTUiIGZpbGw9Im5vbmUiIGNsaXAtcGF0aD0idXJsKCNjbGlwUGF0aDIpIi8+PHRleHQgeD0iMTEuMjQ0IiB5PSIxMjcuODc1IiBzdHJva2U9Im5vbmUiIGNsaXAtcGF0aD0idXJsKCNjbGlwUGF0aDIpIiBmb250LWZhbWlseT0iJ1N1aXNzZSBJbnRsJyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+ODwvdGV4dD48L2c+PGcgZmlsbD0iI0RERCIgc3Ryb2tlPSIjREREIiBzaGFwZS1yZW5kZXJpbmc9Imdlb21ldHJpY1ByZWNpc2lvbiIgdGV4dC1yZW5kZXJpbmc9Imdlb21ldHJpY1ByZWNpc2lvbiIgdHJhbnNmb3JtPSJtYXRyaXgoMSwwLDAsMSwxLDEpIj48Y2lyY2xlIGN4PSIyOC43NjkiIGN5PSI1NC4yMTIiIHI9IjE1IiBzdHJva2U9Im5vbmUiIGNsaXAtcGF0aD0idXJsKCNjbGlwUGF0aDIpIi8+PC9nPjxnIHN0cm9rZS1saW5lY2FwPSJidXR0IiBzdHJva2UtbWl0ZXJsaW1pdD0iMS40NSIgc2hhcGUtcmVuZGVyaW5nPSJnZW9tZXRyaWNQcmVjaXNpb24iIHRleHQtcmVuZGVyaW5nPSJnZW9tZXRyaWNQcmVjaXNpb24iIHRyYW5zZm9ybT0ibWF0cml4KDEsMCwwLDEsMSwxKSI+PGNpcmNsZSBjeD0iMjguNzY5IiBjeT0iNTQuMjEyIiByPSIxNSIgZmlsbD0ibm9uZSIgY2xpcC1wYXRoPSJ1cmwoI2NsaXBQYXRoMikiLz48dGV4dCB4PSIyMi41OTUiIHk9IjU4LjY1MiIgc3Ryb2tlPSJub25lIiBjbGlwLXBhdGg9InVybCgjY2xpcFBhdGgyKSIgZm9udC1mYW1pbHk9IidTdWlzc2UgSW50bCciIHhtbDpzcGFjZT0icHJlc2VydmUiPjEwPC90ZXh0PjwvZz48ZyBmaWxsPSIjREREIiBzdHJva2U9IiNEREQiIHNoYXBlLXJlbmRlcmluZz0iZ2VvbWV0cmljUHJlY2lzaW9uIiB0ZXh0LXJlbmRlcmluZz0iZ2VvbWV0cmljUHJlY2lzaW9uIiB0cmFuc2Zvcm09Im1hdHJpeCgxLDAsMCwxLDEsMSkiPjxjaXJjbGUgY3g9IjE5NS44ODgiIGN5PSI4Ny40NTQiIHI9IjE1IiBzdHJva2U9Im5vbmUiIGNsaXAtcGF0aD0idXJsKCNjbGlwUGF0aDIpIi8+PC9nPjxnIHN0cm9rZS1saW5lY2FwPSJidXR0IiBzdHJva2UtbWl0ZXJsaW1pdD0iMS40NSIgc2hhcGUtcmVuZGVyaW5nPSJnZW9tZXRyaWNQcmVjaXNpb24iIHRleHQtcmVuZGVyaW5nPSJnZW9tZXRyaWNQcmVjaXNpb24iIHRyYW5zZm9ybT0ibWF0cml4KDEsMCwwLDEsMSwxKSI+PGNpcmNsZSBjeD0iMTk1Ljg4OCIgY3k9Ijg3LjQ1NCIgcj0iMTUiIGZpbGw9Im5vbmUiIGNsaXAtcGF0aD0idXJsKCNjbGlwUGF0aDIpIi8+PHRleHQgeD0iMTkyLjE0NCIgeT0iOTEuODk0IiBzdHJva2U9Im5vbmUiIGNsaXAtcGF0aD0idXJsKCNjbGlwUGF0aDIpIiBmb250LWZhbWlseT0iJ1N1aXNzZSBJbnRsJyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+NDwvdGV4dD48L2c+PC9nPjwvc3ZnPg==" style="width: 700px; text-align: center"></p> <pre class="language-sql highlighter-rouge" data-language="sql">CREATE TABLE edge (node1id INTEGER, node2id INTEGER);
INSERT INTO edge VALUES
    (1, 3), (1, 5), (2, 4), (2, 5), (2, 10), (3, 1),
    (3, 5), (3, 8), (3, 10), (5, 3), (5, 4), (5, 8),
    (6, 3), (6, 4), (7, 4), (8, 1), (9, 4);</pre> <p>Note that the graph contains directed cycles, e.g., between nodes 1, 2, and 5.</p> <h4 id="enumerate-all-paths-from-a-node"> <a style="text-decoration: none;" href="#enumerate-all-paths-from-a-node">Enumerate All Paths from a Node</a> </h4> <p>The following query returns <strong>all paths</strong> starting in node 1:</p> <pre class="language-sql highlighter-rouge" data-language="sql">WITH RECURSIVE paths(startNode, endNode, path) AS (
        SELECT -- Define the path as the first edge of the traversal
            node1id AS startNode,
            node2id AS endNode,
            [node1id, node2id] AS path
        FROM edge
        WHERE startNode = 1
        UNION ALL
        SELECT -- Concatenate new edge to the path
            paths.startNode AS startNode,
            node2id AS endNode,
            array_append(path, node2id) AS path
        FROM paths
        JOIN edge ON paths.endNode = node1id
        -- Prevent adding a repeated node to the path.
        -- This ensures that no cycles occur.
        WHERE list_position(paths.path, node2id) IS NULL
    )
SELECT startNode, endNode, path
FROM paths
ORDER BY length(path), path;</pre> <table> <thead> <tr> <th style="text-align: right">startNode</th> <th style="text-align: right">endNode</th> <th>path</th> </tr> </thead> <tbody> <tr> <td style="text-align: right">1</td> <td style="text-align: right">3</td> <td>[1, 3]</td> </tr> <tr> <td style="text-align: right">1</td> <td style="text-align: right">5</td> <td>[1, 5]</td> </tr> <tr> <td style="text-align: right">1</td> <td style="text-align: right">5</td> <td>[1, 3, 5]</td> </tr> <tr> <td style="text-align: right">1</td> <td style="text-align: right">8</td> <td>[1, 3, 8]</td> </tr> <tr> <td style="text-align: right">1</td> <td style="text-align: right">10</td> <td>[1, 3, 10]</td> </tr> <tr> <td style="text-align: right">1</td> <td style="text-align: right">3</td> <td>[1, 5, 3]</td> </tr> <tr> <td style="text-align: right">1</td> <td style="text-align: right">4</td> <td>[1, 5, 4]</td> </tr> <tr> <td style="text-align: right">1</td> <td style="text-align: right">8</td> <td>[1, 5, 8]</td> </tr> <tr> <td style="text-align: right">1</td> <td style="text-align: right">4</td> <td>[1, 3, 5, 4]</td> </tr> <tr> <td style="text-align: right">1</td> <td style="text-align: right">8</td> <td>[1, 3, 5, 8]</td> </tr> <tr> <td style="text-align: right">1</td> <td style="text-align: right">8</td> <td>[1, 5, 3, 8]</td> </tr> <tr> <td style="text-align: right">1</td> <td style="text-align: right">10</td> <td>[1, 5, 3, 10]</td> </tr> </tbody> </table> <p>Note that the result of this query is not restricted to shortest paths, e.g., for node 5, the results include paths <code class="language-plaintext highlighter-rouge">[1, 5]</code> and <code class="language-plaintext highlighter-rouge">[1, 3, 5]</code>.</p> <h4 id="enumerate-unweighted-shortest-paths-from-a-node"> <a style="text-decoration: none;" href="#enumerate-unweighted-shortest-paths-from-a-node">Enumerate Unweighted Shortest Paths from a Node</a> </h4> <p>In most cases, enumerating all paths is not practical or feasible. Instead, only the <strong>(unweighted) shortest paths</strong> are of interest. To find these, the second half of the <code class="language-plaintext highlighter-rouge">WITH RECURSIVE</code> query should be adjusted such that it only includes a node if it has not yet been visited. This is implemented by using a subquery that checks if any of the previous paths includes the node:</p> <pre class="language-sql highlighter-rouge" data-language="sql">WITH RECURSIVE paths(startNode, endNode, path) AS (
        SELECT -- Define the path as the first edge of the traversal
            node1id AS startNode,
            node2id AS endNode,
            [node1id, node2id] AS path
        FROM edge
        WHERE startNode = 1
        UNION ALL
        SELECT -- Concatenate new edge to the path
            paths.startNode AS startNode,
            node2id AS endNode,
            array_append(path, node2id) AS path
        FROM paths
        JOIN edge ON paths.endNode = node1id
        -- Prevent adding a node that was visited previously by any path.
        -- This ensures that (1) no cycles occur and (2) only nodes that
        -- were not visited by previous (shorter) paths are added to a path.
        WHERE NOT EXISTS (
                FROM paths previous_paths
                WHERE list_contains(previous_paths.path, node2id)
              )
    )
SELECT startNode, endNode, path
FROM paths
ORDER BY length(path), path;</pre> <table> <thead> <tr> <th style="text-align: right">startNode</th> <th style="text-align: right">endNode</th> <th>path</th> </tr> </thead> <tbody> <tr> <td style="text-align: right">1</td> <td style="text-align: right">3</td> <td>[1, 3]</td> </tr> <tr> <td style="text-align: right">1</td> <td style="text-align: right">5</td> <td>[1, 5]</td> </tr> <tr> <td style="text-align: right">1</td> <td style="text-align: right">8</td> <td>[1, 3, 8]</td> </tr> <tr> <td style="text-align: right">1</td> <td style="text-align: right">10</td> <td>[1, 3, 10]</td> </tr> <tr> <td style="text-align: right">1</td> <td style="text-align: right">4</td> <td>[1, 5, 4]</td> </tr> <tr> <td style="text-align: right">1</td> <td style="text-align: right">8</td> <td>[1, 5, 8]</td> </tr> </tbody> </table> <h4 id="enumerate-unweighted-shortest-paths-between-two-nodes"> <a style="text-decoration: none;" href="#enumerate-unweighted-shortest-paths-between-two-nodes">Enumerate Unweighted Shortest Paths between Two Nodes</a> </h4> <p><code class="language-plaintext highlighter-rouge">WITH RECURSIVE</code> can also be used to find <strong>all (unweighted) shortest paths between two nodes</strong>. To ensure that the recursive query is stopped as soon as we reach the end node, we use a <a href="../functions/window_functions.html">window function</a> which checks whether the end node is among the newly added nodes.</p> <p>The following query returns all unweighted shortest paths between nodes 1 (start node) and 8 (end node):</p> <pre class="language-sql highlighter-rouge" data-language="sql">WITH RECURSIVE paths(startNode, endNode, path, endReached) AS (
   SELECT -- Define the path as the first edge of the traversal
        node1id AS startNode,
        node2id AS endNode,
        [node1id, node2id] AS path,
        (node2id = 8) AS endReached
     FROM edge
     WHERE startNode = 1
   UNION ALL
   SELECT -- Concatenate new edge to the path
        paths.startNode AS startNode,
        node2id AS endNode,
        array_append(path, node2id) AS path,
        max(CASE WHEN node2id = 8 THEN 1 ELSE 0 END)
            OVER (ROWS BETWEEN UNBOUNDED PRECEDING
                           AND UNBOUNDED FOLLOWING) AS endReached
     FROM paths
     JOIN edge ON paths.endNode = node1id
    WHERE NOT EXISTS (
            FROM paths previous_paths
            WHERE list_contains(previous_paths.path, node2id)
          )
      AND paths.endReached = 0
)
SELECT startNode, endNode, path
FROM paths
WHERE endNode = 8
ORDER BY length(path), path;</pre> <table> <thead> <tr> <th style="text-align: right">startNode</th> <th style="text-align: right">endNode</th> <th>path</th> </tr> </thead> <tbody> <tr> <td style="text-align: right">1</td> <td style="text-align: right">8</td> <td>[1, 3, 8]</td> </tr> <tr> <td style="text-align: right">1</td> <td style="text-align: right">8</td> <td>[1, 5, 8]</td> </tr> </tbody> </table> <h2 id="limitations"> <a style="text-decoration: none;" href="#limitations">Limitations</a> </h2> <p>DuckDB does not support mutually recursive CTEs. See the <a href="https://github.com/duckdb/duckdb/issues/14716#issuecomment-2467952456">related issue and discussion in the DuckDB repository</a>.</p> <h2 id="syntax"> <a style="text-decoration: none;" href="#syntax">Syntax</a> </h2><div class="_attribution">
  <p class="_attribution-p">
    &copy; Copyright 2018&ndash;2024 Stichting DuckDB Foundation<br>Licensed under the MIT License.<br>
    <a href="https://duckdb.org/docs/sql/query_syntax/with.html" class="_attribution-link">https://duckdb.org/docs/sql/query_syntax/with.html</a>
  </p>
</div>
