<h1 class="title">Prepared Statements</h1>  <p>DuckDB supports prepared statements where parameters are substituted when the query is executed. This can improve readability and is useful for preventing <a href="https://en.wikipedia.org/wiki/SQL_injection">SQL injections</a>.</p> <h2 id="syntax"> <a style="text-decoration: none;" href="#syntax">Syntax</a> </h2> <p>There are three syntaxes for denoting parameters in prepared statements: auto-incremented (<code class="language-plaintext highlighter-rouge">?</code>), positional (<code class="language-plaintext highlighter-rouge">$1</code>), and named (<code class="language-plaintext highlighter-rouge">$param</code>). Note that not all clients support all of these syntaxes, e.g., the <a href="../../api/java.html">JDBC client</a> only supports auto-incremented parameters in prepared statements.</p> <h3 id="example-data-set"> <a style="text-decoration: none;" href="#example-data-set">Example Data Set</a> </h3> <p>In the following, we introduce the three different syntaxes and illustrate them with examples using the following table.</p> <pre class="language-sql highlighter-rouge" data-language="sql">CREATE TABLE person (name VARCHAR, age BIGINT);
INSERT INTO person VALUES ('Alice', 37), ('Ana', 35), ('Bob', 41), ('Bea', 25);</pre> <p>In our example query, we'll look for people whose name starts with a <code class="language-plaintext highlighter-rouge">B</code> and are at least 40 years old. This will return a single row <code class="language-plaintext highlighter-rouge">&lt;'Bob', 41&gt;</code>.</p> <h3 id="auto-incremented-parameters-"> <a style="text-decoration: none;" href="#auto-incremented-parameters-">Auto-Incremented Parameters: <code class="language-plaintext highlighter-rouge">?</code></a> </h3> <p>DuckDB support using prepared statements with auto-incremented indexing, i.e., the position of the parameters in the query corresponds to their position in the execution statement. For example:</p> <pre class="language-sql highlighter-rouge" data-language="sql">PREPARE query_person AS
    SELECT *
    FROM person
    WHERE starts_with(name, ?)
      AND age &gt;= ?;</pre> <p>Using the CLI client, the statement is executed as follows.</p> <pre class="language-sql highlighter-rouge" data-language="sql">EXECUTE query_person('B', 40);</pre> <h3 id="positional-parameters-1"> <a style="text-decoration: none;" href="#positional-parameters-1">Positional Parameters: <code class="language-plaintext highlighter-rouge">$1</code></a> </h3> <p>Prepared statements can use positional parameters, where parameters are denoted with an integer (<code class="language-plaintext highlighter-rouge">$1</code>, <code class="language-plaintext highlighter-rouge">$2</code>). For example:</p> <pre class="language-sql highlighter-rouge" data-language="sql">PREPARE query_person AS
    SELECT *
    FROM person
    WHERE starts_with(name, $2)
      AND age &gt;= $1;</pre> <p>Using the CLI client, the statement is executed as follows. Note that the first parameter corresponds to <code class="language-plaintext highlighter-rouge">$1</code>, the second to <code class="language-plaintext highlighter-rouge">$2</code>, and so on.</p> <pre class="language-sql highlighter-rouge" data-language="sql">EXECUTE query_person(40, 'B');</pre> <h3 id="named-parameters-parameter"> <a style="text-decoration: none;" href="#named-parameters-parameter">Named Parameters: <code class="language-plaintext highlighter-rouge">$parameter</code></a> </h3> <p>DuckDB also supports names parameters where parameters are denoted with <code class="language-plaintext highlighter-rouge">$parameter_name</code>. For example:</p> <pre class="language-sql highlighter-rouge" data-language="sql">PREPARE query_person AS
    SELECT *
    FROM person
    WHERE starts_with(name, $name_start_letter)
      AND age &gt;= $minimum_age;</pre> <p>Using the CLI client, the statement is executed as follows.</p> <pre class="language-sql highlighter-rouge" data-language="sql">EXECUTE query_person(name_start_letter := 'B', minimum_age := 40);</pre> <h2 id="dropping-prepared-statements-deallocate"> <a style="text-decoration: none;" href="#dropping-prepared-statements-deallocate">Dropping Prepared Statements: <code class="language-plaintext highlighter-rouge">DEALLOCATE</code></a> </h2> <p>To drop a prepared statement, use the <code class="language-plaintext highlighter-rouge">DEALLOCATE</code> statement:</p> <pre class="language-sql highlighter-rouge" data-language="sql">DEALLOCATE query_person;</pre> <p>Alternatively, use:</p> <pre class="language-sql highlighter-rouge" data-language="sql">DEALLOCATE PREPARE query_person;</pre><div class="_attribution">
  <p class="_attribution-p">
    &copy; Copyright 2018&ndash;2024 Stichting DuckDB Foundation<br>Licensed under the MIT License.<br>
    <a href="https://duckdb.org/docs/sql/query_syntax/prepared_statements.html" class="_attribution-link">https://duckdb.org/docs/sql/query_syntax/prepared_statements.html</a>
  </p>
</div>
