<h1 class="title">Full-Text Search</h1>  <p>DuckDB supports full-text search via the <a href="../../extensions/full_text_search.html"><code class="language-plaintext highlighter-rouge">fts</code> extension</a>. A full-text index allows for a query to quickly search for all occurrences of individual words within longer text strings.</p> <h2 id="example-shakespeare-corpus"> <a style="text-decoration: none;" href="#example-shakespeare-corpus">Example: Shakespeare Corpus</a> </h2> <p>Here's an example of building a full-text index of Shakespeare's plays.</p> <pre class="language-sql highlighter-rouge" data-language="sql">CREATE TABLE corpus AS
    SELECT * FROM 'https://blobs.duckdb.org/data/shakespeare.parquet';</pre> <pre class="language-sql highlighter-rouge" data-language="sql">DESCRIBE corpus;</pre> <table> <thead> <tr> <th>column_name</th> <th>column_type</th> <th>null</th> <th>key</th> <th>default</th> <th>extra</th> </tr> </thead> <tbody> <tr> <td>line_id</td> <td>VARCHAR</td> <td>YES</td> <td>NULL</td> <td>NULL</td> <td>NULL</td> </tr> <tr> <td>play_name</td> <td>VARCHAR</td> <td>YES</td> <td>NULL</td> <td>NULL</td> <td>NULL</td> </tr> <tr> <td>line_number</td> <td>VARCHAR</td> <td>YES</td> <td>NULL</td> <td>NULL</td> <td>NULL</td> </tr> <tr> <td>speaker</td> <td>VARCHAR</td> <td>YES</td> <td>NULL</td> <td>NULL</td> <td>NULL</td> </tr> <tr> <td>text_entry</td> <td>VARCHAR</td> <td>YES</td> <td>NULL</td> <td>NULL</td> <td>NULL</td> </tr> </tbody> </table> <p>The text of each line is in <code class="language-plaintext highlighter-rouge">text_entry</code>, and a unique key for each line is in <code class="language-plaintext highlighter-rouge">line_id</code>.</p> <h2 id="creating-a-full-text-search-index"> <a style="text-decoration: none;" href="#creating-a-full-text-search-index">Creating a Full-Text Search Index</a> </h2> <p>First, we create the index, specifying the table name, the unique id column, and the column(s) to index. We will just index the single column <code class="language-plaintext highlighter-rouge">text_entry</code>, which contains the text of the lines in the play.</p> <pre class="language-sql highlighter-rouge" data-language="sql">PRAGMA create_fts_index('corpus', 'line_id', 'text_entry');</pre> <p>The table is now ready to query using the <a href="https://en.wikipedia.org/wiki/Okapi_BM25">Okapi BM25</a> ranking function. Rows with no match return a null score.</p> <p>What does Shakespeare say about butter?</p> <pre class="language-sql highlighter-rouge" data-language="sql">SELECT
    fts_main_corpus.match_bm25(line_id, 'butter') AS score,
    line_id, play_name, speaker, text_entry
FROM corpus
WHERE score IS NOT NULL
ORDER BY score DESC;</pre> <table> <thead> <tr> <th style="text-align: right">score</th> <th>line_id</th> <th>play_name</th> <th>speaker</th> <th>text_entry</th> </tr> </thead> <tbody> <tr> <td style="text-align: right">4.427313429798464</td> <td>H4/2.4.494</td> <td>Henry IV</td> <td>Carrier</td> <td>As fat as butter.</td> </tr> <tr> <td style="text-align: right">3.836270302568675</td> <td>H4/1.2.21</td> <td>Henry IV</td> <td>FALSTAFF</td> <td>prologue to an egg and butter.</td> </tr> <tr> <td style="text-align: right">3.836270302568675</td> <td>H4/2.1.55</td> <td>Henry IV</td> <td>Chamberlain</td> <td>They are up already, and call for eggs and butter;</td> </tr> <tr> <td style="text-align: right">3.3844488405497115</td> <td>H4/4.2.21</td> <td>Henry IV</td> <td>FALSTAFF</td> <td>toasts-and-butter, with hearts in their bellies no</td> </tr> <tr> <td style="text-align: right">3.3844488405497115</td> <td>H4/4.2.62</td> <td>Henry IV</td> <td>PRINCE HENRY</td> <td>already made thee butter. But tell me, Jack, whose</td> </tr> <tr> <td style="text-align: right">3.3844488405497115</td> <td>AWW/4.1.40</td> <td>Alls well that ends well</td> <td>PAROLLES</td> <td>butter-womans mouth and buy myself another of</td> </tr> <tr> <td style="text-align: right">3.3844488405497115</td> <td>AYLI/3.2.93</td> <td>As you like it</td> <td>TOUCHSTONE</td> <td>right butter-womens rank to market.</td> </tr> <tr> <td style="text-align: right">3.3844488405497115</td> <td>KL/2.4.132</td> <td>King Lear</td> <td>Fool</td> <td>kindness to his horse, buttered his hay.</td> </tr> <tr> <td style="text-align: right">3.0278411214953107</td> <td>AWW/5.2.9</td> <td>Alls well that ends well</td> <td>Clown</td> <td>henceforth eat no fish of fortunes buttering.</td> </tr> <tr> <td style="text-align: right">3.0278411214953107</td> <td>MWW/2.2.260</td> <td>Merry Wives of Windsor</td> <td>FALSTAFF</td> <td>Hang him, mechanical salt-butter rogue! I will</td> </tr> <tr> <td style="text-align: right">3.0278411214953107</td> <td>MWW/2.2.284</td> <td>Merry Wives of Windsor</td> <td>FORD</td> <td>rather trust a Fleming with my butter, Parson Hugh</td> </tr> <tr> <td style="text-align: right">3.0278411214953107</td> <td>MWW/3.5.7</td> <td>Merry Wives of Windsor</td> <td>FALSTAFF</td> <td>Ill have my brains taen out and buttered, and give</td> </tr> <tr> <td style="text-align: right">3.0278411214953107</td> <td>MWW/3.5.102</td> <td>Merry Wives of Windsor</td> <td>FALSTAFF</td> <td>to heat as butter; a man of continual dissolution</td> </tr> <tr> <td style="text-align: right">2.739219044070792</td> <td>H4/2.4.115</td> <td>Henry IV</td> <td>PRINCE HENRY</td> <td>Didst thou never see Titan kiss a dish of butter?</td> </tr> </tbody> </table> <p>Unlike standard indexes, full-text indexes don't auto-update as the underlying data is changed, so you need to <code class="language-plaintext highlighter-rouge">PRAGMA drop_fts_index(my_fts_index)</code> and recreate it when appropriate.</p> <h2 id="note-on-generating-the-corpus-table"> <a style="text-decoration: none;" href="#note-on-generating-the-corpus-table">Note on Generating the Corpus Table</a> </h2> <p>For more details, see the <a href="https://duckdb.blogspot.com/2023/04/generating-shakespeare-corpus-for-full.html">“Generating a Shakespeare corpus for full-text searching from JSON” blog post</a></p> <ul> <li>The Columns are: line_id, play_name, line_number, speaker, text_entry.</li> <li>We need a unique key for each row in order for full-text searching to work.</li> <li>The line_id <code class="language-plaintext highlighter-rouge">KL/2.4.132</code> means King Lear, Act 2, Scene 4, Line 132.</li> </ul><div class="_attribution">
  <p class="_attribution-p">
    &copy; Copyright 2018&ndash;2024 Stichting DuckDB Foundation<br>Licensed under the MIT License.<br>
    <a href="https://duckdb.org/docs/guides/sql_features/full_text_search.html" class="_attribution-link">https://duckdb.org/docs/guides/sql_features/full_text_search.html</a>
  </p>
</div>
