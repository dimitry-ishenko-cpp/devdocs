<h1 class="title">S3 Express One</h1>  <p>In late 2023, AWS <a href="https://aws.amazon.com/about-aws/whats-new/2023/11/amazon-s3-express-one-zone-storage-class/">announced</a> the <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/s3-express-one-zone.html">S3 Express One Zone</a>, a high-speed variant of traditional S3 buckets. DuckDB can read S3 Express One buckets using the <a href="../../extensions/httpfs/overview.html"><code class="language-plaintext highlighter-rouge">httpfs</code> extension</a>.</p> <h2 id="credentials-and-configuration"> <a style="text-decoration: none;" href="#credentials-and-configuration">Credentials and Configuration</a> </h2> <p>The configuration of S3 Express One buckets is similar to <a href="s3_import.html">regular S3 buckets</a> with one exception: we have to specify the endpoint according to the following pattern:</p> <pre class="language-text highlighter-rouge" data-language="text">s3express-⟨availability zone⟩.⟨region⟩.amazonaws.com</pre> <p>where the <code class="language-plaintext highlighter-rouge">⟨availability zone⟩</code> (e.g., <code class="language-plaintext highlighter-rouge">use-az5</code>) can be obtained from the S3 Express One bucket's configuration page and the <code class="language-plaintext highlighter-rouge">⟨region⟩</code> is the AWS region (e.g., <code class="language-plaintext highlighter-rouge">us-east-1</code>).</p> <p>For example, to allow DuckDB to use an S3 Express One bucket, configure the <a href="../../sql/statements/create_secret.html">Secrets manager</a> as follows:</p> <pre class="language-sql highlighter-rouge" data-language="sql">CREATE SECRET (
    TYPE S3,
    REGION 'us-east-1',
    KEY_ID 'AKIAIOSFODNN7EXAMPLE',
    SECRET 'wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY',
    ENDPOINT 's3express-use1-az5.us-east-1.amazonaws.com'
);</pre> <h2 id="instance-location"> <a style="text-decoration: none;" href="#instance-location">Instance Location</a> </h2> <p>For best performance, make sure that the EC2 instance is in the same availability zone as the S3 Express One bucket you are querying. To determine the mapping between zone names and zone IDs, use the <code class="language-plaintext highlighter-rouge">aws ec2 describe-availability-zones</code> command.</p> <ul> <li> <p>Zone name to zone ID mapping:</p> <pre class="language-batch highlighter-rouge" data-language="batch">aws ec2 describe-availability-zones --output json \
    | jq -r '.AvailabilityZones[] | select(.ZoneName == "us-east-1f") | .ZoneId'</pre> <pre class="language-text highlighter-rouge" data-language="text">use1-az5</pre> </li> <li> <p>Zone ID to zone name mapping:</p> <pre class="language-batch highlighter-rouge" data-language="batch">aws ec2 describe-availability-zones --output json \
    | jq -r '.AvailabilityZones[] | select(.ZoneId == "use1-az5") | .ZoneName'</pre> <pre class="language-text highlighter-rouge" data-language="text">us-east-1f</pre> </li> </ul> <h2 id="querying"> <a style="text-decoration: none;" href="#querying">Querying</a> </h2> <p>You can query the S3 Express One bucket as any other S3 bucket:</p> <pre class="language-sql highlighter-rouge" data-language="sql">SELECT *
FROM 's3://express-bucket-name--use1-az5--x-s3/my-file.parquet';</pre> <h2 id="performance"> <a style="text-decoration: none;" href="#performance">Performance</a> </h2> <p>We ran two experiments on a <code class="language-plaintext highlighter-rouge">c7gd.12xlarge</code> instance using the <a href="https://blobs.duckdb.org/data/ldbc-sf300-comments-creationDate.parquet">LDBC SF300 Comments <code class="language-plaintext highlighter-rouge">creationDate</code> Parquet file</a> file (also used in the <a href="../performance/benchmarks.html#data-sets.html">microbenchmarks of the performance guide</a>).</p>  <table> <thead> <tr> <th style="text-align: left">Experiment</th> <th style="text-align: right">File size</th> <th style="text-align: right">Runtime</th> </tr> </thead> <tbody> <tr> <td style="text-align: left">Loading only from Parquet</td> <td style="text-align: right">4.1 GB</td> <td style="text-align: right">3.5s</td> </tr> <tr> <td style="text-align: left">Creating local table from Parquet</td> <td style="text-align: right">4.1 GB</td> <td style="text-align: right">5.1s</td> </tr> </tbody> </table> <p>The “loading only” variant is running the load as part of an <a href="../meta/explain_analyze.html"><code class="language-plaintext highlighter-rouge">EXPLAIN ANALYZE</code></a> statement to measure the runtime without account creating a local table, while the “creating local table” variant uses <a href="../../sql/statements/create_table.html#create-table--as-select-ctas.html"><code class="language-plaintext highlighter-rouge">CREATE TABLE ... AS SELECT</code></a> to create a persistent table on the local disk.</p><div class="_attribution">
  <p class="_attribution-p">
    &copy; Copyright 2018&ndash;2024 Stichting DuckDB Foundation<br>Licensed under the MIT License.<br>
    <a href="https://duckdb.org/docs/guides/network_cloud_storage/s3_express_one.html" class="_attribution-link">https://duckdb.org/docs/guides/network_cloud_storage/s3_express_one.html</a>
  </p>
</div>
