<h1 id="testing-with-playwright"> Testing with Playwright <span class="badge warning" style="vertical-align:top;" data-v-76652c5d>Since 2.5</span>
</h1> <p>Playwright is a Node library to automate the <a href="https://www.chromium.org/Home" target="_blank" rel="noopener noreferrer">Chromium<span> <span class="sr-only">(opens new window)</span></span></a>, <a href="https://webkit.org/" target="_blank" rel="noopener noreferrer">WebKit<span> <span class="sr-only">(opens new window)</span></span></a> and <a href="https://www.mozilla.org/en-US/firefox/new/" target="_blank" rel="noopener noreferrer">Firefox<span> <span class="sr-only">(opens new window)</span></span></a> browsers with a single API. It enables <strong>cross-browser</strong> web automation that is <strong>ever-green</strong>, <strong>capable</strong>, <strong>reliable</strong> and <strong>fast</strong>.</p> <p>Playwright was built similarly to <a href="https://github.com/puppeteer/puppeteer" target="_blank" rel="noopener noreferrer">Puppeteer<span> <span class="sr-only">(opens new window)</span></span></a>, using its API and so is very different in usage. However, Playwright has cross browser support with better design for test automaiton.</p> <p>Take a look at a sample test:</p> <div class="language-js extra-class"><pre class="language-js">I.amOnPage('https://github.com');
I.click('Sign in', '//html/body/div[1]/header');
I.see('Sign in to GitHub', 'h1');
I.fillField('Username or email address', 'something@totest.com');
I.fillField('Password', '123456');
I.click('Sign in');
I.see('Incorrect username or password.', '.flash-error');
</pre></div>
<p>It's readable and simple and working using Playwright API!</p> <h2 id="setup"> Setup</h2> <p>To start you need CodeceptJS with Playwright packages installed</p> <div class="language-bash extra-class"><pre class="language-bash">npm install codeceptjs playwright --save
</pre></div>
<p>Or see <a href="https://codecept.io/installation/" target="_blank" rel="noopener noreferrer">alternative installation options<span> <span class="sr-only">(opens new window)</span></span></a></p> <blockquote><p>If you already have CodeceptJS project, just install <code>playwright</code> package and enable a helper it in config.</p></blockquote> <p>And a basic project initialized</p> <div class="language-sh extra-class"><pre class="language-sh">npx codeceptjs init
</pre></div>
<p>You will be asked for a Helper to use, you should select Playwright and provide url of a website you are testing.</p> <h2 id="configuring"> Configuring</h2> <p>Make sure <code>Playwright</code> helper is enabled in <code>codecept.conf.js</code> config:</p> <div class="language-js extra-class"><pre class="language-js">{ // ..
  helpers: {
    Playwright: {
      url: "http://localhost",
      show: true,
      browser: 'chromium'
    }
  }
  // ..
}
</pre></div>
<blockquote><p>Turn off the <code>show</code> option if you want to run test in headless mode. If you don't specify the browser here, <code>chromium</code> will be used. Possible browsers are: <code>chromium</code>, <code>firefox</code> and <code>webkit</code></p></blockquote> <p>Playwright uses different strategies to detect if a page is loaded. In configuration use <code>waitForNavigation</code> option for that:</p> <p>When to consider navigation succeeded, defaults to <code>load</code>. Given an array of event strings, navigation is considered to be successful after all events have been fired. Events can be either:</p> <ul>
<li>
<code>load</code> - consider navigation to be finished when the load event is fired.</li> <li>
<code>domcontentloaded</code> - consider navigation to be finished when the DOMContentLoaded event is fired.</li> <li>
<code>networkidle</code> - consider navigation to be finished when there are no network connections for at least 500 ms.</li>
</ul> <div class="language-js extra-class"><pre class="language-js">  helpers: {
    Playwright: {
      url: "http://localhost",
      show: true,
      browser: 'chromium',
      waitForNavigation: "networkidle0"
    }
  }
</pre></div>
<p>When a test runs faster than application it is recommended to increase <code>waitForAction</code> config value. It will wait for a small amount of time (100ms) by default after each user action is taken.</p> <blockquote><p>▶ More options are listed in <a href="https://codecept.io/helpers/Playwright/" target="_blank" rel="noopener noreferrer">helper reference<span> <span class="sr-only">(opens new window)</span></span></a>.</p></blockquote> <h2 id="writing-tests"> Writing Tests</h2> <p>Additional CodeceptJS tests should be created with <code>gt</code> command:</p> <div class="language-sh extra-class"><pre class="language-sh">npx codeceptjs gt
</pre></div>
<p>As an example we will use <code>ToDoMvc</code> app for testing.</p> <h3 id="actions"> Actions</h3> <p>Tests consist with a scenario of user's action taken on a page. The most widely used ones are:</p> <ul>
<li>
<code>amOnPage</code> - to open a webpage (accepts relative or absolute url)</li> <li>
<code>click</code> - to locate a button or link and click on it</li> <li>
<code>fillField</code> - to enter a text inside a field</li> <li>
<code>selectOption</code>, <code>checkOption</code> - to interact with a form</li> <li>
<code>wait*</code> to wait for some parts of page to be fully rendered (important for testing SPA)</li> <li>
<code>grab*</code> to get values from page sources</li> <li>
<code>see</code>, <code>dontSee</code> - to check for a text on a page</li> <li>
<code>seeElement</code>, <code>dontSeeElement</code> - to check for elements on a page</li>
</ul> <blockquote><p>ℹ All actions are listed in <a href="https://codecept.io/helpers/Playwright/" target="_blank" rel="noopener noreferrer">Playwright helper reference<span> <span class="sr-only">(opens new window)</span></span></a>.*</p></blockquote> <p>All actions which interact with elements can use <strong><a href="https://codecept.io/locators/#css-and-xpath" target="_blank" rel="noopener noreferrer">CSS or XPath locators<span> <span class="sr-only">(opens new window)</span></span></a></strong>. Actions like <code>click</code> or <code>fillField</code> can locate elements by their name or value on a page:</p> <div class="language-js extra-class"><pre class="language-js">// search for link or button
I.click('Login');
// locate field by its label
I.fillField('Name', 'Miles');
// we can use input name
I.fillField('user[email]','miles@davis.com');
</pre></div>
<p>You can also specify the exact locator type with strict locators:</p> <div class="language-js extra-class"><pre class="language-js">I.click({css: 'button.red'});
I.fillField({name: 'user[email]'},'miles@davis.com');
I.seeElement({xpath: '//body/header'});
</pre></div>
<h3 id="interactive-pause"> Interactive Pause</h3> <p>It's easy to start writing a test if you use <a href="https://codecept.io/basics#debug">interactive pause</a>. Just open a web page and pause execution.</p> <div class="language-js extra-class"><pre class="language-js">Feature('Sample Test');

Scenario('open my website', ({ I }) =&gt; {
  I.amOnPage('http://todomvc.com/examples/react/');
  pause();
});
</pre></div>
<p>This is just enough to run a test, open a browser, and think what to do next to write a test case.</p> <p>When you execute such test with <code>codeceptjs run</code> command you may see the browser is started</p> <div class="language- extra-class"><pre class="language-text">npx codeceptjs run --steps
</pre></div>
<p>After a page is opened a full control of a browser is given to a terminal. Type in different commands such as <code>click</code>, <code>see</code>, <code>fillField</code> to write the test. A successful commands will be saved to <code>./output/cli-history</code> file and can be copied into a test.</p> <p>A complete ToDo-MVC test may look like:</p> <div class="language-js extra-class"><pre class="language-js">Feature('ToDo');

Scenario('create todo item', ({ I }) =&gt; {
  I.amOnPage('http://todomvc.com/examples/react/');
  I.dontSeeElement('.todo-count');
  I.fillField('What needs to be done?', 'Write a guide');
  I.pressKey('Enter');
  I.see('Write a guide', '.todo-list');
  I.see('1 item left', '.todo-count');
});
</pre></div>
<h3 id="grabbers"> Grabbers</h3> <p>If you need to get element's value inside a test you can use <code>grab*</code> methods. They should be used with <code>await</code> operator inside <code>async</code> function:</p> <div class="language-js extra-class"><pre class="language-js">const assert = require('assert');
Scenario('get value of current tasks', async ({ I }) =&gt; {
  I.createTodo('do 1');
  I.createTodo('do 2');
  let numTodos = await I.grabTextFrom('.todo-count strong');
  assert.equal(2, numTodos);
});
</pre></div>
<h3 id="within"> Within</h3> <p>In case some actions should be taken inside one element (a container or modal window or iframe) you can use <code>within</code> block to narrow the scope. Please take a note that you can't use within inside another within in Playwright helper:</p> <div class="language-js extra-class"><pre class="language-js">within('.todoapp', () =&gt; {
  I.createTodo('my new item');
  I.see('1 item left', '.todo-count');
  I.click('.todo-list input.toggle');
});
I.see('0 items left', '.todo-count');
</pre></div>
<blockquote><p><a href="https://codecept.io/basics#writing-tests">▶ Learn more about basic commands</a></p></blockquote> <p>CodeceptJS allows you to implement custom actions like <code>I.createTodo</code> or use <strong>PageObjects</strong>. Learn how to improve your tests in <a href="https://codecept.io/pageobjects/" target="_blank" rel="noopener noreferrer">PageObjects<span> <span class="sr-only">(opens new window)</span></span></a> guide.</p> <h2 id="multi-session-testing"> Multi Session Testing</h2> <p>TO launch additional browser context (or incognito window) use <code>session</code> command.</p> <div class="language-js extra-class"><pre class="language-js">Scenario('I try to open this site as anonymous user', () =&gt; {
  I.amOnPage('/');
  I.dontSee('Agree to cookies');
  session('anonymous user', () =&gt; {
    I.amOnPage('/');
    I.see('Agree to cookies');
  });
})
</pre></div>
<blockquote><p>ℹ Learn more about <a href="https://codecept.io/basics/#multiple-sessions">multi-session testing</a></p></blockquote> <h2 id="device-emulation"> Device Emulation</h2> <p>Playwright can emulate browsers of mobile devices. Instead of paying for expensive devices for mobile tests you can adjust Playwright settings so it could emulate mobile browsers on iPhone, Samsung Galaxy, etc.</p> <p>Device emulation can be enabled in CodeceptJS globally in a config or per session.</p> <p>Playwright contains a <a href="https://github.com/Microsoft/playwright/blob/master/src/deviceDescriptors.ts" target="_blank" rel="noopener noreferrer">list of predefined devices<span> <span class="sr-only">(opens new window)</span></span></a> to emulate, for instance this is how you can enable iPhone 6 emulation for all tests:</p> <div class="language-js extra-class"><pre class="language-js">const { devices } = require('playwright');

helpers: {
  Playwright: {
    // regular config goes here
    emulate: devices['iPhone 6'],
  }
}
</pre></div>
<p>To adjust browser settings you can pass <a href="https://github.com/microsoft/playwright/blob/master/docs/api.md#browsernewcontextoptions" target="_blank" rel="noopener noreferrer">custom options<span> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-js extra-class"><pre class="language-js">helpers: {
  Playwright: {
    // regular config goes here
    // put on mobile device
    emulate: { isMobile: true, deviceScaleFactor: 2 }
  }
}
</pre></div>
<p>To enable device emulation for a specific test, create an additional browser session and pass in config as a second parameter:</p> <div class="language-js extra-class"><pre class="language-js">const { devices } = require('playwright');

Scenario('website looks nice on iPhone', () =&gt; {
  session('mobile user', devices['iPhone 6'], () =&gt; {
    I.amOnPage('/');
    I.see('Hello, iPhone user!')
  })
});
</pre></div>
<h2 id="configuring-ci"> Configuring CI</h2> <h3 id="github-actions"> GitHub Actions</h3> <p>Playwright can be added to GitHub Actions using <a href="https://github.com/microsoft/playwright-github-action" target="_blank" rel="noopener noreferrer">official action<span> <span class="sr-only">(opens new window)</span></span></a>. Use it before starting CodeceptJS tests to install all dependencies. It is important to run tests in headless mode (<a href="https://github.com/microsoft/playwright-github-action#run-in-headful-mode" target="_blank" rel="noopener noreferrer">otherwise you will need to enable xvfb to emulate desktop<span> <span class="sr-only">(opens new window)</span></span></a>).</p> <div class="language-yml extra-class"><pre class="language-yml"># from workflows/tests.yml
- uses: microsoft/playwright-github-action@v1
- name: run CodeceptJS tests
  run: npx codeceptjs run
</pre></div>
<h2 id="accessing-playwright-api"> Accessing Playwright API</h2> <p>To get <a href="https://github.com/microsoft/playwright/blob/master/docs/api.md" target="_blank" rel="noopener noreferrer">Playwright API<span> <span class="sr-only">(opens new window)</span></span></a> inside a test use <code>I.usePlaywrightTo</code> method with a callback. To keep test readable provide a description of a callback inside the first parameter.</p> <div class="language-js extra-class"><pre class="language-js">I.usePlaywrightTo('emulate offline mode', async ({ browser, context, page }) =&gt; {
  // use browser, page, context objects inside this function
  await context.setOffline(true);
});
</pre></div>
<p>Playwright commands are asynchronous so a callback function must be async.</p> <p>A Playwright helper is passed as argument for callback, so you can combine Playwrigth API with CodeceptJS API:</p> <div class="language-js extra-class"><pre class="language-js">I.usePlaywrightTo('emulate offline mode', async (Playwright) =&gt; {
  // access internal objects browser, page, context of helper
  await Playwright.context.setOffline(true);
  // call a method of helper, await is required here
  await Playwright.click('Reload');
});

</pre></div>
<h2 id="extending-helper"> Extending Helper</h2> <p>To create custom <code>I.*</code> commands using Playwright API you need to create a custom helper.</p> <p>Start with creating an <code>MyPlaywright</code> helper using <code>generate:helper</code> or <code>gh</code> command:</p> <div class="language-sh extra-class"><pre class="language-sh">npx codeceptjs gh
</pre></div>
<p>Then inside a Helper you can access <code>Playwright</code> helper of CodeceptJS. Let's say you want to create <code>I.grabDimensionsOfCurrentPage</code> action. In this case you need to call <code>evaluate</code> method of <code>page</code> object</p> <div class="language-js extra-class"><pre class="language-js">// inside a MyPlaywright helper
async grabDimensionsOfCurrentPage() {
  const { page } = this.helpers.Playwright;
  await page.goto('https://www.example.com/');
  return page.evaluate(() =&gt; {
    return {
      width: document.documentElement.clientWidth,
      height: document.documentElement.clientHeight,
      deviceScaleFactor: window.devicePixelRatio
    }
  })
}
</pre></div>
<p>The same way you can also access <code>browser</code> object to implement more actions or handle events. For instance, you want to set the permissions, you can approach it with:</p> <div class="language-js extra-class"><pre class="language-js">// inside a MyPlaywright helper
async setPermissions() {
  const { browser } = this.helpers.Playwright;
  const context = browser.defaultContext()
  return context.setPermissions('https://html5demos.com', ['geolocation']);
}
</pre></div>
<blockquote><p><a href="https://github.com/microsoft/playwright/blob/master/docs/api.md#class-browsercontext" target="_blank" rel="noopener noreferrer">▶ Learn more about BrowserContext<span> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <blockquote><p><a href="https://codecept.io/helpers/" target="_blank" rel="noopener noreferrer">▶ Learn more about Helpers<span> <span class="sr-only">(opens new window)</span></span></a></p></blockquote><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2015 DavertMik &lt;davert@codegyre.com&gt; (http://codegyre.com)<br>Licensed under the MIT License.<br>
    <a href="https://codecept.io/playwright/" class="_attribution-link">https://codecept.io/playwright/</a>
  </p>
</div>
