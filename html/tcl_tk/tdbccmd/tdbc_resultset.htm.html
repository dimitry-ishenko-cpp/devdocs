<h1>tdbc_resultset</h1>  <h2 id="M2">Name</h2> tdbc::resultset — TDBC result set object <h2 id="M3">Synopsis</h2> package require <b>tdbc 1.0</b><br> package require <b>tdbc::</b><i>driver version</i><br> <br> <b>tdbc::</b><i>driver</i><b>::connection create </b><i>db</i> <i>?-option value</i>...?<br> <br> <b><a href="../tclcmd/set.htm.html">set</a></b> <i>stmt</i> <b>[</b><i>db</i> <b>prepare</b> <i>sql-code</i><b>]</b><br> <b><a href="../tclcmd/set.htm.html">set</a></b> <i>resultset</i> <b>[</b><i>$stmt</i> <b>execute</b> ?<i>args...</i>?<b>]</b><br> <br> <i>$resultset</i> <b>columns</b><br> <i>$resultset</i> <b>rowcount</b><br> <i>$resultset</i> <b>nextrow</b> ?<b>-as</b> <b>lists</b>|<b>dicts</b>? ?<b>--</b>? <i>varname</i><br> <i>$resultset</i> <b>nextlist</b> <i>varname</i><br> <i>$resultset</i> <b>nextdict</b> <i>varname</i><br> <i>$resultset</i> <b>nextresults</b><br> <i>$resultset</i> <b>allrows</b> ?<b>-as lists|dicts</b>? ?<b>-columnsvariable</b> <i>name</i>? ?<b>--</b>?<br> <i>$resultset</i> <b><a href="../tclcmd/foreach.htm.html">foreach</a></b> ?<b>-as lists|dicts</b>? ?<b>-columnsvariable</b> <i>name</i>? ?<b>--</b>? <i>varname</i> <i>script</i><br> <i>$resultset</i> <b><a href="../tclcmd/close.htm.html">close</a></b><br> <h2 id="M4">Description</h2> Every database driver for TDBC (Tcl DataBase Connectivity) implements a <i>result set</i> object that represents a the results returned from executing SQL statement in a database. Instances of this object are created by executing the <b>execute</b> object command on a statement object. <p> The <b>columns</b> obect command returns a list of the names of the columns in the result set. The columns will appear in the same order as they appeared in the SQL statement that performed the database query. If the SQL statement does not return a set of columns (for instance, if it is an INSERT, UPDATE, or DELETE statement), the <b>columns</b> command will return an empty list. </p>
<p> The <b>rowcount</b> object command returns the number of rows in the database that were affected by the execution of an INSERT, UPDATE or DELETE statement. For a SELECT statement, the row count is unspecified. </p>
<p> The <b>nextlist</b> object command sets the variable given by <i>varname</i> in the caller's scope to the next row of the results, expressed as a list of column values. NULL values are replaced by empty strings. The columns of the result row appear in the same order in which they appeared on the SELECT statement. The return of <b>nextlist</b> is <b>1</b> if the operation succeeded, and <b>0</b> if the end of the result set was reached. </p>
<p> The <b>nextdict</b> object command sets the variable given by <i>varname</i> in the caller's scope to the next row of the results, expressed as a dictionary. The dictionary's keys are column names, and the values are the values of those columns in the row. If a column's value in the row is NULL, its key is omitted from the dictionary. The keys appear in the dictionary in the same order in which the columns appeared on the SELECT statement. The return of <b>nextdict</b> is <b>1</b> if the operation succeeded, and <b>0</b> if the end of the result set was reached. </p>
<p> The <b>nextrow</b> object command is precisely equivalent to the <b>nextdict</b> or <b>nextlist</b> object command, depending on whether <b>-as dicts</b> (the default) or <b>-as lists</b> is specified. </p>
<p> Some databases support the idea of a single statement that returns multiple sets of results. The <b>nextresults</b> object command is executed, typically after the <b>nextlist</b> of <b>nextdict</b> object command has returned <b>0</b>, to advance to the next result set. It returns <b>1</b> if there is another result set to process, and <b>0</b> if the result set just processed was the last. After calling <b>nextresults</b> and getting the return value of <b>1</b>, the caller may once again call <b>columns</b> to get the column descriptions of the next result set, and then return to calling <b>nextdict</b> or <b>nextlist</b> to process the rows of the next result set. It is an error to call <b>columns</b>, <b>nextdict</b>, <b>nextlist</b> or <b>nextrow</b> after <b>nextresults</b> has returned <b>0</b>. </p>
<p> The <b>allrows</b> object command sets the variable designated by the <b>-columnsvariable</b> option (if present) to the result of the <b>columns</b> object command. It then executes the <b>nextrow</b> object command repeatedly until the end of the result set is reached. If <b>nextresults</b> returns a nonzero value, it executes the above two steps (<b>columns</b> followed by iterated <b>nextrow</b> calls) as long as further results are available. The rows returned by <b>nextrow</b> are assembled into a Tcl list and become the return value of the <b>allrows</b> command; the last value returned from <b>columns</b> is what the application will see in <b>-columnsvariable</b>. </p>
<p> The <b><a href="../tclcmd/foreach.htm.html">foreach</a></b> object command sets the variable designated by the <b>-columnsvariable</b> option (if present) to the result of the <b>columns</b> object command. It then executes the <b>nextrow</b> object command repeatedly until the end of the result set is reached, storing the successive rows in the variable designated by <i>varName</i>. For each row, it executes the given <i>script</i>. If the script terminates with an error, the error is reported by the <b><a href="../tclcmd/foreach.htm.html">foreach</a></b> command, and iteration stops. If the script performs a <b><a href="../tclcmd/break.htm.html">break</a></b> operation, the iteration terminates prematurely. If the script performs a <b><a href="../tclcmd/continue.htm.html">continue</a></b> operation, the iteration recommences with the next row. If the script performs a <b><a href="../tclcmd/return.htm.html">return</a></b>, results are the same as if a script outside the control of <b><a href="../tclcmd/foreach.htm.html">foreach</a></b> had returned. Any other unusual return code terminates the iteration and is reported from the <b><a href="../tclcmd/foreach.htm.html">foreach</a></b>. </p>
<p> Once <b>nextrow</b> returns <b>0</b>, the <b><a href="../tclcmd/foreach.htm.html">foreach</a></b> object command tries to advance to the next result set using <b>nextresults</b>. If <b>nextresults</b> returns <b>1</b>, the above steps (<b>columns</b> and <b>nextrow</b>, with script invocation) are repeated as long as more result sets remain. The <i>script</i> will always see the correct description of the columns of the current result set in the variable designated byt <b>-columnsvariable</b>. At the end of the call, the variable designated by <b>-columnsvariable</b> will have the description of the columns of the last result set. </p>
<p> The <b><a href="../tclcmd/close.htm.html">close</a></b> object command deletes the result set and frees any associated system resources. </p>
<h2 id="M5">See also</h2> <b><a href="../tclcmd/encoding.htm.html">encoding</a></b>, <b><a href="tdbc.htm.html">tdbc</a></b>, <b><a href="tdbc_connection.htm.html">tdbc::connection</a></b>, <b><a href="tdbc_statement.htm.html">tdbc::statement</a></b>, <b><a href="tdbc_tokenize.htm.html">tdbc::tokenize</a></b>   <h2 id="M7">Copyright</h2> Copyright (c) 2008 by Kevin B. Kenny. <div class="_attribution"><p class="_attribution-p">Copyright © 2008 by Kevin B. Kenny. </p></div><div class="_attribution">
  <p class="_attribution-p">
    Licensed under <a href="http://tcl.tk/software/tcltk/license.html">Tcl/Tk terms</a><br>
    <a href="https://www.tcl.tk/man/tcl/TdbcCmd/tdbc_resultset.htm" class="_attribution-link">https://www.tcl.tk/man/tcl/TdbcCmd/tdbc_resultset.htm</a>
  </p>
</div>
