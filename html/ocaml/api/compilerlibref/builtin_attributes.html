<div class="api"> <h1>Module Builtin_attributes</h1> <pre id="MODULEBuiltin_attributes" data-type="module Builtin_attributes [Module Builtin_attributes]" data-language="ocaml">module Builtin_attributes: sig .. end</pre>
<div class="info module top"> <div class="info-desc"> <p>Support for the builtin attributes:</p> <ul> <li>ocaml.alert</li> <li>ocaml.boxed</li> <li>ocaml.deprecated</li> <li>ocaml.deprecated_mutable</li> <li>ocaml.explicit_arity</li> <li>ocaml.immediate</li> <li>ocaml.immediate64</li> <li>ocaml.inline</li> <li>ocaml.inlined</li> <li>ocaml.noalloc</li> <li>ocaml.poll</li> <li>ocaml.ppwarning</li> <li>ocaml.specialise</li> <li>ocaml.specialised</li> <li>ocaml.tailcall</li> <li>ocaml.tail_mod_cons</li> <li>ocaml.unboxed</li> <li>ocaml.untagged</li> <li>ocaml.unrolled</li> <li>ocaml.warnerror</li> <li>ocaml.warning</li> <li>ocaml.warn_on_literal_pattern</li> </ul> <p><b>Warning:</b> this module is unstable and part of <a href="compiler_libs.html">compiler-libs</a>.</p> </div> </div>  <h3 id="2_Attributetrackingforwarning53">Attribute tracking for warning 53</h3> <pre id="TYPEcurrent_phase" data-type="type current_phase [Module Builtin_attributes]" data-language="ocaml">type current_phase = </pre>
<table class="typetable"> <tbody>
<tr> <td align="left" valign="top"> <code><span class="keyword">|</span></code>
</td> <td align="left" valign="top"> <code><span id="TYPEELTcurrent_phase.Parser"><span class="constructor">Parser</span></span></code>
</td> </tr> <tr> <td align="left" valign="top"> <code><span class="keyword">|</span></code>
</td> <td align="left" valign="top"> <code><span id="TYPEELTcurrent_phase.Invariant_check"><span class="constructor">Invariant_check</span></span></code>
</td> </tr>
</tbody>
</table> <div class="info "> <div class="info-desc"> <p><code class="code">register_attr</code> must be called on the locations of all attributes that should be tracked for the purpose of misplaced attribute warnings. In particular, it should be called on all attributes that are present in the source program except those that are contained in the payload of another attribute (because these may be left behind by a ppx and intentionally ignored by the compiler).</p> <p>The <code class="code">current_phase</code> argument indicates when this function is being called</p> <ul> <li>either when an attribute is created in the parser or when we see an attribute while running the check in the <code class="code"><span class="constructor">Ast_invariants</span></code> module. This is used to ensure that we track only attributes from the final version of the parse tree: we skip adding attributes seen at parse time if we can see that a ppx will be run later, because the <code class="code"><span class="constructor">Ast_invariants</span></code> check is always run on the result of a ppx.</li> </ul> <p>Note that the <code class="code"><span class="constructor">Ast_invariants</span></code> check is also run on parse trees created from marshalled ast files if no ppx is being used, ensuring we don't miss attributes in that case.</p> </div> </div> <pre id="VALregister_attr" data-type="val register_attr [Module Builtin_attributes]" data-language="ocaml">val register_attr : current_phase -&gt; string Location.loc -&gt; unit</pre> <pre id="VALmark_payload_attrs_used" data-type="val mark_payload_attrs_used [Module Builtin_attributes]" data-language="ocaml">val mark_payload_attrs_used : Parsetree.payload -&gt; unit</pre>
<div class="info "> <div class="info-desc"> <p>Marks the attributes hiding in the payload of another attribute used, for the purposes of misplaced attribute warnings (see comment on <code class="code">current_phase</code> above). In the parser, it's simplest to add these to the table and remove them later, rather than threading through state tracking whether we're in an attribute payload.</p> </div> </div> <pre id="VALwarn_unused" data-type="val warn_unused [Module Builtin_attributes]" data-language="ocaml">val warn_unused : unit -&gt; unit</pre>
<div class="info "> <div class="info-desc"> <p>Issue misplaced attribute warnings for all attributes created with <code class="code">mk_internal</code> but not yet marked used.</p> </div> </div> <h4 id="3_Warning53helpersforenvironmentattributes">Warning 53 helpers for environment attributes</h4> <p>Some attributes, like deprecation markers, do not affect the compilation of the definition on which they appear, but rather result in warnings on future uses of that definition. This is implemented by moving the raw attributes into the environment, where they will be noticed on future accesses.</p> <p>To make misplaced attribute warnings work appropriately for these attributes, we mark them "used" when they are moved into the environment. This is done with the helper functions in this section.</p> <pre id="VALmark_alert_used" data-type="val mark_alert_used [Module Builtin_attributes]" data-language="ocaml">val mark_alert_used : Parsetree.attribute -&gt; unit</pre>
<div class="info "> <div class="info-desc"> <p>Marks the attribute used for the purposes of misplaced attribute warnings if it is an alert. Call this when moving things allowed to have alert attributes into the environment.</p> </div> </div> <pre id="VALmark_alerts_used" data-type="val mark_alerts_used [Module Builtin_attributes]" data-language="ocaml">val mark_alerts_used : Parsetree.attributes -&gt; unit</pre>
<div class="info "> <div class="info-desc"> <p>The same as <code class="code"><span class="constructor">List</span>.iter mark_alert_used</code>.</p> </div> </div> <pre id="VALmark_warn_on_literal_pattern_used" data-type="val mark_warn_on_literal_pattern_used [Module Builtin_attributes]" data-language="ocaml">val mark_warn_on_literal_pattern_used : Parsetree.attributes -&gt; unit</pre>
<div class="info "> <div class="info-desc"> <p>Marks "warn_on_literal_pattern" attributes used for the purposes of misplaced attribute warnings. Call this when moving constructors into the environment.</p> </div> </div> <pre id="VALmark_deprecated_mutable_used" data-type="val mark_deprecated_mutable_used [Module Builtin_attributes]" data-language="ocaml">val mark_deprecated_mutable_used : Parsetree.attributes -&gt; unit</pre>
<div class="info "> <div class="info-desc"> <p>Marks "deprecated_mutable" attributes used for the purposes of misplaced attribute warnings. Call this when moving labels of mutable fields into the environment.</p> </div> </div> <h3 id="2_Helpersforalertandwarningattributes">Helpers for alert and warning attributes</h3> <pre id="VALcheck_alerts" data-type="val check_alerts [Module Builtin_attributes]" data-language="ocaml">val check_alerts : Location.t -&gt; Parsetree.attributes -&gt; string -&gt; unit</pre> <pre id="VALcheck_alerts_inclusion" data-type="val check_alerts_inclusion [Module Builtin_attributes]" data-language="ocaml">val check_alerts_inclusion : def:Location.t -&gt;       use:Location.t -&gt;       Location.t -&gt; Parsetree.attributes -&gt; Parsetree.attributes -&gt; string -&gt; unit</pre> <pre id="VALalerts_of_attrs" data-type="val alerts_of_attrs [Module Builtin_attributes]" data-language="ocaml">val alerts_of_attrs : Parsetree.attributes -&gt; Misc.alerts</pre> <pre id="VALalerts_of_sig" data-type="val alerts_of_sig [Module Builtin_attributes]" data-language="ocaml">val alerts_of_sig : Parsetree.signature -&gt; Misc.alerts</pre> <pre id="VALalerts_of_str" data-type="val alerts_of_str [Module Builtin_attributes]" data-language="ocaml">val alerts_of_str : Parsetree.structure -&gt; Misc.alerts</pre> <pre id="VALcheck_deprecated_mutable" data-type="val check_deprecated_mutable [Module Builtin_attributes]" data-language="ocaml">val check_deprecated_mutable : Location.t -&gt; Parsetree.attributes -&gt; string -&gt; unit</pre> <pre id="VALcheck_deprecated_mutable_inclusion" data-type="val check_deprecated_mutable_inclusion [Module Builtin_attributes]" data-language="ocaml">val check_deprecated_mutable_inclusion : def:Location.t -&gt;       use:Location.t -&gt;       Location.t -&gt; Parsetree.attributes -&gt; Parsetree.attributes -&gt; string -&gt; unit</pre> <pre id="VALerror_of_extension" data-type="val error_of_extension [Module Builtin_attributes]" data-language="ocaml">val error_of_extension : Parsetree.extension -&gt; Location.error</pre> <pre id="VALwarning_attribute" data-type="val warning_attribute [Module Builtin_attributes]" data-language="ocaml">val warning_attribute : ?ppwarning:bool -&gt; Parsetree.attribute -&gt; unit</pre>
<div class="info "> <div class="info-desc"> <p>Apply warning settings from the specified attribute. "ocaml.warning"/"ocaml.warnerror" (and variants without the prefix) are processed and marked used for warning 53. Other attributes are ignored.</p> <p>Also implement ocaml.ppwarning (unless ~ppwarning:false is passed).</p> </div> </div> <pre id="VALwarning_scope" data-type="val warning_scope [Module Builtin_attributes]" data-language="ocaml">val warning_scope : ?ppwarning:bool -&gt; Parsetree.attributes -&gt; (unit -&gt; 'a) -&gt; 'a</pre>
<div class="info "> <div class="info-desc"> <p>Execute a function in a new scope for warning settings. This means that the effect of any call to <code class="code">warning_attribute</code> during the execution of this function will be discarded after execution.</p> <p>The function also takes a list of attributes which are processed with <code class="code">warning_attribute</code> in the fresh scope before the function is executed.</p> </div> </div> <h3 id="2_Helpersforsearchingforparticularattributes">Helpers for searching for particular attributes</h3> <pre id="VALhas_attribute" data-type="val has_attribute [Module Builtin_attributes]" data-language="ocaml">val has_attribute : string -&gt; Parsetree.attributes -&gt; bool</pre>
<div class="info "> <div class="info-desc"> <p><code class="code">has_attribute name attrs</code> is true if an attribute with name <code class="code">name</code> or <code class="code"><span class="string">"ocaml."</span> ^ name</code> is present in <code class="code">attrs</code>. It marks that attribute used for the purposes of misplaced attribute warnings.</p> </div> </div> <pre id="TYPEattr_action" data-type="type attr_action [Module Builtin_attributes]" data-language="ocaml">type attr_action = </pre>
<table class="typetable"> <tbody>
<tr> <td align="left" valign="top"> <code><span class="keyword">|</span></code>
</td> <td align="left" valign="top"> <code><span id="TYPEELTattr_action.Mark_used_only"><span class="constructor">Mark_used_only</span></span></code>
</td> </tr> <tr> <td align="left" valign="top"> <code><span class="keyword">|</span></code>
</td> <td align="left" valign="top"> <code><span id="TYPEELTattr_action.Return"><span class="constructor">Return</span></span></code>
</td> </tr>
</tbody>
</table> <div class="info "> <div class="info-desc"> <p><code class="code">select_attributes actions attrs</code> finds the elements of <code class="code">attrs</code> that appear in <code class="code">actions</code> and either returns them or just marks them used, according to the corresponding <code class="code">attr_action</code>.</p> <p>Each element <code class="code">(nm, action)</code> of the <code class="code">actions</code> list is an attribute along with an <code class="code">attr_action</code> specifying what to do with that attribute. The action is used to accommodate different compiler configurations. If an attribute is used only in some compiler configurations, it's important that we still look for it and mark it used when compiling with other configurations. Otherwise, we would issue spurious misplaced attribute warnings.</p> </div> </div> <pre id="VALselect_attributes" data-type="val select_attributes [Module Builtin_attributes]" data-language="ocaml">val select_attributes : (string * attr_action) list -&gt;       Parsetree.attributes -&gt; Parsetree.attributes</pre> <pre id="VALattr_equals_builtin" data-type="val attr_equals_builtin [Module Builtin_attributes]" data-language="ocaml">val attr_equals_builtin : Parsetree.attribute -&gt; string -&gt; bool</pre>
<div class="info "> <div class="info-desc"> <p><code class="code">attr_equals_builtin attr s</code> is true if the name of the attribute is <code class="code">s</code> or <code class="code"><span class="string">"ocaml."</span> ^ s</code>. This is useful for manually inspecting attribute names, but note that doing so will not result in marking the attribute used for the purpose of warning 53, so it is usually preferrable to use <code class="code">has_attribute</code> or <code class="code">select_attributes</code>.</p> </div> </div> <pre id="VALwarn_on_literal_pattern" data-type="val warn_on_literal_pattern [Module Builtin_attributes]" data-language="ocaml">val warn_on_literal_pattern : Parsetree.attributes -&gt; bool</pre> <pre id="VALexplicit_arity" data-type="val explicit_arity [Module Builtin_attributes]" data-language="ocaml">val explicit_arity : Parsetree.attributes -&gt; bool</pre> <pre id="VALimmediate" data-type="val immediate [Module Builtin_attributes]" data-language="ocaml">val immediate : Parsetree.attributes -&gt; bool</pre> <pre id="VALimmediate64" data-type="val immediate64 [Module Builtin_attributes]" data-language="ocaml">val immediate64 : Parsetree.attributes -&gt; bool</pre> <pre id="VALhas_unboxed" data-type="val has_unboxed [Module Builtin_attributes]" data-language="ocaml">val has_unboxed : Parsetree.attributes -&gt; bool</pre> <pre id="VALhas_boxed" data-type="val has_boxed [Module Builtin_attributes]" data-language="ocaml">val has_boxed : Parsetree.attributes -&gt; bool</pre> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 1995-2024 INRIA.<br>
    <a href="https://ocaml.org/manual/5.2/api/compilerlibref/Builtin_attributes.html" class="_attribution-link">https://ocaml.org/manual/5.2/api/compilerlibref/Builtin_attributes.html</a>
  </p>
</div>
