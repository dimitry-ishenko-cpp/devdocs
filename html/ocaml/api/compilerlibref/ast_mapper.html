<div class="api"> <h1>Module Ast_mapper</h1> <pre id="MODULEAst_mapper" data-type="module Ast_mapper [Module Ast_mapper]" data-language="ocaml">module Ast_mapper: sig .. end</pre>
<div class="info module top"> <div class="info-desc"> <p>The interface of a -ppx rewriter</p> <p>A -ppx rewriter is a program that accepts a serialized abstract syntax tree and outputs another, possibly modified, abstract syntax tree. This module encapsulates the interface between the compiler and the -ppx rewriters, handling such details as the serialization format, forwarding of command-line flags, and storing state.</p> <p><a href="ast_mapper.html#TYPEmapper"><code class="code"><span class="constructor">Ast_mapper</span>.mapper</code></a> enables AST rewriting using open recursion. A typical mapper would be based on <a href="ast_mapper.html#VALdefault_mapper"><code class="code"><span class="constructor">Ast_mapper</span>.default_mapper</code></a>, a deep identity mapper, and will fall back on it for handling the syntax it does not modify. For example:</p> <pre class="codepre" data-language="ocaml">open Asttypes
open Parsetree
open Ast_mapper

let test_mapper argv =
  { default_mapper with
    expr = fun mapper expr -&gt;
      match expr with
      | { pexp_desc = Pexp_extension ({ txt = "test" }, PStr [])} -&gt;
        Ast_helper.Exp.constant (Pconst_integer ("42", None))
      | other -&gt; default_mapper.expr mapper other; }

let () =
  register "ppx_test" test_mapper</pre> <p>This -ppx rewriter, which replaces <code class="code">[%test]</code> in expressions with the constant <code class="code">42</code>, can be compiled using <code class="code">ocamlc -o ppx_test -<span class="constructor">I</span> +compiler-libs ocamlcommon.cma ppx_test.ml</code>.</p> <p><b>Warning:</b> this module is unstable and part of <a href="compiler_libs.html">compiler-libs</a>.</p> </div> </div>  <h2 id="1_AgenericParsetreemapper">A generic Parsetree mapper</h2> <pre id="TYPEmapper" data-type="type mapper [Module Ast_mapper]" data-language="ocaml">type mapper = {</pre>
<table class="typetable"> <tbody>
<tr> <td align="left" valign="top"> 
</td> <td align="left" valign="top"> <code><span id="TYPEELTmapper.attribute">attribute</span> : <code class="type"><a href="ast_mapper.html#TYPEmapper">mapper</a> -&gt; <a href="parsetree.html#TYPEattribute">Parsetree.attribute</a> -&gt; <a href="parsetree.html#TYPEattribute">Parsetree.attribute</a></code>;</code>
</td> </tr> <tr> <td align="left" valign="top"> 
</td> <td align="left" valign="top"> <code><span id="TYPEELTmapper.attributes">attributes</span> : <code class="type"><a href="ast_mapper.html#TYPEmapper">mapper</a> -&gt; <a href="parsetree.html#TYPEattribute">Parsetree.attribute</a> list -&gt; <a href="parsetree.html#TYPEattribute">Parsetree.attribute</a> list</code>;</code>
</td> </tr> <tr> <td align="left" valign="top"> 
</td> <td align="left" valign="top"> <code><span id="TYPEELTmapper.binding_op">binding_op</span> : <code class="type"><a href="ast_mapper.html#TYPEmapper">mapper</a> -&gt; <a href="parsetree.html#TYPEbinding_op">Parsetree.binding_op</a> -&gt; <a href="parsetree.html#TYPEbinding_op">Parsetree.binding_op</a></code>;</code>
</td> </tr> <tr> <td align="left" valign="top"> 
</td> <td align="left" valign="top"> <code><span id="TYPEELTmapper.case">case</span> : <code class="type"><a href="ast_mapper.html#TYPEmapper">mapper</a> -&gt; <a href="parsetree.html#TYPEcase">Parsetree.case</a> -&gt; <a href="parsetree.html#TYPEcase">Parsetree.case</a></code>;</code>
</td> </tr> <tr> <td align="left" valign="top"> 
</td> <td align="left" valign="top"> <code><span id="TYPEELTmapper.cases">cases</span> : <code class="type"><a href="ast_mapper.html#TYPEmapper">mapper</a> -&gt; <a href="parsetree.html#TYPEcase">Parsetree.case</a> list -&gt; <a href="parsetree.html#TYPEcase">Parsetree.case</a> list</code>;</code>
</td> </tr> <tr> <td align="left" valign="top"> 
</td> <td align="left" valign="top"> <code><span id="TYPEELTmapper.class_declaration">class_declaration</span> : <code class="type"><a href="ast_mapper.html#TYPEmapper">mapper</a> -&gt;<br>       <a href="parsetree.html#TYPEclass_declaration">Parsetree.class_declaration</a> -&gt; <a href="parsetree.html#TYPEclass_declaration">Parsetree.class_declaration</a></code>;</code>
</td> </tr> <tr> <td align="left" valign="top"> 
</td> <td align="left" valign="top"> <code><span id="TYPEELTmapper.class_description">class_description</span> : <code class="type"><a href="ast_mapper.html#TYPEmapper">mapper</a> -&gt;<br>       <a href="parsetree.html#TYPEclass_description">Parsetree.class_description</a> -&gt; <a href="parsetree.html#TYPEclass_description">Parsetree.class_description</a></code>;</code>
</td> </tr> <tr> <td align="left" valign="top"> 
</td> <td align="left" valign="top"> <code><span id="TYPEELTmapper.class_expr">class_expr</span> : <code class="type"><a href="ast_mapper.html#TYPEmapper">mapper</a> -&gt; <a href="parsetree.html#TYPEclass_expr">Parsetree.class_expr</a> -&gt; <a href="parsetree.html#TYPEclass_expr">Parsetree.class_expr</a></code>;</code>
</td> </tr> <tr> <td align="left" valign="top"> 
</td> <td align="left" valign="top"> <code><span id="TYPEELTmapper.class_field">class_field</span> : <code class="type"><a href="ast_mapper.html#TYPEmapper">mapper</a> -&gt; <a href="parsetree.html#TYPEclass_field">Parsetree.class_field</a> -&gt; <a href="parsetree.html#TYPEclass_field">Parsetree.class_field</a></code>;</code>
</td> </tr> <tr> <td align="left" valign="top"> 
</td> <td align="left" valign="top"> <code><span id="TYPEELTmapper.class_signature">class_signature</span> : <code class="type"><a href="ast_mapper.html#TYPEmapper">mapper</a> -&gt; <a href="parsetree.html#TYPEclass_signature">Parsetree.class_signature</a> -&gt; <a href="parsetree.html#TYPEclass_signature">Parsetree.class_signature</a></code>;</code>
</td> </tr> <tr> <td align="left" valign="top"> 
</td> <td align="left" valign="top"> <code><span id="TYPEELTmapper.class_structure">class_structure</span> : <code class="type"><a href="ast_mapper.html#TYPEmapper">mapper</a> -&gt; <a href="parsetree.html#TYPEclass_structure">Parsetree.class_structure</a> -&gt; <a href="parsetree.html#TYPEclass_structure">Parsetree.class_structure</a></code>;</code>
</td> </tr> <tr> <td align="left" valign="top"> 
</td> <td align="left" valign="top"> <code><span id="TYPEELTmapper.class_type">class_type</span> : <code class="type"><a href="ast_mapper.html#TYPEmapper">mapper</a> -&gt; <a href="parsetree.html#TYPEclass_type">Parsetree.class_type</a> -&gt; <a href="parsetree.html#TYPEclass_type">Parsetree.class_type</a></code>;</code>
</td> </tr> <tr> <td align="left" valign="top"> 
</td> <td align="left" valign="top"> <code><span id="TYPEELTmapper.class_type_declaration">class_type_declaration</span> : <code class="type"><a href="ast_mapper.html#TYPEmapper">mapper</a> -&gt;<br>       <a href="parsetree.html#TYPEclass_type_declaration">Parsetree.class_type_declaration</a> -&gt; <a href="parsetree.html#TYPEclass_type_declaration">Parsetree.class_type_declaration</a></code>;</code>
</td> </tr> <tr> <td align="left" valign="top"> 
</td> <td align="left" valign="top"> <code><span id="TYPEELTmapper.class_type_field">class_type_field</span> : <code class="type"><a href="ast_mapper.html#TYPEmapper">mapper</a> -&gt; <a href="parsetree.html#TYPEclass_type_field">Parsetree.class_type_field</a> -&gt; <a href="parsetree.html#TYPEclass_type_field">Parsetree.class_type_field</a></code>;</code>
</td> </tr> <tr> <td align="left" valign="top"> 
</td> <td align="left" valign="top"> <code><span id="TYPEELTmapper.constant">constant</span> : <code class="type"><a href="ast_mapper.html#TYPEmapper">mapper</a> -&gt; <a href="parsetree.html#TYPEconstant">Parsetree.constant</a> -&gt; <a href="parsetree.html#TYPEconstant">Parsetree.constant</a></code>;</code>
</td> </tr> <tr> <td align="left" valign="top"> 
</td> <td align="left" valign="top"> <code><span id="TYPEELTmapper.constructor_declaration">constructor_declaration</span> : <code class="type"><a href="ast_mapper.html#TYPEmapper">mapper</a> -&gt;<br>       <a href="parsetree.html#TYPEconstructor_declaration">Parsetree.constructor_declaration</a> -&gt; <a href="parsetree.html#TYPEconstructor_declaration">Parsetree.constructor_declaration</a></code>;</code>
</td> </tr> <tr> <td align="left" valign="top"> 
</td> <td align="left" valign="top"> <code><span id="TYPEELTmapper.directive_argument">directive_argument</span> : <code class="type"><a href="ast_mapper.html#TYPEmapper">mapper</a> -&gt;<br>       <a href="parsetree.html#TYPEdirective_argument">Parsetree.directive_argument</a> -&gt; <a href="parsetree.html#TYPEdirective_argument">Parsetree.directive_argument</a></code>;</code>
</td> </tr> <tr> <td align="left" valign="top"> 
</td> <td align="left" valign="top"> <code><span id="TYPEELTmapper.expr">expr</span> : <code class="type"><a href="ast_mapper.html#TYPEmapper">mapper</a> -&gt; <a href="parsetree.html#TYPEexpression">Parsetree.expression</a> -&gt; <a href="parsetree.html#TYPEexpression">Parsetree.expression</a></code>;</code>
</td> </tr> <tr> <td align="left" valign="top"> 
</td> <td align="left" valign="top"> <code><span id="TYPEELTmapper.extension">extension</span> : <code class="type"><a href="ast_mapper.html#TYPEmapper">mapper</a> -&gt; <a href="parsetree.html#TYPEextension">Parsetree.extension</a> -&gt; <a href="parsetree.html#TYPEextension">Parsetree.extension</a></code>;</code>
</td> </tr> <tr> <td align="left" valign="top"> 
</td> <td align="left" valign="top"> <code><span id="TYPEELTmapper.extension_constructor">extension_constructor</span> : <code class="type"><a href="ast_mapper.html#TYPEmapper">mapper</a> -&gt;<br>       <a href="parsetree.html#TYPEextension_constructor">Parsetree.extension_constructor</a> -&gt; <a href="parsetree.html#TYPEextension_constructor">Parsetree.extension_constructor</a></code>;</code>
</td> </tr> <tr> <td align="left" valign="top"> 
</td> <td align="left" valign="top"> <code><span id="TYPEELTmapper.include_declaration">include_declaration</span> : <code class="type"><a href="ast_mapper.html#TYPEmapper">mapper</a> -&gt;<br>       <a href="parsetree.html#TYPEinclude_declaration">Parsetree.include_declaration</a> -&gt; <a href="parsetree.html#TYPEinclude_declaration">Parsetree.include_declaration</a></code>;</code>
</td> </tr> <tr> <td align="left" valign="top"> 
</td> <td align="left" valign="top"> <code><span id="TYPEELTmapper.include_description">include_description</span> : <code class="type"><a href="ast_mapper.html#TYPEmapper">mapper</a> -&gt;<br>       <a href="parsetree.html#TYPEinclude_description">Parsetree.include_description</a> -&gt; <a href="parsetree.html#TYPEinclude_description">Parsetree.include_description</a></code>;</code>
</td> </tr> <tr> <td align="left" valign="top"> 
</td> <td align="left" valign="top"> <code><span id="TYPEELTmapper.label_declaration">label_declaration</span> : <code class="type"><a href="ast_mapper.html#TYPEmapper">mapper</a> -&gt;<br>       <a href="parsetree.html#TYPElabel_declaration">Parsetree.label_declaration</a> -&gt; <a href="parsetree.html#TYPElabel_declaration">Parsetree.label_declaration</a></code>;</code>
</td> </tr> <tr> <td align="left" valign="top"> 
</td> <td align="left" valign="top"> <code><span id="TYPEELTmapper.location">location</span> : <code class="type"><a href="ast_mapper.html#TYPEmapper">mapper</a> -&gt; <a href="location.html#TYPEt">Location.t</a> -&gt; <a href="location.html#TYPEt">Location.t</a></code>;</code>
</td> </tr> <tr> <td align="left" valign="top"> 
</td> <td align="left" valign="top"> <code><span id="TYPEELTmapper.module_binding">module_binding</span> : <code class="type"><a href="ast_mapper.html#TYPEmapper">mapper</a> -&gt; <a href="parsetree.html#TYPEmodule_binding">Parsetree.module_binding</a> -&gt; <a href="parsetree.html#TYPEmodule_binding">Parsetree.module_binding</a></code>;</code>
</td> </tr> <tr> <td align="left" valign="top"> 
</td> <td align="left" valign="top"> <code><span id="TYPEELTmapper.module_declaration">module_declaration</span> : <code class="type"><a href="ast_mapper.html#TYPEmapper">mapper</a> -&gt;<br>       <a href="parsetree.html#TYPEmodule_declaration">Parsetree.module_declaration</a> -&gt; <a href="parsetree.html#TYPEmodule_declaration">Parsetree.module_declaration</a></code>;</code>
</td> </tr> <tr> <td align="left" valign="top"> 
</td> <td align="left" valign="top"> <code><span id="TYPEELTmapper.module_substitution">module_substitution</span> : <code class="type"><a href="ast_mapper.html#TYPEmapper">mapper</a> -&gt;<br>       <a href="parsetree.html#TYPEmodule_substitution">Parsetree.module_substitution</a> -&gt; <a href="parsetree.html#TYPEmodule_substitution">Parsetree.module_substitution</a></code>;</code>
</td> </tr> <tr> <td align="left" valign="top"> 
</td> <td align="left" valign="top"> <code><span id="TYPEELTmapper.module_expr">module_expr</span> : <code class="type"><a href="ast_mapper.html#TYPEmapper">mapper</a> -&gt; <a href="parsetree.html#TYPEmodule_expr">Parsetree.module_expr</a> -&gt; <a href="parsetree.html#TYPEmodule_expr">Parsetree.module_expr</a></code>;</code>
</td> </tr> <tr> <td align="left" valign="top"> 
</td> <td align="left" valign="top"> <code><span id="TYPEELTmapper.module_type">module_type</span> : <code class="type"><a href="ast_mapper.html#TYPEmapper">mapper</a> -&gt; <a href="parsetree.html#TYPEmodule_type">Parsetree.module_type</a> -&gt; <a href="parsetree.html#TYPEmodule_type">Parsetree.module_type</a></code>;</code>
</td> </tr> <tr> <td align="left" valign="top"> 
</td> <td align="left" valign="top"> <code><span id="TYPEELTmapper.module_type_declaration">module_type_declaration</span> : <code class="type"><a href="ast_mapper.html#TYPEmapper">mapper</a> -&gt;<br>       <a href="parsetree.html#TYPEmodule_type_declaration">Parsetree.module_type_declaration</a> -&gt; <a href="parsetree.html#TYPEmodule_type_declaration">Parsetree.module_type_declaration</a></code>;</code>
</td> </tr> <tr> <td align="left" valign="top"> 
</td> <td align="left" valign="top"> <code><span id="TYPEELTmapper.open_declaration">open_declaration</span> : <code class="type"><a href="ast_mapper.html#TYPEmapper">mapper</a> -&gt; <a href="parsetree.html#TYPEopen_declaration">Parsetree.open_declaration</a> -&gt; <a href="parsetree.html#TYPEopen_declaration">Parsetree.open_declaration</a></code>;</code>
</td> </tr> <tr> <td align="left" valign="top"> 
</td> <td align="left" valign="top"> <code><span id="TYPEELTmapper.open_description">open_description</span> : <code class="type"><a href="ast_mapper.html#TYPEmapper">mapper</a> -&gt; <a href="parsetree.html#TYPEopen_description">Parsetree.open_description</a> -&gt; <a href="parsetree.html#TYPEopen_description">Parsetree.open_description</a></code>;</code>
</td> </tr> <tr> <td align="left" valign="top"> 
</td> <td align="left" valign="top"> <code><span id="TYPEELTmapper.pat">pat</span> : <code class="type"><a href="ast_mapper.html#TYPEmapper">mapper</a> -&gt; <a href="parsetree.html#TYPEpattern">Parsetree.pattern</a> -&gt; <a href="parsetree.html#TYPEpattern">Parsetree.pattern</a></code>;</code>
</td> </tr> <tr> <td align="left" valign="top"> 
</td> <td align="left" valign="top"> <code><span id="TYPEELTmapper.payload">payload</span> : <code class="type"><a href="ast_mapper.html#TYPEmapper">mapper</a> -&gt; <a href="parsetree.html#TYPEpayload">Parsetree.payload</a> -&gt; <a href="parsetree.html#TYPEpayload">Parsetree.payload</a></code>;</code>
</td> </tr> <tr> <td align="left" valign="top"> 
</td> <td align="left" valign="top"> <code><span id="TYPEELTmapper.signature">signature</span> : <code class="type"><a href="ast_mapper.html#TYPEmapper">mapper</a> -&gt; <a href="parsetree.html#TYPEsignature">Parsetree.signature</a> -&gt; <a href="parsetree.html#TYPEsignature">Parsetree.signature</a></code>;</code>
</td> </tr> <tr> <td align="left" valign="top"> 
</td> <td align="left" valign="top"> <code><span id="TYPEELTmapper.signature_item">signature_item</span> : <code class="type"><a href="ast_mapper.html#TYPEmapper">mapper</a> -&gt; <a href="parsetree.html#TYPEsignature_item">Parsetree.signature_item</a> -&gt; <a href="parsetree.html#TYPEsignature_item">Parsetree.signature_item</a></code>;</code>
</td> </tr> <tr> <td align="left" valign="top"> 
</td> <td align="left" valign="top"> <code><span id="TYPEELTmapper.structure">structure</span> : <code class="type"><a href="ast_mapper.html#TYPEmapper">mapper</a> -&gt; <a href="parsetree.html#TYPEstructure">Parsetree.structure</a> -&gt; <a href="parsetree.html#TYPEstructure">Parsetree.structure</a></code>;</code>
</td> </tr> <tr> <td align="left" valign="top"> 
</td> <td align="left" valign="top"> <code><span id="TYPEELTmapper.structure_item">structure_item</span> : <code class="type"><a href="ast_mapper.html#TYPEmapper">mapper</a> -&gt; <a href="parsetree.html#TYPEstructure_item">Parsetree.structure_item</a> -&gt; <a href="parsetree.html#TYPEstructure_item">Parsetree.structure_item</a></code>;</code>
</td> </tr> <tr> <td align="left" valign="top"> 
</td> <td align="left" valign="top"> <code><span id="TYPEELTmapper.toplevel_directive">toplevel_directive</span> : <code class="type"><a href="ast_mapper.html#TYPEmapper">mapper</a> -&gt;<br>       <a href="parsetree.html#TYPEtoplevel_directive">Parsetree.toplevel_directive</a> -&gt; <a href="parsetree.html#TYPEtoplevel_directive">Parsetree.toplevel_directive</a></code>;</code>
</td> </tr> <tr> <td align="left" valign="top"> 
</td> <td align="left" valign="top"> <code><span id="TYPEELTmapper.toplevel_phrase">toplevel_phrase</span> : <code class="type"><a href="ast_mapper.html#TYPEmapper">mapper</a> -&gt; <a href="parsetree.html#TYPEtoplevel_phrase">Parsetree.toplevel_phrase</a> -&gt; <a href="parsetree.html#TYPEtoplevel_phrase">Parsetree.toplevel_phrase</a></code>;</code>
</td> </tr> <tr> <td align="left" valign="top"> 
</td> <td align="left" valign="top"> <code><span id="TYPEELTmapper.typ">typ</span> : <code class="type"><a href="ast_mapper.html#TYPEmapper">mapper</a> -&gt; <a href="parsetree.html#TYPEcore_type">Parsetree.core_type</a> -&gt; <a href="parsetree.html#TYPEcore_type">Parsetree.core_type</a></code>;</code>
</td> </tr> <tr> <td align="left" valign="top"> 
</td> <td align="left" valign="top"> <code><span id="TYPEELTmapper.type_declaration">type_declaration</span> : <code class="type"><a href="ast_mapper.html#TYPEmapper">mapper</a> -&gt; <a href="parsetree.html#TYPEtype_declaration">Parsetree.type_declaration</a> -&gt; <a href="parsetree.html#TYPEtype_declaration">Parsetree.type_declaration</a></code>;</code>
</td> </tr> <tr> <td align="left" valign="top"> 
</td> <td align="left" valign="top"> <code><span id="TYPEELTmapper.type_extension">type_extension</span> : <code class="type"><a href="ast_mapper.html#TYPEmapper">mapper</a> -&gt; <a href="parsetree.html#TYPEtype_extension">Parsetree.type_extension</a> -&gt; <a href="parsetree.html#TYPEtype_extension">Parsetree.type_extension</a></code>;</code>
</td> </tr> <tr> <td align="left" valign="top"> 
</td> <td align="left" valign="top"> <code><span id="TYPEELTmapper.type_exception">type_exception</span> : <code class="type"><a href="ast_mapper.html#TYPEmapper">mapper</a> -&gt; <a href="parsetree.html#TYPEtype_exception">Parsetree.type_exception</a> -&gt; <a href="parsetree.html#TYPEtype_exception">Parsetree.type_exception</a></code>;</code>
</td> </tr> <tr> <td align="left" valign="top"> 
</td> <td align="left" valign="top"> <code><span id="TYPEELTmapper.type_kind">type_kind</span> : <code class="type"><a href="ast_mapper.html#TYPEmapper">mapper</a> -&gt; <a href="parsetree.html#TYPEtype_kind">Parsetree.type_kind</a> -&gt; <a href="parsetree.html#TYPEtype_kind">Parsetree.type_kind</a></code>;</code>
</td> </tr> <tr> <td align="left" valign="top"> 
</td> <td align="left" valign="top"> <code><span id="TYPEELTmapper.value_binding">value_binding</span> : <code class="type"><a href="ast_mapper.html#TYPEmapper">mapper</a> -&gt; <a href="parsetree.html#TYPEvalue_binding">Parsetree.value_binding</a> -&gt; <a href="parsetree.html#TYPEvalue_binding">Parsetree.value_binding</a></code>;</code>
</td> </tr> <tr> <td align="left" valign="top"> 
</td> <td align="left" valign="top"> <code><span id="TYPEELTmapper.value_description">value_description</span> : <code class="type"><a href="ast_mapper.html#TYPEmapper">mapper</a> -&gt;<br>       <a href="parsetree.html#TYPEvalue_description">Parsetree.value_description</a> -&gt; <a href="parsetree.html#TYPEvalue_description">Parsetree.value_description</a></code>;</code>
</td> </tr> <tr> <td align="left" valign="top"> 
</td> <td align="left" valign="top"> <code><span id="TYPEELTmapper.with_constraint">with_constraint</span> : <code class="type"><a href="ast_mapper.html#TYPEmapper">mapper</a> -&gt; <a href="parsetree.html#TYPEwith_constraint">Parsetree.with_constraint</a> -&gt; <a href="parsetree.html#TYPEwith_constraint">Parsetree.with_constraint</a></code>;</code>
</td> </tr>
</tbody>
</table> <code>}</code> <div class="info "> <div class="info-desc"> <p>A mapper record implements one "method" per syntactic category, using an open recursion style: each method takes as its first argument the mapper to be applied to children in the syntax tree.</p> </div> </div> <pre id="VALdefault_mapper" data-type="val default_mapper [Module Ast_mapper]" data-language="ocaml">val default_mapper : mapper</pre>
<div class="info "> <div class="info-desc"> <p>A default mapper, which implements a "deep identity" mapping.</p> </div> </div> <h2 id="1_Applymapperstocompilationunits">Apply mappers to compilation units</h2> <pre id="VALtool_name" data-type="val tool_name [Module Ast_mapper]" data-language="ocaml">val tool_name : unit -&gt; string</pre>
<div class="info "> <div class="info-desc"> <p>Can be used within a ppx preprocessor to know which tool is calling it <code class="code"><span class="string">"ocamlc"</span></code>, <code class="code"><span class="string">"ocamlopt"</span></code>, <code class="code"><span class="string">"ocamldoc"</span></code>, <code class="code"><span class="string">"ocamldep"</span></code>, <code class="code"><span class="string">"ocaml"</span></code>, ... Some global variables that reflect command-line options are automatically synchronized between the calling tool and the ppx preprocessor: <a href="clflags.html#VALinclude_dirs"><code class="code"><span class="constructor">Clflags</span>.include_dirs</code></a>, <a href="clflags.html#VALhidden_include_dirs"><code class="code"><span class="constructor">Clflags</span>.hidden_include_dirs</code></a>, <a href="load_path.html"><code class="code"><span class="constructor">Load_path</span></code></a>, <a href="clflags.html#VALopen_modules"><code class="code"><span class="constructor">Clflags</span>.open_modules</code></a>, <a href="clflags.html#VALfor_package"><code class="code"><span class="constructor">Clflags</span>.for_package</code></a>, <a href="clflags.html#VALdebug"><code class="code"><span class="constructor">Clflags</span>.debug</code></a>.</p> </div> </div> <pre id="VALapply" data-type="val apply [Module Ast_mapper]" data-language="ocaml">val apply : source:string -&gt; target:string -&gt; mapper -&gt; unit</pre>
<div class="info "> <div class="info-desc"> <p>Apply a mapper (parametrized by the unit name) to a dumped parsetree found in the <code class="code">source</code> file and put the result in the <code class="code">target</code> file. The <code class="code">structure</code> or <code class="code">signature</code> field of the mapper is applied to the implementation or interface.</p> </div> </div> <pre id="VALrun_main" data-type="val run_main [Module Ast_mapper]" data-language="ocaml">val run_main : (string list -&gt; mapper) -&gt; unit</pre>
<div class="info "> <div class="info-desc"> <p>Entry point to call to implement a standalone -ppx rewriter from a mapper, parametrized by the command line arguments. The current unit name can be obtained from <a href="location.html#VALinput_name"><code class="code"><span class="constructor">Location</span>.input_name</code></a>. This function implements proper error reporting for uncaught exceptions.</p> </div> </div> <h2 id="1_RegistrationAPI">Registration API</h2> <pre id="VALregister_function" data-type="val register_function [Module Ast_mapper]" data-language="ocaml">val register_function : (string -&gt; (string list -&gt; mapper) -&gt; unit) ref</pre> <pre id="VALregister" data-type="val register [Module Ast_mapper]" data-language="ocaml">val register : string -&gt; (string list -&gt; mapper) -&gt; unit</pre>
<div class="info "> <div class="info-desc"> <p>Apply the <code class="code">register_function</code>. The default behavior is to run the mapper immediately, taking arguments from the process command line. This is to support a scenario where a mapper is linked as a stand-alone executable.</p> <p>It is possible to overwrite the <code class="code">register_function</code> to define "-ppx drivers", which combine several mappers in a single process. Typically, a driver starts by defining <code class="code">register_function</code> to a custom implementation, then lets ppx rewriters (linked statically or dynamically) register themselves, and then run all or some of them. It is also possible to have -ppx drivers apply rewriters to only specific parts of an AST.</p> <p>The first argument to <code class="code">register</code> is a symbolic name to be used by the ppx driver.</p> </div> </div> <h2 id="1_Conveniencefunctionstowritemappers">Convenience functions to write mappers</h2> <pre id="VALmap_opt" data-type="val map_opt [Module Ast_mapper]" data-language="ocaml">val map_opt : ('a -&gt; 'b) -&gt; 'a option -&gt; 'b option</pre> <pre id="VALextension_of_error" data-type="val extension_of_error [Module Ast_mapper]" data-language="ocaml">val extension_of_error : Location.error -&gt; Parsetree.extension</pre>
<div class="info "> <div class="info-desc"> <p>Encode an error into an 'ocaml.error' extension node which can be inserted in a generated Parsetree. The compiler will be responsible for reporting the error.</p> </div> </div> <pre id="VALattribute_of_warning" data-type="val attribute_of_warning [Module Ast_mapper]" data-language="ocaml">val attribute_of_warning : Location.t -&gt; string -&gt; Parsetree.attribute</pre>
<div class="info "> <div class="info-desc"> <p>Encode a warning message into an 'ocaml.ppwarning' attribute which can be inserted in a generated Parsetree. The compiler will be responsible for reporting the warning.</p> </div> </div> <h2 id="1_Helperfunctionstocallexternalmappers">Helper functions to call external mappers</h2> <pre id="VALadd_ppx_context_str" data-type="val add_ppx_context_str [Module Ast_mapper]" data-language="ocaml">val add_ppx_context_str : tool_name:string -&gt; Parsetree.structure -&gt; Parsetree.structure</pre>
<div class="info "> <div class="info-desc"> <p>Extract information from the current environment and encode it into an attribute which is prepended to the list of structure items in order to pass the information to an external processor.</p> </div> </div> <pre id="VALadd_ppx_context_sig" data-type="val add_ppx_context_sig [Module Ast_mapper]" data-language="ocaml">val add_ppx_context_sig : tool_name:string -&gt; Parsetree.signature -&gt; Parsetree.signature</pre>
<div class="info "> <div class="info-desc"> <p>Same as <code class="code">add_ppx_context_str</code>, but for signatures.</p> </div> </div> <pre id="VALdrop_ppx_context_str" data-type="val drop_ppx_context_str [Module Ast_mapper]" data-language="ocaml">val drop_ppx_context_str : restore:bool -&gt; Parsetree.structure -&gt; Parsetree.structure</pre>
<div class="info "> <div class="info-desc"> <p>Drop the ocaml.ppx.context attribute from a structure. If <code class="code">restore</code> is true, also restore the associated data in the current process.</p> </div> </div> <pre id="VALdrop_ppx_context_sig" data-type="val drop_ppx_context_sig [Module Ast_mapper]" data-language="ocaml">val drop_ppx_context_sig : restore:bool -&gt; Parsetree.signature -&gt; Parsetree.signature</pre>
<div class="info "> <div class="info-desc"> <p>Same as <code class="code">drop_ppx_context_str</code>, but for signatures.</p> </div> </div> <h2 id="1_Cookies">Cookies</h2>
<p>Cookies are used to pass information from a ppx processor to a further invocation of itself, when called from the OCaml toplevel (or other tools that support cookies).</p> <pre id="VALset_cookie" data-type="val set_cookie [Module Ast_mapper]" data-language="ocaml">val set_cookie : string -&gt; Parsetree.expression -&gt; unit</pre> <pre id="VALget_cookie" data-type="val get_cookie [Module Ast_mapper]" data-language="ocaml">val get_cookie : string -&gt; Parsetree.expression option</pre> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 1995-2024 INRIA.<br>
    <a href="https://ocaml.org/manual/5.2/api/compilerlibref/Ast_mapper.html" class="_attribution-link">https://ocaml.org/manual/5.2/api/compilerlibref/Ast_mapper.html</a>
  </p>
</div>
