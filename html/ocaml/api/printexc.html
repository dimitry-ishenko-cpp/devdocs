<div class="api"> <h1>Module Printexc</h1> <pre id="MODULEPrintexc" data-type="module Printexc [Module Printexc]" data-language="ocaml">module Printexc: sig .. end</pre>
<div class="info module top"> <div class="info-desc"> <p>Facilities for printing exceptions and inspecting current call stack.</p> </div> </div>  <pre id="TYPEt" data-type="type t [Module Printexc]" data-language="ocaml">type t = exn = ..</pre> <div class="info "> <div class="info-desc"> <p>The type of exception values.</p> </div> </div> <pre id="VALto_string" data-type="val to_string [Module Printexc]" data-language="ocaml">val to_string : exn -&gt; string</pre>
<div class="info "> <div class="info-desc"> <p><code class="code"><span class="constructor">Printexc</span>.to_string e</code> returns a string representation of the exception <code class="code">e</code>.</p> </div> </div> <pre id="VALto_string_default" data-type="val to_string_default [Module Printexc]" data-language="ocaml">val to_string_default : exn -&gt; string</pre>
<div class="info "> <div class="info-desc"> <p><code class="code"><span class="constructor">Printexc</span>.to_string_default e</code> returns a string representation of the exception <code class="code">e</code>, ignoring all registered exception printers.</p> </div> <ul class="info-attributes"> <li>
<b>Since</b> 4.09</li> </ul> </div> <pre id="VALprint" data-type="val print [Module Printexc]" data-language="ocaml">val print : ('a -&gt; 'b) -&gt; 'a -&gt; 'b</pre>
<div class="info "> <div class="info-desc"> <p><code class="code"><span class="constructor">Printexc</span>.print fn x</code> applies <code class="code">fn</code> to <code class="code">x</code> and returns the result. If the evaluation of <code class="code">fn x</code> raises any exception, the name of the exception is printed on standard error output, and the exception is raised again. The typical use is to catch and report exceptions that escape a function application.</p> </div> </div> <pre id="VALcatch" data-type="val catch [Module Printexc]" data-language="ocaml">val catch : ('a -&gt; 'b) -&gt; 'a -&gt; 'b</pre>
<div class="info "> <div class="info-deprecated"> <span class="warning">Deprecated. </span>This function is no longer needed.</div> <div class="info-desc"> <p><code class="code"><span class="constructor">Printexc</span>.catch fn x</code> is similar to <a href="printexc.html#VALprint"><code class="code"><span class="constructor">Printexc</span>.print</code></a>, but aborts the program with exit code 2 after printing the uncaught exception. This function is deprecated: the runtime system is now able to print uncaught exceptions as precisely as <code class="code"><span class="constructor">Printexc</span>.catch</code> does. Moreover, calling <code class="code"><span class="constructor">Printexc</span>.catch</code> makes it harder to track the location of the exception using the debugger or the stack backtrace facility. So, do not use <code class="code"><span class="constructor">Printexc</span>.catch</code> in new code.</p> </div> </div> <pre id="VALprint_backtrace" data-type="val print_backtrace [Module Printexc]" data-language="ocaml">val print_backtrace : out_channel -&gt; unit</pre>
<div class="info "> <div class="info-desc"> <p><code class="code"><span class="constructor">Printexc</span>.print_backtrace oc</code> prints an exception backtrace on the output channel <code class="code">oc</code>. The backtrace lists the program locations where the most-recently raised exception was raised and where it was propagated through function calls.</p> <p>If the call is not inside an exception handler, the returned backtrace is unspecified. If the call is after some exception-catching code (before in the handler, or in a when-guard during the matching of the exception handler), the backtrace may correspond to a later exception than the handled one.</p> </div> <ul class="info-attributes"> <li>
<b>Since</b> 3.11</li> </ul> </div> <pre id="VALget_backtrace" data-type="val get_backtrace [Module Printexc]" data-language="ocaml">val get_backtrace : unit -&gt; string</pre>
<div class="info "> <div class="info-desc"> <p><code class="code"><span class="constructor">Printexc</span>.get_backtrace ()</code> returns a string containing the same exception backtrace that <code class="code"><span class="constructor">Printexc</span>.print_backtrace</code> would print. Same restriction usage than <a href="printexc.html#VALprint_backtrace"><code class="code"><span class="constructor">Printexc</span>.print_backtrace</code></a>.</p> </div> <ul class="info-attributes"> <li>
<b>Since</b> 3.11</li> </ul> </div> <pre id="VALrecord_backtrace" data-type="val record_backtrace [Module Printexc]" data-language="ocaml">val record_backtrace : bool -&gt; unit</pre>
<div class="info "> <div class="info-desc"> <p><code class="code"><span class="constructor">Printexc</span>.record_backtrace b</code> turns recording of exception backtraces on (if <code class="code">b = <span class="keyword">true</span></code>) or off (if <code class="code">b = <span class="keyword">false</span></code>). Initially, backtraces are not recorded, unless the <code class="code">b</code> flag is given to the program through the <code class="code"><span class="constructor">OCAMLRUNPARAM</span></code> variable.</p> </div> <ul class="info-attributes"> <li>
<b>Since</b> 3.11</li> </ul> </div> <pre id="VALbacktrace_status" data-type="val backtrace_status [Module Printexc]" data-language="ocaml">val backtrace_status : unit -&gt; bool</pre>
<div class="info "> <div class="info-desc"> <p><code class="code"><span class="constructor">Printexc</span>.backtrace_status()</code> returns <code class="code"><span class="keyword">true</span></code> if exception backtraces are currently recorded, <code class="code"><span class="keyword">false</span></code> if not.</p> </div> <ul class="info-attributes"> <li>
<b>Since</b> 3.11</li> </ul> </div> <pre id="VALregister_printer" data-type="val register_printer [Module Printexc]" data-language="ocaml">val register_printer : (exn -&gt; string option) -&gt; unit</pre>
<div class="info "> <div class="info-desc"> <p><code class="code"><span class="constructor">Printexc</span>.register_printer fn</code> registers <code class="code">fn</code> as an exception printer. The printer should return <code class="code"><span class="constructor">None</span></code> or raise an exception if it does not know how to convert the passed exception, and <code class="code"><span class="constructor">Some</span><br>
    s</code> with <code class="code">s</code> the resulting string if it can convert the passed exception. Exceptions raised by the printer are ignored.</p> <p>When converting an exception into a string, the printers will be invoked in the reverse order of their registrations, until a printer returns a <code class="code"><span class="constructor">Some</span> s</code> value (if no such printer exists, the runtime will use a generic printer).</p> <p>When using this mechanism, one should be aware that an exception backtrace is attached to the thread that saw it raised, rather than to the exception itself. Practically, it means that the code related to <code class="code">fn</code> should not use the backtrace if it has itself raised an exception before.</p> </div> <ul class="info-attributes"> <li>
<b>Since</b> 3.11.2</li> </ul> </div> <pre id="VALuse_printers" data-type="val use_printers [Module Printexc]" data-language="ocaml">val use_printers : exn -&gt; string option</pre>
<div class="info "> <div class="info-desc"> <p><code class="code"><span class="constructor">Printexc</span>.use_printers e</code> returns <code class="code"><span class="constructor">None</span></code> if there are no registered printers and <code class="code"><span class="constructor">Some</span> s</code> with else as the resulting string otherwise.</p> </div> <ul class="info-attributes"> <li>
<b>Since</b> 4.09</li> </ul> </div> <h2 id="1_Rawbacktraces">Raw backtraces</h2> <pre id="TYPEraw_backtrace" data-type="type raw_backtrace [Module Printexc]" data-language="ocaml">type raw_backtrace </pre> <div class="info "> <div class="info-desc"> <p>The type <code class="code">raw_backtrace</code> stores a backtrace in a low-level format, which can be converted to usable form using <code class="code">raw_backtrace_entries</code> and <code class="code">backtrace_slots_of_raw_entry</code> below.</p> <p>Converting backtraces to <code class="code">backtrace_slot</code>s is slower than capturing the backtraces. If an application processes many backtraces, it can be useful to use <code class="code">raw_backtrace</code> to avoid or delay conversion.</p> <p>Raw backtraces cannot be marshalled. If you need marshalling, you should use the array returned by the <code class="code">backtrace_slots</code> function of the next section.</p> </div> <ul class="info-attributes"> <li>
<b>Since</b> 4.01</li> </ul> </div> <pre id="TYPEraw_backtrace_entry" data-type="type raw_backtrace_entry [Module Printexc]" data-language="ocaml">type raw_backtrace_entry = private int </pre> <div class="info "> <div class="info-desc"> <p>A <code class="code">raw_backtrace_entry</code> is an element of a <code class="code">raw_backtrace</code>.</p> <p>Each <code class="code">raw_backtrace_entry</code> is an opaque integer, whose value is not stable between different programs, or even between different runs of the same binary.</p> <p>A <code class="code">raw_backtrace_entry</code> can be converted to a usable form using <code class="code">backtrace_slots_of_raw_entry</code> below. Note that, due to inlining, a single <code class="code">raw_backtrace_entry</code> may convert to several <code class="code">backtrace_slot</code>s. Since the values of a <code class="code">raw_backtrace_entry</code> are not stable, they cannot be marshalled. If they are to be converted, the conversion must be done by the process that generated them.</p> <p>Again due to inlining, there may be multiple distinct raw_backtrace_entry values that convert to equal <code class="code">backtrace_slot</code>s. However, if two <code class="code">raw_backtrace_entry</code>s are equal as integers, then they represent the same <code class="code">backtrace_slot</code>s.</p> </div> <ul class="info-attributes"> <li>
<b>Since</b> 4.12</li> </ul> </div> <pre id="VALraw_backtrace_entries" data-type="val raw_backtrace_entries [Module Printexc]" data-language="ocaml">val raw_backtrace_entries : raw_backtrace -&gt; raw_backtrace_entry array</pre>
<div class="info "> <ul class="info-attributes"> <li>
<b>Since</b> 4.12</li> </ul> </div> <pre id="VALget_raw_backtrace" data-type="val get_raw_backtrace [Module Printexc]" data-language="ocaml">val get_raw_backtrace : unit -&gt; raw_backtrace</pre>
<div class="info "> <div class="info-desc"> <p><code class="code"><span class="constructor">Printexc</span>.get_raw_backtrace ()</code> returns the same exception backtrace that <code class="code"><span class="constructor">Printexc</span>.print_backtrace</code> would print, but in a raw format. Same restriction usage than <a href="printexc.html#VALprint_backtrace"><code class="code"><span class="constructor">Printexc</span>.print_backtrace</code></a>.</p> </div> <ul class="info-attributes"> <li>
<b>Since</b> 4.01</li> </ul> </div> <pre id="VALprint_raw_backtrace" data-type="val print_raw_backtrace [Module Printexc]" data-language="ocaml">val print_raw_backtrace : out_channel -&gt; raw_backtrace -&gt; unit</pre>
<div class="info "> <div class="info-desc"> <p>Print a raw backtrace in the same format <code class="code"><span class="constructor">Printexc</span>.print_backtrace</code> uses.</p> </div> <ul class="info-attributes"> <li>
<b>Since</b> 4.01</li> </ul> </div> <pre id="VALraw_backtrace_to_string" data-type="val raw_backtrace_to_string [Module Printexc]" data-language="ocaml">val raw_backtrace_to_string : raw_backtrace -&gt; string</pre>
<div class="info "> <div class="info-desc"> <p>Return a string from a raw backtrace, in the same format <code class="code"><span class="constructor">Printexc</span>.get_backtrace</code> uses.</p> </div> <ul class="info-attributes"> <li>
<b>Since</b> 4.01</li> </ul> </div> <pre id="VALraise_with_backtrace" data-type="val raise_with_backtrace [Module Printexc]" data-language="ocaml">val raise_with_backtrace : exn -&gt; raw_backtrace -&gt; 'a</pre>
<div class="info "> <div class="info-desc"> <p>Reraise the exception using the given raw_backtrace for the origin of the exception</p> </div> <ul class="info-attributes"> <li>
<b>Since</b> 4.05</li> </ul> </div> <h2 id="1_Currentcallstack">Current call stack</h2> <pre id="VALget_callstack" data-type="val get_callstack [Module Printexc]" data-language="ocaml">val get_callstack : int -&gt; raw_backtrace</pre>
<div class="info "> <div class="info-desc"> <p><code class="code"><span class="constructor">Printexc</span>.get_callstack n</code> returns a description of the top of the call stack on the current program point (for the current thread), with at most <code class="code">n</code> entries. (Note: this function is not related to exceptions at all, despite being part of the <code class="code"><span class="constructor">Printexc</span></code> module.)</p> </div> <ul class="info-attributes"> <li>
<b>Since</b> 4.01</li> </ul> </div> <h2 id="1_Uncaughtexceptions">Uncaught exceptions</h2> <pre id="VALdefault_uncaught_exception_handler" data-type="val default_uncaught_exception_handler [Module Printexc]" data-language="ocaml">val default_uncaught_exception_handler : exn -&gt; raw_backtrace -&gt; unit</pre>
<div class="info "> <div class="info-desc"> <p><code class="code"><span class="constructor">Printexc</span>.default_uncaught_exception_handler</code> prints the exception and backtrace on standard error output.</p> </div> <ul class="info-attributes"> <li>
<b>Since</b> 4.11</li> </ul> </div> <pre id="VALset_uncaught_exception_handler" data-type="val set_uncaught_exception_handler [Module Printexc]" data-language="ocaml">val set_uncaught_exception_handler : (exn -&gt; raw_backtrace -&gt; unit) -&gt; unit</pre>
<div class="info "> <div class="info-desc"> <p><code class="code"><span class="constructor">Printexc</span>.set_uncaught_exception_handler fn</code> registers <code class="code">fn</code> as the handler for uncaught exceptions. The default handler is <a href="printexc.html#VALdefault_uncaught_exception_handler"><code class="code"><span class="constructor">Printexc</span>.default_uncaught_exception_handler</code></a>.</p> <p>Note that when <code class="code">fn</code> is called all the functions registered with <a href="stdlib.html#VALat_exit"><code class="code">at_exit</code></a> have already been called. Because of this you must make sure any output channel <code class="code">fn</code> writes on is flushed.</p> <p>Also note that exceptions raised by user code in the interactive toplevel are not passed to this function as they are caught by the toplevel itself.</p> <p>If <code class="code">fn</code> raises an exception, both the exceptions passed to <code class="code">fn</code> and raised by <code class="code">fn</code> will be printed with their respective backtrace.</p> </div> <ul class="info-attributes"> <li>
<b>Since</b> 4.02</li> </ul> </div> <h2 id="1_Manipulationofbacktraceinformation">Manipulation of backtrace information</h2> <p>These functions are used to traverse the slots of a raw backtrace and extract information from them in a programmer-friendly format.</p> <pre id="TYPEbacktrace_slot" data-type="type backtrace_slot [Module Printexc]" data-language="ocaml">type backtrace_slot </pre> <div class="info "> <div class="info-desc"> <p>The abstract type <code class="code">backtrace_slot</code> represents a single slot of a backtrace.</p> </div> <ul class="info-attributes"> <li>
<b>Since</b> 4.02</li> </ul> </div> <pre id="VALbacktrace_slots" data-type="val backtrace_slots [Module Printexc]" data-language="ocaml">val backtrace_slots : raw_backtrace -&gt; backtrace_slot array option</pre>
<div class="info "> <div class="info-desc"> <p>Returns the slots of a raw backtrace, or <code class="code"><span class="constructor">None</span></code> if none of them contain useful information.</p> <p>In the return array, the slot at index <code class="code">0</code> corresponds to the most recent function call, raise, or primitive <code class="code">get_backtrace</code> call in the trace.</p> <p>Some possible reasons for returning <code class="code"><span class="constructor">None</span></code> are as follow:</p> <ul> <li>none of the slots in the trace come from modules compiled with debug information (<code class="code">-g</code>)</li> <li>the program is a bytecode program that has not been linked with debug information enabled (<code class="code">ocamlc -g</code>)</li> </ul> </div> <ul class="info-attributes"> <li>
<b>Since</b> 4.02</li> </ul> </div> <pre id="VALbacktrace_slots_of_raw_entry" data-type="val backtrace_slots_of_raw_entry [Module Printexc]" data-language="ocaml">val backtrace_slots_of_raw_entry : raw_backtrace_entry -&gt; backtrace_slot array option</pre>
<div class="info "> <div class="info-desc"> <p>Returns the slots of a single raw backtrace entry, or <code class="code"><span class="constructor">None</span></code> if this entry lacks debug information.</p> <p>Slots are returned in the same order as <code class="code">backtrace_slots</code>: the slot at index <code class="code">0</code> is the most recent call, raise, or primitive, and subsequent slots represent callers.</p> </div> <ul class="info-attributes"> <li>
<b>Since</b> 4.12</li> </ul> </div> <pre id="TYPElocation" data-type="type location [Module Printexc]" data-language="ocaml">type location = {</pre>
<table class="typetable"> <tbody>
<tr> <td align="left" valign="top"> 
</td> <td align="left" valign="top"> <code><span id="TYPEELTlocation.filename">filename</span> : <code class="type">string</code>;</code>
</td> </tr> <tr> <td align="left" valign="top"> 
</td> <td align="left" valign="top"> <code><span id="TYPEELTlocation.line_number">line_number</span> : <code class="type">int</code>;</code>
</td> </tr> <tr> <td align="left" valign="top"> 
</td> <td align="left" valign="top"> <code><span id="TYPEELTlocation.start_char">start_char</span> : <code class="type">int</code>;</code>
</td> </tr> <tr> <td align="left" valign="top"> 
</td> <td align="left" valign="top"> <code><span id="TYPEELTlocation.end_char">end_char</span> : <code class="type">int</code>;</code>
</td> </tr> <tr> <td align="left" valign="top"> 
</td> <td align="left" valign="top"> <code><span id="TYPEELTlocation.end_line">end_line</span> : <code class="type">int</code>;</code>
</td> <td class="typefieldcomment" align="left" valign="top"><code>(*</code></td>
<td class="typefieldcomment" align="left" valign="top">
<div class="info "> <ul class="info-attributes"> <li>
<b>Since</b> 5.2</li> </ul> </div> </td>
<td class="typefieldcomment" align="left" valign="bottom"><code>*)</code></td> </tr> <tr> <td align="left" valign="top"> 
</td> <td align="left" valign="top"> <code><span id="TYPEELTlocation.end_col">end_col</span> : <code class="type">int</code>;</code>
</td> <td class="typefieldcomment" align="left" valign="top"><code>(*</code></td>
<td class="typefieldcomment" align="left" valign="top">
<div class="info "> <ul class="info-attributes"> <li>
<b>Since</b> 5.2</li> </ul> </div> </td>
<td class="typefieldcomment" align="left" valign="bottom"><code>*)</code></td> </tr>
</tbody>
</table> <code>}</code> <div class="info "> <div class="info-desc"> <p>The type of location information found in backtraces. <code class="code">start_char</code> and <code class="code">end_char</code> are positions relative to the beginning of <code class="code">line_number</code>. <code class="code">end_col</code> is relative to the beginning of <code class="code">end_line</code>.</p> </div> <ul class="info-attributes"> <li>
<b>Since</b> 4.02</li> </ul> </div> <pre id="MODULESlot" data-type="module Slot [Module Printexc]" data-language="ocaml">module Slot: sig .. end</pre>
 <h2 id="1_Rawbacktraceslots">Raw backtrace slots</h2> <pre id="TYPEraw_backtrace_slot" data-type="type raw_backtrace_slot [Module Printexc]" data-language="ocaml">type raw_backtrace_slot </pre> <div class="info "> <div class="info-desc"> <p>This type is used to iterate over the slots of a <code class="code">raw_backtrace</code>. For most purposes, <code class="code">backtrace_slots_of_raw_entry</code> is easier to use.</p> <p>Like <code class="code">raw_backtrace_entry</code>, values of this type are process-specific and must absolutely not be marshalled, and are unsafe to use for this reason (marshalling them may not fail, but un-marshalling and using the result will result in undefined behavior).</p> <p>Elements of this type can still be compared and hashed: when two elements are equal, then they represent the same source location (the converse is not necessarily true in presence of inlining, for example).</p> </div> <ul class="info-attributes"> <li>
<b>Since</b> 4.02</li> </ul> </div> <pre id="VALraw_backtrace_length" data-type="val raw_backtrace_length [Module Printexc]" data-language="ocaml">val raw_backtrace_length : raw_backtrace -&gt; int</pre>
<div class="info "> <div class="info-desc"> <p><code class="code">raw_backtrace_length bckt</code> returns the number of slots in the backtrace <code class="code">bckt</code>.</p> </div> <ul class="info-attributes"> <li>
<b>Since</b> 4.02</li> </ul> </div> <pre id="VALget_raw_backtrace_slot" data-type="val get_raw_backtrace_slot [Module Printexc]" data-language="ocaml">val get_raw_backtrace_slot : raw_backtrace -&gt; int -&gt; raw_backtrace_slot</pre>
<div class="info "> <div class="info-desc"> <p><code class="code">get_raw_backtrace_slot bckt pos</code> returns the slot in position <code class="code">pos</code> in the backtrace <code class="code">bckt</code>.</p> </div> <ul class="info-attributes"> <li>
<b>Since</b> 4.02</li> </ul> </div> <pre id="VALconvert_raw_backtrace_slot" data-type="val convert_raw_backtrace_slot [Module Printexc]" data-language="ocaml">val convert_raw_backtrace_slot : raw_backtrace_slot -&gt; backtrace_slot</pre>
<div class="info "> <div class="info-desc"> <p>Extracts the user-friendly <code class="code">backtrace_slot</code> from a low-level <code class="code">raw_backtrace_slot</code>.</p> </div> <ul class="info-attributes"> <li>
<b>Since</b> 4.02</li> </ul> </div> <pre id="VALget_raw_backtrace_next_slot" data-type="val get_raw_backtrace_next_slot [Module Printexc]" data-language="ocaml">val get_raw_backtrace_next_slot : raw_backtrace_slot -&gt; raw_backtrace_slot option</pre>
<div class="info "> <div class="info-desc"> <p><code class="code">get_raw_backtrace_next_slot slot</code> returns the next slot inlined, if any.</p> <p>Sample code to iterate over all frames (inlined and non-inlined):</p> <pre class="codepre" data-language="ocaml">      (* Iterate over inlined frames *)
      let rec iter_raw_backtrace_slot f slot =
        f slot;
        match get_raw_backtrace_next_slot slot with
        | None -&gt; ()
        | Some slot' -&gt; iter_raw_backtrace_slot f slot'

      (* Iterate over stack frames *)
      let iter_raw_backtrace f bt =
        for i = 0 to raw_backtrace_length bt - 1 do
          iter_raw_backtrace_slot f (get_raw_backtrace_slot bt i)
        done
    </pre>
</div> <ul class="info-attributes"> <li>
<b>Since</b> 4.04</li> </ul> </div> <h2 id="1_Exceptionslots">Exception slots</h2> <pre id="VALexn_slot_id" data-type="val exn_slot_id [Module Printexc]" data-language="ocaml">val exn_slot_id : exn -&gt; int</pre>
<div class="info "> <div class="info-desc"> <p><code class="code"><span class="constructor">Printexc</span>.exn_slot_id</code> returns an integer which uniquely identifies the constructor used to create the exception value <code class="code">exn</code> (in the current runtime).</p> </div> <ul class="info-attributes"> <li>
<b>Since</b> 4.02</li> </ul> </div> <pre id="VALexn_slot_name" data-type="val exn_slot_name [Module Printexc]" data-language="ocaml">val exn_slot_name : exn -&gt; string</pre>
<div class="info "> <div class="info-desc"> <p><code class="code"><span class="constructor">Printexc</span>.exn_slot_name exn</code> returns the internal name of the constructor used to create the exception value <code class="code">exn</code>.</p> </div> <ul class="info-attributes"> <li>
<b>Since</b> 4.02</li> </ul> </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 1995-2024 INRIA.<br>
    <a href="https://ocaml.org/manual/5.2/api/Printexc.html" class="_attribution-link">https://ocaml.org/manual/5.2/api/Printexc.html</a>
  </p>
</div>
