<h1 id="twig-for-developers">Twig for Developers</h1> <p>This chapter describes the API to Twig and not the template language. It will be most useful as reference to those implementing the template interface to the application and not those who are creating Twig templates.</p>  <h2 id="basics">Basics</h2> <p>Twig uses a central object called the <strong>environment</strong> (of class <code class="docutils literal notranslate"><span class="pre">\Twig\Environment</span></code>). Instances of this class are used to store the configuration and extensions, and are used to load templates.</p> <p>Most applications create one <code class="docutils literal notranslate"><span class="pre">\Twig\Environment</span></code> object on application initialization and use that to load templates. In some cases, it might be useful to have multiple environments side by side, with different configurations.</p> <p>The typical way to configure Twig to load templates for an application looks roughly like this:</p> <div class="highlight-php notranslate">
<div class="highlight"><pre data-language="php" class="highlight"><span class="k">require_once</span> <span class="s1">'/path/to/vendor/autoload.php'</span><span class="p">;</span>

<span class="nv">$loader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Twig\Loader\FilesystemLoader</span><span class="p">(</span><span class="s1">'/path/to/templates'</span><span class="p">);</span>
<span class="nv">$twig</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Twig\Environment</span><span class="p">(</span><span class="nv">$loader</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">'cache'</span> <span class="o">=&gt;</span> <span class="s1">'/path/to/compilation_cache'</span><span class="p">,</span>
<span class="p">]);</span>
</pre></div> </div> <p>This creates a template environment with a default configuration and a loader that looks up templates in the <code class="docutils literal notranslate"><span class="pre">/path/to/templates/</span></code> directory. Different loaders are available and you can also write your own if you want to load templates from a database or other resources.</p> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">Notice that the second argument of the environment is an array of options. The <code class="docutils literal notranslate"><span class="pre">cache</span></code> option is a compilation cache directory, where Twig caches the compiled templates to avoid the parsing phase for sub-sequent requests. It is very different from the cache you might want to add for the evaluated templates. For such a need, you can use any available PHP cache library.</p> </div>   <h2 id="rendering-templates">Rendering Templates</h2> <p>To load a template from a Twig environment, call the <code class="docutils literal notranslate"><span class="pre">load()</span></code> method which returns a <code class="docutils literal notranslate"><span class="pre">\Twig\TemplateWrapper</span></code> instance:</p> <div class="highlight-php notranslate">
<div class="highlight"><pre data-language="php" class="highlight"><span class="nv">$template</span> <span class="o">=</span> <span class="nv">$twig</span><span class="o">-&gt;</span><span class="na">load</span><span class="p">(</span><span class="s1">'index.html'</span><span class="p">);</span>
</pre></div> </div> <p>To render the template with some variables, call the <code class="docutils literal notranslate"><span class="pre">render()</span></code> method:</p> <div class="highlight-php notranslate">
<div class="highlight"><pre data-language="php" class="highlight"><span class="k">echo</span> <span class="nv">$template</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">([</span><span class="s1">'the'</span> <span class="o">=&gt;</span> <span class="s1">'variables'</span><span class="p">,</span> <span class="s1">'go'</span> <span class="o">=&gt;</span> <span class="s1">'here'</span><span class="p">]);</span>
</pre></div> </div> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">The <code class="docutils literal notranslate"><span class="pre">display()</span></code> method is a shortcut to output the rendered template.</p> </div> <p>You can also load and render the template in one fell swoop:</p> <div class="highlight-php notranslate">
<div class="highlight"><pre data-language="php" class="highlight"><span class="k">echo</span> <span class="nv">$twig</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">'index.html'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'the'</span> <span class="o">=&gt;</span> <span class="s1">'variables'</span><span class="p">,</span> <span class="s1">'go'</span> <span class="o">=&gt;</span> <span class="s1">'here'</span><span class="p">]);</span>
</pre></div> </div> <p>If a template defines blocks, they can be rendered individually via the <code class="docutils literal notranslate"><span class="pre">renderBlock()</span></code> call:</p> <div class="highlight-php notranslate">
<div class="highlight"><pre data-language="php" class="highlight"><span class="k">echo</span> <span class="nv">$template</span><span class="o">-&gt;</span><span class="na">renderBlock</span><span class="p">(</span><span class="s1">'block_name'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'the'</span> <span class="o">=&gt;</span> <span class="s1">'variables'</span><span class="p">,</span> <span class="s1">'go'</span> <span class="o">=&gt;</span> <span class="s1">'here'</span><span class="p">]);</span>
</pre></div> </div>   <h2>Environment Options</h2> <p>When creating a new <code class="docutils literal notranslate"><span class="pre">\Twig\Environment</span></code> instance, you can pass an array of options as the constructor second argument:</p> <div class="highlight-php notranslate">
<div class="highlight"><pre data-language="php" class="highlight"><span class="nv">$twig</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Twig\Environment</span><span class="p">(</span><span class="nv">$loader</span><span class="p">,</span> <span class="p">[</span><span class="s1">'debug'</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">]);</span>
</pre></div> </div> <p>The following options are available:</p> <ul> <li>
<p class="first"><code class="docutils literal notranslate"><span class="pre">debug</span></code> <em>boolean</em></p> <p>When set to <code class="docutils literal notranslate"><span class="pre">true</span></code>, the generated templates have a <code class="docutils literal notranslate"><span class="pre">__toString()</span></code> method that you can use to display the generated nodes (default to <code class="docutils literal notranslate"><span class="pre">false</span></code>).</p> </li> <li>
<p class="first"><code class="docutils literal notranslate"><span class="pre">charset</span></code> <em>string</em> (defaults to <code class="docutils literal notranslate"><span class="pre">utf-8</span></code>)</p> <p>The charset used by the templates.</p> </li> <li>
<p class="first"><code class="docutils literal notranslate"><span class="pre">cache</span></code> <em>string</em> or <code class="docutils literal notranslate"><span class="pre">false</span></code></p> <p>An absolute path where to store the compiled templates, or <code class="docutils literal notranslate"><span class="pre">false</span></code> to disable caching (which is the default).</p> </li> <li>
<p class="first"><code class="docutils literal notranslate"><span class="pre">auto_reload</span></code> <em>boolean</em></p> <p>When developing with Twig, it’s useful to recompile the template whenever the source code changes. If you don’t provide a value for the <code class="docutils literal notranslate"><span class="pre">auto_reload</span></code> option, it will be determined automatically based on the <code class="docutils literal notranslate"><span class="pre">debug</span></code> value.</p> </li> <li>
<p class="first"><code class="docutils literal notranslate"><span class="pre">strict_variables</span></code> <em>boolean</em></p> <p>If set to <code class="docutils literal notranslate"><span class="pre">false</span></code>, Twig will silently ignore invalid variables (variables and or attributes/methods that do not exist) and replace them with a <code class="docutils literal notranslate"><span class="pre">null</span></code> value. When set to <code class="docutils literal notranslate"><span class="pre">true</span></code>, Twig throws an exception instead (default to <code class="docutils literal notranslate"><span class="pre">false</span></code>).</p> </li> <li>
<p class="first"><code class="docutils literal notranslate"><span class="pre">autoescape</span></code> <em>string</em></p> <p>Sets the default auto-escaping strategy (<code class="docutils literal notranslate"><span class="pre">name</span></code>, <code class="docutils literal notranslate"><span class="pre">html</span></code>, <code class="docutils literal notranslate"><span class="pre">js</span></code>, <code class="docutils literal notranslate"><span class="pre">css</span></code>, <code class="docutils literal notranslate"><span class="pre">url</span></code>, <code class="docutils literal notranslate"><span class="pre">html_attr</span></code>, or a PHP callback that takes the template “filename” and returns the escaping strategy to use – the callback cannot be a function name to avoid collision with built-in escaping strategies); set it to <code class="docutils literal notranslate"><span class="pre">false</span></code> to disable auto-escaping. The <code class="docutils literal notranslate"><span class="pre">name</span></code> escaping strategy determines the escaping strategy to use for a template based on the template filename extension (this strategy does not incur any overhead at runtime as auto-escaping is done at compilation time.)</p> </li> <li>
<p class="first"><code class="docutils literal notranslate"><span class="pre">optimizations</span></code> <em>integer</em></p> <p>A flag that indicates which optimizations to apply (default to <code class="docutils literal notranslate"><span class="pre">-1</span></code> – all optimizations are enabled; set it to <code class="docutils literal notranslate"><span class="pre">0</span></code> to disable).</p> </li> </ul>   <h2 id="loaders">Loaders</h2> <p>Loaders are responsible for loading templates from a resource such as the file system.</p>  <h3 id="compilation-cache">Compilation Cache</h3> <p>All template loaders can cache the compiled templates on the filesystem for future reuse. It speeds up Twig a lot as templates are only compiled once.</p>   <h3 id="built-in-loaders">Built-in Loaders</h3> <p>Here is a list of the built-in loaders:</p>  <h4 id="twig-loader-filesystemloader"><code class="docutils literal notranslate"><span class="pre">\Twig\Loader\FilesystemLoader</span></code></h4> <p><code class="docutils literal notranslate"><span class="pre">\Twig\Loader\FilesystemLoader</span></code> loads templates from the file system. This loader can find templates in folders on the file system and is the preferred way to load them:</p> <div class="highlight-php notranslate">
<div class="highlight"><pre data-language="php" class="highlight"><span class="nv">$loader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Twig\Loader\FilesystemLoader</span><span class="p">(</span><span class="nv">$templateDir</span><span class="p">);</span>
</pre></div> </div> <p>It can also look for templates in an array of directories:</p> <div class="highlight-php notranslate">
<div class="highlight"><pre data-language="php" class="highlight"><span class="nv">$loader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Twig\Loader\FilesystemLoader</span><span class="p">([</span><span class="nv">$templateDir1</span><span class="p">,</span> <span class="nv">$templateDir2</span><span class="p">]);</span>
</pre></div> </div> <p>With such a configuration, Twig will first look for templates in <code class="docutils literal notranslate"><span class="pre">$templateDir1</span></code> and if they do not exist, it will fallback to look for them in the <code class="docutils literal notranslate"><span class="pre">$templateDir2</span></code>.</p> <p>You can add or prepend paths via the <code class="docutils literal notranslate"><span class="pre">addPath()</span></code> and <code class="docutils literal notranslate"><span class="pre">prependPath()</span></code> methods:</p> <div class="highlight-php notranslate">
<div class="highlight"><pre data-language="php" class="highlight"><span class="nv">$loader</span><span class="o">-&gt;</span><span class="na">addPath</span><span class="p">(</span><span class="nv">$templateDir3</span><span class="p">);</span>
<span class="nv">$loader</span><span class="o">-&gt;</span><span class="na">prependPath</span><span class="p">(</span><span class="nv">$templateDir4</span><span class="p">);</span>
</pre></div> </div> <p>The filesystem loader also supports namespaced templates. This allows to group your templates under different namespaces which have their own template paths.</p> <p>When using the <code class="docutils literal notranslate"><span class="pre">setPaths()</span></code>, <code class="docutils literal notranslate"><span class="pre">addPath()</span></code>, and <code class="docutils literal notranslate"><span class="pre">prependPath()</span></code> methods, specify the namespace as the second argument (when not specified, these methods act on the “main” namespace):</p> <div class="highlight-php notranslate">
<div class="highlight"><pre data-language="php" class="highlight"><span class="nv">$loader</span><span class="o">-&gt;</span><span class="na">addPath</span><span class="p">(</span><span class="nv">$templateDir</span><span class="p">,</span> <span class="s1">'admin'</span><span class="p">);</span>
</pre></div> </div> <p>Namespaced templates can be accessed via the special <code class="docutils literal notranslate"><span class="pre">@namespace_name/template_path</span></code> notation:</p> <div class="highlight-php notranslate">
<div class="highlight"><pre data-language="php" class="highlight"><span class="nv">$twig</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">'@admin/index.html'</span><span class="p">,</span> <span class="p">[]);</span>
</pre></div> </div> <p><code class="docutils literal notranslate"><span class="pre">\Twig\Loader\FilesystemLoader</span></code> support absolute and relative paths. Using relative paths is preferred as it makes the cache keys independent of the project root directory (for instance, it allows warming the cache from a build server where the directory might be different from the one used on production servers):</p> <div class="highlight-php notranslate">
<div class="highlight"><pre data-language="php" class="highlight"><span class="nv">$loader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Twig\Loader\FilesystemLoader</span><span class="p">(</span><span class="s1">'templates'</span><span class="p">,</span> <span class="nb">getcwd</span><span class="p">()</span><span class="o">.</span><span class="s1">'/..'</span><span class="p">);</span>
</pre></div> </div> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">When not passing the root path as a second argument, Twig uses <code class="docutils literal notranslate"><span class="pre">getcwd()</span></code> for relative paths.</p> </div>   <h4 id="twig-loader-arrayloader"><code class="docutils literal notranslate"><span class="pre">\Twig\Loader\ArrayLoader</span></code></h4> <p><code class="docutils literal notranslate"><span class="pre">\Twig\Loader\ArrayLoader</span></code> loads a template from a PHP array. It is passed an array of strings bound to template names:</p> <div class="highlight-php notranslate">
<div class="highlight"><pre data-language="php" class="highlight"><span class="nv">$loader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Twig\Loader\ArrayLoader</span><span class="p">([</span>
    <span class="s1">'index.html'</span> <span class="o">=&gt;</span> <span class="s1">'Hello {{ name }}!'</span><span class="p">,</span>
<span class="p">]);</span>
<span class="nv">$twig</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Twig\Environment</span><span class="p">(</span><span class="nv">$loader</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$twig</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">'index.html'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'Fabien'</span><span class="p">]);</span>
</pre></div> </div> <p>This loader is very useful for unit testing. It can also be used for small projects where storing all templates in a single PHP file might make sense.</p> <div class="admonition tip"> <p class="first admonition-title">Tip</p> <p class="last">When using the <code class="docutils literal notranslate"><span class="pre">Array</span></code> loader with a cache mechanism, you should know that a new cache key is generated each time a template content “changes” (the cache key being the source code of the template). If you don’t want to see your cache grows out of control, you need to take care of clearing the old cache file by yourself.</p> </div>   <h4 id="twig-loader-chainloader"><code class="docutils literal notranslate"><span class="pre">\Twig\Loader\ChainLoader</span></code></h4> <p><code class="docutils literal notranslate"><span class="pre">\Twig\Loader\ChainLoader</span></code> delegates the loading of templates to other loaders:</p> <div class="highlight-php notranslate">
<div class="highlight"><pre data-language="php" class="highlight"><span class="nv">$loader1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Twig\Loader\ArrayLoader</span><span class="p">([</span>
    <span class="s1">'base.html'</span> <span class="o">=&gt;</span> <span class="s1">'{% block content %}{% endblock %}'</span><span class="p">,</span>
<span class="p">]);</span>
<span class="nv">$loader2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Twig\Loader\ArrayLoader</span><span class="p">([</span>
    <span class="s1">'index.html'</span> <span class="o">=&gt;</span> <span class="s1">'{% extends "base.html" %}{% block content %}Hello {{ name }}{% endblock %}'</span><span class="p">,</span>
    <span class="s1">'base.html'</span>  <span class="o">=&gt;</span> <span class="s1">'Will never be loaded'</span><span class="p">,</span>
<span class="p">]);</span>

<span class="nv">$loader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Twig\Loader\ChainLoader</span><span class="p">([</span><span class="nv">$loader1</span><span class="p">,</span> <span class="nv">$loader2</span><span class="p">]);</span>

<span class="nv">$twig</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Twig\Environment</span><span class="p">(</span><span class="nv">$loader</span><span class="p">);</span>
</pre></div> </div> <p>When looking for a template, Twig tries each loader in turn and returns as soon as the template is found. When rendering the <code class="docutils literal notranslate"><span class="pre">index.html</span></code> template from the above example, Twig will load it with <code class="docutils literal notranslate"><span class="pre">$loader2</span></code> but the <code class="docutils literal notranslate"><span class="pre">base.html</span></code> template will be loaded from <code class="docutils literal notranslate"><span class="pre">$loader1</span></code>.</p> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">You can also add loaders via the <code class="docutils literal notranslate"><span class="pre">addLoader()</span></code> method.</p> </div>    <h3 id="create-your-own-loader">Create your own Loader</h3> <p>All loaders implement the <code class="docutils literal notranslate"><span class="pre">\Twig\Loader\LoaderInterface</span></code>:</p> <div class="highlight-php notranslate">
<div class="highlight"><pre data-language="php" class="highlight"><span class="k">interface</span> <span class="nx">\Twig\Loader\LoaderInterface</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Returns the source context for a given template logical name.</span>
<span class="sd">     *</span>
<span class="sd">     * @param string $name The template logical name</span>
<span class="sd">     *</span>
<span class="sd">     * @return \Twig\Source</span>
<span class="sd">     *</span>
<span class="sd">     * @throws \Twig\Error\LoaderError When $name is not found</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getSourceContext</span><span class="p">(</span><span class="nv">$name</span><span class="p">);</span>

    <span class="sd">/**</span>
<span class="sd">     * Gets the cache key to use for the cache for a given template name.</span>
<span class="sd">     *</span>
<span class="sd">     * @param string $name The name of the template to load</span>
<span class="sd">     *</span>
<span class="sd">     * @return string The cache key</span>
<span class="sd">     *</span>
<span class="sd">     * @throws \Twig\Error\LoaderError When $name is not found</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getCacheKey</span><span class="p">(</span><span class="nv">$name</span><span class="p">);</span>

    <span class="sd">/**</span>
<span class="sd">     * Returns true if the template is still fresh.</span>
<span class="sd">     *</span>
<span class="sd">     * @param string    $name The template name</span>
<span class="sd">     * @param timestamp $time The last modification time of the cached template</span>
<span class="sd">     *</span>
<span class="sd">     * @return bool    true if the template is fresh, false otherwise</span>
<span class="sd">     *</span>
<span class="sd">     * @throws \Twig\Error\LoaderError When $name is not found</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">isFresh</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$time</span><span class="p">);</span>

    <span class="sd">/**</span>
<span class="sd">     * Check if we have the source code of a template, given its name.</span>
<span class="sd">     *</span>
<span class="sd">     * @param string $name The name of the template to check if we can load</span>
<span class="sd">     *</span>
<span class="sd">     * @return bool    If the template source code is handled by this loader or not</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">exists</span><span class="p">(</span><span class="nv">$name</span><span class="p">);</span>
<span class="p">}</span>
</pre></div> </div> <p>The <code class="docutils literal notranslate"><span class="pre">isFresh()</span></code> method must return <code class="docutils literal notranslate"><span class="pre">true</span></code> if the current cached template is still fresh, given the last modification time, or <code class="docutils literal notranslate"><span class="pre">false</span></code> otherwise.</p> <p>The <code class="docutils literal notranslate"><span class="pre">getSourceContext()</span></code> method must return an instance of <code class="docutils literal notranslate"><span class="pre">\Twig\Source</span></code>.</p>    <h2 id="using-extensions">Using Extensions</h2> <p>Twig extensions are packages that add new features to Twig. Register an extension via the <code class="docutils literal notranslate"><span class="pre">addExtension()</span></code> method:</p> <div class="highlight-php notranslate">
<div class="highlight"><pre data-language="php" class="highlight"><span class="nv">$twig</span><span class="o">-&gt;</span><span class="na">addExtension</span><span class="p">(</span><span class="k">new</span> <span class="nx">\Twig\Extension\SandboxExtension</span><span class="p">());</span>
</pre></div> </div> <p>Twig comes bundled with the following extensions:</p> <ul class="simple"> <li>
<em>TwigExtensionCoreExtension</em>: Defines all the core features of Twig.</li> <li>
<em>TwigExtensionDebugExtension</em>: Defines the <code class="docutils literal notranslate"><span class="pre">dump</span></code> function to help debug template variables.</li> <li>
<em>TwigExtensionEscaperExtension</em>: Adds automatic output-escaping and the possibility to escape/unescape blocks of code.</li> <li>
<em>TwigExtensionSandboxExtension</em>: Adds a sandbox mode to the default Twig environment, making it safe to evaluate untrusted code.</li> <li>
<em>TwigExtensionProfilerExtension</em>: Enables the built-in Twig profiler.</li> <li>
<em>TwigExtensionOptimizerExtension</em>: Optimizes the node tree before compilation.</li> <li>
<dl class="first docutils"> <dt>
<em>TwigExtensionStringLoaderExtension</em>: Defines the <code class="docutils literal notranslate"><span class="pre">template_from_string</span></code>
</dt> <dd>function to allow loading templates from string in a template.</dd> </dl> </li> </ul> <p>The Core, Escaper, and Optimizer extensions are registered by default.</p>   <h2 id="built-in-extensions">Built-in Extensions</h2> <p>This section describes the features added by the built-in extensions.</p> <div class="admonition tip"> <p class="first admonition-title">Tip</p> <p class="last">Read the chapter about <a class="reference internal" href="advanced.html"><span class="doc">extending Twig</span></a> to learn how to create your own extensions.</p> </div>  <h3 id="core-extension">Core Extension</h3> <p>The <code class="docutils literal notranslate"><span class="pre">core</span></code> extension defines all the core features of Twig:</p> <ul class="simple"> <li>
<a class="reference internal" href="tags/index.html"><span class="doc">Tags</span></a>;</li> <li>
<a class="reference internal" href="filters/index.html"><span class="doc">Filters</span></a>;</li> <li>
<a class="reference internal" href="functions/index.html"><span class="doc">Functions</span></a>;</li> <li>
<a class="reference internal" href="tests/index.html"><span class="doc">Tests</span></a>.</li> </ul>   <h3 id="escaper-extension">Escaper Extension</h3> <p>The <code class="docutils literal notranslate"><span class="pre">escaper</span></code> extension adds automatic output escaping to Twig. It defines a tag, <code class="docutils literal notranslate"><span class="pre">autoescape</span></code>, and a filter, <code class="docutils literal notranslate"><span class="pre">raw</span></code>.</p> <p>When creating the escaper extension, you can switch on or off the global output escaping strategy:</p> <div class="highlight-php notranslate">
<div class="highlight"><pre data-language="php" class="highlight"><span class="nv">$escaper</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Twig\Extension\EscaperExtension</span><span class="p">(</span><span class="s1">'html'</span><span class="p">);</span>
<span class="nv">$twig</span><span class="o">-&gt;</span><span class="na">addExtension</span><span class="p">(</span><span class="nv">$escaper</span><span class="p">);</span>
</pre></div> </div> <p>If set to <code class="docutils literal notranslate"><span class="pre">html</span></code>, all variables in templates are escaped (using the <code class="docutils literal notranslate"><span class="pre">html</span></code> escaping strategy), except those using the <code class="docutils literal notranslate"><span class="pre">raw</span></code> filter:</p> <div class="highlight-twig notranslate"><pre data-language="php" class="highlight"><span class="cp">{{</span> <span class="nv">article.to_html</span><span class="o">|</span><span class="nf">raw</span> <span class="cp">}}</span>
</pre></div> <p>You can also change the escaping mode locally by using the <code class="docutils literal notranslate"><span class="pre">autoescape</span></code> tag:</p> <div class="highlight-twig notranslate"><pre data-language="php" class="highlight"><span class="cp">{%</span> <span class="k">autoescape</span> <span class="s1">'html'</span> <span class="cp">%}</span>
<span class="cp">{{</span> <span class="nv">var</span> <span class="cp">}}</span>
<span class="cp">{{</span> <span class="nv">var</span><span class="o">|</span><span class="nf">raw</span> <span class="cp">}}</span><span class="c">{# var won't be escaped #}</span>
<span class="cp">{{</span> <span class="nv">var</span><span class="o">|</span><span class="nf">escape</span> <span class="cp">}}</span><span class="c">{# var won't be double-escaped #}</span>
<span class="cp">{%</span> <span class="k">endautoescape</span> <span class="cp">%}</span>
</pre></div> <div class="admonition warning"> <p class="first admonition-title">Warning</p> <p class="last">The <code class="docutils literal notranslate"><span class="pre">autoescape</span></code> tag has no effect on included files.</p> </div> <p>The escaping rules are implemented as follows:</p> <ul> <li>
<p class="first">Literals (integers, booleans, arrays, …) used in the template directly as variables or filter arguments are never automatically escaped:</p> <div class="highlight-html+twig notranslate"><pre data-language="php" class="highlight"><span class="cp">{{</span> <span class="s2">"Twig&lt;br/&gt;"</span> <span class="cp">}}</span> <span class="c">{# won't be escaped #}</span>

<span class="cp">{%</span> <span class="k">set</span> <span class="nv">text</span> <span class="o">=</span> <span class="s2">"Twig&lt;br/&gt;"</span> <span class="cp">%}</span>
<span class="cp">{{</span> <span class="nv">text</span> <span class="cp">}}</span> <span class="c">{# will be escaped #}</span>
</pre></div> </li> <li>
<p class="first">Expressions which the result is a literal or a variable marked safe are never automatically escaped:</p> <div class="highlight-html+twig notranslate"><pre data-language="php" class="highlight"><span class="cp">{{</span> <span class="nv">foo</span> <span class="o">?</span> <span class="s2">"Twig&lt;br/&gt;"</span> <span class="o">:</span> <span class="s2">"&lt;br/&gt;Twig"</span> <span class="cp">}}</span> <span class="c">{# won't be escaped #}</span>

<span class="cp">{%</span> <span class="k">set</span> <span class="nv">text</span> <span class="o">=</span> <span class="s2">"Twig&lt;br/&gt;"</span> <span class="cp">%}</span>
<span class="cp">{{</span> <span class="kp">true</span> <span class="o">?</span> <span class="nv">text</span> <span class="o">:</span> <span class="s2">"&lt;br/&gt;Twig"</span> <span class="cp">}}</span> <span class="c">{# will be escaped #}</span>
<span class="cp">{{</span> <span class="kp">false</span> <span class="o">?</span> <span class="nv">text</span> <span class="o">:</span> <span class="s2">"&lt;br/&gt;Twig"</span> <span class="cp">}}</span> <span class="c">{# won't be escaped #}</span>

<span class="cp">{%</span> <span class="k">set</span> <span class="nv">text</span> <span class="o">=</span> <span class="s2">"Twig&lt;br/&gt;"</span> <span class="cp">%}</span>
<span class="cp">{{</span> <span class="nv">foo</span> <span class="o">?</span> <span class="nv">text</span><span class="o">|</span><span class="nf">raw</span> <span class="o">:</span> <span class="s2">"&lt;br/&gt;Twig"</span> <span class="cp">}}</span> <span class="c">{# won't be escaped #}</span>
</pre></div> </li> <li>
<p class="first">Objects with a <code class="docutils literal notranslate"><span class="pre">__toString</span></code> method are converted to strings and escaped. You can mark some classes and/or interfaces as being safe for some strategies via <code class="docutils literal notranslate"><span class="pre">EscaperExtension::addSafeClass()</span></code>:</p> <div class="highlight-twig notranslate"><pre data-language="php" class="highlight"><span class="x">// mark object of class Foo as safe for the HTML strategy</span>
<span class="x">$escaper-&gt;addSafeClass('Foo', ['html']);</span>

<span class="x">// mark object of interface Foo as safe for the HTML strategy</span>
<span class="x">$escaper-&gt;addSafeClass('FooInterface', ['html']);</span>

<span class="x">// mark object of class Foo as safe for the HTML and JS strategies</span>
<span class="x">$escaper-&gt;addSafeClass('Foo', ['html', 'js']);</span>

<span class="x">// mark object of class Foo as safe for all strategies</span>
<span class="x">$escaper-&gt;addSafeClass('Foo', ['all']);</span>
</pre></div> </li> <li>
<p class="first">Escaping is applied before printing, after any other filter is applied:</p> <div class="highlight-twig notranslate"><pre data-language="php" class="highlight"><span class="cp">{{</span> <span class="nv">var</span><span class="o">|</span><span class="nf">upper</span> <span class="cp">}}</span><span class="c">{# is equivalent to {{ var|upper|escape }} #}</span>
</pre></div> </li> <li>
<p class="first">The <cite>raw</cite> filter should only be used at the end of the filter chain:</p> <div class="highlight-twig notranslate"><pre data-language="php" class="highlight"><span class="cp">{{</span> <span class="nv">var</span><span class="o">|</span><span class="nf">raw</span><span class="o">|</span><span class="nf">upper</span> <span class="cp">}}</span><span class="c">{# will be escaped #}</span>

<span class="cp">{{</span> <span class="nv">var</span><span class="o">|</span><span class="nf">upper</span><span class="o">|</span><span class="nf">raw</span> <span class="cp">}}</span><span class="c">{# won't be escaped #}</span>
</pre></div> </li> <li>
<p class="first">Automatic escaping is not applied if the last filter in the chain is marked safe for the current context (e.g. <code class="docutils literal notranslate"><span class="pre">html</span></code> or <code class="docutils literal notranslate"><span class="pre">js</span></code>). <code class="docutils literal notranslate"><span class="pre">escape</span></code> and <code class="docutils literal notranslate"><span class="pre">escape('html')</span></code> are marked safe for HTML, <code class="docutils literal notranslate"><span class="pre">escape('js')</span></code> is marked safe for JavaScript, <code class="docutils literal notranslate"><span class="pre">raw</span></code> is marked safe for everything.</p> <div class="highlight-twig notranslate"><pre data-language="php" class="highlight"><span class="cp">{%</span> <span class="k">autoescape</span> <span class="s1">'js'</span> <span class="cp">%}</span>
<span class="cp">{{</span> <span class="nv">var</span><span class="o">|</span><span class="nf">escape</span><span class="o">(</span><span class="s1">'html'</span><span class="o">)</span> <span class="cp">}}</span><span class="c">{# will be escaped for HTML and JavaScript #}</span>
<span class="cp">{{</span> <span class="nv">var</span> <span class="cp">}}</span><span class="c">{# will be escaped for JavaScript #}</span>
<span class="cp">{{</span> <span class="nv">var</span><span class="o">|</span><span class="nf">escape</span><span class="o">(</span><span class="s1">'js'</span><span class="o">)</span> <span class="cp">}}</span><span class="c">{# won't be double-escaped #}</span>
<span class="cp">{%</span> <span class="k">endautoescape</span> <span class="cp">%}</span>
</pre></div> </li> </ul> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">Note that autoescaping has some limitations as escaping is applied on expressions after evaluation. For instance, when working with concatenation, <code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">foo|raw</span> <span class="pre">~</span> <span class="pre">bar</span> <span class="pre">}}</span></code> won’t give the expected result as escaping is applied on the result of the concatenation, not on the individual variables (so, the <code class="docutils literal notranslate"><span class="pre">raw</span></code> filter won’t have any effect here).</p> </div>   <h3 id="sandbox-extension">Sandbox Extension</h3> <p>The <code class="docutils literal notranslate"><span class="pre">sandbox</span></code> extension can be used to evaluate untrusted code. Access to unsafe attributes and methods is prohibited. The sandbox security is managed by a policy instance. By default, Twig comes with one policy class: <code class="docutils literal notranslate"><span class="pre">\Twig\Sandbox\SecurityPolicy</span></code>. This class allows you to white-list some tags, filters, properties, and methods:</p> <div class="highlight-php notranslate">
<div class="highlight"><pre data-language="php" class="highlight"><span class="nv">$tags</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'if'</span><span class="p">];</span>
<span class="nv">$filters</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'upper'</span><span class="p">];</span>
<span class="nv">$methods</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'Article'</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">'getTitle'</span><span class="p">,</span> <span class="s1">'getBody'</span><span class="p">],</span>
<span class="p">];</span>
<span class="nv">$properties</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'Article'</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">'title'</span><span class="p">,</span> <span class="s1">'body'</span><span class="p">],</span>
<span class="p">];</span>
<span class="nv">$functions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'range'</span><span class="p">];</span>
<span class="nv">$policy</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Twig\Sandbox\SecurityPolicy</span><span class="p">(</span><span class="nv">$tags</span><span class="p">,</span> <span class="nv">$filters</span><span class="p">,</span> <span class="nv">$methods</span><span class="p">,</span> <span class="nv">$properties</span><span class="p">,</span> <span class="nv">$functions</span><span class="p">);</span>
</pre></div> </div> <p>With the previous configuration, the security policy will only allow usage of the <code class="docutils literal notranslate"><span class="pre">if</span></code> tag, and the <code class="docutils literal notranslate"><span class="pre">upper</span></code> filter. Moreover, the templates will only be able to call the <code class="docutils literal notranslate"><span class="pre">getTitle()</span></code> and <code class="docutils literal notranslate"><span class="pre">getBody()</span></code> methods on <code class="docutils literal notranslate"><span class="pre">Article</span></code> objects, and the <code class="docutils literal notranslate"><span class="pre">title</span></code> and <code class="docutils literal notranslate"><span class="pre">body</span></code> public properties. Everything else won’t be allowed and will generate a <code class="docutils literal notranslate"><span class="pre">\Twig\Sandbox\SecurityError</span></code> exception.</p> <p>The policy object is the first argument of the sandbox constructor:</p> <div class="highlight-php notranslate">
<div class="highlight"><pre data-language="php" class="highlight"><span class="nv">$sandbox</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Twig\Extension\SandboxExtension</span><span class="p">(</span><span class="nv">$policy</span><span class="p">);</span>
<span class="nv">$twig</span><span class="o">-&gt;</span><span class="na">addExtension</span><span class="p">(</span><span class="nv">$sandbox</span><span class="p">);</span>
</pre></div> </div> <p>By default, the sandbox mode is disabled and should be enabled when including untrusted template code by using the <code class="docutils literal notranslate"><span class="pre">sandbox</span></code> tag:</p> <div class="highlight-twig notranslate"><pre data-language="php" class="highlight"><span class="cp">{%</span> <span class="k">sandbox</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">include</span> <span class="s1">'user.html'</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endsandbox</span> <span class="cp">%}</span>
</pre></div> <p>You can sandbox all templates by passing <code class="docutils literal notranslate"><span class="pre">true</span></code> as the second argument of the extension constructor:</p> <div class="highlight-php notranslate">
<div class="highlight"><pre data-language="php" class="highlight"><span class="nv">$sandbox</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Twig\Extension\SandboxExtension</span><span class="p">(</span><span class="nv">$policy</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
</pre></div> </div>   <h3 id="profiler-extension">Profiler Extension</h3> <p>The <code class="docutils literal notranslate"><span class="pre">profiler</span></code> extension enables a profiler for Twig templates; it should only be used on your development machines as it adds some overhead:</p> <div class="highlight-php notranslate">
<div class="highlight"><pre data-language="php" class="highlight"><span class="nv">$profile</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Twig\Profiler\Profile</span><span class="p">();</span>
<span class="nv">$twig</span><span class="o">-&gt;</span><span class="na">addExtension</span><span class="p">(</span><span class="k">new</span> <span class="nx">\Twig\Extension\ProfilerExtension</span><span class="p">(</span><span class="nv">$profile</span><span class="p">));</span>

<span class="nv">$dumper</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Twig\Profiler\Dumper\TextDumper</span><span class="p">();</span>
<span class="k">echo</span> <span class="nv">$dumper</span><span class="o">-&gt;</span><span class="na">dump</span><span class="p">(</span><span class="nv">$profile</span><span class="p">);</span>
</pre></div> </div> <p>A profile contains information about time and memory consumption for template, block, and macro executions.</p> <p>You can also dump the data in a <a class="reference external" href="https://blackfire.io/">Blackfire.io</a> compatible format:</p> <div class="highlight-php notranslate">
<div class="highlight"><pre data-language="php" class="highlight"><span class="nv">$dumper</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Twig\Profiler\Dumper\BlackfireDumper</span><span class="p">();</span>
<span class="nb">file_put_contents</span><span class="p">(</span><span class="s1">'/path/to/profile.prof'</span><span class="p">,</span> <span class="nv">$dumper</span><span class="o">-&gt;</span><span class="na">dump</span><span class="p">(</span><span class="nv">$profile</span><span class="p">));</span>
</pre></div> </div> <p>Upload the profile to visualize it (create a <a class="reference external" href="https://blackfire.io/signup?utm_source=twig&amp;utm_medium=doc&amp;utm_campaign=profiler">free account</a> first):</p> <div class="highlight-sh notranslate"><pre data-language="php" class="highlight">blackfire --slot<span class="o">=</span><span class="m">7</span> upload /path/to/profile.prof
</pre></div>   <h3 id="optimizer-extension">Optimizer Extension</h3> <p>The <code class="docutils literal notranslate"><span class="pre">optimizer</span></code> extension optimizes the node tree before compilation:</p> <div class="highlight-php notranslate">
<div class="highlight"><pre data-language="php" class="highlight"><span class="nv">$twig</span><span class="o">-&gt;</span><span class="na">addExtension</span><span class="p">(</span><span class="k">new</span> <span class="nx">\Twig\Extension\OptimizerExtension</span><span class="p">());</span>
</pre></div> </div> <p>By default, all optimizations are turned on. You can select the ones you want to enable by passing them to the constructor:</p> <div class="highlight-php notranslate">
<div class="highlight"><pre data-language="php" class="highlight"><span class="nv">$optimizer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Twig\Extension\OptimizerExtension</span><span class="p">(</span><span class="nx">\Twig\NodeVisitor\OptimizerNodeVisitor</span><span class="o">::</span><span class="na">OPTIMIZE_FOR</span><span class="p">);</span>

<span class="nv">$twig</span><span class="o">-&gt;</span><span class="na">addExtension</span><span class="p">(</span><span class="nv">$optimizer</span><span class="p">);</span>
</pre></div> </div> <p>Twig supports the following optimizations:</p> <ul class="simple"> <li>
<code class="docutils literal notranslate"><span class="pre">\Twig\NodeVisitor\OptimizerNodeVisitor::OPTIMIZE_ALL</span></code>, enables all optimizations (this is the default value).</li> <li>
<code class="docutils literal notranslate"><span class="pre">\Twig\NodeVisitor\OptimizerNodeVisitor::OPTIMIZE_NONE</span></code>, disables all optimizations. This reduces the compilation time, but it can increase the execution time and the consumed memory.</li> <li>
<code class="docutils literal notranslate"><span class="pre">\Twig\NodeVisitor\OptimizerNodeVisitor::OPTIMIZE_FOR</span></code>, optimizes the <code class="docutils literal notranslate"><span class="pre">for</span></code> tag by removing the <code class="docutils literal notranslate"><span class="pre">loop</span></code> variable creation whenever possible.</li> <li>
<code class="docutils literal notranslate"><span class="pre">\Twig\NodeVisitor\OptimizerNodeVisitor::OPTIMIZE_RAW_FILTER</span></code>, removes the <code class="docutils literal notranslate"><span class="pre">raw</span></code> filter whenever possible.</li> <li>
<code class="docutils literal notranslate"><span class="pre">\Twig\NodeVisitor\OptimizerNodeVisitor::OPTIMIZE_VAR_ACCESS</span></code>, simplifies the creation and access of variables in the compiled templates whenever possible.</li> </ul>    <h2 id="exceptions">Exceptions</h2> <p>Twig can throw exceptions:</p> <ul class="simple"> <li>
<code class="docutils literal notranslate"><span class="pre">\Twig\Error\Error</span></code>: The base exception for all errors.</li> <li>
<code class="docutils literal notranslate"><span class="pre">\Twig\Error\SyntaxError</span></code>: Thrown to tell the user that there is a problem with the template syntax.</li> <li>
<code class="docutils literal notranslate"><span class="pre">\Twig\Error\RuntimeError</span></code>: Thrown when an error occurs at runtime (when a filter does not exist for instance).</li> <li>
<code class="docutils literal notranslate"><span class="pre">\Twig\Error\LoaderError</span></code>: Thrown when an error occurs during template loading.</li> <li>
<code class="docutils literal notranslate"><span class="pre">\Twig\Sandbox\SecurityError</span></code>: Thrown when an unallowed tag, filter, or method is called in a sandboxed template.</li> </ul>    <div class="navigation" style="text-align: center"> <a accesskey="P" title="Twig for Template Designers" href="templates.html"> « Twig for Template Designers </a> <span class="separator">|</span> <a accesskey="N" title="Extending Twig" href="advanced.html"> Extending Twig » </a> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2009&ndash;2018 by the Twig Team<br>Licensed under the three clause BSD license.<br>The Twig logo is &copy; 2010&ndash;2020 Symfony<br>
    <a href="https://twig.symfony.com/doc/3.x/api.html" class="_attribution-link">https://twig.symfony.com/doc/3.x/api.html</a>
  </p>
</div>
