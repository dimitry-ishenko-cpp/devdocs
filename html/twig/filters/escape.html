<h1 id="escape"><span class="pre">escape</span></h1> <p>The <code class="docutils literal notranslate"><span class="pre">escape</span></code> filter escapes a string using strategies that depend on the context.</p> <p>By default, it uses the HTML escaping strategy:</p> <div class="highlight-html+twig notranslate"><pre data-language="php" class="highlight"><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="cp">{{</span> <span class="nv">user.username</span><span class="o">|</span><span class="nf">escape</span> <span class="cp">}}</span>
<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</pre></div> <p>For convenience, the <code class="docutils literal notranslate"><span class="pre">e</span></code> filter is defined as an alias:</p> <div class="highlight-html+twig notranslate"><pre data-language="php" class="highlight"><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="cp">{{</span> <span class="nv">user.username</span><span class="o">|</span><span class="nf">e</span> <span class="cp">}}</span>
<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</pre></div> <p>The <code class="docutils literal notranslate"><span class="pre">escape</span></code> filter can also be used in other contexts than HTML thanks to an optional argument which defines the escaping strategy to use:</p> <div class="highlight-twig notranslate"><pre data-language="php" class="highlight"><span class="cp">{{</span> <span class="nv">user.username</span><span class="o">|</span><span class="nf">e</span> <span class="cp">}}</span>
<span class="c">{# is equivalent to #}</span>
<span class="cp">{{</span> <span class="nv">user.username</span><span class="o">|</span><span class="nf">e</span><span class="o">(</span><span class="s1">'html'</span><span class="o">)</span> <span class="cp">}}</span>
</pre></div> <p>And here is how to escape variables included in JavaScript code:</p> <div class="highlight-twig notranslate"><pre data-language="php" class="highlight"><span class="cp">{{</span> <span class="nv">user.username</span><span class="o">|</span><span class="nf">escape</span><span class="o">(</span><span class="s1">'js'</span><span class="o">)</span> <span class="cp">}}</span>
<span class="cp">{{</span> <span class="nv">user.username</span><span class="o">|</span><span class="nf">e</span><span class="o">(</span><span class="s1">'js'</span><span class="o">)</span> <span class="cp">}}</span>
</pre></div> <p>The <code class="docutils literal notranslate"><span class="pre">escape</span></code> filter supports the following escaping strategies for HTML documents:</p> <ul class="simple"> <li>
<code class="docutils literal notranslate"><span class="pre">html</span></code>: escapes a string for the <strong>HTML body</strong> context.</li> <li>
<code class="docutils literal notranslate"><span class="pre">js</span></code>: escapes a string for the <strong>JavaScript</strong> context.</li> <li>
<code class="docutils literal notranslate"><span class="pre">css</span></code>: escapes a string for the <strong>CSS</strong> context. CSS escaping can be applied to any string being inserted into CSS and escapes everything except alphanumerics.</li> <li>
<code class="docutils literal notranslate"><span class="pre">url</span></code>: escapes a string for the <strong>URI or parameter</strong> contexts. This should not be used to escape an entire URI; only a subcomponent being inserted.</li> <li>
<code class="docutils literal notranslate"><span class="pre">html_attr</span></code>: escapes a string for the <strong>HTML attribute</strong> context.</li> </ul> <p>Note that doing contextual escaping in HTML documents is hard and choosing the right escaping strategy depends on a lot of factors. Please, read related documentation like <a class="reference external" href="https://github.com/OWASP/CheatSheetSeries/blob/master/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.md">the OWASP prevention cheat sheet</a> to learn more about this topic.</p> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">Internally, <code class="docutils literal notranslate"><span class="pre">escape</span></code> uses the PHP native <a class="reference external" href="https://secure.php.net/htmlspecialchars">htmlspecialchars</a> function for the HTML escaping strategy.</p> </div> <div class="admonition caution"> <p class="first admonition-title">Caution</p> <p>When using automatic escaping, Twig tries to not double-escape a variable when the automatic escaping strategy is the same as the one applied by the escape filter; but that does not work when using a variable as the escaping strategy:</p> <div class="highlight-twig notranslate"><pre data-language="php" class="highlight"><span class="cp">{%</span> <span class="k">set</span> <span class="nv">strategy</span> <span class="o">=</span> <span class="s1">'html'</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">autoescape</span> <span class="s1">'html'</span> <span class="cp">%}</span>
<span class="cp">{{</span> <span class="nv">var</span><span class="o">|</span><span class="nf">escape</span><span class="o">(</span><span class="s1">'html'</span><span class="o">)</span> <span class="cp">}}</span><span class="c">{# won't be double-escaped #}</span>
<span class="cp">{{</span> <span class="nv">var</span><span class="o">|</span><span class="nf">escape</span><span class="o">(</span><span class="nv">strategy</span><span class="o">)</span> <span class="cp">}}</span><span class="c">{# will be double-escaped #}</span>
<span class="cp">{%</span> <span class="k">endautoescape</span> <span class="cp">%}</span>
</pre></div> <p>When using a variable as the escaping strategy, you should disable automatic escaping:</p> <div class="last highlight-twig notranslate"><pre data-language="php" class="highlight"><span class="cp">{%</span> <span class="k">set</span> <span class="nv">strategy</span> <span class="o">=</span> <span class="s1">'html'</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">autoescape</span> <span class="s1">'html'</span> <span class="cp">%}</span>
<span class="cp">{{</span> <span class="nv">var</span><span class="o">|</span><span class="nf">escape</span><span class="o">(</span><span class="nv">strategy</span><span class="o">)|</span><span class="nf">raw</span> <span class="cp">}}</span><span class="c">{# won't be double-escaped #}</span>
<span class="cp">{%</span> <span class="k">endautoescape</span> <span class="cp">%}</span>
</pre></div> </div>  <h2 id="custom-escapers">Custom Escapers</h2> <p>You can define custom escapers by calling the <code class="docutils literal notranslate"><span class="pre">setEscaper()</span></code> method on the escaper extension instance. The first argument is the escaper name (to be used in the <code class="docutils literal notranslate"><span class="pre">escape</span></code> call) and the second one must be a valid PHP callable:</p> <div class="highlight-php notranslate">
<div class="highlight"><pre data-language="php" class="highlight"><span class="nv">$twig</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Twig\Environment</span><span class="p">(</span><span class="nv">$loader</span><span class="p">);</span>
<span class="nv">$twig</span><span class="o">-&gt;</span><span class="na">getExtension</span><span class="p">(</span><span class="nx">\Twig\Extension\EscaperExtension</span><span class="o">::</span><span class="na">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">setEscaper</span><span class="p">(</span><span class="s1">'csv'</span><span class="p">,</span> <span class="s1">'csv_escaper'</span><span class="p">);</span>
</pre></div> </div> <p>When called by Twig, the callable receives the Twig environment instance, the string to escape, and the charset.</p> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">Built-in escapers cannot be overridden mainly because they should be considered as the final implementation and also for better performance.</p> </div>   <h2 id="arguments">Arguments</h2> <ul class="simple"> <li>
<code class="docutils literal notranslate"><span class="pre">strategy</span></code>: The escaping strategy</li> <li>
<code class="docutils literal notranslate"><span class="pre">charset</span></code>: The string charset</li> </ul>    <div class="navigation" style="text-align: center"> <a accesskey="P" title="default" href="default.html"> « default </a> <span class="separator">|</span> <a accesskey="N" title="filter" href="filter.html"> filter » </a> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2009&ndash;2018 by the Twig Team<br>Licensed under the three clause BSD license.<br>The Twig logo is &copy; 2010&ndash;2020 Symfony<br>
    <a href="https://twig.symfony.com/doc/3.x/filters/escape.html" class="_attribution-link">https://twig.symfony.com/doc/3.x/filters/escape.html</a>
  </p>
</div>
