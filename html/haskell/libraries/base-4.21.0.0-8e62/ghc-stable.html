<h1 class="caption">GHC.Stable</h1>
<div class="_haskell-api">
<table class="info">
<tr>
<th valign="top">Copyright</th>
<td>(c) The University of Glasgow 1992-2004</td>
</tr>
<tr>
<th>License</th>
<td>see libraries/base/LICENSE</td>
</tr>
<tr>
<th>Maintainer</th>
<td>ffi@haskell.org</td>
</tr>
<tr>
<th>Stability</th>
<td>internal</td>
</tr>
<tr>
<th>Portability</th>
<td>non-portable (GHC Extensions)</td>
</tr>
<tr>
<th>Safe Haskell</th>
<td>None</td>
</tr>
<tr>
<th>Language</th>
<td>Haskell2010</td>
</tr>
</table>
<div id="description">
<h4 class="caption">Description</h4>
<p>Stable pointers.</p>
</div>
<p class="src">data <a id="t:StablePtr" class="def">StablePtr</a> a <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.Stable.html#StablePtr" class="link">Source</a> </p>
<p>A <em>stable pointer</em> is a reference to a Haskell expression that is guaranteed not to be affected by garbage collection, i.e., it will neither be deallocated nor will the value of the stable pointer itself change during garbage collection (ordinary references may be relocated during garbage collection). Consequently, stable pointers can be passed to foreign code, which can treat it as an opaque reference to a Haskell value.</p>
<p>The <code class="inline-code">StablePtr</code> 0 is reserved for representing NULL in foreign code.</p>
<p>A value of type <code class="inline-code">StablePtr a</code> is a stable pointer to a Haskell expression of type <code class="inline-code">a</code>.</p>
<div class="subs constructors">
<h4 class="caption">Constructors</h4>
<table><tr>
<td class="src">
<a id="v:StablePtr" class="def">StablePtr</a> (<a href="ghc-exts.html#t:StablePtr-35-" title="GHC.Exts">StablePtr#</a> a)</td>
<td class="doc empty"> </td>
</tr></table>
</div>
<div class="subs instances">
<h5 class="instances details-toggle-control details-toggle" data-details-id="i:StablePtr">Instances</h5>
<details id="i:StablePtr" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table>
<tr>
<td class="src clearfix">
 <a href="foreign-storable.html#t:Storable" title="Foreign.Storable">Storable</a> (<a href="ghc-stable.html#t:StablePtr" title="GHC.Stable">StablePtr</a> a) <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.Foreign.Storable.html#line-198" class="link">Source</a> </td>
<td class="doc"><p><span class="version">Since: base-2.1</span></p></td>
</tr>
<tr><td colspan="2"><details id="i:id:StablePtr:Storable:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/GHC-Internal-Foreign-Storable.html">GHC.Internal.Foreign.Storable</a></p> <div class="subs methods">
<h4 class="caption">Methods</h4>
<p class="src"><a href="#v:sizeOf">sizeOf</a> :: <a href="ghc-stable.html#t:StablePtr" title="GHC.Stable">StablePtr</a> a -&gt; <a href="data-int.html#t:Int" title="Data.Int">Int</a> <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.Foreign.Storable.html#sizeOf" class="link">Source</a> </p>
<p class="src"><a href="#v:alignment">alignment</a> :: <a href="ghc-stable.html#t:StablePtr" title="GHC.Stable">StablePtr</a> a -&gt; <a href="data-int.html#t:Int" title="Data.Int">Int</a> <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.Foreign.Storable.html#alignment" class="link">Source</a> </p>
<p class="src"><a href="#v:peekElemOff">peekElemOff</a> :: <a href="foreign-ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> (<a href="ghc-stable.html#t:StablePtr" title="GHC.Stable">StablePtr</a> a) -&gt; <a href="data-int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="prelude.html#t:IO" title="Prelude">IO</a> (<a href="ghc-stable.html#t:StablePtr" title="GHC.Stable">StablePtr</a> a) <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.Foreign.Storable.html#peekElemOff" class="link">Source</a> </p>
<p class="src"><a href="#v:pokeElemOff">pokeElemOff</a> :: <a href="foreign-ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> (<a href="ghc-stable.html#t:StablePtr" title="GHC.Stable">StablePtr</a> a) -&gt; <a href="data-int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="ghc-stable.html#t:StablePtr" title="GHC.Stable">StablePtr</a> a -&gt; <a href="prelude.html#t:IO" title="Prelude">IO</a> () <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.Foreign.Storable.html#pokeElemOff" class="link">Source</a> </p>
<p class="src"><a href="#v:peekByteOff">peekByteOff</a> :: <a href="foreign-ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> b -&gt; <a href="data-int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="prelude.html#t:IO" title="Prelude">IO</a> (<a href="ghc-stable.html#t:StablePtr" title="GHC.Stable">StablePtr</a> a) <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.Foreign.Storable.html#peekByteOff" class="link">Source</a> </p>
<p class="src"><a href="#v:pokeByteOff">pokeByteOff</a> :: <a href="foreign-ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> b -&gt; <a href="data-int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="ghc-stable.html#t:StablePtr" title="GHC.Stable">StablePtr</a> a -&gt; <a href="prelude.html#t:IO" title="Prelude">IO</a> () <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.Foreign.Storable.html#pokeByteOff" class="link">Source</a> </p>
<p class="src"><a href="#v:peek">peek</a> :: <a href="foreign-ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> (<a href="ghc-stable.html#t:StablePtr" title="GHC.Stable">StablePtr</a> a) -&gt; <a href="prelude.html#t:IO" title="Prelude">IO</a> (<a href="ghc-stable.html#t:StablePtr" title="GHC.Stable">StablePtr</a> a) <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.Foreign.Storable.html#peek" class="link">Source</a> </p>
<p class="src"><a href="#v:poke">poke</a> :: <a href="foreign-ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> (<a href="ghc-stable.html#t:StablePtr" title="GHC.Stable">StablePtr</a> a) -&gt; <a href="ghc-stable.html#t:StablePtr" title="GHC.Stable">StablePtr</a> a -&gt; <a href="prelude.html#t:IO" title="Prelude">IO</a> () <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.Foreign.Storable.html#poke" class="link">Source</a> </p>
</div></details></td></tr>
<tr>
<td class="src clearfix">
 <a href="data-eq.html#t:Eq" title="Data.Eq">Eq</a> (<a href="ghc-stable.html#t:StablePtr" title="GHC.Stable">StablePtr</a> a) <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.Stable.html#line-109" class="link">Source</a> </td>
<td class="doc"><p><span class="version">Since: base-2.1</span></p></td>
</tr>
<tr><td colspan="2"><details id="i:id:StablePtr:Eq:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/GHC-Internal-Stable.html">GHC.Internal.Stable</a></p> <div class="subs methods">
<h4 class="caption">Methods</h4>
<p class="src"><a href="#v:-61--61-">(==)</a> :: <a href="ghc-stable.html#t:StablePtr" title="GHC.Stable">StablePtr</a> a -&gt; <a href="ghc-stable.html#t:StablePtr" title="GHC.Stable">StablePtr</a> a -&gt; <a href="data-bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-prim-0.13.0-4caa/src/GHC.Classes.html#%3D%3D" class="link">Source</a> </p>
<p class="src"><a href="#v:-47--61-">(/=)</a> :: <a href="ghc-stable.html#t:StablePtr" title="GHC.Stable">StablePtr</a> a -&gt; <a href="ghc-stable.html#t:StablePtr" title="GHC.Stable">StablePtr</a> a -&gt; <a href="data-bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-prim-0.13.0-4caa/src/GHC.Classes.html#%2F%3D" class="link">Source</a> </p>
</div></details></td></tr>
</table></details>
</div>
<p class="src"><a id="v:newStablePtr" class="def">newStablePtr</a> :: a -&gt; <a href="prelude.html#t:IO" title="Prelude">IO</a> (<a href="ghc-stable.html#t:StablePtr" title="GHC.Stable">StablePtr</a> a) <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.Stable.html#newStablePtr" class="link">Source</a> </p>
<p>Create a stable pointer referring to the given Haskell value.</p>
<p class="src"><a id="v:deRefStablePtr" class="def">deRefStablePtr</a> :: <a href="ghc-stable.html#t:StablePtr" title="GHC.Stable">StablePtr</a> a -&gt; <a href="prelude.html#t:IO" title="Prelude">IO</a> a <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.Stable.html#deRefStablePtr" class="link">Source</a> </p>
<p>Obtain the Haskell value referenced by a stable pointer, i.e., the same value that was passed to the corresponding call to <code><a href="ghc-stable.html#v:newStablePtr" title="GHC.Stable">newStablePtr</a></code>. If the argument to <code><a href="ghc-stable.html#v:deRefStablePtr" title="GHC.Stable">deRefStablePtr</a></code> has already been freed using <code><a href="ghc-stable.html#v:freeStablePtr" title="GHC.Stable">freeStablePtr</a></code>, the behaviour of <code><a href="ghc-stable.html#v:deRefStablePtr" title="GHC.Stable">deRefStablePtr</a></code> is undefined.</p>
<p class="src"><a id="v:freeStablePtr" class="def">freeStablePtr</a> :: <a href="ghc-stable.html#t:StablePtr" title="GHC.Stable">StablePtr</a> a -&gt; <a href="prelude.html#t:IO" title="Prelude">IO</a> () <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.Stable.html#freeStablePtr" class="link">Source</a> </p>
<p>Dissolve the association between the stable pointer and the Haskell value. Afterwards, if the stable pointer is passed to <code><a href="ghc-stable.html#v:deRefStablePtr" title="GHC.Stable">deRefStablePtr</a></code> or <code><a href="ghc-stable.html#v:freeStablePtr" title="GHC.Stable">freeStablePtr</a></code>, the behaviour is undefined. However, the stable pointer may still be passed to <code><a href="ghc-stable.html#v:castStablePtrToPtr" title="GHC.Stable">castStablePtrToPtr</a></code>, but the <code class="inline-code"><a href="foreign-ptr.html#v:Ptr" title="Foreign.Ptr">Ptr</a> ()</code> value returned by <code><a href="ghc-stable.html#v:castStablePtrToPtr" title="GHC.Stable">castStablePtrToPtr</a></code>, in this case, is undefined (in particular, it may be <code><a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/GHC-Internal-Foreign-Ptr.html#v:nullPtr" title="GHC.Internal.Foreign.Ptr">nullPtr</a></code>). Nevertheless, the call to <code><a href="ghc-stable.html#v:castStablePtrToPtr" title="GHC.Stable">castStablePtrToPtr</a></code> is guaranteed not to diverge.</p>
<p class="src"><a id="v:castStablePtrToPtr" class="def">castStablePtrToPtr</a> :: <a href="ghc-stable.html#t:StablePtr" title="GHC.Stable">StablePtr</a> a -&gt; <a href="foreign-ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> () <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.Stable.html#castStablePtrToPtr" class="link">Source</a> </p>
<p>Coerce a stable pointer to an address. No guarantees are made about the resulting value, except that the original stable pointer can be recovered by <code><a href="ghc-stable.html#v:castPtrToStablePtr" title="GHC.Stable">castPtrToStablePtr</a></code>. In particular, the address might not refer to an accessible memory location and any attempt to pass it to the member functions of the class <code><a href="foreign-storable.html#v:Storable" title="Foreign.Storable">Storable</a></code> leads to undefined behaviour.</p>
<p class="src"><a id="v:castPtrToStablePtr" class="def">castPtrToStablePtr</a> :: <a href="foreign-ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> () -&gt; <a href="ghc-stable.html#t:StablePtr" title="GHC.Stable">StablePtr</a> a <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.Stable.html#castPtrToStablePtr" class="link">Source</a> </p>
<p>The inverse of <code><a href="ghc-stable.html#v:castStablePtrToPtr" title="GHC.Stable">castStablePtrToPtr</a></code>, i.e., we have the identity</p>
<pre>sp == castPtrToStablePtr (castStablePtrToPtr sp)</pre>
<p>for any stable pointer <code class="inline-code">sp</code> on which <code><a href="ghc-stable.html#v:freeStablePtr" title="GHC.Stable">freeStablePtr</a></code> has not been executed yet. Moreover, <code><a href="ghc-stable.html#v:castPtrToStablePtr" title="GHC.Stable">castPtrToStablePtr</a></code> may only be applied to pointers that have been produced by <code><a href="ghc-stable.html#v:castStablePtrToPtr" title="GHC.Stable">castStablePtrToPtr</a></code>.</p>
</div><div class="_attribution">
  <p class="_attribution-p">
    &copy; The University of Glasgow and others<br>Licensed under a BSD-style license (see top of the page).<br>
    <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/base-4.21.0.0-8e62/GHC-Stable.html" class="_attribution-link">https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/base-4.21.0.0-8e62/GHC-Stable.html</a>
  </p>
</div>
