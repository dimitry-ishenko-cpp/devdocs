<h1 class="caption">Foreign.ForeignPtr</h1>
<div class="_haskell-api">
<table class="info">
<tr>
<th valign="top">Copyright</th>
<td>(c) The University of Glasgow 2001</td>
</tr>
<tr>
<th>License</th>
<td>BSD-style (see the file libraries/base/LICENSE)</td>
</tr>
<tr>
<th>Maintainer</th>
<td>ffi@haskell.org</td>
</tr>
<tr>
<th>Stability</th>
<td>provisional</td>
</tr>
<tr>
<th>Portability</th>
<td>portable</td>
</tr>
<tr>
<th>Safe Haskell</th>
<td>Safe</td>
</tr>
<tr>
<th>Language</th>
<td>Haskell2010</td>
</tr>
</table>
<div id="table-of-contents"><div id="contents-list">
<h4 class="caption" onclick="window.scrollTo(0,0)">Contents</h4>
<ul><li>
<a href="#g:1">Finalised data pointers</a><ul>
<li><a href="#g:2">Basic operations</a></li>
<li><a href="#g:3">Low-level operations</a></li>
<li><a href="#g:4">Allocating managed memory</a></li>
</ul>
</li></ul>
</div></div>
<div id="description">
<h4 class="caption">Description</h4>
<p>The <code><a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a></code> type and operations. This module is part of the Foreign Function Interface (FFI) and will usually be imported via the <a href="foreign.html">Foreign</a> module.</p>
<p>For non-portable support of Haskell finalizers, see the <a href="foreign-concurrent.html">Foreign.Concurrent</a> module.</p>
</div>
<a href="#g:1" id="g:1"><h2>Finalised data pointers</h2></a><p class="src">data <a id="t:ForeignPtr" class="def">ForeignPtr</a> a <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.ForeignPtr.html#ForeignPtr" class="link">Source</a> </p>
<p>The type <code><a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a></code> represents references to objects that are maintained in a foreign language, i.e., that are not part of the data structures usually managed by the Haskell storage manager. The essential difference between <code><a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a></code>s and vanilla memory references of type <code class="inline-code">Ptr a</code> is that the former may be associated with <em>finalizers</em>. A finalizer is a routine that is invoked when the Haskell storage manager detects that - within the Haskell heap and stack - there are no more references left that are pointing to the <code><a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a></code>. Typically, the finalizer will, then, invoke routines in the foreign language that free the resources bound by the foreign object.</p>
<p>The <code><a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a></code> is parameterised in the same way as <code><a href="ghc-exts.html#v:Ptr" title="GHC.Exts">Ptr</a></code>. The type argument of <code><a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a></code> should normally be an instance of class <code><a href="foreign-storable.html#t:Storable" title="Foreign.Storable">Storable</a></code>.</p>
<div class="subs instances">
<h5 class="instances details-toggle-control details-toggle" data-details-id="i:ForeignPtr">Instances</h5>
<details id="i:ForeignPtr" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table>
<tr>
<td class="src clearfix">
 <a href="data-data.html#t:Data" title="Data.Data">Data</a> a =&gt; <a href="data-data.html#t:Data" title="Data.Data">Data</a> (<a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a) <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.Data.Data.html#line-1220" class="link">Source</a> </td>
<td class="doc"><p><span class="version">Since: base-4.8.0.0</span></p></td>
</tr>
<tr><td colspan="2"><details id="i:id:ForeignPtr:Data:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/GHC-Internal-Data-Data.html">GHC.Internal.Data.Data</a></p> <div class="subs methods">
<h4 class="caption">Methods</h4>
<p class="src"><a href="#v:gfoldl">gfoldl</a> :: (forall d b. <a href="data-data.html#t:Data" title="Data.Data">Data</a> d =&gt; c (d -&gt; b) -&gt; d -&gt; c b) -&gt; (forall g. g -&gt; c g) -&gt; <a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a -&gt; c (<a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a) <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.Data.Data.html#gfoldl" class="link">Source</a> </p>
<p class="src"><a href="#v:gunfold">gunfold</a> :: (forall b r. <a href="data-data.html#t:Data" title="Data.Data">Data</a> b =&gt; c (b -&gt; r) -&gt; c r) -&gt; (forall r. r -&gt; c r) -&gt; <a href="data-data.html#t:Constr" title="Data.Data">Constr</a> -&gt; c (<a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a) <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.Data.Data.html#gunfold" class="link">Source</a> </p>
<p class="src"><a href="#v:toConstr">toConstr</a> :: <a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a -&gt; <a href="data-data.html#t:Constr" title="Data.Data">Constr</a> <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.Data.Data.html#toConstr" class="link">Source</a> </p>
<p class="src"><a href="#v:dataTypeOf">dataTypeOf</a> :: <a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a -&gt; <a href="data-data.html#t:DataType" title="Data.Data">DataType</a> <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.Data.Data.html#dataTypeOf" class="link">Source</a> </p>
<p class="src"><a href="#v:dataCast1">dataCast1</a> :: <a href="data-dynamic.html#t:Typeable" title="Data.Dynamic">Typeable</a> t =&gt; (forall d. <a href="data-data.html#t:Data" title="Data.Data">Data</a> d =&gt; c (t d)) -&gt; <a href="data-maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> (c (<a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a)) <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.Data.Data.html#dataCast1" class="link">Source</a> </p>
<p class="src"><a href="#v:dataCast2">dataCast2</a> :: <a href="data-dynamic.html#t:Typeable" title="Data.Dynamic">Typeable</a> t =&gt; (forall d e. (<a href="data-data.html#t:Data" title="Data.Data">Data</a> d, <a href="data-data.html#t:Data" title="Data.Data">Data</a> e) =&gt; c (t d e)) -&gt; <a href="data-maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> (c (<a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a)) <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.Data.Data.html#dataCast2" class="link">Source</a> </p>
<p class="src"><a href="#v:gmapT">gmapT</a> :: (forall b. <a href="data-data.html#t:Data" title="Data.Data">Data</a> b =&gt; b -&gt; b) -&gt; <a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a -&gt; <a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.Data.Data.html#gmapT" class="link">Source</a> </p>
<p class="src"><a href="#v:gmapQl">gmapQl</a> :: (r -&gt; r' -&gt; r) -&gt; r -&gt; (forall d. <a href="data-data.html#t:Data" title="Data.Data">Data</a> d =&gt; d -&gt; r') -&gt; <a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a -&gt; r <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.Data.Data.html#gmapQl" class="link">Source</a> </p>
<p class="src"><a href="#v:gmapQr">gmapQr</a> :: forall r r'. (r' -&gt; r -&gt; r) -&gt; r -&gt; (forall d. <a href="data-data.html#t:Data" title="Data.Data">Data</a> d =&gt; d -&gt; r') -&gt; <a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a -&gt; r <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.Data.Data.html#gmapQr" class="link">Source</a> </p>
<p class="src"><a href="#v:gmapQ">gmapQ</a> :: (forall d. <a href="data-data.html#t:Data" title="Data.Data">Data</a> d =&gt; d -&gt; u) -&gt; <a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a -&gt; [u] <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.Data.Data.html#gmapQ" class="link">Source</a> </p>
<p class="src"><a href="#v:gmapQi">gmapQi</a> :: <a href="data-int.html#t:Int" title="Data.Int">Int</a> -&gt; (forall d. <a href="data-data.html#t:Data" title="Data.Data">Data</a> d =&gt; d -&gt; u) -&gt; <a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a -&gt; u <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.Data.Data.html#gmapQi" class="link">Source</a> </p>
<p class="src"><a href="#v:gmapM">gmapM</a> :: <a href="control-monad.html#t:Monad" title="Control.Monad">Monad</a> m =&gt; (forall d. <a href="data-data.html#t:Data" title="Data.Data">Data</a> d =&gt; d -&gt; m d) -&gt; <a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a -&gt; m (<a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a) <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.Data.Data.html#gmapM" class="link">Source</a> </p>
<p class="src"><a href="#v:gmapMp">gmapMp</a> :: <a href="control-monad.html#t:MonadPlus" title="Control.Monad">MonadPlus</a> m =&gt; (forall d. <a href="data-data.html#t:Data" title="Data.Data">Data</a> d =&gt; d -&gt; m d) -&gt; <a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a -&gt; m (<a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a) <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.Data.Data.html#gmapMp" class="link">Source</a> </p>
<p class="src"><a href="#v:gmapMo">gmapMo</a> :: <a href="control-monad.html#t:MonadPlus" title="Control.Monad">MonadPlus</a> m =&gt; (forall d. <a href="data-data.html#t:Data" title="Data.Data">Data</a> d =&gt; d -&gt; m d) -&gt; <a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a -&gt; m (<a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a) <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.Data.Data.html#gmapMo" class="link">Source</a> </p>
</div></details></td></tr>
<tr>
<td class="src clearfix">
 <a href="prelude.html#t:Show" title="Prelude">Show</a> (<a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a) <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.ForeignPtr.html#line-221" class="link">Source</a> </td>
<td class="doc"><p><span class="version">Since: base-2.1</span></p></td>
</tr>
<tr><td colspan="2"><details id="i:id:ForeignPtr:Show:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/GHC-Internal-ForeignPtr.html">GHC.Internal.ForeignPtr</a></p> <div class="subs methods">
<h4 class="caption">Methods</h4>
<p class="src"><a href="#v:showsPrec">showsPrec</a> :: <a href="data-int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a -&gt; <a href="prelude.html#t:ShowS" title="Prelude">ShowS</a> <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.Show.html#showsPrec" class="link">Source</a> </p>
<p class="src"><a href="#v:show">show</a> :: <a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a -&gt; <a href="data-string.html#t:String" title="Data.String">String</a> <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.Show.html#show" class="link">Source</a> </p>
<p class="src"><a href="#v:showList">showList</a> :: [<a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a] -&gt; <a href="prelude.html#t:ShowS" title="Prelude">ShowS</a> <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.Show.html#showList" class="link">Source</a> </p>
</div></details></td></tr>
<tr>
<td class="src clearfix">
 <a href="data-eq.html#t:Eq" title="Data.Eq">Eq</a> (<a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a) <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.ForeignPtr.html#line-213" class="link">Source</a> </td>
<td class="doc"><p><span class="version">Since: base-2.1</span></p></td>
</tr>
<tr><td colspan="2"><details id="i:id:ForeignPtr:Eq:3"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/GHC-Internal-ForeignPtr.html">GHC.Internal.ForeignPtr</a></p> <div class="subs methods">
<h4 class="caption">Methods</h4>
<p class="src"><a href="#v:-61--61-">(==)</a> :: <a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a -&gt; <a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a -&gt; <a href="data-bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-prim-0.13.0-4caa/src/GHC.Classes.html#%3D%3D" class="link">Source</a> </p>
<p class="src"><a href="#v:-47--61-">(/=)</a> :: <a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a -&gt; <a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a -&gt; <a href="data-bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-prim-0.13.0-4caa/src/GHC.Classes.html#%2F%3D" class="link">Source</a> </p>
</div></details></td></tr>
<tr>
<td class="src clearfix">
 <a href="data-ord.html#t:Ord" title="Data.Ord">Ord</a> (<a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a) <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.ForeignPtr.html#line-217" class="link">Source</a> </td>
<td class="doc"><p><span class="version">Since: base-2.1</span></p></td>
</tr>
<tr><td colspan="2"><details id="i:id:ForeignPtr:Ord:4"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/GHC-Internal-ForeignPtr.html">GHC.Internal.ForeignPtr</a></p> <div class="subs methods">
<h4 class="caption">Methods</h4>
<p class="src"><a href="#v:compare">compare</a> :: <a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a -&gt; <a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a -&gt; <a href="data-ord.html#t:Ordering" title="Data.Ord">Ordering</a> <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-prim-0.13.0-4caa/src/GHC.Classes.html#compare" class="link">Source</a> </p>
<p class="src"><a href="#v:-60-">(&lt;)</a> :: <a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a -&gt; <a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a -&gt; <a href="data-bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-prim-0.13.0-4caa/src/GHC.Classes.html#%3C" class="link">Source</a> </p>
<p class="src"><a href="#v:-60--61-">(&lt;=)</a> :: <a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a -&gt; <a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a -&gt; <a href="data-bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-prim-0.13.0-4caa/src/GHC.Classes.html#%3C%3D" class="link">Source</a> </p>
<p class="src"><a href="#v:-62-">(&gt;)</a> :: <a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a -&gt; <a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a -&gt; <a href="data-bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-prim-0.13.0-4caa/src/GHC.Classes.html#%3E" class="link">Source</a> </p>
<p class="src"><a href="#v:-62--61-">(&gt;=)</a> :: <a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a -&gt; <a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a -&gt; <a href="data-bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-prim-0.13.0-4caa/src/GHC.Classes.html#%3E%3D" class="link">Source</a> </p>
<p class="src"><a href="#v:max">max</a> :: <a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a -&gt; <a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a -&gt; <a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-prim-0.13.0-4caa/src/GHC.Classes.html#max" class="link">Source</a> </p>
<p class="src"><a href="#v:min">min</a> :: <a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a -&gt; <a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a -&gt; <a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-prim-0.13.0-4caa/src/GHC.Classes.html#min" class="link">Source</a> </p>
</div></details></td></tr>
</table></details>
</div>
<p class="src">type <a id="t:FinalizerPtr" class="def">FinalizerPtr</a> a = <a href="foreign-ptr.html#t:FunPtr" title="Foreign.Ptr">FunPtr</a> (<a href="foreign-ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> a -&gt; <a href="prelude.html#t:IO" title="Prelude">IO</a> ()) <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.ForeignPtr.html#FinalizerPtr" class="link">Source</a> </p>
<p>A finalizer is represented as a pointer to a foreign function that, at finalisation time, gets as an argument a plain pointer variant of the foreign pointer that the finalizer is associated with.</p>
<p>Note that the foreign function <em>must</em> either use the <code class="inline-code">ccall</code> or the <code class="inline-code">capi</code> calling convention.</p>
<p class="src">type <a id="t:FinalizerEnvPtr" class="def">FinalizerEnvPtr</a> env a = <a href="foreign-ptr.html#t:FunPtr" title="Foreign.Ptr">FunPtr</a> (<a href="foreign-ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> env -&gt; <a href="foreign-ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> a -&gt; <a href="prelude.html#t:IO" title="Prelude">IO</a> ()) <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.ForeignPtr.html#FinalizerEnvPtr" class="link">Source</a> </p>
<a href="#g:2" id="g:2"><h3>Basic operations</h3></a><p class="src"><a id="v:newForeignPtr" class="def">newForeignPtr</a> :: <a href="foreign-foreignptr.html#t:FinalizerPtr" title="Foreign.ForeignPtr">FinalizerPtr</a> a -&gt; <a href="foreign-ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> a -&gt; <a href="prelude.html#t:IO" title="Prelude">IO</a> (<a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a) <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.Foreign.ForeignPtr.Imp.html#newForeignPtr" class="link">Source</a> </p>
<p>Turns a plain memory reference into a foreign pointer, and associates a finalizer with the reference. The finalizer will be executed after the last reference to the foreign object is dropped. There is no guarantee of promptness, however the finalizer will be executed before the program exits.</p>
<p class="src"><a id="v:newForeignPtr_" class="def">newForeignPtr_</a> :: <a href="foreign-ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> a -&gt; <a href="prelude.html#t:IO" title="Prelude">IO</a> (<a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a) <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.ForeignPtr.html#newForeignPtr_" class="link">Source</a> </p>
<p>Turns a plain memory reference into a foreign pointer that may be associated with finalizers by using <code><a href="foreign-foreignptr.html#v:addForeignPtrFinalizer" title="Foreign.ForeignPtr">addForeignPtrFinalizer</a></code>.</p>
<p class="src"><a id="v:addForeignPtrFinalizer" class="def">addForeignPtrFinalizer</a> :: <a href="foreign-foreignptr.html#t:FinalizerPtr" title="Foreign.ForeignPtr">FinalizerPtr</a> a -&gt; <a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a -&gt; <a href="prelude.html#t:IO" title="Prelude">IO</a> () <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.ForeignPtr.html#addForeignPtrFinalizer" class="link">Source</a> </p>
<p>This function adds a finalizer to the given foreign object. The finalizer will run <em>before</em> all other finalizers for the same object which have already been registered.</p>
<p class="src"><a id="v:newForeignPtrEnv" class="def">newForeignPtrEnv</a> :: <a href="foreign-foreignptr.html#t:FinalizerEnvPtr" title="Foreign.ForeignPtr">FinalizerEnvPtr</a> env a -&gt; <a href="foreign-ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> env -&gt; <a href="foreign-ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> a -&gt; <a href="prelude.html#t:IO" title="Prelude">IO</a> (<a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a) <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.Foreign.ForeignPtr.Imp.html#newForeignPtrEnv" class="link">Source</a> </p>
<p>This variant of <code><a href="foreign-foreignptr.html#v:newForeignPtr" title="Foreign.ForeignPtr">newForeignPtr</a></code> adds a finalizer that expects an environment in addition to the finalized pointer. The environment that will be passed to the finalizer is fixed by the second argument to <code><a href="foreign-foreignptr.html#v:newForeignPtrEnv" title="Foreign.ForeignPtr">newForeignPtrEnv</a></code>.</p>
<p class="src"><a id="v:addForeignPtrFinalizerEnv" class="def">addForeignPtrFinalizerEnv</a> :: <a href="foreign-foreignptr.html#t:FinalizerEnvPtr" title="Foreign.ForeignPtr">FinalizerEnvPtr</a> env a -&gt; <a href="foreign-ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> env -&gt; <a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a -&gt; <a href="prelude.html#t:IO" title="Prelude">IO</a> () <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.ForeignPtr.html#addForeignPtrFinalizerEnv" class="link">Source</a> </p>
<p>Like <code><a href="foreign-foreignptr.html#v:addForeignPtrFinalizer" title="Foreign.ForeignPtr">addForeignPtrFinalizer</a></code> but the finalizer is passed an additional environment parameter.</p>
<p class="src"><a id="v:withForeignPtr" class="def">withForeignPtr</a> :: <a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a -&gt; (<a href="foreign-ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> a -&gt; <a href="prelude.html#t:IO" title="Prelude">IO</a> b) -&gt; <a href="prelude.html#t:IO" title="Prelude">IO</a> b <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.ForeignPtr.html#withForeignPtr" class="link">Source</a> </p>
<p>This is a way to look at the pointer living inside a foreign object. This function takes a function which is applied to that pointer. The resulting <code><a href="prelude.html#t:IO" title="Prelude">IO</a></code> action is then executed. The foreign object is kept alive at least during the whole action, even if it is not used directly inside. Note that it is not safe to return the pointer from the action and use it after the action completes. All uses of the pointer should be inside the <code><a href="foreign-foreignptr.html#v:withForeignPtr" title="Foreign.ForeignPtr">withForeignPtr</a></code> bracket. The reason for this unsafeness is the same as for <code><a href="foreign-foreignptr-unsafe.html#v:unsafeForeignPtrToPtr" title="Foreign.ForeignPtr.Unsafe">unsafeForeignPtrToPtr</a></code> below: the finalizer may run earlier than expected, because the compiler can only track usage of the <code><a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a></code> object, not a <code><a href="ghc-exts.html#v:Ptr" title="GHC.Exts">Ptr</a></code> object made from it.</p>
<p>This function is normally used for marshalling data to or from the object pointed to by the <code><a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a></code>, using the operations from the <code><a href="foreign-storable.html#t:Storable" title="Foreign.Storable">Storable</a></code> class.</p>
<p class="src"><a id="v:finalizeForeignPtr" class="def">finalizeForeignPtr</a> :: <a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a -&gt; <a href="prelude.html#t:IO" title="Prelude">IO</a> () <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.ForeignPtr.html#finalizeForeignPtr" class="link">Source</a> </p>
<p>Causes the finalizers associated with a foreign pointer to be run immediately. The foreign pointer must not be used again after this function is called. If the foreign pointer does not support finalizers, this is a no-op.</p>
<a href="#g:3" id="g:3"><h3>Low-level operations</h3></a><p class="src"><a id="v:touchForeignPtr" class="def">touchForeignPtr</a> :: <a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a -&gt; <a href="prelude.html#t:IO" title="Prelude">IO</a> () <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.ForeignPtr.html#touchForeignPtr" class="link">Source</a> </p>
<p>This function ensures that the foreign object in question is alive at the given place in the sequence of IO actions. However, this comes with a significant caveat: the contract above does not hold if GHC can demonstrate that the code preceding <code class="inline-code">touchForeignPtr</code> diverges (e.g. by looping infinitely or throwing an exception). For this reason, you are strongly advised to use instead <code><a href="foreign-foreignptr.html#v:withForeignPtr" title="Foreign.ForeignPtr">withForeignPtr</a></code> where possible.</p>
<p>Also, note that this function should not be used to express dependencies between finalizers on <code><a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a></code>s. For example, if the finalizer for a <code><a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a></code> <code class="inline-code">F1</code> calls <code><a href="foreign-foreignptr.html#v:touchForeignPtr" title="Foreign.ForeignPtr">touchForeignPtr</a></code> on a second <code><a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a></code> <code class="inline-code">F2</code>, then the only guarantee is that the finalizer for <code class="inline-code">F2</code> is never started before the finalizer for <code class="inline-code">F1</code>. They might be started together if for example both <code class="inline-code">F1</code> and <code class="inline-code">F2</code> are otherwise unreachable, and in that case the scheduler might end up running the finalizer for <code class="inline-code">F2</code> first.</p>
<p>In general, it is not recommended to use finalizers on separate objects with ordering constraints between them. To express the ordering robustly requires explicit synchronisation using <code class="inline-code">MVar</code>s between the finalizers, but even then the runtime sometimes runs multiple finalizers sequentially in a single thread (for performance reasons), so synchronisation between finalizers could result in artificial deadlock. Another alternative is to use explicit reference counting.</p>
<p class="src"><a id="v:castForeignPtr" class="def">castForeignPtr</a> :: <a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a -&gt; <a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> b <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.ForeignPtr.html#castForeignPtr" class="link">Source</a> </p>
<p>This function casts a <code><a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a></code> parameterised by one type into another type.</p>
<p class="src"><a id="v:plusForeignPtr" class="def">plusForeignPtr</a> :: <a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a -&gt; <a href="data-int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> b <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.ForeignPtr.html#plusForeignPtr" class="link">Source</a> </p>
<p>Advances the given address by the given offset in bytes.</p>
<p>The new <code><a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a></code> shares the finalizer of the original, equivalent from a finalization standpoint to just creating another reference to the original. That is, the finalizer will not be called before the new <code><a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a></code> is unreachable, nor will it be called an additional time due to this call, and the finalizer will be called with the same address that it would have had this call not happened, *not* the new address.</p>
<p><span class="version">Since: base-4.10.0.0</span></p>
<a href="#g:4" id="g:4"><h3>Allocating managed memory</h3></a><p class="src"><a id="v:mallocForeignPtr" class="def">mallocForeignPtr</a> :: <a href="foreign-storable.html#t:Storable" title="Foreign.Storable">Storable</a> a =&gt; <a href="prelude.html#t:IO" title="Prelude">IO</a> (<a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a) <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.ForeignPtr.html#mallocForeignPtr" class="link">Source</a> </p>
<p>Allocate some memory and return a <code><a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a></code> to it. The memory will be released automatically when the <code><a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a></code> is discarded.</p>
<p><code><a href="foreign-foreignptr.html#v:mallocForeignPtr" title="Foreign.ForeignPtr">mallocForeignPtr</a></code> is equivalent to</p>
<pre>   do { p &lt;- malloc; newForeignPtr finalizerFree p }</pre>
<p>although it may be implemented differently internally: you may not assume that the memory returned by <code><a href="foreign-foreignptr.html#v:mallocForeignPtr" title="Foreign.ForeignPtr">mallocForeignPtr</a></code> has been allocated with <code><a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/GHC-Internal-Foreign-Marshal-Alloc.html#v:malloc" title="GHC.Internal.Foreign.Marshal.Alloc">malloc</a></code>.</p>
<p>GHC notes: <code><a href="foreign-foreignptr.html#v:mallocForeignPtr" title="Foreign.ForeignPtr">mallocForeignPtr</a></code> has a heavily optimised implementation in GHC. It uses pinned memory in the garbage collected heap, so the <code><a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a></code> does not require a finalizer to free the memory. Use of <code><a href="foreign-foreignptr.html#v:mallocForeignPtr" title="Foreign.ForeignPtr">mallocForeignPtr</a></code> and associated functions is strongly recommended in preference to <code><a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/GHC-Internal-Foreign-ForeignPtr.html#v:newForeignPtr" title="GHC.Internal.Foreign.ForeignPtr">newForeignPtr</a></code> with a finalizer.</p>
<p class="src"><a id="v:mallocForeignPtrBytes" class="def">mallocForeignPtrBytes</a> :: <a href="data-int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="prelude.html#t:IO" title="Prelude">IO</a> (<a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a) <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.ForeignPtr.html#mallocForeignPtrBytes" class="link">Source</a> </p>
<p>This function is similar to <code><a href="foreign-foreignptr.html#v:mallocForeignPtr" title="Foreign.ForeignPtr">mallocForeignPtr</a></code>, except that the size of the memory required is given explicitly as a number of bytes.</p>
<p class="src"><a id="v:mallocForeignPtrArray" class="def">mallocForeignPtrArray</a> :: <a href="foreign-storable.html#t:Storable" title="Foreign.Storable">Storable</a> a =&gt; <a href="data-int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="prelude.html#t:IO" title="Prelude">IO</a> (<a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a) <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.Foreign.ForeignPtr.Imp.html#mallocForeignPtrArray" class="link">Source</a> </p>
<p>This function is similar to <code><a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/GHC-Internal-Foreign-Marshal-Array.html#v:mallocArray" title="GHC.Internal.Foreign.Marshal.Array">mallocArray</a></code>, but yields a memory area that has a finalizer attached that releases the memory area. As with <code><a href="foreign-foreignptr.html#v:mallocForeignPtr" title="Foreign.ForeignPtr">mallocForeignPtr</a></code>, it is not guaranteed that the block of memory was allocated by <code><a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/GHC-Internal-Foreign-Marshal-Alloc.html#v:malloc" title="GHC.Internal.Foreign.Marshal.Alloc">malloc</a></code>.</p>
<p class="src"><a id="v:mallocForeignPtrArray0" class="def">mallocForeignPtrArray0</a> :: <a href="foreign-storable.html#t:Storable" title="Foreign.Storable">Storable</a> a =&gt; <a href="data-int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="prelude.html#t:IO" title="Prelude">IO</a> (<a href="foreign-foreignptr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a) <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.Foreign.ForeignPtr.Imp.html#mallocForeignPtrArray0" class="link">Source</a> </p>
<p>This function is similar to <code><a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/GHC-Internal-Foreign-Marshal-Array.html#v:mallocArray0" title="GHC.Internal.Foreign.Marshal.Array">mallocArray0</a></code>, but yields a memory area that has a finalizer attached that releases the memory area. As with <code><a href="foreign-foreignptr.html#v:mallocForeignPtr" title="Foreign.ForeignPtr">mallocForeignPtr</a></code>, it is not guaranteed that the block of memory was allocated by <code><a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/GHC-Internal-Foreign-Marshal-Alloc.html#v:malloc" title="GHC.Internal.Foreign.Marshal.Alloc">malloc</a></code>.</p>
</div><div class="_attribution">
  <p class="_attribution-p">
    &copy; The University of Glasgow and others<br>Licensed under a BSD-style license (see top of the page).<br>
    <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/base-4.21.0.0-8e62/Foreign-ForeignPtr.html" class="_attribution-link">https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/base-4.21.0.0-8e62/Foreign-ForeignPtr.html</a>
  </p>
</div>
