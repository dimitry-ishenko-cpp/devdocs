<h1 class="caption">Foreign.Marshal.Alloc</h1>
<div class="_haskell-api">
<table class="info">
<tr>
<th valign="top">Copyright</th>
<td>(c) The FFI task force 2001</td>
</tr>
<tr>
<th>License</th>
<td>BSD-style (see the file libraries/base/LICENSE)</td>
</tr>
<tr>
<th>Maintainer</th>
<td>ffi@haskell.org</td>
</tr>
<tr>
<th>Stability</th>
<td>provisional</td>
</tr>
<tr>
<th>Portability</th>
<td>portable</td>
</tr>
<tr>
<th>Safe Haskell</th>
<td>Safe</td>
</tr>
<tr>
<th>Language</th>
<td>Haskell2010</td>
</tr>
</table>
<div id="table-of-contents"><div id="contents-list">
<h4 class="caption" onclick="window.scrollTo(0,0)">Contents</h4>
<ul><li>
<a href="#g:1">Memory allocation</a><ul>
<li><a href="#g:2">Local allocation</a></li>
<li><a href="#g:3">Dynamic allocation</a></li>
</ul>
</li></ul>
</div></div>
<div id="description">
<h4 class="caption">Description</h4>
<p>The module <a href="foreign-marshal-alloc.html">Foreign.Marshal.Alloc</a> provides operations to allocate and deallocate blocks of raw memory (i.e., unstructured chunks of memory outside of the area maintained by the Haskell storage manager). These memory blocks are commonly used to pass compound data structures to foreign functions or to provide space in which compound result values are obtained from foreign functions.</p>
<p>If any of the allocation functions fails, an exception is thrown. In some cases, memory exhaustion may mean the process is terminated. If <code><a href="foreign-marshal-alloc.html#v:free" title="Foreign.Marshal.Alloc">free</a></code> or <code><a href="foreign-marshal-alloc.html#v:reallocBytes" title="Foreign.Marshal.Alloc">reallocBytes</a></code> is applied to a memory area that has been allocated with <code><a href="foreign-marshal-alloc.html#v:alloca" title="Foreign.Marshal.Alloc">alloca</a></code> or <code><a href="foreign-marshal-alloc.html#v:allocaBytes" title="Foreign.Marshal.Alloc">allocaBytes</a></code>, the behaviour is undefined. Any further access to memory areas allocated with <code><a href="foreign-marshal-alloc.html#v:alloca" title="Foreign.Marshal.Alloc">alloca</a></code> or <code><a href="foreign-marshal-alloc.html#v:allocaBytes" title="Foreign.Marshal.Alloc">allocaBytes</a></code>, after the computation that was passed to the allocation function has terminated, leads to undefined behaviour. Any further access to the memory area referenced by a pointer passed to <code><a href="foreign-marshal-alloc.html#v:realloc" title="Foreign.Marshal.Alloc">realloc</a></code>, <code><a href="foreign-marshal-alloc.html#v:reallocBytes" title="Foreign.Marshal.Alloc">reallocBytes</a></code>, or <code><a href="foreign-marshal-alloc.html#v:free" title="Foreign.Marshal.Alloc">free</a></code> entails undefined behaviour.</p>
<p>All storage allocated by functions that allocate based on a <em>size in bytes</em> must be sufficiently aligned for any of the basic foreign types that fits into the newly allocated storage. All storage allocated by functions that allocate based on a specific type must be sufficiently aligned for that type. Array allocation routines need to obey the same alignment constraints for each array element.</p>
<p>The underlying implementation is wrapping the <code class="inline-code"><a href="stdlib.h.html">stdlib.h</a></code> <code class="inline-code">malloc</code>, <code class="inline-code">realloc</code>, and <code class="inline-code">free</code>. In other words it should be safe to allocate using C-<code class="inline-code">malloc</code>, and free memory with <code><a href="foreign-marshal-alloc.html#v:free" title="Foreign.Marshal.Alloc">free</a></code> from this module.</p>
</div>
<a href="#g:1" id="g:1"><h2>Memory allocation</h2></a><a href="#g:2" id="g:2"><h3>Local allocation</h3></a><p class="src"><a id="v:alloca" class="def">alloca</a> :: <a href="foreign-storable.html#t:Storable" title="Foreign.Storable">Storable</a> a =&gt; (<a href="foreign-ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> a -&gt; <a href="prelude.html#t:IO" title="Prelude">IO</a> b) -&gt; <a href="prelude.html#t:IO" title="Prelude">IO</a> b <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.Foreign.Marshal.Alloc.html#alloca" class="link">Source</a> </p>
<p><code class="inline-code"><a href="foreign-marshal-alloc.html#v:alloca" title="Foreign.Marshal.Alloc">alloca</a> f</code> executes the computation <code class="inline-code">f</code>, passing as argument a pointer to a temporarily allocated block of memory sufficient to hold values of type <code class="inline-code">a</code>.</p>
<p>The memory is freed when <code class="inline-code">f</code> terminates (either normally or via an exception), so the pointer passed to <code class="inline-code">f</code> must <em>not</em> be used after this.</p>
<p class="src"><a id="v:allocaBytes" class="def">allocaBytes</a> :: <a href="data-int.html#t:Int" title="Data.Int">Int</a> -&gt; (<a href="foreign-ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> a -&gt; <a href="prelude.html#t:IO" title="Prelude">IO</a> b) -&gt; <a href="prelude.html#t:IO" title="Prelude">IO</a> b <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.Foreign.Marshal.Alloc.html#allocaBytes" class="link">Source</a> </p>
<p><code class="inline-code"><a href="foreign-marshal-alloc.html#v:allocaBytes" title="Foreign.Marshal.Alloc">allocaBytes</a> n f</code> executes the computation <code class="inline-code">f</code>, passing as argument a pointer to a temporarily allocated block of memory of <code class="inline-code">n</code> bytes. The block of memory is sufficiently aligned for any of the basic foreign types that fits into a memory block of the allocated size.</p>
<p>The memory is freed when <code class="inline-code">f</code> terminates (either normally or via an exception), so the pointer passed to <code class="inline-code">f</code> must <em>not</em> be used after this.</p>
<p class="src"><a id="v:allocaBytesAligned" class="def">allocaBytesAligned</a> :: <a href="data-int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="data-int.html#t:Int" title="Data.Int">Int</a> -&gt; (<a href="foreign-ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> a -&gt; <a href="prelude.html#t:IO" title="Prelude">IO</a> b) -&gt; <a href="prelude.html#t:IO" title="Prelude">IO</a> b <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.Foreign.Marshal.Alloc.html#allocaBytesAligned" class="link">Source</a> </p>
<p><code class="inline-code"><a href="foreign-marshal-alloc.html#v:allocaBytesAligned" title="Foreign.Marshal.Alloc">allocaBytesAligned</a> size align f</code> executes the computation <code class="inline-code">f</code>, passing as argument a pointer to a temporarily allocated block of memory of <code class="inline-code">size</code> bytes and aligned to <code class="inline-code">align</code> bytes. The value of <code class="inline-code">align</code> must be a power of two.</p>
<p>The memory is freed when <code class="inline-code">f</code> terminates (either normally or via an exception), so the pointer passed to <code class="inline-code">f</code> must <em>not</em> be used after this.</p>
<a href="#g:3" id="g:3"><h3>Dynamic allocation</h3></a><p class="src"><a id="v:malloc" class="def">malloc</a> :: <a href="foreign-storable.html#t:Storable" title="Foreign.Storable">Storable</a> a =&gt; <a href="prelude.html#t:IO" title="Prelude">IO</a> (<a href="foreign-ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> a) <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.Foreign.Marshal.Alloc.html#malloc" class="link">Source</a> </p>
<p>Allocate a block of memory that is sufficient to hold values of type <code class="inline-code">a</code>. The size of the area allocated is determined by the <code><a href="foreign-storable.html#v:sizeOf" title="Foreign.Storable">sizeOf</a></code> method from the instance of <code><a href="foreign-storable.html#t:Storable" title="Foreign.Storable">Storable</a></code> for the appropriate type.</p>
<p>The memory may be deallocated using <code><a href="foreign-marshal-alloc.html#v:free" title="Foreign.Marshal.Alloc">free</a></code> or <code><a href="foreign-marshal-alloc.html#v:finalizerFree" title="Foreign.Marshal.Alloc">finalizerFree</a></code> when no longer required.</p>
<p class="src"><a id="v:mallocBytes" class="def">mallocBytes</a> :: <a href="data-int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="prelude.html#t:IO" title="Prelude">IO</a> (<a href="foreign-ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> a) <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.Foreign.Marshal.Alloc.html#mallocBytes" class="link">Source</a> </p>
<p>Allocate a block of memory of the given number of bytes. The block of memory is sufficiently aligned for any of the basic foreign types that fits into a memory block of the allocated size.</p>
<p>The memory may be deallocated using <code><a href="foreign-marshal-alloc.html#v:free" title="Foreign.Marshal.Alloc">free</a></code> or <code><a href="foreign-marshal-alloc.html#v:finalizerFree" title="Foreign.Marshal.Alloc">finalizerFree</a></code> when no longer required.</p>
<p class="src"><a id="v:calloc" class="def">calloc</a> :: <a href="foreign-storable.html#t:Storable" title="Foreign.Storable">Storable</a> a =&gt; <a href="prelude.html#t:IO" title="Prelude">IO</a> (<a href="foreign-ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> a) <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.Foreign.Marshal.Alloc.html#calloc" class="link">Source</a> </p>
<p>Like <code><a href="foreign-marshal-alloc.html#v:malloc" title="Foreign.Marshal.Alloc">malloc</a></code> but memory is filled with bytes of value zero.</p>
<p class="src"><a id="v:callocBytes" class="def">callocBytes</a> :: <a href="data-int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="prelude.html#t:IO" title="Prelude">IO</a> (<a href="foreign-ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> a) <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.Foreign.Marshal.Alloc.html#callocBytes" class="link">Source</a> </p>
<p>Like <code><a href="foreign-marshal-alloc.html#v:mallocBytes" title="Foreign.Marshal.Alloc">mallocBytes</a></code>, but memory is filled with bytes of value zero.</p>
<p class="src"><a id="v:realloc" class="def">realloc</a> :: forall a b. <a href="foreign-storable.html#t:Storable" title="Foreign.Storable">Storable</a> b =&gt; <a href="foreign-ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> a -&gt; <a href="prelude.html#t:IO" title="Prelude">IO</a> (<a href="foreign-ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> b) <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.Foreign.Marshal.Alloc.html#realloc" class="link">Source</a> </p>
<p>Resize a memory area that was allocated with <code><a href="foreign-marshal-alloc.html#v:malloc" title="Foreign.Marshal.Alloc">malloc</a></code> or <code><a href="foreign-marshal-alloc.html#v:mallocBytes" title="Foreign.Marshal.Alloc">mallocBytes</a></code> to the size needed to store values of type <code class="inline-code">b</code>. The returned pointer may refer to an entirely different memory area, but will be suitably aligned to hold values of type <code class="inline-code">b</code>. The contents of the referenced memory area will be the same as of the original pointer up to the minimum of the original size and the size of values of type <code class="inline-code">b</code>.</p>
<p>If the argument to <code><a href="foreign-marshal-alloc.html#v:realloc" title="Foreign.Marshal.Alloc">realloc</a></code> is <code><a href="foreign-ptr.html#v:nullPtr" title="Foreign.Ptr">nullPtr</a></code>, <code><a href="foreign-marshal-alloc.html#v:realloc" title="Foreign.Marshal.Alloc">realloc</a></code> behaves like <code><a href="foreign-marshal-alloc.html#v:malloc" title="Foreign.Marshal.Alloc">malloc</a></code>.</p>
<p class="src"><a id="v:reallocBytes" class="def">reallocBytes</a> :: <a href="foreign-ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> a -&gt; <a href="data-int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="prelude.html#t:IO" title="Prelude">IO</a> (<a href="foreign-ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> a) <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.Foreign.Marshal.Alloc.html#reallocBytes" class="link">Source</a> </p>
<p>Resize a memory area that was allocated with <code><a href="foreign-marshal-alloc.html#v:malloc" title="Foreign.Marshal.Alloc">malloc</a></code> or <code><a href="foreign-marshal-alloc.html#v:mallocBytes" title="Foreign.Marshal.Alloc">mallocBytes</a></code> to the given size. The returned pointer may refer to an entirely different memory area, but will be sufficiently aligned for any of the basic foreign types that fits into a memory block of the given size. The contents of the referenced memory area will be the same as of the original pointer up to the minimum of the original size and the given size.</p>
<p>If the pointer argument to <code><a href="foreign-marshal-alloc.html#v:reallocBytes" title="Foreign.Marshal.Alloc">reallocBytes</a></code> is <code><a href="foreign-ptr.html#v:nullPtr" title="Foreign.Ptr">nullPtr</a></code>, <code><a href="foreign-marshal-alloc.html#v:reallocBytes" title="Foreign.Marshal.Alloc">reallocBytes</a></code> behaves like <code><a href="foreign-marshal-alloc.html#v:malloc" title="Foreign.Marshal.Alloc">malloc</a></code>. If the requested size is 0, <code><a href="foreign-marshal-alloc.html#v:reallocBytes" title="Foreign.Marshal.Alloc">reallocBytes</a></code> behaves like <code><a href="foreign-marshal-alloc.html#v:free" title="Foreign.Marshal.Alloc">free</a></code>.</p>
<p class="src"><a id="v:free" class="def">free</a> :: <a href="foreign-ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> a -&gt; <a href="prelude.html#t:IO" title="Prelude">IO</a> () <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.Foreign.Marshal.Alloc.html#free" class="link">Source</a> </p>
<p>Free a block of memory that was allocated with <code><a href="foreign-marshal-alloc.html#v:malloc" title="Foreign.Marshal.Alloc">malloc</a></code>, <code><a href="foreign-marshal-alloc.html#v:mallocBytes" title="Foreign.Marshal.Alloc">mallocBytes</a></code>, <code><a href="foreign-marshal-alloc.html#v:realloc" title="Foreign.Marshal.Alloc">realloc</a></code>, <code><a href="foreign-marshal-alloc.html#v:reallocBytes" title="Foreign.Marshal.Alloc">reallocBytes</a></code>, <code><a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/GHC-Internal-Foreign-Marshal-Utils.html#v:new" title="GHC.Internal.Foreign.Marshal.Utils">new</a></code> or any of the <code class="inline-code">new</code><em>X</em> functions in <a href="foreign-marshal-array.html">Foreign.Marshal.Array</a> or <a href="foreign-c-string.html">Foreign.C.String</a>.</p>
<p class="src"><a id="v:finalizerFree" class="def">finalizerFree</a> :: <a href="foreign-foreignptr.html#t:FinalizerPtr" title="Foreign.ForeignPtr">FinalizerPtr</a> a <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/ghc-internal-9.1201.0-3ad5/src/GHC.Internal.Foreign.Marshal.Alloc.html#finalizerFree" class="link">Source</a> </p>
<p>A pointer to a foreign function equivalent to <code><a href="foreign-marshal-alloc.html#v:free" title="Foreign.Marshal.Alloc">free</a></code>, which may be used as a finalizer (cf <code><a href="foreign-foreignptr.html#v:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a></code>) for storage allocated with <code><a href="foreign-marshal-alloc.html#v:malloc" title="Foreign.Marshal.Alloc">malloc</a></code>, <code><a href="foreign-marshal-alloc.html#v:mallocBytes" title="Foreign.Marshal.Alloc">mallocBytes</a></code>, <code><a href="foreign-marshal-alloc.html#v:realloc" title="Foreign.Marshal.Alloc">realloc</a></code> or <code><a href="foreign-marshal-alloc.html#v:reallocBytes" title="Foreign.Marshal.Alloc">reallocBytes</a></code>.</p>
</div><div class="_attribution">
  <p class="_attribution-p">
    &copy; The University of Glasgow and others<br>Licensed under a BSD-style license (see top of the page).<br>
    <a href="https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/base-4.21.0.0-8e62/Foreign-Marshal-Alloc.html" class="_attribution-link">https://downloads.haskell.org/~ghc/9.12.1/docs/libraries/base-4.21.0.0-8e62/Foreign-Marshal-Alloc.html</a>
  </p>
</div>
