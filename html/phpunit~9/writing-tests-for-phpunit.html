<h1>Writing Tests for PHPUnit</h1> <p><a class="reference internal" href="#writing-tests-for-phpunit-examples-stacktest-php"><span class="std std-numref">Example 2.1</span></a> shows how we can write tests using PHPUnit that exercise PHP’s array operations. The example introduces the basic conventions and steps for writing tests with PHPUnit:</p> <ol class="arabic"> <li>
<p class="first">The tests for a class <code class="docutils literal"><span class="pre">Class</span></code> go into a class <code class="docutils literal"><span class="pre">ClassTest</span></code>.</p> </li> <li>
<p class="first"><code class="docutils literal"><span class="pre">ClassTest</span></code> inherits (most of the time) from <code class="docutils literal"><span class="pre">PHPUnit\Framework\TestCase</span></code>.</p> </li> <li>
<p class="first">The tests are public methods that are named <code class="docutils literal"><span class="pre">test*</span></code>.</p> <p>Alternatively, you can use the <code class="docutils literal"><span class="pre">@test</span></code> annotation in a method’s docblock to mark it as a test method.</p> </li> <li>
<p class="first">Inside the test methods, assertion methods such as <code class="docutils literal"><span class="pre">assertSame()</span></code> (see <a class="reference internal" href="assertions.html#appendixes-assertions"><span class="std std-ref">Assertions</span></a>) are used to assert that an actual value matches an expected value.</p> </li> </ol> <div class="literal-block-wrapper docutils container" id="writing-tests-for-phpunit-examples-stacktest-php"> <div class="code-block-caption">
<span class="caption-number">Example 2.1 </span><span class="caption-text">Testing array operations with PHPUnit</span>
</div> <div class="highlight-php">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">StackTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testPushAndPop</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$stack</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$stack</span><span class="p">));</span>

        <span class="nb">array_push</span><span class="p">(</span><span class="nv">$stack</span><span class="p">,</span> <span class="s1">'foo'</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="s1">'foo'</span><span class="p">,</span> <span class="nv">$stack</span><span class="p">[</span><span class="nb">count</span><span class="p">(</span><span class="nv">$stack</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$stack</span><span class="p">));</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="s1">'foo'</span><span class="p">,</span> <span class="nb">array_pop</span><span class="p">(</span><span class="nv">$stack</span><span class="p">));</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$stack</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> <div class="line-block"> <div class="line">
<em>Martin Fowler</em>:</div> </div> <blockquote> <div>Whenever you are tempted to type something into a <code class="docutils literal"><span class="pre">print</span></code> statement or a debugger expression, write it as a test instead.</div>
</blockquote> <div class="section" id="test-dependencies"> <h2>Test Dependencies</h2> <blockquote> <div>
<p><em>Adrian Kuhn et. al.</em>:</p> <p>Unit Tests are primarily written as a good practice to help developers identify and fix bugs, to refactor code and to serve as documentation for a unit of software under test. To achieve these benefits, unit tests ideally should cover all the possible paths in a program. One unit test usually covers one specific path in one function or method. However a test method is not necessarily an encapsulated, independent entity. Often there are implicit dependencies between test methods, hidden in the implementation scenario of a test.</p> </div>
</blockquote> <p>PHPUnit supports the declaration of explicit dependencies between test methods. Such dependencies do not define the order in which the test methods are to be executed but they allow the returning of an instance of the test fixture by a producer and passing it to the dependent consumers.</p> <ul class="simple"> <li>A producer is a test method that yields its unit under test as return value.</li> <li>A consumer is a test method that depends on one or more producers and their return values.</li> </ul> <p><a class="reference internal" href="#writing-tests-for-phpunit-examples-stacktest2-php"><span class="std std-numref">Example 2.2</span></a> shows how to use the <code class="docutils literal"><span class="pre">@depends</span></code> annotation to express dependencies between test methods.</p> <div class="literal-block-wrapper docutils container" id="writing-tests-for-phpunit-examples-stacktest2-php"> <div class="code-block-caption">
<span class="caption-number">Example 2.2 </span><span class="caption-text">Using the <code class="docutils literal"><span class="pre">@depends</span></code> annotation to express dependencies</span>
</div> <div class="highlight-php">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">StackTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testEmpty</span><span class="p">()</span><span class="o">:</span> <span class="k">array</span>
    <span class="p">{</span>
        <span class="nv">$stack</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEmpty</span><span class="p">(</span><span class="nv">$stack</span><span class="p">);</span>

        <span class="k">return</span> <span class="nv">$stack</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @depends testEmpty</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testPush</span><span class="p">(</span><span class="k">array</span> <span class="nv">$stack</span><span class="p">)</span><span class="o">:</span> <span class="k">array</span>
    <span class="p">{</span>
        <span class="nb">array_push</span><span class="p">(</span><span class="nv">$stack</span><span class="p">,</span> <span class="s1">'foo'</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="s1">'foo'</span><span class="p">,</span> <span class="nv">$stack</span><span class="p">[</span><span class="nb">count</span><span class="p">(</span><span class="nv">$stack</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertNotEmpty</span><span class="p">(</span><span class="nv">$stack</span><span class="p">);</span>

        <span class="k">return</span> <span class="nv">$stack</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @depends testPush</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testPop</span><span class="p">(</span><span class="k">array</span> <span class="nv">$stack</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="s1">'foo'</span><span class="p">,</span> <span class="nb">array_pop</span><span class="p">(</span><span class="nv">$stack</span><span class="p">));</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEmpty</span><span class="p">(</span><span class="nv">$stack</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> <p>In the example above, the first test, <code class="docutils literal"><span class="pre">testEmpty()</span></code>, creates a new array and asserts that it is empty. The test then returns the fixture as its result. The second test, <code class="docutils literal"><span class="pre">testPush()</span></code>, depends on <code class="docutils literal"><span class="pre">testEmpty()</span></code> and is passed the result of that depended-upon test as its argument. Finally, <code class="docutils literal"><span class="pre">testPop()</span></code> depends upon <code class="docutils literal"><span class="pre">testPush()</span></code>.</p> <div class="admonition-note admonition"> <p class="first admonition-title">Note</p> <p class="last">The return value yielded by a producer is passed “as-is” to its consumers by default. This means that when a producer returns an object, a reference to that object is passed to the consumers. Instead of a reference either (a) a (deep) copy via <code class="docutils literal"><span class="pre">@depends</span> <span class="pre">clone</span></code>, or (b) a (normal shallow) clone (based on PHP keyword <code class="docutils literal"><span class="pre">clone</span></code>) via <code class="docutils literal"><span class="pre">@depends</span> <span class="pre">shallowClone</span></code> are possible too.</p> </div> <p>To localize defects, we want our attention to be focussed on relevant failing tests. This is why PHPUnit skips the execution of a test when a depended-upon test has failed. This improves defect localization by exploiting the dependencies between tests as shown in <a class="reference internal" href="#writing-tests-for-phpunit-examples-dependencyfailuretest-php"><span class="std std-numref">Example 2.3</span></a>.</p> <div class="literal-block-wrapper docutils container" id="writing-tests-for-phpunit-examples-dependencyfailuretest-php"> <div class="code-block-caption">
<span class="caption-number">Example 2.3 </span><span class="caption-text">Exploiting the dependencies between tests</span>
</div> <div class="highlight-php">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">DependencyFailureTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testOne</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @depends testOne</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testTwo</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> <pre class="highlight" data-language="php">
$ phpunit --verbose DependencyFailureTest
PHPUnit 9.5.0 by Sebastian Bergmann and contributors.

FS

Time: 0 seconds, Memory: 5.00Mb

There was 1 failure:

1) DependencyFailureTest::testOne
Failed asserting that false is true.

/home/sb/DependencyFailureTest.php:6

There was 1 skipped test:

1) DependencyFailureTest::testTwo
This test depends on "DependencyFailureTest::testOne" to pass.

FAILURES!
Tests: 1, Assertions: 1, Failures: 1, Skipped: 1.
</pre> <p>A test may have more than one <code class="docutils literal"><span class="pre">@depends</span></code> annotation. PHPUnit does not change the order in which tests are executed, you have to ensure that the dependencies of a test can actually be met before the test is run.</p> <p>A test that has more than one <code class="docutils literal"><span class="pre">@depends</span></code> annotation will get a fixture from the first producer as the first argument, a fixture from the second producer as the second argument, and so on. See <a class="reference internal" href="#writing-tests-for-phpunit-examples-multipledependencies-php"><span class="std std-numref">Example 2.4</span></a></p> <div class="literal-block-wrapper docutils container" id="writing-tests-for-phpunit-examples-multipledependencies-php"> <div class="code-block-caption">
<span class="caption-number">Example 2.4 </span><span class="caption-text">Test with multiple dependencies</span>
</div> <div class="highlight-php">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">MultipleDependenciesTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testProducerFirst</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>

        <span class="k">return</span> <span class="s1">'first'</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testProducerSecond</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>

        <span class="k">return</span> <span class="s1">'second'</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @depends testProducerFirst</span>
<span class="sd">     * @depends testProducerSecond</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testConsumer</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$a</span><span class="p">,</span> <span class="nx">string</span> <span class="nv">$b</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="s1">'first'</span><span class="p">,</span> <span class="nv">$a</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="s1">'second'</span><span class="p">,</span> <span class="nv">$b</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> <pre class="highlight" data-language="php">
$ phpunit --verbose MultipleDependenciesTest
PHPUnit 9.5.0 by Sebastian Bergmann and contributors.

...

Time: 0 seconds, Memory: 3.25Mb

OK (3 tests, 4 assertions)
</pre> </div> <div class="section" id="data-providers"> <h2>Data Providers</h2> <p>A test method can accept arbitrary arguments. These arguments are to be provided by one or more data provider methods (<code class="docutils literal"><span class="pre">additionProvider()</span></code> in <a class="reference internal" href="#writing-tests-for-phpunit-data-providers-examples-datatest-php"><span class="std std-numref">Example 2.5</span></a>). The data provider method to be used is specified using the <code class="docutils literal"><span class="pre">@dataProvider</span></code> annotation.</p> <p>A data provider method must be <code class="docutils literal"><span class="pre">public</span></code> and either return an array of arrays or an object that implements the <code class="docutils literal"><span class="pre">Iterator</span></code> interface and yields an array for each iteration step. For each array that is part of the collection the test method will be called with the contents of the array as its arguments.</p> <div class="literal-block-wrapper docutils container" id="writing-tests-for-phpunit-data-providers-examples-datatest-php"> <div class="code-block-caption">
<span class="caption-number">Example 2.5 </span><span class="caption-text">Using a data provider that returns an array of arrays</span>
</div> <div class="highlight-php">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">DataTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @dataProvider additionProvider</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testAdd</span><span class="p">(</span><span class="nx">int</span> <span class="nv">$a</span><span class="p">,</span> <span class="nx">int</span> <span class="nv">$b</span><span class="p">,</span> <span class="nx">int</span> <span class="nv">$expected</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="nv">$expected</span><span class="p">,</span> <span class="nv">$a</span> <span class="o">+</span> <span class="nv">$b</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">additionProvider</span><span class="p">()</span><span class="o">:</span> <span class="k">array</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
        <span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> <pre class="highlight" data-language="php">
$ phpunit DataTest
PHPUnit 9.5.0 by Sebastian Bergmann and contributors.

...F

Time: 0 seconds, Memory: 5.75Mb

There was 1 failure:

1) DataTest::testAdd with data set #3 (1, 1, 3)
Failed asserting that 2 is identical to 3.

/home/sb/DataTest.php:9

FAILURES!
Tests: 4, Assertions: 4, Failures: 1.
</pre> <p>When using a large number of datasets it’s useful to name each one with string key instead of default numeric. Output will be more verbose as it’ll contain that name of a dataset that breaks a test.</p> <div class="literal-block-wrapper docutils container" id="writing-tests-for-phpunit-data-providers-examples-datatest1-php"> <div class="code-block-caption">
<span class="caption-number">Example 2.6 </span><span class="caption-text">Using a data provider with named datasets</span>
</div> <div class="highlight-php">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">DataTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @dataProvider additionProvider</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testAdd</span><span class="p">(</span><span class="nx">int</span> <span class="nv">$a</span><span class="p">,</span> <span class="nx">int</span> <span class="nv">$b</span><span class="p">,</span> <span class="nx">int</span> <span class="nv">$expected</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="nv">$expected</span><span class="p">,</span> <span class="nv">$a</span> <span class="o">+</span> <span class="nv">$b</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">additionProvider</span><span class="p">()</span><span class="o">:</span> <span class="k">array</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="s1">'adding zeros'</span>  <span class="o">=&gt;</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="s1">'zero plus one'</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="s1">'one plus zero'</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="s1">'one plus one'</span>  <span class="o">=&gt;</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
        <span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> <pre class="highlight" data-language="php">
$ phpunit DataTest
PHPUnit 9.5.0 by Sebastian Bergmann and contributors.

...F

Time: 0 seconds, Memory: 5.75Mb

There was 1 failure:

1) DataTest::testAdd with data set "one plus one" (1, 1, 3)
Failed asserting that 2 is identical to 3.

/home/sb/DataTest.php:9

FAILURES!
Tests: 4, Assertions: 4, Failures: 1.
</pre> <div class="literal-block-wrapper docutils container" id="writing-tests-for-phpunit-data-providers-examples-datatest2-php"> <div class="code-block-caption">
<span class="caption-number">Example 2.7 </span><span class="caption-text">Using a data provider that returns an Iterator object</span>
</div> <div class="highlight-php">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">DataTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @dataProvider additionProvider</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testAdd</span><span class="p">(</span><span class="nx">int</span> <span class="nv">$a</span><span class="p">,</span> <span class="nx">int</span> <span class="nv">$b</span><span class="p">,</span> <span class="nx">int</span> <span class="nv">$expected</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="nv">$expected</span><span class="p">,</span> <span class="nv">$a</span> <span class="o">+</span> <span class="nv">$b</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">additionProvider</span><span class="p">()</span><span class="o">:</span> <span class="nx">CsvFileIterator</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">CsvFileIterator</span><span class="p">(</span><span class="s1">'data.csv'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> <pre class="highlight" data-language="php">
$ phpunit DataTest
PHPUnit 9.5.0 by Sebastian Bergmann and contributors.

...F

Time: 0 seconds, Memory: 5.75Mb

There was 1 failure:

1) DataTest::testAdd with data set #3 ('1', '1', '3')
Failed asserting that 2 is identical to 3.

/home/sb/DataTest.php:11

FAILURES!
Tests: 4, Assertions: 4, Failures: 1.
</pre> <div class="literal-block-wrapper docutils container" id="writing-tests-for-phpunit-data-providers-examples-csvfileiterator-php"> <div class="code-block-caption">
<span class="caption-number">Example 2.8 </span><span class="caption-text">The CsvFileIterator class</span>
</div> <div class="highlight-php">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">CsvFileIterator</span> <span class="k">implements</span> <span class="nx">Iterator</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nv">$file</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$key</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$current</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$file</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">file</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="nv">$file</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__destruct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nb">fclose</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">file</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">rewind</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nb">rewind</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">file</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">current</span> <span class="o">=</span> <span class="nb">fgetcsv</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">file</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">key</span>     <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">valid</span><span class="p">()</span><span class="o">:</span> <span class="nx">bool</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="o">!</span><span class="nb">feof</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">file</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">key</span><span class="p">()</span><span class="o">:</span> <span class="nx">int</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">key</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">current</span><span class="p">()</span><span class="o">:</span> <span class="k">array</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">current</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">next</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">current</span> <span class="o">=</span> <span class="nb">fgetcsv</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">file</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">key</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> <p>When a test receives input from both a <code class="docutils literal"><span class="pre">@dataProvider</span></code> method and from one or more tests it <code class="docutils literal"><span class="pre">@depends</span></code> on, the arguments from the data provider will come before the ones from depended-upon tests. The arguments from depended-upon tests will be the same for each data set. See <a class="reference internal" href="#writing-tests-for-phpunit-data-providers-examples-dependencyanddataprovidercombo-php"><span class="std std-numref">Example 2.9</span></a></p> <div class="literal-block-wrapper docutils container" id="writing-tests-for-phpunit-data-providers-examples-dependencyanddataprovidercombo-php"> <div class="code-block-caption">
<span class="caption-number">Example 2.9 </span><span class="caption-text">Combination of @depends and @dataProvider in same test</span>
</div> <div class="highlight-php">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">DependencyAndDataProviderComboTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">provider</span><span class="p">()</span><span class="o">:</span> <span class="k">array</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[[</span><span class="s1">'provider1'</span><span class="p">],</span> <span class="p">[</span><span class="s1">'provider2'</span><span class="p">]];</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testProducerFirst</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>

        <span class="k">return</span> <span class="s1">'first'</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testProducerSecond</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>

        <span class="k">return</span> <span class="s1">'second'</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @depends testProducerFirst</span>
<span class="sd">     * @depends testProducerSecond</span>
<span class="sd">     * @dataProvider provider</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testConsumer</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span>
            <span class="p">[</span><span class="s1">'provider1'</span><span class="p">,</span> <span class="s1">'first'</span><span class="p">,</span> <span class="s1">'second'</span><span class="p">],</span>
            <span class="nb">func_get_args</span><span class="p">()</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> <pre class="highlight" data-language="php">
$ phpunit --verbose DependencyAndDataProviderComboTest
PHPUnit 9.5.0 by Sebastian Bergmann and contributors.

...F

Time: 0 seconds, Memory: 3.50Mb

There was 1 failure:

1) DependencyAndDataProviderComboTest::testConsumer with data set #1 ('provider2')
Failed asserting that two arrays are identical.
--- Expected
+++ Actual
@@ @@
Array &amp;0 (
-    0 =&gt; 'provider1'
+    0 =&gt; 'provider2'
     1 =&gt; 'first'
     2 =&gt; 'second'
)
/home/sb/DependencyAndDataProviderComboTest.php:32

FAILURES!
Tests: 4, Assertions: 4, Failures: 1.
</pre> <div class="literal-block-wrapper docutils container" id="writing-tests-for-phpunit-data-providers-examples2-datatest-php"> <div class="code-block-caption">
<span class="caption-number">Example 2.10 </span><span class="caption-text">Using multiple data providers for a single test</span>
</div> <div class="highlight-php">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">DataTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @dataProvider additionWithNonNegativeNumbersProvider</span>
<span class="sd">     * @dataProvider additionWithNegativeNumbersProvider</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testAdd</span><span class="p">(</span><span class="nx">int</span> <span class="nv">$a</span><span class="p">,</span> <span class="nx">int</span> <span class="nv">$b</span><span class="p">,</span> <span class="nx">int</span> <span class="nv">$expected</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="nv">$expected</span><span class="p">,</span> <span class="nv">$a</span> <span class="o">+</span> <span class="nv">$b</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">additionWithNonNegativeNumbersProvider</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
        <span class="p">];</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">additionWithNegativeNumbersProvider</span><span class="p">()</span><span class="o">:</span> <span class="k">array</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="p">];</span>
    <span class="p">}</span>
 <span class="p">}</span>
</pre></div> </div> </div> <pre class="highlight" data-language="php">
$ phpunit DataTest
PHPUnit 9.5.0 by Sebastian Bergmann and contributors.

..F...                                                              6 / 6 (100%)

Time: 0 seconds, Memory: 5.75Mb

There was 1 failure:

1) DataTest::testAdd with data set #3 (1, 1, 3)
Failed asserting that 2 is identical to 3.

/home/sb/DataTest.php:12

FAILURES!
Tests: 6, Assertions: 6, Failures: 1.
</pre> <div class="admonition-note admonition"> <p class="first admonition-title">Note</p> <p class="last">When a test depends on a test that uses data providers, the depending test will be executed when the test it depends upon is successful for at least one data set. The result of a test that uses data providers cannot be injected into a depending test.</p> </div> <div class="admonition-note admonition"> <p class="first admonition-title">Note</p> <p class="last">All data providers are executed before both the call to the <code class="docutils literal"><span class="pre">setUpBeforeClass()</span></code> static method and the first call to the <code class="docutils literal"><span class="pre">setUp()</span></code> method. Because of that you can’t access any variables you create there from within a data provider. This is required in order for PHPUnit to be able to compute the total number of tests.</p> </div> </div> <div class="section" id="testing-exceptions"> <h2>Testing Exceptions</h2> <p><a class="reference internal" href="#writing-tests-for-phpunit-exceptions-examples-exceptiontest-php"><span class="std std-numref">Example 2.11</span></a> shows how to use the <code class="docutils literal"><span class="pre">expectException()</span></code> method to test whether an exception is thrown by the code under test.</p> <div class="literal-block-wrapper docutils container" id="writing-tests-for-phpunit-exceptions-examples-exceptiontest-php"> <div class="code-block-caption">
<span class="caption-number">Example 2.11 </span><span class="caption-text">Using the expectException() method</span>
</div> <div class="highlight-php">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">ExceptionTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testException</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">expectException</span><span class="p">(</span><span class="nx">InvalidArgumentException</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> <pre class="highlight" data-language="php">
$ phpunit ExceptionTest
PHPUnit 9.5.0 by Sebastian Bergmann and contributors.

F

Time: 0 seconds, Memory: 4.75Mb

There was 1 failure:

1) ExceptionTest::testException
Failed asserting that exception of type "InvalidArgumentException" is thrown.

FAILURES!
Tests: 1, Assertions: 1, Failures: 1.
</pre> <p>In addition to the <code class="docutils literal"><span class="pre">expectException()</span></code> method the <code class="docutils literal"><span class="pre">expectExceptionCode()</span></code>, <code class="docutils literal"><span class="pre">expectExceptionMessage()</span></code>, and <code class="docutils literal"><span class="pre">expectExceptionMessageMatches()</span></code> methods exist to set up expectations for exceptions raised by the code under test.</p> <div class="admonition-note admonition"> <p class="first admonition-title">Note</p> <p class="last">Note that <code class="docutils literal"><span class="pre">expectExceptionMessage()</span></code> asserts that the <code class="docutils literal"><span class="pre">$actual</span></code> message contains the <code class="docutils literal"><span class="pre">$expected</span></code> message and does not perform an exact string comparison.</p> </div> </div> <div class="section" id="testing-php-errors-warnings-and-notices"> <h2>Testing PHP Errors, Warnings, and Notices</h2> <p>By default, PHPUnit converts PHP errors, warnings, and notices that are triggered during the execution of a test to an exception. Among other benefits, this makes it possible to expect that a PHP error, warning, or notice is triggered in a test as shown in <a class="reference internal" href="#writing-tests-for-phpunit-exceptions-examples-errortest-php"><span class="std std-numref">Example 2.12</span></a>.</p> <div class="admonition-note admonition"> <p class="first admonition-title">Note</p> <p class="last">PHP’s <code class="docutils literal"><span class="pre">error_reporting</span></code> runtime configuration can limit which errors PHPUnit will convert to exceptions. If you are having issues with this feature, be sure PHP is not configured to suppress the type of error you are interested in.</p> </div> <div class="literal-block-wrapper docutils container" id="writing-tests-for-phpunit-exceptions-examples-errortest-php"> <div class="code-block-caption">
<span class="caption-number">Example 2.12 </span><span class="caption-text">Expecting PHP errors, warnings, and notices</span>
</div> <div class="highlight-php">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">ErrorTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testDeprecationCanBeExpected</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">expectDeprecation</span><span class="p">();</span>

        <span class="c1">// Optionally test that the message is equal to a string</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">expectDeprecationMessage</span><span class="p">(</span><span class="s1">'foo'</span><span class="p">);</span>

        <span class="c1">// Or optionally test that the message matches a regular expression</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">expectDeprecationMessageMatches</span><span class="p">(</span><span class="s1">'/foo/'</span><span class="p">);</span>

        <span class="nx">\trigger_error</span><span class="p">(</span><span class="s1">'foo'</span><span class="p">,</span> <span class="nx">\E_USER_DEPRECATED</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testNoticeCanBeExpected</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">expectNotice</span><span class="p">();</span>

        <span class="c1">// Optionally test that the message is equal to a string</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">expectNoticeMessage</span><span class="p">(</span><span class="s1">'foo'</span><span class="p">);</span>

        <span class="c1">// Or optionally test that the message matches a regular expression</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">expectNoticeMessageMatches</span><span class="p">(</span><span class="s1">'/foo/'</span><span class="p">);</span>

        <span class="nx">\trigger_error</span><span class="p">(</span><span class="s1">'foo'</span><span class="p">,</span> <span class="nx">\E_USER_NOTICE</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testWarningCanBeExpected</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">expectWarning</span><span class="p">();</span>

        <span class="c1">// Optionally test that the message is equal to a string</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">expectWarningMessage</span><span class="p">(</span><span class="s1">'foo'</span><span class="p">);</span>

        <span class="c1">// Or optionally test that the message matches a regular expression</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">expectWarningMessageMatches</span><span class="p">(</span><span class="s1">'/foo/'</span><span class="p">);</span>

        <span class="nx">\trigger_error</span><span class="p">(</span><span class="s1">'foo'</span><span class="p">,</span> <span class="nx">\E_USER_WARNING</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testErrorCanBeExpected</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">expectError</span><span class="p">();</span>

        <span class="c1">// Optionally test that the message is equal to a string</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">expectErrorMessage</span><span class="p">(</span><span class="s1">'foo'</span><span class="p">);</span>

        <span class="c1">// Or optionally test that the message matches a regular expression</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">expectErrorMessageMatches</span><span class="p">(</span><span class="s1">'/foo/'</span><span class="p">);</span>

        <span class="nx">\trigger_error</span><span class="p">(</span><span class="s1">'foo'</span><span class="p">,</span> <span class="nx">\E_USER_ERROR</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> <p>When testing code that uses PHP built-in functions such as <code class="docutils literal"><span class="pre">fopen()</span></code> that may trigger errors it can sometimes be useful to use error suppression while testing. This allows you to check the return values by suppressing notices that would lead to an exception raised by PHPUnit’s error handler.</p> <div class="literal-block-wrapper docutils container" id="writing-tests-for-phpunit-exceptions-examples-triggererrorreturnvalue-php"> <div class="code-block-caption">
<span class="caption-number">Example 2.13 </span><span class="caption-text">Testing return values of code that uses PHP Errors</span>
</div> <div class="highlight-php">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">ErrorSuppressionTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFileWriting</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$writer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FileWriter</span><span class="p">;</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertFalse</span><span class="p">(</span><span class="o">@</span><span class="nv">$writer</span><span class="o">-&gt;</span><span class="na">write</span><span class="p">(</span><span class="s1">'/is-not-writeable/file'</span><span class="p">,</span> <span class="s1">'stuff'</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">FileWriter</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">write</span><span class="p">(</span><span class="nv">$file</span><span class="p">,</span> <span class="nv">$content</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$file</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="nv">$file</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$file</span> <span class="o">===</span> <span class="k">false</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// ...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> <pre class="highlight" data-language="php">
$ phpunit ErrorSuppressionTest
PHPUnit 9.5.0 by Sebastian Bergmann and contributors.

.

Time: 1 seconds, Memory: 5.25Mb

OK (1 test, 1 assertion)
</pre> <p>Without the error suppression the test would fail reporting <code class="docutils literal"><span class="pre">fopen(/is-not-writeable/file):</span> <span class="pre">failed</span> <span class="pre">to</span> <span class="pre">open</span> <span class="pre">stream:</span> <span class="pre">No</span> <span class="pre">such</span> <span class="pre">file</span> <span class="pre">or</span> <span class="pre">directory</span></code>.</p> </div> <div class="section" id="testing-output"> <h2>Testing Output</h2> <p>Sometimes you want to assert that the execution of a method, for instance, generates an expected output (via <code class="docutils literal"><span class="pre">echo</span></code> or <code class="docutils literal"><span class="pre">print</span></code>, for example). The <code class="docutils literal"><span class="pre">PHPUnit\Framework\TestCase</span></code> class uses PHP’s <a class="reference external" href="http://www.php.net/manual/en/ref.outcontrol.php">Output Buffering</a> feature to provide the functionality that is necessary for this.</p> <p><a class="reference internal" href="#writing-tests-for-phpunit-output-examples-outputtest-php"><span class="std std-numref">Example 2.14</span></a> shows how to use the <code class="docutils literal"><span class="pre">expectOutputString()</span></code> method to set the expected output. If this expected output is not generated, the test will be counted as a failure.</p> <div class="literal-block-wrapper docutils container" id="writing-tests-for-phpunit-output-examples-outputtest-php"> <div class="code-block-caption">
<span class="caption-number">Example 2.14 </span><span class="caption-text">Testing the output of a function or method</span>
</div> <div class="highlight-php">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">OutputTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testExpectFooActualFoo</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">expectOutputString</span><span class="p">(</span><span class="s1">'foo'</span><span class="p">);</span>

        <span class="k">print</span> <span class="s1">'foo'</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testExpectBarActualBaz</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">expectOutputString</span><span class="p">(</span><span class="s1">'bar'</span><span class="p">);</span>

        <span class="k">print</span> <span class="s1">'baz'</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> <pre class="highlight" data-language="php">
$ phpunit OutputTest
PHPUnit 9.5.0 by Sebastian Bergmann and contributors.

.F

Time: 0 seconds, Memory: 5.75Mb

There was 1 failure:

1) OutputTest::testExpectBarActualBaz
Failed asserting that two strings are equal.
--- Expected
+++ Actual
@@ @@
-'bar'
+'baz'

FAILURES!
Tests: 2, Assertions: 2, Failures: 1.
</pre> <p><a class="reference internal" href="#writing-tests-for-phpunit-output-tables-api"><span class="std std-numref">Table 2.1</span></a> shows the methods provided for testing output</p> <table border="1" class="table docutils" id="writing-tests-for-phpunit-output-tables-api"> <caption>
<span class="caption-number">Table 2.1 </span><span class="caption-text">Methods for testing output</span>
</caption> <colgroup> <col width="50%"> <col width="50%"> </colgroup> <thead valign="bottom"> <tr class="row-odd">
<th class="head">Method</th> <th class="head">Meaning</th> </tr> </thead> <tbody valign="top"> <tr class="row-even">
<td><code class="docutils literal"><span class="pre">void</span> <span class="pre">expectOutputRegex(string</span> <span class="pre">$regularExpression)</span></code></td> <td>Set up the expectation that the output matches a <code class="docutils literal"><span class="pre">$regularExpression</span></code>.</td> </tr> <tr class="row-odd">
<td><code class="docutils literal"><span class="pre">void</span> <span class="pre">expectOutputString(string</span> <span class="pre">$expectedString)</span></code></td> <td>Set up the expectation that the output is equal to an <code class="docutils literal"><span class="pre">$expectedString</span></code>.</td> </tr> <tr class="row-even">
<td><code class="docutils literal"><span class="pre">bool</span> <span class="pre">setOutputCallback(callable</span> <span class="pre">$callback)</span></code></td> <td>Sets up a callback that is used to, for instance, normalize the actual output.</td> </tr> <tr class="row-odd">
<td><code class="docutils literal"><span class="pre">string</span> <span class="pre">getActualOutput()</span></code></td> <td>Get the actual output.</td> </tr> </tbody> </table> <div class="admonition-note admonition"> <p class="first admonition-title">Note</p> <p class="last">A test that emits output will fail in strict mode.</p> </div> </div> <div class="section" id="error-output"> <h2>Error output</h2> <p>Whenever a test fails PHPUnit tries its best to provide you with as much context as possible that can help to identify the problem.</p> <div class="literal-block-wrapper docutils container" id="writing-tests-for-phpunit-error-output-examples-arraydifftest-php"> <div class="code-block-caption">
<span class="caption-number">Example 2.15 </span><span class="caption-text">Error output generated when an array comparison fails</span>
</div> <div class="highlight-php">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">ArrayDiffTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testEquality</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> <pre class="highlight" data-language="php">
$ phpunit ArrayDiffTest
PHPUnit 9.5.0 by Sebastian Bergmann and contributors.

F

Time: 0 seconds, Memory: 5.25Mb

There was 1 failure:

1) ArrayDiffTest::testEquality
Failed asserting that two arrays are identical.
--- Expected
+++ Actual
@@ @@
 Array (
     0 =&gt; 1
     1 =&gt; 2
-    2 =&gt; 3
+    2 =&gt; 33
     3 =&gt; 4
     4 =&gt; 5
     5 =&gt; 6
 )

/home/sb/ArrayDiffTest.php:7

FAILURES!
Tests: 1, Assertions: 1, Failures: 1.
</pre> <p>In this example only one of the array values differs and the other values are shown to provide context on where the error occurred.</p> <p>When the generated output would be long to read PHPUnit will split it up and provide a few lines of context around every difference.</p> <div class="literal-block-wrapper docutils container" id="writing-tests-for-phpunit-error-output-examples-longarraydifftest-php"> <div class="code-block-caption">
<span class="caption-number">Example 2.16 </span><span class="caption-text">Error output when an array comparison of an long array fails</span>
</div> <div class="highlight-php">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">LongArrayDiffTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testEquality</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> <pre class="highlight" data-language="php">
$ phpunit LongArrayDiffTest
PHPUnit 9.5.0 by Sebastian Bergmann and contributors.

F

Time: 0 seconds, Memory: 5.25Mb

There was 1 failure:

1) LongArrayDiffTest::testEquality
Failed asserting that two arrays are identical.
--- Expected
+++ Actual
@@ @@
     11 =&gt; 0
     12 =&gt; 1
     13 =&gt; 2
-    14 =&gt; 3
+    14 =&gt; 33
     15 =&gt; 4
     16 =&gt; 5
     17 =&gt; 6
 )

/home/sb/LongArrayDiffTest.php:7

FAILURES!
Tests: 1, Assertions: 1, Failures: 1.
</pre> <div class="section" id="edge-cases"> <h3>Edge Cases</h3> <p>When a comparison fails PHPUnit creates textual representations of the input values and compares those. Due to that implementation a diff might show more problems than actually exist.</p> <p>This only happens when using <code class="docutils literal"><span class="pre">assertEquals()</span></code> or other ‘weak’ comparison functions on arrays or objects.</p> <div class="literal-block-wrapper docutils container" id="writing-tests-for-phpunit-error-output-edge-cases-examples-arrayweakcomparisontest-php"> <div class="code-block-caption">
<span class="caption-number">Example 2.17 </span><span class="caption-text">Edge case in the diff generation when using weak comparison</span>
</div> <div class="highlight-php">
<div class="highlight"><pre class="highlight" data-language="php"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">ArrayWeakComparisonTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testEquality</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">'1'</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div> </div> </div> <pre class="highlight" data-language="php">
$ phpunit ArrayWeakComparisonTest
PHPUnit 9.5.0 by Sebastian Bergmann and contributors.

F

Time: 0 seconds, Memory: 5.25Mb

There was 1 failure:

1) ArrayWeakComparisonTest::testEquality
Failed asserting that two arrays are equal.
--- Expected
+++ Actual
@@ @@
 Array (
-    0 =&gt; 1
+    0 =&gt; '1'
     1 =&gt; 2
-    2 =&gt; 3
+    2 =&gt; 33
     3 =&gt; 4
     4 =&gt; 5
     5 =&gt; 6
 )

/home/sb/ArrayWeakComparisonTest.php:7

FAILURES!
Tests: 1, Assertions: 1, Failures: 1.
</pre> <p>In this example the difference in the first index between <code class="docutils literal"><span class="pre">1</span></code> and <code class="docutils literal"><span class="pre">'1'</span></code> is reported even though <code class="docutils literal"><span class="pre">assertEquals()</span></code> considers the values as a match.</p> </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2005&ndash;2020 Sebastian Bergmann<br>Licensed under the Creative Commons Attribution 3.0 Unported License.<br>
    <a href="https://phpunit.readthedocs.io/en/9.5/writing-tests-for-phpunit.html" class="_attribution-link">https://phpunit.readthedocs.io/en/9.5/writing-tests-for-phpunit.html</a>
  </p>
</div>
