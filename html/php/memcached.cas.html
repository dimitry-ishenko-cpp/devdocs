  <div id="layout"> <div id="layout-content"><div id="memcached.cas" class="refentry"> <div class="refnamediv"> <h1 class="refname">Memcached::cas</h1> <p class="verinfo">(PECL memcached &gt;= 0.1.0)</p>
<p class="refpurpose"><span class="refname">Memcached::cas</span> â€” <span class="dc-title">Compare and swap an item</span></p> </div> <div class="refsect1 description" id="refsect1-memcached.cas-description"> <h3 class="title">Description</h3> <pre class="methodsynopsis dc-description" data-language="php">public Memcached::cas(
 string|int|float $cas_token,
 string $key,
 mixed $value,
 int $expiration = 0
): bool</pre> <p class="para rdfs-comment"> <span class="function"><strong>Memcached::cas()</strong></span> performs a "check and set" operation, so that the item will be stored only if no other client has updated it since it was last fetched by this client. The check is done via the <code class="parameter">cas_token</code> parameter which is a unique 64-bit value assigned to the existing item by memcache. See the documentation for <span class="methodname"><strong>Memcached::get*()</strong></span> methods for how to obtain this token. Note that the token is represented as a float due to the limitations of PHP's integer space. </p> </div> <div class="refsect1 parameters" id="refsect1-memcached.cas-parameters"> <h3 class="title">Parameters</h3> 
<dl> <dt> <code class="parameter">cas_token</code>
</dt> <dd> <p class="para"> Unique value associated with the existing item. Generated by memcache. </p> </dd> <dt> <code class="parameter">key</code>
</dt> <dd> <p class="para"> The key under which to store the value. </p> </dd> <dt> <code class="parameter">value</code>
</dt> <dd> <p class="para"> The value to store. </p> </dd> <dt> <code class="parameter">expiration</code>
</dt> <dd> <p class="para"> The expiration time, defaults to 0. See <a href="https://www.php.net/manual/en/memcached.expiration.php" class="link">Expiration Times</a> for more info. </p> </dd> </dl> </div> <div class="refsect1 returnvalues" id="refsect1-memcached.cas-returnvalues"> <h3 class="title">Return Values</h3> <p class="para"> Returns <strong><code>true</code></strong> on success or <strong><code>false</code></strong> on failure. The <span class="methodname"><a href="memcached.getresultcode.html" class="methodname">Memcached::getResultCode()</a></span> will return <strong><code>Memcached::RES_DATA_EXISTS</code></strong> if the item you are trying to store has been modified since you last fetched it. </p> </div> <div class="refsect1 examples" id="refsect1-memcached.cas-examples"> <h3 class="title">Examples</h3> 
<div class="example" id=""> <p><strong>Example #1 <span class="function"><strong>Memcached::cas()</strong></span> example</strong></p> <div class="example-contents"> <pre class="phpcode" data-language="php">&lt;?php
$m = new Memcached();
$m-&gt;addServer('localhost', 11211);

do {
    /* fetch IP list and its token */
    $ips = $m-&gt;get('ip_block', null, $cas);
    /* if list doesn't exist yet, create it and do
       an atomic add which will fail if someone else already added it */
    if ($m-&gt;getResultCode() == Memcached::RES_NOTFOUND) {
        $ips = array($_SERVER['REMOTE_ADDR']);
        $m-&gt;add('ip_block', $ips);
    /* otherwise, add IP to the list and store via compare-and-swap
       with the token, which will fail if someone else updated the list */
    } else { 
        $ips[] = $_SERVER['REMOTE_ADDR'];
        $m-&gt;cas($cas, 'ip_block', $ips);
    }   
} while ($m-&gt;getResultCode() != Memcached::RES_SUCCESS);

?&gt;</pre> </div> </div> </div> <div class="refsect1 seealso" id="refsect1-memcached.cas-seealso"> <h3 class="title">See Also</h3> 
<ul class="simplelist"> <li class="member"><span class="methodname"><a href="memcached.casbykey.html" class="methodname" rel="rdfs-seeAlso">Memcached::casByKey()</a> - Compare and swap an item on a specific server</span></li> </ul> </div> </div></div>
</div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 1997&ndash;2023 The PHP Documentation Group<br>Licensed under the Creative Commons Attribution License v3.0 or later.<br>
    <a href="https://www.php.net/manual/en/memcached.cas.php" class="_attribution-link">https://www.php.net/manual/en/memcached.cas.php</a>
  </p>
</div>
