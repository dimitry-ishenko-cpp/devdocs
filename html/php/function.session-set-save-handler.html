  <div id="layout"> <div id="layout-content"><div id="function.session-set-save-handler" class="refentry"> <div class="refnamediv"> <h1 class="refname">session_set_save_handler</h1> <p class="verinfo">(PHP 4, PHP 5, PHP 7, PHP 8)</p>
<p class="refpurpose"><span class="refname">session_set_save_handler</span> — <span class="dc-title">Sets user-level session storage functions</span></p> </div> <div class="refsect1 description" id="refsect1-function.session-set-save-handler-description"> <h3 class="title">Description</h3> <pre class="methodsynopsis dc-description" data-language="php">session_set_save_handler(
 callable $open,
 callable $close,
 callable $read,
 callable $write,
 callable $destroy,
 callable $gc,
 callable $create_sid = ?,
 callable $validate_sid = ?,
 callable $update_timestamp = ?
): bool</pre> <p class="para rdfs-comment"> It is possible to register the following prototype: </p> <pre class="methodsynopsis dc-description" data-language="php">session_set_save_handler(object $sessionhandler, bool $register_shutdown = true): bool</pre> <p class="para rdfs-comment"> <span class="function"><strong>session_set_save_handler()</strong></span> sets the user-level session storage functions which are used for storing and retrieving data associated with a session. This is most useful when a storage method other than those supplied by PHP sessions is preferred, e.g. storing the session data in a local database. </p> </div> <div class="refsect1 parameters" id="refsect1-function.session-set-save-handler-parameters"> <h3 class="title">Parameters</h3> <p class="para"> This function has two prototypes. </p>
<dl> <dt> <code class="parameter">sessionhandler</code>
</dt> <dd> <p class="para"> An instance of a class implementing <span class="interfacename"><a href="class.sessionhandlerinterface.html" class="interfacename">SessionHandlerInterface</a></span>, and optionally <span class="interfacename"><a href="class.sessionidinterface.html" class="interfacename">SessionIdInterface</a></span> and/or <span class="interfacename"><a href="class.sessionupdatetimestamphandlerinterface.html" class="interfacename">SessionUpdateTimestampHandlerInterface</a></span>, such as <span class="classname"><a href="class.sessionhandler.html" class="classname">SessionHandler</a></span>, to register as the session handler. </p> </dd> <dt> <code class="parameter">register_shutdown</code>
</dt> <dd> <p class="para"> Register <span class="function"><a href="function.session-write-close.html" class="function">session_write_close()</a></span> as a <span class="function"><a href="function.register-shutdown-function.html" class="function">register_shutdown_function()</a></span> function. </p> </dd> </dl> or <dl> <dt> <code class="parameter">open</code>
</dt> <dd> <p class="para"> A callable with the following signature: </p>
<pre class="methodsynopsis dc-description" data-language="php">open(string $savePath, string $sessionName): bool</pre> <p class="para"> The open callback works like a constructor in classes and is executed when the session is being opened. It is the first callback function executed when the session is started automatically or manually with <span class="function"><a href="function.session-start.html" class="function">session_start()</a></span>. Return value is <strong><code>true</code></strong> for success, <strong><code>false</code></strong> for failure. </p> </dd> <dt> <code class="parameter">close</code>
</dt> <dd> <p class="para"> A callable with the following signature: </p>
<pre class="methodsynopsis dc-description" data-language="php">close(): bool</pre> <p class="para"> The close callback works like a destructor in classes and is executed after the session write callback has been called. It is also invoked when <span class="function"><a href="function.session-write-close.html" class="function">session_write_close()</a></span> is called. Return value should be <strong><code>true</code></strong> for success, <strong><code>false</code></strong> for failure. </p> </dd> <dt> <code class="parameter">read</code>
</dt> <dd> <p class="para"> A callable with the following signature: </p>
<pre class="methodsynopsis dc-description" data-language="php">read(string $sessionId): string</pre> <p class="para"> The <code class="parameter">read</code> callback must always return a session encoded (serialized) string, or an empty string if there is no data to read. </p> <p class="para"> This callback is called internally by PHP when the session starts or when <span class="function"><a href="function.session-start.html" class="function">session_start()</a></span> is called. Before this callback is invoked PHP will invoke the <code class="parameter">open</code> callback. </p> <p class="para"> The value this callback returns must be in exactly the same serialized format that was originally passed for storage to the <code class="parameter">write</code> callback. The value returned will be unserialized automatically by PHP and used to populate the <var class="varname"><a href="reserved.variables.session.html" class="classname">$_SESSION</a></var> superglobal. While the data looks similar to <span class="function"><a href="function.serialize.html" class="function">serialize()</a></span> please note it is a different format which is specified in the <a href="https://www.php.net/manual/en/session.configuration.php#ini.session.serialize-handler" class="link">session.serialize_handler</a> ini setting. </p> </dd> <dt> <code class="parameter">write</code>
</dt> <dd> <p class="para"> A callable with the following signature: </p>
<pre class="methodsynopsis dc-description" data-language="php">write(string $sessionId, string $data): bool</pre> <p class="para"> The <code class="parameter">write</code> callback is called when the session needs to be saved and closed. This callback receives the current session ID a serialized version the <var class="varname"><a href="reserved.variables.session.html" class="classname">$_SESSION</a></var> superglobal. The serialization method used internally by PHP is specified in the <a href="https://www.php.net/manual/en/session.configuration.php#ini.session.serialize-handler" class="link">session.serialize_handler</a> ini setting. </p> <p class="para"> The serialized session data passed to this callback should be stored against the passed session ID. When retrieving this data, the <code class="parameter">read</code> callback must return the exact value that was originally passed to the <code class="parameter">write</code> callback. </p> <p class="para"> This callback is invoked when PHP shuts down or explicitly when <span class="function"><a href="function.session-write-close.html" class="function">session_write_close()</a></span> is called. Note that after executing this function PHP will internally execute the <code class="parameter">close</code> callback. </p>
<blockquote class="note">
<p><strong class="note">Note</strong>: </p>
<p class="para"> The "write" handler is not executed until after the output stream is closed. Thus, output from debugging statements in the "write" handler will never be seen in the browser. If debugging output is necessary, it is suggested that the debug output be written to a file instead. </p> </blockquote> </dd> <dt> <code class="parameter">destroy</code>
</dt> <dd> <p class="para"> A callable with the following signature: </p>
<pre class="methodsynopsis dc-description" data-language="php">destroy(string $sessionId): bool</pre> <p class="para"> This callback is executed when a session is destroyed with <span class="function"><a href="function.session-destroy.html" class="function">session_destroy()</a></span> or with <span class="function"><a href="function.session-regenerate-id.html" class="function">session_regenerate_id()</a></span> with the destroy parameter set to <strong><code>true</code></strong>. Return value should be <strong><code>true</code></strong> for success, <strong><code>false</code></strong> for failure. </p> </dd> <dt> <code class="parameter">gc</code>
</dt> <dd> <p class="para"> A callable with the following signature: </p>
<pre class="methodsynopsis dc-description" data-language="php">gc(int $lifetime): bool</pre> <p class="para"> The garbage collector callback is invoked internally by PHP periodically in order to purge old session data. The frequency is controlled by <a href="https://www.php.net/manual/en/session.configuration.php#ini.session.gc-probability" class="link">session.gc_probability</a> and <a href="https://www.php.net/manual/en/session.configuration.php#ini.session.gc-divisor" class="link">session.gc_divisor</a>. The value of lifetime which is passed to this callback can be set in <a href="https://www.php.net/manual/en/session.configuration.php#ini.session.gc-maxlifetime" class="link">session.gc_maxlifetime</a>. Return value should be <strong><code>true</code></strong> for success, <strong><code>false</code></strong> for failure. </p> </dd> <dt> <code class="parameter">create_sid</code>
</dt> <dd> <p class="para"> A callable with the following signature: </p>
<pre class="methodsynopsis dc-description" data-language="php">create_sid(): string</pre> <p class="para"> This callback is executed when a new session ID is required. No parameters are provided, and the return value should be a string that is a valid session ID for your handler. </p> </dd> <dt> <code class="parameter">validate_sid</code>
</dt> <dd> <p class="para"> A callable with the following signature: </p>
<pre class="methodsynopsis dc-description" data-language="php">validate_sid(string $key): bool</pre> <p class="para"> This callback is executed when a session is to be started, a session ID is supplied and <a href="https://www.php.net/manual/en/session.configuration.php#ini.session.use-strict-mode" class="link">session.use_strict_mode</a> is enabled. The <code class="parameter">key</code> is the session ID to validate. A session ID is valid, if a session with that ID already exists. The return value should be <strong><code>true</code></strong> for success, <strong><code>false</code></strong> for failure. </p> </dd> <dt> <code class="parameter">update_timestamp</code>
</dt> <dd> <p class="para"> A callable with the following signature: </p>
<pre class="methodsynopsis dc-description" data-language="php">update_timestamp(string $key, string $val): bool</pre> <p class="para"> This callback is executed when a session is updated. <code class="parameter">key</code> is the session ID, <code class="parameter">val</code> is the session data. The return value should be <strong><code>true</code></strong> for success, <strong><code>false</code></strong> for failure. </p> </dd> </dl> </div> <div class="refsect1 returnvalues" id="refsect1-function.session-set-save-handler-returnvalues"> <h3 class="title">Return Values</h3> <p class="para"> Returns <strong><code>true</code></strong> on success or <strong><code>false</code></strong> on failure. </p> </div> <div class="refsect1 examples" id="refsect1-function.session-set-save-handler-examples"> <h3 class="title">Examples</h3> 
<div class="example" id=""> <p><strong>Example #1 Custom session handler: see full code in <span class="classname"><a href="class.sessionhandlerinterface.html" class="classname">SessionHandlerInterface</a></span> synopsis. </strong></p> <div class="example-contents"><p> We just show the invocation here, the full example can be seen in the <span class="classname"><a href="class.sessionhandlerinterface.html" class="classname">SessionHandlerInterface</a></span> synopsis linked above. </p></div> <div class="example-contents"><p> Note we use the OOP prototype with <span class="function"><strong>session_set_save_handler()</strong></span> and register the shutdown function using the function's parameter flag. This is generally advised when registering objects as session save handlers. </p></div> <div class="example-contents"> <pre class="phpcode" data-language="php">&lt;?php
class MySessionHandler implements SessionHandlerInterface
{
    // implement interfaces here
}

$handler = new MySessionHandler();
session_set_save_handler($handler, true);
session_start();

// proceed to set and retrieve values by key from $_SESSION</pre> </div> </div> </div> <div class="refsect1 notes" id="refsect1-function.session-set-save-handler-notes"> <h3 class="title">Notes</h3> <div class="warning">
<strong class="warning">Warning</strong> <p class="para"> The <code class="parameter">write</code> and <code class="parameter">close</code> handlers are called after object destruction and therefore cannot use objects or throw exceptions. Exceptions are not able to be caught since will not be caught nor will any exception trace be displayed and the execution will just cease unexpectedly. The object destructors can however use sessions. </p> <p class="para"> It is possible to call <span class="function"><a href="function.session-write-close.html" class="function">session_write_close()</a></span> from the destructor to solve this chicken and egg problem but the most reliable way is to register the shutdown function as described above. </p> </div> <div class="warning">
<strong class="warning">Warning</strong> <p class="para"> Current working directory is changed with some SAPIs if session is closed in the script termination. It is possible to close the session earlier with <span class="function"><a href="function.session-write-close.html" class="function">session_write_close()</a></span>. </p> </div> </div> <div class="refsect1 seealso" id="refsect1-function.session-set-save-handler-seealso"> <h3 class="title">See Also</h3> 
<ul class="simplelist"> <li class="member"> The <a href="https://www.php.net/manual/en/session.configuration.php#ini.session.save-handler" class="link">session.save_handler</a> configuration directive </li> <li class="member"> The <a href="https://www.php.net/manual/en/session.configuration.php#ini.session.serialize-handler" class="link">session.serialize_handler</a> configuration directive. </li> <li class="member">The <span class="function"><a href="function.register-shutdown-function.html" class="function" rel="rdfs-seeAlso">register_shutdown_function()</a> - Register a function for execution on shutdown</span>
</li> <li class="member">The <span class="function"><a href="function.session-register-shutdown.html" class="function" rel="rdfs-seeAlso">session_register_shutdown()</a> - Session shutdown function</span>
</li> <li class="member"> Refer to <a href="https://github.com/php/php-src/blob/master/ext/session/tests/save_handler.inc" class="link external">» save_handler.inc</a> for a full procedural reference implementation </li> </ul> </div> </div></div>
</div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 1997&ndash;2023 The PHP Documentation Group<br>Licensed under the Creative Commons Attribution License v3.0 or later.<br>
    <a href="https://www.php.net/manual/en/function.session-set-save-handler.php" class="_attribution-link">https://www.php.net/manual/en/function.session-set-save-handler.php</a>
  </p>
</div>
