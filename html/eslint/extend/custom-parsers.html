<h1>Custom Parsers</h1> <nav class="docs-toc c-toc" aria-labelledby="js-toc-label"><h2 class="c-toc__label" id="js-toc-label">Table of Contents</h2> <div class="c-toc__panel" id="js-toc-panel"> <nav class="c-toc"> <ol> <li>
<a href="#creating-a-custom-parser">Creating a Custom Parser</a> <ol> <li>
<a href="#methods-in-custom-parsers">Methods in Custom Parsers</a> </li> <li>
<a href="#parse-return-object">parse Return Object</a> </li> <li>
<a href="#parseforeslint-return-object">parseForESLint Return Object</a> </li> <li>
<a href="#meta-data-in-custom-parsers">Meta Data in Custom Parsers</a> </li> </ol> </li> <li>
<a href="#ast-specification">AST Specification</a> <ol> <li>
<a href="#all-nodes">All Nodes</a> </li> <li>
<a href="#the-program-node">The Program Node</a> </li> <li>
<a href="#the-literal-node">The Literal Node</a> </li> </ol> </li> <li>
<a href="#packaging-a-custom-parser">Packaging a Custom Parser</a> </li> <li>
<a href="#example">Example</a> </li> </ol> </nav> </div></nav> <p>ESLint custom parsers let you extend ESLint to support linting new non-standard JavaScript language features or custom syntax in your code. A parser is responsible for taking your code and transforming it into an abstract syntax tree (AST) that ESLint can then analyze and lint.</p> <h2 id="creating-a-custom-parser" tabindex="-1">Creating a Custom Parser</h2> <h3 id="methods-in-custom-parsers" tabindex="-1">Methods in Custom Parsers</h3> <p>A custom parser is a JavaScript object with either a <code>parse</code> or <code>parseForESLint</code> method. The <code>parse</code> method only returns the AST, whereas <code>parseForESLint</code> also returns additional values that let the parser customize the behavior of ESLint even more.</p> <p>Both methods should take in the source code as the first argument, and an optional configuration object as the second argument, which is provided as <a href="custom-parsers../use/configure/language-options.html#specifying-parser-options"><code>parserOptions</code></a> in a configuration file.</p> <pre class="language-javascript line-numbers-mode"><code><span class="token comment">// customParser.js</span>

<span class="token keyword">const</span> espree <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"espree"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Logs the duration it takes to parse each file.</span>
<span class="token keyword">function</span> <span class="token function">parse</span><span class="token punctuation">(</span><span class="token parameter">code<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> label <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Parsing file "</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>options<span class="token punctuation">.</span>filePath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span>label<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> ast <span class="token operator">=</span> espree<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span>label<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> ast<span class="token punctuation">;</span> <span class="token comment">// Only the AST is returned.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span> parse <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="parse-return-object" tabindex="-1">
<code>parse</code> Return Object</h3> <p>The <code>parse</code> method should simply return the <a href="#ast-specification">AST</a> object.</p> <h3 id="parseforeslint-return-object" tabindex="-1">
<code>parseForESLint</code> Return Object</h3> <p>The <code>parseForESLint</code> method should return an object that contains the required property <code>ast</code> and optional properties <code>services</code>, <code>scopeManager</code>, and <code>visitorKeys</code>.</p> <ul> <li>
<code>ast</code> should contain the <a href="#ast-specification">AST</a> object.</li> <li>
<code>services</code> can contain any parser-dependent services (such as type checkers for nodes). The value of the <code>services</code> property is available to rules as <code>context.sourceCode.parserServices</code>. Default is an empty object.</li> <li>
<code>scopeManager</code> can be a <a href="custom-parsers./scope-manager-interface.html">ScopeManager</a> object. Custom parsers can use customized scope analysis for experimental/enhancement syntaxes. The default is the <code>ScopeManager</code> object which is created by <a href="https://github.com/eslint/eslint-scope">eslint-scope</a>. <ul> <li>Support for <code>scopeManager</code> was added in ESLint v4.14.0. ESLint versions that support <code>scopeManager</code> will provide an <code>eslintScopeManager: true</code> property in <code>parserOptions</code>, which can be used for feature detection.</li> </ul> </li> <li>
<code>visitorKeys</code> can be an object to customize AST traversal. The keys of the object are the type of AST nodes. Each value is an array of the property names which should be traversed. The default is <a href="https://github.com/eslint/eslint-visitor-keys#evkkeys">KEYS of <code>eslint-visitor-keys</code></a>. <ul> <li>Support for <code>visitorKeys</code> was added in ESLint v4.14.0. ESLint versions that support <code>visitorKeys</code> will provide an <code>eslintVisitorKeys: true</code> property in <code>parserOptions</code>, which can be used for feature detection.</li> </ul> </li> </ul> <h3 id="meta-data-in-custom-parsers" tabindex="-1">Meta Data in Custom Parsers</h3> <p>For easier debugging and more effective caching of custom parsers, it’s recommended to provide a name and version in a <code>meta</code> object at the root of your custom parsers, like this:</p> <pre class="language-js line-numbers-mode"><code><span class="token comment">// preferred location of name and version</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">meta</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"eslint-parser-custom"</span><span class="token punctuation">,</span>
        <span class="token literal-property property">version</span><span class="token operator">:</span> <span class="token string">"1.2.3"</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>The <code>meta.name</code> property should match the npm package name for your custom parser and the <code>meta.version</code> property should match the npm package version for your custom parser. The easiest way to accomplish this is by reading this information from your <code>package.json</code>.</p> <h2 id="ast-specification" tabindex="-1">AST Specification</h2> <p>The AST that custom parsers should create is based on <a href="https://github.com/estree/estree">ESTree</a>. The AST requires some additional properties about detail information of the source code.</p> <h3 id="all-nodes" tabindex="-1">All Nodes</h3> <p>All nodes must have <code>range</code> property.</p> <ul> <li>
<code>range</code> (<code>number[]</code>) is an array of two numbers. Both numbers are a 0-based index which is the position in the array of source code characters. The first is the start position of the node, the second is the end position of the node. <code>code.slice(node.range[0], node.range[1])</code> must be the text of the node. This range does not include spaces/parentheses which are around the node.</li> <li>
<code>loc</code> (<code>SourceLocation</code>) must not be <code>null</code>. <a href="https://github.com/estree/estree/blob/25834f7247d44d3156030f8e8a2d07644d771fdb/es5.md#node-objects">The <code>loc</code> property is defined as nullable by ESTree</a>, but ESLint requires this property. The <code>SourceLocation#source</code> property can be <code>undefined</code>. ESLint does not use the <code>SourceLocation#source</code> property.</li> </ul> <p>The <code>parent</code> property of all nodes must be rewritable. Before any rules have access to the AST, ESLint sets each node’s <code>parent</code> property to its parent node while traversing.</p> <h3 id="the-program-node" tabindex="-1">The <code>Program</code> Node</h3> <p>The <code>Program</code> node must have <code>tokens</code> and <code>comments</code> properties. Both properties are an array of the below <code>Token</code> interface.</p> <pre class="language-ts line-numbers-mode"><code><span class="token keyword">interface</span> <span class="token class-name">Token</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    loc<span class="token operator">:</span> SourceLocation<span class="token punctuation">;</span>
    <span class="token comment">// See the "All Nodes" section for details of the `range` property.</span>
    range<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token builtin">number</span><span class="token punctuation">,</span> <span class="token builtin">number</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<ul> <li>
<code>tokens</code> (<code>Token[]</code>) is the array of tokens which affect the behavior of programs. Arbitrary spaces can exist between tokens, so rules check the <code>Token#range</code> to detect spaces between tokens. This must be sorted by <code>Token#range[0]</code>.</li> <li>
<code>comments</code> (<code>Token[]</code>) is the array of comment tokens. This must be sorted by <code>Token#range[0]</code>.</li> </ul> <p>The range indexes of all tokens and comments must not overlap with the range of other tokens and comments.</p> <h3 id="the-literal-node" tabindex="-1">The <code>Literal</code> Node</h3> <p>The <code>Literal</code> node must have <code>raw</code> property.</p> <ul> <li>
<code>raw</code> (<code>string</code>) is the source code of this literal. This is the same as <code>code.slice(node.range[0], node.range[1])</code>.</li> </ul> <h2 id="packaging-a-custom-parser" tabindex="-1">Packaging a Custom Parser</h2> <p>To publish your custom parser to npm, perform the following:</p> <ol> <li>Create a custom parser following the <a href="#creating-a-custom-parser">Creating a Custom Parser</a> section above.</li> <li>
<a href="https://docs.npmjs.com/creating-node-js-modules">Create an npm package</a> for the custom parser.</li> <li>In your <code>package.json</code> file, set the <a href="https://docs.npmjs.com/cli/v9/configuring-npm/package-json#main"><code>main</code></a> field as the file that exports your custom parser.</li> <li><a href="https://docs.npmjs.com/creating-and-publishing-unscoped-public-packages">Publish the npm package.</a></li> </ol> <p>For more information on publishing an npm package, refer to the <a href="https://docs.npmjs.com/">npm documentation</a>.</p> <p>Once you’ve published the npm package, you can use it by adding the package to your project. For example:</p> <pre class="language-shell line-numbers-mode"><code><span class="token function">npm</span> <span class="token function">install</span> eslint-parser-myparser --save-dev
</code></pre>
<p>Then add the custom parser to your ESLint configuration file with the <code>parser</code> property. For example:</p> <pre class="language-js line-numbers-mode"><code><span class="token comment">// .eslintrc.js</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">parser</span><span class="token operator">:</span> <span class="token string">'eslint-parser-myparser'</span><span class="token punctuation">,</span>
  <span class="token comment">// ... rest of configuration</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>To learn more about using ESLint parsers in your project, refer to <a href="custom-parsers../use/configure/parser.html">Configure a Parser</a>.</p> <h2 id="example" tabindex="-1">Example</h2> <p>For a complex example of a custom parser, refer to the <a href="https://github.com/typescript-eslint/typescript-eslint/tree/main/packages/parser"><code>@typescript-eslint/parser</code></a> source code.</p> <p>A simple custom parser that provides a <code>context.sourceCode.parserServices.foo()</code> method to rules.</p> <pre class="language-javascript line-numbers-mode"><code><span class="token comment">// awesome-custom-parser.js</span>
<span class="token keyword">var</span> espree <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"espree"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">parseForESLint</span><span class="token punctuation">(</span><span class="token parameter">code<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">ast</span><span class="token operator">:</span> espree<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">services</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token function-variable function">foo</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"foo"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">scopeManager</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
        <span class="token literal-property property">visitorKeys</span><span class="token operator">:</span> <span class="token keyword">null</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span> parseForESLint <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>Include the custom parser in an ESLint configuration file:</p> <pre class="language-js line-numbers-mode"><code><span class="token comment">// .eslintrc.json</span>
<span class="token punctuation">{</span>
    <span class="token string-property property">"parser"</span><span class="token operator">:</span> <span class="token string">"./path/to/awesome-custom-parser.js"</span>
<span class="token punctuation">}</span>
</code></pre><div class="_attribution">
  <p class="_attribution-p">
    &copy; OpenJS Foundation and other contributors<br>Licensed under the MIT License.<br>
    <a href="https://eslint.org/docs/latest/extend/custom-parsers" class="_attribution-link">https://eslint.org/docs/latest/extend/custom-parsers</a>
  </p>
</div>
