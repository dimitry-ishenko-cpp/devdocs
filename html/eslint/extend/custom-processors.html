<h1>Custom Processors</h1> <nav class="docs-toc c-toc" aria-labelledby="js-toc-label"><h2 class="c-toc__label" id="js-toc-label">Table of Contents</h2> <div class="c-toc__panel" id="js-toc-panel"> <nav class="c-toc"> <ol> <li>
<a href="#custom-processor-specification">Custom Processor Specification</a> </li> <li>
<a href="#specifying-processor-in-config-files">Specifying Processor in Config Files</a> </li> <li>
<a href="#file-extension-named-processor">File Extension-named Processor</a> </li> </ol> </nav> </div></nav> <p>You can also create custom processors that tell ESLint how to process files other than standard JavaScript. For example, you could write a custom processor to extract and process JavaScript from Markdown files (<a href="https://www.npmjs.com/package/eslint-plugin-markdown">eslint-plugin-markdown</a> includes a custom processor for this).</p> <h2 id="custom-processor-specification" tabindex="-1">Custom Processor Specification</h2> <p>In order to create a custom processor, the object exported from your module has to conform to the following interface:</p> <pre class="language-js line-numbers-mode"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">processors</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">"processor-name"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">meta</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"eslint-processor-name"</span><span class="token punctuation">,</span>
                <span class="token literal-property property">version</span><span class="token operator">:</span> <span class="token string">"1.2.3"</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token comment">// takes text of the file and filename</span>
            <span class="token function-variable function">preprocess</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">text<span class="token punctuation">,</span> filename</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// here, you can strip out any non-JS content</span>
                <span class="token comment">// and split into multiple strings to lint</span>

                <span class="token keyword">return</span> <span class="token punctuation">[</span> <span class="token comment">// return an array of code blocks to lint</span>
                    <span class="token punctuation">{</span> <span class="token literal-property property">text</span><span class="token operator">:</span> code1<span class="token punctuation">,</span> <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">"0.js"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span> <span class="token literal-property property">text</span><span class="token operator">:</span> code2<span class="token punctuation">,</span> <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">"1.js"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>

            <span class="token comment">// takes a Message[][] and filename</span>
            <span class="token function-variable function">postprocess</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">messages<span class="token punctuation">,</span> filename</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// `messages` argument contains two-dimensional array of Message objects</span>
                <span class="token comment">// where each top-level array item contains array of lint messages related</span>
                <span class="token comment">// to the text that was returned in array from preprocess() method</span>

                <span class="token comment">// you need to return a one-dimensional array of the messages you want to keep</span>
                <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token operator">...</span>messages<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>

            <span class="token literal-property property">supportsAutofix</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// (optional, defaults to false)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p><strong>The <code>preprocess</code> method</strong> takes the file contents and filename as arguments, and returns an array of code blocks to lint. The code blocks will be linted separately but still be registered to the filename.</p> <p>A code block has two properties <code>text</code> and <code>filename</code>. The <code>text</code> property is the content of the block and the <code>filename</code> property is the name of the block. The name of the block can be anything, but should include the file extension, which tells the linter how to process the current block. The linter checks the <a href="custom-processors../use/command-line-interface.html#--ext"><code>--ext</code> CLI option</a> to see if the current block should be linted and resolves <code>overrides</code> configs to check how to process the current block.</p> <p>Itâ€™s up to the plugin to decide if it needs to return just one part of the non-JavaScript file or multiple pieces. For example in the case of processing <code>.html</code> files, you might want to return just one item in the array by combining all scripts. However, for <code>.md</code> files, you can return multiple items because each JavaScript block might be independent.</p> <p><strong>The <code>postprocess</code> method</strong> takes a two-dimensional array of arrays of lint messages and the filename. Each item in the input array corresponds to the part that was returned from the <code>preprocess</code> method. The <code>postprocess</code> method must adjust the locations of all errors to correspond to locations in the original, unprocessed code, and aggregate them into a single flat array and return it.</p> <p>Reported problems have the following location information in each lint message:</p> <pre class="language-typescript line-numbers-mode"><code><span class="token keyword">type</span> <span class="token class-name">LintMessage</span> <span class="token operator">=</span> <span class="token punctuation">{</span>

  <span class="token comment">/// The 1-based line number where the message occurs.</span>
  line<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>

   <span class="token comment">/// The 1-based column number where the message occurs.</span>
  column<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>

  <span class="token comment">/// The 1-based line number of the end location.</span>
  endLine<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>

  <span class="token comment">/// The 1-based column number of the end location.</span>
  endColumn<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>

  <span class="token comment">/// If `true`, this is a fatal error.</span>
  fatal<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>

  <span class="token comment">/// Information for an autofix.</span>
  fix<span class="token operator">:</span> Fix<span class="token punctuation">;</span>

  <span class="token comment">/// The error message.</span>
  message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>

  <span class="token comment">/// The ID of the rule which generated the message, or `null` if not applicable.</span>
  ruleId<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

  <span class="token comment">/// The severity of the message.</span>
  severity<span class="token operator">:</span> <span class="token number">0</span> <span class="token operator">|</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">2</span><span class="token punctuation">;</span>

  <span class="token comment">/// Information for suggestions.</span>
  suggestions<span class="token operator">?</span><span class="token operator">:</span> Suggestion<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">Fix</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    range<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token builtin">number</span><span class="token punctuation">,</span> <span class="token builtin">number</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    text<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> <span class="token class-name">Suggestion</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    desc<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    messageId<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    fix<span class="token operator">:</span> Fix<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre>
<p>By default, ESLint does not perform autofixes when a custom processor is used, even when the <code>--fix</code> flag is enabled on the command line. To allow ESLint to autofix code when using your processor, you should take the following additional steps:</p> <ol> <li> <p>Update the <code>postprocess</code> method to additionally transform the <code>fix</code> property of reported problems. All autofixable problems have a <code>fix</code> property, which is an object with the following schema:</p> <pre class="language-typescript line-numbers-mode"><code><span class="token punctuation">{</span>
    range<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token builtin">number</span><span class="token punctuation">,</span> <span class="token builtin">number</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    text<span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>
</code></pre>
<p>The <code>range</code> property contains two indexes in the code, referring to the start and end location of a contiguous section of text that will be replaced. The <code>text</code> property refers to the text that will replace the given range.</p> <p>In the initial list of problems, the <code>fix</code> property will refer to a fix in the processed JavaScript. The <code>postprocess</code> method should transform the object to refer to a fix in the original, unprocessed file.</p> </li> <li> <p>Add a <code>supportsAutofix: true</code> property to the processor.</p> </li> </ol> <p>You can have both rules and custom processors in a single plugin. You can also have multiple processors in one plugin. To support multiple extensions, add each one to the <code>processors</code> element and point them to the same object.</p> <p><strong>The <code>meta</code> object</strong> helps ESLint cache the processor and provide more friendly debug message. The <code>meta.name</code> property should match the processor name and the <code>meta.version</code> property should match the npm package version for your processors. The easiest way to accomplish this is by reading this information from your <code>package.json</code>.</p> <h2 id="specifying-processor-in-config-files" tabindex="-1">Specifying Processor in Config Files</h2> <p>To use a processor, add its ID to a <code>processor</code> section in the config file. Processor ID is a concatenated string of plugin name and processor name with a slash as a separator. This can also be added to a <code>overrides</code> section of the config, to specify which processors should handle which files.</p> <p>For example:</p> <pre class="language-yml line-numbers-mode"><code><span class="token key atrule">plugins</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> a<span class="token punctuation">-</span>plugin
<span class="token key atrule">overrides</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">files</span><span class="token punctuation">:</span> <span class="token string">"*.md"</span>
    <span class="token key atrule">processor</span><span class="token punctuation">:</span> a<span class="token punctuation">-</span>plugin/markdown
</code></pre>
<p>See <a href="custom-processors../use/configure/plugins.html#specify-a-processor">Specify a Processor</a> in the Plugin Configuration documentation for more details.</p> <h2 id="file-extension-named-processor" tabindex="-1">File Extension-named Processor</h2> <aside role="note" class="alert alert--warning">  <div class="alert__content"> <span class="alert__type">Warning</span> <div class="alert__text">
<p>This feature is deprecated and only works in eslintrc-style configuration files. Flat config files do not automatically apply processors; you need to explicitly set the <code>processor</code> property.</p> </div> </div> </aside><p>If a custom processor name starts with <code>.</code>, ESLint handles the processor as a <strong>file extension-named processor</strong>. ESLint applies the processor to files with that filename extension automatically. Users donâ€™t need to specify the file extension-named processors in their config files.</p> <p>For example:</p> <pre class="language-js line-numbers-mode"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">processors</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// This processor will be applied to `*.md` files automatically.</span>
        <span class="token comment">// Also, you can use this processor as "plugin-id/.md" explicitly.</span>
        <span class="token string-property property">".md"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token function">preprocess</span><span class="token punctuation">(</span><span class="token parameter">text<span class="token punctuation">,</span> filename</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token function">postprocess</span><span class="token punctuation">(</span><span class="token parameter">messageLists<span class="token punctuation">,</span> filename</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// This processor will not be applied to any files automatically.</span>
        <span class="token comment">// To use this processor, you must explicitly specify it</span>
        <span class="token comment">// in your configuration as "plugin-id/markdown".</span>
       <span class="token string-property property">"markdown"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token function">preprocess</span><span class="token punctuation">(</span><span class="token parameter">text<span class="token punctuation">,</span> filename</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token function">postprocess</span><span class="token punctuation">(</span><span class="token parameter">messageLists<span class="token punctuation">,</span> filename</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>You can also use the same custom processor with multiple filename extensions. The following example shows using the same processor for both <code>.md</code> and <code>.mdx</code> files:</p> <pre class="language-js line-numbers-mode"><code><span class="token keyword">const</span> myCustomProcessor <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">/* processor methods */</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">// The same custom processor is applied to both</span>
    <span class="token comment">// `.md` and `.mdx` files.</span>
    <span class="token literal-property property">processors</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">".md"</span><span class="token operator">:</span> myCustomProcessor<span class="token punctuation">,</span>
        <span class="token string-property property">".mdx"</span><span class="token operator">:</span> myCustomProcessor
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="_attribution">
  <p class="_attribution-p">
    &copy; OpenJS Foundation and other contributors<br>Licensed under the MIT License.<br>
    <a href="https://eslint.org/docs/latest/extend/custom-processors" class="_attribution-link">https://eslint.org/docs/latest/extend/custom-processors</a>
  </p>
</div>
