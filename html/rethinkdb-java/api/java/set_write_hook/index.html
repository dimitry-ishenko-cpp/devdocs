<h1 class="title">ReQL command: setWriteHook</h1>  <div class="alg-content">
<h2 id="command-syntax">Command syntax</h2> <pre class="command-syntax" data-language="java">table.setWriteHook(function | binary | null) → object
</pre> <h2 id="description">Description</h2> <p>Sets the write hook on a table or overwrites it if one already exists.</p> <p>The <code class="language-plaintext highlighter-rouge">function</code> can be an anonymous function with the signature <code class="language-plaintext highlighter-rouge">(context: object, oldVal: object, newVal: object) -&gt; object</code> or a binary representation obtained from the <code class="language-plaintext highlighter-rouge">function</code> field of <a href="../get_write_hook/index.html">getWriteHook</a>. The function must be deterministic, and so cannot use a subquery or the <code class="language-plaintext highlighter-rouge">r.js</code> command.</p> <p>The first argument, <code class="language-plaintext highlighter-rouge">context</code>, is a ReQL object containing the following properties:</p> <ul> <li>
<code class="language-plaintext highlighter-rouge">primary_key</code>: primary key of the document being deleted, inserted, or modified</li> <li>
<code class="language-plaintext highlighter-rouge">timestamp</code>: a ReQL <code class="language-plaintext highlighter-rouge">time</code> object representing the current query execution time</li> </ul> <blockquote class="infobox ">
<p>As is the case when creating secondary index functions using <a href="../index_create/index.html">indexCreate</a>, <code class="language-plaintext highlighter-rouge">r.now()</code> is considered non-deterministic and is thus not allowed in the context of write hooks. If you need to reference the current timestamp, <code class="language-plaintext highlighter-rouge">context.g("timestamp")</code> should be used instead.</p> </blockquote> <p>Whenever a write operation on the table inserts, deletes or modifies a given document, the write hook function will be called with the context parameter, the old value of the document (or <code class="language-plaintext highlighter-rouge">null</code> on inserts) and the new value of the document (or <code class="language-plaintext highlighter-rouge">null</code> on deletes). It then returns the value that should actually be inserted and/or replaced instead of <code class="language-plaintext highlighter-rouge">newVal</code>. It can also return <code class="language-plaintext highlighter-rouge">r.error(...)</code> to abort the write.</p> <p>For simplicity, the write hook function is allowed to return <code class="language-plaintext highlighter-rouge">null</code> exactly if and only if <code class="language-plaintext highlighter-rouge">newVal</code> is <code class="language-plaintext highlighter-rouge">null</code>. This is just a safeguard to ensure you don’t accidentally turn an insert/update into a deletion, or a deletion into an update.</p> <p>If successful, <code class="language-plaintext highlighter-rouge">setWriteHook</code> returns an object of the following form:</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight" data-language="java">{
  "function": &lt;binary&gt;,
  "query": "setWriteHook(function(_var1, _var2, _var3) { return ...; })",
}
</pre></div></div> <p><strong>Example:</strong> Create a write hook that sets <code class="language-plaintext highlighter-rouge">modified_at</code> to the current time on each write operation.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight" data-language="java">r.table("comments").setWriteHook((context, oldVal, newVal) -&gt;
  newVal.merge(r.object("modified_at", context.g("timestamp")))
).run(conn);
</pre></div></div> <p><strong>Example:</strong> Delete the write hook associated with the <code class="language-plaintext highlighter-rouge">comments</code> table.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight" data-language="java">r.table("comments").setWriteHook(null).run(conn);
</pre></div></div> <p><strong>Example:</strong> Recreate an outdated write hook on a table.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight" data-language="java">r.table("posts").getWriteHook().do((writeHook) -&gt;
    r.table("posts").setWriteHook(writeHook.g("function"))
).run(conn);
</pre></div></div> </div> <section class="related-commands"> <h2>Related commands</h2> <ul> <li><a href="index.html">getWriteHook</a></li> </ul> </section><div class="_attribution">
  <p class="_attribution-p">
    &copy; RethinkDB contributors<br>Licensed under the Creative Commons Attribution-ShareAlike 3.0 Unported License.<br>
    <a href="https://rethinkdb.com/api/java/set_write_hook/" class="_attribution-link">https://rethinkdb.com/api/java/set_write_hook/</a>
  </p>
</div>
