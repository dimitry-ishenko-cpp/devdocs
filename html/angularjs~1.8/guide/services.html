<h1 id="services">
<a href="https://github.com/angular/angular.js/edit/v1.8.x/docs/content/guide/services.ngdoc?message=docs(guide%2FServices)%3A%20describe%20your%20change..." class="improve-docs btn btn-primary">Improve this Doc</a>Services</h1> <p>AngularJS services are substitutable objects that are wired together using <a href="di.html">dependency injection (DI)</a>. You can use services to organize and share code across your app.</p> <p>AngularJS services are:</p> <ul> <li>Lazily instantiated – AngularJS only instantiates a service when an application component depends on it.</li> <li>Singletons – Each component dependent on a service gets a reference to the single instance generated by the service factory.</li> </ul> <p>AngularJS offers several useful services (like <a href="../api/ng/service/%24http.html"><code>$http</code></a>), but for most applications you'll also want to <a href="services.html#creating-services.html">create your own</a>.</p> <div class="alert alert-info"> <strong>Note:</strong> Like other core AngularJS identifiers, built-in services always start with <code>$</code> (e.g. <code>$http</code>). </div> <h2 id="using-a-service">Using a Service</h2> <p>To use an AngularJS service, you add it as a dependency for the component (controller, service, filter or directive) that depends on the service. AngularJS's <a href="di.html">dependency injection</a> subsystem takes care of the rest.</p>  <h2 id="creating-services">Creating Services</h2> <p>Application developers are free to define their own services by registering the service's name and <strong>service factory function</strong>, with an AngularJS module.</p> <p>The <strong>service factory function</strong> generates the single object or function that represents the service to the rest of the application. The object or function returned by the service is injected into any component (controller, service, filter or directive) that specifies a dependency on the service.</p> <h3 id="registering-services">Registering Services</h3> <p>Services are registered to modules via the <a href="../api/ng/type/angular.module.html">Module API</a>. Typically you use the <a href="../api/ng/type/angular.module.html#factory.html">Module factory</a> API to register a service:</p> <pre data-language="javascript">var myModule = angular.module('myModule', []);
myModule.factory('serviceId', function() {
  var shinyNewServiceInstance;
  // factory function body that constructs shinyNewServiceInstance
  return shinyNewServiceInstance;
});
</pre> <p>Note that you are not registering a <strong>service instance</strong>, but rather a <strong>factory function</strong> that will create this instance when called.</p> <h3 id="dependencies">Dependencies</h3> <p>Services can have their own dependencies. Just like declaring dependencies in a controller, you declare dependencies by specifying them in the service's factory function signature.</p> <p>For more on dependencies, see the <a href="di.html">dependency injection</a> docs.</p> <p>The example module below has two services, each with various dependencies:</p> <pre data-language="javascript">var batchModule = angular.module('batchModule', []);

/**
 * The `batchLog` service allows for messages to be queued in memory and flushed
 * to the console.log every 50 seconds.
 *
 * @param {*} message Message to be logged.
 */
batchModule.factory('batchLog', ['$interval', '$log', function($interval, $log) {
  var messageQueue = [];

  function log() {
    if (messageQueue.length) {
      $log.log('batchLog messages: ', messageQueue);
      messageQueue = [];
    }
  }

  // start periodic checking
  $interval(log, 50000);

  return function(message) {
    messageQueue.push(message);
  }
}]);

/**
 * `routeTemplateMonitor` monitors each `$route` change and logs the current
 * template via the `batchLog` service.
 */
batchModule.factory('routeTemplateMonitor', ['$route', 'batchLog', '$rootScope',
  function($route, batchLog, $rootScope) {
    return {
      startMonitoring: function() {
        $rootScope.$on('$routeChangeSuccess', function() {
          batchLog($route.current ? $route.current.template : null);
        });
      }
    };
  }]);
</pre> <p>In the example, note that:</p> <ul> <li>The <code>batchLog</code> service depends on the built-in <a href="../api/ng/service/%24interval.html"><code>$interval</code></a> and <a href="../api/ng/service/%24log.html"><code>$log</code></a> services.</li> <li>The <code>routeTemplateMonitor</code> service depends on the built-in <a href="../api/ngroute/service/%24route.html"><code>$route</code></a> service and our custom <code>batchLog</code> service.</li> <li>Both services use the array notation to declare their dependencies.</li> <li>The order of identifiers in the array is the same as the order of argument names in the factory function.</li> </ul> <h3 id="registering-a-service-with-provide-">Registering a Service with $provide</h3> <p>You can also register services via the <a href="../api/auto/service/%24provide.html"><code>$provide</code></a> service inside of a module's <code>config</code> function:</p> <pre data-language="javascript">angular.module('myModule', []).config(['$provide', function($provide) {
  $provide.factory('serviceId', function() {
    var shinyNewServiceInstance;
    // factory function body that constructs shinyNewServiceInstance
    return shinyNewServiceInstance;
  });
}]);
</pre> <p>This technique is often used in unit tests to mock out a service's dependencies.</p> <h2 id="unit-testing">Unit Testing</h2> <p>The following is a unit test for the <code>notify</code> service from the <a href="services.html#creating-services.html">Creating AngularJS Services</a> example above. The unit test example uses a Jasmine spy (mock) instead of a real browser alert.</p> <pre data-language="javascript">var mock, notify;
beforeEach(module('myServiceModule'));
beforeEach(function() {
  mock = {alert: jasmine.createSpy()};

  module(function($provide) {
    $provide.value('$window', mock);
  });

  inject(function($injector) {
    notify = $injector.get('notify');
  });
});

it('should not alert first two notifications', function() {
  notify('one');
  notify('two');

  expect(mock.alert).not.toHaveBeenCalled();
});

it('should alert all after third notification', function() {
  notify('one');
  notify('two');
  notify('three');

  expect(mock.alert).toHaveBeenCalledWith("one\ntwo\nthree");
});

it('should clear messages after alert', function() {
  notify('one');
  notify('two');
  notify('third');
  notify('more');
  notify('two');
  notify('third');

  expect(mock.alert.calls.count()).toEqual(2);
  expect(mock.alert.calls.mostRecent().args).toEqual(["more\ntwo\nthird"]);
});
</pre> <h2 id="related-topics">Related Topics</h2> <ul> <li><a href="di.html">Dependency Injection in AngularJS</a></li> </ul> <h2 id="related-api">Related API</h2> <ul> <li><a href="../api/ng/service.html">AngularJS Service API</a></li> <li><a href="../api/ng/function/angular.injector.html">Injector API</a></li> </ul><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2010&ndash;2020 Google, Inc.<br>Licensed under the Creative Commons Attribution License 3.0.<br>
    <a href="https://code.angularjs.org/1.8.2/docs/guide/services" class="_attribution-link">https://code.angularjs.org/1.8.2/docs/guide/services</a>
  </p>
</div>
