<div class="container">
<main>  <h2>
<code>psum.chisq</code> Evaluate the c.d.f. of a weighted sum of chi-squared deviates</h2> <h3>Description</h3> <p> Evaluates the c.d.f. of a weighted sum of chi-squared random variables by the method of Davies (1973, 1980). That is it computes </p> <p style="text-align: center;"><code class="reqn">P(q&lt; \sum_{i=1}^r \lambda_i X_i + \sigma_z Z)</code> </p> <p> where <code class="reqn">X_j</code> is a chi-squared random variable with <code>df[j]</code> (integer) degrees of freedom and non-centrality parameter <code>nc[j]</code>, while <code class="reqn">Z</code> is a standard normal deviate. </p> <h3>Usage</h3> <pre data-language="r"><code class="language-R">psum.chisq(q,lb,df=rep(1,length(lb)),nc=rep(0,length(lb)),sigz=0,
           lower.tail=FALSE,tol=2e-5,nlim=100000,trace=FALSE)
</code></pre> <h3>Arguments</h3> <table> <tr>
<td><code id="q">q</code></td> <td> <p> is the vector of quantile values at which to evaluate.</p> </td>
</tr> <tr>
<td><code id="lb">lb</code></td> <td> <p> contains <code class="reqn">\lambda_i</code>, the weight for deviate <code>i</code>. Weights can be positive and/or negative.</p> </td>
</tr> <tr>
<td><code id="df">df</code></td> <td> <p> is the integer vector of chi-squared degrees of freedom.</p> </td>
</tr> <tr>
<td><code id="nc">nc</code></td> <td> <p> is the vector of non-centrality parameters for the chi-squared deviates.</p> </td>
</tr> <tr>
<td><code id="sigz">sigz</code></td> <td> <p> is the multiplier for the standard normal deviate. Non- positive to exclude this term. </p> </td>
</tr> <tr>
<td><code id="lower.tail">lower.tail</code></td> <td> <p> indicates whether lower of upper tail probabilities are required.</p> </td>
</tr> <tr>
<td><code id="tol">tol</code></td> <td> <p> is the numerical tolerance to work to.</p> </td>
</tr> <tr>
<td><code id="nlim">nlim</code></td> <td> <p> is the maximum number of integration steps to allow</p> </td>
</tr> <tr>
<td><code id="trace">trace</code></td> <td> <p> can be set to <code>TRUE</code> to return some trace information and a fault code as attributes.</p> </td>
</tr> </table> <h3>Details</h3> <p>This calls a C translation of the original Algol60 code from Davies (1980), which numerically inverts the characteristic function of the distribution (see Davies, 1973). Some modifications have been made to remove <code>goto</code> statements and global variables, to use a slightly more efficient sorting of <code>lb</code> and to use R functions for <code>log(1+x)</code>. In addition the integral and associated error are accumulated in single terms, rather than each being split into 2, since only their sums are ever used. If <code>q</code> is a vector then <code>psum.chisq</code> calls the algorithm separately for each <code>q[i]</code>. </p> <p>If the Davies algorithm returns an error then an attempt will be made to use the approximation of Liu et al (2009) and a warning will be issued. If that is not possible then an <code>NA</code> is returned. A warning will also be issued if the algorithm detects that round off errors may be significant. </p> <p>If <code>trace</code> is set to <code>TRUE</code> then the result will have two attributes. <code>"ifault"</code> is 0 for no problem, 1 if the desired accuracy can not be obtained, 2 if round-off error may be significant, 3 is invalid parameters have been supplied or 4 if integration parameters can not be located. <code>"trace"</code> is a 7 element vector: 1. absolute value sum; 2. total number of integration terms; 3. number of integrations; 4. integration interval in main integration; 5. truncation point in initial integration; 6. sd of convergence factor term; 7. number of cycles to locate integration parameters. See Davies (1980) for more details. Note that for vector <code>q</code> these attributes relate to the final element of <code>q</code>. </p> <h3>Author(s)</h3> <p> Simon N. Wood <a href="mailto:simon.wood@r-project.org.html">simon.wood@r-project.org</a></p> <h3>References</h3> <p>Davies, R. B. (1973). Numerical inversion of a characteristic function. Biometrika, 60(2), 415-417. </p> <p>Davies, R. B. (1980) Algorithm AS 155: The Distribution of a Linear Combination of Chi-squared Random Variables. J. R. Statist. Soc. C 29, 323-333 </p> <p>Liu, H.; Tang, Y. &amp; Zhang, H. H (2009) A new chi-square approximation to the distribution of non-negative definite quadratic forms in non-central normal variables. Computational Statistics &amp; Data Analysis 53,853-856 </p> <h3>Examples</h3> <pre data-language="r"><code class="language-R">  require(mgcv)
  lb &lt;- c(4.1,1.2,1e-3,-1) ## weights
  df &lt;- c(2,1,1,1) ## degrees of freedom
  nc &lt;- c(1,1.5,4,1) ## non-centrality parameter
  q &lt;- c(1,6,20) ## quantiles to evaluate

  psum.chisq(q,lb,df,nc)

  ## same by simulation...
  
  psc.sim &lt;- function(q,lb,df=lb*0+1,nc=df*0,ns=10000) {
    r &lt;- length(lb);p &lt;- q
    X &lt;- rowSums(rep(lb,each=ns) *
         matrix(rchisq(r*ns,rep(df,each=ns),rep(nc,each=ns)),ns,r))
    apply(matrix(q),1,function(q) mean(X&gt;q))	 
  } ## psc.sim
  
  psum.chisq(q,lb,df,nc)
  psc.sim(q,lb,df,nc,100000)
</code></pre> </main> </div><div class="_attribution">
  <p class="_attribution-p">
    Copyright (&copy;) 1999â€“2012 R Foundation for Statistical Computing.<br>Licensed under the <a href="https://www.gnu.org/copyleft/gpl.html">GNU General Public License</a>.<br>
    
  </p>
</div>
