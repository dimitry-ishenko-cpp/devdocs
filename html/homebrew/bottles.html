<h1 id="bottles-binary-packages">Bottles (Binary Packages)</h1> <p>Bottles are produced by installing a formula with <code class="language-plaintext highlighter-rouge">brew install --build-bottle &lt;formula&gt;</code> and then bottling it with <code class="language-plaintext highlighter-rouge">brew bottle &lt;formula&gt;</code>. This generates a bottle file in the current directory and outputs the bottle DSL for insertion into the formula file.</p> <h2 id="usage">Usage</h2> <p>When the formula being installed defines a bottle matching your system, it will be downloaded and installed automatically when you run <code class="language-plaintext highlighter-rouge">brew install &lt;formula&gt;</code>.</p> <p>Bottles will not be used if:</p> <ul> <li>the user requests it (by specifying <code class="language-plaintext highlighter-rouge">--build-from-source</code>),</li> <li>the formula requests it (with <code class="language-plaintext highlighter-rouge">pour_bottle?</code>),</li> <li>any options are specified during installation (bottles are all compiled with default options),</li> <li>the bottle is not up to date (e.g. missing or mismatched checksum),</li> <li>or the bottle’s <code class="language-plaintext highlighter-rouge">cellar</code> is neither <code class="language-plaintext highlighter-rouge">:any</code> (it requires being installed to a specific Cellar path) nor equal to the current <code class="language-plaintext highlighter-rouge">HOMEBREW_CELLAR</code> (the required Cellar path does not match that of the current Homebrew installation).</li> </ul> <h2 id="creation">Creation</h2> <p>Bottles for <code class="language-plaintext highlighter-rouge">homebrew/core</code> formulae are created by <a href="brew-test-bot.html">Brew Test Bot</a> when a pull request is submitted. If the formula builds successfully on each supported platform and a maintainer approves the change, Brew Test Bot updates its <code class="language-plaintext highlighter-rouge">bottle do</code> block and uploads each bottle to <a href="https://github.com/orgs/Homebrew/packages">GitHub Packages</a>.</p> <p>By default, bottles will be built for the oldest CPU supported by the OS/architecture you’re building for (Core 2 for 64-bit x86 operating systems). This ensures that bottles are compatible with all computers you might distribute them to. If you <em>really</em> want your bottles to be optimised for something else, you can pass the <code class="language-plaintext highlighter-rouge">--bottle-arch=</code> option to build for another architecture; for example, <code class="language-plaintext highlighter-rouge">brew install foo --build-bottle --bottle-arch=penryn</code>. Just remember that if you build for a newer architecture, some of your users might get binaries they can’t run and that would be sad!</p> <h2 id="format">Format</h2> <p>Bottles are simple gzipped tarballs of compiled binaries. The formula name, version, target operating system and rebuild version is stored in the filename, any other metadata is in the formula’s bottle DSL, and the formula definition is located within the bottle at <code class="language-plaintext highlighter-rouge">&lt;formula&gt;/&lt;version&gt;/.brew/&lt;formula&gt;.rb</code>.</p> <h2 id="bottle-dsl-domain-specific-language">Bottle DSL (Domain Specific Language)</h2> <p>Bottles are specified in formula definitions by a DSL contained within a <code class="language-plaintext highlighter-rouge">bottle do ... end</code> block.</p> <p>A simple (and typical) example:</p> <pre data-language="ruby">bottle do
  sha256 arm64_big_sur: "a9ae578b05c3da46cedc07dd428d94a856aeae7f3ef80a0f405bf89b8cde893a"
  sha256 big_sur:       "5dc376aa20241233b76e2ec2c1d4e862443a0250916b2838a1ff871e8a6dc2c5"
  sha256 catalina:      "924afbbc16549d8c2b80544fd03104ff8c17a4b1460238e3ed17a1313391a2af"
  sha256 mojave:        "678d338adc7d6e8c352800fe03fc56660c796bd6da23eda2b1411fed18bd0d8d"
end</pre> <p>A full example:</p> <pre data-language="ruby">bottle do
  root_url "https://example.com"
  rebuild 4
  sha256 cellar: "/opt/homebrew/Cellar", arm64_big_sur: "a9ae578b05c3da46cedc07dd428d94a856aeae7f3ef80a0f405bf89b8cde893a"
  sha256 cellar: :any,                   big_sur:       "5dc376aa20241233b76e2ec2c1d4e862443a0250916b2838a1ff871e8a6dc2c5"
  sha256                                 catalina:      "924afbbc16549d8c2b80544fd03104ff8c17a4b1460238e3ed17a1313391a2af"
  sha256                                 mojave:        "678d338adc7d6e8c352800fe03fc56660c796bd6da23eda2b1411fed18bd0d8d"
end</pre> <h3 id="root-url-root_url">Root URL (<code class="language-plaintext highlighter-rouge">root_url</code>)</h3> <p>Optionally contains the URL root used to determine bottle URLs.</p> <p>By default this is omitted and Homebrew’s default bottle URL root is used. This may be useful for taps that wish to provide bottles for their formulae or cater to a non-default <code class="language-plaintext highlighter-rouge">HOMEBREW_CELLAR</code>.</p> <h3 id="cellar-cellar">Cellar (<code class="language-plaintext highlighter-rouge">cellar</code>)</h3> <p>Optionally contains the value of <code class="language-plaintext highlighter-rouge">HOMEBREW_CELLAR</code> in which the bottles were built.</p> <p>Most compiled software contains references to its compiled location, preventing it from being simply relocated anywhere on disk. A value of <code class="language-plaintext highlighter-rouge">:any</code> or <code class="language-plaintext highlighter-rouge">:any_skip_relocation</code> means that the bottle can be safely installed in any Cellar as it did not contain any references to the Cellar in which it was originally built. This can be omitted if the bottle was compiled for the given OS/architecture’s default <code class="language-plaintext highlighter-rouge">HOMEBREW_CELLAR</code>, as is done for all bottles built by Brew Test Bot.</p> <h3 id="rebuild-version-rebuild">Rebuild version (<code class="language-plaintext highlighter-rouge">rebuild</code>)</h3> <p>Optionally contains the rebuild version of the bottle.</p> <p>Sometimes bottles may need be updated without bumping the version or revision of the formula, e.g. if a new patch was applied. In such cases <code class="language-plaintext highlighter-rouge">rebuild</code> will have a value of <code class="language-plaintext highlighter-rouge">1</code> or more.</p> <h3 id="checksum-sha256">Checksum (<code class="language-plaintext highlighter-rouge">sha256</code>)</h3> <p>Contains the SHA-256 hash of the bottle for the given OS/architecture.</p> <h2 id="formula-dsl">Formula DSL</h2> <p>An additional bottle-related method is available in the formula DSL.</p> <h3 id="pour-bottle-pour_bottle">Pour bottle (<code class="language-plaintext highlighter-rouge">pour_bottle?</code>)</h3> <p>Optionally returns a boolean to indicate whether a bottle should be used when installing this formula.</p> <p>For example a bottle may break if a related formula has been compiled with non-default options, so this method could check for that case and return <code class="language-plaintext highlighter-rouge">false</code>.</p> <p>A full example:</p> <pre data-language="ruby">pour_bottle? do
  reason "The bottle needs to be installed into #{Homebrew::DEFAULT_PREFIX}."
  satisfy { HOMEBREW_PREFIX.to_s == Homebrew::DEFAULT_PREFIX }
end</pre> <p>Commonly used <code class="language-plaintext highlighter-rouge">pour_bottle?</code> conditions can be added as preset symbols to the <code class="language-plaintext highlighter-rouge">pour_bottle?</code> method, allowing them to be specified like this:</p> <pre data-language="ruby">pour_bottle? only_if: :default_prefix
pour_bottle? only_if: :clt_installed</pre><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2009&ndash;present Homebrew contributors<br>Licensed under the BSD 2-Clause License.<br>
    <a href="https://docs.brew.sh/Bottles" class="_attribution-link">https://docs.brew.sh/Bottles</a>
  </p>
</div>
