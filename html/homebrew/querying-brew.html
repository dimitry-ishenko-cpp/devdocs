<h1 id="querying-brew">Querying <code class="language-plaintext highlighter-rouge">brew</code>
</h1> <p><em>In this document we will be using <a href="https://stedolan.github.io/jq/">jq</a> to parse JSON, available from Homebrew using <code class="language-plaintext highlighter-rouge">brew install jq</code>.</em></p> <h2 id="overview">Overview</h2> <p><code class="language-plaintext highlighter-rouge">brew</code> provides commands for getting common types of information out of the system. <code class="language-plaintext highlighter-rouge">brew list</code> shows installed formulae. <code class="language-plaintext highlighter-rouge">brew deps foo</code> shows the dependencies that <code class="language-plaintext highlighter-rouge">foo</code> needs.</p> <p>Additional commands, including external commands, can of course be written to provide more detailed information. There are a couple of disadvantages here. First, it requires writing Ruby against a possibly changing Homebrew codebase. There will be more code to touch during refactors, and Homebrew can’t guarantee that external commands will continue to work. Second, it requires designing the commands themselves, specifying input parameters and output formats.</p> <p>To enable users to do rich queries without the problems above, Homebrew provides the <code class="language-plaintext highlighter-rouge">brew info</code> command.</p> <h2 id="brew-info---json"><code class="language-plaintext highlighter-rouge">brew info --json</code></h2> <p><code class="language-plaintext highlighter-rouge">brew info</code> can output JSON-formatted information about formulae. This JSON can then be parsed using your tools of choice. See more details in <code class="language-plaintext highlighter-rouge">brew info --help</code>.</p> <p>The default schema version is <code class="language-plaintext highlighter-rouge">v1</code>, which returns info about formulae; specify <code class="language-plaintext highlighter-rouge">--json=v2</code> to include both formulae and casks. Note that fields may be added to the schema as needed without incrementing the schema. Any significant breaking changes will cause a change to the schema version.</p> <p>The schema itself is not currently documented outside of the code in <a href="https://github.com/Homebrew/brew/blob/2e6b6ab3a20da503ba2a22a37fdd6bd936d818ed/Library/Homebrew/formula.rb#L1922-L2017"><code class="language-plaintext highlighter-rouge">formula.rb</code></a> that generates it.</p> <h2 id="examples">Examples</h2> <p><em>The top-level element of the JSON output is always an array, so the <code class="language-plaintext highlighter-rouge">map</code> operator is used to act on the data.</em></p> <h3 id="pretty-print-a-single-formulas-info">Pretty-print a single formula’s info</h3> <pre data-language="bash">brew info --json=v1 tig | jq .</pre> <h3 id="installed-formulae">Installed formulae</h3> <p>To show full JSON information about all installed formulae:</p> <pre data-language="bash">brew info --json=v1 --all | jq "map(select(.installed != []))"</pre> <p>You’ll note that processing all formulae can be slow; it’s quicker to let <code class="language-plaintext highlighter-rouge">brew</code> do this:</p> <pre data-language="bash">brew info --json=v1 --installed</pre> <h3 id="linked-keg-only-formulae">Linked keg-only formulae</h3> <p>Some formulae are marked as “keg-only”, meaning that installed files are not linked to the shared <code class="language-plaintext highlighter-rouge">bin</code>, <code class="language-plaintext highlighter-rouge">lib</code>, etc. directories, as doing so can cause conflicts. Such formulae can be forced to link to the shared directories, but doing so is not recommended (and will cause <code class="language-plaintext highlighter-rouge">brew doctor</code> to complain.)</p> <p>To find the names of linked keg-only formulae:</p> <pre data-language="bash">brew info --json=v1 --installed | jq "map(select(.keg_only == true and .linked_keg != null) | .name)"</pre> <h3 id="unlinked-normal-formulae">Unlinked normal formulae</h3> <p>To find the names of normal (not keg-only) formulae that are installed, but not linked to the shared directories:</p> <pre data-language="bash">brew info --json=v1 --installed | jq "map(select(.keg_only == false and .linked_keg == null) | .name)"</pre> <h2 id="formulaebrewsh">formulae.brew.sh</h2> <p><a href="https://formulae.brew.sh">formulae.brew.sh</a> has a <a href="https://formulae.brew.sh/docs/api/">documented JSON API</a> which provides access to the <code class="language-plaintext highlighter-rouge">brew info --json=v1</code> output without needing access to Homebrew.</p> <h2 id="concluding-remarks">Concluding remarks</h2> <p>By using the JSON output, queries can be made against Homebrew with less risk of being broken due to Homebrew code changes, and without needing to understand Homebrew’s Ruby internals.</p> <p>If the JSON output does not provide some information that it ought to, please submit a request, preferably with a patch to add the desired information.</p><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2009&ndash;present Homebrew contributors<br>Licensed under the BSD 2-Clause License.<br>
    <a href="https://docs.brew.sh/Querying-Brew" class="_attribution-link">https://docs.brew.sh/Querying-Brew</a>
  </p>
</div>
