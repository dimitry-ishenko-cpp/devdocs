<h1 class="section" id="Thread_002dsafety-of-the-runtime-library-1">4.5 Thread-safety of the runtime library</h1> <div class="section-level-extent" id="Thread_002dsafety-of-the-runtime-library">     <p>GNU Fortran can be used in programs with multiple threads, e.g. by using OpenMP, by calling OS thread handling functions via the <code class="code">ISO_C_BINDING</code> facility, or by GNU Fortran compiled library code being called from a multi-threaded program. </p> <p>The GNU Fortran runtime library, (<code class="code">libgfortran</code>), supports being called concurrently from multiple threads with the following exceptions. </p> <p>During library initialization, the C <code class="code">getenv</code> function is used, which need not be thread-safe. Similarly, the <code class="code">getenv</code> function is used to implement the <code class="code">GET_ENVIRONMENT_VARIABLE</code> and <code class="code">GETENV</code> intrinsics. It is the responsibility of the user to ensure that the environment is not being updated concurrently when any of these actions are taking place. </p> <p>The <code class="code">EXECUTE_COMMAND_LINE</code> and <code class="code">SYSTEM</code> intrinsics are implemented with the <code class="code">system</code> function, which need not be thread-safe. It is the responsibility of the user to ensure that <code class="code">system</code> is not called concurrently. </p> <p>For platforms not supporting thread-safe POSIX functions, further functionality might not be thread-safe. For details, please consult the documentation for your operating system. </p> <p>The GNU Fortran runtime library uses various C library functions that depend on the locale, such as <code class="code">strtod</code> and <code class="code">snprintf</code>. In order to work correctly in locale-aware programs that set the locale using <code class="code">setlocale</code>, the locale is reset to the default “C” locale while executing a formatted <code class="code">READ</code> or <code class="code">WRITE</code> statement. On targets supporting the POSIX 2008 per-thread locale functions (e.g. <code class="code">newlocale</code>, <code class="code">uselocale</code>, <code class="code">freelocale</code>), these are used and thus the global locale set using <code class="code">setlocale</code> or the per-thread locales in other threads are not affected. However, on targets lacking this functionality, the global LC_NUMERIC locale is set to “C” during the formatted I/O. Thus, on such targets it’s not safe to call <code class="code">setlocale</code> concurrently from another thread while a Fortran formatted I/O operation is in progress. Also, other threads doing something dependent on the LC_NUMERIC locale might not work correctly if a formatted I/O operation is in progress in another thread. </p> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; Free Software Foundation<br>Licensed under the GNU Free Documentation License, Version 1.3.<br>
    <a href="https://gcc.gnu.org/onlinedocs/gcc-14.2.0/gfortran/Thread_002dsafety-of-the-runtime-library.html" class="_attribution-link">https://gcc.gnu.org/onlinedocs/gcc-14.2.0/gfortran/Thread_002dsafety-of-the-runtime-library.html</a>
  </p>
</div>
