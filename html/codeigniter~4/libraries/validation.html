<h1 id="id1">Validation</h1> <p id="validation">CodeIgniter provides a comprehensive data validation class that helps minimize the amount of code you’ll write.</p>  <ul class="simple"> <li><a class="reference internal" href="#overview" id="id2">Overview</a></li> <li>
<a class="reference internal" href="#form-validation-tutorial" id="id3">Form Validation Tutorial</a><ul> <li><a class="reference internal" href="#the-form" id="id4">The Form</a></li> <li><a class="reference internal" href="#the-success-page" id="id5">The Success Page</a></li> <li><a class="reference internal" href="#the-controller" id="id6">The Controller</a></li> <li><a class="reference internal" href="#try-it" id="id7">Try it!</a></li> <li><a class="reference internal" href="#explanation" id="id8">Explanation</a></li> <li><a class="reference internal" href="#add-validation-rules" id="id9">Add Validation Rules</a></li> </ul> </li> <li><a class="reference internal" href="#loading-the-library" id="id10">Loading the Library</a></li> <li>
<a class="reference internal" href="#setting-validation-rules" id="id11">Setting Validation Rules</a><ul> <li><a class="reference internal" href="#setrule" id="id12">setRule()</a></li> <li><a class="reference internal" href="#setrules" id="id13">setRules()</a></li> <li><a class="reference internal" href="#withrequest" id="id14">withRequest()</a></li> </ul> </li> <li>
<a class="reference internal" href="#working-with-validation" id="id15">Working with Validation</a><ul> <li><a class="reference internal" href="#validating-keys-that-are-arrays" id="id16">Validating Keys that are Arrays</a></li> <li><a class="reference internal" href="#validate-1-value" id="id17">Validate 1 Value</a></li> <li><a class="reference internal" href="#saving-sets-of-validation-rules-to-the-config-file" id="id18">Saving Sets of Validation Rules to the Config File</a></li> <li><a class="reference internal" href="#running-multiple-validations" id="id19">Running Multiple Validations</a></li> <li><a class="reference internal" href="#validation-placeholders" id="id20">Validation Placeholders</a></li> </ul> </li> <li>
<a class="reference internal" href="#working-with-errors" id="id21">Working With Errors</a><ul> <li><a class="reference internal" href="#setting-custom-error-messages" id="id22">Setting Custom Error Messages</a></li> <li><a class="reference internal" href="#translation-of-messages-and-validation-labels" id="id23">Translation Of Messages And Validation Labels</a></li> <li><a class="reference internal" href="#getting-all-errors" id="id24">Getting All Errors</a></li> <li><a class="reference internal" href="#getting-a-single-error" id="id25">Getting a Single Error</a></li> <li><a class="reference internal" href="#check-if-error-exists" id="id26">Check If Error Exists</a></li> </ul> </li> <li>
<a class="reference internal" href="#customizing-error-display" id="id27">Customizing Error Display</a><ul> <li><a class="reference internal" href="#creating-the-views" id="id28">Creating the Views</a></li> <li><a class="reference internal" href="#configuration" id="id29">Configuration</a></li> <li><a class="reference internal" href="#specifying-the-template" id="id30">Specifying the Template</a></li> </ul> </li> <li>
<a class="reference internal" href="#creating-custom-rules" id="id31">Creating Custom Rules</a><ul> <li><a class="reference internal" href="#allowing-parameters" id="id32">Allowing Parameters</a></li> </ul> </li> <li>
<a class="reference internal" href="#available-rules" id="id33">Available Rules</a><ul> <li><a class="reference internal" href="#rules-for-file-uploads" id="id34">Rules for File Uploads</a></li> </ul> </li> </ul>   <h2 id="overview">Overview</h2> <p>Before explaining CodeIgniter’s approach to data validation, let’s describe the ideal scenario:</p> <ol class="arabic simple"> <li>A form is displayed.</li> <li>You fill it in and submit it.</li> <li>If you submitted something invalid, or perhaps missed a required item, the form is redisplayed containing your data along with an error message describing the problem.</li> <li>This process continues until you have submitted a valid form.</li> </ol> <p>On the receiving end, the script must:</p> <ol class="arabic simple"> <li>Check for required data.</li> <li>Verify that the data is of the correct type, and meets the correct criteria. For example, if a username is submitted it must be validated to contain only permitted characters. It must be of a minimum length, and not exceed a maximum length. The username can’t be someone else’s existing username, or perhaps even a reserved word. Etc.</li> <li>Sanitize the data for security.</li> <li>Pre-format the data if needed.</li> <li>Prep the data for insertion in the database.</li> </ol> <p>Although there is nothing terribly complex about the above process, it usually requires a significant amount of code, and to display error messages, various control structures are usually placed within the form HTML. Form validation, while simple to create, is generally very messy and tedious to implement.</p>   <h2 id="form-validation-tutorial">Form Validation Tutorial</h2> <p>What follows is a “hands on” tutorial for implementing CodeIgniter’s Form Validation.</p> <p>In order to implement form validation you’ll need three things:</p> <ol class="arabic simple"> <li>A <a class="reference internal" href="../outgoing/views.html"><span class="doc">View</span></a> file containing a form.</li> <li>A View file containing a “success” message to be displayed upon successful submission.</li> <li>A <a class="reference internal" href="../incoming/controllers.html"><span class="doc">controller</span></a> method to receive and process the submitted data.</li> </ol> <p>Let’s create those three things, using a member sign-up form as the example.</p>  <h3 id="the-form">The Form</h3> <p>Using a text editor, create a form called <strong>Signup.php</strong>. In it, place this code and save it to your <strong>app/Views/</strong> folder:</p> <pre data-language="php">&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;My Form&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

    &lt;?= $validation-&gt;listErrors() ?&gt;

    &lt;?= form_open('form') ?&gt;

    &lt;h5&gt;Username&lt;/h5&gt;
    &lt;input type="text" name="username" value="" size="50" /&gt;

    &lt;h5&gt;Password&lt;/h5&gt;
    &lt;input type="text" name="password" value="" size="50" /&gt;

    &lt;h5&gt;Password Confirm&lt;/h5&gt;
    &lt;input type="text" name="passconf" value="" size="50" /&gt;

    &lt;h5&gt;Email Address&lt;/h5&gt;
    &lt;input type="text" name="email" value="" size="50" /&gt;

    &lt;div&gt;&lt;input type="submit" value="Submit" /&gt;&lt;/div&gt;

    &lt;/form&gt;

&lt;/body&gt;
&lt;/html&gt;
</pre>   <h3 id="the-success-page">The Success Page</h3> <p>Using a text editor, create a form called <strong>Success.php</strong>. In it, place this code and save it to your <strong>app/Views/</strong> folder:</p> <pre data-language="php">&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;My Form&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

    &lt;h3&gt;Your form was successfully submitted!&lt;/h3&gt;

    &lt;p&gt;&lt;?= anchor('form', 'Try it again!') ?&gt;&lt;/p&gt;

&lt;/body&gt;
&lt;/html&gt;
</pre>   <h3 id="the-controller">The Controller</h3> <p>Using a text editor, create a controller called <strong>Form.php</strong>. In it, place this code and save it to your <strong>app/Controllers/</strong> folder:</p> <pre data-language="php">&lt;?php

namespace App\Controllers;

use CodeIgniter\Controller;

class Form extends Controller
{
    public function index()
    {
        helper(['form', 'url']);

        if (! $this-&gt;validate([])) {
            echo view('Signup', [
                'validation' =&gt; $this-&gt;validator,
            ]);
        } else {
            echo view('Success');
        }
    }
}
</pre>   <h3 id="try-it">Try it!</h3> <p>To try your form, visit your site using a URL similar to this one:</p> <pre data-language="php">example.com/index.php/form/
</pre> <p>If you submit the form you should simply see the form reload. That’s because you haven’t set up any validation rules in <code>$this-&gt;validate()</code> yet.</p> <p>The <code>validate()</code> method is a method in the Controller. It uses the <strong>Validation class</strong> inside. See <em>Validating data</em> in <a class="reference internal" href="../incoming/controllers.html"><span class="doc">Controllers</span></a>.</p> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">Since you haven’t told the <code>validate()</code> method to validate anything yet, it <strong>returns false</strong> (boolean false) <strong>by default</strong>. The <code>validate()</code> method only returns true if it has successfully applied your rules without any of them failing.</p> </div>   <h3 id="explanation">Explanation</h3> <p>You’ll notice several things about the above pages:</p> <p>The form (<strong>Signup.php</strong>) is a standard web form with a couple of exceptions:</p> <ol class="arabic"> <li>It uses a <a class="reference internal" href="../helpers/form_helper.html"><span class="doc">form helper</span></a> to create the form opening. Technically, this isn’t necessary. You could create the form using standard HTML. However, the benefit of using the helper is that it generates the action URL for you, based on the URL in your config file. This makes your application more portable in the event your URLs change. </li> <li>
<p class="first">At the top of the form you’ll notice the following function call:</p> <pre data-language="php">&lt;?= $validation-&gt;listErrors() ?&gt;
</pre> <p>This function will return any error messages sent back by the validator. If there are no messages it returns an empty string.</p> </li> </ol> <p>The controller (<strong>Form.php</strong>) has one method: <code>index()</code>. This method uses the Controller-provided <code>validate()</code> method and loads the form helper and URL helper used by your view files. It also runs the validation routine. Based on whether the validation was successful it either presents the form or the success page.</p>   <h3 id="add-validation-rules">Add Validation Rules</h3> <p>Then add validation rules in the controller (<strong>Form.php</strong>):</p> <pre data-language="php">if (! $this-&gt;validate([
    'username' =&gt; 'required',
    'password' =&gt; 'required|min_length[10]',
    'passconf' =&gt; 'required|matches[password]',
    'email'    =&gt; 'required|valid_email',
])) {
    ...
}
</pre> <p>If you submit the form you should see the success page or the form with error messages.</p>    <h2 id="loading-the-library">Loading the Library</h2> <p>The library is loaded as a service named <strong>validation</strong>:</p> <pre data-language="php">$validation =  \Config\Services::validation();
</pre> <p>This automatically loads the <code>Config\Validation</code> file which contains settings for including multiple Rulesets, and collections of rules that can be easily reused.</p> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">You may never need to use this method, as both the <a class="reference internal" href="../incoming/controllers.html"><span class="doc">Controller</span></a> and the <a class="reference internal" href="../models/model.html"><span class="doc">Model</span></a> provide methods to make validation even easier.</p> </div>   <h2 id="setting-validation-rules">Setting Validation Rules</h2> <p>CodeIgniter lets you set as many validation rules as you need for a given field, cascading them in order. To set validation rules you will use the <code>setRule()</code>, <code>setRules()</code>, or <code>withRequest()</code> methods.</p>  <h3 id="setrule">setRule()</h3> <p>This method sets a single rule. It takes the name of the field as the first parameter, an optional label and a string with a pipe-delimited list of rules that should be applied:</p> <pre data-language="php">$validation-&gt;setRule('username', 'Username', 'required');
</pre> <p>The <strong>field name</strong> must match the key of any data array that is sent in. If the data is taken directly from <code>$_POST</code>, then it must be an exact match for the form input name.</p>   <h3 id="setrules">setRules()</h3> <p>Like, <code>setRule()</code>, but accepts an array of field names and their rules:</p> <pre data-language="php">$validation-&gt;setRules([
    'username' =&gt; 'required',
    'password' =&gt; 'required|min_length[10]',
]);
</pre> <p>To give a labeled error message you can set up as:</p> <pre data-language="php">$validation-&gt;setRules([
    'username' =&gt; ['label' =&gt; 'Username', 'rules' =&gt; 'required'],
    'password' =&gt; ['label' =&gt; 'Password', 'rules' =&gt; 'required|min_length[10]'],
]);
</pre>   <h3 id="withrequest">withRequest()</h3> <p>One of the most common times you will use the validation library is when validating data that was input from an HTTP Request. If desired, you can pass an instance of the current Request object and it will take all of the input data and set it as the data to be validated:</p> <pre data-language="php">$validation-&gt;withRequest($this-&gt;request)-&gt;run();
</pre>    <h2 id="working-with-validation">Working with Validation</h2>  <h3 id="validating-keys-that-are-arrays">Validating Keys that are Arrays</h3> <p>If your data is in a nested associative array, you can use “dot array syntax” to easily validate your data:</p> <pre data-language="php">// The data to test:
'contacts' =&gt; [
    'name' =&gt; 'Joe Smith',
    'friends' =&gt; [
        [
            'name' =&gt; 'Fred Flinstone',
        ],
        [
            'name' =&gt; 'Wilma',
        ],
    ]
]

// Joe Smith
$validation-&gt;setRules([
    'contacts.name' =&gt; 'required',
]);

// Fred Flintsone &amp; Wilma
$validation-&gt;setRules([
    'contacts.friends.name' =&gt; 'required',
]);
</pre> <p>You can use the ‘*’ wildcard symbol to match any one level of the array:</p> <pre data-language="php">// Fred Flintsone &amp; Wilma
$validation-&gt;setRules([
    'contacts.*.name' =&gt; 'required',
]);
</pre> <p>“dot array syntax” can also be useful when you have single dimension array data. For example, data returned by multi select dropdown:</p> <pre data-language="php">// The data to test:
'user_ids' =&gt; [
    1,
    2,
    3,
]
// Rule
$validation-&gt;setRules([
    'user_ids.*' =&gt; 'required',
]);
</pre>   <h3 id="validate-1-value">Validate 1 Value</h3> <p>Validate one value against a rule:</p> <pre data-language="php">$validation-&gt;check($value, 'required');
</pre>   <h3 id="saving-sets-of-validation-rules-to-the-config-file">Saving Sets of Validation Rules to the Config File</h3> <p>A nice feature of the Validation class is that it permits you to store all your validation rules for your entire application in a config file. You organize the rules into “groups”. You can specify a different group every time you run the validation.</p>  <h4 id="validation-array">How to save your rules</h4> <p id="how-to-save-your-rules">To store your validation rules, simply create a new public property in the <code>Config\Validation</code> class with the name of your group. This element will hold an array with your validation rules. As shown earlier, the validation array will have this prototype:</p> <pre data-language="php">class Validation
{
    public $signup = [
        'username'     =&gt; 'required',
        'password'     =&gt; 'required',
        'pass_confirm' =&gt; 'required|matches[password]',
        'email'        =&gt; 'required|valid_email',
    ];
}
</pre> <p>You can specify the group to use when you call the <code>run()</code> method:</p> <pre data-language="php">$validation-&gt;run($data, 'signup');
</pre> <p>You can also store custom error messages in this configuration file by naming the property the same as the group, and appended with <code>_errors</code>. These will automatically be used for any errors when this group is used:</p> <pre data-language="php">class Validation
{
    public $signup = [
        'username'     =&gt; 'required',
        'password'     =&gt; 'required',
        'pass_confirm' =&gt; 'required|matches[password]',
        'email'        =&gt; 'required|valid_email',
    ];

    public $signup_errors = [
        'username' =&gt; [
            'required'    =&gt; 'You must choose a username.',
        ],
        'email'    =&gt; [
            'valid_email' =&gt; 'Please check the Email field. It does not appear to be valid.',
        ],
    ];
}
</pre> <p>Or pass all settings in an array:</p> <pre data-language="php">class Validation
{
    public $signup = [
        'username' =&gt; [
            'rules'  =&gt; 'required',
            'errors' =&gt; [
                'required' =&gt; 'You must choose a Username.',
            ],
        ],
        'email'    =&gt; [
            'rules'  =&gt; 'required|valid_email',
            'errors' =&gt; [
                'valid_email' =&gt; 'Please check the Email field. It does not appear to be valid.',
            ],
        ],
    ];
}
</pre> <p>See below for details on the formatting of the array.</p>   <h4 id="getting-setting-rule-groups">Getting &amp; Setting Rule Groups</h4> <p><strong>Get Rule Group</strong></p> <p>This method gets a rule group from the validation configuration:</p> <pre data-language="php">$validation-&gt;getRuleGroup('signup');
</pre> <p><strong>Set Rule Group</strong></p> <p>This method sets a rule group from the validation configuration to the validation service:</p> <pre data-language="php">$validation-&gt;setRuleGroup('signup');
</pre>    <h3 id="running-multiple-validations">Running Multiple Validations</h3> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last"><code>run()</code> method will not reset error state. Should a previous run fail, <code>run()</code> will always return false and <code>getErrors()</code> will return all previous errors until explicitly reset.</p> </div> <p>If you intend to run multiple validations, for instance on different data sets or with different rules after one another, you might need to call <code>$validation-&gt;reset()</code> before each run to get rid of errors from previous run. Be aware that <code>reset()</code> will invalidate any data, rule or custom error you previously set, so <code>setRules()</code>, <code>setRuleGroup()</code> etc. need to be repeated:</p> <pre data-language="php">foreach ($userAccounts as $user) {
    $validation-&gt;reset();
    $validation-&gt;setRules($userAccountRules);

    if (! $validation-&gt;run($user)) {
        // handle validation errors
    }
}
</pre>   <h3 id="validation-placeholders">Validation Placeholders</h3> <p>The Validation class provides a simple method to replace parts of your rules based on data that’s being passed into it. This sounds fairly obscure but can be especially handy with the <code>is_unique</code> validation rule. Placeholders are simply the name of the field (or array key) that was passed in as <code>$data</code> surrounded by curly brackets. It will be replaced by the <strong>value</strong> of the matched incoming field. An example should clarify this:</p> <pre data-language="php">$validation-&gt;setRules([
    'email' =&gt; 'required|valid_email|is_unique[users.email,id,{id}]',
]);
</pre> <p>In this set of rules, it states that the email address should be unique in the database, except for the row that has an id matching the placeholder’s value. Assuming that the form POST data had the following:</p> <pre data-language="php">$_POST = [
    'id' =&gt; 4,
    'email' =&gt; 'foo@example.com',
];
</pre> <p>then the <code>{id}</code> placeholder would be replaced with the number <strong>4</strong>, giving this revised rule:</p> <pre data-language="php">$validation-&gt;setRules([
    'email' =&gt; 'required|valid_email|is_unique[users.email,id,4]',
]);
</pre> <p>So it will ignore the row in the database that has <code>id=4</code> when it verifies the email is unique.</p> <p>This can also be used to create more dynamic rules at runtime, as long as you take care that any dynamic keys passed in don’t conflict with your form data.</p>    <h2 id="working-with-errors">Working With Errors</h2> <p>The Validation library provides several methods to help you set error messages, provide custom error messages, and retrieve one or more errors to display.</p> <p>By default, error messages are derived from language strings in <code>system/Language/en/Validation.php</code>, where each rule has an entry.</p>  <h3 id="validation-custom-errors">Setting Custom Error Messages</h3> <p id="setting-custom-error-messages">Both the <code>setRule()</code> and <code>setRules()</code> methods can accept an array of custom messages that will be used as errors specific to each field as their last parameter. This allows for a very pleasant experience for the user since the errors are tailored to each instance. If not custom error message is provided, the default value will be used.</p> <p>These are two ways to provide custom error messages.</p> <p>As the last parameter:</p> <pre data-language="php">$validation-&gt;setRules([
        'username' =&gt; 'required|is_unique[users.username]',
        'password' =&gt; 'required|min_length[10]'
    ],
    [   // Errors
        'username' =&gt; [
            'required' =&gt; 'All accounts must have usernames provided',
        ],
        'password' =&gt; [
            'min_length' =&gt; 'Your password is too short. You want to get hacked?',
        ],
    ]
);
</pre> <p>Or as a labeled style:</p> <pre data-language="php">$validation-&gt;setRules([
        'username' =&gt; [
            'label'  =&gt; 'Username',
            'rules'  =&gt; 'required|is_unique[users.username]',
            'errors' =&gt; [
                'required' =&gt; 'All accounts must have {field} provided',
            ],
        ],
        'password' =&gt; [
            'label'  =&gt; 'Password',
            'rules'  =&gt; 'required|min_length[10]',
            'errors' =&gt; [
                'min_length' =&gt; 'Your {field} is too short. You want to get hacked?',
            ],
        ]
    ]
);
</pre> <p>If you’d like to include a field’s “human” name, or the optional parameter some rules allow for (such as max_length), or the value that was validated you can add the <code>{field}</code>, <code>{param}</code> and <code>{value}</code> tags to your message, respectively:</p> <pre data-language="php">'min_length' =&gt; 'Supplied value ({value}) for {field} must have at least {param} characters.'
</pre> <p>On a field with the human name Username and a rule of min_length[6] with a value of “Pizza”, an error would display: “Supplied value (Pizza) for Username must have at least 6 characters.”</p> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">If you pass the last parameter the labeled style error messages will be ignored.</p> </div>   <h3 id="translation-of-messages-and-validation-labels">Translation Of Messages And Validation Labels</h3> <p>To use translated strings from language files, we can simply use the dot syntax. Let’s say we have a file with translations located here: <code>app/Languages/en/Rules.php</code>. We can simply use the language lines defined in this file, like this:</p> <pre data-language="php">$validation-&gt;setRules([
        'username' =&gt; [
            'label'  =&gt; 'Rules.username',
            'rules'  =&gt; 'required|is_unique[users.username]',
            'errors' =&gt; [
                'required' =&gt; 'Rules.username.required',
            ],
        ],
        'password' =&gt; [
            'label'  =&gt; 'Rules.password',
            'rules'  =&gt; 'required|min_length[10]',
            'errors' =&gt; [
                'min_length' =&gt; 'Rules.password.min_length',
            ],
        ],
    ]
);
</pre>   <h3 id="getting-all-errors">Getting All Errors</h3> <p>If you need to retrieve all error messages for failed fields, you can use the <code>getErrors()</code> method:</p> <pre data-language="php">$errors = $validation-&gt;getErrors();

// Returns:
[
    'field1' =&gt; 'error message',
    'field2' =&gt; 'error message',
]
</pre> <p>If no errors exist, an empty array will be returned.</p>   <h3 id="getting-a-single-error">Getting a Single Error</h3> <p>You can retrieve the error for a single field with the <code>getError()</code> method. The only parameter is the field name:</p> <pre data-language="php">$error = $validation-&gt;getError('username');
</pre> <p>If no error exists, an empty string will be returned.</p>   <h3 id="check-if-error-exists">Check If Error Exists</h3> <p>You can check to see if an error exists with the <code>hasError()</code> method. The only parameter is the field name:</p> <pre data-language="php">if ($validation-&gt;hasError('username')) {
    echo $validation-&gt;getError('username');
}
</pre>    <h2 id="customizing-error-display">Customizing Error Display</h2> <p>When you call <code>$validation-&gt;listErrors()</code> or <code>$validation-&gt;showError()</code>, it loads a view file in the background that determines how the errors are displayed. By default, they display with a class of <code>errors</code> on the wrapping div. You can easily create new views and use them throughout your application.</p>  <h3 id="creating-the-views">Creating the Views</h3> <p>The first step is to create custom views. These can be placed anywhere that the <code>view()</code> method can locate them, which means the standard View directory, or any namespaced View folder will work. For example, you could create a new view at <strong>/app/Views/_errors_list.php</strong>:</p> <pre data-language="php">&lt;div class="alert alert-danger" role="alert"&gt;
    &lt;ul&gt;
    &lt;?php foreach ($errors as $error) : ?&gt;
        &lt;li&gt;&lt;?= esc($error) ?&gt;&lt;/li&gt;
    &lt;?php endforeach ?&gt;
    &lt;/ul&gt;
&lt;/div&gt;
</pre> <p>An array named <code>$errors</code> is available within the view that contains a list of the errors, where the key is the name of the field that had the error, and the value is the error message, like this:</p> <pre data-language="php">$errors = [
    'username' =&gt; 'The username field must be unique.',
    'email'    =&gt; 'You must provide a valid email address.'
];
</pre> <p>There are actually two types of views that you can create. The first has an array of all of the errors, and is what we just looked at. The other type is simpler, and only contains a single variable, <code>$error</code> that contains the error message. This is used with the <code>showError()</code> method where a field must be specified:</p> <pre data-language="php">&lt;span class="help-block"&gt;&lt;?= esc($error) ?&gt;&lt;/span&gt;
</pre>   <h3 id="configuration">Configuration</h3> <p>Once you have your views created, you need to let the Validation library know about them. Open <code>Config/Validation.php</code>. Inside, you’ll find the <code>$templates</code> property where you can list as many custom views as you want, and provide an short alias they can be referenced by. If we were to add our example file from above, it would look something like:</p> <pre data-language="php">public $templates = [
    'list'    =&gt; 'CodeIgniter\Validation\Views\list',
    'single'  =&gt; 'CodeIgniter\Validation\Views\single',
    'my_list' =&gt; '_errors_list',
];
</pre>   <h3 id="specifying-the-template">Specifying the Template</h3> <p>You can specify the template to use by passing it’s alias as the first parameter in <code>listErrors</code>:</p> <pre data-language="php">&lt;?= $validation-&gt;listErrors('my_list') ?&gt;
</pre> <p>When showing field-specific errors, you can pass the alias as the second parameter to the <code>showError</code> method, right after the name of the field the error should belong to:</p> <pre data-language="php">&lt;?= $validation-&gt;showError('username', 'my_single') ?&gt;
</pre>    <h2 id="creating-custom-rules">Creating Custom Rules</h2> <p>Rules are stored within simple, namespaced classes. They can be stored any location you would like, as long as the autoloader can find it. These files are called RuleSets. To add a new RuleSet, edit <strong>Config/Validation.php</strong> and add the new file to the <code>$ruleSets</code> array:</p> <pre data-language="php">use CodeIgniter\Validation\CreditCardRules;
use CodeIgniter\Validation\FileRules;
use CodeIgniter\Validation\FormatRules;
use CodeIgniter\Validation\Rules;

public $ruleSets = [
    Rules::class,
    FormatRules::class,
    FileRules::class,
    CreditCardRules::class,
];
</pre> <p>You can add it as either a simple string with the fully qualified class name, or using the <code>::class</code> suffix as shown above. The primary benefit here is that it provides some extra navigation capabilities in more advanced IDEs.</p> <p>Within the file itself, each method is a rule and must accept a string as the first parameter, and must return a boolean true or false value signifying true if it passed the test or false if it did not:</p> <pre data-language="php">class MyRules
{
    public function even(string $str): bool
    {
        return (int) $str % 2 == 0;
    }
}
</pre> <p>By default, the system will look within <code>CodeIgniter\Language\en\Validation.php</code> for the language strings used within errors. In custom rules, you may provide error messages by accepting a <code>$error</code> variable by reference in the second parameter:</p> <pre data-language="php">public function even(string $str, string &amp;$error = null): bool
{
    if ((int) $str % 2 !== 0) {
        $error = lang('myerrors.evenError');

        return false;
    }

    return true;
}
</pre> <p>Your new custom rule could now be used just like any other rule:</p> <pre data-language="php">$this-&gt;validate($request, [
    'foo' =&gt; 'required|even',
]);
</pre>  <h3 id="allowing-parameters">Allowing Parameters</h3> <p>If your method needs to work with parameters, the function will need a minimum of three parameters: the string to validate, the parameter string, and an array with all of the data that was submitted the form. The <code>$data</code> array is especially handy for rules like <code>require_with</code> that needs to check the value of another submitted field to base its result on:</p> <pre data-language="php">public function required_with($str, string $fields, array $data): bool
{
    $fields = explode(',', $fields);

    // If the field is present we can safely assume that
    // the field is here, no matter whether the corresponding
    // search field is present or not.
    $present = $this-&gt;required($str ?? '');

    if ($present) {
        return true;
    }

    // Still here? Then we fail this test if
    // any of the fields are present in $data
    // as $fields is the lis
    $requiredFields = [];

    foreach ($fields as $field) {
        if (array_key_exists($field, $data)) {
            $requiredFields[] = $field;
        }
    }

    // Remove any keys with empty values since, that means they
    // weren't truly there, as far as this is concerned.
    $requiredFields = array_filter($requiredFields, function ($item) use ($data) {
        return ! empty($data[$item]);
    });

    return empty($requiredFields);
}
</pre> <p>Custom errors can be returned as the fourth parameter, just as described above.</p>    <h2 id="available-rules">Available Rules</h2> <p>The following is a list of all the native rules that are available to use:</p> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">Rule is a string; there must be <strong>no spaces</strong> between the parameters, especially the <code>is_unique</code> rule. There can be no spaces before and after <code>ignore_value</code>.</p> </div> <pre data-language="php">// is_unique[table.field,ignore_field,ignore_value]

$validation-&gt;setRules([
    'name' =&gt; "is_unique[supplier.name,uuid, $uuid]",  // is not ok
    'name' =&gt; "is_unique[supplier.name,uuid,$uuid ]",  // is not ok
    'name' =&gt; "is_unique[supplier.name,uuid,$uuid]",   // is ok
    'name' =&gt; "is_unique[supplier.name,uuid,{uuid}]",  // is ok - see "Validation Placeholders"
]);
</pre> <table class="docutils">  <thead valign="bottom"> <tr>
<th class="head">Rule</th> <th class="head">Parameter</th> <th class="head">Description</th> <th class="head">Example</th> </tr> </thead>  <tr>
<td>alpha</td> <td>No</td> <td>Fails if field has anything other than alphabetic characters.</td> <td> </td> </tr> <tr>
<td>alpha_space</td> <td>No</td> <td>Fails if field contains anything other than alphabetic characters or spaces.</td> <td> </td> </tr> <tr>
<td>alpha_dash</td> <td>No</td> <td>Fails if field contains anything other than alphanumeric characters, underscores or dashes.</td> <td> </td> </tr> <tr>
<td>alpha_numeric</td> <td>No</td> <td>Fails if field contains anything other than alphanumeric characters.</td> <td> </td> </tr> <tr>
<td>alpha_numeric_space</td> <td>No</td> <td>Fails if field contains anything other than alphanumeric or space characters.</td> <td> </td> </tr> <tr>
<td>alpha_numeric_punct</td> <td>No</td> <td>Fails if field contains anything other than alphanumeric, space, or this limited set of punctuation characters: ~ (tilde), ! (exclamation), # (number), $ (dollar), % (percent), &amp; (ampersand), * (asterisk), - (dash), _ (underscore), + (plus), = (equals), | (vertical bar), : (colon), . (period).</td> <td> </td> </tr> <tr>
<td>decimal</td> <td>No</td> <td>Fails if field contains anything other than a decimal number. Also accepts a + or - sign for the number.</td> <td> </td> </tr> <tr>
<td>differs</td> <td>Yes</td> <td>Fails if field does not differ from the one in the parameter.</td> <td>differs[field_name]</td> </tr> <tr>
<td>exact_length</td> <td>Yes</td> <td>Fails if field is not exactly the parameter value. One or more comma-separated values.</td> <td>exact_length[5] or exact_length[5,8,12]</td> </tr> <tr>
<td>greater_than</td> <td>Yes</td> <td>Fails if field is less than or equal to the parameter value or not numeric.</td> <td>greater_than[8]</td> </tr> <tr>
<td>greater_than_equal_to</td> <td>Yes</td> <td>Fails if field is less than the parameter value, or not numeric.</td> <td>greater_than_equal_to[5]</td> </tr> <tr>
<td>hex</td> <td>No</td> <td>Fails if field contains anything other than hexadecimal characters.</td> <td> </td> </tr> <tr>
<td>if_exist</td> <td>No</td> <td>If this rule is present, validation will only return possible errors if the field key exists, regardless of its value.</td> <td> </td> </tr> <tr>
<td>in_list</td> <td>Yes</td> <td>Fails if field is not within a predetermined list.</td> <td>in_list[red,blue,green]</td> </tr> <tr>
<td>integer</td> <td>No</td> <td>Fails if field contains anything other than an integer.</td> <td> </td> </tr> <tr>
<td>is_natural</td> <td>No</td> <td>Fails if field contains anything other than a natural number: 0, 1, 2, 3, etc.</td> <td> </td> </tr> <tr>
<td>is_natural_no_zero</td> <td>No</td> <td>Fails if field contains anything other than a natural number, except zero: 1, 2, 3, etc.</td> <td> </td> </tr> <tr>
<td>is_not_unique</td> <td>Yes</td> <td>Checks the database to see if the given value exist. Can ignore records by field/value to filter (currently accept only one filter).</td> <td>is_not_unique[table.field,where_field,where_value]</td> </tr> <tr>
<td>is_unique</td> <td>Yes</td> <td>Checks if this field value exists in the database. Optionally set a column and value value to ignore, useful when updating records to ignore itself.</td> <td>is_unique[table.field,ignore_field,ignore_value]</td> </tr> <tr>
<td>less_than</td> <td>Yes</td> <td>Fails if field is greater than or equal to the parameter value or not numeric.</td> <td>less_than[8]</td> </tr> <tr>
<td>less_than_equal_to</td> <td>Yes</td> <td>Fails if field is greater than the parameter value or not numeric.</td> <td>less_than_equal_to[8]</td> </tr> <tr>
<td>matches</td> <td>Yes</td> <td>The value must match the value of the field in the parameter.</td> <td>matches[field]</td> </tr> <tr>
<td>max_length</td> <td>Yes</td> <td>Fails if field is longer than the parameter value.</td> <td>max_length[8]</td> </tr> <tr>
<td>min_length</td> <td>Yes</td> <td>Fails if field is shorter than the parameter value.</td> <td>min_length[3]</td> </tr> <tr>
<td>not_in_list</td> <td>Yes</td> <td>Fails if field is within a predetermined list.</td> <td>not_in_list[red,blue,green]</td> </tr> <tr>
<td>numeric</td> <td>No</td> <td>Fails if field contains anything other than numeric characters.</td> <td> </td> </tr> <tr>
<td>regex_match</td> <td>Yes</td> <td>Fails if field does not match the regular expression.</td> <td>regex_match[/regex/]</td> </tr> <tr>
<td>permit_empty</td> <td>No</td> <td>Allows the field to receive an empty array, empty string, null or false.</td> <td> </td> </tr> <tr>
<td>required</td> <td>No</td> <td>Fails if the field is an empty array, empty string, null or false.</td> <td> </td> </tr> <tr>
<td>required_with</td> <td>Yes</td> <td>The field is required when any of the other required fields are present in the data.</td> <td>required_with[field1,field2]</td> </tr> <tr>
<td>required_without</td> <td>Yes</td> <td>The field is required when all of the other fields are present in the data but not required.</td> <td>required_without[field1,field2]</td> </tr> <tr>
<td>string</td> <td>No</td> <td>A generic alternative to the alpha* rules that confirms the element is a string</td> <td> </td> </tr> <tr>
<td>timezone</td> <td>No</td> <td>Fails if field does match a timezone per <code>timezone_identifiers_list</code>
</td> <td> </td> </tr> <tr>
<td>valid_base64</td> <td>No</td> <td>Fails if field contains anything other than valid Base64 characters.</td> <td> </td> </tr> <tr>
<td>valid_json</td> <td>No</td> <td>Fails if field does not contain a valid JSON string.</td> <td> </td> </tr> <tr>
<td>valid_email</td> <td>No</td> <td>Fails if field does not contain a valid email address.</td> <td> </td> </tr> <tr>
<td>valid_emails</td> <td>No</td> <td>Fails if any value provided in a comma separated list is not a valid email.</td> <td> </td> </tr> <tr>
<td>valid_ip</td> <td>No</td> <td>Fails if the supplied IP is not valid. Accepts an optional parameter of ‘ipv4’ or ‘ipv6’ to specify an IP format.</td> <td>valid_ip[ipv6]</td> </tr> <tr>
<td>valid_url</td> <td>No</td> <td>Fails if field does not contain (loosely) a URL. Includes simple strings that could be hostnames, like “codeigniter”.</td> <td> </td> </tr> <tr>
<td>valid_url_strict</td> <td>Yes</td> <td>Fails if field does not contain a valid URL. You can optionally specify a list of valid schemas. If not specified, <code>http,https</code> are valid. This rule uses PHP’s <code>FILTER_VALIDATE_URL</code>.</td> <td>valid_url_strict[https]</td> </tr> <tr>
<td>valid_date</td> <td>No</td> <td>Fails if field does not contain a valid date. Accepts an optional parameter to matches a date format.</td> <td>valid_date[d/m/Y]</td> </tr> <tr>
<td>valid_cc_number</td> <td>Yes</td> <td>Verifies that the credit card number matches the format used by the specified provider. Current supported providers are: American Express (amex), China Unionpay (unionpay), Diners Club CarteBlance (carteblanche), Diners Club (dinersclub), Discover Card (discover), Interpayment (interpayment), JCB (jcb), Maestro (maestro), Dankort (dankort), NSPK MIR (mir), Troy (troy), MasterCard (mastercard), Visa (visa), UATP (uatp), Verve (verve), CIBC Convenience Card (cibc), Royal Bank of Canada Client Card (rbc), TD Canada Trust Access Card (tdtrust), Scotiabank Scotia Card (scotia), BMO ABM Card (bmoabm), HSBC Canada Card (hsbc)</td> <td>valid_cc_number[amex]</td> </tr>  </table>  <h3 id="rules-for-file-uploads">Rules for File Uploads</h3> <p>These validation rules enable you to do the basic checks you might need to verify that uploaded files meet your business needs. Since the value of a file upload HTML field doesn’t exist, and is stored in the $_FILES global, the name of the input field will need to be used twice. Once to specify the field name as you would for any other rule, but again as the first parameter of all file upload related rules:</p> <pre data-language="php">// In the HTML
&lt;input type="file" name="avatar"&gt;

// In the controller
$this-&gt;validate([
    'avatar' =&gt; 'uploaded[avatar]|max_size[avatar,1024]',
]);
</pre> <table class="docutils">  <thead valign="bottom"> <tr>
<th class="head">Rule</th> <th class="head">Parameter</th> <th class="head">Description</th> <th class="head">Example</th> </tr> </thead>  <tr>
<td>uploaded</td> <td>Yes</td> <td>Fails if the name of the parameter does not match the name of any uploaded files.</td> <td>uploaded[field_name]</td> </tr> <tr>
<td>max_size</td> <td>Yes</td> <td>Fails if the uploaded file named in the parameter is larger than the second parameter in kilobytes (kb). Or if the file is larger than allowed maximum size declared in php.ini config file - <code>upload_max_filesize</code> directive.</td> <td>max_size[field_name,2048]</td> </tr> <tr>
<td>max_dims</td> <td>Yes</td> <td>Fails if the maximum width and height of an uploaded image exceed values. The first parameter is the field name. The second is the width, and the third is the height. Will also fail if the file cannot be determined to be an image.</td> <td>max_dims[field_name,300,150]</td> </tr> <tr>
<td>mime_in</td> <td>Yes</td> <td>Fails if the file’s mime type is not one listed in the parameters.</td> <td>mime_in[field_name,image/png,image/jpg]</td> </tr> <tr>
<td>ext_in</td> <td>Yes</td> <td>Fails if the file’s extension is not one listed in the parameters.</td> <td>ext_in[field_name,png,jpg,gif]</td> </tr> <tr>
<td>is_image</td> <td>Yes</td> <td>Fails if the file cannot be determined to be an image based on the mime type.</td> <td>is_image[field_name]</td> </tr>  </table> <p>The file validation rules apply for both single and multiple file uploads.</p> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">You can also use any native PHP functions that return boolean and permit at least one parameter, the field data to validate. The Validation library <strong>never alters the data</strong> to validate.</p> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2014&ndash;2020 British Columbia Institute of Technology<br>Licensed under the MIT License.<br>
    <a href="https://codeigniter.com/user_guide/libraries/validation.html" class="_attribution-link">https://codeigniter.com/user_guide/libraries/validation.html</a>
  </p>
</div>
