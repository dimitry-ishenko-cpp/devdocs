<section id="compiler-selection-and-customizing-a-build"> <h1>Compiler selection and customizing a build</h1> <section id="selecting-a-specific-compiler"> <h2>Selecting a specific compiler</h2> <p>Meson supports the standard environment variables <code>CC</code>, <code>CXX</code> and <code>FC</code> to select specific C, C++ and/or Fortran compilers. These environment variables are documented in <a class="reference external" href="https://mesonbuild.com/Reference-tables.html#compiler-and-linker-flag-environment-variables">the reference tables in the Meson docs</a>.</p> <p>Note that environment variables only get applied from a clean build, because they affect the configure stage (i.e., <code>meson setup</code>). An incremental rebuild does not react to changes in environment variables - you have to run <code>git
clean -xdf</code> and do a full rebuild, or run <code>meson setup --reconfigure</code>.</p> </section> <section id="adding-a-custom-compiler-or-linker-flag"> <h2>Adding a custom compiler or linker flag</h2> <p>Meson by design prefers builds being configured through command-line options passed to <code>meson setup</code>. It provides many built-in options:</p> <ul class="simple"> <li>For enabling a debug build and the optimization level, see the next section on “build types”,</li> <li>Enabling <code>-Werror</code> in a portable manner is done via <code>-Dwerror=true</code>,</li> <li>Enabling warning levels is done via <code>-Dwarning_level=&lt;val&gt;</code>, with <code>&lt;val&gt;</code> one of <code>{0, 1, 2, 3, everything}</code>,</li> <li>There are many other builtin options, from activating Visual Studio (<code>-Dvsenv=true</code>) and building with link time optimization (<code>-Db_lto</code>) to changing the default C++ language level (<code>-Dcpp_std='c++17'</code>) or linker flags (<code>-Dcpp_link_args='-Wl,-z,defs'</code>).</li> </ul> <p>For a comprehensive overview of options, see <a class="reference external" href="https://mesonbuild.com/Builtin-options.html">Meson’s builtin options docs page</a>.</p> <p>Meson also supports the standard environment variables <code>CFLAGS</code>, <code>CXXFLAGS</code>, <code>FFLAGS</code> and <code>LDFLAGS</code> to inject extra flags - with the same caveat as in the previous section about those environment variables being picked up only for a clean build and not an incremental build.</p> </section> <section id="using-different-build-types-with-meson"> <h2>Using different build types with Meson</h2> <p>Meson provides different build types while configuring the project. You can see the available options for build types in <a class="reference external" href="https://mesonbuild.com/Builtin-options.html#core-options">the “core options” section of the Meson documentation</a>.</p> <p>Assuming that you are building from scratch (do <code>git clean -xdf</code> if needed), you can configure the build as following to use the <code>debug</code> build type:</p> <pre data-language="python">spin build -- -Dbuildtype=debug
</pre> <p>Now, you can use the <code>spin</code> interface for further building, installing and testing NumPy as normal:</p> <pre data-language="python">spin test -s linalg
</pre> <p>This will work because after initial configuration, Meson will remember the config options.</p> </section> <section id="controlling-build-parallelism"> <h2>Controlling build parallelism</h2> <p>By default, <code>ninja</code> will launch <code>2*n_cpu + 2</code>, with <code>n_cpu</code> the number of physical CPU cores, parallel build jobs. This is fine in the vast majority of cases, and results in close to optimal build times. In some cases, on machines with a small amount of RAM relative to the number of CPU cores, this leads to a job running out of memory. In case that happens, lower the number of jobs <code>N</code> such that you have at least 2 GB RAM per job. For example, to launch 6 jobs:</p> <pre data-language="python">python -m pip install . -Ccompile-args="-j6"
</pre> <p>or:</p> <pre data-language="python">spin build -j6
</pre> </section> </section><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2005&ndash;2024 NumPy Developers<br>Licensed under the 3-clause BSD License.<br>
    <a href="https://numpy.org/doc/2.0/building/compilers_and_options.html" class="_attribution-link">https://numpy.org/doc/2.0/building/compilers_and_options.html</a>
  </p>
</div>
