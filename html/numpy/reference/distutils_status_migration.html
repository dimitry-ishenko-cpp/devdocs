<section id="status-of-numpy-distutils-and-migration-advice"> <h1 id="distutils-status-migration">Status of numpy.distutils and migration advice</h1> <p><a class="reference internal" href="distutils.html#module-numpy.distutils" title="numpy.distutils"><code>numpy.distutils</code></a> has been deprecated in NumPy <code>1.23.0</code>. It will be removed for Python 3.12; for Python &lt;= 3.11 it will not be removed until 2 years after the Python 3.12 release (Oct 2025).</p> <div class="admonition warning"> <p class="admonition-title">Warning</p> <p><code>numpy.distutils</code> is only tested with <code>setuptools &lt; 60.0</code>, newer versions may break. See <a class="reference internal" href="#numpy-setuptools-interaction"><span class="std std-ref">Interaction of numpy.distutils with setuptools</span></a> for details.</p> </div> <section id="migration-advice"> <h2>Migration advice</h2> <p>There are several build systems which are good options to migrate to. Assuming you have compiled code in your package (if not, you have several good options, e.g. the build backends offered by Poetry, Hatch or PDM) and you want to be using a well-designed, modern and reliable build system, we recommend:</p> <ol class="arabic simple"> <li>
<a class="reference external" href="https://mesonbuild.com/">Meson</a>, and the <a class="reference external" href="https://meson-python.readthedocs.io">meson-python</a> build backend</li> <li>
<a class="reference external" href="https://cmake.org/">CMake</a>, and the <a class="reference external" href="https://scikit-build-core.readthedocs.io/en/latest/">scikit-build-core</a> build backend</li> </ol> <p>If you have modest needs (only simple Cython/C extensions; no need for Fortran, BLAS/LAPACK, nested <code>setup.py</code> files, or other features of <code>numpy.distutils</code>) and have been happy with <code>numpy.distutils</code> so far, you can also consider switching to <code>setuptools</code>. Note that most functionality of <code>numpy.distutils</code> is unlikely to be ported to <code>setuptools</code>.</p> <section id="moving-to-meson"> <h3>Moving to Meson</h3> <p>SciPy has moved to Meson and meson-python for its 1.9.0 release. During this process, remaining issues with Mesonâ€™s Python support and feature parity with <code>numpy.distutils</code> were resolved. <em>Note: parity means a large superset (because Meson is a good general-purpose build system); only a few BLAS/LAPACK library selection niceties are missing</em>. SciPy uses almost all functionality that <code>numpy.distutils</code> offers, so if SciPy has successfully made a release with Meson as the build system, there should be no blockers left to migrate, and SciPy will be a good reference for other packages who are migrating. For more details about the SciPy migration, see:</p> <ul class="simple"> <li><a class="reference external" href="https://github.com/scipy/scipy/issues/13615">RFC: switch to Meson as a build system</a></li> <li><a class="reference external" href="https://github.com/rgommers/scipy/issues/22">Tracking issue for Meson support</a></li> </ul> <p>NumPy will migrate to Meson for the 1.26 release.</p> </section> <section id="moving-to-cmake-scikit-build"> <h3>Moving to CMake / scikit-build</h3> <p>The next generation of scikit-build is called <a class="reference external" href="https://scikit-build-core.readthedocs.io/en/latest/">scikit-build-core</a>. Where the older <code>scikit-build</code> used <code>setuptools</code> underneath, the rewrite does not. Like Meson, CMake is a good general-purpose build system.</p> </section> <section id="moving-to-setuptools"> <h3>Moving to <code>setuptools</code>
</h3> <p>For projects that only use <code>numpy.distutils</code> for historical reasons, and do not actually use features beyond those that <code>setuptools</code> also supports, moving to <code>setuptools</code> is likely the solution which costs the least effort. To assess that, there are the <code>numpy.distutils</code> features that are <em>not</em> present in <code>setuptools</code>:</p> <ul class="simple"> <li>Nested <code>setup.py</code> files</li> <li>Fortran build support</li> <li>BLAS/LAPACK library support (OpenBLAS, MKL, ATLAS, Netlib LAPACK/BLAS, BLIS, 64-bit ILP interface, etc.)</li> <li>Support for a few other scientific libraries, like FFTW and UMFPACK</li> <li>Better MinGW support</li> <li>Per-compiler build flag customization (e.g. <code>-O3</code> and <code>SSE2</code> flags are default)</li> <li>a simple user build config system, see <a class="reference external" href="https://github.com/numpy/numpy/blob/master/site.cfg.example">site.cfg.example</a>
</li> <li>SIMD intrinsics support</li> <li>Support for the NumPy-specific <code>.src</code> templating format for <code>.c</code>/<code>.h</code> files</li> </ul> <p>The most widely used feature is nested <code>setup.py</code> files. This feature may perhaps still be ported to <code>setuptools</code> in the future (it needs a volunteer though, see <a class="reference external" href="https://github.com/numpy/numpy/issues/18588">gh-18588</a> for status). Projects only using that feature could move to <code>setuptools</code> after that is done. In case a project uses only a couple of <code>setup.py</code> files, it also could make sense to simply aggregate all the content of those files into a single <code>setup.py</code> file and then move to <code>setuptools</code>. This involves dropping all <code>Configuration</code> instances, and using <code>Extension</code> instead. E.g.,:</p> <pre data-language="python">from distutils.core import setup
from distutils.extension import Extension
setup(name='foobar',
      version='1.0',
      ext_modules=[
          Extension('foopkg.foo', ['foo.c']),
          Extension('barpkg.bar', ['bar.c']),
          ],
      )
</pre> <p>For more details, see the <a class="reference external" href="https://setuptools.pypa.io/en/latest/setuptools.html">setuptools documentation</a></p> </section> </section> <section id="interaction-of-numpy-distutils-with-setuptools"> <h2 id="numpy-setuptools-interaction">Interaction of <code>numpy.distutils</code> with <code>setuptools</code>
</h2> <p>It is recommended to use <code>setuptools &lt; 60.0</code>. Newer versions may work, but are not guaranteed to. The reason for this is that <code>setuptools</code> 60.0 enabled a vendored copy of <code>distutils</code>, including backwards incompatible changes that affect some functionality in <code>numpy.distutils</code>.</p> <p>If you are using only simple Cython or C extensions with minimal use of <code>numpy.distutils</code> functionality beyond nested <code>setup.py</code> files (its most popular feature, see <a class="reference internal" href="distutils.html#numpy.distutils.misc_util.Configuration" title="numpy.distutils.misc_util.Configuration"><code>Configuration</code></a>), then latest <code>setuptools</code> is likely to continue working. In case of problems, you can also try <code>SETUPTOOLS_USE_DISTUTILS=stdlib</code> to avoid the backwards incompatible changes in <code>setuptools</code>.</p> <p>Whatever you do, it is recommended to put an upper bound on your <code>setuptools</code> build requirement in <code>pyproject.toml</code> to avoid future breakage - see <a class="reference internal" href="../dev/depending_on_numpy.html#for-downstream-package-authors"><span class="std std-ref">For downstream package authors</span></a>.</p> </section> </section><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2005&ndash;2024 NumPy Developers<br>Licensed under the 3-clause BSD License.<br>
    <a href="https://numpy.org/doc/2.0/reference/distutils_status_migration.html" class="_attribution-link">https://numpy.org/doc/2.0/reference/distutils_status_migration.html</a>
  </p>
</div>
