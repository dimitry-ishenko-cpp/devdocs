<section id="compatibility-policy"> <h1 id="random-compatibility">Compatibility policy</h1> <p><a class="reference internal" href="index.html#module-numpy.random" title="numpy.random"><code>numpy.random</code></a> has a somewhat stricter compatibility policy than the rest of NumPy. Users of pseudorandomness often have use cases for being able to reproduce runs in fine detail given the same seed (so-called “stream compatibility”), and so we try to balance those needs with the flexibility to enhance our algorithms. <a class="reference external" href="https://numpy.org/neps/nep-0019-rng-policy.html#nep19" title="(in NumPy Enhancement Proposals)"><span class="xref std std-ref">NEP 19</span></a> describes the evolution of this policy.</p> <p>The main kind of compatibility that we enforce is stream-compatibility from run to run under certain conditions. If you create a <a class="reference internal" href="generator.html#numpy.random.Generator" title="numpy.random.Generator"><code>Generator</code></a> with the same <a class="reference internal" href="bit_generators/generated/numpy.random.bitgenerator.html#numpy.random.BitGenerator" title="numpy.random.BitGenerator"><code>BitGenerator</code></a>, with the same seed, perform the same sequence of method calls with the same arguments, on the same build of <code>numpy</code>, in the same environment, on the same machine, you should get the same stream of numbers. Note that these conditions are very strict. There are a number of factors outside of NumPy’s control that limit our ability to guarantee much more than this. For example, different CPUs implement floating point arithmetic differently, and this can cause differences in certain edge cases that cascade to the rest of the stream. <a class="reference internal" href="generated/numpy.random.generator.multivariate_normal.html#numpy.random.Generator.multivariate_normal" title="numpy.random.Generator.multivariate_normal"><code>Generator.multivariate_normal</code></a>, for another example, uses a matrix decomposition from <a class="reference internal" href="../routines.linalg.html#module-numpy.linalg" title="numpy.linalg"><code>numpy.linalg</code></a>. Even on the same platform, a different build of <code>numpy</code> may use a different version of this matrix decomposition algorithm from the LAPACK that it links to, causing <a class="reference internal" href="generated/numpy.random.generator.multivariate_normal.html#numpy.random.Generator.multivariate_normal" title="numpy.random.Generator.multivariate_normal"><code>Generator.multivariate_normal</code></a> to return completely different (but equally valid!) results. We strive to prefer algorithms that are more resistant to these effects, but this is always imperfect.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>Most of the <a class="reference internal" href="generator.html#numpy.random.Generator" title="numpy.random.Generator"><code>Generator</code></a> methods allow you to draw multiple values from a distribution as arrays. The requested size of this array is a parameter, for the purposes of the above policy. Calling <code>rng.random()</code> 5 times is not <em>guaranteed</em> to give the same numbers as <code>rng.random(5)</code>. We reserve the ability to decide to use different algorithms for different-sized blocks. In practice, this happens rarely.</p> </div> <p>Like the rest of NumPy, we generally maintain API source compatibility from version to version. If we <em>must</em> make an API-breaking change, then we will only do so with an appropriate deprecation period and warnings, according to <a class="reference external" href="https://numpy.org/neps/nep-0023-backwards-compatibility.html#nep23" title="(in NumPy Enhancement Proposals)"><span class="xref std std-ref">general NumPy policy</span></a>.</p> <p>Breaking stream-compatibility in order to introduce new features or improve performance in <a class="reference internal" href="generator.html#numpy.random.Generator" title="numpy.random.Generator"><code>Generator</code></a> or <a class="reference internal" href="generator.html#numpy.random.default_rng" title="numpy.random.default_rng"><code>default_rng</code></a> will be <em>allowed</em> with <em>caution</em>. Such changes will be considered features, and as such will be no faster than the standard release cadence of features (i.e. on <code>X.Y</code> releases, never <code>X.Y.Z</code>). Slowness will not be considered a bug for this purpose. Correctness bug fixes that break stream-compatibility can happen on bugfix releases, per usual, but developers should consider if they can wait until the next feature release. We encourage developers to strongly weight user’s pain from the break in stream-compatibility against the improvements. One example of a worthwhile improvement would be to change algorithms for a significant increase in performance, for example, moving from the <a class="reference external" href="https://en.wikipedia.org/wiki/Box%E2%80%93Muller_transform">Box-Muller transform</a> method of Gaussian variate generation to the faster <a class="reference external" href="https://en.wikipedia.org/wiki/Ziggurat_algorithm">Ziggurat algorithm</a>. An example of a discouraged improvement would be tweaking the Ziggurat tables just a little bit for a small performance improvement.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>In particular, <a class="reference internal" href="generator.html#numpy.random.default_rng" title="numpy.random.default_rng"><code>default_rng</code></a> is allowed to change the default <a class="reference internal" href="bit_generators/generated/numpy.random.bitgenerator.html#numpy.random.BitGenerator" title="numpy.random.BitGenerator"><code>BitGenerator</code></a> that it uses (again, with <em>caution</em> and plenty of advance warning).</p> </div> <p>In general, <a class="reference internal" href="bit_generators/generated/numpy.random.bitgenerator.html#numpy.random.BitGenerator" title="numpy.random.BitGenerator"><code>BitGenerator</code></a> classes have stronger guarantees of version-to-version stream compatibility. This allows them to be a firmer building block for downstream users that need it. Their limited API surface makes it easier for them to maintain this compatibility from version to version. See the docstrings of each <a class="reference internal" href="bit_generators/generated/numpy.random.bitgenerator.html#numpy.random.BitGenerator" title="numpy.random.BitGenerator"><code>BitGenerator</code></a> class for their individual compatibility guarantees.</p> <p>The legacy <a class="reference internal" href="legacy.html#numpy.random.RandomState" title="numpy.random.RandomState"><code>RandomState</code></a> and the <a class="reference internal" href="legacy.html#functions-in-numpy-random"><span class="std std-ref">associated convenience functions</span></a> have a stricter version-to-version compatibility guarantee. For reasons outlined in <a class="reference external" href="https://numpy.org/neps/nep-0019-rng-policy.html#nep19" title="(in NumPy Enhancement Proposals)"><span class="xref std std-ref">NEP 19</span></a>, we had made stronger promises about their version-to-version stability early in NumPy’s development. There are still some limited use cases for this kind of compatibility (like generating data for tests), so we maintain as much compatibility as we can. There will be no more modifications to <a class="reference internal" href="legacy.html#numpy.random.RandomState" title="numpy.random.RandomState"><code>RandomState</code></a>, not even to fix correctness bugs. There are a few gray areas where we can make minor fixes to keep <a class="reference internal" href="legacy.html#numpy.random.RandomState" title="numpy.random.RandomState"><code>RandomState</code></a> working without segfaulting as NumPy’s internals change, and some docstring fixes. However, the previously-mentioned caveats about the variability from machine to machine and build to build still apply to <a class="reference internal" href="legacy.html#numpy.random.RandomState" title="numpy.random.RandomState"><code>RandomState</code></a> just as much as it does to <a class="reference internal" href="generator.html#numpy.random.Generator" title="numpy.random.Generator"><code>Generator</code></a>.</p> </section><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2005&ndash;2024 NumPy Developers<br>Licensed under the 3-clause BSD License.<br>
    <a href="https://numpy.org/doc/2.0/reference/random/compatibility.html" class="_attribution-link">https://numpy.org/doc/2.0/reference/random/compatibility.html</a>
  </p>
</div>
