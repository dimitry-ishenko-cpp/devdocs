<h1 tabindex="-1" dir="auto" id="context">Context</h1> <p dir="auto">A Koa Context encapsulates Node's <code>request</code> and <code>response</code> objects into a single object which provides many helpful methods for writing web applications and APIs. These operations are used so frequently in HTTP server development that they are added at this level instead of a higher level framework, which would force middleware to re-implement this common functionality.</p> <p dir="auto">A <code>Context</code> is created <em>per</em> request, and is referenced in middleware as the receiver, or the <code>ctx</code> identifier, as shown in the following snippet:</p> <pre data-language="js">app.use(async ctx =&gt; {
  ctx; // is the Context
  ctx.request; // is a Koa Request
  ctx.response; // is a Koa Response
});</pre> <p dir="auto">Many of the context's accessors and methods simply delegate to their <code>ctx.request</code> or <code>ctx.response</code> equivalents for convenience, and are otherwise identical. For example <code>ctx.type</code> and <code>ctx.length</code> delegate to the <code>response</code> object, and <code>ctx.path</code> and <code>ctx.method</code> delegate to the <code>request</code>.</p> <h2 tabindex="-1" dir="auto" id="api">API</h2> <p dir="auto"><code>Context</code> specific methods and accessors.</p> <h3 tabindex="-1" dir="auto" id="ctxreq">ctx.req</h3> <p dir="auto">Node's <code>request</code> object.</p> <h3 tabindex="-1" dir="auto" id="ctxres">ctx.res</h3> <p dir="auto">Node's <code>response</code> object.</p> <p dir="auto">Bypassing Koa's response handling is <strong>not supported</strong>. Avoid using the following Node properties:</p> <ul dir="auto"> <li><code>res.statusCode</code></li> <li><code>res.writeHead()</code></li> <li><code>res.write()</code></li> <li><code>res.end()</code></li> </ul> <h3 tabindex="-1" dir="auto" id="ctxrequest">ctx.request</h3> <p dir="auto">A Koa <code>Request</code> object.</p> <h3 tabindex="-1" dir="auto" id="ctxresponse">ctx.response</h3> <p dir="auto">A Koa <code>Response</code> object.</p> <h3 tabindex="-1" dir="auto" id="ctxstate">ctx.state</h3> <p dir="auto">The recommended namespace for passing information through middleware and to your frontend views.</p> <pre data-language="js">ctx.state.user = await User.find(id);</pre> <h3 tabindex="-1" dir="auto" id="ctxapp">ctx.app</h3> <p dir="auto">Application instance reference.</p> <h3 tabindex="-1" dir="auto" id="ctxappemit">ctx.app.emit</h3> <p dir="auto">Koa applications extend an internal <a href="https://nodejs.org/dist/latest-v11.x/docs/api/events.html" rel="nofollow">EventEmitter</a>. <code>ctx.app.emit</code> emits an event with a type, defined by the first argument. For each event you can hook up "listeners", which is a function that is called when the event is emitted. Consult the <a href="../error-handling.md.html" rel="nofollow">error handling docs</a> for more information.</p> <h3 tabindex="-1" dir="auto" id="ctxcookiesgetname-options">ctx.cookies.get(name, [options])</h3> <p dir="auto">Get cookie <code>name</code> with <code>options</code>:</p> <ul dir="auto"> <li>
<code>signed</code> the cookie requested should be signed</li> </ul> <p dir="auto">Koa uses the <a href="https://github.com/pillarjs/cookies">cookies</a> module where options are simply passed.</p> <h3 tabindex="-1" dir="auto" id="ctxcookiessetname-value-options">ctx.cookies.set(name, value, [options])</h3> <p dir="auto">Set cookie <code>name</code> to <code>value</code> with <code>options</code>:</p> <ul dir="auto"> <li>
<code>maxAge</code>: a number representing the milliseconds from <code>Date.now()</code> for expiry.</li> <li>
<code>expires</code>: a <code>Date</code> object indicating the cookie's expiration date (expires at the end of session by default).</li> <li>
<code>path</code>: a string indicating the path of the cookie (<code>/</code> by default).</li> <li>
<code>domain</code>: a string indicating the domain of the cookie (no default).</li> <li>
<code>secure</code>: a boolean indicating whether the cookie is only to be sent over HTTPS (<code>false</code> by default for HTTP, <code>true</code> by default for HTTPS). <a href="https://github.com/pillarjs/cookies#secure-cookies">Read more about this option</a>.</li> <li>
<code>httpOnly</code>: a boolean indicating whether the cookie is only to be sent over HTTP(S), and not made available to client JavaScript (<code>true</code> by default).</li> <li>
<code>sameSite</code>: a boolean or string indicating whether the cookie is a "same site" cookie (<code>false</code> by default). This can be set to <code>'strict'</code>, <code>'lax'</code>, <code>'none'</code>, or <code>true</code> (which maps to <code>'strict'</code>).</li> <li>
<code>signed</code>: a boolean indicating whether the cookie is to be signed (<code>false</code> by default). If this is true, another cookie of the same name with the <code>.sig</code> suffix appended will also be sent, with a 27-byte url-safe base64 SHA1 value representing the hash of <em>cookie-name</em>=<em>cookie-value</em> against the first <a href="https://www.npmjs.com/package/keygrip" rel="nofollow">Keygrip</a> key. This signature key is used to detect tampering the next time a cookie is received.</li> <li>
<code>overwrite</code>: a boolean indicating whether to overwrite previously set cookies of the same name (<code>false</code> by default). If this is true, all cookies set during the same request with the same name (regardless of path or domain) are filtered out of the Set-Cookie header when setting this cookie.</li> </ul> <p dir="auto">Koa uses the <a href="https://github.com/pillarjs/cookies">cookies</a> module where options are simply passed.</p> <h3 tabindex="-1" dir="auto" id="ctxthrowstatus-msg-properties">ctx.throw([status], [msg], [properties])</h3> <p dir="auto">Helper method to throw an error with a <code>.status</code> property defaulting to <code>500</code> that will allow Koa to respond appropriately. The following combinations are allowed:</p> <pre data-language="js">ctx.throw(400);
ctx.throw(400, 'name required');
ctx.throw(400, 'name required', { user: user });</pre> <p dir="auto">For example <code>ctx.throw(400, 'name required')</code> is equivalent to:</p> <pre data-language="js">const err = new Error('name required');
err.status = 400;
err.expose = true;
throw err;</pre> <p dir="auto">Note that these are user-level errors and are flagged with <code>err.expose</code> meaning the messages are appropriate for client responses, which is typically not the case for error messages since you do not want to leak failure details.</p> <p dir="auto">You may optionally pass a <code>properties</code> object which is merged into the error as-is, useful for decorating machine-friendly errors which are reported to the requester upstream.</p> <pre data-language="js">ctx.throw(401, 'access_denied', { user: user });</pre> <p dir="auto">Koa uses <a href="https://github.com/jshttp/http-errors">http-errors</a> to create errors. <code>status</code> should only be passed as the first parameter.</p> <h3 tabindex="-1" dir="auto" id="ctxassertvalue-status-msg-properties">ctx.assert(value, [status], [msg], [properties])</h3> <p dir="auto">Helper method to throw an error similar to <code>.throw()</code> when <code>!value</code>. Similar to Node's <a href="http://nodejs.org/api/assert.html" rel="nofollow">assert()</a> method.</p> <pre data-language="js">ctx.assert(ctx.state.user, 401, 'User not found. Please login!');</pre> <p dir="auto">Koa uses <a href="https://github.com/jshttp/http-assert">http-assert</a> for assertions.</p> <h3 tabindex="-1" dir="auto" id="ctxrespond">ctx.respond</h3> <p dir="auto">To bypass Koa's built-in response handling, you may explicitly set <code>ctx.respond = false;</code>. Use this if you want to write to the raw <code>res</code> object instead of letting Koa handle the response for you.</p> <p dir="auto">Note that using this is <strong>not</strong> supported by Koa. This may break intended functionality of Koa middleware and Koa itself. Using this property is considered a hack and is only a convenience to those wishing to use traditional <code>fn(req, res)</code> functions and middleware within Koa.</p> <h2 tabindex="-1" dir="auto" id="request-aliases">Request aliases</h2> <p dir="auto">The following accessors and alias <a href="https://github.com/koajs/koa/blob/master/docs/api/request.md">Request</a> equivalents:</p> <ul dir="auto"> <li><code>ctx.header</code></li> <li><code>ctx.headers</code></li> <li><code>ctx.method</code></li> <li><code>ctx.method=</code></li> <li><code>ctx.url</code></li> <li><code>ctx.url=</code></li> <li><code>ctx.originalUrl</code></li> <li><code>ctx.origin</code></li> <li><code>ctx.href</code></li> <li><code>ctx.path</code></li> <li><code>ctx.path=</code></li> <li><code>ctx.query</code></li> <li><code>ctx.query=</code></li> <li><code>ctx.querystring</code></li> <li><code>ctx.querystring=</code></li> <li><code>ctx.host</code></li> <li><code>ctx.hostname</code></li> <li><code>ctx.fresh</code></li> <li><code>ctx.stale</code></li> <li><code>ctx.socket</code></li> <li><code>ctx.protocol</code></li> <li><code>ctx.secure</code></li> <li><code>ctx.ip</code></li> <li><code>ctx.ips</code></li> <li><code>ctx.subdomains</code></li> <li><code>ctx.is()</code></li> <li><code>ctx.accepts()</code></li> <li><code>ctx.acceptsEncodings()</code></li> <li><code>ctx.acceptsCharsets()</code></li> <li><code>ctx.acceptsLanguages()</code></li> <li><code>ctx.get()</code></li> </ul> <h2 tabindex="-1" dir="auto" id="response-aliases">Response aliases</h2> <p dir="auto">The following accessors and alias <a href="https://github.com/koajs/koa/blob/master/docs/api/response.md">Response</a> equivalents:</p> <ul dir="auto"> <li><code>ctx.body</code></li> <li><code>ctx.body=</code></li> <li><code>ctx.has()</code></li> <li><code>ctx.status</code></li> <li><code>ctx.status=</code></li> <li><code>ctx.message</code></li> <li><code>ctx.message=</code></li> <li><code>ctx.length=</code></li> <li><code>ctx.length</code></li> <li><code>ctx.type=</code></li> <li><code>ctx.type</code></li> <li><code>ctx.vary()</code></li> <li><code>ctx.headerSent</code></li> <li><code>ctx.redirect()</code></li> <li><code>ctx.attachment()</code></li> <li><code>ctx.set()</code></li> <li><code>ctx.append()</code></li> <li><code>ctx.remove()</code></li> <li><code>ctx.lastModified=</code></li> <li><code>ctx.etag=</code></li> <li><code>ctx.writable</code></li> </ul><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2020 Koa contributors<br>Licensed under the MIT License.<br>
    <a href="https://github.com/koajs/koa/tree/master/docs/api/context.md" class="_attribution-link">https://github.com/koajs/koa/tree/master/docs/api/context.md</a>
  </p>
</div>
