<h1 class="title">External API access</h1> <div class="alg-content">
<blockquote class="infobox infobox-info">
<p><strong>Note:</strong> the following examples use the JavaScript driver. See the <a href="https://rethinkdb.com/api/javascript/http/">r.http</a> command reference for documentation for other languages.</p> </blockquote> <div class="toc">  <ul id="markdown-toc"> <li><a href="#basic-usage" id="markdown-toc-basic-usage">Basic usage</a></li> <li><a href="#accessing-json-apis" id="markdown-toc-accessing-json-apis">Accessing JSON APIs</a></li> <li><a href="#storing-and-enriching-api-data" id="markdown-toc-storing-and-enriching-api-data">Storing and enriching API data</a></li> <li><a href="#pagination" id="markdown-toc-pagination">Pagination</a></li> <li><a href="#authentication" id="markdown-toc-authentication">Authentication</a></li> <li><a href="#read-more" id="markdown-toc-read-more">Read more</a></li> </ul> </div> <p>RethinkDB provides an <a href="https://rethinkdb.com/api/javascript/http/">r.http</a> command for accessing external APIs directly from the database. Since many APIs accept and return JSON, RethinkDB is a convenient platform for manipulating and analyzing API data, both interactively and in running applications. Make sure that you <strong>never</strong> use this command for <strong>user provided</strong> URLs.</p> <h2 id="basic-usage">Basic usage</h2> <p>Let’s try something very simple — accessing a website. Type the following command in the Data Explorer and hit ‘Run’ (alternatively, you can run it from a RethinkDB driver):</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight" data-language="">r.http('www.google.com')
</pre></div></div> <p>The <code class="language-plaintext highlighter-rouge">r.http</code> command will issue a request to <code class="language-plaintext highlighter-rouge">www.google.com</code> directly from the database and return a string with the source of Google’s homepage.</p> <h2 id="accessing-json-apis">Accessing JSON APIs</h2> <p>Now let’s access a real JSON API. In this example we’re going to use GitHub — a collaborative development platform that hosts thousands of open-source projects. Users on GitHub can indicate interest by starring projects and following other users. GitHub calls users who starred other projects “stargazers”.</p> <p>Let’s find the most influential GitHub users who showed interest in RethinkDB. First, let’s grab the list of RethinkDB stargazers:</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight" data-language="">r.http('https://api.github.com/repos/rethinkdb/rethinkdb/stargazers')
</pre></div></div> <p>This query makes a call to GitHub and returns an array of JSON documents. RethinkDB natively operates on JSON, and what’s really convenient about <code class="language-plaintext highlighter-rouge">r.http</code> is that its output is no different from any other query. You can use ReQL commands to perform operations on the output of <code class="language-plaintext highlighter-rouge">r.http</code>, just like on a standard RethinkDB table!</p> <p>For example, let’s count the number of results returned by the API:</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight" data-language="">r.http('https://api.github.com/repos/rethinkdb/rethinkdb/stargazers').count()
</pre></div></div> <p>Or, let’s pluck out usernames and IDs, and sort the array in ascending order by user IDs:</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight" data-language="">r.http('https://api.github.com/repos/rethinkdb/rethinkdb/stargazers')
 .pluck('login', 'id').orderBy('id')
</pre></div></div> <p>You can chain as many ReQL commands as necessary to perform data manipulation tasks. Since ReQL is explicitly designed for JSON querying and modification, it’s also an excellent language for operating on web services!</p> <h2 id="storing-and-enriching-api-data">Storing and enriching API data</h2> <p>Since you’ll be doing more manipulation on the data, you might want to store the results of an API call in the database. Let’s create a table <code class="language-plaintext highlighter-rouge">stargazers</code> and insert the RethinkDB stargazers into this table:</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight" data-language="">r.tableCreate('stargazers');
r.table('stargazers').insert(
  r.http('https://api.github.com/repos/rethinkdb/rethinkdb/stargazers'));
</pre></div></div> <p>Now we’d like to sort RethinkDB stargazers by influence. When you request stargazers from GitHub, the GitHub API doesn’t include the number of followers for each stargazer, but it does include a field <code class="language-plaintext highlighter-rouge">url</code> specific to each stargazer. If you follow this URL, the GitHub API will return additional information for the user, including the number of their followers.</p> <p>Let’s update our stargazer data with this additional information:</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight" data-language="">r.table('stargazers').update(r.http(r.row('url')), {nonAtomic: true})
</pre></div></div> <p>The update command will go through every row and issue an API request to the GitHub URL for the given user, grab the relevant data, and update the user information with that data!</p> <p>We can now sort the stargazers by the number of their followers!</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight" data-language="">r.table('stargazers').orderBy(r.desc('followers'))
</pre></div></div> <h2 id="pagination">Pagination</h2> <p>The calls above only return a few dozen stargazers while RethinkDB has thousands. Most APIs paginate large result sets and GitHub is no exception. The <code class="language-plaintext highlighter-rouge">r.http</code> command has built-in support for pagination via the <code class="language-plaintext highlighter-rouge">page</code> and <code class="language-plaintext highlighter-rouge">pageLimit</code> arguments. Let’s get ten pages of stargazers from GitHub instead of one:</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight" data-language="">r.http('https://api.github.com/repos/rethinkdb/rethinkdb/stargazers',
       { page: 'link-next', pageLimit: 10 })
</pre></div></div> <p>The <code class="language-plaintext highlighter-rouge">page</code> argument takes the type of pagination mechanism used by the API. In this case GitHub uses the standard link header mechanism <code class="language-plaintext highlighter-rouge">link-next</code>, but you can also specify custom pagination schemes for unusual APIs. The <code class="language-plaintext highlighter-rouge">page-limit</code> argument specifies the number of pages you’d like to get. See the <a href="https://rethinkdb.com/api/javascript/http/">API reference</a> for more details.</p> <p>When you turn on pagination in <code class="language-plaintext highlighter-rouge">r.http</code>, instead of returning an array of documents, RethinkDB returns a stream which you can access in the driver via the usual cursor API. This is significant because pagination happens lazily — RethinkDB will request new pages as you iterate through the cursor to minimize the number of API calls.</p> <h2 id="authentication">Authentication</h2> <p>Most APIs support some form of authentication and rate limiting. The <code class="language-plaintext highlighter-rouge">r.http</code> command supports common forms of authentication (see the <a href="https://rethinkdb.com/api/javascript/http/">reference</a> for more details). For example, here is how you can use GitHub tokens with basic auth:</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight" data-language="">r.http('https://api.github.com/users/coffeemug', {
       auth: {
           user: GITHUB_TOKEN,
           pass: 'x-oauth-basic'
       }
})
</pre></div></div> <h2 id="read-more">Read more</h2> <p>Browse the following resources to learn more about ReQL and <code class="language-plaintext highlighter-rouge">r.http</code>:</p> <ul> <li>
<a href="https://rethinkdb.com/api/javascript/http">r.http</a> API reference</li> <li><a href="../introduction-to-reql/index.html">Introduction to ReQL</a></li> <li><a href="https://rethinkdb.com/blog/lambda-functions/">Lambda functions in RethinkDB</a></li> </ul> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; RethinkDB contributors<br>Licensed under the Creative Commons Attribution-ShareAlike 3.0 Unported License.<br>
    <a href="https://rethinkdb.com/docs/external-api-access/" class="_attribution-link">https://rethinkdb.com/docs/external-api-access/</a>
  </p>
</div>
