<h1 class="title">Migrating data from previous versions of RethinkDB</h1> <div class="alg-content">
<p>The steps necessary for migrating data to current RethinkDB versions from previous ones depend on which version you’re migrating from.</p> <div class="toc">  <ul id="markdown-toc"> <li><a href="#back-up-your-data" id="markdown-toc-back-up-your-data">Back up your data</a></li> <li><a href="#rebuild-indexes" id="markdown-toc-rebuild-indexes">Rebuild indexes</a></li> <li><a href="#migrating-old-data" id="markdown-toc-migrating-old-data">Migrating old data</a></li> <li><a href="#deprecated-versions" id="markdown-toc-deprecated-versions">Deprecated versions</a></li> </ul> </div> <ul> <li>
<strong>1.16 or higher:</strong> Migration is handled automatically. (This is also true for upgrading from 1.14 onward to versions earlier than 2.2.) After migration, follow the “Rebuild indexes” directions.</li> <li>
<strong>1.13–1.15:</strong> Upgrade to RethinkDB 2.0.5 <em>first,</em> rebuild the secondary indexes by following the “Rebuild indexes” directions, then upgrade to 2.1 or higher. (Migration from 2.0.5 to 2.1+ will be handled automatically.)</li> <li>
<strong>1.7–1.12:</strong> Follow the “Migrating old data” directions.</li> <li>
<strong>1.6 or earlier:</strong> Read the “Deprecated versions” section.</li> </ul> <h2 id="back-up-your-data">Back up your data</h2> <p>While it’s not strictly necessary to back up your data before upgrading, it’s always a good idea. You should make a backup by using the <code class="language-plaintext highlighter-rouge">dump</code> command <em>before</em> updating RethinkDB to its new version! Databases that have been automatically upgraded are not backward-compatible (that is, a database from version 1.14 cannot be used with version 1.13).</p> <p>Use the <code class="language-plaintext highlighter-rouge">dump</code> subcommand from the command line to create an archive of data from the cluster. This creates a <strong>tar.gz</strong> file consisting of JSON documents and additional table metadata.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight" data-language="">rethinkdb dump [options]
</pre></div></div> <p>The <code class="language-plaintext highlighter-rouge">restore</code> subcommand will reload a backup an archive into your cluster.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight" data-language="">rethinkdb restore filename
</pre></div></div> <p>Use <code class="language-plaintext highlighter-rouge">rethinkdb help &lt;command&gt;</code> for a list of options. For more details, see <a href="../backup/index.html">Backing up your data</a>.</p> <blockquote class="infobox infobox-alert">
<p><strong>Note:</strong> The <code class="language-plaintext highlighter-rouge">dump</code> and <code class="language-plaintext highlighter-rouge">restore</code> commands require the <a href="https://rethinkdb.com/docs/install-drivers/python/">Python driver</a> to be installed. Don’t upgrade the Python driver until <em>after</em> you’ve dumped the data!</p> <p>If you don’t have the Python driver installed, you can install a previous version using <code class="language-plaintext highlighter-rouge">pip install rethinkdb==&lt;version&gt;</code>. (You can use the <a href="https://pypi.python.org/pypi/rethinkdb" title="PyPI &gt; rethinkdb">Python Package Index</a> to check on current and older versions.)</p> </blockquote> <h2 id="rebuild-indexes">Rebuild indexes</h2> <p>When you upgrade a major release (i.e., 2.1 to 2.2), you should rebuild outdated secondary indexes manually. This can be done easily from the command line:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight" data-language="">rethinkdb index-rebuild
</pre></div></div> <p>This is <em>required</em> if you’re upgrading from versions before 1.16; in those cases, you’ll need to upgrade to version 2.0.5 first. (You can download 2.0.5 and other older versions at RethinkDB’s <a href="https://download.rethinkdb.com">download archive</a>). If you’re upgrading from RethinkDB version 1.16 or later, you can move to 2.2 or higher directly.</p> <p>Note that rebuilding indexes is <em>not</em> required if you’re upgrading between minor releases (i.e., 2.2.0 to 2.2.1).</p> <h2 id="migrating-old-data">Migrating old data</h2> <p><em>These steps are only necessary if you’re upgrading from RethinkDB version 1.7–1.12 to version 2.1 or higher.</em> If you’re using a later version, see the sections above. (If you’re using 1.6 or earlier, read the “<a href="#deprecated-versions">Deprecated versions</a>” section below.)</p> <p>Migration consists of three simple steps:</p> <ul> <li>Export your data from the existing version of RethinkDB</li> <li>Upgrade RethinkDB to a new version</li> <li>Import the data into the new version of RethinkDB</li> </ul> <blockquote class="infobox infobox-alert">
<p>You must export your data <strong>before</strong> you’ve upgraded RethinkDB to a new version! If you’ve already updated, you can find binaries for previous versions in the <a href="https://download.rethinkdb.com">download archive</a>.</p> </blockquote> <h3 id="exporting-your-data">Exporting your data</h3> <p>To export your data, use <code class="language-plaintext highlighter-rouge">rethinkdb dump</code>:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight" data-language="">rethinkdb dump -c &lt;host&gt;:&lt;port&gt;
</pre></div></div> <p>This command will export all your data to a <code class="language-plaintext highlighter-rouge">tar.gz</code> file named <code class="language-plaintext highlighter-rouge">rethinkdb_dump_&lt;timestamp&gt;.tar.gz</code> (this may vary depending on your platform).</p> <p>Use <code class="language-plaintext highlighter-rouge">rethinkdb help &lt;command&gt;</code> for a list of options. For more details, see <a href="../backup/index.html">Backing up your data</a>.</p> <h3 id="upgrading-rethinkdb">Upgrading RethinkDB</h3> <p>First, upgrade the RethinkDB server and drivers to the latest version:</p> <ul> <li>See <a href="https://rethinkdb.com/install">server install instructions</a> for your platform.</li> <li>See <a href="../install-drivers/index.html">driver install instructions</a> for your language.</li> </ul> <blockquote class="infobox ">
<p><strong>Keep in mind</strong>:</p> <ul> <li>Don’t upgrade the Python driver until <em>after</em> you’ve dumped the data.</li> <li>
<a href="https://rethinkdb.com/docs/install-drivers/python/">Upgrade</a> the Python driver for the <code class="language-plaintext highlighter-rouge">restore</code> step below.</li> </ul> </blockquote> <p>Then make sure to move or delete the old RethinkDB data directory (<code class="language-plaintext highlighter-rouge">rethinkdb_data</code> by default), since the new version will not be able to read the old file.</p> <h3 id="importing-your-data">Importing your data</h3> <p>To import your data, use <code class="language-plaintext highlighter-rouge">rethinkdb restore</code>:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight" data-language="">rethinkdb restore &lt;exported_file&gt; -c &lt;host&gt;:&lt;port&gt;
</pre></div></div> <p>Use <code class="language-plaintext highlighter-rouge">rethinkdb restore --help</code> to see the complete list of options for importing your data. Again, for more details, see <a href="../backup/index.html">Backing up your data</a>.</p> <p>After importing your data, you’ll need to rebuild your secondary indexes.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight" data-language="">rethinkdb index-rebuild
</pre></div></div> <blockquote class="infobox infobox-alert">
<p>The cluster configuration is <em>not</em> exported in backup. After a full restore, it will need to be manually reconfigured.</p> </blockquote> <h2 id="deprecated-versions">Deprecated versions</h2> <p>Upgrading from RethinkDB versions 1.6 or earlier has <em>not</em> been tested with RethinkDB 2.1 and higher. However, you should be able to use the deprecated <a href="https://github.com/rethinkdb/rethinkdb/tree/02b4f29e1e7f15b3edffcb68bf015578ec5783ab/scripts/migration">migration script</a>.</p> <p>Follow the directions in the README file to perform the migration.</p> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; RethinkDB contributors<br>Licensed under the Creative Commons Attribution-ShareAlike 3.0 Unported License.<br>
    <a href="https://rethinkdb.com/docs/migration/" class="_attribution-link">https://rethinkdb.com/docs/migration/</a>
  </p>
</div>
