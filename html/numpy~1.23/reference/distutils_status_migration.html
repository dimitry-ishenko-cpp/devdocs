<h1 id="distutils-status-migration">Status of numpy.distutils and migration advice</h1> <p><a class="reference internal" href="distutils.html#module-numpy.distutils" title="numpy.distutils"><code>numpy.distutils</code></a> has been deprecated in NumPy <code>1.23.0</code>. It will be removed for Python 3.12; for Python &lt;= 3.11 it will not be removed until 2 years after the Python 3.12 release (Oct 2025).</p> <div class="admonition warning"> <p class="admonition-title">Warning</p> <p><code>numpy.distutils</code> is only tested with <code>setuptools &lt; 60.0</code>, newer versions may break. See <a class="reference internal" href="#numpy-setuptools-interaction"><span class="std std-ref">Interaction of numpy.disutils with setuptools</span></a> for details.</p> </div> <section id="migration-advice"> <h2>Migration advice</h2> <p>It is <strong>not necessary</strong> to migrate immediately - the release date for Python 3.12 is October 2023. It may be beneficial to wait with migrating until there are examples from other projects to follow (see below).</p> <p>There are several build systems which are good options to migrate to. Assuming you have compiled code in your package (if not, we recommend using <a class="reference external" href="https://flit.readthedocs.io">Flit</a>) and you want to be using a well-designed, modern and reliable build system, we recommend:</p> <ol class="arabic simple"> <li><a class="reference external" href="https://mesonbuild.com/">Meson</a></li> <li>
<a class="reference external" href="https://cmake.org/">CMake</a> (or <a class="reference external" href="https://scikit-build.readthedocs.io/">scikit-build</a> as an interface to CMake)</li> </ol> <p>If you have modest needs (only simple Cython/C extensions, and perhaps nested <code>setup.py</code> files) and have been happy with <code>numpy.distutils</code> so far, you can also consider switching to <code>setuptools</code>. Note that most functionality of <code>numpy.disutils</code> is unlikely to be ported to <code>setuptools</code>.</p> <section id="moving-to-meson"> <h3>Moving to Meson</h3> <p>SciPy is moving to Meson for its 1.9.0 release, planned for July 2022. During this process, any remaining issues with Meson’s Python support and achieving feature parity with <code>numpy.distutils</code> will be resolved. <em>Note: parity means a large superset, but right now some BLAS/LAPACK support is missing and there are a few open issues related to Cython.</em> SciPy uses almost all functionality that <code>numpy.distutils</code> offers, so if SciPy has successfully made a release with Meson as the build system, there should be no blockers left to migrate, and SciPy will be a good reference for other packages who are migrating. For more details about the SciPy migration, see:</p> <ul class="simple"> <li><a class="reference external" href="https://github.com/scipy/scipy/issues/13615">RFC: switch to Meson as a build system</a></li> <li><a class="reference external" href="https://github.com/rgommers/scipy/issues/22">Tracking issue for Meson support</a></li> </ul> <p>NumPy itself will very likely migrate to Meson as well, once the SciPy migration is done.</p> </section> <section id="moving-to-cmake-scikit-build"> <h3>Moving to CMake / scikit-build</h3> <p>See the <a class="reference external" href="https://scikit-build.readthedocs.io/en/latest/">scikit-build documentation</a> for how to use scikit-build. Please note that as of Feb 2022, scikit-build still relies on setuptools, so it’s probably not quite ready yet for a post-distutils world. How quickly this changes depends on funding, the current (Feb 2022) estimate is that if funding arrives then a viable <code>numpy.distutils</code> replacement will be ready at the end of 2022, and a very polished replacement mid-2023. For more details on this, see <a class="reference external" href="https://iscinumpy.gitlab.io/post/scikit-build-proposal/">this blog post by Henry Schreiner</a>.</p> </section> <section id="moving-to-setuptools"> <h3>Moving to <code>setuptools</code>
</h3> <p>For projects that only use <code>numpy.distutils</code> for historical reasons, and do not actually use features beyond those that <code>setuptools</code> also supports, moving to <code>setuptools</code> is likely the solution which costs the least effort. To assess that, there are the <code>numpy.distutils</code> features that are <em>not</em> present in <code>setuptools</code>:</p> <ul class="simple"> <li>Nested <code>setup.py</code> files</li> <li>Fortran build support</li> <li>BLAS/LAPACK library support (OpenBLAS, MKL, ATLAS, Netlib LAPACK/BLAS, BLIS, 64-bit ILP interface, etc.)</li> <li>Support for a few other scientific libraries, like FFTW and UMFPACK</li> <li>Better MinGW support</li> <li>Per-compiler build flag customization (e.g. <code>-O3</code> and <code>SSE2</code> flags are default)</li> <li>a simple user build config system, see [site.cfg.example](<a class="reference external" href="https://github.com/numpy/numpy/blob/master/site.cfg.example">https://github.com/numpy/numpy/blob/master/site.cfg.example</a>)</li> <li>SIMD intrinsics support</li> </ul> <p>The most widely used feature is nested <code>setup.py</code> files. This feature will likely be ported to <code>setuptools</code> (see <a class="reference external" href="https://github.com/numpy/numpy/issues/18588">gh-18588</a> for status). Projects only using that feature could move to <code>setuptools</code> after that is done. In case a project uses only a couple of <code>setup.py</code> files, it also could make sense to simply aggregate all the content of those files into a single <code>setup.py</code> file and then move to <code>setuptools</code>. This involves dropping all <code>Configuration</code> instances, and using <code>Extension</code> instead. E.g.,:</p> <pre data-language="python">from distutils.core import setup
from distutils.extension import Extension
setup(name='foobar',
      version='1.0',
      ext_modules=[
          Extension('foopkg.foo', ['foo.c']),
          Extension('barpkg.bar', ['bar.c']),
          ],
      )
</pre> <p>For more details, see the <a class="reference external" href="https://setuptools.pypa.io/en/latest/setuptools.html">setuptools documentation</a></p> </section> </section> <section id="interaction-of-numpy-disutils-with-setuptools"> <h2 id="numpy-setuptools-interaction">Interaction of <code>numpy.disutils</code> with <code>setuptools</code>
</h2> <p>It is recommended to use <code>setuptools &lt; 60.0</code>. Newer versions may work, but are not guaranteed to. The reason for this is that <code>setuptools</code> 60.0 enabled a vendored copy of <code>distutils</code>, including backwards incompatible changes that affect some functionality in <code>numpy.distutils</code>.</p> <p>If you are using only simple Cython or C extensions with minimal use of <code>numpy.distutils</code> functionality beyond nested <code>setup.py</code> files (its most popular feature, see <a class="reference internal" href="distutils.html#numpy.distutils.misc_util.Configuration" title="numpy.distutils.misc_util.Configuration"><code>Configuration</code></a>), then latest <code>setuptools</code> is likely to continue working. In case of problems, you can also try <code>SETUPTOOLS_USE_DISTUTILS=stdlib</code> to avoid the backwards incompatible changes in <code>setuptools</code>.</p> <p>Whatever you do, it is recommended to put an upper bound on your <code>setuptools</code> build requirement in <code>pyproject.toml</code> to avoid future breakage - see <a class="reference internal" href="../user/depending_on_numpy.html#for-downstream-package-authors"><span class="std std-ref">For downstream package authors</span></a>.</p> </section><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2005&ndash;2022 NumPy Developers<br>Licensed under the 3-clause BSD License.<br>
    <a href="https://numpy.org/doc/1.23/reference/distutils_status_migration.html" class="_attribution-link">https://numpy.org/doc/1.23/reference/distutils_status_migration.html</a>
  </p>
</div>
