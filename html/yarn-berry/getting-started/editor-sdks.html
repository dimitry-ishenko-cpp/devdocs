<h1>4. Editor SDKs</h1>

<div class="css-elchao exirf770">
<p>Smart IDEs (such as VSCode or IntelliJ) require special configuration for TypeScript to work when using <a href="../features/pnp.html">Plug'n'Play installs</a>. This page intends to be a collection of settings for each editor we've worked with - please contribute to this list!</p>
<p>The editor SDKs and settings can be generated using <code class="language-text">yarn dlx @yarnpkg/sdks</code> (or <code class="language-text">yarn sdks</code> if you added <code class="language-text">@yarnpkg/sdks</code> to your dependencies). Its detailed documentation can be found on the <a href="../sdks/cli/default.html">dedicated page</a>. Generally speaking:</p>
<ul>
<li>Use <code class="language-text">yarn sdks vscode vim</code> to generate both the base SDKs and the settings for the specified supported editors.</li>
<li>Use <code class="language-text">yarn sdks base</code> to generate the base SDKs and then manually tweak the configuration of unsupported editors.</li>
<li>Use <code class="language-text">yarn sdks</code> to update all installed SDKs and editor settings.</li>
</ul>
<hr>
<div class="toc"><ul>
<li><p><a href="#tools-currently-supported">Tools currently supported</a></p></li>
<li>
<p><a href="#editor-setup">Editor setup</a></p>
<ul>
<li><p><a href="#vscode">VSCode</a></p></li>
<li>
<p><a href="#vim">VIM</a></p>
<ul>
<li><p><a href="#cocnvim">coc.nvim</a></p></li>
<li>
<p><a href="#neovim-native-lsp">Neovim Native LSP</a></p>
<ul><li><a href="#supporting-go-to-definition-et-al">Supporting go-to-definition et al.</a></li></ul>
</li>
</ul>
</li>
<li><p><a href="#emacs">Emacs</a></p></li>
</ul>
</li>
<li><p><a href="#caveat">Caveat</a></p></li>
</ul></div>
<h2 id="tools-currently-supported">
Tools currently supported</h2>
<blockquote><p><strong>Note:</strong> Be aware that only the SDKs for the tools present in your <em>root</em> package.json will be installed (the tool won't look at the dependencies from your other workspaces). So don't forget to run the command again should you change the set of tools used by your project!</p></blockquote>
<table>
<thead><tr>
<th>Extension</th>
<th>Required <code class="language-text">package.json</code> dependency</th>
</tr></thead>
<tbody>
<tr>
<td>Builtin VSCode TypeScript Server</td>
<td><a href="https://yarnpkg.com/package/typescript">typescript</a></td>
</tr>
<tr>
<td><a href="https://marketplace.visualstudio.com/items?itemName=dbaeumer.vscode-eslint">vscode-eslint</a></td>
<td><a href="https://yarnpkg.com/package/eslint">eslint</a></td>
</tr>
<tr>
<td><a href="https://marketplace.visualstudio.com/items?itemName=esbenp.prettier-vscode">prettier-vscode</a></td>
<td><a href="https://yarnpkg.com/package/prettier">prettier</a></td>
</tr>
<tr>
<td><a href="https://marketplace.visualstudio.com/items?itemName=stylelint.vscode-stylelint">vscode-stylelint</a></td>
<td><a href="https://stylelint.io/">stylelint</a></td>
</tr>
<tr>
<td><a href="https://marketplace.visualstudio.com/items?itemName=flowtype.flow-for-vscode">flow-for-vscode*</a></td>
<td><a href="https://flow.org/">flow-bin</a></td>
</tr>
</tbody>
</table>
<blockquote><p>* Flow is currently <a href="../features/pnp.html#incompatible">incompatible with PnP</a>.</p></blockquote>
<p>If you'd like to contribute more, <a href="https://github.com/yarnpkg/berry/blob/master/packages/yarnpkg-sdks/sources/generateSdk.ts">take a look here!</a></p>
<h2 id="editor-setup">
Editor setup</h2>
<h3 id="vscode">
VSCode</h3>
<p>To support features like go-to-definition a plugin like <a href="https://marketplace.visualstudio.com/items?itemName=arcanis.vscode-zipfs">ZipFS</a> is needed.</p>
<ol><li>Run the following command, which will generate a new directory called <code class="language-text">.yarn/sdks</code>:</li></ol>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">yarn</span> dlx @yarnpkg/sdks vscode</code></pre></div>
<ol start="2">
<li><p>For safety reason VSCode requires you to explicitly activate the custom TS settings:</p></li>
<li><p>Press <kbd>ctrl+shift+p</kbd> in a TypeScript file</p></li>
<li><p>Choose "Select TypeScript Version"</p></li>
<li><p>Pick "Use Workspace Version"</p></li>
</ol>
<p>Your VSCode project is now configured to use the exact same version of TypeScript as the one you usually use, except that it will now be able to properly resolve the type definitions!</p>
<p>Note that VSCode might ask you to do Step 3 again from time to time, but apart from that your experience should be mostly the same as usual. Happy development!</p>
<h3 id="vim">
VIM</h3>
<p>To support features like go-to-definition a plugin like <a href="https://github.com/lbrayner/vim-rzip">vim-rzip</a> is needed.</p>
<h4 id="cocnvim">
coc.nvim</h4>
<p>Run the following command, which will generate a new directory called <code class="language-text">.yarn/sdks</code> and create a <code class="language-text">.vim/coc-settings.json</code> file:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">yarn</span> dlx @yarnpkg/sdks <span class="token function">vim</span></code></pre></div>
<h4 id="neovim-native-lsp">
Neovim Native LSP</h4>
<p>Run the following command, which will generate a new directory called <code class="language-text">.yarn/sdks</code>:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">yarn</span> dlx @yarnpkg/sdks base</code></pre></div>
<p>With the <code class="language-text">.yarn/sdks</code> in place TypeScript support should work out of the box with <a href="https://github.com/neovim/nvim-lspconfig">nvim-lspconfig</a> and <a href="https://github.com/theia-ide/typescript-language-server">theia-ide/typescript-language-server</a>.</p>
<h5 id="supporting-go-to-definition-et-al">
Supporting go-to-definition et al.</h5>
<blockquote><p><strong>Note:</strong> Due to a bug in <a href="https://github.com/neovim/neovim/pull/14959">Neovim's URI handling</a> go-to-definition is only supported in neovim-nightly.</p></blockquote>
<p>As well as the <a href="https://github.com/lbrayner/vim-rzip">vim-rzip</a> plugin you'll also need the following snippet to handle Yarn PnP's URIs emitted from <a href="https://github.com/theia-ide/typescript-language-server">theia-ide/typescript-language-server</a>. See <a href="https://github.com/lbrayner/vim-rzip/issues/15">lbrayner/vim-rzip#15</a> for further details.</p>
<div class="gatsby-highlight" data-language="vim"><pre class="language-vim"><code class="language-vim"><span class="token comment">" Decode URI encoded characters</span>
<span class="token keyword">function</span><span class="token operator">!</span> <span class="token function">DecodeURI</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token function">substitute</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span>uri<span class="token punctuation">,</span> <span class="token string">'%\([a-fA-F0-9][a-fA-F0-9]\)'</span><span class="token punctuation">,</span> <span class="token string">'\=nr2char("0x" . submatch(1))'</span><span class="token punctuation">,</span> <span class="token string">"g"</span><span class="token punctuation">)</span>
<span class="token keyword">endfunction</span>

<span class="token comment">" Attempt to clear non-focused buffers with matching name</span>
<span class="token keyword">function</span><span class="token operator">!</span> <span class="token function">ClearDuplicateBuffers</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span>
    <span class="token comment">" if our filename has URI encoded characters</span>
    <span class="token keyword">if</span> <span class="token function">DecodeURI</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span>uri<span class="token punctuation">)</span> <span class="token operator">!=#</span> a<span class="token punctuation">:</span>uri
        <span class="token comment">" wipeout buffer with URI decoded name - can print error if buffer in focus</span>
        <span class="token keyword">sil</span><span class="token operator">!</span> exe <span class="token string">"bwipeout "</span> <span class="token operator">.</span> <span class="token function">fnameescape</span><span class="token punctuation">(</span><span class="token function">DecodeURI</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span>uri<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment">" change the name of the current buffer to the URI decoded name</span>
        exe <span class="token string">"keepalt file "</span> <span class="token operator">.</span> <span class="token function">fnameescape</span><span class="token punctuation">(</span><span class="token function">DecodeURI</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span>uri<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment">" ensure we don't have any open buffer matching non-URI decoded name</span>
        <span class="token keyword">sil</span><span class="token operator">!</span> exe <span class="token string">"bwipeout "</span> <span class="token operator">.</span> <span class="token function">fnameescape</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span>uri<span class="token punctuation">)</span>
    <span class="token keyword">endif</span>
<span class="token keyword">endfunction</span>

<span class="token keyword">function</span><span class="token operator">!</span> <span class="token function">RzipOverride</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">" Disable vim-rzip's autocommands</span>
    <span class="token builtin">autocmd</span><span class="token operator">!</span> zip BufReadCmd   zipfile<span class="token punctuation">:</span><span class="token operator">*</span><span class="token punctuation">,</span>zipfile<span class="token punctuation">:</span><span class="token operator">*</span><span class="token operator">/</span><span class="token operator">*</span>
    exe <span class="token string">"au! zip BufReadCmd "</span><span class="token operator">.</span>g<span class="token punctuation">:</span>zipPlugin_ext

    <span class="token comment">" order is important here, setup name of new buffer correctly then fallback to vim-rzip's handling</span>
    <span class="token builtin">autocmd</span> zip BufReadCmd   zipfile<span class="token punctuation">:</span><span class="token operator">*</span>  <span class="token keyword">call</span> <span class="token function">ClearDuplicateBuffers</span><span class="token punctuation">(</span><span class="token function">expand</span><span class="token punctuation">(</span><span class="token string">"&lt;amatch&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token builtin">autocmd</span> zip BufReadCmd   zipfile<span class="token punctuation">:</span><span class="token operator">*</span>  <span class="token keyword">call</span> rzip#<span class="token function">Read</span><span class="token punctuation">(</span><span class="token function">DecodeURI</span><span class="token punctuation">(</span><span class="token function">expand</span><span class="token punctuation">(</span><span class="token string">"&lt;amatch&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token function">has</span><span class="token punctuation">(</span><span class="token string">"unix"</span><span class="token punctuation">)</span>
        <span class="token builtin">autocmd</span> zip BufReadCmd   zipfile<span class="token punctuation">:</span><span class="token operator">*</span><span class="token operator">/</span><span class="token operator">*</span>  <span class="token keyword">call</span> <span class="token function">ClearDuplicateBuffers</span><span class="token punctuation">(</span><span class="token function">expand</span><span class="token punctuation">(</span><span class="token string">"&lt;amatch&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token builtin">autocmd</span> zip BufReadCmd   zipfile<span class="token punctuation">:</span><span class="token operator">*</span><span class="token operator">/</span><span class="token operator">*</span>  <span class="token keyword">call</span> rzip#<span class="token function">Read</span><span class="token punctuation">(</span><span class="token function">DecodeURI</span><span class="token punctuation">(</span><span class="token function">expand</span><span class="token punctuation">(</span><span class="token string">"&lt;amatch&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">endif</span>

    exe <span class="token string">"au zip BufReadCmd "</span><span class="token operator">.</span>g<span class="token punctuation">:</span>zipPlugin_ext<span class="token operator">.</span><span class="token string">"  call rzip#Browse(DecodeURI(expand('&lt;amatch&gt;')))"</span>
<span class="token keyword">endfunction</span>

<span class="token builtin">autocmd</span> VimEnter <span class="token operator">*</span> <span class="token keyword">call</span> <span class="token function">RzipOverride</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></div>
<h3 id="emacs">
Emacs</h3>
<p>The SDK comes with a typescript-language-server wrapper which enables you to use the ts-ls LSP client.</p>
<ol><li>Run the following command, which will generate a new directory called <code class="language-text">.yarn/sdks</code>:</li></ol>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">yarn</span> dlx @yarnpkg/sdks base</code></pre></div>
<ol start="2"><li>Create a <code class="language-text">.dir-locals.el</code> with the following content to enable Flycheck and LSP support and make sure LSP is loaded after local variables are applied to trigger the <code class="language-text">eval-after-load</code>:</li></ol>
<div class="gatsby-highlight" data-language="lisp"><pre class="language-lisp"><code class="language-lisp"><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token car">typescript-mode</span>
  <span class="token punctuation">.</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token car">eval</span> <span class="token punctuation">.</span> <span class="token punctuation">(</span><span class="token keyword">let</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token car">project-directory</span> <span class="token punctuation">(</span><span class="token car">car</span> <span class="token punctuation">(</span><span class="token car">dir-locals-find-file</span> default-directory<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">(</span><span class="token keyword">setq</span> lsp-clients-typescript-server-args <span class="token punctuation">`(</span><span class="token string">"--tsserver-path"</span> <span class="token punctuation">,(</span><span class="token keyword">concat</span> project-directory <span class="token string">".yarn/sdks/typescript/bin/tsserver"</span><span class="token punctuation">)</span> <span class="token string">"--stdio"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div>
<ol start="3"><li>Do note, that you can rename <code class="language-text">:local</code> as you'd like in case you have SDKs stored elsewhere (other than <code class="language-text">.yarn/sdks/...</code>) in other projects.</li></ol>
<h2 id="caveat">
Caveat</h2>
<ul><li>
<p>Since the Yarn packages are kept within their archives, editors need to understand how to work with such paths should you want to open the files (for example when command-clicking on an import path originating from an external package). This can only be implemented by those editors, and we can't do much more than opening issues to ask for this feature to be implemented (for example, here's the VSCode issue: <a href="https://github.com/microsoft/vscode/issues/75559">#75559</a>).</p>
<p>As a workaround, you can run <code class="language-text">yarn unplug pkg-name</code> to instruct yarn to unzip the package, which will re-enable <code class="language-text">Go to definition</code> functionality for the specific package.</p>
</li></ul>
</div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2016&ndash;present Yarn Contributors<br>Licensed under the BSD License.<br>
    <a href="https://yarnpkg.com/getting-started/editor-sdks" class="_attribution-link">https://yarnpkg.com/getting-started/editor-sdks</a>
  </p>
</div>
