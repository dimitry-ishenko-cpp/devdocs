<h1>Workspaces</h1>

<div class="css-elchao exirf770">
<p>The Yarn workspaces aim to make working with <a href="../advanced/lexicon.html#monorepository">monorepos</a> easy, solving one of the main use cases for <code class="language-text">yarn link</code> in a more declarative way. In short, they allow multiple of your projects to live together in the same repository AND to cross-reference each others - any modification to one's source code being instantly applied to the others.</p>
<p>First, some vocabulary: in the context of the workspace feature, a <em>project</em> is the whole directory tree making up your workspaces (often the repository itself). A <em>workspace</em> is a local package made up from your own sources from that same project. Finally, a <em>worktree</em> is the name given to workspaces that list their own child workspaces. A project contains one or more worktrees, which may themselves contain any number of workspaces. Any project contains at least one workspace: the root one.</p>
<div class="toc"><ul>
<li><a href="#how-to-declare-a-worktree">How to declare a worktree?</a></li>
<li><a href="#what-does-it-mean-to-be-a-workspace">What does it mean to be a workspace?</a></li>
<li><a href="#workspace-ranges-workspace">Workspace ranges (<code class="language-text">workspace:</code>)</a></li>
<li><a href="#publishing-workspaces">Publishing workspaces</a></li>
<li><a href="#yarn-workspaces-vs-lerna">Yarn Workspaces vs Lerna</a></li>
</ul></div>
<h2 id="how-to-declare-a-worktree">
How to declare a worktree?</h2>
<p>Worktrees are defined through the traditional <code class="language-text">package.json</code> files. What makes them special is that they have the following properties:</p>
<ul>
<li><p>They must declare a <code class="language-text">workspaces</code> field which is expected to be an array of glob patterns that should be used to locate the workspaces that make up the worktree. For example, if you want all folders within the <code class="language-text">packages</code> folder to be workspaces, just add <code class="language-text">packages/*</code> to this array.</p></li>
<li><p>They must be connected in some way to the project-level <code class="language-text">package.json</code> file. This doesn't matter in the typical workspace setup because there's usually a single worktree defined in the project-level <code class="language-text">package.json</code>, but if you try to setup nested workspaces then you must make sure that the nested worktree is defined as a valid workspace of its parent worktree (otherwise Yarn won't find its correct parent folder).</p></li>
</ul>
<p>Note that because worktrees are defined with an otherwise regular <code class="language-text">package.json</code> file, they also are valid workspaces themselves. If they're named, other workspaces will be able to properly cross-reference them.</p>
<blockquote>
<p><strong>Note</strong></p>
<p>Worktrees used to be required to be private (ie list <code class="language-text">"private": true</code> in their package.json). This requirement got removed with the 2.0 release in order to help standalone projects to progressively adopt workspaces (for example by listing their documentation website as a separate workspace).</p>
</blockquote>
<h2 id="what-does-it-mean-to-be-a-workspace">
What does it mean to be a workspace?</h2>
<p>Workspaces have two important properties:</p>
<ul>
<li><p>Only the dependencies depended upon by a workspace can be accessed. Said another way, we strictly enforce your workspaces dependencies. Doing this allows us to cleanly decouple projects from one another, since you don't have to merge all their dependencies in one huge unmaintainable list. We still provide tools to manage dependencies from multiple workspaces at once, but they need to be explicitly used and offer a better integration (for example <code class="language-text">yarn add</code> can make suggestions for your new dependencies based on what other workspaces use, but you can override them).</p></li>
<li><p>If the package manager was to resolve a range that a workspace could satisfy, it will prefer the workspace resolution over the remote resolution if possible. This is the pillar of the monorepo approach: rather than using the remote packages from the registry, your project packages will be interconnected and will use the code stored within your repository.</p></li>
</ul>
<h2 id="workspace-ranges-workspace">
Workspace ranges (<code class="language-text">workspace:</code>)</h2>
<p>While Yarn automatically picks workspace resolutions when they match, there are times where you absolutely don't want to risk using a package from the remote registry even if the versions don't match (for example if your project isn't actually meant to be published and you just want to use the workspaces to better compartment your code).</p>
<p>For those use cases, Yarn now supports a new resolution protocol starting from the v2: <code class="language-text">workspace:</code>. When this protocol is used Yarn will refuse to resolve to anything else than a local workspace. This range protocol has two flavors:</p>
<ul>
<li>If a semver range, it will select the workspace matching the specified version.</li>
<li>If a project-relative path, it will select the workspace that match this path <strong>(experimental)</strong>.</li>
</ul>
<p>Note that the second flavor is experimental and we advise against using it for now, as some details might change in the future. Our current recommendation is to use <code class="language-text">workspace:*</code>, which will almost always do what you expect.</p>
<h2 id="publishing-workspaces">
Publishing workspaces</h2>
<p>When a workspace is packed into an archive (whether it's through <code class="language-text">yarn pack</code> or one of the publish commands like <code class="language-text">yarn npm publish</code>), we dynamically replace any <code class="language-text">workspace:</code> dependency by:</p>
<ul>
<li>The corresponding version in the target workspace (if you use <code class="language-text">*</code>, <code class="language-text">^</code>, <code class="language-text">~</code>, or a project-relative path)</li>
<li>The associated semver range (for any other range type)</li>
</ul>
<p>So for example, if we assume we have the following workspaces whose current version is <code class="language-text">1.5.0</code>, the following:</p>
<div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"star"</span><span class="token operator">:</span> <span class="token string">"workspace:*"</span><span class="token punctuation">,</span>
    <span class="token property">"caret"</span><span class="token operator">:</span> <span class="token string">"workspace:^"</span><span class="token punctuation">,</span>
    <span class="token property">"tilde"</span><span class="token operator">:</span> <span class="token string">"workspace:~"</span><span class="token punctuation">,</span>
    <span class="token property">"range"</span><span class="token operator">:</span> <span class="token string">"workspace:^1.2.3"</span><span class="token punctuation">,</span>
    <span class="token property">"path"</span><span class="token operator">:</span> <span class="token string">"workspace:path/to/baz"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Will be transformed into:</p>
<div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"star"</span><span class="token operator">:</span> <span class="token string">"1.5.0"</span><span class="token punctuation">,</span>
    <span class="token property">"caret"</span><span class="token operator">:</span> <span class="token string">"^1.5.0"</span><span class="token punctuation">,</span>
    <span class="token property">"tilde"</span><span class="token operator">:</span> <span class="token string">"~1.5.0"</span><span class="token punctuation">,</span>
    <span class="token property">"range"</span><span class="token operator">:</span> <span class="token string">"^1.2.3"</span><span class="token punctuation">,</span>
    <span class="token property">"path"</span><span class="token operator">:</span> <span class="token string">"1.5.0"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>This feature allows you to not have to depend on something else than your local workspaces, while still being able to publish the resulting packages to the remote registry without having to run intermediary publish steps - your consumers will be able to use your published workspaces as any other package, still benefiting from the guarantees semver offers.</p>
<h2 id="yarn-workspaces-vs-lerna">
Yarn Workspaces vs Lerna</h2>
<p>Despite the appearances, the Yarn workspaces and Lerna don't compete. In fact, Lerna will use Yarn's workspaces if possible. In a sense, you can see Lerna as a high-level layer on top of the low-level Yarn implementation.</p>
</div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2016&ndash;present Yarn Contributors<br>Licensed under the BSD License.<br>
    <a href="https://yarnpkg.com/features/workspaces" class="_attribution-link">https://yarnpkg.com/features/workspaces</a>
  </p>
</div>
