<h1>yarn dedupe</h1>

<div class="css-elchao exirf770">
<p>Deduplicate dependencies with overlapping ranges.</p>
<h2 id="usage">
Usage</h2>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">$&gt; yarn dedupe ...</code></pre></div>
<h2 id="examples">
Examples</h2>
<p>Dedupe all packages :</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">yarn dedupe</code></pre></div>
<p>Dedupe all packages using a specific strategy :</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">yarn dedupe --strategy highest</code></pre></div>
<p>Dedupe a specific package :</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">yarn dedupe lodash</code></pre></div>
<p>Dedupe all packages with the <code class="language-text">@babel/*</code> scope :</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">yarn dedupe '@babel/*'</code></pre></div>
<p>Check for duplicates (can be used as a CI step) :</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">yarn dedupe --check</code></pre></div>
<h2 id="options">
Options</h2>
<table>
<thead><tr>
<th><div>Definition</div></th>
<th>Description</th>
</tr></thead>
<tbody>
<tr>
<td><span id="options-s%2C-strategy%20%230" class="header-code"><code class="language-text">-s,--strategy #0</code></span></td>
<td>The strategy to use when deduping dependencies</td>
</tr>
<tr>
<td><span id="options-c%2C-check" class="header-code"><code class="language-text">-c,--check</code></span></td>
<td>Exit with exit code 1 when duplicates are found, without persisting the dependency tree</td>
</tr>
<tr>
<td><span id="options-json" class="header-code"><code class="language-text">--json</code></span></td>
<td>Format the output as an NDJSON stream</td>
</tr>
<tr>
<td><span id="options-mode%20%230" class="header-code"><code class="language-text">--mode #0</code></span></td>
<td>Change what artifacts installs generate</td>
</tr>
</tbody>
</table>
<h2 id="details">
Details</h2>
<p>Duplicates are defined as descriptors with overlapping ranges being resolved and locked to different locators. They are a natural consequence of Yarn's deterministic installs, but they can sometimes pile up and unnecessarily increase the size of your project.</p>
<p>This command dedupes dependencies in the current project using different strategies (only one is implemented at the moment):</p>
<ul><li>
<code class="language-text">highest</code>: Reuses (where possible) the locators with the highest versions. This means that dependencies can only be upgraded, never downgraded. It's also guaranteed that it never takes more than a single pass to dedupe the entire dependency tree.</li></ul>
<p><strong>Note:</strong> Even though it never produces a wrong dependency tree, this command should be used with caution, as it modifies the dependency tree, which can sometimes cause problems when packages don't strictly follow semver recommendations. Because of this, it is recommended to also review the changes manually.</p>
<p>If set, the <code class="language-text">-c,--check</code> flag will only report the found duplicates, without persisting the modified dependency tree. If changes are found, the command will exit with a non-zero exit code, making it suitable for CI purposes.</p>
<p>If the <code class="language-text">--mode=&lt;mode&gt;</code> option is set, Yarn will change which artifacts are generated. The modes currently supported are:</p>
<ul>
<li><p><code class="language-text">skip-build</code> will not run the build scripts at all. Note that this is different from setting <code class="language-text">enableScripts</code> to false because the later will disable build scripts, and thus affect the content of the artifacts generated on disk, whereas the former will just disable the build step - but not the scripts themselves, which just won't run.</p></li>
<li><p><code class="language-text">update-lockfile</code> will skip the link step altogether, and only fetch packages that are missing from the lockfile (or that have no associated checksums). This mode is typically used by tools like Renovate or Dependabot to keep a lockfile up-to-date without incurring the full install cost.</p></li>
</ul>
<p>This command accepts glob patterns as arguments (if valid Idents and supported by <a href="https://github.com/micromatch/micromatch">micromatch</a>). Make sure to escape the patterns, to prevent your own shell from trying to expand them.</p>
<h3 id="in-depth-explanation">
In-depth explanation:</h3>
<p>Yarn doesn't deduplicate dependencies by default, otherwise installs wouldn't be deterministic and the lockfile would be useless. What it actually does is that it tries to not duplicate dependencies in the first place.</p>
<p><strong>Example:</strong> If <code class="language-text">foo@^2.3.4</code> (a dependency of a dependency) has already been resolved to <code class="language-text">foo@2.3.4</code>, running <code class="language-text">yarn add foo@*</code>will cause Yarn to reuse <code class="language-text">foo@2.3.4</code>, even if the latest <code class="language-text">foo</code> is actually <code class="language-text">foo@2.10.14</code>, thus preventing unnecessary duplication.</p>
<p>Duplication happens when Yarn can't unlock dependencies that have already been locked inside the lockfile.</p>
<p><strong>Example:</strong> If <code class="language-text">foo@^2.3.4</code> (a dependency of a dependency) has already been resolved to <code class="language-text">foo@2.3.4</code>, running <code class="language-text">yarn add foo@2.10.14</code> will cause Yarn to install <code class="language-text">foo@2.10.14</code> because the existing resolution doesn't satisfy the range <code class="language-text">2.10.14</code>. This behavior can lead to (sometimes) unwanted duplication, since now the lockfile contains 2 separate resolutions for the 2 <code class="language-text">foo</code> descriptors, even though they have overlapping ranges, which means that the lockfile can be simplified so that both descriptors resolve to <code class="language-text">foo@2.10.14</code>.</p>
</div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2016&ndash;present Yarn Contributors<br>Licensed under the BSD License.<br>
    <a href="https://yarnpkg.com/cli/dedupe" class="_attribution-link">https://yarnpkg.com/cli/dedupe</a>
  </p>
</div>
