<h1 id="id1">Media</h1> <p id="media">Falcon allows for easy and customizable internet media type handling. By default Falcon only enables a single JSON handler. However, additional handlers can be configured through the <a class="reference internal" href="api.html#falcon.RequestOptions" title="falcon.RequestOptions"><code>falcon.RequestOptions</code></a> and <a class="reference internal" href="api.html#falcon.ResponseOptions" title="falcon.ResponseOptions"><code>falcon.ResponseOptions</code></a> objects specified on your <a class="reference internal" href="api.html#falcon.API" title="falcon.API"><code>falcon.API</code></a>.</p> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">To avoid unnecessary overhead, Falcon will only process request media the first time the media property is referenced. Once it has been referenced, it’ll use the cached result for subsequent interactions.</p> </div>  <h2 id="usage">Usage</h2> <p>Zero configuration is needed if you’re creating a JSON API. Just access or set the <code>media</code> attribute as appropriate and let Falcon do the heavy lifting for you.</p> <pre data-language="python">import falcon


class EchoResource(object):
    def on_post(self, req, resp):
        message = req.media.get('message')

        resp.media = {'message': message}
        resp.status = falcon.HTTP_200
</pre> <div class="admonition warning"> <p class="first admonition-title">Warning</p> <p class="last">Once <code>media</code> is called on a request, it’ll consume the request’s stream.</p> </div>   <h2 id="validating-media">Validating Media</h2> <p>Falcon currently only provides a JSON Schema media validator; however, JSON Schema is very versatile and can be used to validate any deserialized media type that JSON also supports (i.e. dicts, lists, etc).</p> <dl class="function"> <dt id="falcon.media.validators.jsonschema.validate">
<code>falcon.media.validators.jsonschema.validate(req_schema=None, resp_schema=None)</code> <a class="reference internal" href="https://falcon.readthedocs.io/en/2.0.0/_modules/falcon/media/validators/jsonschema.html#validate"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<p>Decorator for validating <code>req.media</code> using JSON Schema.</p> <p>This decorator provides standard JSON Schema validation via the <code>jsonschema</code> package available from PyPI. Semantic validation via the <em>format</em> keyword is enabled for the default checkers implemented by <code>jsonschema.FormatChecker</code>.</p> <div class="admonition note"> <p class="first admonition-title">Note</p> <p>The <code>jsonschema`</code> package must be installed separately in order to use this decorator, as Falcon does not install it by default.</p> <p class="last">See <a class="reference external" href="http://json-schema.org/">json-schema.org</a> for more information on defining a compatible dictionary.</p> </div> <table class="docutils field-list" frame="void" rules="none"> <col class="field-name"> <col class="field-body">  <tr>
<th class="field-name">Parameters:</th>
<td class="field-body">
<ul class="first last simple"> <li>
<strong>req_schema</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.7)">dict</a><em>, </em><em>optional</em>) – A dictionary that follows the JSON Schema specification. The request will be validated against this schema.</li> <li>
<strong>resp_schema</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.7)">dict</a><em>, </em><em>optional</em>) – A dictionary that follows the JSON Schema specification. The response will be validated against this schema.</li> </ul> </td> </tr>  </table> <h4 class="rubric">Example</h4> <pre data-language="python">from falcon.media.validators import jsonschema

# -- snip --

@jsonschema.validate(my_post_schema)
def on_post(self, req, resp):

# -- snip --
</pre> </dd>
</dl> <p>If JSON Schema does not meet your needs, a custom validator may be implemented in a similar manner to the one above.</p>   <h2 id="content-type-negotiation">Content-Type Negotiation</h2> <p>Falcon currently only supports partial negotiation out of the box. By default, when the <code>media</code> attribute is used it attempts to de/serialize based on the <code>Content-Type</code> header value. The missing link that Falcon doesn’t provide is the connection between the <a class="reference internal" href="request_and_response.html#falcon.Request" title="falcon.Request"><code>falcon.Request</code></a> <code>Accept</code> header provided by a user and the <a class="reference internal" href="request_and_response.html#falcon.Response" title="falcon.Response"><code>falcon.Response</code></a> <code>Content-Type</code> header.</p> <p>If you do need full negotiation, it is very easy to bridge the gap using middleware. Here is an example of how this can be done:</p> <pre data-language="python">class NegotiationMiddleware(object):
    def process_request(self, req, resp):
        resp.content_type = req.accept
</pre>   <h2 id="replacing-the-default-handlers">Replacing the Default Handlers</h2> <p>When creating your API object you can either add or completely replace all of the handlers. For example, lets say you want to write an API that sends and receives MessagePack. We can easily do this by telling our Falcon API that we want a default media-type of <code>application/msgpack</code> and then create a new <a class="reference internal" href="#falcon.media.Handlers" title="falcon.media.Handlers"><code>Handlers</code></a> object specifying the desired media type and a handler that can process that data.</p> <pre data-language="python">import falcon
from falcon import media


handlers = media.Handlers({
    'application/msgpack': media.MessagePackHandler(),
})

api = falcon.API(media_type='application/msgpack')

api.req_options.media_handlers = handlers
api.resp_options.media_handlers = handlers
</pre> <p>Alternatively, if you would like to add an additional handler such as MessagePack, this can be easily done in the following manner:</p> <pre data-language="python">import falcon
from falcon import media


extra_handlers = {
    'application/msgpack': media.MessagePackHandler(),
}

api = falcon.API()

api.req_options.media_handlers.update(extra_handlers)
api.resp_options.media_handlers.update(extra_handlers)
</pre>   <h2 id="supported-handler-types">Supported Handler Types</h2> <dl class="class"> <dt id="falcon.media.JSONHandler">
<code>class falcon.media.JSONHandler(dumps=None, loads=None)</code> <a class="reference internal" href="https://falcon.readthedocs.io/en/2.0.0/_modules/falcon/media/json.html#JSONHandler"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<p>JSON media handler.</p> <p>This handler uses Python’s standard <a class="reference external" href="https://docs.python.org/3/library/json.html#module-json" title="(in Python v3.7)"><code>json</code></a> library by default, but can be easily configured to use any of a number of third-party JSON libraries, depending on your needs. For example, you can often realize a significant performance boost under CPython by using an alternative library. Good options in this respect include <code>orjson</code>, <code>python-rapidjson</code>, and <code>mujson</code>.</p> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">If you are deploying to PyPy, we recommend sticking with the standard library’s JSON implementation, since it will be faster in most cases as compared to a third-party library.</p> </div> <p>Overriding the default JSON implementation is simply a matter of specifying the desired <code>dumps</code> and <code>loads</code> functions:</p> <pre data-language="python">import falcon
from falcon import media

import rapidjson

json_handler = media.JSONHandler(
    dumps=rapidjson.dumps,
    loads=rapidjson.loads,
)
extra_handlers = {
    'application/json': json_handler,
}

api = falcon.API()
api.req_options.media_handlers.update(extra_handlers)
api.resp_options.media_handlers.update(extra_handlers)
</pre> <p>By default, <code>ensure_ascii</code> is passed to the <code>json.dumps</code> function. If you override the <code>dumps</code> function, you will need to explicitly set <code>ensure_ascii</code> to <code>False</code> in order to enable the serialization of Unicode characters to UTF-8. This is easily done by using <code>functools.partial</code> to apply the desired keyword argument. In fact, you can use this same technique to customize any option supported by the <code>dumps</code> and <code>loads</code> functions:</p> <pre data-language="python">from functools import partial

from falcon import media
import rapidjson

json_handler = media.JSONHandler(
    dumps=partial(
        rapidjson.dumps,
        ensure_ascii=False, sort_keys=True
    ),
)
</pre> <table class="docutils field-list" frame="void" rules="none"> <col class="field-name"> <col class="field-body">  <tr><th class="field-name" colspan="2">Keyword Arguments:</th></tr> <tr>
<td> </td>
<td class="field-body">
<ul class="first last simple"> <li>
<strong>dumps</strong> (<em>func</em>) – Function to use when serializing JSON responses.</li> <li>
<strong>loads</strong> (<em>func</em>) – Function to use when deserializing JSON requests.</li> </ul> </td> </tr>  </table> <dl class="method"> <dt id="falcon.media.JSONHandler.deserialize">
<code>deserialize(stream, content_type, content_length)</code> <a class="reference internal" href="https://falcon.readthedocs.io/en/2.0.0/_modules/falcon/media/json.html#JSONHandler.deserialize"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<p>Deserialize the <a class="reference internal" href="request_and_response.html#falcon.Request" title="falcon.Request"><code>falcon.Request</code></a> body.</p> <table class="docutils field-list" frame="void" rules="none"> <col class="field-name"> <col class="field-body">  <tr>
<th class="field-name">Parameters:</th>
<td class="field-body">
<ul class="first simple"> <li>
<strong>stream</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.7)">object</a>) – Input data to deserialize.</li> <li>
<strong>content_type</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)">str</a>) – Type of request content.</li> <li>
<strong>content_length</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)">int</a>) – Length of request content.</li> </ul> </td> </tr> <tr>
<th class="field-name">Returns:</th>
<td class="field-body">
<p class="first">A deserialized object.</p> </td> </tr> <tr>
<th class="field-name">Return type:</th>
<td class="field-body">
<p class="first last"><a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.7)">object</a></p> </td> </tr>  </table> </dd>
</dl> <dl class="method"> <dt id="falcon.media.JSONHandler.serialize">
<code>serialize(media, content_type)</code> <a class="reference internal" href="https://falcon.readthedocs.io/en/2.0.0/_modules/falcon/media/json.html#JSONHandler.serialize"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<p>Serialize the media object on a <a class="reference internal" href="request_and_response.html#falcon.Response" title="falcon.Response"><code>falcon.Response</code></a></p> <table class="docutils field-list" frame="void" rules="none"> <col class="field-name"> <col class="field-body">  <tr>
<th class="field-name">Parameters:</th>
<td class="field-body">
<ul class="first simple"> <li>
<strong>media</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.7)">object</a>) – A serializable object.</li> <li>
<strong>content_type</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)">str</a>) – Type of response content.</li> </ul> </td> </tr> <tr>
<th class="field-name">Returns:</th>
<td class="field-body">
<p class="first">The resulting serialized bytes from the input object.</p> </td> </tr> <tr>
<th class="field-name">Return type:</th>
<td class="field-body">
<p class="first last"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.7)">bytes</a></p> </td> </tr>  </table> </dd>
</dl> </dd>
</dl> <dl class="class"> <dt id="falcon.media.MessagePackHandler">
<code>class falcon.media.MessagePackHandler</code> <a class="reference internal" href="https://falcon.readthedocs.io/en/2.0.0/_modules/falcon/media/msgpack.html#MessagePackHandler"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<p>Handler built using the <code>msgpack</code> module.</p> <p>This handler uses <code>msgpack.unpackb()</code> and <code>msgpack.packb()</code>. The MessagePack <code>bin</code> type is used to distinguish between Unicode strings (<code>str</code> on Python 3, <code>unicode</code> on Python 2) and byte strings (<code>bytes</code> on Python 2/3, or <code>str</code> on Python 2).</p> <div class="admonition note"> <p class="first admonition-title">Note</p> <p>This handler requires the extra <code>msgpack</code> package (version 0.5.2 or higher), which must be installed in addition to <code>falcon</code> from PyPI:</p> <pre data-language="last">$ pip install msgpack
</pre> </div> <dl class="method"> <dt id="falcon.media.MessagePackHandler.deserialize">
<code>deserialize(stream, content_type, content_length)</code> <a class="reference internal" href="https://falcon.readthedocs.io/en/2.0.0/_modules/falcon/media/msgpack.html#MessagePackHandler.deserialize"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<p>Deserialize the <a class="reference internal" href="request_and_response.html#falcon.Request" title="falcon.Request"><code>falcon.Request</code></a> body.</p> <table class="docutils field-list" frame="void" rules="none"> <col class="field-name"> <col class="field-body">  <tr>
<th class="field-name">Parameters:</th>
<td class="field-body">
<ul class="first simple"> <li>
<strong>stream</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.7)">object</a>) – Input data to deserialize.</li> <li>
<strong>content_type</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)">str</a>) – Type of request content.</li> <li>
<strong>content_length</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)">int</a>) – Length of request content.</li> </ul> </td> </tr> <tr>
<th class="field-name">Returns:</th>
<td class="field-body">
<p class="first">A deserialized object.</p> </td> </tr> <tr>
<th class="field-name">Return type:</th>
<td class="field-body">
<p class="first last"><a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.7)">object</a></p> </td> </tr>  </table> </dd>
</dl> <dl class="method"> <dt id="falcon.media.MessagePackHandler.serialize">
<code>serialize(media, content_type)</code> <a class="reference internal" href="https://falcon.readthedocs.io/en/2.0.0/_modules/falcon/media/msgpack.html#MessagePackHandler.serialize"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<p>Serialize the media object on a <a class="reference internal" href="request_and_response.html#falcon.Response" title="falcon.Response"><code>falcon.Response</code></a></p> <table class="docutils field-list" frame="void" rules="none"> <col class="field-name"> <col class="field-body">  <tr>
<th class="field-name">Parameters:</th>
<td class="field-body">
<ul class="first simple"> <li>
<strong>media</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.7)">object</a>) – A serializable object.</li> <li>
<strong>content_type</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)">str</a>) – Type of response content.</li> </ul> </td> </tr> <tr>
<th class="field-name">Returns:</th>
<td class="field-body">
<p class="first">The resulting serialized bytes from the input object.</p> </td> </tr> <tr>
<th class="field-name">Return type:</th>
<td class="field-body">
<p class="first last"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.7)">bytes</a></p> </td> </tr>  </table> </dd>
</dl> </dd>
</dl>   <h2 id="custom-handler-type">Custom Handler Type</h2> <p>If Falcon doesn’t have an internet media type handler that supports your use case, you can easily implement your own using the abstract base class provided by Falcon:</p> <dl class="class"> <dt id="falcon.media.BaseHandler">
<code>class falcon.media.BaseHandler</code> <a class="reference internal" href="https://falcon.readthedocs.io/en/2.0.0/_modules/falcon/media/base.html#BaseHandler"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<p>Abstract Base Class for an internet media type handler</p> <dl class="method"> <dt id="falcon.media.BaseHandler.serialize">
<code>serialize(media, content_type)</code> <a class="reference internal" href="https://falcon.readthedocs.io/en/2.0.0/_modules/falcon/media/base.html#BaseHandler.serialize"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<p>Serialize the media object on a <a class="reference internal" href="request_and_response.html#falcon.Response" title="falcon.Response"><code>falcon.Response</code></a></p> <table class="docutils field-list" frame="void" rules="none"> <col class="field-name"> <col class="field-body">  <tr>
<th class="field-name">Parameters:</th>
<td class="field-body">
<ul class="first simple"> <li>
<strong>media</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.7)">object</a>) – A serializable object.</li> <li>
<strong>content_type</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)">str</a>) – Type of response content.</li> </ul> </td> </tr> <tr>
<th class="field-name">Returns:</th>
<td class="field-body">
<p class="first">The resulting serialized bytes from the input object.</p> </td> </tr> <tr>
<th class="field-name">Return type:</th>
<td class="field-body">
<p class="first last"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.7)">bytes</a></p> </td> </tr>  </table> </dd>
</dl> <dl class="method"> <dt id="falcon.media.BaseHandler.deserialize">
<code>deserialize(stream, content_type, content_length)</code> <a class="reference internal" href="https://falcon.readthedocs.io/en/2.0.0/_modules/falcon/media/base.html#BaseHandler.deserialize"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<p>Deserialize the <a class="reference internal" href="request_and_response.html#falcon.Request" title="falcon.Request"><code>falcon.Request</code></a> body.</p> <table class="docutils field-list" frame="void" rules="none"> <col class="field-name"> <col class="field-body">  <tr>
<th class="field-name">Parameters:</th>
<td class="field-body">
<ul class="first simple"> <li>
<strong>stream</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.7)">object</a>) – Input data to deserialize.</li> <li>
<strong>content_type</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)">str</a>) – Type of request content.</li> <li>
<strong>content_length</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)">int</a>) – Length of request content.</li> </ul> </td> </tr> <tr>
<th class="field-name">Returns:</th>
<td class="field-body">
<p class="first">A deserialized object.</p> </td> </tr> <tr>
<th class="field-name">Return type:</th>
<td class="field-body">
<p class="first last"><a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.7)">object</a></p> </td> </tr>  </table> </dd>
</dl> </dd>
</dl>   <h2 id="handlers">Handlers</h2> <dl class="class"> <dt id="falcon.media.Handlers">
<code>class falcon.media.Handlers(initial=None)</code> <a class="reference internal" href="https://falcon.readthedocs.io/en/2.0.0/_modules/falcon/media/handlers.html#Handlers"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<p>A dictionary like object that manages internet media type handlers.</p> </dd>
</dl>   <h2 id="id2">Media Type Constants</h2> <p id="media-type-constants">The <code>falcon</code> module provides a number of constants for common media types, including the following:</p> <pre data-language="python">falcon.MEDIA_JSON
falcon.MEDIA_MSGPACK
falcon.MEDIA_YAML
falcon.MEDIA_XML
falcon.MEDIA_HTML
falcon.MEDIA_JS
falcon.MEDIA_TEXT
falcon.MEDIA_JPEG
falcon.MEDIA_PNG
falcon.MEDIA_GIF
</pre><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2019 by Falcon contributors<br>Licensed under the Apache License, Version 2.0.<br>
    <a href="https://falcon.readthedocs.io/en/2.0.0/api/media.html" class="_attribution-link">https://falcon.readthedocs.io/en/2.0.0/api/media.html</a>
  </p>
</div>
