<div id="col-content" data-swiftype-index="true"> <div id="log-files"><h1>Log Files</h1></div>  <div class="prose"> <p data-swiftype-index="false"> <a href="https://github.com/chef/chef-server/blob/main/docs-chef-io/content/server/server_logs.md" alt="Link to page on GitHub repository">[edit on GitHub]</a> </p> <p>All logs generated by the Chef Infra Server can be found in <code>/var/log/opscode</code>. Each service enabled on the system also has a sub-directory in which service-specific logs are located, typically found in <code>/var/log/opscode/service_name</code>.</p> <h2 id="view-log-files">View Log Files</h2> <p>The Chef Infra Server has built-in support for easily tailing the logs that are generated. To view all the logs being generated on the Chef Infra Server, enter the following command:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-server-ctl tail
</code></pre></div>
<p>To view logs for a specific service:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-server-ctl tail SERVICENAME
</code></pre></div>
<p>where <code>SERVICENAME</code> should be replaced with the name of the service for which log files will be viewed.</p> <h3 id="tail-log-files">tail Log Files</h3> <p>The <code>tail</code> subcommand is used to follow all of the Chef Infra Server logs for all services. This command can also be run for an individual service by specifying the name of the service in the command.</p> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-server-ctl tail SERVICE_NAME
</code></pre></div>
<p>where <code>SERVICE_NAME</code> represents the name of any service that is listed after running the <code>service-list</code> subcommand.</p> <p>Another common approach to tailing the log files for a service is to use the system utility <code>tail</code>. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">tail -50f /var/log/opscode/opscode-erchef/current
</code></pre></div>
<h2 id="supervisor">Supervisor</h2> <p>Supervisor logs are created and managed directly by the service supervisor, and are automatically rotated when the current log file reaches 1,000,000 bytes. 10 log files are kept. The latest supervisor log is always located in <code>/var/log/service_name/current</code> and rotated logs have a filename starting with <code>@</code> followed by a precise <code>tai64n</code> timestamp based on when the file was rotated.</p> <p>Supervisor logs are available for the following services:</p> <ul> <li>bifrost</li> <li>bookshelf</li> <li>elasticsearch</li> <li>nginx</li> <li>opscode-erchef</li> <li>postgresql</li> <li>redis</li> </ul> <h3 id="nginx-access">nginx, access</h3> <p>Nginx is an important entry point for data on the Chef Infra Server, which means that debugging efforts frequently start with analyzing the <strong>nginx</strong> service’s <code>access.log</code> file. This log contains every HTTP request made to the front-end machine and can be very useful when investigating request rates and usage patterns. The following is an example log entry:</p> <pre tabindex="0" class="highlight" data-language="ruby"><code class="language-none" data-lang="none">175.185.9.6 - - [12/Jul/2013:15:56:54 +0000] "GET
/organizations/exampleorg/data/firewall/nova_api HTTP/1.1" 200
"0.850" 452 "-" "Chef Client/0.10.2 (ruby-1.8.7-p302; ohai-0.6.4;
x86_64-linux; +https://chef.io)" "127.0.0.1:9460" "200"
"0.849" "0.10.2" "version=1.0" "some_node.example.com"
"2013-07-12T15:56:40Z" "2jmj7l5rSw0yVb/vlWAYkK/YBwk=" 985
</code></pre>
<p>where important fields in this log include:</p> <ul> <li>The HTTP status code (<code>200</code>)</li> <li>The IP address of the requesting client (<code>175.185.9.6</code>)</li> <li>The timestamp (<code>[12/Jul/2013:15:56:54 +0000]</code>)</li> <li>The total request time (<code>"0.850"</code>)</li> <li>The request method (<code>GET</code>)</li> <li>The request URL (<code>/organizations/exampleorg/data/firewall/nova_api</code>)</li> </ul> <h3 id="opscode-erchef-current">opscode-erchef, current</h3> <p>The <strong>opscode-erchef</strong> service’s <code>current.log</code> file contains a history of stack traces from major application crashes.</p> <h3 id="opscode-erchef-erchef">opscode-erchef, erchef</h3> <p>The <strong>opscode-erchef</strong> service’s <code>erchef.log</code> file contains a history of API requests that have been processed by Erchef. These logs can be rotated quickly, therefore it is generally best to sort them by date, and then find the most recently updated log file:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">ls -lrt /var/log/opscode/opscode-erchef/erchef.log.*
</code></pre></div>
<p>The following is an example log entry:</p> <pre tabindex="0" class="highlight" data-language="ruby"><code class="language-none" data-lang="none">2013-08-06T08:54:32Z erchef@127.0.0.1 INFO org_name=srwjedoqqoypgmvafmoi; req_id=g3IAA2QAEGVyY2hlZkAx
</code></pre>
<p>where important fields in this log include:</p> <ul> <li>The HTTP method (<code>POST</code>)</li> <li>The HTTP path (<code>/organizations/srwjedoqqoypgmvafmoi/environments</code>)</li> <li>The message (<code>{created,&lt;&lt;"_default"&gt;&gt;}</code>)</li> <li>The organization name (<code>org_name=srwjedoqqoypgmvafmoi</code>)</li> <li>The timestamp (<code>2013-08-06T08:54:32Z</code>)</li> <li>The name of the user and/or Chef Infra Client which made the request (<code>pivotal</code>)</li> </ul> <p>In addition, the log file may contain additional entries that detail the amounts of time spent interacting with other services:</p> <ul> <li>
<code>rdbms_time</code> (the time spent talking to the <strong>postgresql</strong> service)</li> <li>
<code>req_time</code> (the request time)</li> <li>
<code>solr_time</code> (the time spent talking to the <strong>opscode-solr</strong> service)</li> </ul> <h2 id="application">Application</h2> <p>Application logs are created by the services directly, and may require log rotation policies to be applied based on organizational goals and the platform(s) on which the services are running.</p> <h3 id="nginx">nginx</h3> <p>The <code>nginx</code> service creates both supervisor and administrator logs. The administrator logs contain both access and error logs for each virtual host utilized by the Chef Infra Server. Each of the following logs require external log rotation.</p> <table> <col style="width:12%"> <col style="width:87%"> <thead> <tr class="header"> <th>Logs</th> <th>Description</th> </tr> </thead> <tbody> <tr class="odd"> <td><code>/var/log/opscode/nginx/access.log</code></td> <td>The Web UI and API HTTP access logs.</td> </tr> <tr class="even"> <td><code>/var/log/opscode/nginx/error.log</code></td> <td>The Web UI and API HTTP error logs.</td> </tr> <tr class="odd"> <td><code>/var/log/opscode/nginx/internal-account.access.log</code></td> <td>The <code>opscode-account</code> internal load-balancer access logs.</td> </tr> <tr class="even"> <td><code>/var/log/opscode/nginx/internal-account.error.log</code></td> <td>The <code>opscode-account</code> internal load-balancer error logs.</td> </tr> <tr class="odd"> <td><code>/var/log/opscode/nginx/internal-authz.access.log</code></td> <td>The <code>opscode-authz</code> internal load-balancer access logs.</td> </tr> <tr class="even"> <td><code>/var/log/opscode/nginx/internal-authz.error.log</code></td> <td>The <code>opscode-authz</code> internal load-balancer error logs.</td> </tr> <tr class="odd"> <td><code>/var/log/opscode/nginx/internal-chef.access.log</code></td> <td>The <code>opscode-chef</code> and <code>opscode-erchef</code> internal load-balancer access logs.</td> </tr> <tr class="even"> <td><code>/var/log/opscode/nginx/internal-chef.error.log</code></td> <td>The <code>opscode-chef</code> and <code>opscode-erchef</code> internal load-balancer error logs.</td> </tr> <tr class="odd"> <td><code>/var/log/opscode/nginx/nagios.access.log</code></td> <td>The <code>nagios</code> access logs.</td> </tr> <tr class="even"> <td><code>/var/log/opscode/nginx/nagios.error.log</code></td> <td>The <code>nagios</code> error logs.</td> </tr> <tr class="odd"> <td><code>/var/log/opscode/nginx/rewrite-port-80.log</code></td> <td>The rewrite logs for traffic that uses HTTP instead of HTTPS.</td> </tr> </tbody> </table> <p>To follow the logs for the service:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-server-ctl tail nginx
</code></pre></div>
<h4 id="read-log-files">Read Log Files</h4> <p>The <strong>nginx</strong> access log format is as follows:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">log_format opscode <span style="color:#4070a0">'$remote_addr - $remote_user [$time_local]  '</span>
  <span style="color:#4070a0">'"$request" $status "$request_time" $body_bytes_sent '</span>
  <span style="color:#4070a0">'"$http_referrer" "$http_user_agent" "$upstream_addr" '</span>
  <span style="color:#4070a0">'"$upstream_status" "$upstream_response_time" "$http_x_chef_version" '</span>
  <span style="color:#4070a0">'"$http_x_ops_sign" "$http_x_ops_userid" "$http_x_ops_timestamp" '</span>
   <span style="color:#4070a0">'"$http_x_ops_content_hash" $request_length'</span>;
</code></pre></div>
<p>A sample log line:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">192.0.2.0 - - <span style="color:#666">[</span>17/Feb/2012:16:02:42 -0800<span style="color:#666">]</span>
  <span style="color:#4070a0">"GET /organizations/nginx/cookbooks HTTP/1.1"</span> <span style="color:#40a070">200</span>
  <span style="color:#4070a0">"0.346"</span> <span style="color:#40a070">12</span> <span style="color:#4070a0">"-"</span>
  <span style="color:#4070a0">"Chef Knife/0.10.4 (ruby-1.9.3-p0;
</span><span style="color:#4070a0">                      ohai-0.6.10;
</span><span style="color:#4070a0">                      x86_64-darwin11.2.0;
</span><span style="color:#4070a0">                      +http://opscode.com
</span><span style="color:#4070a0">                      )"</span>
  <span style="color:#4070a0">"127.0.0.1:9460"</span> <span style="color:#4070a0">"200"</span> <span style="color:#4070a0">"0.339"</span> <span style="color:#4070a0">"0.10.4"</span>
  <span style="color:#4070a0">"version=1.0"</span> <span style="color:#4070a0">"adam"</span> <span style="color:#4070a0">"2012-02-18T00:02:42Z"</span>
  <span style="color:#4070a0">"2jmj7l5rSw0yVb/vlWAYkK/YBwk="</span> <span style="color:#40a070">871</span>
</code></pre></div>
<p>Field descriptions:</p> <table> <col style="width:12%"> <col style="width:87%"> <thead> <tr class="header"> <th>Field</th> <th>Description</th> </tr> </thead> <tbody> <tr class="odd"> <td><code>$remote_addr</code></td> <td>The IP address of the client who made this request.</td> </tr> <tr class="even"> <td><code>$remote_user</code></td> <td>The HTTP basic auth user name of this request.</td> </tr> <tr class="odd"> <td><code>$time_local</code></td> <td>The local time of the request.</td> </tr> <tr class="even"> <td><code>$request</code></td> <td>The HTTP request.</td> </tr> <tr class="odd"> <td><code>$status</code></td> <td>The HTTP status code.</td> </tr> <tr class="even"> <td><code>$request_time</code></td> <td>The time it took to service the request.</td> </tr> <tr class="odd"> <td><code>$body_bytes_sent</code></td> <td>The number of bytes in the HTTP response body.</td> </tr> <tr class="even"> <td><code>$http_referrer</code></td> <td>The HTTP referrer.</td> </tr> <tr class="odd"> <td><code>$http_user_agent</code></td> <td>The user agent of the requesting client.</td> </tr> <tr class="even"> <td><code>$upstream_addr</code></td> <td>The upstream reverse proxy used to service this request.</td> </tr> <tr class="odd"> <td><code>$upstream_status</code></td> <td>The upstream reverse proxy response status code.</td> </tr> <tr class="even"> <td><code>$upstream_response_time</code></td> <td>The upstream reverse proxy response time.</td> </tr> <tr class="odd"> <td><code>$http_x_chef_version</code></td> <td>The version of Chef used to make this request.</td> </tr> <tr class="even"> <td><code>$http_x_ops_sign</code></td> <td>The version of the authentication protocol.</td> </tr> <tr class="odd"> <td><code>$http_x_ops_userid</code></td> <td>The client name that was used to sign this request.</td> </tr> <tr class="even"> <td><code>$http_x_ops_timestamp</code></td> <td>The timestamp from when this request was signed.</td> </tr> <tr class="odd"> <td><code>$http_x_ops_content_hash</code></td> <td>The hash of the contents of this request.</td> </tr> <tr class="even"> <td><code>$request_length</code></td> <td>The length of this request.</td> </tr> </tbody> </table> </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; Chef Software, Inc.<br>Licensed under the Creative Commons Attribution 3.0 Unported License.<br>The Chef&trade; Mark and Chef Logo are either registered trademarks/service marks or trademarks/servicemarks of Chef, in the United States and other countries and are used with Chef Inc's permission.<br>We are not affiliated with, endorsed or sponsored by Chef Inc.<br>
    <a href="https://docs.chef.io/server/server_logs/" class="_attribution-link">https://docs.chef.io/server/server_logs/</a>
  </p>
</div>
