<div id="col-content" data-swiftype-index="true"> <div id="chef-infra-client-executable"><h1>Chef Infra Client (executable)</h1></div>  <div class="prose"> <p data-swiftype-index="false"> <a href="https://github.com/chef/chef-web-docs/blob/main/content/ctl_chef_client.md" alt="Link to page on GitHub repository">[edit on GitHub]</a> </p> <p>Chef Infra Client is an agent that runs locally on every node that is under management by Chef Infra Server. When Chef Infra Client runs, it performs all of the steps required for bringing a node into the expected state, including:</p> <ul> <li>Registering and authenticating the node with Chef Infra Server</li> <li>Synchronizing cookbooks from the Chef Infra Server to the node</li> <li>Compiling the resource collection by loading each of the required cookbooks, including recipes, attributes, and all other dependencies</li> <li>Taking the appropriate and required actions to configure the node based on recipes and attributes</li> <li>Reporting summary information on the run to Chef Automate</li> </ul> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> The Chef Infra Client executable can be run as a daemon. </div> </div> <p>The Chef Infra Client executable is run as a command-line tool.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>The client.rb file specifies how Chef Infra Client is configured on a node and has the following characteristics:</p> <ul> <li>This file is loaded every time the chef-client executable is run.</li> <li>On Microsoft Windows machines, the default location for this file is <code>C:\chef\client.rb</code>. On all other systems the default location for this file is <code>/etc/chef/client.rb</code>.</li> <li>Use the <code>--config</code> option from the command line to override the default location of the configuration file.</li> <li>This file is not created by default</li> </ul> </div> </div> <h2 id="options">Options</h2> <p>This command has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-client OPTION VALUE OPTION VALUE ...
</code></pre></div>
<p>This command has the following options:</p> <dl> <dt>
<code>-A</code>, <code>--fatal-windows-admin-check</code>
</dt> <dd> <p>Cause a Chef Infra Client run to fail when the Chef Infra Client does not have administrator privileges in Microsoft Windows.</p> </dd> <dt>
<code>-c CONFIG</code>, <code>--config CONFIG</code>
</dt> <dd> <p>The configuration file to use.</p> </dd> <dt><code>--config-option OPTION</code></dt> <dd> <p>Overrides a single configuration option. Can be used to override multiple configuration options by adding another <code>--config-option OPTION</code>.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">property <span style="color:#517918">:db_password</span>, <span style="color:#007020">String</span>, <span style="color:#517918">sensitive</span>: <span style="color:#007020">true</span>
</code></pre></div>
</dd> <dt><code>--chef-zero-host HOST</code></dt> <dd> <p>The host on which chef-zero is started.</p> </dd> <dt><code>--chef-zero-port PORT</code></dt> <dd> <p>The port on which chef-zero listens. If a port is not specified—individually, as range of ports, or from the <code>chef_zero.port</code> setting in the client.rb file—the Chef Infra Client will scan for ports between 8889-9999 and will pick the first port that is available.</p> </dd> <dt>
<code>-d SECONDS</code>, <code>--daemonize SECONDS</code>
</dt> <dd> <p>Run the executable as a daemon. Use <code>SECONDS</code> to specify the number of seconds to wait before the first daemonized Chef Infra Client run. <code>SECONDS</code> is set to <code>0</code> by default. Left unset, the daemon uses the default <code>--interval</code> an <code>--splay</code> values.</p> <p>This option is only available on machines that run in UNIX or Linux environments. For machines that are running Microsoft Windows that require similar functionality, use the <code>chef-client::service</code> recipe in the <code>chef-client</code> cookbook: <a href="https://supermarket.chef.io/cookbooks/chef-client">https://supermarket.chef.io/cookbooks/chef-client</a>. This will install a Chef Infra Client service under Microsoft Windows using the Windows Service Wrapper.</p> </dd> <dt><code>--delete-entire-chef-repo</code></dt> <dd> <p>This option deletes an entire repository. This option may only be used when running the Chef Infra Client in local mode, (<code>--local-mode</code>). This option requires <code>--recipe-url</code> to be specified.</p> </dd> <dt><code>--disable-config</code></dt> <dd> <p>Use to run the Chef Infra Client using default settings. This will prevent the normally-associated configuration file from being used. This setting should only be used for testing purposes and should never be used in a production setting.</p> </dd> <dt>
<code>-E ENVIRONMENT_NAME</code>, <code>--environment ENVIRONMENT_NAME</code>
</dt> <dd> <p>The name of the environment.</p> </dd> <dt>
<code>-f</code>, <code>--[no-]fork</code>
</dt> <dd> <p>Contain Chef Infra Client runs in a secondary process with dedicated RAM. When a Chef Infra Client run is complete, the RAM is returned to the master process. This option helps ensure that a Chef Infra Client uses a steady amount of RAM over time because the master process does not run recipes. This option also helps prevent memory leaks such as those that can be introduced by the code contained within a poorly designed cookbook. Use <code>--no-fork</code> to disable running Chef Infra Client in fork node. Default value: <code>--fork</code>.</p> </dd> <dt>
<code>-F FORMAT</code>, <code>--format FORMAT</code>
</dt> <dd> <p>The output format: <code>doc</code> (default) or <code>min</code>.</p> </dd> </dl> <ul> <li>Use <code>doc</code> to print the progress of a Chef Infra Client run using full strings that display a summary of updates as they occur.</li> <li>Use <code>min</code> to print the progress of a Chef Infra Client run using single characters.</li> </ul> <p>A summary of updates is printed at the end of a Chef Infra Client run. A dot (<code>.</code>) is printed for events that do not have meaningful status information, such as loading a file or synchronizing a cookbook. For resources, a dot (<code>.</code>) is printed when the resource is up to date, an <code>S</code> is printed when the resource is skipped by <code>not_if</code> or <code>only_if</code>, and a <code>U</code> is printed when the resource is updated.</p> <p>Other formatting options are available when those formatters are configured in the client.rb file using the <code>add_formatter</code> option.</p> <dl> <dt><code>--force-formatter</code></dt> <dd> <p>Show formatter output instead of logger output.</p> </dd> <dt><code>--force-logger</code></dt> <dd> <p>Show logger output instead of formatter output.</p> </dd> <dt>
<code>-g GROUP</code>, <code>--group GROUP</code>
</dt> <dd> <p>The name of the group that owns a process. This is required when starting any executable as a daemon.</p> </dd> <dt>
<code>-h</code>, <code>--help</code>
</dt> <dd> <p>Show help for the command.</p> </dd> <dt>
<code>-i SECONDS</code>, <code>--interval SECONDS</code>
</dt> <dd> <p>The frequency (in seconds) at which Chef Infra Client runs. When running Chef Infra Client at intervals, apply <code>--splay</code> and <code>--interval</code> values before a Chef Infra Client run. Default value: <code>1800</code>.</p> </dd> <dt>
<code>-j PATH</code>, <code>--json-attributes PATH</code>
</dt> <dd> <p>The path to a file that contains JSON data. Used to setup the first client run. The attributes will persist on the Chef Infra Server for all future runs with option <code>-j</code>.</p> <p><strong>Run-lists</strong></p> <p>Use this option to define a <code>run_list</code> object. For example, a JSON file similar to:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-javascript" data-lang="javascript"><span style="color:#4070a0">"run_list"</span><span style="color:#666">:</span> [
  <span style="color:#4070a0">"recipe[base]"</span>,
  <span style="color:#4070a0">"recipe[foo]"</span>,
  <span style="color:#4070a0">"recipe[bar]"</span>,
  <span style="color:#4070a0">"role[webserver]"</span>
],
</code></pre></div>
<p>may be used by running <code>chef-client -j path/to/file.json</code>.</p> <p>In certain situations this option may be used to update <code>normal</code> attributes.</p> <p><strong>Environments</strong></p> <p>Use this option to set the <code>chef_environment</code> value for a node.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> Any environment specified for <code>chef_environment</code> by a JSON file will take precedence over an environment specified by the <code>--environment</code> option when both options are part of the same command. </div> </div> <p>For example, run the following:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-client -j /path/to/file.json
</code></pre></div>
<p>where <code>/path/to/file.json</code> is similar to:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-javascript" data-lang="javascript">{
  <span style="color:#4070a0">"chef_environment"</span><span style="color:#666">:</span> <span style="color:#4070a0">"pre-production"</span>
}
</code></pre></div>
<p>This will set the environment for the node to <code>pre-production</code>.</p> <p><strong>All attributes are normal attributes</strong></p> <p>Any other attribute type that is contained in this JSON file will be treated as a <code>normal</code> attribute. Setting attributes at other precedence levels is not possible. For example, attempting to update <code>override</code> attributes using the <code>-j</code> option:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-javascript" data-lang="javascript">{
  <span style="color:#4070a0">"name"</span><span style="color:#666">:</span> <span style="color:#4070a0">"dev-99"</span>,
  <span style="color:#4070a0">"description"</span><span style="color:#666">:</span> <span style="color:#4070a0">"Install some stuff"</span>,
  <span style="color:#4070a0">"override_attributes"</span><span style="color:#666">:</span> {
    <span style="color:#4070a0">"apptastic"</span><span style="color:#666">:</span> {
      <span style="color:#4070a0">"enable_apptastic"</span><span style="color:#666">:</span> <span style="color:#4070a0">"false"</span>,
      <span style="color:#4070a0">"apptastic_tier_name"</span><span style="color:#666">:</span> <span style="color:#4070a0">"dev-99.bomb.com"</span>
    }
  }
}
</code></pre></div>
<p>will result in a node object similar to:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-javascript" data-lang="javascript">{
  <span style="color:#4070a0">"name"</span><span style="color:#666">:</span> <span style="color:#4070a0">"maybe-dev-99"</span>,
  <span style="color:#4070a0">"normal"</span><span style="color:#666">:</span> {
    <span style="color:#4070a0">"name"</span><span style="color:#666">:</span> <span style="color:#4070a0">"dev-99"</span>,
    <span style="color:#4070a0">"description"</span><span style="color:#666">:</span> <span style="color:#4070a0">"Install some stuff"</span>,
    <span style="color:#4070a0">"override_attributes"</span><span style="color:#666">:</span> {
      <span style="color:#4070a0">"apptastic"</span><span style="color:#666">:</span> {
        <span style="color:#4070a0">"enable_apptastic"</span><span style="color:#666">:</span> <span style="color:#4070a0">"false"</span>,
        <span style="color:#4070a0">"apptastic_tier_name"</span><span style="color:#666">:</span> <span style="color:#4070a0">"dev-99.bomb.com"</span>
      }
    }
  }
}
</code></pre></div> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> This has set the <code>normal</code> attribute <code>node['override_attributes']['apptastic']</code>. </div> </div> <p><strong>Specify a policy</strong></p> <p>Use this option to use policy files by specifying a JSON file that contains the following settings:</p> <table> <col style="width:40%"> <col style="width:60%"> <thead> <tr class="header"> <th>Setting</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>policy_group</code></td> <td>The name of a policy group that exists on the Chef Infra Server.</td> </tr> <tr> <td><code>policy_name</code></td> <td>The name of a policy, as identified by the <code>name</code> setting in a Policyfile.rb file.</td> </tr> </tbody> </table> <p>For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-javascript" data-lang="javascript">{
  <span style="color:#4070a0">"policy_name"</span><span style="color:#666">:</span> <span style="color:#4070a0">"appserver"</span>,
  <span style="color:#4070a0">"policy_group"</span><span style="color:#666">:</span> <span style="color:#4070a0">"staging"</span>
}
</code></pre></div>
</dd> <dt>
<code>-k KEY_FILE</code>, <code>--client_key KEY_FILE</code>
</dt> <dd> <p>The location of the file that contains the client key. Default value: <code>/etc/chef/client.pem</code>.</p> </dd> <dt>
<code>-K KEY_FILE</code>, <code>--validation_key KEY_FILE</code>
</dt> <dd> <p>The location of the file that contains the key used when a Chef Infra Client is registered with a Chef Infra Server. A validation key is signed using the <code>validation_client_name</code> for authentication. Default value: <code>/etc/chef/validation.pem</code>.</p> </dd> <dt>
<code>-l LEVEL</code>, <code>--log_level LEVEL</code>
</dt> <dd> <p>The level of logging to be stored in a log file. Possible levels: <code>auto</code> (default), <code>debug</code>, <code>error</code>, <code>fatal</code>, <code>info</code>, <code>trace</code>, or <code>warn</code>. Default value: <code>warn</code> (when a terminal is available) or <code>info</code> (when a terminal is not available).</p> </dd> <dt>
<code>-L LOGLOCATION</code>, <code>--logfile LOGLOCATION</code>
</dt> <dd> <p>The location of the log file. This is recommended when starting any executable as a daemon. Default value: <code>STDOUT</code>.</p> </dd> <dt><code>--lockfile LOCATION</code></dt> <dd> <p>Use to specify the location of the lock file, which prevents multiple Chef Infra Client processes from converging at the same time.</p> </dd> <dt><code>--minimal-ohai</code></dt> <dd> <p>Run the Ohai plugins for name detection and resource/provider selection and no other Ohai plugins. Set to <code>true</code> during integration testing to speed up test cycles.</p> </dd> <dt><code>--[no-]color</code></dt> <dd> <p>View colored output. Default setting: <code>--color</code>.</p> </dd> <dt><code>--[no-]fips</code></dt> <dd> <p>Allows OpenSSL to enforce FIPS-validated security during a Chef Infra Client run.</p> </dd> <dt><code>--[no-]skip-cookbook-sync</code></dt> <dd> <p>Use cached cookbooks without overwriting local differences from the server. Use with caution. Useful for patching a set of cookbooks on a machine when iterating during development.</p> </dd> <dt><code>--[no-]listen</code></dt> <dd> <p>Run chef-zero in socketless mode. <strong>This is the default behavior on Chef Client 13.1 and above.</strong></p> </dd> <dt>
<code>-n NAME</code>, <code>--named-run-list NAME</code>
</dt> <dd> <p>The run-list associated with a policy file.</p> </dd> <dt>
<code>-N NODE_NAME</code>, <code>--node-name NODE_NAME</code>
</dt> <dd> <p>The unique identifier of the node.</p> </dd> <dt>
<code>-o RUN_LIST_ITEM</code>, <code>--override-runlist RUN_LIST_ITEM</code>
</dt> <dd> <p>Replace the current run-list with the specified items. This option will not clear the list of cookbooks (and related files) that is cached on the node. This option will not persist node data at the end of the client run.</p> </dd> <dt><code>--once</code></dt> <dd> <p>Make only one Chef Infra Client run and cancel <code>interval</code> and <code>splay</code> options.</p> </dd> <dt>
<code>-P PID_FILE</code>, <code>--pid PID_FILE</code>
</dt> <dd> <p>The location in which a process identification number (pid) is saved. An executable, when started as a daemon, writes the pid to the specified file. Default value: <code>/tmp/name-of-executable.pid</code>.</p> </dd> <dt><code>--profile-ruby</code></dt> <dd> <p>Use the <code>--profile-ruby</code> option to dump a (large) profiling graph into <code>/var/chef/cache/graph_profile.out</code>. Use the graph output to help identify, and then resolve performance bottlenecks in a Chef Infra Client run. This option:</p> <ul> <li>Generates a large amount of data about a Chef Infra Client run.</li> <li>Has a dependency on the <code>ruby-prof</code> gem, which is packaged as part of Chef and Chef Workstation.</li> <li>Increases the amount of time required to complete a Chef Infra Client run.</li> <li>Should not be used in a production environment.</li> </ul> </dd> <dt>
<code>-r RUN_LIST_ITEM</code>, <code>--runlist RUN_LIST_ITEM</code>
</dt> <dd> <p>Permanently replace the current run-list with the specified run-list items.</p> </dd> <dt>
<code>-R</code>, <code>--enable-reporting</code>
</dt> <dd> <p>Enable Reporting, which performs data collection during a Chef Infra Client run.</p> </dd> <dt><code>RECIPE_FILE</code></dt> <dd> <p>The path to a recipe. For example, if a recipe file is in the current directory, use <code>recipe_file.rb</code>. This is typically used with the <code>--local-mode</code> option.</p> </dd> <dt><code>--recipe-url=RECIPE_URL</code></dt> <dd> <p>The location of a recipe when it exists at a URL. Use this option only when running Chef Infra Client with the <code>--local-mode</code> option.</p> </dd> <dt><code>--run-lock-timeout SECONDS</code></dt> <dd> <p>The amount of time (in seconds) to wait for a Chef Infra Client lock file to be deleted. Default value: not set (indefinite). Set to <code>0</code> to cause a second Chef Infra Client to exit immediately.</p> </dd> <dt>
<code>-s SECONDS</code>, <code>--splay SECONDS</code>
</dt> <dd> <p>A random number between zero and <code>splay</code> that is added to <code>interval</code>. Use splay to help balance the load on the Chef Infra Server by ensuring that many Chef Infra Client runs are not occurring at the same interval. When running Chef Infra Client at intervals, apply <code>--splay</code> and <code>--interval</code> values before a Chef Infra Client run.</p> <p>Changed in Chef Client 12.0 to be applied before the Chef Client run.</p> </dd> <dt>
<code>-S CHEF_SERVER_URL</code>, <code>--server CHEF_SERVER_URL</code>
</dt> <dd> <p>The URL for the Chef Infra Server.</p> </dd> <dt>
<code>-u USER</code>, <code>--user USER</code>
</dt> <dd> <p>The user that owns a process. This is required when starting any executable as a daemon.</p> </dd> <dt>
<code>-v</code>, <code>--version</code>
</dt> <dd> <p>The Chef Infra Client version.</p> </dd> <dt>
<code>-W</code>, <code>--why-run</code>
</dt> <dd> <p>Run the executable in why-run mode, which is a type of Chef Infra Client run that does everything except modify the system. Use why-run mode to understand why the Chef Infra Client makes the decisions that it makes and to learn more about the current and proposed state of the system.</p> </dd> <dt>
<code>-z</code>, <code>--local-mode</code>
</dt> <dd> <p>Run the Chef Infra Client in local mode. This allows all commands that work against the Chef Infra Server to also work against the local chef-repo.</p> </dd> </dl> <h3 id="chef-infra-client-lock-file">Chef Infra Client Lock File</h3> <p>The Chef Infra Client uses a lock file to ensure that only one Chef Infra Client run is in progress at any time. A lock file is created at the start of a Chef Infra Client run and is deleted at the end of a Chef Infra Client run. A new Chef Infra Client run looks for the presence of a lock file and, if present, will wait for that lock file to be deleted. The location of the lock file can vary by platform.</p> <ul> <li>Use the <code>lockfile</code> setting in the client.rb file to specify non-default locations for the lock file. (The default location is typically platform-dependent and is recommended.)</li> <li>Use the <code>run_lock_timeout</code> setting in the client.rb file to specify the amount of time (in seconds) to wait for the lock file associated with an in-progress Chef Infra Client run to be deleted.</li> </ul> <h2 id="run-in-local-mode">Run in Local Mode</h2> <p>Local mode is a way to run the Chef Infra Client against the chef-repo on a local machine as if it were running against the Chef Infra Server. Local mode relies on chef-zero, which acts as a very lightweight instance of the Chef Infra Server. chef-zero reads and writes to the <code>chef_repo_path</code>, which allows all commands that normally work against the Chef Infra Server to be used against the local chef-repo.</p> <p>Local mode does not require a configuration file, instead it will look for a directory named <code>/cookbooks</code> and will set <code>chef_repo_path</code> to be just above that. (Local mode will honor the settings in a configuration file, if desired.) If the client.rb file is not found and no configuration file is specified, local mode will search for a config.rb file.</p> <p>Local mode will store temporary and cache files under the <code>&lt;chef_repo_path&gt;/.cache</code> directory by default. This allows a normal user to run the Chef Infra Client in local mode without requiring root access.</p> <h3 id="about-why-run-mode">About why-run Mode</h3> <p>why-run mode is a way to see what Chef Infra Client would have configured, had an actual Chef Infra Client run occurred. This approach is similar to the concept of “no-operation” (or “no-op”): decide what should be done, but then don’t actually do anything until it’s done right. This approach to configuration management can help identify where complexity exists in the system, where inter-dependencies may be located, and to verify that everything will be configured in the desired manner.</p> <p>When why-run mode is enabled, a Chef Infra Client run will occur that does everything up to the point at which configuration would normally occur. This includes getting the configuration data, authenticating to the Chef Infra Server, rebuilding the node object, expanding the run-list, getting the necessary cookbook files, resetting node attributes, identifying the resources, and building the resource collection, but does not include mapping each resource to a provider or configuring any part of the system.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> why-run mode is not a replacement for running cookbooks in a test environment that mirrors the production environment. Chef uses why-run mode to learn more about what is going on, but also Kitchen on developer systems, along with an internal OpenStack cloud and external cloud providers to test more thoroughly. </div> </div> <p>When Chef Infra Client is run in why-run mode, certain assumptions are made:</p> <ul> <li>If the <strong>service</strong> resource cannot find the appropriate command to verify the status of a service, why-run mode will assume that the command would have been installed by a previous resource and that the service would not be running.</li> <li>For <code>not_if</code> and <code>only_if</code> properties, why-run mode will assume these are commands or blocks that are safe to run. These conditions are not designed to be used to change the state of the system, but rather to help facilitate idempotency for the resource itself. That said, it may be possible that these attributes are being used in a way that modifies the system state</li> <li>The closer the current state of the system is to the desired state, the more useful why-run mode will be. For example, if a full run-list is run against a fresh system, that run-list may not be completely correct on the first try, but also that run-list will produce more output than a smaller run-list</li> </ul> <p>For example, the <strong>service</strong> resource can be used to start a service. If the action is <code>:start</code>, then the service will start if it isn’t running and do nothing if it is running. If a service is installed from a package, then Chef Infra Client cannot check to see if the service is running until after the package is installed. In that case, why-run mode will indicate what Chef Infra Client would do about the state of the service after installing a package. This is important because service actions often trigger notifications to other resources, so it is important to know that these notifications are triggered correctly.</p> <h3 id="about-chef-zero">About chef-zero</h3> <p>chef-zero is a very lightweight Chef Infra Server that runs in-memory on the local machine. This allows the Chef Infra Client to be run against the chef-repo as if it were running against the Chef Infra Server. chef-zero was <a href="https://github.com/chef/chef-zero">originally a standalone tool</a>; it is enabled from within the Chef Infra Client by using the <code>--local-mode</code> option. chef-zero is very useful for quickly testing and validating the behavior of the Chef Infra Client, cookbooks, recipes, and run-lists before uploading that data to the actual Chef Infra Server.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> chef-zero does not save data between restarts. Because it is intended to be used locally, chef-zero does not perform input validation, authentication, or authorization, as these security measures are not necessary for local testing. For these reasons, we strongly recommend against using chef-zero as a persistent Chef Infra Server. </div> </div> <p>Changed in Chef Client 12.8, now chef-zero supports all Chef Server API version 12 endpoints, except <code>/universe</code>.</p> <h3 id="use-encrypted-data-bags">Use Encrypted Data Bags</h3> <p>Data bags store global variables as JSON data. Data bags are indexed for searching and can be loaded by a cookbook or accessed during a search.</p> <p><strong>Create an encrypted data bag for use with Chef Infra Client local mode</strong></p> <p>To generate an encrypted data bag item in a JSON file for use when Chef Infra Client is run in local mode (via the <code>--local-mode</code> option), enter:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">knife data bag from file my_data_bag /path/to/data_bag_item.json -z --secret-file /path/to/encrypted_data_bag_secret
</code></pre></div>
<p>this will create an encrypted JSON file in:</p> <pre class="highlight" data-language="ruby"><code>data_bags/my_data_bag/data_bag_item.json
</code></pre> <h2 id="run-in-fips-mode">Run in FIPS Mode</h2> <p>Federal Information Processing Standards (FIPS) is a United States government computer security standard that specifies security requirements for cryptography. The current version of the standard is FIPS 140-2. Chef Infra Client can be configured to allow OpenSSL to enforce FIPS-validated security during a Chef Infra Client run. This will disable cryptography that is explicitly disallowed in FIPS-validated software, including certain ciphers and hashing algorithms. Any attempt to use any disallowed cryptography will cause Chef Infra Client to throw an exception during a Chef Infra Client run.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>Chef uses MD5 hashes to uniquely identify files that are stored on the Chef Infra Server. MD5 is used only to generate a unique hash identifier and is not used for any cryptographic purpose.</p> </div> </div> <p>Notes about FIPS:</p> <ul> <li>May be enabled for nodes running on Microsoft Windows and Enterprise Linux platforms</li> <li>Should only be enabled for environments that require FIPS 140-2 compliance</li> </ul> <p><strong>Bootstrap a node using FIPS</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">knife bootstrap 192.0.2.0 -P vanilla -x root -r <span style="color:#4070a0">'recipe[apt],recipe[xfs],recipe[vim]'</span> --fips
</code></pre></div>
<p>which shows something similar to:</p> <pre tabindex="0" class="highlight" data-language="ruby"><code class="language-none" data-lang="none">OpenSSL FIPS 140 mode enabled
...
192.0.2.0 Chef Infra Client finished, 12/12 resources updated in 78.942455583 seconds
</code></pre>
<h2 id="run-as-a-service">Run as a Service</h2> <p>The Chef Infra Client can be run as a daemon. Use the <strong>Chef Infra Client</strong> cookbook to configure the Chef Infra Client as a daemon. Add the <code>default</code> recipe to a node’s run-list, and then use attributes in that cookbook to configure the behavior of the Chef Infra Client. For more information about these configuration options, see the <a href="https://github.com/chef-cookbooks/chef-client/">Chef Infra Client cookbook repository on github</a>.</p> <p>When the Chef Infra Client is run as a daemon, the following signals may be used:</p> <dl> <dt><code>HUP</code></dt> <dd> <p>Use to reconfigure the Chef Infra Client.</p> </dd> <dt><code>INT</code></dt> <dd> <p>Use to terminate immediately without waiting for the current Chef Infra Client run to finish.</p> </dd> <dt><code>QUIT</code></dt> <dd> <p>Use to dump a stack trace, and continue to run.</p> </dd> <dt><code>TERM</code></dt> <dd> <p>Use to terminate but wait for the current Chef Infra Client run to finish, and then exit.</p> </dd> <dt><code>USR1</code></dt> <dd> <p>Use to wake up sleeping Chef Infra Client and trigger node convergence.</p> </dd> </dl> <p>On Microsoft Windows, both the <code>HUP</code> and <code>QUIT</code> signals are not supported.</p> <h2 id="run-with-elevated-privileges">Run with Elevated Privileges</h2> <p>The Chef Infra Client may need to be run with elevated privileges in order to get a recipe to converge correctly. On UNIX and UNIX-like operating systems this can be done by running the command as root. On Microsoft Windows this can be done by running the command prompt as an administrator.</p> <h3 id="linux">Linux</h3> <p>On Linux, the following error sometimes occurs when the permissions used to run the Chef Infra Client are incorrect:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-client
<span style="color:#666">[</span>Tue, <span style="color:#40a070">29</span> Nov <span style="color:#40a070">2015</span> 19:46:17 -0800<span style="color:#666">]</span> INFO: *** Chef 12.X.X ***
<span style="color:#666">[</span>Tue, <span style="color:#40a070">29</span> Nov <span style="color:#40a070">2015</span> 19:46:18 -0800<span style="color:#666">]</span> WARN: Failed to <span style="color:#007020">read</span> the private key /etc/chef/client.pem: <span style="color:#60a0b0;font-style:italic">#&lt;Errno::EACCES: Permission denied - /etc/chef/client.pem&gt;</span>
</code></pre></div>
<p>This can be resolved by running the command as root. There are a few ways this can be done:</p> <ul> <li> <p>Log in as root and then run the Chef Infra Client</p> </li> <li> <p>Use <code>su</code> to become the root user, and then run the Chef Infra Client. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">su
</code></pre></div>
<p>and then:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-client
</code></pre></div>
</li> <li> <p>Use the sudo utility</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">sudo chef-client
</code></pre></div>
</li> <li> <p>Give a user access to read <code>/etc/chef</code> and also the files accessed by the Chef Infra Client. This requires super user privileges and, as such, is not a recommended approach</p> </li> </ul> <h3 id="windows">Windows</h3> <p>On Microsoft Windows, running without elevated privileges (when they are necessary) is an issue that fails silently. It will appear that Chef Infra Client completed its run successfully, but the changes will not have been made. When this occurs, do one of the following to run Chef Infra Client as the administrator:</p> <ul> <li> <p>Log in to the administrator account. (This is not the same as an account in the administrator’s security group.)</p> </li> <li> <p>Run Chef Infra Client process from the administrator account while being logged into another account. Run the following command:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">runas /user:Administrator <span style="color:#4070a0">"cmd /C chef-client"</span>
</code></pre></div>
<p>This will prompt for the administrator account password.</p> </li> <li> <p>Open a command prompt by right-clicking on the command prompt application, and then selecting <strong>Run as administrator</strong>. After the command window opens, Chef Infra Client can be run as the administrator</p> </li> </ul> <h2 id="run-as-non-root-user">Run as Non-root User</h2> <p>In large, distributed organizations the ability to modify the configuration of systems is sometimes segmented across teams, often with varying levels of access to those systems. For example, core application services may be deployed to systems by a central server provisioning team, and then developers on different teams build tooling to support specific applications. In this situation, a developer only requires limited access to machines and only needs to perform the operations that are necessary to deploy tooling for a specific application.</p> <p>The default configuration of the Chef Infra Client assumes that it is run as the root user. This affords the Chef Infra Client the greatest flexibility when managing the state of any object. However, the Chef Infra Client may be run as a non-root user—i.e. “run as a user with limited system privileges”—which can be useful when the objects on the system are available to other user accounts.</p> <p>When the Chef Infra Client is run as a non-root user the Chef Infra Client can perform any action allowed to that user, as long as that action does not also require elevated privileges (such as sudo or pbrun). Attempts to manage any object that requires elevated privileges will result in an error. For example, when the Chef Infra Client is run as a non-root user that is unable to create or modify users, the <strong>user</strong> resource will not work.</p> <h3 id="set-the-cache-path">Set the Cache Path</h3> <p>To run a Chef Infra Client in non-root mode, add the <code>file_cache_path</code> setting to the client.rb file for the node that will run as the non-root user. Set the value of <code>file_cache_path</code> to be the home directory for the user that is running the Chef Infra Client. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file_cache_path <span style="color:#4070a0">'~/.chef/cache'</span>
</code></pre></div>
<p>or:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file_cache_path <span style="color:#60add5">File</span><span style="color:#666">.</span>join(<span style="color:#60add5">File</span><span style="color:#666">.</span>expand_path(<span style="color:#4070a0">'~'</span>), <span style="color:#4070a0">'.chef'</span>, <span style="color:#4070a0">'cache'</span>)
</code></pre></div>
<div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> When running the Chef Infra Client using the <code>--local-mode</code> option, <code>~/.chef/local-mode-cache</code> is the default value for <code>file_cache_path</code>. </div> </div> <h3 id="elevate-commands">Elevate Commands</h3> <p>Another example of running the Chef Infra Client as a non-root user involves using resources to pass sudo commands as as an attribute on the resource. For example, the <strong>service</strong> resource uses a series of <code>_command</code> attributes (like <code>start_command</code>, <code>stop_command</code>, and so on), the <strong>package</strong>-based resources use the <code>options</code> attribute, and the <strong>script</strong>-based resources use the <code>code</code> attribute.</p> <p>A command can be elevated similar to the following:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">service <span style="color:#4070a0">'apache2'</span> <span style="color:#007020;font-weight:700">do</span>
  start_command <span style="color:#4070a0">'sudo /etc/init.d/apache2 start'</span>
  action <span style="color:#517918">:start</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>This approach can work very well on a case-by-case basis. The challenge with this approach is often around managing the size of the <code>/etc/sudoers</code> file.</p> <h2 id="run-on-ibm-aix">Run on IBM AIX</h2> <p>The Chef Infra Client may now be used to configure nodes that are running on the AIX platform, versions 7.1 (TL5 SP2 or higher, recommended) and 7.2. The <strong>service</strong> resource supports starting, stopping, and restarting services that are managed by System Resource Controller (SRC), as well as managing all service states with BSD-based init systems.</p> <p><strong>System Requirements</strong></p> <p>The Chef Infra Client has the <a href="../chef_system_requirements/index.html#chef-infra-client">same system requirements</a> on the AIX platform as any other platform, with the following notes:</p> <ul> <li>Expand the file system on the AIX platform using <code>chfs</code> or by passing the <code>-X</code> flag to <code>installp</code> to automatically expand the logical partition (LPAR)</li> <li>The EN_US (UTF-8) character set should be installed on the logical partition prior to installing the Chef Infra Client</li> </ul> <p><strong>Install the Chef Infra Client on the AIX platform</strong></p> <p>The Chef Infra Client is distributed as a Backup File Format (BFF) binary and is installed on the AIX platform using the following command run as a root user:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-text" data-lang="text"># installp -aYgd chef-12.0.0-1.powerpc.bff all
</code></pre></div>
<p><strong>Increase system process limits</strong></p> <p>The out-of-the-box system process limits for maximum process memory size (RSS) and number of open files are typically too low to run the Chef Infra Client on a logical partition (LPAR). When the system process limits are too low, the Chef Infra Client will not be able to create threads. To increase the system process limits:</p> <ol> <li> <p>Validate that the system process limits have not already been increased.</p> </li> <li> <p>If they have not been increased, run the following commands as a root user:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chsec -f /etc/security/limits -s default -a <span style="color:#4070a0">"rss=-1"</span>
</code></pre></div>
<p>and then:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chsec -f /etc/security/limits -s default -a <span style="color:#4070a0">"data=-1"</span>
</code></pre></div>
<p>and then:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chsec -f /etc/security/limits -s default -a <span style="color:#4070a0">"nofiles=50000"</span>
</code></pre></div>
<div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>The previous commands may be run against the root user, instead of default. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chsec -f /etc/security/limits -s root_user -a <span style="color:#4070a0">"rss=-1"</span>
</code></pre></div> </div> </div> </li> <li> <p>Reboot the logical partition (LPAR) to apply the updated system process limits.</p> </li> </ol> <p>When the system process limits are too low, an error is returned similar to:</p> <pre tabindex="0" class="highlight" data-language="ruby"><code class="language-none" data-lang="none">Error Syncing Cookbooks:
==================================================================

Unexpected Error:
-----------------
ThreadError: can't create Thread: Resource temporarily unavailable
</code></pre>
<p><strong>Install the UTF-8 character set</strong></p> <p>The Chef Infra Client uses the EN_US (UTF-8) character set. By default, the AIX base operating system does not include the EN_US (UTF-8) character set and it must be installed prior to installing the Chef Infra Client. The EN_US (UTF-8) character set may be installed from the first disc in the AIX media or may be copied from <code>/installp/ppc/*EN_US*</code> to a location on the logical partition (LPAR). This topic assumes this location to be <code>/tmp/rte</code>.</p> <p>Use <code>smit</code> to install the EN_US (UTF-8) character set. This ensures that any workload partitions (WPARs) also have UTF-8 applied.</p> <p>Remember to point <code>INPUT device/directory</code> to <code>/tmp/rte</code> when not installing from CD.</p> <ol> <li> <p>From a root shell type:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-text" data-lang="text"># smit lang
</code></pre></div>
<p>A screen similar to the following is returned:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">Manage Language Environment

Move cursor to desired item and press Enter.

Change/Show Primary Language Environment
Add Additional Language Environments
Remove Language Environments
Change/Show Language Hierarchy
Set User Languages
Change/Show Applications <span style="color:#007020;font-weight:700">for</span> a Language
Convert System Messages and Flat Files

<span style="color:#bb60d5">F1</span><span style="color:#666">=</span>Help             <span style="color:#bb60d5">F2</span><span style="color:#666">=</span>Refresh          <span style="color:#bb60d5">F3</span><span style="color:#666">=</span>Cancel           <span style="color:#bb60d5">F8</span><span style="color:#666">=</span>Image
<span style="color:#bb60d5">F9</span><span style="color:#666">=</span>Shell            <span style="color:#bb60d5">F10</span><span style="color:#666">=</span>Exit            <span style="color:#bb60d5">Enter</span><span style="color:#666">=</span>Do
</code></pre></div>
</li> <li> <p>Select <code>Add Additional Language Environments</code> and press <code>Enter</code>. A screen similar to the following is returned:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">Add Additional Language Environments

Type or <span style="color:#007020;font-weight:700">select</span> values in entry fields. Press Enter AFTER making
all desired changes.

<span style="color:#666">[</span>Entry Fields<span style="color:#666">]</span>

CULTURAL convention to install + LANGUAGE translation to
install + INPUT device/directory <span style="color:#007020;font-weight:700">for</span> software <span style="color:#666">[</span>/dev/cd0<span style="color:#666">]</span> + EXTEND file
systems <span style="color:#007020;font-weight:700">if</span> space needed? yes + WPAR Management

Perform Operation in Global Environment yes + Perform
Operation on Detached WPARs no + Detached WPAR Names
<span style="color:#666">[</span>_all_wpars<span style="color:#666">]</span> + Remount Installation Device in WPARs
yes + Alternate WPAR Installation Device <span style="color:#666">[]</span>

<span style="color:#bb60d5">F1</span><span style="color:#666">=</span>Help <span style="color:#bb60d5">F2</span><span style="color:#666">=</span>Refresh <span style="color:#bb60d5">F3</span><span style="color:#666">=</span>Cancel <span style="color:#bb60d5">F4</span><span style="color:#666">=</span>List <span style="color:#bb60d5">F5</span><span style="color:#666">=</span>Reset <span style="color:#bb60d5">F6</span><span style="color:#666">=</span>Command <span style="color:#bb60d5">F7</span><span style="color:#666">=</span>Edit
<span style="color:#bb60d5">F8</span><span style="color:#666">=</span>Image <span style="color:#bb60d5">F9</span><span style="color:#666">=</span>Shell <span style="color:#bb60d5">F10</span><span style="color:#666">=</span>Exit <span style="color:#bb60d5">Enter</span><span style="color:#666">=</span>Do
</code></pre></div>
</li> <li> <p>Cursor over the first two entries—<code>CULTURAL convention to install</code> and <code>LANGUAGE translation to install</code>—and use <code>F4</code> to navigate through the list until <code>UTF-8 English (United States) [EN_US]</code> is selected. (EN_US is in capital letters!)</p> </li> <li> <p>Press <code>Enter</code> to apply and install the language set.</p> </li> </ol> <p><strong>Providers</strong></p> <p>The <strong>service</strong> resource has the following providers to support the AIX platform:</p> <table> <col style="width:27%"> <col style="width:14%"> <col style="width:58%"> <thead> <tr class="header"> <th>Long name</th> <th>Short name</th> <th>Notes</th> </tr> </thead> <tbody> <tr> <td><code>Chef::Provider::Service::Aix</code></td> <td><code>service</code></td> <td>The provider that is used with the AIX platforms. Use the <code>service</code> short name to start, stop, and restart services with System Resource Controller (SRC).</td> </tr> <tr> <td><code>Chef::Provider::Service::AixInit</code></td> <td><code>service</code></td> <td>The provider that is used to manage BSD-based init services on AIX.</td> </tr> </tbody> </table> <p><strong>Enable a service on AIX using the mkitab command</strong></p> <p>The <strong>service</strong> resource does not support using the <code>:enable</code> and <code>:disable</code> actions with resources that are managed using System Resource Controller (SRC). This is because System Resource Controller (SRC) does not have a standard mechanism for enabling and disabling services on system boot.</p> <p>One approach for enabling or disabling services that are managed by System Resource Controller (SRC) is to use the <strong>execute</strong> resource to invoke <code>mkitab</code>, and then use that command to enable or disable the service.</p> <p>The following example shows how to install a service:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">execute <span style="color:#4070a0">"install </span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'chef_client'</span><span style="color:#666">][</span><span style="color:#4070a0">'svc_name'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0"> in SRC"</span> <span style="color:#007020;font-weight:700">do</span>
  command <span style="color:#4070a0">"mkssys -s </span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'chef_client'</span><span style="color:#666">][</span><span style="color:#4070a0">'svc_name'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">                  -p </span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'chef_client'</span><span style="color:#666">][</span><span style="color:#4070a0">'bin'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">                  -u root
</span><span style="color:#4070a0">                  -S
</span><span style="color:#4070a0">                  -n 15
</span><span style="color:#4070a0">                  -f 9
</span><span style="color:#4070a0">                  -o </span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'chef_client'</span><span style="color:#666">][</span><span style="color:#4070a0">'log_dir'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">/client.log
</span><span style="color:#4070a0">                  -e </span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'chef_client'</span><span style="color:#666">][</span><span style="color:#4070a0">'log_dir'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">/client.log -a '
</span><span style="color:#4070a0">                  -i </span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'chef_client'</span><span style="color:#666">][</span><span style="color:#4070a0">'interval'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">                  -s </span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'chef_client'</span><span style="color:#666">][</span><span style="color:#4070a0">'splay'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">'"</span>
  not_if <span style="color:#4070a0">"lssrc -s </span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'chef_client'</span><span style="color:#666">][</span><span style="color:#4070a0">'svc_name'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">"</span>
  action <span style="color:#517918">:run</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>and then enable it using the <code>mkitab</code> command:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">execute <span style="color:#4070a0">"enable </span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'chef_client'</span><span style="color:#666">][</span><span style="color:#4070a0">'svc_name'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">"</span> <span style="color:#007020;font-weight:700">do</span>
  command <span style="color:#4070a0">"mkitab '</span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'chef_client'</span><span style="color:#666">][</span><span style="color:#4070a0">'svc_name'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">:2:once:/usr/bin/startsrc
</span><span style="color:#4070a0">                  -s </span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'chef_client'</span><span style="color:#666">][</span><span style="color:#4070a0">'svc_name'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0"> &gt; /dev/console 2&gt;&amp;1'"</span>
  not_if <span style="color:#4070a0">"lsitab </span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'chef_client'</span><span style="color:#666">][</span><span style="color:#4070a0">'svc_name'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">"</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<h2 id="configuring-a-proxy-server">Configuring a Proxy Server</h2> <p>See the <a href="../proxies/index.html">proxies</a> documentation for information on how to configure Chef Infra Client to use a proxy server.</p> <h2 id="examples">Examples</h2> <p><strong>Run the Chef Infra Client</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">sudo chef-client
</code></pre></div>
<p><strong>Start a run when the Chef Infra Client is running as a daemon</strong></p> <p>A Chef Infra Client that is running as a daemon can be woken up and started by sending the process a <code>SIGUSR1</code>. For example, to trigger a Chef Infra Client run on a machine running Linux:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">sudo killall -USR1 chef-client
</code></pre></div>
<p><strong>Setting the initial run-list using a JSON file</strong></p> <p>A node’s initial run-list is specified using a JSON file on the host system. When running Chef Infra Client as an executable, use the <code>-j</code> option to tell Chef Infra Client which JSON file to use. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-client -j /etc/chef/file.json --environment _default
</code></pre></div>
<p>where <code>file.json</code> is similar to:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-javascript" data-lang="javascript">{
  <span style="color:#4070a0">"resolver"</span><span style="color:#666">:</span> {
    <span style="color:#4070a0">"nameservers"</span><span style="color:#666">:</span> [ <span style="color:#4070a0">"10.0.0.1"</span> ],
    <span style="color:#4070a0">"search"</span><span style="color:#666">:</span><span style="color:#4070a0">"int.example.com"</span>
  },
  <span style="color:#4070a0">"run_list"</span><span style="color:#666">:</span> [ <span style="color:#4070a0">"recipe[resolver]"</span> ]
}
</code></pre></div>
<p>and where <code>_default</code> is the name of the environment that is assigned to the node.</p> <div class="admonition-warning"> <p class="admonition-warning-title">Warning</p> <div class="admonition-warning-text"> <p>This approach may be used to update <a href="../attributes.html#attribute-types">normal</a> attributes, but should never be used to update any other attribute type, as all attributes updated using this option are treated as <code>normal</code> attributes.</p> </div> </div> </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; Chef Software, Inc.<br>Licensed under the Creative Commons Attribution 3.0 Unported License.<br>The Chef&trade; Mark and Chef Logo are either registered trademarks/service marks or trademarks/servicemarks of Chef, in the United States and other countries and are used with Chef Inc's permission.<br>We are not affiliated with, endorsed or sponsored by Chef Inc.<br>
    <a href="https://docs.chef.io/ctl_chef_client/" class="_attribution-link">https://docs.chef.io/ctl_chef_client/</a>
  </p>
</div>
