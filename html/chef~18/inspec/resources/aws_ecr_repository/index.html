<div id="col-content" data-swiftype-index="true"> <div id="aws_ecr_repository-resource"><h1>aws_ecr_repository resource</h1></div>  <div class="prose"> <p data-swiftype-index="false"> <a href="https://github.com/inspec/inspec/tree/main/docs-chef-io/content/inspec/resources/aws_ecr_repository.md" alt="Link to page on GitHub repository">[edit on GitHub]</a> </p> <p>Use the <code>aws_ecr_repository</code> InSpec audit resource to test the properties of a single AWS Elastic Container Registry (ECR) repository. This resource is available in InSpec AWS resource pack version <strong><a href="https://github.com/inspec/inspec-aws/releases/tag/v1.11.0">1.11.0</a></strong> onwards.</p> <h2 id="syntax">Syntax</h2> <p>An <code>aws_ecr_repository</code> resource block declares the tests for a single AWS ECR repository by repository name.</p> <pre class="highlight" data-language="ruby"><code>describe aws_ecr_repository(repository_name: 'my-repo') do
  it { should exist }
end
</code></pre> <p>The value of the <code>repository_name</code> can be provided as a string.</p> <pre class="highlight" data-language="ruby"><code>describe aws_ecr_repository('my-repo') do
  it { should exist }
end
</code></pre> <h2 id="parameters">Parameters</h2> <p>The repository name must be provided. The registry id is optional.</p> <h3 id="repository_name-_required_">repository_name <em>(required)</em>
</h3> <p>The name of the ECR repository must satisfy the following constraints:</p> <ul> <li>Regex pattern <code>(?:[a-z0-9]+(?:[._-][a-z0-9]+)*/)*[a-z0-9]+(?:[._-][a-z0-9]+)*</code>.</li> <li>Minimum 2 and maximum of 256 characters long.</li> </ul> <p>This can be passed either as a string or as a <code>repository_name: 'value'</code> key-value entry in a hash.</p> <h3 id="registry_id-_optional_">registry_id <em>(optional)</em>
</h3> <p>The 12-digit ID of the AWS Elastic Container Registry. If not provided, the <a href="https://docs.aws.amazon.com/AmazonECR/latest/APIReference/API_DescribeRepositories.html">default</a> registry is assumed.</p> <h2 id="properties">Properties</h2> <table> <thead> <tr> <th>Property</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td>repository_name</td> <td>The name of the repository.</td> </tr> <tr> <td>image_tag_mutability</td> <td>The tag mutability settings for the repository. Valid values are <code>MUTABLE</code> or <code>IMMUTABLE</code>.</td> </tr> <tr> <td>registry_id</td> <td>The AWS account ID associated with the registry that contains the repository.</td> </tr> <tr> <td>tags</td> <td>An hash with each key-value pair corresponding to a tag associated with the entity.</td> </tr> </tbody> </table> <p>There are also additional properties available. For a comprehensive list, see <a href="https://docs.aws.amazon.com/AmazonECR/latest/APIReference/API_Repository.html">the API reference documentation</a></p> <h2 id="examples">Examples</h2> <h3 id="test-that-image-tags-are-immutable-in-an-ecr-repository">Test that image tags are <code>IMMUTABLE</code> in an ECR repository</h3> <pre class="highlight" data-language="ruby"><code>describe aws_ecr_repository('my-repo') do
  its('image_tag_mutability') { should eq 'IMMUTABLE' }
end
</code></pre> <h3 id="test-that-images-are-scanned-for-vulnerabilities-at-a-push-to-repository">Test that images are scanned for vulnerabilities at a push to repository</h3> <pre class="highlight" data-language="ruby"><code>describe aws_ecr_repository(repository_name: 'my-repo') do
  its('image_scanning_configuration.scan_on_push') { should eq true}
end
</code></pre> <h3 id="test-that-an-ecr-repository-has-a-certain-tag">Test that an ECR repository has a certain tag</h3> <pre class="highlight" data-language="ruby"><code>describe aws_ecr_repository('my-repo') do
  its('tags') { should include('environment' =&gt; 'dev') }
end
</code></pre> <h2 id="matchers">Matchers</h2> <p>This InSpec audit resource has the following special matchers. For a full list of available matchers, please visit our <a href="../../matchers/index.html">matchers page</a>.</p> <h3 id="exist">exist</h3> <pre class="highlight" data-language="ruby"><code>describe aws_ecr_repository(repository_name: 'my-repo') do
    it { should exist }
end
</code></pre> <h2 id="aws-permissions">AWS Permissions</h2> <p>Your <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/intro-structure.html#intro-structure-principal">Principal</a> will need the <code>ecr:DescribeRepositories</code> action set to allow.</p> <p>You can find detailed documentation at <a href="https://docs.aws.amazon.com/AmazonECR/latest/APIReference/API_Operations.html">Actions, Resources, and Condition Keys for Amazon ECR</a>, and <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/list_identityandaccessmanagement.html">Actions, Resources, and Condition Keys for Identity And Access Management</a>.</p> </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; Chef Software, Inc.<br>Licensed under the Creative Commons Attribution 3.0 Unported License.<br>The Chef&trade; Mark and Chef Logo are either registered trademarks/service marks or trademarks/servicemarks of Chef, in the United States and other countries and are used with Chef Inc's permission.<br>We are not affiliated with, endorsed or sponsored by Chef Inc.<br>
    <a href="https://docs.chef.io/inspec/resources/aws_ecr_repository/" class="_attribution-link">https://docs.chef.io/inspec/resources/aws_ecr_repository/</a>
  </p>
</div>
