<div id="col-content" data-swiftype-index="true"> <div id="elasticsearch-resource"><h1>elasticsearch resource</h1></div>  <div class="prose"> <p data-swiftype-index="false"> <a href="https://github.com/inspec/inspec/tree/main/docs-chef-io/content/inspec/resources/elasticsearch.md" alt="Link to page on GitHub repository">[edit on GitHub]</a> </p> <p>Use the <code>elasticsearch</code> resource to test the status of a node against a running Elasticsearch cluster. Chef InSpec retrieves the node list from the cluster node URL provided (defaults to <code>http://localhost:9200</code>) and provides the ability to query a variety of settings and statuses.</p> <h2 id="availability">Availability</h2> <h3 id="installation">Installation</h3> <p>This resource is distributed along with Chef InSpec itself. You can use it automatically.</p> <h3 id="version">Version</h3> <p>This resource first became available in v1.43.5 of InSpec.</p> <h2 id="syntax">Syntax</h2> <pre class="highlight" data-language="ruby"><code>describe elasticsearch do
  its('property') { should cmp 'value' }
end
</code></pre> <h2 id="supported-resource-parameters">Supported Resource Parameters</h2> <p>The <code>elasticsearch</code> resource accepts several optional resource parameters:</p> <dl> <dt><code>url</code></dt> <dd>the top-level URL of an Elasticsearch node in the cluster. If your Elasticsearch installation is not served out of the top-level directory at the host, be sure to specify the full URL; for example: <code>http://my-load-balancer/elasticsearch</code>. Default: <code>http://localhost:9200</code>
</dd> <dt><code>username</code></dt> <dd>a username to use to log in with HTTP-Basic authentication. If <code>username</code> is provided, a <code>password</code> must also be provided.</dd> <dt><code>password</code></dt> <dd>a password to use to log in with HTTP-Basic authentication. If <code>password</code> is provided, a <code>username</code> must also be provided.</dd> <dt><code>ssl_verify</code></dt> <dd>if <code>false</code>, SSL certificate validation will be disabled. Default: <code>true</code>
</dd> </dl> <p>In addition, the <code>elasticsearch</code> resource allows for filtering the nodes returned by property before executing the tests:</p> <pre class="highlight" data-language="ruby"><code>describe elasticsearch.where { node_name == 'one-off-node' } do
  its('version') { should eq '1.2.3' }
end

describe elasticsearch.where { process.mlockall == false } do
  its('count') { should cmp 0 }
end
</code></pre> <p>To simply check if nodes exist that match the criteria, use the <code>exist</code> matcher:</p> <pre class="highlight" data-language="ruby"><code>describe elasticsearch.where { cluster_name == 'my_cluster' } do
  it { should exist }
end
</code></pre> <h2 id="properties">Properties</h2> <p>The following are the different properties of the resource:</p> <p>Since the <code>elasticsearch</code> resource is meant for use on a cluster, each property will return an array of the values for each node that matches any provided search criteria. Using InSpec’s <code>cmp</code> matcher helps avoid issues when comparing values when there is only a single match (i.e. when the cluster only contains a single node or the <code>where</code> filter criteria provided only returns a single node).</p> <h3 id="build_hash">build_hash</h3> <p>The <code>build hash</code> property returns the build hash for each of the nodes.</p> <pre class="highlight" data-language="ruby"><code>its('build_hash') { should cmp 'b2f0c09' }
</code></pre> <h3 id="cluster_name">cluster_name</h3> <p>The <code>cluster_name</code> property returns the cluster names of each of the nodes.</p> <pre class="highlight" data-language="ruby"><code>its('cluster_name') { should cmp 'my_cluster' }
</code></pre> <h3 id="host">host</h3> <p>The <code>host</code> property returns the hostname of each of the nodes. This may return an IP address if the node is improperly performing DNS resolution or has no hostname set.</p> <pre class="highlight" data-language="ruby"><code>its('host') { should cmp 'my.hostname.mycompany.biz' }
</code></pre> <h3 id="http">http</h3> <p>The <code>http</code> property returns a hash of HTTP-related settings for each of the nodes. In this example, the <code>first</code> method is used to grab only the first node’s HTTP-related info and is a way of removing the item from the Array if only one node is being queried.</p> <pre class="highlight" data-language="ruby"><code>its('http.first.max_content_length_in_bytes') { should cmp 123456 }
</code></pre> <h3 id="ingest">ingest</h3> <p>The <code>ingest</code> property returns ingest-related settings and capabilities, such as available processors.</p> <pre class="highlight" data-language="ruby"><code>its('ingest.first.processors.count') { should be &gt;= 1 }
</code></pre> <h3 id="ip">ip</h3> <p>The <code>ip</code> property returns the IP address of each of the nodes.</p> <pre class="highlight" data-language="ruby"><code>its('ip') { should cmp '192.168.1.100' }
</code></pre> <h3 id="jvm">jvm</h3> <p>The <code>jvm</code> property returns Java Virtual Machine related parameters for each of the nodes.</p> <pre class="highlight" data-language="ruby"><code>its('jvm.first.version') { should cmp '1.8.0_141' }
</code></pre> <h3 id="module_list">module_list</h3> <p>The <code>module_list</code> property returns a list of enabled modules for each node in the cluster.</p> <pre class="highlight" data-language="ruby"><code>its('module_list.first') { should include 'my_module' }
</code></pre> <h3 id="modules">modules</h3> <p>The <code>modules</code> property returns detailed information about each enabled module for each node in the cluster.</p> <pre class="highlight" data-language="ruby"><code>its('modules.first') { should include 'lang-groovy' }
</code></pre> <h3 id="node_name">node_name</h3> <p>The <code>node_name</code> property returns the node name for each node in the cluster.</p> <pre class="highlight" data-language="ruby"><code>its('node_name') { should cmp 'node1' }
</code></pre> <h3 id="node_id">node_id</h3> <p>The <code>node_id</code> property returns the node IDs of each of the nodes in the cluster.</p> <pre class="highlight" data-language="ruby"><code>its('node_id') { should include 'my_node_id' }
</code></pre> <h3 id="os">os</h3> <p>The <code>os</code> property returns OS-related information about each node in the cluster.</p> <pre class="highlight" data-language="ruby"><code>its('os.first.arch') { should cmp 'amd64' }
</code></pre> <h3 id="plugin_list">plugin_list</h3> <p>The <code>plugin_list</code> property returns a list of enabled plugins for each node in the cluster. For more additional information about each plugin, use the <code>plugins</code> property.</p> <pre class="highlight" data-language="ruby"><code>its('plugin_list.first') { should include 'my_plugin' }
</code></pre> <h3 id="plugins">plugins</h3> <p>The <code>plugins</code> property returns detailed information about each enabled plugin for each node in the cluster.</p> <pre class="highlight" data-language="ruby"><code>its('plugins.first') { should include 'my_plugin' }
</code></pre> <h3 id="process">process</h3> <p>The <code>process</code> property returns process information for each node in the cluster, such as the process ID.</p> <pre class="highlight" data-language="ruby"><code>its('process.first.mlockall') { should cmp true }
</code></pre> <h3 id="roles">roles</h3> <p>The <code>roles</code> property returns the role for each of the nodes in the cluster.</p> <pre class="highlight" data-language="ruby"><code>its('roles') { should include 'master' }
</code></pre> <h3 id="settings">settings</h3> <p>The <code>settings</code> property returns all the configuration settings for each node in the cluster. These settings usually include those set in the elasticsearch.yml as well as those set via <code>-Des.</code> or <code>-E</code> flags at startup. Use the <code>inspec shell</code> to explore the various setting keys that are available.</p> <pre class="highlight" data-language="ruby"><code>its('settings.first.path.home') { should cmp '/usr/share/elasticsearch' }
</code></pre> <h3 id="total_indexing_buffer">total_indexing_buffer</h3> <p>The <code>total_indexing_buffer</code> property returns the total indexing buffer for each node in the cluster.</p> <pre class="highlight" data-language="ruby"><code>its('total_indexing_buffer') { should cmp 123456 }
</code></pre> <h3 id="transport">transport</h3> <p>The <code>transport</code> property returns transport-related settings for each node in the cluster, such as the bound and published addresses.</p> <pre class="highlight" data-language="ruby"><code>its('transport.first.bound_address') { should cmp '1.2.3.4:9200' }
</code></pre> <h3 id="transport_address">transport_address</h3> <p>The <code>transport_address</code> property returns the bound transport address for each node in the cluster.</p> <pre class="highlight" data-language="ruby"><code>its('transport_address') { should cmp '1.2.3.4:9200' }
</code></pre> <h3 id="version-1">version</h3> <p>The <code>version</code> property returns the version of Elasticsearch running on each node of the cluster.</p> <pre class="highlight" data-language="ruby"><code>its('version') { should cmp '5.5.2' }
</code></pre> <h2 id="examples">Examples</h2> <h3 id="test-to-verify-the-specific-module-uses-additional-ruby-to-find-a-specific-module-and-assert-a-value-for-a-succinct-list-of-the-names-of-each-of-the-modules-enabled-use-the-module_list-property">Test to verify the specific module. Uses additional Ruby to find a specific module and assert a value. For a succinct list of the names of each of the modules enabled, use the <code>module_list</code> property.</h3> <pre class="highlight" data-language="ruby"><code>modules = elasticsearch.modules.first
lang_groovy_module = modules.find { |mod| mod.name == 'lang-groovy' }

describe 'lang-groovy module version' do
  subject { lang_groovy_module }
  its('version') { should cmp '5.5.2' }
end
</code></pre> <h3 id="tests-to-verify-the-specific-plugin-uses-additional-ruby-to-find-a-specific-plugin-and-assert-a-value-for-a-succinct-list-of-the-names-of-each-of-the-plugins-enabled-use-the-plugin_list-property">Tests to verify the specific plugin. Uses additional Ruby to find a specific plugin and assert a value. For a succinct list of the names of each of the plugins enabled, use the <code>plugin_list</code> property.</h3> <pre class="highlight" data-language="ruby"><code>plugins = elasticsearch.plugins.first
my_plugin = plugins.find { |plugin| plugin.name == 'my_plugin' }

describe 'my_plugin plugin version' do
  subject { my_plugin }
  its('version') { should cmp '1.2.3' }
end
</code></pre> <h2 id="matchers">Matchers</h2> <p>For a full list of available matchers, please visit our <a href="../../matchers/index.html">matchers page</a>.</p> </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; Chef Software, Inc.<br>Licensed under the Creative Commons Attribution 3.0 Unported License.<br>The Chef&trade; Mark and Chef Logo are either registered trademarks/service marks or trademarks/servicemarks of Chef, in the United States and other countries and are used with Chef Inc's permission.<br>We are not affiliated with, endorsed or sponsored by Chef Inc.<br>
    <a href="https://docs.chef.io/inspec/resources/elasticsearch/" class="_attribution-link">https://docs.chef.io/inspec/resources/elasticsearch/</a>
  </p>
</div>
