<div id="col-content" data-swiftype-index="true"> <h1 id="registry_key-resource">registry_key Resource</h1>  <div class="prose"> <p data-swiftype-index="false"> <button onclick="resource_note_function('resource_note')" class="note-btn note-block note-left-align">Edit this page in the Chef repository</button> </p>
<div id="resource_note" class="note-container note-hide"> <p> This page is generated from the <a href="https://github.com/chef/chef">Chef Infra Client source code</a>. To suggest a change, edit the <a href="https://github.com/chef/chef/blob/main/lib/chef/resource/registry_key.rb">registry_key.rb</a> file and submit a pull request to the <a href="https://github.com/chef/chef">Chef Infra Client repository</a>. </p> </div> <p data-swiftype-index="false"><a href="../index.html">All Infra resources page</a></p> <hr> <p>Use the <strong>registry_key</strong> resource to create and delete registry keys in Microsoft Windows.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> 
<p>64-bit versions of Microsoft Windows have a 32-bit compatibility layer in the registry that reflects and redirects certain keys (and their values) into specific locations (or logical views) of the registry hive.</p> <p>Chef Infra Client can access any reflected or redirected registry key. The machine architecture of the system on which Chef Infra Client is running is used as the default (non-redirected) location. Access to the SysWow64 location is redirected must be specified. Typically, this is only necessary to ensure compatibility with 32-bit applications that are running on a 64-bit operating system.</p> <p>For more information, see: <a href="https://docs.microsoft.com/en-us/windows/win32/winprog64/registry-reflection">Registry Reflection</a>.</p> </div> </div> <h2 id="syntax">Syntax</h2> <hr> 
<p>A <strong>registry_key</strong> resource block creates and deletes registry keys in Microsoft Windows:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">registry_key <span style="color:#4070a0">'HKEY_LOCAL_MACHINE\\...\\System'</span> <span style="color:#007020;font-weight:700">do</span>
  values <span style="color:#666">[</span>{
    <span style="color:#007020">name</span>: <span style="color:#4070a0">'NewRegistryKeyValue'</span>,
    <span style="color:#517918">type</span>: <span style="color:#517918">:multi_string</span>,
    <span style="color:#517918">data</span>: <span style="color:#c65d09">%w(foo bar baz)</span>,
  }<span style="color:#666">]</span>
  action <span style="color:#517918">:create</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Use multiple registry key entries with key values that are based on node attributes:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">registry_key <span style="color:#4070a0">'HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\name_of_registry_key'</span> <span style="color:#007020;font-weight:700">do</span>
  values <span style="color:#666">[</span>{<span style="color:#007020">name</span>: <span style="color:#4070a0">'key_name'</span>, <span style="color:#517918">type</span>: <span style="color:#517918">:string</span>, <span style="color:#517918">data</span>: <span style="color:#4070a0">'C:\Windows\System32\file_name.bmp'</span>},
          {<span style="color:#007020">name</span>: <span style="color:#4070a0">'key_name'</span>, <span style="color:#517918">type</span>: <span style="color:#517918">:string</span>, <span style="color:#517918">data</span>: node<span style="color:#666">[</span><span style="color:#4070a0">'node_name'</span><span style="color:#666">][</span><span style="color:#4070a0">'attribute'</span><span style="color:#666">][</span><span style="color:#4070a0">'value'</span><span style="color:#666">]</span>},
          {<span style="color:#007020">name</span>: <span style="color:#4070a0">'key_name'</span>, <span style="color:#517918">type</span>: <span style="color:#517918">:string</span>, <span style="color:#517918">data</span>: node<span style="color:#666">[</span><span style="color:#4070a0">'node_name'</span><span style="color:#666">][</span><span style="color:#4070a0">'attribute'</span><span style="color:#666">][</span><span style="color:#4070a0">'value'</span><span style="color:#666">]</span>}
         <span style="color:#666">]</span>
  action <span style="color:#517918">:create</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>The registry_key resource has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">registry_key <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  architecture      <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># default value: :machine</span>
  key               <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  recursive         <span style="color:#007020">true</span>, <span style="color:#007020">false</span> <span style="color:#60a0b0;font-style:italic"># default value: false</span>
  values
  action            <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :create if not specified</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <p>where:</p> <ul> <li>
<code>registry_key</code> is the resource</li> <li>
<code>name</code> is the name of the resource block</li> <li>
<code>values</code> is a hash that contains at least one registry key to be created or deleted. Each registry key in the hash is grouped by brackets in which the <code>name:</code>, <code>type:</code>, and <code>data:</code> values for that registry key are specified.</li> <li>
<p><code>type:</code> represents the values available for registry keys in Microsoft Windows. Use <code>:binary</code> for REG_BINARY, <code>:string</code> for REG_SZ, <code>:multi_string</code> for REG_MULTI_SZ, <code>:expand_string</code> for REG_EXPAND_SZ, <code>:dword</code> for REG_DWORD, <code>:dword_big_endian</code> for REG_DWORD_BIG_ENDIAN, or <code>:qword</code> for REG_QWORD. </p>
<div class="admonition-warning"> <p class="admonition-warning-title">Warning</p> <div class="admonition-warning-text"> <code>:multi_string</code> must be an array, even if there is only a single string.</div>
</div> </li> <li>
<code>action</code> identifies the steps Chef Infra Client will take to bring the node into the desired state</li> <li>
<code>architecture</code>, <code>key</code>, <code>recursive</code> and <code>values</code> are properties of this resource, with the Ruby type shown. See “Properties” section below for more information about all of the properties that may be used with this resource.</li> </ul> <h3 id="windows-registry-key-backslashes">Registry Key Path Separators</h3> <p>A Microsoft Windows registry key can be used as a string in Ruby code, such as when a registry key is used as the name of a recipe. In Ruby, when a registry key is enclosed in a double-quoted string (<code>" "</code>), the same backslash character (<code>\</code>) that is used to define the registry key path separator is also used in Ruby to define an escape character. Therefore, the registry key path separators must be escaped when they are enclosed in a double-quoted string. For example, the following registry key:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#60add5">HKCU</span>\<span style="color:#60add5">SOFTWARE</span>\<span style="color:#60add5">Policies</span>\<span style="color:#60add5">Microsoft</span>\<span style="color:#60add5">Windows</span>\<span style="color:#60add5">CurrentVersion</span>\<span style="color:#60add5">Themes</span>
</code></pre></div>
<p>may be enclosed in a single-quoted string with a single backslash:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#4070a0">'HKCU\SOFTWARE\path\to\key\Themes'</span>
</code></pre></div>
<p>or may be enclosed in a double-quoted string with an extra backslash as an escape character:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#4070a0">"HKCU</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">SOFTWARE</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">path</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">to</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">key</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">Themes"</span>
</code></pre></div> <h3 id="dsl-recipe-method-windows-methods">Chef Infra Language Methods</h3> Six methods are present in the Chef Infra Language to help verify the registry during a Chef Infra Client run on the Microsoft Windows platform—<code>registry_data_exists?</code>, <code>registry_get_subkeys</code>, <code>registry_get_values</code>, <code>registry_has_subkeys?</code>, <code>registry_key_exists?</code>, and <code>registry_value_exists?</code>—these helpers ensure the <strong>powershell_script</strong> resource is idempotent. <h4 id="dsl-recipe-method-registry-data-exists">registry_data_exists?</h4> <p>Use the <code>registry_data_exists?</code> method to find out if a Microsoft Windows registry key contains the specified data of the specified type under the value.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p> This method can be used in recipes and from within the <code>not_if</code> and <code>only_if</code> blocks in resources. This method is not designed to create or modify a registry key. If a registry key needs to be modified, use the <strong>registry_key</strong> resource. </p> </div> </div> <p>The syntax for the <code>registry_data_exists?</code> method is as follows:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">registry_data_exists?(
  <span style="color:#60add5">KEY_PATH</span>,
  { <span style="color:#007020">name</span>: <span style="color:#4070a0">'NAME'</span>, <span style="color:#517918">type</span>: <span style="color:#60add5">TYPE</span>, <span style="color:#517918">data</span>: <span style="color:#60add5">DATA</span> },
  <span style="color:#60add5">ARCHITECTURE</span>
)
</code></pre></div>
<p>where:</p> <ul> <li>
<code>KEY_PATH</code> is the path to the registry key value. The path must include the registry hive, which can be specified either as its full name or as the 3- or 4-letter abbreviation. For example, both <code>HKLM\SECURITY</code> and <code>HKEY_LOCAL_MACHINE\SECURITY</code> are both valid and equivalent. The following hives are valid: <code>HKEY_LOCAL_MACHINE</code>, <code>HKLM</code>, <code>HKEY_CURRENT_CONFIG</code>, <code>HKCC</code>, <code>HKEY_CLASSES_ROOT</code>, <code>HKCR</code>, <code>HKEY_USERS</code>, <code>HKU</code>, <code>HKEY_CURRENT_USER</code>, and <code>HKCU</code>.</li> <li>
<code>{ name: 'NAME', type: TYPE, data: DATA }</code> is a hash that contains the expected name, type, and data of the registry key value</li> <li>
<code>type:</code> represents the values available for registry keys in Microsoft Windows. Use <code>:binary</code> for REG_BINARY, <code>:string</code> for REG_SZ, <code>:multi_string</code> for REG_MULTI_SZ, <code>:expand_string</code> for REG_EXPAND_SZ, <code>:dword</code> for REG_DWORD, <code>:dword_big_endian</code> for REG_DWORD_BIG_ENDIAN, or <code>:qword</code> for REG_QWORD.</li> <li>
<code>ARCHITECTURE</code> is one of the following values: <code>:x86_64</code>, <code>:i386</code>, or <code>:machine</code>. Set to <code>:i386</code> to read or write 32-bit registry keys on 64-bit machines running Microsoft Windows. Set to<code>:x86_64</code> to force write to a 64-bit registry location, however Chef Infra Client returns an exception if <code>:x86_64</code> is used on a 32-bit machine. Set to <code>:machine</code> to allow Chef Infra Client to allow Chef Infra Client to use the appropriate key location based on your node’s architecture. Default value: <code>:machine</code>.</li> </ul> <p>This method will return <code>true</code> or <code>false</code>.</p> <h4 id="dsl-recipe-method-registry-get-subkeys">registry_get_subkeys</h4> <p>Use the <code>registry_get_subkeys</code> method to get a list of registry key values that are present for a Microsoft Windows registry key.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p> This method can be used in recipes and from within the <code>not_if</code> and <code>only_if</code> blocks in resources. This method is not designed to create or modify a registry key. If a registry key needs to be modified, use the <strong>registry_key</strong> resource. </p> </div> </div> <p>The syntax for the <code>registry_get_subkeys</code> method is as follows:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subkey_array <span style="color:#666">=</span> registry_get_subkeys(<span style="color:#60add5">KEY_PATH</span>, <span style="color:#60add5">ARCHITECTURE</span>)
</code></pre></div>
<p>where:</p> <ul> <li>
<code>KEY_PATH</code> is the path to the registry key. The path must include the registry hive, which can be specified either as its full name or as the 3- or 4-letter abbreviation. For example, both <code>HKLM\SECURITY</code> and <code>HKEY_LOCAL_MACHINE\SECURITY</code> are both valid and equivalent. The following hives are valid: <code>HKEY_LOCAL_MACHINE</code>, <code>HKLM</code>, <code>HKEY_CURRENT_CONFIG</code>, <code>HKCC</code>, <code>HKEY_CLASSES_ROOT</code>, <code>HKCR</code>, <code>HKEY_USERS</code>, <code>HKU</code>, <code>HKEY_CURRENT_USER</code>, and <code>HKCU</code>.</li> <li>
<code>ARCHITECTURE</code> is one of the following values: <code>:x86_64</code>, <code>:i386</code>, or <code>:machine</code>. Set to <code>:i386</code> to read or write 32-bit registry keys on 64-bit machines running Microsoft Windows. Set to<code>:x86_64</code> to force write to a 64-bit registry location, however Chef Infra Client returns an exception if <code>:x86_64</code> is used on a 32-bit machine. Set to <code>:machine</code> to allow Chef Infra Client to allow Chef Infra Client to use the appropriate key location based on your node’s architecture. Default value: <code>:machine</code>.</li> </ul> <p>This returns an array of registry key values.</p> <h4 id="dsl-recipe-method-registry-get-values">registry_get_values</h4> <p>Use the <code>registry_get_values</code> method to get the registry key values (name, type, and data) for a Microsoft Windows registry key.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p> This method can be used in recipes and from within the <code>not_if</code> and <code>only_if</code> blocks in resources. This method is not designed to create or modify a registry key. If a registry key needs to be modified, use the <strong>registry_key</strong> resource. </p> </div> </div> <p>The syntax for the <code>registry_get_values</code> method is as follows:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subkey_array <span style="color:#666">=</span> registry_get_values(<span style="color:#60add5">KEY_PATH</span>, <span style="color:#60add5">ARCHITECTURE</span>)
</code></pre></div>
<p>where:</p> <ul> <li>
<code>KEY_PATH</code> is the path to the registry key. The path must include the registry hive, which can be specified either as its full name or as the 3- or 4-letter abbreviation. For example, both <code>HKLM\SECURITY</code> and <code>HKEY_LOCAL_MACHINE\SECURITY</code> are both valid and equivalent. The following hives are valid: <code>HKEY_LOCAL_MACHINE</code>, <code>HKLM</code>, <code>HKEY_CURRENT_CONFIG</code>, <code>HKCC</code>, <code>HKEY_CLASSES_ROOT</code>, <code>HKCR</code>, <code>HKEY_USERS</code>, <code>HKU</code>, <code>HKEY_CURRENT_USER</code>, and <code>HKCU</code>.</li> <li>
<code>ARCHITECTURE</code> is one of the following values: <code>:x86_64</code>, <code>:i386</code>, or <code>:machine</code>. Set to <code>:i386</code> to read or write 32-bit registry keys on 64-bit machines running Microsoft Windows. Set to<code>:x86_64</code> to force write to a 64-bit registry location, however Chef Infra Client returns an exception if <code>:x86_64</code> is used on a 32-bit machine. Set to <code>:machine</code> to allow Chef Infra Client to allow Chef Infra Client to use the appropriate key location based on your node’s architecture. Default value: <code>:machine</code>.</li> </ul> <p>This returns an array of registry key values.</p> <h4 id="dsl-recipe-method-registry-has-subkeys">registry_has_subkeys?</h4> <p>Use the <code>registry_has_subkeys?</code> method to find out if a Microsoft Windows registry key has one (or more) values.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p> This method can be used in recipes and from within the <code>not_if</code> and <code>only_if</code> blocks in resources. This method is not designed to create or modify a registry key. If a registry key needs to be modified, use the <strong>registry_key</strong> resource. </p> </div> </div> <p>The syntax for the <code>registry_has_subkeys?</code> method is as follows:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">registry_has_subkeys?(<span style="color:#60add5">KEY_PATH</span>, <span style="color:#60add5">ARCHITECTURE</span>)
</code></pre></div>
<p>where:</p> <ul> <li>
<code>KEY_PATH</code> is the path to the registry key. The path must include the registry hive, which can be specified either as its full name or as the 3- or 4-letter abbreviation. For example, both <code>HKLM\SECURITY</code> and <code>HKEY_LOCAL_MACHINE\SECURITY</code> are both valid and equivalent. The following hives are valid: <code>HKEY_LOCAL_MACHINE</code>, <code>HKLM</code>, <code>HKEY_CURRENT_CONFIG</code>, <code>HKCC</code>, <code>HKEY_CLASSES_ROOT</code>, <code>HKCR</code>, <code>HKEY_USERS</code>, <code>HKU</code>, <code>HKEY_CURRENT_USER</code>, and <code>HKCU</code>.</li> <li>
<code>ARCHITECTURE</code> is one of the following values: <code>:x86_64</code>, <code>:i386</code>, or <code>:machine</code>. Set to <code>:i386</code> to read or write 32-bit registry keys on 64-bit machines running Microsoft Windows. Set to<code>:x86_64</code> to force write to a 64-bit registry location, however Chef Infra Client returns an exception if <code>:x86_64</code> is used on a 32-bit machine. Set to <code>:machine</code> to allow Chef Infra Client to allow Chef Infra Client to use the appropriate key location based on your node’s architecture. Default value: <code>:machine</code>.</li> </ul> <p>This method will return <code>true</code> or <code>false</code>.</p> <h4 id="dsl-recipe-method-registry-key-exists">registry_key_exists?</h4> <p>Use the <code>registry_key_exists?</code> method to find out if a Microsoft Windows registry key exists at the specified path.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p> This method can be used in recipes and from within the <code>not_if</code> and <code>only_if</code> blocks in resources. This method is not designed to create or modify a registry key. If a registry key needs to be modified, use the <strong>registry_key</strong> resource. </p> </div> </div> <p>The syntax for the <code>registry_key_exists?</code> method is as follows:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">registry_key_exists?(<span style="color:#60add5">KEY_PATH</span>, <span style="color:#60add5">ARCHITECTURE</span>)
</code></pre></div>
<p>where:</p> <ul> <li>
<code>KEY_PATH</code> is the path to the registry key. The path must include the registry hive, which can be specified either as its full name or as the 3- or 4-letter abbreviation. For example, both <code>HKLM\SECURITY</code> and <code>HKEY_LOCAL_MACHINE\SECURITY</code> are both valid and equivalent. The following hives are valid: <code>HKEY_LOCAL_MACHINE</code>, <code>HKLM</code>, <code>HKEY_CURRENT_CONFIG</code>, <code>HKCC</code>, <code>HKEY_CLASSES_ROOT</code>, <code>HKCR</code>, <code>HKEY_USERS</code>, <code>HKU</code>, <code>HKEY_CURRENT_USER</code>, and <code>HKCU</code>.</li> <li>
<code>ARCHITECTURE</code> is one of the following values: <code>:x86_64</code>, <code>:i386</code>, or <code>:machine</code>. Set to <code>:i386</code> to read or write 32-bit registry keys on 64-bit machines running Microsoft Windows. Set to<code>:x86_64</code> to force write to a 64-bit registry location, however Chef Infra Client returns an exception if <code>:x86_64</code> is used on a 32-bit machine. Set to <code>:machine</code> to allow Chef Infra Client to allow Chef Infra Client to use the appropriate key location based on your node’s architecture. Default value: <code>:machine</code>.</li> </ul> <p>This method will return <code>true</code> or <code>false</code>. (Any registry key values that are associated with this registry key are ignored.)</p> <h4 id="dsl-recipe-method-registry-value-exists">registry_value_exists?</h4> <p>Use the <code>registry_value_exists?</code> method to find out if a registry key value exists. Use <code>registry_data_exists?</code> to test for the type and data of a registry key value.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p> This method can be used in recipes and from within the <code>not_if</code> and <code>only_if</code> blocks in resources. This method is not designed to create or modify a registry key. If a registry key needs to be modified, use the <strong>registry_key</strong> resource. </p> </div> </div> <p>The syntax for the <code>registry_dvalue_exists?</code> method is as follows:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">registry_value_exists?(
  <span style="color:#60add5">KEY_PATH</span>,
  { <span style="color:#007020">name</span>: <span style="color:#4070a0">'NAME'</span> },
  <span style="color:#60add5">ARCHITECTURE</span>
)
</code></pre></div>
<p>where:</p> <ul> <li>
<code>KEY_PATH</code> is the path to the registry key. The path must include the registry hive, which can be specified either as its full name or as the 3- or 4-letter abbreviation. For example, both <code>HKLM\SECURITY</code> and <code>HKEY_LOCAL_MACHINE\SECURITY</code> are both valid and equivalent. The following hives are valid: <code>HKEY_LOCAL_MACHINE</code>, <code>HKLM</code>, <code>HKEY_CURRENT_CONFIG</code>, <code>HKCC</code>, <code>HKEY_CLASSES_ROOT</code>, <code>HKCR</code>, <code>HKEY_USERS</code>, <code>HKU</code>, <code>HKEY_CURRENT_USER</code>, and <code>HKCU</code>.</li> <li>
<code>{ name: 'NAME' }</code> is a hash that contains the name of the registry key value; if either <code>type:</code> or <code>:value</code> are specified in the hash, they are ignored</li> <li>
<code>type:</code> represents the values available for registry keys in Microsoft Windows. Use <code>:binary</code> for REG_BINARY, <code>:string</code> for REG_SZ, <code>:multi_string</code> for REG_MULTI_SZ, <code>:expand_string</code> for REG_EXPAND_SZ, <code>:dword</code> for REG_DWORD, <code>:dword_big_endian</code> for REG_DWORD_BIG_ENDIAN, or <code>:qword</code> for REG_QWORD.</li> <li>
<code>ARCHITECTURE</code> is one of the following values: <code>:x86_64</code>, <code>:i386</code>, or <code>:machine</code>. Set to <code>:i386</code> to read or write 32-bit registry keys on 64-bit machines running Microsoft Windows. Set to<code>:x86_64</code> to force write to a 64-bit registry location, however Chef Infra Client returns an exception if <code>:x86_64</code> is used on a 32-bit machine. Set to <code>:machine</code> to allow Chef Infra Client to allow Chef Infra Client to use the appropriate key location based on your node’s architecture. Default value: <code>:machine</code>.</li> </ul> <p>This method will return <code>true</code> or <code>false</code>.</p> <h2 id="actions">Actions</h2> <hr> <p>The <strong>registry_key</strong> resource has the following actions:</p> <dl> <dt><code>:create</code></dt> <dd>Default. Create a registry key. If a registry key already exists (but does not match), update that registry key to match.</dd> <dt><code>:create_if_missing</code></dt> <dd>Create a registry key if it does not exist. Also, create a registry key value if it does not exist.</dd> <dt><code>:delete</code></dt> <dd>Delete the specified values for a registry key.</dd> <dt><code>:delete_key</code></dt> <dd>Delete the specified registry key and all of its subkeys. The <code>:delete_key</code> action with the <code>recursive</code> attribute will delete the registry key, all of its values and all of the names, types, and data associated with them. This cannot be undone by Chef Infra Client.</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> </dl> <h2 id="properties">Properties</h2> <hr> <p>The <strong>registry_key</strong> resource has the following properties:</p> <dl> <dt> <code>architecture</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol | <strong>Default Value:</strong> <code>:machine</code> <strong>Allowed Values:</strong> <code>:i386, :machine, :x86_64</code> 
<p>The architecture of the node for which keys are to be created or deleted. Possible values: <code>:i386</code> (for nodes with a 32-bit registry), <code>:x86_64</code> (for nodes with a 64-bit registry), and <code>:machine</code> (to have Chef Infra Client determine the architecture during a Chef Infra Client run).</p> <p>In order to read or write 32-bit registry keys on 64-bit machines running Microsoft Windows, the <code>architecture</code> property must be set to <code>:i386</code>. The <code>:x86_64</code> value can be used to force writing to a 64-bit registry location, but this value is less useful than the default (<code>:machine</code>) because Chef Infra Client returns an exception if <code>:x86_64</code> is used and the machine turns out to be a 32-bit machine (whereas with <code>:machine</code>, Chef Infra Client is able to access the registry key on the 32-bit machine).</p> </dd> </dl> <dl> <dt> <code>key</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code> <p>The path to the location in which a registry key is to be created or from which a registry key is to be deleted. Default value: the <code>name</code> of the resource block. See “Syntax” section above for more information. The path must include the registry hive, which can be specified either as its full name or as the 3- or 4-letter abbreviation. For example, both <code>HKLM\SECURITY</code> and <code>HKEY_LOCAL_MACHINE\SECURITY</code> are both valid and equivalent. The following hives are valid: <code>HKEY_LOCAL_MACHINE</code>, <code>HKLM</code>, <code>HKEY_CURRENT_CONFIG</code>, <code>HKCC</code>, <code>HKEY_CLASSES_ROOT</code>, <code>HKCR</code>, <code>HKEY_USERS</code>, <code>HKU</code>, <code>HKEY_CURRENT_USER</code>, and <code>HKCU</code>.</p> </dd> </dl> <dl> <dt> <code>recursive</code> </dt> <dd> <strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code> <p>When creating a key, this value specifies that the required keys for the specified path are to be created. When using the <code>:delete_key</code> action in a recipe, and if the registry key has subkeys, then set the value for this property to <code>true</code>. The <code>:delete_key</code> action with the <code>recursive</code> attribute will delete the registry key, all of its values and all of the names, types, and data associated with them. This cannot be undone by Chef Infra Client.</p> </dd> </dl> <dl> <dt> <code>values</code> </dt> <dd> <strong>Ruby Type:</strong> Hash, Array 
<p>An array of hashes, where each Hash contains the values that are to be set under a registry key. Each Hash must contain <code>name:</code>, <code>type:</code>, and <code>data:</code> (and must contain no other key values).</p> <p><code>type:</code> represents the values available for registry keys in Microsoft Windows. Use <code>:binary</code> for REG_BINARY, <code>:string</code> for REG_SZ, <code>:multi_string</code> for REG_MULTI_SZ, <code>:expand_string</code> for REG_EXPAND_SZ, <code>:dword</code> for REG_DWORD, <code>:dword_big_endian</code> for REG_DWORD_BIG_ENDIAN, or <code>:qword</code> for REG_QWORD.</p> <div class="admonition-warning"> <p class="admonition-warning-title">Warning</p> <div class="admonition-warning-text"> <p><code>:multi_string</code> must be an array, even if there is only a single string.</p> </div> </div> </dd> </dl> <h2 id="examples">Examples</h2> <hr> <p>The following examples demonstrate various approaches for using the <strong>registry_key</strong> resource in recipes:</p> <p>Create a registry key</p> <p>Use a double-quoted string:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">registry_key <span style="color:#4070a0">"HKEY_LOCAL_MACHINE</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">path-to-key</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">Policies</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">System"</span> <span style="color:#007020;font-weight:700">do</span>
  values <span style="color:#666">[</span>{
    <span style="color:#007020">name</span>: <span style="color:#4070a0">'EnableLUA'</span>,
    <span style="color:#517918">type</span>: <span style="color:#517918">:dword</span>,
    <span style="color:#517918">data</span>: <span style="color:#40a070">0</span>
  }<span style="color:#666">]</span>
  action <span style="color:#517918">:create</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>or a single-quoted string:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">registry_key <span style="color:#4070a0">'HKEY_LOCAL_MACHINE\path-to-key\Policies\System'</span> <span style="color:#007020;font-weight:700">do</span>
  values <span style="color:#666">[</span>{
    <span style="color:#007020">name</span>: <span style="color:#4070a0">'EnableLUA'</span>,
    <span style="color:#517918">type</span>: <span style="color:#517918">:dword</span>,
    <span style="color:#517918">data</span>: <span style="color:#40a070">0</span>
  }<span style="color:#666">]</span>
  action <span style="color:#517918">:create</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Delete a registry key value</p> <p>Use a double-quoted string:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">registry_key <span style="color:#4070a0">"HKEY_LOCAL_MACHINE</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">SOFTWARE</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">path</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">to</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">key</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">AU"</span> <span style="color:#007020;font-weight:700">do</span>
  values <span style="color:#666">[</span>{
    <span style="color:#007020">name</span>: <span style="color:#4070a0">'NoAutoRebootWithLoggedOnUsers'</span>,
    <span style="color:#517918">type</span>: <span style="color:#517918">:dword</span>,
    <span style="color:#517918">data</span>: <span style="color:#4070a0">''</span>
    }<span style="color:#666">]</span>
  action <span style="color:#517918">:delete</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>or a single-quoted string:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">registry_key <span style="color:#4070a0">'HKEY_LOCAL_MACHINE\SOFTWARE\path\to\key\AU'</span> <span style="color:#007020;font-weight:700">do</span>
  values <span style="color:#666">[</span>{
    <span style="color:#007020">name</span>: <span style="color:#4070a0">'NoAutoRebootWithLoggedOnUsers'</span>,
    <span style="color:#517918">type</span>: <span style="color:#517918">:dword</span>,
    <span style="color:#517918">data</span>: <span style="color:#4070a0">''</span>
    }<span style="color:#666">]</span>
  action <span style="color:#517918">:delete</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>If <code>data:</code> is not specified, you get an error: <code>Missing data key in RegistryKey values hash</code></p> </div> </div> <p>Delete a registry key and its subkeys, recursively</p> <p>Use a double-quoted string:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">registry_key <span style="color:#4070a0">"HKCU</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">SOFTWARE</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">Policies</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">path</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">to</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">key</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">Themes"</span> <span style="color:#007020;font-weight:700">do</span>
  recursive <span style="color:#007020">true</span>
  action <span style="color:#517918">:delete_key</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>or a single-quoted string:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">registry_key <span style="color:#4070a0">'HKCU\SOFTWARE\Policies\path\to\key\Themes'</span> <span style="color:#007020;font-weight:700">do</span>
  recursive <span style="color:#007020">true</span>
  action <span style="color:#517918">:delete_key</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>Be careful when using the <code>:delete_key</code> action with the <code>recursive</code> attribute. This will delete the registry key, all of its values and all of the names, types, and data associated with them. This cannot be undone by Chef Infra Client.</p> </div> </div> <p>Use re-directed keys</p> <p>In 64-bit versions of Microsoft Windows, <code>HKEY_LOCAL_MACHINE\SOFTWARE\Example</code> is a re-directed key. In the following examples, because <code>HKEY_LOCAL_MACHINE\SOFTWARE\Example</code> is a 32-bit key, the output will be “Found 32-bit key” if they are run on a version of Microsoft Windows that is 64-bit:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">registry_key <span style="color:#4070a0">"HKEY_LOCAL_MACHINE</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">SOFTWARE</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">Example"</span> <span style="color:#007020;font-weight:700">do</span>
  architecture <span style="color:#517918">:i386</span>
  recursive <span style="color:#007020">true</span>
  action <span style="color:#517918">:create</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>or:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">registry_key <span style="color:#4070a0">"HKEY_LOCAL_MACHINE</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">SOFTWARE</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">Example"</span> <span style="color:#007020;font-weight:700">do</span>
  architecture <span style="color:#517918">:x86_64</span>
  recursive <span style="color:#007020">true</span>
  action <span style="color:#517918">:delete_key</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>or:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">ruby_block <span style="color:#4070a0">'check 32-bit'</span> <span style="color:#007020;font-weight:700">do</span>
  block <span style="color:#007020;font-weight:700">do</span>
    <span style="color:#007020">puts</span> <span style="color:#4070a0">'Found 32-bit key'</span>
  <span style="color:#007020;font-weight:700">end</span>
  only_if {
    registry_key_exists?(<span style="color:#4070a0">"HKEY_LOCAL_MACHINE\SOFTWARE</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">Example"</span>,
    <span style="color:#517918">:i386</span>)
  }
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>or:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">ruby_block <span style="color:#4070a0">'check 64-bit'</span> <span style="color:#007020;font-weight:700">do</span>
  block <span style="color:#007020;font-weight:700">do</span>
    <span style="color:#007020">puts</span> <span style="color:#4070a0">'Found 64-bit key'</span>
  <span style="color:#007020;font-weight:700">end</span>
  only_if {
    registry_key_exists?(<span style="color:#4070a0">"HKEY_LOCAL_MACHINE</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">SOFTWARE</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">Example"</span>,
    <span style="color:#517918">:x86_64</span>)
  }
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Set proxy settings to be the same as those used by Chef Infra Client</p> <p>Use a double-quoted string:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">proxy <span style="color:#666">=</span> <span style="color:#60add5">URI</span><span style="color:#666">.</span>parse(<span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">[</span><span style="color:#517918">:http_proxy</span><span style="color:#666">]</span>)
registry_key <span style="color:#4070a0">'HKCU\Software\Microsoft\path\to\key\Internet Settings'</span> <span style="color:#007020;font-weight:700">do</span>
  values <span style="color:#666">[</span>{<span style="color:#007020">name</span>: <span style="color:#4070a0">'ProxyEnable'</span>, <span style="color:#517918">type</span>: <span style="color:#517918">:reg_dword</span>, <span style="color:#517918">data</span>: <span style="color:#40a070">1</span>},
          {<span style="color:#007020">name</span>: <span style="color:#4070a0">'ProxyServer'</span>, <span style="color:#517918">data</span>: <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span>proxy<span style="color:#666">.</span>host<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">:</span><span style="color:#70a0d0;font-style:italic">#{</span>proxy<span style="color:#666">.</span>port<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">"</span>},
          {<span style="color:#007020">name</span>: <span style="color:#4070a0">'ProxyOverride'</span>, <span style="color:#517918">type</span>: <span style="color:#517918">:reg_string</span>, <span style="color:#517918">data</span>: <span style="color:#666">&lt;</span>local<span style="color:#666">&gt;</span>},
         <span style="color:#666">]</span>
  action <span style="color:#517918">:create</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>or a single-quoted string:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">proxy <span style="color:#666">=</span> <span style="color:#60add5">URI</span><span style="color:#666">.</span>parse(<span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">[</span><span style="color:#517918">:http_proxy</span><span style="color:#666">]</span>)
registry_key <span style="color:#4070a0">'HKCU\Software\Microsoft\path\to\key\Internet Settings'</span> <span style="color:#007020;font-weight:700">do</span>
  values <span style="color:#666">[</span>{<span style="color:#007020">name</span>: <span style="color:#4070a0">'ProxyEnable'</span>, <span style="color:#517918">type</span>: <span style="color:#517918">:reg_dword</span>, <span style="color:#517918">data</span>: <span style="color:#40a070">1</span>},
          {<span style="color:#007020">name</span>: <span style="color:#4070a0">'ProxyServer'</span>, <span style="color:#517918">data</span>: <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span>proxy<span style="color:#666">.</span>host<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">:</span><span style="color:#70a0d0;font-style:italic">#{</span>proxy<span style="color:#666">.</span>port<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">"</span>},
          {<span style="color:#007020">name</span>: <span style="color:#4070a0">'ProxyOverride'</span>, <span style="color:#517918">type</span>: <span style="color:#517918">:reg_string</span>, <span style="color:#517918">data</span>: <span style="color:#666">&lt;</span>local<span style="color:#666">&gt;</span>},
         <span style="color:#666">]</span>
  action <span style="color:#517918">:create</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Set the name of a registry key to “(Default)"</strong></p> <p>Use a double-quoted string:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">registry_key <span style="color:#4070a0">'Set (Default) value'</span> <span style="color:#007020;font-weight:700">do</span>
  key <span style="color:#4070a0">"HKLM</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">Software</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">Test</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">Key</span><span style="color:#4070a0;font-weight:700">\\</span><span style="color:#4070a0">Path"</span>
  values <span style="color:#666">[</span>
    {<span style="color:#007020">name</span>: <span style="color:#4070a0">''</span>, <span style="color:#517918">type</span>: <span style="color:#517918">:string</span>, <span style="color:#517918">data</span>: <span style="color:#4070a0">'test'</span>},
  <span style="color:#666">]</span>
  action <span style="color:#517918">:create</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>or a single-quoted string:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">registry_key <span style="color:#4070a0">'Set (Default) value'</span> <span style="color:#007020;font-weight:700">do</span>
  key <span style="color:#4070a0">'HKLM\Software\Test\Key\Path'</span>
  values <span style="color:#666">[</span>
    {<span style="color:#007020">name</span>: <span style="color:#4070a0">''</span>, <span style="color:#517918">type</span>: <span style="color:#517918">:string</span>, <span style="color:#517918">data</span>: <span style="color:#4070a0">'test'</span>},
  <span style="color:#666">]</span>
  action <span style="color:#517918">:create</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>where <code>name: ''</code> contains an empty string, which will set the name of the registry key to <code>(Default)</code>.</p> </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; Chef Software, Inc.<br>Licensed under the Creative Commons Attribution 3.0 Unported License.<br>The Chef&trade; Mark and Chef Logo are either registered trademarks/service marks or trademarks/servicemarks of Chef, in the United States and other countries and are used with Chef Inc's permission.<br>We are not affiliated with, endorsed or sponsored by Chef Inc.<br>
    <a href="https://docs.chef.io/resources/registry_key/" class="_attribution-link">https://docs.chef.io/resources/registry_key/</a>
  </p>
</div>
