<div id="col-content" data-swiftype-index="true"> <div id="attribute-sources"><h1>Attribute Sources</h1></div>  <div class="prose"> <p>Chef Infra Client evaluates attributes in the order that they are defined in the run-list, including any attributes that are in the run-list as cookbook dependencies.</p> <p>Attributes are provided to Chef Infra Client from the following locations:</p> <ul> <li>JSON files passed via the <code>chef-client -j</code>
</li> <li>Nodes (collected by Ohai at the start of each Chef Infra Client run)</li> <li>Attribute files (in cookbooks)</li> <li>Recipes (in cookbooks)</li> <li>Environments</li> <li>Roles</li> <li>Policyfiles</li> </ul> <p>Notes:</p> <ul> <li>Many attributes are maintained in the chef-repo for Policyfiles, environments, roles, and cookbooks (attribute files and recipes)</li> <li>Many attributes are collected by Ohai on each individual node at the start of every Chef Infra Client run</li> <li>The attributes that are maintained in the chef-repo are uploaded to the Chef Infra Server from the workstation, periodically</li> <li>Chef Infra Client will pull down the node object from the Chef Infra Server and then reset all the attributes except <code>normal</code>. The node object will contain the attribute data from the previous Chef Infra Client run including attributes set with JSON files via <code>-j</code>.</li> <li>Chef Infra Client will update the cookbooks on the node (if required), which updates the attributes contained in attribute files and recipes</li> <li>Chef Infra Client will update the role and environment data (if required)</li> <li>Chef Infra Client will rebuild the attribute list and apply attribute precedence while configuring the node</li> <li>Chef Infra Client pushes the node object to the Chef Infra Server at the end of a Chef Infra Client run; the updated node object on the Chef Infra Server is then indexed for search and is stored until the next Chef Infra Client run</li> </ul> <h2 id="automatic-attributes-ohai">Automatic Attributes (Ohai)</h2> <p>An automatic attribute is a specific detail about a node, such as an IP address, a host name, a list of loaded kernel modules, and so on. Automatic attributes are detected by Ohai and are then used by Chef Infra Client to ensure that they are handled properly during every Chef Infra Client run. The most commonly accessed automatic attributes are:</p> <table> <col style="width:12%"> <col style="width:87%"> <thead> <tr class="header"> <th>Attribute</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>node['platform']</code></td> <td>The platform on which a node is running. This attribute helps determine which providers will be used.</td> </tr> <tr> <td><code>node['platform_family']</code></td> <td>The platform family is a Chef Infra specific grouping of similar platforms where cookbook code can often be shared. For example, `rhel` includes Red Hat Linux, Oracle Linux, CentOS, and several other platforms that are nearly identical to Red Hat Linux.</td> </tr> <tr> <td><code>node['platform_version']</code></td> <td>The version of the platform. This attribute helps determine which providers will be used.</td> </tr> <tr> <td><code>node['ipaddress']</code></td> <td>The IP address for a node. If the node has a default route, this is the IPV4 address for the interface. If the node does not have a default route, the value for this attribute should be <code>nil</code>. The IP address for default route is the recommended default value.</td> </tr> <tr> <td><code>node['macaddress']</code></td> <td>The MAC address for a node, determined by the same interface that detects the <code>node['ipaddress']</code>.</td> </tr> <tr> <td><code>node['fqdn']</code></td> <td>The fully qualified domain name for a node. This is used as the name of a node unless otherwise set.</td> </tr> <tr> <td><code>node['hostname']</code></td> <td>The host name for the node.</td> </tr> <tr> <td><code>node['domain']</code></td> <td>The domain for the node.</td> </tr> <tr> <td><code>node['recipes']</code></td> <td>A list of recipes associated with a node (and part of that node's run-list).</td> </tr> <tr> <td><code>node['roles']</code></td> <td>A list of roles associated with a node (and part of that node's run-list).</td> </tr> <tr> <td><code>node['ohai_time']</code></td> <td>The time at which Ohai was last run. This attribute is not commonly used in recipes, but it is saved to the Chef Infra Server and can be accessed using the <code>knife status</code> subcommand.</td> </tr> </tbody> </table> <p>Ohai collects a list of automatic attributes at the start of each Chef Infra Client run. This list will vary from organization to organization, by server type, and by the platform that runs those servers. All the attributes collected by Ohai are unmodifiable by Chef Infra Client. Run the <code>ohai</code> command on a system to see which automatic attributes Ohai has collected for a particular node.</p> <h2 id="attribute-files">Attribute Files</h2> <p>An attribute file is located in the <code>attributes/</code> sub-directory for a cookbook. When a cookbook is run against a node, the attributes contained in all attribute files are evaluated in the context of the node object. Node methods (when present) are used to set attribute values on a node. For example, the <code>apache2</code> cookbook contains an attribute file called <code>default.rb</code>, which contains the following attributes:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">default<span style="color:#666">[</span><span style="color:#4070a0">'apache'</span><span style="color:#666">][</span><span style="color:#4070a0">'dir'</span><span style="color:#666">]</span>          <span style="color:#666">=</span> <span style="color:#4070a0">'/etc/apache2'</span>
default<span style="color:#666">[</span><span style="color:#4070a0">'apache'</span><span style="color:#666">][</span><span style="color:#4070a0">'listen_ports'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#666">[</span> <span style="color:#4070a0">'80'</span>,<span style="color:#4070a0">'443'</span> <span style="color:#666">]</span>
</code></pre></div>
<p>The use of the node object (<code>node</code>) is implicit in the previous example; the following example defines the node object itself as part of the attribute:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">node<span style="color:#666">.</span>default<span style="color:#666">[</span><span style="color:#4070a0">'apache'</span><span style="color:#666">][</span><span style="color:#4070a0">'dir'</span><span style="color:#666">]</span>          <span style="color:#666">=</span> <span style="color:#4070a0">'/etc/apache2'</span>
node<span style="color:#666">.</span>default<span style="color:#666">[</span><span style="color:#4070a0">'apache'</span><span style="color:#666">][</span><span style="color:#4070a0">'listen_ports'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#666">[</span> <span style="color:#4070a0">'80'</span>,<span style="color:#4070a0">'443'</span> <span style="color:#666">]</span>
</code></pre></div>
<p>Another (much less common) approach is to set a value only if an attribute has no value. This can be done by using the <code>_unless</code> variants of the attribute priority methods:</p> <ul> <li><code>default_unless</code></li> <li><code>normal_unless</code></li> </ul> <p>Use the <code>_unless</code> variants carefully (and only when necessary) because when they are used, attributes applied to nodes may become out of sync with the values in the cookbooks as these cookbooks are updated. This approach can create situations where two otherwise identical nodes end up having slightly different configurations and can also be a challenge to debug.</p> <p><strong>File Methods</strong></p> <p>Use the following methods within the attributes file for a cookbook or within a recipe. These methods correspond to the attribute type of the same name:</p> <ul> <li><code>override</code></li> <li><code>default</code></li> <li><code>normal</code></li> <li><code>_unless</code></li> </ul> <p><strong>attribute?</strong></p> <p>A useful method that is related to attributes is the <code>attribute?</code> method. This method will check for the existence of an attribute, so that processing can be done in an attributes file or recipe, but only if a specific attribute exists.</p> <p>Using <code>attribute?()</code> in an attributes file:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#007020;font-weight:700">if</span> attribute?(<span style="color:#4070a0">'ec2'</span>)
  <span style="color:#60a0b0;font-style:italic"># ... set stuff related to EC2</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Using <code>attribute?()</code> in a recipe:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#007020;font-weight:700">if</span> node<span style="color:#666">.</span>attribute?(<span style="color:#4070a0">'ec2'</span>)
  <span style="color:#60a0b0;font-style:italic"># ... do stuff on EC2 nodes</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<h2 id="attributes-from-recipes">Attributes from Recipes</h2> <p>A recipe is the most fundamental configuration element within the organization. A recipe:</p> <ul> <li>Is authored using Ruby, which is a programming language designed to read and behave in a predictable manner</li> <li>Is mostly a collection of <a href="../resources/index.html">resources</a>, defined using patterns (resource names, attribute-value pairs, and actions); helper code is added around this using Ruby, when needed</li> <li>Must define everything that is required to configure part of a system</li> <li>Must be stored in a cookbook</li> <li>May be included in another recipe</li> <li>May use the results of a search query and read the contents of a data bag (including an encrypted data bag)</li> <li>May have a dependency on one (or more) recipes</li> <li>Must be added to a run-list before it can be used by Chef Infra Client</li> <li>Is always executed in the same order as listed in a run-list</li> </ul> <p>An attribute can be defined in a cookbook (or a recipe) and then used to override the default settings on a node. When a cookbook is loaded during a Chef Infra Client run, these attributes are compared to the attributes that are already present on the node. Attributes that are defined in attribute files are first loaded according to cookbook order. For each cookbook, attributes in the <code>default.rb</code> file are loaded first, and then additional attribute files (if present) are loaded in lexical sort order. When the cookbook attributes take precedence over the default attributes, Chef Infra Client applies those new settings and values during a Chef Infra Client run on the node.</p> <h2 id="attributes-from-roles">Attributes from Roles</h2> <p>A role is a way to define certain patterns and processes that exist across nodes in an organization as belonging to a single job function. Each role consists of zero (or more) attributes and a run-list. Each node can have zero (or more) roles assigned to it. When a role is run against a node, the configuration details of that node are compared against the attributes of the role, and then the contents of that role’s run-list are applied to the node’s configuration details. When a Chef Infra Client runs, it merges its own attributes and run-lists with those contained within each assigned role.</p> <p>An attribute can be defined in a role and then used to override the default settings on a node. When a role is applied during a Chef Infra Client run, these attributes are compared to the attributes that are already present on the node. When the role attributes take precedence over the default attributes, Chef Infra Client applies those new settings and values during a Chef Infra Client run.</p> <p>A role attribute can only be set to be a default attribute or an override attribute. A role attribute cannot be set to be a normal attribute. Use the <code>default_attribute</code> and <code>override_attribute</code> methods in the <code>.rb</code> attributes file or the <code>default_attributes</code> and <code>override_attributes</code> hashes in a JSON data file.</p> <h2 id="attributes-from-environments">Attributes from Environments</h2> <p>An environment is a way to map an organization’s real-life workflow to what can be configured and managed when using Chef Infra. This mapping is accomplished by setting attributes and pinning cookbooks at the environment level. With environments, you can change cookbook configurations depending on the system’s designation. For example, by designating different staging and production environments, you can then define the correct URL of a database server for each environment. Environments also allow organizations to move new cookbook releases from staging to production with confidence by stepping releases through testing environments before entering production.</p> <p>Attributes can be defined in an environment and then used to override the default attributes in a cookbook. When an environment is applied during a Chef Infra Client run, environment attributes are compared to the attributes that are already present on the node. When the environment attributes take precedence over the default attributes, Chef Infra Client applies those new settings and values during a Chef Infra Client run.</p> <p>Environment attributes can be set to either <code>default</code> attribute level or an <code>override</code> attribute level.</p> </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; Chef Software, Inc.<br>Licensed under the Creative Commons Attribution 3.0 Unported License.<br>The Chef&trade; Mark and Chef Logo are either registered trademarks/service marks or trademarks/servicemarks of Chef, in the United States and other countries and are used with Chef Inc's permission.<br>We are not affiliated with, endorsed or sponsored by Chef Inc.<br>
    <a href="https://docs.chef.io/attribute_sources/" class="_attribution-link">https://docs.chef.io/attribute_sources/</a>
  </p>
</div>
