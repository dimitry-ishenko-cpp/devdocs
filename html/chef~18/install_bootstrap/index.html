<div id="col-content" data-swiftype-index="true"> <div id="bootstrap-a-node"><h1>Bootstrap a Node</h1></div>  <div class="prose"> <p data-swiftype-index="false"> <a href="https://github.com/chef/chef-web-docs/blob/main/content/install_bootstrap.md" alt="Link to page on GitHub repository">[edit on GitHub]</a> </p> <p>A node is any physical, virtual, or cloud device that is configured and maintained by an instance of Chef Infra Client. Bootstrapping installs Chef Infra Client on a target system so that it can run as a client and sets the node up to communicate with a Chef Infra Server. There are two ways to do this:</p> <ul> <li>Run the <code>knife bootstrap</code> command from a workstation.</li> <li>Perform an unattended install to bootstrap from the node itself, without requiring SSH or WinRM connectivity.</li> </ul> <p>The following diagram shows the stages of the bootstrap operation, and the list below the diagram describes each of those stages in greater detail.</p> <p><img src="data:image/png;base64,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" alt="image"></p> <p>During a <code>knife bootstrap</code> bootstrap operation, the following happens:</p> <table> <col style="width:25%"> <col style="width:75%"> <thead> <tr class="header"> <th>Stages</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><strong>knife bootstrap</strong></td> <td>Enter the <code>knife bootstrap</code> subcommand from a workstation. Include the hostname, IP address, or FQDN of the target node as part of this command. Knife will establish an SSH or WinRM connection with the target system and run a bootstrap script.</td> </tr> <tr> <td><p><strong>Get the install script from Chef</strong></p></td> <td><p>The shell script will make a request to the Chef website to get the most recent version of a the Chef Infra Client install script(<code>install.sh</code> or <code>install.ps1</code>).</p></td> </tr> <tr> <td><strong>Get the Chef Infra Client package from Chef</strong></td> <td>The install script then gathers system-specific information and determines the correct package for Chef Infra Client, and then downloads the appropriate package from <code>omnitruck-direct.chef.io</code>.</td> </tr> <tr> <td><strong>Install Chef Infra Client</strong></td> <td>Chef Infra Client is installed on the target node using a system native package (.rpm, .msi, etc).</td> </tr> <tr> <td><p><strong>Start a Chef Infra Client run</strong></p></td> <td>
<p>On UNIX and Linux-based machines: The second shell script executes the <code>chef-client</code> binary with a set of initial settings stored within <code>first-boot.json</code> on the node. <code>first-boot.json</code> is generated from the workstation as part of the initial <code>knife bootstrap</code> subcommand.</p> <p>On Microsoft Windows machines: The batch file that is derived from the windows-chef-client-msi.erb bootstrap template executes the <code>chef-client</code> binary with a set of initial settings stored within <code>first-boot.json</code> on the node. <code>first-boot.json</code> is generated from the workstation as part of the initial <code>knife bootstrap</code> subcommand.</p>
</td> </tr> <tr> <td><p><strong>Complete a Chef Infra Client run</strong></p></td> <td>
<p>a Chef Infra Client run proceeds, using HTTPS (port 443), and registers the node with the Chef Infra Server.</p> <p>The first Chef Infra Client run, by default, contains an empty run-list. A <a href="../workstation/knife_bootstrap/index.html">run-list can be specified</a> as part of the initial bootstrap operation using the <code>--run-list</code> option as part of the <code>knife bootstrap</code> subcommand.</p>
</td> </tr> </tbody> </table> <h2 id="knife-bootstrap">knife bootstrap</h2> <p>The <code>knife bootstrap</code> command is a common way to install Chef Infra Client on a node. The default for this approach assumes that a node can access the Chef website so that it may download the Chef Infra Client package from that location.</p> <p>The Chef Infra Client installer will detect the version of the operating system, and then install the appropriate Chef Infra Client version using a single command to install Chef Infra Client and all of its dependencies, including an embedded version of Ruby, OpenSSL, parsers, libraries, and command line utilities.</p> <p>The Chef Infra Client installer puts everything into a unique directory (<code>/opt/chef/</code>) so that Chef Infra Client will not interfere with other applications that may be running on the target machine. Once installed, Chef Infra Client requires a few more configuration steps before it can perform its first Chef Infra Client run on a node.</p> <h3 id="run-the-bootstrap-command">Run the bootstrap command</h3> <p>The <code>knife bootstrap</code> subcommand is used to run a bootstrap operation that installs Chef Infra Client on the target node. The following steps describe how to bootstrap a node using knife.</p> <ol> <li> <p>Identify the FQDN or IP address of the target node. The <code>knife bootstrap</code> command requires the FQDN or the IP address for the node in order to complete the bootstrap operation.</p> </li> <li> <p>Once the workstation machine is configured, it can be used to install Chef Infra Client on one (or more) nodes across the organization using a knife bootstrap operation. The <code>knife bootstrap</code> command is used to SSH into the target machine, and then do what is needed to allow Chef Infra Client to run on the node. It will install the Chef Infra Client executable (if necessary), generate keys, and register the node with the Chef Infra Server. The bootstrap operation requires the IP address or FQDN of the target system, the SSH credentials (username, password or identity file) for an account that has root access to the node, and (if the operating system is not Ubuntu, which is the default distribution used by <code>knife bootstrap</code>) the operating system running on the target system.</p> <p>In a command window, enter the following:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">knife bootstrap 172.16.1.233 -U USERNAME --sudo
</code></pre></div>
<p>where <code>172.16.1.233</code> is the IP address or the FQDN for the node, and <code>USERNAME</code> is the username you want to use to connect, and <code>--sudo</code> specifies to elevate privileges using the sudo command on UNIX-based systems.</p> <p>Then while the bootstrap operation is running, the command window will show something similar to the following:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">Enter password <span style="color:#007020;font-weight:700">for</span> ubuntu@172.16.1.233:

Connecting to 172.16.1.233
Performing legacy client registration with the validation key at /Users/USERNAME/.chef/validator.pem...
Delete your validation key in order to use your user credentials <span style="color:#007020;font-weight:700">for</span> client registration instead.
Bootstrapping 172.16.1.233
<span style="color:#666">[</span>172.16.1.233<span style="color:#666">]</span> -----&gt; Installing Chef Omnibus <span style="color:#666">(</span>stable/16<span style="color:#666">)</span>
downloading https://omnitruck.chef.io/chef/install.sh
<span style="color:#666">[</span>172.16.1.233<span style="color:#666">]</span>   to file /tmp/install.sh.1624/install.sh
<span style="color:#666">[</span>172.16.1.233<span style="color:#666">]</span> trying wget...
<span style="color:#666">[</span>172.16.1.233<span style="color:#666">]</span> ubuntu 20.04 aarch64
<span style="color:#666">[</span>172.16.1.233<span style="color:#666">]</span> Getting information <span style="color:#007020;font-weight:700">for</span> chef stable <span style="color:#40a070">16</span> <span style="color:#007020;font-weight:700">for</span> ubuntu...
<span style="color:#666">[</span>172.16.1.233<span style="color:#666">]</span> downloading https://omnitruck.chef.io/stable/chef/metadata?v<span style="color:#666">=</span>16&amp;<span style="color:#bb60d5">p</span><span style="color:#666">=</span>ubuntu&amp;<span style="color:#bb60d5">pv</span><span style="color:#666">=</span>20.04&amp;<span style="color:#bb60d5">m</span><span style="color:#666">=</span>aarch64
  to file /tmp/install.sh.1628/metadata.txt
<span style="color:#666">[</span>172.16.1.233<span style="color:#666">]</span> trying wget...
<span style="color:#666">[</span>172.16.1.233<span style="color:#666">]</span> sha1  8d89f8ac2e7f52d170be8ec1c2a028a6449d7e3a
sha256  85cc73bed06e8d6699fc5c0b26c20d2837bf03831873444febccfc8bfa561f00
url  https://packages.chef.io/files/stable/chef/16.1.16/ubuntu/20.04/chef_16.1.16-1_arm64.deb
version  16.1.16
<span style="color:#666">[</span>172.16.1.233<span style="color:#666">]</span>
<span style="color:#666">[</span>172.16.1.233<span style="color:#666">]</span> downloaded metadata file looks valid...
<span style="color:#666">[</span>172.16.1.233<span style="color:#666">]</span> downloading https://packages.chef.io/files/stable/chef/16.1.16/ubuntu/20.04/chef_16.1.16-1_arm64.deb
  to file /tmp/install.sh.1628/chef_16.1.16-1_arm64.deb
<span style="color:#666">[</span>172.16.1.233<span style="color:#666">]</span> trying wget...
<span style="color:#666">[</span>172.16.1.233<span style="color:#666">]</span> Comparing checksum with sha256sum...
<span style="color:#666">[</span>172.16.1.233<span style="color:#666">]</span> Installing chef <span style="color:#40a070">16</span>
installing with dpkg...
<span style="color:#666">[</span>172.16.1.233<span style="color:#666">]</span> Selecting previously unselected package chef.
<span style="color:#666">[</span>172.16.1.233<span style="color:#666">]</span> <span style="color:#666">(</span>Reading database ... <span style="color:#40a070">99114</span> files and directories currently installed.<span style="color:#666">)</span>
<span style="color:#666">[</span>172.16.1.233<span style="color:#666">]</span> Preparing to unpack .../chef_16.1.16-1_arm64.deb ...
<span style="color:#666">[</span>172.16.1.233<span style="color:#666">]</span> Unpacking chef <span style="color:#666">(</span>16.1.16-1<span style="color:#666">)</span> ...
<span style="color:#666">[</span>172.16.1.233<span style="color:#666">]</span> Setting up chef <span style="color:#666">(</span>16.1.16-1<span style="color:#666">)</span> ...
<span style="color:#666">[</span>172.16.1.233<span style="color:#666">]</span> Thank you <span style="color:#007020;font-weight:700">for</span> installing Chef Infra Client! For <span style="color:#007020">help</span> getting started visit https://learn.chef.io
<span style="color:#666">[</span>172.16.1.233<span style="color:#666">]</span> Starting the first Chef Infra Client Client run...
<span style="color:#666">[</span>172.16.1.233<span style="color:#666">]</span> +---------------------------------------------+
✓ <span style="color:#40a070">2</span> product licenses accepted.
+---------------------------------------------+
<span style="color:#666">[</span>172.16.1.233<span style="color:#666">]</span> Starting Chef Infra Client, version 16.1.16
<span style="color:#666">[</span>172.16.1.233<span style="color:#666">]</span> <span style="color:#666">[</span>2020-06-08T23:49:10+00:00<span style="color:#666">]</span> ERROR: shard_seed: Failed to get dmi property serial_number: is dmidecode installed?
<span style="color:#666">[</span>172.16.1.233<span style="color:#666">]</span> Creating a new client identity <span style="color:#007020;font-weight:700">for</span> name_of_node using the validator key.
<span style="color:#666">[</span>172.16.1.233<span style="color:#666">]</span> resolving cookbooks <span style="color:#007020;font-weight:700">for</span> run list: <span style="color:#666">[]</span>
<span style="color:#666">[</span>172.16.1.233<span style="color:#666">]</span> Synchronizing Cookbooks:
<span style="color:#666">[</span>172.16.1.233<span style="color:#666">]</span> Installing Cookbook Gems:
<span style="color:#666">[</span>172.16.1.233<span style="color:#666">]</span> Compiling Cookbooks...
<span style="color:#666">[</span>172.16.1.233<span style="color:#666">]</span> <span style="color:#666">[</span>2020-06-08T23:49:17+00:00<span style="color:#666">]</span> WARN: Node name_of_node has an empty run list.
<span style="color:#666">[</span>172.16.1.233<span style="color:#666">]</span> Converging <span style="color:#40a070">0</span> resources
<span style="color:#666">[</span>172.16.1.233<span style="color:#666">]</span>
<span style="color:#666">[</span>172.16.1.233<span style="color:#666">]</span> Running handlers:
<span style="color:#666">[</span>172.16.1.233<span style="color:#666">]</span> Running handlers <span style="color:#007020">complete</span>
<span style="color:#666">[</span>172.16.1.233<span style="color:#666">]</span> Chef Infra Client finished, 0/0 resources updated in <span style="color:#40a070">11</span> seconds
</code></pre></div>
</li> <li> <p>After the bootstrap operation has finished, verify that the node is recognized by the Chef Infra Server. To show only the node that was just bootstrapped, run the following command:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">knife client show NAME_OF_NODE
</code></pre></div>
<p>where <code>NODE_NAME</code> is the name of the node that was just bootstrapped. The Chef Infra Server will return something similar to:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">admin: <span style="color:#007020">false</span>
chef_type: client
name:  NODE_NAME
validator: <span style="color:#007020">false</span>
</code></pre></div>
<p>and to show the full list of nodes (and workstations) that are registered with the Chef Infra Server, run the following command:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">knife client list
</code></pre></div>
<p>The Chef Infra Server will return something similar to:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">workstation1
workstation2
...
client1
client2
</code></pre></div>
</li> </ol> <h2 id="validatorless-and-legacy-validator-bootstraps">Validatorless and Legacy Validator Bootstraps</h2> <p>We recommended using “validatorless bootstrapping” to authenticate new nodes with the Chef Infra Server.</p> <p>The legacy Chef Infra validator-based node bootstrapping process depended on using a shared “validatory” key throughout an organization for authenticating new nodes with the Chef Infra Server.</p> <p>Shortcomings of the legacy validator process are:</p> <ul> <li>All users share the same key for bootstrapping new systems</li> <li>Key sharing makes key rotation difficult, if it is compromised or if an employee leaves the organization.</li> </ul> <p>The “validatorless bootstrap” generates a key for each node, which is then transferred to the new node and used to authenticate with the Chef Infra Server instead of relying on a shared “validator” key.</p> <p>The Chef Infra bootstrap process is validatorless by default. If you receive a warning during a bootstrap that a validator key is in use, remove the configuration for this legacy bootstrap mode. Edit your <a href="../workstation/config_rb/index.html">config.rb (knife.rb)</a> file and remove any <code>validation_key</code> or <code>validation_client_name</code> entries.</p> <h2 id="bootstrapping-with-chef-vault">Bootstrapping with chef-vault</h2> <p>Use the following options with a validatorless bootstrap to specify items that are stored in chef-vault:</p> <dl> <dt><code>--bootstrap-vault-file VAULT_FILE</code></dt> <dd> <p>The path to a JSON file that contains a list of vaults and items to be updated.</p> </dd> <dt><code>--bootstrap-vault-item VAULT_ITEM</code></dt> <dd> <p>A single vault and item to update as <code>vault:item</code>.</p> </dd> <dt><code>--bootstrap-vault-json VAULT_JSON</code></dt> <dd> <p>A JSON string that contains a list of vaults and items to be updated. –bootstrap-vault-json ‘{ “vault1”: [“item1”, “item2”], “vault2”: “item2” }’</p> </dd> </dl> <h2 id="examples">Examples</h2> <p>The <code>--bootstrap-vault-*</code> options add the client identify of the bootstrapping node to the permissions list of the specified vault item. This enables the newly-bootstrapped Chef Infra Client to be able to read items from the vault. Only a single client is authorized at a time for access to the vault. (The <code>-S</code> search query option with the <code>knife vault create</code> subcommand does the same.)</p> <h3 id="recreate-a-data-bag-item">Recreate a data bag item</h3> <p>The following example shows how to recreate a data bag item:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">knife vault delete sea power
Do you really want to delete sea/power? <span style="color:#666">(</span>Y/N<span style="color:#666">)</span> Y
Deleted chef_vault_item<span style="color:#666">[</span>sea/power<span style="color:#666">]</span>

<span style="color:#007020">echo</span> <span style="color:#4070a0">"{\"some\":\"content for them\"}"</span> &gt; sea-power-content.json

cat sea-power-content.json
<span style="color:#666">{</span><span style="color:#4070a0">"some"</span>:<span style="color:#4070a0">"content for them"</span><span style="color:#666">}</span>

knife vault create sea power -M client -A sean_horn,angle -J sea-power-content.json
</code></pre></div>
<p>No clients, because the <code>-S</code> option was not specified while creating the vault.</p> <p>At this time, only the users <code>sean_horn</code> and <code>angle</code> are authorized to read and manage the vault.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">knife vault show sea power  --mode client -p all
admins:
  sean_horn
  angle
clients:
id: power
search_query:
some:  content <span style="color:#007020;font-weight:700">for</span> them
</code></pre></div>
<p>It is definitely an encrypted databag, see?</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">knife data_bag show sea power
WARNING: Encrypted data bag detected, but no secret provided <span style="color:#007020;font-weight:700">for</span> decoding. Displaying encrypted data.
id: power
some:
cipher:  aes-256-cbc
encrypted_data: c7Axnyg+1KDxBPOZdYN9QuIYx6dmSmK70unAQbn12Lygvsv2g9DPJJbueXVh
+yxL
iv: <span style="color:#bb60d5">ONoVR7OjPZiAzaqOZ30bjg</span><span style="color:#666">==</span>
version: <span style="color:#40a070">1</span>
</code></pre></div>
<h3 id="use---bootstrap-vault-file">Use –bootstrap-vault-file</h3> <p>Use the <code>sea:power</code> recreation step above first, to follow the difference in the vault permissions.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash"><span style="color:#007020">echo</span> <span style="color:#4070a0">"{\"sea\":\"power\"}"</span> &gt; sea-power-bootstrap-vault-file.json

knife bootstrap localhost -p <span style="color:#40a070">2200</span> -N ubuntu-20.04 -r <span style="color:#4070a0">'role[group1]'</span> --connection-user vagrant --sudo --bootstrap-vault-file sea-power-bootstrap-vault-file.json
Node ubuntu-20.04 exists, overwrite it? <span style="color:#666">(</span>Y/N<span style="color:#666">)</span> Y
Client ubuntu-20.04 exists, overwrite it? <span style="color:#666">(</span>Y/N<span style="color:#666">)</span> Y
Creating new client <span style="color:#007020;font-weight:700">for</span> ubuntu-20.04
Creating new node <span style="color:#007020;font-weight:700">for</span> ubuntu-20.04
Connecting to localhost
localhost -----&gt; Existing Chef installation detected
localhost Starting first Chef Client run...
localhost Starting Chef Client, version 12.2.1
localhost resolving cookbooks <span style="color:#007020;font-weight:700">for</span> run list: <span style="color:#666">[</span><span style="color:#4070a0">"delay-test-reporting"</span><span style="color:#666">]</span>
localhost Synchronizing Cookbooks:
localhost   - delay-test-reporting
localhost Compiling Cookbooks...
localhost Converging <span style="color:#40a070">1</span> resources
localhost Recipe: delay-test-reporting::default
localhost   * execute<span style="color:#666">[</span>sleep 30<span style="color:#666">]</span> action run
localhost     - execute sleep <span style="color:#40a070">30</span>
localhost
localhost Running handlers:
localhost Running handlers <span style="color:#007020">complete</span>
localhost Chef Client finished, 1/1 resources updated in 34.307257232 seconds
</code></pre></div>
<p>The client <code>ubuntu-20.04</code> was added to the <code>chef-vault</code> during the bootstrap.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">knife vault show sea power  --mode client -p all
admins:
  sean_horn
  angle
clients:  ubuntu-20.04
id: power
search_query:
some:  content <span style="color:#007020;font-weight:700">for</span> them
</code></pre></div>
<h3 id="use---bootstrap-vault-item">Use –bootstrap-vault-item</h3> <p>Use the <code>sea:power</code> re-creation step above first, to follow the difference in the vault permissions.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">knife bootstrap localhost -p <span style="color:#40a070">2200</span> -N ubuntu-20.04 -r <span style="color:#4070a0">'role[group1]'</span> --connection-user vagrant --sudo --bootstrap-vault-item sea:power
Node ubuntu-20.04 exists, overwrite it? <span style="color:#666">(</span>Y/N<span style="color:#666">)</span> Y
Client ubuntu-20.04 exists, overwrite it? <span style="color:#666">(</span>Y/N<span style="color:#666">)</span> Y
Creating new client <span style="color:#007020;font-weight:700">for</span> ubuntu-20.04
Creating new node <span style="color:#007020;font-weight:700">for</span> ubuntu-20.04
Connecting to localhost
localhost -----&gt; Existing Chef installation detected
localhost Starting first Chef Client run...
localhost Starting Chef Client, version 12.2.1
localhost resolving cookbooks <span style="color:#007020;font-weight:700">for</span> run list: <span style="color:#666">[</span><span style="color:#4070a0">"delay-test-reporting"</span><span style="color:#666">]</span>
localhost Synchronizing Cookbooks:
localhost   - delay-test-reporting
localhost Compiling Cookbooks...
localhost Converging <span style="color:#40a070">1</span> resources
localhost Recipe: delay-test-reporting::default
localhost   * execute<span style="color:#666">[</span>sleep 30<span style="color:#666">]</span> action run
localhost     - execute sleep <span style="color:#40a070">30</span>
localhost
localhost Running handlers:
localhost Running handlers <span style="color:#007020">complete</span>
localhost Chef Client finished, 1/1 resources updated in 34.322229474
seconds
</code></pre></div>
<p>During the above run, the <code>sea:power</code> vault item was updated with the <code>ubuntu-20.04</code> client during the validatorless bootstrap. Previously, it only had the two admins authorized to view the content</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">knife vault show sea power -p all
admins:
  sean_horn
  angle
clients:  ubuntu-20.04
id: power
search_query: role:stuff
some:  secret stuff <span style="color:#007020;font-weight:700">for</span> them
</code></pre></div>
<p>Then, let’s check the <code>ubuntu-20.04</code> client. The client itself can decrypt and read the encrypted databag contents as well using the embedded knife CLI in the Chef Infra Client package.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">sudo /opt/chef/bin/knife vault show sea power -c /etc/chef/client.rb -M client -p all
admins:
  sean_horn
  angle
clients:  ubuntu-20.04
id: power
search_query: role:group1
some:  secret stuff <span style="color:#007020;font-weight:700">for</span> them
</code></pre></div>
<p>Success! The client is authorized to view the content of the <code>sea:power</code> databag item</p> <h3 id="use---bootstrap-vault-json">Use –bootstrap-vault-json</h3> <p>Use the <code>sea:power</code> re-creation step above first, to follow the difference in the vault permissions.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">knife bootstrap localhost -p <span style="color:#40a070">2200</span> -N ubuntu-20.04 -r <span style="color:#4070a0">'role[group1]'</span> --connection-user vagrant --sudo --bootstrap-vault-json <span style="color:#4070a0">'{"sea": "power"}'</span>
Node ubuntu-20.04 exists, overwrite it? <span style="color:#666">(</span>Y/N<span style="color:#666">)</span> Y
Client ubuntu-20.04 exists, overwrite it? <span style="color:#666">(</span>Y/N<span style="color:#666">)</span> Y
Creating new client <span style="color:#007020;font-weight:700">for</span> ubuntu-.04
Creating new node <span style="color:#007020;font-weight:700">for</span> ubuntu-20.04
Connecting to localhost
localhost -----&gt; Existing Chef installation detected
localhost Starting first Chef Client run...
localhost Starting Chef Client, version 12.2.1
localhost resolving cookbooks <span style="color:#007020;font-weight:700">for</span> run list: <span style="color:#666">[</span><span style="color:#4070a0">"delay-test-reporting"</span><span style="color:#666">]</span>
localhost Synchronizing Cookbooks:
localhost   - delay-test-reporting
localhost Compiling Cookbooks...
localhost Converging <span style="color:#40a070">1</span> resources
localhost Recipe: delay-test-reporting::default

localhost   * execute<span style="color:#666">[</span>sleep 30<span style="color:#666">]</span> action run
localhost     - execute sleep <span style="color:#40a070">30</span>
localhost
localhost Running handlers:
localhost Running handlers <span style="color:#007020">complete</span>
localhost Chef Client finished, 1/1 resources updated in 33.732784033 seconds
</code></pre></div>
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">knife vault show sea power -M client -p all
admins:
  sean_horn
  angle
clients:  ubuntu-20.04
id: power
search_query:
some:  content <span style="color:#007020;font-weight:700">for</span> them
</code></pre></div>
<h2 id="unattended-installs">Unattended Installs</h2> <p>Chef Infra Client can be installed using an unattended bootstrap. This allows Chef Infra Client to be installed from itself, without requiring SSH. For example, machines are often created using environments like AWS Auto Scaling, AWS CloudFormation, Rackspace Auto Scale, and PXE. In this scenario, using tooling for attended, single-machine installs like <code>knife bootstrap</code> or <code>knife CLOUD_PLUGIN create</code> is not practical because the machines are created automatically and someone cannot always be on-hand to initiate the bootstrap process.</p> <p>When Chef Infra Client is installed using an unattended bootstrap, remember that Chef Infra Client:</p> <ul> <li>Must be able to authenticate to the Chef Infra Server</li> <li>Must be able to configure a run-list</li> <li>May require custom attributes, depending on the cookbooks that are being used</li> <li>Must be able to access the chef-validator.pem so that it may create a new identity on the Chef Infra Server</li> <li>Must have a unique node name; Chef Infra Client will use the FQDN for the host system by default</li> </ul> <p>When Chef Infra Client is installed using an unattended bootstrap, it may be built into an image that starts Chef Infra Client on boot, or installed using User Data or some other kind of post-deployment script. The type of image or User Data used depends on the platform on which the unattended bootstrap will take place.</p> <h3 id="bootstrapping-with-user-data">Bootstrapping with User Data</h3> <p>The method used to inject a user data script into a server will vary depending on the infrastructure platform being used. For example, on AWS you can pass this data in as a text file using the command line tool.</p> <p>The following user data examples demonstrate the process of bootstrapping Windows and Linux nodes.</p> <h4 id="powershell-user-data">PowerShell User Data</h4> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-powershell" data-lang="powershell"><span style="color:#60a0b0;font-style:italic">## Set host file so the instance knows where to find chef-server</span>
<span style="color:#bb60d5">$hosts</span> = <span style="color:#4070a0">"1.2.3.4 hello.example.com"</span>
<span style="color:#bb60d5">$file</span> = <span style="color:#4070a0">"C:\Windows\System32\drivers\etc\hosts"</span>
<span style="color:#bb60d5">$hosts</span> | <span style="color:#007020">Add-Content</span> <span style="color:#bb60d5">$file</span>

<span style="color:#60a0b0;font-style:italic">## Download the Chef Client</span>
<span style="color:#bb60d5">$clientURL</span> = <span style="color:#4070a0">"https://packages.chef.io/files/stable/chef/12.19.36/windows/2012/chef-client-&lt;version-here&gt;.msi"</span>
<span style="color:#bb60d5">$clientDestination</span> = <span style="color:#4070a0">"C:\chef-client.msi"</span>
<span style="color:#007020">Invoke-WebRequest</span> <span style="color:#bb60d5">$clientURL</span> -OutFile <span style="color:#bb60d5">$clientDestination</span>

<span style="color:#60a0b0;font-style:italic">## Install the Chef Client</span>
<span style="color:#007020">Start-Process</span> msiexec.exe -ArgumentList @(<span style="color:#4070a0">'/qn'</span>, <span style="color:#4070a0">'/lv C:\Windows\Temp\chef-log.txt'</span>, <span style="color:#4070a0">'/i C:\chef-client.msi'</span>, <span style="color:#4070a0">'ADDLOCAL="ChefClientFeature,ChefSchTaskFeature,ChefPSModuleFeature"'</span>) -Wait

<span style="color:#60a0b0;font-style:italic">## Create first-boot.json</span>
<span style="color:#bb60d5">$firstboot</span> = @{
   <span style="color:#4070a0">"run_list"</span> = @(<span style="color:#4070a0">"role[base]"</span>)
}
<span style="color:#007020">Set-Content</span> -Path c:\chef\<span style="color:#007020">first-boot</span>.json -Value (<span style="color:#bb60d5">$firstboot</span> | <span style="color:#007020">ConvertTo-Json</span> -Depth 10)

<span style="color:#60a0b0;font-style:italic">## Create client.rb</span>
<span style="color:#bb60d5">$nodeName</span> = <span style="color:#4070a0">"lab-win-{0}"</span> <span style="color:#666">-f</span> (-join ((65..90) + (97..122) | <span style="color:#007020">Get-Random</span> -Count 4 | % {<span style="color:#60add5">[char]</span><span style="color:#bb60d5">$_</span>}))

<span style="color:#bb60d5">$clientrb</span> = <span style="color:#4070a0">@"
</span><span style="color:#4070a0">chef_server_url        'https://chef-server/organizations/my-org'
</span><span style="color:#4070a0">validation_client_name 'validator'
</span><span style="color:#4070a0">validation_key         'C:\chef\validator.pem'
</span><span style="color:#4070a0">node_name              '{0}'
</span><span style="color:#4070a0">"@</span> <span style="color:#666">-f</span> <span style="color:#bb60d5">$nodeName</span>

<span style="color:#007020">Set-Content</span> -Path c:\chef\client.rb -Value <span style="color:#bb60d5">$clientrb</span>

<span style="color:#60a0b0;font-style:italic">## Run Chef</span>
C:\opscode\chef\bin\<span style="color:#007020">chef-client</span>.bat -j C:\chef\<span style="color:#007020">first-boot</span>.json
</code></pre></div>
<h4 id="bash-user-data">Bash User Data</h4> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash"><span style="color:#007020">#!/bin/bash -xev
</span>
<span style="color:#60a0b0;font-style:italic"># Do some chef pre-work</span>
/bin/mkdir -p /etc/chef
/bin/mkdir -p /var/lib/chef
/bin/mkdir -p /var/log/chef

<span style="color:#60a0b0;font-style:italic"># Setup hosts file correctly</span>
cat &gt;&gt; <span style="color:#4070a0">"/etc/hosts"</span> <span style="color:#4070a0">&lt;&lt; EOF
</span><span style="color:#4070a0">10.0.0.5    compliance-server compliance-server.automate.com
</span><span style="color:#4070a0">10.0.0.6    infra-server infra-server.automate.com
</span><span style="color:#4070a0">10.0.0.7    automate-server automate-server.automate.com
</span><span style="color:#4070a0">EOF</span>

<span style="color:#007020">cd</span> /etc/chef/

<span style="color:#60a0b0;font-style:italic"># Install chef</span>
curl -L https://omnitruck.chef.io/install.sh | bash <span style="color:#666">||</span> error_exit <span style="color:#4070a0">'could not install chef'</span>

<span style="color:#60a0b0;font-style:italic"># Create first-boot.json</span>
cat &gt; <span style="color:#4070a0">"/etc/chef/first-boot.json"</span> <span style="color:#4070a0">&lt;&lt; EOF
</span><span style="color:#4070a0">{
</span><span style="color:#4070a0">   "run_list" :[
</span><span style="color:#4070a0">   "role[base]"
</span><span style="color:#4070a0">   ]
</span><span style="color:#4070a0">}
</span><span style="color:#4070a0">EOF</span>

<span style="color:#bb60d5">NODE_NAME</span><span style="color:#666">=</span>node-<span style="color:#007020;font-weight:700">$(</span>cat /dev/urandom | tr -dc <span style="color:#4070a0">'a-zA-Z0-9'</span> | fold -w <span style="color:#40a070">4</span> | head -n 1<span style="color:#007020;font-weight:700">)</span>

<span style="color:#60a0b0;font-style:italic"># Create client.rb</span>
cat &gt; <span style="color:#4070a0">'/etc/chef/client.rb'</span> <span style="color:#4070a0">&lt;&lt; EOF
</span><span style="color:#4070a0">log_location            STDOUT
</span><span style="color:#4070a0">chef_server_url         'https://aut-chef-server/organizations/my-org'
</span><span style="color:#4070a0">validation_client_name  'my-org-validator'
</span><span style="color:#4070a0">validation_key          '/etc/chef/my_org_validator.pem'
</span><span style="color:#4070a0">node_name               "${NODE_NAME}"
</span><span style="color:#4070a0">EOF</span>

chef-client -j /etc/chef/first-boot.json
</code></pre></div>
<p>It is important that settings in the <a href="../config_rb_client/index.html">client.rb file</a>—<code>chef_server_url</code>, <code>http_proxy</code>, and so on are used—to ensure that configuration details are built into the unattended bootstrap process.</p> <h5 id="setting-the-initial-run-list">Setting the initial run-list</h5> <p>A node’s initial run-list is specified using a JSON file on the host system. When running Chef Infra Client as an executable, use the <code>-j</code> option to tell Chef Infra Client which JSON file to use. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-client -j /etc/chef/file.json --environment _default
</code></pre></div>
<p>where <code>file.json</code> is similar to:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-javascript" data-lang="javascript">{
  <span style="color:#4070a0">"resolver"</span><span style="color:#666">:</span> {
    <span style="color:#4070a0">"nameservers"</span><span style="color:#666">:</span> [ <span style="color:#4070a0">"10.0.0.1"</span> ],
    <span style="color:#4070a0">"search"</span><span style="color:#666">:</span><span style="color:#4070a0">"int.example.com"</span>
  },
  <span style="color:#4070a0">"run_list"</span><span style="color:#666">:</span> [ <span style="color:#4070a0">"recipe[resolver]"</span> ]
}
</code></pre></div>
<p>and where <code>_default</code> is the name of the environment that is assigned to the node.</p> <div class="admonition-warning"> <p class="admonition-warning-title">Warning</p> <div class="admonition-warning-text"> <p>This approach may be used to update <a href="../attributes.html#attribute-types">normal</a> attributes, but should never be used to update any other attribute type, as all attributes updated using this option are treated as <code>normal</code> attributes.</p> </div> </div> </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; Chef Software, Inc.<br>Licensed under the Creative Commons Attribution 3.0 Unported License.<br>The Chef&trade; Mark and Chef Logo are either registered trademarks/service marks or trademarks/servicemarks of Chef, in the United States and other countries and are used with Chef Inc's permission.<br>We are not affiliated with, endorsed or sponsored by Chef Inc.<br>
    <a href="https://docs.chef.io/install_bootstrap/" class="_attribution-link">https://docs.chef.io/install_bootstrap/</a>
  </p>
</div>
