<div id="col-content" data-swiftype-index="true"> <div id="setting-up-the-applications-dashboard"><h1>Setting up the Applications Dashboard</h1></div>  <div class="prose"> <p data-swiftype-index="false"> <a href="https://github.com/chef/automate/blob/master/components/docs-chef-io/content/automate/applications_setup.md" alt="Link to page on GitHub repository">[edit on GitHub]</a> </p> <p>This Enterprise Application Stack (EAS) integration gives you immediate insight into the status of your Chef Habitat services, even when scaling out to large numbers of services.</p> <p>The Chef Automate Applications Dashboard gives you operational observability into your Chef Habitat systems, so you can monitor and respond quickly to changes in your Chef Habitat environments. The Applications Dashboard <em>Service Groups</em> table is an overview of your Chef Habitat network, grouped together by package, environment, service group, and application. The right-hand sidebar contains detailed status report cards for each individual service.</p> <h2 id="requirements-and-capacity-planning">Requirements and Capacity Planning</h2> <p>Chef Enterprise Application Stack with Chef Automate + Chef Habitat can scale up to 15,000 services on a system using:</p> <ul> <li>4 CPU</li> <li>16GB RAM</li> <li>50 GB disk space</li> <li>Chef Automate, current version</li> <li>Chef Habitat, minimum version 1.5.0</li> </ul> <p>Chef Automate’s Compliance and Infrastructure observability features require additional computing and memory capacity. Larger scale systems (15,000+ services) consume significant CPU resources for processing applications data.</p> <h2 id="chef-habitat-service-group-best-practices">Chef Habitat Service Group Best Practices</h2> <p>A service group contains all of the services for a single package. The services in a group share a single relationship structure (topology) and are connected within a Chef Habitat supervisor network.</p> <p>For best results:</p> <ul> <li>Use a separate Chef Habitat network for each application deployment environment (“Development”, “Test”, “Acceptance”, “Production”)</li> <li>Use the default Chef Habitat service group names</li> </ul> <p>For services that do not follow this layout, you should select environment and application names that help you find and filter the application data and are relevant to your typical job tasks.</p> <p>For more information on setting up Chef Habitat, see the Chef Habitat <a href="../../habitat/about_services/index.html#service-group">Service Groups</a> documentation.</p> <h2 id="setting-up-the-applications-dashboard">Setting up the Applications Dashboard</h2> <p>To get started, you need:</p> <ol> <li>Running installations of Chef Automate and Chef Habitat Builder SasS or Builder on-prem</li> <li>A <a href="../api_tokens/index.html#creating-a-standard-api-token">Chef Automate API token</a> specifically for this integration</li> </ol> <h2 id="sending-event-data-to-chef-automate">Sending Event Data to Chef Automate</h2> <p>If you have not already done so, <a href="../api_tokens/index.html#creating-a-standard-api-token">create an API token</a> in Chef Automate. Save it somewhere safe and accessible to you for use in this step.</p> <h3 id="customize-the-event-stream-command">Customize the Event Stream Command</h3> <p>Copy the following event stream command into your editor and replace <code>MY_APP</code>, <code>MY_ENV</code>, <code>MY_SITE</code>, <code>AUTOMATE_HOSTNAME</code>, and <code>API_TOKEN</code> with the appropriate values.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-shell" data-lang="shell">hab sup run <span style="color:#4070a0;font-weight:700">\
</span>  --event-stream-application<span style="color:#666">=</span><span style="color:#4070a0">"MY_APP"</span> <span style="color:#4070a0;font-weight:700">\
</span>  --event-stream-environment<span style="color:#666">=</span><span style="color:#4070a0">"MY_ENV"</span> <span style="color:#4070a0;font-weight:700">\
</span>  --event-stream-site<span style="color:#666">=</span><span style="color:#4070a0">"MY_SITE"</span> <span style="color:#4070a0;font-weight:700">\
</span>  --event-stream-url<span style="color:#666">=</span><span style="color:#4070a0">"AUTOMATE_HOSTNAME:4222"</span> <span style="color:#4070a0;font-weight:700">\
</span>  --event-stream-token<span style="color:#666">=</span><span style="color:#4070a0">"API_TOKEN"</span> <span style="color:#4070a0;font-weight:700">\
</span></code></pre></div>
<ul> <li>
<a href="../../habitat/habitat_cli/index.html#hab-sup-run">hab sup run</a> is the hab cli commant to start the Habitat supervisor.</li> <li>
<code>MY_APP</code> is the name of your application. Chef Automate groups services by application name in the Applications Dashboard</li> <li>
<code>MY_ENV</code> is the application environment for this supervisor. Chef Automate groups services by environment in the Applications Dashboard</li> <li>
<code>MY_SITE</code> describes the physical (for example, datacenter) or cloud-specific (for example, the AWS region) location where your services are deployed. The site field is a value filtering for services in the Applications Dashboard.</li> <li>
<code>AUTOMATE_HOSTNAME:4222</code> is the Chef Automate URL with port 4222 specified.</li> <li>
<code>API_TOKEN</code> is the token you created in Chef Automate.</li> </ul> <h3 id="run-the-event-stream-command">Run the Event Stream Command</h3> <p>Paste your customized event stream command into the Chef Habitat command line.</p> <p>For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-shell" data-lang="shell">hab sup run <span style="color:#4070a0;font-weight:700">\
</span>  --event-stream-application<span style="color:#666">=</span><span style="color:#4070a0">"AmazingEnterpriseApp"</span> <span style="color:#4070a0;font-weight:700">\
</span>  --event-stream-environment<span style="color:#666">=</span><span style="color:#4070a0">"acceptance"</span> <span style="color:#4070a0;font-weight:700">\
</span>  --event-stream-site<span style="color:#666">=</span><span style="color:#4070a0">"us-west-2"</span> <span style="color:#4070a0;font-weight:700">\
</span>  --event-stream-url<span style="color:#666">=</span><span style="color:#4070a0">"automate.company.com:4222"</span> <span style="color:#4070a0;font-weight:700">\
</span>  --event-stream-token<span style="color:#666">=</span><span style="color:#4070a0">"1234567890abcdefgh"</span> <span style="color:#4070a0;font-weight:700">\
</span></code></pre></div>
<h2 id="authorize-communication-from-chef-habitat-to-chef-automate">Authorize Communication from Chef Habitat to Chef Automate</h2> <p>The Transport Layer Security (TLS) protocol provides privacy and data integrity during communication between Chef Automate and Chef Habitat. Provide Chef Habitat with Chef Automate’s TLS certificate to authorize communication between the two.</p> <h3 id="retrieve-chef-automates-tls-certificate">Retrieve Chef Automate’s TLS Certificate</h3> <p>Chef Automate’s TLS certificate file is located at <code>/hab/svc/automate-load-balancer/data/&lt;servername&gt;.cert</code>.</p> <p>For example, if your FQDN is <code>automate</code>, then the file location is: <code>/hab/svc/automate-load-balancer/data/automate.cert</code>.</p> <p>From Chef Automate:</p> <ol> <li>On the command line, run <code>chef-automate external-cert show</code>
</li> <li>Copy the certificate contents from the output</li> <li>Make sure to copy it entirely, including <code>-----BEGIN CERTIFICATE...END CERTIFICATE-----</code>
</li> <li>Save the file as <code>automate.cert</code> somewhere safe and accessible to you</li> </ol> <h3 id="share-the-tls-certificate-with-chef-habitat">Share the TLS Certificate with Chef Habitat</h3> <p>Share the automate certificate with the Chef Habitat supervisor.</p> <p>Use <strong>one</strong> of these three options:</p> <h4 id="copy-the-chef-automate-certificate-into-the-habcachessl-directory">Copy the Chef Automate Certificate into the <code>/hab/cache/ssl</code> Directory</h4> <p>Chef Habitat automatically searches that directory and uses the certificate at start up.</p> <p><strong>On Linux systems</strong>, as a root user, copy the certificate to<code>/hab/cache/ssl</code> . As a non-root user, copy it to <code>~/.hab/cache/ssl</code>. The full file path for a non-root user certificate in your local directory is <code>/Users/username/.hab/cache/ssl/automate.cert</code>. You may need to use <code>sudo</code> with the command.</p> <p>As the root user, copy the file with:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">cp /path/to/automate.cert /hab/cache/ssl/automate.cert
</code></pre></div>
<p>As a non-root user, copy it with:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">sudo /path/to/automate.cert ~/.hab/cache/ssl
</code></pre></div>
<p><strong>On Windows systems</strong>, store your certs in <code>C:\hab\cache\ssl</code>. For example, copy the file with:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-powershell" data-lang="powershell"><span style="color:#007020">Copy-Item</span> <span style="color:#4070a0">"C:\path\to\automate.cert"</span> -Destination <span style="color:#4070a0">"C:\hab\cache\ssl"</span>
</code></pre></div>
<h4 id="add-the-tls-certificate-to-your-event-stream-command">Add the TLS Certificate to Your Event Stream Command</h4> <p>Pass the certificate file as a parameter by adding it to your event stream command:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-shell" data-lang="shell">--event-stream-server-certificate<span style="color:#666">=</span>/path/to/automate.cert
</code></pre></div>
<p>For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-shell" data-lang="shell">hab sup run <span style="color:#4070a0;font-weight:700">\
</span>--event-stream-application<span style="color:#666">=</span>MY_APP <span style="color:#4070a0;font-weight:700">\
</span>--event-stream-environment<span style="color:#666">=</span>MY_ENV <span style="color:#4070a0;font-weight:700">\
</span>--event-stream-site<span style="color:#666">=</span>MY_SITE <span style="color:#4070a0;font-weight:700">\
</span>--event-stream-url<span style="color:#666">=</span>AUTOMATE_HOSTNAME:4222 <span style="color:#4070a0;font-weight:700">\
</span>--event-stream-token<span style="color:#666">=</span>API_TOKEN <span style="color:#4070a0;font-weight:700">\
</span>--event-stream-server-certificate<span style="color:#666">=</span>/path/to/automate.cert <span style="color:#4070a0;font-weight:700">\
</span></code></pre></div>
<h4 id="add-the-tls-certificate-to-your-certificate-store">Add the TLS Certificate to Your Certificate Store</h4> <p>Add the certificate to your systems platform-specific certificate store. These are: <code>SChannel</code> on Windows, <code>Secure Transport</code> on OSX, and <code>OpenSSL</code> on all other platforms. Please follow the instructions for your specific operating system.</p> <h2 id="troubleshooting">Troubleshooting</h2> <h3 id="create-a-new-tls-key-pair">Create a New TLS Key Pair</h3> <p>You can change Chef Automate’s automate front-end TLS key pair by following the <a href="../configuration/index.html#load-balancer-certificate-and-private-key">load balancing configuration</a> documentation.</p> <h3 id="re-enable-tls-on-chef-automate">Re-Enable TLS on Chef Automate</h3> <p>In some cases, front-end TLS communication may be previously disabled. To re-enable front-end TLS communication, which allows Chef Automate to receive encrypted event data from Chef Habitat, on the Chef Automate host:</p> <ol> <li>Create a file with the following content:</li> </ol> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-TOML" data-lang="TOML">[event_gateway]
  [event_gateway.v1]
    [event_gateway.v1.sys]
      [event_gateway.v1.sys.service]
        disable_frontend_tls = <span style="color:#007020;font-weight:700">false</span>
</code></pre></div>
<ol> <li>Save the file in the <code>.toml</code> file format. Use any name.</li> <li>Apply the configuration change with <code>chef-automate config patch FILENAME.TOML</code>. You should see output similar to:</li> </ol> <pre tabindex="0" class="highlight" data-language="ruby"><code class="language-output" data-lang="output">Updating deployment configuration

Applying deployment configuration
  Started event-gateway
</code></pre>
<h4 id="disable-tls-encryption-on-chef-automate">Disable TLS Encryption on Chef Automate</h4> <p>To disable front-end TLS encryption on Chef Automate and allow un-encrypted event data from Chef Habitat, on the Chef Automate host:</p> <ol> <li>Create a file with the following content:</li> </ol> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-TOML" data-lang="TOML">[event_gateway]
  [event_gateway.v1]
    [event_gateway.v1.sys]
      [event_gateway.v1.sys.service]
        disable_frontend_tls = <span style="color:#007020;font-weight:700">true</span>
</code></pre></div>
<ol> <li>Save the file in the <code>.toml</code> file format. Use any name.</li> <li>Apply the configuration change with <code>chef-automate config patch FILENAME.TOML</code>. You should see output similar to:</li> </ol> <pre tabindex="0" class="highlight" data-language="ruby"><code class="language-output" data-lang="output">Updating deployment configuration

Applying deployment configuration
  Started event-gateway
</code></pre>
<h3 id="authenticating-existing-chef-automate-and-builder-installations">Authenticating Existing Chef Automate and Builder Installations</h3> <p>To configure Chef Automate as an OAuth Provider for Habitat Builder, create a TOML file that contains the partial configuration below. Run <code>chef-automate config patch &lt;/path/to/your-file.toml&gt;</code> to deploy your change.</p> <p><code>bldr_client_id</code> and <code>bldr_client_secret</code> need to match the settings of the values in Habitat Builder. Follow the <a href="https://www.oauth.com/oauth2-servers/client-registration/client-id-secret/">best practices</a> for setting these values <code>client_id</code> and <code>client_secret</code> in the Oauth2 standard.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-toml" data-lang="toml">[session.v1.sys.service]
bldr_signin_url = <span style="color:#4070a0">"&lt;your Builder fqdn&gt;"</span> <span style="color:#60a0b0;font-style:italic"># for example, "http://builder.test/"</span>
<span style="color:#60a0b0;font-style:italic"># This needs to match what you configured OAUTH_CLIENT_ID as when you configured Habitat Builder.</span>
bldr_client_id = <span style="color:#4070a0">"&lt;your Habitat Builder Oauth2 Client ID&gt;"</span>
<span style="color:#60a0b0;font-style:italic"># This needs to match what you configured OAUTH_CLIENT_SECRET as when you configured Habitat Builder.</span>
bldr_client_secret = <span style="color:#4070a0">"&lt;your Habitat Builder Oauth2 Client Secret&gt;"</span>
</code></pre></div>
<p>You’ll need to add Automate’s TLS certificate to Builder’s list of accepted certificates in addition to these configuration changes. Locate Automate’s default self-signed certificate by running <code>cat /hab/svc/automate-load-balancer/data/automate.example.com.cert</code> You can copy this default certificate, and then add it to your Builder instance’s list of accepted certs.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-text" data-lang="text">-----BEGIN CERTIFICATE-----
MIIDfDCCAmSgAcasldkaf...
-----END CERTIFICATE-----
</code></pre></div>
<p>If you are using a certificate signed by a trusted certificate authority instead of the default certificate, you can provide Builder with the root certificate authority for the signed certificate.</p> <p>For more information, check out this further explanation on how to <a href="https://github.com/habitat-sh/on-prem-builder">configure Builder to authenticate via Chef Automate</a>.</p> <h2 id="related-resources">Related Resources</h2> <p>For more information, see the <a href="../../habitat/index.html">Chef Habitat documentation</a>. In particular, see the entries on:</p> <ul> <li><a href="../../habitat/service_groups/index.html">Service Groups</a></li> <li><a href="../../habitat/about_services/index.html">Services</a></li> <li><a href="../../habitat/sup/index.html">Supervisor</a></li> <li><a href="../../habitat/about_services/index.html#topology">Topology</a></li> </ul> </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; Chef Software, Inc.<br>Licensed under the Creative Commons Attribution 3.0 Unported License.<br>The Chef&trade; Mark and Chef Logo are either registered trademarks/service marks or trademarks/servicemarks of Chef, in the United States and other countries and are used with Chef Inc's permission.<br>We are not affiliated with, endorsed or sponsored by Chef Inc.<br>
    <a href="https://docs.chef.io/automate/applications_setup/" class="_attribution-link">https://docs.chef.io/automate/applications_setup/</a>
  </p>
</div>
