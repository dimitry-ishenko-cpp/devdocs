<div id="col-content" data-swiftype-index="true"> <div id="cookstyle"><h1>Cookstyle</h1></div>  <div class="prose"> <p data-swiftype-index="false"> <a href="https://github.com/chef/chef-workstation/blob/main/docs-chef-io/content/workstation/cookstyle/_index.md" alt="Link to page on GitHub repository">[edit on GitHub]</a> </p> <p>Cookstyle is a code linting tool that helps you write better Chef Infra cookbooks by detecting and automatically correcting style, syntax, and logic mistakes in your code.</p> <p>Cookstyle is powered by the RuboCop linting engine. RuboCop ships with over three-hundred rules, or cops, designed to detect common Ruby coding mistakes and enforce a common coding style. We’ve customized Cookstyle with a subset of those cops that we believe are perfectly tailored for cookbook development. We also ship Chef-specific cops that catch common cookbook coding mistakes, cleanup portions of code that are no longer necessary, and detect deprecations that prevent cookbooks from running on the latest releases of Chef Infra Client.</p> <p>Cookstyle increases code quality by:</p> <ul> <li>Enforcing style conventions and best practices.</li> <li>Helping every member of a team author similarly structured code.</li> <li>Maintaining uniformity in the source code.</li> <li>Setting expectations for fellow (and future) project contributors.</li> <li>Detecting deprecated code that creates errors after upgrading to a newer Chef Infra Client release.</li> <li>Detecting common Chef Infra mistakes that cause code to fail or behave incorrectly.</li> </ul> <h2 id="cookstyle-vs-rubocop">Cookstyle vs. Rubocop</h2> <p>Cookstyle is more stable than Rubocop and is customized for Chef Cookbook code. This means that linting Cookbooks with Cookstyle will be more consistent and less likely to produce CI test failures.</p> <h3 id="tailored-cops">Tailored cops</h3> <p>Cookbook development differs from traditional Ruby software development, so we maintain a tailored set of built-in cops from Rubocop. Cops that are not useful for cookbook development are disabled and occasionally we change the configuration of a rule to enforce a different behavior. We’ve also extended the base RuboCop package with a set of our own Chef Infra-specific cops. These cops are only found in Cookstyle and will help you to write more reliable and future-proof cookbooks.</p> <h3 id="new-cops">New cops</h3> <p>New cops are continuously added to Rubocop. New cops can make existing codebases fail CI tests and force authors to constantly update their code.</p> <p>With Cookstyle, we update the RuboCop engine for bug and performance fixes, but we only change the set of cops that will fail tests once a year during Chef Infra’s major release in April. All new cops are introduced at RuboCop’s “refactor” alert level, meaning they will alert to the screen as you run Cookstyle, but they won’t fail a build. This stability means you are free to upgrade releases of Cookstyle without being forced to update your infrastructure code.</p> <h2 id="run-cookstyle">Run Cookstyle</h2> <p>Cookstyle is run from the command line, typically against a single cookbook and all of the Ruby files contained within it:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">cookstyle /path/to/cookbook
</code></pre></div>
<p>Cookstyle may also be run from the root of an individual cookbook directory:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">cookstyle .
</code></pre></div>
<p>Cookstyle returns a list, via standard output, that shows the results of the evaluation:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">Inspecting <span style="color:#40a070">8</span> files
CWCWCCCC

Offences:

cookbooks/apache/attributes/default.rb:1:1: C: Missing utf-8 encoding comment.
default<span style="color:#666">[</span><span style="color:#4070a0">"apache"</span><span style="color:#666">][</span><span style="color:#4070a0">"indexfile"</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#4070a0">"index1.html"</span>
^
cookbooks/apache/attributes/default.rb:1:9: C: Prefer single-quoted strings when you don<span style="color:#4070a0">'t
</span><span style="color:#4070a0">need string interpolation or special symbols.
</span><span style="color:#4070a0">default["apache"]["indexfile"] = "index1.html"
</span><span style="color:#4070a0">        ^^^^^^^^
</span><span style="color:#4070a0">cookbooks/apache/attributes/default.rb:1:19: C: Prefer single-quoted strings when you
</span><span style="color:#4070a0">don'</span>t need string interpolation or special symbols.
default<span style="color:#666">[</span><span style="color:#4070a0">"apache"</span><span style="color:#666">][</span><span style="color:#4070a0">"indexfile"</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#4070a0">"index1.html"</span>
                  ^^^^^^^^^^^
</code></pre></div>
<h3 id="output">Output</h3> <p>Cookstyle output:</p> <ul> <li>States the number of files found and examined. For example: <code>Inspecting 8 files</code>
</li> <li>Lists the results of those files as a series of symbols. For example: <code>CWCWCCCC</code>
</li> <li>For each symbol, states the file name, line number, character number, type of issue or error, describes the issue or error, and specifies the location in the source code at which the issue or error is located</li> </ul> <p>A Cookstyle evaluation has the following syntax:</p> <pre tabindex="0" class="highlight" data-language="ruby"><code class="language-none" data-lang="none">FILENAME:LINE_NUMBER:CHARACTER_NUMBER: TYPE_OF_ERROR: MESSAGE
SOURCE CODE
^^^^^^^^^^^
</code></pre>
<p>For example:</p> <pre tabindex="0" class="highlight" data-language="ruby"><code class="language-none" data-lang="none">cookbooks/apache/attributes/default.rb:1:9: C: Prefer single-quoted strings when you don't
need string interpolation or special symbols.
default["apache"]["indexfile"] = "index1.html"
        ^^^^^^^^
</code></pre>
<h4 id="symbols">Symbols</h4> <p>The following symbols appear in the standard output and are used to indicate the result of an evaluation:</p> <table> <col style="width:12%"> <col style="width:87%"> <thead> <tr class="header"> <th>Symbol</th> <th>Description</th> </tr> </thead> <tbody> <tr class="odd"> <td><code>.</code></td> <td>The file does not have any issues.</td> </tr> <tr class="even"> <td><code>C</code></td> <td>The file has an issue with convention.</td> </tr> <tr class="odd"> <td><code>E</code></td> <td>The file contains an error.</td> </tr> <tr class="even"> <td><code>F</code></td> <td>The file contains a fatal error.</td> </tr> <tr class="odd"> <td><code>W</code></td> <td>The file contains a warning.</td> </tr> <tr class="even"> <td><code>R</code></td> <td>The file contains code that should be refactored.</td> </tr> </tbody> </table> <h2 id="autocorrecting-cookstyle-warnings">Autocorrecting Cookstyle Warnings</h2> <p>Many of the Cookstyle Cops include the ability to autocorrect violations. To autocorrect code run the following from the cookbook directory:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">cookstyle -a .
</code></pre></div>
<p>Take particular care after running this command to ensure the autocorrection logic resulted in appropriate cookbook code.</p> <h2 id="rubocopyml">.rubocop.yml</h2> <p>Use a .rubocop.yml file in a cookbook to override the default settings in Cookstyle for enabled and disabled rules. Only enabled rules—either in the <code>enabled.yml</code> file in Cookstyle itself or rules that are specifically enabled in a cookbook’s .rubocop.yml file—will be used during the evaluation. Any rule that becomes unhelpful should be disabled in the .rubocop.yml file.</p> <p>Each cookbook has its own .rubocop.yml file, which means that each cookbook may have its own set of enabled, disabled, and custom rules. That said, it’s more common for all cookbooks to have the same set of enabled, disabled, and custom rules. When RuboCop is run against a cookbook, the full set of enabled and disabled rules (as defined the <code>enabled.yml</code> and <code>disabled.yml</code> files in Cookstyle itself) are loaded first, and are then compared against the settings in the cookbook’s .rubocop.yml file.</p> <p>Custom rules should be specified in the .rubocop.yml file. The state of rules—enabled or disabled—in a .rubocop.yml file take precedence over the state of rules defined in the <code>enabled.yml</code> and <code>disabled.yml</code> files.</p> <h3 id="syntax">Syntax</h3> <p>A .rubocop.yml file has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-yaml" data-lang="yaml"><span style="color:#062873;font-weight:700">NAME_OF_RULE</span>:<span style="color:#062873;font-weight:700">Description</span>:<span style="color:#4070a0">'a description of a rule'</span><span style="color:#062873;font-weight:700">Enabled </span>:(true or false)<span style="color:#062873;font-weight:700">KEY</span>:VALUE</code></pre></div>
<p>where</p> <ul> <li>
<code>NAME_OF_RULE</code> is the name of a rule</li> <li>
<code>Description</code> is the string that prints as part of the standard output that describes the rule if it is triggered during the evaluation</li> <li>
<code>Enabled</code> enables a rule (<code>true</code>) or disables a rule (<code>false</code>); for non-custom rules, this value will override the settings in the <code>enabled.yml</code> and <code>disabled.yml</code> files in Cookstyle</li> <li>
<code>KEY: VALUE</code> adds additional details for a rule, if necessary. For example, <code>Max: 200</code> sets the line length to 200 characters for the <code>LineLength</code> rule</li> </ul> <h3 id="rubocop_todoyml">.rubocop_todo.yml</h3> <p>Use a .rubocop_todo.yml file to capture the current state of all evaluations, and then write them to a file. This allows evaluations to reviewed one at a time. Disable any evaluations that are unhelpful, and then address the ones that are.</p> <p>To generate the .rubocop_todo.yml file, run the following command:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">cookstyle --auto-gen-config
</code></pre></div>
<div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> Rename this file to .rubocop.yml to adopt this evaluation state as the standard. Include this file in the .rubocop.yml file by adding <code>inherit_from: .rubocop_todo.yml</code> to the top of the .rubocop.yml file. </div> </div> </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; Chef Software, Inc.<br>Licensed under the Creative Commons Attribution 3.0 Unported License.<br>The Chef&trade; Mark and Chef Logo are either registered trademarks/service marks or trademarks/servicemarks of Chef, in the United States and other countries and are used with Chef Inc's permission.<br>We are not affiliated with, endorsed or sponsored by Chef Inc.<br>
    <a href="https://docs.chef.io/workstation/cookstyle.html" class="_attribution-link">https://docs.chef.io/workstation/cookstyle.html</a>
  </p>
</div>
