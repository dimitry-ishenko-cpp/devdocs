<div id="col-content" data-swiftype-index="true"> <div id="test-kitchen"><h1>Test Kitchen</h1></div>  <div class="prose"> <p data-swiftype-index="false"> <a href="https://github.com/chef/chef-workstation/blob/main/docs-chef-io/content/workstation/kitchen.md" alt="Link to page on GitHub repository">[edit on GitHub]</a> </p> <p>Use <a href="https://kitchen.ci/">Test Kitchen</a> to automatically test cookbooks across any combination of platforms and test suites:</p> <ul> <li>Test suites are defined in a kitchen.yml file. See the <a href="../config_yml_kitchen/index.html">configuration</a> documentation for options and syntax information.</li> <li>Supports cookbook testing across many cloud providers and virtualization technologies.</li> <li>Uses a comprehensive set of operating system base images from Chef’s <a href="https://github.com/chef/bento">Bento</a> project.</li> </ul> <p>The key concepts in Test Kitchen are:</p> <ul> <li>A platform is the operating system or target environment on which a cookbook is to be tested</li> <li>A suite is the Chef Infra Client configuration, a Policyfile or run-list, and (optionally) node attributes</li> <li>An instance is the combination of a specific platform and a specific suite, with each instance being assigned an auto-generated name</li> <li>A driver is the lifecycle that implements the actions associated with a specific instance—create the instance, do what is needed to converge on that instance (such as installing Chef Infra Client, uploading cookbooks, starting a Chef Infra Client run, and so on), setup anything else needed for testing, verify one (or more) suites post-converge, and then destroy that instance</li> <li>A provisioner is the component on which the Chef Infra Client code will be run, either using chef-zero or chef-solo via the <code>chef_zero</code> and <code>chef_solo</code> provisioners, respectively</li> </ul> <h2 id="bento">Bento</h2> <p><a href="https://github.com/chef/bento">Bento</a> is a Chef Software project that produces base testing VirtualBox, Parallels, and VMware boxes for multiple operating systems for use with Test Kitchen. By default, Test Kitchen uses the base images provided by Bento although custom images may also be built using HashiCorp Packer.</p> <h2 id="drivers">Drivers</h2> <p>Test Kitchen uses a driver plugin architecture to enable Test Kitchen to test instances on cloud providers such as Amazon EC2, Google Compute Engine, and Microsoft Azure. You can also test on multiple local hypervisors, such as VMware, Hyper-V, or VirtualBox.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>Chef Workstation includes many common Test Kitchen drivers.</p> </div> </div> <p>Most drivers have driver-specific configuration settings that must be added to the kitchen.yml file before Test Kitchen will be able to use that platform during cookbook testing. For information about these driver-specific settings, please refer to the driver-specific documentation.</p> <p>Some popular drivers:</p> <table> <col style="width:25%"> <col style="width:75%"> <thead> <tr class="header"> <th>Driver Plugin</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><a href="https://github.com/test-kitchen/kitchen-azurerm">kitchen-azurerm</a></td> <td>A driver for Microsoft Azure.</td> </tr> <tr> <td><a href="https://github.com/test-kitchen/kitchen-cloudstack">kitchen-cloudstack</a></td> <td>A driver for CloudStack.</td> </tr> <tr> <td><a href="https://github.com/test-kitchen/kitchen-digitalocean">kitchen-digitalocean</a></td> <td>A driver for DigitalOcean. This driver ships in Chef Workstation.</td> </tr> <tr> <td><a href="https://github.com/test-kitchen/kitchen-dokken">kitchen-dokken</a></td> <td>A driver for Docker. This driver ships in Chef Workstation.</td> </tr> <tr> <td><a href="https://github.com/test-kitchen/kitchen-dsc">kitchen-dsc</a></td> <td>A driver for Windows PowerShell Desired State Configuration (DSC).</td> </tr> <tr> <td><a href="https://github.com/test-kitchen/kitchen-ec2">kitchen-ec2</a></td> <td>A driver for Amazon EC2. This driver ships in Chef Workstation.</td> </tr> <tr> <td><a href="https://github.com/test-kitchen/kitchen-google">kitchen-google</a></td> <td>A driver for Google Compute Engine. This driver ships in Chef Workstation</td> </tr> <tr> <td><a href="https://github.com/test-kitchen/kitchen-hyperv">kitchen-hyperv</a></td> <td>A driver for Microsoft Hyper-V Server. This driver ships in Chef Workstation.</td> </tr> <tr> <td><a href="https://github.com/test-kitchen/kitchen-openstack">kitchen-openstack</a></td> <td>A driver for OpenStack. This driver ships in Chef Workstation.</td> </tr> <tr> <td><a href="https://github.com/test-kitchen/kitchen-rackspace">kitchen-rackspace</a></td> <td>A driver for Rackspace.</td> </tr> <tr> <td><a href="https://github.com/test-kitchen/kitchen-vagrant">kitchen-vagrant</a></td> <td>A driver for HashiCorp Vagrant. This driver ships in Chef Workstation.</td> </tr> </tbody> </table> <h2 id="validation-with-inspec">Validation with InSpec</h2> <p>Test Kitchen will create a VM or cloud instance, install Chef Infra Client to that system, and converge Chef Infra Client with your local cookbook. Once this is complete, you will want to perform automated validation against the infrastructure you have built to validate its configuration. Test Kitchen allows you to run InSpec tests against your converged cookbook for easy local validation of your infrastructure.</p> <h2 id="kitchen-executable">kitchen (executable)</h2> <p>kitchen is the command-line tool for Test Kitchen, an integration testing tool maintained by Chef Software. Test Kitchen runs tests against any combination of platforms using any combination of test suites. Each test, however, is done against a specific instance, which is comprised of a single platform and a single set of testing criteria. This allows each test to be run in isolation, ensuring that different behaviors within the same codebase can be tested thoroughly before those changes are committed to production.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>Any Test Kitchen subcommand that does not specify an instance will be applied to all instances.</p> </div> </div> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> For more information about the <code>kitchen</code> command line tool, see <a href="../ctl_kitchen/index.html">kitchen</a>. </div> </div> <h2 id="kitchenyml">kitchen.yml</h2> <p>Use a kitchen.yml file to define what is required to run Test Kitchen, including drivers, provisioners, platforms, and test suites.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> For more information about the kitchen.yml file, see <a href="../config_yml_kitchen/index.html">kitchen.yml</a>. </div> </div> <h3 id="syntax">Syntax</h3> <p>The basic structure of a kitchen.yml file is as follows:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-yaml" data-lang="yaml"><span style="color:#062873;font-weight:700">driver</span>:<span style="color:#062873;font-weight:700">name</span>:driver_name<span style="color:#062873;font-weight:700">provisioner</span>:<span style="color:#062873;font-weight:700">name</span>:provisioner_name<span style="color:#062873;font-weight:700">verifier</span>:<span style="color:#062873;font-weight:700">name</span>:verifier_name<span style="color:#062873;font-weight:700">transport</span>:<span style="color:#062873;font-weight:700">name</span>:transport_name<span style="color:#062873;font-weight:700">platforms</span>:- <span style="color:#062873;font-weight:700">name</span>:platform-version<span style="color:#062873;font-weight:700">driver</span>:<span style="color:#062873;font-weight:700">name</span>:driver_name- <span style="color:#062873;font-weight:700">name</span>:platform-version<span style="color:#062873;font-weight:700">suites</span>:- <span style="color:#062873;font-weight:700">name</span>:suite_name<span style="color:#062873;font-weight:700">run_list</span>:- recipe[cookbook_name::recipe_name]<span style="color:#062873;font-weight:700">attributes</span>:{<span style="color:#062873;font-weight:700">foo</span>:<span style="color:#4070a0">"bar"</span>}<span style="color:#062873;font-weight:700">excludes</span>:- platform-version- <span style="color:#062873;font-weight:700">name</span>:suite_name<span style="color:#062873;font-weight:700">driver</span>:<span style="color:#062873;font-weight:700">name</span>:driver_name<span style="color:#062873;font-weight:700">run_list</span>:- recipe[cookbook_name::recipe_name]<span style="color:#062873;font-weight:700">attributes</span>:{<span style="color:#062873;font-weight:700">foo</span>:<span style="color:#4070a0">"bar"</span>}<span style="color:#062873;font-weight:700">includes</span>:- platform-version</code></pre></div>
<p>where:</p> <ul> <li> <p><code>driver_name</code> is the name of a driver that will be used to create platform instances used during cookbook testing. This is the default driver used for all platforms and suites <strong>unless</strong> a platform or suite specifies a <code>driver</code> to override the default driver for that platform or suite; a driver specified for a suite will override a driver set for a platform</p> </li> <li> <p><code>provisioner_name</code> specifies how Chef Infra Client will be simulated during testing. <code>chef_zero</code> and <code>chef_solo</code> are the most common provisioners used for testing cookbooks</p> </li> <li> <p><code>verifier_name</code> specifies which application to use when running tests, such as <code>inspec</code></p> </li> <li> <p><code>transport_name</code> specifies which transport to use when executing commands remotely on the test instance. <code>winrm</code> is the default transport on Windows. The <code>ssh</code> transport is the default on all other operating systems.</p> </li> <li> <p><code>platform-version</code> is the name of a platform on which Test Kitchen will perform cookbook testing, for example, <code>ubuntu-20.04</code> or <code>centos-7</code>; depending on the platform, additional driver details—for example, instance names and URLs used with cloud platforms like OpenStack or Amazon EC2—may be required</p> </li> <li> <p><code>platforms</code> may define Chef Infra Server attributes that are common to the collection of test suites</p> </li> <li> <p><code>suites</code> is a collection of test suites, with each <code>suite_name</code> grouping defining an aspect of a cookbook to be tested. Each <code>suite_name</code> must specify a run-list, for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#517918">run_list</span>:
  <span style="color:#666">-</span> recipe<span style="color:#666">[</span>cookbook_name<span style="color:#666">::</span>default<span style="color:#666">]</span>
  <span style="color:#666">-</span> recipe<span style="color:#666">[</span>cookbook_name<span style="color:#666">::</span>recipe_name<span style="color:#666">]</span>
</code></pre></div>
</li> <li> <p>Each <code>suite_name</code> grouping may specify <code>attributes</code> as a Hash: <code>{ foo: "bar" }</code></p> </li> <li> <p>A <code>suite_name</code> grouping may use <code>excludes</code> and <code>includes</code> to exclude/include one (or more) platforms. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#517918">excludes</span>:
   <span style="color:#666">-</span> platform<span style="color:#666">-</span>version
   <span style="color:#666">-</span> platform<span style="color:#666">-</span>version       <span style="color:#60a0b0;font-style:italic"># for additional platforms</span>
</code></pre></div>
</li> </ul> <p>For example, a very simple kitchen.yml file:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-yaml" data-lang="yaml"><span style="color:#062873;font-weight:700">driver</span>:<span style="color:#062873;font-weight:700">name</span>:vagrant<span style="color:#062873;font-weight:700">provisioner</span>:<span style="color:#062873;font-weight:700">name</span>:chef_zero<span style="color:#062873;font-weight:700">platforms</span>:- <span style="color:#062873;font-weight:700">name</span>:ubuntu-20.04- <span style="color:#062873;font-weight:700">name</span>:centos-8- <span style="color:#062873;font-weight:700">name</span>:debian-10<span style="color:#062873;font-weight:700">suites</span>:- <span style="color:#062873;font-weight:700">name</span>:default<span style="color:#062873;font-weight:700">run_list</span>:- recipe[apache::httpd]<span style="color:#062873;font-weight:700">excludes</span>:- debian-10</code></pre></div>
<p>This file uses HashiCorp Vagrant as the driver, which requires no additional configuration because it’s the default driver used by Test Kitchen, chef-zero as the provisioner, and a single (default) test suite that runs on Ubuntu 20.04, and CentOS 7.</p> <h3 id="work-with-proxies">Work with Proxies</h3> <p>The environment variables <code>http_proxy</code>, <code>https_proxy</code>, and <code>ftp_proxy</code> are honored by Test Kitchen for proxies. The client.rb file is read to look for proxy configuration settings. If <code>http_proxy</code>, <code>https_proxy</code>, and <code>ftp_proxy</code> are specified in the client.rb file, Chef Infra Client will configure the <code>ENV</code> variable based on these (and related) settings. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">http_proxy <span style="color:#4070a0">'http://proxy.example.org:8080'</span>
http_proxy_user <span style="color:#4070a0">'myself'</span>
http_proxy_pass <span style="color:#4070a0">'Password1'</span>
</code></pre></div>
<p>will be set to:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#60add5">ENV</span><span style="color:#666">[</span><span style="color:#4070a0">'http_proxy'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#4070a0">'http://myself:Password1@proxy.example.org:8080'</span>
</code></pre></div>
<p>Test Kitchen also supports <code>http_proxy</code> and <code>https_proxy</code> in the <code>kitchen.yml</code> file. You can set them manually or have them read from your local environment variables:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-yaml" data-lang="yaml"><span style="color:#062873;font-weight:700">driver</span>:<span style="color:#062873;font-weight:700">name</span>:vagrant<span style="color:#062873;font-weight:700">provisioner</span>:<span style="color:#062873;font-weight:700">name</span>:chef_zero<span style="color:#60a0b0;font-style:italic"># Set proxy settings manually, or</span><span style="color:#062873;font-weight:700">http_proxy</span>:<span style="color:#4070a0">'http://user:password@server:port'</span><span style="color:#062873;font-weight:700">https_proxy</span>:<span style="color:#4070a0">'http://user:password@server:port'</span><span style="color:#60a0b0;font-style:italic"># Read from local environment variables</span><span style="color:#062873;font-weight:700">http_proxy</span>:&lt;%= ENV['http_proxy'] %&gt;<span style="color:#062873;font-weight:700">https_proxy</span>:&lt;%= ENV['https_proxy'] %&gt;</code></pre></div>
<p>This will not set the proxy environment variables for applications other than Chef. The Vagrant plugin, <a href="http://tmatilai.github.io/vagrant-proxyconf/">vagrant-proxyconf</a>, can be used to set the proxy environment variables for applications inside the VM.</p> <h2 id="for-more-information-">For more information &amp;mldr;</h2> <p>For more information about test-driven development and Test Kitchen:</p> <ul> <li><a href="https://kitchen.ci/">kitchen.ci</a></li> <li><a href="https://kitchen.ci/docs/getting-started/introduction/">Getting Started with Test Kitchen</a></li> </ul> </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; Chef Software, Inc.<br>Licensed under the Creative Commons Attribution 3.0 Unported License.<br>The Chef&trade; Mark and Chef Logo are either registered trademarks/service marks or trademarks/servicemarks of Chef, in the United States and other countries and are used with Chef Inc's permission.<br>We are not affiliated with, endorsed or sponsored by Chef Inc.<br>
    <a href="https://docs.chef.io/workstation/kitchen/" class="_attribution-link">https://docs.chef.io/workstation/kitchen/</a>
  </p>
</div>
