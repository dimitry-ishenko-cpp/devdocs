<div id="col-content" data-swiftype-index="true"> <div id="deprecation-resource_name-declaration-without-provides-chef-31"><h1>Deprecation: resource_name declaration without provides (CHEF-31)</h1></div>  <div class="prose"> <p data-swiftype-index="false"> <a href="https://github.com/chef/chef-web-docs/blob/main/content/deprecations_resource_name_without_provides.md" alt="Link to page on GitHub repository">[edit on GitHub]</a> </p> <p>In Chef Client 12.5.1 through 15, resources could be addressed from recipe code using only the name of the resource, provided that no other <code>provides</code> declaration was used in the same file.</p> <p>The intent was to fulfill the demands that “users should just be able to name a resource and it should work” with the demands that, for more complicated use cases, users should be able to use <code>provides</code> lines to arbitrarily wire up resources to the Chef recipe language.</p> <p>This failed because it attempted to overly simplify user intent while generating two separate constructs with confusing interactions. Most users were entirely unaware that the <code>resource_name</code> statement implicitly issued a <code>provides</code> statement which wired up a specially designated <code>canonical</code> DSL entry, which was then removed behind the scenes if any subsequent <code>provides</code> declaration followed. When this worked it was easy to use, but when it failed the edge conditions were confusing and required too much background knowledge to debug.</p> <p>An attempt was made to preserve more complete backwards compatibility between Chef Infra Client 16.0 and earlier versions by retaining some automatic wiring of the <code>provides</code> statement with the <code>resource_name</code>. This failed due to complicated interactions between cookbooks that used multiple resources with the same name wired up via <code>provides</code> lines to different resource implementations on different operating systems. This was a silent error and dependent upon the parse order of the resources in the cookbook for it to become apparent, and could not be easily detected or remedied.</p> <p>The solution eventually adopted in Chef Infra Client 16.2 was to require all resources to declare a <code>provides</code> lines, and to make the <code>resource_name</code> setting only affect the display output. As a result, any cookbook which declares a resource with only a <code>resource_name</code> needs to add a <code>provides</code> line for Chef Infra Client 16. While this is more disruptive to users it is simple, it can be auto-corrected via static analysis, and it results in a much simpler end state where the <code>resource_name</code> is just a display name and the <code>provides</code> statement is solely responsible for how the resource is addressed in recipe mode.</p> <p>There is also the very old standard that existed before resources could declare what they provided. In that standard, the resource was addressed by prepending the <code>cookbook_name</code> to the filename that the resource was declared in. That has remained unchanged and is not affected by this change.</p> <h2 id="remediation">Remediation</h2> <p>A resource with only a <code>resource_name</code> property:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">resource_name <span style="color:#517918">:my_custom_resource</span>

property <span style="color:#517918">:my_property</span>, <span style="color:#007020">String</span>

action <span style="color:#517918">:run</span> <span style="color:#007020;font-weight:700">do</span>
  <span style="color:#666">[</span> <span style="color:#666">...</span>implementation of the action<span style="color:#666">...</span> <span style="color:#666">]</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Should have a <code>provides</code> statement added:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">resource_name <span style="color:#517918">:my_custom_resource</span>
provides <span style="color:#517918">:my_custom_resource</span>

property <span style="color:#517918">:my_property</span>, <span style="color:#007020">String</span>

action <span style="color:#517918">:run</span> <span style="color:#007020;font-weight:700">do</span>
  <span style="color:#666">[</span> <span style="color:#666">...</span>implementation of the action<span style="color:#666">...</span> <span style="color:#666">]</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>It also works to have the <code>provides</code> line come prior to the <code>resource_name</code>, the order does not matter.</p> <p>For cookbooks which do not have to support Chef Infra Client 15 or before, the <code>resource_name</code> can also be entirely omitted:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">provides <span style="color:#517918">:my_custom_resource</span>

property <span style="color:#517918">:my_property</span>, <span style="color:#007020">String</span>

action <span style="color:#517918">:run</span> <span style="color:#007020;font-weight:700">do</span>
  <span style="color:#666">[</span> <span style="color:#666">...</span>implementation of the action<span style="color:#666">...</span> <span style="color:#666">]</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; Chef Software, Inc.<br>Licensed under the Creative Commons Attribution 3.0 Unported License.<br>The Chef&trade; Mark and Chef Logo are either registered trademarks/service marks or trademarks/servicemarks of Chef, in the United States and other countries and are used with Chef Inc's permission.<br>We are not affiliated with, endorsed or sponsored by Chef Inc.<br>
    <a href="https://docs.chef.io/deprecations_resource_name_without_provides/" class="_attribution-link">https://docs.chef.io/deprecations_resource_name_without_provides/</a>
  </p>
</div>
