<div id="col-content" data-swiftype-index="true"> <div id="install-private-supermarket"><h1>Install Private Supermarket</h1></div>  <div class="prose"> <p data-swiftype-index="false"> <a href="https://github.com/chef/supermarket/blob/main/docs-chef-io/content/supermarket/install_supermarket.md" alt="Link to page on GitHub repository">[edit on GitHub]</a> </p> <p>The source code for Chef Supermarket is located at the following URLs:</p> <ul> <li>The application itself: <a href="https://github.com/chef/supermarket">https://github.com/chef/supermarket</a>. Report issues to: <a href="https://github.com/chef/supermarket/issues">https://github.com/chef/supermarket/issues</a>.</li> <li>The cookbook that is run by the <code>supermarket-ctl reconfigure</code> command: <a href="https://github.com/chef/supermarket/tree/main/omnibus/cookbooks/omnibus-supermarket">https://github.com/chef/supermarket/tree/main/omnibus/cookbooks/omnibus-supermarket</a>
</li> </ul> <h2 id="requirements">Requirements</h2> <p>A private Chef Supermarket has the following requirements:</p> <ul> <li>An working Chef Infra Server, which acts as the OAuth 2.0 provider</li> <li>A user account on the Chef Infra Server with <code>admins</code> privileges</li> <li>A key for the user account on the Chef server</li> <li>An x86_64 compatible Linux host with at least 2 GB memory</li> <li>System clocks synchronized on the Chef Infra Server and Supermarket hosts</li> <li>Sufficient disk space on host to meet project cookbook storage capacity <strong>or</strong> credentials to store cookbooks in an Amazon Simple Storage Service (S3) bucket</li> </ul> <p><strong>Considerations with regard to storage capacity:</strong></p> <ul> <li>PostgreSQL database size will grow linearly based on the number of cookbooks and the number of cookbook versions published</li> <li>Redis database size is negligible as it is used only for background job queuing, and to cache a small number of API responses</li> <li>Cookbook storage growth is entirely dependent on the size of the cookbooks published. Cookbooks that include binaries or other large files will consume more space than code-only cookbooks</li> <li>Opting to run a private Supermarket with off-host PostgreSQL, Redis, and cookbook store is less a decision about storage sizing; it is about data service uptime, backup, and restore procedure for your organization</li> <li>As a point of reference: as of May 2021 after six years of operation, the public Supermarket has approx 83,000 users, 4,000 cookbooks with a total of 27,000 versions published. The PostgreSQL database is 435 MB, and the S3 bucket containing the published community cookbooks is 3.1 GB</li> </ul> <h2 id="chef-identity">Chef Identity</h2> <p>Chef Identity (also referred to as <strong>oc-id</strong>) is an OAuth 2.0 authentication and authorization service packaged with the Chef Infra Server. Chef Identity must be configured to run with a private Chef Supermarket, after which users may use the same credentials to access the Chef Supermarket as they do to access the Chef Infra Server.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> The Chef Supermarket server must be able to reach (via HTTPS) the specified <code>chef_server_url</code> during OAuth 2.0 negotiation. This type of issue is typically with name resolution and firewall rules. </div> </div> <h3 id="configure">Configure</h3> <p>To configure Chef Supermarket to use Chef Identity, do the following:</p> <ol> <li> <p>Log on to the Chef Infra Server via SSH and elevate to an admin-level user. If running a multi-node Chef Infra Server cluster, log on to the node acting as the primary node in the cluster.</p> </li> <li> <p>Update the <code>/etc/opscode/chef-server.rb</code> configuration file.</p> <p>To define OAuth 2 information for Chef Supermarket, create a Hash similar to:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">oc_id<span style="color:#666">[</span><span style="color:#4070a0">'applications'</span><span style="color:#666">]</span> <span style="color:#666">||=</span> {}
oc_id<span style="color:#666">[</span><span style="color:#4070a0">'applications'</span><span style="color:#666">][</span><span style="color:#4070a0">'supermarket'</span><span style="color:#666">]</span> <span style="color:#666">=</span> {
  <span style="color:#4070a0">'redirect_uri'</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'https://supermarket.mycompany.com/auth/chef_oauth2/callback'</span>,
}
</code></pre></div> </li> <li> <p>Reconfigure the Chef Infra Server.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">sudo chef-server-ctl reconfigure
</code></pre></div>
</li> <li> <p>Retrieve Supermarket’s OAuth 2.0 client credentials:</p> <p>Depending on your Chef Infra Server version and configuration (see <a href="../server/config_rb_server_optional_settings/index.html#config-rb-server-insecure-addon-compat">chef-server.rb</a>), this can be retrieved via <a href="../ctl_chef_server/index.html#ctl-chef-server-oc-id-show-app">chef-server-ctl oc-id-show-app supermarket</a> or is located in <code>/etc/opscode/oc-id-applications/supermarket.json</code>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-javascript" data-lang="javascript">{
  <span style="color:#4070a0">"name"</span><span style="color:#666">:</span> <span style="color:#4070a0">"supermarket"</span>,
  <span style="color:#4070a0">"uid"</span><span style="color:#666">:</span> <span style="color:#4070a0">"0bad0f2eb04e935718e081fb71asdfec3681c81acb9968a8e1e32451d08b"</span>,
  <span style="color:#4070a0">"secret"</span><span style="color:#666">:</span> <span style="color:#4070a0">"17cf1141cc971a10ce307611beda7ffadstr4f1bc98d9f9ca76b9b127879"</span>,
  <span style="color:#4070a0">"redirect_uri"</span><span style="color:#666">:</span> <span style="color:#4070a0">"https://supermarket.mycompany.com/auth/chef_oauth2/callback"</span>
}
</code></pre></div>
<p>The <code>uid</code> and <code>secret</code> values will be needed later on during the setup process for Chef Supermarket.</p> </li> </ol> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> Add as many Chef Identity applications to the <code>/etc/opscode/chef-server.rb</code> configuration file as necessary. A JSON file is generated for each application added, which contains the authentication tokens for that application. The secrets are added to the Chef Identity database and are available to all nodes in the Chef Infra Server front end group. The generated JSON files do not need to be copied anywhere. </div> </div> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> The redirect URL specified <strong>MUST</strong> match the FQDN of the Chef Supermarket server. The URI must also be correct: <code>/auth/chef_oauth2/callback</code>. Otherwise, an error message similar to <code>The redirect uri included is not valid.</code> will be shown. </div> </div> <h2 id="install-supermarket">Install Supermarket</h2> <p>To install a private Chef Supermarket use the <code>supermarket-omnibus-cookbook</code>. This cookbook is <a href="https://supermarket.chef.io/cookbooks/supermarket-omnibus-cookbook">available from the public</a> Chef Supermarket.</p> <ul> <li>The <code>supermarket-omnibus-cookbook</code> cookbook is attribute-driven; use a custom cookbook to specify your organization’s unique <code>node[supermarket_omnibus]</code> attribute values.</li> <li>The custom cookbook is a wrapper around <code>supermarket-omnibus-cookbook</code>, which performs the actual installation of the Chef Supermarket packages, and then writes the custom <code>node[supermarket_omnibus]</code> values to <code>/etc/supermarket/supermarket.json</code>.</li> <li>The Chef Supermarket package itself contains an internal cookbook which configures the already-installed package using the attributes defined in <code>/etc/supermarket/supermarket.json</code>.</li> </ul> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> In general, for production environments Chef recommends to start running Chef Supermarket with small virtual machines, and then increase the size of the virtual machine as necessary. Put the <code>/var/opt/supermarket</code> directory on a separate disk, and then use LVM so that may be expanded. </div> </div> <h3 id="create-a-wrapper">Create a Wrapper</h3> <p>A wrapper cookbook is used to define project- and/or organization-specific requirements around a community cookbook.</p> <figure><img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxOS4xLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iTGF5ZXJfMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiDQoJIHZpZXdCb3g9IjAgMCAyODcuOSAxMTUuOCIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMjg3LjkgMTE1LjgiIHhtbDpzcGFjZT0icHJlc2VydmUiPg0KPHJlY3QgZmlsbD0iIzQ0NTQ2NCIgd2lkdGg9IjI4Ny45IiBoZWlnaHQ9IjExNS44Ii8+DQo8Zz4NCgk8Zz4NCgkJPHBhdGggZmlsbD0iI0ZGRkZGRiIgZD0iTTE2Mi45LDU0LjFoM2MxLjgsMCwyLjgsMSwyLjgsMi41djBjMCwxLjctMS4zLDIuNi0zLDIuNmgtMS4ydjIuMmgtMS42VjU0LjF6IE0xNjUuOCw1Ny44DQoJCQljMC44LDAsMS4zLTAuNSwxLjMtMS4xdjBjMC0wLjctMC41LTEuMS0xLjMtMS4xaC0xLjJ2Mi4ySDE2NS44eiIvPg0KCQk8cGF0aCBmaWxsPSIjRkZGRkZGIiBkPSJNMTY5LjgsNTMuOGgxLjd2MS40aC0xLjdWNTMuOHogTTE2OS44LDU1LjhoMS42djUuNmgtMS42VjU1Ljh6Ii8+DQoJCTxwYXRoIGZpbGw9IiNGRkZGRkYiIGQ9Ik0xNzIuOSw1NS44aDEuNnYwLjhjMC40LTAuNSwwLjktMC45LDEuOC0wLjljMS4zLDAsMi42LDEsMi42LDIuOXYwYzAsMS45LTEuMiwyLjktMi42LDIuOQ0KCQkJYy0wLjksMC0xLjQtMC40LTEuOC0wLjh2Mi40aC0xLjZWNTUuOHogTTE3Ny4yLDU4LjZMMTc3LjIsNTguNmMwLTEtMC42LTEuNi0xLjQtMS42Yy0wLjcsMC0xLjQsMC42LTEuNCwxLjZ2MA0KCQkJYzAsMC45LDAuNiwxLjYsMS40LDEuNkMxNzYuNiw2MC4yLDE3Ny4yLDU5LjYsMTc3LjIsNTguNnoiLz4NCgkJPHBhdGggZmlsbD0iI0ZGRkZGRiIgZD0iTTE3OS43LDU4LjdMMTc5LjcsNTguN2MwLTEuNiwxLjEtMi45LDIuOC0yLjljMS45LDAsMi43LDEuNSwyLjcsMy4xYzAsMC4xLDAsMC4zLDAsMC40aC0zLjkNCgkJCWMwLjIsMC43LDAuNywxLjEsMS40LDEuMWMwLjUsMCwwLjktMC4yLDEuNC0wLjZsMC45LDAuOGMtMC41LDAuNy0xLjMsMS0yLjMsMUMxODEsNjEuNiwxNzkuNyw2MC40LDE3OS43LDU4Ljd6IE0xODMuNyw1OC4yDQoJCQljLTAuMS0wLjctMC41LTEuMi0xLjItMS4yYy0wLjcsMC0xLjEsMC41LTEuMiwxLjJIMTgzLjd6Ii8+DQoJCTxwYXRoIGZpbGw9IiNGRkZGRkYiIGQ9Ik0xODYuNSw1My44aDEuNnY3LjdoLTEuNlY1My44eiIvPg0KCQk8cGF0aCBmaWxsPSIjRkZGRkZGIiBkPSJNMTg5LjYsNTMuOGgxLjd2MS40aC0xLjdWNTMuOHogTTE4OS43LDU1LjhoMS42djUuNmgtMS42VjU1Ljh6Ii8+DQoJCTxwYXRoIGZpbGw9IiNGRkZGRkYiIGQ9Ik0xOTIuOCw1NS44aDEuNnYwLjhjMC40LTAuNSwwLjgtMC45LDEuNi0wLjljMS4yLDAsMS45LDAuOCwxLjksMi4xdjMuNmgtMS42di0zLjFjMC0wLjgtMC40LTEuMS0xLTEuMQ0KCQkJYy0wLjYsMC0xLDAuNC0xLDEuMXYzLjFoLTEuNlY1NS44eiIvPg0KCQk8cGF0aCBmaWxsPSIjRkZGRkZGIiBkPSJNMTk5LDU4LjdMMTk5LDU4LjdjMC0xLjYsMS4xLTIuOSwyLjgtMi45YzEuOSwwLDIuNywxLjUsMi43LDMuMWMwLDAuMSwwLDAuMywwLDAuNGgtMy45DQoJCQljMC4yLDAuNywwLjcsMS4xLDEuNCwxLjFjMC41LDAsMC45LTAuMiwxLjQtMC42bDAuOSwwLjhjLTAuNSwwLjctMS4zLDEtMi4zLDFDMjAwLjMsNjEuNiwxOTksNjAuNCwxOTksNTguN3ogTTIwMyw1OC4yDQoJCQljLTAuMS0wLjctMC41LTEuMi0xLjItMS4yYy0wLjcsMC0xLjEsMC41LTEuMiwxLjJIMjAzeiIvPg0KCQk8cGF0aCBmaWxsPSIjRkZGRkZGIiBkPSJNMjA4LjcsNTcuOEwyMDguNyw1Ny44YzAtMi4xLDEuNi0zLjgsMy44LTMuOGMxLjQsMCwyLjIsMC41LDIuOSwxLjFsLTEsMS4yYy0wLjYtMC41LTEuMS0wLjgtMS45LTAuOA0KCQkJYy0xLjIsMC0yLjEsMS0yLjEsMi4zdjBjMCwxLjMsMC45LDIuMywyLjEsMi4zYzAuOCwwLDEuNC0wLjMsMS45LTAuOWwxLDFjLTAuOCwwLjgtMS42LDEuMy0zLDEuMw0KCQkJQzIxMC4zLDYxLjYsMjA4LjcsNTkuOSwyMDguNyw1Ny44eiIvPg0KCTwvZz4NCjwvZz4NCjxyZWN0IHg9Ijk5LjkiIHk9IjkuOSIgZmlsbD0iIzdGODg4RCIgd2lkdGg9IjE3OC4yIiBoZWlnaHQ9Ijk2Ii8+DQo8cmVjdCB4PSIxODkuOSIgeT0iMTkuOSIgZmlsbD0iIzZDQjFFMSIgd2lkdGg9Ijc4LjUiIGhlaWdodD0iNzYiLz4NCjxnPg0KCTxnPg0KCQk8cGF0aCBmaWxsPSIjRkZGRkZGIiBkPSJNMjI5LjEsNzIuMmMtMC4zLDAtMC41LTAuMS0wLjgtMC4ybC0xOS40LTkuNmMtMC43LTAuMy0xLjEtMS4xLTEuMS0xLjlWNDEuMmMwLTAuOCwwLjQtMS42LDEuMS0xLjkNCgkJCWwxOS40LTkuNmMwLjUtMC4yLDEuMS0wLjIsMS42LDBsMTkuNCw5LjZjMC43LDAuMywxLjEsMS4xLDEuMSwxLjl2MTkuM2MwLDAuOC0wLjQsMS42LTEuMSwxLjlsLTE5LjQsOS42DQoJCQlDMjI5LjcsNzIuMiwyMjkuNCw3Mi4yLDIyOS4xLDcyLjJMMjI5LjEsNzIuMnogTTIxMS42LDU5LjJsMTcuNSw4LjdsMTcuNS04LjdWNDIuNmwtMTcuNS04LjdsLTE3LjUsOC43VjU5LjJMMjExLjYsNTkuMnoiLz4NCgk8L2c+DQoJPGc+DQoJCTxwYXRoIGZpbGw9IiNGRkZGRkYiIGQ9Ik0yMjkuMSw1My41Yy0wLjMsMC0wLjUtMC4xLTAuOC0wLjJsLTE5LjQtOS42Yy0xLTAuNS0xLjQtMS43LTAuOS0yLjdjMC40LTEsMS42LTEuNSwyLjUtMWwxOC43LDkuMw0KCQkJbDE4LjctOS4zYzEtMC41LDIuMSwwLDIuNSwxYzAuNCwxLDAsMi4zLTAuOSwyLjdsLTE5LjQsOS42QzIyOS43LDUzLjQsMjI5LjQsNTMuNSwyMjkuMSw1My41TDIyOS4xLDUzLjV6Ii8+DQoJPC9nPg0KCTxnPg0KCQk8cGF0aCBmaWxsPSIjRkZGRkZGIiBkPSJNMjM5LjYsNDcuN2MtMC4xLDAtMC4zLDAtMC40LTAuMUwyMTkuOCwzOGMtMC41LTAuMi0wLjctMC45LTAuNS0xLjRjMC4yLTAuNSwwLjgtMC43LDEuMy0wLjVsMTkuNCw5LjYNCgkJCWMwLjUsMC4yLDAuNywwLjksMC41LDEuNEMyNDAuMyw0Ny41LDI0MCw0Ny43LDIzOS42LDQ3LjdMMjM5LjYsNDcuN3oiLz4NCgk8L2c+DQoJPGc+DQoJCTxwYXRoIGZpbGw9IiNGRkZGRkYiIGQ9Ik0yMjkuMSw3MS41Yy0xLjEsMC0xLjktMC45LTEuOS0yLjF2LTE2YzAtMS4xLDAuOS0yLjEsMS45LTIuMWMxLjEsMCwxLjksMC45LDEuOSwyLjF2MTYNCgkJCUMyMzEsNzAuNiwyMzAuMiw3MS41LDIyOS4xLDcxLjVMMjI5LjEsNzEuNXoiLz4NCgk8L2c+DQo8L2c+DQo8Zz4NCgk8Zz4NCgkJPHBhdGggZmlsbD0iI0ZGRkZGRiIgZD0iTTIwNy41LDgwaDNjMS44LDAsMi44LDEsMi44LDIuNXYwYzAsMS43LTEuMywyLjYtMywyLjZoLTEuMnYyLjJoLTEuNlY4MHogTTIxMC40LDgzLjcNCgkJCWMwLjgsMCwxLjMtMC41LDEuMy0xLjF2MGMwLTAuNy0wLjUtMS4xLTEuMy0xLjFoLTEuMnYyLjJIMjEwLjR6Ii8+DQoJCTxwYXRoIGZpbGw9IiNGRkZGRkYiIGQ9Ik0yMTMuOSw4NS44TDIxMy45LDg1LjhjMC0xLjIsMC45LTEuOCwyLjMtMS44YzAuNiwwLDEsMC4xLDEuNCwwLjJ2LTAuMWMwLTAuNy0wLjQtMS0xLjItMQ0KCQkJYy0wLjYsMC0xLDAuMS0xLjYsMC4zbC0wLjQtMS4yYzAuNi0wLjMsMS4yLTAuNSwyLjItMC41YzAuOSwwLDEuNSwwLjIsMS45LDAuNmMwLjQsMC40LDAuNiwxLDAuNiwxLjh2My4zaC0xLjV2LTAuNg0KCQkJYy0wLjQsMC40LTAuOSwwLjctMS43LDAuN0MyMTQuOCw4Ny41LDIxMy45LDg2LjksMjEzLjksODUuOHogTTIxNy42LDg1LjR2LTAuM2MtMC4zLTAuMS0wLjYtMC4yLTEtMC4yYy0wLjcsMC0xLjEsMC4zLTEuMSwwLjh2MA0KCQkJYzAsMC40LDAuNCwwLjcsMC45LDAuN0MyMTcuMSw4Ni40LDIxNy42LDg2LDIxNy42LDg1LjR6Ii8+DQoJCTxwYXRoIGZpbGw9IiNGRkZGRkYiIGQ9Ik0yMjAuMiw4NC42TDIyMC4yLDg0LjZjMC0xLjYsMS4yLTIuOSwyLjktMi45YzEuMSwwLDEuNywwLjQsMi4yLDAuOWwtMSwxYy0wLjQtMC40LTAuNy0wLjYtMS4zLTAuNg0KCQkJYy0wLjgsMC0xLjQsMC43LTEuNCwxLjV2MGMwLDAuOSwwLjYsMS42LDEuNCwxLjZjMC41LDAsMC45LTAuMiwxLjMtMC42bDAuOSwwLjljLTAuNSwwLjYtMS4yLDEtMi4zLDENCgkJCUMyMjEuNCw4Ny41LDIyMC4yLDg2LjIsMjIwLjIsODQuNnoiLz4NCgkJPHBhdGggZmlsbD0iI0ZGRkZGRiIgZD0iTTIyNi41LDc5LjdoMS42djQuMWwxLjktMmgxLjlsLTIuMSwyLjJsMi4yLDMuNGgtMS44bC0xLjUtMi4zbC0wLjYsMC42djEuN2gtMS42Vjc5Ljd6Ii8+DQoJCTxwYXRoIGZpbGw9IiNGRkZGRkYiIGQ9Ik0yMzIuMyw4NS44TDIzMi4zLDg1LjhjMC0xLjIsMC45LTEuOCwyLjMtMS44YzAuNiwwLDEsMC4xLDEuNCwwLjJ2LTAuMWMwLTAuNy0wLjQtMS0xLjItMQ0KCQkJYy0wLjYsMC0xLDAuMS0xLjYsMC4zbC0wLjQtMS4yYzAuNi0wLjMsMS4yLTAuNSwyLjItMC41YzAuOSwwLDEuNSwwLjIsMS45LDAuNmMwLjQsMC40LDAuNiwxLDAuNiwxLjh2My4zaC0xLjV2LTAuNg0KCQkJYy0wLjQsMC40LTAuOSwwLjctMS43LDAuN0MyMzMuMSw4Ny41LDIzMi4zLDg2LjksMjMyLjMsODUuOHogTTIzNS45LDg1LjR2LTAuM2MtMC4zLTAuMS0wLjYtMC4yLTEtMC4yYy0wLjcsMC0xLjEsMC4zLTEuMSwwLjh2MA0KCQkJYzAsMC40LDAuNCwwLjcsMC45LDAuN0MyMzUuNCw4Ni40LDIzNS45LDg2LDIzNS45LDg1LjR6Ii8+DQoJCTxwYXRoIGZpbGw9IiNGRkZGRkYiIGQ9Ik0yMzguOCw4OC41bDAuNS0xLjJjMC42LDAuMywxLjIsMC41LDEuOSwwLjVjMS4xLDAsMS42LTAuNSwxLjYtMS41Vjg2Yy0wLjUsMC42LTEsMC45LTEuOCwwLjkNCgkJCWMtMS4zLDAtMi41LTEtMi41LTIuNnYwYzAtMS43LDEuMi0yLjYsMi41LTIuNmMwLjksMCwxLjQsMC40LDEuOCwwLjh2LTAuN2gxLjZ2NC40YzAsMS0wLjIsMS43LTAuNywyLjJjLTAuNSwwLjUtMS4zLDAuOC0yLjQsMC44DQoJCQlDMjQwLjQsODkuMSwyMzkuNSw4OC45LDIzOC44LDg4LjV6IE0yNDIuOSw4NC4zTDI0Mi45LDg0LjNjMC0wLjgtMC42LTEuMy0xLjQtMS4zYy0wLjgsMC0xLjQsMC41LTEuNCwxLjN2MA0KCQkJYzAsMC44LDAuNiwxLjMsMS40LDEuM0MyNDIuMyw4NS42LDI0Mi45LDg1LjEsMjQyLjksODQuM3oiLz4NCgkJPHBhdGggZmlsbD0iI0ZGRkZGRiIgZD0iTTI0NS42LDg0LjZMMjQ1LjYsODQuNmMwLTEuNiwxLjEtMi45LDIuOC0yLjljMS45LDAsMi43LDEuNSwyLjcsMy4xYzAsMC4xLDAsMC4zLDAsMC40aC0zLjkNCgkJCWMwLjIsMC43LDAuNywxLjEsMS40LDEuMWMwLjUsMCwwLjktMC4yLDEuNC0wLjZsMC45LDAuOGMtMC41LDAuNy0xLjMsMS0yLjMsMUMyNDYuOSw4Ny41LDI0NS42LDg2LjMsMjQ1LjYsODQuNnogTTI0OS42LDg0LjENCgkJCWMtMC4xLTAuNy0wLjUtMS4yLTEuMi0xLjJjLTAuNywwLTEuMSwwLjUtMS4yLDEuMkgyNDkuNnoiLz4NCgk8L2c+DQo8L2c+DQo8cmVjdCB4PSIxMDYuMiIgeT0iMTkuOSIgZmlsbD0iIzdGODg4RCIgd2lkdGg9Ijc4LjUiIGhlaWdodD0iNzYiLz4NCjxnPg0KCTxnPg0KCQk8cGF0aCBmaWxsPSIjRkZGRkZGIiBkPSJNMTUzLjksNDcuOGgtMTIuNGMtMC40LDAtMC44LTAuNC0wLjgtMC44di03YzAtMC40LDAuNC0wLjgsMC44LTAuOGgxMi40YzAuNCwwLDAuOCwwLjQsMC44LDAuOHY3DQoJCQlDMTU0LjcsNDcuNCwxNTQuNCw0Ny44LDE1My45LDQ3LjhMMTUzLjksNDcuOHogTTE0Mi40LDQ2LjJoMTAuOHYtNS40aC0xMC44VjQ2LjJMMTQyLjQsNDYuMnoiLz4NCgk8L2c+DQoJPGc+DQoJCTxnPg0KCQkJPHBhdGggZmlsbD0iI0ZGRkZGRiIgZD0iTTE2MC43LDY5LjlIMTMzYy0wLjksMC0xLjYtMC43LTEuNi0xLjZWMzMuNWMwLTAuOSwwLjctMS42LDEuNi0xLjZoMjcuN2MwLjksMCwxLjYsMC43LDEuNiwxLjZ2MzQuOA0KCQkJCUMxNjIuMyw2OS4yLDE2MS42LDY5LjksMTYwLjcsNjkuOUwxNjAuNyw2OS45eiBNMTM0LjYsNjYuN2gyNC40VjM1LjFoLTI0LjRWNjYuN0wxMzQuNiw2Ni43eiIvPg0KCQk8L2c+DQoJCTxnPg0KCQkJPHBhdGggZmlsbD0iI0ZGRkZGRiIgZD0iTTEzNS45LDQxLjZoLTUuNmMtMC45LDAtMS42LTAuNy0xLjYtMS42YzAtMC45LDAuNy0xLjYsMS42LTEuNmg1LjZjMC45LDAsMS42LDAuNywxLjYsMS42DQoJCQkJQzEzNy41LDQwLjksMTM2LjcsNDEuNiwxMzUuOSw0MS42TDEzNS45LDQxLjZ6Ii8+DQoJCTwvZz4NCgkJPGc+DQoJCQk8cGF0aCBmaWxsPSIjRkZGRkZGIiBkPSJNMTM1LjksNDguOGgtNS42Yy0wLjksMC0xLjYtMC43LTEuNi0xLjZjMC0wLjksMC43LTEuNiwxLjYtMS42aDUuNmMwLjksMCwxLjYsMC43LDEuNiwxLjYNCgkJCQlDMTM3LjUsNDguMSwxMzYuNyw0OC44LDEzNS45LDQ4LjhMMTM1LjksNDguOHoiLz4NCgkJPC9nPg0KCQk8Zz4NCgkJCTxwYXRoIGZpbGw9IiNGRkZGRkYiIGQ9Ik0xMzUuOSw1NmgtNS42Yy0wLjksMC0xLjYtMC43LTEuNi0xLjZjMC0wLjksMC43LTEuNiwxLjYtMS42aDUuNmMwLjksMCwxLjYsMC43LDEuNiwxLjYNCgkJCQlDMTM3LjUsNTUuMywxMzYuNyw1NiwxMzUuOSw1NkwxMzUuOSw1NnoiLz4NCgkJPC9nPg0KCQk8Zz4NCgkJCTxwYXRoIGZpbGw9IiNGRkZGRkYiIGQ9Ik0xMzUuOSw2My4yaC01LjZjLTAuOSwwLTEuNi0wLjctMS42LTEuNmMwLTAuOSwwLjctMS42LDEuNi0xLjZoNS42YzAuOSwwLDEuNiwwLjcsMS42LDEuNg0KCQkJCUMxMzcuNSw2Mi41LDEzNi43LDYzLjIsMTM1LjksNjMuMkwxMzUuOSw2My4yeiIvPg0KCQk8L2c+DQoJPC9nPg0KPC9nPg0KPGc+DQoJPGc+DQoJCTxwYXRoIGZpbGw9IiNGRkZGRkYiIGQ9Ik0xMTEuNiw4Ni4zbDEtMS4xYzAuNywwLjUsMS40LDAuOSwyLjIsMC45YzAuNywwLDEuMS0wLjMsMS4xLTAuN3YwYzAtMC40LTAuMy0wLjYtMS41LTAuOQ0KCQkJYy0xLjUtMC40LTIuNC0wLjgtMi40LTIuMnYwYzAtMS4zLDEuMS0yLjIsMi42LTIuMmMxLjEsMCwyLDAuMywyLjcsMC45bC0wLjgsMS4yYy0wLjctMC41LTEuMy0wLjctMS45LTAuNw0KCQkJYy0wLjYsMC0wLjksMC4zLTAuOSwwLjZ2MGMwLDAuNSwwLjMsMC42LDEuNiwxYzEuNSwwLjQsMi4zLDAuOSwyLjMsMi4ydjBjMCwxLjUtMS4xLDIuMy0yLjcsMi4zDQoJCQlDMTEzLjYsODcuNSwxMTIuNSw4Ny4xLDExMS42LDg2LjN6Ii8+DQoJCTxwYXRoIGZpbGw9IiNGRkZGRkYiIGQ9Ik0xMTguNiw4NS40di0zLjZoMS42djMuMWMwLDAuOCwwLjQsMS4xLDEsMS4xczEtMC40LDEtMS4xdi0zLjFoMS42djUuNmgtMS42di0wLjgNCgkJCWMtMC40LDAuNS0wLjgsMC45LTEuNiwwLjlDMTE5LjMsODcuNSwxMTguNiw4Ni43LDExOC42LDg1LjR6Ii8+DQoJCTxwYXRoIGZpbGw9IiNGRkZGRkYiIGQ9Ik0xMjUuMiw4MS44aDEuNnYwLjhjMC40LTAuNSwwLjktMC45LDEuOC0wLjljMS4zLDAsMi42LDEsMi42LDIuOXYwYzAsMS45LTEuMiwyLjktMi42LDIuOQ0KCQkJYy0wLjksMC0xLjQtMC40LTEuOC0wLjh2Mi40aC0xLjZWODEuOHogTTEyOS41LDg0LjZMMTI5LjUsODQuNmMwLTEtMC42LTEuNi0xLjQtMS42Yy0wLjcsMC0xLjQsMC42LTEuNCwxLjZ2MA0KCQkJYzAsMC45LDAuNiwxLjYsMS40LDEuNkMxMjguOSw4Ni4xLDEyOS41LDg1LjUsMTI5LjUsODQuNnoiLz4NCgkJPHBhdGggZmlsbD0iI0ZGRkZGRiIgZD0iTTEzMiw4NC42TDEzMiw4NC42YzAtMS42LDEuMS0yLjksMi44LTIuOWMxLjksMCwyLjcsMS41LDIuNywzLjFjMCwwLjEsMCwwLjMsMCwwLjRoLTMuOQ0KCQkJYzAuMiwwLjcsMC43LDEuMSwxLjQsMS4xYzAuNSwwLDAuOS0wLjIsMS40LTAuNmwwLjksMC44Yy0wLjUsMC43LTEuMywxLTIuMywxQzEzMy4yLDg3LjUsMTMyLDg2LjMsMTMyLDg0LjZ6IE0xMzYsODQuMQ0KCQkJYy0wLjEtMC43LTAuNS0xLjItMS4yLTEuMmMtMC43LDAtMS4xLDAuNS0xLjIsMS4ySDEzNnoiLz4NCgkJPHBhdGggZmlsbD0iI0ZGRkZGRiIgZD0iTTEzOC43LDgxLjhoMS42djEuMWMwLjMtMC44LDAuOS0xLjMsMS44LTEuMnYxLjdIMTQyYy0xLjEsMC0xLjcsMC42LTEuNywydjIuMWgtMS42VjgxLjh6Ii8+DQoJCTxwYXRoIGZpbGw9IiNGRkZGRkYiIGQ9Ik0xNDMuMSw4MS44aDEuNnYwLjhjMC40LTAuNSwwLjktMC45LDEuNy0wLjljMC43LDAsMS4zLDAuMywxLjYsMC45YzAuNS0wLjYsMS4xLTAuOSwxLjgtMC45DQoJCQljMS4yLDAsMS45LDAuNywxLjksMi4xdjMuN2gtMS42di0zLjFjMC0wLjgtMC4zLTEuMS0wLjktMS4xYy0wLjYsMC0xLDAuNC0xLDEuMXYzLjFoLTEuNnYtMy4xYzAtMC44LTAuMy0xLjEtMC45LTEuMQ0KCQkJcy0xLDAuNC0xLDEuMXYzLjFoLTEuNlY4MS44eiIvPg0KCQk8cGF0aCBmaWxsPSIjRkZGRkZGIiBkPSJNMTUyLjcsODUuOEwxNTIuNyw4NS44YzAtMS4yLDAuOS0xLjgsMi4zLTEuOGMwLjYsMCwxLDAuMSwxLjQsMC4ydi0wLjFjMC0wLjctMC40LTEtMS4yLTENCgkJCWMtMC42LDAtMSwwLjEtMS42LDAuM2wtMC40LTEuMmMwLjYtMC4zLDEuMi0wLjUsMi4yLTAuNWMwLjksMCwxLjUsMC4yLDEuOSwwLjZjMC40LDAuNCwwLjYsMSwwLjYsMS44djMuM2gtMS41di0wLjYNCgkJCWMtMC40LDAuNC0wLjksMC43LTEuNywwLjdDMTUzLjYsODcuNSwxNTIuNyw4Ni45LDE1Mi43LDg1Ljh6IE0xNTYuNCw4NS40di0wLjNjLTAuMy0wLjEtMC42LTAuMi0xLTAuMmMtMC43LDAtMS4xLDAuMy0xLjEsMC44djANCgkJCWMwLDAuNCwwLjQsMC43LDAuOSwwLjdDMTU1LjksODYuNCwxNTYuNCw4NiwxNTYuNCw4NS40eiIvPg0KCQk8cGF0aCBmaWxsPSIjRkZGRkZGIiBkPSJNMTU5LjMsODEuOGgxLjZ2MS4xYzAuMy0wLjgsMC45LTEuMywxLjgtMS4ydjEuN2gtMC4xYy0xLjEsMC0xLjcsMC42LTEuNywydjIuMWgtMS42VjgxLjh6Ii8+DQoJCTxwYXRoIGZpbGw9IiNGRkZGRkYiIGQ9Ik0xNjMuNyw3OS43aDEuNnY0LjFsMS45LTJoMS45bC0yLjEsMi4ybDIuMiwzLjRoLTEuOGwtMS41LTIuM2wtMC42LDAuNnYxLjdoLTEuNlY3OS43eiIvPg0KCQk8cGF0aCBmaWxsPSIjRkZGRkZGIiBkPSJNMTY5LjQsODQuNkwxNjkuNCw4NC42YzAtMS42LDEuMS0yLjksMi44LTIuOWMxLjksMCwyLjcsMS41LDIuNywzLjFjMCwwLjEsMCwwLjMsMCwwLjRoLTMuOQ0KCQkJYzAuMiwwLjcsMC43LDEuMSwxLjQsMS4xYzAuNSwwLDAuOS0wLjIsMS40LTAuNmwwLjksMC44Yy0wLjUsMC43LTEuMywxLTIuMywxQzE3MC42LDg3LjUsMTY5LjQsODYuMywxNjkuNCw4NC42eiBNMTczLjMsODQuMQ0KCQkJYy0wLjEtMC43LTAuNS0xLjItMS4yLTEuMmMtMC43LDAtMS4xLDAuNS0xLjIsMS4ySDE3My4zeiIvPg0KCQk8cGF0aCBmaWxsPSIjRkZGRkZGIiBkPSJNMTc2LjMsODUuOHYtMi43aC0wLjd2LTEuNGgwLjd2LTEuNGgxLjZ2MS40aDEuM3YxLjRoLTEuM3YyLjRjMCwwLjQsMC4yLDAuNSwwLjUsMC41DQoJCQljMC4zLDAsMC42LTAuMSwwLjgtMC4ydjEuM2MtMC4zLDAuMi0wLjcsMC4zLTEuMywwLjNDMTc3LDg3LjUsMTc2LjMsODcuMSwxNzYuMyw4NS44eiIvPg0KCTwvZz4NCjwvZz4NCjxyZWN0IHg9IjExLjIiIHk9IjE5LjkiIGZpbGw9IiM0NDU0NjQiIHdpZHRoPSI3OC41IiBoZWlnaHQ9Ijc2Ii8+DQo8Zz4NCgk8Zz4NCgkJPHBhdGggZmlsbD0iI0ZGRkZGRiIgZD0iTTU4LjksNDcuOEg0Ni42Yy0wLjQsMC0wLjgtMC40LTAuOC0wLjh2LTdjMC0wLjQsMC40LTAuOCwwLjgtMC44aDEyLjRjMC40LDAsMC44LDAuNCwwLjgsMC44djcNCgkJCUM1OS43LDQ3LjQsNTkuNCw0Ny44LDU4LjksNDcuOEw1OC45LDQ3Ljh6IE00Ny40LDQ2LjJoMTAuOHYtNS40SDQ3LjRWNDYuMkw0Ny40LDQ2LjJ6Ii8+DQoJPC9nPg0KCTxnPg0KCQk8Zz4NCgkJCTxwYXRoIGZpbGw9IiNGRkZGRkYiIGQ9Ik02NS43LDY5LjlIMzhjLTAuOSwwLTEuNi0wLjctMS42LTEuNlYzMy41YzAtMC45LDAuNy0xLjYsMS42LTEuNmgyNy43YzAuOSwwLDEuNiwwLjcsMS42LDEuNnYzNC44DQoJCQkJQzY3LjMsNjkuMiw2Ni42LDY5LjksNjUuNyw2OS45TDY1LjcsNjkuOXogTTM5LjYsNjYuN2gyNC40VjM1LjFIMzkuNlY2Ni43TDM5LjYsNjYuN3oiLz4NCgkJPC9nPg0KCQk8Zz4NCgkJCTxwYXRoIGZpbGw9IiNGRkZGRkYiIGQ9Ik00MC45LDQxLjZoLTUuNmMtMC45LDAtMS42LTAuNy0xLjYtMS42YzAtMC45LDAuNy0xLjYsMS42LTEuNmg1LjZjMC45LDAsMS42LDAuNywxLjYsMS42DQoJCQkJQzQyLjUsNDAuOSw0MS43LDQxLjYsNDAuOSw0MS42TDQwLjksNDEuNnoiLz4NCgkJPC9nPg0KCQk8Zz4NCgkJCTxwYXRoIGZpbGw9IiNGRkZGRkYiIGQ9Ik00MC45LDQ4LjhoLTUuNmMtMC45LDAtMS42LTAuNy0xLjYtMS42YzAtMC45LDAuNy0xLjYsMS42LTEuNmg1LjZjMC45LDAsMS42LDAuNywxLjYsMS42DQoJCQkJQzQyLjUsNDguMSw0MS43LDQ4LjgsNDAuOSw0OC44TDQwLjksNDguOHoiLz4NCgkJPC9nPg0KCQk8Zz4NCgkJCTxwYXRoIGZpbGw9IiNGRkZGRkYiIGQ9Ik00MC45LDU2aC01LjZjLTAuOSwwLTEuNi0wLjctMS42LTEuNnMwLjctMS42LDEuNi0xLjZoNS42YzAuOSwwLDEuNiwwLjcsMS42LDEuNlM0MS43LDU2LDQwLjksNTYNCgkJCQlMNDAuOSw1NnoiLz4NCgkJPC9nPg0KCQk8Zz4NCgkJCTxwYXRoIGZpbGw9IiNGRkZGRkYiIGQ9Ik00MC45LDYzLjJoLTUuNmMtMC45LDAtMS42LTAuNy0xLjYtMS42YzAtMC45LDAuNy0xLjYsMS42LTEuNmg1LjZjMC45LDAsMS42LDAuNywxLjYsMS42DQoJCQkJQzQyLjUsNjIuNSw0MS43LDYzLjIsNDAuOSw2My4yTDQwLjksNjMuMnoiLz4NCgkJPC9nPg0KCTwvZz4NCjwvZz4NCjxnPg0KCTxnPg0KCQk8cGF0aCBmaWxsPSIjRkZGRkZGIiBkPSJNMjcuNCw4MGgxLjdsMS41LDVsMS42LTVoMS40bDEuNiw1bDEuNS01aDEuN0wzNiw4Ny40aC0xLjRMMzMsODIuNmwtMS43LDQuOGgtMS40TDI3LjQsODB6Ii8+DQoJCTxwYXRoIGZpbGw9IiNGRkZGRkYiIGQ9Ik0zOS4yLDgxLjhoMS42djEuMWMwLjMtMC44LDAuOS0xLjMsMS44LTEuMnYxLjdoLTAuMWMtMS4xLDAtMS43LDAuNi0xLjcsMnYyLjFoLTEuNlY4MS44eiIvPg0KCQk8cGF0aCBmaWxsPSIjRkZGRkZGIiBkPSJNNDMsODUuOEw0Myw4NS44YzAtMS4yLDAuOS0xLjgsMi4zLTEuOGMwLjYsMCwxLDAuMSwxLjQsMC4ydi0wLjFjMC0wLjctMC40LTEtMS4yLTFjLTAuNiwwLTEsMC4xLTEuNiwwLjMNCgkJCWwtMC40LTEuMmMwLjYtMC4zLDEuMi0wLjUsMi4yLTAuNWMwLjksMCwxLjUsMC4yLDEuOSwwLjZjMC40LDAuNCwwLjYsMSwwLjYsMS44djMuM2gtMS41di0wLjZjLTAuNCwwLjQtMC45LDAuNy0xLjcsMC43DQoJCQlDNDMuOSw4Ny41LDQzLDg2LjksNDMsODUuOHogTTQ2LjcsODUuNHYtMC4zYy0wLjMtMC4xLTAuNi0wLjItMS0wLjJjLTAuNywwLTEuMSwwLjMtMS4xLDAuOHYwYzAsMC40LDAuNCwwLjcsMC45LDAuNw0KCQkJQzQ2LjIsODYuNCw0Ni43LDg2LDQ2LjcsODUuNHoiLz4NCgkJPHBhdGggZmlsbD0iI0ZGRkZGRiIgZD0iTTQ5LjYsODEuOGgxLjZ2MC44YzAuNC0wLjUsMC45LTAuOSwxLjgtMC45YzEuMywwLDIuNiwxLDIuNiwyLjl2MGMwLDEuOS0xLjIsMi45LTIuNiwyLjkNCgkJCWMtMC45LDAtMS40LTAuNC0xLjgtMC44djIuNGgtMS42VjgxLjh6IE01My45LDg0LjZMNTMuOSw4NC42YzAtMS0wLjYtMS42LTEuNC0xLjZzLTEuNCwwLjYtMS40LDEuNnYwYzAsMC45LDAuNiwxLjYsMS40LDEuNg0KCQkJUzUzLjksODUuNSw1My45LDg0LjZ6Ii8+DQoJCTxwYXRoIGZpbGw9IiNGRkZGRkYiIGQ9Ik01Ni42LDgxLjhoMS42djAuOGMwLjQtMC41LDAuOS0wLjksMS44LTAuOWMxLjMsMCwyLjYsMSwyLjYsMi45djBjMCwxLjktMS4yLDIuOS0yLjYsMi45DQoJCQljLTAuOSwwLTEuNC0wLjQtMS44LTAuOHYyLjRoLTEuNlY4MS44eiBNNjEsODQuNkw2MSw4NC42YzAtMS0wLjYtMS42LTEuNC0xLjZzLTEuNCwwLjYtMS40LDEuNnYwYzAsMC45LDAuNiwxLjYsMS40LDEuNg0KCQkJUzYxLDg1LjUsNjEsODQuNnoiLz4NCgkJPHBhdGggZmlsbD0iI0ZGRkZGRiIgZD0iTTYzLjUsODQuNkw2My41LDg0LjZjMC0xLjYsMS4xLTIuOSwyLjgtMi45YzEuOSwwLDIuNywxLjUsMi43LDMuMWMwLDAuMSwwLDAuMywwLDAuNEg2NQ0KCQkJYzAuMiwwLjcsMC43LDEuMSwxLjQsMS4xYzAuNSwwLDAuOS0wLjIsMS40LTAuNmwwLjksMC44Yy0wLjUsMC43LTEuMywxLTIuMywxQzY0LjcsODcuNSw2My41LDg2LjMsNjMuNSw4NC42eiBNNjcuNCw4NC4xDQoJCQljLTAuMS0wLjctMC41LTEuMi0xLjItMS4yYy0wLjcsMC0xLjEsMC41LTEuMiwxLjJINjcuNHoiLz4NCgkJPHBhdGggZmlsbD0iI0ZGRkZGRiIgZD0iTTcwLjIsODEuOGgxLjZ2MS4xYzAuMy0wLjgsMC45LTEuMywxLjgtMS4ydjEuN2gtMC4xYy0xLjEsMC0xLjcsMC42LTEuNywydjIuMWgtMS42VjgxLjh6Ii8+DQoJPC9nPg0KPC9nPg0KPC9zdmc+DQo=" alt="Diagram showing a wrapper cookbook containing a private Supermarket." width="500"> </figure> <p>In the case of installing a private Chef Supermarket, Chef recommends the use of a wrapper cookbook to specify certain attributes that are unique to your organization, while enabling the use of the generic installer cookbook which, in turn, installs the Chef Supermarket package behind your firewall.</p> <p>All of the keys under <code>node['supermarket_omnibus']</code> are written out as <code>/etc/supermarket/supermarket.json</code>. Add other keys as needed to override the default attributes specified in the Chef Supermarket <a href="https://github.com/chef/supermarket/blob/main/omnibus/cookbooks/omnibus-supermarket/attributes/default.rb">omnibus package</a>.</p> <p>For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">default<span style="color:#666">[</span><span style="color:#4070a0">'supermarket_omnibus'</span><span style="color:#666">][</span><span style="color:#4070a0">'chef_server_url'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#4070a0">'https://chefserver.mycompany.com:443'</span>
default<span style="color:#666">[</span><span style="color:#4070a0">'supermarket_omnibus'</span><span style="color:#666">][</span><span style="color:#4070a0">'chef_oauth2_app_id'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#4070a0">'14dfcf186221781cff51eedd5ac1616'</span>
default<span style="color:#666">[</span><span style="color:#4070a0">'supermarket_omnibus'</span><span style="color:#666">][</span><span style="color:#4070a0">'chef_oauth2_secret'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#4070a0">'a49402219627cfa6318d58b13e90aca'</span>
default<span style="color:#666">[</span><span style="color:#4070a0">'supermarket_omnibus'</span><span style="color:#666">][</span><span style="color:#4070a0">'chef_oauth2_verify_ssl'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#007020">false</span>
default<span style="color:#666">[</span><span style="color:#4070a0">'supermarket_omnibus'</span><span style="color:#666">][</span><span style="color:#4070a0">'fqdn'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#4070a0">'supermarket.mycompany.com'</span>
</code></pre></div>
<p>On your workstation, generate a new cookbook using the <code>chef</code> command line interface:</p> <ol> <li> <p>Generate the cookbook:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef generate cookbook my_supermarket_wrapper
</code></pre></div>
</li> <li> <p>Change directories into that cookbook:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash"><span style="color:#007020">cd</span> my_supermarket_wrapper
</code></pre></div>
</li> <li> <p>Defines the wrapper cookbook’s dependency on the <code>supermarket-omnibus-cookbook</code> cookbook. Open the metadata.rb file of the newly-created cookbook, and then add the following line:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">depends <span style="color:#4070a0">'supermarket-omnibus-cookbook'</span>
</code></pre></div>
</li> <li> <p>Save and close the metadata.rb file.</p> </li> <li> <p>Open the <code>/recipes/default.rb</code> recipe located within the newly-generated cookbook and add the following content:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">include_recipe <span style="color:#4070a0">'supermarket-omnibus-cookbook'</span>
</code></pre></div>
<p>This ensures that the <code>default.rb</code> file in the <code>supermarket-omnibus-cookbook</code> is run.</p> </li> </ol> <h3 id="define-attributes">Define Attributes</h3> <p>Define the attributes for the Chef Supermarket installation and how it connects to the Chef Infra Server. One approach would be to hard-code attributes in the wrapper cookbook’s <code>default.rb</code> recipe. A better approach is to place these attributes in a data bag, and then reference them from the recipe. For example, the data bag could be named <code>apps</code> and then a data bag item within the data bag could be named <code>supermarket</code>.</p> <p>The following attribute values must be defined:</p> <ul> <li><code>chef_server_url</code></li> <li><code>chef_oauth2_app_id</code></li> <li><code>chef_oauth2_secret</code></li> </ul> <p>Once configured, you can get the <code>chef_oauth2_app_id</code> and <code>chef_oauth2_secret</code> values from your Chef Infra Server within <code>/etc/opscode/oc-id-applications/supermarket.json</code>:</p> <p>For <code>chef_server_url</code>, enter in the URL of your chef server. For <code>chef_oauth2_app_id</code>, enter in the uid from <code>/etc/opscode/oc-id-applications/supermarket.json</code> For <code>chef_oauth2_secret</code>, enter in the secret from <code>/etc/opscode/oc-id-applications/supermarket.json</code></p> <p>To define these attributes, do the following:</p> <ol> <li> <p>Open the <code>/recipes/default.rb</code> file and add the following, <strong>BEFORE</strong> the <code>include_recipe</code> line that was added in the previous step. This example uses a data bag named <code>apps</code> and a data bag item named <code>supermarket</code>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">app <span style="color:#666">=</span> data_bag_item(<span style="color:#4070a0">'apps'</span>, <span style="color:#4070a0">'supermarket'</span>)
</code></pre></div>
</li> <li> <p>Set the attributes from the data bag:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">node<span style="color:#666">.</span>override<span style="color:#666">[</span><span style="color:#4070a0">'supermarket_omnibus'</span><span style="color:#666">][</span><span style="color:#4070a0">'chef_server_url'</span><span style="color:#666">]</span> <span style="color:#666">=</span> app<span style="color:#666">[</span><span style="color:#4070a0">'chef_server_url'</span><span style="color:#666">]</span>
node<span style="color:#666">.</span>override<span style="color:#666">[</span><span style="color:#4070a0">'supermarket_omnibus'</span><span style="color:#666">][</span><span style="color:#4070a0">'chef_oauth2_app_id'</span><span style="color:#666">]</span> <span style="color:#666">=</span> app<span style="color:#666">[</span><span style="color:#4070a0">'chef_oauth2_app_id'</span><span style="color:#666">]</span>
node<span style="color:#666">.</span>override<span style="color:#666">[</span><span style="color:#4070a0">'supermarket_omnibus'</span><span style="color:#666">][</span><span style="color:#4070a0">'chef_oauth2_secret'</span><span style="color:#666">]</span> <span style="color:#666">=</span> app<span style="color:#666">[</span><span style="color:#4070a0">'chef_oauth2_secret'</span><span style="color:#666">]</span>
</code></pre></div>
<p>When finished, the <code>/recipes/default.rb</code> file should have code similar to:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">app <span style="color:#666">=</span> data_bag_item(<span style="color:#4070a0">'apps'</span>, <span style="color:#4070a0">'supermarket'</span>)

node<span style="color:#666">.</span>override<span style="color:#666">[</span><span style="color:#4070a0">'supermarket_omnibus'</span><span style="color:#666">][</span><span style="color:#4070a0">'chef_server_url'</span><span style="color:#666">]</span> <span style="color:#666">=</span> app<span style="color:#666">[</span><span style="color:#4070a0">'chef_server_url'</span><span style="color:#666">]</span>
node<span style="color:#666">.</span>override<span style="color:#666">[</span><span style="color:#4070a0">'supermarket_omnibus'</span><span style="color:#666">][</span><span style="color:#4070a0">'chef_oauth2_app_id'</span><span style="color:#666">]</span> <span style="color:#666">=</span> app<span style="color:#666">[</span><span style="color:#4070a0">'chef_oauth2_app_id'</span><span style="color:#666">]</span>
node<span style="color:#666">.</span>override<span style="color:#666">[</span><span style="color:#4070a0">'supermarket_omnibus'</span><span style="color:#666">][</span><span style="color:#4070a0">'chef_oauth2_secret'</span><span style="color:#666">]</span> <span style="color:#666">=</span> app<span style="color:#666">[</span><span style="color:#4070a0">'chef_oauth2_secret'</span><span style="color:#666">]</span>

include_recipe <span style="color:#4070a0">'supermarket-omnibus-cookbook'</span>
</code></pre></div>
</li> <li> <p>Save and close the <code>/recipes/default.rb</code> file.</p> </li> </ol> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>If you are running your private Supermarket in AWS, you may need to set an additional attribute for the node’s public IP address:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">node<span style="color:#666">.</span>override<span style="color:#666">[</span><span style="color:#4070a0">'supermarket_omnibus'</span><span style="color:#666">][</span><span style="color:#4070a0">'config'</span><span style="color:#666">][</span><span style="color:#4070a0">'fqdn'</span><span style="color:#666">]</span> <span style="color:#666">=</span> your_node_public_ip
</code></pre></div> </div> </div> <h3 id="upload-the-wrapper">Upload the Wrapper</h3> <p>The wrapper cookbook around the <code>supermarket-omnibus-cookbook</code> cookbook must be uploaded to the Chef Infra Server, along with any cookbooks against which the <code>supermarket-omnibus-cookbook</code> cookbook has dependencies.</p> <p>To upload the cookbooks necessary to install Chef Supermarket, do the following:</p> <ol> <li> <p>Install Berkshelf:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">berks install
</code></pre></div>
</li> <li> <p>Change directories into <code>~/.berkshelf/cookbooks</code>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash"><span style="color:#007020">cd</span> ~/.berkshelf/cookbooks
</code></pre></div>
</li> <li> <p>Upload all cookbooks to the Chef Infra Server:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">knife cookbook upload -a
</code></pre></div>
</li> <li> <p>Change directories into the location in which the wrapper cookbook was created:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash"><span style="color:#007020">cd</span> path/to/wrapper/cookbook/
</code></pre></div>
</li> <li> <p>Upload the wrapper cookbook to the Chef Infra Server:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">knife cookbook upload -a
</code></pre></div>
</li> </ol> <h3 id="bootstrap-supermarket">Bootstrap Supermarket</h3> <p>Bootstrap the node on which Chef Supermarket is to be installed. For example, to bootstrap a node running Ubuntu on Amazon Web Services (AWS), the command is similar to:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">knife bootstrap ip_address -N supermarket-node -x ubuntu --sudo
</code></pre></div>
<p>where</p> <ul> <li>
<code>-N</code> defines the name of the Chef Supermarket node: <code>supermarket-node</code>
</li> <li>
<code>-x</code> defines the (ssh) user name: <code>ubuntu</code>
</li> <li>
<code>--sudo</code> ensures that sudo is used while running commands on the node during the bootstrap operation</li> </ul> <p>When the bootstrap operation is finished, do the following:</p> <ol> <li> <p>Edit the node to add the wrapper cookbook’s <code>/recipes/default.rb</code> recipe to the run-list:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">knife node edit supermarket-node
</code></pre></div>
<p>where <code>supermarket-node</code> is the name of the node that was just bootstrapped.</p> </li> <li> <p>Add the recipe to the run-list:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#4070a0">"run_list"</span>: <span style="color:#666">[</span>
  <span style="color:#4070a0">"recipe[my_supermarket_wrapper::default]"</span>
<span style="color:#666">]</span>
</code></pre></div>
</li> <li> <p>Start Chef Infra Client on the newly-bootstrapped Chef Supermarket node. For example, using SSH:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">ssh ubuntu@your-supermarket-node-public-dns
</code></pre></div>
</li> <li> <p>After accessing the Chef Supermarket node, run Chef Infra Client:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">sudo chef-client
</code></pre></div>
</li> </ol> <h2 id="install-supermarket-directly-without-a-cookbook">Install Supermarket Directly (without a cookbook)</h2> <p>While there are many benefits to using the cookbook method to install Supermarket, there are also cases where it’s simpler to set up the Supermarket installation manually. These steps will walk you through the process of manually configuring your private Supermarket server.</p> <p>Before following these steps, be sure to complete the OAuth setup process detailed in the <a href="index.html#chef-identity">Chef Identity</a> section of this guide.</p> <ol> <li> <p><a href="https://www.chef.io/downloads/tools/supermarket">Download</a> the correct package for your operating system from <code>chef.io/downloads</code>.</p> </li> <li> <p>Install Supermarket using the appropriate package manager for your distribution:</p> <ul> <li> <p>For Ubuntu:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">dpkg -i /path/to/package/supermarket*.deb
</code></pre></div>
</li> <li> <p>For RHEL / CentOS:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">rpm -Uvh /path/to/package/supermarket*.rpm
</code></pre></div>
</li> </ul> </li> <li> <p>Run the <code>reconfigure</code> command to complete the initial installation:</p> <pre tabindex="0" class="highlight" data-language="ruby"><code class="language-none" data-lang="none">sudo supermarket-ctl reconfigure
</code></pre>
</li> <li> <p>Create an <code>/etc/supermarket/supermarket.json</code> file and add the following information, substituting the values for each configuration option with the OAuth 2.0 client credentials that were created in the <a href="index.html#chef-identity">previous section</a>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">{
    <span style="color:#4070a0">"chef_server_url"</span>: <span style="color:#4070a0">"https://chefserver.mycompany.com"</span>,
    <span style="color:#4070a0">"chef_oauth2_app_id"</span>: <span style="color:#4070a0">"0bad0f2eb04e935718e081fb71asdfec3681c81acb9968a8e1e32451d08b"</span>,
    <span style="color:#4070a0">"chef_oauth2_secret"</span>: <span style="color:#4070a0">"17cf1141cc971a10ce307611beda7ffadstr4f1bc98d9f9ca76b9b127879"</span>,
    <span style="color:#4070a0">"fqdn"</span>: <span style="color:#4070a0">"supermarket.mycompany.com"</span>,
    <span style="color:#4070a0">"chef_oauth2_verify_ssl"</span>: <span style="color:#007020">false</span>
}
</code></pre></div>
<p>Where:</p> <ul> <li>
<code>"chef_server_url"</code> should contain the FQDN of your Chef Infra Server. Note that if you’re using a non-standard SSL port, this much be appended to the URL. For example: <code>https://chefserver.mycompany.com:65400</code>
</li> <li>
<code>"chef_oauth2_app_id"</code> should contain the <code>"uid"</code> value from your OAuth credentials</li> <li>
<code>"chef_oauth2_secret"</code> should contain the <code>"secret"</code> value from your OAuth credentials</li> <li>
<code>chef_oauth2_verify_ssl</code> is set to false, which is necessary when using a self-signed certificate without a properly configured certificate authority</li> <li>
<code>fqdn</code> should contain the desired URL that will be used to access your private Supermarket. If not specified, this default to the FQDN of the machine</li> </ul> </li> <li> <p>Issue another <code>reconfigure</code> command to apply your changes:</p> <pre tabindex="0" class="highlight" data-language="ruby"><code class="language-none" data-lang="none">sudo supermarket-ctl reconfigure
</code></pre>
</li> </ol> <h2 id="connect-to-supermarket">Connect to Supermarket</h2> <p>To reach the newly spun up private Chef Supermarket, the hostname must be resolvable from a workstation. For production use, the hostname should have a DNS entry in an appropriate domain that is trusted by each user’s workstation.</p> <ol> <li>Visit the Chef Supermarket hostname in the browser. A private Chef Supermarket will generate and use a self-signed certificate, if a certificate is not supplied as part of the installation process (via the wrapper cookbook).</li> <li>If an SSL notice is shown while connecting to Chef Supermarket via a web browser, accept the SSL certificate. A trusted SSL certificate should be used for private Chef Supermarket that is used in production.</li> <li>After opening Chef Supermarket in a web browser, click the <strong>Create Account</strong> link. A prompt to log in to the Chef Infra Server is shown, but only if the user is not already logged in. Authorize the Chef Supermarket to use the Chef Infra Server account for authentication.</li> </ol> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> The redirect URL specified for Chef Identity <strong>MUST</strong> match the fqdn hostname of the Chef Supermarket server. The URI must also be correct: <code>/auth/chef_oauth2/callback</code>. Otherwise, an error message similar to <code>The redirect uri included is not valid.</code> will be shown. </div> </div> <h2 id="customize-supermarket">Customize Supermarket</h2> <p>Chef Supermarket is a Ruby on Rails application with a PostgreSQL database. The private Chef Supermarket configuration may be scaled-out, such as using an external database, using an external cache, and using an external cookbook storage location.</p> <h3 id="external-database">External Database</h3> <p>A Chef Supermarket installation can use an external database running PostgreSQL (9.3 or higher) and with the <code>pgpsql</code> and <code>pg_trgm</code> installed and loaded. The public Chef Supermarket uses Amazon Relational Database Service (RDS). To use an external database, configure the following attributes in the <code>/recipes/default.rb</code> recipe of the wrapper cookbook:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">node<span style="color:#666">.</span>override<span style="color:#666">[</span><span style="color:#4070a0">'supermarket_omnibus'</span><span style="color:#666">][</span><span style="color:#4070a0">'config'</span><span style="color:#666">][</span><span style="color:#4070a0">'postgresql'</span><span style="color:#666">][</span><span style="color:#4070a0">'enable'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#007020">false</span>
node<span style="color:#666">.</span>override<span style="color:#666">[</span><span style="color:#4070a0">'supermarket_omnibus'</span><span style="color:#666">][</span><span style="color:#4070a0">'config'</span><span style="color:#666">][</span><span style="color:#4070a0">'database'</span><span style="color:#666">][</span><span style="color:#4070a0">'user'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#4070a0">'supermarket'</span>
node<span style="color:#666">.</span>override<span style="color:#666">[</span><span style="color:#4070a0">'supermarket_omnibus'</span><span style="color:#666">][</span><span style="color:#4070a0">'config'</span><span style="color:#666">][</span><span style="color:#4070a0">'database'</span><span style="color:#666">][</span><span style="color:#4070a0">'name'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#4070a0">'supermarket'</span>
node<span style="color:#666">.</span>override<span style="color:#666">[</span><span style="color:#4070a0">'supermarket_omnibus'</span><span style="color:#666">][</span><span style="color:#4070a0">'config'</span><span style="color:#666">][</span><span style="color:#4070a0">'database'</span><span style="color:#666">][</span><span style="color:#4070a0">'host'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#4070a0">'yourcompany...rds.amazon.com'</span>
node<span style="color:#666">.</span>override<span style="color:#666">[</span><span style="color:#4070a0">'supermarket_omnibus'</span><span style="color:#666">][</span><span style="color:#4070a0">'config'</span><span style="color:#666">][</span><span style="color:#4070a0">'database'</span><span style="color:#666">][</span><span style="color:#4070a0">'port'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#4070a0">'5432'</span>
node<span style="color:#666">.</span>override<span style="color:#666">[</span><span style="color:#4070a0">'supermarket_omnibus'</span><span style="color:#666">][</span><span style="color:#4070a0">'config'</span><span style="color:#666">][</span><span style="color:#4070a0">'database'</span><span style="color:#666">][</span><span style="color:#4070a0">'pool'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#4070a0">'25'</span>
node<span style="color:#666">.</span>override<span style="color:#666">[</span><span style="color:#4070a0">'supermarket_omnibus'</span><span style="color:#666">][</span><span style="color:#4070a0">'config'</span><span style="color:#666">][</span><span style="color:#4070a0">'database'</span><span style="color:#666">][</span><span style="color:#4070a0">'password'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#4070a0">'topsecretneverguessit'</span>
</code></pre></div>
<h3 id="external-cache">External Cache</h3> <p>Chef Supermarket installations can also use an external cache store. The public Chef Supermarket uses Redis on Amazon ElastiCache. One Redis instance per private Chef Supermarket application server may be run safely. Use Redis 2.8 (or higher) for a high availability pair. To use an external cache, configure the following attributes in the <code>/recipes/default.rb</code> recipe of the wrapper cookbook:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">node<span style="color:#666">.</span>override<span style="color:#666">[</span><span style="color:#4070a0">'supermarket_omnibus'</span><span style="color:#666">][</span><span style="color:#4070a0">'config'</span><span style="color:#666">][</span><span style="color:#4070a0">'redis'</span><span style="color:#666">][</span><span style="color:#4070a0">'enable'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#007020">false</span>
node<span style="color:#666">.</span>override<span style="color:#666">[</span><span style="color:#4070a0">'supermarket_omnibus'</span><span style="color:#666">][</span><span style="color:#4070a0">'config'</span><span style="color:#666">][</span><span style="color:#4070a0">'redis_url'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#4070a0">'redis://your-redis-instance:6379'</span>
</code></pre></div>
<h3 id="external-cookbook-storage">External Cookbook Storage</h3> <p>Cookbook artifacts—tar.gz artifacts that are uploaded to Chef Supermarket when sharing a cookbook—can be stored either on the local filesystem of the Chef Supermarket node (<code>/var/opt/supermarket/data</code> by default) or in an Amazon Simple Storage Service (S3) bucket. To use an S3 bucket, configure the following attributes in the <code>/recipes/default.rb</code> recipe of the wrapper cookbook:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">node<span style="color:#666">.</span>override<span style="color:#666">[</span><span style="color:#4070a0">'supermarket_omnibus'</span><span style="color:#666">][</span><span style="color:#4070a0">'config'</span><span style="color:#666">][</span><span style="color:#4070a0">'s3_access_key_id'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#4070a0">'yourkeyid'</span>
node<span style="color:#666">.</span>override<span style="color:#666">[</span><span style="color:#4070a0">'supermarket_omnibus'</span><span style="color:#666">][</span><span style="color:#4070a0">'config'</span><span style="color:#666">][</span><span style="color:#4070a0">'s3_bucket'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#4070a0">'all-our-awesome-cookbooks'</span>
node<span style="color:#666">.</span>override<span style="color:#666">[</span><span style="color:#4070a0">'supermarket_omnibus'</span><span style="color:#666">][</span><span style="color:#4070a0">'config'</span><span style="color:#666">][</span><span style="color:#4070a0">'s3_region'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#4070a0">'some-place-3'</span>
node<span style="color:#666">.</span>override<span style="color:#666">[</span><span style="color:#4070a0">'supermarket_omnibus'</span><span style="color:#666">][</span><span style="color:#4070a0">'config'</span><span style="color:#666">][</span><span style="color:#4070a0">'s3_secret_access_key'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#4070a0">'yoursecretaccesskey'</span>
</code></pre></div>
<div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> Encrypted S3 buckets are currently not supported. </div> </div> <h2 id="upgrade-a-private-supermarket">Upgrade a Private Supermarket</h2> <ol> <li> <p>Shut down the server running Private Supermarket.</p> </li> <li> <p>Backup the <code>/var/opt/supermarket</code> directory.</p> </li> <li> <p>Download the <a href="https://www.chef.io/downloads/tools/supermarket">Chef Supermarket</a> package.</p> </li> <li> <p>Upgrade your system with the new package using the appropriate package manager for your distribution:</p> <ul> <li> <p>For Ubuntu:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">dpkg -i /path/to/package/supermarket*.deb
</code></pre></div>
</li> <li> <p>For RHEL / CentOS:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">rpm -Uvh /path/to/package/supermarket*.rpm
</code></pre></div>
</li> </ul> </li> <li> <p><a href="../ctl_supermarket/index.html#reconfigure">Reconfigure</a> the server that Chef Supermarket is installed on:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">sudo supermarket-ctl reconfigure
</code></pre></div>
</li> </ol> <p>Private Supermarket is updated on your server now. We recommend restarting the services that run Chef Supermarket to ensure that the old installation of Chef Supermarket doesn’t persist in the server memory.</p> <ol> <li> <p>Get the name of the active unit:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">systemctl list-units | grep runsvdir
</code></pre></div>
</li> <li> <p>Restart the unit:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">systemctl restart UNIT_NAME
</code></pre></div>
<p>This will restart the <code>runsvdir</code>, <code>runsv</code>, and <code>svlogd</code> service processes that run Chef Supermarket.</p> </li> </ol> </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; Chef Software, Inc.<br>Licensed under the Creative Commons Attribution 3.0 Unported License.<br>The Chef&trade; Mark and Chef Logo are either registered trademarks/service marks or trademarks/servicemarks of Chef, in the United States and other countries and are used with Chef Inc's permission.<br>We are not affiliated with, endorsed or sponsored by Chef Inc.<br>
    <a href="https://docs.chef.io/install_supermarket/" class="_attribution-link">https://docs.chef.io/install_supermarket/</a>
  </p>
</div>
