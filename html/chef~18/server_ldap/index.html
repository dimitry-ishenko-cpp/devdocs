<div id="col-content" data-swiftype-index="true"> <div id="active-directory-and-ldap"><h1>Active Directory and LDAP</h1></div>  <div class="prose"> <p data-swiftype-index="false"> <a href="https://github.com/chef/chef-web-docs/blob/main/content/server_ldap.md" alt="Link to page on GitHub repository">[edit on GitHub]</a> </p> <p>The Chef Infra Server supports Active Directory and LDAP authentication, which enables users to log in to the Chef Infra Server using their corporate credential and the Manage interface. Without the Manage interface add-on installed, there is no need to enable the Chef Infra Server LDAP functionality. LDAP is not used with Supermarket logins, nor with any Chef Infra Client related authentication.</p> <h2 id="configure-ldap">Configure LDAP</h2> <p>The Chef Infra Server supports using Active Directory or LDAP for any user that has an email address in the LDAP directory. This allows those users to log in to the Chef Infra Server by using their corporate credentials instead of having a separate username and password.</p> <div class="admonition-warning"> <p class="admonition-warning-title">Warning</p> <div class="admonition-warning-text"> <p>The following attributes <strong>MUST</strong> be in the user LDAP record:</p> <ul> <li><code>mail:</code></li> <li>
<code>sAMAccountName:</code> or <code>uid:</code>
</li> </ul> <p>The following attributes <strong>SHOULD</strong> be in the user LDAP record:</p> <ul> <li><code>displayname:</code></li> <li><code>givenname:</code></li> <li><code>sn:</code></li> <li><code>c:</code></li> <li><code>l:</code></li> </ul> </div> </div> <p>To configure the Chef Infra Server to use Active Directory or LDAP do the following:</p> <ol> <li> <p>Install the Chef management console (if it is not already).</p> </li> <li> <p>Add the following settings to the <code>/etc/opscode/chef-server.rb</code> file. These settings must be added to the <code>chef-server.rb</code> file on each machine in the Chef Infra Server frontend deployment of a High Availability installation as well as on Chef servers in a standalone installation.</p> <div class="admonition-warning"> <p class="admonition-warning-title">Warning</p> <div class="admonition-warning-text"> <p>The following settings <strong>MUST</strong> be in the config file for LDAP authentication to Active Directory to work:</p> <ul> <li><code>base_dn</code></li> <li><code>bind_dn</code></li> <li><code>group_dn</code></li> <li><code>host</code></li> </ul> <p>If those settings are missing, you will get authentication errors and be unable to proceed.</p> </div> </div> <p>This configuration file has the following settings for <code>ldap</code>:</p> <dl> <dt><code>ldap['base_dn']</code></dt> <dd> <p>The root LDAP node under which all other nodes exist in the directory structure. For Active Directory, this is typically <code>cn=users</code> and then the domain. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#4070a0">'OU=Employees,OU=Domain users,DC=example,DC=com'</span>
</code></pre></div>
<p>Default value: <code>nil</code>.</p> </dd> <dt><code>ldap['bind_dn']</code></dt> <dd> <p>The distinguished name used to bind to the LDAP server. The user the Chef Infra Server will use to perform LDAP searches. This is often the administrator or manager user. This user needs to have read access to all LDAP users that require authentication. The Chef Infra Server must do an LDAP search before any user can log in. Many Active Directory and LDAP systems do not allow an anonymous bind. If anonymous bind is allowed, leave the <code>bind_dn</code> and <code>bind_password</code> settings blank. If anonymous bind is not allowed, a user with <code>READ</code> access to the directory is required. This user must be specified as an LDAP distinguished name similar to:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#4070a0">'CN=user,OU=Employees,OU=Domainuser,DC=example,DC=com'</span>
</code></pre></div>
<div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>If you need to escape characters in a distinguished name, such as when using Active Directory, they must be <a href="https://social.technet.microsoft.com/wiki/contents/articles/5312.active-directory-characters-to-escape.aspx">escaped with a backslash escape character</a>.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#4070a0">'CN=example\\user,OU=Employees,OU=Domainuser,DC=example,DC=com'</span>
</code></pre></div>
</div> </div> <p>Default value: <code>nil</code>.</p> </dd> <dt><code>ldap['bind_password']</code></dt> <dd> <p>Legacy configuration for the password of the binding user. The password for the user specified by <code>ldap['bind_dn']</code>. Leave this value and <code>ldap['bind_dn']</code> unset if anonymous bind is sufficient. Default value: <code>nil</code>. As of Chef Server 12.14, this is no longer the preferred command.</p> <p>Please use <code>chef-server-ctl set-secret ldap bind_password</code> from the <a href="../ctl_chef_server.html#ctl-chef-server-secrets-management">Secrets Management</a> commands.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-server-ctl set-secret ldap bind_password
Enter ldap bind_password:    <span style="color:#666">(</span>no terminal output<span style="color:#666">)</span>
Re-enter ldap bind_password: <span style="color:#666">(</span>no terminal output<span style="color:#666">)</span>
</code></pre></div>
<p>Remove a set password via</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-server-ctl remove-secret ldap bind_password
</code></pre></div>
</dd> <dt><code>ldap['group_dn']</code></dt> <dd> <p>The distinguished name for a group. When set to the distinguished name of a group, only members of that group can log in. This feature filters based on the <code>memberOf</code> attribute and only works with LDAP servers that provide such an attribute. In OpenLDAP, the <code>memberOf</code> overlay provides this attribute. For example, if the value of the <code>memberOf</code> attribute is <code>CN=abcxyz,OU=users,DC=company,DC=com</code>, then use:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">ldap<span style="color:#666">[</span><span style="color:#4070a0">'group_dn'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#4070a0">'CN=abcxyz,OU=users,DC=company,DC=com'</span>
</code></pre></div>
</dd> <dt><code>ldap['host']</code></dt> <dd> <p>The name (or IP address) of the LDAP server. The hostname of the LDAP or Active Directory server. Be sure the Chef Infra Server is able to resolve any host names. Default value: <code>ldap-server-host</code>.</p> </dd> <dt><code>ldap['login_attribute']</code></dt> <dd> <p>The LDAP attribute that holds the user’s login name. Use to specify the Chef Infra Server user name for an LDAP user. Default value: <code>sAMAccountName</code>.</p> </dd> <dt><code>ldap['port']</code></dt> <dd> <p>An integer that specifies the port on which the LDAP server listens. The default value is an appropriate value for most configurations. Default value: <code>389</code> or <code>636</code> when <code>ldap['encryption']</code> is set to <code>:simple_tls</code>.</p> </dd> <dt><code>ldap['ssl_enabled']</code></dt> <dd> <p>Cause the Chef Infra Server to connect to the LDAP server using SSL. Default value: <code>false</code>. Must be <code>false</code> when <code>ldap['tls_enabled']</code> is <code>true</code>.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>It’s recommended that you enable SSL for Active Directory.</p> </div> </div> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>Previous versions of the Chef Infra Server used the <code>ldap['ssl_enabled']</code> setting to first enable SSL, and then the <code>ldap['encryption']</code> setting to specify the encryption type. These settings are deprecated.</p> </div> </div> </dd> <dt><code>ldap['system_adjective']</code></dt> <dd> <p>A descriptive name for the login system that is displayed to users in the Chef Infra Server management console. If a value like “corporate” is used, then the Chef management console user interface will display strings like “the corporate login server”, “corporate login”, or “corporate password.” Default value: <code>AD/LDAP</code>.</p> <div class="admonition-warning"> <p class="admonition-warning-title">Warning</p> <div class="admonition-warning-text"> <p>This setting is <strong>not</strong> used by the Chef Infra Server. It is used only by the Chef management console.</p> </div> </div> </dd> <dt><code>ldap['timeout']</code></dt> <dd> <p>The amount of time (in seconds) to wait before timing out. Default value: <code>60000</code>.</p> </dd> <dt><code>ldap['tls_enabled']</code></dt> <dd> <p>Enable TLS. When enabled, communication with the LDAP server is done via a secure SSL connection on a dedicated port. When <code>true</code>, <code>ldap['port']</code> is also set to <code>636</code>. Default value: <code>false</code>. Must be <code>false</code> when <code>ldap['ssl_enabled']</code> is <code>true</code>.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>Previous versions of the Chef Infra Server used the <code>ldap['ssl_enabled']</code> setting to first enable SSL, and then the <code>ldap['encryption']</code> setting to specify the encryption type. These settings are deprecated.</p> </div> </div> </dd> </dl> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> If the chef-server.rb file does not exist, create a file called <code>chef-server.rb</code> and put it in the <code>/etc/opscode/</code> directory. </div> </div> </li> <li> <p>Reconfigure the Chef Infra Server and the Chef management console (standalone and frontend group members of a High Availabilty installation):</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-server-ctl reconfigure
</code></pre></div> </li> </ol> <p>At this point, all users should be able to use their Active Directory or LDAP usernames and passwords to log in to the Chef Infra Server.</p> <h2 id="test-ldap-connectivity">Test LDAP Connectivity</h2> <p>Use <code>ldapsearch</code> to test the ability of the Chef Infra Server to use Active Directory or LDAP. First, translate the Chef Infra Server LDAP settings into <code>ldapsearch</code> parameters:</p> <table> <col style="width:50%"> <col style="width:50%"> <thead> <tr class="header"> <th>Chef Infra Server Setting</th> <th>
<code>ldapsearch</code> Parameter</th> </tr> </thead> <tbody> <tr> <td>
<code>ldap['host']</code> and <code>ldap['port']</code>
</td> <td><code>-H [HOST:PORT]</code></td> </tr> <tr> <td><code>ldap['bind_dn']</code></td> <td><code>-D [BIND_DN]</code></td> </tr> <tr> <td><code>ldap['bind_password']</code></td> <td>
<code>-W</code>; <code>ldapsearch</code> will prompt for this parameter</td> </tr> <tr> <td><code>ldap['base_dn']</code></td> <td><code>-b [BASE_DN]</code></td> </tr> <tr> <td><code>ldap['login_attribute']</code></td> <td>Defaults to <code>SAMAccountName</code>
</td> </tr> </tbody> </table> <p>And then from a front end machine (in a high availability or tiered configuration) or from the Chef Infra Server in a standalone configuration, run the following command. Be sure to replace the uppercase placeholders with the values for your organization:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">ldapsearch -LLL -H ldap://HOST:PORT -b <span style="color:#4070a0">'BASE_DN'</span> -D <span style="color:#4070a0">'BIND_DN'</span> -W <span style="color:#4070a0">'(LOGIN_ATTRIBUTE=YOUR_LDAP_ACCOUNT_USERNAME)'</span>
</code></pre></div>
<p>For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">ldapsearch -LLL -H ldap://win-ad1.chef.co:389 -b <span style="color:#4070a0">'OU=Employees,OU=Domain users,DC=opscodecorp,DC=com'</span> -D <span style="color:#4070a0">'CN=Robert Forster,OU=Employees,OU=Domain users,DC=opscodecorp,DC=com'</span> -W <span style="color:#4070a0">'(sAMAccountName=rforster)'</span>
</code></pre></div>
<p>Output similar to the following is returned:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">ldapsearch -LLL -H ldap://win-ad1.chef.co:389 -b <span style="color:#4070a0">'OU=Employees,OU=Domain users,DC=opscodecorp,DC=com'</span> -D <span style="color:#4070a0">'CN=Robert Forster,OU=Employees,OU=Domain users,DC=opscodecorp,DC=com'</span> -W <span style="color:#4070a0">'(sAMAccountName=rforster)'</span>
Enter LDAP Password:

dn: <span style="color:#bb60d5">CN</span><span style="color:#666">=</span>Robert Forster,OU<span style="color:#666">=</span>Employees,OU<span style="color:#666">=</span>Domain users,DC<span style="color:#666">=</span>opscodecorp,DC<span style="color:#666">=</span>com
objectClass: top
objectClass: person
objectClass: organizationalPerson
objectClass: user
cn: Robert Forster
sn: Forster
c: <span style="color:#40a070">0</span>
givenName: Robert
distinguishedName: <span style="color:#bb60d5">CN</span><span style="color:#666">=</span>Robert Forster,OU<span style="color:#666">=</span>Employees,OU<span style="color:#666">=</span>Domain users,DC<span style="color:#666">=</span>opscodecorp,DC
 <span style="color:#666">=</span>com
</code></pre></div>
<div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> The <code>ldapsearch</code> command may need to be installed on the platform. It is not included as part of the Chef Infra Server package. </div> </div> </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; Chef Software, Inc.<br>Licensed under the Creative Commons Attribution 3.0 Unported License.<br>The Chef&trade; Mark and Chef Logo are either registered trademarks/service marks or trademarks/servicemarks of Chef, in the United States and other countries and are used with Chef Inc's permission.<br>We are not affiliated with, endorsed or sponsored by Chef Inc.<br>
    <a href="https://docs.chef.io/server_ldap/" class="_attribution-link">https://docs.chef.io/server_ldap/</a>
  </p>
</div>
