<div id="col-content" data-swiftype-index="true"> <div id="supermarket-ctl-executable"><h1>supermarket-ctl (executable)</h1></div>  <div class="prose"> <p data-swiftype-index="false"> <a href="https://github.com/chef/supermarket/blob/main/docs-chef-io/content/supermarket/ctl_supermarket.md" alt="Link to page on GitHub repository">[edit on GitHub]</a> </p> <p>The Chef Supermarket installations that are done using the Chef installer include a command-line utility named supermarket-ctl. This command-line tool is used to start and stop individual services, reconfigure the Chef Supermarket server, run smoke tests, and tail the Chef Supermarket log files.</p> <h2 id="make-admin">make-admin</h2> <p>The <code>make-admin</code> subcommand is used to make the named Chef Supermarket user an administrator.</p> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">sudo -u supermarket supermarket-ctl make-admin USER_NAME
</code></pre></div>
<p>where <code>USER_NAME</code> represents the name of the user to be granted administrator privileges.</p> <h2 id="spdx">spdx</h2> <p>The <code>spdx</code> subcommands are used to manage SPDX license information in cookbooks. Linked SPDX licenses appear on the cookbook information page.</p> <p><a href="https://spdx.dev/">The Software Package Data Exchange</a> (SPDX) is an open standard for software manifests, including components, licenses, copyrights, and security content.</p> <p>SPDX maintains a <a href="https://spdx.org/licenses/">License List</a> of common licenses and exceptions used in open source development. Changes to the SPDX License List are not automatically reflected in your cookbooks. to To apply changes made by SPDX, rescan your cookbooks with the <code>spdx</code> subcommands.</p> <h3 id="spdx-all">spdx-all</h3> <p>The <code>spdx-all</code> command links the licenses known to SPDX for all cookbooks in your system.</p> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">sudo -u supermarket supermarket-ctl spdx-all
</code></pre></div>
<h3 id="spdx-latest">spdx-latest</h3> <p>The <code>spdx-latest</code> command links the licenses known to SPDX for the specified cookbook.</p> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">sudo -u supermarket supermarket-ctl spdx-latest COOKBOOK_NAME
</code></pre></div>
<p>Where COOKBOOK_NAME is the name of cookbook for SPDX linking. The latest version of the cookbook receives SPDX linking.</p> <h3 id="spdx-on-version">spdx-on-version</h3> <p>The <code>spdx-on-version</code> command links the licenses known to SPDX for the specified cookbook version.</p> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">sudo -u supermarket supermarket-ctl spdx-on-version COOKBOOK_NAME VERSION
</code></pre></div>
<p>Where COOKBOOK_NAME is the name of cookbook and VERSION is the version of the cookbook that receives SPDX linking.</p> <h2 id="quality-metrics">Quality Metrics</h2> <h3 id="qm-flip-admin-only">qm-flip-admin-only</h3> <p>The <code>qm-flip-admin-only</code> command is used to make a single named quality metric visible only to admins.</p> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">sudo -u supermarket supermarket-ctl qm-flip-admin-only <span style="color:#4070a0">"METRIC_NAME"</span>
</code></pre></div>
<p>where <code>METRIC_NAME</code> is the name of the quality metric to make admin only. Names containing spaces must be surrounded by quotes.</p> <h3 id="qm-flip-all-admin-only">qm-flip-all-admin-only</h3> <p>The <code>qm-flip-all-admin-only</code> command is used to make all quality metrics visible only to admins.</p> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">sudo -u supermarket supermarket-ctl qm-flip-all-admin-only
</code></pre></div>
<h3 id="qm-flip-all-public">qm-flip-all-public</h3> <p>The <code>qm-flip-all-public</code> command is used to make all quality metrics visible to all users.</p> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">sudo -u supermarket supermarket-ctl qm-flip-all-public
</code></pre></div>
<h3 id="qm-flip-public">qm-flip-public</h3> <p>The <code>qm-flip-public</code> command is used to make a single named quality metric visible to all users.</p> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">sudo -u supermarket supermarket-ctl qm-flip-public <span style="color:#4070a0">"METRIC_NAME"</span>
</code></pre></div>
<p>where <code>METRIC_NAME</code> is the name of the quality metric to make public. Names containing spaces must be surrounded by quotes.</p> <h3 id="qm-list">qm-list</h3> <p>The <code>qm-list</code> command is used to list the names of quality metrics defined currently in a Supermarket.</p> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">sudo -u supermarket supermarket-ctl qm-list
</code></pre></div>
<h3 id="qm-run-all-the-latest">qm-run-all-the-latest</h3> <p>The <code>qm-run-all-the-latest</code> command is used to run all quality metrics on the latest versions of all cookbooks.</p> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">sudo -u supermarket supermarket-ctl qm-run-all-the-latest
</code></pre></div>
<h3 id="qm-run-on-latest">qm-run-on-latest</h3> <p>The <code>qm-run-on-latest</code> command is used to run all quality metrics on the latest version of a named cookbook.</p> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">sudo -u supermarket supermarket-ctl qm-run-on-version COOKBOOK_NAME
</code></pre></div>
<p>where <code>COOKBOOK_NAME</code> is the name of the cookbook on which to run all quality metrics on its latest version.</p> <h3 id="qm-run-on-version">qm-run-on-version</h3> <p>The <code>qm-run-on-version</code> command is used to run all quality metrics on a given version of a named cookbook.</p> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">sudo -u supermarket supermarket-ctl qm-run-on-version COOKBOOK_NAME VERSION
</code></pre></div>
<p>where <code>COOKBOOK_NAME</code> and <code>VERSION</code> are respectively the name and version of the cookbook on which to run all quality metrics.</p> <h2 id="general-commands">General Commands</h2> <h3 id="cleanse">cleanse</h3> <p>The <code>cleanse</code> subcommand is used to re-set the server to the state it was in before the first time the <code>reconfigure</code> subcommand is run to destroy all data, configuration files, and logs.</p> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">supermarket-ctl cleanse
</code></pre></div>
<h3 id="help">help</h3> <p>The <code>help</code> subcommand is used to print a list of all available supermarket-ctl commands.</p> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">supermarket-ctl <span style="color:#007020">help</span>
</code></pre></div>
<h3 id="reconfigure">reconfigure</h3> <p>The <code>reconfigure</code> subcommand is used when changes are made to the supermarket.rb file to reconfigure the server. When changes are made to the supermarket.rb file, they will not be applied to the Chef Supermarket configuration until after this command is run. This subcommand will also restart any services for which the <code>service_name['enabled']</code> setting is set to <code>true</code>.</p> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">supermarket-ctl reconfigure
</code></pre></div>
<h3 id="show-config">show-config</h3> <p>The <code>show-config</code> subcommand is used to view the configuration that will be generated by the <code>reconfigure</code> subcommand. This command is most useful in the early stages of a deployment to ensure that everything is built properly prior to installation.</p> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">supermarket-ctl show-config
</code></pre></div>
<h3 id="uninstall">uninstall</h3> <p>The <code>uninstall</code> subcommand is used to remove the Chef Supermarket application, but without removing any of the data. This subcommand will shut down all services (including the <code>runit</code> process supervisor).</p> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">supermarket-ctl uninstall
</code></pre></div>
<div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> To revert the <code>uninstall</code> subcommand, run the <code>reconfigure</code> subcommand (because the <code>start</code> subcommand is disabled by the <code>uninstall</code> command). </div> </div> <h2 id="service-subcommands">Service Subcommands</h2> <p>This command has a built in process supervisor that ensures all of the required services are in the appropriate state at any given time. The supervisor starts two processes per service and provides the following subcommands for managing services: <code>hup</code>, <code>int</code>, <code>kill</code>, <code>once</code>, <code>restart</code>, <code>service-list</code>, <code>start</code>, <code>status</code>, <code>stop</code>, <code>tail</code>, and <code>term</code>.</p> <h3 id="hup">hup</h3> <p>The <code>hup</code> subcommand is used to send a <code>SIGHUP</code> to all services. This command can also be run for an individual service by specifying the name of the service in the command.</p> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">supermarket-ctl hup name_of_service
</code></pre></div>
<p>where <code>name_of_service</code> represents the name of any service that is listed after running the <code>service-list</code> subcommand.</p> <h3 id="int">int</h3> <p>The <code>int</code> subcommand is used to send a <code>SIGINT</code> to all services. This command can also be run for an individual service by specifying the name of the service in the command.</p> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">supermarket-ctl int name_of_service
</code></pre></div>
<p>where <code>name_of_service</code> represents the name of any service that is listed after running the <code>service-list</code> subcommand.</p> <h3 id="kill">kill</h3> <p>The <code>kill</code> subcommand is used to send a <code>SIGKILL</code> to all services. This command can also be run for an individual service by specifying the name of the service in the command.</p> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">supermarket-ctl <span style="color:#007020">kill</span> name_of_service
</code></pre></div>
<p>where <code>name_of_service</code> represents the name of any service that is listed after running the <code>service-list</code> subcommand.</p> <h3 id="once">once</h3> <p>The supervisor for Chef Supermarket is configured to restart any service that fails, unless that service has been asked to change its state. The <code>once</code> subcommand is used to tell the supervisor to not attempt to restart any service that fails.</p> <p>This command is useful when troubleshooting configuration errors that prevent a service from starting. Run the <code>once</code> subcommand followed by the <code>status</code> subcommand to look for services in a down state and/or to identify which services are in trouble. This command can also be run for an individual service by specifying the name of the service in the command.</p> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">supermarket-ctl once name_of_service
</code></pre></div>
<p>where <code>name_of_service</code> represents the name of any service that is listed after running the <code>service-list</code> subcommand.</p> <h3 id="restart">restart</h3> <p>The <code>restart</code> subcommand is used to restart all services enabled on Chef Supermarket or to restart an individual service by specifying the name of that service in the command.</p> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">supermarket-ctl restart name_of_service
</code></pre></div>
<p>where <code>name_of_service</code> represents the name of any service that is listed after running the <code>service-list</code> subcommand. When a service is successfully restarted the output should be similar to:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">ok: run: service_name: <span style="color:#666">(</span>pid 12345<span style="color:#666">)</span> 1s
</code></pre></div>
<h3 id="service-list">service-list</h3> <p>The <code>service-list</code> subcommand is used to display a list of all available services. A service that is enabled is labeled with an asterisk (*).</p> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">supermarket-ctl service-list
</code></pre></div>
<h3 id="start">start</h3> <p>The <code>start</code> subcommand is used to start all services that are enabled in Chef Supermarket. This command can also be run for an individual service by specifying the name of the service in the command.</p> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">supermarket-ctl start name_of_service
</code></pre></div>
<p>where <code>name_of_service</code> represents the name of any service that is listed after running the <code>service-list</code> subcommand. When a service is successfully started the output should be similar to:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">ok: run: service_name: <span style="color:#666">(</span>pid 12345<span style="color:#666">)</span> 1s
</code></pre></div>
<p>The supervisor for Chef Supermarket is configured to wait seven seconds for a service to respond to a command from the supervisor. If you see output that references a timeout, it means that a signal has been sent to the process, but that the process has yet to actually comply. In general, processes that have timed out are not a big concern, unless they are failing to respond to the signals at all. If a process is not responding, use a command like the <code>kill</code> subcommand to stop the process, investigate the cause (if required), and then use the <code>start</code> subcommand to re-enable it.</p> <h3 id="status">status</h3> <p>The <code>status</code> subcommand is used to show the status of all services available to Chef Supermarket. The results will vary based on the configuration of a given server. This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">supermarket-ctl status
</code></pre></div>
<p>and will return the status for all services. Status can be returned for individual services by specifying the name of the service as part of the command:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">supermarket-ctl status name_of_service
</code></pre></div>
<p>where <code>name_of_service</code> represents the name of any service that is listed after running the <code>service-list</code> subcommand.</p> <p>When service status is requested, the output should be similar to:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">run: service_name: <span style="color:#666">(</span>pid 12345<span style="color:#666">)</span> 12345s; run: log: <span style="color:#666">(</span>pid 1234<span style="color:#666">)</span> 67890s
</code></pre></div>
<p>where</p> <ul> <li>
<code>run:</code> is the state of the service (<code>run:</code> or <code>down:</code>)</li> <li>
<code>service_name:</code> is the name of the service for which status is returned</li> <li>
<code>(pid 12345)</code> is the process identifier</li> <li>
<code>12345s</code> is the uptime of the service, in seconds</li> </ul> <p>For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">down: actions: <span style="color:#666">(</span>pid 35546<span style="color:#666">)</span> 10s
</code></pre></div>
<p>By default, runit will restart services automatically when the services fail. Therefore, runit may report the status of a service as <code>run:</code> even when there is an issue with that service. When investigating why a particular service is not running as it should be, look for the services with the shortest uptimes. For example, the list below indicates that the <strong>actions</strong> should be investigated further:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">run: actions: <span style="color:#666">(</span>pid 6361<span style="color:#666">)</span> 4132s; run: log: <span style="color:#666">(</span>pid 6173<span style="color:#666">)</span> 4146s
run: actions_consumer: <span style="color:#666">(</span>pid 6374<span style="color:#666">)</span> 5s; run: log: <span style="color:#666">(</span>pid 6227<span style="color:#666">)</span> 4139s
run: actions_messages: <span style="color:#666">(</span>pid 6392<span style="color:#666">)</span> 4131s; run: log: <span style="color:#666">(</span>pid 6324<span style="color:#666">)</span> 4133s
run: memcached: <span style="color:#666">(</span>pid 6115<span style="color:#666">)</span> 4157s; run: log: <span style="color:#666">(</span>pid 6129<span style="color:#666">)</span> 4156s
</code></pre></div>
<h4 id="log-files">Log Files</h4> <p>A typical status line for a service that is running in Chef Supermarket is similar to the following:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">run: name_of_service: <span style="color:#666">(</span>pid 1486<span style="color:#666">)</span> 7819s; run: log: <span style="color:#666">(</span>pid 1485<span style="color:#666">)</span> 7819s
</code></pre></div>
<p>where:</p> <ul> <li>
<code>run</code> describes the state in which the supervisor attempts to keep processes. This state is either <code>run</code> or <code>down</code>. If a service is in a <code>down</code> state, it should be stopped</li> <li>
<code>name_of_service</code> is the service name</li> <li>
<code>(pid 1486) 7819s;</code> is the process identifier followed by the amount of time (in seconds) the service has been running</li> <li>
<code>run: log: (pid 1485) 7819s</code> is the log process. It is typical for a log process to have a longer run time than a service; this is because the supervisor does not need to restart the log process in order to connect the supervised process</li> </ul> <p>If the service is down, the status line will appear similar to the following:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">down: actions: 3s, normally up; run: log: <span style="color:#666">(</span>pid 1485<span style="color:#666">)</span> 8526s
</code></pre></div>
<p>where</p> <ul> <li>
<code>down</code> indicates that the service is in a down state</li> <li>
<code>3s, normally up;</code> indicates that the service is normally in a run state and that the supervisor would attempt to restart this service after a reboot</li> </ul> <h3 id="stop">stop</h3> <p>The <code>stop</code> subcommand is used to stop all services enabled on Chef Supermarket. This command can also be run for an individual service by specifying the name of the service in the command.</p> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">supermarket-ctl stop name_of_service
</code></pre></div>
<p>where <code>name_of_service</code> represents the name of any service that is listed after running the <code>service-list</code> subcommand. When a service is successfully stopped the output should be similar to:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">ok: diwb: service_name: 0s, normally up
</code></pre></div>
<p>For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">supermarket-ctl stop
</code></pre></div>
<p>will return something similar to:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">ok: down: actions: 1s, normally up
ok: down: actions_consumer: 0s, normally up
ok: down: actions_messages: 0s, normally up
ok: down: memcached: 1s, normally up
</code></pre></div>
<h3 id="tail">tail</h3> <p>The <code>tail</code> subcommand is used to follow all Chef Supermarket logs for all services. This command can also be run for an individual service by specifying the name of the service in the command.</p> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">supermarket-ctl tail name_of_service
</code></pre></div>
<p>where <code>name_of_service</code> represents the name of any service that is listed after running the <code>service-list</code> subcommand.</p> <h3 id="term">term</h3> <p>The <code>term</code> subcommand is used to send a <code>SIGTERM</code> to all services. This command can also be run for an individual service by specifying the name of the service in the command.</p> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">supermarket-ctl term name_of_service
</code></pre></div>
<p>where <code>name_of_service</code> represents the name of any service that is listed after running the <code>service-list</code> subcommand.</p> </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; Chef Software, Inc.<br>Licensed under the Creative Commons Attribution 3.0 Unported License.<br>The Chef&trade; Mark and Chef Logo are either registered trademarks/service marks or trademarks/servicemarks of Chef, in the United States and other countries and are used with Chef Inc's permission.<br>We are not affiliated with, endorsed or sponsored by Chef Inc.<br>
    <a href="https://docs.chef.io/ctl_supermarket/" class="_attribution-link">https://docs.chef.io/ctl_supermarket/</a>
  </p>
</div>
