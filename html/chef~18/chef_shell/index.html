<div id="col-content" data-swiftype-index="true"> <div id="chef-shell-executable"><h1>chef-shell (executable)</h1></div>  <div class="prose"> <p data-swiftype-index="false"> <a href="https://github.com/chef/chef-workstation/blob/main/docs-chef-io/content/workstation/chef_shell.md" alt="Link to page on GitHub repository">[edit on GitHub]</a> </p> <p>chef-shell is a recipe debugging tool that allows the use of breakpoints within recipes. chef-shell runs as an Interactive Ruby (IRb) session. chef-shell supports both recipe and attribute file syntax, as well as interactive debugging features.</p> <p>The chef-shell executable is run as a command-line tool.</p> <h2 id="modes">Modes</h2> <p>chef-shell is tool that is run using an Interactive Ruby (IRb) session. chef-shell currently supports recipe and attribute file syntax, as well as interactive debugging features. chef-shell has three run modes:</p> <table> <col style="width:40%"> <col style="width:60%"> <thead> <tr class="header"> <th>Mode</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td>Standalone</td> <td>Default. No cookbooks are loaded, and the run-list is empty.</td> </tr> <tr> <td>Solo</td> <td>chef-shell acts as a Chef Solo Client. It attempts to load the chef-solo configuration file at <code>~/.chef/config.rb</code> and any JSON attributes passed. If the JSON attributes set a run-list, it will be honored. Cookbooks will be loaded in the same way that chef-solo loads them. chef-solo mode is activated with the <code>-s</code> or <code>--solo</code> command line option, and JSON attributes are specified in the same way as for chef-solo, with <code>-j /path/to/chef-solo.json</code>.</td> </tr> <tr> <td>Client</td> <td>chef-shell acts as a Chef Infra Client. During startup, it reads the Chef Infra Client configuration file from <code>~/.chef/client.rb</code> and contacts the Chef Infra Server to get the node's run_list, attributes, and cookbooks. Chef Infra Client mode is activated with the <code>-z</code> or <code>--client</code> options. You can also specify the configuration file with <code>-c CONFIG</code> and the server URL with <code>-S SERVER_URL</code>.</td> </tr> </tbody> </table> <h2 id="options">Options</h2> <p>This command has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-shell OPTION VALUE OPTION VALUE ...
</code></pre></div>
<p>This command has the following options:</p> <dl> <dt>
<code>-a</code>, <code>--standalone</code>
</dt> <dd> <p>Run chef-shell in standalone mode.</p> </dd> <dt>
<code>-c CONFIG</code>, <code>--config CONFIG</code>
</dt> <dd> <p>The configuration file to use.</p> </dd> <dt>
<code>-h</code>, <code>--help</code>
</dt> <dd> <p>Show help for the command.</p> </dd> <dt>
<code>-j PATH</code>, <code>--json-attributes PATH</code>
</dt> <dd> <p>The path to a file that contains JSON data. Use this option to define a <code>run_list</code> object. For example, a JSON file similar to:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-javascript" data-lang="javascript"><span style="color:#4070a0">"run_list"</span><span style="color:#666">:</span> [
  <span style="color:#4070a0">"recipe[base]"</span>,
  <span style="color:#4070a0">"recipe[foo]"</span>,
  <span style="color:#4070a0">"recipe[bar]"</span>,
  <span style="color:#4070a0">"role[webserver]"</span>
],
</code></pre></div>
<p>may be used by running <code>chef-shell -j path/to/file.json</code>.</p> <p>In certain situations this option may be used to update <code>normal</code> attributes.</p> <div class="admonition-warning"> <p class="admonition-warning-title">Warning</p> <div class="admonition-warning-text"> <p>Any other attribute type that is contained in this JSON file will be treated as a <code>normal</code> attribute. Setting attributes at other precedence levels is not possible. For example, attempting to update <code>override</code> attributes using the <code>-j</code> option:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-javascript" data-lang="javascript">{
  <span style="color:#4070a0">"name"</span><span style="color:#666">:</span> <span style="color:#4070a0">"dev-99"</span>,
  <span style="color:#4070a0">"description"</span><span style="color:#666">:</span> <span style="color:#4070a0">"Install some stuff"</span>,
  <span style="color:#4070a0">"override_attributes"</span><span style="color:#666">:</span> {
    <span style="color:#4070a0">"apptastic"</span><span style="color:#666">:</span> {
      <span style="color:#4070a0">"enable_apptastic"</span><span style="color:#666">:</span> <span style="color:#4070a0">"false"</span>,
      <span style="color:#4070a0">"apptastic_tier_name"</span><span style="color:#666">:</span> <span style="color:#4070a0">"dev-99.bomb.com"</span>
    }
  }
}
</code></pre></div>
<p>will result in a node object similar to:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-javascript" data-lang="javascript">{
  <span style="color:#4070a0">"name"</span><span style="color:#666">:</span> <span style="color:#4070a0">"maybe-dev-99"</span>,
  <span style="color:#4070a0">"normal"</span><span style="color:#666">:</span> {
    <span style="color:#4070a0">"name"</span><span style="color:#666">:</span> <span style="color:#4070a0">"dev-99"</span>,
    <span style="color:#4070a0">"description"</span><span style="color:#666">:</span> <span style="color:#4070a0">"Install some stuff"</span>,
    <span style="color:#4070a0">"override_attributes"</span><span style="color:#666">:</span> {
      <span style="color:#4070a0">"apptastic"</span><span style="color:#666">:</span> {
        <span style="color:#4070a0">"enable_apptastic"</span><span style="color:#666">:</span> <span style="color:#4070a0">"false"</span>,
        <span style="color:#4070a0">"apptastic_tier_name"</span><span style="color:#666">:</span> <span style="color:#4070a0">"dev-99.bomb.com"</span>
      }
    }
  }
}
</code></pre></div> </div> </div> </dd> <dt>
<code>-l LEVEL</code>, <code>--log-level LEVEL</code>
</dt> <dd> <p>The level of logging to be stored in a log file.</p> </dd> <dt>
<code>-o RUN_LIST_ITEM</code>, <code>--override-runlist RUN_LIST_ITEM</code>
</dt> <dd> <p>Replace the current run-list with the specified items. Only applicable when also using <code>solo</code> or <code>server</code> modes.</p> </dd> <dt>
<code>-s</code>, <code>--solo</code>
</dt> <dd> <p>Run chef-shell in chef-solo mode.</p> </dd> <dt>
<code>-S CHEF_SERVER_URL</code>, <code>--server CHEF_SERVER_URL</code>
</dt> <dd> <p>The URL for the Chef Infra Server.</p> </dd> <dt>
<code>-v</code>, <code>--version</code>
</dt> <dd> <p>The Chef Infra Client version.</p> </dd> <dt>
<code>-z</code>, <code>--client</code>
</dt> <dd> <p>Run chef-shell in Chef Infra Client mode.</p> </dd> </dl> <h2 id="configure">Configure</h2> <p>chef-shell determines which configuration file to load based on the following:</p> <ol> <li>If a configuration file is specified using the <code>-c</code> option, chef-shell will use the specified configuration file</li> <li>If a NAMED_CONF is given, chef-shell will load ~/.chef/NAMED_CONF/chef_shell.rb</li> <li>If no NAMED_CONF is given chef-shell will load ~/.chef/chef_shell.rb if it exists</li> <li>If no chef_shell.rb can be found, chef-shell falls back to load: <ul> <li>/etc/chef/client.rb if -z option is given.</li> <li>/etc/chef/solo.rb if –solo-legacy-mode option is given.</li> <li>.chef/config.rb if -s option is given.</li> <li>.chef/knife.rb if -s option is given.</li> </ul> </li> </ol> <h3 id="chef-shellrb">chef-shell.rb</h3> <p>The chef-shell.rb file can be used to configure chef-shell in the same way as the client.rb file is used to configure Chef Infra Client. For example, to configure chef-shell to authenticate to the Chef Infra Server, copy the <code>node_name</code>, <code>client_key</code>, and <code>chef_server_url</code> settings from the config.rb file:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">node_name                <span style="color:#4070a0">'your-knife-clientname'</span>
client_key               <span style="color:#60add5">File</span><span style="color:#666">.</span>expand_path(<span style="color:#4070a0">'~/.chef/my-client.pem'</span>)
chef_server_url          <span style="color:#4070a0">'https://api.opscode.com/organizations/myorg'</span>
</code></pre></div>
<p>and then add them to the chef-shell.rb file. Other configuration possibilities include disabling Ohai plugins (which will speed up the chef-shell boot process) or including arbitrary Ruby code in the chef-shell.rb file.</p> <h3 id="run-as-a-chef-infra-client">Run as a Chef Infra Client</h3> <p>By default, chef-shell loads in standalone mode and does not connect to the Chef Infra Server. The chef-shell can be run as a Chef Infra Client to verify functionality that is only available when Chef Infra Client connects to the Chef Infra Server, such as search functionality or accessing data stored in data bags.</p> <p>chef-shell can use the same credentials as knife when connecting to a Chef Infra Server. Make sure that the settings in chef-shell.rb are the same as those in config.rb, and then use the <code>-z</code> option as part of the command. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-shell -z
</code></pre></div>
<h2 id="debugging-cookbooks">Debugging Cookbooks</h2> <p>chef-shell allows the current position in a run-list to be manipulated during a Chef Infra Client run. Add breakpoints to a recipe to take advantage of this functionality.</p> <h3 id="step-through-run-list">Step Through Run-list</h3> <p>To explore how using the <strong>breakpoint</strong> to manually step through a Chef Infra Client run, create a simple recipe in chef-shell:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef &gt; recipe_mode
  chef:recipe &gt; <span style="color:#007020">echo</span> off
  chef:recipe &gt; file <span style="color:#4070a0">"/tmp/before-breakpoint"</span>
  chef:recipe &gt; breakpoint <span style="color:#4070a0">"foo"</span>
  chef:recipe &gt; file <span style="color:#4070a0">"/tmp/after-breakpoint"</span>
</code></pre></div>
<p>and then run Chef Infra Client:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef:recipe &gt; run_chef
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 14:17:49 -0800<span style="color:#666">]</span> DEBUG: Processing file<span style="color:#666">[</span>/tmp/before-breakpoint<span style="color:#666">]</span>
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 14:17:49 -0800<span style="color:#666">]</span> DEBUG: file<span style="color:#666">[</span>/tmp/before-breakpoint<span style="color:#666">]</span> using Chef::Provider::File
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 14:17:49 -0800<span style="color:#666">]</span> INFO: Creating file<span style="color:#666">[</span>/tmp/before-breakpoint<span style="color:#666">]</span> at /tmp/before-breakpoint
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 14:17:49 -0800<span style="color:#666">]</span> DEBUG: Processing <span style="color:#666">[</span>./bin/../lib/chef/mixin/recipe_definition_dsl_core.rb:56:in <span style="color:#4070a0">'new'</span><span style="color:#666">]</span>
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 14:17:49 -0800<span style="color:#666">]</span> DEBUG: <span style="color:#666">[</span>./bin/../lib/chef/mixin/recipe_definition_dsl_core.rb:56:in <span style="color:#4070a0">'new'</span><span style="color:#666">]</span> using Chef::Provider::Breakpoint
</code></pre></div>
<p>Chef Infra Client ran the first resource before the breakpoint (<code>file[/tmp/before-breakpoint]</code>), but then stopped after execution. Chef Infra Client attempted to name the breakpoint after its position in the source file, but Chef Infra Client was confused because the resource was entered interactively. From here, chef-shell can resume the interrupted Chef Infra Client run:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef:recipe &gt; chef_run.resume
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 14:27:08 -0800<span style="color:#666">]</span> INFO: Creating file<span style="color:#666">[</span>/tmp/after-breakpoint<span style="color:#666">]</span> at /tmp/after-breakpoint
</code></pre></div>
<p>A quick view of the <code>/tmp</code> directory shows that the following files were created:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">after-breakpoint
before-breakpoint
</code></pre></div>
<p>You can rewind and step through a Chef Infra Client run:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef:recipe &gt; Chef::Log.level <span style="color:#666">=</span> :debug <span style="color:#60a0b0;font-style:italic"># debug logging won't turn on automatically in this case</span>
    <span style="color:#666">=</span>&gt; :debug
  chef:recipe &gt; chef_run.rewind
    <span style="color:#666">=</span>&gt; <span style="color:#40a070">0</span>
  chef:recipe &gt; chef_run.step
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 14:40:52 -0800<span style="color:#666">]</span> DEBUG: Processing file<span style="color:#666">[</span>/tmp/before-breakpoint<span style="color:#666">]</span>
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 14:40:52 -0800<span style="color:#666">]</span> DEBUG: file<span style="color:#666">[</span>/tmp/before-breakpoint<span style="color:#666">]</span> using Chef::Provider::File
    <span style="color:#666">=</span>&gt; <span style="color:#40a070">1</span>
  chef:recipe &gt; chef_run.step
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 14:40:54 -0800<span style="color:#666">]</span> DEBUG: Processing <span style="color:#666">[</span>./bin/../lib/chef/mixin/recipe_definition_dsl_core.rb:56:in <span style="color:#4070a0">'new'</span><span style="color:#666">]</span>
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 14:40:54 -0800<span style="color:#666">]</span> DEBUG: <span style="color:#666">[</span>./bin/../lib/chef/mixin/recipe_definition_dsl_core.rb:56:in <span style="color:#4070a0">'new'</span><span style="color:#666">]</span> using Chef::Provider::Breakpoint
    <span style="color:#666">=</span>&gt; <span style="color:#40a070">2</span>
  chef:recipe &gt; chef_run.step
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 14:40:56 -0800<span style="color:#666">]</span> DEBUG: Processing file<span style="color:#666">[</span>/tmp/after-breakpoint<span style="color:#666">]</span>
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 14:40:56 -0800<span style="color:#666">]</span> DEBUG: file<span style="color:#666">[</span>/tmp/after-breakpoint<span style="color:#666">]</span> using Chef::Provider::File
    <span style="color:#666">=</span>&gt; <span style="color:#40a070">3</span>
</code></pre></div>
<p>From the output, the rewound run-list is shown, but when the resources are executed again, they will repeat their checks for the existence of files. If they exist, Chef Infra Client will skip creating them. If the files are deleted, then:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef:recipe &gt; ls<span style="color:#666">(</span><span style="color:#4070a0">"/tmp"</span><span style="color:#666">)</span>.grep<span style="color:#666">(</span>/breakpoint/<span style="color:#666">)</span>.each <span style="color:#666">{</span>|f| rm <span style="color:#4070a0">"/tmp/#{f}"</span> <span style="color:#666">}</span>
    <span style="color:#666">=</span>&gt; <span style="color:#666">[</span><span style="color:#4070a0">"after-breakpoint"</span>, <span style="color:#4070a0">"before-breakpoint"</span><span style="color:#666">]</span>
</code></pre></div>
<p>Rewind, and then resume your Chef Infra Client run to get the expected results:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef:recipe &gt; chef_run.rewind
  chef:recipe &gt; chef_run.resume
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 14:48:56 -0800<span style="color:#666">]</span> DEBUG: Processing file<span style="color:#666">[</span>/tmp/before-breakpoint<span style="color:#666">]</span>
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 14:48:56 -0800<span style="color:#666">]</span> DEBUG: file<span style="color:#666">[</span>/tmp/before-breakpoint<span style="color:#666">]</span> using Chef::Provider::File
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 14:48:56 -0800<span style="color:#666">]</span> INFO: Creating file<span style="color:#666">[</span>/tmp/before-breakpoint<span style="color:#666">]</span> at /tmp/before-breakpoint
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 14:48:56 -0800<span style="color:#666">]</span> DEBUG: Processing <span style="color:#666">[</span>./bin/../lib/chef/mixin/recipe_definition_dsl_core.rb:56:in <span style="color:#4070a0">'new'</span><span style="color:#666">]</span>
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 14:48:56 -0800<span style="color:#666">]</span> DEBUG: <span style="color:#666">[</span>./bin/../lib/chef/mixin/recipe_definition_dsl_core.rb:56:in <span style="color:#4070a0">'new'</span><span style="color:#666">]</span> using Chef::Provider::Breakpoint
  chef:recipe &gt; chef_run.resume
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 14:49:20 -0800<span style="color:#666">]</span> DEBUG: Processing file<span style="color:#666">[</span>/tmp/after-breakpoint<span style="color:#666">]</span>
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 14:49:20 -0800<span style="color:#666">]</span> DEBUG: file<span style="color:#666">[</span>/tmp/after-breakpoint<span style="color:#666">]</span> using Chef::Provider::File
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 14:49:20 -0800<span style="color:#666">]</span> INFO: Creating file<span style="color:#666">[</span>/tmp/after-breakpoint<span style="color:#666">]</span> at /tmp/after-breakpoint
</code></pre></div>
<h3 id="debug-existing-recipe">Debug Existing Recipe</h3> <p>chef-shell can be used to debug existing recipes. The recipe first needs to be added to a run-list for the node, so that it is cached when starting chef-shell and then used for debugging. chef-shell will report which recipes are being cached when it is started:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">loading configuration: none <span style="color:#666">(</span>standalone session<span style="color:#666">)</span>
Session type: standalone
Loading.............done.

Welcome to the chef-shell 15.8.23
For usage see https://docs.chef.io/chef_shell.html

run <span style="color:#4070a0">`</span>help<span style="color:#4070a0">' for help, `exit'</span> or ^D to quit.

chef <span style="color:#666">(</span>15.8.23<span style="color:#666">)</span>&gt;
</code></pre></div>
<p>To just load one recipe from the run-list, go into the recipe and use the <code>include_recipe</code> command. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef &gt; recipe_mode
  chef:recipe &gt; include_recipe <span style="color:#4070a0">"getting-started"</span>
    <span style="color:#666">=</span>&gt; <span style="color:#666">[</span><span style="color:#60a0b0;font-style:italic">#&lt; Chef::Recipe:0x10256f9e8 @cookbook_name="getting-started",</span>
  ... output truncated ...
</code></pre></div>
<p>To load all of the recipes from a run-list, use code similar to the following:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">node<span style="color:#666">.</span>run_list<span style="color:#666">.</span>expand(node<span style="color:#666">.</span>chef_environment)<span style="color:#666">.</span>recipes<span style="color:#666">.</span>each <span style="color:#007020;font-weight:700">do</span> <span style="color:#666">|</span>r<span style="color:#666">|</span>
  include_recipe r
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>After the recipes that are to be debugged have been loaded, use the <code>run_chef</code> command to run them.</p> <h3 id="advanced-debugging">Advanced Debugging</h3> <p>In chef-shell, it is possible to get verbose debugging using the tracing feature in Interactive Ruby (IRb). chef-shell provides a shortcut for turning tracing on and off. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef &gt; tracing on
tracing is <span style="color:#bb60d5">on</span>
<span style="color:#666">=</span>&gt; nil
chef &gt;
</code></pre></div>
<p>and:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef &gt; tracing off
<span style="color:#60a0b0;font-style:italic">#0:(irb):2:Object:-: tracing off</span>
<span style="color:#60a0b0;font-style:italic">#0:/opt/chef-workstation/embedded/lib/ruby/gems/2.6.0/gems/chef-15.8.23/lib/chef/shell/ext.rb:109:Shell::Extensions::ObjectCoreExtensions:&gt;:       def off</span>
<span style="color:#60a0b0;font-style:italic">#0:/opt/chef-workstation/embedded/lib/ruby/gems/2.6.0/gems/chef-15.8.23/lib/chef/shell/ext.rb:110:Shell::Extensions::ObjectCoreExtensions:-:         :off</span>
<span style="color:#60a0b0;font-style:italic">#0:/opt/chef-workstation/embedded/lib/ruby/gems/2.6.0/gems/chef-15.8.23/lib/chef/shell/ext.rb:111:Shell::Extensions::ObjectCoreExtensions:&lt;:       end</span>
<span style="color:#60a0b0;font-style:italic">#0:/opt/chef-workstation/embedded/lib/ruby/gems/2.6.0/gems/chef-15.8.23/lib/chef/shell/ext.rb:272:main:&gt;:       def tracing(on_or_off)</span>
<span style="color:#60a0b0;font-style:italic">#0:/opt/chef-workstation/embedded/lib/ruby/gems/2.6.0/gems/chef-15.8.23/lib/chef/shell/ext.rb:273:main:-:         conf.use_tracer = on_or_off.on_off_to_bool</span>
<span style="color:#60a0b0;font-style:italic">#0:/opt/chef-workstation/embedded/lib/ruby/gems/2.6.0/gems/chef-15.8.23/lib/chef/shell/ext.rb:162:Shell::Extensions::Symbol:&gt;:       def on_off_to_bool</span>
<span style="color:#60a0b0;font-style:italic">#0:/opt/chef-workstation/embedded/lib/ruby/gems/2.6.0/gems/chef-15.8.23/lib/chef/shell/ext.rb:163:Shell::Extensions::Symbol:-:         to_s.on_off_to_bool</span>
<span style="color:#60a0b0;font-style:italic">#0:/opt/chef-workstation/embedded/lib/ruby/gems/2.6.0/gems/chef-15.8.23/lib/chef/shell/ext.rb:149:Shell::Extensions::String:&gt;:       def on_off_to_bool</span>
<span style="color:#60a0b0;font-style:italic">#0:/opt/chef-workstation/embedded/lib/ruby/gems/2.6.0/gems/chef-15.8.23/lib/chef/shell/ext.rb:150:Shell::Extensions::String:-:         case self</span>
<span style="color:#60a0b0;font-style:italic">#0:/opt/chef-workstation/embedded/lib/ruby/gems/2.6.0/gems/chef-15.8.23/lib/chef/shell/ext.rb:154:Shell::Extensions::String:-:           false</span>
<span style="color:#60a0b0;font-style:italic">#0:/opt/chef-workstation/embedded/lib/ruby/gems/2.6.0/gems/chef-15.8.23/lib/chef/shell/ext.rb:158:Shell::Extensions::String:&lt;:       end</span>
<span style="color:#60a0b0;font-style:italic">#0:/opt/chef-workstation/embedded/lib/ruby/gems/2.6.0/gems/chef-15.8.23/lib/chef/shell/ext.rb:164:Shell::Extensions::Symbol:&lt;:       end</span>
tracing is <span style="color:#bb60d5">off</span>
<span style="color:#666">=</span>&gt; nil
chef &gt;
</code></pre></div> <h2 id="manipulating-chef-infra-server-data">Manipulating Chef Infra Server Data</h2> <p>When chef-shell is configured to access a Chef Infra Server, chef-shell can list, show, search for and edit cookbooks, clients, nodes, roles, environments, policyfiles, and data bags.</p> <p>The syntax for managing objects on the Chef Infra Server is as follows:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-shell -z named_configuration
</code></pre></div>
<p>Where:</p> <ul> <li>
<code>named_configuration</code> is an existing configuration file in <code>~/.chef/named_configuration/chef_shell.rb</code>, such as <code>production</code>, <code>staging</code>, or <code>test</code>.</li> </ul> <p>Once in chef-shell, commands can be run against objects as follows:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef <span style="color:#666">(</span>preprod<span style="color:#666">)</span> &gt; items.command
</code></pre></div>
<p>Where:</p> <ul> <li>
<code>items</code> is the type of item to search for: <code>cookbooks</code>, <code>clients</code>, <code>nodes</code>, <code>roles</code>, <code>environments</code> or a data bag.</li> <li>
<code>command</code> is the command: <code>list</code>, <code>show</code>, <code>find</code>, or <code>edit</code>.</li> </ul> <p>For example, to list all of the nodes in a configuration named “preprod”, enter:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef <span style="color:#666">(</span>preprod<span style="color:#666">)</span> &gt; nodes.list
</code></pre></div>
<p>Which will return something similar to:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash"><span style="color:#666">=</span>&gt; <span style="color:#666">[</span>node<span style="color:#666">[</span>i-f09a939b<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-049a936f<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-eaaaa581<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-9154b1fb<span style="color:#666">]</span>,
    node<span style="color:#666">[</span>i-6a213101<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-c2687aa9<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-7abeaa11<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-4eb8ac25<span style="color:#666">]</span>,
    node<span style="color:#666">[</span>i-9a2030f1<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-a06875cb<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-145f457f<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-e032398b<span style="color:#666">]</span>,
    node<span style="color:#666">[</span>i-dc8c98b7<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-6afdf401<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-f49b119c<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-5abfab31<span style="color:#666">]</span>,
    node<span style="color:#666">[</span>i-78b8ac13<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-d99678b3<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-02322269<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-feb4a695<span style="color:#666">]</span>,
    node<span style="color:#666">[</span>i-9e2232f5<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-6e213105<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-cdde3ba7<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-e8bfb083<span style="color:#666">]</span>,
    node<span style="color:#666">[</span>i-743c2c1f<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-2eaca345<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-aa7f74c1<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-72fdf419<span style="color:#666">]</span>,
    node<span style="color:#666">[</span>i-140e1e7f<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-f9d43193<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-bd2dc8d7<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-8e7f70e5<span style="color:#666">]</span>,
    node<span style="color:#666">[</span>i-78f2e213<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-962232fd<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-4c322227<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-922232f9<span style="color:#666">]</span>,
    node<span style="color:#666">[</span>i-c02728ab<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-f06c7b9b<span style="color:#666">]]</span>
</code></pre></div>
<p>The <code>list</code> command can take a code block, which will applied (but not saved), to each object that is returned from the server. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef <span style="color:#666">(</span>preprod<span style="color:#666">)</span> &gt; nodes.list <span style="color:#666">{</span>|n| puts <span style="color:#4070a0">"#{n.name}: #{n.run_list}"</span> <span style="color:#666">}</span>
</code></pre></div>
<p>will return something similar to:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash"><span style="color:#666">=</span>&gt; i-f09a939b: role<span style="color:#666">[</span>lb<span style="color:#666">]</span>, role<span style="color:#666">[</span>preprod<span style="color:#666">]</span>, recipe<span style="color:#666">[</span>aws<span style="color:#666">]</span>
   i-049a936f: role<span style="color:#666">[</span>lb<span style="color:#666">]</span>, role<span style="color:#666">[</span>preprod<span style="color:#666">]</span>, recipe<span style="color:#666">[</span>aws<span style="color:#666">]</span>
   i-9154b1fb: recipe<span style="color:#666">[</span>erlang<span style="color:#666">]</span>, role<span style="color:#666">[</span>base<span style="color:#666">]</span>, role<span style="color:#666">[</span>couchdb<span style="color:#666">]</span>, role<span style="color:#666">[</span>preprod<span style="color:#666">]</span>,
   i-6a213101: role<span style="color:#666">[</span>chef<span style="color:#666">]</span>, role<span style="color:#666">[</span>preprod<span style="color:#666">]</span>
   <span style="color:#60a0b0;font-style:italic"># more...</span>
</code></pre></div>
<p>The <code>show</code> command can be used to display a specific node. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef <span style="color:#666">(</span>preprod<span style="color:#666">)</span> &gt; <span style="color:#bb60d5">load_balancer</span> <span style="color:#666">=</span> nodes.show<span style="color:#666">(</span><span style="color:#4070a0">'i-f09a939b'</span><span style="color:#666">)</span>
</code></pre></div>
<p>will return something similar to:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash"><span style="color:#666">=</span>&gt; node<span style="color:#666">[</span>i-f09a939b<span style="color:#666">]</span>
</code></pre></div>
<p>Or:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef <span style="color:#666">(</span>preprod<span style="color:#666">)</span> &gt; load_balancer.ec2.public_hostname
</code></pre></div>
<p>will return something similar to:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash"><span style="color:#666">=</span>&gt; <span style="color:#4070a0">"ec2-111-22-333-44.compute-1.amazonaws.com"</span>
</code></pre></div>
<p>The <code>find</code> command can be used to search the Chef Infra Server from the chef-shell. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef <span style="color:#666">(</span>preprod<span style="color:#666">)</span> &gt; pp nodes.find<span style="color:#666">(</span>:ec2_public_hostname <span style="color:#666">=</span>&gt; <span style="color:#4070a0">'ec2*'</span><span style="color:#666">)</span>
</code></pre></div>
<p>You can also format the results with a code block. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef <span style="color:#666">(</span>preprod<span style="color:#666">)</span> &gt; pp nodes.find<span style="color:#666">(</span>:ec2_public_hostname <span style="color:#666">=</span>&gt; <span style="color:#4070a0">'ec2*'</span><span style="color:#666">)</span> <span style="color:#666">{</span>|n| n.ec2.ami_id <span style="color:#666">}</span> and nil
</code></pre></div>
<p>will return something similar to:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash"><span style="color:#666">=</span>&gt; <span style="color:#666">[</span><span style="color:#4070a0">"ami-f8927a91"</span>,
    <span style="color:#4070a0">"ami-f8927a91"</span>,
    <span style="color:#4070a0">"ami-a89870c1"</span>,
    <span style="color:#4070a0">"ami-a89870c1"</span>,
    <span style="color:#4070a0">"ami-a89870c1"</span>,
    <span style="color:#4070a0">"ami-a89870c1"</span>,
    <span style="color:#4070a0">"ami-a89870c1"</span>
    <span style="color:#60a0b0;font-style:italic"># and more...</span>
</code></pre></div>
<p>Or:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef <span style="color:#666">(</span>preprod<span style="color:#666">)</span> &gt; <span style="color:#bb60d5">amis</span> <span style="color:#666">=</span> nodes.find<span style="color:#666">(</span>:ec2_public_hostname <span style="color:#666">=</span>&gt; <span style="color:#4070a0">'ec2*'</span><span style="color:#666">)</span> <span style="color:#666">{</span>|n| n.ec2.ami_id <span style="color:#666">}</span>
chef <span style="color:#666">(</span>preprod<span style="color:#666">)</span> &gt; puts amis.uniq.sort
</code></pre></div>
<p>will return something similar to:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash"><span style="color:#666">=</span>&gt; ami-4b4ba522
   ami-a89870c1
   ami-eef61587
   ami-f8927a91
</code></pre></div>
<h2 id="examples">Examples</h2> <p>The following examples show how to use chef-shell.</p> <h3 id="hello-world">“Hello World”</h3> <p>This example shows how to run chef-shell in standalone mode. (For chef-solo or Chef Infra Client modes, you would need to run chef-shell using the <code>-s</code> or <code>-z</code> command line options, and then take into consideration the necessary configuration settings.)</p> <p>When Chef Infra Client is installed using RubyGems or a package manager, chef-shell should already be installed. When Chef Infra Client is run from a git clone, it will be located in <code>chef/bin/chef shell</code>. To start chef-shell, just run it without any options. You’ll see the loading message, then the banner, and then the chef-shell prompt:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">bin/chef-shell

  loading configuration: none <span style="color:#666">(</span>standalone session<span style="color:#666">)</span>
  Session type: standalone
  Loading.............done.

  Welcome to the chef-shell 15.8.23
  For usage see https://docs.chef.io/chef_shell.html

  run <span style="color:#4070a0">`</span>help<span style="color:#4070a0">' for help, `exit'</span> or ^D to quit.

  chef <span style="color:#666">(</span>15.8.23<span style="color:#666">)</span>&gt;
</code></pre></div>
<p>(Use the help command to print a list of supported commands.) Use the recipe_mode command to switch to recipe context:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef &gt; recipe_mode
  chef:recipe_mode &gt;
</code></pre></div>
<p>Typing is evaluated in the same context as recipes. Create a file resource:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef:recipe_mode &gt; file <span style="color:#4070a0">"/tmp/ohai2u_shef"</span>
    <span style="color:#666">=</span>&gt; <span style="color:#60a0b0;font-style:italic">#&lt; Chef::Resource::File:0x1b691ac</span>
       @enclosing_provider<span style="color:#666">=</span>nil,
       @resource_name<span style="color:#666">=</span>:file,
       @before<span style="color:#666">=</span>nil,
       @supports<span style="color:#666">={}</span>,
       @backup<span style="color:#666">=</span>5,
       @allowed_actions<span style="color:#666">=[</span>:nothing, :create, :delete, :touch, :create_if_missing<span style="color:#666">]</span>,
       @only_if<span style="color:#666">=</span>nil,
       @noop<span style="color:#666">=</span>nil,
       @collection<span style="color:#666">=</span><span style="color:#60a0b0;font-style:italic">#&lt; Chef::ResourceCollection:0x1b9926c</span>
       @insert_after_idx<span style="color:#666">=</span>nil,
       @resources_by_name<span style="color:#666">={</span><span style="color:#4070a0">"file[/tmp/ohai2u_shef]"</span><span style="color:#666">=</span>&gt;0<span style="color:#666">}</span>,
       @resources<span style="color:#666">=[</span><span style="color:#60a0b0;font-style:italic">#&lt; Chef::Resource::File:0x1b691ac ...&gt;]&gt;,</span>
       @updated<span style="color:#666">=</span>false,
       @provider<span style="color:#666">=</span>nil,
       @node<span style="color:#666">=</span>&lt; Chef::Node:0xdeeaae
       @name<span style="color:#666">=</span><span style="color:#4070a0">"eigenstate.local"</span>&gt;,
       @recipe_name<span style="color:#666">=</span>nil,
       @not_if<span style="color:#666">=</span>nil,
       @name<span style="color:#666">=</span><span style="color:#4070a0">"/tmp/ohai2u_shef"</span>,
       @action<span style="color:#666">=</span><span style="color:#4070a0">"create"</span>,
       @path<span style="color:#666">=</span><span style="color:#4070a0">"/tmp/ohai2u_shef"</span>,
       @source_line<span style="color:#666">=</span><span style="color:#4070a0">"/Users/username/ruby/chef/chef/(irb#1) line 1"</span>,
       @params<span style="color:#666">={}</span>,
       @actions<span style="color:#666">={}</span>,
       @cookbook_name<span style="color:#666">=</span>nil,
       @ignore_failure<span style="color:#666">=</span>false&gt;
</code></pre></div>
<p>(The previous example was formatted for presentation.) At this point, chef-shell has created the resource and put it in the run-list, but not yet created the file. To initiate a Chef Infra Client run, use the <code>run_chef</code> command:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef:recipe_mode &gt; run_chef
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 10:42:47 -0800<span style="color:#666">]</span> DEBUG: Processing file<span style="color:#666">[</span>/tmp/ohai2u_shef<span style="color:#666">]</span>
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 10:42:47 -0800<span style="color:#666">]</span> DEBUG: file<span style="color:#666">[</span>/tmp/ohai2u_shef<span style="color:#666">]</span> using Chef::Provider::File
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 10:42:47 -0800<span style="color:#666">]</span> INFO: Creating file<span style="color:#666">[</span>/tmp/ohai2u_shef<span style="color:#666">]</span> at /tmp/ohai2u_shef
    <span style="color:#666">=</span>&gt; <span style="color:#007020">true</span>
</code></pre></div>
<p>chef-shell can also switch to the same context as attribute files. Set an attribute with the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef:recipe_mode &gt; attributes_mode
  chef:attributes &gt; default<span style="color:#666">[</span>:hello<span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#4070a0">"ohai2u-again"</span>
    <span style="color:#666">=</span>&gt; <span style="color:#4070a0">"ohai2u-again"</span>
  chef:attributes &gt;
</code></pre></div>
<p>Switch back to recipe_mode context and use the attributes:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef:attributes &gt; <span style="color:#bb60d5">recipe_mode</span>
    <span style="color:#666">=</span>&gt; :attributes
  chef:recipe_mode &gt; file <span style="color:#4070a0">"/tmp/#{node.hello}"</span>
</code></pre></div>
<p>Now, run Chef Infra Client again:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef:recipe_mode &gt; run_chef
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 10:53:22 -0800<span style="color:#666">]</span> DEBUG: Processing file<span style="color:#666">[</span>/tmp/ohai2u_shef<span style="color:#666">]</span>
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 10:53:22 -0800<span style="color:#666">]</span> DEBUG: file<span style="color:#666">[</span>/tmp/ohai2u_shef<span style="color:#666">]</span> using Chef::Provider::File
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 10:53:22 -0800<span style="color:#666">]</span> DEBUG: Processing file<span style="color:#666">[</span>/tmp/ohai2u-again<span style="color:#666">]</span>
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 10:53:22 -0800<span style="color:#666">]</span> DEBUG: file<span style="color:#666">[</span>/tmp/ohai2u-again<span style="color:#666">]</span> using Chef::Provider::File
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 10:53:22 -0800<span style="color:#666">]</span> INFO: Creating file<span style="color:#666">[</span>/tmp/ohai2u-again<span style="color:#666">]</span> at /tmp/ohai2u-again
    <span style="color:#666">=</span>&gt; <span style="color:#007020">true</span>
  chef:recipe_mode &gt;
</code></pre></div>
<p>Because the first resource (<code>file[/tmp/ohai2u_shef]</code>) is still in the run-list, it gets executed again. And because that file already exists, Chef Infra Client doesn’t attempt to re-create it. Finally, the files were created using the <code>ls</code> method:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef:recipe_mode &gt; ls<span style="color:#666">(</span><span style="color:#4070a0">"/tmp"</span><span style="color:#666">)</span>.grep<span style="color:#666">(</span>/ohai/<span style="color:#666">)</span>
    <span style="color:#666">=</span>&gt; <span style="color:#666">[</span><span style="color:#4070a0">"ohai2u-again"</span>, <span style="color:#4070a0">"ohai2u_shef"</span><span style="color:#666">]</span>
  Shell Tutorial
</code></pre></div> <h3 id="get-specific-nodes">Get Specific Nodes</h3> <p>To get a list of nodes using a recipe named <code>postfix</code> use <code>search(:node,"recipe:postfix")</code>. To get a list of nodes using a sub-recipe named <code>delivery</code>, use chef-shell. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">search(<span style="color:#517918">:node</span>, <span style="color:#4070a0">'recipes:postfix\:\:delivery'</span>)
</code></pre></div>
<div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>Single (' ‘) vs. double (" “) is important. This is because a backslash () needs to be included in the string, instead of having Ruby interpret it as an escape.</p> </div> </div> </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; Chef Software, Inc.<br>Licensed under the Creative Commons Attribution 3.0 Unported License.<br>The Chef&trade; Mark and Chef Logo are either registered trademarks/service marks or trademarks/servicemarks of Chef, in the United States and other countries and are used with Chef Inc's permission.<br>We are not affiliated with, endorsed or sponsored by Chef Inc.<br>
    <a href="https://docs.chef.io/chef_shell/" class="_attribution-link">https://docs.chef.io/chef_shell/</a>
  </p>
</div>
