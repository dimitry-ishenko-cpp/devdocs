<div id="col-content" data-swiftype-index="true"> <div id="microsoft-azure-powershell"><h1>Microsoft Azure PowerShell</h1></div>  <div class="prose"> <p data-swiftype-index="false"> <a href="https://github.com/chef/chef-web-docs/blob/main/content/azure_powershell.md" alt="Link to page on GitHub repository">[edit on GitHub]</a> </p> <h2 id="powershell-cmdlets">PowerShell Cmdlets</h2> <p>If Windows PowerShell is installed on the workstation, along with the Azure Chef Extension, the <code>Get-AzureVMChefExtension</code> and <code>Set-AzureVMChefExtension</code> extensions may be used to manage Chef running on virtual machines in Microsoft Azure.</p> <h3 id="get-azurevmchefextension">Get-AzureVMChefExtension</h3> <p>Use the <code>Get-AzureVMChefExtension</code> cmdlet to get the details for the Azure Chef Extension that is running on the named virtual machine.</p> <h4 id="syntax">Syntax</h4> <p>This cmdlet has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">Get-AzureVMChefExtension -VM &lt;string&gt;
</code></pre></div>
<h4 id="example">Example</h4> <p>The following examples show how to use the <code>Get-AzureVMChefExtension</code> cmdlet:</p> <h5 id="get-details-for-a-virtual-machine">Get details for a virtual machine</h5> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">Get-AzureVM -ServiceName cloudservice1 -Name azurevm1 | Get-AzureVMExtension
</code></pre></div>
<h3 id="set-azurevmchefextension">Set-AzureVMChefExtension</h3> <p>Use the <code>Set-AzureVMChefExtension</code> cmdlet to enable Chef on any virtual machine running on Microsoft Azure.</p> <h4 id="syntax-1">Syntax</h4> <p>This cmdlet has the following syntax.</p> <p>For Microsoft Windows:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">Set-AzureVMChefExtension -ValidationPem &lt;String&gt; -VM &lt;IPersistentVM&gt; -Windows <span style="color:#666">[</span>-ChefServerUrl &lt;String&gt; <span style="color:#666">]</span> <span style="color:#666">[</span>-ClientRb &lt;String&gt; <span style="color:#666">]</span> <span style="color:#666">[</span>-OrganizationName &lt;String&gt; <span style="color:#666">]</span> <span style="color:#666">[</span>-RunList &lt;String&gt; <span style="color:#666">]</span> <span style="color:#666">[</span>-ValidationClientName &lt;String&gt; <span style="color:#666">]</span> <span style="color:#666">[</span>-Version &lt;String&gt; <span style="color:#666">]</span> <span style="color:#666">[</span> &lt;CommonParameters&gt;<span style="color:#666">]</span>
</code></pre></div>
<p>For Linux:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">Set-AzureVMChefExtension -Linux -ValidationPem &lt;String&gt; -VM &lt;IPersistentVM&gt; <span style="color:#666">[</span>-ChefServerUrl &lt;String&gt; <span style="color:#666">]</span> <span style="color:#666">[</span>-ClientRb &lt;String&gt; <span style="color:#666">]</span> <span style="color:#666">[</span>-OrganizationName &lt;String&gt; <span style="color:#666">]</span> <span style="color:#666">[</span>-RunList &lt;String&gt; <span style="color:#666">]</span> <span style="color:#666">[</span>-ValidationClientName &lt;String&gt; <span style="color:#666">]</span> <span style="color:#666">[</span>-Version &lt;String&gt; <span style="color:#666">]</span> <span style="color:#666">[</span> &lt;CommonParameters&gt;<span style="color:#666">]</span>
</code></pre></div>
<h4 id="options">Options</h4> <p>This cmdlet has the following options:</p> <dl> <dt><code>-AutoUpdateChefClient</code></dt> <dd> <p>Auto-update . Set to <code>true</code> to auto update the version of the Azure Chef Extension when the virtual machine is restarted. For example, if this option is enabled, a virtual machine that has version <code>1205.12.2.0</code> will be updated automatically to <code>1205.12.2.1</code> when it is published.</p> </dd> <dt><code>-BootstrapOptions &lt;string&gt;</code></dt> <dd> <p>A JSON string that is added to the first run of a Chef Infra Client.</p> <p>For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">-BootstrapOptions <span style="color:#4070a0">'{"chef_node_name":"test_node"}'</span>
</code></pre></div>
<p>Supported options: <code>"chef_node_name"</code>, <code>"chef_server_url"</code> (required), <code>"environment"</code>, <code>"secret"</code>, and <code>"validation_client_name"</code> (required).</p> </dd> <dt><code>-ChefServerUrl &lt;string&gt;</code></dt> <dd> <p>The URL for the Chef Infra Server.</p> </dd> <dt><code>-ClientRb &lt;string&gt;</code></dt> <dd> <p>The path to the <code>client.rb</code> file.</p> </dd> <dt><code>-DeleteChefConfig</code></dt> <dd> <p>Disable the Azure Chef Extension extension.</p> </dd> <dt><code>-Linux</code></dt> <dd> <p>Sets the Azure Chef Extension to run Linux.</p> </dd> <dt><code>-OrganizationName &lt;string&gt;</code></dt> <dd> <p>The name of the organization on the Chef Infra Server.</p> </dd> <dt><code>-RunList &lt;string&gt;</code></dt> <dd> <p>A comma-separated list of roles and/or recipes to be applied.</p> </dd> <dt><code>-ValidationClientName &lt;string&gt;</code></dt> <dd> <p>The name of the chef-validator key Chef Infra Client uses to access the Chef Infra Server during the initial Chef Infra Client run.</p> </dd> <dt><code>-ValidationPem &lt;string&gt;</code></dt> <dd> <p>The location of the file that contains the key used when a Chef Infra Client is registered with a Chef Infra Server. A validation key is signed using the <code>validation_client_name</code> for authentication. Default value: <code>/etc/chef/validation.pem</code>.</p> </dd> <dt><code>-Version &lt;string&gt;</code></dt> <dd> <p>Specify the version number for the Azure Chef Extension extension. Default is to use the latest extensionâ€™s version number.</p> </dd> <dt><code>-Windows</code></dt> <dd> <p>Sets the Azure Chef Extension to run Microsoft Windows.</p> </dd> </dl> <h4 id="examples">Examples</h4> <p>The following examples show how to use the <code>Set-AzureVMChefExtension</code> cmdlet:</p> <h5 id="create-windows-virtual-machine">Create Windows virtual machine</h5> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash"><span style="color:#bb60d5">$vm1</span> <span style="color:#666">=</span> <span style="color:#4070a0">"azurechefwin"</span>
<span style="color:#bb60d5">$svc</span> <span style="color:#666">=</span> <span style="color:#4070a0">"azurechefwin"</span>
<span style="color:#bb60d5">$username</span> <span style="color:#666">=</span> <span style="color:#4070a0">'azure'</span>
<span style="color:#bb60d5">$password</span> <span style="color:#666">=</span> <span style="color:#4070a0">'azure@123'</span>

<span style="color:#bb60d5">$img</span> <span style="color:#666">=</span> <span style="color:#4070a0">"a699494373c04fc0bc8f2bb1389d6106__Windows-Server-2012-R2-201406.01-en.us-127GB.vhd"</span>

<span style="color:#bb60d5">$vmObj1</span> <span style="color:#666">=</span> New-AzureVMConfig -Name <span style="color:#bb60d5">$vm1</span> -InstanceSize Small -ImageName <span style="color:#bb60d5">$img</span>

<span style="color:#bb60d5">$vmObj1</span> <span style="color:#666">=</span> Add-AzureProvisioningConfig -VM <span style="color:#bb60d5">$vmObj1</span> -Password <span style="color:#bb60d5">$password</span> -AdminUsername <span style="color:#bb60d5">$username</span> -Windows

<span style="color:#60a0b0;font-style:italic"># set azure chef extension</span>
<span style="color:#bb60d5">$vmObj1</span> <span style="color:#666">=</span> Set-AzureVMChefExtension -VM <span style="color:#bb60d5">$vmObj1</span> -ValidationPem <span style="color:#4070a0">"C:\\users\\azure\\msazurechef-validator.pem"</span> -ClientRb
<span style="color:#4070a0">"C:\\users\\azure\\client.rb"</span> -RunList <span style="color:#4070a0">"getting-started"</span> -Windows

New-AzureVM -Location <span style="color:#4070a0">'West US'</span> -ServiceName <span style="color:#bb60d5">$svc</span> -VM <span style="color:#bb60d5">$vmObj1</span>
</code></pre></div>
<h5 id="create-centos-virtual-machine">Create CentOS virtual machine</h5> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash"><span style="color:#bb60d5">$vm1</span> <span style="color:#666">=</span> <span style="color:#4070a0">"azurecheflnx"</span>
<span style="color:#bb60d5">$svc</span> <span style="color:#666">=</span> <span style="color:#4070a0">"azurecheflnx"</span>
<span style="color:#bb60d5">$username</span> <span style="color:#666">=</span> <span style="color:#4070a0">'azure'</span>
<span style="color:#bb60d5">$password</span> <span style="color:#666">=</span> <span style="color:#4070a0">'azure@123'</span>

<span style="color:#60a0b0;font-style:italic"># CentOS image id</span>
<span style="color:#bb60d5">$img</span> <span style="color:#666">=</span> <span style="color:#4070a0">"5112500ae3b842c8b9c604889f8753c3__OpenLogic-CentOS-71-20150605"</span>

<span style="color:#bb60d5">$vmObj1</span> <span style="color:#666">=</span> New-AzureVMConfig -Name <span style="color:#bb60d5">$vm1</span> -InstanceSize Small -ImageName <span style="color:#bb60d5">$img</span>

<span style="color:#bb60d5">$vmObj1</span> <span style="color:#666">=</span> Add-AzureProvisioningConfig -VM <span style="color:#bb60d5">$vmObj1</span> -Password <span style="color:#bb60d5">$password</span> -Linux -LinuxUser <span style="color:#bb60d5">$username</span>

<span style="color:#60a0b0;font-style:italic"># set azure chef extension</span>
<span style="color:#bb60d5">$vmObj1</span> <span style="color:#666">=</span> Set-AzureVMChefExtension -VM <span style="color:#bb60d5">$vmObj1</span> -ValidationPem <span style="color:#4070a0">"C:\\users\\azure\\msazurechef-validator.pem"</span> -ClientRb
<span style="color:#4070a0">"C:\\users\\azure\\client.rb"</span> -RunList <span style="color:#4070a0">"getting-started"</span> -Linux

New-AzureVM -Location <span style="color:#4070a0">'West US'</span> -ServiceName <span style="color:#bb60d5">$svc</span> -VM <span style="color:#bb60d5">$vmObj1</span>
</code></pre></div>
<h5 id="create-ubuntu-virtual-machine">Create Ubuntu virtual machine</h5> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash"><span style="color:#bb60d5">$vm1</span> <span style="color:#666">=</span> <span style="color:#4070a0">"azurecheflnx"</span>
<span style="color:#bb60d5">$svc</span> <span style="color:#666">=</span> <span style="color:#4070a0">"azurecheflnx"</span>
<span style="color:#bb60d5">$username</span> <span style="color:#666">=</span> <span style="color:#4070a0">'azure'</span>
<span style="color:#bb60d5">$password</span> <span style="color:#666">=</span> <span style="color:#4070a0">'azure@123'</span>

<span style="color:#bb60d5">$img</span> <span style="color:#666">=</span> <span style="color:#4070a0">"b39f27a8b8c64d52b05eac6a62ebad85__ubuntu-20_04_5-LTS-amd64-server-20150127-en-us-30GB"</span>

<span style="color:#bb60d5">$vmObj1</span> <span style="color:#666">=</span> New-AzureVMConfig -Name <span style="color:#bb60d5">$vm1</span> -InstanceSize Small -ImageName <span style="color:#bb60d5">$img</span>

<span style="color:#bb60d5">$vmObj1</span> <span style="color:#666">=</span> Add-AzureProvisioningConfig -VM <span style="color:#bb60d5">$vmObj1</span> -Password <span style="color:#bb60d5">$password</span> -Linux -LinuxUser <span style="color:#bb60d5">$username</span>

<span style="color:#60a0b0;font-style:italic"># set azure chef extension</span>
<span style="color:#bb60d5">$vmObj1</span> <span style="color:#666">=</span> Set-AzureVMChefExtension -VM <span style="color:#bb60d5">$vmObj1</span> -ValidationPem <span style="color:#4070a0">"C:\\users\\azure\\msazurechef-validator.pem"</span> -ClientRb
<span style="color:#4070a0">"C:\\users\\azure\\client.rb"</span> -RunList <span style="color:#4070a0">"getting-started"</span> -Linux

New-AzureVM -Location <span style="color:#4070a0">'West US'</span> -ServiceName <span style="color:#bb60d5">$svc</span> -VM <span style="color:#bb60d5">$vmObj1</span>
</code></pre></div> </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; Chef Software, Inc.<br>Licensed under the Creative Commons Attribution 3.0 Unported License.<br>The Chef&trade; Mark and Chef Logo are either registered trademarks/service marks or trademarks/servicemarks of Chef, in the United States and other countries and are used with Chef Inc's permission.<br>We are not affiliated with, endorsed or sponsored by Chef Inc.<br>
    <a href="https://docs.chef.io/azure_powershell/" class="_attribution-link">https://docs.chef.io/azure_powershell/</a>
  </p>
</div>
