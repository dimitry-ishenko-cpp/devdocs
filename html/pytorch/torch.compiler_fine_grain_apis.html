<h1 id="torchdynamo-fine-grain-tracing">TorchDynamo APIs for fine-grained tracing</h1> <div class="admonition note" id="torchdynamo-apis-for-fine-grained-tracing"> <p class="admonition-title">Note</p> <p>In this document <code>torch.compiler.compile</code> and <code>torch.compile</code> are used interchangeably. Both versions will work in your code.</p> </div> <p><code>torch.compile</code> performs TorchDynamo tracing on the whole user model. However, it is possible that a small part of the model code cannot be handeled by <code>torch.compiler</code>. In this case, you might want to disable the compiler on that particular portion, while running compilation on the rest of the model. This section describe the existing APIs that use to define parts of your code in which you want to skip compilation and the relevant use cases.</p> <p>The API that you can use to define portions of the code on which you can disable compilation are listed in the following table:</p> <table class="colwidths-auto docutils align-default" id="id1"> <caption><span class="caption-text">TorchDynamo APIs to control fine-grained tracing</span></caption> <thead> <tr>
<th class="head"><p>API</p></th> <th class="head"><p>Description</p></th> <th class="head"><p>When to use?</p></th> </tr> </thead>  <tr>
<td><p><code>torch.compiler.disable</code></p></td> <td><p>Disables Dynamo on the decorated function as well as recursively invoked functions.</p></td> <td><p>Excellent for unblocking a user, if a small portion of the model cannot be handeled with <code>torch.compile</code>.</p></td> </tr> <tr>
<td><p><code>torch._dynamo.disallow_in_graph</code></p></td> <td><p>Disallows the marked op in the TorchDynamo graph. TorchDynamo causes graph break, and runs the op in the eager (no compile) mode.nnThis is suitable for the ops, while <code>torch.compiler.disable</code> is suitable for decorating functions.</p></td> <td><p>This API is excellent for both debugging and unblocking if a custom op like <code>torch.ops.fbgemm.*</code> is causing issues with the <code>torch.compile</code> function.</p></td> </tr> <tr>
<td><p><code>torch.compile.allow_in_graph</code></p></td> <td><p>The annotated callable goes as is in the TorchDynamo graph. For example, a black-box for TorchDynamo Dynamo.nnNote that AOT Autograd will trace through it, so the <code>allow_in_graph</code> is only a Dynamo-level concept.</p></td> <td><p>This API is useful for portions of the model which have known TorchDynamo hard-to-support features, like hooks or <code>autograd.Function</code>. However, each usage of <code>allow_in_graph</code> <strong>must be carefully screened</strong> (no graph breaks, no closures).</p></td> </tr> <tr>
<td><p><code>torch._dynamo.graph_break</code></p></td> <td><p>Adds a graph break. The code before and after the graph break goes through TorchDynamo.</p></td> <td><p><strong>Rarely useful for deployment</strong> - If you think you need this, most probably you need either <code>disable</code> or <code>disallow_in_graph</code>.</p></td> </tr>  </table>  <h2 id="torch-compiler-disable"><code>torch.compiler.disable</code></h2> <p><code>torch.compiler.disable</code> disables compilation on the decorated function frame and all the function frames recursively invoked from the decorated function frame.</p> <p>TorchDynamo intercepts the execution of each Python function frame. So, suppose you have a code structure (image below) where the function <code>fn</code> calls functions <code>a_fn</code> and <code>b_fn</code>. And <code>a_fn</code> calls <code>aa_fn</code> and <code>ab_fn</code>. When you use the PyTorch eager mode rather than <code>torch.compile</code>, these function frames run as is. With <code>torch.compile</code>, TorchDynamo intercepts each of these function frames (indicated by the green color):</p> <div class="figure align-default"> <img alt="Callstack diagram of differnet apis." src="data:image/png;base64,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"> </div> <p>Let’s imagine, that function <code>a_fn</code> is causing troubles with <code>torch.compile</code>. And this is a non-critical portion of the model. You can use <code>compiler.disable</code> on function <code>a_fn</code>. As shown above, TorchDynamo will stop looking at frames originating from the <code>a_fn</code> call (white color indicates original Python behavior).</p> <p>To skip compilation, you can decorate the offending function with <code>@torch.compiler.disable</code>.</p> <p>You can also use the non-decorator syntax if you don’t want to change the source code However, we recommend that you avoid this style if possible. Here, you have to take care that all users of the original function are now using the patched version.</p>   <h2 id="torch-dynamo-disallow-in-graph"><code>torch._dynamo.disallow_in_graph</code></h2> <p><code>torch._dynamo.disallow_in_graph</code> disallows an operator but not the function to be present in the TorchDynamo extracted graph. Note that this is suitable for operators and not general functions as in the case of <code>_dynamo.disable</code>.</p> <p>Let’s imagine you compile your model with PyTorch. TorchDynamo is able to extract a graph, but then you see the downstream compiler failing. For example, the meta kernel is missing, or some Autograd dispatch key is set incorrectly for a particular operator. Then you can mark that operator as <code>disallow_in_graph</code>, and TorchDynamo will cause a graph break and run that operator by using the PyTorch eager mode.</p> <p>The catch is that you will have to find the corresponding Dynamo level operator, and not the ATen level operator. See more in the Limitations section of the doc.</p> <div class="admonition warning"> <p class="admonition-title">Warning</p> <p><code>torch._dynamo.disallow_in_graph</code> is a global flag. If you are comparing different backend compilers, you might have to call <code>allow_in_graph</code> for the disallowed operator when switching to the other compiler.</p> </div>   <h2 id="torch-compiler-allow-in-graph"><code>torch.compiler.allow_in_graph</code></h2> <p><code>torch.compiler.allow_in_graph</code> is useful when the relevant function frame has some known hard-to-support TorchDynamo feature, such as hooks and <code>autograd.Function</code>, and you are confident that downstream PyTorch components such as AOTAutograd can safely trace through the decorated function. When a function is decorated with <code>allow_in_graph</code>, TorchDynamo treats it as a black-box and puts it as is in the generated graph.</p> <div class="admonition warning"> <p class="admonition-title">Warning</p> <p><code>allow_in_graph</code> skips TorchDynamo completely on the decorated function omitting all TorchDynamo safety checks, including graph breaks, handling closures, and others. Use <code>allow_in_graph</code> with caution. PyTorch downstream components, such as AOTAutograd rely on TorchDynamo to handle complex Python features, but <code>allow_in_graph</code> bypasses TorchDynamo. Using <code>allow_in_graph</code> could lead to soundness and hard-to-debug issues.</p> </div>   <h2 id="limitations">Limitations</h2> <p>All the existing APIs are applied at the TorchDynamo level. Therefore, these APIs have visibility to only what TorchDynamo sees. This can lead to confusing scenarios.</p> <p>For example, <code>torch._dynamo.disallow_in_graph</code> will not work for ATen operators because they are visible to AOT Autograd. For example, <code>torch._dynamo.disallow_in_graph(torch.ops.aten.add)</code> will not work in the above example.</p><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2024, PyTorch Contributors<br>PyTorch has a BSD-style license, as found in the <a href="https://github.com/pytorch/pytorch/blob/main/LICENSE">LICENSE</a> file.<br>
    <a href="https://pytorch.org/docs/2.1/torch.compiler_fine_grain_apis.html" class="_attribution-link">https://pytorch.org/docs/2.1/torch.compiler_fine_grain_apis.html</a>
  </p>
</div>
