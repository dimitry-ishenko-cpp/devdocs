<div class="innertube"> <h1 id="Upcoming Potential Incompatibilities">4 Upcoming Potential Incompatibilities</h1> <h2 id="introduction" class="title-link"> <div class="title-name">4.1 Introduction</div>  </h2> <p>This document lists planned upcoming potential incompatibilities in Erlang/OTP.</p> <h2 id="otp-27" class="title-link"> 4.2 otp 27  </h2> <h3 id="fun-creator-pid-will-always-be-local-init-process" class="title-link"> <div class="title-name">Fun creator pid will always be local init process</div>  </h3> <p> As of OTP 27, the functions <code> erlang:fun_info/1,2</code> will always say that the local <code>init</code> process created all funs, regardless of which process or node the fun was originally created on. </p> <p> In OTP 28, the <code>{pid,_}</code>element will be removed altogether.</p> <h3 id="feature-maybe_expr-will-be-enabled-by-default" class="title-link"> <div class="title-name">Feature maybe_expr will be enabled by default</div>  </h3> <p> As of OTP 27, the <code>maybe_expr</code> feature will be approved and enabled by default. That means that code that uses the unquoted atom <code>maybe</code> will fail to compile. All uses of <code>maybe</code> as an atom will need to be quoted. Alternatively, as a short-term solution, the <code>maybe_expr</code> feature can be disabled. </p> <p> It is recommend to quote all uses of the atom <code>maybe</code> as soon as possible. The compiler option <code>warn_keywords</code> can be used to emit warnings about all occurrences of <code>maybe</code> without quotes. </p> <h3 id="the-re-module-will-use-a-different-regular-expression-engine" class="title-link"> <div class="title-name">The re module will use a different regular expression engine</div>  </h3> <p>The functionality of module <code>re</code> is currently provided by the PCRE library, which is no longer actively maintained. Therefore, in OTP 27, we will switch to a different regular expression library.</p> <p>The source code for PCRE used by the <code>re</code> module has been modified by the OTP team to ensure that a regular expression match would yield when matching huge input binaries and/or when using demanding (back-tracking) regular expressions. Because of the those modifications, moving to a new version of PCRE has always been a time-consuming process because all of the modifications had to be applied by hand again to the updated PCRE source code.</p> <p>Most likely, the new regular expression library will be <code><a href="https://github.com/google/re2">RE2</a></code>. RE2 guarantees that the match time is linear in the length of input string, and it also eschews recursion to avoid stack overflow. That should make it possible to use RE2 without modifying its source code. For more information about why RE2 is a good choice, see <code><a href="https://github.com/google/re2/wiki/WhyRE2">WhyRE2</a></code>.</p> <p>Some of implications of this change are:</p> <ul> <li><p>We expect that the functions in the <code>re</code> module will continue to be supported, although some of the options are likely to be dis-continued.</p></li> <li><p>It is likely that only pattern matching of UTF8-encoded binaries will be supported (not Latin1-encoded binaries).</p></li> <li><p>In order to guarantee the linear-time performance, RE2 does not support all the constructs in regular expression patterns that PCRE do. For example, backreferences and look-around assertions are not supported. See <code><a href="https://github.com/google/re2/wiki/Syntax">Syntax</a></code> for a description of what RE2 supports.</p></li> <li><p>Compiling a regular expression is likely to be slower, and thus more can be gained by explicitly compiling the regular expression before matching with it.</p></li> </ul> <h3 id="0.0-and--0.0-will-no-longer-be-exactly-equal" class="title-link"> <div class="title-name">0.0 and -0.0 will no longer be exactly equal</div>  </h3> <p>Currently, the floating point numbers <code>0.0</code> and <code>-0.0</code> have distinct internal representations. That can be seen if they are converted to binaries:</p> <pre data-language="erlang">
1&gt; <code>&lt;&lt;0.0/float&gt;&gt;.</code>
&lt;&lt;0,0,0,0,0,0,0,0&gt;&gt;
2&gt; <code>&lt;&lt;-0.0/float&gt;&gt;.</code>
&lt;&lt;128,0,0,0,0,0,0,0&gt;&gt;</pre> <p>However, when they are matched against each other or compared using the <code>=:=</code> operator, they are considered to be equal. Thus, <code>0.0 =:= -0.0</code> currently returns <code>true</code>.</p> <p>In Erlang/OTP 27, <code>0.0 =:= -0.0</code> will return <code>false</code>, and matching <code>0.0</code> against <code>-0.0</code> will fail. When used as map keys, <code>0.0</code> and <code>-0.0</code> will be considered to be distinct.</p> <p>The <code>==</code> operator will continue to return <code>true</code> for <code>0.0 == -0.0</code>.</p> <p>To help to find code that might need to be revised, in OTP 27 there will be a new compiler warning when matching against <code>0.0</code> or comparing to that value using the <code>=:=</code> operator. The warning can be suppressed by matching against <code>+0.0</code> instead of <code>0.0</code>.</p> <p>We plan to introduce the same warning in OTP 26.1, but by default it will be disabled.</p> <h3 id="singleton-type-variables-will-become-a-compile-time-error" class="title-link"> <div class="title-name">Singleton type variables will become a compile-time error</div>  </h3> <p>Before Erlang/OTP 26, the compiler would silenty accept the following spec:</p> <pre data-language="erlang">
-spec f(Opts) -&gt; term() when
    Opts :: {ok, Unknown} | {error, Unknown}.
f(_) -&gt; error.</pre> <p>In OTP 26, the compiler emits a warning pointing out that the type variable <code>Unknown</code> is unbound:</p> <pre data-language="erlang">
t.erl:6:18: Warning: type variable 'Unknown' is only used once (is unbound)
%    6|     Opts :: {ok, Unknown} | {error, Unknown}.
%     |                  ^</pre> <p>In OTP 27, that warning will become an error.</p> <h2 id="otp-28" class="title-link"> 4.3 otp 28  </h2> <h3 id="fun-creator-pid-will-be-removed" class="title-link"> <div class="title-name">Fun creator pid will be removed</div>  </h3> <p> As of OTP 28, the function <code>erlang:fun_info/1</code> will not include the <code>{pid,_}</code> element and the function <code>erlang:fun_info/2</code> will no longer accept <code>pid</code> as the second argument.</p> <h2 id="otp-29" class="title-link"> 4.4 otp 29  </h2> <h3 id="it-will-no-longer-be-possible-to-disable-feature-maybe_expr" class="title-link"> <div class="title-name">It will no longer be possible to disable feature maybe_expr</div>  </h3> <p> As of OTP 29, the <code>maybe_expr</code> feature will become permanent and no longer possible to disable. All uses of <code>maybe</code> as an atom will need to be quoted. </p> <p> It is recommend to quote all uses of the atom <code>maybe</code> as soon as possible. The compiler option <code>warn_keywords</code> can be used to emit warnings about all occurrences of <code>maybe</code> without quotes. </p> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2010&ndash;2023 Ericsson AB<br>Licensed under the Apache License, Version 2.0.<br>
    
  </p>
</div>
