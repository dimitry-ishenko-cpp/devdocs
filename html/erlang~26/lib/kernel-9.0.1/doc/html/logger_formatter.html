  <div class="innertube"> <h2 id="module" class="title-link"> <div class="title-name">Module</div>  </h2> <div class="REFBODY module-body">logger_formatter</div> </div> <div class="innertube"> <h2 id="module-summary" class="title-link"> <div class="title-name">Module Summary</div>  </h2> <div class="REFBODY module-summary-body">Default formatter for Logger.</div> <h2 id="since" class="title-link"> <div class="title-name">Since</div>  </h2> <div class="REFBODY module-since"> Module logger_formatter was introduced in OTP 21.0. </div> </div> <section class="description"><div class="innertube"> <h2 id="description" class="title-link"> <div class="title-name">Description</div>  </h2> <div class="REFBODY description-body">

<p>Each Logger handler has a configured formatter specified as a module and a configuration term. The purpose of the formatter is to translate the log events to a final printable string (<code>unicode:chardata() </code>) which can be written to the output device of the handler. See sections <code><a href="logger_chapter.html#handlers">Handlers</a></code> and <code><a href="logger_chapter.html#formatters">Formatters</a></code> in the Kernel User's Guide for more information.</p> <p><code>logger_formatter</code> is the default formatter used by Logger.</p> </div> </div></section> <div class="innertube"> <h2 id="data-types" class="title-link"> <div class="title-name">Data Types</div>  </h2> <article class="data-types-body"><h3 id="type-config" class="title-link data-type-name">  <div class="title-name"> <pre data-language="erlang"><code><a name="type-config">config()</a> = 
 #{chars_limit =&gt; integer() &gt;= 1 | unlimited,
 depth =&gt; integer() &gt;= 1 | unlimited,
 legacy_header =&gt; boolean(),
 max_size =&gt; integer() &gt;= 1 | unlimited,
 report_cb =&gt; <a href="logger.html#type-report_cb">logger:report_cb()</a>,
 single_line =&gt; boolean(),
 template =&gt; <a href="#type-template">template()</a>,
 time_designator =&gt; byte(),
 time_offset =&gt; integer() | [byte()]}</code></pre>
<br> </div> </h3> <div class="data-type-desc"><div class="REFBODY rb-7"> <p>The configuration term for <code>logger_formatter</code> is a <code>map</code>, and the following keys can be set as configuration parameters:</p> <dl> <dt class="title-link"><strong> <code id="chars_limit">chars_limit = integer() &gt; 0 | unlimited</code></strong></dt> <dd> <p>A positive integer representing the value of the option with the same name to be used when calling <code> io_lib:format/3</code>. This value limits the total number of characters printed for each log event. Notice that this is a soft limit. For a hard truncation limit, see option <code>max_size</code>.</p> <p>Defaults to <code>unlimited</code>.</p> </dd> <dt class="title-link"><strong><code id="depth">depth = integer() &gt; 0 | unlimited</code></strong></dt> <dd> <p>A positive integer representing the maximum depth to which terms shall be printed by this formatter. Format strings passed to this formatter are rewritten. The format controls ~p and ~w are replaced with ~P and ~W, respectively, and the value is used as the depth parameter. For details, see <code>io:format/2,3</code> in STDLIB.</p> <p>Defaults to <code>unlimited</code>.</p> </dd> <dt class="title-link"><strong><code>legacy_header = boolean()</code></strong></dt> <dd> <p>If set to <code>true</code> a header field is added to logger_formatter's part of <code>Metadata</code>. The value of this field is a string similar to the header created by the old <code><a href="error_logger.html">error_logger</a></code> event handlers. It can be included in the log event by adding the list <code>[logger_formatter,header]</code> to the template. See the description of the <code><a href="#type-template">template()</a></code> type for more information.</p> <p>Defaults to <code>false</code>.</p> </dd> <dt class="title-link"><strong> <code id="max_size">max_size = integer() &gt; 0 | unlimited</code></strong></dt> <dd> <p>A positive integer representing the absolute maximum size a string returned from this formatter can have. If the formatted string is longer, after possibly being limited by <code>chars_limit</code> or <code>depth</code>, it is truncated.</p> <p>Defaults to <code>unlimited</code>.</p> </dd> <dt class="title-link"><strong><code>report_cb =</code><code><a href="logger.html#type-report_cb"> logger:report_cb()</a></code></strong></dt> <dd> <p>A report callback is used by the formatter to transform log messages on report form to a format string and arguments. The report callback can be specified in the metadata for the log event. If no report callback exists in metadata, <code>logger_formatter</code> will use <code><a href="logger.html#format_report-1"> logger:format_report/1</a></code> as default callback.</p> <p>If this configuration parameter is set, it replaces both the default report callback, and any report callback found in metadata. That is, all reports are converted by this configured function.</p> </dd> <dt class="title-link"><strong><code>single_line = boolean()</code></strong></dt> <dd> <p>If set to <code>true</code>, each log event is printed as a single line. To achieve this, <code>logger_formatter</code> sets the field width to <code>0</code> for all <code>~p</code> and <code>~P</code> control sequences in the format a string (see <code> io:format/2</code>), and replaces all newlines in the message with <code>", "</code>. White spaces following directly after newlines are removed. Notice that newlines added by the <code>template</code> parameter are not replaced.</p> <p>Defaults to <code>true</code>.</p> </dd> <dt class="title-link"><strong> <code id="template">template =</code><code><a href="#type-template">template() </a></code></strong></dt> <dd> <p>The template describes how the formatted string is composed by combining different data values from the log event. See the description of the <code><a href="#type-template">template()</a></code> type for more information about this.</p> </dd> <dt class="title-link"><strong><code>time_designator = byte()</code></strong></dt> <dd> <p>Timestamps are formatted according to RFC3339, and the time designator is the character used as date and time separator.</p> <p>Defaults to <code>$T</code>.</p> <p>The value of this parameter is used as the <code>time_designator</code> option to <code> calendar:system_time_to_rfc3339/2</code>.</p> </dd> <dt class="title-link"><strong><code>time_offset = integer() | [byte()]</code></strong></dt> <dd> <p>The time offset, either a string or an integer, to be used when formatting the timestamp.</p> <p>An empty string is interpreted as local time. The values <code>"Z"</code>, <code>"z"</code> or <code>0</code> are interpreted as Universal Coordinated Time (UTC).</p> <p>Strings, other than <code>"Z"</code>, <code>"z"</code>, or <code>""</code>, must be on the form <code>Â±[hh]:[mm]</code>, for example <code>"-02:00"</code> or <code>"+00:00"</code>.</p> <p>Integers must be in microseconds, meaning that the offset <code>7200000000</code> is equivalent to <code>"+02:00"</code>.</p> <p>Defaults to an empty string, meaning that timestamps are displayed in local time. However, for backwards compatibility, if the SASL configuration parameter <code> utc_log</code><code>=true</code>, the default is changed to <code>"Z"</code>, meaning that timestamps are displayed in UTC.</p> <p>The value of this parameter is used as the <code>offset</code> option to <code> calendar:system_time_to_rfc3339/2</code>.</p> </dd> </dl> </div></div></article> <article class="data-types-body"><h3 id="type-metakey" class="title-link data-type-name">  <div class="title-name"> <code><a name="type-metakey">metakey()</a> = atom() | [atom()]</code><br> </div> </h3> </article> <article class="data-types-body"><h3 id="type-template" class="title-link data-type-name">  <div class="title-name"> <pre data-language="erlang"><code><a name="type-template">template()</a> = 
 [<a href="#type-metakey">metakey()</a> |
 {<a href="#type-metakey">metakey()</a>, <a href="#type-template">template()</a>, <a href="#type-template">template()</a>} |
 unicode:chardata()]</code></pre>
<br> </div> </h3> <div class="data-type-desc"><div class="REFBODY rb-7"> <p>The template is a list of atoms, atom lists, tuples and strings. The atoms <code>level</code> or <code>msg</code>, are treated as placeholders for the severity level and the log message, respectively. Other atoms or atom lists are interpreted as placeholders for metadata, where atoms are expected to match top level keys, and atom lists represent paths to sub keys when the metadata is a nested map. For example the list <code>[key1,key2]</code> is replaced by the value of the <code>key2</code> field in the nested map below. The atom <code>key1</code> on its own is replaced by the complete value of the <code>key1</code> field. The values are converted to strings.</p> <pre data-language="erlang">#{key1 =&gt; #{key2 =&gt; my_value,
            ...}
  ...}</pre> <p>Tuples in the template express if-exist tests for metadata keys. For example, the following tuple says that if <code>key1</code> exists in the metadata map, print <code>"key1=Value"</code>, where <code>Value</code> is the value that <code>key1</code> is associated with in the metadata map. If <code>key1</code> does not exist, print nothing.</p> <pre data-language="erlang">{key1, ["key1=",key1], []}</pre> <p>Strings in the template are printed literally.</p> <p>The default value for the <code>template</code> configuration parameter depends on the value of the <code>single_line</code> and <code>legacy_header</code> configuration parameters as follows.</p> <p>The log event used in the examples is:</p> <pre data-language="erlang">?LOG_ERROR("name: ~p~nexit_reason: ~p", [my_name, "It crashed"])</pre> <dl> <dt class="title-link"><strong><code>legacy_header = true, single_line = false</code></strong></dt> <dd> <p>Default template: <code>[[logger_formatter,header],"\n",msg,"\n"]</code></p> <p>Example log entry:</p> <pre data-language="erlang">=ERROR REPORT==== 17-May-2018::18:30:19.453447 ===
name: my_name
exit_reason: "It crashed"</pre> <p>Notice that all eight levels can occur in the heading, not only <code>ERROR</code>, <code>WARNING</code> or <code>INFO</code> as <code><a href="error_logger.html">error_logger</a></code> produces. And microseconds are added at the end of the timestamp.</p> </dd> <dt class="title-link"><strong><code>legacy_header = true, single_line = true</code></strong></dt> <dd> <p>Default template: <code>[[logger_formatter,header],"\n",msg,"\n"]</code></p> <p>Notice that the template is here the same as for <code>single_line=false</code>, but the resulting log entry differs in that there is only one line after the heading:</p> <pre data-language="erlang">=ERROR REPORT==== 17-May-2018::18:31:06.952665 ===
name: my_name, exit_reason: "It crashed"</pre> </dd> <dt class="title-link"><strong><code>legacy_header = false, single_line = true</code></strong></dt> <dd> <p>Default template: <code>[time," ",level,": ",msg,"\n"]</code></p> <p>Example log entry:</p> <pre data-language="erlang">2018-05-17T18:31:31.152864+02:00 error: name: my_name, exit_reason: "It crashed"</pre> </dd> <dt class="title-link"><strong><code>legacy_header = false, single_line = false</code></strong></dt> <dd> <p>Default template: <code>[time," ",level,":\n",msg,"\n"]</code></p> <p>Example log entry:</p> <pre data-language="erlang">2018-05-17T18:32:20.105422+02:00 error:
name: my_name
exit_reason: "It crashed"</pre> </dd> </dl> </div></div></article> </div> <div class="innertube"><h2 id="export" class="title-link"> <div class="title-name">Exports</div>  </h2></div> <div class="exports-body"> <article class="func"><h3 id="check_config-1" class="bold_code title-link func-head">  <code>check_config(Config) -&gt; ok | {error, <code>term()</code>}</code><div class="title-since"><span class="since">OTP 21.0</span></div> </h3> <div class="REFBODY fun-types"> <h4 id="types" class="func-types-title">Types</h4> <div class="REFTYPES rt-1"><code>Config = <a href="#type-config">config()</a></code></div> </div> <div class="exports-tube"><div class="REFBODY rb-7"> <p>The function is called by Logger when the formatter configuration for a handler is set or modified. It returns <code>ok</code> if the configuration is valid, and <code>{error,term()}</code> if it is faulty.</p> <p>The following Logger API functions can trigger this callback:</p> <ul> <li><code><a href="logger.html#add_handler-3"> logger:add_handler/3</a></code></li> <li><code><a href="logger.html#set_handler_config-2"> logger:set_handler_config/2,3</a></code></li> <li><code><a href="logger.html#update_handler_config-2"> logger:update_handler_config/2</a></code></li> <li><code><a href="logger.html#update_formatter_config-2"> logger:update_formatter_config/2</a></code></li> </ul> </div></div></article><article class="func"><h3 id="format-2" class="bold_code title-link func-head">  <code>format(LogEvent, Config) -&gt; <code>unicode:chardata()</code></code><div class="title-since"><span class="since">OTP 21.0</span></div> </h3> <div class="REFBODY fun-types"> <h4 id="types" class="func-types-title">Types</h4> <div class="REFTYPES rt-1"><code>LogEvent = <a href="logger.html#type-log_event">logger:log_event()</a></code></div> <div class="REFTYPES rt-1"><code>Config = <a href="#type-config">config()</a></code></div> </div> <div class="exports-tube"><div class="REFBODY rb-7"> <p>This the formatter callback function to be called from handlers. The log event is processed as follows:</p> <ul> <li>If the message is on report form, it is converted to <code>{Format,Args}</code> by calling the report callback. See section <code><a href="logger_chapter.html#log_message">Log Message</a></code> in the Kernel User's Guide for more information about report callbacks and valid forms of log messages.</li> <li>The message size is limited according to the values of configuration parameters <code><a href="#chars_limit"> chars_limit</a></code> and <code><a href="#depth">depth</a></code>.</li> <li>The full log entry is composed according to the <code><a href="#template">template</a></code>.</li> <li>If the final string is too long, it is truncated according to the value of configuration parameter <code><a href="#max_size">max_size</a></code>.</li> </ul> </div></div></article> </div> <section class="innertube"><h2 id="see-also" class="title-link"> <div class="title-name">See Also</div>  </h2> <div class="REFBODY rb-3"> <p> <code>calendar(3)</code>, <code><a href="error_logger.html">error_logger(3)</a></code>, <code>io(3)</code>, <code>io_lib(3)</code>, <code><a href="logger.html">logger(3)</a></code>, <code>maps(3)</code>, <code>sasl(6)</code>, <code>unicode(3)</code> </p> </div></section><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2010&ndash;2023 Ericsson AB<br>Licensed under the Apache License, Version 2.0.<br>
    
  </p>
</div>
