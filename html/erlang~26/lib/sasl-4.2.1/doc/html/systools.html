  <div class="innertube"> <h2 id="module" class="title-link"> <div class="title-name">Module</div>  </h2> <div class="REFBODY module-body">systools</div> </div> <div class="innertube"> <h2 id="module-summary" class="title-link"> <div class="title-name">Module Summary</div>  </h2> <div class="REFBODY module-summary-body">A Set of Release Handling Tools</div> </div> <section class="description"><div class="innertube"> <h2 id="description" class="title-link"> <div class="title-name">Description</div>  </h2> <div class="REFBODY description-body">

<p>This module contains functions to generate boot scripts (<code>.boot</code>, <code>.script</code>), a release upgrade file (<code>relup</code>), and release packages.</p> </div> </div></section> <div class="innertube"><h2 id="export" class="title-link"> <div class="title-name">Exports</div>  </h2></div> <div class="exports-body"> <article class="func"><div class="bold_code func-head"><h3 id="make_relup-3" class="title-link">  <div class="title-name">make_relup(Name, UpFrom, DownTo) -&gt; Result</div> </h3></div> <div class="bold_code func-head"><h3 id="make_relup-4" class="title-link">  <div class="title-name">make_relup(Name, UpFrom, DownTo, [Opt]) -&gt; Result</div> </h3></div> <div class="exports-tube"> <div class="REFBODY rb-5"> <h2 id="types" class="func-types-title">Types</h2> <div class="REFTYPES rt-4"> <code>Name = string()</code><br> </div> <div class="REFTYPES rt-4"> <code>UpFrom = DownTo = [Name | {Name,Descr}]</code><br> </div> <div class="REFTYPES rt-4"> <code>Descr = term()</code><br> </div> <div class="REFTYPES rt-4"> <code>Opt = {path,[Dir]} | restart_emulator | silent | noexec | {outdir,Dir} | warnings_as_errors</code><br> </div> <div class="REFTYPES rt-4"> <code>Dir = string()</code><br> </div> <div class="REFTYPES rt-4"> <code>Result = ok | error | {ok,Relup,Module,Warnings} | {error,Module,Error}</code><br> </div> <div class="REFTYPES rt-4"> <code>Relup, see relup(4)</code><br> </div> <div class="REFTYPES rt-4"> <code>Module = atom()</code><br> </div> <div class="REFTYPES rt-4"> <code>Warnings = Error = term()</code><br> </div> </div> <div class="REFBODY rb-7"> <p>Generates a release upgrade file <code>relup</code> containing instructions for upgrading from or downgrading to one or more previous releases. The instructions are used by <code><a href="release_handler.html">release_handler</a></code> when installing a new version of a release in runtime.</p> <p>By default, <code>relup</code> file is located in the current working directory. If option <code>{outdir,Dir}</code> is specified, the <code>relup</code> file is located in <code>Dir</code> instead.</p> <p>The release resource file <code>Name.rel</code> is compared with all release resource files <code>Name2.rel</code>, specified in <code>UpFrom</code> and <code>DownTo</code>. For each such pair, the following is deducted:</p> <ul> <li> <p>Which applications to be deleted, that is, applications listed in <code>Name.rel</code> but not in <code>Name2.rel</code></p> </li> <li> <p>Which applications to be added, that is, applications listed in <code>Name2.rel</code> but not in <code>Name.rel</code></p> </li> <li> <p>Which applications to be upgraded/downgraded, that is, applications listed in both <code>Name.rel</code> and <code>Name2.rel</code> but with different versions</p> </li> <li> <p>If the emulator needs to be restarted after upgrading or downgrading, that is, if the ERTS version differs between <code>Name.rel</code> and <code>Name2.rel</code></p> </li> </ul> <p>Instructions for this are added to the <code>relup</code> file in the above order. Instructions for upgrading or downgrading between application versions are fetched from the relevant application upgrade files <code>App.appup</code>, sorted in the same order as when generating a boot script, see <code><a href="#make_script-1">make_script/1,2</a></code>. High-level instructions are translated into low-level instructions and the result is printed to the <code>relup</code> file.</p> <p>The optional <code>Descr</code> parameter is included "as is" in the <code>relup</code> file, see <code><a href="relup.html">relup(4)</a></code>. Defaults to the empty list.</p> <p>All the files are searched for in the code path. It is assumed that the <code>.app</code> and <code>.appup</code> files for an application are located in the same directory.</p> <p>If option <code>{path,[Dir]}</code> is specified, this path is appended to the current path. Wildcard <code>*</code> is expanded to all matching directories, for example, <code>lib/*/ebin</code>.</p> <p>If option <code>restart_emulator</code> is specified, a low-level instruction to restart the emulator is appended to the <code>relup</code> file. This ensures that a complete reboot of the system is done when the system is upgraded or downgraded.</p> <p>If an upgrade includes a change from an emulator earlier than OTP R15 to OTP R15 or later, the warning <code>pre_R15_emulator_upgrade</code> is issued. For more information about this, see <code>Design Principles</code> in <strong>System Documentation</strong>.</p> <p>By default, errors and warnings are printed to tty and the function returns <code>ok</code> or <code>error</code>. If option <code>silent</code> is specified, the function instead either returns <code>{ok,Relup,Module,Warnings}</code>, where <code>Relup</code> is the release upgrade file, or <code>{error,Module,Error}</code>. Warnings and errors can be converted to strings by calling <code>Module:format_warning(Warnings)</code> or <code>Module:format_error(Error)</code>.</p> <p>If option <code>noexec</code> is specified, the function returns the same values as for <code>silent</code> but no <code>relup</code> file is created.</p> <p>If option <code>warnings_as_errors</code> is specified, warnings are treated as errors.</p> </div> </div></article><article class="func"><div class="bold_code func-head"><h3 id="make_script-1" class="title-link">  <div class="title-name">make_script(Name) -&gt; Result</div> </h3></div> <div class="bold_code func-head"><h3 id="make_script-2" class="title-link">  <div class="title-name">make_script(Name, [Opt]) -&gt; Result</div> </h3></div> <div class="exports-tube"> <div class="REFBODY rb-5"> <h2 id="types" class="func-types-title">Types</h2> <div class="REFTYPES rt-4"> <code>Name = string()</code><br> </div> <div class="REFTYPES rt-4"> <code>Opt = src_tests | {path,[Dir]} | local | {variables,[Var]} | exref | {exref,[App]}] | silent | {outdir,Dir} | no_dot_erlang | no_warn_sasl | warnings_as_errors | {script_name, Name}</code><br> </div> <div class="REFTYPES rt-4"> <code>Dir = string()</code><br> </div> <div class="REFTYPES rt-4"> <code>Var = {VarName,Prefix}</code><br> </div> <div class="REFTYPES rt-4"> <code>VarName = Prefix = string()</code><br> </div> <div class="REFTYPES rt-4"> <code>App = atom()</code><br> </div> <div class="REFTYPES rt-4"> <code>Result = ok | error | {ok,Module,Warnings} | {error,Module,Error}</code><br> </div> <div class="REFTYPES rt-4"> <code>Module = atom()</code><br> </div> <div class="REFTYPES rt-4"> <code>Warnings = Error = term()</code><br> </div> </div> <div class="REFBODY rb-7"> <p>Generates a boot script <code>Name.script</code> and its binary version, the boot file <code>Name.boot</code>, unless the <code>{script_name, ScriptName}</code> option is given, in which case the names are <code>ScriptName.script</code> and <code>ScriptName.boot</code> The boot file specifies which code to be loaded and which applications to be started when the Erlang runtime system is started. See <code><a href="script.html">script(4)</a></code>.</p> <p>The release resource file <code>Name.rel</code> is read to determine which applications are included in the release. Then the relevant application resource files <code>App.app</code> are read to determine which modules to be loaded, and if and how the applications are to be started. (Keys <code>modules</code> and <code>mod</code>, see <code>app(4)</code>.</p> <p>By default, the boot script and boot file are located in the same directory as <code>Name.rel</code>. That is, in the current working directory unless <code>Name</code> contains a path. If option <code>{outdir,Dir}</code> is specified, they are located in <code>Dir</code> instead.</p> <p>The correctness of each application is checked as follows:</p> <ul> <li> <p>The version of an application specified in the <code>.rel</code> file is to be the same as the version specified in the <code>.app</code> file.</p> </li> <li> <p>There are to be no undefined applications, that is, dependencies to applications that are not included in the release. (Key <code>applications</code> in the <code>.app</code> file).</p> </li> <li> <p>There are to be no circular dependencies among the applications.</p> </li> <li> <p>There are to be no duplicated modules, that is, modules with the same name but belonging to different applications.</p> </li> <li> <p>If option <code>src_tests</code> is specified, a warning is issued if the source code for a module is missing or is newer than the object code.</p> </li> </ul> <p>The applications are sorted according to the dependencies between the applications. Where there are no dependencies, the order in the <code>.rel</code> file is kept.</p> <p>The function fails if the mandatory applications Kernel and STDLIB are not included in the <code>.rel</code> file and have start type <code>permanent</code> (which is default).</p> <p>If SASL is not included as an application in the <code>.rel</code> file, a warning is issued because such a release cannot be used in an upgrade. To turn off this warning, add option <code>no_warn_sasl</code>.</p> <p>All files are searched for in the current path. It is assumed that the <code>.app</code> and <code>.beam</code> files for an application are located in the same directory. The <code>.erl</code> files are also assumed to be located in this directory, unless it is an <code>ebin</code> directory in which case they can be located in the corresponding <code>src</code> directory.</p> <p>If option <code>{path,[Dir]}</code> is specified, this path is appended to the current path. A directory in the path can be specified with a wildcard <code>*</code>, this is expanded to all matching directories. Example: <code>"lib/*/ebin"</code>.</p> <p>In the generated boot script all application directories are structured as <code>App-Vsn/ebin</code>. They are assumed to be located in <code>$ROOT/lib</code>, where <code>$ROOT</code> is the root directory of the installed release. If option <code>local</code> is specified, the actual directories where the applications were found are used instead. This is a useful way to test a generated boot script locally.</p> <p>Option <code>variables</code> can be used to specify an installation directory other than <code>$ROOT/lib</code> for some of the applications. If a variable <code>{VarName,Prefix}</code> is specified and an application is found in a directory <code>Prefix/Rest/App[-Vsn]/ebin</code>, this application gets the path <code>VarName/Rest/App-Vsn/ebin</code> in the boot script. If an application is found in a directory <code>Prefix/Rest</code>, the path is <code>VarName/Rest/App-Vsn/ebin</code>. When starting Erlang, all variables <code>VarName</code> are given values using command-line flag <code>boot_var</code>.</p> <p><strong>Example:</strong> If option <code>{variables,[{"TEST","lib"}]}</code> is specified and <code>myapp.app</code> is found in <code>lib/myapp/ebin</code>, the path to this application in the boot script is <code>"$TEST/myapp-1/ebin"</code>. If <code>myapp.app</code> is found in <code>lib/test</code>, the path is <code>$TEST/test/myapp-1/ebin</code>.</p> <p>The checks performed before the boot script is generated can be extended with some cross reference checks by specifying option <code>exref</code>. These checks are performed with the Xref tool. All applications, or the applications specified with <code>{exref,[App]}</code>, are checked by Xref and warnings are issued for calls to undefined functions.</p> <p>By default, errors and warnings are printed to tty and the function returns <code>ok</code> or <code>error</code>. If option <code>silent</code> is specified, the function instead returns <code>{ok,Module,Warnings}</code> or <code>{error,Module,Error}</code>. Warnings and errors can be converted to strings by calling <code>Module:format_warning(Warnings)</code> or <code>Module:format_error(Error)</code>.</p> <p>If option <code>warnings_as_errors</code> is specified, warnings are treated as errors.</p> <p>If option <code>no_dot_erlang</code> is specified, the instruction to load the <code>.erlang</code> file during boot is <strong>not</strong> included.</p> </div> </div></article><article class="func"><h3 id="make_tar-1" class="bold_code title-link func-head">  <code>make_tar(Name) -&gt; Result</code> </h3> <h3 id="make_tar-2" class="bold_code title-link func-head">  <code>make_tar(Name, Opts) -&gt; Result</code> </h3> <div class="REFBODY fun-types"> <h4 id="types" class="func-types-title">Types</h4> <div class="REFTYPES rt-1"><code>Name = string()</code></div> <div class="REFTYPES rt-1"><code>Opts = [Opt]</code></div> <div class="REFTYPES rt-1"><pre><code>Opt = 
 {dirs, [IncDir]} |
 {path, [Dir]} |
 {variables, [Var]} |
 {var_tar, VarTar} |
 {erts, Dir} |
 erts_all | src_tests | exref |
 {exref, [App]} |
 silent |
 {outdir, Dir} |
 no_warn_sasl | warnings_as_errors |
 {extra_files, ExtraFiles}</code></pre></div> <div class="REFTYPES rt-1"><code>Dir = file:filename_all()</code></div> <div class="REFTYPES rt-1"><code>IncDir = src | include | atom()</code></div> <div class="REFTYPES rt-1"><code>Var = {VarName, PreFix}</code></div> <div class="REFTYPES rt-1"><code>VarName = PreFix = string()</code></div>  <div class="REFTYPES rt-1"><code>VarTar = include | ownfile | omit</code></div> <div class="REFTYPES rt-1"><code>App = atom()</code></div> <div class="REFTYPES rt-1"><pre><code>Result = 
 ok | error |
 {ok, Module :: module(), Warnings :: term()} |
 {error, Module :: module(), Error :: term()}</code></pre></div> <div class="REFTYPES rt-1"><code>ExtraFiles = [{NameInArchive, file:filename_all()}]</code></div> <div class="REFTYPES rt-1"><code>NameInArchive = string()</code></div> </div> <div class="exports-tube"><div class="REFBODY rb-7"> <p>Creates a release package file <code>Name.tar.gz</code>. This file must be uncompressed and unpacked on the target system using <code><a href="release_handler.html">release_handler</a></code> before the new release can be installed.</p> <p>The release resource file <code>Name.rel</code> is read to determine which applications are included in the release. Then the relevant application resource files <code>App.app</code> are read to determine the version and modules of each application (keys <code>vsn</code> and <code>modules</code>, see <code>app(4)</code>).</p> <p>By default, the release package file is located in the same directory as <code>Name.rel</code>. That is, in the current working directory unless <code>Name</code> contains a path. If option <code>{outdir,Dir}</code> is specified, it is located in <code>Dir</code> instead.</p> <p>If SASL is not included as an application in the <code>.rel</code> file, a warning is issued because such a release cannot be used in an upgrade. To turn off this warning, add option <code>no_warn_sasl</code>.</p> <p>By default, the release package contains the directories <code>lib/App-Vsn/ebin</code> and <code>lib/App-Vsn/priv</code> for each included application. If more directories are to be included, option <code>dirs</code> is specified, for example, <code>{dirs,[src,examples]}</code>.</p> <p>All these files are searched for in the current path. If option <code>{path,[Dir]}</code> is specified, this path is appended to the current path. Wildcard <code>*</code> is expanded to all matching directories. Example: <code>"lib/*/ebin"</code>.</p> <p>If the <code>{extra_files, ExtraFiles}</code> option is given then the <code>ExtraFiles</code> are added to the tarball after everything else to be included has been added. The <code>ExtraFiles</code> list is a list of files or directories in the same format as the <code>add_type()</code> tuple for <code>erl_tar:add/3,4</code></p> <p>Option <code>variables</code> can be used to specify an installation directory other than <code>lib</code> for some of the applications. If variable <code>{VarName,Prefix}</code> is specified and an application is found in directory <code>Prefix/Rest/App[-Vsn]/ebin</code>, this application is packed into a separate <code>VarName.tar.gz</code> file as <code>Rest/App-Vsn/ebin</code>.</p> <p><strong>Example:</strong> If option <code>{variables,[{"TEST","lib"}]}</code> is specified and <code>myapp.app</code> is located in <code>lib/myapp-1/ebin</code>, application <code>myapp</code> is included in <code>TEST.tar.gz</code>:</p> <pre data-language="erlang">
% <code>tar tf TEST.tar</code>
myapp-1/ebin/myapp.app
...</pre> <p>Option <code>{var_tar,VarTar}</code> can be used to specify if and where a separate package is to be stored. In this option <code>VarTar</code> is one of the following:</p> <dl> <dt class="title-link"><strong><code>include</code></strong></dt> <dd><p>Each separate (variable) package is included in the main <code>ReleaseName.tar.gz</code> file. This is the default.</p></dd> <dt class="title-link"><strong><code>ownfile</code></strong></dt> <dd><p>Each separate (variable) package is generated as a separate file in the same directory as the <code>ReleaseName.tar.gz</code> file.</p></dd> <dt class="title-link"><strong><code>omit</code></strong></dt> <dd><p>No separate (variable) packages are generated. Applications that are found underneath a variable directory are ignored.</p></dd> </dl> <p>A directory <code>releases</code> is also included in the release package, containing <code>Name.rel</code> and a subdirectory <code>RelVsn</code>. <code>RelVsn</code> is the release version as specified in <code>Name.rel</code>.</p> <p><code>releases/RelVsn</code> contains the boot script <code>Name.boot</code> renamed to <code>start.boot</code> and, if found, the files <code>relup</code> and <code>sys.config</code> or <code>sys.config.src</code>. These files are searched for in the same directory as <code>Name.rel</code>, in the current working directory, and in any directories specified using option <code>path</code>. In the case of <code>sys.config</code> it is not included if <code>sys.config.src</code> is found.</p> <p>If the release package is to contain a new Erlang runtime system, the <code>erts-ErtsVsn/bin</code> directory of the specified runtime system <code>{erts,Dir}</code> is copied to <code>erts-ErtsVsn/bin</code>. Some erts executables are not copied by default, if you want to include all executables you can give the <code>erts_all</code> option.</p> <p>All checks with function <code><a href="#make_script-1">make_script</a></code> are performed before the release package is created. Options <code>src_tests</code> and <code>exref</code> are also valid here.</p> <p>The return value and the handling of errors and warnings are the same as described for <code><a href="#make_script-1">make_script</a></code>.</p> </div></div></article><article class="func"><div class="bold_code func-head"><h3 id="script2boot-1" class="title-link">  <div class="title-name">script2boot(File) -&gt; ok | error</div> </h3></div> <div class="exports-tube"> <div class="REFBODY rb-5"> <h2 id="types" class="func-types-title">Types</h2> <div class="REFTYPES rt-4"> <code>File = string()</code><br> </div> </div> <div class="REFBODY rb-7"> <p>The Erlang runtime system requires that the contents of the script used to boot the system is a binary Erlang term. This function transforms the <code>File.script</code> boot script to a binary term, which is stored in the <code>File.boot</code> file.</p> <p>A boot script generated using <code><a href="#make_script-1">make_script</a></code> is already transformed to the binary form.</p> </div> </div></article> </div> <section class="innertube"><h2 id="see-also" class="title-link"> <div class="title-name">See Also</div>  </h2> <div class="REFBODY rb-3"> <p><code>app(4)</code>, <code><a href="appup.html">appup(4)</a></code>, <code>erl(1)</code>, <code><a href="rel.html">rel(4)</a></code>, <code><a href="release_handler.html">release_handler(3)</a></code>, <code><a href="relup.html">relup(4)</a></code>, <code><a href="script.html">script(4)</a></code></p> </div></section><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2010&ndash;2023 Ericsson AB<br>Licensed under the Apache License, Version 2.0.<br>
    
  </p>
</div>
