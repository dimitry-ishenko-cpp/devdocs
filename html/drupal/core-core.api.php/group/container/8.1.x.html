<h1 id="page-subtitle">Services and Dependency Injection Container</h1>      <p>Overview of the Dependency Injection Container and Services.</p> <h3 id="sec_overview">Overview of container, injection, and services</h3> <p>The Services and Dependency Injection Container concepts have been adopted by Drupal from the <a href="http://symfony.com/">Symfony framework.</a> A "service" (such as accessing the database, sending email, or translating user interface text) is defined (given a name and an interface or at least a class that defines the methods that may be called), and a default class is designated to provide the service. These two steps must be done together, and can be done by Drupal Core or a module. Other modules can then define alternative classes to provide the same services, overriding the default classes. Classes and functions that need to use the service should always instantiate the class via the dependency injection container (also known simply as the "container"), rather than instantiating a particular service provider class directly, so that they get the correct class (default or overridden).</p> <p>See <a href="https://www.drupal.org/node/2133171">https://www.drupal.org/node/2133171</a> for more detailed information on services and the dependency injection container.</p> <h3 id="sec_discover">Discovering existing services</h3> <p>Drupal core defines many core services in the <a href="https://api.drupal.org/api/drupal/core%21core.services.yml/8.1.x" title="core/core.services.yml" class="local">core.services.yml</a> file (in the top-level core directory). Some Drupal Core modules and contributed modules also define services in modulename.services.yml files. API reference sites (such as <a href="https://api.drupal.org">https://api.drupal.org</a>) generate lists of all existing services from these files. Look for the Services link in the API Navigation block. Alternatively you can look through the individual files manually.</p> <p>A typical service definition in a *.services.yml file looks like this:</p> <pre class="php" data-language="php">path.alias_manager:
  class: Drupal\Core\Path\AliasManager
  arguments: ['@path.crud', '@path.alias_whitelist', '@language_manager']
</pre>
<p> Some services use other services as factories; a typical service definition is:</p> <pre class="php" data-language="php">  cache.entity:
    class: Drupal\Core\Cache\CacheBackendInterface
    tags:
      - { name: cache.bin }
    factory: cache_factory:get
    arguments: [entity]
</pre>
<p> The first line of a service definition gives the unique machine name of the service. This is often prefixed by the module name if provided by a module; however, by convention some service names are prefixed by a group name instead, such as cache.* for cache bins and plugin.manager.* for plugin managers.</p> <p>The class line either gives the default class that provides the service, or if the service uses a factory class, the interface for the service. If the class depends on other services, the arguments line lists the machine names of the dependencies (preceded by '@'); objects for each of these services are instantiated from the container and passed to the class constructor when the service class is instantiated. Other arguments can also be passed in; see the section at <a href="https://www.drupal.org/node/2133171">https://www.drupal.org/node/2133171</a> for more detailed information.</p> <p>Services using factories can be defined as shown in the above example, if the factory is itself a service. The factory can also be a class; details of how to use service factories can be found in the section at <a href="https://www.drupal.org/node/2133171">https://www.drupal.org/node/2133171</a>.</p> <h3 id="sec_container">Accessing a service through the container</h3> <p>As noted above, if you need to use a service in your code, you should always instantiate the service class via a call to the container, using the machine name of the service, so that the default class can be overridden. There are several ways to make sure this happens:</p> <ul> <li>For service-providing classes, see other sections of this documentation describing how to pass services as arguments to the constructor.</li> <li>Plugin classes, controllers, and similar classes have create() or createInstance() methods that are used to create an instance of the class. These methods come from different interfaces, and have different arguments, but they all include an argument $container of type <a href="https://api.drupal.org/api/drupal/vendor%21symfony%21dependency-injection%21ContainerInterface.php/interface/ContainerInterface/8.1.x" title="ContainerInterface is the interface implemented by service container classes." class="local">\Symfony\Component\DependencyInjection\ContainerInterface</a>. If you are defining one of these classes, in the create() or createInstance() method, call $container-&gt;get('myservice.name') to instantiate a service. The results of these calls are generally passed to the class constructor and saved as member variables in the class.</li> <li>For functions and class methods that do not have access to either of the above methods of dependency injection, you can use service location to access services, via a call to the global <a href="../../../core-lib-drupal.php/class/drupal/8.1.x.html" title="Static Service Container wrapper." class="local">\Drupal</a> class. This class has special methods for accessing commonly-used services, or you can call a generic method to access any service. Examples: </li> </ul> <pre class="php" data-language="php">  // Retrieve the entity.manager service object (special method exists).
  $manager = \Drupal::entityManager();
  // Retrieve the service object for machine name 'foo.bar'.
  $foobar = \Drupal::service('foo.bar');
  </pre>
<p> As a note, you should always use dependency injection (via service arguments or create()/createInstance() methods) if possible to instantiate services, rather than service location (via the <a href="../../../core-lib-drupal.php/class/drupal/8.1.x.html" title="Static Service Container wrapper." class="local">\Drupal</a> class), because:</p> <ul> <li>Dependency injection facilitates writing unit tests, since the container argument can be mocked and the create() method can be bypassed by using the class constructor. If you use the <a href="../../../core-lib-drupal.php/class/drupal/8.1.x.html" title="Static Service Container wrapper." class="local">\Drupal</a> class, unit tests are much harder to write and your code has more dependencies.</li> <li>Having the service interfaces on the class constructor and member variables is useful for IDE auto-complete and self-documentation.</li> </ul> <h3 id="sec_define">Defining a service</h3> <p>If your module needs to define a new service, here are the steps:</p> <ul> <li>Choose a unique machine name for your service. Typically, this should start with your module name. Example: mymodule.myservice.</li> <li>Create a PHP interface to define what your service does.</li> <li>Create a default class implementing your interface that provides your service. If your class needs to use existing services (such as database access), be sure to make these services arguments to your class constructor, and save them in member variables. Also, if the needed services are provided by other modules and not Drupal Core, you'll want these modules to be dependencies of your module.</li> <li>Add an entry to a modulename.services.yml file for the service. See <a href="#sec_discover">Discovering existing services</a> above, or existing *.services.yml files in Core, for the syntax; it will start with your machine name, refer to your default class, and list the services that need to be passed into your constructor.</li> </ul> <p>Services can also be defined dynamically, as in the <a href="../../../core-lib-drupal-core-coreserviceprovider.php/class/coreserviceprovider/8.1.x.html" title="ServiceProvider class for mandatory core services." class="local">\Drupal\Core\CoreServiceProvider</a> class, but this is less common for modules.</p> <h3 id="sec_tags">Service tags</h3> <p>Some services have tags, which are defined in the service definition. See <a href="../service_tag/8.1.x.html" title="Service tags overview" class="local">Service Tags</a> for usage.</p> <h3 id="sec_injection">Overriding the default service class</h3> <p>Modules can override the default classes used for services. Here are the steps:</p> <ul> <li>Define a class in the top-level namespace for your module (Drupal\my_module), whose name is the camel-case version of your module's machine name followed by "ServiceProvider" (for example, if your module machine name is my_module, the class must be named MyModuleServiceProvider).</li> <li>The class needs to implement <a href="../../../core-lib-drupal-core-dependencyinjection-servicemodifierinterface.php/interface/servicemodifierinterface/8.1.x.html" title="Interface that service providers can implement to modify services." class="local">\Drupal\Core\DependencyInjection\ServiceModifierInterface</a>, which is typically done by extending <a href="../../../core-lib-drupal-core-dependencyinjection-serviceproviderbase.php/class/serviceproviderbase/8.1.x.html" title="Base service provider implementation." class="local">\Drupal\Core\DependencyInjection\ServiceProviderBase</a>.</li> <li>
<strong>The class needs to contain one method</strong>: alter(). This method does the actual work of telling Drupal to use your class instead of the default. Here's an example: </li> </ul> <pre class="php" data-language="php">  public function alter(ContainerBuilder $container) {
    // Override the language_manager class with a new class.
    $definition = $container-&gt;getDefinition('language_manager');
    $definition-&gt;setClass('Drupal\my_module\MyLanguageManager');
  }
  </pre>
<p> Note that $container here is an instance of <a href="../../../core-lib-drupal-core-dependencyinjection-containerbuilder.php/class/containerbuilder/8.1.x.html" title="Drupal's dependency injection container builder." class="local">\Drupal\Core\DependencyInjection\ContainerBuilder</a>.</p> <h3>See also</h3> <p> <a href="https://www.drupal.org/node/2133171">https://www.drupal.org/node/2133171</a></p> <p><a href="https://api.drupal.org/api/drupal/core%21core.services.yml/8.1.x" title="core/core.services.yml" class="local">core.services.yml</a></p> <p><a href="../../../core-lib-drupal.php/class/drupal/8.1.x.html" title="Static Service Container wrapper." class="local">\Drupal</a></p> <p><a href="https://api.drupal.org/api/drupal/vendor%21symfony%21dependency-injection%21ContainerInterface.php/interface/ContainerInterface/8.1.x" title="ContainerInterface is the interface implemented by service container classes." class="local">\Symfony\Component\DependencyInjection\ContainerInterface</a></p> <p><a href="../plugin_api/8.1.x.html" title="Using the Plugin API" class="local">Plugin API</a></p> <p><a href="../../../core-lib-drupal-core-menu-menu.api.php/group/menu/8.1.x.html" title="Define the navigation menus, local actions and tasks, and contextual links." class="local">Menu system</a></p> <h3>File</h3> 
<dl> <dt>core/<a href="https://api.drupal.org/api/drupal/core%21core.api.php/8.1.x">core.api.php</a>, line 707</dt> <dd>Documentation landing page and topics, plus core library hooks.</dd> </dl> <h3>Classes</h3>  <table> <thead> <tr> <th scope="col"> Name </th> <th scope="col"> Location </th> <th scope="col"> Description </th> </tr> </thead> <tbody> <tr> <td data-th="Name"> <a href="../../../core-lib-drupal-component-dependencyinjection-container.php/class/container/8.1.x.html">Container</a> </td> <td data-th="Location"> core/lib/Drupal/Component/DependencyInjection/<a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Component%21DependencyInjection%21Container.php/8.1.x">Container.php</a> </td> <td data-th="Description"> Provides a container optimized for Drupal's needs. </td> </tr> <tr> <td data-th="Name"> <a href="../../../core-lib-drupal-core-dependencyinjection-containerbuilder.php/class/containerbuilder/8.1.x.html">ContainerBuilder</a> </td> <td data-th="Location"> core/lib/Drupal/Core/DependencyInjection/<a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21DependencyInjection%21ContainerBuilder.php/8.1.x">ContainerBuilder.php</a> </td> <td data-th="Description"> Drupal's dependency injection container builder. </td> </tr> <tr> <td data-th="Name"> <a href="../../../core-lib-drupal-core-coreserviceprovider.php/class/coreserviceprovider/8.1.x.html">CoreServiceProvider</a> </td> <td data-th="Location"> core/lib/Drupal/Core/<a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21CoreServiceProvider.php/8.1.x">CoreServiceProvider.php</a> </td> <td data-th="Description"> ServiceProvider class for mandatory core services. </td> </tr> <tr> <td data-th="Name"> <a href="../../../core-lib-drupal-component-dependencyinjection-phparraycontainer.php/class/phparraycontainer/8.1.x.html">PhpArrayContainer</a> </td> <td data-th="Location"> core/lib/Drupal/Component/DependencyInjection/<a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Component%21DependencyInjection%21PhpArrayContainer.php/8.1.x">PhpArrayContainer.php</a> </td> <td data-th="Description"> Provides a container optimized for Drupal's needs. </td> </tr> <tr> <td data-th="Name"> <a href="../../../core-lib-drupal-core-dependencyinjection-serviceproviderbase.php/class/serviceproviderbase/8.1.x.html">ServiceProviderBase</a> </td> <td data-th="Location"> core/lib/Drupal/Core/DependencyInjection/<a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21DependencyInjection%21ServiceProviderBase.php/8.1.x">ServiceProviderBase.php</a> </td> <td data-th="Description"> Base service provider implementation. </td> </tr> </tbody> </table>  <h3>Interfaces</h3>  <table> <thead> <tr> <th scope="col"> Name </th> <th scope="col"> Location </th> <th scope="col"> Description </th> </tr> </thead> <tbody> <tr> <td data-th="Name"> <a href="../../../core-lib-drupal-core-dependencyinjection-servicemodifierinterface.php/interface/servicemodifierinterface/8.1.x.html">ServiceModifierInterface</a> </td> <td data-th="Location"> core/lib/Drupal/Core/DependencyInjection/<a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21DependencyInjection%21ServiceModifierInterface.php/8.1.x">ServiceModifierInterface.php</a> </td> <td data-th="Description"> Interface that service providers can implement to modify services. </td> </tr> <tr> <td data-th="Name"> <a href="../../../core-lib-drupal-core-dependencyinjection-serviceproviderinterface.php/interface/serviceproviderinterface/8.1.x.html">ServiceProviderInterface</a> </td> <td data-th="Location"> core/lib/Drupal/Core/DependencyInjection/<a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21DependencyInjection%21ServiceProviderInterface.php/8.1.x">ServiceProviderInterface.php</a> </td> <td data-th="Description"> Interface that all service providers must implement. </td> </tr> </tbody> </table><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2001&ndash;2016 by the original authors<br>Licensed under the GNU General Public License, version 2 and later.<br>Drupal is a registered trademark of Dries Buytaert.<br>
    <a href="https://api.drupal.org/api/drupal/core!core.api.php/group/container/8.1.x" class="_attribution-link">https://api.drupal.org/api/drupal/core!core.api.php/group/container/8.1.x</a>
  </p>
</div>
