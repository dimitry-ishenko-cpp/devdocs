<h1 id="page-subtitle">Menu system</h1>      <p>Define the navigation menus, local actions and tasks, and contextual links.</p> <h3 id="sec_overview">Overview and terminology</h3> <p>The menu system uses routes; see the <a href="../../../core-lib-drupal-core-routing-routing.api.php/group/routing/8.1.x.html" title="Route page requests to code based on URLs." class="local">Routing API topic</a> for more information. It is used for navigation menus, local tasks, local actions, and contextual links:</p> <ul> <li>Navigation menus are hierarchies of menu links; links point to routes or URLs.</li> <li>Menu links and their hierarchies can be defined by Drupal subsystems and modules, or created in the user interface using the Menu UI module.</li> <li>Local tasks are groups of related routes. Local tasks are usually rendered as a group of tabs.</li> <li>Local actions are used for operations such as adding a new item on a page that lists items of some type. Local actions are usually rendered as buttons.</li> <li>Contextual links are actions that are related to sections of rendered output, and are usually rendered as a pop-up list of links. The Contextual Links module handles the gathering and rendering of contextual links.</li> </ul> <p>The following sections of this topic provide an overview of the menu API. For more detailed information, see <a href="https://www.drupal.org/developing/api/8/menu">https://www.drupal.org/developing/api/8/menu</a></p> <h3 id="sec_links">Defining menu links for the administrative menu</h3> <p>Routes for administrative tasks can be added to the main Drupal administrative menu hierarchy. To do this, add lines like the following to a module_name.links.menu.yml file (in the top-level directory for your module):</p> <pre class="php" data-language="php">dblog.overview:
  title: 'Recent log messages'
  parent: system.admin_reports
  description: 'View events that have recently been logged.'
  route_name: dblog.overview
  weight: -1
</pre>
<p> Some notes:</p> <ul> <li>The first line is the machine name for your menu link, which usually matches the machine name of the route (given in the 'route_name' line).</li> <li>
<strong>parent</strong>: The machine name of the menu link that is the parent in the administrative hierarchy. See <a href="https://api.drupal.org/api/drupal/core%21modules%21system%21system.links.menu.yml/8.1.x" title="core/modules/system/system.links.menu.yml" class="local">system.links.menu.yml</a> to find the main skeleton of the hierarchy.</li> <li>
<strong>weight</strong>: Lower (negative) numbers come before higher (positive) numbers, for menu items with the same parent.</li> </ul> <p>Discovered menu links from other modules can be altered using <a href="../../function/hook_menu_links_discovered_alter/8.1.x.html" title="Alters all the menu links discovered by the menu link plugin manager." class="local">hook_menu_links_discovered_alter</a>().</p> <p>@todo Derivatives will probably be defined for these; when they are, add documentation here.</p> <h3 id="sec_tasks">Defining groups of local tasks (tabs)</h3> <p>Local tasks appear as tabs on a page when there are at least two defined for a route, including the base route as the main tab, and additional routes as other tabs. Static local tasks can be defined by adding lines like the following to a module_name.links.task.yml file (in the top-level directory for your module):</p> <pre class="php" data-language="php">book.admin:
  route_name: book.admin
  title: 'List'
  base_route: book.admin
book.settings:
  route_name: book.settings
  title: 'Settings'
  base_route: book.admin
  weight: 100
</pre>
<p> Some notes:</p> <ul> <li>The first line is the machine name for your local task, which usually matches the machine name of the route (given in the 'route_name' line).</li> <li>
<strong>base_route</strong>: The machine name of the main task (tab) for the set of local tasks.</li> <li>
<strong>weight</strong>: Lower (negative) numbers come before higher (positive) numbers, for tasks on the same base route. If there is a tab whose route matches the base route, that will be the default/first tab shown.</li> </ul> <p>Local tasks from other modules can be altered using <a href="../../function/hook_menu_local_tasks_alter/8.1.x.html" title="Alter local tasks displayed on the page before they are rendered." class="local">hook_menu_local_tasks_alter</a>().</p> <p>@todo Derivatives are in flux for these; when they are more stable, add documentation here.</p> <h3 id="sec_actions">Defining local actions for routes</h3> <p>Local actions can be defined for operations related to a given route. For instance, adding content is a common operation for the content management page, so it should be a local action. Static local actions can be defined by adding lines like the following to a module_name.links.action.yml file (in the top-level directory for your module):</p> <pre class="php" data-language="php">node.add_page:
  route_name: node.add_page
  title: 'Add content'
  appears_on:
    - system.admin_content
</pre>
<p> Some notes:</p> <ul> <li>The first line is the machine name for your local action, which usually matches the machine name of the route (given in the 'route_name' line).</li> <li>
<strong>appears_on</strong>: Machine names of one or more routes that this local task should appear on.</li> </ul> <p>Local actions from other modules can be altered using <a href="../../function/hook_menu_local_actions_alter/8.1.x.html" title="Alter local actions plugins." class="local">hook_menu_local_actions_alter</a>().</p> <p>@todo Derivatives are in flux for these; when they are more stable, add documentation here.</p> <h3 id="sec_contextual">Defining contextual links</h3> <p>Contextual links are displayed by the Contextual Links module for user interface elements whose render arrays have a '#contextual_links' element defined. For example, a block render array might look like this, in part:</p> <pre class="php" data-language="php">array(
  '#contextual_links' =&gt; array(
    'block' =&gt; array(
      'route_parameters' =&gt; array('block' =&gt; $entity-&gt;id()),
    ),
  ),
</pre>
<p> In this array, the outer key 'block' defines a "group" for contextual links, and the inner array provides values for the route's placeholder parameters (see @ref sec_placeholders above).</p> <p>To declare that a defined route should be a contextual link for a contextual links group, put lines like the following in a module_name.links.contextual.yml file (in the top-level directory for your module):</p> <pre class="php" data-language="php">block_configure:
  title: 'Configure block'
  route_name: 'entity.block.edit_form'
  group: 'block'
</pre>
<p> Some notes:</p> <ul> <li>The first line is the machine name for your contextual link, which usually matches the machine name of the route (given in the 'route_name' line).</li> <li>
<strong>group</strong>: This needs to match the link group defined in the render array.</li> </ul> <p>Contextual links from other modules can be altered using <a href="../../function/hook_contextual_links_alter/8.1.x.html" title="Alter contextual links before they are rendered." class="local">hook_contextual_links_alter</a>().</p> <p>@todo Derivatives are in flux for these; when they are more stable, add documentation here.</p> <h3 id="sec_rendering">Rendering menus</h3> <p>Once you have created menus (that contain menu links), you want to render them. Drupal provides a block (<a href="https://api.drupal.org/api/drupal/core%21modules%21system%21src%21Plugin%21Block%21SystemMenuBlock.php/class/SystemMenuBlock/8.1.x" title="Provides a generic Menu block." class="local">Drupal\system\Plugin\Block\SystemMenuBlock</a>) to do so.</p> <p>However, perhaps you have more advanced needs and you're not satisfied with what the menu blocks offer you. If that's the case, you'll want to:</p> <ul> <li>Instantiate <a href="../../../core-lib-drupal-core-menu-menutreeparameters.php/class/menutreeparameters/8.1.x.html" title="Provides a value object to model menu tree parameters." class="local">\Drupal\Core\Menu\MenuTreeParameters</a>, and set its values to match your needs. Alternatively, you can use MenuLinkTree::getCurrentRouteMenuTreeParameters() to get a typical default set of parameters, and then customize them to suit your needs.</li> <li>Call \Drupal\Core\MenuLinkTree::load() with your menu link tree parameters, this will return a menu link tree.</li> <li>Pass the menu tree to <a href="../../../core-lib-drupal-core-menu-menulinktree.php/function/menulinktree-transform/8.1.x.html" title="Applies menu link tree manipulators to transform the given tree." class="local">\Drupal\Core\Menu\MenuLinkTree::transform</a>() to apply menu link tree manipulators that transform the tree. You will almost always want to apply access checking. The manipulators that you will typically need can be found in \Drupal\Core\Menu\DefaultMenuTreeManipulators.</li> <li>Potentially write a custom menu tree manipulator, see \Drupal\Core\Menu\DefaultMenuTreeManipulators for examples. This is only necessary if you want to do things like adding extra metadata to rendered links to display icons next to them.</li> <li>Pass the menu tree to <a href="../../../core-lib-drupal-core-menu-menulinktree.php/function/menulinktree-build/8.1.x.html" title="Builds a renderable array from a menu tree." class="local">\Drupal\Core\Menu\MenuLinkTree::build</a>(), this will build a renderable array.</li> </ul> <p>Combined, that would look like this:</p> <pre class="php" data-language="php">$menu_tree = \Drupal::menuTree();
$menu_name = 'my_menu';

// Build the typical default set of menu tree parameters.
$parameters = $menu_tree-&gt;getCurrentRouteMenuTreeParameters($menu_name);

// Load the tree based on this set of parameters.
$tree = $menu_tree-&gt;load($menu_name, $parameters);

// Transform the tree using the manipulators you want.
$manipulators = array(
  // Only show links that are accessible for the current user.
  array('callable' =&gt; 'menu.default_tree_manipulators:checkAccess'),
  // Use the default sorting of menu links.
  array('callable' =&gt; 'menu.default_tree_manipulators:generateIndexAndSort'),
);
$tree = $menu_tree-&gt;transform($tree, $manipulators);

// Finally, build a renderable array from the transformed tree.
$menu = $menu_tree-&gt;build($tree);

$menu_html = drupal_render($menu);
</pre> <h3>File</h3> 
<dl> <dt>core/lib/Drupal/Core/Menu/<a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Menu%21menu.api.php/8.1.x">menu.api.php</a>, line 8</dt> <dd>Hooks and documentation related to the menu system and links.</dd> </dl> <h3>Functions</h3>  <table> <thead> <tr> <th scope="col"> Name </th> <th scope="col"> Location </th> <th scope="col"> Description </th> </tr> </thead> <tbody> <tr> <td data-th="Name"> <a href="../../function/hook_contextual_links_alter/8.1.x.html">hook_contextual_links_alter</a> </td> <td data-th="Location"> core/lib/Drupal/Core/Menu/<a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Menu%21menu.api.php/8.1.x">menu.api.php</a> </td> <td data-th="Description"> Alter contextual links before they are rendered. </td> </tr> <tr> <td data-th="Name"> <a href="../../function/hook_contextual_links_plugins_alter/8.1.x.html">hook_contextual_links_plugins_alter</a> </td> <td data-th="Location"> core/lib/Drupal/Core/Menu/<a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Menu%21menu.api.php/8.1.x">menu.api.php</a> </td> <td data-th="Description"> Alter the plugin definition of contextual links. </td> </tr> <tr> <td data-th="Name"> <a href="../../function/hook_local_tasks_alter/8.1.x.html">hook_local_tasks_alter</a> </td> <td data-th="Location"> core/lib/Drupal/Core/Menu/<a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Menu%21menu.api.php/8.1.x">menu.api.php</a> </td> <td data-th="Description"> Alter local tasks plugins. </td> </tr> <tr> <td data-th="Name"> <a href="../../function/hook_menu_links_discovered_alter/8.1.x.html">hook_menu_links_discovered_alter</a> </td> <td data-th="Location"> core/lib/Drupal/Core/Menu/<a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Menu%21menu.api.php/8.1.x">menu.api.php</a> </td> <td data-th="Description"> Alters all the menu links discovered by the menu link plugin manager. </td> </tr> <tr> <td data-th="Name"> <a href="../../function/hook_menu_local_actions_alter/8.1.x.html">hook_menu_local_actions_alter</a> </td> <td data-th="Location"> core/lib/Drupal/Core/Menu/<a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Menu%21menu.api.php/8.1.x">menu.api.php</a> </td> <td data-th="Description"> Alter local actions plugins. </td> </tr> <tr> <td data-th="Name"> <a href="../../function/hook_menu_local_tasks_alter/8.1.x.html">hook_menu_local_tasks_alter</a> </td> <td data-th="Location"> core/lib/Drupal/Core/Menu/<a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Menu%21menu.api.php/8.1.x">menu.api.php</a> </td> <td data-th="Description"> Alter local tasks displayed on the page before they are rendered. </td> </tr> <tr> <td data-th="Name"> <a href="../../function/hook_system_breadcrumb_alter/8.1.x.html">hook_system_breadcrumb_alter</a> </td> <td data-th="Location"> core/lib/Drupal/Core/Menu/<a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Menu%21menu.api.php/8.1.x">menu.api.php</a> </td> <td data-th="Description"> Perform alterations to the breadcrumb built by the BreadcrumbManager. </td> </tr> <tr> <td data-th="Name"> <a href="../../../core-includes-menu.inc/function/menu_cache_clear_all/8.1.x.html">menu_cache_clear_all</a> </td> <td data-th="Location"> core/includes/<a href="../../../core-includes-menu.inc/8.1.x.html">menu.inc</a> </td> <td data-th="Description"> Clears all cached menu data. </td> </tr> <tr> <td data-th="Name"> <a href="../../../core-includes-menu.inc/function/menu_list_system_menus/8.1.x.html">menu_list_system_menus</a> </td> <td data-th="Location"> core/includes/<a href="../../../core-includes-menu.inc/8.1.x.html">menu.inc</a> </td> <td data-th="Description"> Returns an array containing the names of system-defined (default) menus. </td> </tr> <tr> <td data-th="Name"> <a href="../../../core-includes-menu.inc/function/menu_local_tabs/8.1.x.html">menu_local_tabs</a> </td> <td data-th="Location"> core/includes/<a href="../../../core-includes-menu.inc/8.1.x.html">menu.inc</a> </td> <td data-th="Description"> Returns a renderable element for the primary and secondary tabs. </td> </tr> <tr> <td data-th="Name"> <a href="../../../core-includes-menu.inc/function/menu_local_tasks/8.1.x.html">menu_local_tasks</a> <span class="api-deprecated">Deprecated</span> </td> <td data-th="Location"> core/includes/<a href="../../../core-includes-menu.inc/8.1.x.html">menu.inc</a> </td> <td data-th="Description"> Collects the local tasks (tabs) for the current route. </td> </tr> <tr> <td data-th="Name"> <a href="../../../core-includes-menu.inc/function/menu_primary_local_tasks/8.1.x.html">menu_primary_local_tasks</a> <span class="api-deprecated">Deprecated</span> </td> <td data-th="Location"> core/includes/<a href="../../../core-includes-menu.inc/8.1.x.html">menu.inc</a> </td> <td data-th="Description"> Returns the rendered local tasks at the top level. </td> </tr> <tr> <td data-th="Name"> <a href="../../../core-includes-menu.inc/function/menu_secondary_local_tasks/8.1.x.html">menu_secondary_local_tasks</a> <span class="api-deprecated">Deprecated</span> </td> <td data-th="Location"> core/includes/<a href="../../../core-includes-menu.inc/8.1.x.html">menu.inc</a> </td> <td data-th="Description"> Returns the rendered local tasks at the second level. </td> </tr> <tr> <td data-th="Name"> <a href="../../../core-includes-menu.inc/function/template_preprocess_menu_local_action/8.1.x.html">template_preprocess_menu_local_action</a> </td> <td data-th="Location"> core/includes/<a href="../../../core-includes-menu.inc/8.1.x.html">menu.inc</a> </td> <td data-th="Description"> Prepares variables for single local action link templates. </td> </tr> <tr> <td data-th="Name"> <a href="../../../core-includes-menu.inc/function/template_preprocess_menu_local_task/8.1.x.html">template_preprocess_menu_local_task</a> </td> <td data-th="Location"> core/includes/<a href="../../../core-includes-menu.inc/8.1.x.html">menu.inc</a> </td> <td data-th="Description"> Prepares variables for single local task link templates. </td> </tr> </tbody> </table>  <h3>Interfaces</h3>  <table> <thead> <tr> <th scope="col"> Name </th> <th scope="col"> Location </th> <th scope="col"> Description </th> </tr> </thead> <tbody> <tr> <td data-th="Name"> <a href="../../../core-lib-drupal-core-menu-contextuallinkinterface.php/interface/contextuallinkinterface/8.1.x.html">ContextualLinkInterface</a> </td> <td data-th="Location"> core/lib/Drupal/Core/Menu/<a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Menu%21ContextualLinkInterface.php/8.1.x">ContextualLinkInterface.php</a> </td> <td data-th="Description"> Defines a contextual link plugin. </td> </tr> </tbody> </table><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2001&ndash;2016 by the original authors<br>Licensed under the GNU General Public License, version 2 and later.<br>Drupal is a registered trademark of Dries Buytaert.<br>
    <a href="https://api.drupal.org/api/drupal/core!lib!Drupal!Core!Menu!menu.api.php/group/menu/8.1.x" class="_attribution-link">https://api.drupal.org/api/drupal/core!lib!Drupal!Core!Menu!menu.api.php/group/menu/8.1.x</a>
  </p>
</div>
