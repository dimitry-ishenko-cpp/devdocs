<h1 id="page-subtitle">public function EntityViewDisplay::buildMultiple</h1>     <pre class="signature">public <a href="../../class/entityviewdisplay/8.1.x.html">EntityViewDisplay</a>::buildMultiple(array $entities)</pre> <p>Builds a renderable array for the components of a set of entities.</p> <p>This only includes the components handled by the Display object, but excludes 'extra fields', that are typically rendered through specific, ad-hoc code in EntityViewBuilderInterface::buildComponents() or in <a href="../../../core-lib-drupal-core-entity-entity.api.php/function/hook_entity_view/8.1.x.html" title="Act on entities being assembled before rendering." class="local">hook_entity_view</a>() implementations.</p> <p><a href="../../../core-lib-drupal-core-entity-entity.api.php/function/hook_entity_display_build_alter/8.1.x.html" title="Alter the render array generated by an EntityDisplay for an entity." class="local">hook_entity_display_build_alter</a>() is invoked on each entity, allowing 3rd party code to alter the render array.</p> <h3>Parameters</h3> <p> <strong><a href="../../../core-lib-drupal-core-entity-fieldableentityinterface.php/interface/fieldableentityinterface/8.1.x.html" title="Interface for entities having fields." class="local">\Drupal\Core\Entity\FieldableEntityInterface</a>[] $entities</strong>: The entities being displayed.</p> <h3>Return value</h3> <p> array A renderable array for the entities, indexed by the same keys as the $entities array parameter.</p> <p class="api-override">Overrides <a href="../../../core-lib-drupal-core-entity-display-entityviewdisplayinterface.php/function/entityviewdisplayinterface-buildmultiple/8.1.x.html">EntityViewDisplayInterface::buildMultiple</a></p> <h3>See also</h3> <p> <a href="../../../core-lib-drupal-core-entity-entity.api.php/function/hook_entity_display_build_alter/8.1.x.html" title="Alter the render array generated by an EntityDisplay for an entity." class="local">hook_entity_display_build_alter</a>()</p>  <h3>File</h3> 
<dl> <dt>core/lib/Drupal/Core/Entity/Entity/<a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21Entity%21EntityViewDisplay.php/8.1.x">EntityViewDisplay.php</a>, line 224</dt>  </dl> <h3>Class</h3> 
<dl> <dt>
<a href="../../class/entityviewdisplay/8.1.x.html">EntityViewDisplay</a> </dt> <dd>Configuration entity that contains display options for all components of a rendered entity in a given view mode.</dd> </dl> <h3>Namespace</h3> <a href="https://api.drupal.org/api/drupal/namespace/Drupal%21Core%21Entity%21Entity/8.1.x">Drupal\Core\Entity\Entity</a> <h3>Code</h3> <pre class="php" data-language="php">public function buildMultiple(array $entities) {
  $build_list = array();
  foreach ($entities as $key =&gt; $entity) {
    $build_list[$key] = array();
  }

  // Run field formatters.
  foreach ($this-&gt;getComponents() as $name =&gt; $options) {
    if ($formatter = $this-&gt;getRenderer($name)) {
      // Group items across all entities and pass them to the formatter's
      // prepareView() method.
      $grouped_items = array();
      foreach ($entities as $id =&gt; $entity) {
        $items = $entity-&gt;get($name);
        $items-&gt;filterEmptyItems();
        $grouped_items[$id] = $items;
      }
      $formatter-&gt;prepareView($grouped_items);

      // Then let the formatter build the output for each entity.
      foreach ($entities as $id =&gt; $entity) {
        $items = $grouped_items[$id];
        /** @var \Drupal\Core\Access\AccessResultInterface $field_access */
        $field_access = $items-&gt;access('view', NULL, TRUE);
        // The language of the field values to display is already determined
        // in the incoming $entity. The formatter should build its output of
        // those values using:
        // - the entity language if the entity is translatable,
        // - the current "content language" otherwise.
        if ($entity instanceof TranslatableInterface &amp;&amp; $entity-&gt;isTranslatable()) {
          $view_langcode = $entity-&gt;language()-&gt;getId();
        }
        else {
          $view_langcode = NULL;
        }
        $build_list[$id][$name] = $field_access-&gt;isAllowed() ? $formatter-&gt;view($items, $view_langcode) : [];
        // Apply the field access cacheability metadata to the render array.
        $this-&gt;renderer-&gt;addCacheableDependency($build_list[$id][$name], $field_access);
      }
    }
  }

  foreach ($entities as $id =&gt; $entity) {
    // Assign the configured weights.
    foreach ($this-&gt;getComponents() as $name =&gt; $options) {
      if (isset($build_list[$id][$name])) {
        $build_list[$id][$name]['#weight'] = $options['weight'];
      }
    }

    // Let other modules alter the renderable array.
    $context = array(
      'entity' =&gt; $entity,
      'view_mode' =&gt; $this-&gt;originalMode,
      'display' =&gt; $this,
    );
    \Drupal::moduleHandler()-&gt;alter('entity_display_build', $build_list[$key], $context);
  }

  return $build_list;
}
</pre><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2001&ndash;2016 by the original authors<br>Licensed under the GNU General Public License, version 2 and later.<br>Drupal is a registered trademark of Dries Buytaert.<br>
    <a href="https://api.drupal.org/api/drupal/core!lib!Drupal!Core!Entity!Entity!EntityViewDisplay.php/function/EntityViewDisplay::buildMultiple/8.1.x" class="_attribution-link">https://api.drupal.org/api/drupal/core!lib!Drupal!Core!Entity!Entity!EntityViewDisplay.php/function/EntityViewDisplay::buildMultiple/8.1.x</a>
  </p>
</div>
