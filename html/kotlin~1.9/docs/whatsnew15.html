<h1 data-toc="whatsnew15" id="whatsnew15.md">What's new in Kotlin 1.5.0</h1>
<p id="8ecba7fa"><em id="73e4807f" class=""><a href="releases.html#release-details" id="34d3d4f7">Released: 5 May 2021</a></em></p>
<p id="8a92600c">Kotlin 1.5.0 introduces new language features, stable IR-based JVM compiler backend, performance improvements, and evolutionary changes such as stabilizing experimental features and deprecating outdated ones.</p>
<p id="16877bcd">You can also find an overview of the changes in the <a href="https://blog.jetbrains.com/kotlin/2021/04/kotlin-1-5-0-released/" id="4987077" data-external="true" rel="noopener noreferrer">release blog post</a>.</p>
<section class="chapter"><h2 id="language-features" data-toc="language-features">Language features</h2>
<p id="82f2e1d3">Kotlin 1.5.0 brings stable versions of the new language features presented for <a href="whatsnew1430.html#language-features" id="e8087245">preview in 1.4.30</a>:</p>
<ul class="list _bullet" id="54ff9851">
<li class="list__item" id="da697d24"><p><a href="#jvm-records-support" id="50f229cb">JVM records support</a></p></li>
<li class="list__item" id="fcb47aec"><p><a href="#sealed-interfaces" id="51873c4c">Sealed interfaces</a> and <a href="#package-wide-sealed-class-hierarchies" id="b08cc060">sealed class improvements</a></p></li>
<li class="list__item" id="9ae99178"><p><a href="#inline-classes" id="99aa10c6">Inline classes</a></p></li>
</ul>
<p id="da24ae69">Detailed descriptions of these features are available in <a href="https://blog.jetbrains.com/kotlin/2021/02/new-language-features-preview-in-kotlin-1-4-30/" id="861441d4" data-external="true" rel="noopener noreferrer">this blog post</a> and the corresponding pages of Kotlin documentation.</p>
<section class="chapter"><h3 id="jvm-records-support" data-toc="jvm-records-support">JVM records support</h3>
<p id="d326589f">Java is evolving fast, and to make sure Kotlin remains interoperable with it, we've introduced support for one of its latest features – <a href="https://openjdk.java.net/jeps/395" id="a1fc7783" data-external="true" rel="noopener noreferrer">record classes</a>.</p>
<p id="e7884a93">Kotlin's support for JVM records includes bidirectional interoperability:</p>
<ul class="list _bullet" id="45891bbf">
<li class="list__item" id="9884d9a5"><p>In Kotlin code, you can use Java record classes like you would use typical classes with properties.</p></li>
<li class="list__item" id="67e75c1e"><p>To use a Kotlin class as a record in Java code, make it a <code class="code ">data</code> class and mark it with the <code class="code ">@JvmRecord</code> annotation.</p></li>
</ul>
<pre class="code" data-language="kotlin">@JvmRecord
data class User(val name: String, val age: Int)
</pre>
<p id="d79c7389"><a href="jvm-records.html" id="fcec07a1">Learn more about using JVM records in Kotlin</a>.</p>
</section><section class="chapter"><h3 id="sealed-interfaces" data-toc="sealed-interfaces">Sealed interfaces</h3>
<p id="51db7f75">Kotlin interfaces can now have the <code class="code ">sealed</code> modifier, which works on interfaces in the same way it works on classes: all implementations of a sealed interface are known at compile time.</p>
<pre class="code" data-language="kotlin">sealed interface Polygon
</pre>
<p id="8cb92471">You can rely on that fact, for example, to write exhaustive <code class="code ">when</code> expressions.</p>
<pre class="code" data-language="kotlin">fun draw(polygon: Polygon) = when (polygon) {
   is Rectangle -&gt; // ...
   is Triangle -&gt; // ...
   // else is not needed - all possible implementations are covered
}

</pre>
<p id="86d0d8cc">Additionally, sealed interfaces enable more flexible restricted class hierarchies because a class can directly inherit more than one sealed interface.</p>
<pre class="code" data-language="kotlin">class FilledRectangle: Polygon, Fillable
</pre>
<p id="4c365673"><a href="sealed-classes.html" id="ff5785a4">Learn more about sealed interfaces</a>.</p>
</section><section class="chapter"><h3 id="package-wide-sealed-class-hierarchies" data-toc="package-wide-sealed-class-hierarchies">Package-wide sealed class hierarchies</h3>
<p id="a9dd3433">Sealed classes can now have subclasses in all files of the same compilation unit and the same package. Previously, all subclasses had to appear in the same file.</p>
<p id="269c6bb4">Direct subclasses may be top-level or nested inside any number of other named classes, named interfaces, or named objects.</p>
<p id="a3491700">The subclasses of a sealed class must have a name that is properly qualified – they cannot be local or anonymous objects.</p>
<p id="9486de39"><a href="sealed-classes.html#location-of-direct-subclasses" id="808157da">Learn more about sealed class hierarchies</a>.</p></section><section class="chapter"><h3 id="inline-classes" data-toc="inline-classes">Inline classes</h3>
<p id="dc101b20">Inline classes are a subset of <a href="https://github.com/Kotlin/KEEP/blob/master/notes/value-classes.md" id="bdf1a0f7" data-external="true" rel="noopener noreferrer">value-based</a> classes that only hold values. You can use them as wrappers for a value of a certain type without the additional overhead that comes from using memory allocations.</p>
<p id="2e66eee0">Inline classes can be declared with the <code class="code ">value</code> modifier before the name of the class:</p>
<pre class="code" data-language="kotlin">value class Password(val s: String)
</pre>
<p id="f0dc419a">The JVM backend also requires a special <code class="code ">@JvmInline</code> annotation:</p>
<pre class="code" data-language="kotlin">@JvmInline
value class Password(val s: String)
</pre>
<p id="42461d70">The <code class="code ">inline</code> modifier is now deprecated with a warning.</p>
<p id="6c8006db"><a href="inline-classes.html" id="45fb2456">Learn more about inline classes</a>.</p>
</section></section><section class="chapter"><h2 id="kotlin-jvm" data-toc="kotlin-jvm">Kotlin/JVM</h2>
<p id="932422f4">Kotlin/JVM has received a number of improvements, both internal and user-facing. Here are the most notable among them:</p>
<ul class="list _bullet" id="6b28239f">
<li class="list__item" id="d684ed76"><p><a href="#stable-jvm-ir-backend" id="cdc3bb4d">Stable JVM IR backend</a></p></li>
<li class="list__item" id="92a1abc5"><p><a href="#new-default-jvm-target-1-8" id="5bcc4663">New default JVM target: 1.8</a></p></li>
<li class="list__item" id="35d9d724"><p><a href="#sam-adapters-via-invokedynamic" id="a7c250b">SAM adapters via invokedynamic</a></p></li>
<li class="list__item" id="3368337d"><p><a href="#lambdas-via-invokedynamic" id="d487148b">Lambdas via invokedynamic</a></p></li>
<li class="list__item" id="be792d49"><p><a href="#deprecation-of-jvmdefault-and-old-xjvm-default-modes" id="e832ab13">Deprecation of @JvmDefault and old Xjvm-default modes</a></p></li>
<li class="list__item" id="2dbe743c"><p><a href="#improvements-to-handling-nullability-annotations" id="774317b7">Improvements to handling nullability annotations</a></p></li>
</ul>
<section class="chapter"><h3 id="stable-jvm-ir-backend" data-toc="stable-jvm-ir-backend">Stable JVM IR backend</h3>
<p id="db200b16">The <a href="whatsnew14.html#new-jvm-ir-backend" id="66819adb">IR-based backend</a> for the Kotlin/JVM compiler is now <a href="components-stability.html" id="d575ff46">Stable</a> and enabled by default.</p>
<p id="246438a0">Starting from <a href="whatsnew14.html" id="f0bd1f48">Kotlin 1.4.0</a>, early versions of the IR-based backend were available for preview, and it has now become the default for language version <code class="code ">1.5</code>. The old backend is still used by default for earlier language versions.</p>
<p id="fe1164e2">You can find more details about the benefits of the IR backend and its future development in <a href="https://blog.jetbrains.com/kotlin/2021/02/the-jvm-backend-is-in-beta-let-s-make-it-stable-together/" id="e50d9327" data-external="true" rel="noopener noreferrer">this blog post</a>.</p>
<p id="b525f0ac">If you need to use the old backend in Kotlin 1.5.0, you can add the following lines to the project's configuration file:</p>
<ul class="list _bullet" id="7c10d6d1"><li class="list__item" id="214a7685"><p>In Gradle:</p></li></ul>
<div class="tabs" id="22e7f7ab" data-group="build-script" data-anchors="[583d66e5,4d168310,dab80730,4cbead9a,22e7f7ab]">
<div class="tabs__content" data-gtm="tab" id="583d66e5" data-sync-tabs="kotlin" data-title="Kotlin"><pre class="code" data-language="kotlin">tasks.withType&lt;org.jetbrains.kotlin.gradle.dsl.KotlinJvmCompile&gt; {
  kotlinOptions.useOldBackend = true
}
</pre></div>
<div class="tabs__content" data-gtm="tab" id="dab80730" data-sync-tabs="groovy" data-title="Groovy"><pre class="code" data-language="groovy">tasks.withType(org.jetbrains.kotlin.gradle.dsl.KotlinJvmCompile) {
 kotlinOptions.useOldBackend = true
}
</pre></div>
</div>
<ul class="list _bullet" id="29f39b6d"><li class="list__item" id="e9d435b"><p>In Maven:</p></li></ul>
<pre class="code" data-language="markup">&lt;configuration&gt;
    &lt;args&gt;
        &lt;arg&gt;-Xuse-old-backend&lt;/arg&gt;
    &lt;/args&gt;
&lt;/configuration&gt;
</pre></section><section class="chapter"><h3 id="new-default-jvm-target-1-8" data-toc="new-default-jvm-target-1-8">New default JVM target: 1.8</h3>
<p id="2e8d4b4a">The default target version for Kotlin/JVM compilations is now <code class="code ">1.8</code>. The <code class="code ">1.6</code> target is deprecated.</p>
<p id="511f4f80">If you need a build for JVM 1.6, you can still switch to this target. Learn how:</p>
<ul class="list _bullet" id="91f2b709">
<li class="list__item" id="e5d0de60"><p><a href="gradle-compiler-options.html#attributes-specific-to-jvm" id="167f6e1b">in Gradle</a></p></li>
<li class="list__item" id="ff64eff5"><p><a href="maven.html#attributes-specific-to-jvm" id="eaaa572">in Maven</a></p></li>
<li class="list__item" id="ea15759d"><p><a href="compiler-reference.html#jvm-target-version" id="9b8805c">in the command-line compiler</a></p></li>
</ul></section><section class="chapter"><h3 id="sam-adapters-via-invokedynamic" data-toc="sam-adapters-via-invokedynamic">SAM adapters via invokedynamic</h3>
<p id="d1489595">Kotlin 1.5.0 now uses dynamic invocations (<code class="code ">invokedynamic</code>) for compiling SAM (Single Abstract Method) conversions:</p>
<ul class="list _bullet" id="e5443893">
<li class="list__item" id="10faba68"><p>Over any expression if the SAM type is a <a href="java-interop.html#sam-conversions" id="4ad77bc5">Java interface</a></p></li>
<li class="list__item" id="eec126ea"><p>Over lambda if the SAM type is a <a href="fun-interfaces.html#sam-conversions" id="e29f1f2">Kotlin functional interface</a></p></li>
</ul>
<p id="aa1c8ff8">The new implementation uses <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/invoke/LambdaMetafactory.html#metafactory-java.lang.invoke.MethodHandles.Lookup-java.lang.String-java.lang.invoke.MethodType-java.lang.invoke.MethodType-java.lang.invoke.MethodHandle-java.lang.invoke.MethodType-" id="a3851d10" data-external="true" rel="noopener noreferrer"><code class="code ">LambdaMetafactory.metafactory()</code></a> and auxiliary wrapper classes are no longer generated during compilation. This decreases the size of the application's JAR, which improves the JVM startup performance.</p>
<p id="c252d198">To roll back to the old implementation scheme based on anonymous class generation, add the compiler option <code class="code ">-Xsam-conversions=class</code>.</p>
<p id="5051574c">Learn how to add compiler options in <a href="gradle-compiler-options.html" id="570c25ce">Gradle</a>, <a href="maven.html#specifying-compiler-options" id="8a98a75a">Maven</a>, and the <a href="compiler-reference.html#compiler-options" id="8d50252c">command-line compiler</a>.</p></section><section class="chapter"><h3 id="lambdas-via-invokedynamic" data-toc="lambdas-via-invokedynamic">Lambdas via invokedynamic</h3>
<aside data-type="warning" class="prompt" data-title="" id="49ea2dfb"><p id="a29203ab">Compiling plain Kotlin lambdas into invokedynamic is <a href="components-stability.html" id="66138603">Experimental</a>. It may be dropped or changed at any time. Opt-in is required (see details below), and you should use it only for evaluation purposes. We would appreciate hearing your feedback on it in <a href="https://youtrack.jetbrains.com/issue/KT-45375" id="6db75089" data-external="true" rel="noopener noreferrer">YouTrack</a>.</p></aside><p id="213ccef4">Kotlin 1.5.0 is introducing experimental support for compiling plain Kotlin lambdas (which are not converted to an instance of a functional interface) into dynamic invocations (<code class="code ">invokedynamic</code>). The implementation produces lighter binaries by using <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/invoke/LambdaMetafactory.html#metafactory-java.lang.invoke.MethodHandles.Lookup-java.lang.String-java.lang.invoke.MethodType-java.lang.invoke.MethodType-java.lang.invoke.MethodHandle-java.lang.invoke.MethodType-" id="f143129c" data-external="true" rel="noopener noreferrer"><code class="code ">LambdaMetafactory.metafactory()</code></a>, which effectively generates the necessary classes at runtime. Currently, it has three limitations compared to ordinary lambda compilation:</p>
<ul class="list _bullet" id="35ffbd43">
<li class="list__item" id="a097d1da"><p>A lambda compiled into invokedynamic is not serializable.</p></li>
<li class="list__item" id="8fe703ed"><p>Calling <code class="code ">toString()</code> on such a lambda produces a less readable string representation.</p></li>
<li class="list__item" id="f6fa464c"><p>Experimental <a href="../api/latest/jvm/stdlib/kotlin.reflect.jvm/reflect.html" id="7bff55ea" data-external="true" rel="noopener noreferrer"><code class="code ">reflect</code></a> API does not support lambdas created with <code class="code ">LambdaMetafactory</code>.</p></li>
</ul>
<p id="896ba536">To try this feature, add the <code class="code ">-Xlambdas=indy</code> compiler option. We would be grateful if you could share your feedback on it using this <a href="https://youtrack.jetbrains.com/issue/KT-45375" id="bbe6f774" data-external="true" rel="noopener noreferrer">YouTrack ticket</a>.</p>
<p id="c3298183">Learn how to add compiler options in <a href="gradle-compiler-options.html" id="be367885">Gradle</a>, <a href="maven.html#specifying-compiler-options" id="8699587e">Maven</a>, and <a href="compiler-reference.html#compiler-options" id="7168ef20">command-line compiler</a>.</p></section><section class="chapter"><h3 id="deprecation-of-jvmdefault-and-old-xjvm-default-modes" data-toc="deprecation-of-jvmdefault-and-old-xjvm-default-modes">Deprecation of @JvmDefault and old Xjvm-default modes</h3>
<p id="6d0c8a78">Prior to Kotlin 1.4.0, there was the <code class="code ">@JvmDefault</code> annotation along with <code class="code ">-Xjvm-default=enable</code> and <code class="code ">-Xjvm-default=compatibility</code> modes. They served to create the JVM default method for any particular non-abstract member in the Kotlin interface.</p>
<p id="6fc7ae42">In Kotlin 1.4.0, we <a href="https://blog.jetbrains.com/kotlin/2020/07/kotlin-1-4-m3-generating-default-methods-in-interfaces/" id="719848f6" data-external="true" rel="noopener noreferrer">introduced the new <code class="code ">Xjvm-default</code> modes</a>, which switch on default method generation for the whole project.</p>
<p id="f079b8c4">In Kotlin 1.5.0, we are deprecating <code class="code ">@JvmDefault</code> and the old Xjvm-default modes: <code class="code ">-Xjvm-default=enable</code> and <code class="code ">-Xjvm-default=compatibility</code>.</p>
<p id="b25c60e0"><a href="java-to-kotlin-interop.html#default-methods-in-interfaces" id="e782445a">Learn more about default methods in the Java interop</a>.</p></section><section class="chapter"><h3 id="improvements-to-handling-nullability-annotations" data-toc="improvements-to-handling-nullability-annotations">Improvements to handling nullability annotations</h3>
<p id="61282399">Kotlin supports handling type nullability information from Java with <a href="java-interop.html#nullability-annotations" id="8807a74d">nullability annotations</a>. Kotlin 1.5.0 introduces a number of improvements for the feature:</p>
<ul class="list _bullet" id="d38c0207">
<li class="list__item" id="eac41b2f"><p>It reads nullability annotations on type arguments in compiled Java libraries that are used as dependencies.</p></li>
<li class="list__item" id="c023cb93">
<p>It supports nullability annotations with the <code class="code ">TYPE_USE</code> target for: </p>
<ul class="list _bullet" id="19b59593">
<li class="list__item" id="da54450e"><p>Arrays</p></li>
<li class="list__item" id="e12ed8b"><p>Varargs</p></li>
<li class="list__item" id="8346445a"><p>Fields</p></li>
<li class="list__item" id="f0c8f184"><p>Type parameters and their bounds</p></li>
<li class="list__item" id="2e687388"><p>Type arguments of base classes and interfaces</p></li>
</ul>
</li>
<li class="list__item" id="d009c2a7"><p>If a nullability annotation has multiple targets applicable to a type, and one of these targets is <code class="code ">TYPE_USE</code>, then <code class="code ">TYPE_USE</code> is preferred. For example, the method signature <code class="code ">@Nullable String[] f()</code> becomes <code class="code ">fun f(): Array&lt;String?&gt;!</code> if <code class="code ">@Nullable</code> supports both <code class="code ">TYPE_USE</code> and <code class="code ">METHOD</code>as targets.</p></li>
</ul>
<p id="db7e053">For these newly supported cases, using the wrong type nullability when calling Java from Kotlin produces warnings. Use the <code class="code ">-Xtype-enhancement-improvements-strict-mode</code> compiler option to enable strict mode for these cases (with error reporting).</p>
<p id="a270a156"><a href="java-interop.html#null-safety-and-platform-types" id="139ade56">Learn more about null-safety and platform types</a>.</p></section></section><section class="chapter"><h2 id="kotlin-native" data-toc="kotlin-native">Kotlin/Native</h2>
<p id="38c5d48c">Kotlin/Native is now more performant and stable. The notable changes are:</p>
<ul class="list _bullet" id="670f3748">
<li class="list__item" id="bd891f6c"><p><a href="#performance-improvements" id="5105cd7c">Performance improvements</a></p></li>
<li class="list__item" id="5b4e81c1"><p><a href="#deactivation-of-the-memory-leak-checker" id="cb869d60">Deactivation of the memory leak checker</a></p></li>
</ul>
<section class="chapter"><h3 id="performance-improvements" data-toc="performance-improvements">Performance improvements</h3>
<p id="3a75accc">In 1.5.0, Kotlin/Native is receiving a set of performance improvements that speed up both compilation and execution.</p>
<p id="b863a3f5"><a href="https://blog.jetbrains.com/kotlin/2020/03/kotlin-1-3-70-released/#kotlin-native" id="4ae26e0b" data-external="true" rel="noopener noreferrer">Compiler caches</a> are now supported in debug mode for <code class="code ">linuxX64</code> (only on Linux hosts) and <code class="code ">iosArm64</code> targets. With compiler caches enabled, most debug compilations complete much faster, except for the first one. Measurements showed about a 200% speed increase on our test projects.</p>
<p id="7aa33b72">To use compiler caches for new targets, opt in by adding the following lines to the project's <code class="code ">gradle.properties</code>:</p>
<ul class="list _bullet" id="3ee399e">
<li class="list__item" id="1b8651b"><p>For <code class="code ">linuxX64</code>: <code class="code ">kotlin.native.cacheKind.linuxX64=static</code></p></li>
<li class="list__item" id="3877e32a"><p>For <code class="code ">iosArm64</code>: <code class="code ">kotlin.native.cacheKind.iosArm64=static</code></p></li>
</ul>
<p id="3b737171">If you encounter any issues after enabling the compiler caches, please report them to our issue tracker <a href="https://kotl.in/issue" id="ac8aca22" data-external="true" rel="noopener noreferrer">YouTrack</a>.</p>
<p id="5fc0287f">Other improvements speed up the execution of Kotlin/Native code:</p>
<ul class="list _bullet" id="86966702">
<li class="list__item" id="3dbbd6eb"><p>Trivial property accessors are inlined.</p></li>
<li class="list__item" id="ab476725"><p><code class="code ">trimIndent()</code> on string literals is evaluated during the compilation.</p></li>
</ul></section><section class="chapter"><h3 id="deactivation-of-the-memory-leak-checker" data-toc="deactivation-of-the-memory-leak-checker">Deactivation of the memory leak checker</h3>
<p id="e804cbe9">The built-in Kotlin/Native memory leak checker has been disabled by default.</p>
<p id="dd94e079">It was initially designed for internal use, and it is able to find leaks only in a limited number of cases, not all of them. Moreover, it later turned out to have issues that can cause application crashes. So we've decided to turn off the memory leak checker.</p>
<p id="e19d7c7d">The memory leak checker can still be useful for certain cases, for example, unit testing. For these cases, you can enable it by adding the following line of code:</p>
<pre class="code" data-language="kotlin">Platform.isMemoryLeakCheckerActive = true
</pre>
<p id="83075032">Note that enabling the checker for the application runtime is not recommended.</p></section></section><section class="chapter"><h2 id="kotlin-js" data-toc="kotlin-js">Kotlin/JS</h2>
<p id="5be1a715">Kotlin/JS is receiving evolutionary changes in 1.5.0. We're continuing our work on moving the <a href="js-ir-compiler.html" id="7d6d7f6f">JS IR compiler backend</a> towards stable and shipping other updates:</p>
<ul class="list _bullet" id="6aaf239b">
<li class="list__item" id="dab24cfe"><p><a href="#upgrade-to-webpack-5" id="62e235ca">Upgrade of webpack to version 5</a></p></li>
<li class="list__item" id="cb46c2d4"><p><a href="#frameworks-and-libraries-for-the-ir-compiler" id="1cfeee90">Frameworks and libraries for the IR compiler</a></p></li>
</ul>
<section class="chapter"><h3 id="upgrade-to-webpack-5" data-toc="upgrade-to-webpack-5">Upgrade to webpack 5</h3>
<p id="13f2a881">The Kotlin/JS Gradle plugin now uses webpack 5 for browser targets instead of webpack 4. This is a major webpack upgrade that brings incompatible changes. If you're using a custom webpack configuration, be sure to check the <a href="https://webpack.js.org/blog/2020-10-10-webpack-5-release/" id="1408f452" data-external="true" rel="noopener noreferrer">webpack 5 release notes</a>.</p>
<p id="5f4536e8"><a href="js-project-setup.html#webpack-bundling" id="f2d474f5">Learn more about bundling Kotlin/JS projects with webpack</a>.</p></section><section class="chapter"><h3 id="frameworks-and-libraries-for-the-ir-compiler" data-toc="frameworks-and-libraries-for-the-ir-compiler">Frameworks and libraries for the IR compiler</h3>
<aside data-type="warning" class="prompt" data-title="" id="617fcbf5"><p id="b5e99800">The Kotlin/JS IR compiler is in <a href="components-stability.html" id="9a6ad261">Alpha</a>. It may change incompatibly and require manual migration in the future. We would appreciate your feedback on it in <a href="https://youtrack.jetbrains.com/issues/KT" id="b6dfc84b" data-external="true" rel="noopener noreferrer">YouTrack</a>.</p></aside><p id="ab2284d0">Along with working on the IR-based backend for Kotlin/JS compiler, we encourage and help library authors to build their projects in <code class="code ">both</code> mode. This means they are able to produce artifacts for both Kotlin/JS compilers, therefore growing the ecosystem for the new compiler.</p>
<p id="efdf8c3">Many well-known frameworks and libraries are already available for the IR backend: <a href="https://kvision.io/" id="326ab4f3" data-external="true" rel="noopener noreferrer">KVision</a>, <a href="https://www.fritz2.dev/" id="d7ec4538" data-external="true" rel="noopener noreferrer">fritz2</a>, <a href="https://github.com/nacular/doodle" id="e969991c" data-external="true" rel="noopener noreferrer">doodle</a>, and others. If you're using them in your project, you can already build it with the IR backend and see the benefits it brings.</p>
<p id="d53771f2">If you're writing your own library, <a href="js-ir-compiler.html#authoring-libraries-for-the-ir-compiler-with-backwards-compatibility" id="1c4a2438">compile it in the 'both' mode</a> so that your clients can also use it with the new compiler.</p></section></section><section class="chapter"><h2 id="kotlin-multiplatform" data-toc="kotlin-multiplatform">Kotlin Multiplatform</h2>
<p id="3cbd77b6">In Kotlin 1.5.0, <a href="#simplified-test-dependencies-usage-in-multiplatform-projects" id="8c8544a1">choosing a testing dependency for each platform has been simplified</a> and it is now done automatically by the Gradle plugin.</p>
<p id="131fc708">A new <a href="#new-api-for-getting-a-char-category-now-available-in-multiplatform-code" id="3ef51a93">API for getting a char category is now available in multiplatform projects</a>.</p></section><section class="chapter"><h2 id="standard-library" data-toc="standard-library">Standard library</h2>
<p id="db30da2a">The standard library has received a range of changes and improvements, from stabilizing experimental parts to adding new features:</p>
<ul class="list _bullet" id="f285bf01">
<li class="list__item" id="a8251868"><p><a href="#stable-unsigned-integer-types" id="d816d629">Stable unsigned integer types</a></p></li>
<li class="list__item" id="f3ed13fe"><p><a href="#stable-locale-agnostic-api-for-upper-lowercasing-text" id="aeb6919a">Stable locale-agnostic API for uppercase/lowercase text</a></p></li>
<li class="list__item" id="43efc113"><p><a href="#stable-char-to-integer-conversion-api" id="c545d198">Stable Char-to-integer conversion API</a></p></li>
<li class="list__item" id="1bcfb9e"><p><a href="#stable-path-api" id="84d39bf8">Stable Path API</a></p></li>
<li class="list__item" id="f18d5b3a"><p><a href="#floored-division-and-the-mod-operator" id="fbe1aef2">Floored division and the mod operator</a></p></li>
<li class="list__item" id="43e23f27"><p><a href="#duration-api-changes" id="2fbca077">Duration API changes</a></p></li>
<li class="list__item" id="e16efa13"><p><a href="#new-api-for-getting-a-char-category-now-available-in-multiplatform-code" id="19b64f09">New API for getting a char category now available in multiplatform code</a></p></li>
<li class="list__item" id="451d645e"><p><a href="#new-collections-function-firstnotnullof" id="9cc2772d">New collections function firstNotNullOf()</a></p></li>
<li class="list__item" id="a730acef"><p><a href="#strict-version-of-string-toboolean" id="212298ec">Strict version of String?.toBoolean()</a></p></li>
</ul>
<p id="352153e3">You can learn more about the standard library changes in <a href="https://blog.jetbrains.com/kotlin/2021/04/kotlin-1-5-0-rc-released" id="3cda0b06" data-external="true" rel="noopener noreferrer">this blog post</a>.</p>

<section class="chapter"><h3 id="stable-unsigned-integer-types" data-toc="stable-unsigned-integer-types">Stable unsigned integer types</h3>
<p id="265b5b2">The <code class="code ">UInt</code>, <code class="code ">ULong</code>, <code class="code ">UByte</code>, <code class="code ">UShort</code> unsigned integer types are now <a href="components-stability.html" id="22401498">Stable</a>. The same goes for operations on these types, ranges, and progressions of them. Unsigned arrays and operations on them remain in Beta.</p>
<p id="49d64ab7"><a href="unsigned-integer-types.html" id="426c6fd6">Learn more about unsigned integer types</a>.</p></section><section class="chapter"><h3 id="stable-locale-agnostic-api-for-upper-lowercasing-text" data-toc="stable-locale-agnostic-api-for-upper-lowercasing-text">Stable locale-agnostic API for upper/lowercasing text</h3>
<p id="902f4aa1">This release brings a new locale-agnostic API for uppercase/lowercase text conversion. It provides an alternative to the <code class="code ">toLowerCase()</code>, <code class="code ">toUpperCase()</code>, <code class="code ">capitalize()</code>, and <code class="code ">decapitalize()</code> API functions, which are locale-sensitive. The new API helps you avoid errors due to different locale settings.</p>
<p id="927f6de2">Kotlin 1.5.0 provides the following fully <a href="components-stability.html" id="97348923">Stable</a> alternatives:</p>
<ul class="list _bullet" id="8b46809b">
<li class="list__item" id="7f4af9aa">
<p id="ab83803">For <code class="code ">String</code> functions:</p>
<div class="table-wrapper"><table class=" wide" id="b515c979">
<thead><tr class="ijRowHead" id="1da37abb">
<th id="83eb090f"><p><b id="2d440082" class="">Earlier versions</b></p></th>
<th id="78dd555d"><p><b id="4c9e9e4" class="">1.5.0 alternative</b></p></th>
</tr></thead>
<tbody>
<tr class="" id="eb6c9056">
<td id="e3d13907"><p><code class="code ">String.toUpperCase()</code></p></td>
<td id="db1034c7"><p><code class="code ">String.uppercase()</code></p></td>
</tr>
<tr class="" id="d7abec33">
<td id="fb4145ed"><p><code class="code ">String.toLowerCase()</code></p></td>
<td id="b8214aab"><p><code class="code ">String.lowercase()</code></p></td>
</tr>
<tr class="" id="ad2ea42a">
<td id="165d57fd"><p><code class="code ">String.capitalize()</code></p></td>
<td id="bf550938"><p><code class="code ">String.replaceFirstChar { it.uppercase() }</code></p></td>
</tr>
<tr class="" id="96343d9b">
<td id="81ceea04"><p><code class="code ">String.decapitalize()</code></p></td>
<td id="3d5093e6"><p><code class="code ">String.replaceFirstChar { it.lowercase() }</code></p></td>
</tr>
</tbody>
</table></div>
</li>
<li class="list__item" id="4eeed606">
<p id="5ad2a6b7">For <code class="code ">Char</code> functions:</p>
<div class="table-wrapper"><table class=" wide" id="c092301b">
<thead><tr class="ijRowHead" id="2452d4d4">
<th id="df19d8e2"><p><b id="2ecf0479" class="">Earlier versions</b></p></th>
<th id="9fb7e2b4"><p><b id="1ab55b61" class="">1.5.0 alternative</b></p></th>
</tr></thead>
<tbody>
<tr class="" id="8fad467a">
<td id="c2eec62c"><p><code class="code ">Char.toUpperCase()</code></p></td>
<td id="b814cf85"><p><code class="code ">Char.uppercaseChar(): Char</code><br><code class="code ">Char.uppercase(): String</code></p></td>
</tr>
<tr class="" id="a0d76734">
<td id="930cd70"><p><code class="code ">Char.toLowerCase()</code></p></td>
<td id="6de30a5"><p><code class="code ">Char.lowercaseChar(): Char</code><br><code class="code ">Char.lowercase(): String</code></p></td>
</tr>
<tr class="" id="da23198">
<td id="36a99386"><p><code class="code ">Char.toTitleCase()</code></p></td>
<td id="b823bdcf"><p><code class="code ">Char.titlecaseChar(): Char</code><br><code class="code ">Char.titlecase(): String</code></p></td>
</tr>
</tbody>
</table></div>
</li>
</ul>
<aside data-type="note" class="prompt" data-title="" id="52facb47"><p id="39ccc797">For Kotlin/JVM, there are also overloaded <code class="code ">uppercase()</code>, <code class="code ">lowercase()</code>, and <code class="code ">titlecase()</code> functions with an explicit <code class="code ">Locale</code> parameter.</p></aside><p id="12a218ba">The old API functions are marked as deprecated and will be removed in a future release.</p>
<p id="596b56ad">See the full list of changes to the text processing functions in <a href="https://github.com/Kotlin/KEEP/blob/master/proposals/stdlib/locale-agnostic-case-conversions.md" id="3f359723" data-external="true" rel="noopener noreferrer">KEEP</a>.</p></section><section class="chapter"><h3 id="stable-char-to-integer-conversion-api" data-toc="stable-char-to-integer-conversion-api">Stable char-to-integer conversion API</h3>
<p id="39d27ba4">Starting from Kotlin 1.5.0, new char-to-code and char-to-digit conversion functions are <a href="components-stability.html" id="2fc33f44">Stable</a>. These functions replace the current API functions, which were often confused with the similar string-to-Int conversion.</p>
<p id="1e704868">The new API removes this naming confusion, making the code behavior more transparent and unambiguous.</p>
<p id="97549dea">This release introduces <code class="code ">Char</code> conversions that are divided into the following sets of clearly named functions:</p>
<ul class="list _bullet" id="b6fe9592"><li class="list__item" id="a8f972e9"><p>Functions to get the integer code of <code class="code ">Char</code> and to construct <code class="code ">Char</code> from the given code:</p></li></ul>
<pre class="code" data-language="kotlin">fun Char(code: Int): Char
fun Char(code: UShort): Char
val Char.code: Int
</pre>
<ul class="list _bullet" id="dcf23dc4"><li class="list__item" id="e7d4ef19"><p>Functions to convert <code class="code ">Char</code> to the numeric value of the digit it represents:</p></li></ul>
<pre class="code" data-language="kotlin">fun Char.digitToInt(radix: Int): Int
fun Char.digitToIntOrNull(radix: Int): Int?
</pre>
<ul class="list _bullet" id="ee9eb32c"><li class="list__item" id="81976937"><p>An extension function for <code class="code ">Int</code> to convert the non-negative single digit it represents to the corresponding <code class="code ">Char</code> representation:</p></li></ul>
<pre class="code" data-language="kotlin">fun Int.digitToChar(radix: Int): Char
</pre>
<p id="8d6f85cb">The old conversion APIs, including <code class="code ">Number.toChar()</code> with its implementations (all except <code class="code ">Int.toChar()</code>) and <code class="code ">Char</code> extensions for conversion to a numeric type, like <code class="code ">Char.toInt()</code>, are now deprecated.</p>
<p id="79c7e80b"><a href="https://github.com/Kotlin/KEEP/blob/master/proposals/stdlib/char-int-conversions.md" id="d314b5ac" data-external="true" rel="noopener noreferrer">Learn more about the char-to-integer conversion API in KEEP</a>.</p></section><section class="chapter"><h3 id="stable-path-api" data-toc="stable-path-api">Stable Path API</h3>
<p id="a63b6c22">The <a href="../api/latest/jvm/stdlib/kotlin.io.path/java.nio.file.-path/index.html" id="efc9ca9e" data-external="true" rel="noopener noreferrer">experimental Path API</a> with extensions for <code class="code ">java.nio.file.Path</code> is now <a href="components-stability.html" id="476bbe5d">Stable</a>.</p>
<pre class="code" data-language="kotlin">// construct path with the div (/) operator
val baseDir = Path("/base")
val subDir = baseDir / "subdirectory"

// list files in a directory
val kotlinFiles: List&lt;Path&gt; = Path("/home/user").listDirectoryEntries("*.kt")
</pre>
<p id="68ada05e"><a href="whatsnew1420.html#extensions-for-java-nio-file-path" id="1238de52">Learn more about the Path API</a>.</p></section><section class="chapter"><h3 id="floored-division-and-the-mod-operator" data-toc="floored-division-and-the-mod-operator">Floored division and the mod operator</h3>
<p id="de5a71e2">New operations for modular arithmetics have been added to the standard library:</p>
<ul class="list _bullet" id="2f108053">
<li class="list__item" id="ee0d01ff"><p><code class="code ">floorDiv()</code> returns the result of <a href="https://en.wikipedia.org/wiki/Floor_and_ceiling_functions" id="b3dd4a26" data-external="true" rel="noopener noreferrer">floored division</a>. It is available for integer types.</p></li>
<li class="list__item" id="89392c00"><p><code class="code ">mod()</code> returns the remainder of floored division (<em id="7c5d317d" class="">modulus</em>). It is available for all numeric types.</p></li>
</ul>
<p id="6b1d3e74">These operations look quite similar to the existing <a href="numbers.html#operations-on-numbers" id="9cd5f038">division of integers</a> and <a href="../api/latest/jvm/stdlib/kotlin/-int/rem.html" id="268e72b3" data-external="true" rel="noopener noreferrer">rem()</a> function (or the <code class="code ">%</code>operator), but they work differently on negative numbers:</p>
<ul class="list _bullet" id="da2b75e2">
<li class="list__item" id="9c8a7432"><p><code class="code ">a.floorDiv(b)</code> differs from a regular <code class="code ">/</code> in that <code class="code ">floorDiv</code> rounds the result down (towards the lesser integer), whereas <code class="code ">/</code> truncates the result to the integer closer to 0.</p></li>
<li class="list__item" id="b3e5dc52"><p><code class="code ">a.mod(b)</code> is the difference between <code class="code ">a</code> and <code class="code ">a.floorDiv(b) * b</code>. It's either zero or has the same sign as <code class="code ">b</code>, while <code class="code ">a % b</code> can have a different one.</p></li>
</ul>
<pre class="code" data-language="kotlin">fun main() {
//sampleStart
    println("Floored division -5/3: ${(-5).floorDiv(3)}")
    println( "Modulus: ${(-5).mod(3)}")
    
    println("Truncated division -5/3: ${-5 / 3}")
    println( "Remainder: ${-5 % 3}")
//sampleEnd    
}
</pre></section><section class="chapter"><h3 id="duration-api-changes" data-toc="duration-api-changes">Duration API changes</h3>
<aside data-type="warning" class="prompt" data-title="" id="ad09fa09"><p id="20ec3dc7">The Duration API is <a href="components-stability.html" id="2ad87071">Experimental</a>. It may be dropped or changed at any time. Use it only for evaluation purposes. We would appreciate hearing your feedback on it in <a href="https://youtrack.jetbrains.com/issues/KT" id="e76ff465" data-external="true" rel="noopener noreferrer">YouTrack</a>.</p></aside><p id="e5be209a">There is an experimental <a href="../api/latest/jvm/stdlib/kotlin.time/-duration/index.html" id="dedcd312" data-external="true" rel="noopener noreferrer">Duration</a> class for representing duration amounts in different time units. In 1.5.0, the Duration API has received the following changes:</p>
<ul class="list _bullet" id="2314a788">
<li class="list__item" id="56e6461"><p>Internal value representation now uses <code class="code ">Long</code> instead of <code class="code ">Double</code> to provide better precision.</p></li>
<li class="list__item" id="584682c2"><p>There is a new API for conversion to a particular time unit in <code class="code ">Long</code>. It comes to replace the old API, which operates with <code class="code ">Double</code> values and is now deprecated. For example, <a href="../api/latest/jvm/stdlib/kotlin.time/-duration/in-whole-minutes.html" id="16080d58" data-external="true" rel="noopener noreferrer"><code class="code ">Duration.inWholeMinutes</code></a> returns the value of the duration expressed as <code class="code ">Long</code> and replaces <code class="code ">Duration.inMinutes</code>.</p></li>
<li class="list__item" id="4212f786"><p>There are new companion functions for constructing a <code class="code ">Duration</code> from a number. For example, <a href="../api/latest/jvm/stdlib/kotlin.time/-duration/seconds.html" id="a885db" data-external="true" rel="noopener noreferrer"><code class="code ">Duration.seconds(Int)</code></a> creates a <code class="code ">Duration</code> object representing an integer number of seconds. Old extension properties like <code class="code ">Int.seconds</code> are now deprecated.</p></li>
</ul>
<pre class="code" data-language="kotlin">import kotlin.time.Duration
import kotlin.time.ExperimentalTime

@ExperimentalTime
fun main() {
//sampleStart
    val duration = Duration.milliseconds(120000)
    println("There are ${duration.inWholeSeconds} seconds in ${duration.inWholeMinutes} minutes")
//sampleEnd
}
</pre></section><section class="chapter"><h3 id="new-api-for-getting-a-char-category-now-available-in-multiplatform-code" data-toc="new-api-for-getting-a-char-category-now-available-in-multiplatform-code">New API for getting a char category now available in multiplatform code</h3>
<p id="8dc23f9">Kotlin 1.5.0 introduces the new API for getting a character's category according to Unicode in multiplatform projects. Several functions are now available in all the platforms and in the common code.</p>
<p id="d1ce4cb">Functions for checking whether a char is a letter or a digit:</p>
<ul class="list _bullet" id="9064f45e">
<li class="list__item" id="44b4d179"><p><a href="../api/latest/jvm/stdlib/kotlin.text/is-digit.html" id="c53e0a07" data-external="true" rel="noopener noreferrer"><code class="code ">Char.isDigit()</code></a></p></li>
<li class="list__item" id="4d35219b"><p><a href="../api/latest/jvm/stdlib/kotlin.text/is-letter.html" id="7be68432" data-external="true" rel="noopener noreferrer"><code class="code ">Char.isLetter()</code></a></p></li>
<li class="list__item" id="4320b0dd"><p><a href="../api/latest/jvm/stdlib/kotlin.text/is-letter-or-digit.html" id="5df4fb2a" data-external="true" rel="noopener noreferrer"><code class="code ">Char.isLetterOrDigit()</code></a></p></li>
</ul>
<pre class="code" data-language="kotlin">fun main() {
//sampleStart
    val chars = listOf('a', '1', '+')
    val (letterOrDigitList, notLetterOrDigitList) = chars.partition { it.isLetterOrDigit() }
    println(letterOrDigitList) // [a, 1]
    println(notLetterOrDigitList) // [+]
//sampleEnd    
}
</pre>
<p id="4b047627">Functions for checking the case of a char:</p>
<ul class="list _bullet" id="b0c5780d">
<li class="list__item" id="548a3bea"><p><a href="../api/latest/jvm/stdlib/kotlin.text/is-lower-case.html" id="7afcae43" data-external="true" rel="noopener noreferrer"><code class="code ">Char.isLowerCase()</code></a></p></li>
<li class="list__item" id="735cb0be"><p><a href="../api/latest/jvm/stdlib/kotlin.text/is-upper-case.html" id="7d79e184" data-external="true" rel="noopener noreferrer"><code class="code ">Char.isUpperCase()</code></a></p></li>
<li class="list__item" id="b1fee4b3"><p><a href="../api/latest/jvm/stdlib/kotlin.text/is-title-case.html" id="a6e012bb" data-external="true" rel="noopener noreferrer"><code class="code ">Char.isTitleCase()</code></a></p></li>
</ul>
<pre class="code" data-language="kotlin">fun main() {
//sampleStart
    val chars = listOf('ǅ', 'ǈ', 'ǋ', 'ǲ', '1', 'A', 'a', '+')
    val (titleCases, notTitleCases) = chars.partition { it.isTitleCase() }
    println(titleCases) // [ǅ, ǈ, ǋ, ǲ]
    println(notTitleCases) // [1, A, a, +]
//sampleEnd    
}
</pre>
<p id="ec3d8ff9">Some other functions:</p>
<ul class="list _bullet" id="212fc844">
<li class="list__item" id="3a65e5b5"><p><a href="../api/latest/jvm/stdlib/kotlin.text/is-defined.html" id="e99be7f6" data-external="true" rel="noopener noreferrer"><code class="code ">Char.isDefined()</code></a></p></li>
<li class="list__item" id="901a5863"><p><a href="../api/latest/jvm/stdlib/kotlin.text/is-i-s-o-control.html" id="26806a66" data-external="true" rel="noopener noreferrer"><code class="code ">Char.isISOControl()</code></a></p></li>
</ul>
<p id="d7c8969e">The property <a href="../api/latest/jvm/stdlib/kotlin.text/category.html" id="34dbc32c" data-external="true" rel="noopener noreferrer"><code class="code ">Char.category</code></a> and its return type enum class <a href="../api/latest/jvm/stdlib/kotlin.text/-char-category/index.html" id="8b259c21" data-external="true" rel="noopener noreferrer"><code class="code ">CharCategory</code></a>, which indicates a char's general category according to Unicode, are now also available in multiplatform projects.</p>
<p id="fabb9e46"><a href="characters.html" id="2e9859ec">Learn more about characters</a>.</p></section><section class="chapter"><h3 id="new-collections-function-firstnotnullof" data-toc="new-collections-function-firstnotnullof">New collections function firstNotNullOf()</h3>
<p id="ba43b961">The new <a href="../api/latest/jvm/stdlib/kotlin.collections/first-not-null-of.html" id="8c4ba047" data-external="true" rel="noopener noreferrer"><code class="code ">firstNotNullOf()</code></a> and <a href="../api/latest/jvm/stdlib/kotlin.collections/first-not-null-of-or-null.html" id="15c91043" data-external="true" rel="noopener noreferrer"><code class="code ">firstNotNullOfOrNull()</code></a> functions combine <a href="../api/latest/jvm/stdlib/kotlin.collections/map-not-null.html" id="c55b6486" data-external="true" rel="noopener noreferrer"><code class="code ">mapNotNull()</code></a> with <a href="../api/latest/jvm/stdlib/kotlin.collections/first.html" id="15bad1a4" data-external="true" rel="noopener noreferrer"><code class="code ">first()</code></a> or <a href="../api/latest/jvm/stdlib/kotlin.collections/first-or-null.html" id="fe155a52" data-external="true" rel="noopener noreferrer"><code class="code ">firstOrNull()</code></a>. They map the original collection with the custom selector function and return the first non-null value. If there is no such value, <code class="code ">firstNotNullOf()</code> throws an exception, and <code class="code ">firstNotNullOfOrNull()</code> returns null.</p>
<pre class="code" data-language="kotlin">fun main() {
//sampleStart
    val data = listOf("Kotlin", "1.5")
    println(data.firstNotNullOf(String::toDoubleOrNull))
    println(data.firstNotNullOfOrNull(String::toIntOrNull))
//sampleEnd
}
</pre></section><section class="chapter"><h3 id="strict-version-of-string-toboolean" data-toc="strict-version-of-string-toboolean">Strict version of String?.toBoolean()</h3>
<p id="8fca0354">Two new functions introduce case-sensitive strict versions of the existing <a href="../api/latest/jvm/stdlib/kotlin.text/to-boolean.html" id="2b2c74f1" data-external="true" rel="noopener noreferrer">String?.toBoolean()</a>:</p>
<ul class="list _bullet" id="f537aea2">
<li class="list__item" id="fc2aa274"><p><a href="../api/latest/jvm/stdlib/kotlin.text/to-boolean-strict.html" id="b2b7fb01" data-external="true" rel="noopener noreferrer"><code class="code ">String.toBooleanStrict()</code></a> throws an exception for all inputs except the literals <code class="code ">true</code> and <code class="code ">false</code>.</p></li>
<li class="list__item" id="2626f615"><p><a href="../api/latest/jvm/stdlib/kotlin.text/to-boolean-strict-or-null.html" id="26e1b4e9" data-external="true" rel="noopener noreferrer"><code class="code ">String.toBooleanStrictOrNull()</code></a> returns null for all inputs except the literals <code class="code ">true</code> and <code class="code ">false</code>.</p></li>
</ul>
<pre class="code" data-language="kotlin">fun main() {
//sampleStart
    println("true".toBooleanStrict())
    println("1".toBooleanStrictOrNull())
    // println("1".toBooleanStrict()) // Exception
//sampleEnd    
}
</pre></section></section><section class="chapter"><h2 id="kotlin-test-library" data-toc="kotlin-test-library">kotlin-test library</h2>
<p id="7b2ba0de">The <a href="https://kotlinlang.org/api/latest/kotlin.test/" id="4b9284cd" data-external="true" rel="noopener noreferrer">kotlin-test</a> library introduces some new features:</p>
<ul class="list _bullet" id="696f793e">
<li class="list__item" id="f73f52d7"><p><a href="#simplified-test-dependencies-usage-in-multiplatform-projects" id="eb33a8e2">Simplified test dependencies usage in multiplatform projects</a></p></li>
<li class="list__item" id="3a8fdc6d"><p><a href="#automatic-selection-of-a-testing-framework-for-kotlin-jvm-source-sets" id="d15f8c36">Automatic selection of a testing framework for Kotlin/JVM source sets</a></p></li>
<li class="list__item" id="921c9769"><p><a href="#assertion-function-updates" id="3244ba4c">Assertion function updates</a></p></li>
</ul>
<section class="chapter"><h3 id="simplified-test-dependencies-usage-in-multiplatform-projects" data-toc="simplified-test-dependencies-usage-in-multiplatform-projects">Simplified test dependencies usage in multiplatform projects</h3>
<p id="83680d16">Now you can use the <code class="code ">kotlin-test</code> dependency to add dependencies for testing in the <code class="code ">commonTest</code> source set, and the Gradle plugin will infer the corresponding platform dependencies for each test source set:</p>
<ul class="list _bullet" id="6d827088">
<li class="list__item" id="1d33f5d0"><p><code class="code ">kotlin-test-junit</code> for JVM source sets, see <a href="#automatic-selection-of-a-testing-framework-for-kotlin-jvm-source-sets" id="1fdce2dc">automatic choice of a testing framework for Kotlin/JVM source sets</a></p></li>
<li class="list__item" id="fd0bfdbc"><p><code class="code ">kotlin-test-js</code> for Kotlin/JS source sets</p></li>
<li class="list__item" id="a0e0bf9e"><p><code class="code ">kotlin-test-common</code> and <code class="code ">kotlin-test-annotations-common</code> for common source sets</p></li>
<li class="list__item" id="ed71e95f"><p>No extra artifact for Kotlin/Native source sets</p></li>
</ul>
<p id="8faf2971">Additionally, you can use the <code class="code ">kotlin-test</code> dependency in any shared or platform-specific source set.</p>
<p id="3376d43d">An existing kotlin-test setup with explicit dependencies will continue to work both in Gradle and in Maven.</p>
<p id="831d3252">Learn more about <a href="gradle-configure-project.html#set-dependencies-on-test-libraries" id="a6041e8b">setting dependencies on test libraries</a>.</p></section><section class="chapter"><h3 id="automatic-selection-of-a-testing-framework-for-kotlin-jvm-source-sets" data-toc="automatic-selection-of-a-testing-framework-for-kotlin-jvm-source-sets">Automatic selection of a testing framework for Kotlin/JVM source sets</h3>
<p id="756c14da">The Gradle plugin now chooses and adds a dependency on a testing framework automatically. All you need to do is add the dependency <code class="code ">kotlin-test</code> in the common source set.</p>
<p id="bfbef7f3">Gradle uses JUnit 4 by default. Therefore, the <code class="code ">kotlin("test")</code> dependency resolves to the variant for JUnit 4, namely <code class="code ">kotlin-test-junit</code>:</p>
<div class="tabs" id="cb9d6cc5" data-group="build-script" data-anchors="[d0c55a92,3755ae4c,24905319,b6755da7,cb9d6cc5]">
<div class="tabs__content" data-gtm="tab" id="d0c55a92" data-sync-tabs="kotlin" data-title="Kotlin"><pre class="code" data-language="kotlin">kotlin {
    sourceSets {
        val commonTest by getting {
            dependencies {
                implementation(kotlin("test")) // This brings the dependency
                                               // on JUnit 4 transitively
            }
        }
    }
}
</pre></div>
<div class="tabs__content" data-gtm="tab" id="24905319" data-sync-tabs="groovy" data-title="Groovy"><pre class="code" data-language="groovy">kotlin {
    sourceSets {
        commonTest {
            dependencies {
                implementation kotlin("test") // This brings the dependency 
                                              // on JUnit 4 transitively
            }
        }
    }
}
</pre></div>
</div>
<p id="560889b8">You can choose JUnit 5 or TestNG by calling <a href="https://docs.gradle.org/current/javadoc/org/gradle/api/tasks/testing/Test.html#useJUnitPlatform" id="b3c1af19" data-external="true" rel="noopener noreferrer"><code class="code ">useJUnitPlatform()</code></a> or <a href="https://docs.gradle.org/current/javadoc/org/gradle/api/tasks/testing/Test.html#useTestNG" id="ecf014ab" data-external="true" rel="noopener noreferrer"><code class="code ">useTestNG()</code></a> in the test task:</p>
<pre class="code" data-language="groovy">tasks {
    test {
        // enable TestNG support
        useTestNG()
        // or
        // enable JUnit Platform (a.k.a. JUnit 5) support
        useJUnitPlatform()
    }
}
</pre>
<p id="1922050">You can disable automatic testing framework selection by adding the line <code class="code ">kotlin.test.infer.jvm.variant=false</code> to the project's <code class="code ">gradle.properties</code>.</p>
<p id="d8419ea2">Learn more about <a href="gradle-configure-project.html#set-dependencies-on-test-libraries" id="1082aeeb">setting dependencies on test libraries</a>.</p></section><section class="chapter"><h3 id="assertion-function-updates" data-toc="assertion-function-updates">Assertion function updates</h3>
<p id="568f202b">This release brings new assertion functions and improves the existing ones.</p>
<p id="1a7bdd35">The <code class="code ">kotlin-test</code> library now has the following features:</p>
<ul class="list _bullet" id="9cc45380">
<li class="list__item" id="951f9e6e">
<p id="84607323"><b id="ffb5e5da" class="">Checking the type of a value</b></p>
<p id="8ab9cf18">You can use the new <code class="code ">assertIs&lt;T&gt;</code> and <code class="code ">assertIsNot&lt;T&gt;</code> to check the type of a value:</p>
<pre class="code" data-language="kotlin">@Test
fun testFunction() {
    val s: Any = "test"
    assertIs&lt;String&gt;(s)  // throws AssertionError mentioning the actual type of s if the assertion fails
    // can now print s.length because of contract in assertIs
    println("${s.length}")
}
</pre>
<p id="b9206560">Because of type erasure, this assert function only checks whether the <code class="code ">value</code> is of the <code class="code ">List</code> type in the following example and doesn't check whether it's a list of the particular <code class="code ">String</code> element type: <code class="code ">assertIs&lt;List&lt;String&gt;&gt;(value)</code>.</p>
</li>
<li class="list__item" id="75f5385f">
<p id="a21d3cbf"><b id="50c4bd36" class="">Comparing the container content for arrays, sequences, and arbitrary iterables</b></p>
<p id="4a8d72db">There is a new set of overloaded <code class="code ">assertContentEquals()</code> functions for comparing content for different collections that don't implement <a href="equality.html#structural-equality" id="d783208f">structural equality</a>:</p>
<pre class="code" data-language="kotlin">@Test
fun test() {
    val expectedArray = arrayOf(1, 2, 3)
    val actualArray = Array(3) { it + 1 }
    assertContentEquals(expectedArray, actualArray)
}
</pre>
</li>
<li class="list__item" id="4b21916c">
<p id="74501c7e"><b id="3c662c6b" class="">New overloads to <code class="code ">assertEquals()</code> and <code class="code ">assertNotEquals()</code> for <code class="code ">Double</code> and <code class="code ">Float</code> numbers</b></p>
<p id="e0cc5e2e">There are new overloads for the <code class="code ">assertEquals()</code> function that make it possible to compare two <code class="code ">Double</code> or <code class="code ">Float</code> numbers with absolute precision. The precision value is specified as the third parameter of the function:</p>
<pre class="code" data-language="kotlin"> @Test
fun test() {
    val x = sin(PI)

    // precision parameter
    val tolerance = 0.000001

    assertEquals(0.0, x, tolerance)
}
</pre>
</li>
<li class="list__item" id="87efe851">
<p id="e70c6d47"><b id="1732a227" class="">New functions for checking the content of collections and elements</b></p>
<p id="e2cb8685">You can now check whether the collection or element contains something with the <code class="code ">assertContains()</code> function. You can use it with Kotlin collections and elements that have the <code class="code ">contains()</code> operator, such as <code class="code ">IntRange</code>, <code class="code ">String</code>, and others:</p>
<pre class="code" data-language="kotlin">@Test
fun test() {
    val sampleList = listOf&lt;String&gt;("sample", "sample2")
    val sampleString = "sample"
    assertContains(sampleList, sampleString)  // element in collection
    assertContains(sampleString, "amp")       // substring in string
}
</pre>
</li>
<li class="list__item" id="72dae772">
<p id="40d94b92"><b id="f5bed550" class=""><code class="code ">assertTrue()</code>, <code class="code ">assertFalse()</code>, <code class="code ">expect()</code> functions are now inline</b></p>
<p id="ab76a9c6">From now on, you can use these as inline functions, so it's possible to call <a href="composing-suspending-functions.html" id="152ffe45">suspend functions</a> inside a lambda expression:</p>
<pre class="code" data-language="kotlin">@Test
fun test() = runBlocking&lt;Unit&gt; {
    val deferred = async { "Kotlin is nice" }
    assertTrue("Kotlin substring should be present") {
        deferred.await() .contains("Kotlin")
    }
}
</pre>
</li>
</ul></section></section><section class="chapter"><h2 id="kotlinx-libraries" data-toc="kotlinx-libraries">kotlinx libraries</h2>
<p id="b4396d5a">Along with Kotlin 1.5.0, we are releasing new versions of the kotlinx libraries:</p>
<ul class="list _bullet" id="83c22f02">
<li class="list__item" id="7f7e5d98"><p><code class="code ">kotlinx.coroutines</code> <a href="#coroutines-1-5-0-rc" id="3c1c64ff">1.5.0-RC</a></p></li>
<li class="list__item" id="97e90b9e"><p><code class="code ">kotlinx.serialization</code> <a href="#serialization-1-2-1" id="ab0821e">1.2.1</a></p></li>
<li class="list__item" id="81b5461f"><p><code class="code ">kotlinx-datetime</code> <a href="#datetime-0-2-0" id="f7247c14">0.2.0</a></p></li>
</ul>
<section class="chapter"><h3 id="coroutines-1-5-0-rc" data-toc="coroutines-1-5-0-rc">Coroutines 1.5.0-RC</h3>
<p id="a38a67f5"><code class="code ">kotlinx.coroutines</code> <a href="https://github.com/Kotlin/kotlinx.coroutines/releases/tag/1.5.0-RC" id="93fb3872" data-external="true" rel="noopener noreferrer">1.5.0-RC</a> is here with:</p>
<ul class="list _bullet" id="e1fd625d">
<li class="list__item" id="a49f5378"><p><a href="channels.html" id="fc4e2cd4">New channels API</a></p></li>
<li class="list__item" id="bc0025ba"><p>Stable <a href="async-programming.html#reactive-extensions" id="736a961b">reactive integrations</a></p></li>
<li class="list__item" id="ba6eb2e8"><p>And more</p></li>
</ul>
<p id="c4804ac1">Starting with Kotlin 1.5.0, <a href="whatsnew14.html#exclusion-of-the-deprecated-experimental-coroutines" id="ccac404e">experimental coroutines</a> are disabled and the <code class="code ">-Xcoroutines=experimental</code> flag is no longer supported.</p>
<p id="3f3eabca">Learn more in the <a href="https://github.com/Kotlin/kotlinx.coroutines/releases/tag/1.5.0-RC" id="8dc7c741" data-external="true" rel="noopener noreferrer">changelog</a> and the <a href="https://blog.jetbrains.com/kotlin/2021/05/kotlin-coroutines-1-5-0-released/" id="5f4999fb" data-external="true" rel="noopener noreferrer"><code class="code ">kotlinx.coroutines</code> 1.5.0 release blog post</a>.</p>
</section><section class="chapter"><h3 id="serialization-1-2-1" data-toc="serialization-1-2-1">Serialization 1.2.1</h3>
<p id="867291ee"><code class="code ">kotlinx.serialization</code> <a href="https://github.com/Kotlin/kotlinx.serialization/releases/tag/v1.2.1" id="b812757f" data-external="true" rel="noopener noreferrer">1.2.1</a> is here with:</p>
<ul class="list _bullet" id="c11709dc">
<li class="list__item" id="4e8b9081"><p>Improvements to JSON serialization performance</p></li>
<li class="list__item" id="b86d4097"><p>Support for multiple names in JSON serialization</p></li>
<li class="list__item" id="da03b0c2"><p>Experimental .proto schema generation from <code class="code ">@Serializable</code> classes</p></li>
<li class="list__item" id="d8c5db64"><p>And more</p></li>
</ul>
<p id="e29d1865">Learn more in the <a href="https://github.com/Kotlin/kotlinx.serialization/releases/tag/v1.2.1" id="5549cbae" data-external="true" rel="noopener noreferrer">changelog</a> and the <a href="https://blog.jetbrains.com/kotlin/2021/05/kotlinx-serialization-1-2-released/" id="9007316" data-external="true" rel="noopener noreferrer"><code class="code ">kotlinx.serialization</code> 1.2.1 release blog post</a>.</p>
</section><section class="chapter"><h3 id="datetime-0-2-0" data-toc="datetime-0-2-0">dateTime 0.2.0</h3>
<p id="ffeb987f"><code class="code ">kotlinx-datetime</code> <a href="https://github.com/Kotlin/kotlinx-datetime/releases/tag/v0.2.0" id="94bc296d" data-external="true" rel="noopener noreferrer">0.2.0</a> is here with:</p>
<ul class="list _bullet" id="807b3550">
<li class="list__item" id="c479bce"><p><code class="code ">@Serializable</code> Datetime objects</p></li>
<li class="list__item" id="9d7c1d90"><p>Normalized API of <code class="code ">DateTimePeriod</code> and <code class="code ">DatePeriod</code></p></li>
<li class="list__item" id="e4130752"><p>And more</p></li>
</ul>
<p id="ca47a1e6">Learn more in the <a href="https://github.com/Kotlin/kotlinx-datetime/releases/tag/v0.2.0" id="5d640f9f" data-external="true" rel="noopener noreferrer">changelog</a> and the <a href="https://blog.jetbrains.com/kotlin/2021/05/kotlinx-datetime-0-2-0-is-out/" id="e4741606" data-external="true" rel="noopener noreferrer"><code class="code ">kotlinx-datetime</code> 0.2.0 release blog post</a>.</p></section></section><section class="chapter"><h2 id="migrating-to-kotlin-1-5-0" data-toc="migrating-to-kotlin-1-5-0">Migrating to Kotlin 1.5.0</h2>
<p id="e8851cba">IntelliJ IDEA and Android Studio will suggest updating the Kotlin plugin to 1.5.0 once it is available.</p>
<p id="49749daa">To migrate existing projects to Kotlin 1.5.0, just change the Kotlin version to <code class="code ">1.5.0</code> and re-import your Gradle or Maven project. <a href="releases.html#update-to-a-new-release" id="df322aab">Learn how to update to Kotlin 1.5.0</a>.</p>
<p id="c8becc1">To start a new project with Kotlin 1.5.0, update the Kotlin plugin and run the Project Wizard from <b id="a3e8bef4" class="">File</b> | <b id="7b1a8cb0" class="">New</b> | <b id="a7f775ff" class="">Project</b>.</p>
<p id="cbb9fe6d">The new command-line compiler is available for downloading on the <a href="https://github.com/JetBrains/kotlin/releases/tag/v1.5.0" id="2a6a47a2" data-external="true" rel="noopener noreferrer">GitHub release page</a>.</p>
<p id="edad5990">Kotlin 1.5.0 is a <a href="kotlin-evolution.html#feature-releases-and-incremental-releases" id="d980b004">feature release</a> and therefore can bring incompatible changes to the language. Find the detailed list of such changes in the <a href="compatibility-guide-15.html" id="d0bce283">Compatibility Guide for Kotlin 1.5</a>.</p></section><div class="last-modified"> Last modified: 25 May 2023</div>

<div class="navigation-links _bottom"> <a class="navigation-links__prev" href="whatsnew1520.html">What's new in Kotlin 1.5.20</a> <a class="navigation-links__next" href="whatsnew1430.html">What's new in Kotlin 1.4.30</a> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2010&ndash;2023 JetBrains s.r.o. and Kotlin Programming Language contributors<br>Licensed under the Apache License, Version 2.0.<br>
    <a href="https://kotlinlang.org/docs/whatsnew15.html" class="_attribution-link">https://kotlinlang.org/docs/whatsnew15.html</a>
  </p>
</div>
