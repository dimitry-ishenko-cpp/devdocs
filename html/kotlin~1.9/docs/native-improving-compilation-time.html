<h1 data-toc="native-improving-compilation-time" id="native-improving-compilation-time.md">Tips for improving Kotlin/Native compilation times</h1>
<p id="dc0bb87">The Kotlin/Native compiler is constantly receiving updates that improve its performance. With the latest Kotlin/Native compiler and a properly configured build environment, you can significantly improve the compilation times of your projects with Kotlin/Native targets.</p>
<p id="365190e6">Read on for our tips on how to speed up the Kotlin/Native compilation process.</p>
<section class="chapter"><h2 id="general-recommendations" data-toc="general-recommendations">General recommendations</h2>
<ul class="list _bullet" id="bf17dc5c">
<li class="list__item" id="a07df48c"><p id="6ebcd514"><b id="a57ef6e7" class="">Use the most recent version of Kotlin</b>. This way you will always have the latest performance improvements.</p></li>
<li class="list__item" id="19c3eed2"><p id="ccdaabb7"><b id="bc874c3" class="">Avoid creating huge classes</b>. They take a long time to compile and load during execution.</p></li>
<li class="list__item" id="54c3d4a0">
<p id="3be3795e"><b id="2416ed4c" class="">Preserve downloaded and cached components between builds</b>. When compiling projects, Kotlin/Native downloads the required components and caches some results of its work to the <code class="code ">$USER_HOME/.konan</code> directory. The compiler uses this directory for subsequent compilations, making them take less time to complete.</p>
<p id="2d498513">When building in containers (such as Docker) or with continuous integration systems, the compiler may have to create the <code class="code ">~/.konan</code> directory from scratch for each build. To avoid this step, configure your environment to preserve <code class="code ">~/.konan</code> between builds. For example, redefine its location using the <code class="code ">KONAN_DATA_DIR</code> environment variable.</p>
</li>
</ul></section><section class="chapter"><h2 id="gradle-configuration" data-toc="gradle-configuration">Gradle configuration</h2>
<p id="152a5ddc">The first compilation with Gradle usually takes more time than subsequent ones due to the need to download the dependencies, build caches, and perform additional steps. You should build your project at least twice to get an accurate reading of the actual compilation times.</p>
<p id="9e3c50d4">Here are some recommendations for configuring Gradle for better compilation performance:</p>
<ul class="list _bullet" id="ccc65d8c">
<li class="list__item" id="ff943042"><p id="28eff5a7"><b id="82487931" class="">Increase the <a href="https://docs.gradle.org/current/userguide/performance.html#adjust_the_daemons_heap_size" id="97af422b" data-external="true" rel="noopener noreferrer">Gradle heap size</a></b>. Add <code class="code ">org.gradle.jvmargs=-Xmx3g</code> to <code class="code ">gradle.properties</code>. If you use <a href="https://docs.gradle.org/current/userguide/performance.html#parallel_execution" id="d2fd191" data-external="true" rel="noopener noreferrer">parallel builds</a>, you might need to choose the right number of workers with the <code class="code ">org.gradle.workers.max</code> property or the <code class="code ">--max-workers</code> command-line option. The default value is the number of CPU processors.</p></li>
<li class="list__item" id="f39fc3b1">
<p id="1cb51c56"><b id="232cfad" class="">Build only the binaries you need</b>. Don't run Gradle tasks that build the whole project, such as <code class="code ">build</code> or <code class="code ">assemble</code>, unless you really need to. These tasks build the same code more than once, increasing the compilation times. In typical cases such as running tests from IntelliJ IDEA or starting the app from Xcode, the Kotlin tooling avoids executing unnecessary tasks.</p>
<p id="6f8c668a">If you have a non-typical case or build configuration, you might need to choose the task yourself.</p>
<ul class="list _bullet" id="d4638be">
<li class="list__item" id="142298bb"><p id="aa6c3fb8"><code class="code ">linkDebug*</code>: To run your code during development, you usually need only one binary, so running the corresponding <code class="code ">linkDebug*</code> task should be enough. Keep in mind that compiling a release binary (<code class="code ">linkRelease*</code>) takes more time than compiling a debug one.</p></li>
<li class="list__item" id="815258e3">
<p id="dcf575a"><code class="code ">packForXcode</code>: Since iOS simulators and devices have different processor architectures, it's a common approach to distribute a Kotlin/Native binary as a universal (fat) framework. During local development, it will be faster to build the <code class="code ">.framework</code> for only the platform you're using.</p>
<p id="e604a34">To build a platform-specific framework, call the <code class="code ">packForXcode</code> task generated by the <a href="multiplatform-mobile-create-first-app.html" id="dd7cf4fa">Kotlin Multiplatform project wizard</a>.</p>
<aside data-type="note" class="prompt" data-title="" id="121d32bd"><p id="e2f8f72">Remember that in this case, you will need to clean the build using <code class="code ">./gradlew clean</code> after switching between the device and the simulator. See <a href="https://youtrack.jetbrains.com/issue/KT-40907" id="8cef86cf" data-external="true" rel="noopener noreferrer">this issue</a> for details.</p></aside>
</li>
</ul>
</li>
<li class="list__item" id="789c627"><p id="201cde11"><b id="e0c31268" class="">Don't disable the <a href="https://docs.gradle.org/current/userguide/gradle_daemon.html" id="eb4a7dce" data-external="true" rel="noopener noreferrer">Gradle daemon</a></b> without having a good reason to. <a href="https://blog.jetbrains.com/kotlin/2020/03/kotlin-1-3-70-released/#kotlin-native" id="10a83bc8" data-external="true" rel="noopener noreferrer">Kotlin/Native runs from the Gradle daemon</a> by default. When it's enabled, the same JVM process is used and there is no need to warm it up for each compilation.</p></li>
<li class="list__item" id="85c2c8ec"><p id="8e8ded1b"><b id="da840be1" class="">Don't use <a href="multiplatform-build-native-binaries.html#export-dependencies-to-binaries" id="818b58a7">transitiveExport = true</a></b>. Using transitive export disables dead code elimination in many cases: the compiler has to process a lot of unused code. It increases the compilation time. Use <code class="code ">export</code> explicitly for exporting the required projects and dependencies.</p></li>
<li class="list__item" id="e20d617a">
<p id="9a37b73b"><b id="906b947b" class="">Use the Gradle <a href="https://docs.gradle.org/current/userguide/build_cache.html" id="f97f4e9b" data-external="true" rel="noopener noreferrer">build caches</a></b>:</p>
<ul class="list _bullet" id="bab934f3">
<li class="list__item" id="4599cdac"><p><b id="d95cac70" class="">Local build cache</b>: Add <code class="code ">org.gradle.caching=true</code> to your <code class="code ">gradle.properties</code> or run with <code class="code ">--build-cache</code> on the command line.</p></li>
<li class="list__item" id="d4831e2a"><p><b id="34f00c80" class="">Remote build cache</b> in continuous integration environments. Learn how to <a href="https://docs.gradle.org/current/userguide/build_cache.html#sec:build_cache_configure_remote" id="9ee8cf74" data-external="true" rel="noopener noreferrer">configure the remote build cache</a>.</p></li>
</ul>
</li>
<li class="list__item" id="3f5f89e1"><p id="88f7cf09"><b id="5d2b487c" class="">Enable previously disabled features of Kotlin/Native</b>. There are properties that disable the Gradle daemon and compiler caches â€“ <code class="code ">kotlin.native.disableCompilerDaemon=true</code> and <code class="code ">kotlin.native.cacheKind=none</code>. If you had issues with these features before and added these lines to your <code class="code ">gradle.properties</code> or Gradle arguments, remove them and check whether the build completes successfully. It is possible that these properties were added previously to work around issues that have already been fixed.</p></li>
</ul></section><section class="chapter"><h2 id="windows-os-configuration" data-toc="windows-os-configuration">Windows OS configuration</h2>
<ul class="list _bullet" id="febdb3cb"><li class="list__item" id="c18f2ae9"><p><b id="e56de882" class="">Configure Windows Security</b>. Windows Security may slow down the Kotlin/Native compiler. You can avoid this by adding the <code class="code ">.konan</code> directory, which is located in <code class="code ">%USERPROFILE%</code> by default, to Windows Security exclusions. Learn how to <a href="https://support.microsoft.com/en-us/windows/add-an-exclusion-to-windows-security-811816c0-4dfd-af4a-47e4-c301afe13b26" id="d227b048" data-external="true" rel="noopener noreferrer">add exclusions to Windows Security</a>.</p></li></ul></section><div class="last-modified"> Last modified: 11 April 2023</div>

<div class="navigation-links _bottom"> <a class="navigation-links__prev" href="native-target-support.html">Kotlin/Native target support</a> <a class="navigation-links__next" href="native-binary-licenses.html">License files for the Kotlin/Native binaries</a> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2010&ndash;2023 JetBrains s.r.o. and Kotlin Programming Language contributors<br>Licensed under the Apache License, Version 2.0.<br>
    <a href="https://kotlinlang.org/docs/native-improving-compilation-time.html" class="_attribution-link">https://kotlinlang.org/docs/native-improving-compilation-time.html</a>
  </p>
</div>
