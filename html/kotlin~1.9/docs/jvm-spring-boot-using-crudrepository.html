<h1 data-toc="jvm-spring-boot-using-crudrepository" id="jvm-spring-boot-using-crudrepository.md">Use Spring Data CrudRepository for database access</h1>
<p id="9ac71f6b">In this part, you will migrate the service layer to use the <a href="https://docs.spring.io/spring-data/commons/docs/current/api/org/springframework/data/repository/CrudRepository.html" id="ea3ab480" data-external="true" rel="noopener noreferrer">Spring Data</a> <code class="code ">CrudRepository</code> instead of <code class="code ">JdbcTemplate</code> for database access. <em id="d942296c" class="">CrudRepository</em> is a Spring Data interface for generic <a href="https://en.wikipedia.org/wiki/Create,_read,_update_and_delete" id="f418bc22" data-external="true" rel="noopener noreferrer">CRUD</a> operations on a repository of a specific type. It provides several methods out of the box for interacting with a database.</p>
<section class="chapter"><h2 id="update-your-application" data-toc="update-your-application">Update your application</h2>
<p id="458382d0">First, you need to adjust the <code class="code ">Message</code> class for work with the <code class="code ">CrudRepository</code> API:</p>
<ol class="list _decimal" id="b07df78e" type="1">
<li class="list__item" id="e3ebd3e7">
<p id="b4424079">Add the <code class="code ">@Table</code> annotation to the <code class="code ">Message</code> class to declare mapping to a database table.<br> Add the <code class="code ">@Id</code> annotation before the <code class="code ">id</code> field.</p>
<aside data-type="note" class="prompt" data-title="" id="79fde2f"><p id="45ebd206">These annotations also require additional imports.</p></aside><pre class="code" data-language="kotlin">import org.springframework.data.annotation.Id
import org.springframework.data.relational.core.mapping.Table

@Table("MESSAGES")
data class Message(@Id var id: String?, val text: String)
</pre>
<p id="3f6af492">Besides adding the annotations, you also need to make the <code class="code ">id</code> mutable (<code class="code ">var</code>) for the reasons of how <code class="code ">CrudRepository</code> works when inserting the new objects to the database.</p>
</li>
<li class="list__item" id="8d308a36">
<p id="300f2c84">Declare an interface for the <code class="code ">CrudRepository</code> that will work with the <code class="code ">Message</code> data class:</p>
<pre class="code" data-language="kotlin">import org.springframework.data.repository.CrudRepository

interface MessageRepository : CrudRepository&lt;Message, String&gt;
</pre>
</li>
<li class="list__item" id="44ad0cf9">
<p id="eead71d1">Update the <code class="code ">MessageService</code> class. It will now call to the <code class="code ">MessageRepository</code> instead of executing SQL queries:</p>
<pre class="code" data-language="kotlin">@Service
class MessageService(val db: MessageRepository) {
    fun findMessages(): List&lt;Message&gt; = db.findAll().toList()

    fun findMessageById(id: String): List&lt;Message&gt; = db.findById(id).toList()

    fun save(message: Message) {
        db.save(message)
    }

    fun &lt;T : Any&gt; Optional&lt;out T&gt;.toList(): List&lt;T&gt; =
        if (isPresent) listOf(get()) else emptyList()
}
</pre>
<dl id="afde9a54" data-style="title-top">
<dt id="25d12e5b" data-expandable="true" data-expanded="false" data-anchors="[4905edc0,b24de3b2,25d12e5b]">Extension functions</dt>
<dd>
<p id="4905edc0">The return type of the <code class="code ">findById()</code> function in the <code class="code ">CrudRepository</code> interface is an instance of the <code class="code ">Optional</code> class. However, it would be convenient to return a <code class="code ">List</code> with a single message for consistency. For that, you need to unwrap the <code class="code ">Optional</code> value if it’s present, and return a list with the value. This can be implemented as an <a href="extensions.html#extension-functions" id="cf63fd77">extension function</a> to the <code class="code ">Optional</code> type.</p>
<p id="b24de3b2">In the code, <code class="code ">Optional&lt;out T&gt;.toList()</code>, <code class="code ">toList()</code> is the extension function for <code class="code ">Optional</code>. Extension functions allow you to write additional functions to any classes, which is especially useful when you want to extend functionality of some library class.</p>
</dd>
<dt id="568f3836" data-expandable="true" data-expanded="false" data-anchors="[ee206dcf,647378b0,dbd4cd94,568f3836]">CrudRepository save() function</dt>
<dd>
<p id="ee206dcf"><a href="https://docs.spring.io/spring-data/jdbc/docs/current/reference/html/#jdbc.entity-persistence" id="2c090935" data-external="true" rel="noopener noreferrer">This function works</a> with an assumption that the new object doesn’t have an id in the database. Hence, the id <b id="d739475d" class="">should be null</b> for insertion.</p>
<p id="647378b0">If the id isn’t <em id="92ca5943" class="">null</em>, <code class="code ">CrudRepository</code> assumes that the object already exists in the database and this is an <em id="51e7d56e" class="">update</em> operation as opposed to an <em id="a20ba282" class="">insert</em> operation. After the insert operation, the <code class="code ">id</code> will be generated by the data store and assigned back to the <code class="code ">Message</code> instance. This is why the <code class="code ">id</code> property should be declared using the <code class="code ">var</code> keyword.</p>

</dd>
</dl>
</li>
<li class="list__item" id="d40955a9">
<p id="4b603ed2">Update the messages table definition to generate the ids for the inserted objects. Since <code class="code ">id</code> is a string, you can use the <code class="code ">RANDOM_UUID()</code> function to generate the id value by default:</p>
<pre class="code" data-language="sql">CREATE TABLE messages (
   id                     VARCHAR(60)  DEFAULT RANDOM_UUID() PRIMARY KEY,
   text                   VARCHAR      NOT NULL
   );
</pre>
</li>
</ol></section><section class="chapter"><h2 id="run-the-application" data-toc="run-the-application">Run the application</h2>
<p id="f6087b9b">The application is ready to run again. By replacing the <code class="code ">JdbcTemplate</code> with <code class="code ">CrudRepository</code>, the functionality didn't change hence the application should work the same way as previously.</p></section><section class="chapter"><h2 id="next-step" data-toc="next-step">Next step</h2>
<p id="29005d2f">Get your personal language map to help you navigate Kotlin features and track your progress in studying the language. We will also send you language tips and useful materials on using Kotlin with Spring.</p>
<p id="ec4af8d6"><a href="https://info.jetbrains.com/kotlin-tips.html" id="be225a96" data-external="true" rel="noopener noreferrer"><figure class=" " id="85ece820"><img alt="Get the Kotlin language map" title="Get the Kotlin language map" src="data:image/png;base64,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" class=" " width="700" height="80"></figure></a></p>
<aside data-type="note" class="prompt" data-title="" id="e517afc7"><p id="251a0198">You will need to share your email address on the next page to receive the materials.</p></aside></section><div class="last-modified"> Last modified: 22 February 2023</div>

<div class="navigation-links _bottom"> <a class="navigation-links__prev" href="jvm-spring-boot-add-db-support.html">Add database support for Spring Boot project</a> <a class="navigation-links__next" href="jvm-test-using-junit.html">Test code using JUnit in JVM – tutorial</a> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2010&ndash;2023 JetBrains s.r.o. and Kotlin Programming Language contributors<br>Licensed under the Apache License, Version 2.0.<br>
    <a href="https://kotlinlang.org/docs/jvm-spring-boot-using-crudrepository.html" class="_attribution-link">https://kotlinlang.org/docs/jvm-spring-boot-using-crudrepository.html</a>
  </p>
</div>
