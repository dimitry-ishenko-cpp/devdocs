<article class="devsite-article">  <h1 class="devsite-page-title" tabindex="-1">Python Rules</h1> <div class="devsite-page-title-meta"><devsite-view-release-notes></devsite-view-release-notes></div>  <div class="devsite-article-body clearfix
  ">     <h2 id="rules" data-text="Rules" tabindex="-1">Rules</h2> <ul> <li> <a href="#py_binary"> py_binary </a> </li> <li> <a href="#py_library"> py_library </a> </li> <li> <a href="#py_test"> py_test </a> </li> <li> <a href="#py_runtime"> py_runtime </a> </li> </ul> <h2 id="py_binary" data-text="     py_binary   " tabindex="-1"> py_binary </h2>  <pre class="rule-signature" translate="no" dir="ltr">py_binary(<a href="#py_binary.name">name</a>, <a href="#py_binary.deps">deps</a>, <a href="#py_binary.srcs">srcs</a>, <a href="common-definitions.html#typical.data">data</a>, <a href="common-definitions.html#binary.args">args</a>, <a href="common-definitions.html#common.compatible_with">compatible_with</a>, <a href="common-definitions.html#common.deprecation">deprecation</a>, <a href="common-definitions.html#common.distribs">distribs</a>, <a href="common-definitions.html#binary.env">env</a>, <a href="common-definitions.html#common.exec_compatible_with">exec_compatible_with</a>, <a href="common-definitions.html#common.exec_properties">exec_properties</a>, <a href="common-definitions.html#common.features">features</a>, <a href="#py_binary.imports">imports</a>, <a href="#py_binary.legacy_create_init">legacy_create_init</a>, <a href="common-definitions.html#typical.licenses">licenses</a>, <a href="#py_binary.main">main</a>, <a href="common-definitions.html#binary.output_licenses">output_licenses</a>, <a href="#py_binary.python_version">python_version</a>, <a href="common-definitions.html#common.restricted_to">restricted_to</a>, <a href="#py_binary.srcs_version">srcs_version</a>, <a href="#py_binary.stamp">stamp</a>, <a href="common-definitions.html#common.tags">tags</a>, <a href="common-definitions.html#common.target_compatible_with">target_compatible_with</a>, <a href="common-definitions.html#common.testonly">testonly</a>, <a href="common-definitions.html#common.toolchains">toolchains</a>, <a href="common-definitions.html#common.visibility">visibility</a>)</pre> <p> A <code translate="no" dir="ltr">py_binary</code> is an executable Python program consisting of a collection of <code translate="no" dir="ltr">.py</code> source files (possibly belonging to other <code translate="no" dir="ltr">py_library</code> rules), a <code translate="no" dir="ltr">*.runfiles</code> directory tree containing all the code and data needed by the program at run-time, and a stub script that starts up the program with the correct initial environment and data. </p> <h4 id="py_binary_examples" data-text="Examples" tabindex="-1">Examples</h4> <pre class="code" translate="no" dir="ltr">
py_binary(
    name = "foo",
    srcs = ["foo.py"],
    data = [":transform"],  # a cc_binary which we invoke at run time
    deps = [
        ":foolib",  # a py_library
    ],
)
</pre> <p>If you want to run a <code translate="no" dir="ltr">py_binary</code> from within another binary or test (for example, running a python binary to set up some mock resource from within a java_test) then the correct approach is to make the other binary or test depend on the <code translate="no" dir="ltr">py_binary</code> in its data section. The other binary can then locate the <code translate="no" dir="ltr">py_binary</code> relative to the source directory. </p> <pre class="code" translate="no" dir="ltr">
py_binary(
    name = "test_main",
    srcs = ["test_main.py"],
    deps = [":testing"],
)

java_library(
    name = "testing",
    srcs = glob(["*.java"]),
    data = [":test_main"]
)
</pre> <h3 id="py_binary_args" data-text="Arguments" tabindex="-1">Arguments</h3> <table class="table table-condensed table-bordered table-params"> <colgroup> <col class="col-param"> <col class="param-description"> </colgroup> <thead> <tr> <th colspan="2">Attributes</th> </tr> </thead> <tbody> <tr> <td id="py_binary.name"><code translate="no" dir="ltr">name</code></td> <td> <p><a href="https://bazel.build/versions/7.0.0/concepts/labels#target-names">Name</a>; required</p> <p>A unique name for this target.</p> <br>If <code translate="no" dir="ltr">main</code> is unspecified, this should be the same as the name of the source file that is the main entry point of the application, minus the extension. For example, if your entry point is called <code translate="no" dir="ltr">main.py</code>, then your name should be <code translate="no" dir="ltr">main</code>. </td> </tr> <tr> <td id="py_binary.deps"> <code translate="no" dir="ltr">deps</code> </td> <td> <p>List of <a href="https://bazel.build/versions/7.0.0/concepts/labels">labels</a>; default is <code translate="no" dir="ltr">[]</code></p> The list of other libraries to be linked in to the binary target. See general comments about <code translate="no" dir="ltr">deps</code> at <a href="common-definitions.html#typical-attributes"> Typical attributes defined by most build rules</a>. These are generally <a href="python.html#py_library"><code translate="no" dir="ltr">py_library</code></a> rules. </td> </tr> <tr> <td id="py_binary.srcs"> <code translate="no" dir="ltr">srcs</code> </td> <td> <p>List of <a href="https://bazel.build/versions/7.0.0/concepts/labels">labels</a>; required</p> The list of source (<code translate="no" dir="ltr">.py</code>) files that are processed to create the target. This includes all your checked-in code and any generated source files. Library targets belong in <code translate="no" dir="ltr">deps</code> instead, while other binary files needed at runtime belong in <code translate="no" dir="ltr">data</code>. </td> </tr> <tr> <td id="py_binary.imports"> <code translate="no" dir="ltr">imports</code> </td> <td> <p>List of strings; default is <code translate="no" dir="ltr">[]</code></p> List of import directories to be added to the <code translate="no" dir="ltr">PYTHONPATH</code>. <p> Subject to <a href="make-variables.html">"Make variable"</a> substitution. These import directories will be added for this rule and all rules that depend on it (note: not the rules this rule depends on. Each directory will be added to <code translate="no" dir="ltr">PYTHONPATH</code> by <a href="python.html#py_binary"><code translate="no" dir="ltr">py_binary</code></a> rules that depend on this rule. </p> <p> Absolute paths (paths that start with <code translate="no" dir="ltr">/</code>) and paths that references a path above the execution root are not allowed and will result in an error. </p> </td> </tr> <tr> <td id="py_binary.legacy_create_init"> <code translate="no" dir="ltr">legacy_create_init</code> </td> <td> <p>Integer; default is <code translate="no" dir="ltr">-1</code></p> Whether to implicitly create empty __init__.py files in the runfiles tree. These are created in every directory containing Python source code or shared libraries, and every parent directory of those directories, excluding the repo root directory. The default, auto, means true unless <code translate="no" dir="ltr">--incompatible_default_to_explicit_init_py</code> is used. If false, the user is responsible for creating (possibly empty) __init__.py files and adding them to the <code translate="no" dir="ltr">srcs</code> of Python targets as required. </td> </tr> <tr> <td id="py_binary.main"> <code translate="no" dir="ltr">main</code> </td> <td> <p><a href="https://bazel.build/versions/7.0.0/concepts/labels">Label</a>; default is <code translate="no" dir="ltr">None</code></p> The name of the source file that is the main entry point of the application. This file must also be listed in <code translate="no" dir="ltr">srcs</code>. If left unspecified, <code translate="no" dir="ltr">name</code> is used instead (see above). If <code translate="no" dir="ltr">name</code> does not match any filename in <code translate="no" dir="ltr">srcs</code>, <code translate="no" dir="ltr">main</code> must be specified. </td> </tr> <tr> <td id="py_binary.python_version"> <code translate="no" dir="ltr">python_version</code> </td> <td> <p>String; <a href="common-definitions.html#configurable-attributes">nonconfigurable</a>; default is <code translate="no" dir="ltr">"_INTERNAL_SENTINEL"</code></p> Whether to build this target (and its transitive <code translate="no" dir="ltr">deps</code>) for Python 2 or Python 3. Valid values are <code translate="no" dir="ltr">"PY2"</code> and <code translate="no" dir="ltr">"PY3"</code> (the default). <p>The Python version is always reset (possibly by default) to whatever version is specified by this attribute, regardless of the version specified on the command line or by other higher targets that depend on this one. </p>
<p>If you want to <code translate="no" dir="ltr">select()</code> on the current Python version, you can inspect the value of <code translate="no" dir="ltr">@rules_python//python:python_version</code>. See <a href="https://github.com/bazelbuild/rules_python/blob/120590e2f2b66e5590bf4dc8ebef9c5338984775/python/BUILD#L43">here</a> for more information. </p>
<p><b>Bug warning:</b> This attribute sets the version for which Bazel builds your target, but due to <a href="https://github.com/bazelbuild/bazel/issues/4815">#4815</a>, the resulting stub script may still invoke the wrong interpreter version at runtime. See <a href="https://github.com/bazelbuild/bazel/issues/4815#issuecomment-460777113">this workaround</a>, which involves defining a <code translate="no" dir="ltr">py_runtime</code> target that points to either Python version as needed, and activating this <code translate="no" dir="ltr">py_runtime</code> by setting <code translate="no" dir="ltr">--python_top</code>. </p>
</td> </tr> <tr> <td id="py_binary.srcs_version"> <code translate="no" dir="ltr">srcs_version</code> </td> <td> <p>String; default is <code translate="no" dir="ltr">"PY2AND3"</code></p> This attribute declares the target's <code translate="no" dir="ltr">srcs</code> to be compatible with either Python 2, Python 3, or both. To actually set the Python runtime version, use the <a href="python.html#py_binary.python_version"><code translate="no" dir="ltr">python_version</code></a> attribute of an executable Python rule (<code translate="no" dir="ltr">py_binary</code> or <code translate="no" dir="ltr">py_test</code>). <p>Allowed values are: <code translate="no" dir="ltr">"PY2AND3"</code>, <code translate="no" dir="ltr">"PY2"</code>, and <code translate="no" dir="ltr">"PY3"</code>. The values <code translate="no" dir="ltr">"PY2ONLY"</code> and <code translate="no" dir="ltr">"PY3ONLY"</code> are also allowed for historic reasons, but they are essentially the same as <code translate="no" dir="ltr">"PY2"</code> and <code translate="no" dir="ltr">"PY3"</code> and should be avoided. </p>
<p>Note that only the executable rules (<code translate="no" dir="ltr">py_binary</code> and <code translate="no" dir="ltr">py_library
          </code>) actually verify the current Python version against the value of this attribute. (This is a feature; since <code translate="no" dir="ltr">py_library</code> does not change the current Python version, if it did the validation, it'd be impossible to build both <code translate="no" dir="ltr">PY2ONLY</code> and <code translate="no" dir="ltr">PY3ONLY</code> libraries in the same invocation.) Furthermore, if there is a version mismatch, the error is only reported in the execution phase. In particular, the error will not appear in a <code translate="no" dir="ltr">bazel build --nobuild</code> invocation.) </p>
<p>To get diagnostic information about which dependencies introduce version requirements, you can run the <code translate="no" dir="ltr">find_requirements</code> aspect on your target: </p>
<pre translate="no" dir="ltr">
          bazel build &lt;your target&gt; \
              --aspects=@rules_python//python:defs.bzl%find_requirements \
              --output_groups=pyversioninfo
          </pre> This will build a file with the suffix <code translate="no" dir="ltr">-pyversioninfo.txt</code> giving information about why your target requires one Python version or another. Note that it works even if the given target failed to build due to a version conflict. </td> </tr> <tr> <td id="py_binary.stamp"> <code translate="no" dir="ltr">stamp</code> </td> <td> <p>Integer; default is <code translate="no" dir="ltr">-1</code></p> Whether to encode build information into the binary. Possible values: <ul> <li> <code translate="no" dir="ltr">stamp = 1</code>: Always stamp the build information into the binary, even in <a href="https://bazel.build/versions/7.0.0/docs/user-manual#flag--stamp"><code translate="no" dir="ltr">--nostamp</code></a> builds. <b>This setting should be avoided</b>, since it potentially kills remote caching for the binary and any downstream actions that depend on it. </li> <li> <code translate="no" dir="ltr">stamp = 0</code>: Always replace build information by constant values. This gives good build result caching. </li> <li> <code translate="no" dir="ltr">stamp = -1</code>: Embedding of build information is controlled by the <a href="https://bazel.build/versions/7.0.0/docs/user-manual#flag--stamp"><code translate="no" dir="ltr">--[no]stamp</code></a> flag. </li> </ul> <p>Stamped binaries are <em>not</em> rebuilt unless their dependencies change.</p> </td> </tr> </tbody> </table> <h2 id="py_library" data-text="     py_library   " tabindex="-1"> py_library </h2>  <pre class="rule-signature" translate="no" dir="ltr">py_library(<a href="#py_library.name">name</a>, <a href="#py_library.deps">deps</a>, <a href="#py_library.srcs">srcs</a>, <a href="common-definitions.html#typical.data">data</a>, <a href="common-definitions.html#common.compatible_with">compatible_with</a>, <a href="common-definitions.html#common.deprecation">deprecation</a>, <a href="common-definitions.html#common.distribs">distribs</a>, <a href="common-definitions.html#common.exec_compatible_with">exec_compatible_with</a>, <a href="common-definitions.html#common.exec_properties">exec_properties</a>, <a href="common-definitions.html#common.features">features</a>, <a href="#py_library.imports">imports</a>, <a href="common-definitions.html#typical.licenses">licenses</a>, <a href="common-definitions.html#common.restricted_to">restricted_to</a>, <a href="#py_library.srcs_version">srcs_version</a>, <a href="common-definitions.html#common.tags">tags</a>, <a href="common-definitions.html#common.target_compatible_with">target_compatible_with</a>, <a href="common-definitions.html#common.testonly">testonly</a>, <a href="common-definitions.html#common.visibility">visibility</a>)</pre> <h3 id="py_library_args" data-text="Arguments" tabindex="-1">Arguments</h3> <table class="table table-condensed table-bordered table-params"> <colgroup> <col class="col-param"> <col class="param-description"> </colgroup> <thead> <tr> <th colspan="2">Attributes</th> </tr> </thead> <tbody> <tr> <td id="py_library.name"><code translate="no" dir="ltr">name</code></td> <td> <p><a href="https://bazel.build/versions/7.0.0/concepts/labels#target-names">Name</a>; required</p> <p>A unique name for this target.</p> </td> </tr> <tr> <td id="py_library.deps"> <code translate="no" dir="ltr">deps</code> </td> <td> <p>List of <a href="https://bazel.build/versions/7.0.0/concepts/labels">labels</a>; default is <code translate="no" dir="ltr">[]</code></p> The list of other libraries to be linked in to the binary target. See general comments about <code translate="no" dir="ltr">deps</code> at <a href="common-definitions.html#typical-attributes"> Typical attributes defined by most build rules</a>. These are generally <a href="python.html#py_library"><code translate="no" dir="ltr">py_library</code></a> rules. </td> </tr> <tr> <td id="py_library.srcs"> <code translate="no" dir="ltr">srcs</code> </td> <td> <p>List of <a href="https://bazel.build/versions/7.0.0/concepts/labels">labels</a>; default is <code translate="no" dir="ltr">[]</code></p> The list of source (<code translate="no" dir="ltr">.py</code>) files that are processed to create the target. This includes all your checked-in code and any generated source files. </td> </tr> <tr> <td id="py_library.imports"> <code translate="no" dir="ltr">imports</code> </td> <td> <p>List of strings; default is <code translate="no" dir="ltr">[]</code></p> List of import directories to be added to the <code translate="no" dir="ltr">PYTHONPATH</code>. <p> Subject to <a href="make-variables.html">"Make variable"</a> substitution. These import directories will be added for this rule and all rules that depend on it (note: not the rules this rule depends on. Each directory will be added to <code translate="no" dir="ltr">PYTHONPATH</code> by <a href="python.html#py_binary"><code translate="no" dir="ltr">py_binary</code></a> rules that depend on this rule. </p> <p> Absolute paths (paths that start with <code translate="no" dir="ltr">/</code>) and paths that references a path above the execution root are not allowed and will result in an error. </p> </td> </tr> <tr> <td id="py_library.srcs_version"> <code translate="no" dir="ltr">srcs_version</code> </td> <td> <p>String; default is <code translate="no" dir="ltr">"PY2AND3"</code></p> This attribute declares the target's <code translate="no" dir="ltr">srcs</code> to be compatible with either Python 2, Python 3, or both. To actually set the Python runtime version, use the <a href="python.html#py_binary.python_version"><code translate="no" dir="ltr">python_version</code></a> attribute of an executable Python rule (<code translate="no" dir="ltr">py_binary</code> or <code translate="no" dir="ltr">py_test</code>). <p>Allowed values are: <code translate="no" dir="ltr">"PY2AND3"</code>, <code translate="no" dir="ltr">"PY2"</code>, and <code translate="no" dir="ltr">"PY3"</code>. The values <code translate="no" dir="ltr">"PY2ONLY"</code> and <code translate="no" dir="ltr">"PY3ONLY"</code> are also allowed for historic reasons, but they are essentially the same as <code translate="no" dir="ltr">"PY2"</code> and <code translate="no" dir="ltr">"PY3"</code> and should be avoided. </p>
<p>Note that only the executable rules (<code translate="no" dir="ltr">py_binary</code> and <code translate="no" dir="ltr">py_library
          </code>) actually verify the current Python version against the value of this attribute. (This is a feature; since <code translate="no" dir="ltr">py_library</code> does not change the current Python version, if it did the validation, it'd be impossible to build both <code translate="no" dir="ltr">PY2ONLY</code> and <code translate="no" dir="ltr">PY3ONLY</code> libraries in the same invocation.) Furthermore, if there is a version mismatch, the error is only reported in the execution phase. In particular, the error will not appear in a <code translate="no" dir="ltr">bazel build --nobuild</code> invocation.) </p>
<p>To get diagnostic information about which dependencies introduce version requirements, you can run the <code translate="no" dir="ltr">find_requirements</code> aspect on your target: </p>
<pre translate="no" dir="ltr">
          bazel build &lt;your target&gt; \
              --aspects=@rules_python//python:defs.bzl%find_requirements \
              --output_groups=pyversioninfo
          </pre> This will build a file with the suffix <code translate="no" dir="ltr">-pyversioninfo.txt</code> giving information about why your target requires one Python version or another. Note that it works even if the given target failed to build due to a version conflict. </td> </tr> </tbody> </table> <h2 id="py_test" data-text="     py_test   " tabindex="-1"> py_test </h2>  <pre class="rule-signature" translate="no" dir="ltr">py_test(<a href="#py_test.name">name</a>, <a href="#py_test.deps">deps</a>, <a href="#py_test.srcs">srcs</a>, <a href="common-definitions.html#typical.data">data</a>, <a href="common-definitions.html#test.args">args</a>, <a href="common-definitions.html#common.compatible_with">compatible_with</a>, <a href="common-definitions.html#common.deprecation">deprecation</a>, <a href="common-definitions.html#common.distribs">distribs</a>, <a href="common-definitions.html#test.env">env</a>, <a href="common-definitions.html#test.env_inherit">env_inherit</a>, <a href="common-definitions.html#common.exec_compatible_with">exec_compatible_with</a>, <a href="common-definitions.html#common.exec_properties">exec_properties</a>, <a href="common-definitions.html#common.features">features</a>, <a href="common-definitions.html#test.flaky">flaky</a>, <a href="#py_test.imports">imports</a>, <a href="#py_test.legacy_create_init">legacy_create_init</a>, <a href="common-definitions.html#typical.licenses">licenses</a>, <a href="common-definitions.html#test.local">local</a>, <a href="#py_test.main">main</a>, <a href="#py_test.python_version">python_version</a>, <a href="common-definitions.html#common.restricted_to">restricted_to</a>, <a href="common-definitions.html#test.shard_count">shard_count</a>, <a href="common-definitions.html#test.size">size</a>, <a href="#py_test.srcs_version">srcs_version</a>, <a href="#py_test.stamp">stamp</a>, <a href="common-definitions.html#common.tags">tags</a>, <a href="common-definitions.html#common.target_compatible_with">target_compatible_with</a>, <a href="common-definitions.html#common.testonly">testonly</a>, <a href="common-definitions.html#test.timeout">timeout</a>, <a href="common-definitions.html#common.toolchains">toolchains</a>, <a href="common-definitions.html#common.visibility">visibility</a>)</pre> <p> A <code translate="no" dir="ltr">py_test()</code> rule compiles a test. A test is a binary wrapper around some test code.</p> <h4 id="py_test_examples" data-text="Examples" tabindex="-1">Examples</h4> 
<pre class="code" translate="no" dir="ltr">
py_test(
    name = "runtest_test",
    srcs = ["runtest_test.py"],
    deps = [
        "//path/to/a/py/library",
    ],
)
</pre> <p>It's also possible to specify a main module:</p> <pre class="code" translate="no" dir="ltr">
py_test(
    name = "runtest_test",
    srcs = [
        "runtest_main.py",
        "runtest_lib.py",
    ],
    main = "runtest_main.py",
)
</pre> <h3 id="py_test_args" data-text="Arguments" tabindex="-1">Arguments</h3> <table class="table table-condensed table-bordered table-params"> <colgroup> <col class="col-param"> <col class="param-description"> </colgroup> <thead> <tr> <th colspan="2">Attributes</th> </tr> </thead> <tbody> <tr> <td id="py_test.name"><code translate="no" dir="ltr">name</code></td> <td> <p><a href="https://bazel.build/versions/7.0.0/concepts/labels#target-names">Name</a>; required</p> <p>A unique name for this target.</p> </td> </tr> <tr> <td id="py_test.deps"> <code translate="no" dir="ltr">deps</code> </td> <td> <p>List of <a href="https://bazel.build/versions/7.0.0/concepts/labels">labels</a>; default is <code translate="no" dir="ltr">[]</code></p> The list of other libraries to be linked in to the binary target. See general comments about <code translate="no" dir="ltr">deps</code> at <a href="common-definitions.html#typical-attributes"> Typical attributes defined by most build rules</a>. These are generally <a href="python.html#py_library"><code translate="no" dir="ltr">py_library</code></a> rules. </td> </tr> <tr> <td id="py_test.srcs"> <code translate="no" dir="ltr">srcs</code> </td> <td> <p>List of <a href="https://bazel.build/versions/7.0.0/concepts/labels">labels</a>; required</p> The list of source (<code translate="no" dir="ltr">.py</code>) files that are processed to create the target. This includes all your checked-in code and any generated source files. Library targets belong in <code translate="no" dir="ltr">deps</code> instead, while other binary files needed at runtime belong in <code translate="no" dir="ltr">data</code>. </td> </tr> <tr> <td id="py_test.imports"> <code translate="no" dir="ltr">imports</code> </td> <td> <p>List of strings; default is <code translate="no" dir="ltr">[]</code></p> List of import directories to be added to the <code translate="no" dir="ltr">PYTHONPATH</code>. <p> Subject to <a href="make-variables.html">"Make variable"</a> substitution. These import directories will be added for this rule and all rules that depend on it (note: not the rules this rule depends on. Each directory will be added to <code translate="no" dir="ltr">PYTHONPATH</code> by <a href="python.html#py_binary"><code translate="no" dir="ltr">py_binary</code></a> rules that depend on this rule. </p> <p> Absolute paths (paths that start with <code translate="no" dir="ltr">/</code>) and paths that references a path above the execution root are not allowed and will result in an error. </p> </td> </tr> <tr> <td id="py_test.legacy_create_init"> <code translate="no" dir="ltr">legacy_create_init</code> </td> <td> <p>Integer; default is <code translate="no" dir="ltr">-1</code></p> Whether to implicitly create empty __init__.py files in the runfiles tree. These are created in every directory containing Python source code or shared libraries, and every parent directory of those directories, excluding the repo root directory. The default, auto, means true unless <code translate="no" dir="ltr">--incompatible_default_to_explicit_init_py</code> is used. If false, the user is responsible for creating (possibly empty) __init__.py files and adding them to the <code translate="no" dir="ltr">srcs</code> of Python targets as required. </td> </tr> <tr> <td id="py_test.main"> <code translate="no" dir="ltr">main</code> </td> <td> <p><a href="https://bazel.build/versions/7.0.0/concepts/labels">Label</a>; default is <code translate="no" dir="ltr">None</code></p> The name of the source file that is the main entry point of the application. This file must also be listed in <code translate="no" dir="ltr">srcs</code>. If left unspecified, <code translate="no" dir="ltr">name</code> is used instead (see above). If <code translate="no" dir="ltr">name</code> does not match any filename in <code translate="no" dir="ltr">srcs</code>, <code translate="no" dir="ltr">main</code> must be specified. </td> </tr> <tr> <td id="py_test.python_version"> <code translate="no" dir="ltr">python_version</code> </td> <td> <p>String; <a href="common-definitions.html#configurable-attributes">nonconfigurable</a>; default is <code translate="no" dir="ltr">"_INTERNAL_SENTINEL"</code></p> Whether to build this target (and its transitive <code translate="no" dir="ltr">deps</code>) for Python 2 or Python 3. Valid values are <code translate="no" dir="ltr">"PY2"</code> and <code translate="no" dir="ltr">"PY3"</code> (the default). <p>The Python version is always reset (possibly by default) to whatever version is specified by this attribute, regardless of the version specified on the command line or by other higher targets that depend on this one. </p>
<p>If you want to <code translate="no" dir="ltr">select()</code> on the current Python version, you can inspect the value of <code translate="no" dir="ltr">@rules_python//python:python_version</code>. See <a href="https://github.com/bazelbuild/rules_python/blob/120590e2f2b66e5590bf4dc8ebef9c5338984775/python/BUILD#L43">here</a> for more information. </p>
<p><b>Bug warning:</b> This attribute sets the version for which Bazel builds your target, but due to <a href="https://github.com/bazelbuild/bazel/issues/4815">#4815</a>, the resulting stub script may still invoke the wrong interpreter version at runtime. See <a href="https://github.com/bazelbuild/bazel/issues/4815#issuecomment-460777113">this workaround</a>, which involves defining a <code translate="no" dir="ltr">py_runtime</code> target that points to either Python version as needed, and activating this <code translate="no" dir="ltr">py_runtime</code> by setting <code translate="no" dir="ltr">--python_top</code>. </p>
</td> </tr> <tr> <td id="py_test.srcs_version"> <code translate="no" dir="ltr">srcs_version</code> </td> <td> <p>String; default is <code translate="no" dir="ltr">"PY2AND3"</code></p> This attribute declares the target's <code translate="no" dir="ltr">srcs</code> to be compatible with either Python 2, Python 3, or both. To actually set the Python runtime version, use the <a href="python.html#py_binary.python_version"><code translate="no" dir="ltr">python_version</code></a> attribute of an executable Python rule (<code translate="no" dir="ltr">py_binary</code> or <code translate="no" dir="ltr">py_test</code>). <p>Allowed values are: <code translate="no" dir="ltr">"PY2AND3"</code>, <code translate="no" dir="ltr">"PY2"</code>, and <code translate="no" dir="ltr">"PY3"</code>. The values <code translate="no" dir="ltr">"PY2ONLY"</code> and <code translate="no" dir="ltr">"PY3ONLY"</code> are also allowed for historic reasons, but they are essentially the same as <code translate="no" dir="ltr">"PY2"</code> and <code translate="no" dir="ltr">"PY3"</code> and should be avoided. </p>
<p>Note that only the executable rules (<code translate="no" dir="ltr">py_binary</code> and <code translate="no" dir="ltr">py_library
          </code>) actually verify the current Python version against the value of this attribute. (This is a feature; since <code translate="no" dir="ltr">py_library</code> does not change the current Python version, if it did the validation, it'd be impossible to build both <code translate="no" dir="ltr">PY2ONLY</code> and <code translate="no" dir="ltr">PY3ONLY</code> libraries in the same invocation.) Furthermore, if there is a version mismatch, the error is only reported in the execution phase. In particular, the error will not appear in a <code translate="no" dir="ltr">bazel build --nobuild</code> invocation.) </p>
<p>To get diagnostic information about which dependencies introduce version requirements, you can run the <code translate="no" dir="ltr">find_requirements</code> aspect on your target: </p>
<pre translate="no" dir="ltr">
          bazel build &lt;your target&gt; \
              --aspects=@rules_python//python:defs.bzl%find_requirements \
              --output_groups=pyversioninfo
          </pre> This will build a file with the suffix <code translate="no" dir="ltr">-pyversioninfo.txt</code> giving information about why your target requires one Python version or another. Note that it works even if the given target failed to build due to a version conflict. </td> </tr> <tr> <td id="py_test.stamp"> <code translate="no" dir="ltr">stamp</code> </td> <td> <p>Integer; default is <code translate="no" dir="ltr">0</code></p> See the section on <a href="python.html#py_binary_args">py_binary()</a> arguments, except that the stamp argument is set to 0 by default for tests. </td> </tr> </tbody> </table> <h2 id="py_runtime" data-text="     py_runtime   " tabindex="-1"> py_runtime </h2>  <pre class="rule-signature" translate="no" dir="ltr">py_runtime(<a href="#py_runtime.name">name</a>, <a href="#py_runtime.bootstrap_template">bootstrap_template</a>, <a href="common-definitions.html#common.compatible_with">compatible_with</a>, <a href="#py_runtime.coverage_tool">coverage_tool</a>, <a href="common-definitions.html#common.deprecation">deprecation</a>, <a href="common-definitions.html#common.distribs">distribs</a>, <a href="common-definitions.html#common.features">features</a>, <a href="#py_runtime.files">files</a>, <a href="#py_runtime.interpreter">interpreter</a>, <a href="#py_runtime.interpreter_path">interpreter_path</a>, <a href="common-definitions.html#typical.licenses">licenses</a>, <a href="#py_runtime.python_version">python_version</a>, <a href="common-definitions.html#common.restricted_to">restricted_to</a>, <a href="#py_runtime.stub_shebang">stub_shebang</a>, <a href="common-definitions.html#common.tags">tags</a>, <a href="common-definitions.html#common.target_compatible_with">target_compatible_with</a>, <a href="common-definitions.html#common.testonly">testonly</a>, <a href="common-definitions.html#common.visibility">visibility</a>)</pre> <p>Represents a Python runtime used to execute Python code. </p>
<p>A <code translate="no" dir="ltr">py_runtime</code> target can represent either a <em>platform runtime</em> or an <em>in-build runtime</em>. A platform runtime accesses a system-installed interpreter at a known path, whereas an in-build runtime points to an executable target that acts as the interpreter. In both cases, an "interpreter" means any executable binary or wrapper script that is capable of running a Python script passed on the command line, following the same conventions as the standard CPython interpreter. </p>
<p>A platform runtime is by its nature non-hermetic. It imposes a requirement on the target platform to have an interpreter located at a specific path. An in-build runtime may or may not be hermetic, depending on whether it points to a checked-in interpreter or a wrapper script that accesses the system interpreter. </p>
<h4 id="py_runtime_example" data-text="Example:" tabindex="-1">Example:</h4> <pre class="code" translate="no" dir="ltr">
py_runtime(
    name = "python-2.7.12",
    files = glob(["python-2.7.12/**"]),
    interpreter = "python-2.7.12/bin/python",
)

py_runtime(
    name = "python-3.6.0",
    interpreter_path = "/opt/pyenv/versions/3.6.0/bin/python",
)
</pre> <h3 id="py_runtime_args" data-text="Arguments" tabindex="-1">Arguments</h3> <table class="table table-condensed table-bordered table-params"> <colgroup> <col class="col-param"> <col class="param-description"> </colgroup> <thead> <tr> <th colspan="2">Attributes</th> </tr> </thead> <tbody> <tr> <td id="py_runtime.name"><code translate="no" dir="ltr">name</code></td> <td> <p><a href="https://bazel.build/versions/7.0.0/concepts/labels#target-names">Name</a>; required</p> <p>A unique name for this target.</p> </td> </tr> <tr> <td id="py_runtime.bootstrap_template"> <code translate="no" dir="ltr">bootstrap_template</code> </td> <td> <p><a href="https://bazel.build/versions/7.0.0/concepts/labels">Label</a>; default is <code translate="no" dir="ltr">"@bazel_tools//tools/python:python_bootstrap_template.txt"</code></p> Previously referred to as the "Python stub script", this is the entrypoint to every Python executable target. </td> </tr> <tr> <td id="py_runtime.coverage_tool"> <code translate="no" dir="ltr">coverage_tool</code> </td> <td> <p><a href="https://bazel.build/versions/7.0.0/concepts/labels">Label</a>; default is <code translate="no" dir="ltr">None</code></p> This is a target to use for collecting code coverage information from <code translate="no" dir="ltr">py_binary</code> and <code translate="no" dir="ltr">py_test</code> targets. <p>If set, the target must either produce a single file or be and executable target. The path to the single file, or the executable if the target is executable, determines the entry point for the python coverage tool. The target and its runfiles will be added to the runfiles when coverage is enabled.</p> <p>The entry point for the tool must be loadable by a python interpreter (e.g. a <code translate="no" dir="ltr">.py</code> or <code translate="no" dir="ltr">.pyc</code> file). It must accept the command line arguments of <a href="https://coverage.readthedocs.io/">coverage.py</a>, at least including the <code translate="no" dir="ltr">run</code> and <code translate="no" dir="ltr">lcov</code> subcommands. </p>
</td> </tr> <tr> <td id="py_runtime.files"> <code translate="no" dir="ltr">files</code> </td> <td> <p>List of <a href="https://bazel.build/versions/7.0.0/concepts/labels">labels</a>; default is <code translate="no" dir="ltr">[]</code></p> For an in-build runtime, this is the set of files comprising this runtime. These files will be added to the runfiles of Python binaries that use this runtime. For a platform runtime this attribute must not be set. </td> </tr> <tr> <td id="py_runtime.interpreter"> <code translate="no" dir="ltr">interpreter</code> </td> <td> <p><a href="https://bazel.build/versions/7.0.0/concepts/labels">Label</a>; default is <code translate="no" dir="ltr">None</code></p> For an in-build runtime, this is the target to invoke as the interpreter. For a platform runtime this attribute must not be set. </td> </tr> <tr> <td id="py_runtime.interpreter_path"> <code translate="no" dir="ltr">interpreter_path</code> </td> <td> <p>String; default is <code translate="no" dir="ltr">""</code></p> For a platform runtime, this is the absolute path of a Python interpreter on the target platform. For an in-build runtime this attribute must not be set. </td> </tr> <tr> <td id="py_runtime.python_version"> <code translate="no" dir="ltr">python_version</code> </td> <td> <p>String; default is <code translate="no" dir="ltr">"_INTERNAL_SENTINEL"</code></p> Whether this runtime is for Python major version 2 or 3. Valid values are <code translate="no" dir="ltr">"PY2"</code> and <code translate="no" dir="ltr">"PY3"</code>. <p>The default value is controlled by the <code translate="no" dir="ltr">--incompatible_py3_is_default</code> flag. However, in the future this attribute will be mandatory and have no default value. </p>
</td> </tr> <tr> <td id="py_runtime.stub_shebang"> <code translate="no" dir="ltr">stub_shebang</code> </td> <td> <p>String; default is <code translate="no" dir="ltr">"#!/usr/bin/env python3"</code></p> "Shebang" expression prepended to the bootstrapping Python script used when executing <code translate="no" dir="ltr">py_binary</code> targets. <p>See <a href="https://github.com/bazelbuild/bazel/issues/8685">issue 8685</a> for motivation. </p>
<p>Does not apply to Windows. </p>
</td> </tr> </tbody> </table>  </div>  </article> <devsite-content-footer class="nocontent"> <p>Except as otherwise noted, the content of this page is licensed under the <a href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 License</a>, and code samples are licensed under the <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 License</a>. For details, see the <a href="https://developers.google.com/site-policies">Google Developers Site Policies</a>. Java is a registered trademark of Oracle and/or its affiliates.</p> <p>Last updated 2023-12-11 UTC.</p> </devsite-content-footer> <devsite-notification> </devsite-notification> <div class="devsite-content-data"> <template class="devsite-thumb-rating-down-categories"> [{ "type": "thumb-down", "id": "missingTheInformationINeed", "label":"Missing the information I need" },{ "type": "thumb-down", "id": "tooComplicatedTooManySteps", "label":"Too complicated / too many steps" },{ "type": "thumb-down", "id": "outOfDate", "label":"Out of date" },{ "type": "thumb-down", "id": "samplesCodeIssue", "label":"Samples / code issue" },{ "type": "thumb-down", "id": "otherDown", "label":"Other" }] </template> <template class="devsite-thumb-rating-up-categories"> [{ "type": "thumb-up", "id": "easyToUnderstand", "label":"Easy to understand" },{ "type": "thumb-up", "id": "solvedMyProblem", "label":"Solved my problem" },{ "type": "thumb-up", "id": "otherUp", "label":"Other" }] </template> </div><div class="_attribution">
  <p class="_attribution-p">
    Licensed under the Creative Commons Attribution 4.0 License, and code samples are licensed under the Apache 2.0 License.<br>
    <a href="https://bazel.build/versions/7.0.0/reference/be/python" class="_attribution-link">https://bazel.build/versions/7.0.0/reference/be/python</a>
  </p>
</div>
