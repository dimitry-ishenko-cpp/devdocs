<div class="sphx-glr-download-link-note admonition note"> <p class="admonition-title">Note</p> <p>Click <a class="reference internal" href="#sphx-glr-download-auto-examples-neighbors-plot-caching-nearest-neighbors-py"><span class="std std-ref">here</span></a> to download the full example code or to run this example in your browser via Binder</p> </div> <section class="sphx-glr-example-title" id="caching-nearest-neighbors"> <h1 id="sphx-glr-auto-examples-neighbors-plot-caching-nearest-neighbors-py">Caching nearest neighbors</h1> <p>This examples demonstrates how to precompute the k nearest neighbors before using them in KNeighborsClassifier. KNeighborsClassifier can compute the nearest neighbors internally, but precomputing them can have several benefits, such as finer parameter control, caching for multiple use, or custom implementations.</p> <p>Here we use the caching property of pipelines to cache the nearest neighbors graph between multiple fits of KNeighborsClassifier. The first call is slow since it computes the neighbors graph, while subsequent call are faster as they do not need to recompute the graph. Here the durations are small since the dataset is small, but the gain can be more substantial when the dataset grows larger, or when the grid of parameter to search is large.</p> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAyAAAAGQCAMAAABh+/QGAAAACXBIWXMAAA9hAAAPYQGoP6dpAAAAOXRFWHRTb2Z0d2FyZQBNYXRwbG90bGliIHZlcnNpb24zLjUuMiwgaHR0cHM6Ly9tYXRwbG90bGliLm9yZy8qNh9FAAABR1BMVEX///8fHx8LCwv+/v71+fv/AAAGBgbx8fEfd7QAAAAmJibg4OCurq5eXl6goKB/f394eHgXFxc/Pz+np6cDAwOGhoYPDw8xMTFvb2/c3Nz7+/vX19fj4+PAwMD5+fnq6upNTU0qKio9PT1ubm7+/P1HR0ecnJzn5+ePj482Njazs7NYWFgbGxuUlJTMzMzCwsL/9fVnZ2dqamr/DQ3IyMiXl5f/3d05OTnt7e3GxsaLi4tiYmLU1NT/0tJSUlK4uLj/Ghp0dHS8vLz/Jyf19fbKysr/x8fPz8//e3v/XV3/R0f/bGxcnMhtps7/5+f/MzP/sbFLksP/nZ0rfrihxuD/vLzS0tL/p6ckerb/7u49ib7/PDz/iIj/UVH/kpLr8/jj7vbS5PB7r9O20+Y1hLuNutna6fLA2eqUvtvI3uyuzuT5+/2EtNbnhNAjAAAgAElEQVR42uydDXPiNhrHZaWIyhiMsbF5BycBwttSKJS3nF1TuPTambbTmWbm5m77/T/GSbJNTAJpZzfsEfP8ZzYhQYjs89dP0iMZGSEQCAQCgUAgEAgEAoFAIBAIBAKBQCAQCAQCgUAgEAgEAoFAIBAIBAKBQIf1mJYItpZzhHK510tWaZV9HciEztPS4SJdVXyT0hDXT1KGCnkpmkFooc4/LbCqffui3hRC+h1/mKLLv//3SI198w++m3UbZ0tahj2ounnJ+WtAkoskQg90NVyUig+Hi4yp+PZQhLb+iYBkFkyp2qKO0JK36k8IbAUrz39VX9QQakifAYgw/3CzMFsxdmRhNGv8e63714AI6XTyyrOBj2+nzdWFAbJ9+uEAIH9LXv9wl/5ZgLxmuhxjkxpGZfdYAKJ2TGy1+P94nTNJ39kgNLUwlrP+KJvjM4A0ElOs24FFzA4jS29qRM6ykmkxQUj5M4FUj/12eSssWUp4tth1Z2Mba7mh4FKViZlbROqiajiVyFB3pdFNMS3jfuOR/3buSURrlq/kpt9zjWMLCJ9iqSKY/sQmGtgq1T0NN9rJkWmmebd+xWPn7MaWmumxrx0eI5tXp9BHMcUS1tEXbqDKqE80p402nmWaMzH47NyQGq5F5FY4xUrjYhP3Pd6lVhxs9rZ8JogmdB1bPkq4g/YBSbfW6zxmrTRFmkpVT8/ZmHHjrqc3fozuVTYJKPqApOmq6+bZxDZ/161OJfbqokPZBKEmfKz3tak7pmPuttRUFNsMx+jyWK92VwYLeClneG43q0fqigLSH7lKqeopVcXBZUaEjVVXKazRHeWtYUDvYwjIpMQkAKncUGURTGyiga1SKe1Oca7puUuD2YJGxHN1WWsHdQypy75mcQ21Kc6zDl7zc5D7mcbqeOFGRdPu1vqqjJLpzNr1jEzUWalvZ1yHs+EDQuzlWuUWbWRz4BYkAUgJe7EFpE17zwDh/UdJNa9YxxPkGWMzmqf5fRwHZEizT6+9KlVZRxXOBLiPWTEXG9Mys8QuIbSlepTMUs7hlbVCU8O6ooDsMtJSTS6wwS3sqZK4wLvHHIohIEIlkaQfmGL5gPB5T4FyNhzmzULMmSq7VrqkHJU1HSIdj1mM5F6QpIdTrH03VqQctWVlRd2QCHvdxhyFgIhXNWXeO3EKRwIQNOtcECBsYsUtaqMi6WSKvmk9pX4AkCwN+6xiT+Ov0fd87NhIDL9TZgmPd43mwzeaWoQVZ2HukWC2/FRXFJCu8Cxv89JsxjCTwwpuzA1rAUosk/QtE3odkCmPoT9O0CT7V+ejzq6VFmiJJ29ERelGl2wqvBPaA2TfDa25Sy9nmAWaRN2QZgKA5g6QDX9TVqSH/RYhAHH6lzPFmhg5fbHN8ngOG5hKfGWwNTNox30ByMoIcrNkX2pVtwoPVsRHWXTwFWZEkBb6TV90caPuZNtkVTTD1eJdXXuAiPn4jZF1J1srF9YoiDSmzJVSfJP01wFRdiVVWkcrf9ShYSxHxHdzhvqDpOG2aOUZIPtuGKvggUIdZbFd0agbfpLOG0aQg4h1XVYkJzqrsg9Iz7ycJL1ARB/hW1Oa9PyReON22Fh7bATpikxy/QyQ6Aiyb4klGvpMOjiCEDG64ydATDHR6ueiIwhqWBUjjwAQDkiWDvmos31EYSy5hShvTNj0dub1ZPQqILsRxJE4Fj26N4IcA2RvBGnKl7PM67HcDm2k0Jok9cLupfsyB1FDQPiSiMOD5fnm+DnIh10O8gwQbsmjIe3lIOGTYoVqTSOAjMRb5CI5CEIuzZF63AEZ0KfsIBLY54AM95I7/oxAZUubfb6Lp41DQBztECC7HMThzbyNadSNo4Ds5SCyE+OVd7FRuF7KwUbhmjqubsksnlMns3YdFofVjV7VLbP+HBA2Ix113fwAzU1L6fZkHqwMVSfb3SpWy73xV7H2LVGpup5qssRXsYjndlX9qS6UZ08OZPMJkDS5Wy81PoIkbZx3u56gxKax3KzfA6RKR4ttMnxiF9jngKAR9rprfTwNl6VEjoJuTbrihYPSKV54Otm+cEOsYimjMmrR8TojyzTi7HFANrI5DVex5nQQY0DQg7jURK0HSXpLJlK+xeK5cCRi5tjAkslppN97fJGDoNs7m5gzVmIxw9rqgQerttIi+yDmbh9kz5Ka1yeWIqrY7PZBwrrYkzj3EMlB5isNXw/F3zYvSERrlH2TJrEHBGX7RniBRySwLwBBrQ7GcvpDWMm1P2ly+MhSw8Y8BGTumP4+yJ4bqLLi/rJ68hKxW7z1P7lxFBC+D4IdV6yjtEgbgc5MVgdicExKJK88rfJ8AQBd9yDm56XkIhvHNd630tXsC1xiMBisXY/wmUKVwJV3Z6YqNVWIwnE95k9/fW3LxkRW+QKPokPEQSAQCAQCgUAgEAih20oS9Jmq3IIZ8TMjUIWCPlsVMCN+ZgRKUui1PrfPokkwI35m7DxJwjzzXEIIZpxfCMETAATMAE8AEDADPAFAQAAIAAICQAAQEAACnoAZAMhlejKQiDUMHlctIvHPr7auTTPHP8KY72D/I43iqMMOmAGAXJonOmmVC9g/s6KIC+UWURDqDR7KK7OCUDNz/9CQ+CGrzXa7PQczAJBL86TDD1HhJxEzefycj9HMf6KEM/6Duvh0dgPMAEAu0JOawT/Le3Mtfrjmp3sqRs0vSrp+kSI/VidtavKqDmYAIBfmSUWc8ZX3T0KT+dl0i+AUtbEsTqZCVw1Oj9597Fp2LaDqFBcSgRlvW+FXX3/9FcT4BIAMfUCWZnBy4VgKrzltk+DkCP9GBZGavkkkvoHgAiAXNMVamsGdbcb9pzM85PyREQQAAUBim6TzI3PsIEm3wyR9afo3nLmK8jEnmSM1ASAASFw9CZd5s+nIMu+SKO12O8nvlVJlDzYo6S1S1Vk/CYBcICCXhNqRjUK+jsvPOg03CiWRZKgI+R98y6BNUyNSuoKOA/JvaPAnACS6izuQicyHcP/Wcs0gFdQAkPPstJ4D8gc0+Lc3I7qLO8V6UcddNtNlY/o9v3OcarNHdQDkfQDyOzT4tzcjuos74zfmKAS7uHd4w2/1AFOs9wPIj9Dg39yMvSVGi58+myX+VpTNyVGxJvWKAMj7AORf0ODf3Iy9Taqs9uFqq/mbVBNxMwxXeVzntOACuRdL7wDIeQHyH2jwpwVkszKMvifuj4JGdlhkoy39By82b2MNyMn+pNMB8j00+NNOsdiPldIU87PmNubdrkxzdB4jyJel6B0CAhshp0jSI7u4Qv69ezJk98GDWl89jxwEAHm9pm8T/4AW/+ZmRHdxy5nipGemnjBBXrU4aeAUAPIeAPk18Ru0+Lc3I7KLW7aw6d+vsizuuItQTyN95x4BIO8BkI+J/0KL/7+ZAYCcPSA/Jn6GFg+AACDHavo98RO0eAAEADlW0x+JH6DFAyBfqlm/P0B+SSRuockDIADIkZpuE4nvoMkDIADIsZp+gAveAZD3B8jzik4HyMfEn9Dk3x0gX7bQRQPyM6zzAiAAyPGa/kx8hCYPgAAgx2r6DdZ5ARAA5HhN3yW+vYI2D4CcESCf8iedDpBSIvELtHkABAA5VtP3iX9CmwdAAJBjNf2PvTP9ThvJorhwARaOl1ESk3Ym8ZIxh/ZyJrGduOPYTtppdzuZgGdocwhhFjazGPj/P4+qJMQmlYQljArd96HtUJU6fXj1S72qku79B4RNAAgAsR7pG4RNAAgAsR7pPxA2ASCzCAjXo9BoJStK9PEZb6TvkX9izgOQmQOE71FotK7OLeb2lHnOSOeRI8x5ADJzgPA9CrutRFmVpPX4O85IELAGIDMICN+j0Ghdi12pv2wu8bL7K4RNAMjMAcL3KDRaT2LU+uAgoVNl6lH478h3THoAMvOA9HsU9gFCPzzVARmRuWTxFcImACQwJZbmUWhRYpmvIF9wzgtAZnCTzvUo7LYSqpHM36RLf0LAGoDMHiB8j8LeMW/c7phX+gMC1gBk9gDhexR2W9lF4ascd6RrCFgDkBkExLPsEghYAxAAwhkJAtaeA8J1uR1oBSD+BwTCJl4Dwne57W8FIAKUWBCw9hoQvsttfysAEWAF+R8ErL0FhO9yO2TQBkB8DwgErD0GhO9yO9B6T49CAPKQgBxDwHqCgIy43A4Ccj+XWx8CMt3/pYkCAgHrSZZYIy63g60zs4LMMCAQsPZ8k851uR1pnQcg/gYEwiYeA8J3uZ3NY95ZBgTCJh4Dwne5NZ4DAiBiAEIgYO01IC4GBCD+W0H+BWETAAJArEc6h4A1AAEg1iNB2ASAABDeSBCwBiAAhDMShE0ACADhjPQV57wABIBYjwQBawACQDgjfYewCQABINYjQdgEgAAQzkg/IGwCQAAIZyQImwAQAMIZCcImAASAcEb6LwSsAQgAsR4JwiYAZNYAMfMoPPsYitG3OnUN0kNJWqI/d2yz+yeETYQCpCjL2ToBIJycmHoU/n7xRGGAbCSTyc8x+spOQv3tvW12IWwiEiCkdSurcZNq3oUBiEVOrDwKQz93e/y0oP4Ts7TpKLvXEDYRB5C7DMUjlaf/zWc61SIAGcOj0ABkPU59p5biysLpRvcjUwMdGttHEDYRBJBSWl07mmqndjmbZiuJXEib1luBBsTSo9AA5MlTak/4ZDe3+2xLk/WzsGBjAWETMQAJ19SFo1JknQiRSKlVYeuJWb0FQMw8Cg1AEkZxlaTbE/4KAgFrIQBhm49UeahTuFFL3Wj1VqVVAiDOSqxHTxeNzgwgfna/4ZzX/4CU1cWiUCVmnQbqrXIbgFh4FPYAWVGed7u+jy7bZhfCJr4HpMg2H2FOJ1pv5bV6q9YI45h31KNw/epKubhao7vuEGNn/uLk0ctf9udts4tzXp8D0m6qVVS6ZDuHwndNrd6SMxVcFA57FD5iu3D6yacY0yq7TCjR0NIL2+ySYwib+BkQUi2oM/7OyRxS00jq2XSBQVIpBRcQb7P7PBK5xtT3KyD1lCzftojTOcQ6FqsViki6DEA8yS6ETXwLSFGd6fla+D4TLUVvFBsEgLjPLgSsfQpIO9u/+Rh3opXT6q4902oDEJfZJRCw9hIQM5db6f2hEl3Y1e9rFYeANAY3H+NPtFJHBayQDQMQd9mFsImHgJi63K7vJF4/en2lArKVTCY3HAHCNh9Z4m6iFZu3snxTKwIQNysIBKw9BMTU5fZdqPvEzzOHJVa4k5fznbD7iRbOqutQ3vRIC4A4zO555AhT3yNAzF1uE3sHytbqcxWQOSW0t2YLCMnS50rqEvFiopFqxvxIC4A4XEEgYO0dIOYutwvR078/iau4fFrMfX6s6C/pWHoU0ofaCw3vJhq5Mz3SAiBOs/srhE0mAojhcruwr64eH/TN+aXyQa+3zF1u2UPt2ba3E61ucqQFQJxmFwLWkymxDJfbV9oTDvpGJHHAWUH0h9q9n2ijR1oAxGl2v0LYxLtNupnL7V9C25L0s76CrO+vWO9B9M3HRCba8JEWAHGa3S845/UMEFOX2xdzh3/dVVYl6eLl2ttNnstt96H2yUy0wSMtAOI0uxCw9g4Qc5fbk51oiJ5i7SnR/Y9nVgMWew+1T2qi9R9pARCH2SUQsPYQEBcDqqkvTXyi9Y60AIjT7F5DwNovgDzIRNOPtIoAxGF2CQSsAwWIfqR1C0CcZhcC1gEDRD/Skm/T2TIBILYjQdgkcIDQIy1Z7r3FDkB4I0HAOoCA0E5d1SB5UDUIgAzGNgSsAwqI2omUu2+xm9VbAIQFhE2CC4i2aa8OqAYBkKE4hoB1sAFhfzSrtwCIVmNFIGAdeEBo9OqtglZvARAtIGANQIzor7eqAIQFhE0AyGCbUW/JDQBCBawhbAJALOqtTls0QLgehYayDFlRoo/PnGUXAtYAxKqPummviwUI36PQUJZZnVvM7SnzjrILYRMAYtWndSvnm0QkQPgehV1lGUJf0FmPv3OU3XMIWAMQqz7FlCynSuIAYmOg01WWWYtdqX/aXNL/krXDFI03ELAGIJZ9SPZGvmkRUQCx8SjsKsucxKj1wUFC+0scj0IWELAGIJw+pYwsp4vCAjLsUciUZTRqThOOVhAImwAQbh/SzMu3DTEAsbeBZsoygyWWXXa/4pwXgHD7UJfESliMTbqNR6GmLEOoPpnTTToErAGIXZ9wR5YLdyIAwvcoNJRlVuPOj3khbAJA7Pvc3cpyre1/QPgehYayDL0ofJVzmF0ImwAQ+z7htOmtYQAeNZF+QNgEgDjoU72R81kSQEAkCJsAECd9zG4NAwEIhE0EAcRRTA4Qs1vDQAACAWsA4rBPffjWMBCAQNgEgDjt0x66NQwEIBA2ASDO+5QL/beGgQAEwiYeAcK1gR5oFRgQqV2R5UI5SIBcQ9jEE0D4NtD9rUIDIkmNWzmv3xoGApDtIwibeAEI3wa6v1VwQKSicWsYCEAgbOIJIHwb6EEHQ0uXWzEAkaSWfmtoOxAplqtNr8xPpgUIBKy9AIRvAz3QauVyKw4gUkm7NbTsFK43srV0qpDX9FHkVLYoLiDfcM7rNSAjNtCDgAi/gtBbw7x80xru1C7dtZqVVEbXDWK6v5k0+5lPtcKCAgJhE89LrBEb6KFWsfcgWrBbQ60TLaSynXTmtsfFTSZVabbuSm02Ur1JDRLz6WpbQEAIznm92aRzbaBHWoUHRGpTY3e5VukVUioDhVS6lm3UR2Ww6zWqtHWTbrSFW0GOIWziBSB8G+gZOubt/dNaLvQVUp1stVwknJFIucO8rSp3RCxAnkPYxAtA+DbQ3dZZAoTZV6dpIcXqLDXsRiJ3Fbo9KXTuZUcyLUCk3yBs4gUgLgYUFRBNG4iQMUZqN9KMkVpdHEAgYA1AJjfQaKdwlbpRy5lmSRBAIGANQB4SELXUCrdSjBHjesTXgEDYBIA8LCBs/5JNsStE7XrE14BAwBqAPDwgapSyme4Vop8BIeeRIxAAQB4eEMoIu0K8SVf9vIK8iUR+AAEAMg1A1H+ftStEWa4SvwICAWsAMj1AJJsrRD8AAgFrADJNQCRC1E4WV4hjAcK1YFvdmVPY9e0SfZh6Z4zsQtgEgEwVENapaH6FOA4gfAu2xPLZ1WboUgUkkUwm34+R3S845wUgUwckbH6FOA4gfAs2Ghsx+jTQ5pjZhYA1APEFIPSX4SvEMQBx4A+yFsupgMSVhdONMbILAWsA4hdApN4V4jAjbi3Y6GZnk9LzZDe3+2xLVwuwc5iicQ0BawDiH0AYI5nRtxA9sGA7DL3Qf0vS7QkNO49CxhUErAGIrwAh3SvEfLoa9q7EOtxfMzozgByuIBCwBiD+AkSLobcQ3VqwkX4+3keXx8guhE0AiA8BGbpCdGvBdhh/mUwmL6X5i5NHL3/Zn3eeXQIBawDiS0Ak9hYiY6RTdmvBxn7GlqXLhBINLb0YJ7sQsAYgfgVEom8ham/qTu1REwhYAxA/A0IZqbJr9s6UADmGgDUA8TUgtEtLlhtTAmQ7AgFrAOJzQKb4NC8ErGcGEM8oAiADAWETAAJAOAFhEwACQDgBAWsAAkA4AWETAAJAOHEOAWsAAkCs4w0ErF0DYuZyu8yebrjUH6pWAIiogEDYxPVXaOpyuxxPqqF+srKl/twAIMICAmETt1+hqcvtclxvXXmGEktoQL7inNfdV2jucrv8NLS/eUUBmVNCe923ESboUQhAJgQIBKxdfoXmLrcny1evP86pYHxazH1+rOhSMxN0uQUgEwIEwiZeAmK43NLYfvY3rcul8gEriKiAQNjEyxLLcLllcZrQP0wcYA8iKiA/IGzidpNu5nJLg+yc6tDsrwAQUQGRIGzi8is0dbld+bR2dfr0rSRdvFx7u/kALrcAZFKAQNjE7Vdo5nL7UyiqJOjmZE+J7n88kwCIsIBAwNr1V3j/AQGI/wGBsAkAASCcgLAJAAEg1kH+gLAJAAEg1nENYRMAAkA4S8gRhE0ACACxDgibABDhAeF6FBqtZEWJPj4bN7sQsAYgogPC9yg0WlfnFnN7yvyY2f2Gc14AIjggfI/CbitRViVpPf5uzOxC2ASACA4I30DHaF2L0Td0NpfGzC4ErAMDiFcQ+Q0Qvkeh0XoSo9YHB/oz1o4cpujG5RjCJgBk1gB5bQ4I/bD7EoITj0IW2xA2ASABLLGcriAS+Q3CJtMCxIch5iad61HYbSX0zc7xN+kQsAYgogPC9yjsHfPG73PMSyBgDUAEB4TvUdhtZReFr3JjJwPCJgBEdEAmmgwIWAMQAMKJ88gRQAAgAMRqD/ImEvkBEgAIALEKCFgDED9TNHVAIGANQAAIJyBsAkAACCe+4JwXgAAQ64CANQABIJyAgDUAASCcuIaANQD5f3tnwpS210fhBIYwQRAjiKK4UKEo8loqdasV61LXGXU6o45T2+//Md7cBBAQbjXJ35LkOdOpaEhG7snDXbieH4AMV5QAawABEIkIsHbThNIqtz1HAcSngBBs4qIJ5VVuu48CiF8BIcDaRRPKq9x2HwUQv85BCLB23oTyKre9Bdpe/VeeADJaPQjBJs6bUF7ltufo63MCAGS0ANkiwNobQF5Uue0FhB7Ep4CUYgRYezLEelHltu8ocxB/AkKAtZtJurTK7YujAOJHQAg2cd6E8iq3LPMGAhCCTVw0obTKbSdRA0D8DAgB1q6b8J9dEEDewQyCTQAEQCTaJ8AaQABkuOoEWAMIgEhEsAmAjCxFDmsUKsmiVhQfQ6nWBoYNRUmJr6uOzCDYBEB8DMjAGoW72am5KbHUvlipVI50sdBYNh/tODLjgnVeAPEvIANrFK6JSjnl1qe2Mwlzkp1acmwGAdYA4l9ABhfQqYniICuq/YycqDuVyhmJvcX2SW/aGEewCYD4F5DBNQq1jDX4ssdgWVGeMFO9r04XF+yT3ra1mmATAAkSIJ/6ACl3BlcVMT15ew/ySLAJgAR3iDWWTXaebAH0djMINgEQH0/SB9Uo7Jqkp43Z9lN3tHFHZhBsAiD+BWRgjcLOMq9SUi124oe7Y/PbtbgjMwiwBhD/AjKwRqGSTGgJa2h1oIsd1spJ2dDUVMGZGQSbAIiPAfnvzSDYBEAARKJTgk0ABECGKnpNsAmAAIiEkAbBJgACIMNFsAmAAIhEBFgDCIBIdMU6L4AAyHARbAIgACIRAdYAAiASbcUarPMCCIAMUbREsAmAAIhErPMCCIBIRIA1gACIRARYO2zCQVVuTWX0JaX1l88GgAQAEIJNnDXhwCq3ijJW+2ABUqxUKosAEgBACLB21oQDq9wqs9sfrRSm9DRDrIAAsh9rwMPbm3BwlVsl3bRjytIRQ13Lt58blBqFoQSkHos9AsSbm3BwldtPtUUbkIPk/dGk0Yq7DEyV21ACQoC1e0DaVW7j6kFX0OWJ8TWMPYhnFI0KIARYux5itavcnunZbFbXs62xVflzGOcggQOEYBNnk/QBVW5P7k0tTd7bKZcLtTSABACQc9Z5nTThwCq3QtYQ63A+/2UpcFVuwwkIAdbOmnBQldsOIGuGVmt+UwAkAIAQYO26Cf/FBQHkncyIEmANIAAiI4QAawDxKSDSGoWd/XDRtKFNuhjvEmANIP4ERF6jsLMfbiqSvF8z4o7NINgEQPwA0VtrFLb3w0WNKVGMbdOxGQRYA4gvAflLAZ32fri8fmb+ZCnVOunt2xoIsAYQXwLylxqF7f1wu7ooffC5bJ/kYGMcwSYAEhBA+msUWvvhBDWKsld23INsEWANIAEcYlkqf+4bYjkwoxQjwBpAfDlJ/0uNQns/XFTsqnYzSSfYBED8CYi8RmFnP9xUzt0yL8EmAOJPQOQ1Cjv74cQHhR/uXZhBsAmA+BOQdzKDAGsAARCJCDYBEACRaD/WiOIHgADIENUJsAYQAJGIYBMAARCJCDYBEACR6IJ1XgABkOEiwBpAAEQigk0ABEAk2ifYBEAAZLgINgEQAJGJYBMAARCJCDYBEACRiABrAAEQiQg2ARAAkYhgk7c3obTKbc9RAPE9IHex2N3p6f7+1tbW9fXjY71ecrK9N1oq1R2e6j9A5FVuu48CiP8B2YoNUKPR+G7q+Pj45ubm169LW79Mmd/fHFsST/jeEOo5U5xlnnN5+fvi4urq/Pz86c+fnw8Pt3cCQxPCR6G6rdlSafSYclvltvsogPgfkHosdty61WP/Vo2OYrGby4urp5+3p1v16MgBIq9y21egDUD8DkiPSrP1+uP1tTnc2t/fPz09vbu7u729fXj4aepByPzO7AtEb3AqxmXWyEyMza6tbuHRPHNfnCVO+fPnyew/rq4uLn6bnY/odwSFb8fmuxewREvPL6z9uh7E6zJ/y1jvjn+XVW57jlLEM2CASO+xnm+ifQ+iXT/remp0wGSl1BpgWYMt8661tNWRwO709ufT1cXlzfc+oF7CUhJUipte3PHm/f701AXl8bF5yiu6xgfngLyoctsLSLjKQIcbEK95i3YB1MVbL1LR+paA5XwQLE46JHtyZc2tfom51W9Tsd5sMJdVbnuP0oMAyLvQZE+XhsDSsFcGrPv94kqsDHQvDLTW5169xua2yu2Lo8xBRui2Do0ZJiz2oli9JBkJ/jdNKK9yyzIvgIxWx/L+Zkir3LaPAgiAYAae/CtPpDUKp1YjhvW2lRJrJKuYASBh80Reo7A8/u1sST0xASlXKpUdzACQsHkir1EotKjPtwe9mAEgIfPkFQV08vq9CUjOSOwttk9izR1AQuLJX2oUmoouCXoy1fvqdHHBPolPbQEkvID01yjcUAut51bE9IQeBEAYYnUNsTZq+c6TLYAwA0BCNUmX1iiMdvOxo41jBoCEzBN5jcKN3HylUjlR4oe7Y/PbtThmAEjYPJHWKLRm4/q4clI2NDVVwIwRB6QQR65U8HCrCWaMjBmdFRfkWgXMCP0awl4AAANFSURBVJ4ZLZUKDiAteIZ7YcQu5OhKhRJmBM+MURjmeXal8G6oxQw8wRPMwBM8wYygALKQXhi1K43gr4QZ4TMDIYQQQgghhN5dncgBTy6mz3hxmcJaLjK97v46sxOqpqZLmIEZztWJHPBAP9RpLzzZUVNfxo7yHtwiuepYMrKCGZjhTlbkgHvFE0eTXngy8cGj17W0Z/7XTGEGZriTFTngXqkZxRNPijNNY/qjF4MMdU45MzKYgRmuZEcOuFameOKNJ5o2cbbZ/Zd5jl/YhJ7VpzADM9zpOXLA1WTOOFM88kTU0Fre9uAuqWXux3PjmIEZriyp5b24TLJVk2HW9ZVUMVrdrLn/lWr/U56rp2AGZjjq+TyyRImLmgyrKQ8G0GtikDHjwZtWbtNnnmDGCL5ltSIHvJEnvfqP7FQ+E/FgOpeqVceSxiFmYIZztSMHRsgTpVrUEl4snMRnVE2dWMAMzEAIIYQQQgghhBBCCCGEEEIIoRFUz8e6eqtO2by+Q8tgBjK1E8cTzECvk9wT9utgRgB77eXDnJF+bvWPzUiiaj74Vo4YqUW7V6+UNTWjrjwfnder09qq2JSdLGrqV/OrOpXKpRY2DE2dok0xI0ie5NL5cf2g40ktk1+O7CgVY2LurDxpe1Ke/rI+KYIt2kfn9eLB/ZK6oKxn03PjkXHTk9zXfP5r7dPYpwxtihlB8kT8Yc3qRMcT8/3rxLQoLWrBFvQ54cmc/kNkEqw8H53XzZbfiWTskrGigKzaNB8sT0ZpUMwImCeiVLIV7WJ7It5zcuNKWYuYMpvf9CSZFbFhuZXno/P6mPlgOi3+mT27NqtYnfl6LrF8QJNiRqA8ESuHS6memZ/wpJkXOunzJDnUEytZLJ7ZyzVpU8wIvicTidnO8Tl9vd2rdzx50au3o/cOWHTEjBB4UjCaX/IHe7PteeGZPS/seFI86psXCk9WMnNze0aJRsWMwHui5Ju5SGIm+ryyaGx2e1ItaqtnStfKovDk43QkN3lGm2JGCFXQj2gEzECDdFTN726rfDaLGaFVJmKpOPjoQTFiNMdoJcwIreLWOmKedscMhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYRQsPR/+AycWUBeZxIAAAAASUVORK5CYII=" srcset="../../_images/sphx_glr_plot_caching_nearest_neighbors_001.png" alt="Classification accuracy, Fit time (with caching)" class="sphx-glr-single-img"><pre data-language="python"># Author: Tom Dupre la Tour
#
# License: BSD 3 clause
from tempfile import TemporaryDirectory
import matplotlib.pyplot as plt

from sklearn.neighbors import KNeighborsTransformer, KNeighborsClassifier
from sklearn.model_selection import GridSearchCV
from sklearn.datasets import load_digits
from sklearn.pipeline import Pipeline

X, y = load_digits(return_X_y=True)
n_neighbors_list = [1, 2, 3, 4, 5, 6, 7, 8, 9]

# The transformer computes the nearest neighbors graph using the maximum number
# of neighbors necessary in the grid search. The classifier model filters the
# nearest neighbors graph as required by its own n_neighbors parameter.
graph_model = KNeighborsTransformer(n_neighbors=max(n_neighbors_list), mode="distance")
classifier_model = KNeighborsClassifier(metric="precomputed")

# Note that we give `memory` a directory to cache the graph computation
# that will be used several times when tuning the hyperparameters of the
# classifier.
with TemporaryDirectory(prefix="sklearn_graph_cache_") as tmpdir:
    full_model = Pipeline(
        steps=[("graph", graph_model), ("classifier", classifier_model)], memory=tmpdir
    )

    param_grid = {"classifier__n_neighbors": n_neighbors_list}
    grid_model = GridSearchCV(full_model, param_grid)
    grid_model.fit(X, y)

# Plot the results of the grid search.
fig, axes = plt.subplots(1, 2, figsize=(8, 4))
axes[0].errorbar(
    x=n_neighbors_list,
    y=grid_model.cv_results_["mean_test_score"],
    yerr=grid_model.cv_results_["std_test_score"],
)
axes[0].set(xlabel="n_neighbors", title="Classification accuracy")
axes[1].errorbar(
    x=n_neighbors_list,
    y=grid_model.cv_results_["mean_fit_time"],
    yerr=grid_model.cv_results_["std_fit_time"],
    color="r",
)
axes[1].set(xlabel="n_neighbors", title="Fit time (with caching)")
fig.tight_layout()
plt.show()
</pre> <p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes 0.877 seconds)</p> <div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-examples-neighbors-plot-caching-nearest-neighbors-py"> <div class="binder-badge docutils container"> <a class="reference external image-reference" href="https://mybinder.org/v2/gh/scikit-learn/scikit-learn/1.1.X?urlpath=lab/tree/notebooks/auto_examples/neighbors/plot_caching_nearest_neighbors.ipynb"><img alt="Launch binder" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMTA5IiBoZWlnaHQ9IjIwIj48bGluZWFyR3JhZGllbnQgaWQ9ImIiIHgyPSIwIiB5Mj0iMTAwJSI+PHN0b3Agb2Zmc2V0PSIwIiBzdG9wLWNvbG9yPSIjYmJiIiBzdG9wLW9wYWNpdHk9Ii4xIi8+PHN0b3Agb2Zmc2V0PSIxIiBzdG9wLW9wYWNpdHk9Ii4xIi8+PC9saW5lYXJHcmFkaWVudD48Y2xpcFBhdGggaWQ9ImEiPjxyZWN0IHdpZHRoPSIxMDkiIGhlaWdodD0iMjAiIHJ4PSIzIiBmaWxsPSIjZmZmIi8+PC9jbGlwUGF0aD48ZyBjbGlwLXBhdGg9InVybCgjYSkiPjxwYXRoIGZpbGw9IiM1NTUiIGQ9Ik0wIDBoNjR2MjBIMHoiLz48cGF0aCBmaWxsPSIjNTc5YWNhIiBkPSJNNjQgMGg0NXYyMEg2NHoiLz48cGF0aCBmaWxsPSJ1cmwoI2IpIiBkPSJNMCAwaDEwOXYyMEgweiIvPjwvZz48ZyBmaWxsPSIjZmZmIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LWZhbWlseT0iRGVqYVZ1IFNhbnMsVmVyZGFuYSxHZW5ldmEsc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMTAiPjxpbWFnZSB4PSI1IiB5PSIzIiB3aWR0aD0iMTQiIGhlaWdodD0iMTQiIHhsaW5rOmhyZWY9ImRhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBRmtBQUFCWkNBTUFBQUJpMVhpZEFBQUI4bEJNVkVYLy8vOVhtc3JtWllIMW9sSlhtc3Ixb2xKWG1zcm1aWUgxb2xKWG1zcjFvbEpYbXNybVpZSDFvbEwxb2xKWG1zcjFvbEpYbXNybVpZSDFvbEwxb2xKWG1zcm1aWUgxb2xKWG1zcjFvbEwxb2xKWG1zcm1aWUgxb2xMMW9sSlhtc3JtWllIMW9sTDFvbEwwbkZmMW9sSlhtc3JtWllIMW9sSlhtc3E4ZFpiMW9sSlhtc3JtWllIMW9sSlhtc3BYbXNwWG1zcjFvbEwxb2xKWG1zcm1aWUgxb2xKWG1zcjFvbEwxb2xKWG1zcm1aWUgxb2xMMW9sTGVhSVZYbXNybVpZSDFvbEwxb2xMMW9sSlhtc3JtWllIMW9sTG5hMzFYbXNyMW9sSlhtc3Ixb2xKWG1zcm1aWUgxb2xMcW9WcjFvbEpYbXNyMW9sSlhtc3JtWllIMW9sTDFvbEtrZmFQb2JYdnZpR2FiZ2FkWG1zcVRoS3VvZktIbVo0RG9ibnIxb2xKWG1zcjFvbEpYbXNwWG1zcjFvbEpYbXNyZlo0VHVoV24xb2xMMW9sSlhtc3FCaTdYMW9sSlhtc3BabXNsYm1NaGJtc2RlbXNWZmw4Wmdtc05pbThKcGs4RjBtN1I0bTdGNW5MQjZqYmg3amJpRGlyT0VpYk9HbkthTWhxK1BuYUNWZzZxV2c2cWVnS2FmZjZXaG5wS29mS0d0bm9teGVaeTNub0c2ZFppK24zdkNjcFBEY3BQR24zYkxiNC9NYjQ3VWJJclZhNHJZb0dqZGFJYmVhSVhob1dIbVpZSG9iWHZwY0hqcWRIWHJlSExyb1Zyc2ZHL3VoR251aDJid2oySHhrMTd5bDF2em1sanptMWowbmxYMW9sTDNBSlhXQUFBQWJYUlNUbE1BRUJBUUh4OGdJQ0F1TGpBd01EdzlQVUJBUUVwUVVGQlhWMWhnWUdCa2NIQndjWGw4Z0lDQWdvaUlrSkNRbEppY25KMmdvS0NtcUsrd3NMQzR1c0RBd01qUDBORFExTmJXM056ZzRPRGk1KzN2OFBEdzgvVDA5UFgyOXZiMzkvZjUrZnI3Ky96OC9QejkvdjcremN6Q3hnQUFCQzVKUkVGVWVBSE4xdWwzazBVVUJ2Q2IxQ1RWcG1wYWl0QUdTTFNwU3VLQ0xXcGJUS05KRkdsY1NNQUZGNjNpVW1SY2NORzZnTGJ1eGtYVTY2SkFVZWYvOUxTcG1YbnlMcjNUNUFPL3J6bDV6ajEzN3AxMzZCSVN5NDRmS0pYdUdOL2QxOVBVZlllTzY3Wm5xdGYyS0gzM0lkMXBzWG9GZFczMHNQWjFzTXZzMkQwNjBBSHF3czRGSGVKb2pMWnFudzUzY21mdmcrWFI4bUMwT0VqdXhyWEVrWDV5ZGVWSkxWSWxWMGUxMFBYazVrN2RZZUh1N0NqMWorNDl1S2c3dUxVNjF0R0x3MWxxMjd1Z1FZbGNsSEM0Ymd2N1ZRK1RBeWo1WmMvVWpzUHZzMXNkNWNXcnlXT2J0dldUMkVQYTRydG5XVzNKa3BqZ2dFcGJPc1ByN0Y3RXlOZXd0cEJJc2xBN3A0M0hDc253b29YVEVjM1VtUG1DTm41bHJxVEp4eTZuUm1jYXZHWlZ0LzNEYTJwRDVOSHZzT0hKQ3JkYzFHMnIzRElUcFU3eWljN3cvN1J4bmpjMGt0NUdDNGRqaXYyU3ozRmIyaUVaZzQxL2Rkc0ZEb3l1WXJJa21GZWh6MEhSMnRoUGdRcU15UVliMk90QjBXeHNaM0JlRzMrd3BSYjF2emwyVVlCb2c4RmZHaHR0RktqdEFjbG5aWXJSbzlyeUc5dUcvRlpRVTRBRWc4WkU5TGpHTXpUbXFLWFBMbmxXVm5JbFFRVHZ4SmY4aXA3VmdqWmp5VlByancxdGU1b3RNN1JtUDd4bStzSzJHdjlJOEdpKytCUmJFa1I5RUJ3OHpSVWNLeHdwNzN4a2FMaXFRYitrR2R1SlROSEc3MnpjVzlMb0pncVF4cFAzL1RqLy9jM3lCMHRxemFtbDA1LytvckhMa3NWTys5NWtYNy83cWdKdm5qbHJmcjJHZ3N5eDBlb3k5dVB6TjVTUGQ4NmFYZ2dPc0VLVzJQcno3ZHUzVklEMy90enMvc1NSczJ3N292VkhLdGpyWDJwZDdaTWxUeEFZZkJBTDlqaUR3ZkxrcTU1VG03aWZoTWxUR1B5Q0FzN1JGUmhuNDdKbmxjQjlSTTVUOTdBU3VaWEljVk51VURJbmRwRGJkc2ZycXNPcHBlWGw1WStYVktkakZDVGgrekdhVnVqMGQ5enkwNVBQSzNRekJhbXhkd3RUQ3J6eWcvMlJ2ZjJFc3RVam9yZEd3YS9reDltU0pMcjhtTEx0Q1c4SEhHSmMyUjVoUzIxOUlpRjZQblR1c09xY01sNTdnbTBaOGthbktNQVFnMHFTeXVaZm43ekl0c2JHeU85UWxueFkwZUN1RDFYTDJ5cy9Nc3JRaGx0RTdVZzB1Rk96dWZKRkUyUHhCby9ZQXg4WFBQZER3V04wTXJEUllJWkYwbVNNS0NOSGdhSVZGb0JiTm9MSjd0RVFES3hHRjBrY0xRaW1vakNab3B2ME9rTk95V0NDZzlYTVZBaTdBUkp6UWRNMlFVaDBnbUJvempjM1NrZzZkU0JScURHWVNVT3U2NlpnK0kyZk5acy9NMy9mL0dybC9YbnlGMUd3M1ZLQ2V6MFBONUlVZkZMcXZnVU40QzBxTnFZczVZaFBMK2FWWllERTRJcFVrNTdvU0ZuSm00RnlDcXFPRTBqaFkyU015TEZvbzU2enlvNmJlY09TNVVWRGRqN1ZpaDB6cCt0Y01od1JwQmVMeXF0SWpsSktBSVpTYkk4U0dTRjNrMHBBM21SNXRIdXdQRm9hN043cmVvcTJicUNzQWsxSHFDdTV1dkkxbjZKdVJYSStTMU1jbzU0WW1ZVHdjbjZBZWljK2tzc1hpOFhwWEM0VjN0Ny9BRHVUTkthUUpkU2NBQUFBQUVsRlRrU3VRbUNDIi8+IDx0ZXh0IHg9IjQxNSIgeT0iMTUwIiBmaWxsPSIjMDEwMTAxIiBmaWxsLW9wYWNpdHk9Ii4zIiB0cmFuc2Zvcm09InNjYWxlKC4xKSIgdGV4dExlbmd0aD0iMzcwIj5sYXVuY2g8L3RleHQ+PHRleHQgeD0iNDE1IiB5PSIxNDAiIHRyYW5zZm9ybT0ic2NhbGUoLjEpIiB0ZXh0TGVuZ3RoPSIzNzAiPmxhdW5jaDwvdGV4dD48dGV4dCB4PSI4NTUiIHk9IjE1MCIgZmlsbD0iIzAxMDEwMSIgZmlsbC1vcGFjaXR5PSIuMyIgdHJhbnNmb3JtPSJzY2FsZSguMSkiIHRleHRMZW5ndGg9IjM1MCI+YmluZGVyPC90ZXh0Pjx0ZXh0IHg9Ijg1NSIgeT0iMTQwIiB0cmFuc2Zvcm09InNjYWxlKC4xKSIgdGV4dExlbmd0aD0iMzUwIj5iaW5kZXI8L3RleHQ+PC9nPiA8L3N2Zz4=" width="150px"></a> </div> <div class="sphx-glr-download sphx-glr-download-python docutils container"> <p><a class="reference download internal" download="" href="https://scikit-learn.org/1.1/_downloads/7880ee063d9d3845a0ed85afa9948265/plot_caching_nearest_neighbors.py"><code>Download Python source code: plot_caching_nearest_neighbors.py</code></a></p> </div> <div class="sphx-glr-download sphx-glr-download-jupyter docutils container"> <p><a class="reference download internal" download="" href="https://scikit-learn.org/1.1/_downloads/2eaa49c025f80c826512eda4a8add5c3/plot_caching_nearest_neighbors.ipynb"><code>Download Jupyter notebook: plot_caching_nearest_neighbors.ipynb</code></a></p> </div> </div>  </section><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2007&ndash;2022 The scikit-learn developers<br>Licensed under the 3-clause BSD License.<br>
    <a href="https://scikit-learn.org/1.1/auto_examples/neighbors/plot_caching_nearest_neighbors.html" class="_attribution-link">https://scikit-learn.org/1.1/auto_examples/neighbors/plot_caching_nearest_neighbors.html</a>
  </p>
</div>
