<h1>Application Profiler</h1> <p>This module provides a middleware that profiles each request with the <a class="reference external" href="https://docs.python.org/3/library/profile.html#module-cProfile" title="(in Python v3.11)"><code>cProfile</code></a> module. This can help identify bottlenecks in your code that may be slowing down your application.</p> <dl class="py class"> <dt class="sig sig-object py" id="werkzeug.middleware.profiler.ProfilerMiddleware">
<code>class werkzeug.middleware.profiler.ProfilerMiddleware(app, stream=&lt;_io.TextIOWrapper name='&lt;stdout&gt;' mode='w' encoding='utf-8'&gt;, sort_by=('time', 'calls'), restrictions=(), profile_dir=None, filename_format='{method}.{path}.{elapsed:.0f}ms.{time:.0f}.prof')</code> </dt> <dd>
<p>Wrap a WSGI application and profile the execution of each request. Responses are buffered so that timings are more exact.</p> <p>If <code>stream</code> is given, <a class="reference external" href="https://docs.python.org/3/library/profile.html#pstats.Stats" title="(in Python v3.11)"><code>pstats.Stats</code></a> are written to it after each request. If <code>profile_dir</code> is given, <a class="reference external" href="https://docs.python.org/3/library/profile.html#module-cProfile" title="(in Python v3.11)"><code>cProfile</code></a> data files are saved to that directory, one file per request.</p> <p>The filename can be customized by passing <code>filename_format</code>. If it is a string, it will be formatted using <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str.format" title="(in Python v3.11)"><code>str.format()</code></a> with the following fields available:</p> <ul class="simple"> <li>
<code>{method}</code> - The request method; GET, POST, etc.</li> <li>
<code>{path}</code> - The request path or ‘root’ should one not exist.</li> <li>
<code>{elapsed}</code> - The elapsed time of the request in milliseconds.</li> <li>
<code>{time}</code> - The time of the request.</li> </ul> <p>If it is a callable, it will be called with the WSGI <code>environ</code> and be expected to return a filename string. The <code>environ</code> dictionary will also have the <code>"werkzeug.profiler"</code> key populated with a dictionary containing the following fields (more may be added in the future): - <code>{elapsed}</code> - The elapsed time of the request in milliseconds. - <code>{time}</code> - The time of the request.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters<span class="colon">:</span>
</dt> <dd class="field-odd">
<ul class="simple"> <li>
<strong>app</strong> (<em>WSGIApplication</em>) – The WSGI application to wrap.</li> <li>
<strong>stream</strong> (<em>t.IO</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)">str</a><em>] </em><em>| </em><em>None</em>) – Write stats to this stream. Disable with <code>None</code>.</li> <li>
<strong>sort_by</strong> (<em>t.Iterable</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)">str</a><em>]</em>) – A tuple of columns to sort stats by. See <a class="reference external" href="https://docs.python.org/3/library/profile.html#pstats.Stats.sort_stats" title="(in Python v3.11)"><code>pstats.Stats.sort_stats()</code></a>.</li> <li>
<strong>restrictions</strong> (<em>t.Iterable</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)">str</a><em> | </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.11)">int</a><em> | </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.11)">float</a><em>]</em>) – A tuple of restrictions to filter stats by. See <a class="reference external" href="https://docs.python.org/3/library/profile.html#pstats.Stats.print_stats" title="(in Python v3.11)"><code>pstats.Stats.print_stats()</code></a>.</li> <li>
<strong>profile_dir</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)">str</a><em> | </em><em>None</em>) – Save profile data files to this directory.</li> <li>
<strong>filename_format</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)">str</a>) – Format string for profile data file names, or a callable returning a name. See explanation above.</li> </ul> </dd> </dl> <pre data-language="python">from werkzeug.middleware.profiler import ProfilerMiddleware
app = ProfilerMiddleware(app)
</pre> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 3.0: </span>Added the <code>"werkzeug.profiler"</code> key to the <code>filename_format(environ)</code> parameter with the <code>elapsed</code> and <code>time</code> fields.</p> </div> <details class="changelog"> <summary>Changelog</summary><div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 0.15: </span>Stats are written even if <code>profile_dir</code> is given, and can be disable by passing <code>stream=None</code>.</p> </div> <div class="versionadded"> <p><span class="versionmodified added">New in version 0.15: </span>Added <code>filename_format</code>.</p> </div> <div class="versionadded"> <p><span class="versionmodified added">New in version 0.9: </span>Added <code>restrictions</code> and <code>profile_dir</code>.</p> </div> </details>
</dd>
</dl><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2007 Pallets<br>Licensed under the BSD 3-clause License.<br>
    <a href="https://werkzeug.palletsprojects.com/en/3.0.x/middleware/profiler/" class="_attribution-link">https://werkzeug.palletsprojects.com/en/3.0.x/middleware/profiler/</a>
  </p>
</div>
