  <h1 class="subsection">POSIX Jobserver Interaction</h1>  <p>On POSIX systems the jobserver is implemented in one of two ways: on systems that support it, GNU <code>make</code> will create a named pipe and use that for the jobserver. In this case the auth option will have the form <code>--jobserver-auth=fifo:PATH</code> where ‘<samp>PATH</samp>’ is the pathname of the named pipe. To access the jobserver you should open the named pipe path and read/write to it as described below. </p>  <p>If the system doesn’t support named pipes, or if the user provided the <code>--jobserver-style</code> option and specified ‘<samp>pipe</samp>’, then the jobserver will be implemented as a simple UNIX pipe. In this case the auth option will have the form <code>--jobserver-auth=R,W</code> where ‘<samp>R</samp>’ and ‘<samp>W</samp>’ are non-negative integers representing file descriptors: ‘<samp>R</samp>’ is the read file descriptor and ‘<samp>W</samp>’ is the write file descriptor. If either or both of these file descriptors are negative, it means the jobserver is disabled for this process. </p> <p>When using a simple pipe, only command lines that <code>make</code> understands to be recursive invocations of <code>make</code> (see <a href="make-variable.html">How the <code>MAKE</code> Variable Works</a>) will have access to the jobserver. When writing makefiles you must be sure to mark the command as recursive (most commonly by prefixing the command line with the <code>+</code> indicator (see <a href="recursion.html">Recursive Use of <code>make</code></a>). Note that the read side of the jobserver pipe is set to “blocking” mode. This should not be changed. </p> <p>In both implementations of the jobserver, the pipe will be pre-loaded with one single-character token for each available job. To obtain an extra slot you must read a single character from the jobserver; to release a slot you must write a single character back into the jobserver. </p> <p>It’s important that when you release the job slot, you write back the same character you read. Don’t assume that all tokens are the same character; different characters may have different meanings to GNU <code>make</code>. The order is not important, since <code>make</code> has no idea in what order jobs will complete anyway. </p> <p>There are various error conditions you must consider to ensure your implementation is robust: </p> <ul> <li> If you have a command-line argument controlling the parallel operation of your tool, consider whether your tool should detect situations where both the jobserver and the command-line argument are specified, and how it should react. </li>
<li> If your tool does not recognize the format of the <code>--jobserver-auth</code> string, it should assume the jobserver is using a different style and it cannot connect. </li>
<li> If your tool determines that the <code>--jobserver-auth</code> option references a simple pipe but that the file descriptors specified are closed, this means that the calling <code>make</code> process did not think that your tool was a recursive <code>make</code> invocation (e.g., the command line was not prefixed with a <code>+</code> character). You should notify your users of this situation. </li>
<li> Your tool should be sure to write back the tokens it read, even under error conditions. This includes not only errors in your tool but also outside influences such as interrupts (<code>SIGINT</code>), etc. You may want to install signal handlers to manage this write-back. </li>
<li> Your tool may also examine the first word of the <code>MAKEFLAGS</code> variable and look for the character <code>n</code>. If this character is present then <code>make</code> was invoked with the ‘<samp>-n</samp>’ option and your tool may want to stop without performing any operations. </li>
</ul><div class="_attribution">
  <p class="_attribution-p">
    Copyright © 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022 Free Software Foundation, Inc. <br>Licensed under the GNU Free Documentation License.<br>
    <a href="https://www.gnu.org/software/make/manual/html_node/POSIX-Jobserver.html" class="_attribution-link">https://www.gnu.org/software/make/manual/html_node/POSIX-Jobserver.html</a>
  </p>
</div>
