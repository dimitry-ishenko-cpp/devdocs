<h1 class="section" id="Stack-scrubbing-internal-interfaces">6.53 Stack scrubbing internal interfaces</h1> <div class="section-level-extent" id="Stack-Scrubbing">    <p>Stack scrubbing involves cooperation between a <code class="code">strub</code> context, i.e., a function whose stack frame is to be zeroed-out, and its callers. The caller initializes a stack watermark, the <code class="code">strub</code> context updates the watermark according to its stack use, and the caller zeroes it out once it regains control, whether by the calleeâ€™s returning or by an exception. </p> <p>Each of these steps is performed by a different builtin function call. Calls to these builtins are introduced automatically, in response to <code class="code">strub</code> attributes and command-line options; they are not expected to be explicitly called by source code. </p> <p>The functions that implement the builtins are available in libgcc but, depending on optimization levels, they are expanded internally, adjusted to account for inlining, and sometimes combined/deferred (e.g. passing the caller-supplied watermark on to callees, refraining from erasing stack areas that the caller will) to enable tail calls and to optimize for code size. </p> <dl class="first-deftypefn"> <dt class="deftypefn" id="index-_005f_005fbuiltin_005f_005f_005fstrub_005fenter">
<span class="category-def">Built-in Function: </span><span><code class="def-type">void</code> <strong class="def-name">__builtin___strub_enter</strong> <code class="def-code-arguments">(void **<var class="var">wmptr</var>)</code></span>
</dt> <dd><p>This function initializes a stack <var class="var">watermark</var> variable with the current top of the stack. A call to this builtin function is introduced before entering a <code class="code">strub</code> context. It remains as a function call if optimization is not enabled. </p></dd>
</dl> <dl class="first-deftypefn"> <dt class="deftypefn" id="index-_005f_005fbuiltin_005f_005f_005fstrub_005fupdate">
<span class="category-def">Built-in Function: </span><span><code class="def-type">void</code> <strong class="def-name">__builtin___strub_update</strong> <code class="def-code-arguments">(void **<var class="var">wmptr</var>)</code></span>
</dt> <dd><p>This function updates a stack <var class="var">watermark</var> variable with the current top of the stack, if it tops the previous watermark. A call to this builtin function is inserted within <code class="code">strub</code> contexts, whenever additional stack space may have been used. It remains as a function call at optimization levels lower than 2. </p></dd>
</dl> <dl class="first-deftypefn"> <dt class="deftypefn" id="index-_005f_005fbuiltin_005f_005f_005fstrub_005fleave">
<span class="category-def">Built-in Function: </span><span><code class="def-type">void</code> <strong class="def-name">__builtin___strub_leave</strong> <code class="def-code-arguments">(void **<var class="var">wmptr</var>)</code></span>
</dt> <dd><p>This function overwrites the memory area between the current top of the stack, and the <var class="var">watermark</var>ed address. A call to this builtin function is inserted after leaving a <code class="code">strub</code> context. It remains as a function call at optimization levels lower than 3, and it is guarded by a condition at level 2. </p></dd>
</dl> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; Free Software Foundation<br>Licensed under the GNU Free Documentation License, Version 1.3.<br>
    <a href="https://gcc.gnu.org/onlinedocs/gcc-14.2.0/gcc/Stack-Scrubbing.html" class="_attribution-link">https://gcc.gnu.org/onlinedocs/gcc-14.2.0/gcc/Stack-Scrubbing.html</a>
  </p>
</div>
