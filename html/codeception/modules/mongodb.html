<h1 id="mongodb">MongoDb</h1> <h2 id="installation">Installation</h2> <p>If you use Codeception installed using composer, install this module with the following command:</p> <pre data-language="yaml">composer require --dev codeception/module-mongodb</pre> <p>Alternatively, you can enable <code class="language-plaintext highlighter-rouge">MongoDb</code> module in suite configuration file and run</p> <pre data-language="yaml">codecept init upgrade4</pre> <p>This module was bundled with Codeception 2 and 3, but since version 4 it is necessary to install it separately. <br> Some modules are bundled with PHAR files.<br> Warning. Using PHAR file and composer in the same project can cause unexpected errors.</p> <h2 id="description">Description</h2> <p>Works with MongoDb database.</p> <p>The most important function of this module is cleaning database before each test. To have your database properly cleaned you should configure it to access the database.</p> <p>In order to have your database populated with data you need a valid js file with data (of the same style which can be fed up to mongo binary) File can be generated by RockMongo export command You can also use directory, generated by</p> <pre data-language="yaml">mongodump</pre> <p>tool or it’s</p> <pre data-language="yaml">.tar.gz</pre> <p>archive (not available for Windows systems), generated by</p> <pre data-language="yaml">tar -czf &lt;archive_file_name&gt;.tar.gz &lt;path_to dump directory&gt;</pre> <p>. Just put it in</p> <pre data-language="yaml">tests/_data </pre> <p>dir (by default) and specify path to it in config. Next time after database is cleared all your data will be restored from dump. The DB preparation should as following:</p> <ul> <li>clean database</li> <li>system collection system.users should contain the user which will be authenticated while script performs DB operations</li> </ul> <p>Connection is done by MongoDb driver, which is stored in Codeception\Lib\Driver namespace. Check out the driver if you get problems loading dumps and cleaning databases.</p> <p>HINT: This module can be used with <a href="https://github.com/mongofill/mongofill">Mongofill</a> library which is Mongo client written in PHP without extension.</p> <h2 id="status">Status</h2> <ul> <li>Maintainer: <strong>judgedim</strong>, <strong>davert</strong>
</li> <li>Stability: <strong>beta</strong>
</li> <li>Contact: davert@codeception.com</li> </ul> <p><em>Please review the code of non-stable modules and provide patches if you have issues.</em></p> <h2 id="config">Config</h2> <ul> <li>dsn <em>required</em> - MongoDb DSN with the db name specified at the end of the host after slash</li> <li>user <em>required</em> - user to access database</li> <li>password <em>required</em> - password</li> <li>dump_type <em>required</em> - type of dump. One of ‘js’ (MongoDb::DUMP_TYPE_JS), ‘mongodump’ (MongoDb::DUMP_TYPE_MONGODUMP) or ‘mongodump-tar-gz’ (MongoDb::DUMP_TYPE_MONGODUMP_TAR_GZ). default: MongoDb::DUMP_TYPE_JS).</li> <li>dump - path to database dump</li> <li>populate: true - should the dump be loaded before test suite is started.</li> <li>cleanup: true - should the dump be reloaded after each test. Boolean or ‘dirty’. If cleanup is set to ‘dirty’, the dump is only reloaded if any data has been written to the db during a test. This is checked using the <a href="https://docs.mongodb.com/manual/reference/command/dbHash/">dbHash</a> command.</li> </ul> <h2 id="actions">Actions</h2> <h3 id="dontseeincollection">dontSeeInCollection</h3> <p>Checks if collection doesn’t contain an item.</p> <pre data-language="php">&lt;?php
$I-&gt;dontSeeInCollection('users', array('name' =&gt; 'miles'));</pre> <ul> <li>
<code class="language-plaintext highlighter-rouge">param</code> $collection</li> <li>
<code class="language-plaintext highlighter-rouge">param array</code> $criteria</li> </ul> <h3 id="grabcollectioncount">grabCollectionCount</h3> <p>Grabs the documents count from a collection</p> <pre data-language="php">&lt;?php
$count = $I-&gt;grabCollectionCount('users');
// or
$count = $I-&gt;grabCollectionCount('users', array('isAdmin' =&gt; true));</pre> <ul> <li>
<code class="language-plaintext highlighter-rouge">param</code> $collection</li> <li>
<code class="language-plaintext highlighter-rouge">param array</code> $criteria</li> <li><code class="language-plaintext highlighter-rouge">return integer</code></li> </ul> <h3 id="grabfromcollection">grabFromCollection</h3> <p>Grabs a data from collection</p> <pre data-language="php">&lt;?php
$user = $I-&gt;grabFromCollection('users', array('name' =&gt; 'miles'));</pre> <ul> <li>
<code class="language-plaintext highlighter-rouge">param</code> $collection</li> <li>
<code class="language-plaintext highlighter-rouge">param array</code> $criteria</li> <li><code class="language-plaintext highlighter-rouge">return array</code></li> </ul> <h3 id="haveincollection">haveInCollection</h3> <p>Inserts data into collection</p> <pre data-language="php">&lt;?php
$I-&gt;haveInCollection('users', array('name' =&gt; 'John', 'email' =&gt; 'john@coltrane.com'));
$user_id = $I-&gt;haveInCollection('users', array('email' =&gt; 'john@coltrane.com'));</pre> <ul> <li>
<code class="language-plaintext highlighter-rouge">param</code> $collection</li> <li>
<code class="language-plaintext highlighter-rouge">param array</code> $data</li> </ul> <h3 id="seeelementisarray">seeElementIsArray</h3> <p>Asserts that an element in a collection exists and is an Array</p> <pre data-language="php">&lt;?php
$I-&gt;seeElementIsArray('users', array('name' =&gt; 'John Doe') , 'data.skills');</pre> <ul> <li>
<code class="language-plaintext highlighter-rouge">param String</code> $collection</li> <li>
<code class="language-plaintext highlighter-rouge">param Array</code> $criteria</li> <li>
<code class="language-plaintext highlighter-rouge">param String</code> $elementToCheck</li> </ul> <h3 id="seeelementisobject">seeElementIsObject</h3> <p>Asserts that an element in a collection exists and is an Object</p> <pre data-language="php">&lt;?php
$I-&gt;seeElementIsObject('users', array('name' =&gt; 'John Doe') , 'data');</pre> <ul> <li>
<code class="language-plaintext highlighter-rouge">param String</code> $collection</li> <li>
<code class="language-plaintext highlighter-rouge">param Array</code> $criteria</li> <li>
<code class="language-plaintext highlighter-rouge">param String</code> $elementToCheck</li> </ul> <h3 id="seeincollection">seeInCollection</h3> <p>Checks if collection contains an item.</p> <pre data-language="php">&lt;?php
$I-&gt;seeInCollection('users', array('name' =&gt; 'miles'));</pre> <ul> <li>
<code class="language-plaintext highlighter-rouge">param</code> $collection</li> <li>
<code class="language-plaintext highlighter-rouge">param array</code> $criteria</li> </ul> <h3 id="seenumelementsincollection">seeNumElementsInCollection</h3> <p>Count number of records in a collection</p> <pre data-language="php">&lt;?php
$I-&gt;seeNumElementsInCollection('users', 2);
$I-&gt;seeNumElementsInCollection('users', 1, array('name' =&gt; 'miles'));</pre> <ul> <li>
<code class="language-plaintext highlighter-rouge">param</code> $collection</li> <li>
<code class="language-plaintext highlighter-rouge">param integer</code> $expected</li> <li>
<code class="language-plaintext highlighter-rouge">param array</code> $criteria</li> </ul> <h3 id="usedatabase">useDatabase</h3> <p>Specify the database to use</p> <pre data-language="php">&lt;?php
$I-&gt;useDatabase('db_1');</pre> <ul> <li>
<code class="language-plaintext highlighter-rouge">param</code> $dbName</li> </ul> <div class="_attribution">
  <p class="_attribution-p">
    &copy; 2011 Michael Bodnarchuk and contributors<br>Licensed under the MIT License.<br>
    <a href="https://codeception.com/docs/modules/MongoDb" class="_attribution-link">https://codeception.com/docs/modules/MongoDb</a>
  </p>
</div>
