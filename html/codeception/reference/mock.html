<h1 id="mocks">Mocks</h1> <p>Declare mocks inside <code class="language-plaintext highlighter-rouge">Codeception\Test\Unit</code> class. If you want to use mocks outside it, check the reference for <a href="https://github.com/Codeception/Stub">Codeception/Stub</a> library.</p> <h3 id="public-makeclass-params--null">
<em>public</em> make($class, $params = null)</h3> <p>Instantiates a class without executing a constructor. Properties and methods can be set as a second parameter. Even protected and private properties can be set.</p> <pre data-language="php">&lt;?php
$this-&gt;make('User');
$this-&gt;make('User', ['name' =&gt; 'davert']);
?&gt;</pre> <p>Accepts either name of class or object of that class</p> <pre data-language="php">&lt;?php
$this-&gt;make(new User, ['name' =&gt; 'davert']);
?&gt;</pre> <p>To replace method provide it’s name as a key in second parameter and it’s return value or callback function as parameter</p> <pre data-language="php">&lt;?php
$this-&gt;make('User', ['save' =&gt; function () { return true; }]);
$this-&gt;make('User', ['save' =&gt; true]);</pre> <p>@template RealInstanceType of object</p> <ul> <li>
<code class="language-plaintext highlighter-rouge">param class-string&lt;RealInstanceType&gt;|RealInstanceType|callable(): class-string&lt;RealInstanceType&gt;</code> $class - A class to be mocked</li> <li>
<code class="language-plaintext highlighter-rouge">param array</code> $params - properties and methods to set</li> </ul> <p>@return \PHPUnit\Framework\MockObject\MockObject&amp;RealInstanceType - mock @throws \RuntimeException when class does not exist @throws \Exception</p> <h3 id="public-makeemptyclass-params--null">
<em>public</em> makeEmpty($class, $params = null)</h3> <p>Instantiates class having all methods replaced with dummies. Constructor is not triggered. Properties and methods can be set as a second parameter. Even protected and private properties can be set.</p> <pre data-language="php">&lt;?php
$this-&gt;makeEmpty('User');
$this-&gt;makeEmpty('User', ['name' =&gt; 'davert']);</pre> <p>Accepts either name of class or object of that class</p> <pre data-language="php">&lt;?php
$this-&gt;makeEmpty(new User, ['name' =&gt; 'davert']);</pre> <p>To replace method provide it’s name as a key in second parameter and it’s return value or callback function as parameter</p> <pre data-language="php">&lt;?php
$this-&gt;makeEmpty('User', ['save' =&gt; function () { return true; }]);
$this-&gt;makeEmpty('User', ['save' =&gt; true));</pre> <p>@template RealInstanceType of object</p> <ul> <li>
<code class="language-plaintext highlighter-rouge">param class-string&lt;RealInstanceType&gt;|RealInstanceType|callable(): class-string&lt;RealInstanceType&gt;</code> $class - A class to be mocked</li> <li>
<code class="language-plaintext highlighter-rouge">param array</code> $params</li> <li>
<code class="language-plaintext highlighter-rouge">param bool|\PHPUnit\Framework\TestCase</code> $testCase</li> </ul> <p>@return \PHPUnit\Framework\MockObject\MockObject&amp;RealInstanceType @throws \Exception</p> <h3 id="public-makeemptyexceptclass-method-params--null">
<em>public</em> makeEmptyExcept($class, $method, $params = null)</h3> <p>Instantiates class having all methods replaced with dummies except one. Constructor is not triggered. Properties and methods can be replaced. Even protected and private properties can be set.</p> <pre data-language="php">&lt;?php
$this-&gt;makeEmptyExcept('User', 'save');
$this-&gt;makeEmptyExcept('User', 'save', ['name' =&gt; 'davert']);
?&gt;</pre> <p>Accepts either name of class or object of that class</p> <pre data-language="php">&lt;?php
* $this-&gt;makeEmptyExcept(new User, 'save');
?&gt;</pre> <p>To replace method provide it’s name as a key in second parameter and it’s return value or callback function as parameter</p> <pre data-language="php">&lt;?php
$this-&gt;makeEmptyExcept('User', 'save', ['isValid' =&gt; function () { return true; }]);
$this-&gt;makeEmptyExcept('User', 'save', ['isValid' =&gt; true]);</pre> <p>@template RealInstanceType of object</p> <ul> <li>
<code class="language-plaintext highlighter-rouge">param class-string&lt;RealInstanceType&gt;|RealInstanceType|callable(): class-string&lt;RealInstanceType&gt;</code> $class - A class to be mocked</li> <li>
<code class="language-plaintext highlighter-rouge">param string</code> $method</li> <li>
<code class="language-plaintext highlighter-rouge">param array</code> $params</li> </ul> <p>@return \PHPUnit\Framework\MockObject\MockObject&amp;RealInstanceType @throws \Exception</p> <h3 id="public-constructclass-constructorparams--null-params--null">
<em>public</em> construct($class, $constructorParams = null, $params = null)</h3> <p>Instantiates a class instance by running constructor. Parameters for constructor passed as second argument Properties and methods can be set in third argument. Even protected and private properties can be set.</p> <pre data-language="php">&lt;?php
$this-&gt;construct('User', ['autosave' =&gt; false]);
$this-&gt;construct('User', ['autosave' =&gt; false], ['name' =&gt; 'davert']);
?&gt;</pre> <p>Accepts either name of class or object of that class</p> <pre data-language="php">&lt;?php
$this-&gt;construct(new User, ['autosave' =&gt; false), ['name' =&gt; 'davert']);
?&gt;</pre> <p>To replace method provide it’s name as a key in third parameter and it’s return value or callback function as parameter</p> <pre data-language="php">&lt;?php
$this-&gt;construct('User', [], ['save' =&gt; function () { return true; }]);
$this-&gt;construct('User', [], ['save' =&gt; true]);
?&gt;</pre> <p>@template RealInstanceType of object</p> <ul> <li>
<code class="language-plaintext highlighter-rouge">param class-string&lt;RealInstanceType&gt;|RealInstanceType|callable(): class-string&lt;RealInstanceType&gt;</code> $class - A class to be mocked</li> <li>
<code class="language-plaintext highlighter-rouge">param array</code> $constructorParams</li> <li>
<code class="language-plaintext highlighter-rouge">param array</code> $params</li> <li>
<code class="language-plaintext highlighter-rouge">param bool|\PHPUnit\Framework\TestCase</code> $testCase</li> </ul> <p>@return \PHPUnit\Framework\MockObject\MockObject&amp;RealInstanceType @throws \Exception</p> <h3 id="public-constructemptyclass-constructorparams--null-params--null">
<em>public</em> constructEmpty($class, $constructorParams = null, $params = null)</h3> <p>Instantiates a class instance by running constructor with all methods replaced with dummies. Parameters for constructor passed as second argument Properties and methods can be set in third argument. Even protected and private properties can be set.</p> <pre data-language="php">&lt;?php
$this-&gt;constructEmpty('User', ['autosave' =&gt; false]);
$this-&gt;constructEmpty('User', ['autosave' =&gt; false), ['name' =&gt; 'davert']);</pre> <p>Accepts either name of class or object of that class</p> <pre data-language="php">&lt;?php
$this-&gt;constructEmpty(new User, ['autosave' =&gt; false], ['name' =&gt; 'davert']);</pre> <p>To replace method provide it’s name as a key in third parameter and it’s return value or callback function as parameter</p> <pre data-language="php">&lt;?php
$this-&gt;constructEmpty('User', array(), array('save' =&gt; function () { return true; }));
$this-&gt;constructEmpty('User', array(), array('save' =&gt; true));</pre> <p><strong>To create a mock, pass current testcase name as last argument:</strong></p> <pre data-language="php">&lt;?php
$this-&gt;constructEmpty('User', [], [
     'save' =&gt; \Codeception\Stub\Expected::once()
]);</pre> <p>@template RealInstanceType of object</p> <ul> <li>
<code class="language-plaintext highlighter-rouge">param class-string&lt;RealInstanceType&gt;|RealInstanceType|callable(): class-string&lt;RealInstanceType&gt;</code> $class - A class to be mocked</li> <li>
<code class="language-plaintext highlighter-rouge">param array</code> $constructorParams</li> <li>
<code class="language-plaintext highlighter-rouge">param array</code> $params</li> </ul> <p>@return \PHPUnit\Framework\MockObject\MockObject&amp;RealInstanceType</p> <h3 id="public-constructemptyexceptclass-method-constructorparams--null-params--null">
<em>public</em> constructEmptyExcept($class, $method, $constructorParams = null, $params = null)</h3> <p>Instantiates a class instance by running constructor with all methods replaced with dummies, except one. Parameters for constructor passed as second argument Properties and methods can be set in third argument. Even protected and private properties can be set.</p> <pre data-language="php">&lt;?php
$this-&gt;constructEmptyExcept('User', 'save');
$this-&gt;constructEmptyExcept('User', 'save', ['autosave' =&gt; false], ['name' =&gt; 'davert']);
?&gt;</pre> <p>Accepts either name of class or object of that class</p> <pre data-language="php">&lt;?php
$this-&gt;constructEmptyExcept(new User, 'save', ['autosave' =&gt; false], ['name' =&gt; 'davert']);
?&gt;</pre> <p>To replace method provide it’s name as a key in third parameter and it’s return value or callback function as parameter</p> <pre data-language="php">&lt;?php
$this-&gt;constructEmptyExcept('User', 'save', [], ['save' =&gt; function () { return true; }]);
$this-&gt;constructEmptyExcept('User', 'save', [], ['save' =&gt; true]);
?&gt;</pre> <p>@template RealInstanceType of object</p> <ul> <li>
<code class="language-plaintext highlighter-rouge">param class-string&lt;RealInstanceType&gt;|RealInstanceType|callable(): class-string&lt;RealInstanceType&gt;</code> $class - A class to be mocked</li> <li>
<code class="language-plaintext highlighter-rouge">param string</code> $method</li> <li>
<code class="language-plaintext highlighter-rouge">param array</code> $constructorParams</li> <li>
<code class="language-plaintext highlighter-rouge">param array</code> $params</li> </ul> <p>@return \PHPUnit\Framework\MockObject\MockObject&amp;RealInstanceType</p> <h3 id="public-static-neverparams--null">
<em>public static</em> never($params = null)</h3> <p>Checks if a method never has been invoked</p> <p>If method invoked, it will immediately throw an exception.</p> <pre data-language="php">&lt;?php
use \Codeception\Stub\Expected;

$user = $this-&gt;make('User', [
     'getName' =&gt; Expected::never(),
     'someMethod' =&gt; function() {}
]);
$user-&gt;someMethod();
?&gt;</pre> <ul> <li>
<code class="language-plaintext highlighter-rouge">param mixed</code> $params @return StubMarshaler</li> </ul> <h3 id="public-static-onceparams--null">
<em>public static</em> once($params = null)</h3> <p>Checks if a method has been invoked exactly one time.</p> <p>If the number is less or greater it will later be checked in verify() and also throw an exception.</p> <pre data-language="php">&lt;?php
use \Codeception\Stub\Expected;

$user = $this-&gt;make(
    'User',
    array(
        'getName' =&gt; Expected::once('Davert'),
        'someMethod' =&gt; function() {}
    )
);
$userName = $user-&gt;getName();
$this-&gt;assertEquals('Davert', $userName);
?&gt;</pre> <p>Alternatively, a function can be passed as parameter:</p> <pre data-language="php">&lt;?php
Expected::once(function() { return Faker::name(); });</pre> <ul> <li>
<code class="language-plaintext highlighter-rouge">param mixed</code> $params</li> </ul> <p>@return StubMarshaler</p> <h3 id="public-static-atleastonceparams--null">
<em>public static</em> atLeastOnce($params = null)</h3> <p>Checks if a method has been invoked at least one time.</p> <p>If the number of invocations is 0 it will throw an exception in verify.</p> <pre data-language="php">&lt;?php
use \Codeception\Stub\Expected;

$user = $this-&gt;make(
    'User',
    array(
        'getName' =&gt; Expected::atLeastOnce('Davert')),
        'someMethod' =&gt; function() {}
    )
);
$user-&gt;getName();
$userName = $user-&gt;getName();
$this-&gt;assertEquals('Davert', $userName);
?&gt;</pre> <p>Alternatively, a function can be passed as parameter:</p> <pre data-language="php">&lt;?php
Expected::atLeastOnce(function() { return Faker::name(); });</pre> <ul> <li>
<code class="language-plaintext highlighter-rouge">param mixed</code> $params</li> </ul> <p>@return StubMarshaler</p> <h3 id="public-static-exactlycount-params--null">
<em>public static</em> exactly($count, $params = null)</h3> <p>Checks if a method has been invoked a certain amount of times. If the number of invocations exceeds the value it will immediately throw an exception, If the number is less it will later be checked in verify() and also throw an exception.</p> <pre data-language="php">&lt;?php
use \Codeception\Stub;
use \Codeception\Stub\Expected;

$user = $this-&gt;make(
    'User',
    array(
        'getName' =&gt; Expected::exactly(3, 'Davert'),
        'someMethod' =&gt; function() {}
    )
);
$user-&gt;getName();
$user-&gt;getName();
$userName = $user-&gt;getName();
$this-&gt;assertEquals('Davert', $userName);
?&gt;</pre> <p>Alternatively, a function can be passed as parameter:</p> <pre data-language="php">&lt;?php
Expected::exactly(function() { return Faker::name() });</pre> <ul> <li>
<code class="language-plaintext highlighter-rouge">param int</code> $count</li> <li>
<code class="language-plaintext highlighter-rouge">param mixed</code> $params</li> </ul> <p>@return StubMarshaler</p><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2011 Michael Bodnarchuk and contributors<br>Licensed under the MIT License.<br>
    <a href="https://codeception.com/docs/reference/Mock" class="_attribution-link">https://codeception.com/docs/reference/Mock</a>
  </p>
</div>
