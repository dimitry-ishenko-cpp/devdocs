<div class="innertube"> <h1 id="Definition of Agent Net if">12 Definition of Agent Net if</h1>  <div class="doc-image-wrapper">  <p class="doc-image-caption">Figure 12.1: The Purpose of Agent Net if</p> </div> <p>The Network Interface (Net If) process delivers SNMP PDUs to a master agent, and receives SNMP PDUs from the master agent. The most common behaviour of a Net if process is that is receives bytes from a network, decodes them into an SNMP PDU, which it sends to a master agent. When the master agent has processed the PDU, it sends a response PDU to the Net if process, which encodes the PDU into bytes and transmits the bytes onto the network. </p> <p>However, that simple behaviour can be modified in numerous ways. For example, the Net if process can apply some kind of encrypting/decrypting scheme on the bytes or act as a proxy filter, which sends some packets to a proxy agent and some packets to the master agent. </p> <p>It is also possible to write your own Net if process. The default Net if process is implemented in the module <code>snmpa_net_if</code> and it uses UDP as the transport protocol i.e the transport domains <code>transportDomainUdpIpv4</code> and/or <code>transportDomainUdpIpv6</code>. </p> <p>This section describes how to write a Net if process. </p> <h2 id="mandatory-functions" class="title-link"> <div class="title-name">12.1 Mandatory Functions</div>  </h2> <p>A Net if process must implement the SNMP agent <code><a href="snmpa_network_interface.html">network interface behaviour</a></code>. </p> <h2 id="messages" class="title-link"> <div class="title-name">12.2 Messages</div>  </h2> <p>The section <strong>Messages</strong> describes mandatory messages, which Net If must send and be able to receive. </p> <p>In this section an <code>Address</code> field is a <code>{Domain, Addr}</code> tuple where <code>Domain</code> is <code>transportDomainUdpIpv4</code> or <code>transportDomainUdpIpv4</code>, and <code>Addr</code> is an <code>{</code><code>IpAddr</code><code>,IpPort}</code> tuple.</p> <h3 id="outgoing-messages" class="title-link"> <div class="title-name">Outgoing Messages</div>  </h3> <p>Net if must send the following message when it receives an SNMP PDU from the network that is aimed for the MasterAgent: </p>  <pre id="om_snmp_pdu" data-language="erlang">
MasterAgent ! {snmp_pdu, Vsn, Pdu, PduMS, ACMData, From, Extra}
      </pre> <ul> <li> <code>Vsn</code> is either <code>'version-1'</code>, <code>'version-2'</code>, or <code>'version-3'</code>. </li> <li> <code>Pdu</code> is an SNMP PDU record, as defined in <code>snmp_types.hrl</code>, with the SNMP request. </li> <li> <code>PduMS</code> is the Maximum Size of the response Pdu allowed. Normally this is returned from <code>snmpa_mpd:process_packet</code> (see Reference Manual). </li> <li> <code>ACMData</code> is data used by the Access Control Module in use. Normally this is returned from <code>snmpa_mpd:process_packet</code> (see Reference Manual). </li> <li> <code>From</code> is the source <code>Address</code>. </li> <li> <code>Extra</code> is any term the Net if process wishes to send to the agent. This term can be retrieved by the instrumentation functions by calling <code>snmp:current_net_if_data()</code>. This data is also sent back to the Net if process when the agent generates a response to the request.</li> </ul> <p>The following message is used to report that a response to a request has been received. The only request an agent can send is an Inform-Request. </p>  <pre id="om_snmp_response_received" data-language="erlang">
Pid ! {snmp_response_received, Vsn, Pdu, From}
      </pre> <ul> <li> <code>Pid</code> is the Process that waits for the response for the request. The Pid was specified in the <code>send_pdu_req</code> message <code><a href="#im_send_pdu_req">(see below)</a></code>. </li> <li> <code>Vsn</code> is either <code>'version-1'</code>, <code>'version-2'</code>, or <code>'version-3'</code>. </li> <li> <code>Pdu</code> is the SNMP Pdu received </li> <li> <code>From</code> is the source <code>Address</code>. </li> </ul> <h3 id="incoming-messages" class="title-link"> <div class="title-name">Incoming Messages</div>  </h3> <p>This section describes the incoming messages which a Net if process must be able to receive. </p> <ul> <li>  <p id="im_snmp_response"><code>{snmp_response, Vsn, Pdu, Type, ACMData, To, Extra}</code></p> <p>This message is sent to the Net if process from a master agent as a response to a previously received request. </p> <ul> <li> <p><code>Vsn</code> is either <code>'version-1'</code>, <code>'version-2'</code>, or <code>'version-3'</code>. </p> </li> <li> <p><code>Pdu</code> is an SNMP PDU record (as defined in snmp_types.hrl) with the SNMP response. </p> </li> <li> <p><code>Type</code> is the <code>#pdu.type</code> of the original request. </p> </li> <li> <p><code>ACMData</code> is data used by the Access Control Module in use. Normally this is just sent to <code>snmpa_mpd:generate_response_message</code> (see Reference Manual). </p> </li> <li> <p><code>To</code> is the destination <code>Address</code> that comes from the <code>From</code> field in the corresponding <code>snmp_pdu</code> message previously sent to the MasterAgent.</p> </li> <li> <p><code>Extra</code> is the term that the Net if process sent to the agent when the request was sent to the agent. </p> </li> </ul> </li> <li>  <p id="im_discarded_pdu"><code>{discarded_pdu, Vsn, ReqId, ACMData, Variable, Extra}</code></p> <p>This message is sent from a master agent if it for some reason decided to discard the pdu. </p> <ul> <li> <p><code>Vsn</code> is either <code>'version-1'</code>, <code>'version-2'</code>, or <code>'version-3'</code>. </p> </li> <li> <p><code>ReqId</code> is the request id of the original request. </p> </li> <li> <p><code>ACMData</code> is data used by the Access Control Module in use. Normally this is just sent to <code>snmpa_mpd:generate_response_message</code> (see Reference Manual). </p> </li> <li> <p><code>Variable</code> is the name of an snmp counter that represents the error, e.g. <code>snmpInBadCommunityUses</code>. </p> </li> <li> <p><code>Extra</code> is the term that the Net if process sent to the agent when the request was sent to the agent. </p> </li> </ul> </li> <li>  <p id="im_send_pdu"><code>{send_pdu, Vsn, Pdu, MsgData, To, Extra}</code></p> <p>This message is sent from a master agent when a trap is to be sent. </p> <ul> <li> <p><code>Vsn</code> is either <code>'version-1'</code>, <code>'version-2'</code>, or <code>'version-3'</code>.</p> </li> <li> <p><code>Pdu</code> is an SNMP PDU record (as defined in snmp_types.hrl) with the SNMP response. </p> </li> <li> <p><code>MsgData</code> is the message specific data used in the SNMP message. This value is normally sent to <code>snmpa_mpd:generate_message/4</code>. In SNMPv1 and SNMPv2c, this message data is the community string. In SNMPv3, it is the context information. </p> </li> <li> <p><code>To</code> is a list of <code>{Address, SecData}</code> tuples i.e the destination addresses and their corresponding security parameters. This value is normally sent to <code>snmpa_mpd:generate_message/4</code>. </p> </li> <li> <p><code>Extra</code> is any term that the notification sender wishes to pass to the Net if process when sending a notification (see <code><a href="snmpa.html#send_notification2">send notification </a></code> for more info). </p> </li> </ul> </li> <li>  <p id="im_send_pdu_req"><code>{send_pdu_req, Vsn, Pdu, MsgData, To, Pid, Extra}</code></p> <p>This message is sent from a master agent when a request is to be sent. The only request an agent can send is Inform-Request. The net if process needs to remember the request id and the Pid, and when a response is received for the request id, send it to Pid, using a <code>snmp_response_received</code> message. </p> <ul> <li> <p><code>Vsn</code> is either <code>'version-1'</code>, <code>'version-2'</code>, or <code>'version-3'</code>.</p> </li> <li> <p><code>Pdu</code> is an SNMP PDU record (as defined in snmp_types.hrl) with the SNMP response. </p> </li> <li> <p><code>MsgData</code> is the message specific data used in the SNMP message. This value is normally sent to <code>snmpa_mpd:generate_message/4</code>. In SNMPv1 and SNMPv2c, this message data is the community string. In SNMPv3, it is the context information. </p> </li> <li> <p><code>To</code> is a list of <code>{Address, SecData}</code> tuples i.e the destination addresses and their corresponding security parameters. This value is normally sent to <code>snmpa_mpd:generate_message/4</code>. </p> </li> <li> <p><code>Pid</code> is a process identifier. </p> </li> <li> <p><code>Extra</code> is any term that the notification sender wishes to pass to the Net if process when sending a notification (see <code><a href="snmpa.html#send_notification2">send notification </a></code> for more info). </p> </li> </ul> </li> </ul> <h3 id="notes" class="title-link"> <div class="title-name">Notes</div>  </h3> <p>Since the Net if process is responsible for encoding and decoding of SNMP messages, it must also update the relevant counters in the SNMP group in MIB-II. It can use the functions in the module <code>snmpa_mpd</code> for this purpose (refer to the Reference Manual, section <code>snmp</code>, module <code><a href="snmp_pdus.html">snmpa_mpd</a></code> for more details.) </p> <p>There are also some useful functions for encoding and decoding of SNMP messages in the module <code><a href="snmp_pdus.html">snmp_pdus</a></code>. </p> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2010&ndash;2023 Ericsson AB<br>Licensed under the Apache License, Version 2.0.<br>
    
  </p>
</div>
