  <div class="innertube"> <h2 id="module" class="title-link"> <div class="title-name">Module</div>  </h2> <div class="REFBODY module-body">scheduler</div> </div> <div class="innertube"> <h2 id="module-summary" class="title-link"> <div class="title-name">Module Summary</div>  </h2> <div class="REFBODY module-summary-body">Measure scheduler utilization</div> <h2 id="since" class="title-link"> <div class="title-name">Since</div>  </h2> <div class="REFBODY module-since"> Module scheduler was introduced in OTP 21.0. </div> </div> <section class="description"><div class="innertube"> <h2 id="description" class="title-link"> <div class="title-name">Description</div>  </h2> <div class="REFBODY description-body">

<p> This module contains utility functions for easy measurement and calculation of scheduler utilization. It act as a wrapper around the more primitive API <code> erlang:statistics(scheduler_wall_time)</code>. </p> <p> The simplest usage is to call the blocking <code><a href="#utilization-1"> scheduler:utilization(Seconds)</a></code>. </p> <p> For non blocking and/or continuous calculation of scheduler utilization, the recommended usage is: </p> <ul> <li><p> First call <code> erlang:system_flag(scheduler_wall_time,true)</code> to enable scheduler wall time measurements. </p></li> <li><p> Call <code><a href="#get_sample-0">get_sample/0</a></code> to collect samples with some time in between. </p></li> <li><p> Call <code><a href="#utilization-2">utilization/2</a></code> to calculate the scheduler utilization in the interval between two samples. </p></li> <li><p> When done call <code> erlang:system_flag(scheduler_wall_time,false)</code> to disable scheduler wall time measurements and avoid unecessary cpu overhead. </p></li> </ul> <p> To get correct values from <code><a href="#utilization-2">utilization/2</a></code>, it is important that <code>scheduler_wall_time</code> is kept enabled during the entire interval between the two samples. To ensure this, the process that called <code> erlang:system_flag(scheduler_wall_time,true)</code> must be kept alive, as <code>scheduler_wall_time</code> will automatically be disabled if it terminates. </p> </div> </div></section> <div class="innertube"> <h2 id="data-types" class="title-link"> <div class="title-name">Data Types</div>  </h2> <article class="data-types-body"><h3 id="type-sched_sample" class="title-link data-type-name">  <div class="title-name"> <code><a name="type-sched_sample">sched_sample()</a></code><br> </div> </h3> </article> <article class="data-types-body"><h3 id="type-sched_type" class="title-link data-type-name">  <div class="title-name"> <code><a name="type-sched_type">sched_type()</a> = normal | cpu | io</code><br> </div> </h3> </article> <article class="data-types-body"><h3 id="type-sched_id" class="title-link data-type-name">  <div class="title-name"> <code><a name="type-sched_id">sched_id()</a> = integer()</code><br> </div> </h3> </article> <article class="data-types-body"><h3 id="type-sched_util_result" class="title-link data-type-name">  <div class="title-name"> <pre data-language="erlang"><code><a name="type-sched_util_result">sched_util_result()</a> = 
 [{<a href="#type-sched_type">sched_type()</a>, <a href="#type-sched_id">sched_id()</a>, float(), string()} |
 {total, float(), string()} |
 {weighted, float(), string()}]</code></pre>
<br> </div> </h3> <div class="data-type-desc"><div class="REFBODY rb-7"> <p>A list of tuples containing results for individual schedulers as well as aggregated averages. <code>Util</code> is the scheduler utilization as a floating point value between 0.0 and 1.0. <code>Percent</code> is the same utilization as a more human readable string expressed in percent.</p> <dl> <dt class="title-link"><strong><code>{normal, SchedulerId, Util, Percent}</code></strong></dt> <dd>Scheduler utilization of a normal scheduler with number <code>SchedulerId</code>. Schedulers that are not online will also be included. <code>Online schedulers</code> have the lowest <code>SchedulerId</code>.</dd> <dt class="title-link"><strong><code>{cpu, SchedulerId, Util, Percent}</code></strong></dt> <dd>Scheduler utilization of a dirty-cpu scheduler with number <code>SchedulerId</code>.</dd> <dt class="title-link"><strong><code>{io, SchedulerId, Util, Percent}</code></strong></dt> <dd>Scheduler utilization of a dirty-io scheduler with number <code>SchedulerId</code>. This tuple will only exist if both samples were taken with <code><a href="#sample_all-0">sample_all/0</a></code>.</dd> <dt class="title-link"><strong><code>{total, Util, Percent}</code></strong></dt> <dd>Total utilization of all normal and dirty-cpu schedulers.</dd> <dt class="title-link"><strong><code>{weighted, Util, Percent}</code></strong></dt> <dd>Total utilization of all normal and dirty-cpu schedulers, weighted against maximum amount of available CPU time.</dd> </dl> </div></div></article> </div> <div class="innertube"><h2 id="export" class="title-link"> <div class="title-name">Exports</div>  </h2></div> <div class="exports-body"> <article class="func"><h3 id="get_sample-0" class="bold_code title-link func-head">  <code>get_sample() -&gt; <code><a href="#type-sched_sample">sched_sample()</a></code> | undefined</code><div class="title-since"><span class="since">OTP 24.3</span></div> </h3> <div class="exports-tube"><div class="REFBODY rb-7"> <p>Returns a scheduler utilization sample for normal and dirty-cpu schedulers. Returns <code>undefined</code> if system flag <code> scheduler_wall_time</code> has not been enabled.</p> </div></div></article><article class="func"><h3 id="get_sample_all-0" class="bold_code title-link func-head">  <code>get_sample_all() -&gt; <code><a href="#type-sched_sample">sched_sample()</a></code> | undefined</code><div class="title-since"><span class="since">OTP 24.3</span></div> </h3> <div class="exports-tube"><div class="REFBODY rb-7"> <p>Return a scheduler utilization sample for all schedulers, including dirty-io schedulers. Returns <code>undefined</code> if system flag <code> scheduler_wall_time</code> has not been enabled.</p> </div></div></article><article class="func"><h3 id="sample-0" class="bold_code title-link func-head">  <code>sample() -&gt; <code><a href="#type-sched_sample">sched_sample()</a></code></code><div class="title-since"><span class="since">OTP 21.0</span></div> </h3> <div class="exports-tube"><div class="REFBODY rb-7"> <p> Return a scheduler utilization sample for normal and dirty-cpu schedulers. Will call <code> erlang:system_flag(scheduler_wall_time,true)</code> first if not already already enabled. </p> <div class="note"> <div class="label">Note</div> <div class="content">

<p> This function is <strong>not recommended</strong> as there is no way to detect if <code>scheduler_wall_time</code> already was enabled or not. If <code>scheduler_wall_time</code> has been disabled between two samples, passing them to <code><a href="#utilization-1">utilization/2</a></code> will yield invalid results. </p> <p> Instead use <code><a href="#get_sample-0"> get_sample/0</a></code> together with <code> erlang:system_flag(scheduler_wall_time,_)</code>. </p> </div> </div> </div></div></article><article class="func"><h3 id="sample_all-0" class="bold_code title-link func-head">  <code>sample_all() -&gt; <code><a href="#type-sched_sample">sched_sample()</a></code></code><div class="title-since"><span class="since">OTP 21.0</span></div> </h3> <div class="exports-tube"><div class="REFBODY rb-7"> <p> Return a scheduler utilization sample for all schedulers, including dirty-io schedulers. Will call <code> erlang:system_flag(scheduler_wall_time,true)</code> first if not already already enabled. </p> <div class="note"> <div class="label">Note</div> <div class="content">

<p> This function is <strong>not recommended</strong> for same reason as <code>sample/0</code>. Instead use <code><a href="#get_sample_all-0"> get_sample_all/0</a></code> together with <code> erlang:system_flag(scheduler_wall_time,_)</code>. </p> </div> </div> </div></div></article><article class="func"><h3 id="utilization-1" class="bold_code title-link func-head">  <code>utilization(Seconds) -&gt; <code><a href="#type-sched_util_result">sched_util_result()</a></code></code><div class="title-since"><span class="since">OTP 21.0</span></div> </h3> <div class="REFBODY fun-types"> <h4 id="types" class="func-types-title">Types</h4> <div class="REFTYPES rt-1"><code>Seconds = integer() &gt;= 1</code></div> </div> <div class="exports-tube"><div class="REFBODY rb-7"> <p> Measure utilization for normal and dirty-cpu schedulers during <code>Seconds</code> seconds, and then return the result. </p> <p> Will automatically first enable and then disable <code> scheduler_wall_time</code>. </p> </div></div></article><article class="func"><h3 id="utilization-1" class="bold_code title-link func-head">  <code>utilization(Sample) -&gt; <code><a href="#type-sched_util_result">sched_util_result()</a></code></code><div class="title-since"><span class="since">OTP 21.0</span></div> </h3> <div class="REFBODY fun-types"> <h4 id="types" class="func-types-title">Types</h4> <div class="REFTYPES rt-1"><code>Sample = <a href="#type-sched_sample">sched_sample()</a></code></div> </div> <div class="exports-tube"><div class="REFBODY rb-7"> <p>Calculate scheduler utilizations for the time interval from when <code>Sample</code> was taken and "now". The same as calling <code>scheduler:utilization(Sample, scheduler:sample_all())</code>.</p> <div class="note"> <div class="label">Note</div> <div class="content">

<p> This function is <strong>not recommended</strong> as it's so easy to get invalid results without noticing. In particular do not do this: </p> <pre data-language="erlang">
scheduler:utilization(scheduler:sample()). % DO NOT DO THIS!
</pre> <p> The above example takes two samples in rapid succession and calculates the scheduler utilization between them. The resulting values will probably be more misleading than informative. </p> <p> Instead use <code><a href="#utilization-2"> scheduler:utilization/2</a></code> and call <code><a href="#get_sample-0">get_sample/0</a></code> to get samples with some time in between. </p> </div> </div> </div></div></article><article class="func"><h3 id="utilization-2" class="bold_code title-link func-head">  <code>utilization(Sample1, Sample2) -&gt; <code><a href="#type-sched_util_result">sched_util_result()</a></code></code><div class="title-since"><span class="since">OTP 21.0</span></div> </h3> <div class="REFBODY fun-types"> <h4 id="types" class="func-types-title">Types</h4> <div class="REFTYPES rt-1"><code>Sample1 = Sample2 = <a href="#type-sched_sample">sched_sample()</a></code></div>  </div> <div class="exports-tube"><div class="REFBODY rb-7"> <p>Calculates scheduler utilizations for the time interval between the two samples obtained from calling <code><a href="#sample-0">get_sample/0</a></code> or <code><a href="#sample_all-0">get_sample_all/0</a></code>.</p> <p> This function itself, does not need <code> scheduler_wall_time</code> to be enabled. However, for a correct result, <code>scheduler_wall_time</code> must have been enabled during the entire interval between the two samples. </p> </div></div></article> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2010&ndash;2023 Ericsson AB<br>Licensed under the Apache License, Version 2.0.<br>
    
  </p>
</div>
