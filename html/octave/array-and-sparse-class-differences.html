<div class="subsubsection" id="Array-and-Sparse-Class-Differences">   <h1 class="subsubsection">A.1.6.1 Array and Sparse Class Differences</h1> <p>The number of elements in a sparse matrix is considered to be the number of nonzero elements, rather than the product of the dimensions. Therefore, </p> <pre class="example" data-language="matlab">SparseMatrix sm;
…
int nnz = sm.nelem ();</pre> <p>returns the number of nonzero elements (like the interpreter function <code>nnz</code>). If the user really requires the number of elements in the matrix, including the nonzero elements, they should use <code>numel</code> rather than <code>nelem</code>. Note that for very large matrices, where the product of the two dimensions is larger than the representation of an unsigned int, <code>numel</code> can overflow. An example is <code>speye (1e6)</code> which will create a matrix with a million rows and columns, but only a million nonzero elements. In this case, the number of rows multiplied by the number of columns is more than two hundred times the maximum value that can be represented by an unsigned 32-bit int. The use of <code>numel</code> should, therefore, be avoided unless it is known that it will not overflow. </p> <p>Extreme care is also required when using the <code>elem</code> method or the <code>()</code> operator which perform essentially the same function. The reason is that if a sparse object is non-const, then Octave will assume that a request for a zero element in a sparse matrix is in fact a request to create this element so it can be filled. Therefore, a piece of code like </p> <pre class="example" data-language="matlab">SparseMatrix sm;
…
for (int j = 0; j &lt; nc; j++)
  for (int i = 0; i &lt; nr; i++)
    std::cerr &lt;&lt; " (" &lt;&lt; i &lt;&lt; "," &lt;&lt; j &lt;&lt; "): " &lt;&lt; sm(i,j) &lt;&lt; "\n";</pre> <p>is a great way of turning a sparse matrix into a dense one, and a very slow way at that since it reallocates the sparse object for each zero element in the matrix. </p> <p>A simple way of preventing the above from happening is to create a temporary constant version of the sparse matrix. Note that only the container for the sparse matrix will be copied, while the actual representation of the data will be shared between the two versions of the sparse matrix; This is not a costly operation. The example above, re-written to prevent sparse-to-dense conversion, is </p> <pre class="example" data-language="matlab">SparseMatrix sm;
…
const SparseMatrix tmp (sm);
for (int j = 0; j &lt; nc; j++)
  for (int i = 0; i &lt; nr; i++)
    std::cerr &lt;&lt; " (" &lt;&lt; i &lt;&lt; "," &lt;&lt; j &lt;&lt; "): " &lt;&lt; tmp(i,j) &lt;&lt; "\n";</pre> <p>Finally, because the sparse types aren’t represented by a contiguous block of memory, the <code>fortran_vec</code> method of <code>Array&lt;T&gt;</code> is not available. It is, however, replaced by three separate methods <code>ridx</code>, <code>cidx</code>, and <code>data</code>, that access the raw compressed column format that Octave sparse matrices are stored in. These methods can be used in a manner similar to <code>elem</code> to allow the matrix to be accessed or filled. However, it is up to the user to respect the sparse matrix compressed column format or the matrix will become corrupted. </p> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 1996–2023 The Octave Project Developers<br>Permission is granted to make and distribute verbatim copies of this manual provided the copyright notice and this permission notice are preserved on all copies.<br/>Permission is granted to copy and distribute modified versions of this manual under the conditions for verbatim copying, provided that the entire resulting derived work is distributed under the terms of a permission notice identical to this one.</br>Permission is granted to copy and distribute translations of this manual into another language, under the above conditions for modified versions.<br>
    <a href="https://docs.octave.org/v8.1.0/Array-and-Sparse-Class-Differences.html" class="_attribution-link">https://docs.octave.org/v8.1.0/Array-and-Sparse-Class-Differences.html</a>
  </p>
</div>
