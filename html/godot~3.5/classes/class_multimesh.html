<h1 id="class-multimesh">MultiMesh</h1> <p><strong>Inherits:</strong> <a href="class_resource.html#class-resource"><span class="std std-ref">Resource</span></a> <strong>&lt;</strong> <a href="class_reference.html#class-reference"><span class="std std-ref">Reference</span></a> <strong>&lt;</strong> <a href="class_object.html#class-object"><span class="std std-ref">Object</span></a></p> <p>Provides high-performance mesh instancing.</p> <section id="description"> <h2>Description</h2> <p>MultiMesh provides low-level mesh instancing. Drawing thousands of <a href="class_meshinstance.html#class-meshinstance"><span class="std std-ref">MeshInstance</span></a> nodes can be slow, since each object is submitted to the GPU then drawn individually.</p> <p>MultiMesh is much faster as it can draw thousands of instances with a single draw call, resulting in less API overhead.</p> <p>As a drawback, if the instances are too far away from each other, performance may be reduced as every single instance will always render (they are spatially indexed as one, for the whole object).</p> <p>Since instances may have any behavior, the AABB used for visibility must be provided by the user.</p> </section> <section id="tutorials"> <h2>Tutorials</h2> <ul class="simple"> <li><a href="https://docs.godotengine.org/en/3.5/tutorials/performance/vertex_animation/animating_thousands_of_fish.html"><span class="doc">Animating thousands of fish with MultiMeshInstance</span></a></li> <li><a href="https://docs.godotengine.org/en/3.5/tutorials/performance/using_multimesh.html"><span class="doc">Optimization using MultiMeshes</span></a></li> </ul> </section> <section id="properties"> <h2>Properties</h2> <table class="docutils align-default">   <tr>
<td><p><a href="#enum-multimesh-colorformat"><span class="std std-ref">ColorFormat</span></a></p></td> <td><p><a href="#class-multimesh-property-color-format"><span class="std std-ref">color_format</span></a></p></td> <td><p><code>0</code></p></td> </tr> <tr>
<td><p><a href="#enum-multimesh-customdataformat"><span class="std std-ref">CustomDataFormat</span></a></p></td> <td><p><a href="#class-multimesh-property-custom-data-format"><span class="std std-ref">custom_data_format</span></a></p></td> <td><p><code>0</code></p></td> </tr> <tr>
<td><p><a href="class_int.html#class-int"><span class="std std-ref">int</span></a></p></td> <td><p><a href="#class-multimesh-property-instance-count"><span class="std std-ref">instance_count</span></a></p></td> <td><p><code>0</code></p></td> </tr> <tr>
<td><p><a href="class_mesh.html#class-mesh"><span class="std std-ref">Mesh</span></a></p></td> <td><p><a href="#class-multimesh-property-mesh"><span class="std std-ref">mesh</span></a></p></td> <td></td> </tr> <tr>
<td><p><a href="#enum-multimesh-physicsinterpolationquality"><span class="std std-ref">PhysicsInterpolationQuality</span></a></p></td> <td><p><a href="#class-multimesh-property-physics-interpolation-quality"><span class="std std-ref">physics_interpolation_quality</span></a></p></td> <td><p><code>0</code></p></td> </tr> <tr>
<td><p><a href="#enum-multimesh-transformformat"><span class="std std-ref">TransformFormat</span></a></p></td> <td><p><a href="#class-multimesh-property-transform-format"><span class="std std-ref">transform_format</span></a></p></td> <td><p><code>0</code></p></td> </tr> <tr>
<td><p><a href="class_int.html#class-int"><span class="std std-ref">int</span></a></p></td> <td><p><a href="#class-multimesh-property-visible-instance-count"><span class="std std-ref">visible_instance_count</span></a></p></td> <td><p><code>-1</code></p></td> </tr>  </table> </section> <section id="methods"> <h2>Methods</h2> <table class="docutils align-default">   <tr>
<td><p><a href="class_aabb.html#class-aabb"><span class="std std-ref">AABB</span></a></p></td> <td><p><a href="#class-multimesh-method-get-aabb"><span class="std std-ref">get_aabb</span></a> <strong>(</strong> <strong>)</strong> <abbr title="This method has no side effects. It doesn't modify any of the instance's member variables.">const</abbr></p></td> </tr> <tr>
<td><p><a href="class_color.html#class-color"><span class="std std-ref">Color</span></a></p></td> <td><p><a href="#class-multimesh-method-get-instance-color"><span class="std std-ref">get_instance_color</span></a> <strong>(</strong> <a href="class_int.html#class-int"><span class="std std-ref">int</span></a> instance <strong>)</strong> <abbr title="This method has no side effects. It doesn't modify any of the instance's member variables.">const</abbr></p></td> </tr> <tr>
<td><p><a href="class_color.html#class-color"><span class="std std-ref">Color</span></a></p></td> <td><p><a href="#class-multimesh-method-get-instance-custom-data"><span class="std std-ref">get_instance_custom_data</span></a> <strong>(</strong> <a href="class_int.html#class-int"><span class="std std-ref">int</span></a> instance <strong>)</strong> <abbr title="This method has no side effects. It doesn't modify any of the instance's member variables.">const</abbr></p></td> </tr> <tr>
<td><p><a href="class_transform.html#class-transform"><span class="std std-ref">Transform</span></a></p></td> <td><p><a href="#class-multimesh-method-get-instance-transform"><span class="std std-ref">get_instance_transform</span></a> <strong>(</strong> <a href="class_int.html#class-int"><span class="std std-ref">int</span></a> instance <strong>)</strong> <abbr title="This method has no side effects. It doesn't modify any of the instance's member variables.">const</abbr></p></td> </tr> <tr>
<td><p><a href="class_transform2d.html#class-transform2d"><span class="std std-ref">Transform2D</span></a></p></td> <td><p><a href="#class-multimesh-method-get-instance-transform-2d"><span class="std std-ref">get_instance_transform_2d</span></a> <strong>(</strong> <a href="class_int.html#class-int"><span class="std std-ref">int</span></a> instance <strong>)</strong> <abbr title="This method has no side effects. It doesn't modify any of the instance's member variables.">const</abbr></p></td> </tr> <tr>
<td><p>void</p></td> <td><p><a href="#class-multimesh-method-reset-instance-physics-interpolation"><span class="std std-ref">reset_instance_physics_interpolation</span></a> <strong>(</strong> <a href="class_int.html#class-int"><span class="std std-ref">int</span></a> instance <strong>)</strong></p></td> </tr> <tr>
<td><p>void</p></td> <td><p><a href="#class-multimesh-method-set-as-bulk-array"><span class="std std-ref">set_as_bulk_array</span></a> <strong>(</strong> <a href="class_poolrealarray.html#class-poolrealarray"><span class="std std-ref">PoolRealArray</span></a> array <strong>)</strong></p></td> </tr> <tr>
<td><p>void</p></td> <td><p><a href="#class-multimesh-method-set-as-bulk-array-interpolated"><span class="std std-ref">set_as_bulk_array_interpolated</span></a> <strong>(</strong> <a href="class_poolrealarray.html#class-poolrealarray"><span class="std std-ref">PoolRealArray</span></a> array_current, <a href="class_poolrealarray.html#class-poolrealarray"><span class="std std-ref">PoolRealArray</span></a> array_previous <strong>)</strong></p></td> </tr> <tr>
<td><p>void</p></td> <td><p><a href="#class-multimesh-method-set-instance-color"><span class="std std-ref">set_instance_color</span></a> <strong>(</strong> <a href="class_int.html#class-int"><span class="std std-ref">int</span></a> instance, <a href="class_color.html#class-color"><span class="std std-ref">Color</span></a> color <strong>)</strong></p></td> </tr> <tr>
<td><p>void</p></td> <td><p><a href="#class-multimesh-method-set-instance-custom-data"><span class="std std-ref">set_instance_custom_data</span></a> <strong>(</strong> <a href="class_int.html#class-int"><span class="std std-ref">int</span></a> instance, <a href="class_color.html#class-color"><span class="std std-ref">Color</span></a> custom_data <strong>)</strong></p></td> </tr> <tr>
<td><p>void</p></td> <td><p><a href="#class-multimesh-method-set-instance-transform"><span class="std std-ref">set_instance_transform</span></a> <strong>(</strong> <a href="class_int.html#class-int"><span class="std std-ref">int</span></a> instance, <a href="class_transform.html#class-transform"><span class="std std-ref">Transform</span></a> transform <strong>)</strong></p></td> </tr> <tr>
<td><p>void</p></td> <td><p><a href="#class-multimesh-method-set-instance-transform-2d"><span class="std std-ref">set_instance_transform_2d</span></a> <strong>(</strong> <a href="class_int.html#class-int"><span class="std std-ref">int</span></a> instance, <a href="class_transform2d.html#class-transform2d"><span class="std std-ref">Transform2D</span></a> transform <strong>)</strong></p></td> </tr>  </table> </section> <section id="enumerations"> <h2>Enumerations</h2> <p id="class-multimesh-constant-transform-3d">enum <strong id="enum-multimesh-transformformat">TransformFormat</strong>:</p> <ul class="simple"> <li>
<strong>TRANSFORM_2D</strong> = <strong>0</strong> --- Use this when using 2D transforms.</li> <li>
<strong>TRANSFORM_3D</strong> = <strong>1</strong> --- Use this when using 3D transforms.</li> </ul>  <p id="class-multimesh-constant-color-float">enum <strong id="enum-multimesh-colorformat">ColorFormat</strong>:</p> <ul class="simple"> <li>
<strong>COLOR_NONE</strong> = <strong>0</strong> --- Use when you are not using per-instance <a href="class_color.html#class-color"><span class="std std-ref">Color</span></a>s.</li> <li>
<strong>COLOR_8BIT</strong> = <strong>1</strong> --- Compress <a href="class_color.html#class-color"><span class="std std-ref">Color</span></a> data into 8 bits when passing to shader. This uses less memory and can be faster, but the <a href="class_color.html#class-color"><span class="std std-ref">Color</span></a> loses precision.</li> <li>
<strong>COLOR_FLOAT</strong> = <strong>2</strong> --- The <a href="class_color.html#class-color"><span class="std std-ref">Color</span></a> passed into <a href="#class-multimesh-method-set-instance-color"><span class="std std-ref">set_instance_color</span></a> will use 4 floats. Use this for highest precision <a href="class_color.html#class-color"><span class="std std-ref">Color</span></a>.</li> </ul>  <p id="class-multimesh-constant-custom-data-float">enum <strong id="enum-multimesh-customdataformat">CustomDataFormat</strong>:</p> <ul class="simple"> <li>
<strong>CUSTOM_DATA_NONE</strong> = <strong>0</strong> --- Use when you are not using per-instance custom data.</li> <li>
<strong>CUSTOM_DATA_8BIT</strong> = <strong>1</strong> --- Compress custom_data into 8 bits when passing to shader. This uses less memory and can be faster, but loses precision and range. Floats packed into 8 bits can only represent values between 0 and 1, numbers outside that range will be clamped.</li> <li>
<strong>CUSTOM_DATA_FLOAT</strong> = <strong>2</strong> --- The <a href="class_color.html#class-color"><span class="std std-ref">Color</span></a> passed into <a href="#class-multimesh-method-set-instance-custom-data"><span class="std std-ref">set_instance_custom_data</span></a> will use 4 floats. Use this for highest precision.</li> </ul>  <p id="class-multimesh-constant-interp-quality-high">enum <strong id="enum-multimesh-physicsinterpolationquality">PhysicsInterpolationQuality</strong>:</p> <ul class="simple"> <li>
<strong>INTERP_QUALITY_FAST</strong> = <strong>0</strong> --- Always interpolate using Basis lerping, which can produce warping artifacts in some situations.</li> <li>
<strong>INTERP_QUALITY_HIGH</strong> = <strong>1</strong> --- Attempt to interpolate using Basis slerping (spherical linear interpolation) where possible, otherwise fall back to lerping.</li> </ul> </section> <section id="property-descriptions"> <h2>Property Descriptions</h2> <h3 id="class-multimesh-property-color-format"><p><a href="#enum-multimesh-colorformat"><span class="std std-ref">ColorFormat</span></a> color_format</p></h3> <table class="docutils align-default">   <tr>
<td><p><em>Default</em></p></td> <td><p><code>0</code></p></td> </tr> <tr>
<td><p><em>Setter</em></p></td> <td><p>set_color_format(value)</p></td> </tr> <tr>
<td><p><em>Getter</em></p></td> <td><p>get_color_format()</p></td> </tr>  </table> <p>Format of colors in color array that gets passed to shader.</p>  <h3 id="class-multimesh-property-custom-data-format"><p><a href="#enum-multimesh-customdataformat"><span class="std std-ref">CustomDataFormat</span></a> custom_data_format</p></h3> <table class="docutils align-default">   <tr>
<td><p><em>Default</em></p></td> <td><p><code>0</code></p></td> </tr> <tr>
<td><p><em>Setter</em></p></td> <td><p>set_custom_data_format(value)</p></td> </tr> <tr>
<td><p><em>Getter</em></p></td> <td><p>get_custom_data_format()</p></td> </tr>  </table> <p>Format of custom data in custom data array that gets passed to shader.</p>  <h3 id="class-multimesh-property-instance-count"><p><a href="class_int.html#class-int"><span class="std std-ref">int</span></a> instance_count</p></h3> <table class="docutils align-default">   <tr>
<td><p><em>Default</em></p></td> <td><p><code>0</code></p></td> </tr> <tr>
<td><p><em>Setter</em></p></td> <td><p>set_instance_count(value)</p></td> </tr> <tr>
<td><p><em>Getter</em></p></td> <td><p>get_instance_count()</p></td> </tr>  </table> <p>Number of instances that will get drawn. This clears and (re)sizes the buffers. By default, all instances are drawn but you can limit this with <a href="#class-multimesh-property-visible-instance-count"><span class="std std-ref">visible_instance_count</span></a>.</p>  <h3 id="class-multimesh-property-mesh"><p><a href="class_mesh.html#class-mesh"><span class="std std-ref">Mesh</span></a> mesh</p></h3> <table class="docutils align-default">   <tr>
<td><p><em>Setter</em></p></td> <td><p>set_mesh(value)</p></td> </tr> <tr>
<td><p><em>Getter</em></p></td> <td><p>get_mesh()</p></td> </tr>  </table> <p>Mesh to be drawn.</p>  <h3 id="class-multimesh-property-physics-interpolation-quality"><p><a href="#enum-multimesh-physicsinterpolationquality"><span class="std std-ref">PhysicsInterpolationQuality</span></a> physics_interpolation_quality</p></h3> <table class="docutils align-default">   <tr>
<td><p><em>Default</em></p></td> <td><p><code>0</code></p></td> </tr> <tr>
<td><p><em>Setter</em></p></td> <td><p>set_physics_interpolation_quality(value)</p></td> </tr> <tr>
<td><p><em>Getter</em></p></td> <td><p>get_physics_interpolation_quality()</p></td> </tr>  </table> <p>Choose whether to use an interpolation method that favors speed or quality.</p> <p>When using low physics tick rates (typically below 20) or high rates of object rotation, you may get better results from the high quality setting.</p> <p><strong>Note:</strong> Fast quality does not equate to low quality. Except in the special cases mentioned above, the quality should be comparable to high quality.</p>  <h3 id="class-multimesh-property-transform-format"><p><a href="#enum-multimesh-transformformat"><span class="std std-ref">TransformFormat</span></a> transform_format</p></h3> <table class="docutils align-default">   <tr>
<td><p><em>Default</em></p></td> <td><p><code>0</code></p></td> </tr> <tr>
<td><p><em>Setter</em></p></td> <td><p>set_transform_format(value)</p></td> </tr> <tr>
<td><p><em>Getter</em></p></td> <td><p>get_transform_format()</p></td> </tr>  </table> <p>Format of transform used to transform mesh, either 2D or 3D.</p>  <h3 id="class-multimesh-property-visible-instance-count"><p><a href="class_int.html#class-int"><span class="std std-ref">int</span></a> visible_instance_count</p></h3> <table class="docutils align-default">   <tr>
<td><p><em>Default</em></p></td> <td><p><code>-1</code></p></td> </tr> <tr>
<td><p><em>Setter</em></p></td> <td><p>set_visible_instance_count(value)</p></td> </tr> <tr>
<td><p><em>Getter</em></p></td> <td><p>get_visible_instance_count()</p></td> </tr>  </table> <p>Limits the number of instances drawn, -1 draws all instances. Changing this does not change the sizes of the buffers.</p> </section> <section id="method-descriptions"> <h2>Method Descriptions</h2> <h3 id="class-multimesh-method-get-aabb"><p><a href="class_aabb.html#class-aabb"><span class="std std-ref">AABB</span></a> get_aabb ( ) <abbr title="This method has no side effects. It doesn't modify any of the instance's member variables.">const</abbr></p></h3> <p>Returns the visibility axis-aligned bounding box in local space. See also <a href="class_visualinstance.html#class-visualinstance-method-get-transformed-aabb"><span class="std std-ref">VisualInstance.get_transformed_aabb</span></a>.</p>  <h3 id="class-multimesh-method-get-instance-color"><p><a href="class_color.html#class-color"><span class="std std-ref">Color</span></a> get_instance_color ( <a href="class_int.html#class-int"><span class="std std-ref">int</span></a> instance ) <abbr title="This method has no side effects. It doesn't modify any of the instance's member variables.">const</abbr></p></h3> <p>Gets a specific instance's color.</p>  <h3 id="class-multimesh-method-get-instance-custom-data"><p><a href="class_color.html#class-color"><span class="std std-ref">Color</span></a> get_instance_custom_data ( <a href="class_int.html#class-int"><span class="std std-ref">int</span></a> instance ) <abbr title="This method has no side effects. It doesn't modify any of the instance's member variables.">const</abbr></p></h3> <p>Returns the custom data that has been set for a specific instance.</p>  <h3 id="class-multimesh-method-get-instance-transform"><p><a href="class_transform.html#class-transform"><span class="std std-ref">Transform</span></a> get_instance_transform ( <a href="class_int.html#class-int"><span class="std std-ref">int</span></a> instance ) <abbr title="This method has no side effects. It doesn't modify any of the instance's member variables.">const</abbr></p></h3> <p>Returns the <a href="class_transform.html#class-transform"><span class="std std-ref">Transform</span></a> of a specific instance.</p>  <h3 id="class-multimesh-method-get-instance-transform-2d"><p><a href="class_transform2d.html#class-transform2d"><span class="std std-ref">Transform2D</span></a> get_instance_transform_2d ( <a href="class_int.html#class-int"><span class="std std-ref">int</span></a> instance ) <abbr title="This method has no side effects. It doesn't modify any of the instance's member variables.">const</abbr></p></h3> <p>Returns the <a href="class_transform2d.html#class-transform2d"><span class="std std-ref">Transform2D</span></a> of a specific instance.</p>  <h3 id="class-multimesh-method-reset-instance-physics-interpolation"><p>void reset_instance_physics_interpolation ( <a href="class_int.html#class-int"><span class="std std-ref">int</span></a> instance )</p></h3> <p>When using <em>physics interpolation</em>, this function allows you to prevent interpolation on an instance in the current physics tick.</p> <p>This allows you to move instances instantaneously, and should usually be used when initially placing an instance such as a bullet to prevent graphical glitches.</p>  <h3 id="class-multimesh-method-set-as-bulk-array"><p>void set_as_bulk_array ( <a href="class_poolrealarray.html#class-poolrealarray"><span class="std std-ref">PoolRealArray</span></a> array )</p></h3> <p>Sets all data related to the instances in one go. This is especially useful when loading the data from disk or preparing the data from GDNative.</p> <p>All data is packed in one large float array. An array may look like this: Transform for instance 1, color data for instance 1, custom data for instance 1, transform for instance 2, color data for instance 2, etc...</p> <p><a href="class_transform.html#class-transform"><span class="std std-ref">Transform</span></a> is stored as 12 floats, <a href="class_transform2d.html#class-transform2d"><span class="std std-ref">Transform2D</span></a> is stored as 8 floats, <code>COLOR_8BIT</code> / <code>CUSTOM_DATA_8BIT</code> is stored as 1 float (4 bytes as is) and <code>COLOR_FLOAT</code> / <code>CUSTOM_DATA_FLOAT</code> is stored as 4 floats.</p>  <h3 id="class-multimesh-method-set-as-bulk-array-interpolated"><p>void set_as_bulk_array_interpolated ( <a href="class_poolrealarray.html#class-poolrealarray"><span class="std std-ref">PoolRealArray</span></a> array_current, <a href="class_poolrealarray.html#class-poolrealarray"><span class="std std-ref">PoolRealArray</span></a> array_previous )</p></h3> <p>An alternative version of <a href="#class-multimesh-method-set-as-bulk-array"><span class="std std-ref">set_as_bulk_array</span></a> which can be used with <em>physics interpolation</em>. This method takes two arrays, and can set the data for the current and previous tick in one go. The renderer will automatically interpolate the data at each frame.</p> <p>This is useful for situations where the order of instances may change from physics tick to tick, such as particle systems.</p> <p>When the order of instances is coherent, the simpler <a href="#class-multimesh-method-set-as-bulk-array"><span class="std std-ref">set_as_bulk_array</span></a> can still be used with interpolation.</p>  <h3 id="class-multimesh-method-set-instance-color"><p>void set_instance_color ( <a href="class_int.html#class-int"><span class="std std-ref">int</span></a> instance, <a href="class_color.html#class-color"><span class="std std-ref">Color</span></a> color )</p></h3> <p>Sets the color of a specific instance by <em>multiplying</em> the mesh's existing vertex colors.</p> <p>For the color to take effect, ensure that <a href="#class-multimesh-property-color-format"><span class="std std-ref">color_format</span></a> is non-<code>null</code> on the <code>MultiMesh</code> and <a href="class_spatialmaterial.html#class-spatialmaterial-property-vertex-color-use-as-albedo"><span class="std std-ref">SpatialMaterial.vertex_color_use_as_albedo</span></a> is <code>true</code> on the material. If the color doesn't look as expected, make sure the material's albedo color is set to pure white (<code>Color(1, 1, 1)</code>).</p>  <h3 id="class-multimesh-method-set-instance-custom-data"><p>void set_instance_custom_data ( <a href="class_int.html#class-int"><span class="std std-ref">int</span></a> instance, <a href="class_color.html#class-color"><span class="std std-ref">Color</span></a> custom_data )</p></h3> <p>Sets custom data for a specific instance. Although <a href="class_color.html#class-color"><span class="std std-ref">Color</span></a> is used, it is just a container for 4 floating point numbers. The format of the number can change depending on the <a href="#enum-multimesh-customdataformat"><span class="std std-ref">CustomDataFormat</span></a> used.</p>  <h3 id="class-multimesh-method-set-instance-transform"><p>void set_instance_transform ( <a href="class_int.html#class-int"><span class="std std-ref">int</span></a> instance, <a href="class_transform.html#class-transform"><span class="std std-ref">Transform</span></a> transform )</p></h3> <p>Sets the <a href="class_transform.html#class-transform"><span class="std std-ref">Transform</span></a> for a specific instance.</p>  <h3 id="class-multimesh-method-set-instance-transform-2d"><p>void set_instance_transform_2d ( <a href="class_int.html#class-int"><span class="std std-ref">int</span></a> instance, <a href="class_transform2d.html#class-transform2d"><span class="std std-ref">Transform2D</span></a> transform )</p></h3> <p>Sets the <a href="class_transform2d.html#class-transform2d"><span class="std std-ref">Transform2D</span></a> for a specific instance.</p> </section><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2014&ndash;2022 Juan Linietsky, Ariel Manzur, Godot Engine contributors<br>Licensed under the MIT License.<br>
    <a href="https://docs.godotengine.org/en/3.5/classes/class_multimesh.html" class="_attribution-link">https://docs.godotengine.org/en/3.5/classes/class_multimesh.html</a>
  </p>
</div>
