<h1 id="doc-first-3d-game-character-animation">Character animation</h1> <p>In this final lesson, we'll use Godot's built-in animation tools to make our characters float and flap. You'll learn to design animations in the editor and use code to make your game feel alive.</p> <p><img alt="image0" src="https://docs.godotengine.org/en/3.5/_images/squash-the-creeps-final.gif"></p> <p>We'll start with an introduction to using the animation editor.</p> <section id="using-the-animation-editor"> <h2>Using the animation editor</h2> <p>The engine comes with tools to author animations in the editor. You can then use the code to play and control them at runtime.</p> <p>Open the player scene, select the player node, and add an <em>AnimationPlayer</em> node.</p> <p>The <em>Animation</em> dock appears in the bottom panel.</p> <p><img alt="image1" src="https://docs.godotengine.org/en/3.5/_images/01.animation_player_dock.png"></p> <p>It features a toolbar and the animation drop-down menu at the top, a track editor in the middle that's currently empty, and filter, snap, and zoom options at the bottom.</p> <p>Let's create an animation. Click on <em>Animation -&gt; New</em>.</p> <p><img alt="image2" src="https://docs.godotengine.org/en/3.5/_images/02.new_animation.png"></p> <p>Name the animation "float".</p> <p><img alt="image3" src="https://docs.godotengine.org/en/3.5/_images/03.float_name.png"></p> <p>Once you created the animation, the timeline appears with numbers representing time in seconds.</p> <p><img alt="image4" src="https://docs.godotengine.org/en/3.5/_images/03.timeline.png"></p> <p>We want the animation to start playback automatically at the start of the game. Also, it should loop.</p> <p>To do so, you can click the button with an "A+" icon in the animation toolbar and the looping arrows, respectively.</p> <p><img alt="image5" src="https://docs.godotengine.org/en/3.5/_images/04.autoplay_and_loop.png"></p> <p>You can also pin the animation editor by clicking the pin icon in the top-right. This prevents it from folding when you click on the viewport and deselect the nodes.</p> <p><img alt="image6" src="https://docs.godotengine.org/en/3.5/_images/05.pin_icon.png"></p> <p>Set the animation duration to <code>1.2</code> seconds in the top-right of the dock.</p> <p><img alt="image7" src="https://docs.godotengine.org/en/3.5/_images/06.animation_duration.png"></p> <p>You should see the gray ribbon widen a bit. It shows you the start and end of your animation and the vertical blue line is your time cursor.</p> <p><img alt="image8" src="https://docs.godotengine.org/en/3.5/_images/07.editable_timeline.png"></p> <p>You can click and drag the slider in the bottom-right to zoom in and out of the timeline.</p> <p><img alt="image9" src="https://docs.godotengine.org/en/3.5/_images/08.zoom_slider.png"></p> </section> <section id="the-float-animation"> <h2>The float animation</h2> <p>With the animation player node, you can animate most properties on as many nodes as you need. Notice the key icon next to properties in the <em>Inspector</em>. You can click any of them to create a keyframe, a time and value pair for the corresponding property. The keyframe gets inserted where your time cursor is in the timeline.</p> <p>Let's insert our first keys. Here, we will animate both the translation and the rotation of the <em>Character</em> node.</p> <p>Select the <em>Character</em> and click the key icon next to <em>Translation</em> in the <em>Inspector</em>. Do the same for <em>Rotation Degrees</em>.</p> <p><img alt="image10" src="https://docs.godotengine.org/en/3.5/_images/09.creating_first_keyframe.png"></p> <p>Two tracks appear in the editor with a diamond icon representing each keyframe.</p> <p><img alt="image11" src="https://docs.godotengine.org/en/3.5/_images/10.initial_keys.png"></p> <p>You can click and drag on the diamonds to move them in time. Move the translation key to <code>0.2</code> seconds and the rotation key to <code>0.1</code> seconds.</p> <p><img alt="image12" src="https://docs.godotengine.org/en/3.5/_images/11.moving_keys.png"></p> <p>Move the time cursor to <code>0.5</code> seconds by clicking and dragging on the gray timeline. In the <em>Inspector</em>, set the <em>Translation</em>'s <em>Y</em> axis to about <code>0.65</code> meters and the <em>Rotation Degrees</em>' <em>X</em> axis to <code>8</code>.</p> <p><img alt="image13" src="https://docs.godotengine.org/en/3.5/_images/12.second_keys_values.png"></p> <p>Create a keyframe for both properties and shift the translation key to <code>0.7</code> seconds by dragging it on the timeline.</p> <p><img alt="image14" src="https://docs.godotengine.org/en/3.5/_images/13.second_keys.png"></p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>A lecture on the principles of animation is beyond the scope of this tutorial. Just note that you don't want to time and space everything evenly. Instead, animators play with timing and spacing, two core animation principles. You want to offset and contrast in your character's motion to make them feel alive.</p> </div> <p>Move the time cursor to the end of the animation, at <code>1.2</code> seconds. Set the Y translation to about <code>0.35</code> and the X rotation to <code>-9</code> degrees. Once again, create a key for both properties.</p> <p>You can preview the result by clicking the play button or pressing <kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">Shift</kbd> + <kbd class="kbd docutils literal notranslate">D</kbd></kbd>. Click the stop button or press <kbd class="kbd docutils literal notranslate">S</kbd> to stop playback.</p> <p><img alt="image15" src="https://docs.godotengine.org/en/3.5/_images/14.play_button.png"></p> <p>You can see that the engine interpolates between your keyframes to produce a continuous animation. At the moment, though, the motion feels very robotic. This is because the default interpolation is linear, causing constant transitions, unlike how living things move in the real world.</p> <p>We can control the transition between keyframes using easing curves.</p> <p>Click and drag around the first two keys in the timeline to box select them.</p> <p><img alt="image16" src="https://docs.godotengine.org/en/3.5/_images/15.box_select.png"></p> <p>You can edit the properties of both keys simultaneously in the <em>Inspector</em>, where you can see an <em>Easing</em> property.</p> <p><img alt="image17" src="https://docs.godotengine.org/en/3.5/_images/16.easing_property.png"></p> <p>Click and drag on the curve, pulling it towards the left. This will make it ease-out, that is to say, transition fast initially and slow down as the time cursor reaches the next keyframe.</p> <p><img alt="image18" src="https://docs.godotengine.org/en/3.5/_images/17.ease_out.png"></p> <p>Play the animation again to see the difference. The first half should already feel a bit bouncier.</p> <p>Apply an ease-out to the second keyframe in the rotation track.</p> <p><img alt="image19" src="https://docs.godotengine.org/en/3.5/_images/18.ease_out_second_rotation_key.png"></p> <p>Do the opposite for the second translation keyframe, dragging it to the right.</p> <p><img alt="image20" src="https://docs.godotengine.org/en/3.5/_images/19.ease_in_second_translation_key.png"></p> <p>Your animation should look something like this.</p> <p><img alt="image21" src="https://docs.godotengine.org/en/3.5/_images/20.float_animation.gif"></p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>Animations update the properties of the animated nodes every frame, overriding initial values. If we directly animated the <em>Player</em> node, it would prevent us from moving it in code. This is where the <em>Pivot</em> node comes in handy: even though we animated the <em>Character</em>, we can still move and rotate the <em>Pivot</em> and layer changes on top of the animation in a script.</p> </div> <p>If you play the game, the player's creature will now float!</p> <p>If the creature is a little too close to the floor, you can move the <em>Pivot</em> up to offset it.</p> <section id="controlling-the-animation-in-code"> <h3>Controlling the animation in code</h3> <p>We can use code to control the animation playback based on the player's input. Let's change the animation speed when the character is moving.</p> <p>Open the <em>Player</em>'s script by clicking the script icon next to it.</p> <p><img alt="image22" src="https://docs.godotengine.org/en/3.5/_images/21.script_icon.png"></p> <p>In <code>_physics_process()</code>, after the line where we check the <code>direction</code> vector, add the following code.</p> <div class="sphinx-tabs docutils container"> <div aria-label="Tabbed content" class="closeable" role="tablist">
<button aria-controls="panel-0-R0RTY3JpcHQ=" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-0-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tab" tabindex="0">GDScript</button><button aria-controls="panel-0-QyM=" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-0-QyM=" name="QyM=" role="tab" tabindex="-1">C#</button>
</div>
<div aria-labelledby="tab-0-R0RTY3JpcHQ=" class="sphinx-tabs-panel code-tab group-tab" id="panel-0-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tabpanel" tabindex="0">
<pre data-language="gdscript">func _physics_process(delta):
    #...
    #if direction != Vector3.ZERO:
        #...
        $AnimationPlayer.playback_speed = 4
    else:
        $AnimationPlayer.playback_speed = 1
</pre> </div>
<div aria-labelledby="tab-0-QyM=" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-0-QyM=" name="QyM=" role="tabpanel" tabindex="0">
<pre data-language="csharp">public override void _PhysicsProcess(float delta)
{
    // ...
    if (direction != Vector3.Zero)
    {
        // ...
        GetNode&lt;AnimationPlayer&gt;("AnimationPlayer").PlaybackSpeed = 4;
    }
    else
    {
        GetNode&lt;AnimationPlayer&gt;("AnimationPlayer").PlaybackSpeed = 1;
    }
}
</pre> </div>
</div> <p>This code makes it so when the player moves, we multiply the playback speed by <code>4</code>. When they stop, we reset it to normal.</p> <p>We mentioned that the pivot could layer transforms on top of the animation. We can make the character arc when jumping using the following line of code. Add it at the end of <code>_physics_process()</code>.</p> <div class="sphinx-tabs docutils container"> <div aria-label="Tabbed content" class="closeable" role="tablist">
<button aria-controls="panel-1-R0RTY3JpcHQ=" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-1-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tab" tabindex="0">GDScript</button><button aria-controls="panel-1-QyM=" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-1-QyM=" name="QyM=" role="tab" tabindex="-1">C#</button>
</div>
<div aria-labelledby="tab-1-R0RTY3JpcHQ=" class="sphinx-tabs-panel code-tab group-tab" id="panel-1-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tabpanel" tabindex="0">
<pre data-language="gdscript">func _physics_process(delta):
    #...
    $Pivot.rotation.x = PI / 6 * velocity.y / jump_impulse
</pre> </div>
<div aria-labelledby="tab-1-QyM=" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-1-QyM=" name="QyM=" role="tabpanel" tabindex="0">
<pre data-language="csharp">public override void _PhysicsProcess(float delta)
{
    // ...
    var pivot = GetNode&lt;Spatial&gt;("Pivot");
    pivot.Rotation = new Vector3(Mathf.Pi / 6f * _velocity.y / JumpImpulse, pivot.Rotation.y, pivot.Rotation.z);
}
</pre> </div>
</div> </section> </section> <section id="animating-the-mobs"> <h2>Animating the mobs</h2> <p>Here's another nice trick with animations in Godot: as long as you use a similar node structure, you can copy them to different scenes.</p> <p>For example, both the <em>Mob</em> and the <em>Player</em> scenes have a <em>Pivot</em> and a <em>Character</em> node, so we can reuse animations between them.</p> <p>Open the <em>Player</em> scene, select the animation player node and open the "float" animation. Next, click on <strong>Animation &gt; Copy</strong>. Then open <code>Mob.tscn</code> and open its animation player. Click <strong>Animation &gt; Paste</strong>. That's it; all monsters will now play the float animation.</p> <p>We can change the playback speed based on the creature's <code>random_speed</code>. Open the <em>Mob</em>'s script and at the end of the <code>initialize()</code> function, add the following line.</p> <div class="sphinx-tabs docutils container"> <div aria-label="Tabbed content" class="closeable" role="tablist">
<button aria-controls="panel-2-R0RTY3JpcHQ=" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-2-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tab" tabindex="0">GDScript</button><button aria-controls="panel-2-QyM=" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-2-QyM=" name="QyM=" role="tab" tabindex="-1">C#</button>
</div>
<div aria-labelledby="tab-2-R0RTY3JpcHQ=" class="sphinx-tabs-panel code-tab group-tab" id="panel-2-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tabpanel" tabindex="0">
<pre data-language="gdscript">func initialize(start_position, player_position):
    #...
    $AnimationPlayer.playback_speed = random_speed / min_speed
</pre> </div>
<div aria-labelledby="tab-2-QyM=" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-2-QyM=" name="QyM=" role="tabpanel" tabindex="0">
<pre data-language="csharp">public void Initialize(Vector3 startPosition, Vector3 playerPosition)
{
    // ...
    GetNode&lt;AnimationPlayer&gt;("AnimationPlayer").PlaybackSpeed = randomSpeed / MinSpeed;
}
</pre> </div>
</div> <p>And with that, you finished coding your first complete 3D game.</p> <p><strong>Congratulations</strong>!</p> <p>In the next part, we'll quickly recap what you learned and give you some links to keep learning more. But for now, here are the complete <code>Player.gd</code> and <code>Mob.gd</code> so you can check your code against them.</p> <p>Here's the <em>Player</em> script.</p> <div class="sphinx-tabs docutils container"> <div aria-label="Tabbed content" class="closeable" role="tablist">
<button aria-controls="panel-3-R0RTY3JpcHQ=" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-3-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tab" tabindex="0">GDScript</button><button aria-controls="panel-3-QyM=" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-3-QyM=" name="QyM=" role="tab" tabindex="-1">C#</button>
</div>
<div aria-labelledby="tab-3-R0RTY3JpcHQ=" class="sphinx-tabs-panel code-tab group-tab" id="panel-3-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tabpanel" tabindex="0">
<pre data-language="gdscript">extends KinematicBody

# Emitted when the player was hit by a mob.
signal hit

# How fast the player moves in meters per second.
export var speed = 14
# The downward acceleration when in the air, in meters per second per second.
export var fall_acceleration = 75
# Vertical impulse applied to the character upon jumping in meters per second.
export var jump_impulse = 20
# Vertical impulse applied to the character upon bouncing over a mob in meters per second.
export var bounce_impulse = 16

var velocity = Vector3.ZERO


func _physics_process(delta):
    var direction = Vector3.ZERO

    if Input.is_action_pressed("move_right"):
        direction.x += 1
    if Input.is_action_pressed("move_left"):
        direction.x -= 1
    if Input.is_action_pressed("move_back"):
        direction.z += 1
    if Input.is_action_pressed("move_forward"):
        direction.z -= 1

    if direction != Vector3.ZERO:
        direction = direction.normalized()
        $Pivot.look_at(translation + direction, Vector3.UP)
        $AnimationPlayer.playback_speed = 4
    else:
        $AnimationPlayer.playback_speed = 1

    velocity.x = direction.x * speed
    velocity.z = direction.z * speed

    # Jumping
    if is_on_floor() and Input.is_action_just_pressed("jump"):
        velocity.y += jump_impulse

    velocity.y -= fall_acceleration * delta
    velocity = move_and_slide(velocity, Vector3.UP)

    for index in range(get_slide_count()):
        var collision = get_slide_collision(index)
        if collision.collider.is_in_group("mob"):
            var mob = collision.collider
            if Vector3.UP.dot(collision.normal) &gt; 0.1:
                mob.squash()
                velocity.y = bounce_impulse

    $Pivot.rotation.x = PI / 6 * velocity.y / jump_impulse


func die():
    emit_signal("hit")
    queue_free()


func _on_MobDetector_body_entered(_body):
    die()
</pre> </div>
<div aria-labelledby="tab-3-QyM=" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-3-QyM=" name="QyM=" role="tabpanel" tabindex="0">
<pre data-language="csharp">public class Player : KinematicBody
{
    // Emitted when the player was hit by a mob.
    [Signal]
    public delegate void Hit();

    // How fast the player moves in meters per second.
    [Export]
    public int Speed = 14;
    // The downward acceleration when in the air, in meters per second squared.
    [Export]
    public int FallAcceleration = 75;
    // Vertical impulse applied to the character upon jumping in meters per second.
    [Export]
    public int JumpImpulse = 20;
    // Vertical impulse applied to the character upon bouncing over a mob in meters per second.
    [Export]
    public int BounceImpulse = 16;

    private Vector3 _velocity = Vector3.Zero;

    public override void _PhysicsProcess(float delta)
    {
        var direction = Vector3.Zero;

        if (Input.IsActionPressed("move_right"))
        {
            direction.x += 1f;
        }
        if (Input.IsActionPressed("move_left"))
        {
            direction.x -= 1f;
        }
        if (Input.IsActionPressed("move_back"))
        {
            direction.z += 1f;
        }
        if (Input.IsActionPressed("move_forward"))
        {
            direction.z -= 1f;
        }

        if (direction != Vector3.Zero)
        {
            direction = direction.Normalized();
            GetNode&lt;Spatial&gt;("Pivot").LookAt(Translation + direction, Vector3.Up);
            GetNode&lt;AnimationPlayer&gt;("AnimationPlayer").PlaybackSpeed = 4;
        }
        else
        {
            GetNode&lt;AnimationPlayer&gt;("AnimationPlayer").PlaybackSpeed = 1;
        }

        _velocity.x = direction.x * Speed;
        _velocity.z = direction.z * Speed;

        // Jumping.
        if (IsOnFloor() &amp;&amp; Input.IsActionJustPressed("jump"))
        {
            _velocity.y += JumpImpulse;
        }

        _velocity.y -= FallAcceleration * delta;
        _velocity = MoveAndSlide(_velocity, Vector3.Up);

        for (int index = 0; index &lt; GetSlideCount(); index++)
        {
            KinematicCollision collision = GetSlideCollision(index);
            if (collision.Collider is Mob mob &amp;&amp; mob.IsInGroup("mob"))
            {
                if (Vector3.Up.Dot(collision.Normal) &gt; 0.1f)
                {
                    mob.Squash();
                    _velocity.y = BounceImpulse;
                }
            }
        }

        var pivot = GetNode&lt;Spatial&gt;("Pivot");
        pivot.Rotation = new Vector3(Mathf.Pi / 6f * _velocity.y / JumpImpulse, pivot.Rotation.y, pivot.Rotation.z);
    }

    private void Die()
    {
        EmitSignal(nameof(Hit));
        QueueFree();
    }

    public void OnMobDetectorBodyEntered(Node body)
    {
        Die();
    }
}
</pre> </div>
</div> <p>And the <em>Mob</em>'s script.</p> <div class="sphinx-tabs docutils container"> <div aria-label="Tabbed content" class="closeable" role="tablist">
<button aria-controls="panel-4-R0RTY3JpcHQ=" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-4-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tab" tabindex="0">GDScript</button><button aria-controls="panel-4-QyM=" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-4-QyM=" name="QyM=" role="tab" tabindex="-1">C#</button>
</div>
<div aria-labelledby="tab-4-R0RTY3JpcHQ=" class="sphinx-tabs-panel code-tab group-tab" id="panel-4-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tabpanel" tabindex="0">
<pre data-language="gdscript">extends KinematicBody

# Emitted when the player jumped on the mob.
signal squashed

# Minimum speed of the mob in meters per second.
export var min_speed = 10
# Maximum speed of the mob in meters per second.
export var max_speed = 18

var velocity = Vector3.ZERO


func _physics_process(_delta):
    move_and_slide(velocity)


func initialize(start_position, player_position):
    look_at_from_position(start_position, player_position, Vector3.UP)
    rotate_y(rand_range(-PI / 4, PI / 4))

    var random_speed = rand_range(min_speed, max_speed)
    velocity = Vector3.FORWARD * random_speed
    velocity = velocity.rotated(Vector3.UP, rotation.y)

    $AnimationPlayer.playback_speed = random_speed / min_speed


 func squash():
    emit_signal("squashed")
    queue_free()


func _on_VisibilityNotifier_screen_exited():
    queue_free()
</pre> </div>
<div aria-labelledby="tab-4-QyM=" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-4-QyM=" name="QyM=" role="tabpanel" tabindex="0">
<pre data-language="csharp">public class Mob : KinematicBody
{
    // Emitted when the played jumped on the mob.
    [Signal]
    public delegate void Squashed();

    // Minimum speed of the mob in meters per second
    [Export]
    public int MinSpeed = 10;
    // Maximum speed of the mob in meters per second
    [Export]
    public int MaxSpeed = 18;

    private Vector3 _velocity = Vector3.Zero;

    public override void _PhysicsProcess(float delta)
    {
        MoveAndSlide(_velocity);
    }

    public void Initialize(Vector3 startPosition, Vector3 playerPosition)
    {
        LookAtFromPosition(startPosition, playerPosition, Vector3.Up);
        RotateY((float)GD.RandRange(-Mathf.Pi / 4.0, Mathf.Pi / 4.0));

        float randomSpeed = (float)GD.RandRange(MinSpeed, MaxSpeed);
        _velocity = Vector3.Forward * randomSpeed;
        _velocity = _velocity.Rotated(Vector3.Up, Rotation.y);

        GetNode&lt;AnimationPlayer&gt;("AnimationPlayer").PlaybackSpeed = randomSpeed / MinSpeed;
    }

    public void Squash()
    {
        EmitSignal(nameof(Squashed));
        QueueFree();
    }

    public void OnVisibilityNotifierScreenExited()
    {
        QueueFree();
    }
}
</pre> </div>
</div> </section><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2014&ndash;2022 Juan Linietsky, Ariel Manzur and the Godot community<br>Licensed under the Creative Commons Attribution Unported License v3.0.<br>
    <a href="https://docs.godotengine.org/en/3.5/getting_started/first_3d_game/09.adding_animations.html" class="_attribution-link">https://docs.godotengine.org/en/3.5/getting_started/first_3d_game/09.adding_animations.html</a>
  </p>
</div>
