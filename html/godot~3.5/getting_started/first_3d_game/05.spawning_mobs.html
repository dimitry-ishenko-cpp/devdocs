<h1 id="doc-first-3d-game-spawning-monsters">Spawning monsters</h1> <p>In this part, we're going to spawn monsters along a path randomly. By the end, you will have monsters roaming the game board.</p> <p><img alt="image0" src="https://docs.godotengine.org/en/3.5/_images/01.monsters_path_preview.png"></p> <p>Double-click on <code>Main.tscn</code> in the <em>FileSystem</em> dock to open the <em>Main</em> scene.</p> <p>Before drawing the path, we're going to change the game resolution. Our game has a default window size of <code>1024x600</code>. We're going to set it to <code>720x540</code>, a nice little box.</p> <p>Go to <em>Project -&gt; Project Settings</em>.</p> <p><img alt="image1" src="https://docs.godotengine.org/en/3.5/_images/02.project_settings.png"></p> <p>In the left menu, navigate down to <em>Display -&gt; Window</em>. On the right, set the <em>Width</em> to <code>720</code> and the <em>Height</em> to <code>540</code>.</p> <p><img alt="image2" src="https://docs.godotengine.org/en/3.5/_images/03.window_settings.png"></p> <section id="creating-the-spawn-path"> <h2>Creating the spawn path</h2> <p>Like you did in the 2D game tutorial, you're going to design a path and use a <em>PathFollow</em> node to sample random locations on it.</p> <p>In 3D though, it's a bit more complicated to draw the path. We want it to be around the game view so monsters appear right outside the screen. But if we draw a path, we won't see it from the camera preview.</p> <p>To find the view's limits, we can use some placeholder meshes. Your viewport should still be split into two parts, with the camera preview at the bottom. If that isn't the case, press <kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">Ctrl</kbd> + <kbd class="kbd docutils literal notranslate">2</kbd></kbd> (<kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">Cmd</kbd> + <kbd class="kbd docutils literal notranslate">2</kbd></kbd> on macOS) to split the view into two. Select the <em>Camera</em> node and click the <em>Preview</em> checkbox in the bottom viewport.</p> <p><img alt="image3" src="https://docs.godotengine.org/en/3.5/_images/04.camera_preview.png"></p> <section id="adding-placeholder-cylinders"> <h3>Adding placeholder cylinders</h3> <p>Let's add the placeholder meshes. Add a new <em>Spatial</em> node as a child of the <em>Main</em> node and name it <em>Cylinders</em>. We'll use it to group the cylinders. As a child of it, add a <em>MeshInstance</em> node.</p> <p><img alt="image4" src="https://docs.godotengine.org/en/3.5/_images/05.cylinders_node.png"></p> <p>In the <em>Inspector</em>, assign a <em>CylinderMesh</em> to the <em>Mesh</em> property.</p> <p><img alt="image5" src="https://docs.godotengine.org/en/3.5/_images/06.cylinder_mesh.png"></p> <p>Set the top viewport to the top orthogonal view using the menu in the viewport's top-left corner. Alternatively, you can press the keypad's 7 key.</p> <p><img alt="image6" src="https://docs.godotengine.org/en/3.5/_images/07.top_view.png"></p> <p>The grid is a bit distracting for me. You can toggle it by going to the <em>View</em> menu in the toolbar and clicking <em>View Grid</em>.</p> <p><img alt="image7" src="https://docs.godotengine.org/en/3.5/_images/08.toggle_view_grid.png"></p> <p>You now want to move the cylinder along the ground plane, looking at the camera preview in the bottom viewport. I recommend using grid snap to do so. You can toggle it by clicking the magnet icon in the toolbar or pressing Y.</p> <p><img alt="image8" src="https://docs.godotengine.org/en/3.5/_images/09.toggle_grid_snap.png"></p> <p>Place the cylinder so it's right outside the camera's view in the top-left corner.</p> <p><img alt="image9" src="https://docs.godotengine.org/en/3.5/_images/10.place_first_cylinder.png"></p> <p>We're going to create copies of the mesh and place them around the game area. Press <kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">Ctrl</kbd> + <kbd class="kbd docutils literal notranslate">D</kbd></kbd> (<kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">Cmd</kbd> + <kbd class="kbd docutils literal notranslate">D</kbd></kbd> on macOS) to duplicate the node. You can also right-click the node in the <em>Scene</em> dock and select <em>Duplicate</em>. Move the copy down along the blue Z axis until it's right outside the camera's preview.</p> <p>Select both cylinders by pressing the <kbd class="kbd docutils literal notranslate">Shift</kbd> key and clicking on the unselected one and duplicate them.</p> <p><img alt="image10" src="https://docs.godotengine.org/en/3.5/_images/11.both_cylinders_selected.png"></p> <p>Move them to the right by dragging the red X axis.</p> <p><img alt="image11" src="https://docs.godotengine.org/en/3.5/_images/12.four_cylinders.png"></p> <p>They're a bit hard to see in white, aren't they? Let's make them stand out by giving them a new material.</p> <p>In 3D, materials define a surface's visual properties like its color, how it reflects light, and more. We can use them to change the color of a mesh.</p> <p>We can update all four cylinders at once. Select all the mesh instances in the <em>Scene</em> dock. To do so, you can click on the first one and Shift click on the last one.</p> <p><img alt="image12" src="https://docs.godotengine.org/en/3.5/_images/13.selecting_all_cylinders.png"></p> <p>In the <em>Inspector</em>, expand the <em>Material</em> section and assign a <em>SpatialMaterial</em> to slot <em>0</em>.</p> <p><img alt="image13" src="https://docs.godotengine.org/en/3.5/_images/14.spatial_material.png"></p> <p>Click the sphere icon to open the material resource. You get a preview of the material and a long list of sections filled with properties. You can use these to create all sorts of surfaces, from metal to rock or water.</p> <p>Expand the <em>Albedo</em> section and set the color to something that contrasts with the background, like a bright orange.</p> <p><img alt="image14" src="https://docs.godotengine.org/en/3.5/_images/15.bright-cylinders.png"></p> <p>We can now use the cylinders as guides. Fold them in the <em>Scene</em> dock by clicking the grey arrow next to them. Moving forward, you can also toggle their visibility by clicking the eye icon next to <em>Cylinders</em>.</p> <p><img alt="image15" src="https://docs.godotengine.org/en/3.5/_images/16.cylinders_fold.png"></p> <p>Add a <em>Path</em> node as a child of <em>Main</em>. In the toolbar, four icons appear. Click the <em>Add Point</em> tool, the icon with the green "+" sign.</p> <p><img alt="image16" src="https://docs.godotengine.org/en/3.5/_images/17.points_options.png"></p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>You can hover any icon to see a tooltip describing the tool.</p> </div> <p>Click in the center of each cylinder to create a point. Then, click the <em>Close Curve</em> icon in the toolbar to close the path. If any point is a bit off, you can click and drag on it to reposition it.</p> <p><img alt="image17" src="https://docs.godotengine.org/en/3.5/_images/18.close_path.png"></p> <p>Your path should look like this.</p> <p><img alt="image18" src="https://docs.godotengine.org/en/3.5/_images/19.path_result.png"></p> <p>To sample random positions on it, we need a <em>PathFollow</em> node. Add a <em>PathFollow</em> as a child of the <em>Path</em>. Rename the two nodes to <em>SpawnPath</em> and <em>SpawnLocation</em>, respectively. It's more descriptive of what we'll use them for.</p> <p><img alt="image19" src="https://docs.godotengine.org/en/3.5/_images/20.spawn_nodes.png"></p> <p>With that, we're ready to code the spawn mechanism.</p> </section> </section> <section id="spawning-monsters-randomly"> <h2>Spawning monsters randomly</h2> <p>Right-click on the <em>Main</em> node and attach a new script to it.</p> <p>We first export a variable to the <em>Inspector</em> so that we can assign <code>Mob.tscn</code> or any other monster to it.</p> <p>Then, as we're going to spawn the monsters procedurally, we want to randomize numbers every time we play the game. If we don't do that, the monsters will always spawn following the same sequence.</p> <div class="sphinx-tabs docutils container"> <div aria-label="Tabbed content" class="closeable" role="tablist">
<button aria-controls="panel-0-R0RTY3JpcHQ=" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-0-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tab" tabindex="0">GDScript</button><button aria-controls="panel-0-QyM=" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-0-QyM=" name="QyM=" role="tab" tabindex="-1">C#</button>
</div>
<div aria-labelledby="tab-0-R0RTY3JpcHQ=" class="sphinx-tabs-panel code-tab group-tab" id="panel-0-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tabpanel" tabindex="0">
<pre data-language="gdscript">extends Node

export (PackedScene) var mob_scene


func _ready():
    randomize()
</pre> </div>
<div aria-labelledby="tab-0-QyM=" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-0-QyM=" name="QyM=" role="tabpanel" tabindex="0">
<pre data-language="csharp">public class Main : Node
{
    // Don't forget to rebuild the project so the editor knows about the new export variable.

#pragma warning disable 649
    // We assign this in the editor, so we don't need the warning about not being assigned.
    [Export]
    public PackedScene MobScene;
#pragma warning restore 649

    public override void _Ready()
    {
        GD.Randomize();
    }
}
</pre> </div>
</div> <p>We want to spawn mobs at regular time intervals. To do this, we need to go back to the scene and add a timer. Before that, though, we need to assign the <code>Mob.tscn</code> file to the <code>mob_scene</code> property.</p> <p>Head back to the 3D screen and select the <em>Main</em> node. Drag <code>Mob.tscn</code> from the <em>FileSystem</em> dock to the <em>Mob Scene</em> slot in the <em>Inspector</em>.</p> <p><img alt="image20" src="https://docs.godotengine.org/en/3.5/_images/20.mob_scene_property.png"></p> <p>Add a new <em>Timer</em> node as a child of <em>Main</em>. Name it <em>MobTimer</em>.</p> <p><img alt="image21" src="https://docs.godotengine.org/en/3.5/_images/21.mob_timer.png"></p> <p>In the <em>Inspector</em>, set its <em>Wait Time</em> to <code>0.5</code> seconds and turn on <em>Autostart</em> so it automatically starts when we run the game.</p> <p><img alt="image22" src="https://docs.godotengine.org/en/3.5/_images/22.mob_timer_properties.png"></p> <p>Timers emit a <code>timeout</code> signal every time they reach the end of their <em>Wait Time</em>. By default, they restart automatically, emitting the signal in a cycle. We can connect to this signal from the <em>Main</em> node to spawn monsters every <code>0.5</code> seconds.</p> <p>With the <em>MobTimer</em> still selected, head to the <em>Node</em> dock on the right and double-click the <code>timeout</code> signal.</p> <p><img alt="image23" src="https://docs.godotengine.org/en/3.5/_images/23.timeout_signal.png"></p> <p>Connect it to the <em>Main</em> node.</p> <p><img alt="image24" src="https://docs.godotengine.org/en/3.5/_images/24.connect_timer_to_main.png"></p> <p>This will take you back to the script, with a new empty <code>_on_MobTimer_timeout()</code> function.</p> <p>Let's code the mob spawning logic. We're going to:</p> <ol class="arabic simple"> <li>Instantiate the mob scene.</li> <li>Sample a random position on the spawn path.</li> <li>Get the player's position.</li> <li>Call the mob's <code>initialize()</code> method, passing it the random position and the player's position.</li> <li>Add the mob as a child of the <em>Main</em> node.</li> </ol> <div class="sphinx-tabs docutils container"> <div aria-label="Tabbed content" class="closeable" role="tablist">
<button aria-controls="panel-1-R0RTY3JpcHQ=" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-1-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tab" tabindex="0">GDScript</button><button aria-controls="panel-1-QyM=" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-1-QyM=" name="QyM=" role="tab" tabindex="-1">C#</button>
</div>
<div aria-labelledby="tab-1-R0RTY3JpcHQ=" class="sphinx-tabs-panel code-tab group-tab" id="panel-1-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tabpanel" tabindex="0">
<pre data-language="gdscript">func _on_MobTimer_timeout():
    # Create a new instance of the Mob scene.
    var mob = mob_scene.instance()

    # Choose a random location on the SpawnPath.
    # We store the reference to the SpawnLocation node.
    var mob_spawn_location = get_node("SpawnPath/SpawnLocation")
    # And give it a random offset.
    mob_spawn_location.unit_offset = randf()

    var player_position = $Player.transform.origin
    mob.initialize(mob_spawn_location.translation, player_position)

    add_child(mob)
</pre> </div>
<div aria-labelledby="tab-1-QyM=" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-1-QyM=" name="QyM=" role="tabpanel" tabindex="0">
<pre data-language="csharp">// We also specified this function name in PascalCase in the editor's connection window
public void OnMobTimerTimeout()
{
    // Create a new instance of the Mob scene.
    Mob mob = (Mob)MobScene.Instance();

    // Choose a random location on the SpawnPath.
    // We store the reference to the SpawnLocation node.
    var mobSpawnLocation = GetNode&lt;PathFollow&gt;("SpawnPath/SpawnLocation");
    // And give it a random offset.
    mobSpawnLocation.UnitOffset = GD.Randf();

    Vector3 playerPosition = GetNode&lt;Player&gt;("Player").Transform.origin;
    mob.Initialize(mobSpawnLocation.Translation, playerPosition);

    AddChild(mob);

}
</pre> </div>
</div> <p>Above, <code>randf()</code> produces a random value between <code>0</code> and <code>1</code>, which is what the <em>PathFollow</em> node's <code>unit_offset</code> expects.</p> <p>Here is the complete <code>Main.gd</code> script so far, for reference.</p> <div class="sphinx-tabs docutils container"> <div aria-label="Tabbed content" class="closeable" role="tablist">
<button aria-controls="panel-2-R0RTY3JpcHQ=" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-2-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tab" tabindex="0">GDScript</button><button aria-controls="panel-2-QyM=" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-2-QyM=" name="QyM=" role="tab" tabindex="-1">C#</button>
</div>
<div aria-labelledby="tab-2-R0RTY3JpcHQ=" class="sphinx-tabs-panel code-tab group-tab" id="panel-2-R0RTY3JpcHQ=" name="R0RTY3JpcHQ=" role="tabpanel" tabindex="0">
<pre data-language="gdscript">extends Node

export (PackedScene) var mob_scene


func _ready():
    randomize()


func _on_MobTimer_timeout():
    var mob = mob_scene.instance()

    var mob_spawn_location = get_node("SpawnPath/SpawnLocation")
    mob_spawn_location.unit_offset = randf()
    var player_position = $Player.transform.origin
    mob.initialize(mob_spawn_location.translation, player_position)

    add_child(mob)
</pre> </div>
<div aria-labelledby="tab-2-QyM=" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-2-QyM=" name="QyM=" role="tabpanel" tabindex="0">
<pre data-language="csharp">public class Main : Node
{
#pragma warning disable 649
    [Export]
    public PackedScene MobScene;
#pragma warning restore 649

    public override void _Ready()
    {
        GD.Randomize();
    }

    public void OnMobTimerTimeout()
    {
        Mob mob = (Mob)MobScene.Instance();

        var mobSpawnLocation = GetNode&lt;PathFollow&gt;("SpawnPath/SpawnLocation");
        mobSpawnLocation.UnitOffset = GD.Randf();

        Vector3 playerPosition = GetNode&lt;Player&gt;("Player").Transform.origin;
        mob.Initialize(mobSpawnLocation.Translation, playerPosition);

        AddChild(mob);
    }
}
</pre> </div>
</div> <p>You can test the scene by pressing <kbd class="kbd docutils literal notranslate">F6</kbd>. You should see the monsters spawn and move in a straight line.</p> <p><img alt="image25" src="https://docs.godotengine.org/en/3.5/_images/25.spawn_result.png"></p> <p>For now, they bump and slide against one another when their paths cross. We'll address this in the next part.</p> </section><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2014&ndash;2022 Juan Linietsky, Ariel Manzur and the Godot community<br>Licensed under the Creative Commons Attribution Unported License v3.0.<br>
    <a href="https://docs.godotengine.org/en/3.5/getting_started/first_3d_game/05.spawning_mobs.html" class="_attribution-link">https://docs.godotengine.org/en/3.5/getting_started/first_3d_game/05.spawning_mobs.html</a>
  </p>
</div>
