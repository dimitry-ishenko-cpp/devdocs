<div id="col-content" data-swiftype-index="true"> <div id="azure_virtual_machine_data_disk-resource"><h1>azure_virtual_machine_data_disk resource</h1></div>  <div class="prose"> <p data-swiftype-index="false"> <a href="https://github.com/inspec/inspec/tree/main/docs-chef-io/content/inspec/resources/azure_virtual_machine_data_disk.md" alt="Link to page on GitHub repository">[edit on GitHub]</a> </p> <p>Use this resource to ensure that a specific data disk attached to a machine has been created properly.</p> <h2 id="availability">Availability</h2> <h3 id="installation">Installation</h3> <p>This resource is distributed along with Chef InSpec itself. You can use it automatically.</p> <h3 id="version">Version</h3> <p>This resource first became available in v2.0.16 of InSpec.</p> <h2 id="syntax">Syntax</h2> <p>The name of the resource group and machine are required to use this resource.</p> <pre class="highlight" data-language="ruby"><code>describe azure_virtual_machine_data_disk(group_name: 'InSpec-Azure', name: 'MyVM') do
  its('property') { should eq 'value' }
end
</code></pre> <p>where:</p> <ul> <li>
<code>MyVm</code> is the name of the virtual machine as seen in Azure. (It is <strong>not</strong> the hostname of the machine)</li> <li>
<code>InSpec-Azure</code> is the name of the resource group that the machine is in.</li> <li>
<code>property</code> is a resource property</li> <li>
<code>value</code> is the expected output from the matcher</li> </ul> <h2 id="examples">Examples</h2> <p>The following examples show to use this Chef InSpec audit resource.</p> <h3 id="check-that-the-first-data-disk-is-of-the-correct-size">Check that the first data disk is of the correct size</h3> <pre class="highlight" data-language="ruby"><code>describe azure_virtual_machine_data_disk(group_name: 'InSpec-Azure', name: 'Linux-Internal-VM').where(number: 1) do
  its('size') { should cmp &gt;= 15 }
end
</code></pre> <h2 id="resource-parameters">Resource Parameters</h2> <ul> <li><code>group_name</code></li> <li><code>name</code></li> <li><code>apiversion</code></li> </ul> <h2 id="parameter-examples">Parameter Examples</h2> <p>The options that can be passed to the resource are as follows.</p> <h3 id="group_name-required">
<code>group_name</code> (required)</h3> <p>Use this parameter to define the Azure Resource Group to be tested.</p> <pre class="highlight" data-language="ruby"><code>describe azure_virtual_machine_data_disk(group_name: 'InSpec-Azure') do
    ...
end
</code></pre> <h3 id="name">name</h3> <p>Use this parameter to define the name of the Azure resource to test.</p> <pre class="highlight" data-language="ruby"><code>describe azure_virtual_machine_data_disk(group_name: 'InSpec-Azure', name: 'Windows-Internal-VM') do
    ...
end
</code></pre> <h3 id="apiversion">apiversion</h3> <p>The API Version to use when querying the resource. Defaults to the latest version for the resource.</p> <pre class="highlight" data-language="ruby"><code>describe azure_virtual_machine_data_disk(group_name: 'InSpec-Azure', name: 'Windows-Internal-VM', apiversion: '2.0') do
    ...
end
</code></pre> <p>These options can also be set using the environment variables:</p> <ul> <li><code>AZURE_RESOURCE_GROUP_NAME</code></li> <li><code>AZURE_RESOURCE_NAME</code></li> <li><code>AZURE_RESOURCE_API_VERSION</code></li> </ul> <p>When the options have been set as well as the environment variables, the environment variables take priority.</p> <h2 id="filter-criteria">Filter Criteria</h2> <ul> <li><code>number</code></li> <li><code>disk</code></li> </ul> <h2 id="filter-examples">Filter Examples</h2> <h3 id="disk">disk</h3> <p>The zero based index of the disk attached to the machine.</p> <pre class="highlight" data-language="ruby"><code>describe azure_virtual_machine_data_disk(group_name: 'InSpec-Azure', name: 'Windows-Internal-VM').where(disk: 0)
end
</code></pre> <h3 id="number">number</h3> <p>The ‘1’ based index of the disk attached to the machine.</p> <pre class="highlight" data-language="ruby"><code>describe azure_virtual_machine_data_disk(group_name: 'InSpec-Azure', name: 'Windows-Internal-VM').where(number: 1)
end
</code></pre> <h2 id="properties">Properties</h2> <ul> <li>
<code>count</code>, <code>disk</code>, <code>number</code>, <code>name</code>, <code>size</code>, <code>lun</code>, <code>caching</code>, <code>create_option</code>, <code>is_managed_disk?</code>, <code>vhd_uri</code>, <code>storage_account_name</code>, <code>storage_account_type</code>, <code>id</code>, <code>subscription_id</code>, <code>resource_group</code>
</li> </ul> <h2 id="property-examples">Property Examples</h2> <h3 id="count">count</h3> <p>Returns the number of data disks attached to the machine</p> <pre class="highlight" data-language="ruby"><code>its('count') { should eq 1 }
</code></pre> <h3 id="name-1">name</h3> <p>Returns a string of the name of the disk.</p> <pre class="highlight" data-language="ruby"><code>its('name') { should cmp 'linux-external-datadisk-1' }
</code></pre> <h3 id="size">size</h3> <p>Returns an integer of size of this disk in GB.</p> <pre class="highlight" data-language="ruby"><code>its('size') { should cmp &gt;= 15 }
</code></pre> <h3 id="lun">lun</h3> <p>The disk number as reported by Azure. Has a zero-based index value.</p> <pre class="highlight" data-language="ruby"><code>its('lun') { should cmp 0 }
</code></pre> <h3 id="caching">caching</h3> <p>String stating the caching that has been set on the disk.</p> <pre class="highlight" data-language="ruby"><code>its('caching') { should cmp 'none' }
</code></pre> <h3 id="create_option">create_option</h3> <p>How the disk was created. Typically for data disks, this will be the string value ‘Empty’.</p> <pre class="highlight" data-language="ruby"><code>its('create_option') { should cmp 'Empty' }
</code></pre> <h3 id="is_managed_disk">is_managed_disk?</h3> <p>Boolean stating if the disk is a managed disk or not. If it is not a managed disk then it is one that is stored in a Storage Account.</p> <pre class="highlight" data-language="ruby"><code>its('is_managed_disk?') { should cmp 'false' }
</code></pre> <h3 id="vhd_uri">vhd_uri</h3> <p>If this is <em>not</em> a managed disk, then the <code>vhd_uri</code> will be the full URI to the disk in the storage account.</p> <pre class="highlight" data-language="ruby"><code>its('vhd_uri') { should cmp 'https://primary_storage.blob.core.windows.net/container_name/vm_name.vhd' }
</code></pre> <h3 id="storage_account_name">storage_account_name</h3> <p>If this is <em>not</em> a managed disk this will be the storage account name in which the disk is stored.</p> <p>This derived from the <code>vhd_uri</code>.</p> <pre class="highlight" data-language="ruby"><code>its('storage_account_name') { should cmp 'primary_storage' }
</code></pre> <h3 id="storage_account_type">storage_account_type</h3> <p>If this is a managed disk this is the storage account type, e.g. <code>Standard_LRS</code>.</p> <pre class="highlight" data-language="ruby"><code>its('storage_account_type') { should cmp 'Standard_LRS' }
</code></pre> <h3 id="id">id</h3> <p>If this is a managed disk then this is the fully qualified id for the disk in Azure.</p> <pre class="highlight" data-language="ruby"><code>its('id') { should cmp '/subscriptions/1234abcd-e567-890f-g123-456h78i9jkl0/resourceGroups/InSpec-Azure' }
</code></pre> <h3 id="subscription_id">subscription_id</h3> <p>If this is a managed disk, this returns the subscription id of where the disk is stored.</p> <p>This is derived from the <code>id</code>.</p> <pre class="highlight" data-language="ruby"><code>its('subscription_id') { should cmp '1234abcd-e567-890f-g123-456h78i9jkl0' }
</code></pre> <h3 id="resource_group">resource_group</h3> <p>If this is a managed disk, this returns the resource group in which the disk is stored.</p> <p>This is derived from the <code>id</code>.</p> <pre class="highlight" data-language="ruby"><code>its('resource_group') { should cmp 'InSpec-Azure' }
</code></pre> <p>## Matchers</p> <p>This Chef InSpec audit resource has the following special matchers. For a full list of available matchers, please visit our <a href="../../matchers/index.html">matchers page</a>.</p> <p>The following properties are applied to the virtual machine itself and not specific disks.</p> <h3 id="have_data_disks">have_data_disks</h3> <p>Returns a boolean denoting if any data disks are attached to the machine.</p> <pre class="highlight" data-language="ruby"><code>it { should have_data_disks }
</code></pre> <h3 id="have_managed_disks">have_managed_disks</h3> <p>Returns a boolean stating if the machine has Managed Disks for data disks.</p> <pre class="highlight" data-language="ruby"><code>it { should have_managed_disks }
</code></pre> <h2 id="references">References</h2> <ul> <li><a href="https://github.com/Azure/azure-sdk-for-ruby/tree/main/management/azure_mgmt_compute">Azure Ruby SDK - Compute</a></li> <li><a href="https://github.com/chef/inspec/blob/main/test/azure/verify/controls/virtual_machine_linux_external_vm_datadisk.rb">Linux Internal Data Disks</a></li> <li><a href="https://github.com/chef/inspec/blob/main/test/azure/verify/controls/virtual_machine_windows_internal_vm_datadisk.rb">Windows Internal Data Disk</a></li> </ul> </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; Chef Software, Inc.<br>Licensed under the Creative Commons Attribution 3.0 Unported License.<br>The Chef&trade; Mark and Chef Logo are either registered trademarks/service marks or trademarks/servicemarks of Chef, in the United States and other countries and are used with Chef Inc's permission.<br>We are not affiliated with, endorsed or sponsored by Chef Inc.<br>
    <a href="https://docs.chef.io/inspec/resources/azure_virtual_machine_data_disk/" class="_attribution-link">https://docs.chef.io/inspec/resources/azure_virtual_machine_data_disk/</a>
  </p>
</div>
