<div id="col-content" data-swiftype-index="true"> <div id="opa_cli-resource"><h1>opa_cli resource</h1></div>  <div class="prose"> <p data-swiftype-index="false"> <a href="https://github.com/inspec/inspec/tree/main/docs-chef-io/content/inspec/resources/opa_cli.md" alt="Link to page on GitHub repository">[edit on GitHub]</a> </p> <p>Use the <code>opa_cli</code> Chef InSpec audit resource to query Open Policy Agent (OPA) using an OPA policy file, a data file, and a query.</p> <h2 id="availability">Availability</h2> <h3 id="installation">Installation</h3> <p>This resource is distributed along with Chef InSpec itself. You can use it automatically.</p> <h2 id="syntax">Syntax</h2> <p>An <code>opa_cli</code> resource block declares OPA policy configurations that can be tested.</p> <pre class="highlight" data-language="ruby"><code>describe opa_cli(policy: "example.rego", data: "input.json", query: "data.example.allow") do
  its(["result"]) { should eq "value" }
end
</code></pre> <p>where</p> <ul> <li>
<code>data</code> specifies the json formatted input data or file path.</li> <li>
<code>policy</code> the path to policy file.</li> <li>
<code>query</code> specifies the query to be run.</li> <li>
<code>its(["result"]) { should eq "value" }</code> compares the results of the query against the expected result in the test</li> </ul> <h2 id="parameters">parameters</h2> <p>The <code>opa_cli</code> resource InSpec resource accepts <code>policy</code>, <code>data</code>, <code>query</code>, and <code>opa_executable_path</code> as parameters.</p> <h3 id="policy-_required_">
<code>policy</code> <em>(required)</em>
</h3> <p>The path to the OPA policy file.</p> <h3 id="data-_required_">
<code>data</code> <em>(required)</em>
</h3> <p>An OPA query as a JSON data file or a string in JSON format.</p> <h3 id="query-_required_">
<code>query</code> <em>(required)</em>
</h3> <p>The query to be evaluated against policy and input data.</p> <h3 id="opa_executable_path"><code>opa_executable_path</code></h3> <p>This is the full path to the OPA binary or EXE file used for running the OPA CLI or OPA commands. By default it will consider that the path is added in PATH variable.</p> <h2 id="properties">Properties</h2> <h3 id="result">result</h3> <p>The <code>result</code> property checks whether the resource query returns an empty result.</p> <pre class="highlight" data-language="ruby"><code>its('result') { should be nil }
</code></pre> <h3 id="allow">allow</h3> <p>The <code>allow</code> property checks if specific input matches the policy defined in OPA. This matcher will not work if <code>allow</code> is not defined in the policy file.</p> <pre class="highlight" data-language="ruby"><code>its('allow') { should eq 'value' }
</code></pre> <h2 id="examples">Examples</h2> <p>The following examples show how to use this Chef InSpec audit resource:</p> <pre class="highlight" data-language="ruby"><code>describe opa_cli(query: "data.example.allow", policy: "example.rego", data: "input.json", opa_executable_path: "./opa") do
  its("result") { shoule_not be nil }
  its(["result", 0, "expressions", 0, "value"]) { should eq true }
  its("allow") { should eq "true" }
end
</code></pre> <p>The above example shows how the <code>allow</code> value can be fetched in two ways.</p> <h2 id="matchers">Matchers</h2> <p>For a full list of available matchers, please visit our <a href="../../matchers/index.html">matchers page</a>.</p> </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; Chef Software, Inc.<br>Licensed under the Creative Commons Attribution 3.0 Unported License.<br>The Chef&trade; Mark and Chef Logo are either registered trademarks/service marks or trademarks/servicemarks of Chef, in the United States and other countries and are used with Chef Inc's permission.<br>We are not affiliated with, endorsed or sponsored by Chef Inc.<br>
    <a href="https://docs.chef.io/inspec/resources/opa_cli/" class="_attribution-link">https://docs.chef.io/inspec/resources/opa_cli/</a>
  </p>
</div>
