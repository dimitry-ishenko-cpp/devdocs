<div id="col-content" data-swiftype-index="true"> <div id="aws_ec2_instance-resource"><h1>aws_ec2_instance resource</h1></div>  <div class="prose"> <p data-swiftype-index="false"> <a href="https://github.com/inspec/inspec/tree/main/docs-chef-io/content/inspec/resources/aws_ec2_instance.md" alt="Link to page on GitHub repository">[edit on GitHub]</a> </p> <p>Use the <code>aws_ec2_instance</code> InSpec audit resource to test properties of a single AWS EC2 instance.</p> <h2 id="syntax">Syntax</h2> <p>An <code>aws_ec2_instance</code> resource block declares the tests for a single AWS EC2 instance by either name or instance id.</p> <pre class="highlight" data-language="ruby"><code>describe aws_ec2_instance('i-01a2349e94458a507') do
  it { should exist }
end

describe aws_ec2_instance(name: 'my-instance') do
  it { should exist }
end
</code></pre> <h2 id="parameters">Parameters</h2> <p>One of either the EC2 instance’s ID or name must be be provided.</p> <h3 id="instance_id-_required-if-name-not-provided_">instance_id <em>(required if <code>name</code> not provided)</em>
</h3> <p>The ID of the EC2 instance. This is in the format of <code>i-</code> followed by 8 or 17 hexadecimal characters. This can be passed either as a string or as an <code>instance_id: 'value'</code> key-value entry in a hash.</p> <h3 id="name-_required-if-instance_id-not-provided_">name <em>(required if <code>instance_id</code> not provided)</em>
</h3> <p>If you have a <code>Name</code> tag applied to the EC2 instance, this can be used to lookup the instance. This must be passed as a <code>name: 'value'</code> key-value entry in a hash.</p> <h2 id="properties">Properties</h2> <table> <thead> <tr> <th>Property</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td>state</td> <td>The current state of the EC2 Instance, for example ‘running’.</td> </tr> <tr> <td>image_id</td> <td>The id of the AMI used to launch the instance.</td> </tr> <tr> <td>role</td> <td>The IAM role attached to the instance.</td> </tr> <tr> <td>launch_time</td> <td>The time the instance was launched.</td> </tr> <tr> <td>availability_zone</td> <td>The availability zone of the instance.</td> </tr> <tr> <td>security_groups</td> <td>A hash containing the security group ids and names associated with the instance.</td> </tr> <tr> <td>security_group_ids</td> <td>The security group ids associated with the instance.</td> </tr> <tr> <td>ebs_volumes</td> <td>A hash containing the names and ids of any EBS volumes associated with the instance.</td> </tr> <tr> <td>tags</td> <td>A list of hashes with each key-value pair corresponding to an EC2 instance tag, e.g, <code>[{:key=&gt;"Name", :value=&gt;"Testing Box"}, {:key=&gt;"Environment", :value=&gt;"Dev"}]</code>
</td> </tr> <tr> <td>tags_hash</td> <td>A hash, with each key-value pair corresponding to an EC2 instance tag, e.g, <code>{"Name"=&gt;"Testing Box", "Environment"=&gt;"Dev"}</code>. This property is available in InSpec AWS resource pack version <strong><a href="https://github.com/inspec/inspec-aws/releases/tag/v1.12.0">1.12.0</a></strong> onwards.</td> </tr> </tbody> </table> <p>There are also additional properties available. For a comprehensive list, see <a href="https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_Instance.html">the API reference documentation</a></p> <h2 id="examples">Examples</h2> <h3 id="test-that-an-ec2-instance-is-running">Test that an EC2 instance is running</h3> <pre class="highlight" data-language="ruby"><code>describe aws_ec2_instance(name: 'prod-database') do
  it { should be_running }
end
</code></pre> <h3 id="test-that-an-ec2-instance-is-using-the-correct-ami">Test that an EC2 instance is using the correct AMI</h3> <pre class="highlight" data-language="ruby"><code>describe aws_ec2_instance(name: 'my-instance') do
  its('image_id') { should eq 'ami-27a58d5c' }
end
</code></pre> <h3 id="test-that-an-ec2-instance-has-the-correct-tag">Test that an EC2 instance has the correct tag</h3> <pre class="highlight" data-language="ruby"><code>describe aws_ec2_instance('i-090c29e4f4c165b74') do
  its('tags') { should include(key: 'Contact', value: 'Gilfoyle') }
end
</code></pre> <h3 id="test-that-an-ec2-instance-has-the-correct-tag-using-the-tags_hash-property">Test that an EC2 instance has the correct tag (using the <code>tags_hash</code> property)</h3> <pre class="highlight" data-language="ruby"><code>describe aws_ec2_instance('i-090c29e4f4c165b74') do
  its('tags_hash') { should include('Contact' =&gt; 'Gilfoyle') }
  its('tags_hash') { should include('Contact') }                  # Regardless of the value
end
</code></pre> <h3 id="test-that-an-ec2-instance-has-no-roles">Test that an EC2 instance has no roles</h3> <pre class="highlight" data-language="ruby"><code>describe aws_ec2_instance('i-090c29e4f4c165b74') do
  it { should_not have_roles }
end
</code></pre> <h2 id="matchers">Matchers</h2> <p>This InSpec audit resource has the following special matchers. For a full list of available matchers, please visit our <a href="../../matchers/index.html">matchers page</a>.</p> <h3 id="exist">exist</h3> <p>The control will pass if the describe returns at least one result.</p> <p>Use <code>should_not</code> to test the entity should not exist.</p> <pre class="highlight" data-language="ruby"><code>  it { should exist }

  it { should_not exist }
</code></pre> <h3 id="has_roles">has_roles</h3> <p>Test if the EC2 instance has any roles associated with it.</p> <p>Use <code>should_not</code> to test the entity does not have roles.</p> <pre class="highlight" data-language="ruby"><code>it { should have_roles }

it { should_not have_roles }
</code></pre> <h3 id="be_pending">be_pending</h3> <p>The <code>be_pending</code> matcher tests if the described EC2 instance state is <code>pending</code>. This indicates that an instance is provisioning. This state should be temporary.</p> <pre class="highlight" data-language="ruby"><code>it { should be_pending }
</code></pre> <h3 id="be_running">be_running</h3> <p>The <code>be_running</code> matcher tests if the described EC2 instance state is <code>running</code>. This indicates the instance is fully operational from AWS’s perspective.</p> <pre class="highlight" data-language="ruby"><code>it { should be_running }
</code></pre> <h3 id="be_shutting_down">be_shutting_down</h3> <p>The <code>be_shutting_down</code> matcher tests if the described EC2 instance state is <code>shutting-down</code>. This indicates the instance has received a termination command and is in the process of being permanently halted and de-provisioned. This state should be temporary.</p> <pre class="highlight" data-language="ruby"><code>it { should be_shutting_down }
</code></pre> <h3 id="be_stopped">be_stopped</h3> <p>The <code>be_stopped</code> matcher tests if the described EC2 instance state is <code>stopped</code>. This indicates that the instance is suspended and may be started again.</p> <pre class="highlight" data-language="ruby"><code>it { should be_stopped }
</code></pre> <h3 id="be_stopping">be_stopping</h3> <p>The <code>be_stopping</code> matcher tests if the described EC2 instance state is <code>stopping</code>. This indicates that an AWS stop command has been issued, which will suspend the instance in an OS-unaware manner. This state should be temporary.</p> <pre class="highlight" data-language="ruby"><code>it { should be_stopping }
</code></pre> <h3 id="be_terminated">be_terminated</h3> <p>The <code>be_terminated</code> matcher tests if the described EC2 instance state is <code>terminated</code>. This indicates the instance is permanently halted and will be removed from the instance listing in a short period. This state should be temporary.</p> <pre class="highlight" data-language="ruby"><code>it { should be_terminated }
</code></pre> <h3 id="be_unknown">be_unknown</h3> <p>The <code>be_unknown</code> matcher tests if the described EC2 instance state is <code>unknown</code>. This indicates an error condition in the AWS management system. This state should be temporary.</p> <pre class="highlight" data-language="ruby"><code>it { should be_unknown }
</code></pre> <h2 id="aws-permissions">AWS Permissions</h2> <p>Your <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/intro-structure.html#intro-structure-principal">Principal</a> will need the <code>ec2:DescribeInstances</code>, and <code>iam:GetInstanceProfile</code> actions set to allow.</p> <p>You can find detailed documentation at <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/list_amazonec2.html">Actions, Resources, and Condition Keys for Amazon EC2</a>, and <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/list_identityandaccessmanagement.html">Actions, Resources, and Condition Keys for Identity And Access Management</a>.</p> </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; Chef Software, Inc.<br>Licensed under the Creative Commons Attribution 3.0 Unported License.<br>The Chef&trade; Mark and Chef Logo are either registered trademarks/service marks or trademarks/servicemarks of Chef, in the United States and other countries and are used with Chef Inc's permission.<br>We are not affiliated with, endorsed or sponsored by Chef Inc.<br>
    <a href="https://docs.chef.io/inspec/resources/aws_ec2_instance/" class="_attribution-link">https://docs.chef.io/inspec/resources/aws_ec2_instance/</a>
  </p>
</div>
