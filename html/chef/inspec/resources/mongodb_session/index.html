<div id="col-content" data-swiftype-index="true"> <div id="mongodb_session-resource"><h1>mongodb_session resource</h1></div>  <div class="prose"> <p data-swiftype-index="false"> <a href="https://github.com/inspec/inspec/tree/main/docs-chef-io/content/inspec/resources/mongodb_session.md" alt="Link to page on GitHub repository">[edit on GitHub]</a> </p> <p>Use the <code>mongodb_session</code> Chef InSpec audit resource to run MongoDB command against a MongoDB Database.</p> <h2 id="availability">Availability</h2> <h3 id="installation">Installation</h3> <p>This resource is distributed along with Chef InSpec itself. You can use it automatically.</p> <h2 id="syntax">Syntax</h2> <p>A <code>mongodb_session</code> resource block declares the <code>user</code>, <code>password</code>, and <code>database</code> to use for the session and then the command to be run:</p> <p>describe mongodb_session(user: “username”, password: “password”, database: “test”).query(key: value) do its(“params”) { should match(/expected-result/) } end</p> <p>where</p> <ul> <li>
<code>mongodb_session</code> declares a user, password, and database, connecting locally, with permission to run the query.</li> <li>
<code>query</code> contains the query to be run.</li> <li>
<code>its("params") { should eq(/expected-result/) }</code> compares the results of the query against the expected result in the test</li> </ul> <h3 id="optional-parameters">Optional Parameters</h3> <p>The <code>mongodb_session</code> InSpec resource accepts <code>user</code>, <code>password</code>, <code>host</code>, <code>port</code>, <code>auth_source</code>, <code>auth_mech</code>, <code>ssl</code>, <code>ssl_cert</code>, <code>ssl_ca_cert</code>, and <code>auth_mech_properties</code> parameters.</p> <p>In Particular:</p> <h4 id="host"><code>host</code></h4> <p>The server host IP address. Default value: <code>127.0.0.1</code>.</p> <h4 id="port"><code>port</code></h4> <p>The server port. Default value: <code>27017</code>.</p> <h4 id="auth_mech"><code>auth_mech</code></h4> <p>The authentication mechanism. The available options are: <code>:scram</code>, <code>:scram256</code>, <code>:mongodb_x509</code>, and <code>:aws</code>. Default value: <code>:scram</code>.</p> <p>See the MongoDB documentation on <a href="https://docs.mongodb.com/ruby-driver/current/reference/authentication/">Ruby driver authentication</a> for more information.</p> <h4 id="auth_source"><code>auth_source</code></h4> <p>The database where the user’s authentication credentials are stored. The default value is the database name that is passed as a parameter to the resource.</p> <h4 id="ssl"><code>ssl</code></h4> <p>Whether to use the SSL security protocol or not. Set to <code>true</code> to use SSL transport, default value: <code>false</code>. See the MongoDB documentation on <a href="https://docs.mongodb.com/ruby-driver/current/reference/authentication/#client-certificate-x-509">Ruby Driver authentication</a> for more information.</p> <h4 id="ssl_cert">‘ssl_cert’</h4> <p>Path to the SSL certificate file.</p> <h4 id="ssl_ca_cert"><code>ssl_ca_cert</code></h4> <p>Path to the SSL Certificate Authority (CA) certificate file.</p> <h4 id="ssl_key"><code>ssl_key</code></h4> <p>Path to SSL key file.</p> <h4 id="auth_mech_properties"><code>auth_mech_properties</code></h4> <p>A hash of the authentication mechanism properties. This option is generally used with the AWS authentication mechanism. See the MongoDB documentation on <a href="https://docs.mongodb.com/ruby-driver/current/reference/authentication/#aws">Ruby Driver authentication using AWS</a> for more information.</p> <h3 id="mongodb-query-reference-documentation">MongoDB Query Reference Documentation</h3> <p>This resource uses the <a href="https://docs.mongodb.com/ruby-driver/current/reference/authentication/">MongoDB Ruby Driver</a> to fetch the data.</p> <h2 id="examples">Examples</h2> <p>The following examples show how to use this Chef InSpec audit resource.</p> <h3 id="test-the-roles-information-using-the-rolesinfo-command-in-mongodb">Test the roles information using the <code>rolesInfo</code> command in MongoDB</h3> <pre class="highlight" data-language="ruby"><code>describe mongodb_session(user: "foo", password: "bar", database: "test").query(rolesInfo: "dbAdmin").params["roles"].first do
  its(["role"]) { should eq "dbAdmin" }
end
</code></pre> <h3 id="test-the-mongodb-user-role">Test the MongoDB user role</h3> <pre class="highlight" data-language="ruby"><code>describe mongodb_session(user: "foo", password: "bar", database: "test").query(usersInfo: "foo").params["users"].first["roles"].first do
  its(["role"]) { should eq "readWrite" }
end
</code></pre> <h3 id="test-the-database-parameters">Test the database parameters</h3> <pre class="highlight" data-language="ruby"><code>describe mongodb_session(user: "foo", password: "bar", database: "test").query(rolesInfo: "dbAdmin") do
  its("params") { should_not be_empty }
  its("params") { should include "roles" }
end
</code></pre> <h2 id="matchers">Matchers</h2> <p>For a full list of available matchers, please visit our <a href="../../matchers/index.html">matchers page</a>.</p> <h3 id="params">params</h3> <p>The <code>params</code> contains all the query data.</p> </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; Chef Software, Inc.<br>Licensed under the Creative Commons Attribution 3.0 Unported License.<br>The Chef&trade; Mark and Chef Logo are either registered trademarks/service marks or trademarks/servicemarks of Chef, in the United States and other countries and are used with Chef Inc's permission.<br>We are not affiliated with, endorsed or sponsored by Chef Inc.<br>
    <a href="https://docs.chef.io/inspec/resources/mongodb_session/" class="_attribution-link">https://docs.chef.io/inspec/resources/mongodb_session/</a>
  </p>
</div>
