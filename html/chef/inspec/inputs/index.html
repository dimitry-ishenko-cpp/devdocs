<div id="col-content" data-swiftype-index="true"> <div id="chef-inspec-inputs"><h1>Chef InSpec Inputs</h1></div>  <div class="prose"> <p data-swiftype-index="false"> <a href="https://github.com/inspec/inspec/tree/main/docs-chef-io/content/inspec/inputs.md" alt="Link to page on GitHub repository">[edit on GitHub]</a> </p> <h2 id="what-are-inputs">What are Inputs?</h2> <p>Inputs are the “knobs” you can use to customize the behavior of Chef InSpec profiles. If a profile supports inputs, you can set the inputs in a variety of ways, allowing flexibility. Profiles that include other profiles can set inputs in the included profile, enabling a multi-layered approach to configuring profiles.</p> <h3 id="a-simple-example">A Simple Example</h3> <p>Suppose you have a profile named <code>rock_critic</code>. In its profile metadata file (inspec.yml):</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-yaml" data-lang="yaml"><span style="color:#60a0b0;font-style:italic"># Optionally declare inputs in the profile metadata</span><span style="color:#60a0b0;font-style:italic"># This lets you set up things like type checking, etc.</span><span style="color:#062873;font-weight:700">inputs</span>:- <span style="color:#062873;font-weight:700">name</span>:amplifier_max_volume<span style="color:#062873;font-weight:700">description</span>:How loud the amplifiers can go<span style="color:#062873;font-weight:700">type</span>:numeric<span style="color:#60a0b0;font-style:italic"># More options, including value: and priority: are possible here</span></code></pre></div>
<p>In the profile’s control code:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#60a0b0;font-style:italic"># Set a default value for an input.  This is optional.</span>
input(<span style="color:#4070a0">'amplifier_max_volume'</span>, <span style="color:#517918">value</span>: <span style="color:#40a070">10</span>)

control <span style="color:#4070a0">'Big Rock Show'</span> <span style="color:#007020;font-weight:700">do</span>
  describe input(<span style="color:#4070a0">'amplifier_max_volume'</span>) <span style="color:#007020;font-weight:700">do</span>    <span style="color:#60a0b0;font-style:italic"># This line reads the value of the input</span>
    it { should cmp <span style="color:#40a070">11</span> } <span style="color:#60a0b0;font-style:italic"># The UK'S LOUDEST BAND</span>
  <span style="color:#007020;font-weight:700">end</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>When the above profile is executed by using <code>inspec exec rock_critic</code>, you would see something like:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">  ×  Big Rock Show: <span style="color:#40a070">10</span>
     ×  <span style="color:#40a070">10</span> is expected to <span style="color:#bb60d5">cmp</span> <span style="color:#666">==</span> <span style="color:#40a070">11</span>

     expected: <span style="color:#40a070">11</span>
          got: <span style="color:#40a070">10</span>

     <span style="color:#666">(</span>compared using <span style="color:#4070a0">`</span>cmp<span style="color:#4070a0">`</span> matcher<span style="color:#666">)</span>
Profile Summary: <span style="color:#40a070">0</span> successful controls, <span style="color:#40a070">1</span> control failure, <span style="color:#40a070">0</span> controls skipped
</code></pre></div>
<p>That result clearly won’t do. Let’s override the input’s default value.</p> <p>We can now run that profile with <code>inspec exec rock_critic --input amplifier_max_volume=11</code>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">  ✔  Big Rock Show: <span style="color:#40a070">11</span>
     ✔  <span style="color:#40a070">11</span> is expected to <span style="color:#bb60d5">cmp</span> <span style="color:#666">==</span> <span style="color:#40a070">11</span>

Profile Summary: <span style="color:#40a070">1</span> successful control, <span style="color:#40a070">0</span> control failures, <span style="color:#40a070">0</span> controls skipped
</code></pre></div>
<h3 id="which-profiles-support-inputs">Which profiles support inputs?</h3> <p>The best way for a profile to indicate it supports inputs is to list them in the metadata file, <code>inspec.yml</code>. Any profile that has an <code>inputs</code> (or the deprecated <code>attributes</code>) section in its <code>inspec.yml</code> metadata file is <a href="#configuring-inputs-in-profile-metadata">configuring</a> inputs.</p> <p>That said, any profile that uses the DSL keyword <code>input()</code> (or the deprecated <code>attribute()</code>) in the control source code supports inputs. These profiles are <em>reading</em> (and possibly setting) input values and using them to make decisions.</p> <h3 id="how-can-i-set-inputs">How can I set Inputs?</h3> <p>As installed (without specialized plugins), Chef InSpec supports several ways of setting inputs:</p> <ul> <li>Inline in control code, using <code>input('input_name', value: 42)</code>.</li> <li>In profile <code>inspec.yml</code> metadata files</li> <li>Using the CLI option <code>--input name1=value1 name2=value2...</code> to read directly from the command line</li> <li>Using the CLI option <code>--input-file somefile.yaml</code> to read inputs from files</li> <li>In kitchen-inspec, using the <code>verifier/inputs</code> settings</li> </ul> <p>In addition, Chef InSpec supports Input Plugins, which can provide optional integrations to specific key-value stores.</p> <h3 id="how-does-input-precedence-work">How does Input precedence work?</h3> <h4 id="simple-precedence">Simple Precedence</h4> <p>Briefly:</p> <p>inline DSL &lt; metadata &lt; ( cli-input-file or kitchen-inspec ) &lt; cli –input</p> <p>In addition, for inherited profiles:</p> <p>dependent profile metadata &lt; wrapper profile metadata</p> <p>This precedence lets you override input values on the command line, as well as override child profile inline values from the parent profile. This description matches the general behavior of InSpec v3, while also making some edge cases easier to reason.</p> <h4 id="the-details-of-input-precedence">The Details of Input Precedence</h4> <p>Whenever an input provider sets a value on an input, a <em>priority value</em> is assigned to the operation. Over the life of the input, multiple assignments with varying priority values may occur. When the input is evaluated, the current value is determined by finding the setting event with the highest priority.</p> <p>Note that this approach does not rely on execution order, nor does it rely on multiple named precedence levels. Each setting operation is preserved and this allows the user to <a href="#debugging-inputs-with-the-event-log">debug</a> the history of the input values.</p> <p>Some input providers allow you to set a priority when you set the value. For example, to set a priority of 50 in a metadata file, use:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-yaml" data-lang="yaml"><span style="color:#062873;font-weight:700">inputs</span>:- <span style="color:#062873;font-weight:700">name</span>:very_important_input<span style="color:#062873;font-weight:700">value</span>:<span style="color:#40a070">12</span><span style="color:#062873;font-weight:700">priority</span>:<span style="color:#40a070">50</span></code></pre></div>
<p>To set a priority in DSL, use:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">input(<span style="color:#4070a0">'also_important'</span>, <span style="color:#517918">value</span>: <span style="color:#40a070">42</span>, <span style="color:#517918">priority</span>: <span style="color:#40a070">45</span>)
</code></pre></div>
<p>As packaged, Chef InSpec uses the following priority values:</p> <table> <thead> <tr> <th>Input Provider</th> <th>Priority</th> <th>May change priority</th> </tr> </thead> <tbody> <tr> <td>Inline DSL</td> <td>20</td> <td>Yes</td> </tr> <tr> <td>Metadata</td> <td>30</td> <td>Yes</td> </tr> <tr> <td>Metadata in a wrapper cookbook</td> <td>35</td> <td>Yes</td> </tr> <tr> <td>CLI <code>--input-file</code> option</td> <td>40</td> <td>No</td> </tr> <tr> <td>inspec-kitchen <code>inputs:</code> section</td> <td>40</td> <td>No</td> </tr> <tr> <td>CLI <code>--input</code> option</td> <td>50</td> <td>No</td> </tr> </tbody> </table> <h3 id="what-happened-to-attributes">What happened to “Attributes”?</h3> <p>When originally introduced, the Input facility was named <em>Attributes</em>. This name was problematic, because:</p> <ul> <li>The Chef Infra tool uses the same word to describe its parameterization system.</li> <li>Chef Infra attributes have a completely different and much more complex precedence system.</li> <li>This caused confusion about passing Chef Infra attributes into InSpec when using Audit Cookbook and kitchen-inspec.</li> </ul> <p>Based on these concerns, InSpec attributes have been renamed to InSpec inputs in Chef InSpec v4.</p> <p>Support for using the DSL keyword <code>attribute()</code>, the metadata field <code>attributes:</code>, and the corresponding kitchen-inspec and audit cookbook values are anticipated to continue through Chef InSpec v5.</p> <h2 id="working-with-inputs-in-control-code">Working with Inputs in Control Code</h2> <h3 id="input-scope">Input Scope</h3> <p>Inputs are available throughout the InSpec profile DSL. You can use them anywhere.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#60a0b0;font-style:italic"># some_controls.rb</span>

input(<span style="color:#4070a0">'outer_input'</span>, <span style="color:#517918">value</span>: <span style="color:#40a070">1</span>) <span style="color:#60a0b0;font-style:italic"># here</span>

control <span style="color:#4070a0">'control-1'</span> <span style="color:#007020;font-weight:700">do</span>
  input(<span style="color:#4070a0">'control_dsl_input'</span>, <span style="color:#517918">value</span>: <span style="color:#40a070">2</span>) <span style="color:#60a0b0;font-style:italic"># here too</span>
  describe some_resource <span style="color:#007020;font-weight:700">do</span>
    input(<span style="color:#4070a0">'test_dsl_input'</span>, <span style="color:#517918">value</span>: <span style="color:#40a070">3</span>) <span style="color:#60a0b0;font-style:italic"># even here</span>
    it { should cmp input(<span style="color:#4070a0">'expectation_dsl_input'</span>) } <span style="color:#60a0b0;font-style:italic"># and yes here too</span>
  <span style="color:#007020;font-weight:700">end</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<h3 id="setting-inputs-in-control-dsl">Setting Inputs in Control DSL</h3> <p>When you write <code>input('some_name', value: 'some_value')</code>, you are <em>setting</em> an input value in the DSL. Because the <code>value:</code> option is present, a new value will be set. You may also pass any other option listed in the <a href="#input-options-reference">input option reference</a>.</p> <h3 id="reading-inputs-in-control-dsl">Reading Inputs in Control DSL</h3> <p>When you call <code>input('some_name')</code>, with or without additional options, the value of the input will be resolved and returned. Note that this process may involve sourcing the value from another provider, using the value set in DSL, or overriding the value provided in the same call.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#60a0b0;font-style:italic"># You can use the value in a Ruby variable</span>
some_var <span style="color:#666">=</span> input(<span style="color:#4070a0">'some_input_name'</span>)

<span style="color:#60a0b0;font-style:italic"># Or more directly in a resource parameter</span>
describe file(input(<span style="color:#4070a0">'important_path'</span>)) <span style="color:#007020;font-weight:700">do</span>
  it { should exist }
<span style="color:#007020;font-weight:700">end</span>

<span style="color:#60a0b0;font-style:italic"># Or as the resource itself (this could be a string, here)</span>
describe input(<span style="color:#4070a0">'some_setting'</span>) <span style="color:#007020;font-weight:700">do</span>
  it { should cmp <span style="color:#4070a0">'correct_value'</span> }
<span style="color:#007020;font-weight:700">end</span>

<span style="color:#60a0b0;font-style:italic"># Or as the expected value</span>
describe file(<span style="color:#4070a0">'/etc/httpd/httpd.conf'</span>) <span style="color:#007020;font-weight:700">do</span>
  its(<span style="color:#4070a0">'owner'</span>) { should_not cmp input(<span style="color:#4070a0">'webserver_user'</span>) }
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>The value returned can be used anywhere a Ruby value is used.</p> <h2 id="configuring-inputs-in-profile-metadata">Configuring Inputs in Profile Metadata</h2> <p>Each Chef InSpec profile has a metadata file at the top level named <code>inspec.yml</code>. In that file, you may add a section for inputs. You may define inputs there, clearly setting options including values, type checking, and whether the input is required.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-yaml" data-lang="yaml"><span style="color:#062873;font-weight:700">name</span>:my_profile<span style="color:#062873;font-weight:700">inputs</span>:- <span style="color:#062873;font-weight:700">name</span>:webserver_user <span style="color:#60a0b0;font-style:italic"># Name is the only required field</span>- <span style="color:#062873;font-weight:700">name</span>:favorite_fruit<span style="color:#062873;font-weight:700">value</span>:banana        <span style="color:#60a0b0;font-style:italic"># You can set a value; priority is 30 for metadata</span>- <span style="color:#062873;font-weight:700">name</span>:meaning_of_life<span style="color:#062873;font-weight:700">type</span>:Numeric<span style="color:#062873;font-weight:700">value</span>:<span style="color:#40a070">42</span><span style="color:#062873;font-weight:700">required</span>:<span style="color:#007020;font-weight:700">true</span><span style="color:#062873;font-weight:700">priority</span>:<span style="color:#40a070">70</span><span style="color:#062873;font-weight:700">sensitive</span>:<span style="color:#007020;font-weight:700">true</span></code></pre></div>
<p>All <a href="#input-options-reference">input options</a> are supported in metadata files.</p> <p>There are two major advantages to defining inputs in profile metadata:</p> <ol> <li>The inputs and their configuration are listed explicitly in simple YAML in one place - a consumer of your profile does not need to read through the control code to find the inputs.</li> <li>You can set inputs in other profiles that you depend on using profile inheritance.</li> </ol> <h3 id="using-inputs-with-profile-inheritance">Using inputs with Profile inheritance</h3> <p>When your profile relies on another profile using the <code>depends</code> key in the metadata file, you can set — that is, override — the value of the input in the dependent profile by including the <code>profile</code> option and naming the dependent profile.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-yaml" data-lang="yaml"><span style="color:#60a0b0;font-style:italic"># child inspec.yml</span><span style="color:#062873;font-weight:700">name</span>:child<span style="color:#062873;font-weight:700">inputs</span>:- <span style="color:#062873;font-weight:700">name</span>:favorite_food<span style="color:#062873;font-weight:700">value</span>:pizza</code></pre></div>
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-yaml" data-lang="yaml"><span style="color:#60a0b0;font-style:italic"># wrapper inspec.yml</span><span style="color:#062873;font-weight:700">name</span>:wrapper<span style="color:#062873;font-weight:700">depends</span>:- <span style="color:#062873;font-weight:700">name</span>:child<span style="color:#062873;font-weight:700">path</span>:../child<span style="color:#062873;font-weight:700">inputs</span>:- <span style="color:#062873;font-weight:700">name</span>:favorite_food<span style="color:#062873;font-weight:700">value</span>:broccoli<span style="color:#062873;font-weight:700">profile</span>:child      <span style="color:#60a0b0;font-style:italic"># &lt;----- REQUIRED to override the value in InSpec 4</span></code></pre></div>
<p>In Chef InSpec 4+, every input is namespaced. For example, you could have an input named <code>wrapper/favorite_food</code> and one named <code>child/favorite_food</code>. If no explicit profile option is set within the <code>wrapper</code> profile metadata file, then <code>wrapper</code> is assumed to be the profile.</p> <h2 id="setting-input-values-using---input-file">Setting Input values using <code>--input-file</code>
</h2> <p>You may also provide inputs and values via YAML files on the command line. The format can be seen below:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-yaml" data-lang="yaml"><span style="color:#062873;font-weight:700">an_input</span>:a_value<span style="color:#062873;font-weight:700">another_input</span>:another_value</code></pre></div>
<p>CLI-input-file-set inputs have a priority of 40.</p> <p>As of Chef InSpec 4.3.2, this mechanism has the following limitations:</p> <ol> <li>No <a href="#input-options-reference">input options</a> may be set - only the name and value.</li> <li>Because the CLI is outside the scope of any individual profile and the inputs don’t take options, the inputs are clumsily copied into every profile, effectively making the CLI mechanism global.</li> </ol> <h2 id="setting-input-values-using---input">Setting Input values using <code>--input</code>
</h2> <p>You may also provide inputs and values directly on the command line:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-yaml" data-lang="yaml">inspec exec my_profile --input input_name=input_value</code></pre></div>
<p>To set multiple inputs, say:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-yaml" data-lang="yaml">inspec exec my_profile --input input_name1=input_value1 name2=value2</code></pre></div>
<p>If a CLI input value resembles a number, it will be converted to an Integer or Float. Scientific notation is not currently recognized.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-yaml" data-lang="yaml">inspec exec my_profile --input amplifier_volume=-11inspec exec my_profile --input water_depth=11.5</code></pre></div>
<p>You may set inputs with complex values, such as arrays and hashes using either YAML or JSON syntax. Just be sure to protect the string from the shell using single quotes.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-yaml" data-lang="yaml">inspec exec my_profile --input alphabet='[a,b,c]'inspec exec my_profile --input fruits='{a: apples, b: bananas, c: cantelopes}'inspec exec my_profile --input json_fruit='{"a": "apples", "g": ["grape01", "grape02"] }'</code></pre></div>
<p>Do not repeat the <code>--input</code> flag; that will override the previous setting.</p> <p>CLI-set inputs have a priority of 50.</p> <p>As of Chef InSpec 4.12, this mechanism has the following limitations:</p> <ol> <li>No <a href="#input-options-reference">input options</a> may be set - only the name and value.</li> <li>Because the CLI is outside the scope of any individual profile and the inputs don’t take options, the inputs are clumsily copied into every profile, effectively making the CLI mechanism global.</li> </ol> <h2 id="setting-input-values-using-plugins">Setting Input values using Plugins</h2> <p>Inputs can also be set by custom input plugins, which retrieve values from external sources like secret stores or databases. Please check <a href="https://rubygems.org/">RubyGems.org</a> for available InSpec input plugins.</p> <h3 id="disabling-caching-for-inputs">Disabling Caching for Inputs</h3> <p>Especially with plugins, it can be desirable to re-evaluate inputs every time and not cache them. By default, an existing input value is reused which can lead to problems if the retrieved values are expected to change. An example for this is using <code>kitchen-inspec</code> with input plugins to connect to a Vault server for password retrieval.</p> <p>To disable input caching, you can disable the cache from your Ruby code:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#60add5">Inspec</span><span style="color:#666">::</span><span style="color:#60add5">InputRegistry</span><span style="color:#666">.</span>instance<span style="color:#666">.</span>cache_inputs <span style="color:#666">=</span> <span style="color:#007020">false</span>
</code></pre></div>
<h2 id="input-options-reference">Input Options Reference</h2> <h3 id="name">Name</h3> <p>Required <code>String</code>. This option identifies the input.</p> <p>Allowed in: All. When used in DSL and Metadata, the name is unique within the current profile. When used in CLI input files, and kitchen-inspec, the input is copied across all profiles using the same name.</p> <h3 id="description">Description</h3> <p>Optional <code>String</code>. Human-meaningful explanation of the input.</p> <p>Allowed in: DSL, Metadata</p> <h3 id="value">Value</h3> <p>Optional, any Ruby or YAML type. This is the value that will be available when you read the input. See the <a href="#reading-inputs-in-control-dsl">Reading Inputs</a> section for more information.</p> <p>Allowed in: All</p> <h3 id="type">Type</h3> <p>Optional, <code>String</code>. This value must be one of <code>String</code>, <code>Numeric</code>, <code>Regexp</code>, <code>Array</code>, <code>Hash</code>, <code>Boolean</code>, or <code>Any</code>. If provided, the value of the input will be checked to see if it is of the corresponding type. Note that <code>Regexp</code> indicates that the input value itself should be a regular expression, not that it should match any particular regular expression.</p> <p>Allowed in: DSL, Metadata</p> <h3 id="required">Required</h3> <p>Optional, <code>true</code> or <code>false</code>. If <code>true</code>, a control using the input will be failed if it <a href="#reading-inputs-in-control-dsl">reads</a> the value when none has been set.</p> <p>Allowed in: DSL, Metadata</p> <h3 id="priority">Priority</h3> <p>Optional, <code>Integer</code>, 0-100. Higher values make this assignment have higher precedence. This is an advanced feature.</p> <p>Allowed in: DSL, Metadata</p> <h3 id="profile">Profile</h3> <p>Optional, <code>String</code>. Allows you to set an input in another profile from your profile.</p> <p>Allowed in: DSL, Metadata</p> <h3 id="sensitive">Sensitive</h3> <p>Optional, <code>true</code> or <code>false</code>. If <code>true</code>, the value of the input will be used normally during the <code>exec</code> run, but the value will be obscured as “***” in the “inputs” or “attributes” section of any <a href="../reporters/index.html">Reporter</a> that explicitly lists inputs (the <code>json</code> reporter is one such reporter). Note that this will not obscure input values that are used as test results.</p> <p>Allowed in: Metadata</p> <h3 id="pattern">Pattern</h3> <p>Optional, <code>Regexp</code>. This feature validates the input by matching it with the provided regular expression.</p> <p>Allowed in: DSL, Metadata</p> <h2 id="advanced-topics">Advanced Topics</h2> <h3 id="debugging-inputs-with-the-event-log">Debugging Inputs with the Event Log</h3> <p>If it is difficult to determine why a particular value is being used, you can use the Event Log to determine what is happening.</p> <p>First, use the <code>input_object()</code> DSL method. This method is like <code>input()</code> in that it looks up an input, but instead of evaluating the current value, it returns the underlying <code>Inspec::Input</code> object.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#007020">puts</span> input_object(<span style="color:#4070a0">'troublesome_input'</span>)<span style="color:#666">.</span>diagnostic_string

<span style="color:#60a0b0;font-style:italic"># Or</span>
<span style="color:#007020">require</span> <span style="color:#4070a0">'pp'</span>
pp input_object(<span style="color:#4070a0">'troublesome_input'</span>)<span style="color:#666">.</span>events
</code></pre></div>
<p><code>diagnostic_string</code> assembles the Event Log into a printable log message for convenience.</p> <p>The Event Log contains entries for every time that the value changed, as well as one for when the input was first created. When possible, stack probing is used to determine file and line numbers. Most importantly, you will see priority numbers; remember that highest priority wins; order only matters to break a tie.</p> </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; Chef Software, Inc.<br>Licensed under the Creative Commons Attribution 3.0 Unported License.<br>The Chef&trade; Mark and Chef Logo are either registered trademarks/service marks or trademarks/servicemarks of Chef, in the United States and other countries and are used with Chef Inc's permission.<br>We are not affiliated with, endorsed or sponsored by Chef Inc.<br>
    <a href="https://docs.chef.io/inspec/inputs/" class="_attribution-link">https://docs.chef.io/inspec/inputs/</a>
  </p>
</div>
