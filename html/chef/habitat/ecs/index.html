<div id="col-content" data-swiftype-index="true"> <div id="amazon-ecs"><h1>Amazon ECS</h1></div>  <div class="prose"> <p data-swiftype-index="false"> <a href="https://github.com/habitat-sh/habitat/tree/main/components/docs-chef-io/content/habitat/ecs.md" alt="Link to page on GitHub repository">[edit on GitHub]</a> </p> <p>Amazon Web Services provides a container management service called <a href="https://aws.amazon.com/ecs/">EC2 Container Service (ECS)</a>. ECS provides a Docker registry, container hosting and tooling to make deploying Docker-based containers fairly straightforward. ECS will schedule and deploy your Docker containers within a Task while Chef Habitat manages the applications.</p> <h2 id="ec2-container-registry">EC2 Container Registry</h2> <p><a href="https://aws.amazon.com/ecr/">EC2 Container Registry (ECR)</a> is a fully-managed Docker registry provided by Amazon Web Services. Applications exported to Docker with <code>hab pkg export docker</code> put the containers into namespaced repositories, so you will need to create these within ECR. For example, if you were building <code>core/mongodb</code> containers you would use the following command:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">$ aws ecr create-repository --repository-name core/mongodb
</code></pre></div>
<p>To tag and push the images to the ECR you will use your Repository URI (substituting your <strong>aws_account_id</strong> and availability zone).</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">$ docker tag core/mongodb:latest aws_account_id.dkr.ecr.ap-southeast-2.amazonaws.com/core/mongodb:latest
$ docker push aws_account_id.dkr.ecr.ap-southeast-2.amazonaws.com/core/mongodb:latest
</code></pre></div>
<h2 id="ec2-compute-service">EC2 Compute Service</h2> <p>Once Docker images are pushed to ECR, they may be run on Amazonâ€™s ECS within a <a href="https://docs.aws.amazon.com/AmazonECS/latest/developerguide/task_defintions.html">Task Definition</a> which may be expressed as a <a href="https://docs.aws.amazon.com/AmazonECS/latest/developerguide/cmd-ecs-cli-compose.html">Docker Compose file</a>. Here is an example of a Tomcat application using a Mongo database demonstrating using Chef Habitat-managed containers:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-yaml" data-lang="yaml"><span style="color:#062873;font-weight:700">version</span>:<span style="color:#4070a0">'2'</span><span style="color:#062873;font-weight:700">services</span>:<span style="color:#062873;font-weight:700">mongo</span>:<span style="color:#062873;font-weight:700">image</span>:aws_account_id.dkr.ecr.ap-southeast-2.amazonaws.com/username/mongodb:latest<span style="color:#062873;font-weight:700">hostname</span>:<span style="color:#4070a0">"mongodb"</span><span style="color:#062873;font-weight:700">national-parks</span>:<span style="color:#062873;font-weight:700">image</span>:aws_account_id.dkr.ecr.ap-southeast-2.amazonaws.com/username/national-parks:latest<span style="color:#062873;font-weight:700">ports</span>:- <span style="color:#4070a0">"8080:8080"</span><span style="color:#062873;font-weight:700">links</span>:- mongo<span style="color:#062873;font-weight:700">command</span>:--peer mongodb --bind database:mongodb.default</code></pre></div>
<p>From the example, the <code>mongo</code> and <code>national-parks</code> services use the Docker images from the ECR. The <code>links</code> entry manages the deployment order of the container and according to the <a href="https://docs.docker.com/engine/userguide/networking/default_network/dockerlinks/#/updating-the-etchosts-file">Docker Compose documentation</a> <code>links</code> should create <code>/etc/hosts</code> entries. This does not appear to currently work with ECS so we assign the <code>hostname: "mongodb"</code>.</p> <p>The <code>command</code> entry for the National Parks Tomcat application allows the Chef Habitat Supervisor to <code>--peer</code> to the <code>mongo</code> gossip ring and <code>--bind</code> applies <code>database</code> entries to its Mongo configuration.</p> <h2 id="related-reading">Related Reading</h2> <ul> <li>
<a href="https://blog.chef.io/a-journey-with-habitat-on-amazon-ecs-part-1/">A Journey with Chef Habitat on Amazon ECS, Part 1</a>)</li> <li><a href="https://blog.chef.io/a-journey-with-habitat-on-amazon-ecs-part-2/">A Journey with Chef Habitat on Amazon ECS, Part 2</a></li> </ul> </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; Chef Software, Inc.<br>Licensed under the Creative Commons Attribution 3.0 Unported License.<br>The Chef&trade; Mark and Chef Logo are either registered trademarks/service marks or trademarks/servicemarks of Chef, in the United States and other countries and are used with Chef Inc's permission.<br>We are not affiliated with, endorsed or sponsored by Chef Inc.<br>
    <a href="https://docs.chef.io/habitat/ecs/" class="_attribution-link">https://docs.chef.io/habitat/ecs/</a>
  </p>
</div>
