<div id="col-content" data-swiftype-index="true"> <div id="debug-recipes-chef-infra-client-runs"><h1>Debug Recipes, Chef Infra Client Runs</h1></div>  <div class="prose"> <p data-swiftype-index="false"> <a href="https://github.com/chef/chef-web-docs/blob/main/content/debug.md" alt="Link to page on GitHub repository">[edit on GitHub]</a> </p> <p>Elements of good approaches to building cookbooks and recipes that are reliable include:</p> <ul> <li>A consistent syntax pattern when constructing recipes</li> <li>Using the same patterns in Ruby</li> <li>Using resources included in Chef Infra Client or community cookbooks before creating custom ones</li> </ul> <p>Ideally, the best way to debug a recipe is to not have to debug it in the first place. That said, the following sections discuss various approaches to debugging recipes and failed Chef Infra Client runs.</p> <h2 id="basic">Basic</h2> <p>Some simple ways to quickly identify common issues that can trigger recipe and/or Chef Infra Client run failures include:</p> <ul> <li>Using an empty run-list</li> <li>Using verbose logging with knife</li> <li>Using logging with Chef Infra Client</li> <li>Using the <strong>log</strong> resource in a recipe to define custom logging</li> </ul> <h3 id="empty-run-lists">Empty Run-lists</h3> <p>Use an empty run-list to determine if a failed Chef Infra Client run has anything to do with the recipes that are defined within that run-list. This is a quick way to discover if the underlying cause of a Chef Infra Client run failure is a configuration issue. If a failure persists even if the run-list is empty, check the following:</p> <ul> <li>Configuration settings in the config.rb file</li> <li>Permissions for the user to both the Chef Infra Server and to the node on which a Chef Infra Client run is to take place</li> </ul> <h3 id="knife">Knife</h3> <p>Use the verbose logging that is built into knife:</p> <dl> <dt>
<code>-V</code>, <code>--verbose</code>
</dt> <dd> <p>Set for more verbose outputs. Use <code>-VV</code> for much more verbose outputs. Use <code>-VVV</code> for maximum verbosity, which may provide more information than is actually helpful.</p> </dd> </dl> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> Plugins do not always support verbose logging. </div> </div> <h3 id="chef-infra-client">Chef Infra Client</h3> <p>Use the verbose logging that is built into Chef Infra Client:</p> <dl> <dt>
<code>-l LEVEL</code>, <code>--log_level LEVEL</code>
</dt> <dd> <p>The level of logging to be stored in a log file. Possible levels: <code>auto</code> (default), <code>debug</code>, <code>error</code>, <code>fatal</code>, <code>info</code>, <code>trace</code>, or <code>warn</code>. Default value: <code>warn</code> (when a terminal is available) or <code>info</code> (when a terminal is not available).</p> </dd> <dt>
<code>-L LOGLOCATION</code>, <code>--logfile c</code>
</dt> <dd> <p>The location of the log file. This is recommended when starting any executable as a daemon. Default value: <code>STDOUT</code>.</p> </dd> </dl> <h3 id="log-resource">log Resource</h3> <p>Use the <strong>log</strong> resource to create log entries. The <strong>log</strong> resource behaves like any other resource: built into the resource collection during the compile phase, and then run during the execution phase. (To create a log entry that is not built into the resource collection, use <code>Chef::Log</code> instead of the <strong>log</strong> resource.)</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>By default, every log resource that executes will count as an updated resource in the updated resource count at the end of a Chef run. You can disable this behavior by adding <code>count_log_resource_updates false</code> to your Chef <code>client.rb</code> configuration file.</p> </div> </div> <p>New in 12.0, <code>-o RUN_LIST_ITEM</code>. Changed in 12.0 <code>-f</code> no longer allows unforked intervals, <code>-i SECONDS</code> is applied before a Chef Infra Client run.</p> <h4 id="syntax">Syntax</h4> <p>A <strong>log</strong> resource block adds messages to the log file based on events that occur during a Chef Infra Client run:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">log <span style="color:#4070a0">'message'</span> <span style="color:#007020;font-weight:700">do</span>
  message <span style="color:#4070a0">'A message add to the log.'</span>
  level <span style="color:#517918">:info</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>The full syntax for all of the properties that are available to the <strong>log</strong> resource is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">log <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  level        <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># default value: :info</span>
  message      <span style="color:#007020">String</span> <span style="color:#60a0b0;font-style:italic"># default value: 'name' unless specified</span>
  action       <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :write if not specified</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>where:</p> <ul> <li>
<code>log</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>level</code> and <code>message</code> are the properties available to this resource.</li> </ul> <h4 id="actions">Actions</h4> <p>The log resource has the following actions:</p> <dl> <dt><code>:nothing</code></dt> <dd> <p>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</p> </dd> <dt><code>:write</code></dt> <dd> <p>Default. Write to log.</p> </dd> </dl> <h4 id="properties">Properties</h4> <p>The log resource has the following properties:</p> <dl> <dt><code>level</code></dt> <dd> <p><strong>Ruby Type:</strong> Symbol | <strong>Default Value:</strong> <code>:info</code></p> <p>The logging level for displaying this message. Options (in order of priority): <code>:debug</code>, <code>:info</code>, <code>:warn</code>, <code>:error</code>, and <code>:fatal</code>.</p> </dd> <dt><code>message</code></dt> <dd> <p><strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The resource block's name</code></p> <p>The message to be added to a log file. Default value: the <code>name</code> of the resource block. See “Syntax” section above for more information.</p> </dd> </dl> <h4 id="examples">Examples</h4> <p>The following examples demonstrate various approaches for using resources in recipes:</p> <h5 id="specify-a-log-entry">Specify a log entry</h5> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">log <span style="color:#4070a0">'a string to log'</span>
</code></pre></div>
<h5 id="set-debug-logging-level">Set debug logging level</h5> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">log <span style="color:#4070a0">'a debug string'</span> <span style="color:#007020;font-weight:700">do</span>
  level <span style="color:#517918">:debug</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<h5 id="create-log-entry-when-the-contents-of-a-data-bag-are-used">Create log entry when the contents of a data bag are used</h5> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">log <span style="color:#4070a0">'a debug string'</span> <span style="color:#007020;font-weight:700">do</span>
  level <span style="color:#517918">:debug</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<h5 id="add-a-message-to-a-log-file">Add a message to a log file</h5> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">log <span style="color:#4070a0">'message'</span> <span style="color:#007020;font-weight:700">do</span>
  message <span style="color:#4070a0">'This is the message that will be added to the log.'</span>
  level <span style="color:#517918">:info</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<h2 id="advanced">Advanced</h2> <p>Some more complex ways to debug issues with a Chef Infra Client run include:</p> <ul> <li>Using the <strong>chef_handler</strong> resource</li> <li>Using the chef-shell and the <strong>breakpoint</strong> resource to add breakpoints to recipes, and to then step through the recipes using the breakpoints</li> <li>Using the <code>debug_value</code> method from chef-shell to identify the location(s) from which attribute values are being set</li> <li>Using the <code>ignore_failure</code> method in a recipe to force Chef Infra Client to move past an error to see what else is going on in the recipe, outside of a known failure</li> <li>Using chef-solo to run targeted Chef Infra Client runs for specific scenarios</li> </ul> <h3 id="chef_handler">chef_handler</h3> <p>Use a handler to identify situations that arise during a Chef Infra Client run, and then tell Chef Infra Client how to handle these situations when they occur.</p> <p>There are three types of handlers:</p> <table> <col style="width:12%"> <col style="width:87%"> <thead> <tr class="header"> <th>Handler</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td>exception</td> <td>An exception handler is used to identify situations that have caused a Chef Infra Client run to fail. An exception handler can be loaded at the start of a Chef Infra Client run by adding a recipe that contains the <strong>chef_handler</strong> resource to a node's run-list. An exception handler runs when the <code>failed?</code> property for the <code>run_status</code> object returns <code>true</code>.</td> </tr> <tr> <td>report</td> <td>A report handler is used when a Chef Infra Client run succeeds and reports back on certain details about that Chef Infra Client run. A report handler can be loaded at the start of a Chef Infra Client run by adding a recipe that contains the <strong>chef_handler</strong> resource to a node's run-list. A report handler runs when the <code>success?</code> property for the <code>run_status</code> object returns <code>true</code>.</td> </tr> <tr> <td>start</td> <td>A start handler is used to run events at the beginning of a Chef Infra Client run. A start handler can be loaded at the start of a Chef Infra Client run by adding the start handler to the <code>start_handlers</code> setting in the client.rb file or by installing the gem that contains the start handler by using the <strong>chef_gem</strong> resource in a recipe in the <strong>chef-client</strong> cookbook. (A start handler may not be loaded using the <code>chef_handler</code> resource.)</td> </tr> </tbody> </table> <p>Read more <a href="../handlers/index.html">about exception, report, and start handlers</a>.</p> <h3 id="chef-shell">chef-shell</h3> <p>chef-shell is a recipe debugging tool that allows the use of breakpoints within recipes. chef-shell runs as an Interactive Ruby (IRb) session. chef-shell supports both recipe and attribute file syntax, as well as interactive debugging features.</p> <p>chef-shell is tool that is run using an Interactive Ruby (IRb) session. chef-shell currently supports recipe and attribute file syntax, as well as interactive debugging features. chef-shell has three run modes:</p> <table> <col style="width:40%"> <col style="width:60%"> <thead> <tr class="header"> <th>Mode</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td>Standalone</td> <td>Default. No cookbooks are loaded, and the run-list is empty.</td> </tr> <tr> <td>Solo</td> <td>chef-shell acts as a Chef Solo Client. It attempts to load the chef-solo configuration file at <code>~/.chef/config.rb</code> and any JSON attributes passed. If the JSON attributes set a run-list, it will be honored. Cookbooks will be loaded in the same way that chef-solo loads them. chef-solo mode is activated with the <code>-s</code> or <code>--solo</code> command line option, and JSON attributes are specified in the same way as for chef-solo, with <code>-j /path/to/chef-solo.json</code>.</td> </tr> <tr> <td>Client</td> <td>chef-shell acts as a Chef Infra Client. During startup, it reads the Chef Infra Client configuration file from <code>~/.chef/client.rb</code> and contacts the Chef Infra Server to get the node's run_list, attributes, and cookbooks. Chef Infra Client mode is activated with the <code>-z</code> or <code>--client</code> options. You can also specify the configuration file with <code>-c CONFIG</code> and the server URL with <code>-S SERVER_URL</code>.</td> </tr> </tbody> </table> <h4 id="configure">Configure</h4> <p>chef-shell determines which configuration file to load based on the following:</p> <ol> <li>If a configuration file is specified using the <code>-c</code> option, chef-shell will use the specified configuration file</li> <li>If a NAMED_CONF is given, chef-shell will load ~/.chef/NAMED_CONF/chef_shell.rb</li> <li>If no NAMED_CONF is given chef-shell will load ~/.chef/chef_shell.rb if it exists</li> <li>If no chef_shell.rb can be found, chef-shell falls back to load: <ul> <li>/etc/chef/client.rb if -z option is given.</li> <li>/etc/chef/solo.rb if –solo-legacy-mode option is given.</li> <li>.chef/config.rb if -s option is given.</li> <li>.chef/knife.rb if -s option is given.</li> </ul> </li> </ol> <h4 id="chef-shellrb">chef-shell.rb</h4> <p>The chef-shell.rb file can be used to configure chef-shell in the same way as the client.rb file is used to configure Chef Infra Client. For example, to configure chef-shell to authenticate to the Chef Infra Server, copy the <code>node_name</code>, <code>client_key</code>, and <code>chef_server_url</code> settings from the config.rb file:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">node_name                <span style="color:#4070a0">'your-knife-clientname'</span>
client_key               <span style="color:#60add5">File</span><span style="color:#666">.</span>expand_path(<span style="color:#4070a0">'~/.chef/my-client.pem'</span>)
chef_server_url          <span style="color:#4070a0">'https://api.opscode.com/organizations/myorg'</span>
</code></pre></div>
<p>and then add them to the chef-shell.rb file. Other configuration possibilities include disabling Ohai plugins (which will speed up the chef-shell boot process) or including arbitrary Ruby code in the chef-shell.rb file.</p> <h4 id="run-as-a-chef-infra-client">Run as a Chef Infra Client</h4> <p>By default, chef-shell loads in standalone mode and does not connect to the Chef Infra Server. The chef-shell can be run as a Chef Infra Client to verify functionality that is only available when Chef Infra Client connects to the Chef Infra Server, such as search functionality or accessing data stored in data bags.</p> <p>chef-shell can use the same credentials as knife when connecting to a Chef Infra Server. Make sure that the settings in chef-shell.rb are the same as those in config.rb, and then use the <code>-z</code> option as part of the command. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-shell -z
</code></pre></div>
<h4 id="manage">Manage</h4> <p>When chef-shell is configured to access a Chef Infra Server, chef-shell can list, show, search for and edit cookbooks, clients, nodes, roles, environments, policyfiles, and data bags.</p> <p>The syntax for managing objects on the Chef Infra Server is as follows:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-shell -z named_configuration
</code></pre></div>
<p>Where:</p> <ul> <li>
<code>named_configuration</code> is an existing configuration file in <code>~/.chef/named_configuration/chef_shell.rb</code>, such as <code>production</code>, <code>staging</code>, or <code>test</code>.</li> </ul> <p>Once in chef-shell, commands can be run against objects as follows:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef <span style="color:#666">(</span>preprod<span style="color:#666">)</span> &gt; items.command
</code></pre></div>
<p>Where:</p> <ul> <li>
<code>items</code> is the type of item to search for: <code>cookbooks</code>, <code>clients</code>, <code>nodes</code>, <code>roles</code>, <code>environments</code> or a data bag.</li> <li>
<code>command</code> is the command: <code>list</code>, <code>show</code>, <code>find</code>, or <code>edit</code>.</li> </ul> <p>For example, to list all of the nodes in a configuration named “preprod”, enter:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef <span style="color:#666">(</span>preprod<span style="color:#666">)</span> &gt; nodes.list
</code></pre></div>
<p>Which will return something similar to:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash"><span style="color:#666">=</span>&gt; <span style="color:#666">[</span>node<span style="color:#666">[</span>i-f09a939b<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-049a936f<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-eaaaa581<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-9154b1fb<span style="color:#666">]</span>,
    node<span style="color:#666">[</span>i-6a213101<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-c2687aa9<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-7abeaa11<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-4eb8ac25<span style="color:#666">]</span>,
    node<span style="color:#666">[</span>i-9a2030f1<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-a06875cb<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-145f457f<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-e032398b<span style="color:#666">]</span>,
    node<span style="color:#666">[</span>i-dc8c98b7<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-6afdf401<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-f49b119c<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-5abfab31<span style="color:#666">]</span>,
    node<span style="color:#666">[</span>i-78b8ac13<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-d99678b3<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-02322269<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-feb4a695<span style="color:#666">]</span>,
    node<span style="color:#666">[</span>i-9e2232f5<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-6e213105<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-cdde3ba7<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-e8bfb083<span style="color:#666">]</span>,
    node<span style="color:#666">[</span>i-743c2c1f<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-2eaca345<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-aa7f74c1<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-72fdf419<span style="color:#666">]</span>,
    node<span style="color:#666">[</span>i-140e1e7f<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-f9d43193<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-bd2dc8d7<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-8e7f70e5<span style="color:#666">]</span>,
    node<span style="color:#666">[</span>i-78f2e213<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-962232fd<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-4c322227<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-922232f9<span style="color:#666">]</span>,
    node<span style="color:#666">[</span>i-c02728ab<span style="color:#666">]</span>, node<span style="color:#666">[</span>i-f06c7b9b<span style="color:#666">]]</span>
</code></pre></div>
<p>The <code>list</code> command can take a code block, which will applied (but not saved), to each object that is returned from the server. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef <span style="color:#666">(</span>preprod<span style="color:#666">)</span> &gt; nodes.list <span style="color:#666">{</span>|n| puts <span style="color:#4070a0">"#{n.name}: #{n.run_list}"</span> <span style="color:#666">}</span>
</code></pre></div>
<p>will return something similar to:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash"><span style="color:#666">=</span>&gt; i-f09a939b: role<span style="color:#666">[</span>lb<span style="color:#666">]</span>, role<span style="color:#666">[</span>preprod<span style="color:#666">]</span>, recipe<span style="color:#666">[</span>aws<span style="color:#666">]</span>
   i-049a936f: role<span style="color:#666">[</span>lb<span style="color:#666">]</span>, role<span style="color:#666">[</span>preprod<span style="color:#666">]</span>, recipe<span style="color:#666">[</span>aws<span style="color:#666">]</span>
   i-9154b1fb: recipe<span style="color:#666">[</span>erlang<span style="color:#666">]</span>, role<span style="color:#666">[</span>base<span style="color:#666">]</span>, role<span style="color:#666">[</span>couchdb<span style="color:#666">]</span>, role<span style="color:#666">[</span>preprod<span style="color:#666">]</span>,
   i-6a213101: role<span style="color:#666">[</span>chef<span style="color:#666">]</span>, role<span style="color:#666">[</span>preprod<span style="color:#666">]</span>
   <span style="color:#60a0b0;font-style:italic"># more...</span>
</code></pre></div>
<p>The <code>show</code> command can be used to display a specific node. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef <span style="color:#666">(</span>preprod<span style="color:#666">)</span> &gt; <span style="color:#bb60d5">load_balancer</span> <span style="color:#666">=</span> nodes.show<span style="color:#666">(</span><span style="color:#4070a0">'i-f09a939b'</span><span style="color:#666">)</span>
</code></pre></div>
<p>will return something similar to:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash"><span style="color:#666">=</span>&gt; node<span style="color:#666">[</span>i-f09a939b<span style="color:#666">]</span>
</code></pre></div>
<p>Or:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef <span style="color:#666">(</span>preprod<span style="color:#666">)</span> &gt; load_balancer.ec2.public_hostname
</code></pre></div>
<p>will return something similar to:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash"><span style="color:#666">=</span>&gt; <span style="color:#4070a0">"ec2-111-22-333-44.compute-1.amazonaws.com"</span>
</code></pre></div>
<p>The <code>find</code> command can be used to search the Chef Infra Server from the chef-shell. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef <span style="color:#666">(</span>preprod<span style="color:#666">)</span> &gt; pp nodes.find<span style="color:#666">(</span>:ec2_public_hostname <span style="color:#666">=</span>&gt; <span style="color:#4070a0">'ec2*'</span><span style="color:#666">)</span>
</code></pre></div>
<p>You can also format the results with a code block. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef <span style="color:#666">(</span>preprod<span style="color:#666">)</span> &gt; pp nodes.find<span style="color:#666">(</span>:ec2_public_hostname <span style="color:#666">=</span>&gt; <span style="color:#4070a0">'ec2*'</span><span style="color:#666">)</span> <span style="color:#666">{</span>|n| n.ec2.ami_id <span style="color:#666">}</span> and nil
</code></pre></div>
<p>will return something similar to:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash"><span style="color:#666">=</span>&gt; <span style="color:#666">[</span><span style="color:#4070a0">"ami-f8927a91"</span>,
    <span style="color:#4070a0">"ami-f8927a91"</span>,
    <span style="color:#4070a0">"ami-a89870c1"</span>,
    <span style="color:#4070a0">"ami-a89870c1"</span>,
    <span style="color:#4070a0">"ami-a89870c1"</span>,
    <span style="color:#4070a0">"ami-a89870c1"</span>,
    <span style="color:#4070a0">"ami-a89870c1"</span>
    <span style="color:#60a0b0;font-style:italic"># and more...</span>
</code></pre></div>
<p>Or:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef <span style="color:#666">(</span>preprod<span style="color:#666">)</span> &gt; <span style="color:#bb60d5">amis</span> <span style="color:#666">=</span> nodes.find<span style="color:#666">(</span>:ec2_public_hostname <span style="color:#666">=</span>&gt; <span style="color:#4070a0">'ec2*'</span><span style="color:#666">)</span> <span style="color:#666">{</span>|n| n.ec2.ami_id <span style="color:#666">}</span>
chef <span style="color:#666">(</span>preprod<span style="color:#666">)</span> &gt; puts amis.uniq.sort
</code></pre></div>
<p>will return something similar to:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash"><span style="color:#666">=</span>&gt; ami-4b4ba522
   ami-a89870c1
   ami-eef61587
   ami-f8927a91
</code></pre></div>
<h3 id="breakpoint-resource">breakpoint Resource</h3> <p>chef-shell allows the current position in a run-list to be manipulated during a Chef Infra Client run. Add breakpoints to a recipe to take advantage of this functionality.</p> <p>Use the <strong>breakpoint</strong> resource to add breakpoints to recipes. Run the chef-shell in Chef Infra Client mode, and then use those breakpoints to debug recipes. Breakpoints are ignored by Chef Infra Client during an actual Chef Infra Client run. That said, breakpoints are typically used to debug recipes only when running them in a non-production environment, after which they are removed from those recipes before the parent cookbook is uploaded to the Chef Infra Server.</p> <h4 id="syntax-1">Syntax</h4> <p>A <strong>breakpoint</strong> resource block creates a breakpoint in a recipe:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">breakpoint <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:break</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>where</p> <ul> <li>
<code>:break</code> will tell Chef Infra Client to stop running a recipe; can only be used when Chef Infra Client is being run in chef-shell mode</li> </ul> <h4 id="actions-1">Actions</h4> <p>The breakpoint resource has the following actions:</p> <dl> <dt><code>:break</code></dt> <dd> <p>Use to add a breakpoint to a recipe.</p> </dd> <dt><code>:nothing</code></dt> <dd> <p>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</p> </dd> </dl> <h4 id="attributes">Attributes</h4> <p>This resource does not have any properties.</p> <h4 id="examples-1">Examples</h4> <p>The following examples demonstrate various approaches for using resources in recipes:</p> <h5 id="a-recipe-without-a-breakpoint">A recipe without a breakpoint</h5> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">yum_key node<span style="color:#666">[</span><span style="color:#4070a0">'yum'</span><span style="color:#666">][</span><span style="color:#4070a0">'elrepo'</span><span style="color:#666">][</span><span style="color:#4070a0">'key'</span><span style="color:#666">]</span> <span style="color:#007020;font-weight:700">do</span>
  url  node<span style="color:#666">[</span><span style="color:#4070a0">'yum'</span><span style="color:#666">][</span><span style="color:#4070a0">'elrepo'</span><span style="color:#666">][</span><span style="color:#4070a0">'key_url'</span><span style="color:#666">]</span>
  action <span style="color:#517918">:add</span>
<span style="color:#007020;font-weight:700">end</span>

yum_repository <span style="color:#4070a0">'elrepo'</span> <span style="color:#007020;font-weight:700">do</span>
  description <span style="color:#4070a0">'ELRepo.org Community Enterprise Linux Extras Repository'</span>
  key node<span style="color:#666">[</span><span style="color:#4070a0">'yum'</span><span style="color:#666">][</span><span style="color:#4070a0">'elrepo'</span><span style="color:#666">][</span><span style="color:#4070a0">'key'</span><span style="color:#666">]</span>
  mirrorlist node<span style="color:#666">[</span><span style="color:#4070a0">'yum'</span><span style="color:#666">][</span><span style="color:#4070a0">'elrepo'</span><span style="color:#666">][</span><span style="color:#4070a0">'url'</span><span style="color:#666">]</span>
  includepkgs node<span style="color:#666">[</span><span style="color:#4070a0">'yum'</span><span style="color:#666">][</span><span style="color:#4070a0">'elrepo'</span><span style="color:#666">][</span><span style="color:#4070a0">'includepkgs'</span><span style="color:#666">]</span>
  exclude node<span style="color:#666">[</span><span style="color:#4070a0">'yum'</span><span style="color:#666">][</span><span style="color:#4070a0">'elrepo'</span><span style="color:#666">][</span><span style="color:#4070a0">'exclude'</span><span style="color:#666">]</span>
  action <span style="color:#517918">:create</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<h5 id="the-same-recipe-with-breakpoints">The same recipe with breakpoints</h5> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">breakpoint <span style="color:#4070a0">"before yum_key node['yum']['repo_name']['key']"</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:break</span>
<span style="color:#007020;font-weight:700">end</span>

yum_key node<span style="color:#666">[</span><span style="color:#4070a0">'yum'</span><span style="color:#666">][</span><span style="color:#4070a0">'repo_name'</span><span style="color:#666">][</span><span style="color:#4070a0">'key'</span><span style="color:#666">]</span> <span style="color:#007020;font-weight:700">do</span>
  url  node<span style="color:#666">[</span><span style="color:#4070a0">'yum'</span><span style="color:#666">][</span><span style="color:#4070a0">'repo_name'</span><span style="color:#666">][</span><span style="color:#4070a0">'key_url'</span><span style="color:#666">]</span>
  action <span style="color:#517918">:add</span>
<span style="color:#007020;font-weight:700">end</span>

breakpoint <span style="color:#4070a0">"after yum_key node['yum']['repo_name']['key']"</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:break</span>
<span style="color:#007020;font-weight:700">end</span>

breakpoint <span style="color:#4070a0">"before yum_repository 'repo_name'"</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:break</span>
<span style="color:#007020;font-weight:700">end</span>

yum_repository <span style="color:#4070a0">'repo_name'</span> <span style="color:#007020;font-weight:700">do</span>
  description <span style="color:#4070a0">'description'</span>
  key node<span style="color:#666">[</span><span style="color:#4070a0">'yum'</span><span style="color:#666">][</span><span style="color:#4070a0">'repo_name'</span><span style="color:#666">][</span><span style="color:#4070a0">'key'</span><span style="color:#666">]</span>
  mirrorlist node<span style="color:#666">[</span><span style="color:#4070a0">'yum'</span><span style="color:#666">][</span><span style="color:#4070a0">'repo_name'</span><span style="color:#666">][</span><span style="color:#4070a0">'url'</span><span style="color:#666">]</span>
  includepkgs node<span style="color:#666">[</span><span style="color:#4070a0">'yum'</span><span style="color:#666">][</span><span style="color:#4070a0">'repo_name'</span><span style="color:#666">][</span><span style="color:#4070a0">'includepkgs'</span><span style="color:#666">]</span>
  exclude node<span style="color:#666">[</span><span style="color:#4070a0">'yum'</span><span style="color:#666">][</span><span style="color:#4070a0">'repo_name'</span><span style="color:#666">][</span><span style="color:#4070a0">'exclude'</span><span style="color:#666">]</span>
  action <span style="color:#517918">:create</span>
<span style="color:#007020;font-weight:700">end</span>

breakpoint <span style="color:#4070a0">"after yum_repository 'repo_name'"</span> <span style="color:#007020;font-weight:700">do</span>
  action <span style="color:#517918">:break</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>where the name of each breakpoint is an arbitrary string. In the previous examples, the names are used to indicate if the breakpoint is before or after a resource, and then also to specify which resource.</p> <h3 id="step-through-run-list">Step Through Run-list</h3> <p>To explore how using the <strong>breakpoint</strong> to manually step through a Chef Infra Client run, create a simple recipe in chef-shell:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef &gt; recipe_mode
  chef:recipe &gt; <span style="color:#007020">echo</span> off
  chef:recipe &gt; file <span style="color:#4070a0">"/tmp/before-breakpoint"</span>
  chef:recipe &gt; breakpoint <span style="color:#4070a0">"foo"</span>
  chef:recipe &gt; file <span style="color:#4070a0">"/tmp/after-breakpoint"</span>
</code></pre></div>
<p>and then run Chef Infra Client:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef:recipe &gt; run_chef
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 14:17:49 -0800<span style="color:#666">]</span> DEBUG: Processing file<span style="color:#666">[</span>/tmp/before-breakpoint<span style="color:#666">]</span>
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 14:17:49 -0800<span style="color:#666">]</span> DEBUG: file<span style="color:#666">[</span>/tmp/before-breakpoint<span style="color:#666">]</span> using Chef::Provider::File
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 14:17:49 -0800<span style="color:#666">]</span> INFO: Creating file<span style="color:#666">[</span>/tmp/before-breakpoint<span style="color:#666">]</span> at /tmp/before-breakpoint
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 14:17:49 -0800<span style="color:#666">]</span> DEBUG: Processing <span style="color:#666">[</span>./bin/../lib/chef/mixin/recipe_definition_dsl_core.rb:56:in <span style="color:#4070a0">'new'</span><span style="color:#666">]</span>
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 14:17:49 -0800<span style="color:#666">]</span> DEBUG: <span style="color:#666">[</span>./bin/../lib/chef/mixin/recipe_definition_dsl_core.rb:56:in <span style="color:#4070a0">'new'</span><span style="color:#666">]</span> using Chef::Provider::Breakpoint
</code></pre></div>
<p>Chef Infra Client ran the first resource before the breakpoint (<code>file[/tmp/before-breakpoint]</code>), but then stopped after execution. Chef Infra Client attempted to name the breakpoint after its position in the source file, but Chef Infra Client was confused because the resource was entered interactively. From here, chef-shell can resume the interrupted Chef Infra Client run:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef:recipe &gt; chef_run.resume
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 14:27:08 -0800<span style="color:#666">]</span> INFO: Creating file<span style="color:#666">[</span>/tmp/after-breakpoint<span style="color:#666">]</span> at /tmp/after-breakpoint
</code></pre></div>
<p>A quick view of the <code>/tmp</code> directory shows that the following files were created:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">after-breakpoint
before-breakpoint
</code></pre></div>
<p>You can rewind and step through a Chef Infra Client run:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef:recipe &gt; Chef::Log.level <span style="color:#666">=</span> :debug <span style="color:#60a0b0;font-style:italic"># debug logging won't turn on automatically in this case</span>
    <span style="color:#666">=</span>&gt; :debug
  chef:recipe &gt; chef_run.rewind
    <span style="color:#666">=</span>&gt; <span style="color:#40a070">0</span>
  chef:recipe &gt; chef_run.step
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 14:40:52 -0800<span style="color:#666">]</span> DEBUG: Processing file<span style="color:#666">[</span>/tmp/before-breakpoint<span style="color:#666">]</span>
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 14:40:52 -0800<span style="color:#666">]</span> DEBUG: file<span style="color:#666">[</span>/tmp/before-breakpoint<span style="color:#666">]</span> using Chef::Provider::File
    <span style="color:#666">=</span>&gt; <span style="color:#40a070">1</span>
  chef:recipe &gt; chef_run.step
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 14:40:54 -0800<span style="color:#666">]</span> DEBUG: Processing <span style="color:#666">[</span>./bin/../lib/chef/mixin/recipe_definition_dsl_core.rb:56:in <span style="color:#4070a0">'new'</span><span style="color:#666">]</span>
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 14:40:54 -0800<span style="color:#666">]</span> DEBUG: <span style="color:#666">[</span>./bin/../lib/chef/mixin/recipe_definition_dsl_core.rb:56:in <span style="color:#4070a0">'new'</span><span style="color:#666">]</span> using Chef::Provider::Breakpoint
    <span style="color:#666">=</span>&gt; <span style="color:#40a070">2</span>
  chef:recipe &gt; chef_run.step
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 14:40:56 -0800<span style="color:#666">]</span> DEBUG: Processing file<span style="color:#666">[</span>/tmp/after-breakpoint<span style="color:#666">]</span>
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 14:40:56 -0800<span style="color:#666">]</span> DEBUG: file<span style="color:#666">[</span>/tmp/after-breakpoint<span style="color:#666">]</span> using Chef::Provider::File
    <span style="color:#666">=</span>&gt; <span style="color:#40a070">3</span>
</code></pre></div>
<p>From the output, the rewound run-list is shown, but when the resources are executed again, they will repeat their checks for the existence of files. If they exist, Chef Infra Client will skip creating them. If the files are deleted, then:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef:recipe &gt; ls<span style="color:#666">(</span><span style="color:#4070a0">"/tmp"</span><span style="color:#666">)</span>.grep<span style="color:#666">(</span>/breakpoint/<span style="color:#666">)</span>.each <span style="color:#666">{</span>|f| rm <span style="color:#4070a0">"/tmp/#{f}"</span> <span style="color:#666">}</span>
    <span style="color:#666">=</span>&gt; <span style="color:#666">[</span><span style="color:#4070a0">"after-breakpoint"</span>, <span style="color:#4070a0">"before-breakpoint"</span><span style="color:#666">]</span>
</code></pre></div>
<p>Rewind, and then resume your Chef Infra Client run to get the expected results:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef:recipe &gt; chef_run.rewind
  chef:recipe &gt; chef_run.resume
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 14:48:56 -0800<span style="color:#666">]</span> DEBUG: Processing file<span style="color:#666">[</span>/tmp/before-breakpoint<span style="color:#666">]</span>
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 14:48:56 -0800<span style="color:#666">]</span> DEBUG: file<span style="color:#666">[</span>/tmp/before-breakpoint<span style="color:#666">]</span> using Chef::Provider::File
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 14:48:56 -0800<span style="color:#666">]</span> INFO: Creating file<span style="color:#666">[</span>/tmp/before-breakpoint<span style="color:#666">]</span> at /tmp/before-breakpoint
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 14:48:56 -0800<span style="color:#666">]</span> DEBUG: Processing <span style="color:#666">[</span>./bin/../lib/chef/mixin/recipe_definition_dsl_core.rb:56:in <span style="color:#4070a0">'new'</span><span style="color:#666">]</span>
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 14:48:56 -0800<span style="color:#666">]</span> DEBUG: <span style="color:#666">[</span>./bin/../lib/chef/mixin/recipe_definition_dsl_core.rb:56:in <span style="color:#4070a0">'new'</span><span style="color:#666">]</span> using Chef::Provider::Breakpoint
  chef:recipe &gt; chef_run.resume
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 14:49:20 -0800<span style="color:#666">]</span> DEBUG: Processing file<span style="color:#666">[</span>/tmp/after-breakpoint<span style="color:#666">]</span>
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 14:49:20 -0800<span style="color:#666">]</span> DEBUG: file<span style="color:#666">[</span>/tmp/after-breakpoint<span style="color:#666">]</span> using Chef::Provider::File
  <span style="color:#666">[</span>Fri, <span style="color:#40a070">15</span> Jan <span style="color:#40a070">2020</span> 14:49:20 -0800<span style="color:#666">]</span> INFO: Creating file<span style="color:#666">[</span>/tmp/after-breakpoint<span style="color:#666">]</span> at /tmp/after-breakpoint
</code></pre></div>
<h3 id="debug-existing-recipe">Debug Existing Recipe</h3> <p>chef-shell can be used to debug existing recipes. The recipe first needs to be added to a run-list for the node, so that it is cached when starting chef-shell and then used for debugging. chef-shell will report which recipes are being cached when it is started:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">loading configuration: none <span style="color:#666">(</span>standalone session<span style="color:#666">)</span>
Session type: standalone
Loading.............done.

Welcome to the chef-shell 15.8.23
For usage see https://docs.chef.io/chef_shell.html

run <span style="color:#4070a0">`</span>help<span style="color:#4070a0">' for help, `exit'</span> or ^D to quit.

chef <span style="color:#666">(</span>15.8.23<span style="color:#666">)</span>&gt;
</code></pre></div>
<p>To just load one recipe from the run-list, go into the recipe and use the <code>include_recipe</code> command. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef &gt; recipe_mode
  chef:recipe &gt; include_recipe <span style="color:#4070a0">"getting-started"</span>
    <span style="color:#666">=</span>&gt; <span style="color:#666">[</span><span style="color:#60a0b0;font-style:italic">#&lt; Chef::Recipe:0x10256f9e8 @cookbook_name="getting-started",</span>
  ... output truncated ...
</code></pre></div>
<p>To load all of the recipes from a run-list, use code similar to the following:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">node<span style="color:#666">.</span>run_list<span style="color:#666">.</span>expand(node<span style="color:#666">.</span>chef_environment)<span style="color:#666">.</span>recipes<span style="color:#666">.</span>each <span style="color:#007020;font-weight:700">do</span> <span style="color:#666">|</span>r<span style="color:#666">|</span>
  include_recipe r
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>After the recipes that are to be debugged have been loaded, use the <code>run_chef</code> command to run them.</p> <h3 id="advanced-debugging">Advanced Debugging</h3> <p>In chef-shell, it is possible to get verbose debugging using the tracing feature in Interactive Ruby (IRb). chef-shell provides a shortcut for turning tracing on and off. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef &gt; tracing on
tracing is <span style="color:#bb60d5">on</span>
<span style="color:#666">=</span>&gt; nil
chef &gt;
</code></pre></div>
<p>and:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef &gt; tracing off
<span style="color:#60a0b0;font-style:italic">#0:(irb):2:Object:-: tracing off</span>
<span style="color:#60a0b0;font-style:italic">#0:/opt/chef-workstation/embedded/lib/ruby/gems/2.6.0/gems/chef-15.8.23/lib/chef/shell/ext.rb:109:Shell::Extensions::ObjectCoreExtensions:&gt;:       def off</span>
<span style="color:#60a0b0;font-style:italic">#0:/opt/chef-workstation/embedded/lib/ruby/gems/2.6.0/gems/chef-15.8.23/lib/chef/shell/ext.rb:110:Shell::Extensions::ObjectCoreExtensions:-:         :off</span>
<span style="color:#60a0b0;font-style:italic">#0:/opt/chef-workstation/embedded/lib/ruby/gems/2.6.0/gems/chef-15.8.23/lib/chef/shell/ext.rb:111:Shell::Extensions::ObjectCoreExtensions:&lt;:       end</span>
<span style="color:#60a0b0;font-style:italic">#0:/opt/chef-workstation/embedded/lib/ruby/gems/2.6.0/gems/chef-15.8.23/lib/chef/shell/ext.rb:272:main:&gt;:       def tracing(on_or_off)</span>
<span style="color:#60a0b0;font-style:italic">#0:/opt/chef-workstation/embedded/lib/ruby/gems/2.6.0/gems/chef-15.8.23/lib/chef/shell/ext.rb:273:main:-:         conf.use_tracer = on_or_off.on_off_to_bool</span>
<span style="color:#60a0b0;font-style:italic">#0:/opt/chef-workstation/embedded/lib/ruby/gems/2.6.0/gems/chef-15.8.23/lib/chef/shell/ext.rb:162:Shell::Extensions::Symbol:&gt;:       def on_off_to_bool</span>
<span style="color:#60a0b0;font-style:italic">#0:/opt/chef-workstation/embedded/lib/ruby/gems/2.6.0/gems/chef-15.8.23/lib/chef/shell/ext.rb:163:Shell::Extensions::Symbol:-:         to_s.on_off_to_bool</span>
<span style="color:#60a0b0;font-style:italic">#0:/opt/chef-workstation/embedded/lib/ruby/gems/2.6.0/gems/chef-15.8.23/lib/chef/shell/ext.rb:149:Shell::Extensions::String:&gt;:       def on_off_to_bool</span>
<span style="color:#60a0b0;font-style:italic">#0:/opt/chef-workstation/embedded/lib/ruby/gems/2.6.0/gems/chef-15.8.23/lib/chef/shell/ext.rb:150:Shell::Extensions::String:-:         case self</span>
<span style="color:#60a0b0;font-style:italic">#0:/opt/chef-workstation/embedded/lib/ruby/gems/2.6.0/gems/chef-15.8.23/lib/chef/shell/ext.rb:154:Shell::Extensions::String:-:           false</span>
<span style="color:#60a0b0;font-style:italic">#0:/opt/chef-workstation/embedded/lib/ruby/gems/2.6.0/gems/chef-15.8.23/lib/chef/shell/ext.rb:158:Shell::Extensions::String:&lt;:       end</span>
<span style="color:#60a0b0;font-style:italic">#0:/opt/chef-workstation/embedded/lib/ruby/gems/2.6.0/gems/chef-15.8.23/lib/chef/shell/ext.rb:164:Shell::Extensions::Symbol:&lt;:       end</span>
tracing is <span style="color:#bb60d5">off</span>
<span style="color:#666">=</span>&gt; nil
chef &gt;
</code></pre></div> <h3 id="debug_value">debug_value</h3> <p>Use the <code>debug_value</code> method to discover the location within the attribute precedence hierarchy from which a particular attribute (or sub-attribute) is set. This method is available when running chef-shell in Chef Infra Client mode:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-shell -z
</code></pre></div>
<p>For example, the following attributes exist in a cookbook. Some are defined in a role file:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">default_attributes <span style="color:#4070a0">'test'</span> <span style="color:#666">=&gt;</span> { <span style="color:#4070a0">'source'</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'role default'</span> }
override_attributes <span style="color:#4070a0">'test'</span> <span style="color:#666">=&gt;</span> { <span style="color:#4070a0">'source'</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'role override'</span> }
</code></pre></div>
<p>And others are defined in an attributes file:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">default<span style="color:#666">[</span><span style="color:#517918">:test</span><span style="color:#666">][</span><span style="color:#517918">:source</span><span style="color:#666">]</span>  <span style="color:#666">=</span> <span style="color:#4070a0">'attributes default'</span>
normal<span style="color:#666">[</span><span style="color:#517918">:test</span><span style="color:#666">][</span><span style="color:#517918">:source</span><span style="color:#666">]</span>      <span style="color:#666">=</span> <span style="color:#4070a0">'attributes normal'</span>
override<span style="color:#666">[</span><span style="color:#517918">:test</span><span style="color:#666">][</span><span style="color:#517918">:source</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#4070a0">'attributes override'</span>
</code></pre></div>
<p>To debug the location in which the value of <code>node[:test][:source]</code> is set, use chef-shell and run a command similar to:</p> <pre tabindex="0" class="highlight" data-language="ruby"><code class="language-none" data-lang="none">pp node.debug_value('test', 'source')
</code></pre>
<p>This will pretty-print return all of the attributes and sub-attributes as an array of arrays; <code>:not_present</code> is returned for any attribute without a value:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash"><span style="color:#666">[[</span><span style="color:#4070a0">'set_unless_enabled?'</span>, false<span style="color:#666">]</span>,
 <span style="color:#666">[</span><span style="color:#4070a0">'default'</span>, <span style="color:#4070a0">'attributes default'</span><span style="color:#666">]</span>,
 <span style="color:#666">[</span><span style="color:#4070a0">'env_default'</span>, :not_present<span style="color:#666">]</span>,
 <span style="color:#666">[</span><span style="color:#4070a0">'role_default'</span>, <span style="color:#4070a0">'role default'</span><span style="color:#666">]</span>,
 <span style="color:#666">[</span><span style="color:#4070a0">'force_default'</span>, :not_present<span style="color:#666">]</span>,
 <span style="color:#666">[</span><span style="color:#4070a0">'normal'</span>, <span style="color:#4070a0">'attributes normal'</span><span style="color:#666">]</span>,
 <span style="color:#666">[</span><span style="color:#4070a0">'override'</span>, <span style="color:#4070a0">'attributes override'</span><span style="color:#666">]</span>,
 <span style="color:#666">[</span><span style="color:#4070a0">'role_override'</span>, <span style="color:#4070a0">'role override'</span><span style="color:#666">]</span>,
 <span style="color:#666">[</span><span style="color:#4070a0">'env_override'</span>, :not_present<span style="color:#666">]</span>,
 <span style="color:#666">[</span><span style="color:#4070a0">'force_override'</span>, :not_present<span style="color:#666">]</span>,
 <span style="color:#666">[</span><span style="color:#4070a0">'automatic'</span>, :not_present<span style="color:#666">]]</span>
</code></pre></div>
<p>where</p> <ul> <li>
<code>set_unless_enabled</code> indicates if the attribute collection is in <code>set_unless</code> mode; this typically returns <code>false</code>
</li> <li>Each attribute type is listed in order of precedence</li> <li>Each attribute value shown is the value that is set for that precedence level</li> <li>
<code>:not_present</code> is shown for any attribute precedence level that has no attributes</li> </ul> <h3 id="ignore_failure-method">ignore_failure Method</h3> <p>All resources share a set of common actions, attributes, and so on. Use the following attribute in a resource to help identify where an issue within a recipe may be located:</p> <table> <col style="width:12%"> <col style="width:87%"> <thead> <tr class="header"> <th>Attribute</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>ignore_failure</code></td> <td>Continue running a recipe if a resource fails for any reason. Default value: <code>false</code>.</td> </tr> </tbody> </table> <h3 id="chef-solo">chef-solo</h3> <p>See <a href="../ctl_chef_solo/index.html">chef-solo (executable)</a> for complete CTL documentation.</p> <p>chef-solo is a command that executes Chef Infra Client in a way that does not require the Chef Infra Server in order to converge cookbooks. chef-solo uses Chef Infra Client’s <a href="../ctl_chef_client.html#run-in-local-mode">Chef local mode</a>, and <strong>does not support</strong> the following functionality present in Chef Infra Client / server configurations:</p> <ul> <li>Centralized distribution of cookbooks</li> <li>A centralized API that interacts with and integrates infrastructure components</li> <li>Authentication or authorization</li> </ul> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>chef-solo can be run as a daemon.</p> </div> </div> <p>The chef-solo executable is run as a command-line tool.</p> <p>See <a href="../ctl_chef_solo/index.html">chef-solo (executable)</a> for complete CTL documentation.</p> </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; Chef Software, Inc.<br>Licensed under the Creative Commons Attribution 3.0 Unported License.<br>The Chef&trade; Mark and Chef Logo are either registered trademarks/service marks or trademarks/servicemarks of Chef, in the United States and other countries and are used with Chef Inc's permission.<br>We are not affiliated with, endorsed or sponsored by Chef Inc.<br>
    <a href="https://docs.chef.io/debug/" class="_attribution-link">https://docs.chef.io/debug/</a>
  </p>
</div>
