<div id="col-content" data-swiftype-index="true"> <div id="capacity-planning"><h1>Capacity Planning</h1></div>  <div class="prose"> <p data-swiftype-index="false"> <a href="https://github.com/chef/chef-server/blob/main/docs-chef-io/content/server/capacity_planning.md" alt="Link to page on GitHub repository">[edit on GitHub]</a> </p> <p>This document provides guidance for capacity planning and how to choose the right configuration–standalone, high availability, or tiered–for the Chef Infra Server. This document provides guidance and not hard/fast rules. This is because some requests to the Chef Infra Server API are more computationally expensive than others. In general, it’s better to start small and then scale the Chef Infra Server as needed. Premature optimization can hinder more than help because it may introduce unnecessary complexity.</p> <h2 id="scaling-the-chef-infra-server">Scaling the Chef Infra Server</h2> <p>The Chef Infra Server itself is highly scalable. A single virtual machine running the Chef Infra Server can handle requests for many thousands of nodes. As the scale increases, it’s a straightforward process to expand into a tiered front-end, back-end architecture with horizontally scaled front-ends to relieve pressure on system bottlenecks.</p> <p>That said, it’s best to isolate failure domains with their own Chef Infra Server, rather than trying to run every node in an infrastructure from a single central, monolithic Chef Infra Server instance/cluster.</p> <p>For instance, if there are West coast and East coast data centers, it is best to have one Chef Infra Server instance in each datacenter. Deploys to each Chef Infra Server can be synchronized upstream by CI software. The primary limiting bottleneck for Chef Infra Server installations is almost always input/output operations per second (IOPS) performance for the database filesystem.</p> <h2 id="ccrsmin">CCRs/min</h2> <p>The key unit of measure for scaling the Chef Infra Server is the number of Chef Infra Client runs per minute: CCRs/min. For example, 500 nodes set to check in every 30 minutes is equivalent to 16.66 CCRs/min.</p> <p>Typically, the Chef Infra Server does not require a high availability or tiered topology until the number of CCRs/min is higher than 333/min (approximately 10k nodes).</p> <p>While synthetic benchmarks should be taken with a grain of salt, as they don’t typically represent real-world performance, internal synthetic benchmarks at Chef have seen a standalone Chef Infra Server installed on a <code>c3.2xlarge</code> Amazon Web Services (AWS) instance handle more than 1,000 CCRs/min (30k nodes).</p> <h2 id="assumptions">Assumptions</h2> <p>Several factors may influence server scalability. All server sizing recommendations are based on these assumptions:</p> <ul> <li>Chef Infra Client runs are daemonized, and are not initiated by a cron job. Using cron to schedule runs can create “thundering herd” problems</li> <li>Chef Infra Client runs are set to a default 30-minute interval with a 5-minute splay</li> <li>Search and <code>partial_search</code> are utilized, but not heavily</li> <li>The number of cookbooks per organization, across all versions, on the Chef Infra Server is under 500. (Multiple organizations with fewer than 500 cookbooks each, that still add up to a total of more than 500 cookbooks server-wide, is fine.)</li> <li>The default maximum allowable size for a node object is 1MB, although it is rare for nodes to exceed 150KB. Though compressed, this data is replicated twice, once in Elasticsearch, and once in PostgreSQL. In practice, allowing a conservative 2MB of storage on the disk partition per node should be sufficient</li> </ul> <h2 id="host-specifications">Host Specifications</h2> <p>The following sections describe the host specifications for various sizes of CCRs/min and help show when to consider moving from a standalone topology to a high availability or tiered topology.</p> <p><strong>UP TO 33 CCRs/Min (approx. 1,000 nodes):</strong></p> <ul> <li>Chef recommends a single virtual machine instance</li> <li>Start with 2 CPU cores and 8GB of RAM, which is equivalent to an Amazon EC2 <code>m3.large</code> instance</li> <li>Allocate 2MB of disk space on the data partition per managed node</li> </ul> <p><strong>UP TO 167 CCRs/Min (approx. 5,000 nodes):</strong></p> <ul> <li>Chef recommends a single virtual machine instance</li> <li>Start with 4 CPU cores and 16GB of RAM, which is equivalent to an Amazon EC2 <code>m3.xlarge</code> instance</li> </ul> <p><strong>UP TO 333 CCRs/Min (Approx. 10,000 nodes):</strong></p> <ul> <li>Chef recommends a single virtual machine instance</li> <li>Start with 8 CPU cores and 32GB of RAM, which is equivalent to an Amazon EC2 <code>m3.2xlarge</code> instance</li> </ul> <p><strong>UP TO 667 CCRs/Min (Approx. 20,000 nodes):</strong></p> <ul> <li>Chef recommends two hosts, one front-end and one back-end</li> <li>The disk requirement for the front-end server is negligible</li> <li>Start with 8 CPU cores and 32GB of RAM for each host, which is equivalent to an Amazon EC2 <code>m3.2xlarge</code> instance</li> </ul> <p><strong>Scaling beyond 20,000 nodes on a single cluster:</strong></p> <ul> <li>Additional capacity can be gained by placing the front-end node behind an HTTP load balancer, and then scaling front-end nodes horizontally</li> <li>Chef recommends that Chef professional services be engaged to help with capacity and architectural planning at this size</li> </ul> </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; Chef Software, Inc.<br>Licensed under the Creative Commons Attribution 3.0 Unported License.<br>The Chef&trade; Mark and Chef Logo are either registered trademarks/service marks or trademarks/servicemarks of Chef, in the United States and other countries and are used with Chef Inc's permission.<br>We are not affiliated with, endorsed or sponsored by Chef Inc.<br>
    <a href="https://docs.chef.io/server/capacity_planning/" class="_attribution-link">https://docs.chef.io/server/capacity_planning/</a>
  </p>
</div>
