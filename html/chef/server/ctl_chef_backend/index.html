<div id="col-content" data-swiftype-index="true"> <div id="chef-backend-ctl"><h1>chef-backend-ctl</h1></div>  <div class="prose"> <p data-swiftype-index="false"> <a href="https://github.com/chef/chef-server/blob/main/docs-chef-io/content/server/ctl_chef_backend.md" alt="Link to page on GitHub repository">[edit on GitHub]</a> </p> <div class="admonition-warning">
<p class="admonition-warning-title">Warning</p>
<div class="admonition-warning-text"> <p>Chef Backend is <a href="../../versions/index.html#deprecated-products-and-versions">deprecated</a> and no longer under active development. Contact your Chef account representative for information about migrating to Chef Automate HA.</p> <p>This document is no longer maintained.</p> </div>
</div> <p>The Chef Infra Server backend HA cluster includes a command-line utility named chef-backend-ctl. This command-line tool is used to manage the Chef Infra Server backend HA cluster, start and stop individual services, and tail Chef Infra Server log files.</p> <h2 id="backup">backup</h2> <p>Use the <code>backup</code> subcommand is to backup the data for a node in the backend HA cluster. This command is typically run against a follower node. Use the <code>--force</code> option to run this command against all nodes in the backend HA cluster. The backup is created as a tar.gz file and is located in <code>/var/opt/chef-backup/</code>.</p> <h3 id="syntax">Syntax</h3> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-backend-ctl backup <span style="color:#666">(</span>options<span style="color:#666">)</span>
</code></pre></div>
<h3 id="options">Options</h3> <p>This subcommand has the following options:</p> <dl> <dt><code>--with-external</code></dt> <dd> <p>Use to specify that data on an external PostgreSQL database should be removed.</p> </dd> </dl> <h3 id="examples">Examples</h3> <p><strong>Backup a node in the backend HA cluster</strong></p> <p>From a follower node, run the following command:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-backend-ctl backup
</code></pre></div>
<h2 id="create-cluster">create-cluster</h2> <p>Use the <code>create-cluster</code> subcommand to initialize the cluster state, including the PostgreSQL data store, and then bootstrap the first node in a backend HA cluster or assist in the recovery of the entire backend HA cluster.</p> <h3 id="syntax-1">Syntax</h3> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-backend-ctl create-cluster <span style="color:#666">(</span>options<span style="color:#666">)</span>
</code></pre></div>
<h3 id="options-1">Options</h3> <p>This subcommand has the following options:</p> <dl> <dt><code>--elasticsearch-wait-time</code></dt> <dd> <p>The maximum amount of time (in seconds) to wait for Elasticsearch to start. Default value: <code>30</code>.</p> </dd> <dt><code>--etcd-wait-time</code></dt> <dd> <p>The maximum amount of time (in seconds) to wait for etcd to start. Default value: <code>30</code>.</p> </dd> <dt><code>--quorum-loss-recovery</code></dt> <dd> <p>Resets the cluster identifier in etcd to this node.</p> <p>If nodes in a backend HA cluster are not available, etcd may not be able to form a cluster. If etcd cannot form a cluster, rebuild the cluster. First reset the cluster identifier on an active node, rebuild the nodes that will be part of the cluster, and then rejoin the rebuilt nodes to the cluster by using the <code>chef-backend-ctl join-cluster</code> subcommand.</p> </dd> <dt>
<code>-y</code>, <code>--yes</code>
</dt> <dd> <p>Do not prompt for confirmation.</p> </dd> </dl> <h3 id="examples-1">Examples</h3> <p>None.</p> <h2 id="cleanse">cleanse</h2> <p>The <code>cleanse</code> subcommand is used to re-set a machine in the Chef Infra Server backend HA cluster to the state it was in prior to the first time the <code>reconfigure</code> subcommand is run. This command will destroy all data, configuration files, and logs. The software that was put on-disk by the package installation will remain; re-run <code>chef-backend-ctl reconfigure</code> to recreate the default data and configuration files.</p> <h3 id="syntax-2">Syntax</h3> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-backend-ctl cleanse
</code></pre></div>
<h3 id="options-2">Options</h3> <p>This subcommand has the following options:</p> <dl> <dt><code>--with-external</code></dt> <dd> <p>Use to specify that data on an external PostgreSQL database should be removed.</p> </dd> </dl> <h3 id="examples-2">Examples</h3> <p>None.</p> <h2 id="cluster-status">cluster-status</h2> <p>Use the <code>cluster-status</code> subcommand to return a list of all accessible nodes, their role (leader, follower), and the status for PostgreSQL and Elasticsearch.</p> <h3 id="syntax-3">Syntax</h3> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-backend-ctl cluster-status <span style="color:#666">(</span>options<span style="color:#666">)</span>
</code></pre></div>
<h3 id="options-3">Options</h3> <p>This subcommand has the following options:</p> <dl> <dt><code>--json</code></dt> <dd> <p>Return cluster health information as JSON.</p> </dd> </dl> <h3 id="examples-3">Examples</h3> <p><strong>Return cluster health data as JSON</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-backend-ctl cluster-status --json
</code></pre></div>
<h2 id="demote">demote</h2> <p>Use the <code>demote</code> subcommand to demote the current leader in the backend HA cluster, after which a new leader is elected from the group of available followers in the backend HA cluster. This command will:</p> <ul> <li>Complete with an exit code of <code>0</code> if the original leader was demoted and a new leader was elected successfully.</li> <li>Return an error message and a non-zero exit code if leader election is prevented because failover has been disabled (for either the cluster or the node) or if a new leader could not be elected within the allowed time.</li> </ul> <h3 id="syntax-4">Syntax</h3> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-backend-ctl demote
</code></pre></div>
<h3 id="examples-4">Examples</h3> <p>None.</p> <h2 id="force-leader">force-leader</h2> <p>Use the <code>force-leader</code> subcommand to force the node from which the command is run to become the leader in the backend HA cluster if there is not already an elected leader.</p> <p>This command should only be run if:</p> <ul> <li>The backend cluster appears to not have an elected and available leader</li> <li>All of the nodes in the backend HA cluster are believed to be in a healthy state; if one (or more) nodes are not healthy, first remove the unhealthy nodes, rebuild, and then rejoin them to the cluster</li> </ul> <p>This command will:</p> <ul> <li> <p>Run the <code>chef-backend-ctl cluster-status</code> subcommand to determine if a leader exists.</p> <div class="admonition-warning"> <p class="admonition-warning-title">Warning</p> <div class="admonition-warning-text"> Nodes in the backend HA cluster may not be visible to each other when they are located in network partitions. This may prevent a cluster status check from discovering that a leader exists. If nodes exist on network partitions, to prevent this scenario, first run <code>chef-backend-ctl cluster-status</code>, and then verify the expected number of nodes in the backend HA cluster as healthy and <code>waiting_for_leader</code> before running this command. </div> </div> </li> <li> <p>Complete with an exit code of <code>0</code> if the node from which the command is run becomes the leader.</p> </li> <li> <p>Return an error message and a non-zero exit code if a leader already exists.</p> </li> </ul> <h3 id="syntax-5">Syntax</h3> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-backend-ctl force-leader
</code></pre></div>
<h3 id="examples-5">Examples</h3> <p>None.</p> <h2 id="gather-logs">gather-logs</h2> <p>Use the <code>gather-logs</code> subcommand to gather the log files for a machine in the Chef Infra Server backend HA cluster into a tarball that contains all of the important log files and system information.</p> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-backend-ctl gather-logs
</code></pre></div>
<h2 id="gen-sample-backend-config">gen-sample-backend-config</h2> <p>Use the <code>gen-sample-backend-config</code> subcommand to generate output that contains all of the backend HA cluster settings along with their default values. Use this subcommand to get the values for <code>publish_address</code> and <code>vip_interface</code> prior to bootstrapping a new node for the backend HA cluster.</p> <div class="admonition-warning"> <p class="admonition-warning-title">Warning</p> <div class="admonition-warning-text"> Service-specific configuration settings—<code>etcd</code>, <code>elasticsearch</code>, <code>leaderl</code>, and <code>postgresql</code>—are generated automatically by the backend and should only be tuned under guidance from Chef. Service-specific configuration settings must be identical on all nodes in the backend HA cluster unless directed otherwise. </div> </div> <h3 id="syntax-6">Syntax</h3> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-backend-ctl gen-sample-backend-config
</code></pre></div>
<h3 id="example-output">Example Output</h3> <p>The following example shows the results of running the <code>chef-backend-ctl gen-sample-backend-config</code> subcommand. The settings and output will vary, depending on the configuration. The <code>elasticsearch</code>, <code>etcd</code>, <code>leaderl</code>, and <code>postgresql</code> settings are generated automatically and should not be modified:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">fqdn <span style="color:#666">=</span> <span style="color:#4070a0">'be1'</span>
hide_sensitive <span style="color:#666">=</span> <span style="color:#007020">true</span>
ip_version <span style="color:#666">=</span> <span style="color:#4070a0">'ipv4'</span>
publish_address <span style="color:#666">=</span> <span style="color:#4070a0">'10.0.2.15'</span>
vip <span style="color:#666">=</span> <span style="color:#4070a0">'10.0.2.15'</span>
vip_interface <span style="color:#666">=</span> <span style="color:#4070a0">'eth0'</span>
etcd<span style="color:#666">.</span>client_port <span style="color:#666">=</span> <span style="color:#40a070">2379</span>
etcd<span style="color:#666">.</span>enable <span style="color:#666">=</span> <span style="color:#007020">true</span>
etcd<span style="color:#666">.</span>log_directory <span style="color:#666">=</span> <span style="color:#4070a0">'/var/log/chef-backend/etcd'</span>
etcd<span style="color:#666">.</span>peer_port <span style="color:#666">=</span> <span style="color:#40a070">2380</span>
etcd<span style="color:#666">.</span>log_rotation<span style="color:#666">.</span>file_maxbytes <span style="color:#666">=</span> <span style="color:#40a070">104857600</span>
etcd<span style="color:#666">.</span>log_rotation<span style="color:#666">.</span>num_to_keep <span style="color:#666">=</span> <span style="color:#40a070">10</span>
postgresql<span style="color:#666">.</span>archive_command <span style="color:#666">=</span> <span style="color:#4070a0">''</span>
postgresql<span style="color:#666">.</span>archive_mode <span style="color:#666">=</span> <span style="color:#4070a0">'off'</span>
postgresql<span style="color:#666">.</span>archive_timeout <span style="color:#666">=</span> <span style="color:#40a070">0</span>
postgresql<span style="color:#666">.</span>checkpoint_completion_target <span style="color:#666">=</span> <span style="color:#40a070">0</span><span style="color:#666">.</span><span style="color:#40a070">5</span>
postgresql<span style="color:#666">.</span>checkpoint_timeout <span style="color:#666">=</span> <span style="color:#4070a0">'5min'</span>
postgresql<span style="color:#666">.</span>checkpoint_warning <span style="color:#666">=</span> <span style="color:#4070a0">'30s'</span>
postgresql<span style="color:#666">.</span>data_dir <span style="color:#666">=</span> <span style="color:#4070a0">'/var/opt/chef-backend/postgresql/9.5/data'</span>
postgresql<span style="color:#666">.</span>db_superuser <span style="color:#666">=</span> <span style="color:#4070a0">'chef_pgsql'</span>
postgresql<span style="color:#666">.</span>effective_cache_size <span style="color:#666">=</span> <span style="color:#4070a0">'496MB'</span>
postgresql<span style="color:#666">.</span>enable <span style="color:#666">=</span> <span style="color:#007020">true</span>
postgresql<span style="color:#666">.</span>hot_standby <span style="color:#666">=</span> <span style="color:#4070a0">'on'</span>
postgresql<span style="color:#666">.</span>keepalives_count <span style="color:#666">=</span> <span style="color:#40a070">2</span>
postgresql<span style="color:#666">.</span>keepalives_idle <span style="color:#666">=</span> <span style="color:#40a070">60</span>
postgresql<span style="color:#666">.</span>keepalives_interval <span style="color:#666">=</span> <span style="color:#40a070">15</span>
postgresql<span style="color:#666">.</span>log_directory <span style="color:#666">=</span> <span style="color:#4070a0">'/var/log/chef-backend/postgresql/9.5'</span>
postgresql<span style="color:#666">.</span>log_min_duration_statement <span style="color:#666">=</span> <span style="color:#666">-</span><span style="color:#40a070">1</span>
postgresql<span style="color:#666">.</span>max_connections <span style="color:#666">=</span> <span style="color:#40a070">350</span>
postgresql<span style="color:#666">.</span>max_replication_slots <span style="color:#666">=</span> <span style="color:#40a070">12</span>
postgresql<span style="color:#666">.</span>max_wal_senders <span style="color:#666">=</span> <span style="color:#40a070">12</span>
postgresql<span style="color:#666">.</span>max_wal_size <span style="color:#666">=</span> <span style="color:#40a070">64</span>
postgresql<span style="color:#666">.</span>md5_auth_cidr_addresses <span style="color:#666">=</span> <span style="color:#4070a0">'["samehost", "samenet"]'</span>
postgresql<span style="color:#666">.</span>min_wal_size <span style="color:#666">=</span> <span style="color:#40a070">5</span>
postgresql<span style="color:#666">.</span>port <span style="color:#666">=</span> <span style="color:#40a070">5432</span>
postgresql<span style="color:#666">.</span>replication_user <span style="color:#666">=</span> <span style="color:#4070a0">'replicator'</span>
postgresql<span style="color:#666">.</span>shared_buffers <span style="color:#666">=</span> <span style="color:#4070a0">'248MB'</span>
postgresql<span style="color:#666">.</span>shmall <span style="color:#666">=</span> <span style="color:#40a070">4194304</span>
postgresql<span style="color:#666">.</span>shmmax <span style="color:#666">=</span> <span style="color:#40a070">17179869184</span>
postgresql<span style="color:#666">.</span>username <span style="color:#666">=</span> <span style="color:#4070a0">'chef_pgsql'</span>
postgresql<span style="color:#666">.</span>wal_keep_segments <span style="color:#666">=</span> <span style="color:#40a070">32</span>
postgresql<span style="color:#666">.</span>wal_level <span style="color:#666">=</span> <span style="color:#4070a0">'hot_standby'</span>
postgresql<span style="color:#666">.</span>wal_log_hints <span style="color:#666">=</span> <span style="color:#4070a0">'on'</span>
postgresql<span style="color:#666">.</span>work_mem <span style="color:#666">=</span> <span style="color:#4070a0">'8MB'</span>
postgresql<span style="color:#666">.</span>log_rotation<span style="color:#666">.</span>file_maxbytes <span style="color:#666">=</span> <span style="color:#40a070">104857600</span>
postgresql<span style="color:#666">.</span>log_rotation<span style="color:#666">.</span>num_to_keep <span style="color:#666">=</span> <span style="color:#40a070">10</span>
elasticsearch<span style="color:#666">.</span>data_dir <span style="color:#666">=</span> <span style="color:#4070a0">'/var/opt/chef-backend/elasticsearch/data'</span>
elasticsearch<span style="color:#666">.</span>enable <span style="color:#666">=</span> <span style="color:#007020">true</span>
elasticsearch<span style="color:#666">.</span>heap_size <span style="color:#666">=</span> <span style="color:#40a070">248</span>
elasticsearch<span style="color:#666">.</span>java_opts <span style="color:#666">=</span> <span style="color:#4070a0">''</span>
elasticsearch<span style="color:#666">.</span>log_directory <span style="color:#666">=</span> <span style="color:#4070a0">'/var/log/chef-backend/elasticsearch'</span>
elasticsearch<span style="color:#666">.</span>new_size <span style="color:#666">=</span> <span style="color:#40a070">32</span>
elasticsearch<span style="color:#666">.</span>plugins_directory <span style="color:#666">=</span> <span style="color:#4070a0">'/var/opt/chef-backend/elasticsearch/plugins'</span>
elasticsearch<span style="color:#666">.</span>port <span style="color:#666">=</span> <span style="color:#40a070">9200</span>
elasticsearch<span style="color:#666">.</span>scripts_directory <span style="color:#666">=</span> <span style="color:#4070a0">'/var/opt/chef-backend/elasticsearch/scripts'</span>
elasticsearch<span style="color:#666">.</span>temp_directory <span style="color:#666">=</span> <span style="color:#4070a0">'/var/opt/chef-backend/elasticsearch/'</span>
elasticsearch<span style="color:#666">.</span>log_rotation<span style="color:#666">.</span>file_maxbytes <span style="color:#666">=</span> <span style="color:#40a070">104857600</span>
elasticsearch<span style="color:#666">.</span>log_rotation<span style="color:#666">.</span>num_to_keep <span style="color:#666">=</span> <span style="color:#40a070">10</span>
leaderl<span style="color:#666">.</span>control_worker_timeout_seconds <span style="color:#666">=</span> <span style="color:#40a070">30</span>
leaderl<span style="color:#666">.</span>db_timeout <span style="color:#666">=</span> <span style="color:#40a070">2000</span>
leaderl<span style="color:#666">.</span>enable <span style="color:#666">=</span> <span style="color:#007020">true</span>
leaderl<span style="color:#666">.</span>health_check_interval_seconds <span style="color:#666">=</span> <span style="color:#40a070">2</span>
leaderl<span style="color:#666">.</span>leader_ttl_seconds <span style="color:#666">=</span> <span style="color:#40a070">10</span>
leaderl<span style="color:#666">.</span>log_directory <span style="color:#666">=</span> <span style="color:#4070a0">'/var/log/chef-backend/leaderl'</span>
leaderl<span style="color:#666">.</span>status_internal_update_interval_seconds <span style="color:#666">=</span> <span style="color:#40a070">5</span>
leaderl<span style="color:#666">.</span>status_post_update_interval_seconds <span style="color:#666">=</span> <span style="color:#40a070">10</span>
leaderl<span style="color:#666">.</span>log_rotation<span style="color:#666">.</span>file_maxbytes <span style="color:#666">=</span> <span style="color:#40a070">104857600</span>
leaderl<span style="color:#666">.</span>log_rotation<span style="color:#666">.</span>max_messages_per_second <span style="color:#666">=</span> <span style="color:#40a070">1000</span>
leaderl<span style="color:#666">.</span>log_rotation<span style="color:#666">.</span>num_to_keep <span style="color:#666">=</span> <span style="color:#40a070">10</span>
leaderl<span style="color:#666">.</span>etcd_pool<span style="color:#666">.</span>cull_interval_seconds <span style="color:#666">=</span> <span style="color:#40a070">60</span>
leaderl<span style="color:#666">.</span>etcd_pool<span style="color:#666">.</span>http_timeout_ms <span style="color:#666">=</span> <span style="color:#40a070">5000</span>
leaderl<span style="color:#666">.</span>etcd_pool<span style="color:#666">.</span>ibrowse_options <span style="color:#666">=</span> <span style="color:#4070a0">'{inactivity_timeout, infinity}'</span>
leaderl<span style="color:#666">.</span>etcd_pool<span style="color:#666">.</span>init_count <span style="color:#666">=</span> <span style="color:#40a070">10</span>
leaderl<span style="color:#666">.</span>etcd_pool<span style="color:#666">.</span>max_age_seconds <span style="color:#666">=</span> <span style="color:#40a070">60</span>
leaderl<span style="color:#666">.</span>etcd_pool<span style="color:#666">.</span>max_connection_duration_seconds <span style="color:#666">=</span> <span style="color:#40a070">300</span>
leaderl<span style="color:#666">.</span>etcd_pool<span style="color:#666">.</span>max_count <span style="color:#666">=</span> <span style="color:#40a070">10</span>
ssl<span style="color:#666">.</span>certificate <span style="color:#666">=</span> <span style="color:#007020">nil</span>
ssl<span style="color:#666">.</span>certificate_key <span style="color:#666">=</span> <span style="color:#007020">nil</span>
ssl<span style="color:#666">.</span>ciphers <span style="color:#666">=</span> (a list of ciphers, <span style="color:#007020;font-weight:700">not</span> shown)
ssl<span style="color:#666">.</span>company_name <span style="color:#666">=</span> <span style="color:#4070a0">'YouCorp'</span>
ssl<span style="color:#666">.</span>country_name <span style="color:#666">=</span> <span style="color:#4070a0">'US'</span>
ssl<span style="color:#666">.</span>data_dir <span style="color:#666">=</span> <span style="color:#4070a0">'/var/opt/chef-backend/ssl/'</span>
ssl<span style="color:#666">.</span>duration <span style="color:#666">=</span> <span style="color:#40a070">3650</span>
ssl<span style="color:#666">.</span>key_length <span style="color:#666">=</span> <span style="color:#40a070">2048</span>
ssl<span style="color:#666">.</span>organizational_unit_name <span style="color:#666">=</span> <span style="color:#4070a0">'Operations'</span>
</code></pre></div>
<h2 id="gen-server-config">gen-server-config</h2> <p>Use the <code>gen-server-config</code> subcommand to generate output for the <code>/etc/opscode/chef-server.rb</code> configuration file. This command may be run from any machine in the backend HA cluster, but must be run separately for each node that is part of the frontend group. This command will:</p> <ul> <li>Complete with an exit code of <code>0</code> if the <code>chef-server.rb</code> file is created successfully.</li> <li>Return an error message and a non-zero exit code if a node has not been bootstrapped or joined or if a FQDN is not provided.</li> </ul> <h3 id="syntax-7">Syntax</h3> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-backend-ctl gen-server-config FQDN
</code></pre></div>
<h3 id="configure-the-front-end">Configure the Front End</h3> <ol> <li> <p>On any node in the backend HA cluster, run the following command for each node in the frontend group:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-backend-ctl gen-server-config FQDN -f chef-server.rb.fqdn
</code></pre></div>
<p>where <code>FQDN</code> is the FQDN for the frontend machine. The generated <code>chef-server.rb</code> file will contain all of the values necessary for any frontend Chef Infra Server to connect to and bootstrap against the backend HA cluster.</p> </li> <li> <p>On each frontend machine, install the <code>chef-server-core</code> package (version 12.4.0 or higher).</p> </li> <li> <p>On each frontend machine, copy the generated <code>chef-server.rb</code>.fqdn to <code>/etc/opscode/chef-server.rb</code>.</p> </li> <li> <p>On each frontend machine, with root permission, run the following command:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-server-ctl reconfigure
</code></pre></div>
</li> </ol> <h3 id="example-output-1">Example Output</h3> <p>The following example shows the results of running the <code>chef-backend-ctl gen-server-config</code> subcommand. The settings and output will vary, depending on the configuration. These settings should be modified carefully:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">fqdn <span style="color:#4070a0">"frontend1.chef-demo.com"</span>
postgresql<span style="color:#666">[</span><span style="color:#4070a0">'external'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#007020">true</span>
postgresql<span style="color:#666">[</span><span style="color:#4070a0">'vip'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#4070a0">'192.0.2.0'</span>
postgresql<span style="color:#666">[</span><span style="color:#4070a0">'db_superuser'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#4070a0">'chef_pgsql'</span>
postgresql<span style="color:#666">[</span><span style="color:#4070a0">'db_superuser_password'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#4070a0">'...6810e52a01e562'</span>
opscode_solr4<span style="color:#666">[</span><span style="color:#4070a0">'external'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#007020">true</span>
opscode_solr4<span style="color:#666">[</span><span style="color:#4070a0">'external_url'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#4070a0">'http://192.0.2.0:9200'</span>
opscode_erchef<span style="color:#666">[</span><span style="color:#4070a0">'search_provider'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#4070a0">'elasticsearch'</span>
opscode_erchef<span style="color:#666">[</span><span style="color:#4070a0">'search_queue_mode'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#4070a0">'batch'</span>
bookshelf<span style="color:#666">[</span><span style="color:#4070a0">'storage_type'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#517918">:sql</span>
rabbitmq<span style="color:#666">[</span><span style="color:#4070a0">'enable'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#007020">false</span>
rabbitmq<span style="color:#666">[</span><span style="color:#4070a0">'management_enabled'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#007020">false</span>
rabbitmq<span style="color:#666">[</span><span style="color:#4070a0">'queue_length_monitor_enabled'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#007020">false</span>
opscode_expander<span style="color:#666">[</span><span style="color:#4070a0">'enable'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#007020">false</span>
dark_launch<span style="color:#666">[</span><span style="color:#4070a0">'actions'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#007020">false</span>
opscode_erchef<span style="color:#666">[</span><span style="color:#4070a0">'nginx_bookshelf_caching'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#517918">:on</span>
opscode_erchef<span style="color:#666">[</span><span style="color:#4070a0">'s3_url_expiry_window_size'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#4070a0">'50%'</span>
</code></pre></div>
<div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> The <code>opscode_solr4</code>, <code>postgresql</code>, and <code>rabbitmq</code> services are disabled in this configuration file for the frontend machines when running the Chef Infra Server with a backend HA cluster. </div> </div> <h2 id="help">help</h2> <p>Use the <code>help</code> subcommand to print a list of all available chef-backend-ctl commands.</p> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-backend-ctl <span style="color:#007020">help</span>
</code></pre></div>
<h2 id="join-cluster">join-cluster</h2> <p>Use the <code>join-cluster</code> subcommand to configure a node to be a member of the backend HA cluster as a peer of the node at the specified <code>PEER_NODE_IP</code> IP address. This command will query the existing cluster to identify any necessary configuration information. If the <code>--publish-address</code> and <code>--vip-interface</code> options are not specified, and are specified in <code>chef-backend.rb</code>, the command will prompt with a list of items from which to choose.</p> <p>This command will return an error message and a non-zero exit code when:</p> <ul> <li>The <code>--secrets-file-path</code> option is specified, a non-empty secrets file already exists at <code>/etc/chef-backend/secrets.json</code>, and the user declines to overwrite it.</li> <li>The <code>--secrets-file-path</code> option is specified, but does not specify a valid file and/or the file at <code>/etc/chef-backend/secrets.json</code> is empty or does not exist.</li> <li>The IP address specified by the <code>--publish-address</code> option does not exist on the node.</li> <li>The interface specified by the <code>--vip-interface</code> option does not exist on the node.</li> <li>Any IP address on the node is already registered in the backend HA cluster.</li> <li>The node is already configured for the backend HA cluster and the <code>--recovery</code> option is not specified.</li> <li>The <code>--recovery</code> option is specified, but no existing installation is found.</li> <li>
<code>--publish-address</code> and/or <code>--vip-interface</code> are specified, but a non-empty <code>chef-backend.rb</code> file already exists. (This command will not overwrite a <code>chef-backend.rb</code> file.)</li> </ul> <p>If successful, this command will generate a <code>chef-backend.rb</code> file at <code>/etc/chef-backend/chef-backend.rb</code> with the values for the <code>publish_address</code>, <code>vip_interface</code>, and <code>vip</code> added automatically.</p> <h3 id="syntax-8">Syntax</h3> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-backend-ctl join-cluster PEER_NODE_IP <span style="color:#666">(</span>options<span style="color:#666">)</span>
</code></pre></div>
<p>where <code>PEER_NODE_IP</code> is the IP address of a peer in the cluster to be joined.</p> <h3 id="options-4">Options</h3> <p>This subcommand has the following options:</p> <dl> <dt>
<code>-i INTERFACE</code>, <code>--vip-interface INTERFACE</code>
</dt> <dd> <p>The network interface to which the backend VIP will bind in the event that this node becomes leader. If not provided, and if not specified in <code>chef-backend.rb</code>, this command will prompt to choose from a list of interfaces that are currently available on the node.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> This option should only be used the first time a node joins the backend HA cluster. </div> </div> </dd> <dt>
<code>-p IP_ADDRESS</code>, <code>--publish-address IP_ADDRESS</code>
</dt> <dd> <p>The IP address that is published within the backend HA cluster. This IP address must be accessible to all nodes in the backend HA cluster. If not provided, and if not specified in <code>chef-backend.rb</code>, this command will prompt to choose from a list of IP addresses that are currently bound on the node.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> This option should only be used the first time a node joins the backend HA cluster. </div> </div> </dd> <dt><code>--recovery</code></dt> <dd> <p>Force this node to rejoin the backend HA cluster if it has been removed via the <code>chef-backend-ctl remove-node</code> or <code>chef-backend-ctl bootstrap --with-quorum-recovery</code> commands.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> This option will run against the existing <code>chef-backend.rb</code> file, which means the <code>--vip-interface</code> and <code>--publish-address</code> options should not be specified. (They are already defined in the <code>chef-backend.rb</code> file.) </div> </div> </dd> <dt>
<code>-s PATH</code>, <code>--secrets-file-path PATH</code>
</dt> <dd> <p>The ABSOLUTE path to the location of the <code>secrets.json</code> file on the bootstrapping node. The path should begin with a “/”. Default value: <code>/etc/chef-backend/secrets.json</code>.</p> </dd> <dt>
<code>-y</code>, <code>--yes</code>
</dt> <dd> <p>Do not prompt for confirmation.</p> </dd> </dl> <h3 id="examples-6">Examples</h3> <p>None.</p> <h2 id="promote">promote</h2> <p>Use the <code>promote</code> subcommand to promote the named node to be leader of the backend HA cluster. This command will:</p> <ul> <li>Complete with an exit code of <code>0</code> when the leader of the backend HA cluster is replaced as leader by the named node.</li> <li>Return an error message and a non-zero exit code if the named node is already leader because failover has been disabled (for either the cluster or the node) or if the new leader could not be promoted within the allowed time.</li> </ul> <h3 id="syntax-9">Syntax</h3> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-backend-ctl promote NODE
</code></pre></div>
<h3 id="examples-7">Examples</h3> <p>None.</p> <h2 id="reconfigure">reconfigure</h2> <p>Use the <code>reconfigure</code> subcommand to reconfigure a machine in the Chef Infra Server backend HA cluster. This subcommand will also restart any services for which the <code>service_name['enabled']</code> setting is set to <code>true</code>.</p> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-backend-ctl reconfigure
</code></pre></div>
<h2 id="remove-node">remove-node</h2> <p>Use the <code>remove-node</code> subcommand to remove the named node from the backend HA cluster by removing the node’s status from etcd and deleting it from the etcd cluster. This command is useful when a node is going to be replaced or if the <code>join-cluster</code> command was unsuccessful.</p> <p>This command may not be run from the node that is to be removed; the node itself must be shut down physically or have all services stopped (via the the <code>chef-backend-ctl stop</code> command). If the node is still running or otherwise available to the backend HA cluster, this command will return an error message and a non-zero exist code.</p> <h3 id="syntax-10">Syntax</h3> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-backend-ctl remove-node NODE_NAME
</code></pre></div>
<h3 id="options-5">Options</h3> <p>This subcommand has the following options:</p> <dl> <dt>
<code>-y</code>, <code>--yes</code>
</dt> <dd> <p>Do not prompt for confirmation.</p> </dd> </dl> <h3 id="examples-8">Examples</h3> <p>None.</p> <h2 id="restore">restore</h2> <p>Use the <code>restore</code> subcommand to restore a backup created by the <code>chef-backend-ctl backup</code> subcommand. This command should be executed on the leader node in the backend HA cluster. This command will delete all existing data and replace it with the data in the backup archive.</p> <h3 id="syntax-11">Syntax</h3> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-backend-ctl restore PATH <span style="color:#666">(</span>options<span style="color:#666">)</span>
</code></pre></div>
<p>where <code>PATH</code> is the path to a tar.gz file that was created by the <code>chef-backend-ctl backup</code> subcommand.</p> <h3 id="options-6">Options</h3> <p>This subcommand has the following options:</p> <dl> <dt>
<code>-d DIRECTORY</code>, <code>--staging-dir DIRECTORY</code>
</dt> <dd> <p>The path to an empty directory to be used during the restore operation. This directory must have enough available space to expand all data in the backup archive.</p> </dd> <dt>
<code>-y</code>, <code>--yes</code>
</dt> <dd> <p>Do not prompt for confirmation.</p> </dd> </dl> <h3 id="examples-9">Examples</h3> <p><strong>Restore data to the backend leader</strong></p> <p>From the leader node, run the following command:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-backend-ctl restore /var/opt/chef-backup/backup_file.tgz
</code></pre></div>
<h2 id="set-cluster-failover">set-cluster-failover</h2> <p>Use the <code>set-cluster-failover</code> subcommand to enable or disable failover across the backend HA cluster.</p> <h3 id="syntax-12">Syntax</h3> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-backend-ctl set-cluster-failover STATE
</code></pre></div>
<p>where <code>STATE</code> may be one of <code>on</code>, <code>off</code>, <code>true</code>, <code>false</code>, <code>enabled</code>, or <code>disabled</code>.</p> <h2 id="set-node-failover">set-node-failover</h2> <p>Use the <code>set-node-failover</code> subcommand to enable or disable failover for a node in the backend HA cluster.</p> <h3 id="syntax-13">Syntax</h3> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-backend-ctl set-node-failover STATE
</code></pre></div>
<p>where <code>STATE</code> may be one of <code>on</code>, <code>off</code>, <code>true</code>, <code>false</code>, <code>enabled</code>, or <code>disabled</code>.</p> <h2 id="show-config">show-config</h2> <p>The <code>show-config</code> subcommand is used to view the configuration that will be generated by the <code>reconfigure</code> subcommand. This command is most useful in the early stages of a deployment to ensure that everything is built properly prior to installation.</p> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-backend-ctl show-config
</code></pre></div>
<h2 id="status">status</h2> <p>Use the <code>status</code> subcommand to show the status of all services available to a node in the backend HA cluster. This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-backend-ctl status
</code></pre></div>
<p>and will return the status for all services. Status can be returned for individual services by specifying the name of the service as part of the command:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-backend-ctl status SERVICE_NAME
</code></pre></div>
<p>For example, full output:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-backend-ctl status
</code></pre></div>
<p>is similar to:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">Service        Local Status        Time in State  Distributed Node Status
elasticsearch  running <span style="color:#666">(</span>pid 6661<span style="color:#666">)</span>  1d 5h 59m 41s  state: green; nodes online: 3/3
etcd           running <span style="color:#666">(</span>pid 6742<span style="color:#666">)</span>  1d 5h 59m 39s  health: green; healthy nodes: 3/3
leaderl        running <span style="color:#666">(</span>pid 6788<span style="color:#666">)</span>  1d 5h 59m 35s  leader: 1; waiting: 0; follower: 2; total: <span style="color:#40a070">3</span>
postgresql     running <span style="color:#666">(</span>pid 6640<span style="color:#666">)</span>  1d 5h 59m 43s  leader: 1; offline: 0; syncing: 0; synced: <span style="color:#40a070">2</span>
</code></pre></div>
<p>which shows status for a healthy backend HA cluster. The first three columns–<code>Service</code>, <code>Local Status</code>, and <code>Time in State</code> summarize the local state. The <code>Distributed Node Status</code> column shows:</p> <ul> <li>A three node cluster</li> <li>All nodes healthy and online</li> <li>A leader selected with two followers (for both leader/follower status for the <code>leaderl</code> service and a leader/synced state for the <code>postgresql</code> service)</li> </ul> <p>Simple output:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-backend-ctl status --simple
</code></pre></div>
<p>is similar to:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">run: elasticsearch: <span style="color:#666">(</span>pid 6661<span style="color:#666">)</span> 106983s; run: log: <span style="color:#666">(</span>pid 6667<span style="color:#666">)</span> 106983s
run: etcd: <span style="color:#666">(</span>pid 6742<span style="color:#666">)</span> 106981s; run: log: <span style="color:#666">(</span>pid 6630<span style="color:#666">)</span> 106984s
run: leaderl: <span style="color:#666">(</span>pid 6788<span style="color:#666">)</span> 106976s; run: log: <span style="color:#666">(</span>pid 6739<span style="color:#666">)</span> 106982s
run: postgresql: <span style="color:#666">(</span>pid 6640<span style="color:#666">)</span> 106984s; run: log: <span style="color:#666">(</span>pid 6653<span style="color:#666">)</span> 106983s
</code></pre></div>
<p>which shows the state of the services, process identifiers, and uptime (in seconds). Simple output is useful if one (or more) nodes in the backend HA cluster are down or in a degraded state.</p> <h2 id="uninstall">uninstall</h2> <p>The <code>uninstall</code> subcommand is used to remove the Chef Infra Server application from a machine in the backend HA cluster, but without removing any of the data. This subcommand will shut down all services (including the <code>runit</code> process supervisor).</p> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-backend-ctl uninstall
</code></pre></div>
<div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> To revert the <code>uninstall</code> subcommand, run the <code>reconfigure</code> subcommand (because the <code>start</code> subcommand is disabled by the <code>uninstall</code> command). </div> </div> <h2 id="service-subcommands">Service Subcommands</h2> <p>This command has a built in process supervisor that ensures all of the required services are in the appropriate state at any given time. The supervisor starts two processes per service and provides the following subcommands for managing services: <code>hup</code>, <code>int</code>, <code>kill</code>, <code>once</code>, <code>restart</code>, <code>service-list</code>, <code>start</code>, <code>status</code>, <code>stop</code>, <code>tail</code>, and <code>term</code>.</p> <div class="admonition-warning"> <p class="admonition-warning-title">Warning</p> <div class="admonition-warning-text"> The following commands are disabled when an external PostgreSQL database is configured for the Chef Infra Server: <code>hup</code>, <code>int</code>, <code>kill</code>, <code>once</code>, <code>restart</code>, <code>service-list</code>, <code>start</code>, <code>stop</code>, <code>tail</code>, and <code>term</code>. </div> </div> <h3 id="hup">hup</h3> <p>Use the <code>hup</code> subcommand to send a <code>SIGHUP</code> to all services on a machine in the Chef Infra Server backend HA cluster. This command can also be run for an individual service by specifying the name of the service in the command.</p> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-backend-ctl hup SERVICE_NAME
</code></pre></div>
<p>where <code>SERVICE_NAME</code> represents the name of any service that is listed after running the <code>service-list</code> subcommand.</p> <h3 id="int">int</h3> <p>Use the <code>int</code> subcommand to send a <code>SIGINT</code> to all services on a machine in the Chef Infra Server backend HA cluster. This command can also be run for an individual service by specifying the name of the service in the command.</p> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-backend-ctl int SERVICE_NAME
</code></pre></div>
<p>where <code>SERVICE_NAME</code> represents the name of any service that is listed after running the <code>service-list</code> subcommand.</p> <h3 id="kill">kill</h3> <p>Use the <code>kill</code> subcommand to send a <code>SIGKILL</code> to all services on a machine in the Chef Infra Server backend HA cluster. This command can also be run for an individual service by specifying the name of the service in the command.</p> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-backend-ctl <span style="color:#007020">kill</span> SERVICE_NAME
</code></pre></div>
<p>where <code>SERVICE_NAME</code> represents the name of any service that is listed after running the <code>service-list</code> subcommand.</p> <h3 id="once">once</h3> <p>The supervisor for a machine in the Chef Infra Server backend HA cluster is configured to restart any service that fails, unless that service has been asked to change its state. The <code>once</code> subcommand is used to tell the supervisor to not attempt to restart any service that fails.</p> <p>This command is useful when troubleshooting configuration errors that prevent a service from starting. Run the <code>once</code> subcommand followed by the <code>status</code> subcommand to look for services in a down state and/or to identify which services are in trouble. This command can also be run for an individual service by specifying the name of the service in the command.</p> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-backend-ctl once SERVICE_NAME
</code></pre></div>
<p>where <code>SERVICE_NAME</code> represents the name of any service that is listed after running the <code>service-list</code> subcommand.</p> <h3 id="restart">restart</h3> <p>Use the <code>restart</code> subcommand to restart all services enabled on a machine in the Chef Infra Server backend HA cluster, or to restart an individual service by specifying the name of that service in the command.</p> <div class="admonition-warning"> <p class="admonition-warning-title">Warning</p> <div class="admonition-warning-text"> When running the Chef Infra Server in a high availability configuration, restarting all services may trigger failover. </div> </div> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-backend-ctl restart SERVICE_NAME
</code></pre></div>
<p>where <code>SERVICE_NAME</code> represents the name of any service that is listed after running the <code>service-list</code> subcommand. When a service is successfully restarted the output should be similar to:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">ok: run: service_name: <span style="color:#666">(</span>pid 12345<span style="color:#666">)</span> 1s
</code></pre></div>
<h3 id="service-list">service-list</h3> <p>Use the <code>service-list</code> subcommand to display a list of all available services on a machine in the Chef Infra Server backend HA cluster. A service that is enabled is labeled with an asterisk (*).</p> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-backend-ctl service-list
</code></pre></div>
<h3 id="start">start</h3> <p>Use the <code>start</code> subcommand to start all services that are enabled on a machine in the Chef Infra Server backend HA cluster. This command can also be run for an individual service by specifying the name of the service in the command.</p> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-backend-ctl start SERVICE_NAME
</code></pre></div>
<p>where <code>SERVICE_NAME</code> represents the name of any service that is listed after running the <code>service-list</code> subcommand. When a service is successfully started the output should be similar to:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">ok: run: service_name: <span style="color:#666">(</span>pid 12345<span style="color:#666">)</span> 1s
</code></pre></div>
<p>The supervisor for a machine in the Chef Infra Server backend HA cluster is configured to wait seven seconds for a service to respond to a command from the supervisor. If you see output that references a timeout, it means that a signal has been sent to the process, but that the process has yet to actually comply. In general, processes that have timed out are not a big concern, unless they are failing to respond to the signals at all. If a process is not responding, use a command like the <code>kill</code> subcommand to stop the process, investigate the cause (if required), and then use the <code>start</code> subcommand to re-enable it.</p> <h3 id="stop">stop</h3> <p>Use the <code>stop</code> subcommand to stop all services enabled on the Chef Infra Server backend HA cluster. This command can also be run for an individual service by specifying the name of the service in the command.</p> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-backend-ctl stop SERVICE_NAME
</code></pre></div>
<p>where <code>SERVICE_NAME</code> represents the name of any service that is listed after running the <code>service-list</code> subcommand. When a service is successfully stopped the output should be similar to:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">ok: diwb: service_name: 0s, normally up
</code></pre></div>
<p>For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-backend-ctl stop
</code></pre></div>
<p>will return something similar to:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">ok: down: etcd: 393s, normally up
ok: down: postgresql: 388s, normally up
</code></pre></div>
<h3 id="tail">tail</h3> <p>Use the <code>tail</code> subcommand to follow all of the logs for all services on a machine in the Chef Infra Server backend HA cluster. This command can also be run for an individual service by specifying the name of the service in the command.</p> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-backend-ctl tail SERVICE_NAME
</code></pre></div>
<p>where <code>SERVICE_NAME</code> represents the name of any service that is listed after running the <code>service-list</code> subcommand.</p> <h3 id="term">term</h3> <p>Use the <code>term</code> subcommand to send a <code>SIGTERM</code> to all services on a machine in the Chef Infra Server backend HA cluster. This command can also be run for an individual service by specifying the name of the service in the command.</p> <p>This subcommand has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef-backend-ctl term SERVICE_NAME
</code></pre></div>
<p>where <code>SERVICE_NAME</code> represents the name of any service that is listed after running the <code>service-list</code> subcommand.</p> </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; Chef Software, Inc.<br>Licensed under the Creative Commons Attribution 3.0 Unported License.<br>The Chef&trade; Mark and Chef Logo are either registered trademarks/service marks or trademarks/servicemarks of Chef, in the United States and other countries and are used with Chef Inc's permission.<br>We are not affiliated with, endorsed or sponsored by Chef Inc.<br>
    <a href="https://docs.chef.io/server/ctl_chef_backend/" class="_attribution-link">https://docs.chef.io/server/ctl_chef_backend/</a>
  </p>
</div>
