<div id="col-content" data-swiftype-index="true"> <div id="deprecation-custom-resource-cleanups-chef-5"><h1>Deprecation: Custom Resource Cleanups (CHEF-5)</h1></div>  <div class="prose"> <p data-swiftype-index="false"> <a href="https://github.com/chef/chef-web-docs/blob/main/content/deprecations_custom_resource_cleanups.md" alt="Link to page on GitHub repository">[edit on GitHub]</a> </p> <p>We are continuously improving and streamlining the way custom resources work in Chef, to make it easier for cookbook authors and Chef developers to build resources.</p> <p>This page documents many deprecations over the course of many Chef releases.</p> <h2 id="nil-properties">Nil Properties</h2> <p>In current versions of Chef, <code>nil</code> was often used to mean that a property had no good default, and needed to be set by the user. However, it is often to useful to set a property to <code>nil</code>, meaning that it’s not set and should be ignored. In Chef Client 13, it is an error to set <code>default: nil</code> on a property if that property doesn’t allow <code>nil</code> as a valid value.</p> <h3 id="remediation">Remediation</h3> <p>If it is valid for the property to be set to nil, then update the property to include that.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">property <span style="color:#517918">:my_nillable_property</span>, <span style="color:#666">[</span> <span style="color:#007020">String</span>, <span style="color:#007020">nil</span> <span style="color:#666">]</span>, <span style="color:#517918">default</span>: <span style="color:#007020">nil</span>
</code></pre></div>
<p>Otherwise, remove the <code>default: nil</code> statement from the property.</p> <h2 id="invalid-defaults">Invalid Defaults</h2> <p>Current versions of Chef emit a warning when a property’s default value is not valid. This is often because the type of the default value doesn’t match the specification of the property. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">property <span style="color:#517918">:my_property</span>, <span style="color:#666">[</span> <span style="color:#007020">String</span> <span style="color:#666">]</span>, <span style="color:#517918">default</span>: <span style="color:#666">[]</span>
</code></pre></div>
<p>sets the type of the property to be a String, but then sets the default to be an Array. In Chef Client 13, this will be an error.</p> <h3 id="remediation-1">Remediation</h3> <p>Ensure that the default value of a property is correct.</p> <h2 id="property-getters">Property Getters</h2> <p>When writing a resource in Chef Client 12, calling <code>some_property nil</code> behaves as a getter, returning the value of <code>some_property</code>. In Chef Client 13, this will change to set <code>some_property</code> to <code>nil</code>.</p> <h3 id="remediation-2">Remediation</h3> <p>Simply write <code>some_property</code> when retrieving the value of <code>some_property</code>.</p> <h2 id="specifying-both-default-and-name_property-on-a-resource">Specifying both “default” and “name_property” on a resource</h2> <p>Current versions of Chef emit a warning if the property declaration has both <code>default</code> and <code>name_property</code> set. In Chef Client 13, that will become an error. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">property <span style="color:#517918">:my_property</span>, <span style="color:#666">[</span> <span style="color:#007020">String</span> <span style="color:#666">]</span>, <span style="color:#517918">default</span>: <span style="color:#666">[]</span>, <span style="color:#517918">name_property</span>: <span style="color:#007020">true</span>
</code></pre></div>
<h3 id="remediation-3">Remediation</h3> <p>A property can either have a default, or it can be a “name” property (meaning that it will take the value of the resource’s name if not otherwise specified), but not both.</p> <h2 id="overriding-provides">Overriding provides?</h2> <p>Some providers override the <code>provides?</code> method, used to check whether they are a valid provider on the current platform. In Chef Client 13, this will cause an error if the provider does not also register themselves with the <code>provides</code> call.</p> <h3 id="example">Example</h3> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#007020;font-weight:700">def</span> <span style="color:#06287e">provides?</span>
  <span style="color:#007020">true</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<h3 id="remediation-4">Remediation</h3> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">provides <span style="color:#517918">:my_provider</span>

<span style="color:#007020;font-weight:700">def</span> <span style="color:#06287e">provides?</span>
  <span style="color:#007020">true</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<h2 id="dont-use-the-updated-method">Don’t use the updated method</h2> <p>The <code>updated=(true_or_false)</code> method is deprecated and will be removed from Chef Client 13. This method never performed its intended job, as notifications from the resource would not fire, and in general its use has always been buggy. The Chef Infra Client notification code checks <code>updated_by_last_action?</code> instead, so setting that is recommended as a substitute. See the <a href="../custom_resources_notes/index.html#updated-by-last-action">updated_by_last_action</a> documentation for more information.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> Setting <code>updated_by_last_action</code> is almost always unnecessary, and correct use of <code>use_inline_resources</code> (which is the default in Chef Client 13 and above) makes the <code>updated_by_last_action</code> setting redundant. Simply deleting this code is very likely to be the correct course of action in nearly all cases. </div> </div> <h3 id="example-1">Example</h3> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">action <span style="color:#517918">:foo</span> <span style="color:#007020;font-weight:700">do</span>
  updated <span style="color:#666">=</span> <span style="color:#007020">true</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<h3 id="remediation-5">Remediation</h3> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">action <span style="color:#517918">:foo</span> <span style="color:#007020;font-weight:700">do</span>
  new_resource<span style="color:#666">.</span>updated_by_last_action <span style="color:#007020">true</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<h2 id="dont-use-the-dsl_name-method">Don’t use the dsl_name method</h2> <p>The <code>dsl_name</code> method is deprecated and will be removed from Chef Client. It has been replaced by <code>resource_name</code>.</p> <h3 id="example-2">Example</h3> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">my_resource <span style="color:#666">=</span> <span style="color:#60add5">MyResource</span><span style="color:#666">.</span>dsl_name
</code></pre></div>
<h3 id="remediation-6">Remediation</h3> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">my_resource <span style="color:#666">=</span> <span style="color:#60add5">MyResource</span><span style="color:#666">.</span>resource_name
</code></pre></div>
<h2 id="dont-use-the-provider_base-method">Don’t use the provider_base method</h2> <p>The <code>Resource.provider_base</code> allows the developer to specify an alternative module to load providers from, rather than <code>Chef::Provider</code>. It is deprecated and will be removed in Chef Client 13. Instead, the provider should call <code>provides</code> to register itself, or the resource should call <code>provider</code> to specify the provider to use.</p> </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; Chef Software, Inc.<br>Licensed under the Creative Commons Attribution 3.0 Unported License.<br>The Chef&trade; Mark and Chef Logo are either registered trademarks/service marks or trademarks/servicemarks of Chef, in the United States and other countries and are used with Chef Inc's permission.<br>We are not affiliated with, endorsed or sponsored by Chef Inc.<br>
    <a href="https://docs.chef.io/deprecations_custom_resource_cleanups/" class="_attribution-link">https://docs.chef.io/deprecations_custom_resource_cleanups/</a>
  </p>
</div>
