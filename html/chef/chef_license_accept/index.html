<div id="col-content" data-swiftype-index="true"> <div id="accepting-the-chef-license"><h1>Accepting the Chef License</h1></div>  <div class="prose"> <p data-swiftype-index="false"> <a href="https://github.com/chef/chef-web-docs/blob/main/content/chef_license_accept.md" alt="Link to page on GitHub repository">[edit on GitHub]</a> </p> <p>This page aims to document how to accept the Chef license for all Chef Software products. For an overview of the license, see the <a href="../chef_license/index.html">Chef license</a> documentation. There are two types of license: MLSA and EULA. The MLSA applies to customers with a commercial contract with Chef Software, and the EULA covers all other cases.</p> <h2 id="accept-the-chef-mlsa">Accept the Chef MLSA</h2> <p>There are three ways to accept the Chef MLSA:</p> <ol> <li>When running <code>chef-&lt;PRODUCT-NAME&gt;-ctl reconfigure</code> the Chef MLSA is printed. Type <code>yes</code> to accept it. Anything other than typing <code>yes</code> rejects the Chef MLSA, and the upgrade process will exit. Typing <code>yes</code> adds a <code>.license.accepted</code> file to the <code>/etc/chef/accepted_licenses/&lt;PRODUCT-NAME&gt;</code> file. As long as this file exists in this directory, the Chef MLSA is accepted and the reconfigure process will not prompt for <code>yes</code>.</li> <li>Run the <code>chef-&lt;PRODUCT-NAME&gt;-ctl reconfigure</code> command using the <code>--chef-license=accept</code> option. This automatically types <code>yes</code> and skips printing the Chef MLSA.</li> <li>Add a <code>.license.accepted</code> file to the <code>/var/opt/&lt;PRODUCT-NAME&gt;/</code> directory. The contents of this file do not matter. As long as this file exists in this directory, the Chef MLSA is accepted and the reconfigure process will not prompt for <code>yes</code>.</li> </ol> <h2 id="accept-the-chef-eula">Accept the Chef EULA</h2> <p>Products below are split below into two categories: workstation and server. Affected product versions which require accepting the EULA to use are shown. Versions before this do not require accepting the EULA. More information on supported versions can be seen at the <a href="../versions/index.html">Supported Versions</a> documentation.</p> <h3 id="workstation-products">Workstation Products</h3> <ul> <li>Chef Workstation &gt;= 0.4, which also contains: <ul> <li>Chef Infra Client</li> <li>Chef InSpec</li> </ul> </li> <li>Chef Infra Client &gt;= 15.0</li> <li>Chef InSpec &gt;= 4.0</li> <li>Chef Habitat &gt;= 0.80</li> </ul> <p>These products are typically installed on a user’s workstation. Two methods are generally used to accept the license for these products:</p> <ol> <li>
<code>--chef-license &lt;value&gt;</code> argument passed to the command line invocation.</li> <li>
<code>CHEF_LICENSE="&lt;value&gt;"</code> as an environment variable. <code>&lt;value&gt;</code> can be specified as one of the following: <ol> <li>
<code>accept</code> - Accepts the license and attempts to persist a marker file locally. Persisting these marker files means future invocations do not require accepting the license again.</li> <li>
<code>accept-silent</code> - Similar to <code>accept</code> except no messaging is sent to STDOUT</li> <li>
<code>accept-no-persist</code> - Similar to <code>accept-silent</code> except no marker file is persisted. Future invocation will require accepting the license again.</li> </ol> </li> </ol> <p>If no command line argument or environment variable is set, these products will attempt to request acceptance through an interactive prompt. If the prompt cannot be displayed, then the product will fail with an exit code 172.</p> <p>If the product attempts to persist the accepted license and fails, a message will be sent to STDOUT, but product invocation will continue successfully. In a future invocation, however, the license would need to be accepted again.</p> <p>Please see <a href="https://github.com/chef/license-acceptance#license-file-persistence">License File Persistence</a> for details about persisted marker files.</p> <p>The <code>--chef-license</code> command line argument is not backwards compatible to older non-EULA versions. If you are managing a multi-version environment, we recommend using the environment variable as that is ignored by older versions.</p> <p>Products with specific features or differences from this general behavior are documented below.</p> <h4 id="chef-workstation">Chef Workstation</h4> <p>Chef Workstation contains multiple Chef Software products. When invoking the <code>chef</code> command line tool and accepting the license, users are required to accept the license for all the embedded products as well. The same license applies to all products, but each product must have its own license acceptance. <code>chef &lt;command&gt; --chef-license accept</code> will accept the license for Chef Workstation, Chef Infra Client, and Chef InSpec. For example, <code>chef env --chef-license accept</code>.</p> <h4 id="chef-infra-client">Chef Infra Client</h4> <p>In addition to the above methods, users can specify <code>chef_license 'accept'</code> in their Chef Infra Client and Chef Infra Server config. On a workstation, this can be specified in <code>~/.chef/config.rb</code> or <code>~/.chef/knife.rb</code>, and on a node, it can be specified in <code>/etc/chef/client.rb</code>. This method of license acceptance is backwards-compatible to non-EULA versions of Chef Infra Client.</p> <h4 id="habitat">Habitat</h4> <p>Two methods are generally used to accept the Chef Habitat license:</p> <ol> <li>Users can execute <code>hab license accept</code> on the command line.</li> <li>Alternatively, users can set <code>HAB_LICENSE="&lt;value&gt;"</code> as an environment variable. <code>&lt;value&gt;</code> can be specified as one of the following: <ol> <li>
<code>accept</code> - Accepts the license and persists a marker file locally. Future invocations do not require accepting the license again.</li> <li>
<code>accept-no-persist</code> - accepts the license without persisting an marker file. Future invocation will require accepting the license again.</li> </ol> </li> </ol> <p>If the license isn’t accepted through either of these methods, Habitat will request acceptance through an interactive prompt.</p> <p>Additionally, to accepting the license in CI or other automation, user may choose to create an empty file on the filesystem at <code>/hab/accepted-licenses/habitat</code> (if your hab commands run as root) or at <code>$HOME/.hab/accepted-licenses/habitat</code> (if your hab commands run as a user other than root). For situations where hab commands run as multiple users, it is advisable to create both files.</p> <h4 id="errors">Errors</h4> <p>If the Chef Habitat License prompt cannot be displayed, then the product fails with an exit code 172. If Chef Habitat cannot persist the accepted license, it sends a message STDOUT, but the product invocation will continue successfully. In a future invocation, however, the user will need to accept the license again.</p> <h4 id="chef-as-habitat-packages">Chef as Habitat packages</h4> <p>Chef Software products are also distributed as Habitat packages, such as Chef Infra Client, Chef InSpec, etc. When Chef products are installed as Habitat, the products request license acceptance at product usage time. Whether installed as system packages or as Habitat packages, users accept the licenses in the same way detailed above.</p> <h3 id="server-products">Server Products</h3> <p>Some Chef products distributed as Habitat packages contain servers. In these cases, Habitat runs the server products as a supervisor. See the below sections for information on how to accept the license for these products when they are distributed as Habitat packages.</p> <table> <col style="width:20%"> <col style="width:79%"> <thead> <tr class="header"> <th>Product</th> <th>Version</th> </tr> </thead> <tbody> <tr> <td>Chef Infra Server</td> <td>&gt;= 13.0</td> </tr> <tr> <td>Chef Automate</td> <td>&gt;= 2.0</td> </tr> <tr> <td>Supermarket</td> <td>&gt;= 4.0</td> </tr> </tbody> </table> <p>Server products are typically installed and managed by some kind of process supervisor. Chef Software server products do not allow interactive license acceptance because process supervisors do not easily allow interactivity. Instead, the license is accepted during the <code>reconfigure</code> command or <code>upgrade</code> command for the Omnibus ctl command. For example:</p> <ul> <li><code>chef-server-ctl reconfigure --chef-license=accept</code></li> <li><code>CHEF_LICENSE="accept-no-persist" supermarket-ctl reconfigure</code></li> </ul> <p>In addition, the Chef license can be accepted via the omnibus configuration file. Specify <code>chef_license 'accept'</code> in the <code>chef-server.rb</code> or <code>supermarket.rb</code> configuration.</p> <h4 id="chef-automate">Chef Automate</h4> <p>Automate has its own reconfigure tool, <code>automate-ctl</code>. This tool walks users through the install and setup of Automate. The Chef license is accepted after that in the browser. Please follow the in-product prompts.</p> <h4 id="chef-infra-server">Chef Infra Server</h4> <p>When installed as a system package, users accept the license with the ctl command. For example, <code>chef-server-ctl reconfigure --chef-license=accept</code>. Acceptance can also be set in the configuration file <code>chef-server.rb</code> as <code>chef_license "accept"</code>.</p> <p>Chef Infra Server is also distributed as a Habitat package and ran using the Habitat supervisor. In this mode, users accept the license by setting the correct Habitat configuration values. The key is <code>chef_license.acceptance</code>.</p> <p>For example: Against a supervisor running Chef Infra Server, run <code>echo "chef_license.acceptance = accept" | hab config apply server.default 100</code>. See the <a href="https://www.habitat.sh/docs/using-habitat/#config-updates">Habitat config updates documentation</a> for more information about how to apply this configuration to a service group.</p> <h3 id="remote-management-products">Remote Management Products</h3> <ul> <li>Test Kitchen</li> <li>
<code>knife bootstrap</code> in Chef Infra Client</li> <li>
<code>chef-run</code> in Chef Workstation</li> <li>Packer</li> <li>Terraform Chef Provider (Deprecated)</li> <li>Vagrant</li> </ul> <p>These products install or manage Chef on a remote instance. If a user has accepted the appropriate product license locally, it will be automatically transferred to the remote instance. For example, if a user has accepted the Chef Infra Client license locally and converges a Test Kitchen instance with the Chef provisioner, it will succeed by copying the acceptance to the remote instance. We aim to support this behavior, so Workstation users do not have their workflow affected, but any differences from that behavior are documented below.</p> <h4 id="test-kitchen">Test Kitchen</h4> <p>Test Kitchen is not owned by or covered by the Chef license, but installing Chef Infra Client on a test instance is covered by the EULA. Without accepting the license, the converge will fail on the test instance.</p> <p>The Chef provisioner in Test Kitchen &gt;= 2.3 has been updated to simplify accepting this license on behalf of the test instance. Users can set the <code>CHEF_LICENSE</code> environment variable or add <code>chef_license: accept</code> to their provisioner config in their <strong>kitchen.yml</strong>. Specifying <strong>accept</strong> will attempt to persist the license acceptance locally. If a local license marker file is detected, no configuration is required; acceptance is automatically transferred to the test instance.</p> <p>To disable this persistence, specify <code>accept-no-persist</code> on every test instance converge.</p> <p><code>kitchen-inspec</code> uses Chef InSpec as a library, and is not covered by the EULA when installed as a gem, but is covered by the EULA when packaged as part of the Chef Workstation installation. Accept the license in a similar way to the Chef Infra Client license - specify the <code>CHEF_LICENSE</code> environment variable, specify the <code>chef_license</code> config under the verifier section in <code>kitchen.yml</code> or persist the acceptance locally.</p> <h5 id="test-kitchen-pin-to-chef-14">Test Kitchen: Pin to Chef 14</h5> <p>You can pin to a specific version of chef in your kitchen.yml:</p> <pre tabindex="0" class="highlight" data-language="ruby"><code class="language-none" data-lang="none">provisioner:
  name: chef_zero
  product_name: chef
  product_version: 14.12.3
</code></pre>
<h4 id="knife-bootstrap"><code>knife bootstrap</code></h4> <p><code>knife</code> usage does not require accepting the EULA. A Chef Infra Client instance does require EULA acceptance. Using <code>knife bootstrap</code> to manage a Chef Infra Client instance will prompt a user to accept the license locally before allowing for bootstrapping the remote instance. Without this, <code>knife bootstrap</code> would fail.</p> <p>In most usage cases via Chef Workstation, this license will already have been accepted and will transfer across transparently. But if a user installs Chef Workstation and the first command they ever run is <code>knife bootstrap</code>, it will perform the same license acceptance flow as the Chef Infra Client product.</p> <h5 id="knife-bootstrap-in-chef-client-14">
<code>knife bootstrap</code> in Chef Client 14</h5> <p>The <code>knife bootstrap</code> command in Chef Client 14 cannot accept the Chef Infra Client 15 EULA on remote nodes unless you use a <a href="../workstation/knife_bootstrap/index.html#custom-templates">custom template</a> and add chef_license “accept” to the client.rb. This applies to workstations who have Chef Infra Client &lt;= 14.x, ChefDK &lt;= 3.x or Chef Workstation &lt;= 0.3 installed.</p> <h5 id="knife-bootstrap-pin-to-chef-14">
<code>knife bootstrap</code>: Pin to Chef 14</h5> <p>Specify the following argument:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">knife bootstrap --bootstrap-version 14.12.3
</code></pre></div>
<h4 id="chef-run"><code>chef-run</code></h4> <p><code>chef-run</code> in Chef Workstation &gt;= 0.3 has been updated to add support for accepting the license locally when remotely running Chef Infra Client 15. As of Chef Workstation &lt;= 0.4 there is no way to manage the version of Chef Infra Client installed on the remote node. It defaults to the latest stable version available.</p> <p>To accept the license, complete one of the following three tasks. Either pass the <code>--chef-license</code> command line flag, set the <code>CHEF_LICENSE</code> environment variable, or add the following to your <code>~/.chef-workstation/config.toml</code> file:</p> <pre tabindex="0" class="highlight" data-language="ruby"><code class="language-none" data-lang="none">[chef]
chef_license = "accept"
</code></pre>
<h4 id="packer">Packer</h4> <p>Use a custom <a href="https://www.packer.io/docs/provisioners/chef/chef-client#chef-configuration">Chef configuration template</a>. In your provisioners config, include:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-json" data-lang="json">{
  <span style="color:#062873;font-weight:700">"type"</span>:            <span style="color:#4070a0">"chef-client"</span>,
  <span style="color:#062873;font-weight:700">"config_template"</span>: <span style="color:#4070a0">"path/to/client.rb"</span>
}
</code></pre></div>
<p>In <code>path/to/client.rb</code>, include:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_license <span style="color:#4070a0">'accept'</span>
</code></pre></div>
<p>You may also add it to the <a href="https://www.packer.io/docs/provisioners/chef-client.html#execute_command">execute_command</a>, but this is not backwards-compatible, so it is not suggested.</p> <h5 id="packer-pin-to-chef-14">Packer: Pin to Chef 14</h5> <p>In your <a href="https://www.packer.io/docs/provisioners/chef-client.html#install_command">Packer provisioners config</a>, include:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-json" data-lang="json">{
  <span style="color:#062873;font-weight:700">"type"</span>:            <span style="color:#4070a0">"chef-client"</span>,
  <span style="color:#062873;font-weight:700">"install_command"</span>: <span style="color:#4070a0">"curl -L https://omnitruck.chef.io/install.sh | sudo bash -s -- -v 14.12.9"</span>
}
</code></pre></div>
<h4 id="terraform-chef-provisioner">Terraform Chef Provisioner</h4> <div class="admonition-warning"> <p class="admonition-warning-title">Warning</p> <div class="admonition-warning-text"> Terraform deprecated the Chef Provisioner in the <a href="https://www.terraform.io/docs/language/resources/provisioners/chef.html">0.13.4</a> release and they will remove it in a future version. Terraform continues to support the Chef Provider. </div> </div> <p>The license can be accepted via the Chef Infra Client config file, which is specified by the <code>client_options</code> <a href="https://www.terraform.io/docs/provisioners/chef.html#client_options-array-">Terraform provisioner config</a>:</p> <pre tabindex="0" class="highlight" data-language="ruby"><code class="language-none" data-lang="none">provisioner "chef" {
  client_options = ["chef_license 'accept'"]
}
</code></pre>
<h5 id="terraform-pin-to-chef-14">Terraform: Pin to Chef 14</h5> <p>In your <a href="https://www.terraform.io/docs/provisioners/chef.html#version-string-">Terraform provisioner config</a>, include:</p> <pre tabindex="0" class="highlight" data-language="ruby"><code class="language-none" data-lang="none">provisioner "chef" {
  version = "14.12.3"
}
</code></pre>
<h4 id="terraform-habitat-provisioner">Terraform Habitat Provisioner</h4> <p>Default behavior of this provisioner is to install the latest version of Habitat. <a href="https://www.terraform.io/docs/provisioners/habitat.html">Documentation for this provisioner</a> will be updated in the near future once the provisioner is updated with options to accept license. For the time being, the provisioner can be pinned to a prior Habitat version as below.</p> <h5 id="terraform-pin-to-chef-habitat-079">Terraform: Pin to Chef Habitat 0.79</h5> <p>In your <a href="https://www.terraform.io/docs/provisioners/habitat.html#version-string-">Terraform provisioner config</a>, include:</p> <pre tabindex="0" class="highlight" data-language="ruby"><code class="language-none" data-lang="none">provisioner "habitat" {
  version = "0.79.1"
}
</code></pre>
<h4 id="vagrant">Vagrant</h4> <p>This license acceptance can be done via the arguments API:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">config<span style="color:#666">.</span>vm<span style="color:#666">.</span>provision <span style="color:#4070a0">'chef_zero'</span> <span style="color:#007020;font-weight:700">do</span> <span style="color:#666">|</span>chef<span style="color:#666">|</span>
  chef<span style="color:#666">.</span>arguments <span style="color:#666">=</span> <span style="color:#4070a0">'--chef-license accept'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>See the <a href="https://www.vagrantup.com/docs/provisioning/chef_common.html#arguments">Vagrant documentation</a> for details. The <code>--chef-license</code> argument is not backwards-compatible to non-EULA Chef Infra Client versions. So instead, users can use the <a href="https://www.vagrantup.com/docs/provisioning/chef_common.html#custom_config_path">custom config path</a> and point at a local file, which specifies the <code>chef_license</code> config. The environment variable is not currently supported.</p> <h5 id="vagrant-pin-to-chef-14">Vagrant: Pin to Chef 14</h5> <p>This version pinning can be done via the <a href="https://www.vagrantup.com/docs/provisioning/chef_common.html#version">version API</a>. In your Chef provisioner config:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">config<span style="color:#666">.</span>vm<span style="color:#666">.</span>provision <span style="color:#4070a0">'chef_zero'</span> <span style="color:#007020;font-weight:700">do</span> <span style="color:#666">|</span>chef<span style="color:#666">|</span>
  chef<span style="color:#666">.</span>version <span style="color:#666">=</span> <span style="color:#4070a0">'14.12.3'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<h3 id="pre-upgrade-support">Pre-upgrade support</h3> <p>Chef Software aims to make upgrading from a non-EULA version to a EULA version as simple as possible. For some products (Chef Client 14.12.9, Chef InSpec 3.9.3), we added backwards-compatible support for the <code>--chef-license</code> command that performs a no-op. This allows customers to start specifying that argument in whatever way they manage those products before upgrading.</p> <p>Alternatively, users can specify the <code>CHEF_LICENSE</code> environment variable when invoking any of the EULA products to accept the license. This environment variable is ignored by non-EULA products, and so is backwards-compatible to older versions.</p> <h4 id="chef-client-cookbook">
<code>chef-client</code> cookbook</h4> <p>For users that manage their Chef Infra Client installation using the <code>chef-client</code> cookbook, we added a new attribute that can be specified. Specify the node attribute <code>node['chef_client']['chef_license'] = 'accept'</code> when running the cookbook to apply the license acceptance in a backwards-compatible way.</p> <p>This functionality allows users to set that attribute for a Chef Client 14 install, upgrade to Chef Infra Client 15, and have the product continue to work correctly.</p> </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; Chef Software, Inc.<br>Licensed under the Creative Commons Attribution 3.0 Unported License.<br>The Chef&trade; Mark and Chef Logo are either registered trademarks/service marks or trademarks/servicemarks of Chef, in the United States and other countries and are used with Chef Inc's permission.<br>We are not affiliated with, endorsed or sponsored by Chef Inc.<br>
    <a href="https://docs.chef.io/chef_license_accept/" class="_attribution-link">https://docs.chef.io/chef_license_accept/</a>
  </p>
</div>
