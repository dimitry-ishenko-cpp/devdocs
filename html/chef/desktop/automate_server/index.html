<div id="col-content" data-swiftype-index="true"> <div id="set-up-automate-server"><h1>Set up Automate Server</h1></div>  <div class="prose"> <p>We recommend starting with a clean installation of Chef Automate, Chef Infra Server, and Chef Desktop. Combining existing Chef Automate nodes with new Chef Desktop leads to significant confusion, because the servers do not distinguish between the types of nodes that they mange.</p> <p>For the purposes of this demonstration, we recommend installing Chef Automate and Chef Infra Server together on the same host. Talk to your account representative to decide if you should follow a different deployment pattern in production.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> Proceed with the instructions provided in the following sections after you have logged in to the server where you want to install and set up Automate. </div> </div> <h2 id="prepare-the-system">Prepare the System</h2> <p>In your clean Linux environment, update and install the system packages:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">apt-get -qq update
apt-get install -y --no-install-recommends
apt-get clean
</code></pre></div>
<p>The Chef Automate installation requires the following settings:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">sysctl -w vm.max_map_count<span style="color:#666">=</span><span style="color:#40a070">262144</span>
sysctl -w vm.dirty_expire_centisecs<span style="color:#666">=</span><span style="color:#40a070">20000</span>
</code></pre></div>
<h2 id="download-automate-and-install-with-desktop-dashboard">Download Automate and install with Desktop dashboard</h2> <p>Download the Chef Automate CLI:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">curl https://packages.chef.io/files/current/latest/chef-automate-cli/chef-automate_linux_amd64.zip | gunzip - &gt; chef-automate
chmod +x chef-automate
</code></pre></div>
<p>Deploy the packages with the following command:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">sudo chef-automate deploy --product automate --product infra-server --product desktop --accept-terms-and-mlsa
</code></pre></div>
<p><em>You will need the host names and user information later in this guide. They are located them in the <code>automate-credentials.toml</code>.</em></p> <h2 id="configure-the-infra-server">Configure the Infra server</h2> <p>You need run these commands as an administrator or use <code>sudo</code> before each command.</p> <p><em><strong>Note</strong>: You will need information from both of these commands. Copy them from your command line to a file. Store the file securely.</em></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-powershell" data-lang="powershell"><span style="color:#007020">chef-server</span>-ctl <span style="color:#007020">user-create</span> USER_NAME FIRST_NAME LAST_NAME EMAIL <span style="color:#4070a0">'PASSWORD'</span> --filename USER_NAME.pem
</code></pre></div>
<p>Create an organization:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-powershell" data-lang="powershell"><span style="color:#007020">chef-server</span>-ctl <span style="color:#007020">org-create</span> SHORT_NAME <span style="color:#4070a0">'FULL_ORGANIZATION_NAME'</span> --association_user USER_NAME --filename <span style="color:#007020">ORGANIZATION-validator</span>.pem
</code></pre></div>
<p>Transfer the generated user and validator keys to your workstation and put them in the <code>.chef</code> directory. If you already logged out of the server, you can read the next section on key management to find instructions on how to transfer them to your local workstation.</p> <h2 id="key-management">Key Management</h2> <p>“Key management” is a software term that means “Safely and securely getting the right credentials from remote and local computers into the right directories–usually, but not always, on your local computer–in order to use software to run commands between computers”.</p> <p>We recommend using a secure copy protocol (SCP) to move the public key and configuration file from the Chef Infra Server to the <code>.chef</code> directory on your workstation.</p> <ul> <li> <p>macOS workstations should have the <code>scp</code> command,</p> </li> <li> <p>Windows workstations will need to install <a href="https://winscp.net/eng/index.php">WinSCP</a> or another similar tool.</p> <ul> <li>The public key is <code>ORGANIZATION-validator.pem</code>
</li> <li>The configuration file is <code>config.toml</code>
</li> </ul> </li> </ul> <p><em>This step is the reason that you copied output of the above commands to files.</em> To manage your keys and credentials, you need to know:</p> <ul> <li>The host name (also called a FQDN) or ip of the Chef Infra Server</li> <li>The user name on the Chef Infra Server</li> <li>The password on the Chef Infra Server</li> </ul> <h3 id="transfer-keys-on-windows-workstations">Transfer Keys on Windows Workstations</h3> <ol> <li>Install WinSCP</li> <li>Open the program using the icon on your workstation desktop.</li> <li>Select <strong>SCP</strong> as the file protocol</li> <li>Set port <strong>22</strong>
</li> <li>Fill in the host name, the user name, and the password that you created on your Chef Infra Server.</li> </ol> <h3 id="transfer-keys-on-macos-workstations">Transfer Keys on macOS Workstations</h3> <p>macOS systems come with <code>scp</code> installed. Download the key and configuration files:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">scp user_name@chef-automate.test:/remote/ORGANIZATION-validator.pem ~/.chef
scp user_name@chef-automate.test:/remote/config.toml ~/.chef
</code></pre></div>
<h3 id="more-information-on-scp">More Information on SCP</h3> <dl> <dt><a href="https://linuxize.com/post/how-to-use-scp-command-to-securely-transfer-files/">SCP for macOS</a></dt> <dd>SCP is used to move files between your workstation to a remote computer. It uses ssh for data transfer. <code>scp</code> asks for passwords or passphrases if needed for authentication.</dd> <dt><a href="https://winscp.net/index.php">WinSCP for Windows</a></dt> <dd>WinSCP is an open source application for Windows used to move files between your workstation and a remote computer. WinSCP offers scripting and basic file manager functionality. The download page has many junk buttons, make sure you select <strong>Download WinSPC</strong>.</dd> <dt><a href="https://docs.microsoft.com/azure/virtual-machines/linux/copy-files-to-linux-vm-using-scp">SCP on Azure</a></dt> <dd>SCP on Azure is used to move files from your workstation up to an Azure Linux VM, or from an Azure Linux VM down to your workstation.</dd> </dl> <ul> <li>Next: <a href="../cookbook_repository/index.html">Chef Desktop Cookbook Development Environment</a>
</li> <li>Last: <a href="../requirements/index.html">Chef Desktop Requirements</a>
</li> </ul> </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; Chef Software, Inc.<br>Licensed under the Creative Commons Attribution 3.0 Unported License.<br>The Chef&trade; Mark and Chef Logo are either registered trademarks/service marks or trademarks/servicemarks of Chef, in the United States and other countries and are used with Chef Inc's permission.<br>We are not affiliated with, endorsed or sponsored by Chef Inc.<br>
    <a href="https://docs.chef.io/desktop/automate_server/" class="_attribution-link">https://docs.chef.io/desktop/automate_server/</a>
  </p>
</div>
