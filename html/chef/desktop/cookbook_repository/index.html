<div id="col-content" data-swiftype-index="true"> <div id="set-up-cookbook-for-windows-10-and-macos-platforms"><h1>Set up Cookbook for Windows 10 and macOS Platforms</h1></div>  <div class="prose"> <p>Estimated time: 1 hour (with your own virtual machines)</p> <p>This step introduces you to fundamentals of cookbook development and walks you through the process of creating, editing, and testing a simple cookbook. These are the same basic steps that you will expand on in developing your Chef Desktop cookbook.</p> <ol> <li>Learn about testing with Test Kitchen</li> <li>Set up your Chef development environment</li> <li>Make a demo cookbook</li> <li>Test your cookbook locally</li> <li>Test your cookbook with Test Kitchen, once you have your virtual machine images</li> </ol> <h2 id="developing-cookbooks">Developing Cookbooks</h2> <p>Testing is central to good software development. Testing your Chef Desktop cookbook provides you the opportunity to detect and correct problems before putting changes into production. Testing saves time and money, but it adds value by helping your organization achieve and maintain operational velocity.</p> <h3 id="licenses">Licenses</h3> <p>It is important to understand your operating license and service agreements. The best place to begin is find and understand your SLA:</p> <ul> <li><a href="https://www.microsoft.com/licensing/default">Windows Licenses</a></li> <li><a href="https://www.apple.com/legal/sla/">Apple macOS SLA</a></li> </ul> <h3 id="setup-your-development-environment">Setup Your Development Environment</h3> <p>In this step, you will prepare your workstation for developing, testing, and deploying the Chef Desktop cookbook.</p> <ol> <li> <p>Create your local repo</p> <p>You will need a local repository on your workstation for storing your cookbooks and related chef work, and for sharing it with GitHub or another version control system.</p> <p>From the command line in your root folder (c:\ or ~/), run:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-powershell" data-lang="powershell">chef generate repo my_repo
</code></pre></div>
</li> </ol> <h3 id="make-your-first-cookbook">Make Your First Cookbook</h3> <p>This is a practice cookbook to understand how to test.</p> <ol> <li> <p>Create your cookbook</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-powershell" data-lang="powershell">chef generate cookbook my_repo/cookbooks/my_cookbook
</code></pre></div>
</li> <li> <p>Edit the <code>metadata.rb</code> file</p> <p>Open your repo in Visual Studio Code. The one key file you will want to manage is the <code>metadata.rb</code> file. Please take a moment now to add your contact information and enter a starting version number for your cookbook.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-powershell" data-lang="powershell">name <span style="color:#4070a0">'my_cookbook'</span>
maintainer <span style="color:#4070a0">'The Authors'</span>
maintainer_email <span style="color:#4070a0">'you@example.com'</span>
license <span style="color:#4070a0">'All Rights Reserved'</span>
description <span style="color:#4070a0">'Installs/Configures my_cookbook'</span>
version <span style="color:#4070a0">'0.1.0'</span>
chef_version <span style="color:#4070a0">'&gt;= 16.0'</span>
</code></pre></div>
</li> <li> <p>Edit the default recipe</p> <p>Open <code>my_repo\cookbook\my_cookbook\recipes\default.rb</code> in Visual Studio and add:</p> <p>For Windows:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">powershell_script <span style="color:#4070a0">'get my path'</span> <span style="color:#007020;font-weight:700">do</span>
  code <span style="color:#4070a0">&lt;&lt;-CODE
</span>  <span style="color:#666">[</span><span style="color:#60add5">Environment</span><span style="color:#666">]::</span><span style="color:#60add5">GetEnvironmentVariable</span>(<span style="color:#4070a0">"Path"</span>)
  <span style="color:#60add5">CODE</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>For macOS:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">bash <span style="color:#4070a0">'get my path'</span> <span style="color:#007020;font-weight:700">do</span>
  user <span style="color:#4070a0">'root'</span>
  code <span style="color:#4070a0">&lt;&lt;-EOH
</span>  echo $PATH
  <span style="color:#60add5">EOH</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<ul> <li>Spacing matters! Be mindful of spaces</li> <li>Use LF line spacing and not CRLF. (Look to the bottom right of the status bar in Visual Studio Code)</li> </ul> </li> </ol> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>If you want to use the Chef Desktop cookbook you received from Chef instead of creating a new one, then navigate and unzip that file into your cookbooks directory. Now you have two cookbooks. Update the <code>metadata.rb</code> file for the Chef Desktop cookbook to add your contact details.</p> <p>Chef Desktop comes with a large number of options for configuring your Windows and Mac desktops. Look through the <code>mac.rb</code> and <code>windows.rb</code> files to explore what settings you want to turn on for your testing and evaluation. For those resources you do not want to explore yet, set their action to ‘:nothing’. See the <a href="../desktop-cookbook/index.html">Chef Desktop cookbook documentation</a> for more information about settings.</p> </div> </div> <h2 id="testing-cookbooks-with-test-kitchen">Testing cookbooks with Test Kitchen</h2> <p>Test Kitchen was installed with Chef Workstation. It provides Chef Infra with a testing harness for cookbooks that uses virtual machines(VMs). Consult your Apple and Microsoft licenses and service level agreements (SLA) to understand your options for acquiring or creating VMs for development.</p> <h3 id="test-kitchen-integrations">Test Kitchen Integrations</h3> <p>Test Kitchen uses a driver plugin architecture to enable Test Kitchen to test instances on cloud providers such as Amazon EC2, Google Compute Engine, and Microsoft Azure. You can also test on multiple local hypervisors, such as VMware, Hyper-V, or VirtualBox. <a href="../../workstation/kitchen/index.html">Test Kitchen Documentation</a> and the <a href="https://github.com/test-kitchen">Test Kitchen GitHub Repository</a>.</p> <h3 id="run-test-kitchen">Run Test Kitchen</h3> <ol> <li> <p><strong>Run the Virtual Devices</strong></p> <p>When working with desktop cookbook that you received from Chef, you downloaded the two virtual devices, also called testing images. Now issue the following command to get them started:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-powershell" data-lang="powershell">kitchen create
</code></pre></div>
</li> <li> <p><strong>Apply the Cookbooks to the Images</strong></p> <p>Run the following command to apply, or ‘converge’, the cookbooks with the base OS image:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-powershell" data-lang="powershell">kitchen converge
</code></pre></div>
</li> <li> <p><strong>Verify the settings</strong></p> <p>Confirm that the converged code is the code that you meant to apply. In VSCode, navigate to the <code>test\integration\default</code> directory and examine the generated integration tests. Carefully go through these tests and adjust them to match the setting to the changes in the <code>default.rb</code> file. Next, run:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-powershell" data-lang="powershell">kitchen verify
</code></pre></div>
<p>If any of the tests fail, check the output and compare your settings in the <code>mac.rb</code> or <code>windows.rb</code> files against the matching tests.</p> </li> <li> <p><strong>Cleanup</strong></p> <p>When you finish with your testing, you can run the following command to delete the running test images:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-powershell" data-lang="powershell">kitchen destroy
</code></pre></div>
</li> </ol> <h4 id="kitchen-test">Kitchen Test</h4> <p>Once you are familiar with Test Kitchen, you can perform all of the steps at once, including cleanup, with:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-powershell" data-lang="powershell">kitchen test
</code></pre></div> </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; Chef Software, Inc.<br>Licensed under the Creative Commons Attribution 3.0 Unported License.<br>The Chef&trade; Mark and Chef Logo are either registered trademarks/service marks or trademarks/servicemarks of Chef, in the United States and other countries and are used with Chef Inc's permission.<br>We are not affiliated with, endorsed or sponsored by Chef Inc.<br>
    <a href="https://docs.chef.io/desktop/cookbook_repository/" class="_attribution-link">https://docs.chef.io/desktop/cookbook_repository/</a>
  </p>
</div>
