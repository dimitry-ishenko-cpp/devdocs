<div id="col-content" data-swiftype-index="true"> <div id="about-templates"><h1>About Templates</h1></div>  <div class="prose"> <p data-swiftype-index="false"> <a href="https://github.com/chef/chef-web-docs/blob/main/content/templates.md" alt="Link to page on GitHub repository">[edit on GitHub]</a> </p> <p>A cookbook template is an Embedded Ruby (ERB) template that is used to dynamically generate static text files. Templates may contain Ruby expressions and statements, and are a great way to manage configuration files. Use the <strong>template</strong> resource to add cookbook templates to recipes; place the corresponding Embedded Ruby (ERB) template file in a cookbook’s <code>/templates</code> directory.</p> <p>The <code>templates</code> directory does not exist by default in a cookbook. Generate the <code>templates</code> directory and a template file from the <code>chef-repo/cookbooks</code> directory with the command:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef generate template PATH_TO_COOKBOOK TEMPLATE_NAME
</code></pre></div>
<p>For example, this command generates a <code>httpd</code> template in the <code>custom_web</code> cookbook:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef generate template cookbooks/custom_web httpd
</code></pre></div>
<p>The <code>custom_web</code> cookbook directory with a template has the structure:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-text" data-lang="text">├ cookbooks
 ├ custom_web
   ├ .delivery
   | └ project.toml
   ├ recipes
   | └ default.rb
   ├ templates
   | └ http.erb
   ├ test
   | └ integration
   | | └ default
   | | | └ default_test.rb
   ├ .gitignore
   ├ CHANGELOG.md
   ├ chefignore
   ├ kitchen.yml
   ├ LICENSE
   ├ metadata.rb
   ├ Policyfile.rb
   └ README.md
</code></pre></div>
<h2 id="requirements">Requirements</h2> <p>To use a template, two things must happen:</p> <ol> <li>A template resource must be added to a recipe</li> <li>An Embedded Ruby (ERB) template must be added to a cookbook</li> </ol> <p>For example, the following template file and template resource settings can be used to manage a configuration file named <code>/etc/sudoers</code>. Within a cookbook that uses sudo, the following resource could be added to <code>/recipes/default.rb</code>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">'/etc/sudoers'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'sudoers.erb'</span>
  mode <span style="color:#4070a0">'0440'</span>
  owner <span style="color:#4070a0">'root'</span>
  group <span style="color:#4070a0">'root'</span>
  variables(<span style="color:#517918">sudoers_groups</span>: node<span style="color:#666">[</span><span style="color:#4070a0">'authorization'</span><span style="color:#666">][</span><span style="color:#4070a0">'sudo'</span><span style="color:#666">][</span><span style="color:#4070a0">'groups'</span><span style="color:#666">]</span>,
            <span style="color:#517918">sudoers_users</span>: node<span style="color:#666">[</span><span style="color:#4070a0">'authorization'</span><span style="color:#666">][</span><span style="color:#4070a0">'sudo'</span><span style="color:#666">][</span><span style="color:#4070a0">'users'</span><span style="color:#666">]</span>)
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>And then create a template called <code>sudoers.erb</code> and save it to <code>templates/default/sudoers.erb</code>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#60a0b0;font-style:italic">#</span>
<span style="color:#60a0b0;font-style:italic"># /etc/sudoers</span>
<span style="color:#60a0b0;font-style:italic">#</span>
<span style="color:#60a0b0;font-style:italic"># Generated by Chef for &lt;%= node['fqdn'] %&gt;</span>
<span style="color:#60a0b0;font-style:italic">#</span>

<span style="color:#60add5">Defaults</span>        <span style="color:#666">!</span>lecture,tty_tickets,<span style="color:#666">!</span>fqdn

<span style="color:#60a0b0;font-style:italic"># User privilege specification</span>
root          <span style="color:#60add5">ALL</span><span style="color:#666">=</span>(<span style="color:#60add5">ALL</span>) <span style="color:#60add5">ALL</span>

<span style="color:#666">&lt;</span><span style="color:#c65d09">% @sudoers_users.each </span> <span style="color:#007020;font-weight:700">do</span> <span style="color:#666">|</span>user<span style="color:#666">|</span> <span style="color:#666">-</span><span style="color:#4070a0">%&gt;
</span><span style="color:#4070a0">&lt;%= user %&gt;</span>   <span style="color:#60add5">ALL</span><span style="color:#666">=</span>(<span style="color:#60add5">ALL</span>) <span style="color:#666">&lt;</span><span style="color:#4070a0">%= "NOPASSWD:" if @passwordless %&gt;ALL
</span><span style="color:#4070a0">&lt;% end -%&gt;
</span><span style="color:#4070a0"># Members of the sysadmin group may gain root privileges
</span><span style="color:#4070a0">%sysadmin     ALL=</span>(<span style="color:#60add5">ALL</span>) <span style="color:#666">&lt;</span><span style="color:#4070a0">%= "NOPASSWD:" if @passwordless %&gt;ALL
</span><span style="color:#4070a0">&lt;% @sudoers_groups.each do |group| -%&gt;
</span><span style="color:#4070a0"># Members of the group '&lt;%=</span> group <span style="color:#4070a0">%&gt;' may gain root privileges
</span><span style="color:#4070a0">&lt;%= group %&gt;</span> <span style="color:#60add5">ALL</span><span style="color:#666">=</span>(<span style="color:#60add5">ALL</span>) <span style="color:#666">&lt;%=</span> <span style="color:#4070a0">"NOPASSWD:"</span> <span style="color:#007020;font-weight:700">if</span> @passwordless <span style="color:#4070a0">%&gt;ALL
</span><span style="color:#4070a0">&lt;% end -%&gt;</span>
</code></pre></div>
<p>And then set the default attributes in <code>attributes/default.rb</code>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">default<span style="color:#666">[</span><span style="color:#4070a0">'authorization'</span><span style="color:#666">][</span><span style="color:#4070a0">'sudo'</span><span style="color:#666">][</span><span style="color:#4070a0">'groups'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#c65d09">%w(sysadmin wheel admin)</span>
default<span style="color:#666">[</span><span style="color:#4070a0">'authorization'</span><span style="color:#666">][</span><span style="color:#4070a0">'sudo'</span><span style="color:#666">][</span><span style="color:#4070a0">'users'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#c65d09">%w(jerry greg)</span>
</code></pre></div> <h2 id="variables">Variables</h2> <p>An Embedded Ruby (ERB) template allows Ruby code to be embedded inside a text file within specially formatted tags. Ruby code can be embedded using expressions and statements. An expression is delimited by <code>&lt;%=</code> and <code>%&gt;</code>. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#666">&lt;%=</span> <span style="color:#4070a0">"my name is </span><span style="color:#70a0d0;font-style:italic">#{</span>$ruby<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">"</span> <span style="color:#666">%&gt;</span>
</code></pre></div>
<p>A statement is delimited by a modifier, such as <code>if</code>, <code>elsif</code>, and <code>else</code>. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#007020;font-weight:700">if</span> <span style="color:#007020">false</span>
<span style="color:#60a0b0;font-style:italic"># this won't happen</span>
<span style="color:#007020;font-weight:700">elsif</span> <span style="color:#007020">nil</span>
      <span style="color:#60a0b0;font-style:italic"># this won't either</span>
    <span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Using a Ruby expression is the most common approach for defining template variables because this is how all variables that are sent to a template are referenced. Whenever a template needs to use an <code>each</code>, <code>if</code>, or <code>end</code>, use a Ruby statement.</p> <p>When a template is rendered, Ruby expressions and statements are evaluated by Chef Infra Client. The variables listed in the <strong>template</strong> resource’s <code>variables</code> parameter and in the node object are evaluated. Chef Infra Client then passes these variables to the template, where they will be accessible as instance variables within the template. The node object can be accessed just as if it were part of a recipe, using the same syntax.</p> <p>For example, a simple template resource like this:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">node<span style="color:#666">[</span><span style="color:#4070a0">'fqdn'</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#4070a0">'latte'</span>
template <span style="color:#4070a0">'/tmp/foo'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'foo.erb'</span>
  variables(<span style="color:#517918">x_men</span>: <span style="color:#4070a0">'are keen'</span>)
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>And a simple Embedded Ruby (ERB) template like this:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#60add5">The</span> node <span style="color:#666">&lt;</span><span style="color:#4070a0">%= node[:fqdn] %&gt; thinks the x-men &lt;%=</span> @x_men <span style="color:#666">%&gt;</span>
</code></pre></div>
<p>Would render something like:</p> <pre tabindex="0" class="highlight" data-language="ruby"><code>The node latte thinks the x-men are keen
</code></pre>
<p>Even though this is a very simple example, the full capabilities of Ruby can be used to tackle even the most complex and demanding template requirements.</p> <h2 id="file-specificity">File Specificity</h2> <p>A cookbook is frequently designed to work across many platforms and is often required to distribute a specific template to a specific platform. A cookbook can be designed to support the distribution of templates across platforms, while ensuring that the correct template ends up on each system.</p> <p>The pattern for template specificity depends on two things: the lookup path and the source. The first pattern that matches is used:</p> <ol> <li><code>/host-$fqdn/$source</code></li> <li><code>/$platform-$platform_version/$source</code></li> <li><code>/$platform/$source</code></li> <li><code>/default/$source</code></li> <li><code>/$source</code></li> </ol> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>To specify a particular Windows version, use the <a href="https://docs.microsoft.com/en-us/windows/win32/sysinfo/operating-system-version">operating system version number</a>. For example, a template in <code>templates/windows-6.3</code> will be deployed on systems installed with Windows 8.1.</p> </div> </div> <p>Use an array with the <code>source</code> property to define an explicit lookup path. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">'/test'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#666">[</span><span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">.</span>chef_environment<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">.erb"</span>, <span style="color:#4070a0">'default.erb'</span><span style="color:#666">]</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>The following example emulates the entire file specificity pattern by defining it as an explicit path:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">'/test'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#c65d09">%W(
</span><span style="color:#c65d09">    host-</span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'fqdn'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#c65d09">/test.erb
</span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'platform'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#c65d09">-</span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'platform_version'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#c65d09">/test.erb
</span><span style="color:#70a0d0;font-style:italic">#{</span>node<span style="color:#666">[</span><span style="color:#4070a0">'platform'</span><span style="color:#666">]</span><span style="color:#70a0d0;font-style:italic">}</span><span style="color:#c65d09">/test.erb
</span><span style="color:#c65d09">    default/test.erb
</span><span style="color:#c65d09">  )</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>A cookbook may have a <code>/templates</code> directory structure like this:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#235388">/templates/</span>
  windows<span style="color:#666">-</span><span style="color:#40a070">10</span>
  windows<span style="color:#666">-</span><span style="color:#40a070">6</span><span style="color:#666">.</span><span style="color:#40a070">3</span>
  windows
  default
</code></pre></div>
<p>and a resource that looks something like the following:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">'C:\path\to\file\text_file.txt'</span> <span style="color:#007020;font-weight:700">do</span>
  source <span style="color:#4070a0">'text_file.txt'</span>
  mode <span style="color:#4070a0">'0755'</span>
  owner <span style="color:#4070a0">'root'</span>
  group <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>This resource would be matched in the same order as the <code>/templates</code> directory structure. For a node named <code>host-node-desktop</code> that is running Windows 8.1, the second item would be the matching item and the location:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#235388">/templates
</span><span style="color:#235388">  windows-10/</span>text_file<span style="color:#666">.</span>txt
  windows<span style="color:#666">-</span><span style="color:#40a070">6</span><span style="color:#666">.</span><span style="color:#40a070">3</span><span style="color:#666">/</span>text_file<span style="color:#666">.</span>txt
  windows<span style="color:#666">/</span>text_file<span style="color:#666">.</span>txt
  default<span style="color:#666">/</span>text_file<span style="color:#666">.</span>txt
</code></pre></div>
<h2 id="host-notation">Host Notation</h2> <p>The naming of folders within cookbook directories must literally match the host notation used for template specificity matching. For example, if a host is named <code>foo.example.com</code>, then the folder must be named <code>host-foo.example.com</code>.</p> <h2 id="transfer-frequency">Transfer Frequency</h2> <p>The Chef Infra Client caches a template when it is first requested. On each subsequent request for that template, the Chef Infra Client compares that request to the template located on the Chef Infra Server. If the templates are the same, no transfer occurs.</p> <h2 id="partial-templates">Partial Templates</h2> <p>A template can be built in a way that allows it to contain references to one (or more) smaller template files. (These smaller template files are also referred to as partials.) A partial can be referenced from a template file in one of the following ways:</p> <ul> <li>By using the <code>render</code> method in the template file</li> <li>By using the <strong>template</strong> resource and the <code>variables</code> property.</li> </ul> <h3 id="variables-attribute">variables Attribute</h3> <p>The <code>variables</code> property of the <strong>template</strong> resource can be used to reference a partial template file by using a Hash. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">template <span style="color:#4070a0">'/file/name.txt'</span> <span style="color:#007020;font-weight:700">do</span>
  variables <span style="color:#517918">partials</span>: {
    <span style="color:#4070a0">'partial_name_1.txt.erb'</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'message'</span>,
    <span style="color:#4070a0">'partial_name_2.txt.erb'</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'message'</span>,
    <span style="color:#4070a0">'partial_name_3.txt.erb'</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'message'</span>,
  }
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>where each of the partial template files can then be combined using normal Ruby template patterns within a template file, such as:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#666">&lt;</span><span style="color:#c65d09">% @partials.each </span> <span style="color:#007020;font-weight:700">do</span> <span style="color:#666">|</span>partial, message<span style="color:#666">|</span> <span style="color:#4070a0">%&gt;
</span><span style="color:#4070a0">  Here is &lt;%= partial %&gt;</span>
  <span style="color:#666">&lt;</span><span style="color:#4070a0">%= render partial, :variables =</span><span style="color:#666">&gt;</span> {<span style="color:#517918">:message</span> <span style="color:#666">=&gt;</span> message} <span style="color:#4070a0">%&gt;
</span><span style="color:#4070a0">&lt;% end %&gt;</span>
</code></pre></div> <h3 id="render-method">render Method</h3> <p>Use the <code>render</code> method in a template to reference a partial template file:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#666">&lt;</span><span style="color:#4070a0">%= render 'partial_name.txt.erb', :option =</span><span style="color:#666">&gt;</span> {} <span style="color:#666">%&gt;</span>
</code></pre></div>
<p>where <code>partial_name</code> is the name of the partial template file and <code>:option</code> is one (or more) of the following:</p> <table> <col style="width:12%"> <col style="width:87%"> <thead> <tr class="header"> <th>Option</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>:cookbook</code></td> <td>By default, a partial template file is assumed to be located in the cookbook that contains the top-level template. Use this option to specify the path to a different cookbook</td> </tr> <tr> <td><code>:local</code></td> <td>Indicates that the name of the partial template file should be interpreted as a path to a file in the local file system or looked up in a cookbook using the normal rules for template files. Set to <code>true</code> to interpret as a path to a file in the local file system and to <code>false</code> to use the normal rules for template files</td> </tr> <tr> <td><code>:source</code></td> <td>By default, a partial template file is identified by its file name. Use this option to specify a different name or a local path to use (instead of the name of the partial template file)</td> </tr> <tr> <td><code>:variables</code></td> <td>A hash of <code>variable_name =&gt; value</code> that will be made available to the partial template file. When this option is used, any variables that are defined in the top-level template that are required by the partial template file must have them defined explicitly using this option</td> </tr> </tbody> </table> <p>For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#666">&lt;</span><span style="color:#4070a0">%= render 'simple.txt.erb', :variables =</span><span style="color:#666">&gt;</span> {<span style="color:#517918">:user</span> <span style="color:#666">=&gt;</span> <span style="color:#60add5">Etc</span><span style="color:#666">.</span>getlogin }, <span style="color:#517918">:local</span> <span style="color:#666">=&gt;</span> <span style="color:#007020">true</span> <span style="color:#666">%&gt;</span>
</code></pre></div> </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; Chef Software, Inc.<br>Licensed under the Creative Commons Attribution 3.0 Unported License.<br>The Chef&trade; Mark and Chef Logo are either registered trademarks/service marks or trademarks/servicemarks of Chef, in the United States and other countries and are used with Chef Inc's permission.<br>We are not affiliated with, endorsed or sponsored by Chef Inc.<br>
    <a href="https://docs.chef.io/templates/" class="_attribution-link">https://docs.chef.io/templates/</a>
  </p>
</div>
