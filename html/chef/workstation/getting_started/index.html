<div id="col-content" data-swiftype-index="true"> <div id="setup-chef-workstation"><h1>Setup Chef Workstation</h1></div>  <div class="prose"> <p data-swiftype-index="false"> <a href="https://github.com/chef/chef-workstation/blob/main/docs-chef-io/content/workstation/getting_started.md" alt="Link to page on GitHub repository">[edit on GitHub]</a> </p> <p>This guide walks your through the four parts to set up Chef Workstation on your computer.</p> <ul> <li><a href="#configure-ruby-environment">Configure Ruby Environment</a></li> <li>
<a href="#setup-your-chef-repo">Set up your chef-repo</a> for storing your cookbooks</li> <li><a href="#setup-chef-credentials">Setup Chef Credentials</a></li> <li><a href="#Verify%20Client-to-Server%20Communication">Verify Client-to-Server Communication</a></li> </ul> <h2 id="prerequisites">Prerequisites</h2> <ol> <li><a href="../install_workstation/index.html">Download and install Chef Workstation</a></li> <li>A running instance of <a href="../../server/install_server/index.html">Chef Infra Server</a> or <a href="https://manage.chef.io/signup">Hosted Chef Server</a>.</li> <li>Unless using Chef Manage or Hosted Chef, the <code>CLIENT.PEM</code> file supplied by your Chef administrator.</li> </ol> <h2 id="configure-ruby-environment">Configure Ruby Environment</h2> <p>For many users, Ruby is primarily used for developing Chef policy (for example, cookbooks, Policyfiles, and Chef InSpec profiles). If that’s true for you, then we recommend using the Chef Workstation Ruby as your default system Ruby. If you use Ruby for software development, you’ll want to skip this step.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> These instructions are intended for macOS and Linux users. On Windows, Chef Workstation includes a desktop shortcut to a PowerShell prompt already configured for use. </div> </div> <ol> <li> <p>Determine your default shell by running:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash"><span style="color:#007020">echo</span> <span style="color:#bb60d5">$SHELL</span>
</code></pre></div>
<p>This will give you the path to your default shell such as <code>/bin/zsh</code> for the Zsh shell.</p> </li> <li> <p>Add the Workstation initialization content to the appropriate shell rc file:</p> <p>For Bash shells run:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash"><span style="color:#007020">echo</span> <span style="color:#4070a0">'eval "$(chef shell-init bash)"'</span> &gt;&gt; ~/.bashrc
</code></pre></div>
<p>For Zsh shells run:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash"><span style="color:#007020">echo</span> <span style="color:#4070a0">'eval "$(chef shell-init zsh)"'</span> &gt;&gt; ~/.zshrc
</code></pre></div>
<p>For Fish shells run:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash"><span style="color:#007020">echo</span> <span style="color:#4070a0">'eval (chef shell-init fish)'</span> &gt;&gt; ~/.config/fish/config.fish
</code></pre></div>
</li> <li> <p>Open a new shell window and run:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">which ruby
</code></pre></div>
<p>The command should return <code>/opt/chef-workstation/embedded/bin/ruby</code>.</p> </li> </ol> <h2 id="setup-your-chef-repo">Setup Your Chef Repo</h2> <p>If you’re setting up Chef for the very first time <strong>in your organization</strong>, then you will need a Chef Infra repository for saving your cookbooks and other work.</p> <p>The chef-repo is a directory on your workstation that stores everything you need to define your infrastructure with Chef Infra:</p> <ul> <li>Cookbooks (including recipes, attributes, custom resources, libraries, and templates)</li> <li>Data bags</li> <li>Policyfiles</li> </ul> <p>The chef-repo directory should be synchronized with a version control system, such as git. All of the data in the chef-repo should be treated like source code.</p> <p>You’ll use the <code>chef</code> and <code>knife</code> commands to upload data to the Chef Infra Server from the chef-repo directory. Once uploaded, Chef Infra Client uses that data to manage the nodes registered with the Chef Infra Server and to ensure that it applies the right cookbooks, policyfiles, and settings to the right nodes in the right order.</p> <p>Use the <a href="../ctl_chef/index.html#chef-generate-repo">chef generate repo</a> command to create your Chef Infra repository. For example, to create a repository called <code>chef-repo</code>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef generate repo chef-repo
</code></pre></div>
<h2 id="setup-chef-credentials">Setup Chef Credentials</h2> <p>The first time you run the Chef Workstation app, it creates a <code>.chef</code> directory in your user directory. The <code>.chef</code> directory is where you will store your Chef Workstation configuration and your client keys.</p> <p>If you’re setting up Chef Workstation <strong>as a Chef Infra Server administrator</strong>, then you will need to manage users with the <a href="../../server/ctl_chef_server/index.html#user-management">Chef Infra Server CLI</a> or the Manage UI. When you create a new user, a user-specific RSA client key will be generated, which you then need to share securely with that user.</p> <p>If you’re setting up Chef Workstation <strong>as a Chef user</strong>, then you will need to setup your unique client private key that corresponds to a client on the Chef Infra Server that your server administrator creates for you. The client private key is an RSA private key in the <code>.pem</code> format.</p> <h3 id="configure-your-user-credentials-file">Configure Your User Credentials File</h3> <p>Your <code>.chef</code> directory contains a <code>credentials</code> file used to communicate with the Chef Infra Server. You can generate this file by running <code>knife configure</code> and following the prompts.</p> <p>The <code>knife configure</code> command requires the following values:</p> <ul> <li>
<code>Chef Server URL</code>: the full URL to your Chef Infra Server including the org</li> <li>
<code>Client Name</code>: the client name your server administrator created for you</li> </ul> <p>Your Chef administrator should provide this information. For Hosted Chef or Chef Manage, you can find this information in the Starter Kit file. Download the file on the Manage site by navigating to the Administration tab and selecting Starter Kit. (<strong>Manage &gt; Administration &gt; Starter Kit &gt; Download Starter Kit</strong>)</p> <p>Find the <code>.chef/config.rb</code> file in the Starter Kit. It should look like:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">current_dir <span style="color:#666">=</span> <span style="color:#60add5">File</span><span style="color:#666">.</span>dirname(__FILE__)
log_level                <span style="color:#517918">:info</span>
log_location             <span style="color:#60add5">STDOUT</span>
node_name                <span style="color:#4070a0">"hshefu"</span>
client_key               <span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span>current_dir<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">/hshefu.pem"</span>
chef_server_url          <span style="color:#4070a0">"https://api.chef.io/organizations/4thcafe-web-team"</span>
cookbook_path            <span style="color:#666">[</span><span style="color:#4070a0">"</span><span style="color:#70a0d0;font-style:italic">#{</span>current_dir<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">/../cookbooks"</span><span style="color:#666">]</span>
</code></pre></div>
<p>Use the <code>chef_server_url</code> and <code>node_name</code> values from this file when running <code>knife configure</code>.</p> <h3 id="setup-your-client-private-key">Setup Your Client Private Key</h3> <p>All communication between Chef Workstation and the Chef Infra Server is authenticated using an RSA public/private key pair. This pair is generated on the Chef Infra Server and the private key must be copied to your local Chef Workstation installation for communication to function.</p> <p>The steps for downloading or generating these files vary depending on how you interact with Chef Infra Server. Select the option that best describes how you interact with the server:</p> <ul class="tabs" data-tabs id="tabs-panel-container"> <li class="tabs-title is-active"> <a href="#infra_and_automate_keys" aria-selected="true">Chef Infra Server / Automate</a> </li> <li class="tabs-title"> <a data-tabs-target="hosted-keys" href="#hosted-keys">Hosted Chef / Manage</a> </li> </ul> <div class="tabs-content" data-tabs-content="tabs-panel-container"> <div class="tabs-panel is-active" id="infra_and_automate_keys">
<p>Your Chef administrator will provide you with your client.pem file. Copy this file to the <code>~/.chef</code> directory.</p> <p>On macOS and Linux systems this looks something like:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">cp ~/Downloads/MY_NAME.pem ~/.chef/
</code></pre></div>
<p>On Windows systems this will look something like this:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-powershell" data-lang="powershell"><span style="color:#007020">Copy-Item</span> -Path C:\Users\MY_NAME\Downloads\MY_NAME.pem -Destination C:\Users\MY_NAME\.chef\
</code></pre></div>
</div> <div class="tabs-panel" id="hosted-keys">
<p>The client key file is located in the Starter Kit at <code>.chef/MY_NAME.pem</code>. Copy the .pem file to the <code>~/.chef</code> directory.</p> <p>On macOS and Linux systems this looks something like:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">cp ~/Downloads/chef-repo/.chef/MY_NAME.pem ~/.chef/
</code></pre></div>
<p>On Windows systems this will look something like this:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-powershell" data-lang="powershell"><span style="color:#007020">Copy-Item</span> -Path C:\Users\MY_NAME\Downloads\<span style="color:#007020">chef-repo</span>\.chef\MY_NAME.pem -Destination C:\Users\MY_NAME\.chef\
</code></pre></div>
</div> </div> <h2 id="verify-client-to-server-communication">Verify Client-to-Server Communication</h2> <p>To verify that Chef Workstation can connect to the Chef Infra Server:</p> <p>Run the following command on the command line:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">knife client list
</code></pre></div>
<p>Which should return a list of clients similar to:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">chef_machine
registered_node
</code></pre></div>
<h3 id="fetch-self-signed-certificates">Fetch Self Signed Certificates</h3> <p>If the Chef Infra Server you’re configured to use has a self signed certificate, you’ll use the <code>knife ssl fetch</code> subcommand to download the the Chef Infra Server TLS/SSL certificate and save it in your <code>.chef/trusted_certs</code>.</p> <p>Chef Infra verifies the security of all requests made to the server from tools such a knife and Chef Infra Client. The certificate that is generated during the installation of the Chef Infra Server is self-signed, which means there isn’t a signing certificate authority (CA) to verify. In addition, this certificate must be downloaded to any machine from which knife and/or Chef Infra Client will make requests to the Chef Infra Server.</p> <p>Use the <code>knife ssl fetch</code> subcommand to pull the SSL certificate down from the Chef Infra Server:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">knife ssl fetch
</code></pre></div>
<p>See <a href="../../chef_client_security/index.html#ssl-certificates">SSL Certificates</a> for more information about how knife and Chef Infra Client use SSL certificates generated by the Chef Infra Server.</p> </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; Chef Software, Inc.<br>Licensed under the Creative Commons Attribution 3.0 Unported License.<br>The Chef&trade; Mark and Chef Logo are either registered trademarks/service marks or trademarks/servicemarks of Chef, in the United States and other countries and are used with Chef Inc's permission.<br>We are not affiliated with, endorsed or sponsored by Chef Inc.<br>
    <a href="https://docs.chef.io/workstation/getting_started/" class="_attribution-link">https://docs.chef.io/workstation/getting_started/</a>
  </p>
</div>
