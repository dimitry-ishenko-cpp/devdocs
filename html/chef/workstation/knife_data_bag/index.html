<div id="col-content" data-swiftype-index="true"> <div id="knife-data-bag"><h1>knife data bag</h1></div>  <div class="prose"> <p data-swiftype-index="false"> <a href="https://github.com/chef/chef-workstation/blob/main/docs-chef-io/content/workstation/knife_data_bag.md" alt="Link to page on GitHub repository">[edit on GitHub]</a> </p> <p>Data bags store global variables as JSON data. Data bags are indexed for searching and can be loaded by a cookbook or accessed during a search.</p> <p>A data bag item may be encrypted using <a href="https://en.wikipedia.org/wiki/Symmetric-key_algorithm">shared secret encryption</a>. This allows each data bag item to store confidential information (such as a database password) or to be managed in a source control system (without plain-text data appearing in revision history). Each data bag item may be encrypted individually; if a data bag contains multiple encrypted data bag items, these data bag items are not required to share the same encryption keys.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>Because the contents of encrypted data bag items are not visible to the Chef Infra Server, search queries against data bags with encrypted items will not return any results.</p> </div> </div> <p>Use the <code>knife data bag</code> subcommand to manage arbitrary stores of globally available JSON data.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> Review the list of <a href="../knife_options/index.html">common options</a> available to this (and all) knife subcommands and plugins. </div> </div> <h2 id="create">create</h2> <p>Use the <code>create</code> argument to add a data bag to the Chef Infra Server.</p> <h3 id="syntax">Syntax</h3> <p>This argument has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">knife data bag create DATA_BAG_NAME <span style="color:#666">[</span>DATA_BAG_ITEM<span style="color:#666">]</span> <span style="color:#666">(</span>options<span style="color:#666">)</span>
</code></pre></div>
<h3 id="options">Options</h3> <p>This argument has the following options:</p> <dl> <dt><code>DATA_BAG_ITEM</code></dt> <dd> <p>The name of a specific item within a data bag. <code>DATA_BAG_NAME</code> may not be <code>client</code>, <code>environment</code>, <code>node</code> or <code>role</code>, as these are reserved words for <a href="../knife_search/index.html">knife search</a>.</p> </dd> <dt><code>--secret SECRET</code></dt> <dd> <p>The encryption key that is used for values contained within a data bag item. If <code>secret</code> is not specified, Chef Infra Client looks for a secret at the path specified by the <code>encrypted_data_bag_secret</code> setting in the client.rb file. For encrypted data bag items, use <strong>either</strong> <code>--secret</code> or <code>--secret-file</code>, not both.</p> </dd> <dt><code>--secret-file FILE</code></dt> <dd> <p>The path to the file that contains the encryption key.</p> </dd> </dl> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> See <a href="../config_rb_optional_settings/index.html">config.rb</a> for more information about how to add certain knife options as settings in the config.rb file. </div> </div> <h3 id="examples">Examples</h3> <p>The following examples show how to use this knife subcommand:</p> <p><strong>Create a data bag</strong></p> <p>To create a data bag named “admins”, enter:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">knife data bag create admins
</code></pre></div>
<p>to return:</p> <pre tabindex="0" class="highlight" data-language="ruby"><code class="language-none" data-lang="none">Created data_bag[admins]
</code></pre>
<h2 id="delete">delete</h2> <p>Use the <code>delete</code> argument to delete a data bag or a data bag item from a Chef Infra Server.</p> <h3 id="syntax-1">Syntax</h3> <p>This argument has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">knife data bag delete DATA_BAG_NAME <span style="color:#666">[</span>DATA_BAG_ITEM<span style="color:#666">]</span> <span style="color:#666">(</span>options<span style="color:#666">)</span>
</code></pre></div>
<h3 id="options-1">Options</h3> <p>This argument has the following options:</p> <dl> <dt><code>DATA_BAG_ITEM</code></dt> <dd> <p>The name of a specific item within a data bag.</p> </dd> </dl> <h3 id="examples-1">Examples</h3> <p>The following examples show how to use this knife subcommand:</p> <p><strong>Delete a data bag</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">knife data bag delete data_bag_name
</code></pre></div>
<p><strong>Delete a data bag item</strong></p> <p>To delete an item named “charlie”, enter:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">knife data bag delete admins charlie
</code></pre></div>
<p>Type <code>Y</code> to confirm a deletion.</p> <h2 id="edit">edit</h2> <p>Use the <code>edit</code> argument to edit the data contained in a data bag. If encryption is being used, the data bag will be decrypted, the data will be made available in the $EDITOR, and then encrypted again before saving it to the Chef Infra Server.</p> <h3 id="syntax-2">Syntax</h3> <p>This argument has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">knife data bag edit DATA_BAG_NAME <span style="color:#666">[</span>DATA_BAG_ITEM<span style="color:#666">]</span> <span style="color:#666">(</span>options<span style="color:#666">)</span>
</code></pre></div>
<h3 id="options-2">Options</h3> <p>This argument has the following options:</p> <dl> <dt><code>DATA_BAG_ITEM</code></dt> <dd> <p>The name of a specific item within a data bag.</p> </dd> <dt><code>--secret SECRET</code></dt> <dd> <p>The encryption key that is used for values contained within a data bag item. If <code>secret</code> is not specified, Chef Infra Client looks for a secret at the path specified by the <code>encrypted_data_bag_secret</code> setting in the client.rb file.</p> </dd> <dt><code>--secret-file FILE</code></dt> <dd> <p>The path to the file that contains the encryption key.</p> </dd> </dl> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> For encrypted data bag items, use <em>either</em> <code>--secret</code> or <code>--secret-file</code>, not both. </div> </div> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> See <a href="../config_rb_optional_settings/index.html">config.rb</a> for more information about how to add certain knife options as settings in the config.rb file. </div> </div> <h3 id="examples-2">Examples</h3> <p>The following examples show how to use this knife subcommand:</p> <p><strong>Edit a data bag</strong></p> <p>To edit the contents of a data bag, enter:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">knife data bag edit dogs tibetanspaniel
</code></pre></div>
<p>where <code>dogs</code> is the name of the data bag and <code>tibetanspaniel</code> is the name of the data bag item. This will return something similar to the following in the knife editor:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-javascript" data-lang="javascript">{
  <span style="color:#4070a0">"name"</span><span style="color:#666">:</span><span style="color:#4070a0">"data_bag_item_dogs_tibetanspaniel"</span>,
  <span style="color:#4070a0">"json_class"</span><span style="color:#666">:</span><span style="color:#4070a0">"Chef::DataBagItem"</span>,
  <span style="color:#4070a0">"chef_type"</span><span style="color:#666">:</span><span style="color:#4070a0">"data_bag_item"</span>,
  <span style="color:#4070a0">"data_bag"</span><span style="color:#666">:</span><span style="color:#4070a0">"dogs"</span>,
  <span style="color:#4070a0">"raw_data"</span><span style="color:#666">:</span>
    {
      <span style="color:#4070a0">"description"</span><span style="color:#666">:</span><span style="color:#4070a0">"small dog that likes to sit in windows"</span>,
      <span style="color:#4070a0">"id"</span><span style="color:#666">:</span><span style="color:#4070a0">"tibetanspaniel"</span>
    }
}
</code></pre></div>
<p>Make the necessary changes to the key-value pairs under <code>raw_data</code> and save them.</p> <p><strong>Edit a data bag item</strong></p> <p>To edit an item named “charlie” that is contained in a data bag named “admins”, enter:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">knife data bag edit admins charlie
</code></pre></div>
<p>to open the $EDITOR. Once opened, you can update the data before saving it to the Chef Infra Server. For example, by changing:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-javascript" data-lang="javascript">{
   <span style="color:#4070a0">"id"</span><span style="color:#666">:</span> <span style="color:#4070a0">"charlie"</span>
}
</code></pre></div>
<p>to:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-javascript" data-lang="javascript">{
   <span style="color:#4070a0">"id"</span><span style="color:#666">:</span> <span style="color:#4070a0">"charlie"</span>,
   <span style="color:#4070a0">"uid"</span><span style="color:#666">:</span> <span style="color:#40a070">1005</span>,
   <span style="color:#4070a0">"gid"</span><span style="color:#666">:</span> <span style="color:#4070a0">"ops"</span>,
   <span style="color:#4070a0">"shell"</span><span style="color:#666">:</span> <span style="color:#4070a0">"/bin/zsh"</span>,
   <span style="color:#4070a0">"comment"</span><span style="color:#666">:</span> <span style="color:#4070a0">"Crazy Charlie"</span>
}
</code></pre></div>
<h2 id="from-file">from file</h2> <p>Use the <code>from file</code> argument to:</p> <ul> <li>Add a data bag item to a data bag</li> <li>Update the contents of an existing data bag item</li> </ul> <p>The data bag itself must already exist on the Chef Infra Server and must be specified as part of the command. The contents of the data bag item are specified using a JSON file. This JSON file may be located at a relative or absolute path; its location must be specified as part of the command. The JSON file that defines the contents of the data bag item must at least contain the name of the data bag item—<code>"id": "name"</code>.</p> <h3 id="syntax-3">Syntax</h3> <p>This argument has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">knife data bag from file DATA_BAG_NAME_or_PATH JSON_FILE
</code></pre></div>
<h3 id="options-3">Options</h3> <p>This argument has the following options:</p> <dl> <dt>
<code>-a</code>, <code>--all</code>
</dt> <dd> <p>Upload all data bags found at the specified path.</p> </dd> <dt><code>--secret SECRET</code></dt> <dd> <p>The encryption key that is used for values contained within a data bag item. If <code>secret</code> is not specified, Chef Infra Client looks for a secret at the path specified by the <code>encrypted_data_bag_secret</code> setting in the client.rb file.</p> </dd> <dt><code>--secret-file FILE</code></dt> <dd> <p>The path to the file that contains the encryption key.</p> </dd> </dl> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> For encrypted data bag items, use <em>either</em> <code>--secret</code> or <code>--secret-file</code>, not both. </div> </div> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> See <a href="../config_rb_optional_settings/index.html">config.rb</a> for more information about how to add certain knife options as settings in the config.rb file. </div> </div> <h3 id="examples-3">Examples</h3> <p>The following examples show how to use this knife subcommand:</p> <p><strong>Create a data bag from a file</strong></p> <p>To create a data bag on the Chef Infra Server from a file:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">knife data bag from file <span style="color:#4070a0">"path to JSON file"</span>
</code></pre></div>
<p><strong>Create an encrypted data bag from a file</strong></p> <p>To create a data bag named “devops_data” that contains encrypted data, enter:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">knife data bag from file devops_data --secret-file <span style="color:#4070a0">"path to decryption file"</span>
</code></pre></div>
<p><strong>Create an encrypted data bag for use with Chef Infra Client local mode</strong></p> <p>To generate an encrypted data bag item in a JSON file for use when Chef Infra Client is run in local mode (via the <code>--local-mode</code> option), enter:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">knife data bag from file my_data_bag /path/to/data_bag_item.json -z --secret-file /path/to/encrypted_data_bag_secret
</code></pre></div>
<p>this will create an encrypted JSON file in:</p> <pre class="highlight" data-language="ruby"><code>data_bags/my_data_bag/data_bag_item.json
</code></pre> <h2 id="list">list</h2> <p>Use the <code>list</code> argument to view a list of data bags that are currently available on the Chef Infra Server.</p> <h3 id="syntax-4">Syntax</h3> <p>This argument has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">knife data bag list
</code></pre></div>
<h3 id="options-4">Options</h3> <p>This argument has the following options:</p> <dl> <dt>
<code>-w</code>, <code>--with-uri</code>
</dt> <dd> <p>Show the corresponding URIs.</p> </dd> </dl> <h3 id="examples-4">Examples</h3> <p>The following examples show how to use this knife subcommand:</p> <p><strong>View a list of data bags</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">knife data bag list
</code></pre></div>
<h2 id="show">show</h2> <p>Use the <code>show</code> argument to view the contents of a data bag.</p> <h3 id="syntax-5">Syntax</h3> <p>This argument has the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">knife data bag show DATA_BAG_NAME <span style="color:#666">(</span>options<span style="color:#666">)</span>
</code></pre></div>
<h3 id="options-5">Options</h3> <p>This argument has the following options:</p> <dl> <dt><code>DATA_BAG_ITEM</code></dt> <dd> <p>The name of a specific item within a data bag.</p> </dd> <dt><code>--secret SECRET</code></dt> <dd> <p>The encryption key that is used for values contained within a data bag item. If <code>secret</code> is not specified, Chef Infra Client looks for a secret at the path specified by the <code>encrypted_data_bag_secret</code> setting in the client.rb file.</p> </dd> <dt><code>--secret-file FILE</code></dt> <dd> <p>The path to the file that contains the encryption key.</p> </dd> </dl> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> For encrypted data bag items, use <em>either</em> <code>--secret</code> or <code>--secret-file</code>, not both. </div> </div> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> See <a href="../config_rb_optional_settings/index.html">config.rb</a> for more information about how to add certain knife options as settings in the config.rb file. </div> </div> <h3 id="examples-5">Examples</h3> <p>The following examples show how to use this knife subcommand:</p> <p><strong>Show a data bag</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">knife data bag show admins
</code></pre></div>
<p>to return something like:</p> <pre tabindex="0" class="highlight" data-language="ruby"><code class="language-none" data-lang="none">charlie
</code></pre>
<p><strong>Show a data bag item</strong></p> <p>To show the contents of a specific item within data bag, enter:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">knife data bag show admins charlie
</code></pre></div>
<p>to return:</p> <pre tabindex="0" class="highlight" data-language="ruby"><code class="language-none" data-lang="none">comment:  Crazy Charlie
gid:    ops
id:     charlie
shell:  /bin/zsh
uid:    1005
</code></pre>
<p><strong>Show a data bag, encrypted</strong></p> <p>To show the contents of a data bag named <code>passwords</code> with an item that contains encrypted data named <code>mysql</code>, enter:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">knife data bag show passwords mysql
</code></pre></div>
<p>to return:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-javascript" data-lang="javascript">{
  <span style="color:#4070a0">"id"</span><span style="color:#666">:</span> <span style="color:#4070a0">"mysql"</span>,
  <span style="color:#4070a0">"pass"</span><span style="color:#666">:</span> <span style="color:#4070a0">"trywgFA6R70NO28PNhMpGhEvKBZuxouemnbnAUQsUyo=\n"</span>,
  <span style="color:#4070a0">"user"</span><span style="color:#666">:</span> <span style="color:#4070a0">"e/p+8WJYVHY9fHcEgAAReg==\n"</span>
}
</code></pre></div>
<p><strong>Show a data bag, decrypted</strong></p> <p>To show the decrypted contents of the same data bag, enter:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">knife data bag show --secret-file /path/to/decryption/file passwords mysql
</code></pre></div>
<p>to return:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-javascript" data-lang="javascript">{
  <span style="color:#4070a0">"id"</span><span style="color:#666">:</span> <span style="color:#4070a0">"mysql"</span>,
  <span style="color:#4070a0">"pass"</span><span style="color:#666">:</span> <span style="color:#4070a0">"thesecret123"</span>,
  <span style="color:#4070a0">"user"</span><span style="color:#666">:</span> <span style="color:#4070a0">"fred"</span>
}
</code></pre></div>
<p><strong>Show a data bag as JSON</strong></p> <p>To view information in JSON format, use the <code>-F</code> common option as part of the command like this:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">knife data bag show admins -F json
</code></pre></div>
<p>Other formats available include <code>text</code>, <code>yaml</code>, and <code>pp</code>.</p> </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; Chef Software, Inc.<br>Licensed under the Creative Commons Attribution 3.0 Unported License.<br>The Chef&trade; Mark and Chef Logo are either registered trademarks/service marks or trademarks/servicemarks of Chef, in the United States and other countries and are used with Chef Inc's permission.<br>We are not affiliated with, endorsed or sponsored by Chef Inc.<br>
    <a href="https://docs.chef.io/workstation/knife_data_bag/" class="_attribution-link">https://docs.chef.io/workstation/knife_data_bag/</a>
  </p>
</div>
