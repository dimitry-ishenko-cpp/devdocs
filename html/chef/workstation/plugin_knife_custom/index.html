<div id="col-content" data-swiftype-index="true"> <div id="writing-custom-knife-plugins"><h1>Writing Custom Knife Plugins</h1></div>  <div class="prose"> <p data-swiftype-index="false"> <a href="https://github.com/chef/chef-workstation/blob/main/docs-chef-io/content/workstation/plugin_knife_custom.md" alt="Link to page on GitHub repository">[edit on GitHub]</a> </p> <p>A knife plugin is a set of one (or more) subcommands that can be added to knife to support additional functionality that is not built-in to the base set of knife subcommands. Many of the knife plugins are built by members of the Chef community and several of them are built and maintained by Chef.</p> <p>The Chef Infra Client will load knife plugins from the following locations:</p> <ul> <li>The home directory: <code>~/.chef/plugins/knife/</code>
</li> <li>A <code>.chef/plugins/knife</code> directory in the cookbook repository</li> <li>A plugin installed from RubyGems. (For more information about releasing a plugin on RubyGems, see: <a href="http://guides.rubygems.org/make-your-own-gem/">http://guides.rubygems.org/make-your-own-gem/</a>.)</li> </ul> <p>This approach allows knife plugins to be reused across projects in the home directory, kept in a repository that is accessible to other team members, and distributable to the community using RubyGems.</p> <h2 id="syntax">Syntax</h2> <p>There are many ways to structure a knife plugin. The following syntax shows a typical knife plugin:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#007020">require</span> <span style="color:#4070a0">'chef/knife'</span>
<span style="color:#60a0b0;font-style:italic"># other require attributes, as needed</span>

<span style="color:#007020;font-weight:700">module</span> <span style="color:#0e84b5;font-weight:700">ModuleName</span>
  <span style="color:#007020;font-weight:700">class</span> <span style="color:#0e84b5;font-weight:700">SubclassName</span> <span style="color:#666">&lt;</span> <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Knife</span>

    deps <span style="color:#007020;font-weight:700">do</span>
      <span style="color:#007020">require</span> <span style="color:#4070a0">'chef/dependency'</span>
      <span style="color:#60a0b0;font-style:italic"># other dependencies, as needed</span>
    <span style="color:#007020;font-weight:700">end</span>

    banner <span style="color:#4070a0">"knife subcommand argument VALUE (options)"</span>

    option <span style="color:#517918">:name_of_option</span>,
      <span style="color:#517918">:short</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">"-l VALUE"</span>,
      <span style="color:#517918">:long</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">"--long-option-name VALUE"</span>,
      <span style="color:#517918">:description</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">"The description for the option."</span>,
      <span style="color:#517918">:proc</span> <span style="color:#666">=&gt;</span> <span style="color:#60add5">Proc</span><span style="color:#666">.</span>new { code_to_run }
      <span style="color:#517918">:boolean</span> <span style="color:#666">=&gt;</span> <span style="color:#007020">true</span> <span style="color:#666">|</span> <span style="color:#007020">false</span>
      <span style="color:#517918">:default</span> <span style="color:#666">=&gt;</span> default_value

    <span style="color:#007020;font-weight:700">def</span> <span style="color:#06287e">run</span>
      <span style="color:#60a0b0;font-style:italic"># Ruby code goes here</span>
    <span style="color:#007020;font-weight:700">end</span>
  <span style="color:#007020;font-weight:700">end</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>where:</p> <ul> <li>
<code>require</code> identifies any other knife subcommands and/or knife plugins required by this plugin</li> <li>
<code>module ModuleName</code> declares the knife plugin as its own namespace</li> <li>
<code>class SubclassName &lt; Chef::Knife</code> declares the plugin as a subclass of <code>Knife</code>, which is in the <code>Chef</code> namespace. The capitalization of this name is important. For example, <code>SubclassName</code> would have a knife command of <code>knife subclass name</code>, whereas <code>Subclassname</code> would have a knife command of <code>knife subclassname</code>
</li> <li>
<code>deps do</code> is a list of dependencies</li> <li>
<code>banner "knife subcommand argument VALUE (options)"</code> is displayed when a user enters <code>knife subclassName --help</code>
</li> <li>
<code>option :name_of_option</code> defines each of the command-line options that are available for this plugin. For example, <code>knife subclass -l VALUE</code> or <code>knife subclass --long-option-name VALUE</code>
</li> <li>
<code>def run</code> is the Ruby code that is executed when the command is run</li> </ul> <p>and where for each command-line option:</p> <ul> <li>
<code>:short</code> defines the short option name</li> <li>
<code>:long</code> defines the long option name</li> <li>
<code>:description</code> defines a description that is displayed when a user enters <code>knife subclassName --help</code>
</li> <li>
<code>:boolean</code> defines whether the option is <code>true</code> or <code>false</code>; if the <code>:short</code> and <code>:long</code> names define a <code>VALUE</code>, then this attribute must not be used</li> <li>
<code>:proc</code> defines code that determines the value for this option</li> <li>
<code>:default</code> defines a default value</li> </ul> <p>The following example shows part of a knife plugin named <code>knife windows</code>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#007020">require</span> <span style="color:#4070a0">'chef/knife'</span>
<span style="color:#007020">require</span> <span style="color:#4070a0">'chef/knife/winrm_base'</span>

<span style="color:#007020;font-weight:700">class</span> <span style="color:#0e84b5;font-weight:700">Chef</span>
  <span style="color:#007020;font-weight:700">class</span> <span style="color:#0e84b5;font-weight:700">Knife</span>
    <span style="color:#007020;font-weight:700">class</span> <span style="color:#0e84b5;font-weight:700">Winrm</span> <span style="color:#666">&lt;</span> <span style="color:#60add5">Knife</span>

      <span style="color:#007020">include</span> <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Knife</span><span style="color:#666">::</span><span style="color:#60add5">WinrmBase</span>

      deps <span style="color:#007020;font-weight:700">do</span>
        <span style="color:#007020">require</span> <span style="color:#4070a0">'readline'</span>
        <span style="color:#007020">require</span> <span style="color:#4070a0">'chef/search/query'</span>
        <span style="color:#007020">require</span> <span style="color:#4070a0">'em-winrm'</span>
      <span style="color:#007020;font-weight:700">end</span>

      <span style="color:#007020">attr_writer</span> <span style="color:#517918">:password</span>

      banner <span style="color:#4070a0">"knife winrm QUERY COMMAND (options)"</span>

      option <span style="color:#517918">:attribute</span>,
        <span style="color:#517918">:short</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">"-a ATTR"</span>,
        <span style="color:#517918">:long</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">"--attribute ATTR"</span>,
        <span style="color:#517918">:description</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">"The attribute to use for opening the connection - default is fqdn"</span>,
        <span style="color:#517918">:default</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">"fqdn"</span>

      <span style="color:#666">...</span> <span style="color:#60a0b0;font-style:italic"># more options</span>

      <span style="color:#007020;font-weight:700">def</span> <span style="color:#06287e">session</span>
        session_opts <span style="color:#666">=</span> {}
        session_opts<span style="color:#666">[</span><span style="color:#517918">:logger</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Log</span><span style="color:#666">.</span>logger <span style="color:#007020;font-weight:700">if</span> <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Log</span><span style="color:#666">.</span>level <span style="color:#666">==</span> <span style="color:#517918">:debug</span>
        @session <span style="color:#666">||=</span> <span style="color:#007020;font-weight:700">begin</span>
          s <span style="color:#666">=</span> <span style="color:#60add5">EventMachine</span><span style="color:#666">::</span><span style="color:#60add5">WinRM</span><span style="color:#666">::</span><span style="color:#60add5">Session</span><span style="color:#666">.</span>new(session_opts)
          s<span style="color:#666">.</span>on_output <span style="color:#007020;font-weight:700">do</span> <span style="color:#666">|</span>host, data<span style="color:#666">|</span>
            print_data(host, data)
          <span style="color:#007020;font-weight:700">end</span>
          s<span style="color:#666">.</span>on_error <span style="color:#007020;font-weight:700">do</span> <span style="color:#666">|</span>host, err<span style="color:#666">|</span>
            print_data(host, err, <span style="color:#517918">:red</span>)
          <span style="color:#007020;font-weight:700">end</span>
          s<span style="color:#666">.</span>on_command_complete <span style="color:#007020;font-weight:700">do</span> <span style="color:#666">|</span>host<span style="color:#666">|</span>
            host <span style="color:#666">=</span> host <span style="color:#666">==</span> <span style="color:#517918">:all</span> ? <span style="color:#4070a0">'All Servers'</span> : host
            <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Log</span><span style="color:#666">.</span>debug(<span style="color:#4070a0">"command complete on </span><span style="color:#70a0d0;font-style:italic">#{</span>host<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">"</span>)
          <span style="color:#007020;font-weight:700">end</span>
          s
        <span style="color:#007020;font-weight:700">end</span>

      <span style="color:#007020;font-weight:700">end</span>

      <span style="color:#666">...</span> <span style="color:#60a0b0;font-style:italic"># more def blocks</span>

    <span style="color:#007020;font-weight:700">end</span>
  <span style="color:#007020;font-weight:700">end</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>Take a look at all of the code for this plugin on GitHub: <a href="https://github.com/chef/knife-windows/blob/main/lib/chef/knife/winrm.rb">https://github.com/chef/knife-windows/blob/main/lib/chef/knife/winrm.rb</a>.</p> <h3 id="namespace">Namespace</h3> <p>A knife plugin should have its own namespace (even though knife will load a command regardless of its namespace). The namespace is declared using the <code>module</code> method, for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#007020">require</span> <span style="color:#4070a0">'chef/knife'</span>
<span style="color:#60a0b0;font-style:italic">## other require attributes, as needed</span>

<span style="color:#007020;font-weight:700">module</span> <span style="color:#0e84b5;font-weight:700">MyNamespace</span>
  <span style="color:#007020;font-weight:700">class</span> <span style="color:#0e84b5;font-weight:700">SubclassName</span> <span style="color:#666">&lt;</span> <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Knife</span>
</code></pre></div>
<p>where <code>module MyNamespace</code> declares that the knife plugin has its own namespace, with a namespace of <code>MyNamespace</code>.</p> <h3 id="class-name">Class Name</h3> <p>The class name declares a plugin as a subclass of both <code>Knife</code> and <code>Chef</code>. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#007020;font-weight:700">class</span> <span style="color:#0e84b5;font-weight:700">SubclassName</span> <span style="color:#666">&lt;</span> <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Knife</span>
</code></pre></div>
<p>where <code>SubclassName</code> is the class name used by this plugin. The capitalization of this name is important. For example, <code>OMG</code> would have a knife command of <code>knife o m g</code>, whereas <code>Omg</code> would have a knife command of <code>knife omg</code>. Use the capitalization pattern to define the word grouping that best makes sense for the plugin.</p> <p>A plugin can override an existing knife subcommand by using the same class name as the existing subcommand. For example, to override the current functionality of <code>knife cookbook upload</code>, use the following class name:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#007020;font-weight:700">class</span> <span style="color:#0e84b5;font-weight:700">CookbookUpload</span> <span style="color:#666">&lt;</span> <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Knife</span>
</code></pre></div>
<h3 id="banner">Banner</h3> <p>A banner displays the syntax for the plugin to users when they enter the <code>--help</code> option. Use the <code>banner</code> method in the class body similar to the following:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#007020;font-weight:700">module</span> <span style="color:#0e84b5;font-weight:700">example</span>
  <span style="color:#007020;font-weight:700">class</span> example <span style="color:#666">&lt;</span> <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Knife</span>

  banner <span style="color:#4070a0">"knife example"</span>

  <span style="color:#666">...</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>and the when a user enters <code>knife --help</code>, the following will be displayed:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">**EXAMPLE COMMANDS**
knife example
</code></pre></div>
<h3 id="dependencies">Dependencies</h3> <p>The functionality of other knife plugins can be accessed from a plugin by using the <code>deps</code> method to ensure the necessary files are available. The <code>deps</code> method acts as a lazy loader, ensuring that dependencies are only loaded into knife when the plugin which requires them is run. Use the following syntax just below the class declaration:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#007020;font-weight:700">class</span> subclassName <span style="color:#666">&lt;</span> <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Knife</span>

deps <span style="color:#007020;font-weight:700">do</span>
  <span style="color:#007020">require</span> <span style="color:#4070a0">'chef/knife/name_of_command'</span>
  <span style="color:#007020">require</span> <span style="color:#4070a0">'chef/search/query'</span>
  <span style="color:#60a0b0;font-style:italic"># other dependencies, as needed</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>where the actual path may vary from plugin to plugin, but is typically located in the <code>chef/knife/</code> directory.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> Using the <code>deps</code> method instead of <code>require</code> is recommended, especially if the environment in which knife is being run contains a lot of plugins and/or any of those plugins have a lot of dependencies and/or requirements on other plugins and search functionality. </div> </div> <h4 id="requirements">Requirements</h4> <p>The functionality of other knife plugins can be accessed from a plugin by using the <code>require</code> method to ensure the necessary files are available, and then within the code for the plugin, to create a new object of the class of the plugin to be used.</p> <p>First, ensure that the correct files are available using the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#007020">require</span> <span style="color:#4070a0">'chef/knife/name_of_command'</span>
</code></pre></div>
<p>where the actual path may vary from plugin to plugin, but is typically located in the <code>chef/knife/</code> directory.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> Using the <code>deps</code> method instead of <code>require</code> is recommended, especially when the environment in which knife is being run contains a lot of plugins and/or any of those plugins have a lot of dependencies and/or requirements on other plugins and search functionality. </div> </div> <p>For example, use the following to require a plugin named <code>bootstrap</code>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#007020">require</span> <span style="color:#4070a0">'chef/knife/bootstrap'</span>
</code></pre></div>
<p>Next, for the required plugin, create an object of that plugin, like this:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">bootstrap <span style="color:#666">=</span> <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Knife</span><span style="color:#666">::</span><span style="color:#60add5">Bootstrap</span><span style="color:#666">.</span>new
</code></pre></div>
<p>and then pass arguments or options to that object. This is done by altering that object’s <code>config</code> and <code>name_arg</code> variables. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">bootstrap<span style="color:#666">.</span>config<span style="color:#666">[</span><span style="color:#517918">:ssh_user</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#4070a0">"myuser"</span>
bootstrap<span style="color:#666">.</span>config<span style="color:#666">[</span><span style="color:#517918">:distro</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#4070a0">"ubuntu10.04-gems"</span>
bootstrap<span style="color:#666">.</span>config<span style="color:#666">[</span><span style="color:#517918">:use_sudo</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#007020">true</span>

bootstrap<span style="color:#666">.</span>name_args <span style="color:#666">=</span> <span style="color:#4070a0">"some_host_name"</span>
</code></pre></div>
<p>where the available configuration objects vary from plugin to plugin. Make sure those configuration objects are correct by verifying them in the source files for each plugin.</p> <p>And then call the object’s <code>run</code> method, like this:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">bootstrap<span style="color:#666">.</span>run
</code></pre></div>
<h3 id="options">Options</h3> <p>Command-line options can be added to a knife plugin using the <code>option</code> method. An option can have a true/false value:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">option <span style="color:#517918">:true_or_false</span>,
  <span style="color:#517918">:short</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">"-t"</span>,
  <span style="color:#517918">:long</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">"--true-or-false"</span>,
  <span style="color:#517918">:description</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">"Is this value true? Or is this value false?"</span>,
  <span style="color:#517918">:boolean</span> <span style="color:#666">=&gt;</span> <span style="color:#007020">true</span> <span style="color:#666">|</span> <span style="color:#007020">false</span>
  <span style="color:#517918">:default</span> <span style="color:#666">=&gt;</span> <span style="color:#007020">true</span>
</code></pre></div>
<p>and it can have a string value:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">option <span style="color:#517918">:some_type_of_string_value</span>,
  <span style="color:#517918">:short</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">"-s VALUE"</span>,
  <span style="color:#517918">:long</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">"--some-type-of-string-value VALUE"</span>,
  <span style="color:#517918">:description</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">"This is not a random string value."</span>,
  <span style="color:#517918">:default</span> <span style="color:#666">=&gt;</span> <span style="color:#40a070">47</span>
</code></pre></div>
<p>and can specify code that is run to determine the option’s value:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">option <span style="color:#517918">:tags</span>,
  <span style="color:#517918">:short</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">"-T T=V[,T=V,...]"</span>,
  <span style="color:#517918">:long</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">"--tags Tag=Value[,Tag=Value...]"</span>,
  <span style="color:#517918">:description</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">"A list of tags associated with the virtual machine"</span>,
  <span style="color:#517918">:proc</span> <span style="color:#666">=&gt;</span> <span style="color:#60add5">Proc</span><span style="color:#666">.</span>new { <span style="color:#666">|</span>tags<span style="color:#666">|</span> tags<span style="color:#666">.</span>split(<span style="color:#4070a0">','</span>) }
</code></pre></div>
<p>where the knife command allows a comma-separated list of values and the <code>:proc</code> attribute converts that list of values into an array.</p> <p>When a user enters <code>knife --help</code>, the description attributes are displayed as part of the help. Using the previous examples, something like the following will be displayed:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">**EXAMPLE COMMANDS**
knife example
  -s, --some-type-of-string-value     This is not a random string value.
  -t, --true-or-false                 Is this value true? Or is this value false?
  -T, --tags                          A list of tags associated with the virtual machine.
</code></pre></div>
<p>When knife runs the command, the options are parsed from the command-line and make the settings available as a hash that can be used to access the <code>config</code> method. For example, the following option:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">option <span style="color:#517918">:omg</span>,
  <span style="color:#517918">:short</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'-O'</span>,
  <span style="color:#517918">:long</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'--omg'</span>,
  <span style="color:#517918">:boolean</span> <span style="color:#666">=&gt;</span> <span style="color:#007020">true</span>,
  <span style="color:#517918">:description</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">"I'm so excited!"</span>
</code></pre></div>
<p>can be used to update the <code>run</code> method of a class to change its behavior based on the <code>config</code> flag, similar to the following:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#007020;font-weight:700">def</span> <span style="color:#06287e">run</span>
  <span style="color:#007020;font-weight:700">if</span> config<span style="color:#666">[</span><span style="color:#517918">:omg</span><span style="color:#666">]</span>
    <span style="color:#60a0b0;font-style:italic"># Oh yeah, we are pumped.</span>
    <span style="color:#007020">puts</span> <span style="color:#4070a0">"OMG HELLO WORLD!!!1!!11"</span>
  <span style="color:#007020;font-weight:700">else</span>
    <span style="color:#60a0b0;font-style:italic"># meh</span>
    <span style="color:#007020">puts</span> <span style="color:#4070a0">"I am just a boring example."</span>
  <span style="color:#007020;font-weight:700">end</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>For a knife plugin with the <code>--omg</code> option, run <code>knife example --omg</code> to return something like:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">OMG HELLO WORLD!!!1!!11
</code></pre></div>
<p>or just <code>knife example</code> to return:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">I am just a boring example.
</code></pre></div>
<h3 id="arguments">Arguments</h3> <p>A knife plugin can also take command-line arguments that are not specified using the <code>option</code> flag, for example: <code>knife node show NODE</code>. These arguments are added using the <code>name_args</code> method. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">banner <span style="color:#4070a0">"knife hello world WHO"</span>

<span style="color:#007020;font-weight:700">def</span> <span style="color:#06287e">run</span>
  <span style="color:#007020;font-weight:700">unless</span> name_args<span style="color:#666">.</span>size <span style="color:#666">==</span> <span style="color:#40a070">1</span>
    <span style="color:#007020">puts</span> <span style="color:#4070a0">"You need to say hello to someone!"</span>
    show_usage
    <span style="color:#007020">exit</span> <span style="color:#40a070">1</span>
  <span style="color:#007020;font-weight:700">end</span>

  who <span style="color:#666">=</span> name_args<span style="color:#666">.</span>first

  <span style="color:#007020;font-weight:700">if</span> config<span style="color:#666">[</span><span style="color:#517918">:omg</span><span style="color:#666">]</span>
    <span style="color:#007020">puts</span> <span style="color:#4070a0">"OMG HELLO </span><span style="color:#70a0d0;font-style:italic">#{</span>who<span style="color:#666">.</span>upcase<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">!!!1!!11"</span>
  <span style="color:#007020;font-weight:700">else</span>
    <span style="color:#007020">puts</span> <span style="color:#4070a0">"Hello, </span><span style="color:#70a0d0;font-style:italic">#{</span>who<span style="color:#666">.</span>capitalize<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">!"</span>
  <span style="color:#007020;font-weight:700">end</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>where</p> <ul> <li>
<code>unless name_args.size == 1</code> is used to check the number of arguments given; the command should fail if the input does not make sense</li> <li>
<code>who = name_args.first</code> is used to access arguments using <code>name_args</code>
</li> <li>
<code>show_usage</code> is used to display the correct usage before exiting (if the command fails)</li> </ul> <p>For example, the following command:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">knife hello world
</code></pre></div>
<p>will return:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">You need to say hello to someone!
USAGE: knife hello world WHO
</code></pre></div>
<p>the following command:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">knife hello world chefs
</code></pre></div>
<p>will return:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">Hello, Chefs!
</code></pre></div>
<p>and the following command:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">knife hello world chefs --omg
</code></pre></div>
<p>will return:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">OMG HELLO CHEFS!!!1!!11
</code></pre></div>
<h3 id="configrb-settings">config.rb Settings</h3> <p>Certain settings defined by a knife plugin can be configured so that they can be set using the config.rb file. This can be done in two ways:</p> <ul> <li>By using the <code>:proc</code> attribute of the <code>option</code> method and code that references <code>Chef::Config[:knife][:setting_name]</code>
</li> <li>By specifying the configuration setting directly within the <code>def</code> Ruby blocks using either <code>Chef::Config[:knife][:setting_name]</code> or <code>config[:setting_name]</code>
</li> </ul> <p>An option that is defined in this manner may be configured using the config.rb file with the following syntax:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">knife<span style="color:#666">[</span><span style="color:#517918">:setting_name</span><span style="color:#666">]</span>
</code></pre></div>
<p>This approach can be useful when a particular setting is used a lot. The order of precedence for a knife option is:</p> <ol> <li>A value passed via the command line</li> <li>A value saved in the config.rb file</li> <li>A default value</li> </ol> <p>The following example shows how the <code>knife bootstrap</code> subcommand checks for a value in the config.rb file by using the <code>:proc</code> attribute:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">option <span style="color:#517918">:ssh_port</span>,
  <span style="color:#517918">:short</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">"-p PORT"</span>,
  <span style="color:#517918">:long</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">"--ssh-port PORT"</span>,
  <span style="color:#517918">:description</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">"The ssh port"</span>,
  <span style="color:#517918">:proc</span> <span style="color:#666">=&gt;</span> <span style="color:#60add5">Proc</span><span style="color:#666">.</span>new { <span style="color:#666">|</span>key<span style="color:#666">|</span> <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">[</span><span style="color:#517918">:knife</span><span style="color:#666">][</span><span style="color:#517918">:ssh_port</span><span style="color:#666">]</span> <span style="color:#666">=</span> key }
</code></pre></div>
<p>where <code>Chef::Config[:knife][:ssh_port]</code> tells knife to check the config.rb file for a setting named <code>knife[:ssh_port]</code>.</p> <p>And the following example shows the <code>knife bootstrap</code> subcommand calling the <code>knife ssh</code> subcommand for the actual SSH part of running a bootstrap operation:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#007020;font-weight:700">def</span> <span style="color:#06287e">knife_ssh</span>
  ssh <span style="color:#666">=</span> <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Knife</span><span style="color:#666">::</span><span style="color:#60add5">Ssh</span><span style="color:#666">.</span>new
  ssh<span style="color:#666">.</span>ui <span style="color:#666">=</span> ui
  ssh<span style="color:#666">.</span>name_args <span style="color:#666">=</span> <span style="color:#666">[</span> server_name, ssh_command <span style="color:#666">]</span>
  ssh<span style="color:#666">.</span>config<span style="color:#666">[</span><span style="color:#517918">:ssh_user</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">[</span><span style="color:#517918">:knife</span><span style="color:#666">][</span><span style="color:#517918">:ssh_user</span><span style="color:#666">]</span> <span style="color:#666">||</span> config<span style="color:#666">[</span><span style="color:#517918">:ssh_user</span><span style="color:#666">]</span>
  ssh<span style="color:#666">.</span>config<span style="color:#666">[</span><span style="color:#517918">:ssh_password</span><span style="color:#666">]</span> <span style="color:#666">=</span> config<span style="color:#666">[</span><span style="color:#517918">:ssh_password</span><span style="color:#666">]</span>
  ssh<span style="color:#666">.</span>config<span style="color:#666">[</span><span style="color:#517918">:ssh_port</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">[</span><span style="color:#517918">:knife</span><span style="color:#666">][</span><span style="color:#517918">:ssh_port</span><span style="color:#666">]</span> <span style="color:#666">||</span> config<span style="color:#666">[</span><span style="color:#517918">:ssh_port</span><span style="color:#666">]</span>
  ssh<span style="color:#666">.</span>config<span style="color:#666">[</span><span style="color:#517918">:ssh_gateway</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">[</span><span style="color:#517918">:knife</span><span style="color:#666">][</span><span style="color:#517918">:ssh_gateway</span><span style="color:#666">]</span> <span style="color:#666">||</span> config<span style="color:#666">[</span><span style="color:#517918">:ssh_gateway</span><span style="color:#666">]</span>
  ssh<span style="color:#666">.</span>config<span style="color:#666">[</span><span style="color:#517918">:identity_file</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">[</span><span style="color:#517918">:knife</span><span style="color:#666">][</span><span style="color:#517918">:identity_file</span><span style="color:#666">]</span> <span style="color:#666">||</span> config<span style="color:#666">[</span><span style="color:#517918">:identity_file</span><span style="color:#666">]</span>
  ssh<span style="color:#666">.</span>config<span style="color:#666">[</span><span style="color:#517918">:manual</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#007020">true</span>
  ssh<span style="color:#666">.</span>config<span style="color:#666">[</span><span style="color:#517918">:host_key_verify</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Config</span><span style="color:#666">[</span><span style="color:#517918">:knife</span><span style="color:#666">][</span><span style="color:#517918">:host_key_verify</span><span style="color:#666">]</span> <span style="color:#666">||</span> config<span style="color:#666">[</span><span style="color:#517918">:host_key_verify</span><span style="color:#666">]</span>
  ssh<span style="color:#666">.</span>config<span style="color:#666">[</span><span style="color:#517918">:on_error</span><span style="color:#666">]</span> <span style="color:#666">=</span> <span style="color:#517918">:raise</span>
  ssh
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>where</p> <ul> <li>
<code>ssh = Chef::Knife::Ssh.new</code> creates a new instance of the <code>Ssh</code> subclass named <code>ssh</code>
</li> <li>A series of settings in <code>knife ssh</code> are associated with <code>knife bootstrap</code> using the <code>ssh.config[:setting_name]</code> syntax</li> <li>
<code>Chef::Config[:knife][:setting_name]</code> tells knife to check the config.rb file for various settings</li> <li>Raises an exception if any aspect of the SSH operation fails</li> </ul> <h3 id="search">Search</h3> <p>Use the Chef Infra Server search capabilities from a plugin to return information about the infrastructure to that plugin. Use the <code>require</code> method to ensure that search functionality is available with the following:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#007020">require</span> <span style="color:#4070a0">'chef/search/query'</span>
</code></pre></div>
<p>Create a search query object and assign it to a variable:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">variable_name <span style="color:#666">=</span> <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Search</span><span style="color:#666">::</span><span style="color:#60add5">Query</span><span style="color:#666">.</span>new
</code></pre></div>
<p>After the search object is created it can be used by the plugin to execute search queries for objects on the Chef Infra Server. For example, using a variable named <code>query_nodes</code> a plugin could search for nodes with the <code>webserver</code> role and then return the name of each node found:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">query <span style="color:#666">=</span> <span style="color:#4070a0">"role:webserver"</span>

query_nodes<span style="color:#666">.</span>search(<span style="color:#4070a0">'node'</span>, query) <span style="color:#007020;font-weight:700">do</span> <span style="color:#666">|</span>node_item<span style="color:#666">|</span>
  <span style="color:#007020">puts</span> <span style="color:#4070a0">"Node Name: </span><span style="color:#70a0d0;font-style:italic">#{</span>node_item<span style="color:#666">.</span>name<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">"</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>This result can then be used to edit nodes. For example, searching for nodes with the <code>webserver</code> role, and then changing the run_list for those nodes to a role named <code>apache2</code>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">query <span style="color:#666">=</span> <span style="color:#4070a0">"role:webserver"</span>

query_nodes<span style="color:#666">.</span>search(<span style="color:#4070a0">'node'</span>, query) <span style="color:#007020;font-weight:700">do</span> <span style="color:#666">|</span>node_item<span style="color:#666">|</span>
  ui<span style="color:#666">.</span>msg <span style="color:#4070a0">"Changing the run_list to role[apache2] for </span><span style="color:#70a0d0;font-style:italic">#{</span>node_item<span style="color:#666">.</span>name<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">"</span>
  node_item<span style="color:#666">.</span>run_list(<span style="color:#4070a0">"role[apache2]"</span>)
  node_item<span style="color:#666">.</span>save
  ui<span style="color:#666">.</span>msg <span style="color:#4070a0">"New run_list: </span><span style="color:#70a0d0;font-style:italic">#{</span>node_item<span style="color:#666">.</span>run_list<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">"</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>It’s also possible to specify multiple items to add to the run_list:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">node_item<span style="color:#666">.</span>run_list(<span style="color:#4070a0">"role[apache2]"</span>, <span style="color:#4070a0">"recipe[mysql]"</span>)
</code></pre></div>
<p>And arguments sent with a plugin command can also be used to search. For example, if the command <code>knife envchange "web*"</code> is sent, then the command will search for any nodes in roles beginning with “web” and then change their environment to “web”:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#007020;font-weight:700">module</span> <span style="color:#0e84b5;font-weight:700">MyKnifePlugins</span>

  <span style="color:#007020;font-weight:700">class</span> <span style="color:#0e84b5;font-weight:700">Envchange</span> <span style="color:#666">&lt;</span> <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Knife</span>

    banner <span style="color:#4070a0">"knife envchange ROLE"</span>

    deps <span style="color:#007020;font-weight:700">do</span>
      <span style="color:#007020">require</span> <span style="color:#4070a0">'chef/search/query'</span>
    <span style="color:#007020;font-weight:700">end</span>

    <span style="color:#007020;font-weight:700">def</span> <span style="color:#06287e">run</span>
      <span style="color:#007020;font-weight:700">if</span> name_args<span style="color:#666">.</span>size <span style="color:#666">==</span> <span style="color:#40a070">1</span>
        role <span style="color:#666">=</span> name_args<span style="color:#666">.</span>first
      <span style="color:#007020;font-weight:700">else</span>
        ui<span style="color:#666">.</span>fatal <span style="color:#4070a0">"Please provide a role name to search for"</span>
        <span style="color:#007020">exit</span> <span style="color:#40a070">1</span>
      <span style="color:#007020;font-weight:700">end</span>

      query <span style="color:#666">=</span> <span style="color:#4070a0">"role:</span><span style="color:#70a0d0;font-style:italic">#{</span>role<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">"</span>
      query_nodes <span style="color:#666">=</span> <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Search</span><span style="color:#666">::</span><span style="color:#60add5">Query</span><span style="color:#666">.</span>new

      query_nodes<span style="color:#666">.</span>search(<span style="color:#4070a0">'node'</span>, query) <span style="color:#007020;font-weight:700">do</span> <span style="color:#666">|</span>node_item<span style="color:#666">|</span>
        ui<span style="color:#666">.</span>msg <span style="color:#4070a0">"Moving </span><span style="color:#70a0d0;font-style:italic">#{</span>node_item<span style="color:#666">.</span>name<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0"> to the web environment"</span>
        node_item<span style="color:#666">.</span>chef_environment(<span style="color:#4070a0">"web"</span>)
        node_item<span style="color:#666">.</span>save
      <span style="color:#007020;font-weight:700">end</span>

    <span style="color:#007020;font-weight:700">end</span>
  <span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<h3 id="user-interaction">User Interaction</h3> <p>The <code>ui</code> object provides a set of methods that can be used to define user interactions and to help ensure a consistent user experience across knife plugins. The following methods should be used in favor of manually handling user interactions:</p> <table> <col style="width:12%"> <col style="width:87%"> <thead> <tr class="header"> <th>Method</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>ui.ask(*args, &amp;block)</code></td> <td></td> </tr> <tr> <td><code>ui.ask_question(question, opts={})</code></td> <td>Use to ask a user the question contained in <code>question</code>. If <code>:default =&gt; default_value</code> is passed as the second argument, <code>default_value</code> will be used if the user does not provide an answer. This method will respect the <code>--default</code> command-line option.</td> </tr> <tr> <td><p><code>ui.color(string, *colors)</code></p></td> <td>
<p>Use to specify a color. For example, from the <code>knife rackspace server list</code> subcommand:</p> <div class="sourceCode" id="cb1"><pre class="sourceCode ruby highlight" data-language="ruby"><code class="sourceCode ruby"><span id="cb1-1">server_list = [</span>
<span id="cb1-2">  ui.color(<span class="st">'Instance ID'</span>, <span class="st">:bold</span>),</span>
<span id="cb1-3">  ui.color(<span class="st">'Name'</span>, <span class="st">:bold</span>),</span>
<span id="cb1-4">  ui.color(<span class="st">'Public IP'</span>, <span class="st">:bold</span>),</span>
<span id="cb1-5">  ui.color(<span class="st">'Private IP'</span>, <span class="st">:bold</span>),</span>
<span id="cb1-6">  ui.color(<span class="st">'Flavor'</span>, <span class="st">:bold</span>),</span>
<span id="cb1-7">  ui.color(<span class="st">'Image'</span>, <span class="st">:bold</span>),</span>
<span id="cb1-8">  ui.color(<span class="st">'State'</span>, <span class="st">:bold</span>)</span>
<span id="cb1-9">]</span></code></pre></div> <p>and from the <code>knife eucalyptus server create</code> subcommand:</p> <div class="sourceCode" id="cb2"><pre class="sourceCode ruby highlight" data-language="ruby"><code class="sourceCode ruby"><span id="cb2-1">server = connection.servers.create(server_def)</span>
<span id="cb2-2">  puts <span class="st">"</span><span class="ot">#{</span>ui.color(<span class="st">"Instance ID"</span>, <span class="st">:cyan</span>)<span class="ot">}</span><span class="st">: </span><span class="ot">#{</span>server.id<span class="ot">}</span><span class="st">"</span></span>
<span id="cb2-3">  puts <span class="st">"</span><span class="ot">#{</span>ui.color(<span class="st">"Flavor"</span>, <span class="st">:cyan</span>)<span class="ot">}</span><span class="st">: </span><span class="ot">#{</span>server.flavor_id<span class="ot">}</span><span class="st">"</span></span>
<span id="cb2-4">  puts <span class="st">"</span><span class="ot">#{</span>ui.color(<span class="st">"Image"</span>, <span class="st">:cyan</span>)<span class="ot">}</span><span class="st">: </span><span class="ot">#{</span>server.image_id<span class="ot">}</span><span class="st">"</span></span>
<span id="cb2-5">  ...</span>
<span id="cb2-6">  puts <span class="st">"</span><span class="ot">#{</span>ui.color(<span class="st">"SSH Key"</span>, <span class="st">:cyan</span>)<span class="ot">}</span><span class="st">: </span><span class="ot">#{</span>server.key_name<span class="ot">}</span><span class="st">"</span></span>
<span id="cb2-7">print <span class="st">"\n</span><span class="ot">#{</span>ui.color(<span class="st">"Waiting for server"</span>, <span class="st">:magenta</span>)<span class="ot">}</span><span class="st">"</span></span></code></pre></div>
</td> </tr> <tr> <td><code>ui.color?()</code></td> <td>Indicates that colored output should be used. (Colored output can only be used when output is sent to a terminal.)</td> </tr> <tr> <td><code>ui.confirm(question, append_instructions=true)</code></td> <td>Use to ask a Y/N question. If the user responds with <code>N</code>, immediately exit with status code 3.</td> </tr> <tr> <td><code>ui.edit_data(data, parse_output=true)</code></td> <td>Use to edit data. This opens the $EDITOR.</td> </tr> <tr> <td><code>ui.edit_object(klass, name)</code></td> <td></td> </tr> <tr> <td><code>ui.error</code></td> <td>Use to present an error to the user.</td> </tr> <tr> <td><code>ui.fatal</code></td> <td>Use to present a fatal error to the user.</td> </tr> <tr> <td><code>ui.highline</code></td> <td>Use to provide direct access to the <a href="http://highline.rubyforge.org/doc/">Highline object</a> used by many <code>ui</code> methods.</td> </tr> <tr> <td><code>ui.info</code></td> <td>Use to present a message to a user.</td> </tr> <tr> <td><code>ui.interchange</code></td> <td>Use to determine if the output is a data interchange format such as JSON or YAML.</td> </tr> <tr> <td><code>ui.list(*args)</code></td> <td></td> </tr> <tr> <td><code>ui.msg(message)</code></td> <td>Use to present a message to the user.</td> </tr> <tr> <td><code>ui.output(data)</code></td> <td>Use to present a data structure to the user. This method will respect the output requested when the <code>-F</code> command-line option is used. The output will use the generic default presenter.</td> </tr> <tr> <td><code>ui.pretty_print(data)</code></td> <td>Use to enable pretty-print output for JSON data.</td> </tr> <tr> <td><code>ui.use_presenter(presenter_class)</code></td> <td>Use to specify a custom output presenter.</td> </tr> <tr> <td><code>ui.warn(message)</code></td> <td>Use to present a warning to the user.</td> </tr> </tbody> </table> <p>For example, to show a fatal error in a plugin in the same way that it would be shown in knife do something similar to the following:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#007020;font-weight:700">unless</span> name_args<span style="color:#666">.</span>size <span style="color:#666">==</span> <span style="color:#40a070">1</span>
  ui<span style="color:#666">.</span>fatal <span style="color:#4070a0">"Be sure to say hello to someone!"</span>
  show_usage
  <span style="color:#007020">exit</span> <span style="color:#40a070">1</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<h2 id="create-a-plugin">Create a Plugin</h2> <p>A knife command is a Ruby class that inherits from the <code>Chef::Knife</code> class. A knife command is run by calling the <code>run</code> method on an instance of the command class. For example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby"><span style="color:#007020;font-weight:700">module</span> <span style="color:#0e84b5;font-weight:700">MyKnifePlugins</span>
  <span style="color:#007020;font-weight:700">class</span> <span style="color:#0e84b5;font-weight:700">HelloWorld</span> <span style="color:#666">&lt;</span> <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Knife</span>

    <span style="color:#007020;font-weight:700">def</span> <span style="color:#06287e">run</span>
      <span style="color:#007020">puts</span> <span style="color:#4070a0">"Hello, World!"</span>
    <span style="color:#007020;font-weight:700">end</span>
  <span style="color:#007020;font-weight:700">end</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>and is run from the command line using:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-bash" data-lang="bash">knife hello world
</code></pre></div>
<h2 id="exceptions">Exceptions</h2> <p>In most cases, the exception handling available within knife is enough to ensure that exception handling for a plugin is consistent with how knife ordinarily behaves. That said, exceptions can also be handled within a knife plugin in the same way they are handled in any Ruby program.</p> <h2 id="install-a-plugin">Install a Plugin</h2> <p>To install a knife plugin from a file, do one of the following:</p> <ul> <li>Copy the file to the <code>~/.chef/plugins/knife</code> directory; the file’s extension must be <code>.rb</code>
</li> <li>Add the file to the chef-repo at the <code>CHEF_REPO/.chef/plugins/knife</code>; the file’s extension must be <code>.rb</code>
</li> <li>Install the plugin from RubyGems</li> </ul> </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; Chef Software, Inc.<br>Licensed under the Creative Commons Attribution 3.0 Unported License.<br>The Chef&trade; Mark and Chef Logo are either registered trademarks/service marks or trademarks/servicemarks of Chef, in the United States and other countries and are used with Chef Inc's permission.<br>We are not affiliated with, endorsed or sponsored by Chef Inc.<br>
    <a href="https://docs.chef.io/workstation/plugin_knife_custom/" class="_attribution-link">https://docs.chef.io/workstation/plugin_knife_custom/</a>
  </p>
</div>
