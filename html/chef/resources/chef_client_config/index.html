<div id="col-content" data-swiftype-index="true"> <h1 id="chef_client_config-resource">chef_client_config Resource</h1>  <div class="prose"> <p data-swiftype-index="false"> <button onclick="resource_note_function('resource_note')" class="note-btn note-block note-left-align">Edit this page in the Chef repository</button> </p>
<div id="resource_note" class="note-container note-hide"> <p> This page is generated from the <a href="https://github.com/chef/chef">Chef Infra Client source code</a>. To suggest a change, edit the <a href="https://github.com/chef/chef/blob/main/lib/chef/resource/chef_client_config.rb">chef_client_config.rb</a> file and submit a pull request to the <a href="https://github.com/chef/chef">Chef Infra Client repository</a>. </p> </div> <p data-swiftype-index="false"><a href="../index.html">All Infra resources page</a></p> <hr> <p>Use the <strong>chef_client_config</strong> resource to create a client.rb file in the Chef Infra Client configuration directory. See the <a href="../../config_rb_client/index.html">client.rb docs</a> for more details on options available in the client.rb configuration file.</p> <p><strong>New in Chef Infra Client 16.6.</strong></p> <h2 id="syntax">Syntax</h2> <hr>  <p>The full syntax for all of the properties that are available to the <strong>chef_client_config</strong> resource is:</p> 
<div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_client_config <span style="color:#4070a0">'name'</span> <span style="color:#007020;font-weight:700">do</span>
  additional_config              <span style="color:#007020">String</span>
  chef_license                   <span style="color:#007020">String</span>
  chef_server_url                <span style="color:#007020">String</span>
  config_directory               <span style="color:#007020">String</span>
  data_collector_server_url      <span style="color:#007020">String</span>
  data_collector_token           <span style="color:#007020">String</span>
  event_loggers                  <span style="color:#007020">Array</span> <span style="color:#60a0b0;font-style:italic"># default value: []</span>
  exception_handlers             <span style="color:#007020">Array</span> <span style="color:#60a0b0;font-style:italic"># default value: []</span>
  file_backup_path               <span style="color:#007020">String</span>
  file_cache_path                <span style="color:#007020">String</span>
  file_staging_uses_destdir      <span style="color:#007020">String</span>
  formatters                     <span style="color:#007020">Array</span> <span style="color:#60a0b0;font-style:italic"># default value: []</span>
  ftp_proxy                      <span style="color:#007020">String</span>
  group                          <span style="color:#007020">String</span>
  http_proxy                     <span style="color:#007020">String</span>
  https_proxy                    <span style="color:#007020">String</span>
  log_level                      <span style="color:#60add5">Symbol</span>
  log_location                   <span style="color:#007020">String</span>, <span style="color:#60add5">Symbol</span>
  minimal_ohai                   <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  named_run_list                 <span style="color:#007020">String</span>
  no_proxy                       <span style="color:#007020">String</span>, <span style="color:#007020">Array</span> <span style="color:#60a0b0;font-style:italic"># default value: []</span>
  node_name                      <span style="color:#007020">String</span>
  ohai_disabled_plugins          <span style="color:#007020">Array</span> <span style="color:#60a0b0;font-style:italic"># default value: []</span>
  ohai_optional_plugins          <span style="color:#007020">Array</span> <span style="color:#60a0b0;font-style:italic"># default value: []</span>
  pid_file                       <span style="color:#007020">String</span>
  policy_group                   <span style="color:#007020">String</span>
  policy_name                    <span style="color:#007020">String</span>
  policy_persist_run_list        <span style="color:#007020">true</span>, <span style="color:#007020">false</span>
  report_handlers                <span style="color:#007020">Array</span> <span style="color:#60a0b0;font-style:italic"># default value: []</span>
  ssl_verify_mode                <span style="color:#60add5">Symbol</span>, <span style="color:#007020">String</span>
  start_handlers                 <span style="color:#007020">Array</span> <span style="color:#60a0b0;font-style:italic"># default value: []</span>
  user                           <span style="color:#007020">String</span>
  action                         <span style="color:#60add5">Symbol</span> <span style="color:#60a0b0;font-style:italic"># defaults to :create if not specified</span>
<span style="color:#007020;font-weight:700">end</span></code></pre></div> <p>where:</p> <ul> <li>
<code>chef_client_config</code> is the resource.</li> <li>
<code>name</code> is the name given to the resource block.</li> <li>
<code>action</code> identifies which steps Chef Infra Client will take to bring the node into the desired state.</li> <li>
<code>additional_config</code>, <code>chef_license</code>, <code>chef_server_url</code>, <code>config_directory</code>, <code>data_collector_server_url</code>, <code>data_collector_token</code>, <code>event_loggers</code>, <code>exception_handlers</code>, <code>file_backup_path</code>, <code>file_cache_path</code>, <code>file_staging_uses_destdir</code>, <code>formatters</code>, <code>ftp_proxy</code>, <code>group</code>, <code>http_proxy</code>, <code>https_proxy</code>, <code>log_level</code>, <code>log_location</code>, <code>minimal_ohai</code>, <code>named_run_list</code>, <code>no_proxy</code>, <code>node_name</code>, <code>ohai_disabled_plugins</code>, <code>ohai_optional_plugins</code>, <code>pid_file</code>, <code>policy_group</code>, <code>policy_name</code>, <code>policy_persist_run_list</code>, <code>report_handlers</code>, <code>ssl_verify_mode</code>, <code>start_handlers</code>, and <code>user</code> are the properties available to this resource.</li> </ul> <h2 id="actions">Actions</h2> <hr> <p>The <strong>chef_client_config</strong> resource has the following actions:</p> <dl> <dt><code>:create</code></dt> <dd>Create a client.rb config file for configuring Chef Infra Client. (default)</dd> <dt><code>:nothing</code></dt> <dd>This resource block does not act unless notified by another resource to take action. Once notified, this resource block either runs immediately or is queued up to run at the end of a Chef Infra Client run.</dd> <dt><code>:remove</code></dt> <dd>Remove a client.rb config file for configuring Chef Infra Client.</dd> </dl> <h2 id="properties">Properties</h2> <hr> <p>The <strong>chef_client_config</strong> resource has the following properties:</p> <dl> <dt> <code>additional_config</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>Additional text to add at the bottom of the client.rb config. This can be used to run custom Ruby or to add less common config options</p> </dd> </dl> <dl> <dt> <code>chef_license</code> </dt> <dd> <strong>Ruby Type:</strong> String <strong>Allowed Values:</strong> <code>"accept", "accept-no-persist", "accept-silent"</code> <p>Accept the <a href="https://www.chef.io/end-user-license-agreement/">Chef EULA</a></p> </dd> </dl> <dl> <dt> <code>chef_server_url</code> </dt> <dd> <strong>Ruby Type:</strong> String | <code>REQUIRED</code> <p>The URL for the Chef Infra Server.</p> </dd> </dl> <dl> <dt> <code>config_directory</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>`/etc/chef/` on *nix-like systems and `C:\chef\` on Windows</code> <p>The directory to store the client.rb in.</p> </dd> </dl> <dl> <dt> <code>data_collector_server_url</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The data collector URL (typically automate) to send node, converge, and compliance data.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>If possible, use Chef Infra Server to do all data collection reporting, as this removes the need to distribute tokens to individual nodes.</p> </div> </div> <p> New in Chef Infra Client 17.8 </p> </dd> </dl> <dl> <dt> <code>data_collector_token</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The data collector token to interact with the data collector server URL (Automate).</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>If possible, use Chef Infra Server to do all data collection reporting, as this removes the need to distribute tokens to individual nodes.</p> </div> </div> <p> New in Chef Infra Client 17.8 </p> </dd> </dl> <dl> <dt> <code>event_loggers</code> </dt> <dd> <strong>Ruby Type:</strong> Array | <strong>Default Value:</strong> <code>[]</code> </dd> </dl> <dl> <dt> <code>exception_handlers</code> </dt> <dd> <strong>Ruby Type:</strong> Array | <strong>Default Value:</strong> <code>[]</code> <p>An array of hashes that contain a exception handler class and the arguments to pass to that class on initialization. The hash should include <code>class</code> and <code>argument</code> keys where <code>class</code> is a String and <code>argument</code> is an array of quoted String values. For example: <code>[{'class' =&gt; 'MyHandler', %w('"argument1"', '"argument2"')}]</code></p> </dd> </dl> <dl> <dt> <code>file_backup_path</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The location in which backup files are stored. If this value is empty, backup files are stored in the directory of the target file</p> </dd> </dl> <dl> <dt> <code>file_cache_path</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The location in which cookbooks (and other transient data) files are stored when they are synchronized. This value can also be used in recipes to download files with the <code>remote_file</code> resource.</p> </dd> </dl> <dl> <dt> <code>file_staging_uses_destdir</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>How file staging (via temporary files) is done. When <code>true</code>, temporary files are created in the directory in which files will reside. When <code>false</code>, temporary files are created under <code>ENV['TMP']</code></p> </dd> </dl> <dl> <dt> <code>formatters</code> </dt> <dd> <strong>Ruby Type:</strong> Array | <strong>Default Value:</strong> <code>[]</code> <p>Client logging formatters to load.</p> </dd> </dl> <dl> <dt> <code>ftp_proxy</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The proxy server to use for FTP connections.</p> </dd> </dl> <dl> <dt> <code>group</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The group that should own the client.rb file and the configuration directory if it needs to be created.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>The configuration directory will not be created if it already exists, which allows you to further control the setup of that directory outside of this resource.</p> </div> </div> </dd> </dl> <dl> <dt> <code>http_proxy</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The proxy server to use for HTTP connections.</p> </dd> </dl> <dl> <dt> <code>https_proxy</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The proxy server to use for HTTPS connections.</p> </dd> </dl> <dl> <dt> <code>log_level</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol <strong>Allowed Values:</strong> <code>:auto, :debug, :fatal, :info, :trace, :warn</code> <p>The level of logging performed by the Chef Infra Client.</p> </dd> </dl> <dl> <dt> <code>log_location</code> </dt> <dd> <strong>Ruby Type:</strong> String, Symbol <p>The location to save logs to. This can either by a path to a log file on disk <code>:syslog</code> to log to Syslog, <code>:win_evt</code> to log to the Windows Event Log, or <code>'STDERR'</code>/<code>'STDOUT'</code> to log to the *nix text streams.</p> </dd> </dl> <dl> <dt> <code>minimal_ohai</code> </dt> <dd> <strong>Ruby Type:</strong> true, false <p>Run a minimal set of Ohai plugins providing data necessary for the execution of Chef Infra Client’s built-in resources. Setting this to true will skip many large and time consuming data sets such as <code>cloud</code> or <code>packages</code>. Setting this this to true may break cookbooks that assume all Ohai data will be present.</p> </dd> </dl> <dl> <dt> <code>named_run_list</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>A specific named runlist defined in the node’s applied Policyfile, which the should be used when running Chef Infra Client.</p> </dd> </dl> <dl> <dt> <code>no_proxy</code> </dt> <dd> <strong>Ruby Type:</strong> String, Array | <strong>Default Value:</strong> <code>[]</code> <p>A comma-separated list or an array of URLs that do not need a proxy.</p> </dd> </dl> <dl> <dt> <code>node_name</code> </dt> <dd> <strong>Ruby Type:</strong> String | <strong>Default Value:</strong> <code>The `node.name` value reported by Chef Infra Client.</code> <p>The name of the node. This configuration sets the <code>node.name</code> value used in cookbooks and the <code>client_name</code> value used when authenticating to a Chef Infra Server to determine what configuration to apply.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>By default this configuration uses the <code>node.name</code> value which would be set during bootstrap. Hard coding this value in the <code>client.rb</code> config avoids logic within Chef Infra Server that performs DNS lookups and may fail in the event of a DNS outage. To skip this default value and instead use the built-in Chef Infra Server logic, set this property to <code>nil</code></p> </div> </div> </dd> </dl> <dl> <dt> <code>ohai_disabled_plugins</code> </dt> <dd> <strong>Ruby Type:</strong> Array | <strong>Default Value:</strong> <code>[]</code> <p>Ohai plugins that should be disabled in order to speed up the Chef Infra Client run and reduce the size of node data sent to Chef Infra Client</p> </dd> </dl> <dl> <dt> <code>ohai_optional_plugins</code> </dt> <dd> <strong>Ruby Type:</strong> Array | <strong>Default Value:</strong> <code>[]</code> <p>Optional Ohai plugins that should be enabled to provide additional Ohai data for use in cookbooks.</p> </dd> </dl> <dl> <dt> <code>pid_file</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The location in which a process identification number (pid) is saved. An executable, when started as a daemon, writes the pid to the specified file.</p> </dd> </dl> <dl> <dt> <code>policy_group</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The name of a <code>policy group</code> that exists on the Chef Infra Server. <code>policy_name</code> must also be specified when setting this property.</p> </dd> </dl> <dl> <dt> <code>policy_name</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The name of a policy, as identified by the <code>name</code> setting in a Policyfile.rb file. <code>policy_group</code> when setting this property.</p> </dd> </dl> <dl> <dt> <code>policy_persist_run_list</code> </dt> <dd> <strong>Ruby Type:</strong> true, false <p>Override run lists defined in a Policyfile with the <code>run_list</code> defined on the Chef Infra Server.</p> <p> New in Chef Infra Client 17.3 </p> </dd> </dl> <dl> <dt> <code>report_handlers</code> </dt> <dd> <strong>Ruby Type:</strong> Array | <strong>Default Value:</strong> <code>[]</code> <p>An array of hashes that contain a report handler class and the arguments to pass to that class on initialization. The hash should include <code>class</code> and <code>argument</code> keys where <code>class</code> is a String and <code>argument</code> is an array of quoted String values. For example: <code>[{'class' =&gt; 'MyHandler', %w('"argument1"', '"argument2"')}]</code></p> </dd> </dl> <dl> <dt> <code>ssl_verify_mode</code> </dt> <dd> <strong>Ruby Type:</strong> Symbol, String <strong>Allowed Values:</strong> <code>:verify_none, :verify_peer</code> 
<p>Set the verify mode for HTTPS requests.</p> <ul> <li>Use :verify_none for no validation of SSL certificates.</li> <li>Use :verify_peer for validation of all SSL certificates, including the Chef Infra Server connections, S3 connections, and any HTTPS remote_file resource URLs used in Chef Infra Client runs. This is the recommended setting.</li> </ul> </dd> </dl> <dl> <dt> <code>start_handlers</code> </dt> <dd> <strong>Ruby Type:</strong> Array | <strong>Default Value:</strong> <code>[]</code> <p>An array of hashes that contain a report handler class and the arguments to pass to that class on initialization. The hash should include <code>class</code> and <code>argument</code> keys where <code>class</code> is a String and <code>argument</code> is an array of quoted String values. For example: <code>[{'class' =&gt; 'MyHandler', %w('"argument1"', '"argument2"')}]</code></p> </dd> </dl> <dl> <dt> <code>user</code> </dt> <dd> <strong>Ruby Type:</strong> String <p>The user that should own the client.rb file and the configuration directory if it needs to be created.</p> <div class="admonition-note"> <p class="admonition-note-title">Note</p> <div class="admonition-note-text"> <p>The configuration directory will not be created if it already exists, which allows you to further control the setup of that directory outside of this resource.</p> </div> </div> </dd> </dl> <br> <h2 id="functionality">Common Resource Functionality</h2> <hr> <p>Chef resources include common properties, notifications, and resource guards.</p> <h3 id="resources-common-properties">Common Properties</h3> <p>The following properties are common to every resource:</p> <dl> <dt><code>compile_time</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Control the phase during which the resource is run on the node. Set to true to run while the resource collection is being built (the <code>compile phase</code>). Set to false to run while Chef Infra Client is configuring the node (the <code>converge phase</code>).</p> </dd> <dt><code>ignore_failure</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false, :quiet | <strong>Default Value:</strong> <code>false</code></p> <p>Continue running a recipe if a resource fails for any reason. <code>:quiet</code> will not display the full stack trace and the recipe will continue to run if a resource fails.</p> </dd> <dt><code>retries</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>0</code></p> <p>The number of attempts to catch exceptions and retry the resource.</p> </dd> <dt><code>retry_delay</code></dt> <dd> <p><strong>Ruby Type:</strong> Integer | <strong>Default Value:</strong> <code>2</code></p> <p>The delay in seconds between retry attempts.</p> </dd> <dt><code>sensitive</code></dt> <dd> <p><strong>Ruby Type:</strong> true, false | <strong>Default Value:</strong> <code>false</code></p> <p>Ensure that sensitive resource data is not logged by Chef Infra Client.</p> </dd> </dl> <h3 id="resources-common-notifications">Notifications</h3> <dl> <dt> <code>notifies</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> that resource should take, and then the <code>:timer</code> for that action. A resource may notify more than one resource; use a <code>notifies</code> statement for each resource to be notified.</p> <p>If the referenced resource does not exist, an error is raised. In contrast, <code>subscribes</code> will not fail if the source resource is not found.</p> </dd> </dl> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>notifies</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">notifies <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <dl> <dt> <code>subscribes</code> </dt> <dd> <p><strong>Ruby Type:</strong> Symbol, 'Chef::Resource[String]'</p> </dd> </dl> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code>'resource[name]'</code>, the <code>:action</code> to be taken, and then the <code>:timer</code> for that action.</p> <p>Note that <code>subscribes</code> does not apply the specified action to the resource that it listens to - for example:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">file <span style="color:#4070a0">'/etc/nginx/ssl/example.crt'</span> <span style="color:#007020;font-weight:700">do</span>
  mode <span style="color:#4070a0">'0600'</span>
  owner <span style="color:#4070a0">'root'</span>
<span style="color:#007020;font-weight:700">end</span>

service <span style="color:#4070a0">'nginx'</span> <span style="color:#007020;font-weight:700">do</span>
  subscribes <span style="color:#517918">:reload</span>, <span style="color:#4070a0">'file[/etc/nginx/ssl/example.crt]'</span>, <span style="color:#517918">:immediately</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p>In this case the <code>subscribes</code> property reloads the <code>nginx</code> service whenever its certificate file, located under <code>/etc/nginx/ssl/example.crt</code>, is updated. <code>subscribes</code> does not make any changes to the certificate file itself, it merely listens for a change to the file, and executes the <code>:reload</code> action for its resource (in this example <code>nginx</code>) when a change is detected.</p> <p>If the other resource does not exist, the subscription will not raise an error. Contrast this with the stricter semantics of <code>notifies</code>, which will raise an error if the other resource does not exist.</p> <p>A timer specifies the point during a Chef Infra Client run at which a notification is run. The following timers are available:</p> <dl> <dt><code>:before</code></dt> <dd> <p>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</p> </dd> <dt><code>:delayed</code></dt> <dd> <p>Default. Specifies that a notification should be queued up, and then executed at the end of a Chef Infra Client run.</p> </dd> <dt>
<code>:immediate</code>, <code>:immediately</code>
</dt> <dd> <p>Specifies that a notification should be run immediately, per resource notified.</p> </dd> </dl> <p>The syntax for <code>subscribes</code> is:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">subscribes <span style="color:#517918">:action</span>, <span style="color:#4070a0">'resource[name]'</span>, <span style="color:#517918">:timer</span>
</code></pre></div> <h3 id="guards">Guards</h3> <p>A guard property can be used to evaluate the state of a node during the execution phase of a Chef Infra Client run. Based on the results of this evaluation, a guard property is then used to tell Chef Infra Client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p> <ul> <li>A string is executed as a shell command. If the command returns <code>0</code>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <code>true</code> in addition to <code>0</code>.</li> <li>A block is executed as Ruby code that must return either <code>true</code> or <code>false</code>. If the block returns <code>true</code>, the guard property is applied. If the block returns <code>false</code>, the guard property is not applied.</li> </ul> <p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for Chef Infra Client to do nothing.</p> <strong>Properties</strong> <p>The following properties can be used to define a guard that is evaluated during the execution phase of a Chef Infra Client run:</p> <dl> <dt><code>not_if</code></dt> <dd> <p>Prevent a resource from executing when the condition returns <code>true</code>.</p> </dd> <dt><code>only_if</code></dt> <dd> <p>Allow a resource to execute only if the condition returns <code>true</code>.</p> </dd> </dl> <h2 id="examples">Examples</h2> <hr> <p>The following examples demonstrate various approaches for using the <strong>chef_client_config</strong> resource in recipes:</p> <p><strong>Bare minimum Chef Infra Client client.rb</strong>:</p> <p>The absolute minimum configuration necessary for a node to communicate with the Chef Infra Server is the URL of the Chef Infra Server. All other configuration options either have values at the server side (Policyfiles, Roles, Environments, etc) or have default values determined at client startup.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_client_config <span style="color:#4070a0">'Create client.rb'</span> <span style="color:#007020;font-weight:700">do</span>
  chef_server_url <span style="color:#4070a0">'https://chef.example.dmz'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>More complex Chef Infra Client client.rb</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_client_config <span style="color:#4070a0">'Create client.rb'</span> <span style="color:#007020;font-weight:700">do</span>
  chef_server_url <span style="color:#4070a0">'https://chef.example.dmz'</span>
  log_level <span style="color:#517918">:info</span>
  log_location <span style="color:#517918">:syslog</span>
  http_proxy <span style="color:#4070a0">'proxy.example.dmz'</span>
  https_proxy <span style="color:#4070a0">'proxy.example.dmz'</span>
  no_proxy <span style="color:#c65d09">%w(internal.example.dmz)</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Adding additional config content to the client.rb</strong>:</p> <p>This resource aims to provide common configuration options. Some configuration options are missing and some users may want to use arbitrary Ruby code within their configuration. For this we offer an <code>additional_config</code> property that can be used to add any configuration or code to the bottom of the <code>client.rb</code> file. Also keep in mind that within the configuration directory is a <code>client.d</code> directory where you can put additional <code>.rb</code> files containing configuration options. These can be created using <code>file</code> or <code>template</code> resources within your cookbooks as necessary.</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_client_config <span style="color:#4070a0">'Create client.rb'</span> <span style="color:#007020;font-weight:700">do</span>
  chef_server_url <span style="color:#4070a0">'https://chef.example.dmz'</span>
  additional_config <span style="color:#666">&lt;&lt;~</span><span style="color:#60add5">CONFIG</span>
    <span style="color:#60a0b0;font-style:italic"># Extra config code to safely load a gem into the client run.</span>
    <span style="color:#60a0b0;font-style:italic"># Since the config is Ruby you can run any Ruby code you want via the client.rb.</span>
    <span style="color:#60a0b0;font-style:italic"># It's a great way to break things, so be careful</span>
    <span style="color:#007020;font-weight:700">begin</span>
      <span style="color:#007020">require</span> <span style="color:#4070a0">'aws-sdk'</span>
    <span style="color:#007020;font-weight:700">rescue</span> <span style="color:#60add5">LoadError</span>
      <span style="color:#60add5">Chef</span><span style="color:#666">::</span><span style="color:#60add5">Log</span><span style="color:#666">.</span>warn <span style="color:#4070a0">"Failed to load aws-sdk."</span>
    <span style="color:#007020;font-weight:700">end</span>
  <span style="color:#60add5">CONFIG</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Setup two report handlers in the client.rb</strong>:</p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_client_config <span style="color:#4070a0">'Create client.rb'</span> <span style="color:#007020;font-weight:700">do</span>
  chef_server_url <span style="color:#4070a0">'https://chef.example.dmz'</span>
  report_handlers <span style="color:#666">[</span>
    {
     <span style="color:#4070a0">'class'</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'ReportHandler1Class'</span>,
     <span style="color:#4070a0">'arguments'</span> <span style="color:#666">=&gt;</span> <span style="color:#666">[</span><span style="color:#4070a0">"'FirstArgument'"</span>, <span style="color:#4070a0">"'SecondArgument'"</span><span style="color:#666">]</span>,
    },
    {
     <span style="color:#4070a0">'class'</span> <span style="color:#666">=&gt;</span> <span style="color:#4070a0">'ReportHandler2Class'</span>,
     <span style="color:#4070a0">'arguments'</span> <span style="color:#666">=&gt;</span> <span style="color:#666">[</span><span style="color:#4070a0">"'FirstArgument'"</span>, <span style="color:#4070a0">"'SecondArgument'"</span><span style="color:#666">]</span>,
    },
  <span style="color:#666">]</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div>
<p><strong>Report directly to the <a href="../../automate/data_collection/index.html#configure-chef-infra-client-to-use-the-data-collector-endpoint-in-chef-automate">Chef Automate data collector endpoint</a>.</strong></p> <div class="highlight"><pre tabindex="0" class="highlight" data-language="ruby"><code class="language-ruby" data-lang="ruby">chef_client_config <span style="color:#4070a0">'Create client.rb'</span> <span style="color:#007020;font-weight:700">do</span>
  chef_server_url <span style="color:#4070a0">'https://chef.example.dmz'</span>
  data_collector_server_url <span style="color:#4070a0">'https://automate.example.dmz'</span>
  data_collector_token <span style="color:#4070a0">'TEST_TOKEN_TEST'</span>
<span style="color:#007020;font-weight:700">end</span>
</code></pre></div> </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; Chef Software, Inc.<br>Licensed under the Creative Commons Attribution 3.0 Unported License.<br>The Chef&trade; Mark and Chef Logo are either registered trademarks/service marks or trademarks/servicemarks of Chef, in the United States and other countries and are used with Chef Inc's permission.<br>We are not affiliated with, endorsed or sponsored by Chef Inc.<br>
    <a href="https://docs.chef.io/resources/chef_client_config/" class="_attribution-link">https://docs.chef.io/resources/chef_client_config/</a>
  </p>
</div>
